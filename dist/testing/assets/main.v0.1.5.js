function Oge(r,t){for(var s=0;s<t.length;s++){const a=t[s];if(typeof a!="string"&&!Array.isArray(a)){for(const l in a)if(l!=="default"&&!(l in r)){const d=Object.getOwnPropertyDescriptor(a,l);d&&Object.defineProperty(r,l,d.get?d:{enumerable:!0,get:()=>a[l]})}}}return Object.freeze(Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}))}var D_=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function BS(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var Jx={exports:{}},Sb={},Qx={exports:{}},lr={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var LK;function Pge(){if(LK)return lr;LK=1;var r=Symbol.for("react.element"),t=Symbol.for("react.portal"),s=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),l=Symbol.for("react.profiler"),d=Symbol.for("react.provider"),p=Symbol.for("react.context"),E=Symbol.for("react.forward_ref"),v=Symbol.for("react.suspense"),b=Symbol.for("react.memo"),R=Symbol.for("react.lazy"),O=Symbol.iterator;function N(Ae){return Ae===null||typeof Ae!="object"?null:(Ae=O&&Ae[O]||Ae["@@iterator"],typeof Ae=="function"?Ae:null)}var F={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},H=Object.assign,z={};function G(Ae,qe,Ze){this.props=Ae,this.context=qe,this.refs=z,this.updater=Ze||F}G.prototype.isReactComponent={},G.prototype.setState=function(Ae,qe){if(typeof Ae!="object"&&typeof Ae!="function"&&Ae!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,Ae,qe,"setState")},G.prototype.forceUpdate=function(Ae){this.updater.enqueueForceUpdate(this,Ae,"forceUpdate")};function ee(){}ee.prototype=G.prototype;function J(Ae,qe,Ze){this.props=Ae,this.context=qe,this.refs=z,this.updater=Ze||F}var re=J.prototype=new ee;re.constructor=J,H(re,G.prototype),re.isPureReactComponent=!0;var de=Array.isArray,se=Object.prototype.hasOwnProperty,ye={current:null},Q={key:!0,ref:!0,__self:!0,__source:!0};function ne(Ae,qe,Ze){var Fe,lt={},Et=null,Nt=null;if(qe!=null)for(Fe in qe.ref!==void 0&&(Nt=qe.ref),qe.key!==void 0&&(Et=""+qe.key),qe)se.call(qe,Fe)&&!Q.hasOwnProperty(Fe)&&(lt[Fe]=qe[Fe]);var $t=arguments.length-2;if($t===1)lt.children=Ze;else if(1<$t){for(var xt=Array($t),En=0;En<$t;En++)xt[En]=arguments[En+2];lt.children=xt}if(Ae&&Ae.defaultProps)for(Fe in $t=Ae.defaultProps,$t)lt[Fe]===void 0&&(lt[Fe]=$t[Fe]);return{$$typeof:r,type:Ae,key:Et,ref:Nt,props:lt,_owner:ye.current}}function oe(Ae,qe){return{$$typeof:r,type:Ae.type,key:qe,ref:Ae.ref,props:Ae.props,_owner:Ae._owner}}function ue(Ae){return typeof Ae=="object"&&Ae!==null&&Ae.$$typeof===r}function Ee(Ae){var qe={"=":"=0",":":"=2"};return"$"+Ae.replace(/[=:]/g,function(Ze){return qe[Ze]})}var fe=/\/+/g;function le(Ae,qe){return typeof Ae=="object"&&Ae!==null&&Ae.key!=null?Ee(""+Ae.key):qe.toString(36)}function Le(Ae,qe,Ze,Fe,lt){var Et=typeof Ae;(Et==="undefined"||Et==="boolean")&&(Ae=null);var Nt=!1;if(Ae===null)Nt=!0;else switch(Et){case"string":case"number":Nt=!0;break;case"object":switch(Ae.$$typeof){case r:case t:Nt=!0}}if(Nt)return Nt=Ae,lt=lt(Nt),Ae=Fe===""?"."+le(Nt,0):Fe,de(lt)?(Ze="",Ae!=null&&(Ze=Ae.replace(fe,"$&/")+"/"),Le(lt,qe,Ze,"",function(En){return En})):lt!=null&&(ue(lt)&&(lt=oe(lt,Ze+(!lt.key||Nt&&Nt.key===lt.key?"":(""+lt.key).replace(fe,"$&/")+"/")+Ae)),qe.push(lt)),1;if(Nt=0,Fe=Fe===""?".":Fe+":",de(Ae))for(var $t=0;$t<Ae.length;$t++){Et=Ae[$t];var xt=Fe+le(Et,$t);Nt+=Le(Et,qe,Ze,xt,lt)}else if(xt=N(Ae),typeof xt=="function")for(Ae=xt.call(Ae),$t=0;!(Et=Ae.next()).done;)Et=Et.value,xt=Fe+le(Et,$t++),Nt+=Le(Et,qe,Ze,xt,lt);else if(Et==="object")throw qe=String(Ae),Error("Objects are not valid as a React child (found: "+(qe==="[object Object]"?"object with keys {"+Object.keys(Ae).join(", ")+"}":qe)+"). If you meant to render a collection of children, use an array instead.");return Nt}function pt(Ae,qe,Ze){if(Ae==null)return Ae;var Fe=[],lt=0;return Le(Ae,Fe,"","",function(Et){return qe.call(Ze,Et,lt++)}),Fe}function et(Ae){if(Ae._status===-1){var qe=Ae._result;qe=qe(),qe.then(function(Ze){(Ae._status===0||Ae._status===-1)&&(Ae._status=1,Ae._result=Ze)},function(Ze){(Ae._status===0||Ae._status===-1)&&(Ae._status=2,Ae._result=Ze)}),Ae._status===-1&&(Ae._status=0,Ae._result=qe)}if(Ae._status===1)return Ae._result.default;throw Ae._result}var Oe={current:null},Ue={transition:null},Me={ReactCurrentDispatcher:Oe,ReactCurrentBatchConfig:Ue,ReactCurrentOwner:ye};function it(){throw Error("act(...) is not supported in production builds of React.")}return lr.Children={map:pt,forEach:function(Ae,qe,Ze){pt(Ae,function(){qe.apply(this,arguments)},Ze)},count:function(Ae){var qe=0;return pt(Ae,function(){qe++}),qe},toArray:function(Ae){return pt(Ae,function(qe){return qe})||[]},only:function(Ae){if(!ue(Ae))throw Error("React.Children.only expected to receive a single React element child.");return Ae}},lr.Component=G,lr.Fragment=s,lr.Profiler=l,lr.PureComponent=J,lr.StrictMode=a,lr.Suspense=v,lr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Me,lr.act=it,lr.cloneElement=function(Ae,qe,Ze){if(Ae==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+Ae+".");var Fe=H({},Ae.props),lt=Ae.key,Et=Ae.ref,Nt=Ae._owner;if(qe!=null){if(qe.ref!==void 0&&(Et=qe.ref,Nt=ye.current),qe.key!==void 0&&(lt=""+qe.key),Ae.type&&Ae.type.defaultProps)var $t=Ae.type.defaultProps;for(xt in qe)se.call(qe,xt)&&!Q.hasOwnProperty(xt)&&(Fe[xt]=qe[xt]===void 0&&$t!==void 0?$t[xt]:qe[xt])}var xt=arguments.length-2;if(xt===1)Fe.children=Ze;else if(1<xt){$t=Array(xt);for(var En=0;En<xt;En++)$t[En]=arguments[En+2];Fe.children=$t}return{$$typeof:r,type:Ae.type,key:lt,ref:Et,props:Fe,_owner:Nt}},lr.createContext=function(Ae){return Ae={$$typeof:p,_currentValue:Ae,_currentValue2:Ae,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},Ae.Provider={$$typeof:d,_context:Ae},Ae.Consumer=Ae},lr.createElement=ne,lr.createFactory=function(Ae){var qe=ne.bind(null,Ae);return qe.type=Ae,qe},lr.createRef=function(){return{current:null}},lr.forwardRef=function(Ae){return{$$typeof:E,render:Ae}},lr.isValidElement=ue,lr.lazy=function(Ae){return{$$typeof:R,_payload:{_status:-1,_result:Ae},_init:et}},lr.memo=function(Ae,qe){return{$$typeof:b,type:Ae,compare:qe===void 0?null:qe}},lr.startTransition=function(Ae){var qe=Ue.transition;Ue.transition={};try{Ae()}finally{Ue.transition=qe}},lr.unstable_act=it,lr.useCallback=function(Ae,qe){return Oe.current.useCallback(Ae,qe)},lr.useContext=function(Ae){return Oe.current.useContext(Ae)},lr.useDebugValue=function(){},lr.useDeferredValue=function(Ae){return Oe.current.useDeferredValue(Ae)},lr.useEffect=function(Ae,qe){return Oe.current.useEffect(Ae,qe)},lr.useId=function(){return Oe.current.useId()},lr.useImperativeHandle=function(Ae,qe,Ze){return Oe.current.useImperativeHandle(Ae,qe,Ze)},lr.useInsertionEffect=function(Ae,qe){return Oe.current.useInsertionEffect(Ae,qe)},lr.useLayoutEffect=function(Ae,qe){return Oe.current.useLayoutEffect(Ae,qe)},lr.useMemo=function(Ae,qe){return Oe.current.useMemo(Ae,qe)},lr.useReducer=function(Ae,qe,Ze){return Oe.current.useReducer(Ae,qe,Ze)},lr.useRef=function(Ae){return Oe.current.useRef(Ae)},lr.useState=function(Ae){return Oe.current.useState(Ae)},lr.useSyncExternalStore=function(Ae,qe,Ze){return Oe.current.useSyncExternalStore(Ae,qe,Ze)},lr.useTransition=function(){return Oe.current.useTransition()},lr.version="18.3.1",lr}var xK;function uu(){return xK||(xK=1,Qx.exports=Pge()),Qx.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var MK;function Nge(){if(MK)return Sb;MK=1;var r=uu(),t=Symbol.for("react.element"),s=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,l=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,d={key:!0,ref:!0,__self:!0,__source:!0};function p(E,v,b){var R,O={},N=null,F=null;b!==void 0&&(N=""+b),v.key!==void 0&&(N=""+v.key),v.ref!==void 0&&(F=v.ref);for(R in v)a.call(v,R)&&!d.hasOwnProperty(R)&&(O[R]=v[R]);if(E&&E.defaultProps)for(R in v=E.defaultProps,v)O[R]===void 0&&(O[R]=v[R]);return{$$typeof:t,type:E,key:N,ref:F,props:O,_owner:l.current}}return Sb.Fragment=s,Sb.jsx=p,Sb.jsxs=p,Sb}var UK;function kge(){return UK||(UK=1,Jx.exports=Nge()),Jx.exports}var D=kge(),V=uu();const Zr=BS(V),VK=Oge({__proto__:null,default:Zr},[V]);var vO={},Zx={exports:{}},Ac={},eM={exports:{}},tM={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var FK;function Dge(){return FK||(FK=1,function(r){function t(Ue,Me){var it=Ue.length;Ue.push(Me);e:for(;0<it;){var Ae=it-1>>>1,qe=Ue[Ae];if(0<l(qe,Me))Ue[Ae]=Me,Ue[it]=qe,it=Ae;else break e}}function s(Ue){return Ue.length===0?null:Ue[0]}function a(Ue){if(Ue.length===0)return null;var Me=Ue[0],it=Ue.pop();if(it!==Me){Ue[0]=it;e:for(var Ae=0,qe=Ue.length,Ze=qe>>>1;Ae<Ze;){var Fe=2*(Ae+1)-1,lt=Ue[Fe],Et=Fe+1,Nt=Ue[Et];if(0>l(lt,it))Et<qe&&0>l(Nt,lt)?(Ue[Ae]=Nt,Ue[Et]=it,Ae=Et):(Ue[Ae]=lt,Ue[Fe]=it,Ae=Fe);else if(Et<qe&&0>l(Nt,it))Ue[Ae]=Nt,Ue[Et]=it,Ae=Et;else break e}}return Me}function l(Ue,Me){var it=Ue.sortIndex-Me.sortIndex;return it!==0?it:Ue.id-Me.id}if(typeof performance=="object"&&typeof performance.now=="function"){var d=performance;r.unstable_now=function(){return d.now()}}else{var p=Date,E=p.now();r.unstable_now=function(){return p.now()-E}}var v=[],b=[],R=1,O=null,N=3,F=!1,H=!1,z=!1,G=typeof setTimeout=="function"?setTimeout:null,ee=typeof clearTimeout=="function"?clearTimeout:null,J=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function re(Ue){for(var Me=s(b);Me!==null;){if(Me.callback===null)a(b);else if(Me.startTime<=Ue)a(b),Me.sortIndex=Me.expirationTime,t(v,Me);else break;Me=s(b)}}function de(Ue){if(z=!1,re(Ue),!H)if(s(v)!==null)H=!0,et(se);else{var Me=s(b);Me!==null&&Oe(de,Me.startTime-Ue)}}function se(Ue,Me){H=!1,z&&(z=!1,ee(ne),ne=-1),F=!0;var it=N;try{for(re(Me),O=s(v);O!==null&&(!(O.expirationTime>Me)||Ue&&!Ee());){var Ae=O.callback;if(typeof Ae=="function"){O.callback=null,N=O.priorityLevel;var qe=Ae(O.expirationTime<=Me);Me=r.unstable_now(),typeof qe=="function"?O.callback=qe:O===s(v)&&a(v),re(Me)}else a(v);O=s(v)}if(O!==null)var Ze=!0;else{var Fe=s(b);Fe!==null&&Oe(de,Fe.startTime-Me),Ze=!1}return Ze}finally{O=null,N=it,F=!1}}var ye=!1,Q=null,ne=-1,oe=5,ue=-1;function Ee(){return!(r.unstable_now()-ue<oe)}function fe(){if(Q!==null){var Ue=r.unstable_now();ue=Ue;var Me=!0;try{Me=Q(!0,Ue)}finally{Me?le():(ye=!1,Q=null)}}else ye=!1}var le;if(typeof J=="function")le=function(){J(fe)};else if(typeof MessageChannel<"u"){var Le=new MessageChannel,pt=Le.port2;Le.port1.onmessage=fe,le=function(){pt.postMessage(null)}}else le=function(){G(fe,0)};function et(Ue){Q=Ue,ye||(ye=!0,le())}function Oe(Ue,Me){ne=G(function(){Ue(r.unstable_now())},Me)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(Ue){Ue.callback=null},r.unstable_continueExecution=function(){H||F||(H=!0,et(se))},r.unstable_forceFrameRate=function(Ue){0>Ue||125<Ue?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):oe=0<Ue?Math.floor(1e3/Ue):5},r.unstable_getCurrentPriorityLevel=function(){return N},r.unstable_getFirstCallbackNode=function(){return s(v)},r.unstable_next=function(Ue){switch(N){case 1:case 2:case 3:var Me=3;break;default:Me=N}var it=N;N=Me;try{return Ue()}finally{N=it}},r.unstable_pauseExecution=function(){},r.unstable_requestPaint=function(){},r.unstable_runWithPriority=function(Ue,Me){switch(Ue){case 1:case 2:case 3:case 4:case 5:break;default:Ue=3}var it=N;N=Ue;try{return Me()}finally{N=it}},r.unstable_scheduleCallback=function(Ue,Me,it){var Ae=r.unstable_now();switch(typeof it=="object"&&it!==null?(it=it.delay,it=typeof it=="number"&&0<it?Ae+it:Ae):it=Ae,Ue){case 1:var qe=-1;break;case 2:qe=250;break;case 5:qe=1073741823;break;case 4:qe=1e4;break;default:qe=5e3}return qe=it+qe,Ue={id:R++,callback:Me,priorityLevel:Ue,startTime:it,expirationTime:qe,sortIndex:-1},it>Ae?(Ue.sortIndex=it,t(b,Ue),s(v)===null&&Ue===s(b)&&(z?(ee(ne),ne=-1):z=!0,Oe(de,it-Ae))):(Ue.sortIndex=qe,t(v,Ue),H||F||(H=!0,et(se))),Ue},r.unstable_shouldYield=Ee,r.unstable_wrapCallback=function(Ue){var Me=N;return function(){var it=N;N=Me;try{return Ue.apply(this,arguments)}finally{N=it}}}}(tM)),tM}var jK;function Lge(){return jK||(jK=1,eM.exports=Dge()),eM.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var BK;function xge(){if(BK)return Ac;BK=1;var r=uu(),t=Lge();function s(f){for(var g="https://reactjs.org/docs/error-decoder.html?invariant="+f,T=1;T<arguments.length;T++)g+="&args[]="+encodeURIComponent(arguments[T]);return"Minified React error #"+f+"; visit "+g+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var a=new Set,l={};function d(f,g){p(f,g),p(f+"Capture",g)}function p(f,g){for(l[f]=g,f=0;f<g.length;f++)a.add(g[f])}var E=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),v=Object.prototype.hasOwnProperty,b=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,R={},O={};function N(f){return v.call(O,f)?!0:v.call(R,f)?!1:b.test(f)?O[f]=!0:(R[f]=!0,!1)}function F(f,g,T,A){if(T!==null&&T.type===0)return!1;switch(typeof g){case"function":case"symbol":return!0;case"boolean":return A?!1:T!==null?!T.acceptsBooleans:(f=f.toLowerCase().slice(0,5),f!=="data-"&&f!=="aria-");default:return!1}}function H(f,g,T,A){if(g===null||typeof g>"u"||F(f,g,T,A))return!0;if(A)return!1;if(T!==null)switch(T.type){case 3:return!g;case 4:return g===!1;case 5:return isNaN(g);case 6:return isNaN(g)||1>g}return!1}function z(f,g,T,A,x,W,ie){this.acceptsBooleans=g===2||g===3||g===4,this.attributeName=A,this.attributeNamespace=x,this.mustUseProperty=T,this.propertyName=f,this.type=g,this.sanitizeURL=W,this.removeEmptyString=ie}var G={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(f){G[f]=new z(f,0,!1,f,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(f){var g=f[0];G[g]=new z(g,1,!1,f[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(f){G[f]=new z(f,2,!1,f.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(f){G[f]=new z(f,2,!1,f,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(f){G[f]=new z(f,3,!1,f.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(f){G[f]=new z(f,3,!0,f,null,!1,!1)}),["capture","download"].forEach(function(f){G[f]=new z(f,4,!1,f,null,!1,!1)}),["cols","rows","size","span"].forEach(function(f){G[f]=new z(f,6,!1,f,null,!1,!1)}),["rowSpan","start"].forEach(function(f){G[f]=new z(f,5,!1,f.toLowerCase(),null,!1,!1)});var ee=/[\-:]([a-z])/g;function J(f){return f[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(f){var g=f.replace(ee,J);G[g]=new z(g,1,!1,f,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(f){var g=f.replace(ee,J);G[g]=new z(g,1,!1,f,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(f){var g=f.replace(ee,J);G[g]=new z(g,1,!1,f,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(f){G[f]=new z(f,1,!1,f.toLowerCase(),null,!1,!1)}),G.xlinkHref=new z("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(f){G[f]=new z(f,1,!1,f.toLowerCase(),null,!0,!0)});function re(f,g,T,A){var x=G.hasOwnProperty(g)?G[g]:null;(x!==null?x.type!==0:A||!(2<g.length)||g[0]!=="o"&&g[0]!=="O"||g[1]!=="n"&&g[1]!=="N")&&(H(g,T,x,A)&&(T=null),A||x===null?N(g)&&(T===null?f.removeAttribute(g):f.setAttribute(g,""+T)):x.mustUseProperty?f[x.propertyName]=T===null?x.type===3?!1:"":T:(g=x.attributeName,A=x.attributeNamespace,T===null?f.removeAttribute(g):(x=x.type,T=x===3||x===4&&T===!0?"":""+T,A?f.setAttributeNS(A,g,T):f.setAttribute(g,T))))}var de=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,se=Symbol.for("react.element"),ye=Symbol.for("react.portal"),Q=Symbol.for("react.fragment"),ne=Symbol.for("react.strict_mode"),oe=Symbol.for("react.profiler"),ue=Symbol.for("react.provider"),Ee=Symbol.for("react.context"),fe=Symbol.for("react.forward_ref"),le=Symbol.for("react.suspense"),Le=Symbol.for("react.suspense_list"),pt=Symbol.for("react.memo"),et=Symbol.for("react.lazy"),Oe=Symbol.for("react.offscreen"),Ue=Symbol.iterator;function Me(f){return f===null||typeof f!="object"?null:(f=Ue&&f[Ue]||f["@@iterator"],typeof f=="function"?f:null)}var it=Object.assign,Ae;function qe(f){if(Ae===void 0)try{throw Error()}catch(T){var g=T.stack.trim().match(/\n( *(at )?)/);Ae=g&&g[1]||""}return`
`+Ae+f}var Ze=!1;function Fe(f,g){if(!f||Ze)return"";Ze=!0;var T=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(g)if(g=function(){throw Error()},Object.defineProperty(g.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(g,[])}catch($e){var A=$e}Reflect.construct(f,[],g)}else{try{g.call()}catch($e){A=$e}f.call(g.prototype)}else{try{throw Error()}catch($e){A=$e}f()}}catch($e){if($e&&A&&typeof $e.stack=="string"){for(var x=$e.stack.split(`
`),W=A.stack.split(`
`),ie=x.length-1,Se=W.length-1;1<=ie&&0<=Se&&x[ie]!==W[Se];)Se--;for(;1<=ie&&0<=Se;ie--,Se--)if(x[ie]!==W[Se]){if(ie!==1||Se!==1)do if(ie--,Se--,0>Se||x[ie]!==W[Se]){var Ie=`
`+x[ie].replace(" at new "," at ");return f.displayName&&Ie.includes("<anonymous>")&&(Ie=Ie.replace("<anonymous>",f.displayName)),Ie}while(1<=ie&&0<=Se);break}}}finally{Ze=!1,Error.prepareStackTrace=T}return(f=f?f.displayName||f.name:"")?qe(f):""}function lt(f){switch(f.tag){case 5:return qe(f.type);case 16:return qe("Lazy");case 13:return qe("Suspense");case 19:return qe("SuspenseList");case 0:case 2:case 15:return f=Fe(f.type,!1),f;case 11:return f=Fe(f.type.render,!1),f;case 1:return f=Fe(f.type,!0),f;default:return""}}function Et(f){if(f==null)return null;if(typeof f=="function")return f.displayName||f.name||null;if(typeof f=="string")return f;switch(f){case Q:return"Fragment";case ye:return"Portal";case oe:return"Profiler";case ne:return"StrictMode";case le:return"Suspense";case Le:return"SuspenseList"}if(typeof f=="object")switch(f.$$typeof){case Ee:return(f.displayName||"Context")+".Consumer";case ue:return(f._context.displayName||"Context")+".Provider";case fe:var g=f.render;return f=f.displayName,f||(f=g.displayName||g.name||"",f=f!==""?"ForwardRef("+f+")":"ForwardRef"),f;case pt:return g=f.displayName||null,g!==null?g:Et(f.type)||"Memo";case et:g=f._payload,f=f._init;try{return Et(f(g))}catch{}}return null}function Nt(f){var g=f.type;switch(f.tag){case 24:return"Cache";case 9:return(g.displayName||"Context")+".Consumer";case 10:return(g._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return f=g.render,f=f.displayName||f.name||"",g.displayName||(f!==""?"ForwardRef("+f+")":"ForwardRef");case 7:return"Fragment";case 5:return g;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Et(g);case 8:return g===ne?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof g=="function")return g.displayName||g.name||null;if(typeof g=="string")return g}return null}function $t(f){switch(typeof f){case"boolean":case"number":case"string":case"undefined":return f;case"object":return f;default:return""}}function xt(f){var g=f.type;return(f=f.nodeName)&&f.toLowerCase()==="input"&&(g==="checkbox"||g==="radio")}function En(f){var g=xt(f)?"checked":"value",T=Object.getOwnPropertyDescriptor(f.constructor.prototype,g),A=""+f[g];if(!f.hasOwnProperty(g)&&typeof T<"u"&&typeof T.get=="function"&&typeof T.set=="function"){var x=T.get,W=T.set;return Object.defineProperty(f,g,{configurable:!0,get:function(){return x.call(this)},set:function(ie){A=""+ie,W.call(this,ie)}}),Object.defineProperty(f,g,{enumerable:T.enumerable}),{getValue:function(){return A},setValue:function(ie){A=""+ie},stopTracking:function(){f._valueTracker=null,delete f[g]}}}}function In(f){f._valueTracker||(f._valueTracker=En(f))}function hn(f){if(!f)return!1;var g=f._valueTracker;if(!g)return!0;var T=g.getValue(),A="";return f&&(A=xt(f)?f.checked?"true":"false":f.value),f=A,f!==T?(g.setValue(f),!0):!1}function Kn(f){if(f=f||(typeof document<"u"?document:void 0),typeof f>"u")return null;try{return f.activeElement||f.body}catch{return f.body}}function Ar(f,g){var T=g.checked;return it({},g,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:T??f._wrapperState.initialChecked})}function Zt(f,g){var T=g.defaultValue==null?"":g.defaultValue,A=g.checked!=null?g.checked:g.defaultChecked;T=$t(g.value!=null?g.value:T),f._wrapperState={initialChecked:A,initialValue:T,controlled:g.type==="checkbox"||g.type==="radio"?g.checked!=null:g.value!=null}}function Zn(f,g){g=g.checked,g!=null&&re(f,"checked",g,!1)}function zt(f,g){Zn(f,g);var T=$t(g.value),A=g.type;if(T!=null)A==="number"?(T===0&&f.value===""||f.value!=T)&&(f.value=""+T):f.value!==""+T&&(f.value=""+T);else if(A==="submit"||A==="reset"){f.removeAttribute("value");return}g.hasOwnProperty("value")?Ne(f,g.type,T):g.hasOwnProperty("defaultValue")&&Ne(f,g.type,$t(g.defaultValue)),g.checked==null&&g.defaultChecked!=null&&(f.defaultChecked=!!g.defaultChecked)}function ve(f,g,T){if(g.hasOwnProperty("value")||g.hasOwnProperty("defaultValue")){var A=g.type;if(!(A!=="submit"&&A!=="reset"||g.value!==void 0&&g.value!==null))return;g=""+f._wrapperState.initialValue,T||g===f.value||(f.value=g),f.defaultValue=g}T=f.name,T!==""&&(f.name=""),f.defaultChecked=!!f._wrapperState.initialChecked,T!==""&&(f.name=T)}function Ne(f,g,T){(g!=="number"||Kn(f.ownerDocument)!==f)&&(T==null?f.defaultValue=""+f._wrapperState.initialValue:f.defaultValue!==""+T&&(f.defaultValue=""+T))}var We=Array.isArray;function dt(f,g,T,A){if(f=f.options,g){g={};for(var x=0;x<T.length;x++)g["$"+T[x]]=!0;for(T=0;T<f.length;T++)x=g.hasOwnProperty("$"+f[T].value),f[T].selected!==x&&(f[T].selected=x),x&&A&&(f[T].defaultSelected=!0)}else{for(T=""+$t(T),g=null,x=0;x<f.length;x++){if(f[x].value===T){f[x].selected=!0,A&&(f[x].defaultSelected=!0);return}g!==null||f[x].disabled||(g=f[x])}g!==null&&(g.selected=!0)}}function mt(f,g){if(g.dangerouslySetInnerHTML!=null)throw Error(s(91));return it({},g,{value:void 0,defaultValue:void 0,children:""+f._wrapperState.initialValue})}function gt(f,g){var T=g.value;if(T==null){if(T=g.children,g=g.defaultValue,T!=null){if(g!=null)throw Error(s(92));if(We(T)){if(1<T.length)throw Error(s(93));T=T[0]}g=T}g==null&&(g=""),T=g}f._wrapperState={initialValue:$t(T)}}function Vt(f,g){var T=$t(g.value),A=$t(g.defaultValue);T!=null&&(T=""+T,T!==f.value&&(f.value=T),g.defaultValue==null&&f.defaultValue!==T&&(f.defaultValue=T)),A!=null&&(f.defaultValue=""+A)}function _n(f){var g=f.textContent;g===f._wrapperState.initialValue&&g!==""&&g!==null&&(f.value=g)}function kn(f){switch(f){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function rn(f,g){return f==null||f==="http://www.w3.org/1999/xhtml"?kn(g):f==="http://www.w3.org/2000/svg"&&g==="foreignObject"?"http://www.w3.org/1999/xhtml":f}var ur,$a=function(f){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(g,T,A,x){MSApp.execUnsafeLocalFunction(function(){return f(g,T,A,x)})}:f}(function(f,g){if(f.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in f)f.innerHTML=g;else{for(ur=ur||document.createElement("div"),ur.innerHTML="<svg>"+g.valueOf().toString()+"</svg>",g=ur.firstChild;f.firstChild;)f.removeChild(f.firstChild);for(;g.firstChild;)f.appendChild(g.firstChild)}});function kt(f,g){if(g){var T=f.firstChild;if(T&&T===f.lastChild&&T.nodeType===3){T.nodeValue=g;return}}f.textContent=g}var tn={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Hi=["Webkit","ms","Moz","O"];Object.keys(tn).forEach(function(f){Hi.forEach(function(g){g=g+f.charAt(0).toUpperCase()+f.substring(1),tn[g]=tn[f]})});function Cs(f,g,T){return g==null||typeof g=="boolean"||g===""?"":T||typeof g!="number"||g===0||tn.hasOwnProperty(f)&&tn[f]?(""+g).trim():g+"px"}function Vs(f,g){f=f.style;for(var T in g)if(g.hasOwnProperty(T)){var A=T.indexOf("--")===0,x=Cs(T,g[T],A);T==="float"&&(T="cssFloat"),A?f.setProperty(T,x):f[T]=x}}var li=it({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Ca(f,g){if(g){if(li[f]&&(g.children!=null||g.dangerouslySetInnerHTML!=null))throw Error(s(137,f));if(g.dangerouslySetInnerHTML!=null){if(g.children!=null)throw Error(s(60));if(typeof g.dangerouslySetInnerHTML!="object"||!("__html"in g.dangerouslySetInnerHTML))throw Error(s(61))}if(g.style!=null&&typeof g.style!="object")throw Error(s(62))}}function Bc(f,g){if(f.indexOf("-")===-1)return typeof g.is=="string";switch(f){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Zs=null;function eo(f){return f=f.target||f.srcElement||window,f.correspondingUseElement&&(f=f.correspondingUseElement),f.nodeType===3?f.parentNode:f}var yl=null,Is=null,Ya=null;function Yo(f){if(f=Cp(f)){if(typeof yl!="function")throw Error(s(280));var g=f.stateNode;g&&(g=Ip(g),yl(f.stateNode,f.type,g))}}function Xa(f){Is?Ya?Ya.push(f):Ya=[f]:Is=f}function Wc(){if(Is){var f=Is,g=Ya;if(Ya=Is=null,Yo(f),g)for(f=0;f<g.length;f++)Yo(g[f])}}function mu(f,g){return f(g)}function Ja(){}var Gc=!1;function Eo(f,g,T){if(Gc)return f(g,T);Gc=!0;try{return mu(f,g,T)}finally{Gc=!1,(Is!==null||Ya!==null)&&(Ja(),Wc())}}function Ri(f,g){var T=f.stateNode;if(T===null)return null;var A=Ip(T);if(A===null)return null;T=A[g];e:switch(g){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(A=!A.disabled)||(f=f.type,A=!(f==="button"||f==="input"||f==="select"||f==="textarea")),f=!A;break e;default:f=!1}if(f)return null;if(T&&typeof T!="function")throw Error(s(231,g,typeof T));return T}var es=!1;if(E)try{var Ia={};Object.defineProperty(Ia,"passive",{get:function(){es=!0}}),window.addEventListener("test",Ia,Ia),window.removeEventListener("test",Ia,Ia)}catch{es=!1}function gu(f,g,T,A,x,W,ie,Se,Ie){var $e=Array.prototype.slice.call(arguments,3);try{g.apply(T,$e)}catch(St){this.onError(St)}}var Qa=!1,Xo=null,Jo=!1,hd=null,rg={onError:function(f){Qa=!0,Xo=f}};function _u(f,g,T,A,x,W,ie,Se,Ie){Qa=!1,Xo=null,gu.apply(rg,arguments)}function Bh(f,g,T,A,x,W,ie,Se,Ie){if(_u.apply(this,arguments),Qa){if(Qa){var $e=Xo;Qa=!1,Xo=null}else throw Error(s(198));Jo||(Jo=!0,hd=$e)}}function As(f){var g=f,T=f;if(f.alternate)for(;g.return;)g=g.return;else{f=g;do g=f,(g.flags&4098)!==0&&(T=g.return),f=g.return;while(f)}return g.tag===3?T:null}function Eu(f){if(f.tag===13){var g=f.memoizedState;if(g===null&&(f=f.alternate,f!==null&&(g=f.memoizedState)),g!==null)return g.dehydrated}return null}function Qo(f){if(As(f)!==f)throw Error(s(188))}function fd(f){var g=f.alternate;if(!g){if(g=As(f),g===null)throw Error(s(188));return g!==f?null:f}for(var T=f,A=g;;){var x=T.return;if(x===null)break;var W=x.alternate;if(W===null){if(A=x.return,A!==null){T=A;continue}break}if(x.child===W.child){for(W=x.child;W;){if(W===T)return Qo(x),f;if(W===A)return Qo(x),g;W=W.sibling}throw Error(s(188))}if(T.return!==A.return)T=x,A=W;else{for(var ie=!1,Se=x.child;Se;){if(Se===T){ie=!0,T=x,A=W;break}if(Se===A){ie=!0,A=x,T=W;break}Se=Se.sibling}if(!ie){for(Se=W.child;Se;){if(Se===T){ie=!0,T=W,A=x;break}if(Se===A){ie=!0,A=W,T=x;break}Se=Se.sibling}if(!ie)throw Error(s(189))}}if(T.alternate!==A)throw Error(s(190))}if(T.tag!==3)throw Error(s(188));return T.stateNode.current===T?f:g}function pd(f){return f=fd(f),f!==null?Aa(f):null}function Aa(f){if(f.tag===5||f.tag===6)return f;for(f=f.child;f!==null;){var g=Aa(f);if(g!==null)return g;f=f.sibling}return null}var md=t.unstable_scheduleCallback,yu=t.unstable_cancelCallback,yo=t.unstable_shouldYield,gd=t.unstable_requestPaint,Mr=t.unstable_now,ui=t.unstable_getCurrentPriorityLevel,Za=t.unstable_ImmediatePriority,zc=t.unstable_UserBlockingPriority,Zo=t.unstable_NormalPriority,Wh=t.unstable_LowPriority,_d=t.unstable_IdlePriority,vl=null,to=null;function dp(f){if(to&&typeof to.onCommitFiberRoot=="function")try{to.onCommitFiberRoot(vl,f,void 0,(f.current.flags&128)===128)}catch{}}var Fs=Math.clz32?Math.clz32:Ed,Gh=Math.log,Hc=Math.LN2;function Ed(f){return f>>>=0,f===0?32:31-(Gh(f)/Hc|0)|0}var yd=64,ar=4194304;function Sl(f){switch(f&-f){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return f&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return f&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return f}}function Tl(f,g){var T=f.pendingLanes;if(T===0)return 0;var A=0,x=f.suspendedLanes,W=f.pingedLanes,ie=T&268435455;if(ie!==0){var Se=ie&~x;Se!==0?A=Sl(Se):(W&=ie,W!==0&&(A=Sl(W)))}else ie=T&~x,ie!==0?A=Sl(ie):W!==0&&(A=Sl(W));if(A===0)return 0;if(g!==0&&g!==A&&(g&x)===0&&(x=A&-A,W=g&-g,x>=W||x===16&&(W&4194240)!==0))return g;if((A&4)!==0&&(A|=T&16),g=f.entangledLanes,g!==0)for(f=f.entanglements,g&=A;0<g;)T=31-Fs(g),x=1<<T,A|=f[T],g&=~x;return A}function vu(f,g){switch(f){case 1:case 2:case 4:return g+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return g+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Oa(f,g){for(var T=f.suspendedLanes,A=f.pingedLanes,x=f.expirationTimes,W=f.pendingLanes;0<W;){var ie=31-Fs(W),Se=1<<ie,Ie=x[ie];Ie===-1?((Se&T)===0||(Se&A)!==0)&&(x[ie]=vu(Se,g)):Ie<=g&&(f.expiredLanes|=Se),W&=~Se}}function vo(f){return f=f.pendingLanes&-1073741825,f!==0?f:f&1073741824?1073741824:0}function Su(){var f=yd;return yd<<=1,(yd&4194240)===0&&(yd=64),f}function Kc(f){for(var g=[],T=0;31>T;T++)g.push(f);return g}function bl(f,g,T){f.pendingLanes|=g,g!==536870912&&(f.suspendedLanes=0,f.pingedLanes=0),f=f.eventTimes,g=31-Fs(g),f[g]=T}function jr(f,g){var T=f.pendingLanes&~g;f.pendingLanes=g,f.suspendedLanes=0,f.pingedLanes=0,f.expiredLanes&=g,f.mutableReadLanes&=g,f.entangledLanes&=g,g=f.entanglements;var A=f.eventTimes;for(f=f.expirationTimes;0<T;){var x=31-Fs(T),W=1<<x;g[x]=0,A[x]=-1,f[x]=-1,T&=~W}}function Pa(f,g){var T=f.entangledLanes|=g;for(f=f.entanglements;T;){var A=31-Fs(T),x=1<<A;x&g|f[A]&g&&(f[A]|=g),T&=~x}}var er=0;function ec(f){return f&=-f,1<f?4<f?(f&268435455)!==0?16:536870912:4:1}var hp,wl,vd,zh,fp,Hh=!1,So=[],Ki=null,To=null,bo=null,Rl=new Map,wo=new Map,Ro=[],pp="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function tc(f,g){switch(f){case"focusin":case"focusout":Ki=null;break;case"dragenter":case"dragleave":To=null;break;case"mouseover":case"mouseout":bo=null;break;case"pointerover":case"pointerout":Rl.delete(g.pointerId);break;case"gotpointercapture":case"lostpointercapture":wo.delete(g.pointerId)}}function ts(f,g,T,A,x,W){return f===null||f.nativeEvent!==W?(f={blockedOn:g,domEventName:T,eventSystemFlags:A,nativeEvent:W,targetContainers:[x]},g!==null&&(g=Cp(g),g!==null&&wl(g)),f):(f.eventSystemFlags|=A,g=f.targetContainers,x!==null&&g.indexOf(x)===-1&&g.push(x),f)}function Tu(f,g,T,A,x){switch(g){case"focusin":return Ki=ts(Ki,f,g,T,A,x),!0;case"dragenter":return To=ts(To,f,g,T,A,x),!0;case"mouseover":return bo=ts(bo,f,g,T,A,x),!0;case"pointerover":var W=x.pointerId;return Rl.set(W,ts(Rl.get(W)||null,f,g,T,A,x)),!0;case"gotpointercapture":return W=x.pointerId,wo.set(W,ts(wo.get(W)||null,f,g,T,A,x)),!0}return!1}function Kh(f){var g=ef(f.target);if(g!==null){var T=As(g);if(T!==null){if(g=T.tag,g===13){if(g=Eu(T),g!==null){f.blockedOn=g,fp(f.priority,function(){vd(T)});return}}else if(g===3&&T.stateNode.current.memoizedState.isDehydrated){f.blockedOn=T.tag===3?T.stateNode.containerInfo:null;return}}}f.blockedOn=null}function qc(f){if(f.blockedOn!==null)return!1;for(var g=f.targetContainers;0<g.length;){var T=fr(f.domEventName,f.eventSystemFlags,g[0],f.nativeEvent);if(T===null){T=f.nativeEvent;var A=new T.constructor(T.type,T);Zs=A,T.target.dispatchEvent(A),Zs=null}else return g=Cp(T),g!==null&&wl(g),f.blockedOn=T,!1;g.shift()}return!0}function Cl(f,g,T){qc(f)&&T.delete(g)}function mp(){Hh=!1,Ki!==null&&qc(Ki)&&(Ki=null),To!==null&&qc(To)&&(To=null),bo!==null&&qc(bo)&&(bo=null),Rl.forEach(Cl),wo.forEach(Cl)}function ea(f,g){f.blockedOn===g&&(f.blockedOn=null,Hh||(Hh=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,mp)))}function ta(f){function g(x){return ea(x,f)}if(0<So.length){ea(So[0],f);for(var T=1;T<So.length;T++){var A=So[T];A.blockedOn===f&&(A.blockedOn=null)}}for(Ki!==null&&ea(Ki,f),To!==null&&ea(To,f),bo!==null&&ea(bo,f),Rl.forEach(g),wo.forEach(g),T=0;T<Ro.length;T++)A=Ro[T],A.blockedOn===f&&(A.blockedOn=null);for(;0<Ro.length&&(T=Ro[0],T.blockedOn===null);)Kh(T),T.blockedOn===null&&Ro.shift()}var $c=de.ReactCurrentBatchConfig,_e=!0;function Re(f,g,T,A){var x=er,W=$c.transition;$c.transition=null;try{er=1,Bt(f,g,T,A)}finally{er=x,$c.transition=W}}function Ke(f,g,T,A){var x=er,W=$c.transition;$c.transition=null;try{er=4,Bt(f,g,T,A)}finally{er=x,$c.transition=W}}function Bt(f,g,T,A){if(_e){var x=fr(f,g,T,A);if(x===null)TE(f,g,A,Wn,T),tc(f,A);else if(Tu(x,f,g,T,A))A.stopPropagation();else if(tc(f,A),g&4&&-1<pp.indexOf(f)){for(;x!==null;){var W=Cp(x);if(W!==null&&hp(W),W=fr(f,g,T,A),W===null&&TE(f,g,A,Wn,T),W===x)break;x=W}x!==null&&A.stopPropagation()}else TE(f,g,A,null,T)}}var Wn=null;function fr(f,g,T,A){if(Wn=null,f=eo(A),f=ef(f),f!==null)if(g=As(f),g===null)f=null;else if(T=g.tag,T===13){if(f=Eu(g),f!==null)return f;f=null}else if(T===3){if(g.stateNode.current.memoizedState.isDehydrated)return g.tag===3?g.stateNode.containerInfo:null;f=null}else g!==f&&(f=null);return Wn=f,null}function Ur(f){switch(f){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(ui()){case Za:return 1;case zc:return 4;case Zo:case Wh:return 16;case _d:return 536870912;default:return 16}default:return 16}}var nn=null,Or=null,di=null;function _s(){if(di)return di;var f,g=Or,T=g.length,A,x="value"in nn?nn.value:nn.textContent,W=x.length;for(f=0;f<T&&g[f]===x[f];f++);var ie=T-f;for(A=1;A<=ie&&g[T-A]===x[W-A];A++);return di=x.slice(f,1<A?1-A:void 0)}function Co(f){var g=f.keyCode;return"charCode"in f?(f=f.charCode,f===0&&g===13&&(f=13)):f=g,f===10&&(f=13),32<=f||f===13?f:0}function Io(){return!0}function bu(){return!1}function Ui(f){function g(T,A,x,W,ie){this._reactName=T,this._targetInst=x,this.type=A,this.nativeEvent=W,this.target=ie,this.currentTarget=null;for(var Se in f)f.hasOwnProperty(Se)&&(T=f[Se],this[Se]=T?T(W):W[Se]);return this.isDefaultPrevented=(W.defaultPrevented!=null?W.defaultPrevented:W.returnValue===!1)?Io:bu,this.isPropagationStopped=bu,this}return it(g.prototype,{preventDefault:function(){this.defaultPrevented=!0;var T=this.nativeEvent;T&&(T.preventDefault?T.preventDefault():typeof T.returnValue!="unknown"&&(T.returnValue=!1),this.isDefaultPrevented=Io)},stopPropagation:function(){var T=this.nativeEvent;T&&(T.stopPropagation?T.stopPropagation():typeof T.cancelBubble!="unknown"&&(T.cancelBubble=!0),this.isPropagationStopped=Io)},persist:function(){},isPersistent:Io}),g}var Yc={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(f){return f.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Sd=Ui(Yc),nc=it({},Yc,{view:0,detail:0}),ig=Ui(nc),gp,wu,Ao,Il=it({},nc,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:rc,button:0,buttons:0,relatedTarget:function(f){return f.relatedTarget===void 0?f.fromElement===f.srcElement?f.toElement:f.fromElement:f.relatedTarget},movementX:function(f){return"movementX"in f?f.movementX:(f!==Ao&&(Ao&&f.type==="mousemove"?(gp=f.screenX-Ao.screenX,wu=f.screenY-Ao.screenY):wu=gp=0,Ao=f),gp)},movementY:function(f){return"movementY"in f?f.movementY:wu}}),_p=Ui(Il),sg=it({},Il,{dataTransfer:0}),pE=Ui(sg),Ep=it({},nc,{relatedTarget:0}),yp=Ui(Ep),Ru=it({},Yc,{animationName:0,elapsedTime:0,pseudoElement:0}),Cu=Ui(Ru),Iu=it({},Yc,{clipboardData:function(f){return"clipboardData"in f?f.clipboardData:window.clipboardData}}),og=Ui(Iu),mE=it({},Yc,{data:0}),Dn=Ui(mE),vp={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Oo={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},gE={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function _E(f){var g=this.nativeEvent;return g.getModifierState?g.getModifierState(f):(f=gE[f])?!!g[f]:!1}function rc(){return _E}var C=it({},nc,{key:function(f){if(f.key){var g=vp[f.key]||f.key;if(g!=="Unidentified")return g}return f.type==="keypress"?(f=Co(f),f===13?"Enter":String.fromCharCode(f)):f.type==="keydown"||f.type==="keyup"?Oo[f.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:rc,charCode:function(f){return f.type==="keypress"?Co(f):0},keyCode:function(f){return f.type==="keydown"||f.type==="keyup"?f.keyCode:0},which:function(f){return f.type==="keypress"?Co(f):f.type==="keydown"||f.type==="keyup"?f.keyCode:0}}),j=Ui(C),X=it({},Il,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),he=Ui(X),je=it({},nc,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:rc}),Je=Ui(je),It=it({},Yc,{propertyName:0,elapsedTime:0,pseudoElement:0}),Br=Ui(It),ti=it({},Il,{deltaX:function(f){return"deltaX"in f?f.deltaX:"wheelDeltaX"in f?-f.wheelDeltaX:0},deltaY:function(f){return"deltaY"in f?f.deltaY:"wheelDeltaY"in f?-f.wheelDeltaY:"wheelDelta"in f?-f.wheelDelta:0},deltaZ:0,deltaMode:0}),pr=Ui(ti),Os=[9,13,27,32],ns=E&&"CompositionEvent"in window,Na=null;E&&"documentMode"in document&&(Na=document.documentMode);var Po=E&&"TextEvent"in window&&!Na,qh=E&&(!ns||Na&&8<Na&&11>=Na),Sp=" ",ka=!1;function xR(f,g){switch(f){case"keyup":return Os.indexOf(g.keyCode)!==-1;case"keydown":return g.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function MR(f){return f=f.detail,typeof f=="object"&&"data"in f?f.data:null}var Tp=!1;function Ck(f,g){switch(f){case"compositionend":return MR(g);case"keypress":return g.which!==32?null:(ka=!0,Sp);case"textInput":return f=g.data,f===Sp&&ka?null:f;default:return null}}function UR(f,g){if(Tp)return f==="compositionend"||!ns&&xR(f,g)?(f=_s(),di=Or=nn=null,Tp=!1,f):null;switch(f){case"paste":return null;case"keypress":if(!(g.ctrlKey||g.altKey||g.metaKey)||g.ctrlKey&&g.altKey){if(g.char&&1<g.char.length)return g.char;if(g.which)return String.fromCharCode(g.which)}return null;case"compositionend":return qh&&g.locale!=="ko"?null:g.data;default:return null}}var Ik={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function VR(f){var g=f&&f.nodeName&&f.nodeName.toLowerCase();return g==="input"?!!Ik[f.type]:g==="textarea"}function sT(f,g,T,A){Xa(A),g=bE(g,"onChange"),0<g.length&&(T=new Sd("onChange","change",null,T,A),f.push({event:T,listeners:g}))}var $h=null,ag=null;function Ak(f){hT(f,0)}function Yh(f){var g=tf(f);if(hn(g))return f}function Ok(f,g){if(f==="change")return g}var FR=!1;if(E){var oT;if(E){var ic="oninput"in document;if(!ic){var jR=document.createElement("div");jR.setAttribute("oninput","return;"),ic=typeof jR.oninput=="function"}oT=ic}else oT=!1;FR=oT&&(!document.documentMode||9<document.documentMode)}function BR(){$h&&($h.detachEvent("onpropertychange",na),ag=$h=null)}function na(f){if(f.propertyName==="value"&&Yh(ag)){var g=[];sT(g,ag,f,eo(f)),Eo(Ak,g)}}function Pk(f,g,T){f==="focusin"?(BR(),$h=g,ag=T,$h.attachEvent("onpropertychange",na)):f==="focusout"&&BR()}function Nk(f){if(f==="selectionchange"||f==="keyup"||f==="keydown")return Yh(ag)}function kk(f,g){if(f==="click")return Yh(g)}function Dk(f,g){if(f==="input"||f==="change")return Yh(g)}function WR(f,g){return f===g&&(f!==0||1/f===1/g)||f!==f&&g!==g}var Xc=typeof Object.is=="function"?Object.is:WR;function cg(f,g){if(Xc(f,g))return!0;if(typeof f!="object"||f===null||typeof g!="object"||g===null)return!1;var T=Object.keys(f),A=Object.keys(g);if(T.length!==A.length)return!1;for(A=0;A<T.length;A++){var x=T[A];if(!v.call(g,x)||!Xc(f[x],g[x]))return!1}return!0}function GR(f){for(;f&&f.firstChild;)f=f.firstChild;return f}function aT(f,g){var T=GR(f);f=0;for(var A;T;){if(T.nodeType===3){if(A=f+T.textContent.length,f<=g&&A>=g)return{node:T,offset:g-f};f=A}e:{for(;T;){if(T.nextSibling){T=T.nextSibling;break e}T=T.parentNode}T=void 0}T=GR(T)}}function zR(f,g){return f&&g?f===g?!0:f&&f.nodeType===3?!1:g&&g.nodeType===3?zR(f,g.parentNode):"contains"in f?f.contains(g):f.compareDocumentPosition?!!(f.compareDocumentPosition(g)&16):!1:!1}function HR(){for(var f=window,g=Kn();g instanceof f.HTMLIFrameElement;){try{var T=typeof g.contentWindow.location.href=="string"}catch{T=!1}if(T)f=g.contentWindow;else break;g=Kn(f.document)}return g}function lg(f){var g=f&&f.nodeName&&f.nodeName.toLowerCase();return g&&(g==="input"&&(f.type==="text"||f.type==="search"||f.type==="tel"||f.type==="url"||f.type==="password")||g==="textarea"||f.contentEditable==="true")}function cT(f){var g=HR(),T=f.focusedElem,A=f.selectionRange;if(g!==T&&T&&T.ownerDocument&&zR(T.ownerDocument.documentElement,T)){if(A!==null&&lg(T)){if(g=A.start,f=A.end,f===void 0&&(f=g),"selectionStart"in T)T.selectionStart=g,T.selectionEnd=Math.min(f,T.value.length);else if(f=(g=T.ownerDocument||document)&&g.defaultView||window,f.getSelection){f=f.getSelection();var x=T.textContent.length,W=Math.min(A.start,x);A=A.end===void 0?W:Math.min(A.end,x),!f.extend&&W>A&&(x=A,A=W,W=x),x=aT(T,W);var ie=aT(T,A);x&&ie&&(f.rangeCount!==1||f.anchorNode!==x.node||f.anchorOffset!==x.offset||f.focusNode!==ie.node||f.focusOffset!==ie.offset)&&(g=g.createRange(),g.setStart(x.node,x.offset),f.removeAllRanges(),W>A?(f.addRange(g),f.extend(ie.node,ie.offset)):(g.setEnd(ie.node,ie.offset),f.addRange(g)))}}for(g=[],f=T;f=f.parentNode;)f.nodeType===1&&g.push({element:f,left:f.scrollLeft,top:f.scrollTop});for(typeof T.focus=="function"&&T.focus(),T=0;T<g.length;T++)f=g[T],f.element.scrollLeft=f.left,f.element.scrollTop=f.top}}var Lk=E&&"documentMode"in document&&11>=document.documentMode,Xe=null,lT=null,ug=null,uT=!1;function KR(f,g,T){var A=T.window===T?T.document:T.nodeType===9?T:T.ownerDocument;uT||Xe==null||Xe!==Kn(A)||(A=Xe,"selectionStart"in A&&lg(A)?A={start:A.selectionStart,end:A.selectionEnd}:(A=(A.ownerDocument&&A.ownerDocument.defaultView||window).getSelection(),A={anchorNode:A.anchorNode,anchorOffset:A.anchorOffset,focusNode:A.focusNode,focusOffset:A.focusOffset}),ug&&cg(ug,A)||(ug=A,A=bE(lT,"onSelect"),0<A.length&&(g=new Sd("onSelect","select",null,g,T),f.push({event:g,listeners:A}),g.target=Xe)))}function EE(f,g){var T={};return T[f.toLowerCase()]=g.toLowerCase(),T["Webkit"+f]="webkit"+g,T["Moz"+f]="moz"+g,T}var bp={animationend:EE("Animation","AnimationEnd"),animationiteration:EE("Animation","AnimationIteration"),animationstart:EE("Animation","AnimationStart"),transitionend:EE("Transition","TransitionEnd")},dT={},qR={};E&&(qR=document.createElement("div").style,"AnimationEvent"in window||(delete bp.animationend.animation,delete bp.animationiteration.animation,delete bp.animationstart.animation),"TransitionEvent"in window||delete bp.transitionend.transition);function Xh(f){if(dT[f])return dT[f];if(!bp[f])return f;var g=bp[f],T;for(T in g)if(g.hasOwnProperty(T)&&T in qR)return dT[f]=g[T];return f}var Jh=Xh("animationend"),$R=Xh("animationiteration"),YR=Xh("animationstart"),XR=Xh("transitionend"),JR=new Map,yE="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Td(f,g){JR.set(f,g),d(g,[f])}for(var vE=0;vE<yE.length;vE++){var Da=yE[vE],xk=Da.toLowerCase(),dg=Da[0].toUpperCase()+Da.slice(1);Td(xk,"on"+dg)}Td(Jh,"onAnimationEnd"),Td($R,"onAnimationIteration"),Td(YR,"onAnimationStart"),Td("dblclick","onDoubleClick"),Td("focusin","onFocus"),Td("focusout","onBlur"),Td(XR,"onTransitionEnd"),p("onMouseEnter",["mouseout","mouseover"]),p("onMouseLeave",["mouseout","mouseover"]),p("onPointerEnter",["pointerout","pointerover"]),p("onPointerLeave",["pointerout","pointerover"]),d("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),d("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),d("onBeforeInput",["compositionend","keypress","textInput","paste"]),d("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),d("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),d("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var hg="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Mk=new Set("cancel close invalid load scroll toggle".split(" ").concat(hg));function QR(f,g,T){var A=f.type||"unknown-event";f.currentTarget=T,Bh(A,g,void 0,f),f.currentTarget=null}function hT(f,g){g=(g&4)!==0;for(var T=0;T<f.length;T++){var A=f[T],x=A.event;A=A.listeners;e:{var W=void 0;if(g)for(var ie=A.length-1;0<=ie;ie--){var Se=A[ie],Ie=Se.instance,$e=Se.currentTarget;if(Se=Se.listener,Ie!==W&&x.isPropagationStopped())break e;QR(x,Se,$e),W=Ie}else for(ie=0;ie<A.length;ie++){if(Se=A[ie],Ie=Se.instance,$e=Se.currentTarget,Se=Se.listener,Ie!==W&&x.isPropagationStopped())break e;QR(x,Se,$e),W=Ie}}}if(Jo)throw f=hd,Jo=!1,hd=null,f}function _i(f,g){var T=g[gg];T===void 0&&(T=g[gg]=new Set);var A=f+"__bubble";T.has(A)||(ZR(g,f,2,!1),T.add(A))}function fT(f,g,T){var A=0;g&&(A|=4),ZR(T,f,A,g)}var SE="_reactListening"+Math.random().toString(36).slice(2);function Qh(f){if(!f[SE]){f[SE]=!0,a.forEach(function(T){T!=="selectionchange"&&(Mk.has(T)||fT(T,!1,f),fT(T,!0,f))});var g=f.nodeType===9?f:f.ownerDocument;g===null||g[SE]||(g[SE]=!0,fT("selectionchange",!1,g))}}function ZR(f,g,T,A){switch(Ur(g)){case 1:var x=Re;break;case 4:x=Ke;break;default:x=Bt}T=x.bind(null,g,T,f),x=void 0,!es||g!=="touchstart"&&g!=="touchmove"&&g!=="wheel"||(x=!0),A?x!==void 0?f.addEventListener(g,T,{capture:!0,passive:x}):f.addEventListener(g,T,!0):x!==void 0?f.addEventListener(g,T,{passive:x}):f.addEventListener(g,T,!1)}function TE(f,g,T,A,x){var W=A;if((g&1)===0&&(g&2)===0&&A!==null)e:for(;;){if(A===null)return;var ie=A.tag;if(ie===3||ie===4){var Se=A.stateNode.containerInfo;if(Se===x||Se.nodeType===8&&Se.parentNode===x)break;if(ie===4)for(ie=A.return;ie!==null;){var Ie=ie.tag;if((Ie===3||Ie===4)&&(Ie=ie.stateNode.containerInfo,Ie===x||Ie.nodeType===8&&Ie.parentNode===x))return;ie=ie.return}for(;Se!==null;){if(ie=ef(Se),ie===null)return;if(Ie=ie.tag,Ie===5||Ie===6){A=W=ie;continue e}Se=Se.parentNode}}A=A.return}Eo(function(){var $e=W,St=eo(T),Tt=[];e:{var vt=JR.get(f);if(vt!==void 0){var Ft=Sd,Yt=f;switch(f){case"keypress":if(Co(T)===0)break e;case"keydown":case"keyup":Ft=j;break;case"focusin":Yt="focus",Ft=yp;break;case"focusout":Yt="blur",Ft=yp;break;case"beforeblur":case"afterblur":Ft=yp;break;case"click":if(T.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Ft=_p;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Ft=pE;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Ft=Je;break;case Jh:case $R:case YR:Ft=Cu;break;case XR:Ft=Br;break;case"scroll":Ft=ig;break;case"wheel":Ft=pr;break;case"copy":case"cut":case"paste":Ft=og;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Ft=he}var Xt=(g&4)!==0,Fi=!Xt&&f==="scroll",Ge=Xt?vt!==null?vt+"Capture":null:vt;Xt=[];for(var Pe=$e,He;Pe!==null;){He=Pe;var wt=He.stateNode;if(He.tag===5&&wt!==null&&(He=wt,Ge!==null&&(wt=Ri(Pe,Ge),wt!=null&&Xt.push(wp(Pe,wt,He)))),Fi)break;Pe=Pe.return}0<Xt.length&&(vt=new Ft(vt,Yt,null,T,St),Tt.push({event:vt,listeners:Xt}))}}if((g&7)===0){e:{if(vt=f==="mouseover"||f==="pointerover",Ft=f==="mouseout"||f==="pointerout",vt&&T!==Zs&&(Yt=T.relatedTarget||T.fromElement)&&(ef(Yt)||Yt[sc]))break e;if((Ft||vt)&&(vt=St.window===St?St:(vt=St.ownerDocument)?vt.defaultView||vt.parentWindow:window,Ft?(Yt=T.relatedTarget||T.toElement,Ft=$e,Yt=Yt?ef(Yt):null,Yt!==null&&(Fi=As(Yt),Yt!==Fi||Yt.tag!==5&&Yt.tag!==6)&&(Yt=null)):(Ft=null,Yt=$e),Ft!==Yt)){if(Xt=_p,wt="onMouseLeave",Ge="onMouseEnter",Pe="mouse",(f==="pointerout"||f==="pointerover")&&(Xt=he,wt="onPointerLeave",Ge="onPointerEnter",Pe="pointer"),Fi=Ft==null?vt:tf(Ft),He=Yt==null?vt:tf(Yt),vt=new Xt(wt,Pe+"leave",Ft,T,St),vt.target=Fi,vt.relatedTarget=He,wt=null,ef(St)===$e&&(Xt=new Xt(Ge,Pe+"enter",Yt,T,St),Xt.target=He,Xt.relatedTarget=Fi,wt=Xt),Fi=wt,Ft&&Yt)t:{for(Xt=Ft,Ge=Yt,Pe=0,He=Xt;He;He=Zh(He))Pe++;for(He=0,wt=Ge;wt;wt=Zh(wt))He++;for(;0<Pe-He;)Xt=Zh(Xt),Pe--;for(;0<He-Pe;)Ge=Zh(Ge),He--;for(;Pe--;){if(Xt===Ge||Ge!==null&&Xt===Ge.alternate)break t;Xt=Zh(Xt),Ge=Zh(Ge)}Xt=null}else Xt=null;Ft!==null&&fg(Tt,vt,Ft,Xt,!1),Yt!==null&&Fi!==null&&fg(Tt,Fi,Yt,Xt,!0)}}e:{if(vt=$e?tf($e):window,Ft=vt.nodeName&&vt.nodeName.toLowerCase(),Ft==="select"||Ft==="input"&&vt.type==="file")var Jt=Ok;else if(VR(vt))if(FR)Jt=Dk;else{Jt=Nk;var on=Pk}else(Ft=vt.nodeName)&&Ft.toLowerCase()==="input"&&(vt.type==="checkbox"||vt.type==="radio")&&(Jt=kk);if(Jt&&(Jt=Jt(f,$e))){sT(Tt,Jt,T,St);break e}on&&on(f,vt,$e),f==="focusout"&&(on=vt._wrapperState)&&on.controlled&&vt.type==="number"&&Ne(vt,"number",vt.value)}switch(on=$e?tf($e):window,f){case"focusin":(VR(on)||on.contentEditable==="true")&&(Xe=on,lT=$e,ug=null);break;case"focusout":ug=lT=Xe=null;break;case"mousedown":uT=!0;break;case"contextmenu":case"mouseup":case"dragend":uT=!1,KR(Tt,T,St);break;case"selectionchange":if(Lk)break;case"keydown":case"keyup":KR(Tt,T,St)}var fn;if(ns)e:{switch(f){case"compositionstart":var An="onCompositionStart";break e;case"compositionend":An="onCompositionEnd";break e;case"compositionupdate":An="onCompositionUpdate";break e}An=void 0}else Tp?xR(f,T)&&(An="onCompositionEnd"):f==="keydown"&&T.keyCode===229&&(An="onCompositionStart");An&&(qh&&T.locale!=="ko"&&(Tp||An!=="onCompositionStart"?An==="onCompositionEnd"&&Tp&&(fn=_s()):(nn=St,Or="value"in nn?nn.value:nn.textContent,Tp=!0)),on=bE($e,An),0<on.length&&(An=new Dn(An,f,null,T,St),Tt.push({event:An,listeners:on}),fn?An.data=fn:(fn=MR(T),fn!==null&&(An.data=fn)))),(fn=Po?Ck(f,T):UR(f,T))&&($e=bE($e,"onBeforeInput"),0<$e.length&&(St=new Dn("onBeforeInput","beforeinput",null,T,St),Tt.push({event:St,listeners:$e}),St.data=fn))}hT(Tt,g)})}function wp(f,g,T){return{instance:f,listener:g,currentTarget:T}}function bE(f,g){for(var T=g+"Capture",A=[];f!==null;){var x=f,W=x.stateNode;x.tag===5&&W!==null&&(x=W,W=Ri(f,T),W!=null&&A.unshift(wp(f,W,x)),W=Ri(f,g),W!=null&&A.push(wp(f,W,x))),f=f.return}return A}function Zh(f){if(f===null)return null;do f=f.return;while(f&&f.tag!==5);return f||null}function fg(f,g,T,A,x){for(var W=g._reactName,ie=[];T!==null&&T!==A;){var Se=T,Ie=Se.alternate,$e=Se.stateNode;if(Ie!==null&&Ie===A)break;Se.tag===5&&$e!==null&&(Se=$e,x?(Ie=Ri(T,W),Ie!=null&&ie.unshift(wp(T,Ie,Se))):x||(Ie=Ri(T,W),Ie!=null&&ie.push(wp(T,Ie,Se)))),T=T.return}ie.length!==0&&f.push({event:g,listeners:ie})}var Uk=/\r\n?/g,Vk=/\u0000|\uFFFD/g;function eC(f){return(typeof f=="string"?f:""+f).replace(Uk,`
`).replace(Vk,"")}function wE(f,g,T){if(g=eC(g),eC(f)!==g&&T)throw Error(s(425))}function RE(){}var CE=null,pg=null;function pT(f,g){return f==="textarea"||f==="noscript"||typeof g.children=="string"||typeof g.children=="number"||typeof g.dangerouslySetInnerHTML=="object"&&g.dangerouslySetInnerHTML!==null&&g.dangerouslySetInnerHTML.__html!=null}var mg=typeof setTimeout=="function"?setTimeout:void 0,Fk=typeof clearTimeout=="function"?clearTimeout:void 0,tC=typeof Promise=="function"?Promise:void 0,jk=typeof queueMicrotask=="function"?queueMicrotask:typeof tC<"u"?function(f){return tC.resolve(null).then(f).catch(Bk)}:mg;function Bk(f){setTimeout(function(){throw f})}function mT(f,g){var T=g,A=0;do{var x=T.nextSibling;if(f.removeChild(T),x&&x.nodeType===8)if(T=x.data,T==="/$"){if(A===0){f.removeChild(x),ta(g);return}A--}else T!=="$"&&T!=="$?"&&T!=="$!"||A++;T=x}while(T);ta(g)}function bd(f){for(;f!=null;f=f.nextSibling){var g=f.nodeType;if(g===1||g===3)break;if(g===8){if(g=f.data,g==="$"||g==="$!"||g==="$?")break;if(g==="/$")return null}}return f}function nC(f){f=f.previousSibling;for(var g=0;f;){if(f.nodeType===8){var T=f.data;if(T==="$"||T==="$!"||T==="$?"){if(g===0)return f;g--}else T==="/$"&&g++}f=f.previousSibling}return null}var Rp=Math.random().toString(36).slice(2),Al="__reactFiber$"+Rp,wd="__reactProps$"+Rp,sc="__reactContainer$"+Rp,gg="__reactEvents$"+Rp,Wk="__reactListeners$"+Rp,Gk="__reactHandles$"+Rp;function ef(f){var g=f[Al];if(g)return g;for(var T=f.parentNode;T;){if(g=T[sc]||T[Al]){if(T=g.alternate,g.child!==null||T!==null&&T.child!==null)for(f=nC(f);f!==null;){if(T=f[Al])return T;f=nC(f)}return g}f=T,T=f.parentNode}return null}function Cp(f){return f=f[Al]||f[sc],!f||f.tag!==5&&f.tag!==6&&f.tag!==13&&f.tag!==3?null:f}function tf(f){if(f.tag===5||f.tag===6)return f.stateNode;throw Error(s(33))}function Ip(f){return f[wd]||null}var gT=[],Ap=-1;function oc(f){return{current:f}}function Ei(f){0>Ap||(f.current=gT[Ap],gT[Ap]=null,Ap--)}function hi(f,g){Ap++,gT[Ap]=f.current,f.current=g}var Rd={},no=oc(Rd),ra=oc(!1),nf=Rd;function rf(f,g){var T=f.type.contextTypes;if(!T)return Rd;var A=f.stateNode;if(A&&A.__reactInternalMemoizedUnmaskedChildContext===g)return A.__reactInternalMemoizedMaskedChildContext;var x={},W;for(W in T)x[W]=g[W];return A&&(f=f.stateNode,f.__reactInternalMemoizedUnmaskedChildContext=g,f.__reactInternalMemoizedMaskedChildContext=x),x}function ia(f){return f=f.childContextTypes,f!=null}function IE(){Ei(ra),Ei(no)}function rC(f,g,T){if(no.current!==Rd)throw Error(s(168));hi(no,g),hi(ra,T)}function AE(f,g,T){var A=f.stateNode;if(g=g.childContextTypes,typeof A.getChildContext!="function")return T;A=A.getChildContext();for(var x in A)if(!(x in g))throw Error(s(108,Nt(f)||"Unknown",x));return it({},T,A)}function OE(f){return f=(f=f.stateNode)&&f.__reactInternalMemoizedMergedChildContext||Rd,nf=no.current,hi(no,f),hi(ra,ra.current),!0}function iC(f,g,T){var A=f.stateNode;if(!A)throw Error(s(169));T?(f=AE(f,g,nf),A.__reactInternalMemoizedMergedChildContext=f,Ei(ra),Ei(no),hi(no,f)):Ei(ra),hi(ra,T)}var ac=null,PE=!1,_T=!1;function sC(f){ac===null?ac=[f]:ac.push(f)}function zk(f){PE=!0,sC(f)}function Cd(){if(!_T&&ac!==null){_T=!0;var f=0,g=er;try{var T=ac;for(er=1;f<T.length;f++){var A=T[f];do A=A(!0);while(A!==null)}ac=null,PE=!1}catch(x){throw ac!==null&&(ac=ac.slice(f+1)),md(Za,Cd),x}finally{er=g,_T=!1}}return null}var Op=[],Au=0,_g=null,NE=0,cc=[],La=0,sf=null,Ou=1,Pu="";function Nu(f,g){Op[Au++]=NE,Op[Au++]=_g,_g=f,NE=g}function kE(f,g,T){cc[La++]=Ou,cc[La++]=Pu,cc[La++]=sf,sf=f;var A=Ou;f=Pu;var x=32-Fs(A)-1;A&=~(1<<x),T+=1;var W=32-Fs(g)+x;if(30<W){var ie=x-x%5;W=(A&(1<<ie)-1).toString(32),A>>=ie,x-=ie,Ou=1<<32-Fs(g)+x|T<<x|A,Pu=W+f}else Ou=1<<W|T<<x|A,Pu=f}function DE(f){f.return!==null&&(Nu(f,1),kE(f,1,0))}function Eg(f){for(;f===_g;)_g=Op[--Au],Op[Au]=null,NE=Op[--Au],Op[Au]=null;for(;f===sf;)sf=cc[--La],cc[La]=null,Pu=cc[--La],cc[La]=null,Ou=cc[--La],cc[La]=null}var sa=null,oa=null,ni=!1,No=null;function oC(f,g){var T=Ua(5,null,null,0);T.elementType="DELETED",T.stateNode=g,T.return=f,g=f.deletions,g===null?(f.deletions=[T],f.flags|=16):g.push(T)}function aC(f,g){switch(f.tag){case 5:var T=f.type;return g=g.nodeType!==1||T.toLowerCase()!==g.nodeName.toLowerCase()?null:g,g!==null?(f.stateNode=g,sa=f,oa=bd(g.firstChild),!0):!1;case 6:return g=f.pendingProps===""||g.nodeType!==3?null:g,g!==null?(f.stateNode=g,sa=f,oa=null,!0):!1;case 13:return g=g.nodeType!==8?null:g,g!==null?(T=sf!==null?{id:Ou,overflow:Pu}:null,f.memoizedState={dehydrated:g,treeContext:T,retryLane:1073741824},T=Ua(18,null,null,0),T.stateNode=g,T.return=f,f.child=T,sa=f,oa=null,!0):!1;default:return!1}}function LE(f){return(f.mode&1)!==0&&(f.flags&128)===0}function ET(f){if(ni){var g=oa;if(g){var T=g;if(!aC(f,g)){if(LE(f))throw Error(s(418));g=bd(T.nextSibling);var A=sa;g&&aC(f,g)?oC(A,T):(f.flags=f.flags&-4097|2,ni=!1,sa=f)}}else{if(LE(f))throw Error(s(418));f.flags=f.flags&-4097|2,ni=!1,sa=f}}}function cC(f){for(f=f.return;f!==null&&f.tag!==5&&f.tag!==3&&f.tag!==13;)f=f.return;sa=f}function yg(f){if(f!==sa)return!1;if(!ni)return cC(f),ni=!0,!1;var g;if((g=f.tag!==3)&&!(g=f.tag!==5)&&(g=f.type,g=g!=="head"&&g!=="body"&&!pT(f.type,f.memoizedProps)),g&&(g=oa)){if(LE(f))throw lC(),Error(s(418));for(;g;)oC(f,g),g=bd(g.nextSibling)}if(cC(f),f.tag===13){if(f=f.memoizedState,f=f!==null?f.dehydrated:null,!f)throw Error(s(317));e:{for(f=f.nextSibling,g=0;f;){if(f.nodeType===8){var T=f.data;if(T==="/$"){if(g===0){oa=bd(f.nextSibling);break e}g--}else T!=="$"&&T!=="$!"&&T!=="$?"||g++}f=f.nextSibling}oa=null}}else oa=sa?bd(f.stateNode.nextSibling):null;return!0}function lC(){for(var f=oa;f;)f=bd(f.nextSibling)}function Pp(){oa=sa=null,ni=!1}function yT(f){No===null?No=[f]:No.push(f)}var Hk=de.ReactCurrentBatchConfig;function vg(f,g,T){if(f=T.ref,f!==null&&typeof f!="function"&&typeof f!="object"){if(T._owner){if(T=T._owner,T){if(T.tag!==1)throw Error(s(309));var A=T.stateNode}if(!A)throw Error(s(147,f));var x=A,W=""+f;return g!==null&&g.ref!==null&&typeof g.ref=="function"&&g.ref._stringRef===W?g.ref:(g=function(ie){var Se=x.refs;ie===null?delete Se[W]:Se[W]=ie},g._stringRef=W,g)}if(typeof f!="string")throw Error(s(284));if(!T._owner)throw Error(s(290,f))}return f}function xE(f,g){throw f=Object.prototype.toString.call(g),Error(s(31,f==="[object Object]"?"object with keys {"+Object.keys(g).join(", ")+"}":f))}function vT(f){var g=f._init;return g(f._payload)}function Id(f){function g(Ge,Pe){if(f){var He=Ge.deletions;He===null?(Ge.deletions=[Pe],Ge.flags|=16):He.push(Pe)}}function T(Ge,Pe){if(!f)return null;for(;Pe!==null;)g(Ge,Pe),Pe=Pe.sibling;return null}function A(Ge,Pe){for(Ge=new Map;Pe!==null;)Pe.key!==null?Ge.set(Pe.key,Pe):Ge.set(Pe.index,Pe),Pe=Pe.sibling;return Ge}function x(Ge,Pe){return Ge=Fu(Ge,Pe),Ge.index=0,Ge.sibling=null,Ge}function W(Ge,Pe,He){return Ge.index=He,f?(He=Ge.alternate,He!==null?(He=He.index,He<Pe?(Ge.flags|=2,Pe):He):(Ge.flags|=2,Pe)):(Ge.flags|=1048576,Pe)}function ie(Ge){return f&&Ge.alternate===null&&(Ge.flags|=2),Ge}function Se(Ge,Pe,He,wt){return Pe===null||Pe.tag!==6?(Pe=r0(He,Ge.mode,wt),Pe.return=Ge,Pe):(Pe=x(Pe,He),Pe.return=Ge,Pe)}function Ie(Ge,Pe,He,wt){var Jt=He.type;return Jt===Q?St(Ge,Pe,He.props.children,wt,He.key):Pe!==null&&(Pe.elementType===Jt||typeof Jt=="object"&&Jt!==null&&Jt.$$typeof===et&&vT(Jt)===Pe.type)?(wt=x(Pe,He.props),wt.ref=vg(Ge,Pe,He),wt.return=Ge,wt):(wt=Sy(He.type,He.key,He.props,null,Ge.mode,wt),wt.ref=vg(Ge,Pe,He),wt.return=Ge,wt)}function $e(Ge,Pe,He,wt){return Pe===null||Pe.tag!==4||Pe.stateNode.containerInfo!==He.containerInfo||Pe.stateNode.implementation!==He.implementation?(Pe=i0(He,Ge.mode,wt),Pe.return=Ge,Pe):(Pe=x(Pe,He.children||[]),Pe.return=Ge,Pe)}function St(Ge,Pe,He,wt,Jt){return Pe===null||Pe.tag!==7?(Pe=_f(He,Ge.mode,wt,Jt),Pe.return=Ge,Pe):(Pe=x(Pe,He),Pe.return=Ge,Pe)}function Tt(Ge,Pe,He){if(typeof Pe=="string"&&Pe!==""||typeof Pe=="number")return Pe=r0(""+Pe,Ge.mode,He),Pe.return=Ge,Pe;if(typeof Pe=="object"&&Pe!==null){switch(Pe.$$typeof){case se:return He=Sy(Pe.type,Pe.key,Pe.props,null,Ge.mode,He),He.ref=vg(Ge,null,Pe),He.return=Ge,He;case ye:return Pe=i0(Pe,Ge.mode,He),Pe.return=Ge,Pe;case et:var wt=Pe._init;return Tt(Ge,wt(Pe._payload),He)}if(We(Pe)||Me(Pe))return Pe=_f(Pe,Ge.mode,He,null),Pe.return=Ge,Pe;xE(Ge,Pe)}return null}function vt(Ge,Pe,He,wt){var Jt=Pe!==null?Pe.key:null;if(typeof He=="string"&&He!==""||typeof He=="number")return Jt!==null?null:Se(Ge,Pe,""+He,wt);if(typeof He=="object"&&He!==null){switch(He.$$typeof){case se:return He.key===Jt?Ie(Ge,Pe,He,wt):null;case ye:return He.key===Jt?$e(Ge,Pe,He,wt):null;case et:return Jt=He._init,vt(Ge,Pe,Jt(He._payload),wt)}if(We(He)||Me(He))return Jt!==null?null:St(Ge,Pe,He,wt,null);xE(Ge,He)}return null}function Ft(Ge,Pe,He,wt,Jt){if(typeof wt=="string"&&wt!==""||typeof wt=="number")return Ge=Ge.get(He)||null,Se(Pe,Ge,""+wt,Jt);if(typeof wt=="object"&&wt!==null){switch(wt.$$typeof){case se:return Ge=Ge.get(wt.key===null?He:wt.key)||null,Ie(Pe,Ge,wt,Jt);case ye:return Ge=Ge.get(wt.key===null?He:wt.key)||null,$e(Pe,Ge,wt,Jt);case et:var on=wt._init;return Ft(Ge,Pe,He,on(wt._payload),Jt)}if(We(wt)||Me(wt))return Ge=Ge.get(He)||null,St(Pe,Ge,wt,Jt,null);xE(Pe,wt)}return null}function Yt(Ge,Pe,He,wt){for(var Jt=null,on=null,fn=Pe,An=Pe=0,as=null;fn!==null&&An<He.length;An++){fn.index>An?(as=fn,fn=null):as=fn.sibling;var mr=vt(Ge,fn,He[An],wt);if(mr===null){fn===null&&(fn=as);break}f&&fn&&mr.alternate===null&&g(Ge,fn),Pe=W(mr,Pe,An),on===null?Jt=mr:on.sibling=mr,on=mr,fn=as}if(An===He.length)return T(Ge,fn),ni&&Nu(Ge,An),Jt;if(fn===null){for(;An<He.length;An++)fn=Tt(Ge,He[An],wt),fn!==null&&(Pe=W(fn,Pe,An),on===null?Jt=fn:on.sibling=fn,on=fn);return ni&&Nu(Ge,An),Jt}for(fn=A(Ge,fn);An<He.length;An++)as=Ft(fn,Ge,An,He[An],wt),as!==null&&(f&&as.alternate!==null&&fn.delete(as.key===null?An:as.key),Pe=W(as,Pe,An),on===null?Jt=as:on.sibling=as,on=as);return f&&fn.forEach(function(Vd){return g(Ge,Vd)}),ni&&Nu(Ge,An),Jt}function Xt(Ge,Pe,He,wt){var Jt=Me(He);if(typeof Jt!="function")throw Error(s(150));if(He=Jt.call(He),He==null)throw Error(s(151));for(var on=Jt=null,fn=Pe,An=Pe=0,as=null,mr=He.next();fn!==null&&!mr.done;An++,mr=He.next()){fn.index>An?(as=fn,fn=null):as=fn.sibling;var Vd=vt(Ge,fn,mr.value,wt);if(Vd===null){fn===null&&(fn=as);break}f&&fn&&Vd.alternate===null&&g(Ge,fn),Pe=W(Vd,Pe,An),on===null?Jt=Vd:on.sibling=Vd,on=Vd,fn=as}if(mr.done)return T(Ge,fn),ni&&Nu(Ge,An),Jt;if(fn===null){for(;!mr.done;An++,mr=He.next())mr=Tt(Ge,mr.value,wt),mr!==null&&(Pe=W(mr,Pe,An),on===null?Jt=mr:on.sibling=mr,on=mr);return ni&&Nu(Ge,An),Jt}for(fn=A(Ge,fn);!mr.done;An++,mr=He.next())mr=Ft(fn,Ge,An,mr.value,wt),mr!==null&&(f&&mr.alternate!==null&&fn.delete(mr.key===null?An:mr.key),Pe=W(mr,Pe,An),on===null?Jt=mr:on.sibling=mr,on=mr);return f&&fn.forEach(function(aD){return g(Ge,aD)}),ni&&Nu(Ge,An),Jt}function Fi(Ge,Pe,He,wt){if(typeof He=="object"&&He!==null&&He.type===Q&&He.key===null&&(He=He.props.children),typeof He=="object"&&He!==null){switch(He.$$typeof){case se:e:{for(var Jt=He.key,on=Pe;on!==null;){if(on.key===Jt){if(Jt=He.type,Jt===Q){if(on.tag===7){T(Ge,on.sibling),Pe=x(on,He.props.children),Pe.return=Ge,Ge=Pe;break e}}else if(on.elementType===Jt||typeof Jt=="object"&&Jt!==null&&Jt.$$typeof===et&&vT(Jt)===on.type){T(Ge,on.sibling),Pe=x(on,He.props),Pe.ref=vg(Ge,on,He),Pe.return=Ge,Ge=Pe;break e}T(Ge,on);break}else g(Ge,on);on=on.sibling}He.type===Q?(Pe=_f(He.props.children,Ge.mode,wt,He.key),Pe.return=Ge,Ge=Pe):(wt=Sy(He.type,He.key,He.props,null,Ge.mode,wt),wt.ref=vg(Ge,Pe,He),wt.return=Ge,Ge=wt)}return ie(Ge);case ye:e:{for(on=He.key;Pe!==null;){if(Pe.key===on)if(Pe.tag===4&&Pe.stateNode.containerInfo===He.containerInfo&&Pe.stateNode.implementation===He.implementation){T(Ge,Pe.sibling),Pe=x(Pe,He.children||[]),Pe.return=Ge,Ge=Pe;break e}else{T(Ge,Pe);break}else g(Ge,Pe);Pe=Pe.sibling}Pe=i0(He,Ge.mode,wt),Pe.return=Ge,Ge=Pe}return ie(Ge);case et:return on=He._init,Fi(Ge,Pe,on(He._payload),wt)}if(We(He))return Yt(Ge,Pe,He,wt);if(Me(He))return Xt(Ge,Pe,He,wt);xE(Ge,He)}return typeof He=="string"&&He!==""||typeof He=="number"?(He=""+He,Pe!==null&&Pe.tag===6?(T(Ge,Pe.sibling),Pe=x(Pe,He),Pe.return=Ge,Ge=Pe):(T(Ge,Pe),Pe=r0(He,Ge.mode,wt),Pe.return=Ge,Ge=Pe),ie(Ge)):T(Ge,Pe)}return Fi}var Np=Id(!0),uC=Id(!1),ME=oc(null),Sg=null,kp=null,UE=null;function ST(){UE=kp=Sg=null}function TT(f){var g=ME.current;Ei(ME),f._currentValue=g}function bT(f,g,T){for(;f!==null;){var A=f.alternate;if((f.childLanes&g)!==g?(f.childLanes|=g,A!==null&&(A.childLanes|=g)):A!==null&&(A.childLanes&g)!==g&&(A.childLanes|=g),f===T)break;f=f.return}}function ku(f,g){Sg=f,UE=kp=null,f=f.dependencies,f!==null&&f.firstContext!==null&&((f.lanes&g)!==0&&(ca=!0),f.firstContext=null)}function lc(f){var g=f._currentValue;if(UE!==f)if(f={context:f,memoizedValue:g,next:null},kp===null){if(Sg===null)throw Error(s(308));kp=f,Sg.dependencies={lanes:0,firstContext:f}}else kp=kp.next=f;return g}var of=null;function wT(f){of===null?of=[f]:of.push(f)}function dC(f,g,T,A){var x=g.interleaved;return x===null?(T.next=T,wT(g)):(T.next=x.next,x.next=T),g.interleaved=T,Du(f,A)}function Du(f,g){f.lanes|=g;var T=f.alternate;for(T!==null&&(T.lanes|=g),T=f,f=f.return;f!==null;)f.childLanes|=g,T=f.alternate,T!==null&&(T.childLanes|=g),T=f,f=f.return;return T.tag===3?T.stateNode:null}var Ad=!1;function Tg(f){f.updateQueue={baseState:f.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function hC(f,g){f=f.updateQueue,g.updateQueue===f&&(g.updateQueue={baseState:f.baseState,firstBaseUpdate:f.firstBaseUpdate,lastBaseUpdate:f.lastBaseUpdate,shared:f.shared,effects:f.effects})}function Ol(f,g){return{eventTime:f,lane:g,tag:0,payload:null,callback:null,next:null}}function Od(f,g,T){var A=f.updateQueue;if(A===null)return null;if(A=A.shared,(yr&2)!==0){var x=A.pending;return x===null?g.next=g:(g.next=x.next,x.next=g),A.pending=g,Du(f,T)}return x=A.interleaved,x===null?(g.next=g,wT(A)):(g.next=x.next,x.next=g),A.interleaved=g,Du(f,T)}function bg(f,g,T){if(g=g.updateQueue,g!==null&&(g=g.shared,(T&4194240)!==0)){var A=g.lanes;A&=f.pendingLanes,T|=A,g.lanes=T,Pa(f,T)}}function fC(f,g){var T=f.updateQueue,A=f.alternate;if(A!==null&&(A=A.updateQueue,T===A)){var x=null,W=null;if(T=T.firstBaseUpdate,T!==null){do{var ie={eventTime:T.eventTime,lane:T.lane,tag:T.tag,payload:T.payload,callback:T.callback,next:null};W===null?x=W=ie:W=W.next=ie,T=T.next}while(T!==null);W===null?x=W=g:W=W.next=g}else x=W=g;T={baseState:A.baseState,firstBaseUpdate:x,lastBaseUpdate:W,shared:A.shared,effects:A.effects},f.updateQueue=T;return}f=T.lastBaseUpdate,f===null?T.firstBaseUpdate=g:f.next=g,T.lastBaseUpdate=g}function VE(f,g,T,A){var x=f.updateQueue;Ad=!1;var W=x.firstBaseUpdate,ie=x.lastBaseUpdate,Se=x.shared.pending;if(Se!==null){x.shared.pending=null;var Ie=Se,$e=Ie.next;Ie.next=null,ie===null?W=$e:ie.next=$e,ie=Ie;var St=f.alternate;St!==null&&(St=St.updateQueue,Se=St.lastBaseUpdate,Se!==ie&&(Se===null?St.firstBaseUpdate=$e:Se.next=$e,St.lastBaseUpdate=Ie))}if(W!==null){var Tt=x.baseState;ie=0,St=$e=Ie=null,Se=W;do{var vt=Se.lane,Ft=Se.eventTime;if((A&vt)===vt){St!==null&&(St=St.next={eventTime:Ft,lane:0,tag:Se.tag,payload:Se.payload,callback:Se.callback,next:null});e:{var Yt=f,Xt=Se;switch(vt=g,Ft=T,Xt.tag){case 1:if(Yt=Xt.payload,typeof Yt=="function"){Tt=Yt.call(Ft,Tt,vt);break e}Tt=Yt;break e;case 3:Yt.flags=Yt.flags&-65537|128;case 0:if(Yt=Xt.payload,vt=typeof Yt=="function"?Yt.call(Ft,Tt,vt):Yt,vt==null)break e;Tt=it({},Tt,vt);break e;case 2:Ad=!0}}Se.callback!==null&&Se.lane!==0&&(f.flags|=64,vt=x.effects,vt===null?x.effects=[Se]:vt.push(Se))}else Ft={eventTime:Ft,lane:vt,tag:Se.tag,payload:Se.payload,callback:Se.callback,next:null},St===null?($e=St=Ft,Ie=Tt):St=St.next=Ft,ie|=vt;if(Se=Se.next,Se===null){if(Se=x.shared.pending,Se===null)break;vt=Se,Se=vt.next,vt.next=null,x.lastBaseUpdate=vt,x.shared.pending=null}}while(!0);if(St===null&&(Ie=Tt),x.baseState=Ie,x.firstBaseUpdate=$e,x.lastBaseUpdate=St,g=x.shared.interleaved,g!==null){x=g;do ie|=x.lane,x=x.next;while(x!==g)}else W===null&&(x.shared.lanes=0);hf|=ie,f.lanes=ie,f.memoizedState=Tt}}function pC(f,g,T){if(f=g.effects,g.effects=null,f!==null)for(g=0;g<f.length;g++){var A=f[g],x=A.callback;if(x!==null){if(A.callback=null,A=T,typeof x!="function")throw Error(s(191,x));x.call(A)}}}var wg={},Pl=oc(wg),Rg=oc(wg),Dp=oc(wg);function af(f){if(f===wg)throw Error(s(174));return f}function RT(f,g){switch(hi(Dp,g),hi(Rg,f),hi(Pl,wg),f=g.nodeType,f){case 9:case 11:g=(g=g.documentElement)?g.namespaceURI:rn(null,"");break;default:f=f===8?g.parentNode:g,g=f.namespaceURI||null,f=f.tagName,g=rn(g,f)}Ei(Pl),hi(Pl,g)}function cf(){Ei(Pl),Ei(Rg),Ei(Dp)}function mC(f){af(Dp.current);var g=af(Pl.current),T=rn(g,f.type);g!==T&&(hi(Rg,f),hi(Pl,T))}function Lp(f){Rg.current===f&&(Ei(Pl),Ei(Rg))}var Si=oc(0);function Pd(f){for(var g=f;g!==null;){if(g.tag===13){var T=g.memoizedState;if(T!==null&&(T=T.dehydrated,T===null||T.data==="$?"||T.data==="$!"))return g}else if(g.tag===19&&g.memoizedProps.revealOrder!==void 0){if((g.flags&128)!==0)return g}else if(g.child!==null){g.child.return=g,g=g.child;continue}if(g===f)break;for(;g.sibling===null;){if(g.return===null||g.return===f)return null;g=g.return}g.sibling.return=g.return,g=g.sibling}return null}var CT=[];function IT(){for(var f=0;f<CT.length;f++)CT[f]._workInProgressVersionPrimary=null;CT.length=0}var FE=de.ReactCurrentDispatcher,AT=de.ReactCurrentBatchConfig,Nl=0,Ci=null,rs=null,is=null,xp=!1,Cg=!1,Ig=0,Kk=0;function ro(){throw Error(s(321))}function OT(f,g){if(g===null)return!1;for(var T=0;T<g.length&&T<f.length;T++)if(!Xc(f[T],g[T]))return!1;return!0}function Mp(f,g,T,A,x,W){if(Nl=W,Ci=g,g.memoizedState=null,g.updateQueue=null,g.lanes=0,FE.current=f===null||f.memoizedState===null?Yk:CC,f=T(A,x),Cg){W=0;do{if(Cg=!1,Ig=0,25<=W)throw Error(s(301));W+=1,is=rs=null,g.updateQueue=null,FE.current=Xk,f=T(A,x)}while(Cg)}if(FE.current=GE,g=rs!==null&&rs.next!==null,Nl=0,is=rs=Ci=null,xp=!1,g)throw Error(s(300));return f}function PT(){var f=Ig!==0;return Ig=0,f}function ko(){var f={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return is===null?Ci.memoizedState=is=f:is=is.next=f,is}function aa(){if(rs===null){var f=Ci.alternate;f=f!==null?f.memoizedState:null}else f=rs.next;var g=is===null?Ci.memoizedState:is.next;if(g!==null)is=g,rs=f;else{if(f===null)throw Error(s(310));rs=f,f={memoizedState:rs.memoizedState,baseState:rs.baseState,baseQueue:rs.baseQueue,queue:rs.queue,next:null},is===null?Ci.memoizedState=is=f:is=is.next=f}return is}function Nd(f,g){return typeof g=="function"?g(f):g}function lf(f){var g=aa(),T=g.queue;if(T===null)throw Error(s(311));T.lastRenderedReducer=f;var A=rs,x=A.baseQueue,W=T.pending;if(W!==null){if(x!==null){var ie=x.next;x.next=W.next,W.next=ie}A.baseQueue=x=W,T.pending=null}if(x!==null){W=x.next,A=A.baseState;var Se=ie=null,Ie=null,$e=W;do{var St=$e.lane;if((Nl&St)===St)Ie!==null&&(Ie=Ie.next={lane:0,action:$e.action,hasEagerState:$e.hasEagerState,eagerState:$e.eagerState,next:null}),A=$e.hasEagerState?$e.eagerState:f(A,$e.action);else{var Tt={lane:St,action:$e.action,hasEagerState:$e.hasEagerState,eagerState:$e.eagerState,next:null};Ie===null?(Se=Ie=Tt,ie=A):Ie=Ie.next=Tt,Ci.lanes|=St,hf|=St}$e=$e.next}while($e!==null&&$e!==W);Ie===null?ie=A:Ie.next=Se,Xc(A,g.memoizedState)||(ca=!0),g.memoizedState=A,g.baseState=ie,g.baseQueue=Ie,T.lastRenderedState=A}if(f=T.interleaved,f!==null){x=f;do W=x.lane,Ci.lanes|=W,hf|=W,x=x.next;while(x!==f)}else x===null&&(T.lanes=0);return[g.memoizedState,T.dispatch]}function Up(f){var g=aa(),T=g.queue;if(T===null)throw Error(s(311));T.lastRenderedReducer=f;var A=T.dispatch,x=T.pending,W=g.memoizedState;if(x!==null){T.pending=null;var ie=x=x.next;do W=f(W,ie.action),ie=ie.next;while(ie!==x);Xc(W,g.memoizedState)||(ca=!0),g.memoizedState=W,g.baseQueue===null&&(g.baseState=W),T.lastRenderedState=W}return[W,A]}function gC(){}function NT(f,g){var T=Ci,A=aa(),x=g(),W=!Xc(A.memoizedState,x);if(W&&(A.memoizedState=x,ca=!0),A=A.queue,uc(EC.bind(null,T,A,f),[f]),A.getSnapshot!==g||W||is!==null&&is.memoizedState.tag&1){if(T.flags|=2048,Ag(9,kT.bind(null,T,A,x,g),void 0,null),Ps===null)throw Error(s(349));(Nl&30)!==0||_C(T,g,x)}return x}function _C(f,g,T){f.flags|=16384,f={getSnapshot:g,value:T},g=Ci.updateQueue,g===null?(g={lastEffect:null,stores:null},Ci.updateQueue=g,g.stores=[f]):(T=g.stores,T===null?g.stores=[f]:T.push(f))}function kT(f,g,T,A){g.value=T,g.getSnapshot=A,yC(g)&&jE(f)}function EC(f,g,T){return T(function(){yC(g)&&jE(f)})}function yC(f){var g=f.getSnapshot;f=f.value;try{var T=g();return!Xc(f,T)}catch{return!0}}function jE(f){var g=Du(f,1);g!==null&&pc(g,f,1,-1)}function BE(f){var g=ko();return typeof f=="function"&&(f=f()),g.memoizedState=g.baseState=f,f={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Nd,lastRenderedState:f},g.queue=f,f=f.dispatch=$k.bind(null,Ci,f),[g.memoizedState,f]}function Ag(f,g,T,A){return f={tag:f,create:g,destroy:T,deps:A,next:null},g=Ci.updateQueue,g===null?(g={lastEffect:null,stores:null},Ci.updateQueue=g,g.lastEffect=f.next=f):(T=g.lastEffect,T===null?g.lastEffect=f.next=f:(A=T.next,T.next=f,f.next=A,g.lastEffect=f)),f}function vC(){return aa().memoizedState}function Og(f,g,T,A){var x=ko();Ci.flags|=f,x.memoizedState=Ag(1|g,T,void 0,A===void 0?null:A)}function Vp(f,g,T,A){var x=aa();A=A===void 0?null:A;var W=void 0;if(rs!==null){var ie=rs.memoizedState;if(W=ie.destroy,A!==null&&OT(A,ie.deps)){x.memoizedState=Ag(g,T,W,A);return}}Ci.flags|=f,x.memoizedState=Ag(1|g,T,W,A)}function SC(f,g){return Og(8390656,8,f,g)}function uc(f,g){return Vp(2048,8,f,g)}function uf(f,g){return Vp(4,2,f,g)}function kd(f,g){return Vp(4,4,f,g)}function DT(f,g){if(typeof g=="function")return f=f(),g(f),function(){g(null)};if(g!=null)return f=f(),g.current=f,function(){g.current=null}}function LT(f,g,T){return T=T!=null?T.concat([f]):null,Vp(4,4,DT.bind(null,g,f),T)}function Lu(){}function WE(f,g){var T=aa();g=g===void 0?null:g;var A=T.memoizedState;return A!==null&&g!==null&&OT(g,A[1])?A[0]:(T.memoizedState=[f,g],f)}function TC(f,g){var T=aa();g=g===void 0?null:g;var A=T.memoizedState;return A!==null&&g!==null&&OT(g,A[1])?A[0]:(f=f(),T.memoizedState=[f,g],f)}function xT(f,g,T){return(Nl&21)===0?(f.baseState&&(f.baseState=!1,ca=!0),f.memoizedState=T):(Xc(T,g)||(T=Su(),Ci.lanes|=T,hf|=T,f.baseState=!0),g)}function qk(f,g){var T=er;er=T!==0&&4>T?T:4,f(!0);var A=AT.transition;AT.transition={};try{f(!1),g()}finally{er=T,AT.transition=A}}function MT(){return aa().memoizedState}function bC(f,g,T){var A=fc(f);if(T={lane:A,action:T,hasEagerState:!1,eagerState:null,next:null},xu(f))wC(g,T);else if(T=dC(f,g,T,A),T!==null){var x=Ws();pc(T,f,A,x),RC(T,g,A)}}function $k(f,g,T){var A=fc(f),x={lane:A,action:T,hasEagerState:!1,eagerState:null,next:null};if(xu(f))wC(g,x);else{var W=f.alternate;if(f.lanes===0&&(W===null||W.lanes===0)&&(W=g.lastRenderedReducer,W!==null))try{var ie=g.lastRenderedState,Se=W(ie,T);if(x.hasEagerState=!0,x.eagerState=Se,Xc(Se,ie)){var Ie=g.interleaved;Ie===null?(x.next=x,wT(g)):(x.next=Ie.next,Ie.next=x),g.interleaved=x;return}}catch{}finally{}T=dC(f,g,x,A),T!==null&&(x=Ws(),pc(T,f,A,x),RC(T,g,A))}}function xu(f){var g=f.alternate;return f===Ci||g!==null&&g===Ci}function wC(f,g){Cg=xp=!0;var T=f.pending;T===null?g.next=g:(g.next=T.next,T.next=g),f.pending=g}function RC(f,g,T){if((T&4194240)!==0){var A=g.lanes;A&=f.pendingLanes,T|=A,g.lanes=T,Pa(f,T)}}var GE={readContext:lc,useCallback:ro,useContext:ro,useEffect:ro,useImperativeHandle:ro,useInsertionEffect:ro,useLayoutEffect:ro,useMemo:ro,useReducer:ro,useRef:ro,useState:ro,useDebugValue:ro,useDeferredValue:ro,useTransition:ro,useMutableSource:ro,useSyncExternalStore:ro,useId:ro,unstable_isNewReconciler:!1},Yk={readContext:lc,useCallback:function(f,g){return ko().memoizedState=[f,g===void 0?null:g],f},useContext:lc,useEffect:SC,useImperativeHandle:function(f,g,T){return T=T!=null?T.concat([f]):null,Og(4194308,4,DT.bind(null,g,f),T)},useLayoutEffect:function(f,g){return Og(4194308,4,f,g)},useInsertionEffect:function(f,g){return Og(4,2,f,g)},useMemo:function(f,g){var T=ko();return g=g===void 0?null:g,f=f(),T.memoizedState=[f,g],f},useReducer:function(f,g,T){var A=ko();return g=T!==void 0?T(g):g,A.memoizedState=A.baseState=g,f={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:f,lastRenderedState:g},A.queue=f,f=f.dispatch=bC.bind(null,Ci,f),[A.memoizedState,f]},useRef:function(f){var g=ko();return f={current:f},g.memoizedState=f},useState:BE,useDebugValue:Lu,useDeferredValue:function(f){return ko().memoizedState=f},useTransition:function(){var f=BE(!1),g=f[0];return f=qk.bind(null,f[1]),ko().memoizedState=f,[g,f]},useMutableSource:function(){},useSyncExternalStore:function(f,g,T){var A=Ci,x=ko();if(ni){if(T===void 0)throw Error(s(407));T=T()}else{if(T=g(),Ps===null)throw Error(s(349));(Nl&30)!==0||_C(A,g,T)}x.memoizedState=T;var W={value:T,getSnapshot:g};return x.queue=W,SC(EC.bind(null,A,W,f),[f]),A.flags|=2048,Ag(9,kT.bind(null,A,W,T,g),void 0,null),T},useId:function(){var f=ko(),g=Ps.identifierPrefix;if(ni){var T=Pu,A=Ou;T=(A&~(1<<32-Fs(A)-1)).toString(32)+T,g=":"+g+"R"+T,T=Ig++,0<T&&(g+="H"+T.toString(32)),g+=":"}else T=Kk++,g=":"+g+"r"+T.toString(32)+":";return f.memoizedState=g},unstable_isNewReconciler:!1},CC={readContext:lc,useCallback:WE,useContext:lc,useEffect:uc,useImperativeHandle:LT,useInsertionEffect:uf,useLayoutEffect:kd,useMemo:TC,useReducer:lf,useRef:vC,useState:function(){return lf(Nd)},useDebugValue:Lu,useDeferredValue:function(f){var g=aa();return xT(g,rs.memoizedState,f)},useTransition:function(){var f=lf(Nd)[0],g=aa().memoizedState;return[f,g]},useMutableSource:gC,useSyncExternalStore:NT,useId:MT,unstable_isNewReconciler:!1},Xk={readContext:lc,useCallback:WE,useContext:lc,useEffect:uc,useImperativeHandle:LT,useInsertionEffect:uf,useLayoutEffect:kd,useMemo:TC,useReducer:Up,useRef:vC,useState:function(){return Up(Nd)},useDebugValue:Lu,useDeferredValue:function(f){var g=aa();return rs===null?g.memoizedState=f:xT(g,rs.memoizedState,f)},useTransition:function(){var f=Up(Nd)[0],g=aa().memoizedState;return[f,g]},useMutableSource:gC,useSyncExternalStore:NT,useId:MT,unstable_isNewReconciler:!1};function xa(f,g){if(f&&f.defaultProps){g=it({},g),f=f.defaultProps;for(var T in f)g[T]===void 0&&(g[T]=f[T]);return g}return g}function zE(f,g,T,A){g=f.memoizedState,T=T(A,g),T=T==null?g:it({},g,T),f.memoizedState=T,f.lanes===0&&(f.updateQueue.baseState=T)}var HE={isMounted:function(f){return(f=f._reactInternals)?As(f)===f:!1},enqueueSetState:function(f,g,T){f=f._reactInternals;var A=Ws(),x=fc(f),W=Ol(A,x);W.payload=g,T!=null&&(W.callback=T),g=Od(f,W,x),g!==null&&(pc(g,f,x,A),bg(g,f,x))},enqueueReplaceState:function(f,g,T){f=f._reactInternals;var A=Ws(),x=fc(f),W=Ol(A,x);W.tag=1,W.payload=g,T!=null&&(W.callback=T),g=Od(f,W,x),g!==null&&(pc(g,f,x,A),bg(g,f,x))},enqueueForceUpdate:function(f,g){f=f._reactInternals;var T=Ws(),A=fc(f),x=Ol(T,A);x.tag=2,g!=null&&(x.callback=g),g=Od(f,x,A),g!==null&&(pc(g,f,A,T),bg(g,f,A))}};function UT(f,g,T,A,x,W,ie){return f=f.stateNode,typeof f.shouldComponentUpdate=="function"?f.shouldComponentUpdate(A,W,ie):g.prototype&&g.prototype.isPureReactComponent?!cg(T,A)||!cg(x,W):!0}function IC(f,g,T){var A=!1,x=Rd,W=g.contextType;return typeof W=="object"&&W!==null?W=lc(W):(x=ia(g)?nf:no.current,A=g.contextTypes,W=(A=A!=null)?rf(f,x):Rd),g=new g(T,W),f.memoizedState=g.state!==null&&g.state!==void 0?g.state:null,g.updater=HE,f.stateNode=g,g._reactInternals=f,A&&(f=f.stateNode,f.__reactInternalMemoizedUnmaskedChildContext=x,f.__reactInternalMemoizedMaskedChildContext=W),g}function AC(f,g,T,A){f=g.state,typeof g.componentWillReceiveProps=="function"&&g.componentWillReceiveProps(T,A),typeof g.UNSAFE_componentWillReceiveProps=="function"&&g.UNSAFE_componentWillReceiveProps(T,A),g.state!==f&&HE.enqueueReplaceState(g,g.state,null)}function VT(f,g,T,A){var x=f.stateNode;x.props=T,x.state=f.memoizedState,x.refs={},Tg(f);var W=g.contextType;typeof W=="object"&&W!==null?x.context=lc(W):(W=ia(g)?nf:no.current,x.context=rf(f,W)),x.state=f.memoizedState,W=g.getDerivedStateFromProps,typeof W=="function"&&(zE(f,g,W,T),x.state=f.memoizedState),typeof g.getDerivedStateFromProps=="function"||typeof x.getSnapshotBeforeUpdate=="function"||typeof x.UNSAFE_componentWillMount!="function"&&typeof x.componentWillMount!="function"||(g=x.state,typeof x.componentWillMount=="function"&&x.componentWillMount(),typeof x.UNSAFE_componentWillMount=="function"&&x.UNSAFE_componentWillMount(),g!==x.state&&HE.enqueueReplaceState(x,x.state,null),VE(f,T,x,A),x.state=f.memoizedState),typeof x.componentDidMount=="function"&&(f.flags|=4194308)}function Fp(f,g){try{var T="",A=g;do T+=lt(A),A=A.return;while(A);var x=T}catch(W){x=`
Error generating stack: `+W.message+`
`+W.stack}return{value:f,source:g,stack:x,digest:null}}function FT(f,g,T){return{value:f,source:null,stack:T??null,digest:g??null}}function jT(f,g){try{console.error(g.value)}catch(T){setTimeout(function(){throw T})}}var Jk=typeof WeakMap=="function"?WeakMap:Map;function BT(f,g,T){T=Ol(-1,T),T.tag=3,T.payload={element:null};var A=g.value;return T.callback=function(){ly||(ly=!0,QT=A),jT(f,g)},T}function Mu(f,g,T){T=Ol(-1,T),T.tag=3;var A=f.type.getDerivedStateFromError;if(typeof A=="function"){var x=g.value;T.payload=function(){return A(x)},T.callback=function(){jT(f,g)}}var W=f.stateNode;return W!==null&&typeof W.componentDidCatch=="function"&&(T.callback=function(){jT(f,g),typeof A!="function"&&(Dd===null?Dd=new Set([this]):Dd.add(this));var ie=g.stack;this.componentDidCatch(g.value,{componentStack:ie!==null?ie:""})}),T}function OC(f,g,T){var A=f.pingCache;if(A===null){A=f.pingCache=new Jk;var x=new Set;A.set(g,x)}else x=A.get(g),x===void 0&&(x=new Set,A.set(g,x));x.has(T)||(x.add(T),f=ZC.bind(null,f,g,T),g.then(f,f))}function PC(f){do{var g;if((g=f.tag===13)&&(g=f.memoizedState,g=g!==null?g.dehydrated!==null:!0),g)return f;f=f.return}while(f!==null);return null}function NC(f,g,T,A,x){return(f.mode&1)===0?(f===g?f.flags|=65536:(f.flags|=128,T.flags|=131072,T.flags&=-52805,T.tag===1&&(T.alternate===null?T.tag=17:(g=Ol(-1,1),g.tag=2,Od(T,g,1))),T.lanes|=1),f):(f.flags|=65536,f.lanes=x,f)}var Qk=de.ReactCurrentOwner,ca=!1;function Do(f,g,T,A){g.child=f===null?uC(g,null,T,A):Np(g,f.child,T,A)}function KE(f,g,T,A,x){T=T.render;var W=g.ref;return ku(g,x),A=Mp(f,g,T,A,W,x),T=PT(),f!==null&&!ca?(g.updateQueue=f.updateQueue,g.flags&=-2053,f.lanes&=~x,kl(f,g,x)):(ni&&T&&DE(g),g.flags|=1,Do(f,g,A,x),g.child)}function kC(f,g,T,A,x){if(f===null){var W=T.type;return typeof W=="function"&&!xd(W)&&W.defaultProps===void 0&&T.compare===null&&T.defaultProps===void 0?(g.tag=15,g.type=W,DC(f,g,W,A,x)):(f=Sy(T.type,null,A,g,g.mode,x),f.ref=g.ref,f.return=g,g.child=f)}if(W=f.child,(f.lanes&x)===0){var ie=W.memoizedProps;if(T=T.compare,T=T!==null?T:cg,T(ie,A)&&f.ref===g.ref)return kl(f,g,x)}return g.flags|=1,f=Fu(W,A),f.ref=g.ref,f.return=g,g.child=f}function DC(f,g,T,A,x){if(f!==null){var W=f.memoizedProps;if(cg(W,A)&&f.ref===g.ref)if(ca=!1,g.pendingProps=A=W,(f.lanes&x)!==0)(f.flags&131072)!==0&&(ca=!0);else return g.lanes=f.lanes,kl(f,g,x)}return WT(f,g,T,A,x)}function LC(f,g,T){var A=g.pendingProps,x=A.children,W=f!==null?f.memoizedState:null;if(A.mode==="hidden")if((g.mode&1)===0)g.memoizedState={baseLanes:0,cachePool:null,transitions:null},hi(Jc,Ma),Ma|=T;else{if((T&1073741824)===0)return f=W!==null?W.baseLanes|T:T,g.lanes=g.childLanes=1073741824,g.memoizedState={baseLanes:f,cachePool:null,transitions:null},g.updateQueue=null,hi(Jc,Ma),Ma|=f,null;g.memoizedState={baseLanes:0,cachePool:null,transitions:null},A=W!==null?W.baseLanes:T,hi(Jc,Ma),Ma|=A}else W!==null?(A=W.baseLanes|T,g.memoizedState=null):A=T,hi(Jc,Ma),Ma|=A;return Do(f,g,x,T),g.child}function xC(f,g){var T=g.ref;(f===null&&T!==null||f!==null&&f.ref!==T)&&(g.flags|=512,g.flags|=2097152)}function WT(f,g,T,A,x){var W=ia(T)?nf:no.current;return W=rf(g,W),ku(g,x),T=Mp(f,g,T,A,W,x),A=PT(),f!==null&&!ca?(g.updateQueue=f.updateQueue,g.flags&=-2053,f.lanes&=~x,kl(f,g,x)):(ni&&A&&DE(g),g.flags|=1,Do(f,g,T,x),g.child)}function MC(f,g,T,A,x){if(ia(T)){var W=!0;OE(g)}else W=!1;if(ku(g,x),g.stateNode===null)QE(f,g),IC(g,T,A),VT(g,T,A,x),A=!0;else if(f===null){var ie=g.stateNode,Se=g.memoizedProps;ie.props=Se;var Ie=ie.context,$e=T.contextType;typeof $e=="object"&&$e!==null?$e=lc($e):($e=ia(T)?nf:no.current,$e=rf(g,$e));var St=T.getDerivedStateFromProps,Tt=typeof St=="function"||typeof ie.getSnapshotBeforeUpdate=="function";Tt||typeof ie.UNSAFE_componentWillReceiveProps!="function"&&typeof ie.componentWillReceiveProps!="function"||(Se!==A||Ie!==$e)&&AC(g,ie,A,$e),Ad=!1;var vt=g.memoizedState;ie.state=vt,VE(g,A,ie,x),Ie=g.memoizedState,Se!==A||vt!==Ie||ra.current||Ad?(typeof St=="function"&&(zE(g,T,St,A),Ie=g.memoizedState),(Se=Ad||UT(g,T,Se,A,vt,Ie,$e))?(Tt||typeof ie.UNSAFE_componentWillMount!="function"&&typeof ie.componentWillMount!="function"||(typeof ie.componentWillMount=="function"&&ie.componentWillMount(),typeof ie.UNSAFE_componentWillMount=="function"&&ie.UNSAFE_componentWillMount()),typeof ie.componentDidMount=="function"&&(g.flags|=4194308)):(typeof ie.componentDidMount=="function"&&(g.flags|=4194308),g.memoizedProps=A,g.memoizedState=Ie),ie.props=A,ie.state=Ie,ie.context=$e,A=Se):(typeof ie.componentDidMount=="function"&&(g.flags|=4194308),A=!1)}else{ie=g.stateNode,hC(f,g),Se=g.memoizedProps,$e=g.type===g.elementType?Se:xa(g.type,Se),ie.props=$e,Tt=g.pendingProps,vt=ie.context,Ie=T.contextType,typeof Ie=="object"&&Ie!==null?Ie=lc(Ie):(Ie=ia(T)?nf:no.current,Ie=rf(g,Ie));var Ft=T.getDerivedStateFromProps;(St=typeof Ft=="function"||typeof ie.getSnapshotBeforeUpdate=="function")||typeof ie.UNSAFE_componentWillReceiveProps!="function"&&typeof ie.componentWillReceiveProps!="function"||(Se!==Tt||vt!==Ie)&&AC(g,ie,A,Ie),Ad=!1,vt=g.memoizedState,ie.state=vt,VE(g,A,ie,x);var Yt=g.memoizedState;Se!==Tt||vt!==Yt||ra.current||Ad?(typeof Ft=="function"&&(zE(g,T,Ft,A),Yt=g.memoizedState),($e=Ad||UT(g,T,$e,A,vt,Yt,Ie)||!1)?(St||typeof ie.UNSAFE_componentWillUpdate!="function"&&typeof ie.componentWillUpdate!="function"||(typeof ie.componentWillUpdate=="function"&&ie.componentWillUpdate(A,Yt,Ie),typeof ie.UNSAFE_componentWillUpdate=="function"&&ie.UNSAFE_componentWillUpdate(A,Yt,Ie)),typeof ie.componentDidUpdate=="function"&&(g.flags|=4),typeof ie.getSnapshotBeforeUpdate=="function"&&(g.flags|=1024)):(typeof ie.componentDidUpdate!="function"||Se===f.memoizedProps&&vt===f.memoizedState||(g.flags|=4),typeof ie.getSnapshotBeforeUpdate!="function"||Se===f.memoizedProps&&vt===f.memoizedState||(g.flags|=1024),g.memoizedProps=A,g.memoizedState=Yt),ie.props=A,ie.state=Yt,ie.context=Ie,A=$e):(typeof ie.componentDidUpdate!="function"||Se===f.memoizedProps&&vt===f.memoizedState||(g.flags|=4),typeof ie.getSnapshotBeforeUpdate!="function"||Se===f.memoizedProps&&vt===f.memoizedState||(g.flags|=1024),A=!1)}return qE(f,g,T,A,W,x)}function qE(f,g,T,A,x,W){xC(f,g);var ie=(g.flags&128)!==0;if(!A&&!ie)return x&&iC(g,T,!1),kl(f,g,W);A=g.stateNode,Qk.current=g;var Se=ie&&typeof T.getDerivedStateFromError!="function"?null:A.render();return g.flags|=1,f!==null&&ie?(g.child=Np(g,f.child,null,W),g.child=Np(g,null,Se,W)):Do(f,g,Se,W),g.memoizedState=A.state,x&&iC(g,T,!0),g.child}function GT(f){var g=f.stateNode;g.pendingContext?rC(f,g.pendingContext,g.pendingContext!==g.context):g.context&&rC(f,g.context,!1),RT(f,g.containerInfo)}function UC(f,g,T,A,x){return Pp(),yT(x),g.flags|=256,Do(f,g,T,A),g.child}var zT={dehydrated:null,treeContext:null,retryLane:0};function jp(f){return{baseLanes:f,cachePool:null,transitions:null}}function $E(f,g,T){var A=g.pendingProps,x=Si.current,W=!1,ie=(g.flags&128)!==0,Se;if((Se=ie)||(Se=f!==null&&f.memoizedState===null?!1:(x&2)!==0),Se?(W=!0,g.flags&=-129):(f===null||f.memoizedState!==null)&&(x|=1),hi(Si,x&1),f===null)return ET(g),f=g.memoizedState,f!==null&&(f=f.dehydrated,f!==null)?((g.mode&1)===0?g.lanes=1:f.data==="$!"?g.lanes=8:g.lanes=1073741824,null):(ie=A.children,f=A.fallback,W?(A=g.mode,W=g.child,ie={mode:"hidden",children:ie},(A&1)===0&&W!==null?(W.childLanes=0,W.pendingProps=ie):W=Md(ie,A,0,null),f=_f(f,A,T,null),W.return=g,f.return=g,W.sibling=f,g.child=W,g.child.memoizedState=jp(T),g.memoizedState=zT,f):YE(g,ie));if(x=f.memoizedState,x!==null&&(Se=x.dehydrated,Se!==null))return VC(f,g,ie,A,Se,x,T);if(W){W=A.fallback,ie=g.mode,x=f.child,Se=x.sibling;var Ie={mode:"hidden",children:A.children};return(ie&1)===0&&g.child!==x?(A=g.child,A.childLanes=0,A.pendingProps=Ie,g.deletions=null):(A=Fu(x,Ie),A.subtreeFlags=x.subtreeFlags&14680064),Se!==null?W=Fu(Se,W):(W=_f(W,ie,T,null),W.flags|=2),W.return=g,A.return=g,A.sibling=W,g.child=A,A=W,W=g.child,ie=f.child.memoizedState,ie=ie===null?jp(T):{baseLanes:ie.baseLanes|T,cachePool:null,transitions:ie.transitions},W.memoizedState=ie,W.childLanes=f.childLanes&~T,g.memoizedState=zT,A}return W=f.child,f=W.sibling,A=Fu(W,{mode:"visible",children:A.children}),(g.mode&1)===0&&(A.lanes=T),A.return=g,A.sibling=null,f!==null&&(T=g.deletions,T===null?(g.deletions=[f],g.flags|=16):T.push(f)),g.child=A,g.memoizedState=null,A}function YE(f,g){return g=Md({mode:"visible",children:g},f.mode,0,null),g.return=f,f.child=g}function df(f,g,T,A){return A!==null&&yT(A),Np(g,f.child,null,T),f=YE(g,g.pendingProps.children),f.flags|=2,g.memoizedState=null,f}function VC(f,g,T,A,x,W,ie){if(T)return g.flags&256?(g.flags&=-257,A=FT(Error(s(422))),df(f,g,ie,A)):g.memoizedState!==null?(g.child=f.child,g.flags|=128,null):(W=A.fallback,x=g.mode,A=Md({mode:"visible",children:A.children},x,0,null),W=_f(W,x,ie,null),W.flags|=2,A.return=g,W.return=g,A.sibling=W,g.child=A,(g.mode&1)!==0&&Np(g,f.child,null,ie),g.child.memoizedState=jp(ie),g.memoizedState=zT,W);if((g.mode&1)===0)return df(f,g,ie,null);if(x.data==="$!"){if(A=x.nextSibling&&x.nextSibling.dataset,A)var Se=A.dgst;return A=Se,W=Error(s(419)),A=FT(W,A,void 0),df(f,g,ie,A)}if(Se=(ie&f.childLanes)!==0,ca||Se){if(A=Ps,A!==null){switch(ie&-ie){case 4:x=2;break;case 16:x=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:x=32;break;case 536870912:x=268435456;break;default:x=0}x=(x&(A.suspendedLanes|ie))!==0?0:x,x!==0&&x!==W.retryLane&&(W.retryLane=x,Du(f,x),pc(A,f,x,-1))}return t0(),A=FT(Error(s(421))),df(f,g,ie,A)}return x.data==="$?"?(g.flags|=128,g.child=f.child,g=Ey.bind(null,f),x._reactRetry=g,null):(f=W.treeContext,oa=bd(x.nextSibling),sa=g,ni=!0,No=null,f!==null&&(cc[La++]=Ou,cc[La++]=Pu,cc[La++]=sf,Ou=f.id,Pu=f.overflow,sf=g),g=YE(g,A.children),g.flags|=4096,g)}function FC(f,g,T){f.lanes|=g;var A=f.alternate;A!==null&&(A.lanes|=g),bT(f.return,g,T)}function XE(f,g,T,A,x){var W=f.memoizedState;W===null?f.memoizedState={isBackwards:g,rendering:null,renderingStartTime:0,last:A,tail:T,tailMode:x}:(W.isBackwards=g,W.rendering=null,W.renderingStartTime=0,W.last=A,W.tail=T,W.tailMode=x)}function JE(f,g,T){var A=g.pendingProps,x=A.revealOrder,W=A.tail;if(Do(f,g,A.children,T),A=Si.current,(A&2)!==0)A=A&1|2,g.flags|=128;else{if(f!==null&&(f.flags&128)!==0)e:for(f=g.child;f!==null;){if(f.tag===13)f.memoizedState!==null&&FC(f,T,g);else if(f.tag===19)FC(f,T,g);else if(f.child!==null){f.child.return=f,f=f.child;continue}if(f===g)break e;for(;f.sibling===null;){if(f.return===null||f.return===g)break e;f=f.return}f.sibling.return=f.return,f=f.sibling}A&=1}if(hi(Si,A),(g.mode&1)===0)g.memoizedState=null;else switch(x){case"forwards":for(T=g.child,x=null;T!==null;)f=T.alternate,f!==null&&Pd(f)===null&&(x=T),T=T.sibling;T=x,T===null?(x=g.child,g.child=null):(x=T.sibling,T.sibling=null),XE(g,!1,x,T,W);break;case"backwards":for(T=null,x=g.child,g.child=null;x!==null;){if(f=x.alternate,f!==null&&Pd(f)===null){g.child=x;break}f=x.sibling,x.sibling=T,T=x,x=f}XE(g,!0,T,null,W);break;case"together":XE(g,!1,null,null,void 0);break;default:g.memoizedState=null}return g.child}function QE(f,g){(g.mode&1)===0&&f!==null&&(f.alternate=null,g.alternate=null,g.flags|=2)}function kl(f,g,T){if(f!==null&&(g.dependencies=f.dependencies),hf|=g.lanes,(T&g.childLanes)===0)return null;if(f!==null&&g.child!==f.child)throw Error(s(153));if(g.child!==null){for(f=g.child,T=Fu(f,f.pendingProps),g.child=T,T.return=g;f.sibling!==null;)f=f.sibling,T=T.sibling=Fu(f,f.pendingProps),T.return=g;T.sibling=null}return g.child}function jC(f,g,T){switch(g.tag){case 3:GT(g),Pp();break;case 5:mC(g);break;case 1:ia(g.type)&&OE(g);break;case 4:RT(g,g.stateNode.containerInfo);break;case 10:var A=g.type._context,x=g.memoizedProps.value;hi(ME,A._currentValue),A._currentValue=x;break;case 13:if(A=g.memoizedState,A!==null)return A.dehydrated!==null?(hi(Si,Si.current&1),g.flags|=128,null):(T&g.child.childLanes)!==0?$E(f,g,T):(hi(Si,Si.current&1),f=kl(f,g,T),f!==null?f.sibling:null);hi(Si,Si.current&1);break;case 19:if(A=(T&g.childLanes)!==0,(f.flags&128)!==0){if(A)return JE(f,g,T);g.flags|=128}if(x=g.memoizedState,x!==null&&(x.rendering=null,x.tail=null,x.lastEffect=null),hi(Si,Si.current),A)break;return null;case 22:case 23:return g.lanes=0,LC(f,g,T)}return kl(f,g,T)}var BC,ZE,HT,WC;BC=function(f,g){for(var T=g.child;T!==null;){if(T.tag===5||T.tag===6)f.appendChild(T.stateNode);else if(T.tag!==4&&T.child!==null){T.child.return=T,T=T.child;continue}if(T===g)break;for(;T.sibling===null;){if(T.return===null||T.return===g)return;T=T.return}T.sibling.return=T.return,T=T.sibling}},ZE=function(){},HT=function(f,g,T,A){var x=f.memoizedProps;if(x!==A){f=g.stateNode,af(Pl.current);var W=null;switch(T){case"input":x=Ar(f,x),A=Ar(f,A),W=[];break;case"select":x=it({},x,{value:void 0}),A=it({},A,{value:void 0}),W=[];break;case"textarea":x=mt(f,x),A=mt(f,A),W=[];break;default:typeof x.onClick!="function"&&typeof A.onClick=="function"&&(f.onclick=RE)}Ca(T,A);var ie;T=null;for($e in x)if(!A.hasOwnProperty($e)&&x.hasOwnProperty($e)&&x[$e]!=null)if($e==="style"){var Se=x[$e];for(ie in Se)Se.hasOwnProperty(ie)&&(T||(T={}),T[ie]="")}else $e!=="dangerouslySetInnerHTML"&&$e!=="children"&&$e!=="suppressContentEditableWarning"&&$e!=="suppressHydrationWarning"&&$e!=="autoFocus"&&(l.hasOwnProperty($e)?W||(W=[]):(W=W||[]).push($e,null));for($e in A){var Ie=A[$e];if(Se=x!=null?x[$e]:void 0,A.hasOwnProperty($e)&&Ie!==Se&&(Ie!=null||Se!=null))if($e==="style")if(Se){for(ie in Se)!Se.hasOwnProperty(ie)||Ie&&Ie.hasOwnProperty(ie)||(T||(T={}),T[ie]="");for(ie in Ie)Ie.hasOwnProperty(ie)&&Se[ie]!==Ie[ie]&&(T||(T={}),T[ie]=Ie[ie])}else T||(W||(W=[]),W.push($e,T)),T=Ie;else $e==="dangerouslySetInnerHTML"?(Ie=Ie?Ie.__html:void 0,Se=Se?Se.__html:void 0,Ie!=null&&Se!==Ie&&(W=W||[]).push($e,Ie)):$e==="children"?typeof Ie!="string"&&typeof Ie!="number"||(W=W||[]).push($e,""+Ie):$e!=="suppressContentEditableWarning"&&$e!=="suppressHydrationWarning"&&(l.hasOwnProperty($e)?(Ie!=null&&$e==="onScroll"&&_i("scroll",f),W||Se===Ie||(W=[])):(W=W||[]).push($e,Ie))}T&&(W=W||[]).push("style",T);var $e=W;(g.updateQueue=$e)&&(g.flags|=4)}},WC=function(f,g,T,A){T!==A&&(g.flags|=4)};function Pg(f,g){if(!ni)switch(f.tailMode){case"hidden":g=f.tail;for(var T=null;g!==null;)g.alternate!==null&&(T=g),g=g.sibling;T===null?f.tail=null:T.sibling=null;break;case"collapsed":T=f.tail;for(var A=null;T!==null;)T.alternate!==null&&(A=T),T=T.sibling;A===null?g||f.tail===null?f.tail=null:f.tail.sibling=null:A.sibling=null}}function io(f){var g=f.alternate!==null&&f.alternate.child===f.child,T=0,A=0;if(g)for(var x=f.child;x!==null;)T|=x.lanes|x.childLanes,A|=x.subtreeFlags&14680064,A|=x.flags&14680064,x.return=f,x=x.sibling;else for(x=f.child;x!==null;)T|=x.lanes|x.childLanes,A|=x.subtreeFlags,A|=x.flags,x.return=f,x=x.sibling;return f.subtreeFlags|=A,f.childLanes=T,g}function ey(f,g,T){var A=g.pendingProps;switch(Eg(g),g.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return io(g),null;case 1:return ia(g.type)&&IE(),io(g),null;case 3:return A=g.stateNode,cf(),Ei(ra),Ei(no),IT(),A.pendingContext&&(A.context=A.pendingContext,A.pendingContext=null),(f===null||f.child===null)&&(yg(g)?g.flags|=4:f===null||f.memoizedState.isDehydrated&&(g.flags&256)===0||(g.flags|=1024,No!==null&&(py(No),No=null))),ZE(f,g),io(g),null;case 5:Lp(g);var x=af(Dp.current);if(T=g.type,f!==null&&g.stateNode!=null)HT(f,g,T,A,x),f.ref!==g.ref&&(g.flags|=512,g.flags|=2097152);else{if(!A){if(g.stateNode===null)throw Error(s(166));return io(g),null}if(f=af(Pl.current),yg(g)){A=g.stateNode,T=g.type;var W=g.memoizedProps;switch(A[Al]=g,A[wd]=W,f=(g.mode&1)!==0,T){case"dialog":_i("cancel",A),_i("close",A);break;case"iframe":case"object":case"embed":_i("load",A);break;case"video":case"audio":for(x=0;x<hg.length;x++)_i(hg[x],A);break;case"source":_i("error",A);break;case"img":case"image":case"link":_i("error",A),_i("load",A);break;case"details":_i("toggle",A);break;case"input":Zt(A,W),_i("invalid",A);break;case"select":A._wrapperState={wasMultiple:!!W.multiple},_i("invalid",A);break;case"textarea":gt(A,W),_i("invalid",A)}Ca(T,W),x=null;for(var ie in W)if(W.hasOwnProperty(ie)){var Se=W[ie];ie==="children"?typeof Se=="string"?A.textContent!==Se&&(W.suppressHydrationWarning!==!0&&wE(A.textContent,Se,f),x=["children",Se]):typeof Se=="number"&&A.textContent!==""+Se&&(W.suppressHydrationWarning!==!0&&wE(A.textContent,Se,f),x=["children",""+Se]):l.hasOwnProperty(ie)&&Se!=null&&ie==="onScroll"&&_i("scroll",A)}switch(T){case"input":In(A),ve(A,W,!0);break;case"textarea":In(A),_n(A);break;case"select":case"option":break;default:typeof W.onClick=="function"&&(A.onclick=RE)}A=x,g.updateQueue=A,A!==null&&(g.flags|=4)}else{ie=x.nodeType===9?x:x.ownerDocument,f==="http://www.w3.org/1999/xhtml"&&(f=kn(T)),f==="http://www.w3.org/1999/xhtml"?T==="script"?(f=ie.createElement("div"),f.innerHTML="<script><\/script>",f=f.removeChild(f.firstChild)):typeof A.is=="string"?f=ie.createElement(T,{is:A.is}):(f=ie.createElement(T),T==="select"&&(ie=f,A.multiple?ie.multiple=!0:A.size&&(ie.size=A.size))):f=ie.createElementNS(f,T),f[Al]=g,f[wd]=A,BC(f,g,!1,!1),g.stateNode=f;e:{switch(ie=Bc(T,A),T){case"dialog":_i("cancel",f),_i("close",f),x=A;break;case"iframe":case"object":case"embed":_i("load",f),x=A;break;case"video":case"audio":for(x=0;x<hg.length;x++)_i(hg[x],f);x=A;break;case"source":_i("error",f),x=A;break;case"img":case"image":case"link":_i("error",f),_i("load",f),x=A;break;case"details":_i("toggle",f),x=A;break;case"input":Zt(f,A),x=Ar(f,A),_i("invalid",f);break;case"option":x=A;break;case"select":f._wrapperState={wasMultiple:!!A.multiple},x=it({},A,{value:void 0}),_i("invalid",f);break;case"textarea":gt(f,A),x=mt(f,A),_i("invalid",f);break;default:x=A}Ca(T,x),Se=x;for(W in Se)if(Se.hasOwnProperty(W)){var Ie=Se[W];W==="style"?Vs(f,Ie):W==="dangerouslySetInnerHTML"?(Ie=Ie?Ie.__html:void 0,Ie!=null&&$a(f,Ie)):W==="children"?typeof Ie=="string"?(T!=="textarea"||Ie!=="")&&kt(f,Ie):typeof Ie=="number"&&kt(f,""+Ie):W!=="suppressContentEditableWarning"&&W!=="suppressHydrationWarning"&&W!=="autoFocus"&&(l.hasOwnProperty(W)?Ie!=null&&W==="onScroll"&&_i("scroll",f):Ie!=null&&re(f,W,Ie,ie))}switch(T){case"input":In(f),ve(f,A,!1);break;case"textarea":In(f),_n(f);break;case"option":A.value!=null&&f.setAttribute("value",""+$t(A.value));break;case"select":f.multiple=!!A.multiple,W=A.value,W!=null?dt(f,!!A.multiple,W,!1):A.defaultValue!=null&&dt(f,!!A.multiple,A.defaultValue,!0);break;default:typeof x.onClick=="function"&&(f.onclick=RE)}switch(T){case"button":case"input":case"select":case"textarea":A=!!A.autoFocus;break e;case"img":A=!0;break e;default:A=!1}}A&&(g.flags|=4)}g.ref!==null&&(g.flags|=512,g.flags|=2097152)}return io(g),null;case 6:if(f&&g.stateNode!=null)WC(f,g,f.memoizedProps,A);else{if(typeof A!="string"&&g.stateNode===null)throw Error(s(166));if(T=af(Dp.current),af(Pl.current),yg(g)){if(A=g.stateNode,T=g.memoizedProps,A[Al]=g,(W=A.nodeValue!==T)&&(f=sa,f!==null))switch(f.tag){case 3:wE(A.nodeValue,T,(f.mode&1)!==0);break;case 5:f.memoizedProps.suppressHydrationWarning!==!0&&wE(A.nodeValue,T,(f.mode&1)!==0)}W&&(g.flags|=4)}else A=(T.nodeType===9?T:T.ownerDocument).createTextNode(A),A[Al]=g,g.stateNode=A}return io(g),null;case 13:if(Ei(Si),A=g.memoizedState,f===null||f.memoizedState!==null&&f.memoizedState.dehydrated!==null){if(ni&&oa!==null&&(g.mode&1)!==0&&(g.flags&128)===0)lC(),Pp(),g.flags|=98560,W=!1;else if(W=yg(g),A!==null&&A.dehydrated!==null){if(f===null){if(!W)throw Error(s(318));if(W=g.memoizedState,W=W!==null?W.dehydrated:null,!W)throw Error(s(317));W[Al]=g}else Pp(),(g.flags&128)===0&&(g.memoizedState=null),g.flags|=4;io(g),W=!1}else No!==null&&(py(No),No=null),W=!0;if(!W)return g.flags&65536?g:null}return(g.flags&128)!==0?(g.lanes=T,g):(A=A!==null,A!==(f!==null&&f.memoizedState!==null)&&A&&(g.child.flags|=8192,(g.mode&1)!==0&&(f===null||(Si.current&1)!==0?os===0&&(os=3):t0())),g.updateQueue!==null&&(g.flags|=4),io(g),null);case 4:return cf(),ZE(f,g),f===null&&Qh(g.stateNode.containerInfo),io(g),null;case 10:return TT(g.type._context),io(g),null;case 17:return ia(g.type)&&IE(),io(g),null;case 19:if(Ei(Si),W=g.memoizedState,W===null)return io(g),null;if(A=(g.flags&128)!==0,ie=W.rendering,ie===null)if(A)Pg(W,!1);else{if(os!==0||f!==null&&(f.flags&128)!==0)for(f=g.child;f!==null;){if(ie=Pd(f),ie!==null){for(g.flags|=128,Pg(W,!1),A=ie.updateQueue,A!==null&&(g.updateQueue=A,g.flags|=4),g.subtreeFlags=0,A=T,T=g.child;T!==null;)W=T,f=A,W.flags&=14680066,ie=W.alternate,ie===null?(W.childLanes=0,W.lanes=f,W.child=null,W.subtreeFlags=0,W.memoizedProps=null,W.memoizedState=null,W.updateQueue=null,W.dependencies=null,W.stateNode=null):(W.childLanes=ie.childLanes,W.lanes=ie.lanes,W.child=ie.child,W.subtreeFlags=0,W.deletions=null,W.memoizedProps=ie.memoizedProps,W.memoizedState=ie.memoizedState,W.updateQueue=ie.updateQueue,W.type=ie.type,f=ie.dependencies,W.dependencies=f===null?null:{lanes:f.lanes,firstContext:f.firstContext}),T=T.sibling;return hi(Si,Si.current&1|2),g.child}f=f.sibling}W.tail!==null&&Mr()>Gp&&(g.flags|=128,A=!0,Pg(W,!1),g.lanes=4194304)}else{if(!A)if(f=Pd(ie),f!==null){if(g.flags|=128,A=!0,T=f.updateQueue,T!==null&&(g.updateQueue=T,g.flags|=4),Pg(W,!0),W.tail===null&&W.tailMode==="hidden"&&!ie.alternate&&!ni)return io(g),null}else 2*Mr()-W.renderingStartTime>Gp&&T!==1073741824&&(g.flags|=128,A=!0,Pg(W,!1),g.lanes=4194304);W.isBackwards?(ie.sibling=g.child,g.child=ie):(T=W.last,T!==null?T.sibling=ie:g.child=ie,W.last=ie)}return W.tail!==null?(g=W.tail,W.rendering=g,W.tail=g.sibling,W.renderingStartTime=Mr(),g.sibling=null,T=Si.current,hi(Si,A?T&1|2:T&1),g):(io(g),null);case 22:case 23:return Vg(),A=g.memoizedState!==null,f!==null&&f.memoizedState!==null!==A&&(g.flags|=8192),A&&(g.mode&1)!==0?(Ma&1073741824)!==0&&(io(g),g.subtreeFlags&6&&(g.flags|=8192)):io(g),null;case 24:return null;case 25:return null}throw Error(s(156,g.tag))}function Zk(f,g){switch(Eg(g),g.tag){case 1:return ia(g.type)&&IE(),f=g.flags,f&65536?(g.flags=f&-65537|128,g):null;case 3:return cf(),Ei(ra),Ei(no),IT(),f=g.flags,(f&65536)!==0&&(f&128)===0?(g.flags=f&-65537|128,g):null;case 5:return Lp(g),null;case 13:if(Ei(Si),f=g.memoizedState,f!==null&&f.dehydrated!==null){if(g.alternate===null)throw Error(s(340));Pp()}return f=g.flags,f&65536?(g.flags=f&-65537|128,g):null;case 19:return Ei(Si),null;case 4:return cf(),null;case 10:return TT(g.type._context),null;case 22:case 23:return Vg(),null;case 24:return null;default:return null}}var ty=!1,so=!1,GC=typeof WeakSet=="function"?WeakSet:Set,Ht=null;function Bp(f,g){var T=f.ref;if(T!==null)if(typeof T=="function")try{T(null)}catch(A){Ii(f,g,A)}else T.current=null}function Ng(f,g,T){try{T()}catch(A){Ii(f,g,A)}}var zC=!1;function KT(f,g){if(CE=_e,f=HR(),lg(f)){if("selectionStart"in f)var T={start:f.selectionStart,end:f.selectionEnd};else e:{T=(T=f.ownerDocument)&&T.defaultView||window;var A=T.getSelection&&T.getSelection();if(A&&A.rangeCount!==0){T=A.anchorNode;var x=A.anchorOffset,W=A.focusNode;A=A.focusOffset;try{T.nodeType,W.nodeType}catch{T=null;break e}var ie=0,Se=-1,Ie=-1,$e=0,St=0,Tt=f,vt=null;t:for(;;){for(var Ft;Tt!==T||x!==0&&Tt.nodeType!==3||(Se=ie+x),Tt!==W||A!==0&&Tt.nodeType!==3||(Ie=ie+A),Tt.nodeType===3&&(ie+=Tt.nodeValue.length),(Ft=Tt.firstChild)!==null;)vt=Tt,Tt=Ft;for(;;){if(Tt===f)break t;if(vt===T&&++$e===x&&(Se=ie),vt===W&&++St===A&&(Ie=ie),(Ft=Tt.nextSibling)!==null)break;Tt=vt,vt=Tt.parentNode}Tt=Ft}T=Se===-1||Ie===-1?null:{start:Se,end:Ie}}else T=null}T=T||{start:0,end:0}}else T=null;for(pg={focusedElem:f,selectionRange:T},_e=!1,Ht=g;Ht!==null;)if(g=Ht,f=g.child,(g.subtreeFlags&1028)!==0&&f!==null)f.return=g,Ht=f;else for(;Ht!==null;){g=Ht;try{var Yt=g.alternate;if((g.flags&1024)!==0)switch(g.tag){case 0:case 11:case 15:break;case 1:if(Yt!==null){var Xt=Yt.memoizedProps,Fi=Yt.memoizedState,Ge=g.stateNode,Pe=Ge.getSnapshotBeforeUpdate(g.elementType===g.type?Xt:xa(g.type,Xt),Fi);Ge.__reactInternalSnapshotBeforeUpdate=Pe}break;case 3:var He=g.stateNode.containerInfo;He.nodeType===1?He.textContent="":He.nodeType===9&&He.documentElement&&He.removeChild(He.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(s(163))}}catch(wt){Ii(g,g.return,wt)}if(f=g.sibling,f!==null){f.return=g.return,Ht=f;break}Ht=g.return}return Yt=zC,zC=!1,Yt}function kg(f,g,T){var A=g.updateQueue;if(A=A!==null?A.lastEffect:null,A!==null){var x=A=A.next;do{if((x.tag&f)===f){var W=x.destroy;x.destroy=void 0,W!==void 0&&Ng(g,T,W)}x=x.next}while(x!==A)}}function Dg(f,g){if(g=g.updateQueue,g=g!==null?g.lastEffect:null,g!==null){var T=g=g.next;do{if((T.tag&f)===f){var A=T.create;T.destroy=A()}T=T.next}while(T!==g)}}function qT(f){var g=f.ref;if(g!==null){var T=f.stateNode;switch(f.tag){case 5:f=T;break;default:f=T}typeof g=="function"?g(f):g.current=f}}function HC(f){var g=f.alternate;g!==null&&(f.alternate=null,HC(g)),f.child=null,f.deletions=null,f.sibling=null,f.tag===5&&(g=f.stateNode,g!==null&&(delete g[Al],delete g[wd],delete g[gg],delete g[Wk],delete g[Gk])),f.stateNode=null,f.return=null,f.dependencies=null,f.memoizedProps=null,f.memoizedState=null,f.pendingProps=null,f.stateNode=null,f.updateQueue=null}function $T(f){return f.tag===5||f.tag===3||f.tag===4}function KC(f){e:for(;;){for(;f.sibling===null;){if(f.return===null||$T(f.return))return null;f=f.return}for(f.sibling.return=f.return,f=f.sibling;f.tag!==5&&f.tag!==6&&f.tag!==18;){if(f.flags&2||f.child===null||f.tag===4)continue e;f.child.return=f,f=f.child}if(!(f.flags&2))return f.stateNode}}function YT(f,g,T){var A=f.tag;if(A===5||A===6)f=f.stateNode,g?T.nodeType===8?T.parentNode.insertBefore(f,g):T.insertBefore(f,g):(T.nodeType===8?(g=T.parentNode,g.insertBefore(f,T)):(g=T,g.appendChild(f)),T=T._reactRootContainer,T!=null||g.onclick!==null||(g.onclick=RE));else if(A!==4&&(f=f.child,f!==null))for(YT(f,g,T),f=f.sibling;f!==null;)YT(f,g,T),f=f.sibling}function ny(f,g,T){var A=f.tag;if(A===5||A===6)f=f.stateNode,g?T.insertBefore(f,g):T.appendChild(f);else if(A!==4&&(f=f.child,f!==null))for(ny(f,g,T),f=f.sibling;f!==null;)ny(f,g,T),f=f.sibling}var js=null,dc=!1;function Dl(f,g,T){for(T=T.child;T!==null;)qC(f,g,T),T=T.sibling}function qC(f,g,T){if(to&&typeof to.onCommitFiberUnmount=="function")try{to.onCommitFiberUnmount(vl,T)}catch{}switch(T.tag){case 5:so||Bp(T,g);case 6:var A=js,x=dc;js=null,Dl(f,g,T),js=A,dc=x,js!==null&&(dc?(f=js,T=T.stateNode,f.nodeType===8?f.parentNode.removeChild(T):f.removeChild(T)):js.removeChild(T.stateNode));break;case 18:js!==null&&(dc?(f=js,T=T.stateNode,f.nodeType===8?mT(f.parentNode,T):f.nodeType===1&&mT(f,T),ta(f)):mT(js,T.stateNode));break;case 4:A=js,x=dc,js=T.stateNode.containerInfo,dc=!0,Dl(f,g,T),js=A,dc=x;break;case 0:case 11:case 14:case 15:if(!so&&(A=T.updateQueue,A!==null&&(A=A.lastEffect,A!==null))){x=A=A.next;do{var W=x,ie=W.destroy;W=W.tag,ie!==void 0&&((W&2)!==0||(W&4)!==0)&&Ng(T,g,ie),x=x.next}while(x!==A)}Dl(f,g,T);break;case 1:if(!so&&(Bp(T,g),A=T.stateNode,typeof A.componentWillUnmount=="function"))try{A.props=T.memoizedProps,A.state=T.memoizedState,A.componentWillUnmount()}catch(Se){Ii(T,g,Se)}Dl(f,g,T);break;case 21:Dl(f,g,T);break;case 22:T.mode&1?(so=(A=so)||T.memoizedState!==null,Dl(f,g,T),so=A):Dl(f,g,T);break;default:Dl(f,g,T)}}function $C(f){var g=f.updateQueue;if(g!==null){f.updateQueue=null;var T=f.stateNode;T===null&&(T=f.stateNode=new GC),g.forEach(function(A){var x=eI.bind(null,f,A);T.has(A)||(T.add(A),A.then(x,x))})}}function Lo(f,g){var T=g.deletions;if(T!==null)for(var A=0;A<T.length;A++){var x=T[A];try{var W=f,ie=g,Se=ie;e:for(;Se!==null;){switch(Se.tag){case 5:js=Se.stateNode,dc=!1;break e;case 3:js=Se.stateNode.containerInfo,dc=!0;break e;case 4:js=Se.stateNode.containerInfo,dc=!0;break e}Se=Se.return}if(js===null)throw Error(s(160));qC(W,ie,x),js=null,dc=!1;var Ie=x.alternate;Ie!==null&&(Ie.return=null),x.return=null}catch($e){Ii(x,g,$e)}}if(g.subtreeFlags&12854)for(g=g.child;g!==null;)XT(g,f),g=g.sibling}function XT(f,g){var T=f.alternate,A=f.flags;switch(f.tag){case 0:case 11:case 14:case 15:if(Lo(g,f),la(f),A&4){try{kg(3,f,f.return),Dg(3,f)}catch(Xt){Ii(f,f.return,Xt)}try{kg(5,f,f.return)}catch(Xt){Ii(f,f.return,Xt)}}break;case 1:Lo(g,f),la(f),A&512&&T!==null&&Bp(T,T.return);break;case 5:if(Lo(g,f),la(f),A&512&&T!==null&&Bp(T,T.return),f.flags&32){var x=f.stateNode;try{kt(x,"")}catch(Xt){Ii(f,f.return,Xt)}}if(A&4&&(x=f.stateNode,x!=null)){var W=f.memoizedProps,ie=T!==null?T.memoizedProps:W,Se=f.type,Ie=f.updateQueue;if(f.updateQueue=null,Ie!==null)try{Se==="input"&&W.type==="radio"&&W.name!=null&&Zn(x,W),Bc(Se,ie);var $e=Bc(Se,W);for(ie=0;ie<Ie.length;ie+=2){var St=Ie[ie],Tt=Ie[ie+1];St==="style"?Vs(x,Tt):St==="dangerouslySetInnerHTML"?$a(x,Tt):St==="children"?kt(x,Tt):re(x,St,Tt,$e)}switch(Se){case"input":zt(x,W);break;case"textarea":Vt(x,W);break;case"select":var vt=x._wrapperState.wasMultiple;x._wrapperState.wasMultiple=!!W.multiple;var Ft=W.value;Ft!=null?dt(x,!!W.multiple,Ft,!1):vt!==!!W.multiple&&(W.defaultValue!=null?dt(x,!!W.multiple,W.defaultValue,!0):dt(x,!!W.multiple,W.multiple?[]:"",!1))}x[wd]=W}catch(Xt){Ii(f,f.return,Xt)}}break;case 6:if(Lo(g,f),la(f),A&4){if(f.stateNode===null)throw Error(s(162));x=f.stateNode,W=f.memoizedProps;try{x.nodeValue=W}catch(Xt){Ii(f,f.return,Xt)}}break;case 3:if(Lo(g,f),la(f),A&4&&T!==null&&T.memoizedState.isDehydrated)try{ta(g.containerInfo)}catch(Xt){Ii(f,f.return,Xt)}break;case 4:Lo(g,f),la(f);break;case 13:Lo(g,f),la(f),x=f.child,x.flags&8192&&(W=x.memoizedState!==null,x.stateNode.isHidden=W,!W||x.alternate!==null&&x.alternate.memoizedState!==null||(cy=Mr())),A&4&&$C(f);break;case 22:if(St=T!==null&&T.memoizedState!==null,f.mode&1?(so=($e=so)||St,Lo(g,f),so=$e):Lo(g,f),la(f),A&8192){if($e=f.memoizedState!==null,(f.stateNode.isHidden=$e)&&!St&&(f.mode&1)!==0)for(Ht=f,St=f.child;St!==null;){for(Tt=Ht=St;Ht!==null;){switch(vt=Ht,Ft=vt.child,vt.tag){case 0:case 11:case 14:case 15:kg(4,vt,vt.return);break;case 1:Bp(vt,vt.return);var Yt=vt.stateNode;if(typeof Yt.componentWillUnmount=="function"){A=vt,T=vt.return;try{g=A,Yt.props=g.memoizedProps,Yt.state=g.memoizedState,Yt.componentWillUnmount()}catch(Xt){Ii(A,T,Xt)}}break;case 5:Bp(vt,vt.return);break;case 22:if(vt.memoizedState!==null){Lg(Tt);continue}}Ft!==null?(Ft.return=vt,Ht=Ft):Lg(Tt)}St=St.sibling}e:for(St=null,Tt=f;;){if(Tt.tag===5){if(St===null){St=Tt;try{x=Tt.stateNode,$e?(W=x.style,typeof W.setProperty=="function"?W.setProperty("display","none","important"):W.display="none"):(Se=Tt.stateNode,Ie=Tt.memoizedProps.style,ie=Ie!=null&&Ie.hasOwnProperty("display")?Ie.display:null,Se.style.display=Cs("display",ie))}catch(Xt){Ii(f,f.return,Xt)}}}else if(Tt.tag===6){if(St===null)try{Tt.stateNode.nodeValue=$e?"":Tt.memoizedProps}catch(Xt){Ii(f,f.return,Xt)}}else if((Tt.tag!==22&&Tt.tag!==23||Tt.memoizedState===null||Tt===f)&&Tt.child!==null){Tt.child.return=Tt,Tt=Tt.child;continue}if(Tt===f)break e;for(;Tt.sibling===null;){if(Tt.return===null||Tt.return===f)break e;St===Tt&&(St=null),Tt=Tt.return}St===Tt&&(St=null),Tt.sibling.return=Tt.return,Tt=Tt.sibling}}break;case 19:Lo(g,f),la(f),A&4&&$C(f);break;case 21:break;default:Lo(g,f),la(f)}}function la(f){var g=f.flags;if(g&2){try{e:{for(var T=f.return;T!==null;){if($T(T)){var A=T;break e}T=T.return}throw Error(s(160))}switch(A.tag){case 5:var x=A.stateNode;A.flags&32&&(kt(x,""),A.flags&=-33);var W=KC(f);ny(f,W,x);break;case 3:case 4:var ie=A.stateNode.containerInfo,Se=KC(f);YT(f,Se,ie);break;default:throw Error(s(161))}}catch(Ie){Ii(f,f.return,Ie)}f.flags&=-3}g&4096&&(f.flags&=-4097)}function Wp(f,g,T){Ht=f,JT(f)}function JT(f,g,T){for(var A=(f.mode&1)!==0;Ht!==null;){var x=Ht,W=x.child;if(x.tag===22&&A){var ie=x.memoizedState!==null||ty;if(!ie){var Se=x.alternate,Ie=Se!==null&&Se.memoizedState!==null||so;Se=ty;var $e=so;if(ty=ie,(so=Ie)&&!$e)for(Ht=x;Ht!==null;)ie=Ht,Ie=ie.child,ie.tag===22&&ie.memoizedState!==null?YC(x):Ie!==null?(Ie.return=ie,Ht=Ie):YC(x);for(;W!==null;)Ht=W,JT(W),W=W.sibling;Ht=x,ty=Se,so=$e}ry(f)}else(x.subtreeFlags&8772)!==0&&W!==null?(W.return=x,Ht=W):ry(f)}}function ry(f){for(;Ht!==null;){var g=Ht;if((g.flags&8772)!==0){var T=g.alternate;try{if((g.flags&8772)!==0)switch(g.tag){case 0:case 11:case 15:so||Dg(5,g);break;case 1:var A=g.stateNode;if(g.flags&4&&!so)if(T===null)A.componentDidMount();else{var x=g.elementType===g.type?T.memoizedProps:xa(g.type,T.memoizedProps);A.componentDidUpdate(x,T.memoizedState,A.__reactInternalSnapshotBeforeUpdate)}var W=g.updateQueue;W!==null&&pC(g,W,A);break;case 3:var ie=g.updateQueue;if(ie!==null){if(T=null,g.child!==null)switch(g.child.tag){case 5:T=g.child.stateNode;break;case 1:T=g.child.stateNode}pC(g,ie,T)}break;case 5:var Se=g.stateNode;if(T===null&&g.flags&4){T=Se;var Ie=g.memoizedProps;switch(g.type){case"button":case"input":case"select":case"textarea":Ie.autoFocus&&T.focus();break;case"img":Ie.src&&(T.src=Ie.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(g.memoizedState===null){var $e=g.alternate;if($e!==null){var St=$e.memoizedState;if(St!==null){var Tt=St.dehydrated;Tt!==null&&ta(Tt)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(s(163))}so||g.flags&512&&qT(g)}catch(vt){Ii(g,g.return,vt)}}if(g===f){Ht=null;break}if(T=g.sibling,T!==null){T.return=g.return,Ht=T;break}Ht=g.return}}function Lg(f){for(;Ht!==null;){var g=Ht;if(g===f){Ht=null;break}var T=g.sibling;if(T!==null){T.return=g.return,Ht=T;break}Ht=g.return}}function YC(f){for(;Ht!==null;){var g=Ht;try{switch(g.tag){case 0:case 11:case 15:var T=g.return;try{Dg(4,g)}catch(Ie){Ii(g,T,Ie)}break;case 1:var A=g.stateNode;if(typeof A.componentDidMount=="function"){var x=g.return;try{A.componentDidMount()}catch(Ie){Ii(g,x,Ie)}}var W=g.return;try{qT(g)}catch(Ie){Ii(g,W,Ie)}break;case 5:var ie=g.return;try{qT(g)}catch(Ie){Ii(g,ie,Ie)}}}catch(Ie){Ii(g,g.return,Ie)}if(g===f){Ht=null;break}var Se=g.sibling;if(Se!==null){Se.return=g.return,Ht=Se;break}Ht=g.return}}var eD=Math.ceil,iy=de.ReactCurrentDispatcher,sy=de.ReactCurrentOwner,hc=de.ReactCurrentBatchConfig,yr=0,Ps=null,Vi=null,ss=0,Ma=0,Jc=oc(0),os=0,Bs=null,hf=0,oy=0,ay=0,xg=null,xo=null,cy=0,Gp=1/0,Ll=null,ly=!1,QT=null,Dd=null,zp=!1,xl=null,uy=0,ff=0,ZT=null,Mg=-1,dy=0;function Ws(){return(yr&6)!==0?Mr():Mg!==-1?Mg:Mg=Mr()}function fc(f){return(f.mode&1)===0?1:(yr&2)!==0&&ss!==0?ss&-ss:Hk.transition!==null?(dy===0&&(dy=Su()),dy):(f=er,f!==0||(f=window.event,f=f===void 0?16:Ur(f.type)),f)}function pc(f,g,T,A){if(50<ff)throw ff=0,ZT=null,Error(s(185));bl(f,T,A),((yr&2)===0||f!==Ps)&&(f===Ps&&((yr&2)===0&&(oy|=T),os===4&&Uu(f,ss)),oo(f,A),T===1&&yr===0&&(g.mode&1)===0&&(Gp=Mr()+500,PE&&Cd()))}function oo(f,g){var T=f.callbackNode;Oa(f,g);var A=Tl(f,f===Ps?ss:0);if(A===0)T!==null&&yu(T),f.callbackNode=null,f.callbackPriority=0;else if(g=A&-A,f.callbackPriority!==g){if(T!=null&&yu(T),g===1)f.tag===0?zk(pf.bind(null,f)):sC(pf.bind(null,f)),jk(function(){(yr&6)===0&&Cd()}),T=null;else{switch(ec(A)){case 1:T=Za;break;case 4:T=zc;break;case 16:T=Zo;break;case 536870912:T=_d;break;default:T=Zo}T=Fg(T,hy.bind(null,f))}f.callbackPriority=g,f.callbackNode=T}}function hy(f,g){if(Mg=-1,dy=0,(yr&6)!==0)throw Error(s(327));var T=f.callbackNode;if(Hp()&&f.callbackNode!==T)return null;var A=Tl(f,f===Ps?ss:0);if(A===0)return null;if((A&30)!==0||(A&f.expiredLanes)!==0||g)g=Ml(f,A);else{g=A;var x=yr;yr|=2;var W=XC();(Ps!==f||ss!==g)&&(Ll=null,Gp=Mr()+500,Ld(f,g));do try{tD();break}catch(Se){e0(f,Se)}while(!0);ST(),iy.current=W,yr=x,Vi!==null?g=0:(Ps=null,ss=0,g=os)}if(g!==0){if(g===2&&(x=vo(f),x!==0&&(A=x,g=fy(f,x))),g===1)throw T=Bs,Ld(f,0),Uu(f,A),oo(f,Mr()),T;if(g===6)Uu(f,A);else{if(x=f.current.alternate,(A&30)===0&&!my(x)&&(g=Ml(f,A),g===2&&(W=vo(f),W!==0&&(A=W,g=fy(f,W))),g===1))throw T=Bs,Ld(f,0),Uu(f,A),oo(f,Mr()),T;switch(f.finishedWork=x,f.finishedLanes=A,g){case 0:case 1:throw Error(s(345));case 2:mf(f,xo,Ll);break;case 3:if(Uu(f,A),(A&130023424)===A&&(g=cy+500-Mr(),10<g)){if(Tl(f,0)!==0)break;if(x=f.suspendedLanes,(x&A)!==A){Ws(),f.pingedLanes|=f.suspendedLanes&x;break}f.timeoutHandle=mg(mf.bind(null,f,xo,Ll),g);break}mf(f,xo,Ll);break;case 4:if(Uu(f,A),(A&4194240)===A)break;for(g=f.eventTimes,x=-1;0<A;){var ie=31-Fs(A);W=1<<ie,ie=g[ie],ie>x&&(x=ie),A&=~W}if(A=x,A=Mr()-A,A=(120>A?120:480>A?480:1080>A?1080:1920>A?1920:3e3>A?3e3:4320>A?4320:1960*eD(A/1960))-A,10<A){f.timeoutHandle=mg(mf.bind(null,f,xo,Ll),A);break}mf(f,xo,Ll);break;case 5:mf(f,xo,Ll);break;default:throw Error(s(329))}}}return oo(f,Mr()),f.callbackNode===T?hy.bind(null,f):null}function fy(f,g){var T=xg;return f.current.memoizedState.isDehydrated&&(Ld(f,g).flags|=256),f=Ml(f,g),f!==2&&(g=xo,xo=T,g!==null&&py(g)),f}function py(f){xo===null?xo=f:xo.push.apply(xo,f)}function my(f){for(var g=f;;){if(g.flags&16384){var T=g.updateQueue;if(T!==null&&(T=T.stores,T!==null))for(var A=0;A<T.length;A++){var x=T[A],W=x.getSnapshot;x=x.value;try{if(!Xc(W(),x))return!1}catch{return!1}}}if(T=g.child,g.subtreeFlags&16384&&T!==null)T.return=g,g=T;else{if(g===f)break;for(;g.sibling===null;){if(g.return===null||g.return===f)return!0;g=g.return}g.sibling.return=g.return,g=g.sibling}}return!0}function Uu(f,g){for(g&=~ay,g&=~oy,f.suspendedLanes|=g,f.pingedLanes&=~g,f=f.expirationTimes;0<g;){var T=31-Fs(g),A=1<<T;f[T]=-1,g&=~A}}function pf(f){if((yr&6)!==0)throw Error(s(327));Hp();var g=Tl(f,0);if((g&1)===0)return oo(f,Mr()),null;var T=Ml(f,g);if(f.tag!==0&&T===2){var A=vo(f);A!==0&&(g=A,T=fy(f,A))}if(T===1)throw T=Bs,Ld(f,0),Uu(f,g),oo(f,Mr()),T;if(T===6)throw Error(s(345));return f.finishedWork=f.current.alternate,f.finishedLanes=g,mf(f,xo,Ll),oo(f,Mr()),null}function Ug(f,g){var T=yr;yr|=1;try{return f(g)}finally{yr=T,yr===0&&(Gp=Mr()+500,PE&&Cd())}}function Vu(f){xl!==null&&xl.tag===0&&(yr&6)===0&&Hp();var g=yr;yr|=1;var T=hc.transition,A=er;try{if(hc.transition=null,er=1,f)return f()}finally{er=A,hc.transition=T,yr=g,(yr&6)===0&&Cd()}}function Vg(){Ma=Jc.current,Ei(Jc)}function Ld(f,g){f.finishedWork=null,f.finishedLanes=0;var T=f.timeoutHandle;if(T!==-1&&(f.timeoutHandle=-1,Fk(T)),Vi!==null)for(T=Vi.return;T!==null;){var A=T;switch(Eg(A),A.tag){case 1:A=A.type.childContextTypes,A!=null&&IE();break;case 3:cf(),Ei(ra),Ei(no),IT();break;case 5:Lp(A);break;case 4:cf();break;case 13:Ei(Si);break;case 19:Ei(Si);break;case 10:TT(A.type._context);break;case 22:case 23:Vg()}T=T.return}if(Ps=f,Vi=f=Fu(f.current,null),ss=Ma=g,os=0,Bs=null,ay=oy=hf=0,xo=xg=null,of!==null){for(g=0;g<of.length;g++)if(T=of[g],A=T.interleaved,A!==null){T.interleaved=null;var x=A.next,W=T.pending;if(W!==null){var ie=W.next;W.next=x,A.next=ie}T.pending=A}of=null}return f}function e0(f,g){do{var T=Vi;try{if(ST(),FE.current=GE,xp){for(var A=Ci.memoizedState;A!==null;){var x=A.queue;x!==null&&(x.pending=null),A=A.next}xp=!1}if(Nl=0,is=rs=Ci=null,Cg=!1,Ig=0,sy.current=null,T===null||T.return===null){os=1,Bs=g,Vi=null;break}e:{var W=f,ie=T.return,Se=T,Ie=g;if(g=ss,Se.flags|=32768,Ie!==null&&typeof Ie=="object"&&typeof Ie.then=="function"){var $e=Ie,St=Se,Tt=St.tag;if((St.mode&1)===0&&(Tt===0||Tt===11||Tt===15)){var vt=St.alternate;vt?(St.updateQueue=vt.updateQueue,St.memoizedState=vt.memoizedState,St.lanes=vt.lanes):(St.updateQueue=null,St.memoizedState=null)}var Ft=PC(ie);if(Ft!==null){Ft.flags&=-257,NC(Ft,ie,Se,W,g),Ft.mode&1&&OC(W,$e,g),g=Ft,Ie=$e;var Yt=g.updateQueue;if(Yt===null){var Xt=new Set;Xt.add(Ie),g.updateQueue=Xt}else Yt.add(Ie);break e}else{if((g&1)===0){OC(W,$e,g),t0();break e}Ie=Error(s(426))}}else if(ni&&Se.mode&1){var Fi=PC(ie);if(Fi!==null){(Fi.flags&65536)===0&&(Fi.flags|=256),NC(Fi,ie,Se,W,g),yT(Fp(Ie,Se));break e}}W=Ie=Fp(Ie,Se),os!==4&&(os=2),xg===null?xg=[W]:xg.push(W),W=ie;do{switch(W.tag){case 3:W.flags|=65536,g&=-g,W.lanes|=g;var Ge=BT(W,Ie,g);fC(W,Ge);break e;case 1:Se=Ie;var Pe=W.type,He=W.stateNode;if((W.flags&128)===0&&(typeof Pe.getDerivedStateFromError=="function"||He!==null&&typeof He.componentDidCatch=="function"&&(Dd===null||!Dd.has(He)))){W.flags|=65536,g&=-g,W.lanes|=g;var wt=Mu(W,Se,g);fC(W,wt);break e}}W=W.return}while(W!==null)}QC(T)}catch(Jt){g=Jt,Vi===T&&T!==null&&(Vi=T=T.return);continue}break}while(!0)}function XC(){var f=iy.current;return iy.current=GE,f===null?GE:f}function t0(){(os===0||os===3||os===2)&&(os=4),Ps===null||(hf&268435455)===0&&(oy&268435455)===0||Uu(Ps,ss)}function Ml(f,g){var T=yr;yr|=2;var A=XC();(Ps!==f||ss!==g)&&(Ll=null,Ld(f,g));do try{JC();break}catch(x){e0(f,x)}while(!0);if(ST(),yr=T,iy.current=A,Vi!==null)throw Error(s(261));return Ps=null,ss=0,os}function JC(){for(;Vi!==null;)gy(Vi)}function tD(){for(;Vi!==null&&!yo();)gy(Vi)}function gy(f){var g=yy(f.alternate,f,Ma);f.memoizedProps=f.pendingProps,g===null?QC(f):Vi=g,sy.current=null}function QC(f){var g=f;do{var T=g.alternate;if(f=g.return,(g.flags&32768)===0){if(T=ey(T,g,Ma),T!==null){Vi=T;return}}else{if(T=Zk(T,g),T!==null){T.flags&=32767,Vi=T;return}if(f!==null)f.flags|=32768,f.subtreeFlags=0,f.deletions=null;else{os=6,Vi=null;return}}if(g=g.sibling,g!==null){Vi=g;return}Vi=g=f}while(g!==null);os===0&&(os=5)}function mf(f,g,T){var A=er,x=hc.transition;try{hc.transition=null,er=1,nD(f,g,T,A)}finally{hc.transition=x,er=A}return null}function nD(f,g,T,A){do Hp();while(xl!==null);if((yr&6)!==0)throw Error(s(327));T=f.finishedWork;var x=f.finishedLanes;if(T===null)return null;if(f.finishedWork=null,f.finishedLanes=0,T===f.current)throw Error(s(177));f.callbackNode=null,f.callbackPriority=0;var W=T.lanes|T.childLanes;if(jr(f,W),f===Ps&&(Vi=Ps=null,ss=0),(T.subtreeFlags&2064)===0&&(T.flags&2064)===0||zp||(zp=!0,Fg(Zo,function(){return Hp(),null})),W=(T.flags&15990)!==0,(T.subtreeFlags&15990)!==0||W){W=hc.transition,hc.transition=null;var ie=er;er=1;var Se=yr;yr|=4,sy.current=null,KT(f,T),XT(T,f),cT(pg),_e=!!CE,pg=CE=null,f.current=T,Wp(T),gd(),yr=Se,er=ie,hc.transition=W}else f.current=T;if(zp&&(zp=!1,xl=f,uy=x),W=f.pendingLanes,W===0&&(Dd=null),dp(T.stateNode),oo(f,Mr()),g!==null)for(A=f.onRecoverableError,T=0;T<g.length;T++)x=g[T],A(x.value,{componentStack:x.stack,digest:x.digest});if(ly)throw ly=!1,f=QT,QT=null,f;return(uy&1)!==0&&f.tag!==0&&Hp(),W=f.pendingLanes,(W&1)!==0?f===ZT?ff++:(ff=0,ZT=f):ff=0,Cd(),null}function Hp(){if(xl!==null){var f=ec(uy),g=hc.transition,T=er;try{if(hc.transition=null,er=16>f?16:f,xl===null)var A=!1;else{if(f=xl,xl=null,uy=0,(yr&6)!==0)throw Error(s(331));var x=yr;for(yr|=4,Ht=f.current;Ht!==null;){var W=Ht,ie=W.child;if((Ht.flags&16)!==0){var Se=W.deletions;if(Se!==null){for(var Ie=0;Ie<Se.length;Ie++){var $e=Se[Ie];for(Ht=$e;Ht!==null;){var St=Ht;switch(St.tag){case 0:case 11:case 15:kg(8,St,W)}var Tt=St.child;if(Tt!==null)Tt.return=St,Ht=Tt;else for(;Ht!==null;){St=Ht;var vt=St.sibling,Ft=St.return;if(HC(St),St===$e){Ht=null;break}if(vt!==null){vt.return=Ft,Ht=vt;break}Ht=Ft}}}var Yt=W.alternate;if(Yt!==null){var Xt=Yt.child;if(Xt!==null){Yt.child=null;do{var Fi=Xt.sibling;Xt.sibling=null,Xt=Fi}while(Xt!==null)}}Ht=W}}if((W.subtreeFlags&2064)!==0&&ie!==null)ie.return=W,Ht=ie;else e:for(;Ht!==null;){if(W=Ht,(W.flags&2048)!==0)switch(W.tag){case 0:case 11:case 15:kg(9,W,W.return)}var Ge=W.sibling;if(Ge!==null){Ge.return=W.return,Ht=Ge;break e}Ht=W.return}}var Pe=f.current;for(Ht=Pe;Ht!==null;){ie=Ht;var He=ie.child;if((ie.subtreeFlags&2064)!==0&&He!==null)He.return=ie,Ht=He;else e:for(ie=Pe;Ht!==null;){if(Se=Ht,(Se.flags&2048)!==0)try{switch(Se.tag){case 0:case 11:case 15:Dg(9,Se)}}catch(Jt){Ii(Se,Se.return,Jt)}if(Se===ie){Ht=null;break e}var wt=Se.sibling;if(wt!==null){wt.return=Se.return,Ht=wt;break e}Ht=Se.return}}if(yr=x,Cd(),to&&typeof to.onPostCommitFiberRoot=="function")try{to.onPostCommitFiberRoot(vl,f)}catch{}A=!0}return A}finally{er=T,hc.transition=g}}return!1}function _y(f,g,T){g=Fp(T,g),g=BT(f,g,1),f=Od(f,g,1),g=Ws(),f!==null&&(bl(f,1,g),oo(f,g))}function Ii(f,g,T){if(f.tag===3)_y(f,f,T);else for(;g!==null;){if(g.tag===3){_y(g,f,T);break}else if(g.tag===1){var A=g.stateNode;if(typeof g.type.getDerivedStateFromError=="function"||typeof A.componentDidCatch=="function"&&(Dd===null||!Dd.has(A))){f=Fp(T,f),f=Mu(g,f,1),g=Od(g,f,1),f=Ws(),g!==null&&(bl(g,1,f),oo(g,f));break}}g=g.return}}function ZC(f,g,T){var A=f.pingCache;A!==null&&A.delete(g),g=Ws(),f.pingedLanes|=f.suspendedLanes&T,Ps===f&&(ss&T)===T&&(os===4||os===3&&(ss&130023424)===ss&&500>Mr()-cy?Ld(f,0):ay|=T),oo(f,g)}function n0(f,g){g===0&&((f.mode&1)===0?g=1:(g=ar,ar<<=1,(ar&130023424)===0&&(ar=4194304)));var T=Ws();f=Du(f,g),f!==null&&(bl(f,g,T),oo(f,T))}function Ey(f){var g=f.memoizedState,T=0;g!==null&&(T=g.retryLane),n0(f,T)}function eI(f,g){var T=0;switch(f.tag){case 13:var A=f.stateNode,x=f.memoizedState;x!==null&&(T=x.retryLane);break;case 19:A=f.stateNode;break;default:throw Error(s(314))}A!==null&&A.delete(g),n0(f,T)}var yy;yy=function(f,g,T){if(f!==null)if(f.memoizedProps!==g.pendingProps||ra.current)ca=!0;else{if((f.lanes&T)===0&&(g.flags&128)===0)return ca=!1,jC(f,g,T);ca=(f.flags&131072)!==0}else ca=!1,ni&&(g.flags&1048576)!==0&&kE(g,NE,g.index);switch(g.lanes=0,g.tag){case 2:var A=g.type;QE(f,g),f=g.pendingProps;var x=rf(g,no.current);ku(g,T),x=Mp(null,g,A,f,x,T);var W=PT();return g.flags|=1,typeof x=="object"&&x!==null&&typeof x.render=="function"&&x.$$typeof===void 0?(g.tag=1,g.memoizedState=null,g.updateQueue=null,ia(A)?(W=!0,OE(g)):W=!1,g.memoizedState=x.state!==null&&x.state!==void 0?x.state:null,Tg(g),x.updater=HE,g.stateNode=x,x._reactInternals=g,VT(g,A,f,T),g=qE(null,g,A,!0,W,T)):(g.tag=0,ni&&W&&DE(g),Do(null,g,x,T),g=g.child),g;case 16:A=g.elementType;e:{switch(QE(f,g),f=g.pendingProps,x=A._init,A=x(A._payload),g.type=A,x=g.tag=gf(A),f=xa(A,f),x){case 0:g=WT(null,g,A,f,T);break e;case 1:g=MC(null,g,A,f,T);break e;case 11:g=KE(null,g,A,f,T);break e;case 14:g=kC(null,g,A,xa(A.type,f),T);break e}throw Error(s(306,A,""))}return g;case 0:return A=g.type,x=g.pendingProps,x=g.elementType===A?x:xa(A,x),WT(f,g,A,x,T);case 1:return A=g.type,x=g.pendingProps,x=g.elementType===A?x:xa(A,x),MC(f,g,A,x,T);case 3:e:{if(GT(g),f===null)throw Error(s(387));A=g.pendingProps,W=g.memoizedState,x=W.element,hC(f,g),VE(g,A,null,T);var ie=g.memoizedState;if(A=ie.element,W.isDehydrated)if(W={element:A,isDehydrated:!1,cache:ie.cache,pendingSuspenseBoundaries:ie.pendingSuspenseBoundaries,transitions:ie.transitions},g.updateQueue.baseState=W,g.memoizedState=W,g.flags&256){x=Fp(Error(s(423)),g),g=UC(f,g,A,T,x);break e}else if(A!==x){x=Fp(Error(s(424)),g),g=UC(f,g,A,T,x);break e}else for(oa=bd(g.stateNode.containerInfo.firstChild),sa=g,ni=!0,No=null,T=uC(g,null,A,T),g.child=T;T;)T.flags=T.flags&-3|4096,T=T.sibling;else{if(Pp(),A===x){g=kl(f,g,T);break e}Do(f,g,A,T)}g=g.child}return g;case 5:return mC(g),f===null&&ET(g),A=g.type,x=g.pendingProps,W=f!==null?f.memoizedProps:null,ie=x.children,pT(A,x)?ie=null:W!==null&&pT(A,W)&&(g.flags|=32),xC(f,g),Do(f,g,ie,T),g.child;case 6:return f===null&&ET(g),null;case 13:return $E(f,g,T);case 4:return RT(g,g.stateNode.containerInfo),A=g.pendingProps,f===null?g.child=Np(g,null,A,T):Do(f,g,A,T),g.child;case 11:return A=g.type,x=g.pendingProps,x=g.elementType===A?x:xa(A,x),KE(f,g,A,x,T);case 7:return Do(f,g,g.pendingProps,T),g.child;case 8:return Do(f,g,g.pendingProps.children,T),g.child;case 12:return Do(f,g,g.pendingProps.children,T),g.child;case 10:e:{if(A=g.type._context,x=g.pendingProps,W=g.memoizedProps,ie=x.value,hi(ME,A._currentValue),A._currentValue=ie,W!==null)if(Xc(W.value,ie)){if(W.children===x.children&&!ra.current){g=kl(f,g,T);break e}}else for(W=g.child,W!==null&&(W.return=g);W!==null;){var Se=W.dependencies;if(Se!==null){ie=W.child;for(var Ie=Se.firstContext;Ie!==null;){if(Ie.context===A){if(W.tag===1){Ie=Ol(-1,T&-T),Ie.tag=2;var $e=W.updateQueue;if($e!==null){$e=$e.shared;var St=$e.pending;St===null?Ie.next=Ie:(Ie.next=St.next,St.next=Ie),$e.pending=Ie}}W.lanes|=T,Ie=W.alternate,Ie!==null&&(Ie.lanes|=T),bT(W.return,T,g),Se.lanes|=T;break}Ie=Ie.next}}else if(W.tag===10)ie=W.type===g.type?null:W.child;else if(W.tag===18){if(ie=W.return,ie===null)throw Error(s(341));ie.lanes|=T,Se=ie.alternate,Se!==null&&(Se.lanes|=T),bT(ie,T,g),ie=W.sibling}else ie=W.child;if(ie!==null)ie.return=W;else for(ie=W;ie!==null;){if(ie===g){ie=null;break}if(W=ie.sibling,W!==null){W.return=ie.return,ie=W;break}ie=ie.return}W=ie}Do(f,g,x.children,T),g=g.child}return g;case 9:return x=g.type,A=g.pendingProps.children,ku(g,T),x=lc(x),A=A(x),g.flags|=1,Do(f,g,A,T),g.child;case 14:return A=g.type,x=xa(A,g.pendingProps),x=xa(A.type,x),kC(f,g,A,x,T);case 15:return DC(f,g,g.type,g.pendingProps,T);case 17:return A=g.type,x=g.pendingProps,x=g.elementType===A?x:xa(A,x),QE(f,g),g.tag=1,ia(A)?(f=!0,OE(g)):f=!1,ku(g,T),IC(g,A,x),VT(g,A,x,T),qE(null,g,A,!0,f,T);case 19:return JE(f,g,T);case 22:return LC(f,g,T)}throw Error(s(156,g.tag))};function Fg(f,g){return md(f,g)}function vy(f,g,T,A){this.tag=f,this.key=T,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=g,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=A,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ua(f,g,T,A){return new vy(f,g,T,A)}function xd(f){return f=f.prototype,!(!f||!f.isReactComponent)}function gf(f){if(typeof f=="function")return xd(f)?1:0;if(f!=null){if(f=f.$$typeof,f===fe)return 11;if(f===pt)return 14}return 2}function Fu(f,g){var T=f.alternate;return T===null?(T=Ua(f.tag,g,f.key,f.mode),T.elementType=f.elementType,T.type=f.type,T.stateNode=f.stateNode,T.alternate=f,f.alternate=T):(T.pendingProps=g,T.type=f.type,T.flags=0,T.subtreeFlags=0,T.deletions=null),T.flags=f.flags&14680064,T.childLanes=f.childLanes,T.lanes=f.lanes,T.child=f.child,T.memoizedProps=f.memoizedProps,T.memoizedState=f.memoizedState,T.updateQueue=f.updateQueue,g=f.dependencies,T.dependencies=g===null?null:{lanes:g.lanes,firstContext:g.firstContext},T.sibling=f.sibling,T.index=f.index,T.ref=f.ref,T}function Sy(f,g,T,A,x,W){var ie=2;if(A=f,typeof f=="function")xd(f)&&(ie=1);else if(typeof f=="string")ie=5;else e:switch(f){case Q:return _f(T.children,x,W,g);case ne:ie=8,x|=8;break;case oe:return f=Ua(12,T,g,x|2),f.elementType=oe,f.lanes=W,f;case le:return f=Ua(13,T,g,x),f.elementType=le,f.lanes=W,f;case Le:return f=Ua(19,T,g,x),f.elementType=Le,f.lanes=W,f;case Oe:return Md(T,x,W,g);default:if(typeof f=="object"&&f!==null)switch(f.$$typeof){case ue:ie=10;break e;case Ee:ie=9;break e;case fe:ie=11;break e;case pt:ie=14;break e;case et:ie=16,A=null;break e}throw Error(s(130,f==null?f:typeof f,""))}return g=Ua(ie,T,g,x),g.elementType=f,g.type=A,g.lanes=W,g}function _f(f,g,T,A){return f=Ua(7,f,A,g),f.lanes=T,f}function Md(f,g,T,A){return f=Ua(22,f,A,g),f.elementType=Oe,f.lanes=T,f.stateNode={isHidden:!1},f}function r0(f,g,T){return f=Ua(6,f,null,g),f.lanes=T,f}function i0(f,g,T){return g=Ua(4,f.children!==null?f.children:[],f.key,g),g.lanes=T,g.stateNode={containerInfo:f.containerInfo,pendingChildren:null,implementation:f.implementation},g}function rD(f,g,T,A,x){this.tag=g,this.containerInfo=f,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Kc(0),this.expirationTimes=Kc(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Kc(0),this.identifierPrefix=A,this.onRecoverableError=x,this.mutableSourceEagerHydrationData=null}function s0(f,g,T,A,x,W,ie,Se,Ie){return f=new rD(f,g,T,Se,Ie),g===1?(g=1,W===!0&&(g|=8)):g=0,W=Ua(3,null,null,g),f.current=W,W.stateNode=f,W.memoizedState={element:A,isDehydrated:T,cache:null,transitions:null,pendingSuspenseBoundaries:null},Tg(W),f}function iD(f,g,T){var A=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:ye,key:A==null?null:""+A,children:f,containerInfo:g,implementation:T}}function tI(f){if(!f)return Rd;f=f._reactInternals;e:{if(As(f)!==f||f.tag!==1)throw Error(s(170));var g=f;do{switch(g.tag){case 3:g=g.stateNode.context;break e;case 1:if(ia(g.type)){g=g.stateNode.__reactInternalMemoizedMergedChildContext;break e}}g=g.return}while(g!==null);throw Error(s(171))}if(f.tag===1){var T=f.type;if(ia(T))return AE(f,T,g)}return g}function Ty(f,g,T,A,x,W,ie,Se,Ie){return f=s0(T,A,!0,f,x,W,ie,Se,Ie),f.context=tI(null),T=f.current,A=Ws(),x=fc(T),W=Ol(A,x),W.callback=g??null,Od(T,W,x),f.current.lanes=x,bl(f,x,A),oo(f,A),f}function jg(f,g,T,A){var x=g.current,W=Ws(),ie=fc(x);return T=tI(T),g.context===null?g.context=T:g.pendingContext=T,g=Ol(W,ie),g.payload={element:f},A=A===void 0?null:A,A!==null&&(g.callback=A),f=Od(x,g,ie),f!==null&&(pc(f,x,ie,W),bg(f,x,ie)),ie}function by(f){if(f=f.current,!f.child)return null;switch(f.child.tag){case 5:return f.child.stateNode;default:return f.child.stateNode}}function o0(f,g){if(f=f.memoizedState,f!==null&&f.dehydrated!==null){var T=f.retryLane;f.retryLane=T!==0&&T<g?T:g}}function a0(f,g){o0(f,g),(f=f.alternate)&&o0(f,g)}function Bg(){return null}var Qc=typeof reportError=="function"?reportError:function(f){console.error(f)};function wy(f){this._internalRoot=f}Ry.prototype.render=wy.prototype.render=function(f){var g=this._internalRoot;if(g===null)throw Error(s(409));jg(f,g,null,null)},Ry.prototype.unmount=wy.prototype.unmount=function(){var f=this._internalRoot;if(f!==null){this._internalRoot=null;var g=f.containerInfo;Vu(function(){jg(null,f,null,null)}),g[sc]=null}};function Ry(f){this._internalRoot=f}Ry.prototype.unstable_scheduleHydration=function(f){if(f){var g=zh();f={blockedOn:null,target:f,priority:g};for(var T=0;T<Ro.length&&g!==0&&g<Ro[T].priority;T++);Ro.splice(T,0,f),T===0&&Kh(f)}};function c0(f){return!(!f||f.nodeType!==1&&f.nodeType!==9&&f.nodeType!==11)}function Kp(f){return!(!f||f.nodeType!==1&&f.nodeType!==9&&f.nodeType!==11&&(f.nodeType!==8||f.nodeValue!==" react-mount-point-unstable "))}function l0(){}function sD(f,g,T,A,x){if(x){if(typeof A=="function"){var W=A;A=function(){var $e=by(ie);W.call($e)}}var ie=Ty(g,A,f,0,null,!1,!1,"",l0);return f._reactRootContainer=ie,f[sc]=ie.current,Qh(f.nodeType===8?f.parentNode:f),Vu(),ie}for(;x=f.lastChild;)f.removeChild(x);if(typeof A=="function"){var Se=A;A=function(){var $e=by(Ie);Se.call($e)}}var Ie=s0(f,0,!1,null,null,!1,!1,"",l0);return f._reactRootContainer=Ie,f[sc]=Ie.current,Qh(f.nodeType===8?f.parentNode:f),Vu(function(){jg(g,Ie,T,A)}),Ie}function Ef(f,g,T,A,x){var W=T._reactRootContainer;if(W){var ie=W;if(typeof x=="function"){var Se=x;x=function(){var Ie=by(ie);Se.call(Ie)}}jg(g,ie,f,x)}else ie=sD(T,g,f,x,A);return by(ie)}hp=function(f){switch(f.tag){case 3:var g=f.stateNode;if(g.current.memoizedState.isDehydrated){var T=Sl(g.pendingLanes);T!==0&&(Pa(g,T|1),oo(g,Mr()),(yr&6)===0&&(Gp=Mr()+500,Cd()))}break;case 13:Vu(function(){var A=Du(f,1);if(A!==null){var x=Ws();pc(A,f,1,x)}}),a0(f,1)}},wl=function(f){if(f.tag===13){var g=Du(f,134217728);if(g!==null){var T=Ws();pc(g,f,134217728,T)}a0(f,134217728)}},vd=function(f){if(f.tag===13){var g=fc(f),T=Du(f,g);if(T!==null){var A=Ws();pc(T,f,g,A)}a0(f,g)}},zh=function(){return er},fp=function(f,g){var T=er;try{return er=f,g()}finally{er=T}},yl=function(f,g,T){switch(g){case"input":if(zt(f,T),g=T.name,T.type==="radio"&&g!=null){for(T=f;T.parentNode;)T=T.parentNode;for(T=T.querySelectorAll("input[name="+JSON.stringify(""+g)+'][type="radio"]'),g=0;g<T.length;g++){var A=T[g];if(A!==f&&A.form===f.form){var x=Ip(A);if(!x)throw Error(s(90));hn(A),zt(A,x)}}}break;case"textarea":Vt(f,T);break;case"select":g=T.value,g!=null&&dt(f,!!T.multiple,g,!1)}},mu=Ug,Ja=Vu;var Ud={usingClientEntryPoint:!1,Events:[Cp,tf,Ip,Xa,Wc,Ug]},ju={findFiberByHostInstance:ef,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},oD={bundleType:ju.bundleType,version:ju.version,rendererPackageName:ju.rendererPackageName,rendererConfig:ju.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:de.ReactCurrentDispatcher,findHostInstanceByFiber:function(f){return f=pd(f),f===null?null:f.stateNode},findFiberByHostInstance:ju.findFiberByHostInstance||Bg,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Cy=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Cy.isDisabled&&Cy.supportsFiber)try{vl=Cy.inject(oD),to=Cy}catch{}}return Ac.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Ud,Ac.createPortal=function(f,g){var T=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!c0(g))throw Error(s(200));return iD(f,g,null,T)},Ac.createRoot=function(f,g){if(!c0(f))throw Error(s(299));var T=!1,A="",x=Qc;return g!=null&&(g.unstable_strictMode===!0&&(T=!0),g.identifierPrefix!==void 0&&(A=g.identifierPrefix),g.onRecoverableError!==void 0&&(x=g.onRecoverableError)),g=s0(f,1,!1,null,null,T,!1,A,x),f[sc]=g.current,Qh(f.nodeType===8?f.parentNode:f),new wy(g)},Ac.findDOMNode=function(f){if(f==null)return null;if(f.nodeType===1)return f;var g=f._reactInternals;if(g===void 0)throw typeof f.render=="function"?Error(s(188)):(f=Object.keys(f).join(","),Error(s(268,f)));return f=pd(g),f=f===null?null:f.stateNode,f},Ac.flushSync=function(f){return Vu(f)},Ac.hydrate=function(f,g,T){if(!Kp(g))throw Error(s(200));return Ef(null,f,g,!0,T)},Ac.hydrateRoot=function(f,g,T){if(!c0(f))throw Error(s(405));var A=T!=null&&T.hydratedSources||null,x=!1,W="",ie=Qc;if(T!=null&&(T.unstable_strictMode===!0&&(x=!0),T.identifierPrefix!==void 0&&(W=T.identifierPrefix),T.onRecoverableError!==void 0&&(ie=T.onRecoverableError)),g=Ty(g,null,f,1,T??null,x,!1,W,ie),f[sc]=g.current,Qh(f),A)for(f=0;f<A.length;f++)T=A[f],x=T._getVersion,x=x(T._source),g.mutableSourceEagerHydrationData==null?g.mutableSourceEagerHydrationData=[T,x]:g.mutableSourceEagerHydrationData.push(T,x);return new Ry(g)},Ac.render=function(f,g,T){if(!Kp(g))throw Error(s(200));return Ef(null,f,g,!1,T)},Ac.unmountComponentAtNode=function(f){if(!Kp(f))throw Error(s(40));return f._reactRootContainer?(Vu(function(){Ef(null,null,f,!1,function(){f._reactRootContainer=null,f[sc]=null})}),!0):!1},Ac.unstable_batchedUpdates=Ug,Ac.unstable_renderSubtreeIntoContainer=function(f,g,T,A){if(!Kp(T))throw Error(s(200));if(f==null||f._reactInternals===void 0)throw Error(s(38));return Ef(f,g,T,!1,A)},Ac.version="18.3.1-next-f1338f8080-20240426",Ac}var WK;function aJ(){if(WK)return Zx.exports;WK=1;function r(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r)}catch(t){console.error(t)}}return r(),Zx.exports=xge(),Zx.exports}var GK;function Mge(){if(GK)return vO;GK=1;var r=aJ();return vO.createRoot=r.createRoot,vO.hydrateRoot=r.hydrateRoot,vO}var Uge=Mge();const EN=BS(Uge);function Vge(r,t,s,a){return r.addEventListener(t,s,a),()=>{r.removeEventListener(t,s,a)}}function yN(r){return r!=null&&typeof r=="object"&&"nodeType"in r&&r.nodeType===Node.ELEMENT_NODE}function Fge(){return!!(globalThis!=null&&globalThis.document)}function cJ(r){return r.parentElement&&cJ(r.parentElement)?!0:r.hidden}function jge(r){const t=r.getAttribute("contenteditable");return t!=="false"&&t!=null}function Bge(r){return!!r.getAttribute("disabled")||!!r.getAttribute("aria-disabled")}function Wge(r){var t;return((t=lJ(r))==null?void 0:t.defaultView)??window}function lJ(r){return yN(r)?r.ownerDocument:document}function Gge(r){return r.view??window}function zge(r){return lJ(r).activeElement}function Hge(r){const t=Gge(r);return typeof t.PointerEvent<"u"&&r instanceof t.PointerEvent?r.pointerType==="mouse":r instanceof t.MouseEvent}function uJ(r){return!!r.touches}function Kge(r){return uJ(r)&&r.touches.length>1}function qge(r,t="page"){const s=r.touches[0]||r.changedTouches[0];return{x:s[`${t}X`],y:s[`${t}Y`]}}function $ge(r,t="page"){return{x:r[`${t}X`],y:r[`${t}Y`]}}function dJ(r,t="page"){return uJ(r)?qge(r,t):$ge(r,t)}function Yge(r){return t=>{const s=Hge(t);(!s||s&&t.button===0)&&r(t)}}function Xge(r,t=!1){function s(l){r(l,{point:dJ(l)})}return t?Yge(s):s}function ZO(r,t,s,a){return Vge(r,t,Xge(s,t==="pointerdown"),a)}function Jge(r,...t){if(r==null)throw new TypeError("Cannot convert undefined or null to object");const s={...r};for(const a of t)if(a!=null)for(const l in a)Object.prototype.hasOwnProperty.call(a,l)&&(l in s&&delete s[l],s[l]=a[l]);return s}const zn=r=>r?"":void 0,nS=r=>r?!0:void 0;function Qge(r){return Array.isArray(r)}function au(r){const t=typeof r;return r!=null&&(t==="object"||t==="function")&&!Qge(r)}function Zge(r){const t=r==null?0:r.length;return t?r[t-1]:void 0}function e_e(r){const t=parseFloat(r.toString()),s=r.toString().replace(String(t),"");return{unitless:!s,value:t,unit:s}}function S2(r){if(r==null)return r;const{unitless:t}=e_e(r);return t||typeof r=="number"?`${r}px`:r}const hJ=(r,t)=>parseInt(r[1],10)>parseInt(t[1],10)?1:-1,ZU=r=>Object.fromEntries(Object.entries(r).sort(hJ));function zK(r){const t=ZU(r);return Object.assign(Object.values(t),t)}function t_e(r){const t=Object.keys(ZU(r));return new Set(t)}function HK(r){if(!r)return r;r=S2(r)??r;const t=-.02;return typeof r=="number"?`${r+t}`:r.replace(/(\d+\.?\d*)/u,s=>`${parseFloat(s)+t}`)}function Gb(r,t){const s=["@media screen"];return r&&s.push("and",`(min-width: ${S2(r)})`),t&&s.push("and",`(max-width: ${S2(t)})`),s.join(" ")}function n_e(r){if(!r)return null;r.base=r.base??"0px";const t=zK(r),s=Object.entries(r).sort(hJ).map(([d,p],E,v)=>{let[,b]=v[E+1]??[];return b=parseFloat(b)>0?HK(b):void 0,{_minW:HK(p),breakpoint:d,minW:p,maxW:b,maxWQuery:Gb(null,b),minWQuery:Gb(p),minMaxQuery:Gb(p,b)}}),a=t_e(r),l=Array.from(a.values());return{keys:a,normalized:t,isResponsive(d){const p=Object.keys(d);return p.length>0&&p.every(E=>a.has(E))},asObject:ZU(r),asArray:zK(r),details:s,get(d){return s.find(p=>p.breakpoint===d)},media:[null,...t.map(d=>Gb(d)).slice(1)],toArrayValue(d){if(!au(d))throw new Error("toArrayValue: value must be an object");const p=l.map(E=>d[E]??null);for(;Zge(p)===null;)p.pop();return p},toObjectValue(d){if(!Array.isArray(d))throw new Error("toObjectValue: value must be an array");return d.reduce((p,E,v)=>{const b=l[v];return b!=null&&E!=null&&(p[b]=E),p},{})}}}function fJ(...r){return function(...s){r.forEach(a=>a==null?void 0:a(...s))}}function Yn(...r){return function(s){r.some(a=>(a==null||a(s),s==null?void 0:s.defaultPrevented))}}function eV(r){return V.Children.toArray(r).filter(t=>V.isValidElement(t))}function vN(r){const t=Object.assign({},r);for(let s in t)t[s]===void 0&&delete t[s];return t}function r_e(r,t){return`${r} returned \`undefined\`. Seems you forgot to wrap component within ${t}`}function Mi(r={}){const{name:t,strict:s=!0,hookName:a="useContext",providerName:l="Provider",errorMessage:d,defaultValue:p}=r,E=V.createContext(p);E.displayName=t;function v(){var R;const b=V.useContext(E);if(!b&&s){const O=new Error(d??r_e(a,l));throw O.name="ContextError",(R=Error.captureStackTrace)==null||R.call(Error,O,v),O}return b}return[E.Provider,v,E]}const dn=(...r)=>r.filter(Boolean).join(" "),pJ=r=>r.hasAttribute("tabindex"),i_e=r=>pJ(r)&&r.tabIndex===-1;function LP(r){if(!yN(r)||cJ(r)||Bge(r))return!1;const{localName:t}=r;if(["input","select","textarea","button"].indexOf(t)>=0)return!0;const a={a:()=>r.hasAttribute("href"),audio:()=>r.hasAttribute("controls"),video:()=>r.hasAttribute("controls")};return t in a?a[t]():jge(r)?!0:pJ(r)}function s_e(r){return r?yN(r)&&LP(r)&&!i_e(r):!1}const o_e=["input:not(:disabled):not([disabled])","select:not(:disabled):not([disabled])","textarea:not(:disabled):not([disabled])","embed","iframe","object","a[href]","area[href]","button:not(:disabled):not([disabled])","[tabindex]","audio[controls]","video[controls]","*[tabindex]:not([aria-disabled])","*[contenteditable]"],a_e=o_e.join(),c_e=r=>r.offsetWidth>0&&r.offsetHeight>0;function mJ(r){const t=Array.from(r.querySelectorAll(a_e));return t.unshift(r),t.filter(s=>LP(s)&&c_e(s))}function l_e(r,t,s,a){const l=typeof t=="string"?t.split("."):[t];for(a=0;a<l.length&&r;a+=1)r=r[l[a]];return r===void 0?s:r}const u_e=r=>{const t=new WeakMap;return(a,l,d,p)=>{if(typeof a>"u")return r(a,l,d);t.has(a)||t.set(a,new Map);const E=t.get(a);if(E.has(l))return E.get(l);const v=r(a,l,d,p);return E.set(l,v),v}},gJ=u_e(l_e),d_e=r=>r.default||r;function tV(r){const{wasSelected:t,enabled:s,isSelected:a,mode:l="unmount"}=r;return!!(!s||a||l==="keepMounted"&&t)}function h_e(r){const t=parseFloat(r);return typeof t!="number"||Number.isNaN(t)?0:t}function f_e(r,t){let s=h_e(r);const a=10**(t??10);return s=Math.round(s*a)/a,t?s.toFixed(t):s.toString()}function p_e(r){if(!Number.isFinite(r))return 0;let t=1,s=0;for(;Math.round(r*t)/t!==r;)t*=10,s+=1;return s}function KK(r,t,s){return(r-t)*100/(s-t)}function m_e(r,t,s){return(s-t)*r+t}function qK(r,t,s){const a=Math.round((r-t)/s)*s+t,l=p_e(s);return f_e(a,l)}function nM(r,t,s){return r==null?r:(s<t&&console.warn("clamp: max cannot be less than min"),Math.min(Math.max(r,t),s))}function sR(r,t=[]){const s=Object.assign({},r);for(const a of t)a in s&&delete s[a];return s}function _J(r,t){const s={};for(const a of t)a in r&&(s[a]=r[a]);return s}function SN(r,t){return Array.isArray(r)?r.map(s=>s===null?null:t(s)):au(r)?Object.keys(r).reduce((s,a)=>(s[a]=t(r[a]),s),{}):r!=null?t(r):null}const g_e=r=>typeof r=="function";function xc(r,...t){return g_e(r)?r(...t):r}function __e(r){const t=r.ownerDocument.defaultView||window,{overflow:s,overflowX:a,overflowY:l}=t.getComputedStyle(r);return/auto|scroll|overlay|hidden/.test(s+l+a)}function E_e(r){return r.localName==="html"?r:r.assignedSlot||r.parentElement||r.ownerDocument.documentElement}function EJ(r){return["html","body","#document"].includes(r.localName)?r.ownerDocument.body:yN(r)&&__e(r)?r:EJ(E_e(r))}function y_e(r,t){const s={},a={};for(const[l,d]of Object.entries(r))t.includes(l)?s[l]=d:a[l]=d;return[s,a]}function v_e(r,...t){const s=Object.getOwnPropertyDescriptors(r),a=Object.keys(s),l=p=>{const E={};for(let v=0;v<p.length;v++){const b=p[v];s[b]&&(Object.defineProperty(E,b,s[b]),delete s[b])}return E},d=p=>l(Array.isArray(p)?p:a.filter(p));return t.map(d).concat(l(a))}function $K(r,t,s={}){const{stop:a,getKey:l}=s;function d(p,E=[]){if(au(p)||Array.isArray(p)){const v={};for(const[b,R]of Object.entries(p)){const O=(l==null?void 0:l(b))??b,N=[...E,O];if(a!=null&&a(p,N))return t(p,E);v[O]=d(R,N)}return v}return t(p,E)}return d(r)}var zb={exports:{}};zb.exports;var YK;function S_e(){return YK||(YK=1,function(r,t){var s=200,a="__lodash_hash_undefined__",l=800,d=16,p=9007199254740991,E="[object Arguments]",v="[object Array]",b="[object AsyncFunction]",R="[object Boolean]",O="[object Date]",N="[object Error]",F="[object Function]",H="[object GeneratorFunction]",z="[object Map]",G="[object Number]",ee="[object Null]",J="[object Object]",re="[object Proxy]",de="[object RegExp]",se="[object Set]",ye="[object String]",Q="[object Undefined]",ne="[object WeakMap]",oe="[object ArrayBuffer]",ue="[object DataView]",Ee="[object Float32Array]",fe="[object Float64Array]",le="[object Int8Array]",Le="[object Int16Array]",pt="[object Int32Array]",et="[object Uint8Array]",Oe="[object Uint8ClampedArray]",Ue="[object Uint16Array]",Me="[object Uint32Array]",it=/[\\^$.*+?()[\]{}|]/g,Ae=/^\[object .+?Constructor\]$/,qe=/^(?:0|[1-9]\d*)$/,Ze={};Ze[Ee]=Ze[fe]=Ze[le]=Ze[Le]=Ze[pt]=Ze[et]=Ze[Oe]=Ze[Ue]=Ze[Me]=!0,Ze[E]=Ze[v]=Ze[oe]=Ze[R]=Ze[ue]=Ze[O]=Ze[N]=Ze[F]=Ze[z]=Ze[G]=Ze[J]=Ze[de]=Ze[se]=Ze[ye]=Ze[ne]=!1;var Fe=typeof D_=="object"&&D_&&D_.Object===Object&&D_,lt=typeof self=="object"&&self&&self.Object===Object&&self,Et=Fe||lt||Function("return this")(),Nt=t&&!t.nodeType&&t,$t=Nt&&!0&&r&&!r.nodeType&&r,xt=$t&&$t.exports===Nt,En=xt&&Fe.process,In=function(){try{var _e=$t&&$t.require&&$t.require("util").types;return _e||En&&En.binding&&En.binding("util")}catch{}}(),hn=In&&In.isTypedArray;function Kn(_e,Re,Ke){switch(Ke.length){case 0:return _e.call(Re);case 1:return _e.call(Re,Ke[0]);case 2:return _e.call(Re,Ke[0],Ke[1]);case 3:return _e.call(Re,Ke[0],Ke[1],Ke[2])}return _e.apply(Re,Ke)}function Ar(_e,Re){for(var Ke=-1,Bt=Array(_e);++Ke<_e;)Bt[Ke]=Re(Ke);return Bt}function Zt(_e){return function(Re){return _e(Re)}}function Zn(_e,Re){return _e==null?void 0:_e[Re]}function zt(_e,Re){return function(Ke){return _e(Re(Ke))}}var ve=Array.prototype,Ne=Function.prototype,We=Object.prototype,dt=Et["__core-js_shared__"],mt=Ne.toString,gt=We.hasOwnProperty,Vt=function(){var _e=/[^.]+$/.exec(dt&&dt.keys&&dt.keys.IE_PROTO||"");return _e?"Symbol(src)_1."+_e:""}(),_n=We.toString,kn=mt.call(Object),rn=RegExp("^"+mt.call(gt).replace(it,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),ur=xt?Et.Buffer:void 0,$a=Et.Symbol,kt=Et.Uint8Array;ur&&ur.allocUnsafe;var tn=zt(Object.getPrototypeOf,Object),Hi=Object.create,Cs=We.propertyIsEnumerable,Vs=ve.splice,li=$a?$a.toStringTag:void 0,Ca=function(){try{var _e=Oa(Object,"defineProperty");return _e({},"",{}),_e}catch{}}(),Bc=ur?ur.isBuffer:void 0,Zs=Math.max,eo=Date.now,yl=Oa(Et,"Map"),Is=Oa(Object,"create"),Ya=function(){function _e(){}return function(Re){if(!tc(Re))return{};if(Hi)return Hi(Re);_e.prototype=Re;var Ke=new _e;return _e.prototype=void 0,Ke}}();function Yo(_e){var Re=-1,Ke=_e==null?0:_e.length;for(this.clear();++Re<Ke;){var Bt=_e[Re];this.set(Bt[0],Bt[1])}}function Xa(){this.__data__=Is?Is(null):{},this.size=0}function Wc(_e){var Re=this.has(_e)&&delete this.__data__[_e];return this.size-=Re?1:0,Re}function mu(_e){var Re=this.__data__;if(Is){var Ke=Re[_e];return Ke===a?void 0:Ke}return gt.call(Re,_e)?Re[_e]:void 0}function Ja(_e){var Re=this.__data__;return Is?Re[_e]!==void 0:gt.call(Re,_e)}function Gc(_e,Re){var Ke=this.__data__;return this.size+=this.has(_e)?0:1,Ke[_e]=Is&&Re===void 0?a:Re,this}Yo.prototype.clear=Xa,Yo.prototype.delete=Wc,Yo.prototype.get=mu,Yo.prototype.has=Ja,Yo.prototype.set=Gc;function Eo(_e){var Re=-1,Ke=_e==null?0:_e.length;for(this.clear();++Re<Ke;){var Bt=_e[Re];this.set(Bt[0],Bt[1])}}function Ri(){this.__data__=[],this.size=0}function es(_e){var Re=this.__data__,Ke=gd(Re,_e);if(Ke<0)return!1;var Bt=Re.length-1;return Ke==Bt?Re.pop():Vs.call(Re,Ke,1),--this.size,!0}function Ia(_e){var Re=this.__data__,Ke=gd(Re,_e);return Ke<0?void 0:Re[Ke][1]}function gu(_e){return gd(this.__data__,_e)>-1}function Qa(_e,Re){var Ke=this.__data__,Bt=gd(Ke,_e);return Bt<0?(++this.size,Ke.push([_e,Re])):Ke[Bt][1]=Re,this}Eo.prototype.clear=Ri,Eo.prototype.delete=es,Eo.prototype.get=Ia,Eo.prototype.has=gu,Eo.prototype.set=Qa;function Xo(_e){var Re=-1,Ke=_e==null?0:_e.length;for(this.clear();++Re<Ke;){var Bt=_e[Re];this.set(Bt[0],Bt[1])}}function Jo(){this.size=0,this.__data__={hash:new Yo,map:new(yl||Eo),string:new Yo}}function hd(_e){var Re=vu(this,_e).delete(_e);return this.size-=Re?1:0,Re}function rg(_e){return vu(this,_e).get(_e)}function _u(_e){return vu(this,_e).has(_e)}function Bh(_e,Re){var Ke=vu(this,_e),Bt=Ke.size;return Ke.set(_e,Re),this.size+=Ke.size==Bt?0:1,this}Xo.prototype.clear=Jo,Xo.prototype.delete=hd,Xo.prototype.get=rg,Xo.prototype.has=_u,Xo.prototype.set=Bh;function As(_e){var Re=this.__data__=new Eo(_e);this.size=Re.size}function Eu(){this.__data__=new Eo,this.size=0}function Qo(_e){var Re=this.__data__,Ke=Re.delete(_e);return this.size=Re.size,Ke}function fd(_e){return this.__data__.get(_e)}function pd(_e){return this.__data__.has(_e)}function Aa(_e,Re){var Ke=this.__data__;if(Ke instanceof Eo){var Bt=Ke.__data__;if(!yl||Bt.length<s-1)return Bt.push([_e,Re]),this.size=++Ke.size,this;Ke=this.__data__=new Xo(Bt)}return Ke.set(_e,Re),this.size=Ke.size,this}As.prototype.clear=Eu,As.prototype.delete=Qo,As.prototype.get=fd,As.prototype.has=pd,As.prototype.set=Aa;function md(_e,Re){var Ke=To(_e),Bt=!Ke&&Ki(_e),Wn=!Ke&&!Bt&&wo(_e),fr=!Ke&&!Bt&&!Wn&&Kh(_e),Ur=Ke||Bt||Wn||fr,nn=Ur?Ar(_e.length,String):[],Or=nn.length;for(var di in _e)Ur&&(di=="length"||Wn&&(di=="offset"||di=="parent")||fr&&(di=="buffer"||di=="byteLength"||di=="byteOffset")||Kc(di,Or))||nn.push(di);return nn}function yu(_e,Re,Ke){(Ke!==void 0&&!So(_e[Re],Ke)||Ke===void 0&&!(Re in _e))&&Mr(_e,Re,Ke)}function yo(_e,Re,Ke){var Bt=_e[Re];(!(gt.call(_e,Re)&&So(Bt,Ke))||Ke===void 0&&!(Re in _e))&&Mr(_e,Re,Ke)}function gd(_e,Re){for(var Ke=_e.length;Ke--;)if(So(_e[Ke][0],Re))return Ke;return-1}function Mr(_e,Re,Ke){Re=="__proto__"&&Ca?Ca(_e,Re,{configurable:!0,enumerable:!0,value:Ke,writable:!0}):_e[Re]=Ke}var ui=Tl();function Za(_e){return _e==null?_e===void 0?Q:ee:li&&li in Object(_e)?vo(_e):hp(_e)}function zc(_e){return ts(_e)&&Za(_e)==E}function Zo(_e){if(!tc(_e)||Pa(_e))return!1;var Re=Ro(_e)?rn:Ae;return Re.test(Hh(_e))}function Wh(_e){return ts(_e)&&pp(_e.length)&&!!Ze[Za(_e)]}function _d(_e){if(!tc(_e))return ec(_e);var Re=er(_e),Ke=[];for(var Bt in _e)Bt=="constructor"&&(Re||!gt.call(_e,Bt))||Ke.push(Bt);return Ke}function vl(_e,Re,Ke,Bt,Wn){_e!==Re&&ui(Re,function(fr,Ur){if(Wn||(Wn=new As),tc(fr))to(_e,Re,Ur,Ke,vl,Bt,Wn);else{var nn=Bt?Bt(vd(_e,Ur),fr,Ur+"",_e,Re,Wn):void 0;nn===void 0&&(nn=fr),yu(_e,Ur,nn)}},Cl)}function to(_e,Re,Ke,Bt,Wn,fr,Ur){var nn=vd(_e,Ke),Or=vd(Re,Ke),di=Ur.get(Or);if(di){yu(_e,Ke,di);return}var _s=fr?fr(nn,Or,Ke+"",_e,Re,Ur):void 0,Co=_s===void 0;if(Co){var Io=To(Or),bu=!Io&&wo(Or),Ui=!Io&&!bu&&Kh(Or);_s=Or,Io||bu||Ui?To(nn)?_s=nn:Rl(nn)?_s=yd(nn):bu?(Co=!1,_s=Gh(Or)):Ui?(Co=!1,_s=Ed(Or)):_s=[]:Tu(Or)||Ki(Or)?(_s=nn,Ki(nn)?_s=qc(nn):(!tc(nn)||Ro(nn))&&(_s=Su(Or))):Co=!1}Co&&(Ur.set(Or,_s),Wn(_s,Or,Bt,fr,Ur),Ur.delete(Or)),yu(_e,Ke,_s)}function dp(_e,Re){return zh(wl(_e,Re,ta),_e+"")}var Fs=Ca?function(_e,Re){return Ca(_e,"toString",{configurable:!0,enumerable:!1,value:ea(Re),writable:!0})}:ta;function Gh(_e,Re){return _e.slice()}function Hc(_e){var Re=new _e.constructor(_e.byteLength);return new kt(Re).set(new kt(_e)),Re}function Ed(_e,Re){var Ke=Hc(_e.buffer);return new _e.constructor(Ke,_e.byteOffset,_e.length)}function yd(_e,Re){var Ke=-1,Bt=_e.length;for(Re||(Re=Array(Bt));++Ke<Bt;)Re[Ke]=_e[Ke];return Re}function ar(_e,Re,Ke,Bt){var Wn=!Ke;Ke||(Ke={});for(var fr=-1,Ur=Re.length;++fr<Ur;){var nn=Re[fr],Or=void 0;Or===void 0&&(Or=_e[nn]),Wn?Mr(Ke,nn,Or):yo(Ke,nn,Or)}return Ke}function Sl(_e){return dp(function(Re,Ke){var Bt=-1,Wn=Ke.length,fr=Wn>1?Ke[Wn-1]:void 0,Ur=Wn>2?Ke[2]:void 0;for(fr=_e.length>3&&typeof fr=="function"?(Wn--,fr):void 0,Ur&&bl(Ke[0],Ke[1],Ur)&&(fr=Wn<3?void 0:fr,Wn=1),Re=Object(Re);++Bt<Wn;){var nn=Ke[Bt];nn&&_e(Re,nn,Bt,fr)}return Re})}function Tl(_e){return function(Re,Ke,Bt){for(var Wn=-1,fr=Object(Re),Ur=Bt(Re),nn=Ur.length;nn--;){var Or=Ur[++Wn];if(Ke(fr[Or],Or,fr)===!1)break}return Re}}function vu(_e,Re){var Ke=_e.__data__;return jr(Re)?Ke[typeof Re=="string"?"string":"hash"]:Ke.map}function Oa(_e,Re){var Ke=Zn(_e,Re);return Zo(Ke)?Ke:void 0}function vo(_e){var Re=gt.call(_e,li),Ke=_e[li];try{_e[li]=void 0;var Bt=!0}catch{}var Wn=_n.call(_e);return Bt&&(Re?_e[li]=Ke:delete _e[li]),Wn}function Su(_e){return typeof _e.constructor=="function"&&!er(_e)?Ya(tn(_e)):{}}function Kc(_e,Re){var Ke=typeof _e;return Re=Re??p,!!Re&&(Ke=="number"||Ke!="symbol"&&qe.test(_e))&&_e>-1&&_e%1==0&&_e<Re}function bl(_e,Re,Ke){if(!tc(Ke))return!1;var Bt=typeof Re;return(Bt=="number"?bo(Ke)&&Kc(Re,Ke.length):Bt=="string"&&Re in Ke)?So(Ke[Re],_e):!1}function jr(_e){var Re=typeof _e;return Re=="string"||Re=="number"||Re=="symbol"||Re=="boolean"?_e!=="__proto__":_e===null}function Pa(_e){return!!Vt&&Vt in _e}function er(_e){var Re=_e&&_e.constructor,Ke=typeof Re=="function"&&Re.prototype||We;return _e===Ke}function ec(_e){var Re=[];if(_e!=null)for(var Ke in Object(_e))Re.push(Ke);return Re}function hp(_e){return _n.call(_e)}function wl(_e,Re,Ke){return Re=Zs(Re===void 0?_e.length-1:Re,0),function(){for(var Bt=arguments,Wn=-1,fr=Zs(Bt.length-Re,0),Ur=Array(fr);++Wn<fr;)Ur[Wn]=Bt[Re+Wn];Wn=-1;for(var nn=Array(Re+1);++Wn<Re;)nn[Wn]=Bt[Wn];return nn[Re]=Ke(Ur),Kn(_e,this,nn)}}function vd(_e,Re){if(!(Re==="constructor"&&typeof _e[Re]=="function")&&Re!="__proto__")return _e[Re]}var zh=fp(Fs);function fp(_e){var Re=0,Ke=0;return function(){var Bt=eo(),Wn=d-(Bt-Ke);if(Ke=Bt,Wn>0){if(++Re>=l)return arguments[0]}else Re=0;return _e.apply(void 0,arguments)}}function Hh(_e){if(_e!=null){try{return mt.call(_e)}catch{}try{return _e+""}catch{}}return""}function So(_e,Re){return _e===Re||_e!==_e&&Re!==Re}var Ki=zc(function(){return arguments}())?zc:function(_e){return ts(_e)&&gt.call(_e,"callee")&&!Cs.call(_e,"callee")},To=Array.isArray;function bo(_e){return _e!=null&&pp(_e.length)&&!Ro(_e)}function Rl(_e){return ts(_e)&&bo(_e)}var wo=Bc||$c;function Ro(_e){if(!tc(_e))return!1;var Re=Za(_e);return Re==F||Re==H||Re==b||Re==re}function pp(_e){return typeof _e=="number"&&_e>-1&&_e%1==0&&_e<=p}function tc(_e){var Re=typeof _e;return _e!=null&&(Re=="object"||Re=="function")}function ts(_e){return _e!=null&&typeof _e=="object"}function Tu(_e){if(!ts(_e)||Za(_e)!=J)return!1;var Re=tn(_e);if(Re===null)return!0;var Ke=gt.call(Re,"constructor")&&Re.constructor;return typeof Ke=="function"&&Ke instanceof Ke&&mt.call(Ke)==kn}var Kh=hn?Zt(hn):Wh;function qc(_e){return ar(_e,Cl(_e))}function Cl(_e){return bo(_e)?md(_e):_d(_e)}var mp=Sl(function(_e,Re,Ke,Bt){vl(_e,Re,Ke,Bt)});function ea(_e){return function(){return _e}}function ta(_e){return _e}function $c(){return!1}r.exports=mp}(zb,zb.exports)),zb.exports}var T_e=S_e();const gh=BS(T_e);function Mc(r,t=[]){const s=V.useRef(r);return V.useEffect(()=>{s.current=r}),V.useCallback((...a)=>{var l;return(l=s.current)==null?void 0:l.call(s,...a)},t)}function rS(r,t,s,a){const l=Mc(s);return V.useEffect(()=>{const d=typeof r=="function"?r():r??document;if(!(!s||!d))return d.addEventListener(t,l,a),()=>{d.removeEventListener(t,l,a)}},[t,r,a,l,s]),()=>{const d=typeof r=="function"?r():r??document;d==null||d.removeEventListener(t,l,a)}}function yJ(r){const{isOpen:t,ref:s}=r,[a,l]=V.useState(t),[d,p]=V.useState(!1);return V.useEffect(()=>{d||(l(t),p(!0))},[t,d,a]),rS(()=>s.current,"animationend",()=>{l(t)}),{present:!(t?!1:!a),onComplete(){var R;const v=Wge(s.current),b=new v.CustomEvent("animationend",{bubbles:!0});(R=s.current)==null||R.dispatchEvent(b)}}}function vJ(r){const{value:t,defaultValue:s,onChange:a,shouldUpdate:l=(N,F)=>N!==F}=r,d=Mc(a),p=Mc(l),[E,v]=V.useState(s),b=t!==void 0,R=b?t:E,O=Mc(N=>{const H=typeof N=="function"?N(R):N;p(R,H)&&(b||v(H),d(H))},[b,d,R,p]);return[R,O]}function WS(r={}){const{onClose:t,onOpen:s,isOpen:a,id:l}=r,d=Mc(s),p=Mc(t),[E,v]=V.useState(r.defaultIsOpen||!1),b=a!==void 0?a:E,R=a!==void 0,O=V.useId(),N=l??`disclosure-${O}`,F=V.useCallback(()=>{R||v(!1),p==null||p()},[R,p]),H=V.useCallback(()=>{R||v(!0),d==null||d()},[R,d]),z=V.useCallback(()=>{b?F():H()},[b,H,F]);function G(J={}){return{...J,"aria-expanded":b,"aria-controls":N,onClick(re){var de;(de=J.onClick)==null||de.call(J,re),z()}}}function ee(J={}){return{...J,hidden:!b,id:N}}return{isOpen:b,onOpen:H,onClose:F,onToggle:z,isControlled:R,getButtonProps:G,getDisclosureProps:ee}}const Nm=globalThis!=null&&globalThis.document?V.useLayoutEffect:V.useEffect,Um=(r,t)=>{const s=V.useRef(!1),a=V.useRef(!1);V.useEffect(()=>{if(s.current&&a.current)return r();a.current=!0},t),V.useEffect(()=>(s.current=!0,()=>{s.current=!1}),[])};function b_e(r){const t=r.current;if(!t)return!1;const s=zge(t);return!s||t.contains(s)?!1:!!s_e(s)}function SJ(r,t){const{shouldFocus:s,visible:a,focusRef:l}=t,d=s&&!a;Um(()=>{if(!d||b_e(r))return;const p=(l==null?void 0:l.current)||r.current;let E;if(p)return E=requestAnimationFrame(()=>{p.focus({preventScroll:!0})}),()=>{cancelAnimationFrame(E)}},[d,r,l])}const w_e={preventScroll:!0,shouldFocus:!1};function R_e(r,t=w_e){const{focusRef:s,preventScroll:a,shouldFocus:l,visible:d}=t,p=C_e(r)?r.current:r,E=l&&d,v=V.useRef(E),b=V.useRef(d);Nm(()=>{!b.current&&d&&(v.current=E),b.current=d},[d,E]);const R=V.useCallback(()=>{if(!(!d||!p||!v.current)&&(v.current=!1,!p.contains(document.activeElement)))if(s!=null&&s.current)requestAnimationFrame(()=>{var O;(O=s.current)==null||O.focus({preventScroll:a})});else{const O=mJ(p);O.length>0&&requestAnimationFrame(()=>{O[0].focus({preventScroll:a})})}},[d,a,p,s]);Um(()=>{R()},[R]),rS(p,"transitionend",R)}function C_e(r){return"current"in r}function I_e(r){return"current"in r}const TJ=()=>typeof window<"u";function A_e(){const r=navigator.userAgentData;return(r==null?void 0:r.platform)??navigator.platform}const O_e=r=>TJ()&&r.test(navigator.vendor),P_e=r=>TJ()&&r.test(A_e()),N_e=()=>P_e(/mac|iphone|ipad|ipod/i),k_e=()=>N_e()&&O_e(/apple/i);function D_e(r){const{ref:t,elements:s,enabled:a}=r,l=()=>{var d;return((d=t.current)==null?void 0:d.ownerDocument)??document};rS(l,"pointerdown",d=>{var b,R;if(!k_e()||!a)return;const p=((R=(b=d.composedPath)==null?void 0:b.call(d))==null?void 0:R[0])??d.target,v=(s??[t]).some(O=>{const N=I_e(O)?O.current:O;return(N==null?void 0:N.contains(p))||N===p});l().activeElement!==p&&v&&(d.preventDefault(),p.focus())})}function L_e(r,t){const s=V.useId();return V.useMemo(()=>r||[t,s].filter(Boolean).join("-"),[r,t,s])}function x_e(r,...t){const s=L_e(r);return V.useMemo(()=>t.map(a=>`${a}-${s}`),[s,t])}function bJ(r){const t=V.useRef(null);return t.current=r,t}function M_e(r,t){if(r!=null){if(typeof r=="function"){r(t);return}try{r.current=t}catch{throw new Error(`Cannot assign value '${t}' to ref '${r}'`)}}}function Gi(...r){return t=>{r.forEach(s=>{M_e(s,t)})}}function U_e(...r){return V.useMemo(()=>Gi(...r),r)}function wJ(r){const{ref:t,handler:s,enabled:a=!0}=r,l=Mc(s),p=V.useRef({isPointerDown:!1,ignoreEmulatedMouseEvents:!1}).current;V.useEffect(()=>{if(!a)return;const E=O=>{rM(O,t)&&(p.isPointerDown=!0)},v=O=>{if(p.ignoreEmulatedMouseEvents){p.ignoreEmulatedMouseEvents=!1;return}p.isPointerDown&&s&&rM(O,t)&&(p.isPointerDown=!1,l(O))},b=O=>{p.ignoreEmulatedMouseEvents=!0,s&&p.isPointerDown&&rM(O,t)&&(p.isPointerDown=!1,l(O))},R=RJ(t.current);return R.addEventListener("mousedown",E,!0),R.addEventListener("mouseup",v,!0),R.addEventListener("touchstart",E,!0),R.addEventListener("touchend",b,!0),()=>{R.removeEventListener("mousedown",E,!0),R.removeEventListener("mouseup",v,!0),R.removeEventListener("touchstart",E,!0),R.removeEventListener("touchend",b,!0)}},[s,t,l,p,a])}function rM(r,t){var a,l;const s=((a=r.composedPath)==null?void 0:a.call(r)[0])??r.target;return s&&!RJ(s).contains(s)?!1:!((l=t.current)!=null&&l.contains(s))}function RJ(r){return(r==null?void 0:r.ownerDocument)??document}function V_e(r,t){const s=Mc(r);V.useEffect(()=>{if(t==null)return;let a=null;return a=window.setTimeout(()=>{s()},t),()=>{a&&window.clearTimeout(a)}},[t,s])}const CJ=1/60*1e3,F_e=typeof performance<"u"?()=>performance.now():()=>Date.now(),IJ=typeof window<"u"?r=>window.requestAnimationFrame(r):r=>setTimeout(()=>r(F_e()),CJ);function j_e(r){let t=[],s=[],a=0,l=!1,d=!1;const p=new WeakSet,E={schedule:(v,b=!1,R=!1)=>{const O=R&&l,N=O?t:s;return b&&p.add(v),N.indexOf(v)===-1&&(N.push(v),O&&l&&(a=t.length)),v},cancel:v=>{const b=s.indexOf(v);b!==-1&&s.splice(b,1),p.delete(v)},process:v=>{if(l){d=!0;return}if(l=!0,[t,s]=[s,t],s.length=0,a=t.length,a)for(let b=0;b<a;b++){const R=t[b];R(v),p.has(R)&&(E.schedule(R),r())}l=!1,d&&(d=!1,E.process(v))}};return E}const B_e=40;let T2=!0,Iw=!1,b2=!1;const iS={delta:0,timestamp:0},oR=["read","update","preRender","render","postRender"],TN=oR.reduce((r,t)=>(r[t]=j_e(()=>Iw=!0),r),{}),W_e=oR.reduce((r,t)=>{const s=TN[t];return r[t]=(a,l=!1,d=!1)=>(Iw||H_e(),s.schedule(a,l,d)),r},{}),G_e=oR.reduce((r,t)=>(r[t]=TN[t].cancel,r),{});oR.reduce((r,t)=>(r[t]=()=>TN[t].process(iS),r),{});const z_e=r=>TN[r].process(iS),AJ=r=>{Iw=!1,iS.delta=T2?CJ:Math.max(Math.min(r-iS.timestamp,B_e),1),iS.timestamp=r,b2=!0,oR.forEach(z_e),b2=!1,Iw&&(T2=!1,IJ(AJ))},H_e=()=>{Iw=!0,T2=!0,b2||IJ(AJ)},XK=()=>iS;var K_e=Object.defineProperty,q_e=(r,t,s)=>t in r?K_e(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,rd=(r,t,s)=>(q_e(r,typeof t!="symbol"?t+"":t,s),s);class $_e{constructor(t,s,a){if(rd(this,"history",[]),rd(this,"startEvent",null),rd(this,"lastEvent",null),rd(this,"lastEventInfo",null),rd(this,"handlers",{}),rd(this,"removeListeners",()=>{}),rd(this,"threshold",3),rd(this,"win"),rd(this,"updatePoint",()=>{if(!(this.lastEvent&&this.lastEventInfo))return;const E=iM(this.lastEventInfo,this.history),v=this.startEvent!==null,b=Q_e(E.offset,{x:0,y:0})>=this.threshold;if(!v&&!b)return;const{timestamp:R}=XK();this.history.push({...E.point,timestamp:R});const{onStart:O,onMove:N}=this.handlers;v||(O==null||O(this.lastEvent,E),this.startEvent=this.lastEvent),N==null||N(this.lastEvent,E)}),rd(this,"onPointerMove",(E,v)=>{this.lastEvent=E,this.lastEventInfo=v,W_e.update(this.updatePoint,!0)}),rd(this,"onPointerUp",(E,v)=>{const b=iM(v,this.history),{onEnd:R,onSessionEnd:O}=this.handlers;O==null||O(E,b),this.end(),!(!R||!this.startEvent)&&(R==null||R(E,b))}),this.win=t.view??window,Kge(t))return;this.handlers=s,a&&(this.threshold=a),t.stopPropagation(),t.preventDefault();const l={point:dJ(t)},{timestamp:d}=XK();this.history=[{...l.point,timestamp:d}];const{onSessionStart:p}=s;p==null||p(t,iM(l,this.history)),this.removeListeners=J_e(ZO(this.win,"pointermove",this.onPointerMove),ZO(this.win,"pointerup",this.onPointerUp),ZO(this.win,"pointercancel",this.onPointerUp))}updateHandlers(t){this.handlers=t}end(){var t;(t=this.removeListeners)==null||t.call(this),G_e.update(this.updatePoint)}}function JK(r,t){return{x:r.x-t.x,y:r.y-t.y}}function iM(r,t){return{point:r.point,delta:JK(r.point,t[t.length-1]),offset:JK(r.point,t[0]),velocity:X_e(t,.1)}}const Y_e=r=>r*1e3;function X_e(r,t){if(r.length<2)return{x:0,y:0};let s=r.length-1,a=null;const l=r[r.length-1];for(;s>=0&&(a=r[s],!(l.timestamp-a.timestamp>Y_e(t)));)s--;if(!a)return{x:0,y:0};const d=(l.timestamp-a.timestamp)/1e3;if(d===0)return{x:0,y:0};const p={x:(l.x-a.x)/d,y:(l.y-a.y)/d};return p.x===1/0&&(p.x=0),p.y===1/0&&(p.y=0),p}function J_e(...r){return t=>r.reduce((s,a)=>a(s),t)}function sM(r,t){return Math.abs(r-t)}function QK(r){return"x"in r&&"y"in r}function Q_e(r,t){if(typeof r=="number"&&typeof t=="number")return sM(r,t);if(QK(r)&&QK(t)){const s=sM(r.x,t.x),a=sM(r.y,t.y);return Math.sqrt(s**2+a**2)}return 0}function Z_e(r,t){const{onPan:s,onPanStart:a,onPanEnd:l,onPanSessionStart:d,onPanSessionEnd:p,threshold:E}=t,v=!!(s||a||l||d||p),b=V.useRef(null),R=bJ({onSessionStart:d,onSessionEnd:p,onStart:a,onMove:s,onEnd(O,N){b.current=null,l==null||l(O,N)}});V.useEffect(()=>{var O;(O=b.current)==null||O.updateHandlers(R.current)}),V.useEffect(()=>{const O=r.current;if(!O||!v)return;function N(F){b.current=new $_e(F,R.current,E)}return ZO(O,"pointerdown",N)},[r,v,R,E]),V.useEffect(()=>()=>{var O;(O=b.current)==null||O.end(),b.current=null},[])}const $s={open:(r,t)=>`${r}[data-open], ${r}[open], ${r}[data-state=open] ${t}`,closed:(r,t)=>`${r}[data-closed], ${r}[data-state=closed] ${t}`,hover:(r,t)=>`${r}:hover ${t}, ${r}[data-hover] ${t}`,focus:(r,t)=>`${r}:focus ${t}, ${r}[data-focus] ${t}`,focusVisible:(r,t)=>`${r}:focus-visible ${t}`,focusWithin:(r,t)=>`${r}:focus-within ${t}`,active:(r,t)=>`${r}:active ${t}, ${r}[data-active] ${t}`,disabled:(r,t)=>`${r}:disabled ${t}, ${r}[data-disabled] ${t}`,invalid:(r,t)=>`${r}:invalid ${t}, ${r}[data-invalid] ${t}`,checked:(r,t)=>`${r}:checked ${t}, ${r}[data-checked] ${t}`,placeholderShown:(r,t)=>`${r}:placeholder-shown ${t}`},oh=r=>OJ(t=>r(t,"&"),"[role=group]","[data-group]",".group"),Vf=r=>OJ(t=>r(t,"~ &"),"[data-peer]",".peer"),OJ=(r,...t)=>t.map(r).join(", "),sS={_hover:"&:hover, &[data-hover]",_active:"&:active, &[data-active]",_focus:"&:focus, &[data-focus]",_highlighted:"&[data-highlighted]",_focusWithin:"&:focus-within, &[data-focus-within]",_focusVisible:"&:focus-visible, &[data-focus-visible]",_disabled:"&:disabled, &[disabled], &[aria-disabled=true], &[data-disabled]",_readOnly:"&[aria-readonly=true], &[readonly], &[data-readonly]",_before:"&::before",_after:"&::after",_empty:"&:empty, &[data-empty]",_expanded:"&[aria-expanded=true], &[data-expanded], &[data-state=expanded]",_checked:"&[aria-checked=true], &[data-checked], &[data-state=checked]",_grabbed:"&[aria-grabbed=true], &[data-grabbed]",_pressed:"&[aria-pressed=true], &[data-pressed]",_invalid:"&[aria-invalid=true], &[data-invalid]",_valid:"&[data-valid], &[data-state=valid]",_loading:"&[data-loading], &[aria-busy=true]",_selected:"&[aria-selected=true], &[data-selected]",_hidden:"&[hidden], &[data-hidden]",_autofill:"&:-webkit-autofill",_even:"&:nth-of-type(even)",_odd:"&:nth-of-type(odd)",_first:"&:first-of-type",_firstLetter:"&::first-letter",_last:"&:last-of-type",_notFirst:"&:not(:first-of-type)",_notLast:"&:not(:last-of-type)",_visited:"&:visited",_activeLink:"&[aria-current=page]",_activeStep:"&[aria-current=step]",_indeterminate:"&:indeterminate, &[aria-checked=mixed], &[data-indeterminate], &[data-state=indeterminate]",_groupOpen:oh($s.open),_groupClosed:oh($s.closed),_groupHover:oh($s.hover),_peerHover:Vf($s.hover),_groupFocus:oh($s.focus),_peerFocus:Vf($s.focus),_groupFocusVisible:oh($s.focusVisible),_peerFocusVisible:Vf($s.focusVisible),_groupActive:oh($s.active),_peerActive:Vf($s.active),_groupDisabled:oh($s.disabled),_peerDisabled:Vf($s.disabled),_groupInvalid:oh($s.invalid),_peerInvalid:Vf($s.invalid),_groupChecked:oh($s.checked),_peerChecked:Vf($s.checked),_groupFocusWithin:oh($s.focusWithin),_peerFocusWithin:Vf($s.focusWithin),_peerPlaceholderShown:Vf($s.placeholderShown),_placeholder:"&::placeholder, &[data-placeholder]",_placeholderShown:"&:placeholder-shown, &[data-placeholder-shown]",_fullScreen:"&:fullscreen, &[data-fullscreen]",_selection:"&::selection",_rtl:"[dir=rtl] &, &[dir=rtl]",_ltr:"[dir=ltr] &, &[dir=ltr]",_mediaDark:"@media (prefers-color-scheme: dark)",_mediaReduceMotion:"@media (prefers-reduced-motion: reduce)",_dark:".chakra-ui-dark &:not([data-theme]),[data-theme=dark] &:not([data-theme]),&[data-theme=dark]",_light:".chakra-ui-light &:not([data-theme]),[data-theme=light] &:not([data-theme]),&[data-theme=light]",_horizontal:"&[data-orientation=horizontal]",_vertical:"&[data-orientation=vertical]",_open:"&[data-open], &[open], &[data-state=open]",_closed:"&[data-closed], &[data-state=closed]",_complete:"&[data-complete]",_incomplete:"&[data-incomplete]",_current:"&[data-current]"},PJ=Object.keys(sS),eEe=r=>/!(important)?$/.test(r),ZK=r=>typeof r=="string"?r.replace(/!(important)?$/,"").trim():r,tEe=(r,t)=>s=>{const a=String(t),l=eEe(a),d=ZK(a),p=r?`${r}.${d}`:d;let E=au(s.__cssMap)&&p in s.__cssMap?s.__cssMap[p].varRef:t;return E=ZK(E),l?`${E} !important`:E};function nV(r){const{scale:t,transform:s,compose:a}=r;return(d,p)=>{const E=tEe(t,d)(p);let v=(s==null?void 0:s(E,p))??E;return a&&(v=a(v,p)),v}}const SO=(...r)=>t=>r.reduce((s,a)=>a(s),t);function tu(r,t){return s=>{const a={property:s,scale:r};return a.transform=nV({scale:r,transform:t}),a}}const nEe=({rtl:r,ltr:t})=>s=>s.direction==="rtl"?r:t;function rEe(r){const{property:t,scale:s,transform:a}=r;return{scale:s,property:nEe(t),transform:s?nV({scale:s,compose:a}):a}}const NJ=["rotate(var(--chakra-rotate, 0))","scaleX(var(--chakra-scale-x, 1))","scaleY(var(--chakra-scale-y, 1))","skewX(var(--chakra-skew-x, 0))","skewY(var(--chakra-skew-y, 0))"];function iEe(){return["translateX(var(--chakra-translate-x, 0))","translateY(var(--chakra-translate-y, 0))",...NJ].join(" ")}function sEe(){return["translate3d(var(--chakra-translate-x, 0), var(--chakra-translate-y, 0), 0)",...NJ].join(" ")}const oEe={"--chakra-blur":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-brightness":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-contrast":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-grayscale":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-hue-rotate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-invert":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-saturate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-sepia":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-drop-shadow":"var(--chakra-empty,/*!*/ /*!*/)",filter:["var(--chakra-blur)","var(--chakra-brightness)","var(--chakra-contrast)","var(--chakra-grayscale)","var(--chakra-hue-rotate)","var(--chakra-invert)","var(--chakra-saturate)","var(--chakra-sepia)","var(--chakra-drop-shadow)"].join(" ")},aEe={backdropFilter:["var(--chakra-backdrop-blur)","var(--chakra-backdrop-brightness)","var(--chakra-backdrop-contrast)","var(--chakra-backdrop-grayscale)","var(--chakra-backdrop-hue-rotate)","var(--chakra-backdrop-invert)","var(--chakra-backdrop-opacity)","var(--chakra-backdrop-saturate)","var(--chakra-backdrop-sepia)"].join(" "),"--chakra-backdrop-blur":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-brightness":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-contrast":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-grayscale":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-hue-rotate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-invert":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-opacity":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-saturate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-sepia":"var(--chakra-empty,/*!*/ /*!*/)"};function cEe(r){return{"--chakra-ring-offset-shadow":"var(--chakra-ring-inset) 0 0 0 var(--chakra-ring-offset-width) var(--chakra-ring-offset-color)","--chakra-ring-shadow":"var(--chakra-ring-inset) 0 0 0 calc(var(--chakra-ring-width) + var(--chakra-ring-offset-width)) var(--chakra-ring-color)","--chakra-ring-width":r,boxShadow:["var(--chakra-ring-offset-shadow)","var(--chakra-ring-shadow)","var(--chakra-shadow, 0 0 #0000)"].join(", ")}}const lEe={"row-reverse":{space:"--chakra-space-x-reverse",divide:"--chakra-divide-x-reverse"},"column-reverse":{space:"--chakra-space-y-reverse",divide:"--chakra-divide-y-reverse"}},w2={"to-t":"to top","to-tr":"to top right","to-r":"to right","to-br":"to bottom right","to-b":"to bottom","to-bl":"to bottom left","to-l":"to left","to-tl":"to top left"},uEe=new Set(Object.values(w2)),R2=new Set(["none","-moz-initial","inherit","initial","revert","unset"]),dEe=r=>r.trim();function hEe(r,t){if(r==null||R2.has(r))return r;if(!(C2(r)||R2.has(r)))return`url('${r}')`;const l=/(^[a-z-A-Z]+)\((.*)\)/g.exec(r),d=l==null?void 0:l[1],p=l==null?void 0:l[2];if(!d||!p)return r;const E=d.includes("-gradient")?d:`${d}-gradient`,[v,...b]=p.split(",").map(dEe).filter(Boolean);if((b==null?void 0:b.length)===0)return r;const R=v in w2?w2[v]:v;b.unshift(R);const O=b.map(N=>{if(uEe.has(N))return N;const F=N.indexOf(" "),[H,z]=F!==-1?[N.substr(0,F),N.substr(F+1)]:[N],G=C2(z)?z:z&&z.split(" "),ee=`colors.${H}`,J=ee in t.__cssMap?t.__cssMap[ee].varRef:H;return G?[J,...Array.isArray(G)?G:[G]].join(" "):J});return`${E}(${O.join(", ")})`}const C2=r=>typeof r=="string"&&r.includes("(")&&r.includes(")"),fEe=(r,t)=>hEe(r,t??{});function pEe(r){return/^var\(--.+\)$/.test(r)}const mEe=r=>{const t=parseFloat(r.toString()),s=r.toString().replace(String(t),"");return{unitless:!s,value:t,unit:s}},ah=r=>t=>`${r}(${t})`,br={filter(r){return r!=="auto"?r:oEe},backdropFilter(r){return r!=="auto"?r:aEe},ring(r){return cEe(br.px(r))},bgClip(r){return r==="text"?{color:"transparent",backgroundClip:"text"}:{backgroundClip:r}},transform(r){return r==="auto"?iEe():r==="auto-gpu"?sEe():r},vh(r){return r==="$100vh"?"var(--chakra-vh)":r},px(r){if(r==null)return r;const{unitless:t}=mEe(r);return t||typeof r=="number"?`${r}px`:r},fraction(r){return typeof r!="number"||r>1?r:`${r*100}%`},float(r,t){const s={left:"right",right:"left"};return t.direction==="rtl"?s[r]:r},degree(r){if(pEe(r)||r==null)return r;const t=typeof r=="string"&&!r.endsWith("deg");return typeof r=="number"||t?`${r}deg`:r},gradient:fEe,blur:ah("blur"),opacity:ah("opacity"),brightness:ah("brightness"),contrast:ah("contrast"),dropShadow:ah("drop-shadow"),grayscale:ah("grayscale"),hueRotate:r=>ah("hue-rotate")(br.degree(r)),invert:ah("invert"),saturate:ah("saturate"),sepia:ah("sepia"),bgImage(r){return r==null||C2(r)||R2.has(r)?r:`url(${r})`},outline(r){const t=String(r)==="0"||String(r)==="none";return r!==null&&t?{outline:"2px solid transparent",outlineOffset:"2px"}:{outline:r}},flexDirection(r){const{space:t,divide:s}=lEe[r]??{},a={flexDirection:r};return t&&(a[t]=1),s&&(a[s]=1),a}},De={borderWidths:tu("borderWidths"),borderStyles:tu("borderStyles"),colors:tu("colors"),borders:tu("borders"),gradients:tu("gradients",br.gradient),radii:tu("radii",br.px),space:tu("space",SO(br.vh,br.px)),spaceT:tu("space",SO(br.vh,br.px)),degreeT(r){return{property:r,transform:br.degree}},prop(r,t,s){return{property:r,scale:t,...t&&{transform:nV({scale:t,transform:s})}}},propT(r,t){return{property:r,transform:t}},sizes:tu("sizes",SO(br.vh,br.px)),sizesT:tu("sizes",SO(br.vh,br.fraction)),shadows:tu("shadows"),logical:rEe,blur:tu("blur",br.blur)},eP={background:De.colors("background"),backgroundColor:De.colors("backgroundColor"),backgroundImage:De.gradients("backgroundImage"),backgroundSize:!0,backgroundPosition:!0,backgroundRepeat:!0,backgroundAttachment:!0,backgroundClip:{transform:br.bgClip},bgSize:De.prop("backgroundSize"),bgPosition:De.prop("backgroundPosition"),bg:De.colors("background"),bgColor:De.colors("backgroundColor"),bgPos:De.prop("backgroundPosition"),bgRepeat:De.prop("backgroundRepeat"),bgAttachment:De.prop("backgroundAttachment"),bgGradient:De.gradients("backgroundImage"),bgClip:{transform:br.bgClip}};Object.assign(eP,{bgImage:eP.backgroundImage,bgImg:eP.backgroundImage});const Gr={border:De.borders("border"),borderWidth:De.borderWidths("borderWidth"),borderStyle:De.borderStyles("borderStyle"),borderColor:De.colors("borderColor"),borderRadius:De.radii("borderRadius"),borderTop:De.borders("borderTop"),borderBlockStart:De.borders("borderBlockStart"),borderTopLeftRadius:De.radii("borderTopLeftRadius"),borderStartStartRadius:De.logical({scale:"radii",property:{ltr:"borderTopLeftRadius",rtl:"borderTopRightRadius"}}),borderEndStartRadius:De.logical({scale:"radii",property:{ltr:"borderBottomLeftRadius",rtl:"borderBottomRightRadius"}}),borderTopRightRadius:De.radii("borderTopRightRadius"),borderStartEndRadius:De.logical({scale:"radii",property:{ltr:"borderTopRightRadius",rtl:"borderTopLeftRadius"}}),borderEndEndRadius:De.logical({scale:"radii",property:{ltr:"borderBottomRightRadius",rtl:"borderBottomLeftRadius"}}),borderRight:De.borders("borderRight"),borderInlineEnd:De.borders("borderInlineEnd"),borderBottom:De.borders("borderBottom"),borderBlockEnd:De.borders("borderBlockEnd"),borderBottomLeftRadius:De.radii("borderBottomLeftRadius"),borderBottomRightRadius:De.radii("borderBottomRightRadius"),borderLeft:De.borders("borderLeft"),borderInlineStart:{property:"borderInlineStart",scale:"borders"},borderInlineStartRadius:De.logical({scale:"radii",property:{ltr:["borderTopLeftRadius","borderBottomLeftRadius"],rtl:["borderTopRightRadius","borderBottomRightRadius"]}}),borderInlineEndRadius:De.logical({scale:"radii",property:{ltr:["borderTopRightRadius","borderBottomRightRadius"],rtl:["borderTopLeftRadius","borderBottomLeftRadius"]}}),borderX:De.borders(["borderLeft","borderRight"]),borderInline:De.borders("borderInline"),borderY:De.borders(["borderTop","borderBottom"]),borderBlock:De.borders("borderBlock"),borderTopWidth:De.borderWidths("borderTopWidth"),borderBlockStartWidth:De.borderWidths("borderBlockStartWidth"),borderTopColor:De.colors("borderTopColor"),borderBlockStartColor:De.colors("borderBlockStartColor"),borderTopStyle:De.borderStyles("borderTopStyle"),borderBlockStartStyle:De.borderStyles("borderBlockStartStyle"),borderBottomWidth:De.borderWidths("borderBottomWidth"),borderBlockEndWidth:De.borderWidths("borderBlockEndWidth"),borderBottomColor:De.colors("borderBottomColor"),borderBlockEndColor:De.colors("borderBlockEndColor"),borderBottomStyle:De.borderStyles("borderBottomStyle"),borderBlockEndStyle:De.borderStyles("borderBlockEndStyle"),borderLeftWidth:De.borderWidths("borderLeftWidth"),borderInlineStartWidth:De.borderWidths("borderInlineStartWidth"),borderLeftColor:De.colors("borderLeftColor"),borderInlineStartColor:De.colors("borderInlineStartColor"),borderLeftStyle:De.borderStyles("borderLeftStyle"),borderInlineStartStyle:De.borderStyles("borderInlineStartStyle"),borderRightWidth:De.borderWidths("borderRightWidth"),borderInlineEndWidth:De.borderWidths("borderInlineEndWidth"),borderRightColor:De.colors("borderRightColor"),borderInlineEndColor:De.colors("borderInlineEndColor"),borderRightStyle:De.borderStyles("borderRightStyle"),borderInlineEndStyle:De.borderStyles("borderInlineEndStyle"),borderTopRadius:De.radii(["borderTopLeftRadius","borderTopRightRadius"]),borderBottomRadius:De.radii(["borderBottomLeftRadius","borderBottomRightRadius"]),borderLeftRadius:De.radii(["borderTopLeftRadius","borderBottomLeftRadius"]),borderRightRadius:De.radii(["borderTopRightRadius","borderBottomRightRadius"])};Object.assign(Gr,{rounded:Gr.borderRadius,roundedTop:Gr.borderTopRadius,roundedTopLeft:Gr.borderTopLeftRadius,roundedTopRight:Gr.borderTopRightRadius,roundedTopStart:Gr.borderStartStartRadius,roundedTopEnd:Gr.borderStartEndRadius,roundedBottom:Gr.borderBottomRadius,roundedBottomLeft:Gr.borderBottomLeftRadius,roundedBottomRight:Gr.borderBottomRightRadius,roundedBottomStart:Gr.borderEndStartRadius,roundedBottomEnd:Gr.borderEndEndRadius,roundedLeft:Gr.borderLeftRadius,roundedRight:Gr.borderRightRadius,roundedStart:Gr.borderInlineStartRadius,roundedEnd:Gr.borderInlineEndRadius,borderStart:Gr.borderInlineStart,borderEnd:Gr.borderInlineEnd,borderTopStartRadius:Gr.borderStartStartRadius,borderTopEndRadius:Gr.borderStartEndRadius,borderBottomStartRadius:Gr.borderEndStartRadius,borderBottomEndRadius:Gr.borderEndEndRadius,borderStartRadius:Gr.borderInlineStartRadius,borderEndRadius:Gr.borderInlineEndRadius,borderStartWidth:Gr.borderInlineStartWidth,borderEndWidth:Gr.borderInlineEndWidth,borderStartColor:Gr.borderInlineStartColor,borderEndColor:Gr.borderInlineEndColor,borderStartStyle:Gr.borderInlineStartStyle,borderEndStyle:Gr.borderInlineEndStyle});const gEe={color:De.colors("color"),textColor:De.colors("color"),fill:De.colors("fill"),stroke:De.colors("stroke"),accentColor:De.colors("accentColor"),textFillColor:De.colors("textFillColor")},xP={alignItems:!0,alignContent:!0,justifyItems:!0,justifyContent:!0,flexWrap:!0,flexDirection:{transform:br.flexDirection},flex:!0,flexFlow:!0,flexGrow:!0,flexShrink:!0,flexBasis:De.sizes("flexBasis"),justifySelf:!0,alignSelf:!0,order:!0,placeItems:!0,placeContent:!0,placeSelf:!0,gap:De.space("gap"),rowGap:De.space("rowGap"),columnGap:De.space("columnGap")};Object.assign(xP,{flexDir:xP.flexDirection});const iu={width:De.sizesT("width"),inlineSize:De.sizesT("inlineSize"),height:De.sizes("height"),blockSize:De.sizes("blockSize"),boxSize:De.sizes(["width","height"]),minWidth:De.sizes("minWidth"),minInlineSize:De.sizes("minInlineSize"),minHeight:De.sizes("minHeight"),minBlockSize:De.sizes("minBlockSize"),maxWidth:De.sizes("maxWidth"),maxInlineSize:De.sizes("maxInlineSize"),maxHeight:De.sizes("maxHeight"),maxBlockSize:De.sizes("maxBlockSize"),overflow:!0,overflowX:!0,overflowY:!0,overscrollBehavior:!0,overscrollBehaviorX:!0,overscrollBehaviorY:!0,display:!0,aspectRatio:!0,hideFrom:{scale:"breakpoints",transform:(r,t)=>{var l,d;return{[`@media screen and (min-width: ${((d=(l=t.__breakpoints)==null?void 0:l.get(r))==null?void 0:d.minW)??r})`]:{display:"none"}}}},hideBelow:{scale:"breakpoints",transform:(r,t)=>{var l,d;return{[`@media screen and (max-width: ${((d=(l=t.__breakpoints)==null?void 0:l.get(r))==null?void 0:d._minW)??r})`]:{display:"none"}}}},verticalAlign:!0,boxSizing:!0,boxDecorationBreak:!0,float:De.propT("float",br.float),objectFit:!0,objectPosition:!0,visibility:!0,isolation:!0};Object.assign(iu,{w:iu.width,h:iu.height,minW:iu.minWidth,maxW:iu.maxWidth,minH:iu.minHeight,maxH:iu.maxHeight,overscroll:iu.overscrollBehavior,overscrollX:iu.overscrollBehaviorX,overscrollY:iu.overscrollBehaviorY});const _Ee={filter:{transform:br.filter},blur:De.blur("--chakra-blur"),brightness:De.propT("--chakra-brightness",br.brightness),contrast:De.propT("--chakra-contrast",br.contrast),hueRotate:De.propT("--chakra-hue-rotate",br.hueRotate),invert:De.propT("--chakra-invert",br.invert),saturate:De.propT("--chakra-saturate",br.saturate),dropShadow:De.propT("--chakra-drop-shadow",br.dropShadow),backdropFilter:{transform:br.backdropFilter},backdropBlur:De.blur("--chakra-backdrop-blur"),backdropBrightness:De.propT("--chakra-backdrop-brightness",br.brightness),backdropContrast:De.propT("--chakra-backdrop-contrast",br.contrast),backdropHueRotate:De.propT("--chakra-backdrop-hue-rotate",br.hueRotate),backdropInvert:De.propT("--chakra-backdrop-invert",br.invert),backdropSaturate:De.propT("--chakra-backdrop-saturate",br.saturate)},EEe={ring:{transform:br.ring},ringColor:De.colors("--chakra-ring-color"),ringOffset:De.prop("--chakra-ring-offset-width"),ringOffsetColor:De.colors("--chakra-ring-offset-color"),ringInset:De.prop("--chakra-ring-inset")},yEe={appearance:!0,cursor:!0,resize:!0,userSelect:!0,pointerEvents:!0,outline:{transform:br.outline},outlineOffset:!0,outlineColor:De.colors("outlineColor")},kJ={gridGap:De.space("gridGap"),gridColumnGap:De.space("gridColumnGap"),gridRowGap:De.space("gridRowGap"),gridColumn:!0,gridRow:!0,gridAutoFlow:!0,gridAutoColumns:!0,gridColumnStart:!0,gridColumnEnd:!0,gridRowStart:!0,gridRowEnd:!0,gridAutoRows:!0,gridTemplate:!0,gridTemplateColumns:!0,gridTemplateRows:!0,gridTemplateAreas:!0,gridArea:!0};function vEe(r,t,s,a){const l=typeof t=="string"?t.split("."):[t];for(a=0;a<l.length&&r;a+=1)r=r[l[a]];return r===void 0?s:r}const SEe=r=>{const t=new WeakMap;return(a,l,d,p)=>{if(typeof a>"u")return r(a,l,d);t.has(a)||t.set(a,new Map);const E=t.get(a);if(E.has(l))return E.get(l);const v=r(a,l,d,p);return E.set(l,v),v}},TEe=SEe(vEe),bEe={border:"0px",clip:"rect(0, 0, 0, 0)",width:"1px",height:"1px",margin:"-1px",padding:"0px",overflow:"hidden",whiteSpace:"nowrap",position:"absolute"},wEe={position:"static",width:"auto",height:"auto",clip:"auto",padding:"0",margin:"0",overflow:"visible",whiteSpace:"normal"},oM=(r,t,s)=>{const a={},l=TEe(r,t,{});for(const d in l)d in s&&s[d]!=null||(a[d]=l[d]);return a},REe={srOnly:{transform(r){return r===!0?bEe:r==="focusable"?wEe:{}}},layerStyle:{processResult:!0,transform:(r,t,s)=>oM(t,`layerStyles.${r}`,s)},textStyle:{processResult:!0,transform:(r,t,s)=>oM(t,`textStyles.${r}`,s)},apply:{processResult:!0,transform:(r,t,s)=>oM(t,r,s)}},uw={position:!0,pos:De.prop("position"),zIndex:De.prop("zIndex","zIndices"),inset:De.spaceT("inset"),insetX:De.spaceT(["left","right"]),insetInline:De.spaceT("insetInline"),insetY:De.spaceT(["top","bottom"]),insetBlock:De.spaceT("insetBlock"),top:De.spaceT("top"),insetBlockStart:De.spaceT("insetBlockStart"),bottom:De.spaceT("bottom"),insetBlockEnd:De.spaceT("insetBlockEnd"),left:De.spaceT("left"),insetInlineStart:De.logical({scale:"space",property:{ltr:"left",rtl:"right"}}),right:De.spaceT("right"),insetInlineEnd:De.logical({scale:"space",property:{ltr:"right",rtl:"left"}})};Object.assign(uw,{insetStart:uw.insetInlineStart,insetEnd:uw.insetInlineEnd});const I2={boxShadow:De.shadows("boxShadow"),mixBlendMode:!0,blendMode:De.prop("mixBlendMode"),backgroundBlendMode:!0,bgBlendMode:De.prop("backgroundBlendMode"),opacity:!0};Object.assign(I2,{shadow:I2.boxShadow});const Di={margin:De.spaceT("margin"),marginTop:De.spaceT("marginTop"),marginBlockStart:De.spaceT("marginBlockStart"),marginRight:De.spaceT("marginRight"),marginInlineEnd:De.spaceT("marginInlineEnd"),marginBottom:De.spaceT("marginBottom"),marginBlockEnd:De.spaceT("marginBlockEnd"),marginLeft:De.spaceT("marginLeft"),marginInlineStart:De.spaceT("marginInlineStart"),marginX:De.spaceT(["marginInlineStart","marginInlineEnd"]),marginInline:De.spaceT("marginInline"),marginY:De.spaceT(["marginTop","marginBottom"]),marginBlock:De.spaceT("marginBlock"),padding:De.space("padding"),paddingTop:De.space("paddingTop"),paddingBlockStart:De.space("paddingBlockStart"),paddingRight:De.space("paddingRight"),paddingBottom:De.space("paddingBottom"),paddingBlockEnd:De.space("paddingBlockEnd"),paddingLeft:De.space("paddingLeft"),paddingInlineStart:De.space("paddingInlineStart"),paddingInlineEnd:De.space("paddingInlineEnd"),paddingX:De.space(["paddingInlineStart","paddingInlineEnd"]),paddingInline:De.space("paddingInline"),paddingY:De.space(["paddingTop","paddingBottom"]),paddingBlock:De.space("paddingBlock")};Object.assign(Di,{m:Di.margin,mt:Di.marginTop,mr:Di.marginRight,me:Di.marginInlineEnd,marginEnd:Di.marginInlineEnd,mb:Di.marginBottom,ml:Di.marginLeft,ms:Di.marginInlineStart,marginStart:Di.marginInlineStart,mx:Di.marginX,my:Di.marginY,p:Di.padding,pt:Di.paddingTop,py:Di.paddingY,px:Di.paddingX,pb:Di.paddingBottom,pl:Di.paddingLeft,ps:Di.paddingInlineStart,paddingStart:Di.paddingInlineStart,pr:Di.paddingRight,pe:Di.paddingInlineEnd,paddingEnd:Di.paddingInlineEnd});const CEe={scrollBehavior:!0,scrollSnapAlign:!0,scrollSnapStop:!0,scrollSnapType:!0,scrollMargin:De.spaceT("scrollMargin"),scrollMarginTop:De.spaceT("scrollMarginTop"),scrollMarginBottom:De.spaceT("scrollMarginBottom"),scrollMarginLeft:De.spaceT("scrollMarginLeft"),scrollMarginRight:De.spaceT("scrollMarginRight"),scrollMarginX:De.spaceT(["scrollMarginLeft","scrollMarginRight"]),scrollMarginY:De.spaceT(["scrollMarginTop","scrollMarginBottom"]),scrollPadding:De.spaceT("scrollPadding"),scrollPaddingTop:De.spaceT("scrollPaddingTop"),scrollPaddingBottom:De.spaceT("scrollPaddingBottom"),scrollPaddingLeft:De.spaceT("scrollPaddingLeft"),scrollPaddingRight:De.spaceT("scrollPaddingRight"),scrollPaddingX:De.spaceT(["scrollPaddingLeft","scrollPaddingRight"]),scrollPaddingY:De.spaceT(["scrollPaddingTop","scrollPaddingBottom"])},IEe={fontFamily:De.prop("fontFamily","fonts"),fontSize:De.prop("fontSize","fontSizes",br.px),fontWeight:De.prop("fontWeight","fontWeights"),lineHeight:De.prop("lineHeight","lineHeights"),letterSpacing:De.prop("letterSpacing","letterSpacings"),textAlign:!0,fontStyle:!0,textIndent:!0,wordBreak:!0,overflowWrap:!0,textOverflow:!0,textTransform:!0,whiteSpace:!0,isTruncated:{transform(r){if(r===!0)return{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}},noOfLines:{static:{overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitBoxOrient:"vertical",WebkitLineClamp:"var(--chakra-line-clamp)"},property:"--chakra-line-clamp"}},AEe={textDecorationColor:De.colors("textDecorationColor"),textDecoration:!0,textDecor:{property:"textDecoration"},textDecorationLine:!0,textDecorationStyle:!0,textDecorationThickness:!0,textUnderlineOffset:!0,textShadow:De.shadows("textShadow")},OEe={clipPath:!0,transform:De.propT("transform",br.transform),transformOrigin:!0,translateX:De.spaceT("--chakra-translate-x"),translateY:De.spaceT("--chakra-translate-y"),skewX:De.degreeT("--chakra-skew-x"),skewY:De.degreeT("--chakra-skew-y"),scaleX:De.prop("--chakra-scale-x"),scaleY:De.prop("--chakra-scale-y"),scale:De.prop(["--chakra-scale-x","--chakra-scale-y"]),rotate:De.degreeT("--chakra-rotate")},PEe={listStyleType:!0,listStylePosition:!0,listStylePos:De.prop("listStylePosition"),listStyleImage:!0,listStyleImg:De.prop("listStyleImage")},NEe={transition:!0,transitionDelay:!0,animation:!0,willChange:!0,transitionDuration:De.prop("transitionDuration","transition.duration"),transitionProperty:De.prop("transitionProperty","transition.property"),transitionTimingFunction:De.prop("transitionTimingFunction","transition.easing")},rV=gh({},eP,Gr,gEe,xP,iu,_Ee,EEe,yEe,kJ,REe,uw,I2,Di,CEe,IEe,AEe,OEe,PEe,NEe),kEe=Object.assign({},Di,iu,xP,kJ,uw),DEe=Object.keys(kEe),LEe=[...Object.keys(rV),...PJ],xEe={...rV,...sS},MEe=r=>r in xEe,UEe=r=>t=>{if(!t.__breakpoints)return r;const{isResponsive:s,toArrayValue:a,media:l}=t.__breakpoints,d={};for(const p in r){let E=xc(r[p],t);if(E==null)continue;if(E=au(E)&&s(E)?a(E):E,!Array.isArray(E)){d[p]=E;continue}const v=E.slice(0,l.length).length;for(let b=0;b<v;b+=1){const R=l==null?void 0:l[b];if(!R){d[p]=E[b];continue}d[R]=d[R]||{},E[b]!=null&&(d[R][p]=E[b])}}return d};function VEe(r){const t=[];let s="",a=!1;for(let l=0;l<r.length;l++){const d=r[l];d==="("?(a=!0,s+=d):d===")"?(a=!1,s+=d):d===","&&!a?(t.push(s),s=""):s+=d}return s=s.trim(),s&&t.push(s),t}function FEe(r){return/^var\(--.+\)$/.test(r)}const jEe=(r,t)=>r.startsWith("--")&&typeof t=="string"&&!FEe(t),BEe=(r,t)=>{if(t==null)return t;const s=p=>{var E,v;return(v=(E=r.__cssMap)==null?void 0:E[p])==null?void 0:v.varRef},a=p=>s(p)??p,[l,d]=VEe(t);return t=s(l)??a(d)??a(t),t};function WEe(r){const{configs:t={},pseudos:s={},theme:a}=r,l=(d,p=!1)=>{var R;const E=xc(d,a),v=UEe(E)(a);let b={};for(let O in v){const N=v[O];let F=xc(N,a);O in s&&(O=s[O]),jEe(O,F)&&(F=BEe(a,F));let H=t[O];if(H===!0&&(H={property:O}),au(F)){b[O]=b[O]??{},b[O]=gh({},b[O],l(F,!0));continue}let z=((R=H==null?void 0:H.transform)==null?void 0:R.call(H,F,a,E))??F;z=H!=null&&H.processResult?l(z,!0):z;const G=xc(H==null?void 0:H.property,a);if(!p&&(H!=null&&H.static)){const ee=xc(H.static,a);b=gh({},b,ee)}if(G&&Array.isArray(G)){for(const ee of G)b[ee]=z;continue}if(G){G==="&"&&au(z)?b=gh({},b,z):b[G]=z;continue}if(au(z)){b=gh({},b,z);continue}b[O]=z}return b};return l}const DJ=r=>t=>WEe({theme:t,pseudos:sS,configs:rV})(r);function T6e(r){return r}function b6e(r){return r}function wi(r){return{definePartsStyle(t){return t},defineMultiStyleConfig(t){return{parts:r,...t}}}}function GEe(r,t,s){var a,l;return((l=(a=r.__cssMap)==null?void 0:a[`${t}.${s}`])==null?void 0:l.varRef)??s}function zEe(r,t){if(Array.isArray(r))return r;if(au(r))return t(r);if(r!=null)return[r]}function HEe(r,t){for(let s=t+1;s<r.length;s++)if(r[s]!=null)return s;return-1}function KEe(r){const t=r.__breakpoints;return function(a,l,d,p){var N,F;if(!t)return;const E={},v=zEe(d,t.toArrayValue);if(!v)return E;const b=v.length,R=b===1,O=!!a.parts;for(let H=0;H<b;H++){const z=t.details[H],G=t.details[HEe(v,H)],ee=Gb(z.minW,G==null?void 0:G._minW),J=xc((N=a[l])==null?void 0:N[v[H]],p);if(J){if(O){(F=a.parts)==null||F.forEach(re=>{gh(E,{[re]:R?J[re]:{[ee]:J[re]}})});continue}if(!O){R?gh(E,J):E[ee]=J;continue}E[ee]=J}}return E}}function qEe(r){return t=>{const{variant:s,size:a,theme:l}=t,d=KEe(l);return gh({},xc(r.baseStyle??{},t),d(r,"sizes",a,t),d(r,"variants",s,t))}}function zi(r){return sR(r,["styleConfig","size","variant","colorScheme"])}function LJ(r){return au(r)&&r.reference?r.reference:String(r)}const bN=(r,...t)=>t.map(LJ).join(` ${r} `).replace(/calc/g,""),eq=(...r)=>`calc(${bN("+",...r)})`,tq=(...r)=>`calc(${bN("-",...r)})`,A2=(...r)=>`calc(${bN("*",...r)})`,nq=(...r)=>`calc(${bN("/",...r)})`,rq=r=>{const t=LJ(r);return t!=null&&!Number.isNaN(parseFloat(t))?String(t).startsWith("-")?String(t).slice(1):`-${t}`:A2(t,-1)},Gf=Object.assign(r=>({add:(...t)=>Gf(eq(r,...t)),subtract:(...t)=>Gf(tq(r,...t)),multiply:(...t)=>Gf(A2(r,...t)),divide:(...t)=>Gf(nq(r,...t)),negate:()=>Gf(rq(r)),toString:()=>r.toString()}),{add:eq,subtract:tq,multiply:A2,divide:nq,negate:rq});function $Ee(r,t="-"){return r.replace(/\s+/g,t)}function YEe(r){const t=$Ee(r.toString());return JEe(XEe(t))}function XEe(r){return r.includes("\\.")?r:!Number.isInteger(parseFloat(r.toString()))?r.replace(".","\\."):r}function JEe(r){return r.replace(/[!-,/:-@[-^`{-~]/g,"\\$&")}function QEe(r,t=""){return[t,r].filter(Boolean).join("-")}function ZEe(r,t){return`var(${r}${t?`, ${t}`:""})`}function eye(r,t=""){return YEe(`--${QEe(r,t)}`)}function Cn(r,t,s){const a=eye(r,s);return{variable:a,reference:ZEe(a,t)}}function tye(r,t){const s={};for(const a of t){if(Array.isArray(a)){const[l,d]=a;s[l]=Cn(`${r}-${l}`,d);continue}s[a]=Cn(`${r}-${a}`)}return s}const nye=["colors","borders","borderWidths","borderStyles","fonts","fontSizes","fontWeights","gradients","letterSpacings","lineHeights","radii","space","shadows","sizes","zIndices","transition","blur","breakpoints"];function rye(r){return _J(r,nye)}function iye(r){return r.semanticTokens}function sye(r){const{__cssMap:t,__cssVars:s,__breakpoints:a,...l}=r;return l}function oye(r){const t=rye(r),s=iye(r),a=d=>PJ.includes(d)||d==="default",l={};return $K(t,(d,p)=>{d!=null&&(l[p.join(".")]={isSemantic:!1,value:d})}),$K(s,(d,p)=>{d!=null&&(l[p.join(".")]={isSemantic:!0,value:d})},{stop:d=>Object.keys(d).every(a)}),l}function iq(r,t){return Cn(String(r).replace(/\./g,"-"),void 0,t)}function aye(r){var p;const t=oye(r),s=(p=r.config)==null?void 0:p.cssVarPrefix;let a={};const l={};function d(E,v){const R=[String(E).split(".")[0],v].join(".");if(!t[R])return v;const{reference:N}=iq(R,s);return N}for(const[E,v]of Object.entries(t)){const{isSemantic:b,value:R}=v,{variable:O,reference:N}=iq(E,s);if(!b){if(E.startsWith("space")){const H=E.split("."),[z,...G]=H,ee=`${z}.-${G.join(".")}`,J=Gf.negate(R),re=Gf.negate(N);l[ee]={value:J,var:O,varRef:re}}a[O]=R,l[E]={value:R,var:O,varRef:N};continue}const F=au(R)?R:{default:R};a=gh(a,Object.entries(F).reduce((H,[z,G])=>{if(!G)return H;const ee=d(E,`${G}`);if(z==="default")return H[O]=ee,H;const J=(sS==null?void 0:sS[z])??z;return H[J]={[O]:ee},H},{})),l[E]={value:N,var:O,varRef:N}}return{cssVars:a,cssMap:l}}function cye(r){const t=sye(r),{cssMap:s,cssVars:a}=aye(t);return Object.assign(t,{__cssVars:{...{"--chakra-ring-inset":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-ring-offset-width":"0px","--chakra-ring-offset-color":"#fff","--chakra-ring-color":"rgba(66, 153, 225, 0.6)","--chakra-ring-offset-shadow":"0 0 #0000","--chakra-ring-shadow":"0 0 #0000","--chakra-space-x-reverse":"0","--chakra-space-y-reverse":"0"},...a},__cssMap:s,__breakpoints:n_e(t.breakpoints)}),t}function qr(r,t={}){let s=!1;function a(){if(!s){s=!0;return}throw new Error("[anatomy] .part(...) should only be called once. Did you mean to use .extend(...) ?")}function l(...R){a();for(const O of R)t[O]=v(O);return qr(r,t)}function d(...R){for(const O of R)O in t||(t[O]=v(O));return qr(r,t)}function p(){return Object.fromEntries(Object.entries(t).map(([O,N])=>[O,N.selector]))}function E(){return Object.fromEntries(Object.entries(t).map(([O,N])=>[O,N.className]))}function v(R){const F=`chakra-${(["container","root"].includes(R??"")?[r]:[r,R]).filter(Boolean).join("__")}`;return{className:F,selector:`.${F}`,toString:()=>R}}return{parts:l,toPart:v,extend:d,selectors:p,classnames:E,get keys(){return Object.keys(t)},__type:{}}}const lye=qr("accordion").parts("root","container","button","panel","icon"),uye=qr("alert").parts("title","description","container","icon","spinner"),dye=qr("avatar").parts("label","badge","container","excessLabel","group"),hye=qr("breadcrumb").parts("link","item","container","separator");qr("button").parts();const fye=qr("checkbox").parts("control","icon","container","label");qr("progress").parts("track","filledTrack","label");const pye=qr("drawer").parts("overlay","dialogContainer","dialog","header","closeButton","body","footer"),mye=qr("editable").parts("preview","input","textarea"),gye=qr("form").parts("container","requiredIndicator","helperText"),_ye=qr("formError").parts("text","icon"),Eye=qr("input").parts("addon","field","element","group"),yye=qr("list").parts("container","item","icon"),vye=qr("menu").parts("button","list","item","groupTitle","icon","command","divider"),Sye=qr("modal").parts("overlay","dialogContainer","dialog","header","closeButton","body","footer"),Tye=qr("numberinput").parts("root","field","stepperGroup","stepper");qr("pininput").parts("field");const bye=qr("popover").parts("content","header","body","footer","popper","arrow","closeButton"),wye=qr("progress").parts("label","filledTrack","track"),Rye=qr("radio").parts("container","control","label"),Cye=qr("select").parts("field","icon"),Iye=qr("slider").parts("container","track","thumb","filledTrack","mark"),Aye=qr("stat").parts("container","label","helpText","number","icon"),Oye=qr("switch").parts("container","track","thumb","label"),Pye=qr("table").parts("table","thead","tbody","tr","th","td","tfoot","caption"),Nye=qr("tabs").parts("root","tab","tablist","tabpanel","tabpanels","indicator"),kye=qr("tag").parts("container","label","closeButton"),Dye=qr("card").parts("container","header","body","footer");qr("stepper").parts("stepper","step","title","description","indicator","separator","icon","number");const{definePartsStyle:Lye,defineMultiStyleConfig:xye}=wi(lye.keys),Mye={borderTopWidth:"1px",borderColor:"inherit",_last:{borderBottomWidth:"1px"}},Uye={transitionProperty:"common",transitionDuration:"normal",fontSize:"md",_focusVisible:{boxShadow:"outline"},_hover:{bg:"blackAlpha.50"},_disabled:{opacity:.4,cursor:"not-allowed"},px:"4",py:"2"},Vye={pt:"2",px:"4",pb:"5"},Fye={fontSize:"1.25em"},jye=Lye({container:Mye,button:Uye,panel:Vye,icon:Fye}),Bye=xye({baseStyle:jye});function L_(r,t,s){return Math.min(Math.max(r,s),t)}class Wye extends Error{constructor(t){super(`Failed to parse color: "${t}"`)}}var Hb=Wye;function iV(r){if(typeof r!="string")throw new Hb(r);if(r.trim().toLowerCase()==="transparent")return[0,0,0,0];let t=r.trim();t=Xye.test(r)?Hye(r):r;const s=Kye.exec(t);if(s){const p=Array.from(s).slice(1);return[...p.slice(0,3).map(E=>parseInt(Aw(E,2),16)),parseInt(Aw(p[3]||"f",2),16)/255]}const a=qye.exec(t);if(a){const p=Array.from(a).slice(1);return[...p.slice(0,3).map(E=>parseInt(E,16)),parseInt(p[3]||"ff",16)/255]}const l=$ye.exec(t);if(l){const p=Array.from(l).slice(1);return[...p.slice(0,3).map(E=>parseInt(E,10)),parseFloat(p[3]||"1")]}const d=Yye.exec(t);if(d){const[p,E,v,b]=Array.from(d).slice(1).map(parseFloat);if(L_(0,100,E)!==E)throw new Hb(r);if(L_(0,100,v)!==v)throw new Hb(r);return[...Jye(p,E,v),Number.isNaN(b)?1:b]}throw new Hb(r)}function Gye(r){let t=5381,s=r.length;for(;s;)t=t*33^r.charCodeAt(--s);return(t>>>0)%2341}const sq=r=>parseInt(r.replace(/_/g,""),36),zye="1q29ehhb 1n09sgk7 1kl1ekf_ _yl4zsno 16z9eiv3 1p29lhp8 _bd9zg04 17u0____ _iw9zhe5 _to73___ _r45e31e _7l6g016 _jh8ouiv _zn3qba8 1jy4zshs 11u87k0u 1ro9yvyo 1aj3xael 1gz9zjz0 _3w8l4xo 1bf1ekf_ _ke3v___ _4rrkb__ 13j776yz _646mbhl _nrjr4__ _le6mbhl 1n37ehkb _m75f91n _qj3bzfz 1939yygw 11i5z6x8 _1k5f8xs 1509441m 15t5lwgf _ae2th1n _tg1ugcv 1lp1ugcv 16e14up_ _h55rw7n _ny9yavn _7a11xb_ 1ih442g9 _pv442g9 1mv16xof 14e6y7tu 1oo9zkds 17d1cisi _4v9y70f _y98m8kc 1019pq0v 12o9zda8 _348j4f4 1et50i2o _8epa8__ _ts6senj 1o350i2o 1mi9eiuo 1259yrp0 1ln80gnw _632xcoy 1cn9zldc _f29edu4 1n490c8q _9f9ziet 1b94vk74 _m49zkct 1kz6s73a 1eu9dtog _q58s1rz 1dy9sjiq __u89jo3 _aj5nkwg _ld89jo3 13h9z6wx _qa9z2ii _l119xgq _bs5arju 1hj4nwk9 1qt4nwk9 1ge6wau6 14j9zlcw 11p1edc_ _ms1zcxe _439shk6 _jt9y70f _754zsow 1la40eju _oq5p___ _x279qkz 1fa5r3rv _yd2d9ip _424tcku _8y1di2_ _zi2uabw _yy7rn9h 12yz980_ __39ljp6 1b59zg0x _n39zfzp 1fy9zest _b33k___ _hp9wq92 1il50hz4 _io472ub _lj9z3eo 19z9ykg0 _8t8iu3a 12b9bl4a 1ak5yw0o _896v4ku _tb8k8lv _s59zi6t _c09ze0p 1lg80oqn 1id9z8wb _238nba5 1kq6wgdi _154zssg _tn3zk49 _da9y6tc 1sg7cv4f _r12jvtt 1gq5fmkz 1cs9rvci _lp9jn1c _xw1tdnb 13f9zje6 16f6973h _vo7ir40 _bt5arjf _rc45e4t _hr4e100 10v4e100 _hc9zke2 _w91egv_ _sj2r1kk 13c87yx8 _vqpds__ _ni8ggk8 _tj9yqfb 1ia2j4r4 _7x9b10u 1fc9ld4j 1eq9zldr _5j9lhpx _ez9zl6o _md61fzm".split(" ").reduce((r,t)=>{const s=sq(t.substring(0,3)),a=sq(t.substring(3)).toString(16);let l="";for(let d=0;d<6-a.length;d++)l+="0";return r[s]=`${l}${a}`,r},{});function Hye(r){const t=r.toLowerCase().trim(),s=zye[Gye(t)];if(!s)throw new Hb(r);return`#${s}`}const Aw=(r,t)=>Array.from(Array(t)).map(()=>r).join(""),Kye=new RegExp(`^#${Aw("([a-f0-9])",3)}([a-f0-9])?$`,"i"),qye=new RegExp(`^#${Aw("([a-f0-9]{2})",3)}([a-f0-9]{2})?$`,"i"),$ye=new RegExp(`^rgba?\\(\\s*(\\d+)\\s*${Aw(",\\s*(\\d+)\\s*",2)}(?:,\\s*([\\d.]+))?\\s*\\)$`,"i"),Yye=/^hsla?\(\s*([\d.]+)\s*,\s*([\d.]+)%\s*,\s*([\d.]+)%(?:\s*,\s*([\d.]+))?\s*\)$/i,Xye=/^[a-z]+$/i,oq=r=>Math.round(r*255),Jye=(r,t,s)=>{let a=s/100;if(t===0)return[a,a,a].map(oq);const l=(r%360+360)%360/60,d=(1-Math.abs(2*a-1))*(t/100),p=d*(1-Math.abs(l%2-1));let E=0,v=0,b=0;l>=0&&l<1?(E=d,v=p):l>=1&&l<2?(E=p,v=d):l>=2&&l<3?(v=d,b=p):l>=3&&l<4?(v=p,b=d):l>=4&&l<5?(E=p,b=d):l>=5&&l<6&&(E=d,b=p);const R=a-d/2,O=E+R,N=v+R,F=b+R;return[O,N,F].map(oq)};function Qye(r,t,s,a){return`rgba(${L_(0,255,r).toFixed()}, ${L_(0,255,t).toFixed()}, ${L_(0,255,s).toFixed()}, ${parseFloat(L_(0,1,a).toFixed(3))})`}function Zye(r,t){const[s,a,l,d]=iV(r);return Qye(s,a,l,d-t)}function eve(r){const[t,s,a,l]=iV(r);let d=p=>{const E=L_(0,255,p).toString(16);return E.length===1?`0${E}`:E};return`#${d(t)}${d(s)}${d(a)}${l<1?d(Math.round(l*255)):""}`}const tve=r=>Object.keys(r).length===0;function nve(r,t,s,a,l){for(t=t.split?t.split("."):t,a=0;a<t.length;a++)r=r?r[t[a]]:l;return r===l?s:r}const Ha=(r,t,s)=>{const a=nve(r,`colors.${t}`,t);try{return eve(a),a}catch{return s??"#000000"}},rve=r=>{const[t,s,a]=iV(r);return(t*299+s*587+a*114)/1e3},ive=r=>t=>{const s=Ha(t,r);return rve(s)<128?"dark":"light"},sve=r=>t=>ive(r)(t)==="dark",yS=(r,t)=>s=>{const a=Ha(s,r);return Zye(a,1-t)};function aq(r="1rem",t="rgba(255, 255, 255, 0.15)"){return{backgroundImage:`linear-gradient(
    45deg,
    ${t} 25%,
    transparent 25%,
    transparent 50%,
    ${t} 50%,
    ${t} 75%,
    transparent 75%,
    transparent
  )`,backgroundSize:`${r} ${r}`}}const ove=()=>`#${Math.floor(Math.random()*16777215).toString(16).padEnd(6,"0")}`;function ave(r){const t=ove();return!r||tve(r)?t:r.string&&r.colors?lve(r.string,r.colors):r.string&&!r.colors?cve(r.string):r.colors&&!r.string?uve(r.colors):t}function cve(r){let t=0;if(r.length===0)return t.toString();for(let a=0;a<r.length;a+=1)t=r.charCodeAt(a)+((t<<5)-t),t=t&t;let s="#";for(let a=0;a<3;a+=1){const l=t>>a*8&255;s+=`00${l.toString(16)}`.substr(-2)}return s}function lve(r,t){let s=0;if(r.length===0)return t[0];for(let a=0;a<r.length;a+=1)s=r.charCodeAt(a)+((s<<5)-s),s=s&s;return s=(s%t.length+t.length)%t.length,t[s]}function uve(r){return r[Math.floor(Math.random()*r.length)]}function Rn(r,t){return s=>s.colorMode==="dark"?t:r}function sV(r){const{orientation:t,vertical:s,horizontal:a}=r;return t?t==="vertical"?s:a:{}}function xJ(r){return au(r)&&r.reference?r.reference:String(r)}const wN=(r,...t)=>t.map(xJ).join(` ${r} `).replace(/calc/g,""),cq=(...r)=>`calc(${wN("+",...r)})`,lq=(...r)=>`calc(${wN("-",...r)})`,O2=(...r)=>`calc(${wN("*",...r)})`,uq=(...r)=>`calc(${wN("/",...r)})`,dq=r=>{const t=xJ(r);return t!=null&&!Number.isNaN(parseFloat(t))?String(t).startsWith("-")?String(t).slice(1):`-${t}`:O2(t,-1)},zf=Object.assign(r=>({add:(...t)=>zf(cq(r,...t)),subtract:(...t)=>zf(lq(r,...t)),multiply:(...t)=>zf(O2(r,...t)),divide:(...t)=>zf(uq(r,...t)),negate:()=>zf(dq(r)),toString:()=>r.toString()}),{add:cq,subtract:lq,multiply:O2,divide:uq,negate:dq});function dve(r){return!Number.isInteger(parseFloat(r.toString()))}function hve(r,t="-"){return r.replace(/\s+/g,t)}function MJ(r){const t=hve(r.toString());return t.includes("\\.")?r:dve(r)?t.replace(".","\\."):r}function fve(r,t=""){return[t,MJ(r)].filter(Boolean).join("-")}function pve(r,t){return`var(${MJ(r)}${t?`, ${t}`:""})`}function mve(r,t=""){return`--${fve(r,t)}`}function Qs(r,t){const s=mve(r,t==null?void 0:t.prefix);return{variable:s,reference:pve(s,gve(t==null?void 0:t.fallback))}}function gve(r){return r==null?void 0:r.reference}const{definePartsStyle:aR,defineMultiStyleConfig:_ve}=wi(uye.keys),pl=Cn("alert-fg"),tp=Cn("alert-bg"),Eve=aR({container:{bg:tp.reference,px:"4",py:"3"},title:{fontWeight:"bold",lineHeight:"6",marginEnd:"2"},description:{lineHeight:"6"},icon:{color:pl.reference,flexShrink:0,marginEnd:"3",w:"5",h:"6"},spinner:{color:pl.reference,flexShrink:0,marginEnd:"3",w:"5",h:"5"}});function oV(r){const{theme:t,colorScheme:s}=r,a=yS(`${s}.200`,.16)(t);return{light:`colors.${s}.100`,dark:a}}const yve=aR(r=>{const{colorScheme:t}=r,s=oV(r);return{container:{[pl.variable]:`colors.${t}.600`,[tp.variable]:s.light,_dark:{[pl.variable]:`colors.${t}.200`,[tp.variable]:s.dark}}}}),vve=aR(r=>{const{colorScheme:t}=r,s=oV(r);return{container:{[pl.variable]:`colors.${t}.600`,[tp.variable]:s.light,_dark:{[pl.variable]:`colors.${t}.200`,[tp.variable]:s.dark},paddingStart:"3",borderStartWidth:"4px",borderStartColor:pl.reference}}}),Sve=aR(r=>{const{colorScheme:t}=r,s=oV(r);return{container:{[pl.variable]:`colors.${t}.600`,[tp.variable]:s.light,_dark:{[pl.variable]:`colors.${t}.200`,[tp.variable]:s.dark},pt:"2",borderTopWidth:"4px",borderTopColor:pl.reference}}}),Tve=aR(r=>{const{colorScheme:t}=r;return{container:{[pl.variable]:"colors.white",[tp.variable]:`colors.${t}.600`,_dark:{[pl.variable]:"colors.gray.900",[tp.variable]:`colors.${t}.200`},color:pl.reference}}}),bve={subtle:yve,"left-accent":vve,"top-accent":Sve,solid:Tve},wve=_ve({baseStyle:Eve,variants:bve,defaultProps:{variant:"subtle",colorScheme:"blue"}}),UJ={px:"1px",.5:"0.125rem",1:"0.25rem",1.5:"0.375rem",2:"0.5rem",2.5:"0.625rem",3:"0.75rem",3.5:"0.875rem",4:"1rem",5:"1.25rem",6:"1.5rem",7:"1.75rem",8:"2rem",9:"2.25rem",10:"2.5rem",12:"3rem",14:"3.5rem",16:"4rem",20:"5rem",24:"6rem",28:"7rem",32:"8rem",36:"9rem",40:"10rem",44:"11rem",48:"12rem",52:"13rem",56:"14rem",60:"15rem",64:"16rem",72:"18rem",80:"20rem",96:"24rem"},Rve={max:"max-content",min:"min-content",full:"100%","3xs":"14rem","2xs":"16rem",xs:"20rem",sm:"24rem",md:"28rem",lg:"32rem",xl:"36rem","2xl":"42rem","3xl":"48rem","4xl":"56rem","5xl":"64rem","6xl":"72rem","7xl":"80rem","8xl":"90rem",prose:"60ch"},Cve={sm:"640px",md:"768px",lg:"1024px",xl:"1280px"},VJ={...UJ,...Rve,container:Cve},Ive=r=>typeof r=="function";function Ka(r,...t){return Ive(r)?r(...t):r}const{definePartsStyle:FJ,defineMultiStyleConfig:Ave}=wi(dye.keys),oS=Cn("avatar-border-color"),dw=Cn("avatar-bg"),Ow=Cn("avatar-font-size"),vS=Cn("avatar-size"),Ove={borderRadius:"full",border:"0.2em solid",borderColor:oS.reference,[oS.variable]:"white",_dark:{[oS.variable]:"colors.gray.800"}},Pve={bg:dw.reference,fontSize:Ow.reference,width:vS.reference,height:vS.reference,lineHeight:"1",[dw.variable]:"colors.gray.200",_dark:{[dw.variable]:"colors.whiteAlpha.400"}},Nve=r=>{const{name:t,theme:s}=r,a=t?ave({string:t}):"colors.gray.400",l=sve(a)(s);let d="white";return l||(d="gray.800"),{bg:dw.reference,fontSize:Ow.reference,color:d,borderColor:oS.reference,verticalAlign:"top",width:vS.reference,height:vS.reference,"&:not([data-loaded])":{[dw.variable]:a},[oS.variable]:"colors.white",_dark:{[oS.variable]:"colors.gray.800"}}},kve={fontSize:Ow.reference,lineHeight:"1"},Dve=FJ(r=>({badge:Ka(Ove,r),excessLabel:Ka(Pve,r),container:Ka(Nve,r),label:kve}));function Em(r){const t=r!=="100%"?VJ[r]:void 0;return FJ({container:{[vS.variable]:t??r,[Ow.variable]:`calc(${t??r} / 2.5)`},excessLabel:{[vS.variable]:t??r,[Ow.variable]:`calc(${t??r} / 2.5)`}})}const Lve={"2xs":Em(4),xs:Em(6),sm:Em(8),md:Em(12),lg:Em(16),xl:Em(24),"2xl":Em(32),full:Em("100%")},xve=Ave({baseStyle:Dve,sizes:Lve,defaultProps:{size:"md"}}),ws=tye("badge",["bg","color","shadow"]),Mve={px:1,textTransform:"uppercase",fontSize:"xs",borderRadius:"sm",fontWeight:"bold",bg:ws.bg.reference,color:ws.color.reference,boxShadow:ws.shadow.reference},Uve=r=>{const{colorScheme:t,theme:s}=r,a=yS(`${t}.500`,.6)(s);return{[ws.bg.variable]:`colors.${t}.500`,[ws.color.variable]:"colors.white",_dark:{[ws.bg.variable]:a,[ws.color.variable]:"colors.whiteAlpha.800"}}},Vve=r=>{const{colorScheme:t,theme:s}=r,a=yS(`${t}.200`,.16)(s);return{[ws.bg.variable]:`colors.${t}.100`,[ws.color.variable]:`colors.${t}.800`,_dark:{[ws.bg.variable]:a,[ws.color.variable]:`colors.${t}.200`}}},Fve=r=>{const{colorScheme:t,theme:s}=r,a=yS(`${t}.200`,.8)(s);return{[ws.color.variable]:`colors.${t}.500`,_dark:{[ws.color.variable]:a},[ws.shadow.variable]:`inset 0 0 0px 1px ${ws.color.reference}`}},jve={solid:Uve,subtle:Vve,outline:Fve},hw={baseStyle:Mve,variants:jve,defaultProps:{variant:"subtle",colorScheme:"gray"}},{defineMultiStyleConfig:Bve,definePartsStyle:Wve}=wi(hye.keys),aM=Cn("breadcrumb-link-decor"),Gve={transitionProperty:"common",transitionDuration:"fast",transitionTimingFunction:"ease-out",outline:"none",color:"inherit",textDecoration:aM.reference,[aM.variable]:"none","&:not([aria-current=page])":{cursor:"pointer",_hover:{[aM.variable]:"underline"},_focusVisible:{boxShadow:"outline"}}},zve=Wve({link:Gve}),Hve=Bve({baseStyle:zve}),Kve={lineHeight:"1.2",borderRadius:"md",fontWeight:"semibold",transitionProperty:"common",transitionDuration:"normal",_focusVisible:{boxShadow:"outline"},_disabled:{opacity:.4,cursor:"not-allowed",boxShadow:"none"},_hover:{_disabled:{bg:"initial"}}},jJ=r=>{const{colorScheme:t,theme:s}=r;if(t==="gray")return{color:Rn("gray.800","whiteAlpha.900")(r),_hover:{bg:Rn("gray.100","whiteAlpha.200")(r)},_active:{bg:Rn("gray.200","whiteAlpha.300")(r)}};const a=yS(`${t}.200`,.12)(s),l=yS(`${t}.200`,.24)(s);return{color:Rn(`${t}.600`,`${t}.200`)(r),bg:"transparent",_hover:{bg:Rn(`${t}.50`,a)(r)},_active:{bg:Rn(`${t}.100`,l)(r)}}},qve=r=>{const{colorScheme:t}=r,s=Rn("gray.200","whiteAlpha.300")(r);return{border:"1px solid",borderColor:t==="gray"?s:"currentColor",".chakra-button__group[data-attached][data-orientation=horizontal] > &:not(:last-of-type)":{marginEnd:"-1px"},".chakra-button__group[data-attached][data-orientation=vertical] > &:not(:last-of-type)":{marginBottom:"-1px"},...Ka(jJ,r)}},$ve={yellow:{bg:"yellow.400",color:"black",hoverBg:"yellow.500",activeBg:"yellow.600"},cyan:{bg:"cyan.400",color:"black",hoverBg:"cyan.500",activeBg:"cyan.600"}},Yve=r=>{const{colorScheme:t}=r;if(t==="gray"){const E=Rn("gray.100","whiteAlpha.200")(r);return{bg:E,color:Rn("gray.800","whiteAlpha.900")(r),_hover:{bg:Rn("gray.200","whiteAlpha.300")(r),_disabled:{bg:E}},_active:{bg:Rn("gray.300","whiteAlpha.400")(r)}}}const{bg:s=`${t}.500`,color:a="white",hoverBg:l=`${t}.600`,activeBg:d=`${t}.700`}=$ve[t]??{},p=Rn(s,`${t}.200`)(r);return{bg:p,color:Rn(a,"gray.800")(r),_hover:{bg:Rn(l,`${t}.300`)(r),_disabled:{bg:p}},_active:{bg:Rn(d,`${t}.400`)(r)}}},Xve=r=>{const{colorScheme:t}=r;return{padding:0,height:"auto",lineHeight:"normal",verticalAlign:"baseline",color:Rn(`${t}.500`,`${t}.200`)(r),_hover:{textDecoration:"underline",_disabled:{textDecoration:"none"}},_active:{color:Rn(`${t}.700`,`${t}.500`)(r)}}},Jve={bg:"none",color:"inherit",display:"inline",lineHeight:"inherit",m:"0",p:"0"},Qve={ghost:jJ,outline:qve,solid:Yve,link:Xve,unstyled:Jve},Zve={lg:{h:"12",minW:"12",fontSize:"lg",px:"6"},md:{h:"10",minW:"10",fontSize:"md",px:"4"},sm:{h:"8",minW:"8",fontSize:"sm",px:"3"},xs:{h:"6",minW:"6",fontSize:"xs",px:"2"}},eSe={baseStyle:Kve,variants:Qve,sizes:Zve,defaultProps:{variant:"solid",size:"md",colorScheme:"gray"}},{definePartsStyle:V_,defineMultiStyleConfig:tSe}=wi(Dye.keys),MP=Cn("card-bg"),Xf=Cn("card-padding"),BJ=Cn("card-shadow"),tP=Cn("card-radius"),WJ=Cn("card-border-width","0"),GJ=Cn("card-border-color"),nSe=V_({container:{[MP.variable]:"colors.chakra-body-bg",backgroundColor:MP.reference,boxShadow:BJ.reference,borderRadius:tP.reference,color:"chakra-body-text",borderWidth:WJ.reference,borderColor:GJ.reference},body:{padding:Xf.reference,flex:"1 1 0%"},header:{padding:Xf.reference},footer:{padding:Xf.reference}}),rSe={sm:V_({container:{[tP.variable]:"radii.base",[Xf.variable]:"space.3"}}),md:V_({container:{[tP.variable]:"radii.md",[Xf.variable]:"space.5"}}),lg:V_({container:{[tP.variable]:"radii.xl",[Xf.variable]:"space.7"}})},iSe={elevated:V_({container:{[BJ.variable]:"shadows.base",_dark:{[MP.variable]:"colors.gray.700"}}}),outline:V_({container:{[WJ.variable]:"1px",[GJ.variable]:"colors.chakra-border-color"}}),filled:V_({container:{[MP.variable]:"colors.chakra-subtle-bg"}}),unstyled:{body:{[Xf.variable]:0},header:{[Xf.variable]:0},footer:{[Xf.variable]:0}}},sSe=tSe({baseStyle:nSe,variants:iSe,sizes:rSe,defaultProps:{variant:"elevated",size:"md"}}),{definePartsStyle:nP,defineMultiStyleConfig:oSe}=wi(fye.keys),fw=Cn("checkbox-size"),aSe=r=>{const{colorScheme:t}=r;return{w:fw.reference,h:fw.reference,transitionProperty:"box-shadow",transitionDuration:"normal",border:"2px solid",borderRadius:"sm",borderColor:"inherit",color:"white",_checked:{bg:Rn(`${t}.500`,`${t}.200`)(r),borderColor:Rn(`${t}.500`,`${t}.200`)(r),color:Rn("white","gray.900")(r),_hover:{bg:Rn(`${t}.600`,`${t}.300`)(r),borderColor:Rn(`${t}.600`,`${t}.300`)(r)},_disabled:{borderColor:Rn("gray.200","transparent")(r),bg:Rn("gray.200","whiteAlpha.300")(r),color:Rn("gray.500","whiteAlpha.500")(r)}},_indeterminate:{bg:Rn(`${t}.500`,`${t}.200`)(r),borderColor:Rn(`${t}.500`,`${t}.200`)(r),color:Rn("white","gray.900")(r)},_disabled:{bg:Rn("gray.100","whiteAlpha.100")(r),borderColor:Rn("gray.100","transparent")(r)},_focusVisible:{boxShadow:"outline"},_invalid:{borderColor:Rn("red.500","red.300")(r)}}},cSe={_disabled:{cursor:"not-allowed"}},lSe={userSelect:"none",_disabled:{opacity:.4}},uSe={transitionProperty:"transform",transitionDuration:"normal"},dSe=nP(r=>({icon:uSe,container:cSe,control:Ka(aSe,r),label:lSe})),hSe={sm:nP({control:{[fw.variable]:"sizes.3"},label:{fontSize:"sm"},icon:{fontSize:"3xs"}}),md:nP({control:{[fw.variable]:"sizes.4"},label:{fontSize:"md"},icon:{fontSize:"2xs"}}),lg:nP({control:{[fw.variable]:"sizes.5"},label:{fontSize:"lg"},icon:{fontSize:"2xs"}})},bm=oSe({baseStyle:dSe,sizes:hSe,defaultProps:{size:"md",colorScheme:"blue"}}),pw=Qs("close-button-size"),Tb=Qs("close-button-bg"),fSe={w:[pw.reference],h:[pw.reference],borderRadius:"md",transitionProperty:"common",transitionDuration:"normal",_disabled:{opacity:.4,cursor:"not-allowed",boxShadow:"none"},_hover:{[Tb.variable]:"colors.blackAlpha.100",_dark:{[Tb.variable]:"colors.whiteAlpha.100"}},_active:{[Tb.variable]:"colors.blackAlpha.200",_dark:{[Tb.variable]:"colors.whiteAlpha.200"}},_focusVisible:{boxShadow:"outline"},bg:Tb.reference},pSe={lg:{[pw.variable]:"sizes.10",fontSize:"md"},md:{[pw.variable]:"sizes.8",fontSize:"xs"},sm:{[pw.variable]:"sizes.6",fontSize:"2xs"}},mSe={baseStyle:fSe,sizes:pSe,defaultProps:{size:"md"}},{variants:gSe,defaultProps:_Se}=hw,ESe={fontFamily:"mono",fontSize:"sm",px:"0.2em",borderRadius:"sm",bg:ws.bg.reference,color:ws.color.reference,boxShadow:ws.shadow.reference},ySe={baseStyle:ESe,variants:gSe,defaultProps:_Se},vSe={w:"100%",mx:"auto",maxW:"prose",px:"4"},SSe={baseStyle:vSe},TSe={opacity:.6,borderColor:"inherit"},bSe={borderStyle:"solid"},wSe={borderStyle:"dashed"},RSe={solid:bSe,dashed:wSe},CSe={baseStyle:TSe,variants:RSe,defaultProps:{variant:"solid"}},{definePartsStyle:P2,defineMultiStyleConfig:ISe}=wi(pye.keys),cM=Cn("drawer-bg"),lM=Cn("drawer-box-shadow");function Pv(r){return P2(r==="full"?{dialog:{maxW:"100vw",h:"100vh"}}:{dialog:{maxW:r}})}const ASe={bg:"blackAlpha.600",zIndex:"modal"},OSe={display:"flex",zIndex:"modal",justifyContent:"center"},PSe=r=>{const{isFullHeight:t}=r;return{...t&&{height:"100vh"},zIndex:"modal",maxH:"100vh",color:"inherit",[cM.variable]:"colors.white",[lM.variable]:"shadows.lg",_dark:{[cM.variable]:"colors.gray.700",[lM.variable]:"shadows.dark-lg"},bg:cM.reference,boxShadow:lM.reference}},NSe={px:"6",py:"4",fontSize:"xl",fontWeight:"semibold"},kSe={position:"absolute",top:"2",insetEnd:"3"},DSe={px:"6",py:"2",flex:"1",overflow:"auto"},LSe={px:"6",py:"4"},xSe=P2(r=>({overlay:ASe,dialogContainer:OSe,dialog:Ka(PSe,r),header:NSe,closeButton:kSe,body:DSe,footer:LSe})),MSe={xs:Pv("xs"),sm:Pv("md"),md:Pv("lg"),lg:Pv("2xl"),xl:Pv("4xl"),full:Pv("full")},USe=ISe({baseStyle:xSe,sizes:MSe,defaultProps:{size:"xs"}}),{definePartsStyle:VSe,defineMultiStyleConfig:FSe}=wi(mye.keys),jSe={borderRadius:"md",py:"1",transitionProperty:"common",transitionDuration:"normal"},BSe={borderRadius:"md",py:"1",transitionProperty:"common",transitionDuration:"normal",width:"full",_focusVisible:{boxShadow:"outline"},_placeholder:{opacity:.6}},WSe={borderRadius:"md",py:"1",transitionProperty:"common",transitionDuration:"normal",width:"full",_focusVisible:{boxShadow:"outline"},_placeholder:{opacity:.6}},GSe=VSe({preview:jSe,input:BSe,textarea:WSe}),zSe=FSe({baseStyle:GSe}),{definePartsStyle:HSe,defineMultiStyleConfig:KSe}=wi(gye.keys),aS=Cn("form-control-color"),qSe={marginStart:"1",[aS.variable]:"colors.red.500",_dark:{[aS.variable]:"colors.red.300"},color:aS.reference},$Se={mt:"2",[aS.variable]:"colors.gray.600",_dark:{[aS.variable]:"colors.whiteAlpha.600"},color:aS.reference,lineHeight:"normal",fontSize:"sm"},YSe=HSe({container:{width:"100%",position:"relative"},requiredIndicator:qSe,helperText:$Se}),XSe=KSe({baseStyle:YSe}),{definePartsStyle:JSe,defineMultiStyleConfig:QSe}=wi(_ye.keys),cS=Cn("form-error-color"),ZSe={[cS.variable]:"colors.red.500",_dark:{[cS.variable]:"colors.red.300"},color:cS.reference,mt:"2",fontSize:"sm",lineHeight:"normal"},eTe={marginEnd:"0.5em",[cS.variable]:"colors.red.500",_dark:{[cS.variable]:"colors.red.300"},color:cS.reference},tTe=JSe({text:ZSe,icon:eTe}),nTe=QSe({baseStyle:tTe}),rTe={fontSize:"md",marginEnd:"3",mb:"2",fontWeight:"medium",transitionProperty:"common",transitionDuration:"normal",opacity:1,_disabled:{opacity:.4}},iTe={baseStyle:rTe},sTe={fontFamily:"heading",fontWeight:"bold"},oTe={"4xl":{fontSize:["6xl",null,"7xl"],lineHeight:1},"3xl":{fontSize:["5xl",null,"6xl"],lineHeight:1},"2xl":{fontSize:["4xl",null,"5xl"],lineHeight:[1.2,null,1]},xl:{fontSize:["3xl",null,"4xl"],lineHeight:[1.33,null,1.2]},lg:{fontSize:["2xl",null,"3xl"],lineHeight:[1.33,null,1.2]},md:{fontSize:"xl",lineHeight:1.2},sm:{fontSize:"md",lineHeight:1.2},xs:{fontSize:"sm",lineHeight:1.2}},aTe={baseStyle:sTe,sizes:oTe,defaultProps:{size:"xl"}},{definePartsStyle:Kf,defineMultiStyleConfig:cTe}=wi(Eye.keys),zv=Cn("input-height"),Hv=Cn("input-font-size"),Kv=Cn("input-padding"),qv=Cn("input-border-radius"),lTe=Kf({addon:{height:zv.reference,fontSize:Hv.reference,px:Kv.reference,borderRadius:qv.reference},field:{width:"100%",height:zv.reference,fontSize:Hv.reference,px:Kv.reference,borderRadius:qv.reference,minWidth:0,outline:0,position:"relative",appearance:"none",transitionProperty:"common",transitionDuration:"normal",_disabled:{opacity:.4,cursor:"not-allowed"}}}),ym={lg:{[Hv.variable]:"fontSizes.lg",[Kv.variable]:"space.4",[qv.variable]:"radii.md",[zv.variable]:"sizes.12"},md:{[Hv.variable]:"fontSizes.md",[Kv.variable]:"space.4",[qv.variable]:"radii.md",[zv.variable]:"sizes.10"},sm:{[Hv.variable]:"fontSizes.sm",[Kv.variable]:"space.3",[qv.variable]:"radii.sm",[zv.variable]:"sizes.8"},xs:{[Hv.variable]:"fontSizes.xs",[Kv.variable]:"space.2",[qv.variable]:"radii.sm",[zv.variable]:"sizes.6"}},uTe={lg:Kf({field:ym.lg,group:ym.lg}),md:Kf({field:ym.md,group:ym.md}),sm:Kf({field:ym.sm,group:ym.sm}),xs:Kf({field:ym.xs,group:ym.xs})};function aV(r){const{focusBorderColor:t,errorBorderColor:s}=r;return{focusBorderColor:t||Rn("blue.500","blue.300")(r),errorBorderColor:s||Rn("red.500","red.300")(r)}}const dTe=Kf(r=>{const{theme:t}=r,{focusBorderColor:s,errorBorderColor:a}=aV(r);return{field:{border:"1px solid",borderColor:"inherit",bg:"inherit",_hover:{borderColor:Rn("gray.300","whiteAlpha.400")(r)},_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:Ha(t,a),boxShadow:`0 0 0 1px ${Ha(t,a)}`},_focusVisible:{zIndex:1,borderColor:Ha(t,s),boxShadow:`0 0 0 1px ${Ha(t,s)}`}},addon:{border:"1px solid",borderColor:Rn("inherit","whiteAlpha.50")(r),bg:Rn("gray.100","whiteAlpha.300")(r)}}}),hTe=Kf(r=>{const{theme:t}=r,{focusBorderColor:s,errorBorderColor:a}=aV(r);return{field:{border:"2px solid",borderColor:"transparent",bg:Rn("gray.100","whiteAlpha.50")(r),_hover:{bg:Rn("gray.200","whiteAlpha.100")(r)},_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:Ha(t,a)},_focusVisible:{bg:"transparent",borderColor:Ha(t,s)}},addon:{border:"2px solid",borderColor:"transparent",bg:Rn("gray.100","whiteAlpha.50")(r)}}}),fTe=Kf(r=>{const{theme:t}=r,{focusBorderColor:s,errorBorderColor:a}=aV(r);return{field:{borderBottom:"1px solid",borderColor:"inherit",borderRadius:"0",px:"0",bg:"transparent",_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:Ha(t,a),boxShadow:`0px 1px 0px 0px ${Ha(t,a)}`},_focusVisible:{borderColor:Ha(t,s),boxShadow:`0px 1px 0px 0px ${Ha(t,s)}`}},addon:{borderBottom:"2px solid",borderColor:"inherit",borderRadius:"0",px:"0",bg:"transparent"}}}),pTe=Kf({field:{bg:"transparent",px:"0",height:"auto"},addon:{bg:"transparent",px:"0",height:"auto"}}),mTe={outline:dTe,filled:hTe,flushed:fTe,unstyled:pTe},Kr=cTe({baseStyle:lTe,sizes:uTe,variants:mTe,defaultProps:{size:"md",variant:"outline"}}),uM=Cn("kbd-bg"),gTe={[uM.variable]:"colors.gray.100",_dark:{[uM.variable]:"colors.whiteAlpha.100"},bg:uM.reference,borderRadius:"md",borderWidth:"1px",borderBottomWidth:"3px",fontSize:"0.8em",fontWeight:"bold",lineHeight:"normal",px:"0.4em",whiteSpace:"nowrap"},_Te={baseStyle:gTe},ETe={transitionProperty:"common",transitionDuration:"fast",transitionTimingFunction:"ease-out",cursor:"pointer",textDecoration:"none",outline:"none",color:"inherit",_hover:{textDecoration:"underline"},_focusVisible:{boxShadow:"outline"}},yTe={baseStyle:ETe},{defineMultiStyleConfig:vTe,definePartsStyle:STe}=wi(yye.keys),TTe={marginEnd:"2",display:"inline",verticalAlign:"text-bottom"},bTe=STe({icon:TTe}),wTe=vTe({baseStyle:bTe}),{defineMultiStyleConfig:RTe,definePartsStyle:CTe}=wi(vye.keys),ch=Cn("menu-bg"),dM=Cn("menu-shadow"),ITe={[ch.variable]:"#fff",[dM.variable]:"shadows.sm",_dark:{[ch.variable]:"colors.gray.700",[dM.variable]:"shadows.dark-lg"},color:"inherit",minW:"3xs",py:"2",zIndex:"dropdown",borderRadius:"md",borderWidth:"1px",bg:ch.reference,boxShadow:dM.reference},ATe={py:"1.5",px:"3",transitionProperty:"background",transitionDuration:"ultra-fast",transitionTimingFunction:"ease-in",_focus:{[ch.variable]:"colors.gray.100",_dark:{[ch.variable]:"colors.whiteAlpha.100"}},_active:{[ch.variable]:"colors.gray.200",_dark:{[ch.variable]:"colors.whiteAlpha.200"}},_expanded:{[ch.variable]:"colors.gray.100",_dark:{[ch.variable]:"colors.whiteAlpha.100"}},_disabled:{opacity:.4,cursor:"not-allowed"},bg:ch.reference},OTe={mx:4,my:2,fontWeight:"semibold",fontSize:"sm"},PTe={display:"inline-flex",alignItems:"center",justifyContent:"center",flexShrink:0},NTe={opacity:.6},kTe={border:0,borderBottom:"1px solid",borderColor:"inherit",my:"2",opacity:.6},DTe={transitionProperty:"common",transitionDuration:"normal"},LTe=CTe({button:DTe,list:ITe,item:ATe,groupTitle:OTe,icon:PTe,command:NTe,divider:kTe}),xTe=RTe({baseStyle:LTe}),{defineMultiStyleConfig:MTe,definePartsStyle:N2}=wi(Sye.keys),hM=Cn("modal-bg"),fM=Cn("modal-shadow"),UTe={bg:"blackAlpha.600",zIndex:"modal"},VTe=r=>{const{isCentered:t,scrollBehavior:s}=r;return{display:"flex",zIndex:"modal",justifyContent:"center",alignItems:t?"center":"flex-start",overflow:s==="inside"?"hidden":"auto",overscrollBehaviorY:"none"}},FTe=r=>{const{isCentered:t,scrollBehavior:s}=r;return{borderRadius:"md",color:"inherit",my:t?"auto":"16",mx:t?"auto":void 0,zIndex:"modal",maxH:s==="inside"?"calc(100% - 7.5rem)":void 0,[hM.variable]:"colors.white",[fM.variable]:"shadows.lg",_dark:{[hM.variable]:"colors.gray.700",[fM.variable]:"shadows.dark-lg"},bg:hM.reference,boxShadow:fM.reference}},jTe={px:"6",py:"4",fontSize:"xl",fontWeight:"semibold"},BTe={position:"absolute",top:"2",insetEnd:"3"},WTe=r=>{const{scrollBehavior:t}=r;return{px:"6",py:"2",flex:"1",overflow:t==="inside"?"auto":void 0}},GTe={px:"6",py:"4"},zTe=N2(r=>({overlay:UTe,dialogContainer:Ka(VTe,r),dialog:Ka(FTe,r),header:jTe,closeButton:BTe,body:Ka(WTe,r),footer:GTe}));function id(r){return N2(r==="full"?{dialog:{maxW:"100vw",minH:"$100vh",my:"0",borderRadius:"0"}}:{dialog:{maxW:r}})}const HTe={xs:id("xs"),sm:id("sm"),md:id("md"),lg:id("lg"),xl:id("xl"),"2xl":id("2xl"),"3xl":id("3xl"),"4xl":id("4xl"),"5xl":id("5xl"),"6xl":id("6xl"),full:id("full")},KTe=MTe({baseStyle:zTe,sizes:HTe,defaultProps:{size:"md"}}),zJ={letterSpacings:{tighter:"-0.05em",tight:"-0.025em",normal:"0",wide:"0.025em",wider:"0.05em",widest:"0.1em"},lineHeights:{normal:"normal",none:1,shorter:1.25,short:1.375,base:1.5,tall:1.625,taller:"2",3:".75rem",4:"1rem",5:"1.25rem",6:"1.5rem",7:"1.75rem",8:"2rem",9:"2.25rem",10:"2.5rem"},fontWeights:{hairline:100,thin:200,light:300,normal:400,medium:500,semibold:600,bold:700,extrabold:800,black:900},fonts:{heading:'-apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',body:'-apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',mono:'SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace'},fontSizes:{"3xs":"0.45rem","2xs":"0.625rem",xs:"0.75rem",sm:"0.875rem",md:"1rem",lg:"1.125rem",xl:"1.25rem","2xl":"1.5rem","3xl":"1.875rem","4xl":"2.25rem","5xl":"3rem","6xl":"3.75rem","7xl":"4.5rem","8xl":"6rem","9xl":"8rem"}},{defineMultiStyleConfig:qTe,definePartsStyle:HJ}=wi(Tye.keys),cV=Qs("number-input-stepper-width"),KJ=Qs("number-input-input-padding"),$Te=zf(cV).add("0.5rem").toString(),pM=Qs("number-input-bg"),mM=Qs("number-input-color"),gM=Qs("number-input-border-color"),YTe={[cV.variable]:"sizes.6",[KJ.variable]:$Te},XTe=r=>{var t;return((t=Ka(Kr.baseStyle,r))==null?void 0:t.field)??{}},JTe={width:cV.reference},QTe={borderStart:"1px solid",borderStartColor:gM.reference,color:mM.reference,bg:pM.reference,[mM.variable]:"colors.chakra-body-text",[gM.variable]:"colors.chakra-border-color",_dark:{[mM.variable]:"colors.whiteAlpha.800",[gM.variable]:"colors.whiteAlpha.300"},_active:{[pM.variable]:"colors.gray.200",_dark:{[pM.variable]:"colors.whiteAlpha.300"}},_disabled:{opacity:.4,cursor:"not-allowed"}},ZTe=HJ(r=>({root:YTe,field:Ka(XTe,r)??{},stepperGroup:JTe,stepper:QTe}));function TO(r){var d,p;const t=(d=Kr.sizes)==null?void 0:d[r],s={lg:"md",md:"md",sm:"sm",xs:"sm"},a=((p=t.field)==null?void 0:p.fontSize)??"md",l=zJ.fontSizes[a];return HJ({field:{...t.field,paddingInlineEnd:KJ.reference,verticalAlign:"top"},stepper:{fontSize:zf(l).multiply(.75).toString(),_first:{borderTopEndRadius:s[r]},_last:{borderBottomEndRadius:s[r],mt:"-1px",borderTopWidth:1}}})}const e0e={xs:TO("xs"),sm:TO("sm"),md:TO("md"),lg:TO("lg")},t0e=qTe({baseStyle:ZTe,sizes:e0e,variants:Kr.variants,defaultProps:Kr.defaultProps});var zX;const n0e={...(zX=Kr.baseStyle)==null?void 0:zX.field,textAlign:"center"},r0e={lg:{fontSize:"lg",w:12,h:12,borderRadius:"md"},md:{fontSize:"md",w:10,h:10,borderRadius:"md"},sm:{fontSize:"sm",w:8,h:8,borderRadius:"sm"},xs:{fontSize:"xs",w:6,h:6,borderRadius:"sm"}};var HX;const i0e={outline:r=>{var t,s;return((s=Ka((t=Kr.variants)==null?void 0:t.outline,r))==null?void 0:s.field)??{}},flushed:r=>{var t,s;return((s=Ka((t=Kr.variants)==null?void 0:t.flushed,r))==null?void 0:s.field)??{}},filled:r=>{var t,s;return((s=Ka((t=Kr.variants)==null?void 0:t.filled,r))==null?void 0:s.field)??{}},unstyled:((HX=Kr.variants)==null?void 0:HX.unstyled.field)??{}},s0e={baseStyle:n0e,sizes:r0e,variants:i0e,defaultProps:Kr.defaultProps},{defineMultiStyleConfig:o0e,definePartsStyle:a0e}=wi(bye.keys),bO=Qs("popper-bg"),c0e=Qs("popper-arrow-bg"),hq=Qs("popper-arrow-shadow-color"),l0e={zIndex:"popover"},u0e={[bO.variable]:"colors.white",bg:bO.reference,[c0e.variable]:bO.reference,[hq.variable]:"colors.gray.200",_dark:{[bO.variable]:"colors.gray.700",[hq.variable]:"colors.whiteAlpha.300"},width:"xs",border:"1px solid",borderColor:"inherit",borderRadius:"md",boxShadow:"sm",zIndex:"inherit",_focusVisible:{outline:0,boxShadow:"outline"}},d0e={px:3,py:2,borderBottomWidth:"1px"},h0e={px:3,py:2},f0e={px:3,py:2,borderTopWidth:"1px"},p0e={position:"absolute",borderRadius:"md",top:1,insetEnd:2,padding:2},m0e=a0e({popper:l0e,content:u0e,header:d0e,body:h0e,footer:f0e,closeButton:p0e}),g0e=o0e({baseStyle:m0e}),{defineMultiStyleConfig:_0e,definePartsStyle:Kb}=wi(wye.keys),E0e=r=>{const{colorScheme:t,theme:s,isIndeterminate:a,hasStripe:l}=r,d=Rn(aq(),aq("1rem","rgba(0,0,0,0.1)"))(r),p=Rn(`${t}.500`,`${t}.200`)(r),E=`linear-gradient(
    to right,
    transparent 0%,
    ${Ha(s,p)} 50%,
    transparent 100%
  )`;return{...!a&&l&&d,...a?{bgImage:E}:{bgColor:p}}},y0e={lineHeight:"1",fontSize:"0.25em",fontWeight:"bold",color:"white"},v0e=r=>({bg:Rn("gray.100","whiteAlpha.300")(r)}),S0e=r=>({transitionProperty:"common",transitionDuration:"slow",...E0e(r)}),T0e=Kb(r=>({label:y0e,filledTrack:S0e(r),track:v0e(r)})),b0e={xs:Kb({track:{h:"1"}}),sm:Kb({track:{h:"2"}}),md:Kb({track:{h:"3"}}),lg:Kb({track:{h:"4"}})},w0e=_0e({sizes:b0e,baseStyle:T0e,defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:R0e,definePartsStyle:rP}=wi(Rye.keys),C0e=r=>{var s;const t=(s=Ka(bm.baseStyle,r))==null?void 0:s.control;return{...t,borderRadius:"full",_checked:{...t==null?void 0:t._checked,_before:{content:'""',display:"inline-block",pos:"relative",w:"50%",h:"50%",borderRadius:"50%",bg:"currentColor"}}}},I0e=rP(r=>{var t,s;return{label:(t=bm.baseStyle)==null?void 0:t.call(bm,r).label,container:(s=bm.baseStyle)==null?void 0:s.call(bm,r).container,control:C0e(r)}}),A0e={md:rP({control:{w:"4",h:"4"},label:{fontSize:"md"}}),lg:rP({control:{w:"5",h:"5"},label:{fontSize:"lg"}}),sm:rP({control:{width:"3",height:"3"},label:{fontSize:"sm"}})},O0e=R0e({baseStyle:I0e,sizes:A0e,defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:P0e,definePartsStyle:N0e}=wi(Cye.keys),wO=Cn("select-bg");var KX;const k0e={...(KX=Kr.baseStyle)==null?void 0:KX.field,appearance:"none",paddingBottom:"1px",lineHeight:"normal",bg:wO.reference,[wO.variable]:"colors.white",_dark:{[wO.variable]:"colors.gray.700"},"> option, > optgroup":{bg:wO.reference}},D0e={width:"6",height:"100%",insetEnd:"2",position:"relative",color:"currentColor",fontSize:"xl",_disabled:{opacity:.5}},L0e=N0e({field:k0e,icon:D0e}),RO={paddingInlineEnd:"8"};var qX,$X,YX,XX,JX,QX,ZX,eJ;const x0e={lg:{...(qX=Kr.sizes)==null?void 0:qX.lg,field:{...($X=Kr.sizes)==null?void 0:$X.lg.field,...RO}},md:{...(YX=Kr.sizes)==null?void 0:YX.md,field:{...(XX=Kr.sizes)==null?void 0:XX.md.field,...RO}},sm:{...(JX=Kr.sizes)==null?void 0:JX.sm,field:{...(QX=Kr.sizes)==null?void 0:QX.sm.field,...RO}},xs:{...(ZX=Kr.sizes)==null?void 0:ZX.xs,field:{...(eJ=Kr.sizes)==null?void 0:eJ.xs.field,...RO},icon:{insetEnd:"1"}}},M0e=P0e({baseStyle:L0e,sizes:x0e,variants:Kr.variants,defaultProps:Kr.defaultProps}),_M=Cn("skeleton-start-color"),EM=Cn("skeleton-end-color"),U0e={[_M.variable]:"colors.gray.100",[EM.variable]:"colors.gray.400",_dark:{[_M.variable]:"colors.gray.800",[EM.variable]:"colors.gray.600"},background:_M.reference,borderColor:EM.reference,opacity:.7,borderRadius:"sm"},V0e={baseStyle:U0e},yM=Cn("skip-link-bg"),F0e={borderRadius:"md",fontWeight:"semibold",_focusVisible:{boxShadow:"outline",padding:"4",position:"fixed",top:"6",insetStart:"6",[yM.variable]:"colors.white",_dark:{[yM.variable]:"colors.gray.700"},bg:yM.reference}},j0e={baseStyle:F0e},{defineMultiStyleConfig:B0e,definePartsStyle:RN}=wi(Iye.keys),q_=Cn("slider-thumb-size"),Pw=Cn("slider-track-size"),wm=Cn("slider-bg"),W0e=r=>{const{orientation:t}=r;return{display:"inline-block",position:"relative",cursor:"pointer",_disabled:{opacity:.6,cursor:"default",pointerEvents:"none"},...sV({orientation:t,vertical:{h:"100%",px:Gf(q_.reference).divide(2).toString()},horizontal:{w:"100%",py:Gf(q_.reference).divide(2).toString()}})}},G0e=r=>({...sV({orientation:r.orientation,horizontal:{h:Pw.reference},vertical:{w:Pw.reference}}),overflow:"hidden",borderRadius:"sm",[wm.variable]:"colors.gray.200",_dark:{[wm.variable]:"colors.whiteAlpha.200"},_disabled:{[wm.variable]:"colors.gray.300",_dark:{[wm.variable]:"colors.whiteAlpha.300"}},bg:wm.reference}),z0e=r=>{const{orientation:t}=r;return{...sV({orientation:t,vertical:{left:"50%",transform:"translateX(-50%)",_active:{transform:"translateX(-50%) scale(1.15)"}},horizontal:{top:"50%",transform:"translateY(-50%)",_active:{transform:"translateY(-50%) scale(1.15)"}}}),w:q_.reference,h:q_.reference,display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",outline:0,zIndex:1,borderRadius:"full",bg:"white",boxShadow:"base",border:"1px solid",borderColor:"transparent",transitionProperty:"transform",transitionDuration:"normal",_focusVisible:{boxShadow:"outline"},_disabled:{bg:"gray.300"}}},H0e=r=>{const{colorScheme:t}=r;return{width:"inherit",height:"inherit",[wm.variable]:`colors.${t}.500`,_dark:{[wm.variable]:`colors.${t}.200`},bg:wm.reference}},K0e=RN(r=>({container:W0e(r),track:G0e(r),thumb:z0e(r),filledTrack:H0e(r)})),q0e=RN({container:{[q_.variable]:"sizes.4",[Pw.variable]:"sizes.1"}}),$0e=RN({container:{[q_.variable]:"sizes.3.5",[Pw.variable]:"sizes.1"}}),Y0e=RN({container:{[q_.variable]:"sizes.2.5",[Pw.variable]:"sizes.0.5"}}),X0e={lg:q0e,md:$0e,sm:Y0e},J0e=B0e({baseStyle:K0e,sizes:X0e,defaultProps:{size:"md",colorScheme:"blue"}}),k_=Qs("spinner-size"),Q0e={width:[k_.reference],height:[k_.reference]},Z0e={xs:{[k_.variable]:"sizes.3"},sm:{[k_.variable]:"sizes.4"},md:{[k_.variable]:"sizes.6"},lg:{[k_.variable]:"sizes.8"},xl:{[k_.variable]:"sizes.12"}},ebe={baseStyle:Q0e,sizes:Z0e,defaultProps:{size:"md"}},{defineMultiStyleConfig:tbe,definePartsStyle:qJ}=wi(Aye.keys),nbe={fontWeight:"medium"},rbe={opacity:.8,marginBottom:"2"},ibe={verticalAlign:"baseline",fontWeight:"semibold"},sbe={marginEnd:1,w:"3.5",h:"3.5",verticalAlign:"middle"},obe=qJ({container:{},label:nbe,helpText:rbe,number:ibe,icon:sbe}),abe={md:qJ({label:{fontSize:"sm"},helpText:{fontSize:"sm"},number:{fontSize:"2xl"}})},cbe=tbe({baseStyle:obe,sizes:abe,defaultProps:{size:"md"}}),{defineMultiStyleConfig:lbe,definePartsStyle:qb}=wi(["stepper","step","title","description","indicator","separator","icon","number"]),Hf=Cn("stepper-indicator-size"),$v=Cn("stepper-icon-size"),Yv=Cn("stepper-title-font-size"),$b=Cn("stepper-description-font-size"),bb=Cn("stepper-accent-color"),ube=qb(({colorScheme:r})=>({stepper:{display:"flex",justifyContent:"space-between",gap:"4","&[data-orientation=vertical]":{flexDirection:"column",alignItems:"flex-start"},"&[data-orientation=horizontal]":{flexDirection:"row",alignItems:"center"},[bb.variable]:`colors.${r}.500`,_dark:{[bb.variable]:`colors.${r}.200`}},title:{fontSize:Yv.reference,fontWeight:"medium"},description:{fontSize:$b.reference,color:"chakra-subtle-text"},number:{fontSize:Yv.reference},step:{flexShrink:0,position:"relative",display:"flex",gap:"2","&[data-orientation=horizontal]":{alignItems:"center"},flex:"1","&:last-of-type:not([data-stretch])":{flex:"initial"}},icon:{flexShrink:0,width:$v.reference,height:$v.reference},indicator:{flexShrink:0,borderRadius:"full",width:Hf.reference,height:Hf.reference,display:"flex",justifyContent:"center",alignItems:"center","&[data-status=active]":{borderWidth:"2px",borderColor:bb.reference},"&[data-status=complete]":{bg:bb.reference,color:"chakra-inverse-text"},"&[data-status=incomplete]":{borderWidth:"2px"}},separator:{bg:"chakra-border-color",flex:"1","&[data-status=complete]":{bg:bb.reference},"&[data-orientation=horizontal]":{width:"100%",height:"2px",marginStart:"2"},"&[data-orientation=vertical]":{width:"2px",position:"absolute",height:"100%",maxHeight:`calc(100% - ${Hf.reference} - 8px)`,top:`calc(${Hf.reference} + 4px)`,insetStart:`calc(${Hf.reference} / 2 - 1px)`}}})),dbe=lbe({baseStyle:ube,sizes:{xs:qb({stepper:{[Hf.variable]:"sizes.4",[$v.variable]:"sizes.3",[Yv.variable]:"fontSizes.xs",[$b.variable]:"fontSizes.xs"}}),sm:qb({stepper:{[Hf.variable]:"sizes.6",[$v.variable]:"sizes.4",[Yv.variable]:"fontSizes.sm",[$b.variable]:"fontSizes.xs"}}),md:qb({stepper:{[Hf.variable]:"sizes.8",[$v.variable]:"sizes.5",[Yv.variable]:"fontSizes.md",[$b.variable]:"fontSizes.sm"}}),lg:qb({stepper:{[Hf.variable]:"sizes.10",[$v.variable]:"sizes.6",[Yv.variable]:"fontSizes.lg",[$b.variable]:"fontSizes.md"}})},defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:hbe,definePartsStyle:iP}=wi(Oye.keys),mw=Qs("switch-track-width"),F_=Qs("switch-track-height"),vM=Qs("switch-track-diff"),fbe=zf.subtract(mw,F_),k2=Qs("switch-thumb-x"),wb=Qs("switch-bg"),pbe=r=>{const{colorScheme:t}=r;return{borderRadius:"full",p:"0.5",width:[mw.reference],height:[F_.reference],transitionProperty:"common",transitionDuration:"fast",[wb.variable]:"colors.gray.300",_dark:{[wb.variable]:"colors.whiteAlpha.400"},_focusVisible:{boxShadow:"outline"},_disabled:{opacity:.4,cursor:"not-allowed"},_checked:{[wb.variable]:`colors.${t}.500`,_dark:{[wb.variable]:`colors.${t}.200`}},bg:wb.reference}},mbe={bg:"white",transitionProperty:"transform",transitionDuration:"normal",borderRadius:"inherit",width:[F_.reference],height:[F_.reference],_checked:{transform:`translateX(${k2.reference})`}},gbe=iP(r=>({container:{[vM.variable]:fbe,[k2.variable]:vM.reference,_rtl:{[k2.variable]:zf(vM).negate().toString()}},track:pbe(r),thumb:mbe})),_be={sm:iP({container:{[mw.variable]:"1.375rem",[F_.variable]:"sizes.3"}}),md:iP({container:{[mw.variable]:"1.875rem",[F_.variable]:"sizes.4"}}),lg:iP({container:{[mw.variable]:"2.875rem",[F_.variable]:"sizes.6"}})},Ebe=hbe({baseStyle:gbe,sizes:_be,defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:ybe,definePartsStyle:lS}=wi(Pye.keys),vbe=lS({table:{fontVariantNumeric:"lining-nums tabular-nums",borderCollapse:"collapse",width:"full"},th:{fontFamily:"heading",fontWeight:"bold",textTransform:"uppercase",letterSpacing:"wider",textAlign:"start"},td:{textAlign:"start"},caption:{mt:4,fontFamily:"heading",textAlign:"center",fontWeight:"medium"}}),UP={"&[data-is-numeric=true]":{textAlign:"end"}},Sbe=lS(r=>{const{colorScheme:t}=r;return{th:{color:Rn("gray.600","gray.400")(r),borderBottom:"1px",borderColor:Rn(`${t}.100`,`${t}.700`)(r),...UP},td:{borderBottom:"1px",borderColor:Rn(`${t}.100`,`${t}.700`)(r),...UP},caption:{color:Rn("gray.600","gray.100")(r)},tfoot:{tr:{"&:last-of-type":{th:{borderBottomWidth:0}}}}}}),Tbe=lS(r=>{const{colorScheme:t}=r;return{th:{color:Rn("gray.600","gray.400")(r),borderBottom:"1px",borderColor:Rn(`${t}.100`,`${t}.700`)(r),...UP},td:{borderBottom:"1px",borderColor:Rn(`${t}.100`,`${t}.700`)(r),...UP},caption:{color:Rn("gray.600","gray.100")(r)},tbody:{tr:{"&:nth-of-type(odd)":{"th, td":{borderBottomWidth:"1px",borderColor:Rn(`${t}.100`,`${t}.700`)(r)},td:{background:Rn(`${t}.100`,`${t}.700`)(r)}}}},tfoot:{tr:{"&:last-of-type":{th:{borderBottomWidth:0}}}}}}),bbe={simple:Sbe,striped:Tbe,unstyled:{}},wbe={sm:lS({th:{px:"4",py:"1",lineHeight:"4",fontSize:"xs"},td:{px:"4",py:"2",fontSize:"sm",lineHeight:"4"},caption:{px:"4",py:"2",fontSize:"xs"}}),md:lS({th:{px:"6",py:"3",lineHeight:"4",fontSize:"xs"},td:{px:"6",py:"4",lineHeight:"5"},caption:{px:"6",py:"2",fontSize:"sm"}}),lg:lS({th:{px:"8",py:"4",lineHeight:"5",fontSize:"sm"},td:{px:"8",py:"5",lineHeight:"6"},caption:{px:"6",py:"2",fontSize:"md"}})},Rbe=ybe({baseStyle:vbe,variants:bbe,sizes:wbe,defaultProps:{variant:"simple",size:"md",colorScheme:"gray"}}),Dc=Cn("tabs-color"),ad=Cn("tabs-bg"),CO=Cn("tabs-border-color"),{defineMultiStyleConfig:Cbe,definePartsStyle:Eh}=wi(Nye.keys),Ibe=r=>{const{orientation:t}=r;return{display:t==="vertical"?"flex":"block"}},Abe=r=>{const{isFitted:t}=r;return{flex:t?1:void 0,transitionProperty:"common",transitionDuration:"normal",_focusVisible:{zIndex:1,boxShadow:"outline"},_disabled:{cursor:"not-allowed",opacity:.4}}},Obe=r=>{const{align:t="start",orientation:s}=r;return{justifyContent:{end:"flex-end",center:"center",start:"flex-start"}[t],flexDirection:s==="vertical"?"column":"row"}},Pbe={p:4},Nbe=Eh(r=>({root:Ibe(r),tab:Abe(r),tablist:Obe(r),tabpanel:Pbe})),kbe={sm:Eh({tab:{py:1,px:4,fontSize:"sm"}}),md:Eh({tab:{fontSize:"md",py:2,px:4}}),lg:Eh({tab:{fontSize:"lg",py:3,px:4}})},Dbe=Eh(r=>{const{colorScheme:t,orientation:s}=r,a=s==="vertical",l=a?"borderStart":"borderBottom",d=a?"marginStart":"marginBottom";return{tablist:{[l]:"2px solid",borderColor:"inherit"},tab:{[l]:"2px solid",borderColor:"transparent",[d]:"-2px",_selected:{[Dc.variable]:`colors.${t}.600`,_dark:{[Dc.variable]:`colors.${t}.300`},borderColor:"currentColor"},_active:{[ad.variable]:"colors.gray.200",_dark:{[ad.variable]:"colors.whiteAlpha.300"}},_disabled:{_active:{bg:"none"}},color:Dc.reference,bg:ad.reference}}}),Lbe=Eh(r=>{const{colorScheme:t}=r;return{tab:{borderTopRadius:"md",border:"1px solid",borderColor:"transparent",mb:"-1px",[CO.variable]:"transparent",_selected:{[Dc.variable]:`colors.${t}.600`,[CO.variable]:"colors.white",_dark:{[Dc.variable]:`colors.${t}.300`,[CO.variable]:"colors.gray.800"},borderColor:"inherit",borderBottomColor:CO.reference},color:Dc.reference},tablist:{mb:"-1px",borderBottom:"1px solid",borderColor:"inherit"}}}),xbe=Eh(r=>{const{colorScheme:t}=r;return{tab:{border:"1px solid",borderColor:"inherit",[ad.variable]:"colors.gray.50",_dark:{[ad.variable]:"colors.whiteAlpha.50"},mb:"-1px",_notLast:{marginEnd:"-1px"},_selected:{[ad.variable]:"colors.white",[Dc.variable]:`colors.${t}.600`,_dark:{[ad.variable]:"colors.gray.800",[Dc.variable]:`colors.${t}.300`},borderColor:"inherit",borderTopColor:"currentColor",borderBottomColor:"transparent"},color:Dc.reference,bg:ad.reference},tablist:{mb:"-1px",borderBottom:"1px solid",borderColor:"inherit"}}}),Mbe=Eh(r=>{const{colorScheme:t,theme:s}=r;return{tab:{borderRadius:"full",fontWeight:"semibold",color:"gray.600",_selected:{color:Ha(s,`${t}.700`),bg:Ha(s,`${t}.100`)}}}}),Ube=Eh(r=>{const{colorScheme:t}=r;return{tab:{borderRadius:"full",fontWeight:"semibold",[Dc.variable]:"colors.gray.600",_dark:{[Dc.variable]:"inherit"},_selected:{[Dc.variable]:"colors.white",[ad.variable]:`colors.${t}.600`,_dark:{[Dc.variable]:"colors.gray.800",[ad.variable]:`colors.${t}.300`}},color:Dc.reference,bg:ad.reference}}}),Vbe=Eh({}),Fbe={line:Dbe,enclosed:Lbe,"enclosed-colored":xbe,"soft-rounded":Mbe,"solid-rounded":Ube,unstyled:Vbe},jbe=Cbe({baseStyle:Nbe,sizes:kbe,variants:Fbe,defaultProps:{size:"md",variant:"line",colorScheme:"blue"}}),{defineMultiStyleConfig:Bbe,definePartsStyle:j_}=wi(kye.keys),fq=Cn("tag-bg"),pq=Cn("tag-color"),SM=Cn("tag-shadow"),sP=Cn("tag-min-height"),oP=Cn("tag-min-width"),aP=Cn("tag-font-size"),cP=Cn("tag-padding-inline"),Wbe={fontWeight:"medium",lineHeight:1.2,outline:0,[pq.variable]:ws.color.reference,[fq.variable]:ws.bg.reference,[SM.variable]:ws.shadow.reference,color:pq.reference,bg:fq.reference,boxShadow:SM.reference,borderRadius:"md",minH:sP.reference,minW:oP.reference,fontSize:aP.reference,px:cP.reference,_focusVisible:{[SM.variable]:"shadows.outline"}},Gbe={lineHeight:1.2,overflow:"visible"},zbe={fontSize:"lg",w:"5",h:"5",transitionProperty:"common",transitionDuration:"normal",borderRadius:"full",marginStart:"1.5",marginEnd:"-1",opacity:.5,_disabled:{opacity:.4},_focusVisible:{boxShadow:"outline",bg:"rgba(0, 0, 0, 0.14)"},_hover:{opacity:.8},_active:{opacity:1}},Hbe=j_({container:Wbe,label:Gbe,closeButton:zbe}),Kbe={sm:j_({container:{[sP.variable]:"sizes.5",[oP.variable]:"sizes.5",[aP.variable]:"fontSizes.xs",[cP.variable]:"space.2"},closeButton:{marginEnd:"-2px",marginStart:"0.35rem"}}),md:j_({container:{[sP.variable]:"sizes.6",[oP.variable]:"sizes.6",[aP.variable]:"fontSizes.sm",[cP.variable]:"space.2"}}),lg:j_({container:{[sP.variable]:"sizes.8",[oP.variable]:"sizes.8",[aP.variable]:"fontSizes.md",[cP.variable]:"space.3"}})},qbe={subtle:j_(r=>{var t;return{container:(t=hw.variants)==null?void 0:t.subtle(r)}}),solid:j_(r=>{var t;return{container:(t=hw.variants)==null?void 0:t.solid(r)}}),outline:j_(r=>{var t;return{container:(t=hw.variants)==null?void 0:t.outline(r)}})},$be=Bbe({variants:qbe,baseStyle:Hbe,sizes:Kbe,defaultProps:{size:"md",variant:"subtle",colorScheme:"gray"}});var tJ;const Ybe={...(tJ=Kr.baseStyle)==null?void 0:tJ.field,paddingY:"2",minHeight:"20",lineHeight:"short",verticalAlign:"top"};var nJ;const Xbe={outline:r=>{var t;return((t=Kr.variants)==null?void 0:t.outline(r).field)??{}},flushed:r=>{var t;return((t=Kr.variants)==null?void 0:t.flushed(r).field)??{}},filled:r=>{var t;return((t=Kr.variants)==null?void 0:t.filled(r).field)??{}},unstyled:((nJ=Kr.variants)==null?void 0:nJ.unstyled.field)??{}};var rJ,iJ,sJ,oJ;const Jbe={xs:((rJ=Kr.sizes)==null?void 0:rJ.xs.field)??{},sm:((iJ=Kr.sizes)==null?void 0:iJ.sm.field)??{},md:((sJ=Kr.sizes)==null?void 0:sJ.md.field)??{},lg:((oJ=Kr.sizes)==null?void 0:oJ.lg.field)??{}},Qbe={baseStyle:Ybe,sizes:Jbe,variants:Xbe,defaultProps:{size:"md",variant:"outline"}},IO=Qs("tooltip-bg"),TM=Qs("tooltip-fg"),Zbe=Qs("popper-arrow-bg"),ewe={bg:IO.reference,color:TM.reference,[IO.variable]:"colors.gray.700",[TM.variable]:"colors.whiteAlpha.900",_dark:{[IO.variable]:"colors.gray.300",[TM.variable]:"colors.gray.900"},[Zbe.variable]:IO.reference,px:"2",py:"0.5",borderRadius:"sm",fontWeight:"medium",fontSize:"sm",boxShadow:"md",maxW:"xs",zIndex:"tooltip"},twe={baseStyle:ewe},nwe={Accordion:Bye,Alert:wve,Avatar:xve,Badge:hw,Breadcrumb:Hve,Button:eSe,Checkbox:bm,CloseButton:mSe,Code:ySe,Container:SSe,Divider:CSe,Drawer:USe,Editable:zSe,Form:XSe,FormError:nTe,FormLabel:iTe,Heading:aTe,Input:Kr,Kbd:_Te,Link:yTe,List:wTe,Menu:xTe,Modal:KTe,NumberInput:t0e,PinInput:s0e,Popover:g0e,Progress:w0e,Radio:O0e,Select:M0e,Skeleton:V0e,SkipLink:j0e,Slider:J0e,Spinner:ebe,Stat:cbe,Switch:Ebe,Table:Rbe,Tabs:jbe,Tag:$be,Textarea:Qbe,Tooltip:twe,Card:sSe,Stepper:dbe},rwe={none:0,"1px":"1px solid","2px":"2px solid","4px":"4px solid","8px":"8px solid"},iwe={base:"0em",sm:"30em",md:"48em",lg:"62em",xl:"80em","2xl":"96em"},swe={transparent:"transparent",current:"currentColor",black:"#000000",white:"#FFFFFF",whiteAlpha:{50:"rgba(255, 255, 255, 0.04)",100:"rgba(255, 255, 255, 0.06)",200:"rgba(255, 255, 255, 0.08)",300:"rgba(255, 255, 255, 0.16)",400:"rgba(255, 255, 255, 0.24)",500:"rgba(255, 255, 255, 0.36)",600:"rgba(255, 255, 255, 0.48)",700:"rgba(255, 255, 255, 0.64)",800:"rgba(255, 255, 255, 0.80)",900:"rgba(255, 255, 255, 0.92)"},blackAlpha:{50:"rgba(0, 0, 0, 0.04)",100:"rgba(0, 0, 0, 0.06)",200:"rgba(0, 0, 0, 0.08)",300:"rgba(0, 0, 0, 0.16)",400:"rgba(0, 0, 0, 0.24)",500:"rgba(0, 0, 0, 0.36)",600:"rgba(0, 0, 0, 0.48)",700:"rgba(0, 0, 0, 0.64)",800:"rgba(0, 0, 0, 0.80)",900:"rgba(0, 0, 0, 0.92)"},gray:{50:"#F7FAFC",100:"#EDF2F7",200:"#E2E8F0",300:"#CBD5E0",400:"#A0AEC0",500:"#718096",600:"#4A5568",700:"#2D3748",800:"#1A202C",900:"#171923"},red:{50:"#FFF5F5",100:"#FED7D7",200:"#FEB2B2",300:"#FC8181",400:"#F56565",500:"#E53E3E",600:"#C53030",700:"#9B2C2C",800:"#822727",900:"#63171B"},orange:{50:"#FFFAF0",100:"#FEEBC8",200:"#FBD38D",300:"#F6AD55",400:"#ED8936",500:"#DD6B20",600:"#C05621",700:"#9C4221",800:"#7B341E",900:"#652B19"},yellow:{50:"#FFFFF0",100:"#FEFCBF",200:"#FAF089",300:"#F6E05E",400:"#ECC94B",500:"#D69E2E",600:"#B7791F",700:"#975A16",800:"#744210",900:"#5F370E"},green:{50:"#F0FFF4",100:"#C6F6D5",200:"#9AE6B4",300:"#68D391",400:"#48BB78",500:"#38A169",600:"#2F855A",700:"#276749",800:"#22543D",900:"#1C4532"},teal:{50:"#E6FFFA",100:"#B2F5EA",200:"#81E6D9",300:"#4FD1C5",400:"#38B2AC",500:"#319795",600:"#2C7A7B",700:"#285E61",800:"#234E52",900:"#1D4044"},blue:{50:"#ebf8ff",100:"#bee3f8",200:"#90cdf4",300:"#63b3ed",400:"#4299e1",500:"#3182ce",600:"#2b6cb0",700:"#2c5282",800:"#2a4365",900:"#1A365D"},cyan:{50:"#EDFDFD",100:"#C4F1F9",200:"#9DECF9",300:"#76E4F7",400:"#0BC5EA",500:"#00B5D8",600:"#00A3C4",700:"#0987A0",800:"#086F83",900:"#065666"},purple:{50:"#FAF5FF",100:"#E9D8FD",200:"#D6BCFA",300:"#B794F4",400:"#9F7AEA",500:"#805AD5",600:"#6B46C1",700:"#553C9A",800:"#44337A",900:"#322659"},pink:{50:"#FFF5F7",100:"#FED7E2",200:"#FBB6CE",300:"#F687B3",400:"#ED64A6",500:"#D53F8C",600:"#B83280",700:"#97266D",800:"#702459",900:"#521B41"}},owe={none:"0",sm:"0.125rem",base:"0.25rem",md:"0.375rem",lg:"0.5rem",xl:"0.75rem","2xl":"1rem","3xl":"1.5rem",full:"9999px"},awe={xs:"0 0 0 1px rgba(0, 0, 0, 0.05)",sm:"0 1px 2px 0 rgba(0, 0, 0, 0.05)",base:"0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06)",md:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)",lg:"0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)",xl:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)","2xl":"0 25px 50px -12px rgba(0, 0, 0, 0.25)",outline:"0 0 0 3px rgba(66, 153, 225, 0.6)",inner:"inset 0 2px 4px 0 rgba(0,0,0,0.06)",none:"none","dark-lg":"rgba(0, 0, 0, 0.1) 0px 0px 0px 1px, rgba(0, 0, 0, 0.2) 0px 5px 10px, rgba(0, 0, 0, 0.4) 0px 15px 40px"},cwe={common:"background-color, border-color, color, fill, stroke, opacity, box-shadow, transform",colors:"background-color, border-color, color, fill, stroke",dimensions:"width, height",position:"left, right, top, bottom",background:"background-color, background-image, background-position"},lwe={"ease-in":"cubic-bezier(0.4, 0, 1, 1)","ease-out":"cubic-bezier(0, 0, 0.2, 1)","ease-in-out":"cubic-bezier(0.4, 0, 0.2, 1)"},uwe={"ultra-fast":"50ms",faster:"100ms",fast:"150ms",normal:"200ms",slow:"300ms",slower:"400ms","ultra-slow":"500ms"},dwe={property:cwe,easing:lwe,duration:uwe},hwe={hide:-1,auto:"auto",base:0,docked:10,dropdown:1e3,sticky:1100,banner:1200,overlay:1300,modal:1400,popover:1500,skipLink:1600,toast:1700,tooltip:1800},fwe={none:0,sm:"4px",base:"8px",md:"12px",lg:"16px",xl:"24px","2xl":"40px","3xl":"64px"},pwe={breakpoints:iwe,zIndices:hwe,radii:owe,blur:fwe,colors:swe,...zJ,sizes:VJ,shadows:awe,space:UJ,borders:rwe,transition:dwe},mwe={colors:{"chakra-body-text":{_light:"gray.800",_dark:"whiteAlpha.900"},"chakra-body-bg":{_light:"white",_dark:"gray.800"},"chakra-border-color":{_light:"gray.200",_dark:"whiteAlpha.300"},"chakra-inverse-text":{_light:"white",_dark:"gray.800"},"chakra-subtle-bg":{_light:"gray.100",_dark:"gray.700"},"chakra-subtle-text":{_light:"gray.600",_dark:"gray.400"},"chakra-placeholder-color":{_light:"gray.500",_dark:"whiteAlpha.400"}}},gwe={global:{body:{fontFamily:"body",color:"chakra-body-text",bg:"chakra-body-bg",transitionProperty:"background-color",transitionDuration:"normal",lineHeight:"base"},"*::placeholder":{color:"chakra-placeholder-color"},"*, *::before, &::after":{borderColor:"chakra-border-color"}}},_we="ltr",Ewe={useSystemColorMode:!1,initialColorMode:"light",cssVarPrefix:"chakra"},ywe={semanticTokens:mwe,direction:_we,...pwe,components:nwe,styles:gwe,config:Ewe};function vwe(r){if(r.sheet)return r.sheet;for(var t=0;t<document.styleSheets.length;t++)if(document.styleSheets[t].ownerNode===r)return document.styleSheets[t]}function Swe(r){var t=document.createElement("style");return t.setAttribute("data-emotion",r.key),r.nonce!==void 0&&t.setAttribute("nonce",r.nonce),t.appendChild(document.createTextNode("")),t.setAttribute("data-s",""),t}var Twe=function(){function r(s){var a=this;this._insertTag=function(l){var d;a.tags.length===0?a.insertionPoint?d=a.insertionPoint.nextSibling:a.prepend?d=a.container.firstChild:d=a.before:d=a.tags[a.tags.length-1].nextSibling,a.container.insertBefore(l,d),a.tags.push(l)},this.isSpeedy=s.speedy===void 0?!0:s.speedy,this.tags=[],this.ctr=0,this.nonce=s.nonce,this.key=s.key,this.container=s.container,this.prepend=s.prepend,this.insertionPoint=s.insertionPoint,this.before=null}var t=r.prototype;return t.hydrate=function(a){a.forEach(this._insertTag)},t.insert=function(a){this.ctr%(this.isSpeedy?65e3:1)===0&&this._insertTag(Swe(this));var l=this.tags[this.tags.length-1];if(this.isSpeedy){var d=vwe(l);try{d.insertRule(a,d.cssRules.length)}catch{}}else l.appendChild(document.createTextNode(a));this.ctr++},t.flush=function(){this.tags.forEach(function(a){var l;return(l=a.parentNode)==null?void 0:l.removeChild(a)}),this.tags=[],this.ctr=0},r}(),Ea="-ms-",VP="-moz-",zr="-webkit-",$J="comm",lV="rule",uV="decl",bwe="@import",YJ="@keyframes",wwe="@layer",Rwe=Math.abs,CN=String.fromCharCode,Cwe=Object.assign;function Iwe(r,t){return Ko(r,0)^45?(((t<<2^Ko(r,0))<<2^Ko(r,1))<<2^Ko(r,2))<<2^Ko(r,3):0}function XJ(r){return r.trim()}function Awe(r,t){return(r=t.exec(r))?r[0]:r}function Hr(r,t,s){return r.replace(t,s)}function D2(r,t){return r.indexOf(t)}function Ko(r,t){return r.charCodeAt(t)|0}function Nw(r,t,s){return r.slice(t,s)}function dh(r){return r.length}function dV(r){return r.length}function AO(r,t){return t.push(r),r}function Owe(r,t){return r.map(t).join("")}var IN=1,SS=1,JJ=0,Fc=0,Ls=0,GS="";function AN(r,t,s,a,l,d,p){return{value:r,root:t,parent:s,type:a,props:l,children:d,line:IN,column:SS,length:p,return:""}}function Rb(r,t){return Cwe(AN("",null,null,"",null,null,0),r,{length:-r.length},t)}function Pwe(){return Ls}function Nwe(){return Ls=Fc>0?Ko(GS,--Fc):0,SS--,Ls===10&&(SS=1,IN--),Ls}function ml(){return Ls=Fc<JJ?Ko(GS,Fc++):0,SS++,Ls===10&&(SS=1,IN++),Ls}function yh(){return Ko(GS,Fc)}function lP(){return Fc}function cR(r,t){return Nw(GS,r,t)}function kw(r){switch(r){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function QJ(r){return IN=SS=1,JJ=dh(GS=r),Fc=0,[]}function ZJ(r){return GS="",r}function uP(r){return XJ(cR(Fc-1,L2(r===91?r+2:r===40?r+1:r)))}function kwe(r){for(;(Ls=yh())&&Ls<33;)ml();return kw(r)>2||kw(Ls)>3?"":" "}function Dwe(r,t){for(;--t&&ml()&&!(Ls<48||Ls>102||Ls>57&&Ls<65||Ls>70&&Ls<97););return cR(r,lP()+(t<6&&yh()==32&&ml()==32))}function L2(r){for(;ml();)switch(Ls){case r:return Fc;case 34:case 39:r!==34&&r!==39&&L2(Ls);break;case 40:r===41&&L2(r);break;case 92:ml();break}return Fc}function Lwe(r,t){for(;ml()&&r+Ls!==57;)if(r+Ls===84&&yh()===47)break;return"/*"+cR(t,Fc-1)+"*"+CN(r===47?r:ml())}function xwe(r){for(;!kw(yh());)ml();return cR(r,Fc)}function Mwe(r){return ZJ(dP("",null,null,null,[""],r=QJ(r),0,[0],r))}function dP(r,t,s,a,l,d,p,E,v){for(var b=0,R=0,O=p,N=0,F=0,H=0,z=1,G=1,ee=1,J=0,re="",de=l,se=d,ye=a,Q=re;G;)switch(H=J,J=ml()){case 40:if(H!=108&&Ko(Q,O-1)==58){D2(Q+=Hr(uP(J),"&","&\f"),"&\f")!=-1&&(ee=-1);break}case 34:case 39:case 91:Q+=uP(J);break;case 9:case 10:case 13:case 32:Q+=kwe(H);break;case 92:Q+=Dwe(lP()-1,7);continue;case 47:switch(yh()){case 42:case 47:AO(Uwe(Lwe(ml(),lP()),t,s),v);break;default:Q+="/"}break;case 123*z:E[b++]=dh(Q)*ee;case 125*z:case 59:case 0:switch(J){case 0:case 125:G=0;case 59+R:ee==-1&&(Q=Hr(Q,/\f/g,"")),F>0&&dh(Q)-O&&AO(F>32?gq(Q+";",a,s,O-1):gq(Hr(Q," ","")+";",a,s,O-2),v);break;case 59:Q+=";";default:if(AO(ye=mq(Q,t,s,b,R,l,E,re,de=[],se=[],O),d),J===123)if(R===0)dP(Q,t,ye,ye,de,d,O,E,se);else switch(N===99&&Ko(Q,3)===110?100:N){case 100:case 108:case 109:case 115:dP(r,ye,ye,a&&AO(mq(r,ye,ye,0,0,l,E,re,l,de=[],O),se),l,se,O,E,a?de:se);break;default:dP(Q,ye,ye,ye,[""],se,0,E,se)}}b=R=F=0,z=ee=1,re=Q="",O=p;break;case 58:O=1+dh(Q),F=H;default:if(z<1){if(J==123)--z;else if(J==125&&z++==0&&Nwe()==125)continue}switch(Q+=CN(J),J*z){case 38:ee=R>0?1:(Q+="\f",-1);break;case 44:E[b++]=(dh(Q)-1)*ee,ee=1;break;case 64:yh()===45&&(Q+=uP(ml())),N=yh(),R=O=dh(re=Q+=xwe(lP())),J++;break;case 45:H===45&&dh(Q)==2&&(z=0)}}return d}function mq(r,t,s,a,l,d,p,E,v,b,R){for(var O=l-1,N=l===0?d:[""],F=dV(N),H=0,z=0,G=0;H<a;++H)for(var ee=0,J=Nw(r,O+1,O=Rwe(z=p[H])),re=r;ee<F;++ee)(re=XJ(z>0?N[ee]+" "+J:Hr(J,/&\f/g,N[ee])))&&(v[G++]=re);return AN(r,t,s,l===0?lV:E,v,b,R)}function Uwe(r,t,s){return AN(r,t,s,$J,CN(Pwe()),Nw(r,2,-2),0)}function gq(r,t,s,a){return AN(r,t,s,uV,Nw(r,0,a),Nw(r,a+1,-1),a)}function uS(r,t){for(var s="",a=dV(r),l=0;l<a;l++)s+=t(r[l],l,r,t)||"";return s}function Vwe(r,t,s,a){switch(r.type){case wwe:if(r.children.length)break;case bwe:case uV:return r.return=r.return||r.value;case $J:return"";case YJ:return r.return=r.value+"{"+uS(r.children,a)+"}";case lV:r.value=r.props.join(",")}return dh(s=uS(r.children,a))?r.return=r.value+"{"+s+"}":""}function Fwe(r){var t=dV(r);return function(s,a,l,d){for(var p="",E=0;E<t;E++)p+=r[E](s,a,l,d)||"";return p}}function jwe(r){return function(t){t.root||(t=t.return)&&r(t)}}var _q=function(t){var s=new WeakMap;return function(a){if(s.has(a))return s.get(a);var l=t(a);return s.set(a,l),l}};function eQ(r){var t=Object.create(null);return function(s){return t[s]===void 0&&(t[s]=r(s)),t[s]}}var Bwe=function(t,s,a){for(var l=0,d=0;l=d,d=yh(),l===38&&d===12&&(s[a]=1),!kw(d);)ml();return cR(t,Fc)},Wwe=function(t,s){var a=-1,l=44;do switch(kw(l)){case 0:l===38&&yh()===12&&(s[a]=1),t[a]+=Bwe(Fc-1,s,a);break;case 2:t[a]+=uP(l);break;case 4:if(l===44){t[++a]=yh()===58?"&\f":"",s[a]=t[a].length;break}default:t[a]+=CN(l)}while(l=ml());return t},Gwe=function(t,s){return ZJ(Wwe(QJ(t),s))},Eq=new WeakMap,zwe=function(t){if(!(t.type!=="rule"||!t.parent||t.length<1)){for(var s=t.value,a=t.parent,l=t.column===a.column&&t.line===a.line;a.type!=="rule";)if(a=a.parent,!a)return;if(!(t.props.length===1&&s.charCodeAt(0)!==58&&!Eq.get(a))&&!l){Eq.set(t,!0);for(var d=[],p=Gwe(s,d),E=a.props,v=0,b=0;v<p.length;v++)for(var R=0;R<E.length;R++,b++)t.props[b]=d[v]?p[v].replace(/&\f/g,E[R]):E[R]+" "+p[v]}}},Hwe=function(t){if(t.type==="decl"){var s=t.value;s.charCodeAt(0)===108&&s.charCodeAt(2)===98&&(t.return="",t.value="")}};function tQ(r,t){switch(Iwe(r,t)){case 5103:return zr+"print-"+r+r;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return zr+r+r;case 5349:case 4246:case 4810:case 6968:case 2756:return zr+r+VP+r+Ea+r+r;case 6828:case 4268:return zr+r+Ea+r+r;case 6165:return zr+r+Ea+"flex-"+r+r;case 5187:return zr+r+Hr(r,/(\w+).+(:[^]+)/,zr+"box-$1$2"+Ea+"flex-$1$2")+r;case 5443:return zr+r+Ea+"flex-item-"+Hr(r,/flex-|-self/,"")+r;case 4675:return zr+r+Ea+"flex-line-pack"+Hr(r,/align-content|flex-|-self/,"")+r;case 5548:return zr+r+Ea+Hr(r,"shrink","negative")+r;case 5292:return zr+r+Ea+Hr(r,"basis","preferred-size")+r;case 6060:return zr+"box-"+Hr(r,"-grow","")+zr+r+Ea+Hr(r,"grow","positive")+r;case 4554:return zr+Hr(r,/([^-])(transform)/g,"$1"+zr+"$2")+r;case 6187:return Hr(Hr(Hr(r,/(zoom-|grab)/,zr+"$1"),/(image-set)/,zr+"$1"),r,"")+r;case 5495:case 3959:return Hr(r,/(image-set\([^]*)/,zr+"$1$`$1");case 4968:return Hr(Hr(r,/(.+:)(flex-)?(.*)/,zr+"box-pack:$3"+Ea+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+zr+r+r;case 4095:case 3583:case 4068:case 2532:return Hr(r,/(.+)-inline(.+)/,zr+"$1$2")+r;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(dh(r)-1-t>6)switch(Ko(r,t+1)){case 109:if(Ko(r,t+4)!==45)break;case 102:return Hr(r,/(.+:)(.+)-([^]+)/,"$1"+zr+"$2-$3$1"+VP+(Ko(r,t+3)==108?"$3":"$2-$3"))+r;case 115:return~D2(r,"stretch")?tQ(Hr(r,"stretch","fill-available"),t)+r:r}break;case 4949:if(Ko(r,t+1)!==115)break;case 6444:switch(Ko(r,dh(r)-3-(~D2(r,"!important")&&10))){case 107:return Hr(r,":",":"+zr)+r;case 101:return Hr(r,/(.+:)([^;!]+)(;|!.+)?/,"$1"+zr+(Ko(r,14)===45?"inline-":"")+"box$3$1"+zr+"$2$3$1"+Ea+"$2box$3")+r}break;case 5936:switch(Ko(r,t+11)){case 114:return zr+r+Ea+Hr(r,/[svh]\w+-[tblr]{2}/,"tb")+r;case 108:return zr+r+Ea+Hr(r,/[svh]\w+-[tblr]{2}/,"tb-rl")+r;case 45:return zr+r+Ea+Hr(r,/[svh]\w+-[tblr]{2}/,"lr")+r}return zr+r+Ea+r+r}return r}var Kwe=function(t,s,a,l){if(t.length>-1&&!t.return)switch(t.type){case uV:t.return=tQ(t.value,t.length);break;case YJ:return uS([Rb(t,{value:Hr(t.value,"@","@"+zr)})],l);case lV:if(t.length)return Owe(t.props,function(d){switch(Awe(d,/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":return uS([Rb(t,{props:[Hr(d,/:(read-\w+)/,":"+VP+"$1")]})],l);case"::placeholder":return uS([Rb(t,{props:[Hr(d,/:(plac\w+)/,":"+zr+"input-$1")]}),Rb(t,{props:[Hr(d,/:(plac\w+)/,":"+VP+"$1")]}),Rb(t,{props:[Hr(d,/:(plac\w+)/,Ea+"input-$1")]})],l)}return""})}},qwe=[Kwe],$we=function(t){var s=t.key;if(s==="css"){var a=document.querySelectorAll("style[data-emotion]:not([data-s])");Array.prototype.forEach.call(a,function(z){var G=z.getAttribute("data-emotion");G.indexOf(" ")!==-1&&(document.head.appendChild(z),z.setAttribute("data-s",""))})}var l=t.stylisPlugins||qwe,d={},p,E=[];p=t.container||document.head,Array.prototype.forEach.call(document.querySelectorAll('style[data-emotion^="'+s+' "]'),function(z){for(var G=z.getAttribute("data-emotion").split(" "),ee=1;ee<G.length;ee++)d[G[ee]]=!0;E.push(z)});var v,b=[zwe,Hwe];{var R,O=[Vwe,jwe(function(z){R.insert(z)})],N=Fwe(b.concat(l,O)),F=function(G){return uS(Mwe(G),N)};v=function(G,ee,J,re){R=J,F(G?G+"{"+ee.styles+"}":ee.styles),re&&(H.inserted[ee.name]=!0)}}var H={key:s,sheet:new Twe({key:s,container:p,nonce:t.nonce,speedy:t.speedy,prepend:t.prepend,insertionPoint:t.insertionPoint}),nonce:t.nonce,inserted:d,registered:{},insert:v};return H.sheet.hydrate(E),H};function $_(){return $_=Object.assign?Object.assign.bind():function(r){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var a in s)({}).hasOwnProperty.call(s,a)&&(r[a]=s[a])}return r},$_.apply(null,arguments)}var bM={exports:{}},Qr={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var yq;function Ywe(){if(yq)return Qr;yq=1;var r=typeof Symbol=="function"&&Symbol.for,t=r?Symbol.for("react.element"):60103,s=r?Symbol.for("react.portal"):60106,a=r?Symbol.for("react.fragment"):60107,l=r?Symbol.for("react.strict_mode"):60108,d=r?Symbol.for("react.profiler"):60114,p=r?Symbol.for("react.provider"):60109,E=r?Symbol.for("react.context"):60110,v=r?Symbol.for("react.async_mode"):60111,b=r?Symbol.for("react.concurrent_mode"):60111,R=r?Symbol.for("react.forward_ref"):60112,O=r?Symbol.for("react.suspense"):60113,N=r?Symbol.for("react.suspense_list"):60120,F=r?Symbol.for("react.memo"):60115,H=r?Symbol.for("react.lazy"):60116,z=r?Symbol.for("react.block"):60121,G=r?Symbol.for("react.fundamental"):60117,ee=r?Symbol.for("react.responder"):60118,J=r?Symbol.for("react.scope"):60119;function re(se){if(typeof se=="object"&&se!==null){var ye=se.$$typeof;switch(ye){case t:switch(se=se.type,se){case v:case b:case a:case d:case l:case O:return se;default:switch(se=se&&se.$$typeof,se){case E:case R:case H:case F:case p:return se;default:return ye}}case s:return ye}}}function de(se){return re(se)===b}return Qr.AsyncMode=v,Qr.ConcurrentMode=b,Qr.ContextConsumer=E,Qr.ContextProvider=p,Qr.Element=t,Qr.ForwardRef=R,Qr.Fragment=a,Qr.Lazy=H,Qr.Memo=F,Qr.Portal=s,Qr.Profiler=d,Qr.StrictMode=l,Qr.Suspense=O,Qr.isAsyncMode=function(se){return de(se)||re(se)===v},Qr.isConcurrentMode=de,Qr.isContextConsumer=function(se){return re(se)===E},Qr.isContextProvider=function(se){return re(se)===p},Qr.isElement=function(se){return typeof se=="object"&&se!==null&&se.$$typeof===t},Qr.isForwardRef=function(se){return re(se)===R},Qr.isFragment=function(se){return re(se)===a},Qr.isLazy=function(se){return re(se)===H},Qr.isMemo=function(se){return re(se)===F},Qr.isPortal=function(se){return re(se)===s},Qr.isProfiler=function(se){return re(se)===d},Qr.isStrictMode=function(se){return re(se)===l},Qr.isSuspense=function(se){return re(se)===O},Qr.isValidElementType=function(se){return typeof se=="string"||typeof se=="function"||se===a||se===b||se===d||se===l||se===O||se===N||typeof se=="object"&&se!==null&&(se.$$typeof===H||se.$$typeof===F||se.$$typeof===p||se.$$typeof===E||se.$$typeof===R||se.$$typeof===G||se.$$typeof===ee||se.$$typeof===J||se.$$typeof===z)},Qr.typeOf=re,Qr}var vq;function Xwe(){return vq||(vq=1,bM.exports=Ywe()),bM.exports}var wM,Sq;function Jwe(){if(Sq)return wM;Sq=1;var r=Xwe(),t={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},s={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},a={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},l={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},d={};d[r.ForwardRef]=a,d[r.Memo]=l;function p(H){return r.isMemo(H)?l:d[H.$$typeof]||t}var E=Object.defineProperty,v=Object.getOwnPropertyNames,b=Object.getOwnPropertySymbols,R=Object.getOwnPropertyDescriptor,O=Object.getPrototypeOf,N=Object.prototype;function F(H,z,G){if(typeof z!="string"){if(N){var ee=O(z);ee&&ee!==N&&F(H,ee,G)}var J=v(z);b&&(J=J.concat(b(z)));for(var re=p(H),de=p(z),se=0;se<J.length;++se){var ye=J[se];if(!s[ye]&&!(G&&G[ye])&&!(de&&de[ye])&&!(re&&re[ye])){var Q=R(z,ye);try{E(H,ye,Q)}catch{}}}}return H}return wM=F,wM}Jwe();var Qwe=!0;function nQ(r,t,s){var a="";return s.split(" ").forEach(function(l){r[l]!==void 0?t.push(r[l]+";"):l&&(a+=l+" ")}),a}var hV=function(t,s,a){var l=t.key+"-"+s.name;(a===!1||Qwe===!1)&&t.registered[l]===void 0&&(t.registered[l]=s.styles)},fV=function(t,s,a){hV(t,s,a);var l=t.key+"-"+s.name;if(t.inserted[s.name]===void 0){var d=s;do t.insert(s===d?"."+l:"",d,t.sheet,!0),d=d.next;while(d!==void 0)}};function Zwe(r){for(var t=0,s,a=0,l=r.length;l>=4;++a,l-=4)s=r.charCodeAt(a)&255|(r.charCodeAt(++a)&255)<<8|(r.charCodeAt(++a)&255)<<16|(r.charCodeAt(++a)&255)<<24,s=(s&65535)*1540483477+((s>>>16)*59797<<16),s^=s>>>24,t=(s&65535)*1540483477+((s>>>16)*59797<<16)^(t&65535)*1540483477+((t>>>16)*59797<<16);switch(l){case 3:t^=(r.charCodeAt(a+2)&255)<<16;case 2:t^=(r.charCodeAt(a+1)&255)<<8;case 1:t^=r.charCodeAt(a)&255,t=(t&65535)*1540483477+((t>>>16)*59797<<16)}return t^=t>>>13,t=(t&65535)*1540483477+((t>>>16)*59797<<16),((t^t>>>15)>>>0).toString(36)}var eRe={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,scale:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},tRe=/[A-Z]|^ms/g,nRe=/_EMO_([^_]+?)_([^]*?)_EMO_/g,rQ=function(t){return t.charCodeAt(1)===45},Tq=function(t){return t!=null&&typeof t!="boolean"},RM=eQ(function(r){return rQ(r)?r:r.replace(tRe,"-$&").toLowerCase()}),bq=function(t,s){switch(t){case"animation":case"animationName":if(typeof s=="string")return s.replace(nRe,function(a,l,d){return hh={name:l,styles:d,next:hh},l})}return eRe[t]!==1&&!rQ(t)&&typeof s=="number"&&s!==0?s+"px":s};function Dw(r,t,s){if(s==null)return"";var a=s;if(a.__emotion_styles!==void 0)return a;switch(typeof s){case"boolean":return"";case"object":{var l=s;if(l.anim===1)return hh={name:l.name,styles:l.styles,next:hh},l.name;var d=s;if(d.styles!==void 0){var p=d.next;if(p!==void 0)for(;p!==void 0;)hh={name:p.name,styles:p.styles,next:hh},p=p.next;var E=d.styles+";";return E}return rRe(r,t,s)}case"function":{if(r!==void 0){var v=hh,b=s(r);return hh=v,Dw(r,t,b)}break}}var R=s;if(t==null)return R;var O=t[R];return O!==void 0?O:R}function rRe(r,t,s){var a="";if(Array.isArray(s))for(var l=0;l<s.length;l++)a+=Dw(r,t,s[l])+";";else for(var d in s){var p=s[d];if(typeof p!="object"){var E=p;t!=null&&t[E]!==void 0?a+=d+"{"+t[E]+"}":Tq(E)&&(a+=RM(d)+":"+bq(d,E)+";")}else if(Array.isArray(p)&&typeof p[0]=="string"&&(t==null||t[p[0]]===void 0))for(var v=0;v<p.length;v++)Tq(p[v])&&(a+=RM(d)+":"+bq(d,p[v])+";");else{var b=Dw(r,t,p);switch(d){case"animation":case"animationName":{a+=RM(d)+":"+b+";";break}default:a+=d+"{"+b+"}"}}}return a}var wq=/label:\s*([^\s;{]+)\s*(;|$)/g,hh;function ON(r,t,s){if(r.length===1&&typeof r[0]=="object"&&r[0]!==null&&r[0].styles!==void 0)return r[0];var a=!0,l="";hh=void 0;var d=r[0];if(d==null||d.raw===void 0)a=!1,l+=Dw(s,t,d);else{var p=d;l+=p[0]}for(var E=1;E<r.length;E++)if(l+=Dw(s,t,r[E]),a){var v=d;l+=v[E]}wq.lastIndex=0;for(var b="",R;(R=wq.exec(l))!==null;)b+="-"+R[1];var O=Zwe(l)+b;return{name:O,styles:l,next:hh}}var iRe=function(t){return t()},iQ=VK.useInsertionEffect?VK.useInsertionEffect:!1,sQ=iQ||iRe,Rq=iQ||V.useLayoutEffect,pV=V.createContext(typeof HTMLElement<"u"?$we({key:"css"}):null);pV.Provider;var sRe=function(){return V.useContext(pV)},mV=function(t){return V.forwardRef(function(s,a){var l=V.useContext(pV);return t(s,l,a)})},TS=V.createContext({}),oRe=function(t,s){if(typeof s=="function"){var a=s(t);return a}return $_({},t,s)},aRe=_q(function(r){return _q(function(t){return oRe(r,t)})}),cRe=function(t){var s=V.useContext(TS);return t.theme!==s&&(s=aRe(s)(t.theme)),V.createElement(TS.Provider,{value:s},t.children)},gV={}.hasOwnProperty,x2="__EMOTION_TYPE_PLEASE_DO_NOT_USE__",lRe=function(t,s){var a={};for(var l in s)gV.call(s,l)&&(a[l]=s[l]);return a[x2]=t,a},uRe=function(t){var s=t.cache,a=t.serialized,l=t.isStringTag;return hV(s,a,l),sQ(function(){return fV(s,a,l)}),null},dRe=mV(function(r,t,s){var a=r.css;typeof a=="string"&&t.registered[a]!==void 0&&(a=t.registered[a]);var l=r[x2],d=[a],p="";typeof r.className=="string"?p=nQ(t.registered,d,r.className):r.className!=null&&(p=r.className+" ");var E=ON(d,void 0,V.useContext(TS));p+=t.key+"-"+E.name;var v={};for(var b in r)gV.call(r,b)&&b!=="css"&&b!==x2&&(v[b]=r[b]);return v.className=p,s&&(v.ref=s),V.createElement(V.Fragment,null,V.createElement(uRe,{cache:t,serialized:E,isStringTag:typeof l=="string"}),V.createElement(l,v))}),hRe=dRe,Cq=function(t,s){var a=arguments;if(s==null||!gV.call(s,"css"))return V.createElement.apply(void 0,a);var l=a.length,d=new Array(l);d[0]=hRe,d[1]=lRe(t,s);for(var p=2;p<l;p++)d[p]=a[p];return V.createElement.apply(null,d)};(function(r){var t;t||(t=r.JSX||(r.JSX={}))})(Cq||(Cq={}));var PN=mV(function(r,t){var s=r.styles,a=ON([s],void 0,V.useContext(TS)),l=V.useRef();return Rq(function(){var d=t.key+"-global",p=new t.sheet.constructor({key:d,nonce:t.sheet.nonce,container:t.sheet.container,speedy:t.sheet.isSpeedy}),E=!1,v=document.querySelector('style[data-emotion="'+d+" "+a.name+'"]');return t.sheet.tags.length&&(p.before=t.sheet.tags[0]),v!==null&&(E=!0,v.setAttribute("data-emotion",d),p.hydrate([v])),l.current=[p,E],function(){p.flush()}},[t]),Rq(function(){var d=l.current,p=d[0],E=d[1];if(E){d[1]=!1;return}if(a.next!==void 0&&fV(t,a.next,!0),p.tags.length){var v=p.tags[p.tags.length-1].nextElementSibling;p.before=v,p.flush()}t.insert("",a,p,!1)},[t,a.name]),null});function fRe(){for(var r=arguments.length,t=new Array(r),s=0;s<r;s++)t[s]=arguments[s];return ON(t)}function lR(){var r=fRe.apply(void 0,arguments),t="animation-"+r.name;return{name:t,styles:"@keyframes "+t+"{"+r.styles+"}",anim:1,toString:function(){return"_EMO_"+this.name+"_"+this.styles+"_EMO_"}}}const _V=V.createContext({});_V.displayName="ColorModeContext";function NN(){const r=V.useContext(_V);if(r===void 0)throw new Error("useColorMode must be used within a ColorModeProvider");return r}function pRe(r,t){const{colorMode:s}=NN();return s==="dark"?t:r}const OO={light:"chakra-ui-light",dark:"chakra-ui-dark"};function mRe(r={}){const{preventTransition:t=!0,nonce:s}=r,a={setDataset:l=>{const d=t?a.preventTransition():void 0;document.documentElement.dataset.theme=l,document.documentElement.style.colorScheme=l,d==null||d()},setClassName(l){document.body.classList.add(l?OO.dark:OO.light),document.body.classList.remove(l?OO.light:OO.dark)},query(){return window.matchMedia("(prefers-color-scheme: dark)")},getSystemTheme(l){return a.query().matches??l==="dark"?"dark":"light"},addListener(l){const d=a.query(),p=E=>{l(E.matches?"dark":"light")};return typeof d.addListener=="function"?d.addListener(p):d.addEventListener("change",p),()=>{typeof d.removeListener=="function"?d.removeListener(p):d.removeEventListener("change",p)}},preventTransition(){const l=document.createElement("style");return l.appendChild(document.createTextNode("*{-webkit-transition:none!important;-moz-transition:none!important;-o-transition:none!important;-ms-transition:none!important;transition:none!important}")),s!==void 0&&(l.nonce=s),document.head.appendChild(l),()=>{window.getComputedStyle(document.body),requestAnimationFrame(()=>{requestAnimationFrame(()=>{document.head.removeChild(l)})})}}};return a}const gRe="chakra-ui-color-mode";function _Re(r){return{ssr:!1,type:"localStorage",get(t){if(!(globalThis!=null&&globalThis.document))return t;let s;try{s=localStorage.getItem(r)||t}catch{}return s||t},set(t){try{localStorage.setItem(r,t)}catch{}}}}const ERe=_Re(gRe),Iq=()=>{},yRe=Fge()?V.useLayoutEffect:V.useEffect;function Aq(r,t){return r.type==="cookie"&&r.ssr?r.get(t):t}const oQ=function(t){const{value:s,children:a,options:{useSystemColorMode:l,initialColorMode:d,disableTransitionOnChange:p}={},colorModeManager:E=ERe}=t,v=sRe(),b=d==="dark"?"dark":"light",[R,O]=V.useState(()=>Aq(E,b)),[N,F]=V.useState(()=>Aq(E)),{getSystemTheme:H,setClassName:z,setDataset:G,addListener:ee}=V.useMemo(()=>mRe({preventTransition:p,nonce:v==null?void 0:v.nonce}),[p,v==null?void 0:v.nonce]),J=d==="system"&&!R?N:R,re=V.useCallback(ye=>{const Q=ye==="system"?H():ye;O(Q),z(Q==="dark"),G(Q),E.set(Q)},[E,H,z,G]);yRe(()=>{d==="system"&&F(H())},[]),V.useEffect(()=>{const ye=E.get();if(ye){re(ye);return}if(d==="system"){re("system");return}re(b)},[E,b,d,re]);const de=V.useCallback(()=>{re(J==="dark"?"light":"dark")},[J,re]);V.useEffect(()=>{if(l)return ee(re)},[l,ee,re]);const se=V.useMemo(()=>({colorMode:s??J,toggleColorMode:s?Iq:de,setColorMode:s?Iq:re,forced:s!==void 0}),[J,de,re,s]);return D.jsx(_V.Provider,{value:se,children:a})};oQ.displayName="ColorModeProvider";const aQ=String.raw,cQ=aQ`
  :root,
  :host {
    --chakra-vh: 100vh;
  }

  @supports (height: -webkit-fill-available) {
    :root,
    :host {
      --chakra-vh: -webkit-fill-available;
    }
  }

  @supports (height: -moz-fill-available) {
    :root,
    :host {
      --chakra-vh: -moz-fill-available;
    }
  }

  @supports (height: 100dvh) {
    :root,
    :host {
      --chakra-vh: 100dvh;
    }
  }
`,vRe=()=>D.jsx(PN,{styles:cQ}),SRe=({scope:r=""})=>D.jsx(PN,{styles:aQ`
      html {
        line-height: 1.5;
        -webkit-text-size-adjust: 100%;
        font-family: system-ui, sans-serif;
        -webkit-font-smoothing: antialiased;
        text-rendering: optimizeLegibility;
        -moz-osx-font-smoothing: grayscale;
        touch-action: manipulation;
      }

      body {
        position: relative;
        min-height: 100%;
        margin: 0;
        font-feature-settings: "kern";
      }

      ${r} :where(*, *::before, *::after) {
        border-width: 0;
        border-style: solid;
        box-sizing: border-box;
        word-wrap: break-word;
      }

      main {
        display: block;
      }

      ${r} hr {
        border-top-width: 1px;
        box-sizing: content-box;
        height: 0;
        overflow: visible;
      }

      ${r} :where(pre, code, kbd,samp) {
        font-family: SFMono-Regular, Menlo, Monaco, Consolas, monospace;
        font-size: 1em;
      }

      ${r} a {
        background-color: transparent;
        color: inherit;
        text-decoration: inherit;
      }

      ${r} abbr[title] {
        border-bottom: none;
        text-decoration: underline;
        -webkit-text-decoration: underline dotted;
        text-decoration: underline dotted;
      }

      ${r} :where(b, strong) {
        font-weight: bold;
      }

      ${r} small {
        font-size: 80%;
      }

      ${r} :where(sub,sup) {
        font-size: 75%;
        line-height: 0;
        position: relative;
        vertical-align: baseline;
      }

      ${r} sub {
        bottom: -0.25em;
      }

      ${r} sup {
        top: -0.5em;
      }

      ${r} img {
        border-style: none;
      }

      ${r} :where(button, input, optgroup, select, textarea) {
        font-family: inherit;
        font-size: 100%;
        line-height: 1.15;
        margin: 0;
      }

      ${r} :where(button, input) {
        overflow: visible;
      }

      ${r} :where(button, select) {
        text-transform: none;
      }

      ${r} :where(
          button::-moz-focus-inner,
          [type="button"]::-moz-focus-inner,
          [type="reset"]::-moz-focus-inner,
          [type="submit"]::-moz-focus-inner
        ) {
        border-style: none;
        padding: 0;
      }

      ${r} fieldset {
        padding: 0.35em 0.75em 0.625em;
      }

      ${r} legend {
        box-sizing: border-box;
        color: inherit;
        display: table;
        max-width: 100%;
        padding: 0;
        white-space: normal;
      }

      ${r} progress {
        vertical-align: baseline;
      }

      ${r} textarea {
        overflow: auto;
      }

      ${r} :where([type="checkbox"], [type="radio"]) {
        box-sizing: border-box;
        padding: 0;
      }

      ${r} input[type="number"]::-webkit-inner-spin-button,
      ${r} input[type="number"]::-webkit-outer-spin-button {
        -webkit-appearance: none !important;
      }

      ${r} input[type="number"] {
        -moz-appearance: textfield;
      }

      ${r} input[type="search"] {
        -webkit-appearance: textfield;
        outline-offset: -2px;
      }

      ${r} input[type="search"]::-webkit-search-decoration {
        -webkit-appearance: none !important;
      }

      ${r} ::-webkit-file-upload-button {
        -webkit-appearance: button;
        font: inherit;
      }

      ${r} details {
        display: block;
      }

      ${r} summary {
        display: list-item;
      }

      template {
        display: none;
      }

      [hidden] {
        display: none !important;
      }

      ${r} :where(
          blockquote,
          dl,
          dd,
          h1,
          h2,
          h3,
          h4,
          h5,
          h6,
          hr,
          figure,
          p,
          pre
        ) {
        margin: 0;
      }

      ${r} button {
        background: transparent;
        padding: 0;
      }

      ${r} fieldset {
        margin: 0;
        padding: 0;
      }

      ${r} :where(ol, ul) {
        margin: 0;
        padding: 0;
      }

      ${r} textarea {
        resize: vertical;
      }

      ${r} :where(button, [role="button"]) {
        cursor: pointer;
      }

      ${r} button::-moz-focus-inner {
        border: 0 !important;
      }

      ${r} table {
        border-collapse: collapse;
      }

      ${r} :where(h1, h2, h3, h4, h5, h6) {
        font-size: inherit;
        font-weight: inherit;
      }

      ${r} :where(button, input, optgroup, select, textarea) {
        padding: 0;
        line-height: inherit;
        color: inherit;
      }

      ${r} :where(img, svg, video, canvas, audio, iframe, embed, object) {
        display: block;
      }

      ${r} :where(img, video) {
        max-width: 100%;
        height: auto;
      }

      [data-js-focus-visible]
        :focus:not([data-focus-visible-added]):not(
          [data-focus-visible-disabled]
        ) {
        outline: none;
        box-shadow: none;
      }

      ${r} select::-ms-expand {
        display: none;
      }

      ${cQ}
    `});function TRe(r){const{cssVarsRoot:t,theme:s,children:a}=r,l=V.useMemo(()=>cye(s),[s]);return D.jsxs(cRe,{theme:l,children:[D.jsx(bRe,{root:t}),a]})}function bRe({root:r=":host, :root"}){const t=[r,"[data-theme]"].join(",");return D.jsx(PN,{styles:s=>({[t]:s.__cssVars})})}Mi({name:"StylesContext",errorMessage:"useStyles: `styles` is undefined. Seems you forgot to wrap the components in `<StylesProvider />` "});function wRe(){const{colorMode:r}=NN();return D.jsx(PN,{styles:t=>{const s=gJ(t,"styles.global"),a=xc(s,{theme:t,colorMode:r});return a?DJ(a)(t):void 0}})}const[RRe,CRe]=Mi({strict:!1,name:"PortalManagerContext"});function EV(r){const{children:t,zIndex:s}=r;return D.jsx(RRe,{value:{zIndex:s},children:t})}EV.displayName="PortalManager";const lQ=V.createContext({getDocument(){return document},getWindow(){return window}});lQ.displayName="EnvironmentContext";function uQ(r){const{children:t,environment:s,disabled:a}=r,l=V.useRef(null),d=V.useMemo(()=>s||{getDocument:()=>{var E;return((E=l.current)==null?void 0:E.ownerDocument)??document},getWindow:()=>{var E;return((E=l.current)==null?void 0:E.ownerDocument.defaultView)??window}},[s]),p=!a||!s;return D.jsxs(lQ.Provider,{value:d,children:[t,p&&D.jsx("span",{id:"__chakra_env",hidden:!0,ref:l})]})}uQ.displayName="EnvironmentProvider";const IRe=r=>{const{children:t,colorModeManager:s,portalZIndex:a,resetScope:l,resetCSS:d=!0,theme:p={},environment:E,cssVarsRoot:v,disableEnvironment:b,disableGlobalStyle:R}=r,O=D.jsx(uQ,{environment:E,disabled:b,children:t});return D.jsx(TRe,{theme:p,cssVarsRoot:v,children:D.jsxs(oQ,{colorModeManager:s,options:p.config,children:[d?D.jsx(SRe,{scope:l}):D.jsx(vRe,{}),!R&&D.jsx(wRe,{}),a?D.jsx(EV,{zIndex:a,children:O}):O]})})},yV=V.createContext({});function vV(r){const t=V.useRef(null);return t.current===null&&(t.current=r()),t.current}const uR=V.createContext(null),SV=V.createContext({transformPagePoint:r=>r,isStatic:!1,reducedMotion:"never"});class ARe extends V.Component{getSnapshotBeforeUpdate(t){const s=this.props.childRef.current;if(s&&t.isPresent&&!this.props.isPresent){const a=this.props.sizeRef.current;a.height=s.offsetHeight||0,a.width=s.offsetWidth||0,a.top=s.offsetTop,a.left=s.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function ORe({children:r,isPresent:t}){const s=V.useId(),a=V.useRef(null),l=V.useRef({width:0,height:0,top:0,left:0}),{nonce:d}=V.useContext(SV);return V.useInsertionEffect(()=>{const{width:p,height:E,top:v,left:b}=l.current;if(t||!a.current||!p||!E)return;a.current.dataset.motionPopId=s;const R=document.createElement("style");return d&&(R.nonce=d),document.head.appendChild(R),R.sheet&&R.sheet.insertRule(`
          [data-motion-pop-id="${s}"] {
            position: absolute !important;
            width: ${p}px !important;
            height: ${E}px !important;
            top: ${v}px !important;
            left: ${b}px !important;
          }
        `),()=>{document.head.removeChild(R)}},[t]),D.jsx(ARe,{isPresent:t,childRef:a,sizeRef:l,children:V.cloneElement(r,{ref:a})})}const PRe=({children:r,initial:t,isPresent:s,onExitComplete:a,custom:l,presenceAffectsLayout:d,mode:p})=>{const E=vV(NRe),v=V.useId(),b=V.useCallback(O=>{E.set(O,!0);for(const N of E.values())if(!N)return;a&&a()},[E,a]),R=V.useMemo(()=>({id:v,initial:t,isPresent:s,custom:l,onExitComplete:b,register:O=>(E.set(O,!1),()=>E.delete(O))}),d?[Math.random(),b]:[s,b]);return V.useMemo(()=>{E.forEach((O,N)=>E.set(N,!1))},[s]),V.useEffect(()=>{!s&&!E.size&&a&&a()},[s]),p==="popLayout"&&(r=D.jsx(ORe,{isPresent:s,children:r})),D.jsx(uR.Provider,{value:R,children:r})};function NRe(){return new Map}function TV(r=!0){const t=V.useContext(uR);if(t===null)return[!0,null];const{isPresent:s,onExitComplete:a,register:l}=t,d=V.useId();V.useEffect(()=>{r&&l(d)},[r]);const p=V.useCallback(()=>r&&a&&a(d),[d,a,r]);return!s&&a?[!1,p]:[!0]}function kRe(){return DRe(V.useContext(uR))}function DRe(r){return r===null?!0:r.isPresent}const PO=r=>r.key||"";function Oq(r){const t=[];return V.Children.forEach(r,s=>{V.isValidElement(s)&&t.push(s)}),t}const bV=typeof window<"u",dQ=bV?V.useLayoutEffect:V.useEffect,zS=({children:r,custom:t,initial:s=!0,onExitComplete:a,presenceAffectsLayout:l=!0,mode:d="sync",propagate:p=!1})=>{const[E,v]=TV(p),b=V.useMemo(()=>Oq(r),[r]),R=p&&!E?[]:b.map(PO),O=V.useRef(!0),N=V.useRef(b),F=vV(()=>new Map),[H,z]=V.useState(b),[G,ee]=V.useState(b);dQ(()=>{O.current=!1,N.current=b;for(let de=0;de<G.length;de++){const se=PO(G[de]);R.includes(se)?F.delete(se):F.get(se)!==!0&&F.set(se,!1)}},[G,R.length,R.join("-")]);const J=[];if(b!==H){let de=[...b];for(let se=0;se<G.length;se++){const ye=G[se],Q=PO(ye);R.includes(Q)||(de.splice(se,0,ye),J.push(ye))}d==="wait"&&J.length&&(de=J),ee(Oq(de)),z(b);return}const{forceRender:re}=V.useContext(yV);return D.jsx(D.Fragment,{children:G.map(de=>{const se=PO(de),ye=p&&!E?!1:b===G||R.includes(se),Q=()=>{if(F.has(se))F.set(se,!0);else return;let ne=!0;F.forEach(oe=>{oe||(ne=!1)}),ne&&(re==null||re(),ee(N.current),p&&(v==null||v()),a&&a())};return D.jsx(PRe,{isPresent:ye,initial:!O.current||s?void 0:!1,custom:ye?void 0:t,presenceAffectsLayout:l,mode:d,onExitComplete:ye?void 0:Q,children:de},se)})})},gl=r=>r;let hQ=gl;function wV(r){let t;return()=>(t===void 0&&(t=r()),t)}const bS=(r,t,s)=>{const a=t-r;return a===0?1:(s-r)/a},Jf=r=>r*1e3,Qf=r=>r/1e3,LRe={useManualTiming:!1};function xRe(r){let t=new Set,s=new Set,a=!1,l=!1;const d=new WeakSet;let p={delta:0,timestamp:0,isProcessing:!1};function E(b){d.has(b)&&(v.schedule(b),r()),b(p)}const v={schedule:(b,R=!1,O=!1)=>{const F=O&&a?t:s;return R&&d.add(b),F.has(b)||F.add(b),b},cancel:b=>{s.delete(b),d.delete(b)},process:b=>{if(p=b,a){l=!0;return}a=!0,[t,s]=[s,t],t.forEach(E),t.clear(),a=!1,l&&(l=!1,v.process(b))}};return v}const NO=["read","resolveKeyframes","update","preRender","render","postRender"],MRe=40;function fQ(r,t){let s=!1,a=!0;const l={delta:0,timestamp:0,isProcessing:!1},d=()=>s=!0,p=NO.reduce((ee,J)=>(ee[J]=xRe(d),ee),{}),{read:E,resolveKeyframes:v,update:b,preRender:R,render:O,postRender:N}=p,F=()=>{const ee=performance.now();s=!1,l.delta=a?1e3/60:Math.max(Math.min(ee-l.timestamp,MRe),1),l.timestamp=ee,l.isProcessing=!0,E.process(l),v.process(l),b.process(l),R.process(l),O.process(l),N.process(l),l.isProcessing=!1,s&&t&&(a=!1,r(F))},H=()=>{s=!0,a=!0,l.isProcessing||r(F)};return{schedule:NO.reduce((ee,J)=>{const re=p[J];return ee[J]=(de,se=!1,ye=!1)=>(s||H(),re.schedule(de,se,ye)),ee},{}),cancel:ee=>{for(let J=0;J<NO.length;J++)p[NO[J]].cancel(ee)},state:l,steps:p}}const{schedule:xi,cancel:Vm,state:Go,steps:CM}=fQ(typeof requestAnimationFrame<"u"?requestAnimationFrame:gl,!0),pQ=V.createContext({strict:!1}),Pq={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},wS={};for(const r in Pq)wS[r]={isEnabled:t=>Pq[r].some(s=>!!t[s])};function URe(r){for(const t in r)wS[t]={...wS[t],...r[t]}}const VRe=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function FP(r){return r.startsWith("while")||r.startsWith("drag")&&r!=="draggable"||r.startsWith("layout")||r.startsWith("onTap")||r.startsWith("onPan")||r.startsWith("onLayout")||VRe.has(r)}let mQ=r=>!FP(r);function FRe(r){r&&(mQ=t=>t.startsWith("on")?!FP(t):r(t))}try{FRe(require("@emotion/is-prop-valid").default)}catch{}function jRe(r,t,s){const a={};for(const l in r)l==="values"&&typeof r.values=="object"||(mQ(l)||s===!0&&FP(l)||!t&&!FP(l)||r.draggable&&l.startsWith("onDrag"))&&(a[l]=r[l]);return a}function BRe(r){if(typeof Proxy>"u")return r;const t=new Map,s=(...a)=>r(...a);return new Proxy(s,{get:(a,l)=>l==="create"?r:(t.has(l)||t.set(l,r(l)),t.get(l))})}const kN=V.createContext({});function Lw(r){return typeof r=="string"||Array.isArray(r)}function DN(r){return r!==null&&typeof r=="object"&&typeof r.start=="function"}const RV=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],CV=["initial",...RV];function LN(r){return DN(r.animate)||CV.some(t=>Lw(r[t]))}function gQ(r){return!!(LN(r)||r.variants)}function WRe(r,t){if(LN(r)){const{initial:s,animate:a}=r;return{initial:s===!1||Lw(s)?s:void 0,animate:Lw(a)?a:void 0}}return r.inherit!==!1?t:{}}function GRe(r){const{initial:t,animate:s}=WRe(r,V.useContext(kN));return V.useMemo(()=>({initial:t,animate:s}),[Nq(t),Nq(s)])}function Nq(r){return Array.isArray(r)?r.join(" "):r}const zRe=Symbol.for("motionComponentSymbol");function Xv(r){return r&&typeof r=="object"&&Object.prototype.hasOwnProperty.call(r,"current")}function HRe(r,t,s){return V.useCallback(a=>{a&&r.onMount&&r.onMount(a),t&&(a?t.mount(a):t.unmount()),s&&(typeof s=="function"?s(a):Xv(s)&&(s.current=a))},[t])}const IV=r=>r.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),KRe="framerAppearId",_Q="data-"+IV(KRe),{schedule:AV}=fQ(queueMicrotask,!1),EQ=V.createContext({});function qRe(r,t,s,a,l){var d,p;const{visualElement:E}=V.useContext(kN),v=V.useContext(pQ),b=V.useContext(uR),R=V.useContext(SV).reducedMotion,O=V.useRef(null);a=a||v.renderer,!O.current&&a&&(O.current=a(r,{visualState:t,parent:E,props:s,presenceContext:b,blockInitialAnimation:b?b.initial===!1:!1,reducedMotionConfig:R}));const N=O.current,F=V.useContext(EQ);N&&!N.projection&&l&&(N.type==="html"||N.type==="svg")&&$Re(O.current,s,l,F);const H=V.useRef(!1);V.useInsertionEffect(()=>{N&&H.current&&N.update(s,b)});const z=s[_Q],G=V.useRef(!!z&&!(!((d=window.MotionHandoffIsComplete)===null||d===void 0)&&d.call(window,z))&&((p=window.MotionHasOptimisedAnimation)===null||p===void 0?void 0:p.call(window,z)));return dQ(()=>{N&&(H.current=!0,window.MotionIsMounted=!0,N.updateFeatures(),AV.render(N.render),G.current&&N.animationState&&N.animationState.animateChanges())}),V.useEffect(()=>{N&&(!G.current&&N.animationState&&N.animationState.animateChanges(),G.current&&(queueMicrotask(()=>{var ee;(ee=window.MotionHandoffMarkAsComplete)===null||ee===void 0||ee.call(window,z)}),G.current=!1))}),N}function $Re(r,t,s,a){const{layoutId:l,layout:d,drag:p,dragConstraints:E,layoutScroll:v,layoutRoot:b}=t;r.projection=new s(r.latestValues,t["data-framer-portal-id"]?void 0:yQ(r.parent)),r.projection.setOptions({layoutId:l,layout:d,alwaysMeasureLayout:!!p||E&&Xv(E),visualElement:r,animationType:typeof d=="string"?d:"both",initialPromotionConfig:a,layoutScroll:v,layoutRoot:b})}function yQ(r){if(r)return r.options.allowProjection!==!1?r.projection:yQ(r.parent)}function YRe({preloadedFeatures:r,createVisualElement:t,useRender:s,useVisualState:a,Component:l}){var d,p;r&&URe(r);function E(b,R){let O;const N={...V.useContext(SV),...b,layoutId:XRe(b)},{isStatic:F}=N,H=GRe(b),z=a(b,F);if(!F&&bV){JRe();const G=QRe(N);O=G.MeasureLayout,H.visualElement=qRe(l,z,N,t,G.ProjectionNode)}return D.jsxs(kN.Provider,{value:H,children:[O&&H.visualElement?D.jsx(O,{visualElement:H.visualElement,...N}):null,s(l,b,HRe(z,H.visualElement,R),z,F,H.visualElement)]})}E.displayName=`motion.${typeof l=="string"?l:`create(${(p=(d=l.displayName)!==null&&d!==void 0?d:l.name)!==null&&p!==void 0?p:""})`}`;const v=V.forwardRef(E);return v[zRe]=l,v}function XRe({layoutId:r}){const t=V.useContext(yV).id;return t&&r!==void 0?t+"-"+r:r}function JRe(r,t){V.useContext(pQ).strict}function QRe(r){const{drag:t,layout:s}=wS;if(!t&&!s)return{};const a={...t,...s};return{MeasureLayout:t!=null&&t.isEnabled(r)||s!=null&&s.isEnabled(r)?a.MeasureLayout:void 0,ProjectionNode:a.ProjectionNode}}const ZRe=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function OV(r){return typeof r!="string"||r.includes("-")?!1:!!(ZRe.indexOf(r)>-1||/[A-Z]/u.test(r))}function kq(r){const t=[{},{}];return r==null||r.values.forEach((s,a)=>{t[0][a]=s.get(),t[1][a]=s.getVelocity()}),t}function PV(r,t,s,a){if(typeof t=="function"){const[l,d]=kq(a);t=t(s!==void 0?s:r.custom,l,d)}if(typeof t=="string"&&(t=r.variants&&r.variants[t]),typeof t=="function"){const[l,d]=kq(a);t=t(s!==void 0?s:r.custom,l,d)}return t}const M2=r=>Array.isArray(r),eCe=r=>!!(r&&typeof r=="object"&&r.mix&&r.toValue),tCe=r=>M2(r)?r[r.length-1]||0:r,Ta=r=>!!(r&&r.getVelocity);function hP(r){const t=Ta(r)?r.get():r;return eCe(t)?t.toValue():t}function nCe({scrapeMotionValuesFromProps:r,createRenderState:t,onUpdate:s},a,l,d){const p={latestValues:rCe(a,l,d,r),renderState:t()};return s&&(p.onMount=E=>s({props:a,current:E,...p}),p.onUpdate=E=>s(E)),p}const vQ=r=>(t,s)=>{const a=V.useContext(kN),l=V.useContext(uR),d=()=>nCe(r,t,a,l);return s?d():vV(d)};function rCe(r,t,s,a){const l={},d=a(r,{});for(const N in d)l[N]=hP(d[N]);let{initial:p,animate:E}=r;const v=LN(r),b=gQ(r);t&&b&&!v&&r.inherit!==!1&&(p===void 0&&(p=t.initial),E===void 0&&(E=t.animate));let R=s?s.initial===!1:!1;R=R||p===!1;const O=R?E:p;if(O&&typeof O!="boolean"&&!DN(O)){const N=Array.isArray(O)?O:[O];for(let F=0;F<N.length;F++){const H=PV(r,N[F]);if(H){const{transitionEnd:z,transition:G,...ee}=H;for(const J in ee){let re=ee[J];if(Array.isArray(re)){const de=R?re.length-1:0;re=re[de]}re!==null&&(l[J]=re)}for(const J in z)l[J]=z[J]}}}return l}const HS=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],cE=new Set(HS),SQ=r=>t=>typeof t=="string"&&t.startsWith(r),TQ=SQ("--"),iCe=SQ("var(--"),NV=r=>iCe(r)?sCe.test(r.split("/*")[0].trim()):!1,sCe=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,bQ=(r,t)=>t&&typeof r=="number"?t.transform(r):r,np=(r,t,s)=>s>t?t:s<r?r:s,KS={test:r=>typeof r=="number",parse:parseFloat,transform:r=>r},xw={...KS,transform:r=>np(0,1,r)},kO={...KS,default:1},dR=r=>({test:t=>typeof t=="string"&&t.endsWith(r)&&t.split(" ").length===1,parse:parseFloat,transform:t=>`${t}${r}`}),Tm=dR("deg"),vh=dR("%"),Pn=dR("px"),oCe=dR("vh"),aCe=dR("vw"),Dq={...vh,parse:r=>vh.parse(r)/100,transform:r=>vh.transform(r*100)},cCe={borderWidth:Pn,borderTopWidth:Pn,borderRightWidth:Pn,borderBottomWidth:Pn,borderLeftWidth:Pn,borderRadius:Pn,radius:Pn,borderTopLeftRadius:Pn,borderTopRightRadius:Pn,borderBottomRightRadius:Pn,borderBottomLeftRadius:Pn,width:Pn,maxWidth:Pn,height:Pn,maxHeight:Pn,top:Pn,right:Pn,bottom:Pn,left:Pn,padding:Pn,paddingTop:Pn,paddingRight:Pn,paddingBottom:Pn,paddingLeft:Pn,margin:Pn,marginTop:Pn,marginRight:Pn,marginBottom:Pn,marginLeft:Pn,backgroundPositionX:Pn,backgroundPositionY:Pn},lCe={rotate:Tm,rotateX:Tm,rotateY:Tm,rotateZ:Tm,scale:kO,scaleX:kO,scaleY:kO,scaleZ:kO,skew:Tm,skewX:Tm,skewY:Tm,distance:Pn,translateX:Pn,translateY:Pn,translateZ:Pn,x:Pn,y:Pn,z:Pn,perspective:Pn,transformPerspective:Pn,opacity:xw,originX:Dq,originY:Dq,originZ:Pn},Lq={...KS,transform:Math.round},kV={...cCe,...lCe,zIndex:Lq,size:Pn,fillOpacity:xw,strokeOpacity:xw,numOctaves:Lq},uCe={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},dCe=HS.length;function hCe(r,t,s){let a="",l=!0;for(let d=0;d<dCe;d++){const p=HS[d],E=r[p];if(E===void 0)continue;let v=!0;if(typeof E=="number"?v=E===(p.startsWith("scale")?1:0):v=parseFloat(E)===0,!v||s){const b=bQ(E,kV[p]);if(!v){l=!1;const R=uCe[p]||p;a+=`${R}(${b}) `}s&&(t[p]=b)}}return a=a.trim(),s?a=s(t,l?"":a):l&&(a="none"),a}function DV(r,t,s){const{style:a,vars:l,transformOrigin:d}=r;let p=!1,E=!1;for(const v in t){const b=t[v];if(cE.has(v)){p=!0;continue}else if(TQ(v)){l[v]=b;continue}else{const R=bQ(b,kV[v]);v.startsWith("origin")?(E=!0,d[v]=R):a[v]=R}}if(t.transform||(p||s?a.transform=hCe(t,r.transform,s):a.transform&&(a.transform="none")),E){const{originX:v="50%",originY:b="50%",originZ:R=0}=d;a.transformOrigin=`${v} ${b} ${R}`}}const fCe={offset:"stroke-dashoffset",array:"stroke-dasharray"},pCe={offset:"strokeDashoffset",array:"strokeDasharray"};function mCe(r,t,s=1,a=0,l=!0){r.pathLength=1;const d=l?fCe:pCe;r[d.offset]=Pn.transform(-a);const p=Pn.transform(t),E=Pn.transform(s);r[d.array]=`${p} ${E}`}function xq(r,t,s){return typeof r=="string"?r:Pn.transform(t+s*r)}function gCe(r,t,s){const a=xq(t,r.x,r.width),l=xq(s,r.y,r.height);return`${a} ${l}`}function LV(r,{attrX:t,attrY:s,attrScale:a,originX:l,originY:d,pathLength:p,pathSpacing:E=1,pathOffset:v=0,...b},R,O){if(DV(r,b,O),R){r.style.viewBox&&(r.attrs.viewBox=r.style.viewBox);return}r.attrs=r.style,r.style={};const{attrs:N,style:F,dimensions:H}=r;N.transform&&(H&&(F.transform=N.transform),delete N.transform),H&&(l!==void 0||d!==void 0||F.transform)&&(F.transformOrigin=gCe(H,l!==void 0?l:.5,d!==void 0?d:.5)),t!==void 0&&(N.x=t),s!==void 0&&(N.y=s),a!==void 0&&(N.scale=a),p!==void 0&&mCe(N,p,E,v,!1)}const xV=()=>({style:{},transform:{},transformOrigin:{},vars:{}}),wQ=()=>({...xV(),attrs:{}}),MV=r=>typeof r=="string"&&r.toLowerCase()==="svg";function RQ(r,{style:t,vars:s},a,l){Object.assign(r.style,t,l&&l.getProjectionStyles(a));for(const d in s)r.style.setProperty(d,s[d])}const CQ=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function IQ(r,t,s,a){RQ(r,t,void 0,a);for(const l in t.attrs)r.setAttribute(CQ.has(l)?l:IV(l),t.attrs[l])}const jP={};function _Ce(r){Object.assign(jP,r)}function AQ(r,{layout:t,layoutId:s}){return cE.has(r)||r.startsWith("origin")||(t||s!==void 0)&&(!!jP[r]||r==="opacity")}function UV(r,t,s){var a;const{style:l}=r,d={};for(const p in l)(Ta(l[p])||t.style&&Ta(t.style[p])||AQ(p,r)||((a=s==null?void 0:s.getValue(p))===null||a===void 0?void 0:a.liveStyle)!==void 0)&&(d[p]=l[p]);return d}function OQ(r,t,s){const a=UV(r,t,s);for(const l in r)if(Ta(r[l])||Ta(t[l])){const d=HS.indexOf(l)!==-1?"attr"+l.charAt(0).toUpperCase()+l.substring(1):l;a[d]=r[l]}return a}function ECe(r,t){try{t.dimensions=typeof r.getBBox=="function"?r.getBBox():r.getBoundingClientRect()}catch{t.dimensions={x:0,y:0,width:0,height:0}}}const Mq=["x","y","width","height","cx","cy","r"],yCe={useVisualState:vQ({scrapeMotionValuesFromProps:OQ,createRenderState:wQ,onUpdate:({props:r,prevProps:t,current:s,renderState:a,latestValues:l})=>{if(!s)return;let d=!!r.drag;if(!d){for(const E in l)if(cE.has(E)){d=!0;break}}if(!d)return;let p=!t;if(t)for(let E=0;E<Mq.length;E++){const v=Mq[E];r[v]!==t[v]&&(p=!0)}p&&xi.read(()=>{ECe(s,a),xi.render(()=>{LV(a,l,MV(s.tagName),r.transformTemplate),IQ(s,a)})})}})},vCe={useVisualState:vQ({scrapeMotionValuesFromProps:UV,createRenderState:xV})};function PQ(r,t,s){for(const a in t)!Ta(t[a])&&!AQ(a,s)&&(r[a]=t[a])}function SCe({transformTemplate:r},t){return V.useMemo(()=>{const s=xV();return DV(s,t,r),Object.assign({},s.vars,s.style)},[t])}function TCe(r,t){const s=r.style||{},a={};return PQ(a,s,r),Object.assign(a,SCe(r,t)),a}function bCe(r,t){const s={},a=TCe(r,t);return r.drag&&r.dragListener!==!1&&(s.draggable=!1,a.userSelect=a.WebkitUserSelect=a.WebkitTouchCallout="none",a.touchAction=r.drag===!0?"none":`pan-${r.drag==="x"?"y":"x"}`),r.tabIndex===void 0&&(r.onTap||r.onTapStart||r.whileTap)&&(s.tabIndex=0),s.style=a,s}function wCe(r,t,s,a){const l=V.useMemo(()=>{const d=wQ();return LV(d,t,MV(a),r.transformTemplate),{...d.attrs,style:{...d.style}}},[t]);if(r.style){const d={};PQ(d,r.style,r),l.style={...d,...l.style}}return l}function RCe(r=!1){return(s,a,l,{latestValues:d},p)=>{const v=(OV(s)?wCe:bCe)(a,d,p,s),b=jRe(a,typeof s=="string",r),R=s!==V.Fragment?{...b,...v,ref:l}:{},{children:O}=a,N=V.useMemo(()=>Ta(O)?O.get():O,[O]);return V.createElement(s,{...R,children:N})}}function CCe(r,t){return function(a,{forwardMotionProps:l}={forwardMotionProps:!1}){const p={...OV(a)?yCe:vCe,preloadedFeatures:r,useRender:RCe(l),createVisualElement:t,Component:a};return YRe(p)}}function NQ(r,t){if(!Array.isArray(t))return!1;const s=t.length;if(s!==r.length)return!1;for(let a=0;a<s;a++)if(t[a]!==r[a])return!1;return!0}function xN(r,t,s){const a=r.getProps();return PV(a,t,s!==void 0?s:a.custom,r)}const ICe=wV(()=>window.ScrollTimeline!==void 0);class ACe{constructor(t){this.stop=()=>this.runAll("stop"),this.animations=t.filter(Boolean)}get finished(){return Promise.all(this.animations.map(t=>"finished"in t?t.finished:t))}getAll(t){return this.animations[0][t]}setAll(t,s){for(let a=0;a<this.animations.length;a++)this.animations[a][t]=s}attachTimeline(t,s){const a=this.animations.map(l=>{if(ICe()&&l.attachTimeline)return l.attachTimeline(t);if(typeof s=="function")return s(l)});return()=>{a.forEach((l,d)=>{l&&l(),this.animations[d].stop()})}}get time(){return this.getAll("time")}set time(t){this.setAll("time",t)}get speed(){return this.getAll("speed")}set speed(t){this.setAll("speed",t)}get startTime(){return this.getAll("startTime")}get duration(){let t=0;for(let s=0;s<this.animations.length;s++)t=Math.max(t,this.animations[s].duration);return t}runAll(t){this.animations.forEach(s=>s[t]())}flatten(){this.runAll("flatten")}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}class OCe extends ACe{then(t,s){return Promise.all(this.animations).then(t).catch(s)}}function VV(r,t){return r?r[t]||r.default||r:void 0}const U2=2e4;function kQ(r){let t=0;const s=50;let a=r.next(t);for(;!a.done&&t<U2;)t+=s,a=r.next(t);return t>=U2?1/0:t}function FV(r){return typeof r=="function"}function Uq(r,t){r.timeline=t,r.onfinish=null}const jV=r=>Array.isArray(r)&&typeof r[0]=="number",PCe={linearEasing:void 0};function NCe(r,t){const s=wV(r);return()=>{var a;return(a=PCe[t])!==null&&a!==void 0?a:s()}}const BP=NCe(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),DQ=(r,t,s=10)=>{let a="";const l=Math.max(Math.round(t/s),2);for(let d=0;d<l;d++)a+=r(bS(0,l-1,d))+", ";return`linear(${a.substring(0,a.length-2)})`};function LQ(r){return!!(typeof r=="function"&&BP()||!r||typeof r=="string"&&(r in V2||BP())||jV(r)||Array.isArray(r)&&r.every(LQ))}const Yb=([r,t,s,a])=>`cubic-bezier(${r}, ${t}, ${s}, ${a})`,V2={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:Yb([0,.65,.55,1]),circOut:Yb([.55,0,1,.45]),backIn:Yb([.31,.01,.66,-.59]),backOut:Yb([.33,1.53,.69,.99])};function xQ(r,t){if(r)return typeof r=="function"&&BP()?DQ(r,t):jV(r)?Yb(r):Array.isArray(r)?r.map(s=>xQ(s,t)||V2.easeOut):V2[r]}const od={x:!1,y:!1};function MQ(){return od.x||od.y}function kCe(r,t,s){var a;if(r instanceof Element)return[r];if(typeof r=="string"){let l=document;const d=(a=void 0)!==null&&a!==void 0?a:l.querySelectorAll(r);return d?Array.from(d):[]}return Array.from(r)}function UQ(r,t){const s=kCe(r),a=new AbortController,l={passive:!0,...t,signal:a.signal};return[s,l,()=>a.abort()]}function Vq(r){return t=>{t.pointerType==="touch"||MQ()||r(t)}}function DCe(r,t,s={}){const[a,l,d]=UQ(r,s),p=Vq(E=>{const{target:v}=E,b=t(E);if(typeof b!="function"||!v)return;const R=Vq(O=>{b(O),v.removeEventListener("pointerleave",R)});v.addEventListener("pointerleave",R,l)});return a.forEach(E=>{E.addEventListener("pointerenter",p,l)}),d}const VQ=(r,t)=>t?r===t?!0:VQ(r,t.parentElement):!1,BV=r=>r.pointerType==="mouse"?typeof r.button!="number"||r.button<=0:r.isPrimary!==!1,LCe=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function xCe(r){return LCe.has(r.tagName)||r.tabIndex!==-1}const Xb=new WeakSet;function Fq(r){return t=>{t.key==="Enter"&&r(t)}}function IM(r,t){r.dispatchEvent(new PointerEvent("pointer"+t,{isPrimary:!0,bubbles:!0}))}const MCe=(r,t)=>{const s=r.currentTarget;if(!s)return;const a=Fq(()=>{if(Xb.has(s))return;IM(s,"down");const l=Fq(()=>{IM(s,"up")}),d=()=>IM(s,"cancel");s.addEventListener("keyup",l,t),s.addEventListener("blur",d,t)});s.addEventListener("keydown",a,t),s.addEventListener("blur",()=>s.removeEventListener("keydown",a),t)};function jq(r){return BV(r)&&!MQ()}function UCe(r,t,s={}){const[a,l,d]=UQ(r,s),p=E=>{const v=E.currentTarget;if(!jq(E)||Xb.has(v))return;Xb.add(v);const b=t(E),R=(F,H)=>{window.removeEventListener("pointerup",O),window.removeEventListener("pointercancel",N),!(!jq(F)||!Xb.has(v))&&(Xb.delete(v),typeof b=="function"&&b(F,{success:H}))},O=F=>{R(F,s.useGlobalTarget||VQ(v,F.target))},N=F=>{R(F,!1)};window.addEventListener("pointerup",O,l),window.addEventListener("pointercancel",N,l)};return a.forEach(E=>{!xCe(E)&&E.getAttribute("tabindex")===null&&(E.tabIndex=0),(s.useGlobalTarget?window:E).addEventListener("pointerdown",p,l),E.addEventListener("focus",b=>MCe(b,l),l)}),d}function VCe(r){return r==="x"||r==="y"?od[r]?null:(od[r]=!0,()=>{od[r]=!1}):od.x||od.y?null:(od.x=od.y=!0,()=>{od.x=od.y=!1})}const FQ=new Set(["width","height","top","left","right","bottom",...HS]);let fP;function FCe(){fP=void 0}const Sh={now:()=>(fP===void 0&&Sh.set(Go.isProcessing||LRe.useManualTiming?Go.timestamp:performance.now()),fP),set:r=>{fP=r,queueMicrotask(FCe)}};function WV(r,t){r.indexOf(t)===-1&&r.push(t)}function GV(r,t){const s=r.indexOf(t);s>-1&&r.splice(s,1)}class zV{constructor(){this.subscriptions=[]}add(t){return WV(this.subscriptions,t),()=>GV(this.subscriptions,t)}notify(t,s,a){const l=this.subscriptions.length;if(l)if(l===1)this.subscriptions[0](t,s,a);else for(let d=0;d<l;d++){const p=this.subscriptions[d];p&&p(t,s,a)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}function jQ(r,t){return t?r*(1e3/t):0}const Bq=30,jCe=r=>!isNaN(parseFloat(r));class BCe{constructor(t,s={}){this.version="11.18.2",this.canTrackVelocity=null,this.events={},this.updateAndNotify=(a,l=!0)=>{const d=Sh.now();this.updatedAt!==d&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(a),this.current!==this.prev&&this.events.change&&this.events.change.notify(this.current),l&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.hasAnimated=!1,this.setCurrent(t),this.owner=s.owner}setCurrent(t){this.current=t,this.updatedAt=Sh.now(),this.canTrackVelocity===null&&t!==void 0&&(this.canTrackVelocity=jCe(this.current))}setPrevFrameValue(t=this.current){this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt}onChange(t){return this.on("change",t)}on(t,s){this.events[t]||(this.events[t]=new zV);const a=this.events[t].add(s);return t==="change"?()=>{a(),xi.read(()=>{this.events.change.getSize()||this.stop()})}:a}clearListeners(){for(const t in this.events)this.events[t].clear()}attach(t,s){this.passiveEffect=t,this.stopPassiveEffect=s}set(t,s=!0){!s||!this.passiveEffect?this.updateAndNotify(t,s):this.passiveEffect(t,this.updateAndNotify)}setWithVelocity(t,s,a){this.set(s),this.prev=void 0,this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt-a}jump(t,s=!0){this.updateAndNotify(t),this.prev=t,this.prevUpdatedAt=this.prevFrameValue=void 0,s&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const t=Sh.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||t-this.updatedAt>Bq)return 0;const s=Math.min(this.updatedAt-this.prevUpdatedAt,Bq);return jQ(parseFloat(this.current)-parseFloat(this.prevFrameValue),s)}start(t){return this.stop(),new Promise(s=>{this.hasAnimated=!0,this.animation=t(s),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function Mw(r,t){return new BCe(r,t)}function WCe(r,t,s){r.hasValue(t)?r.getValue(t).set(s):r.addValue(t,Mw(s))}function GCe(r,t){const s=xN(r,t);let{transitionEnd:a={},transition:l={},...d}=s||{};d={...d,...a};for(const p in d){const E=tCe(d[p]);WCe(r,p,E)}}function zCe(r){return!!(Ta(r)&&r.add)}function F2(r,t){const s=r.getValue("willChange");if(zCe(s))return s.add(t)}function BQ(r){return r.props[_Q]}const WQ=(r,t,s)=>(((1-3*s+3*t)*r+(3*s-6*t))*r+3*t)*r,HCe=1e-7,KCe=12;function qCe(r,t,s,a,l){let d,p,E=0;do p=t+(s-t)/2,d=WQ(p,a,l)-r,d>0?s=p:t=p;while(Math.abs(d)>HCe&&++E<KCe);return p}function hR(r,t,s,a){if(r===t&&s===a)return gl;const l=d=>qCe(d,0,1,r,s);return d=>d===0||d===1?d:WQ(l(d),t,a)}const GQ=r=>t=>t<=.5?r(2*t)/2:(2-r(2*(1-t)))/2,zQ=r=>t=>1-r(1-t),HQ=hR(.33,1.53,.69,.99),HV=zQ(HQ),KQ=GQ(HV),qQ=r=>(r*=2)<1?.5*HV(r):.5*(2-Math.pow(2,-10*(r-1))),KV=r=>1-Math.sin(Math.acos(r)),$Q=zQ(KV),YQ=GQ(KV),XQ=r=>/^0[^.\s]+$/u.test(r);function $Ce(r){return typeof r=="number"?r===0:r!==null?r==="none"||r==="0"||XQ(r):!0}const gw=r=>Math.round(r*1e5)/1e5,qV=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function YCe(r){return r==null}const XCe=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,$V=(r,t)=>s=>!!(typeof s=="string"&&XCe.test(s)&&s.startsWith(r)||t&&!YCe(s)&&Object.prototype.hasOwnProperty.call(s,t)),JQ=(r,t,s)=>a=>{if(typeof a!="string")return a;const[l,d,p,E]=a.match(qV);return{[r]:parseFloat(l),[t]:parseFloat(d),[s]:parseFloat(p),alpha:E!==void 0?parseFloat(E):1}},JCe=r=>np(0,255,r),AM={...KS,transform:r=>Math.round(JCe(r))},x_={test:$V("rgb","red"),parse:JQ("red","green","blue"),transform:({red:r,green:t,blue:s,alpha:a=1})=>"rgba("+AM.transform(r)+", "+AM.transform(t)+", "+AM.transform(s)+", "+gw(xw.transform(a))+")"};function QCe(r){let t="",s="",a="",l="";return r.length>5?(t=r.substring(1,3),s=r.substring(3,5),a=r.substring(5,7),l=r.substring(7,9)):(t=r.substring(1,2),s=r.substring(2,3),a=r.substring(3,4),l=r.substring(4,5),t+=t,s+=s,a+=a,l+=l),{red:parseInt(t,16),green:parseInt(s,16),blue:parseInt(a,16),alpha:l?parseInt(l,16)/255:1}}const j2={test:$V("#"),parse:QCe,transform:x_.transform},Jv={test:$V("hsl","hue"),parse:JQ("hue","saturation","lightness"),transform:({hue:r,saturation:t,lightness:s,alpha:a=1})=>"hsla("+Math.round(r)+", "+vh.transform(gw(t))+", "+vh.transform(gw(s))+", "+gw(xw.transform(a))+")"},ya={test:r=>x_.test(r)||j2.test(r)||Jv.test(r),parse:r=>x_.test(r)?x_.parse(r):Jv.test(r)?Jv.parse(r):j2.parse(r),transform:r=>typeof r=="string"?r:r.hasOwnProperty("red")?x_.transform(r):Jv.transform(r)},ZCe=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function eIe(r){var t,s;return isNaN(r)&&typeof r=="string"&&(((t=r.match(qV))===null||t===void 0?void 0:t.length)||0)+(((s=r.match(ZCe))===null||s===void 0?void 0:s.length)||0)>0}const QQ="number",ZQ="color",tIe="var",nIe="var(",Wq="${}",rIe=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function Uw(r){const t=r.toString(),s=[],a={color:[],number:[],var:[]},l=[];let d=0;const E=t.replace(rIe,v=>(ya.test(v)?(a.color.push(d),l.push(ZQ),s.push(ya.parse(v))):v.startsWith(nIe)?(a.var.push(d),l.push(tIe),s.push(v)):(a.number.push(d),l.push(QQ),s.push(parseFloat(v))),++d,Wq)).split(Wq);return{values:s,split:E,indexes:a,types:l}}function eZ(r){return Uw(r).values}function tZ(r){const{split:t,types:s}=Uw(r),a=t.length;return l=>{let d="";for(let p=0;p<a;p++)if(d+=t[p],l[p]!==void 0){const E=s[p];E===QQ?d+=gw(l[p]):E===ZQ?d+=ya.transform(l[p]):d+=l[p]}return d}}const iIe=r=>typeof r=="number"?0:r;function sIe(r){const t=eZ(r);return tZ(r)(t.map(iIe))}const Fm={test:eIe,parse:eZ,createTransformer:tZ,getAnimatableNone:sIe},oIe=new Set(["brightness","contrast","saturate","opacity"]);function aIe(r){const[t,s]=r.slice(0,-1).split("(");if(t==="drop-shadow")return r;const[a]=s.match(qV)||[];if(!a)return r;const l=s.replace(a,"");let d=oIe.has(t)?1:0;return a!==s&&(d*=100),t+"("+d+l+")"}const cIe=/\b([a-z-]*)\(.*?\)/gu,B2={...Fm,getAnimatableNone:r=>{const t=r.match(cIe);return t?t.map(aIe).join(" "):r}},lIe={...kV,color:ya,backgroundColor:ya,outlineColor:ya,fill:ya,stroke:ya,borderColor:ya,borderTopColor:ya,borderRightColor:ya,borderBottomColor:ya,borderLeftColor:ya,filter:B2,WebkitFilter:B2},YV=r=>lIe[r];function nZ(r,t){let s=YV(r);return s!==B2&&(s=Fm),s.getAnimatableNone?s.getAnimatableNone(t):void 0}const uIe=new Set(["auto","none","0"]);function dIe(r,t,s){let a=0,l;for(;a<r.length&&!l;){const d=r[a];typeof d=="string"&&!uIe.has(d)&&Uw(d).values.length&&(l=r[a]),a++}if(l&&s)for(const d of t)r[d]=nZ(s,l)}const Gq=r=>r===KS||r===Pn,zq=(r,t)=>parseFloat(r.split(", ")[t]),Hq=(r,t)=>(s,{transform:a})=>{if(a==="none"||!a)return 0;const l=a.match(/^matrix3d\((.+)\)$/u);if(l)return zq(l[1],t);{const d=a.match(/^matrix\((.+)\)$/u);return d?zq(d[1],r):0}},hIe=new Set(["x","y","z"]),fIe=HS.filter(r=>!hIe.has(r));function pIe(r){const t=[];return fIe.forEach(s=>{const a=r.getValue(s);a!==void 0&&(t.push([s,a.get()]),a.set(s.startsWith("scale")?1:0))}),t}const RS={width:({x:r},{paddingLeft:t="0",paddingRight:s="0"})=>r.max-r.min-parseFloat(t)-parseFloat(s),height:({y:r},{paddingTop:t="0",paddingBottom:s="0"})=>r.max-r.min-parseFloat(t)-parseFloat(s),top:(r,{top:t})=>parseFloat(t),left:(r,{left:t})=>parseFloat(t),bottom:({y:r},{top:t})=>parseFloat(t)+(r.max-r.min),right:({x:r},{left:t})=>parseFloat(t)+(r.max-r.min),x:Hq(4,13),y:Hq(5,14)};RS.translateX=RS.x;RS.translateY=RS.y;const B_=new Set;let W2=!1,G2=!1;function rZ(){if(G2){const r=Array.from(B_).filter(a=>a.needsMeasurement),t=new Set(r.map(a=>a.element)),s=new Map;t.forEach(a=>{const l=pIe(a);l.length&&(s.set(a,l),a.render())}),r.forEach(a=>a.measureInitialState()),t.forEach(a=>{a.render();const l=s.get(a);l&&l.forEach(([d,p])=>{var E;(E=a.getValue(d))===null||E===void 0||E.set(p)})}),r.forEach(a=>a.measureEndState()),r.forEach(a=>{a.suspendedScrollY!==void 0&&window.scrollTo(0,a.suspendedScrollY)})}G2=!1,W2=!1,B_.forEach(r=>r.complete()),B_.clear()}function iZ(){B_.forEach(r=>{r.readKeyframes(),r.needsMeasurement&&(G2=!0)})}function mIe(){iZ(),rZ()}class XV{constructor(t,s,a,l,d,p=!1){this.isComplete=!1,this.isAsync=!1,this.needsMeasurement=!1,this.isScheduled=!1,this.unresolvedKeyframes=[...t],this.onComplete=s,this.name=a,this.motionValue=l,this.element=d,this.isAsync=p}scheduleResolve(){this.isScheduled=!0,this.isAsync?(B_.add(this),W2||(W2=!0,xi.read(iZ),xi.resolveKeyframes(rZ))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:t,name:s,element:a,motionValue:l}=this;for(let d=0;d<t.length;d++)if(t[d]===null)if(d===0){const p=l==null?void 0:l.get(),E=t[t.length-1];if(p!==void 0)t[0]=p;else if(a&&s){const v=a.readValue(s,E);v!=null&&(t[0]=v)}t[0]===void 0&&(t[0]=E),l&&p===void 0&&l.set(t[0])}else t[d]=t[d-1]}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(){this.isComplete=!0,this.onComplete(this.unresolvedKeyframes,this.finalKeyframe),B_.delete(this)}cancel(){this.isComplete||(this.isScheduled=!1,B_.delete(this))}resume(){this.isComplete||this.scheduleResolve()}}const sZ=r=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(r),gIe=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function _Ie(r){const t=gIe.exec(r);if(!t)return[,];const[,s,a,l]=t;return[`--${s??a}`,l]}function oZ(r,t,s=1){const[a,l]=_Ie(r);if(!a)return;const d=window.getComputedStyle(t).getPropertyValue(a);if(d){const p=d.trim();return sZ(p)?parseFloat(p):p}return NV(l)?oZ(l,t,s+1):l}const aZ=r=>t=>t.test(r),EIe={test:r=>r==="auto",parse:r=>r},cZ=[KS,Pn,vh,Tm,aCe,oCe,EIe],Kq=r=>cZ.find(aZ(r));class lZ extends XV{constructor(t,s,a,l,d){super(t,s,a,l,d,!0)}readKeyframes(){const{unresolvedKeyframes:t,element:s,name:a}=this;if(!s||!s.current)return;super.readKeyframes();for(let v=0;v<t.length;v++){let b=t[v];if(typeof b=="string"&&(b=b.trim(),NV(b))){const R=oZ(b,s.current);R!==void 0&&(t[v]=R),v===t.length-1&&(this.finalKeyframe=b)}}if(this.resolveNoneKeyframes(),!FQ.has(a)||t.length!==2)return;const[l,d]=t,p=Kq(l),E=Kq(d);if(p!==E)if(Gq(p)&&Gq(E))for(let v=0;v<t.length;v++){const b=t[v];typeof b=="string"&&(t[v]=parseFloat(b))}else this.needsMeasurement=!0}resolveNoneKeyframes(){const{unresolvedKeyframes:t,name:s}=this,a=[];for(let l=0;l<t.length;l++)$Ce(t[l])&&a.push(l);a.length&&dIe(t,a,s)}measureInitialState(){const{element:t,unresolvedKeyframes:s,name:a}=this;if(!t||!t.current)return;a==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=RS[a](t.measureViewportBox(),window.getComputedStyle(t.current)),s[0]=this.measuredOrigin;const l=s[s.length-1];l!==void 0&&t.getValue(a,l).jump(l,!1)}measureEndState(){var t;const{element:s,name:a,unresolvedKeyframes:l}=this;if(!s||!s.current)return;const d=s.getValue(a);d&&d.jump(this.measuredOrigin,!1);const p=l.length-1,E=l[p];l[p]=RS[a](s.measureViewportBox(),window.getComputedStyle(s.current)),E!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=E),!((t=this.removedTransforms)===null||t===void 0)&&t.length&&this.removedTransforms.forEach(([v,b])=>{s.getValue(v).set(b)}),this.resolveNoneKeyframes()}}const qq=(r,t)=>t==="zIndex"?!1:!!(typeof r=="number"||Array.isArray(r)||typeof r=="string"&&(Fm.test(r)||r==="0")&&!r.startsWith("url("));function yIe(r){const t=r[0];if(r.length===1)return!0;for(let s=0;s<r.length;s++)if(r[s]!==t)return!0}function vIe(r,t,s,a){const l=r[0];if(l===null)return!1;if(t==="display"||t==="visibility")return!0;const d=r[r.length-1],p=qq(l,t),E=qq(d,t);return!p||!E?!1:yIe(r)||(s==="spring"||FV(s))&&a}const SIe=r=>r!==null;function MN(r,{repeat:t,repeatType:s="loop"},a){const l=r.filter(SIe),d=t&&s!=="loop"&&t%2===1?0:l.length-1;return!d||a===void 0?l[d]:a}const TIe=40;class uZ{constructor({autoplay:t=!0,delay:s=0,type:a="keyframes",repeat:l=0,repeatDelay:d=0,repeatType:p="loop",...E}){this.isStopped=!1,this.hasAttemptedResolve=!1,this.createdAt=Sh.now(),this.options={autoplay:t,delay:s,type:a,repeat:l,repeatDelay:d,repeatType:p,...E},this.updateFinishedPromise()}calcStartTime(){return this.resolvedAt?this.resolvedAt-this.createdAt>TIe?this.resolvedAt:this.createdAt:this.createdAt}get resolved(){return!this._resolved&&!this.hasAttemptedResolve&&mIe(),this._resolved}onKeyframesResolved(t,s){this.resolvedAt=Sh.now(),this.hasAttemptedResolve=!0;const{name:a,type:l,velocity:d,delay:p,onComplete:E,onUpdate:v,isGenerator:b}=this.options;if(!b&&!vIe(t,a,l,d))if(p)this.options.duration=0;else{v&&v(MN(t,this.options,s)),E&&E(),this.resolveFinishedPromise();return}const R=this.initPlayback(t,s);R!==!1&&(this._resolved={keyframes:t,finalKeyframe:s,...R},this.onPostResolved())}onPostResolved(){}then(t,s){return this.currentFinishedPromise.then(t,s)}flatten(){this.options.type="keyframes",this.options.ease="linear"}updateFinishedPromise(){this.currentFinishedPromise=new Promise(t=>{this.resolveFinishedPromise=t})}}const Ji=(r,t,s)=>r+(t-r)*s;function OM(r,t,s){return s<0&&(s+=1),s>1&&(s-=1),s<1/6?r+(t-r)*6*s:s<1/2?t:s<2/3?r+(t-r)*(2/3-s)*6:r}function bIe({hue:r,saturation:t,lightness:s,alpha:a}){r/=360,t/=100,s/=100;let l=0,d=0,p=0;if(!t)l=d=p=s;else{const E=s<.5?s*(1+t):s+t-s*t,v=2*s-E;l=OM(v,E,r+1/3),d=OM(v,E,r),p=OM(v,E,r-1/3)}return{red:Math.round(l*255),green:Math.round(d*255),blue:Math.round(p*255),alpha:a}}function WP(r,t){return s=>s>0?t:r}const PM=(r,t,s)=>{const a=r*r,l=s*(t*t-a)+a;return l<0?0:Math.sqrt(l)},wIe=[j2,x_,Jv],RIe=r=>wIe.find(t=>t.test(r));function $q(r){const t=RIe(r);if(!t)return!1;let s=t.parse(r);return t===Jv&&(s=bIe(s)),s}const Yq=(r,t)=>{const s=$q(r),a=$q(t);if(!s||!a)return WP(r,t);const l={...s};return d=>(l.red=PM(s.red,a.red,d),l.green=PM(s.green,a.green,d),l.blue=PM(s.blue,a.blue,d),l.alpha=Ji(s.alpha,a.alpha,d),x_.transform(l))},CIe=(r,t)=>s=>t(r(s)),fR=(...r)=>r.reduce(CIe),z2=new Set(["none","hidden"]);function IIe(r,t){return z2.has(r)?s=>s<=0?r:t:s=>s>=1?t:r}function AIe(r,t){return s=>Ji(r,t,s)}function JV(r){return typeof r=="number"?AIe:typeof r=="string"?NV(r)?WP:ya.test(r)?Yq:NIe:Array.isArray(r)?dZ:typeof r=="object"?ya.test(r)?Yq:OIe:WP}function dZ(r,t){const s=[...r],a=s.length,l=r.map((d,p)=>JV(d)(d,t[p]));return d=>{for(let p=0;p<a;p++)s[p]=l[p](d);return s}}function OIe(r,t){const s={...r,...t},a={};for(const l in s)r[l]!==void 0&&t[l]!==void 0&&(a[l]=JV(r[l])(r[l],t[l]));return l=>{for(const d in a)s[d]=a[d](l);return s}}function PIe(r,t){var s;const a=[],l={color:0,var:0,number:0};for(let d=0;d<t.values.length;d++){const p=t.types[d],E=r.indexes[p][l[p]],v=(s=r.values[E])!==null&&s!==void 0?s:0;a[d]=v,l[p]++}return a}const NIe=(r,t)=>{const s=Fm.createTransformer(t),a=Uw(r),l=Uw(t);return a.indexes.var.length===l.indexes.var.length&&a.indexes.color.length===l.indexes.color.length&&a.indexes.number.length>=l.indexes.number.length?z2.has(r)&&!l.values.length||z2.has(t)&&!a.values.length?IIe(r,t):fR(dZ(PIe(a,l),l.values),s):WP(r,t)};function hZ(r,t,s){return typeof r=="number"&&typeof t=="number"&&typeof s=="number"?Ji(r,t,s):JV(r)(r,t)}const kIe=5;function fZ(r,t,s){const a=Math.max(t-kIe,0);return jQ(s-r(a),t-a)}const ms={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},Xq=.001;function DIe({duration:r=ms.duration,bounce:t=ms.bounce,velocity:s=ms.velocity,mass:a=ms.mass}){let l,d,p=1-t;p=np(ms.minDamping,ms.maxDamping,p),r=np(ms.minDuration,ms.maxDuration,Qf(r)),p<1?(l=b=>{const R=b*p,O=R*r,N=R-s,F=H2(b,p),H=Math.exp(-O);return Xq-N/F*H},d=b=>{const O=b*p*r,N=O*s+s,F=Math.pow(p,2)*Math.pow(b,2)*r,H=Math.exp(-O),z=H2(Math.pow(b,2),p);return(-l(b)+Xq>0?-1:1)*((N-F)*H)/z}):(l=b=>{const R=Math.exp(-b*r),O=(b-s)*r+1;return-.001+R*O},d=b=>{const R=Math.exp(-b*r),O=(s-b)*(r*r);return R*O});const E=5/r,v=xIe(l,d,E);if(r=Jf(r),isNaN(v))return{stiffness:ms.stiffness,damping:ms.damping,duration:r};{const b=Math.pow(v,2)*a;return{stiffness:b,damping:p*2*Math.sqrt(a*b),duration:r}}}const LIe=12;function xIe(r,t,s){let a=s;for(let l=1;l<LIe;l++)a=a-r(a)/t(a);return a}function H2(r,t){return r*Math.sqrt(1-t*t)}const MIe=["duration","bounce"],UIe=["stiffness","damping","mass"];function Jq(r,t){return t.some(s=>r[s]!==void 0)}function VIe(r){let t={velocity:ms.velocity,stiffness:ms.stiffness,damping:ms.damping,mass:ms.mass,isResolvedFromDuration:!1,...r};if(!Jq(r,UIe)&&Jq(r,MIe))if(r.visualDuration){const s=r.visualDuration,a=2*Math.PI/(s*1.2),l=a*a,d=2*np(.05,1,1-(r.bounce||0))*Math.sqrt(l);t={...t,mass:ms.mass,stiffness:l,damping:d}}else{const s=DIe(r);t={...t,...s,mass:ms.mass},t.isResolvedFromDuration=!0}return t}function pZ(r=ms.visualDuration,t=ms.bounce){const s=typeof r!="object"?{visualDuration:r,keyframes:[0,1],bounce:t}:r;let{restSpeed:a,restDelta:l}=s;const d=s.keyframes[0],p=s.keyframes[s.keyframes.length-1],E={done:!1,value:d},{stiffness:v,damping:b,mass:R,duration:O,velocity:N,isResolvedFromDuration:F}=VIe({...s,velocity:-Qf(s.velocity||0)}),H=N||0,z=b/(2*Math.sqrt(v*R)),G=p-d,ee=Qf(Math.sqrt(v/R)),J=Math.abs(G)<5;a||(a=J?ms.restSpeed.granular:ms.restSpeed.default),l||(l=J?ms.restDelta.granular:ms.restDelta.default);let re;if(z<1){const se=H2(ee,z);re=ye=>{const Q=Math.exp(-z*ee*ye);return p-Q*((H+z*ee*G)/se*Math.sin(se*ye)+G*Math.cos(se*ye))}}else if(z===1)re=se=>p-Math.exp(-ee*se)*(G+(H+ee*G)*se);else{const se=ee*Math.sqrt(z*z-1);re=ye=>{const Q=Math.exp(-z*ee*ye),ne=Math.min(se*ye,300);return p-Q*((H+z*ee*G)*Math.sinh(ne)+se*G*Math.cosh(ne))/se}}const de={calculatedDuration:F&&O||null,next:se=>{const ye=re(se);if(F)E.done=se>=O;else{let Q=0;z<1&&(Q=se===0?Jf(H):fZ(re,se,ye));const ne=Math.abs(Q)<=a,oe=Math.abs(p-ye)<=l;E.done=ne&&oe}return E.value=E.done?p:ye,E},toString:()=>{const se=Math.min(kQ(de),U2),ye=DQ(Q=>de.next(se*Q).value,se,30);return se+"ms "+ye}};return de}function Qq({keyframes:r,velocity:t=0,power:s=.8,timeConstant:a=325,bounceDamping:l=10,bounceStiffness:d=500,modifyTarget:p,min:E,max:v,restDelta:b=.5,restSpeed:R}){const O=r[0],N={done:!1,value:O},F=ne=>E!==void 0&&ne<E||v!==void 0&&ne>v,H=ne=>E===void 0?v:v===void 0||Math.abs(E-ne)<Math.abs(v-ne)?E:v;let z=s*t;const G=O+z,ee=p===void 0?G:p(G);ee!==G&&(z=ee-O);const J=ne=>-z*Math.exp(-ne/a),re=ne=>ee+J(ne),de=ne=>{const oe=J(ne),ue=re(ne);N.done=Math.abs(oe)<=b,N.value=N.done?ee:ue};let se,ye;const Q=ne=>{F(N.value)&&(se=ne,ye=pZ({keyframes:[N.value,H(N.value)],velocity:fZ(re,ne,N.value),damping:l,stiffness:d,restDelta:b,restSpeed:R}))};return Q(0),{calculatedDuration:null,next:ne=>{let oe=!1;return!ye&&se===void 0&&(oe=!0,de(ne),Q(ne)),se!==void 0&&ne>=se?ye.next(ne-se):(!oe&&de(ne),N)}}}const FIe=hR(.42,0,1,1),jIe=hR(0,0,.58,1),mZ=hR(.42,0,.58,1),BIe=r=>Array.isArray(r)&&typeof r[0]!="number",WIe={linear:gl,easeIn:FIe,easeInOut:mZ,easeOut:jIe,circIn:KV,circInOut:YQ,circOut:$Q,backIn:HV,backInOut:KQ,backOut:HQ,anticipate:qQ},Zq=r=>{if(jV(r)){hQ(r.length===4);const[t,s,a,l]=r;return hR(t,s,a,l)}else if(typeof r=="string")return WIe[r];return r};function GIe(r,t,s){const a=[],l=s||hZ,d=r.length-1;for(let p=0;p<d;p++){let E=l(r[p],r[p+1]);if(t){const v=Array.isArray(t)?t[p]||gl:t;E=fR(v,E)}a.push(E)}return a}function zIe(r,t,{clamp:s=!0,ease:a,mixer:l}={}){const d=r.length;if(hQ(d===t.length),d===1)return()=>t[0];if(d===2&&t[0]===t[1])return()=>t[1];const p=r[0]===r[1];r[0]>r[d-1]&&(r=[...r].reverse(),t=[...t].reverse());const E=GIe(t,a,l),v=E.length,b=R=>{if(p&&R<r[0])return t[0];let O=0;if(v>1)for(;O<r.length-2&&!(R<r[O+1]);O++);const N=bS(r[O],r[O+1],R);return E[O](N)};return s?R=>b(np(r[0],r[d-1],R)):b}function HIe(r,t){const s=r[r.length-1];for(let a=1;a<=t;a++){const l=bS(0,t,a);r.push(Ji(s,1,l))}}function KIe(r){const t=[0];return HIe(t,r.length-1),t}function qIe(r,t){return r.map(s=>s*t)}function $Ie(r,t){return r.map(()=>t||mZ).splice(0,r.length-1)}function GP({duration:r=300,keyframes:t,times:s,ease:a="easeInOut"}){const l=BIe(a)?a.map(Zq):Zq(a),d={done:!1,value:t[0]},p=qIe(s&&s.length===t.length?s:KIe(t),r),E=zIe(p,t,{ease:Array.isArray(l)?l:$Ie(t,l)});return{calculatedDuration:r,next:v=>(d.value=E(v),d.done=v>=r,d)}}const YIe=r=>{const t=({timestamp:s})=>r(s);return{start:()=>xi.update(t,!0),stop:()=>Vm(t),now:()=>Go.isProcessing?Go.timestamp:Sh.now()}},XIe={decay:Qq,inertia:Qq,tween:GP,keyframes:GP,spring:pZ},JIe=r=>r/100;class QV extends uZ{constructor(t){super(t),this.holdTime=null,this.cancelTime=null,this.currentTime=0,this.playbackSpeed=1,this.pendingPlayState="running",this.startTime=null,this.state="idle",this.stop=()=>{if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.teardown();const{onStop:v}=this.options;v&&v()};const{name:s,motionValue:a,element:l,keyframes:d}=this.options,p=(l==null?void 0:l.KeyframeResolver)||XV,E=(v,b)=>this.onKeyframesResolved(v,b);this.resolver=new p(d,E,s,a,l),this.resolver.scheduleResolve()}flatten(){super.flatten(),this._resolved&&Object.assign(this._resolved,this.initPlayback(this._resolved.keyframes))}initPlayback(t){const{type:s="keyframes",repeat:a=0,repeatDelay:l=0,repeatType:d,velocity:p=0}=this.options,E=FV(s)?s:XIe[s]||GP;let v,b;E!==GP&&typeof t[0]!="number"&&(v=fR(JIe,hZ(t[0],t[1])),t=[0,100]);const R=E({...this.options,keyframes:t});d==="mirror"&&(b=E({...this.options,keyframes:[...t].reverse(),velocity:-p})),R.calculatedDuration===null&&(R.calculatedDuration=kQ(R));const{calculatedDuration:O}=R,N=O+l,F=N*(a+1)-l;return{generator:R,mirroredGenerator:b,mapPercentToKeyframes:v,calculatedDuration:O,resolvedDuration:N,totalDuration:F}}onPostResolved(){const{autoplay:t=!0}=this.options;this.play(),this.pendingPlayState==="paused"||!t?this.pause():this.state=this.pendingPlayState}tick(t,s=!1){const{resolved:a}=this;if(!a){const{keyframes:ne}=this.options;return{done:!0,value:ne[ne.length-1]}}const{finalKeyframe:l,generator:d,mirroredGenerator:p,mapPercentToKeyframes:E,keyframes:v,calculatedDuration:b,totalDuration:R,resolvedDuration:O}=a;if(this.startTime===null)return d.next(0);const{delay:N,repeat:F,repeatType:H,repeatDelay:z,onUpdate:G}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,t):this.speed<0&&(this.startTime=Math.min(t-R/this.speed,this.startTime)),s?this.currentTime=t:this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=Math.round(t-this.startTime)*this.speed;const ee=this.currentTime-N*(this.speed>=0?1:-1),J=this.speed>=0?ee<0:ee>R;this.currentTime=Math.max(ee,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=R);let re=this.currentTime,de=d;if(F){const ne=Math.min(this.currentTime,R)/O;let oe=Math.floor(ne),ue=ne%1;!ue&&ne>=1&&(ue=1),ue===1&&oe--,oe=Math.min(oe,F+1),!!(oe%2)&&(H==="reverse"?(ue=1-ue,z&&(ue-=z/O)):H==="mirror"&&(de=p)),re=np(0,1,ue)*O}const se=J?{done:!1,value:v[0]}:de.next(re);E&&(se.value=E(se.value));let{done:ye}=se;!J&&b!==null&&(ye=this.speed>=0?this.currentTime>=R:this.currentTime<=0);const Q=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&ye);return Q&&l!==void 0&&(se.value=MN(v,this.options,l)),G&&G(se.value),Q&&this.finish(),se}get duration(){const{resolved:t}=this;return t?Qf(t.calculatedDuration):0}get time(){return Qf(this.currentTime)}set time(t){t=Jf(t),this.currentTime=t,this.holdTime!==null||this.speed===0?this.holdTime=t:this.driver&&(this.startTime=this.driver.now()-t/this.speed)}get speed(){return this.playbackSpeed}set speed(t){const s=this.playbackSpeed!==t;this.playbackSpeed=t,s&&(this.time=Qf(this.currentTime))}play(){if(this.resolver.isScheduled||this.resolver.resume(),!this._resolved){this.pendingPlayState="running";return}if(this.isStopped)return;const{driver:t=YIe,onPlay:s,startTime:a}=this.options;this.driver||(this.driver=t(d=>this.tick(d))),s&&s();const l=this.driver.now();this.holdTime!==null?this.startTime=l-this.holdTime:this.startTime?this.state==="finished"&&(this.startTime=l):this.startTime=a??this.calcStartTime(),this.state==="finished"&&this.updateFinishedPromise(),this.cancelTime=this.startTime,this.holdTime=null,this.state="running",this.driver.start()}pause(){var t;if(!this._resolved){this.pendingPlayState="paused";return}this.state="paused",this.holdTime=(t=this.currentTime)!==null&&t!==void 0?t:0}complete(){this.state!=="running"&&this.play(),this.pendingPlayState=this.state="finished",this.holdTime=null}finish(){this.teardown(),this.state="finished";const{onComplete:t}=this.options;t&&t()}cancel(){this.cancelTime!==null&&this.tick(this.cancelTime),this.teardown(),this.updateFinishedPromise()}teardown(){this.state="idle",this.stopDriver(),this.resolveFinishedPromise(),this.updateFinishedPromise(),this.startTime=this.cancelTime=null,this.resolver.cancel()}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(t){return this.startTime=0,this.tick(t,!0)}}const QIe=new Set(["opacity","clipPath","filter","transform"]);function ZIe(r,t,s,{delay:a=0,duration:l=300,repeat:d=0,repeatType:p="loop",ease:E="easeInOut",times:v}={}){const b={[t]:s};v&&(b.offset=v);const R=xQ(E,l);return Array.isArray(R)&&(b.easing=R),r.animate(b,{delay:a,duration:l,easing:Array.isArray(R)?"linear":R,fill:"both",iterations:d+1,direction:p==="reverse"?"alternate":"normal"})}const eAe=wV(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),zP=10,tAe=2e4;function nAe(r){return FV(r.type)||r.type==="spring"||!LQ(r.ease)}function rAe(r,t){const s=new QV({...t,keyframes:r,repeat:0,delay:0,isGenerator:!0});let a={done:!1,value:r[0]};const l=[];let d=0;for(;!a.done&&d<tAe;)a=s.sample(d),l.push(a.value),d+=zP;return{times:void 0,keyframes:l,duration:d-zP,ease:"linear"}}const gZ={anticipate:qQ,backInOut:KQ,circInOut:YQ};function iAe(r){return r in gZ}class e$ extends uZ{constructor(t){super(t);const{name:s,motionValue:a,element:l,keyframes:d}=this.options;this.resolver=new lZ(d,(p,E)=>this.onKeyframesResolved(p,E),s,a,l),this.resolver.scheduleResolve()}initPlayback(t,s){let{duration:a=300,times:l,ease:d,type:p,motionValue:E,name:v,startTime:b}=this.options;if(!E.owner||!E.owner.current)return!1;if(typeof d=="string"&&BP()&&iAe(d)&&(d=gZ[d]),nAe(this.options)){const{onComplete:O,onUpdate:N,motionValue:F,element:H,...z}=this.options,G=rAe(t,z);t=G.keyframes,t.length===1&&(t[1]=t[0]),a=G.duration,l=G.times,d=G.ease,p="keyframes"}const R=ZIe(E.owner.current,v,t,{...this.options,duration:a,times:l,ease:d});return R.startTime=b??this.calcStartTime(),this.pendingTimeline?(Uq(R,this.pendingTimeline),this.pendingTimeline=void 0):R.onfinish=()=>{const{onComplete:O}=this.options;E.set(MN(t,this.options,s)),O&&O(),this.cancel(),this.resolveFinishedPromise()},{animation:R,duration:a,times:l,type:p,ease:d,keyframes:t}}get duration(){const{resolved:t}=this;if(!t)return 0;const{duration:s}=t;return Qf(s)}get time(){const{resolved:t}=this;if(!t)return 0;const{animation:s}=t;return Qf(s.currentTime||0)}set time(t){const{resolved:s}=this;if(!s)return;const{animation:a}=s;a.currentTime=Jf(t)}get speed(){const{resolved:t}=this;if(!t)return 1;const{animation:s}=t;return s.playbackRate}set speed(t){const{resolved:s}=this;if(!s)return;const{animation:a}=s;a.playbackRate=t}get state(){const{resolved:t}=this;if(!t)return"idle";const{animation:s}=t;return s.playState}get startTime(){const{resolved:t}=this;if(!t)return null;const{animation:s}=t;return s.startTime}attachTimeline(t){if(!this._resolved)this.pendingTimeline=t;else{const{resolved:s}=this;if(!s)return gl;const{animation:a}=s;Uq(a,t)}return gl}play(){if(this.isStopped)return;const{resolved:t}=this;if(!t)return;const{animation:s}=t;s.playState==="finished"&&this.updateFinishedPromise(),s.play()}pause(){const{resolved:t}=this;if(!t)return;const{animation:s}=t;s.pause()}stop(){if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.resolveFinishedPromise(),this.updateFinishedPromise();const{resolved:t}=this;if(!t)return;const{animation:s,keyframes:a,duration:l,type:d,ease:p,times:E}=t;if(s.playState==="idle"||s.playState==="finished")return;if(this.time){const{motionValue:b,onUpdate:R,onComplete:O,element:N,...F}=this.options,H=new QV({...F,keyframes:a,duration:l,type:d,ease:p,times:E,isGenerator:!0}),z=Jf(this.time);b.setWithVelocity(H.sample(z-zP).value,H.sample(z).value,zP)}const{onStop:v}=this.options;v&&v(),this.cancel()}complete(){const{resolved:t}=this;t&&t.animation.finish()}cancel(){const{resolved:t}=this;t&&t.animation.cancel()}static supports(t){const{motionValue:s,name:a,repeatDelay:l,repeatType:d,damping:p,type:E}=t;if(!s||!s.owner||!(s.owner.current instanceof HTMLElement))return!1;const{onUpdate:v,transformTemplate:b}=s.owner.getProps();return eAe()&&a&&QIe.has(a)&&!v&&!b&&!l&&d!=="mirror"&&p!==0&&E!=="inertia"}}const sAe={type:"spring",stiffness:500,damping:25,restSpeed:10},oAe=r=>({type:"spring",stiffness:550,damping:r===0?2*Math.sqrt(550):30,restSpeed:10}),aAe={type:"keyframes",duration:.8},cAe={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},lAe=(r,{keyframes:t})=>t.length>2?aAe:cE.has(r)?r.startsWith("scale")?oAe(t[1]):sAe:cAe;function uAe({when:r,delay:t,delayChildren:s,staggerChildren:a,staggerDirection:l,repeat:d,repeatType:p,repeatDelay:E,from:v,elapsed:b,...R}){return!!Object.keys(R).length}const ZV=(r,t,s,a={},l,d)=>p=>{const E=VV(a,r)||{},v=E.delay||a.delay||0;let{elapsed:b=0}=a;b=b-Jf(v);let R={keyframes:Array.isArray(s)?s:[null,s],ease:"easeOut",velocity:t.getVelocity(),...E,delay:-b,onUpdate:N=>{t.set(N),E.onUpdate&&E.onUpdate(N)},onComplete:()=>{p(),E.onComplete&&E.onComplete()},name:r,motionValue:t,element:d?void 0:l};uAe(E)||(R={...R,...lAe(r,R)}),R.duration&&(R.duration=Jf(R.duration)),R.repeatDelay&&(R.repeatDelay=Jf(R.repeatDelay)),R.from!==void 0&&(R.keyframes[0]=R.from);let O=!1;if((R.type===!1||R.duration===0&&!R.repeatDelay)&&(R.duration=0,R.delay===0&&(O=!0)),O&&!d&&t.get()!==void 0){const N=MN(R.keyframes,E);if(N!==void 0)return xi.update(()=>{R.onUpdate(N),R.onComplete()}),new OCe([])}return!d&&e$.supports(R)?new e$(R):new QV(R)};function dAe({protectedKeys:r,needsAnimating:t},s){const a=r.hasOwnProperty(s)&&t[s]!==!0;return t[s]=!1,a}function _Z(r,t,{delay:s=0,transitionOverride:a,type:l}={}){var d;let{transition:p=r.getDefaultTransition(),transitionEnd:E,...v}=t;a&&(p=a);const b=[],R=l&&r.animationState&&r.animationState.getState()[l];for(const O in v){const N=r.getValue(O,(d=r.latestValues[O])!==null&&d!==void 0?d:null),F=v[O];if(F===void 0||R&&dAe(R,O))continue;const H={delay:s,...VV(p||{},O)};let z=!1;if(window.MotionHandoffAnimation){const ee=BQ(r);if(ee){const J=window.MotionHandoffAnimation(ee,O,xi);J!==null&&(H.startTime=J,z=!0)}}F2(r,O),N.start(ZV(O,N,F,r.shouldReduceMotion&&FQ.has(O)?{type:!1}:H,r,z));const G=N.animation;G&&b.push(G)}return E&&Promise.all(b).then(()=>{xi.update(()=>{E&&GCe(r,E)})}),b}function K2(r,t,s={}){var a;const l=xN(r,t,s.type==="exit"?(a=r.presenceContext)===null||a===void 0?void 0:a.custom:void 0);let{transition:d=r.getDefaultTransition()||{}}=l||{};s.transitionOverride&&(d=s.transitionOverride);const p=l?()=>Promise.all(_Z(r,l,s)):()=>Promise.resolve(),E=r.variantChildren&&r.variantChildren.size?(b=0)=>{const{delayChildren:R=0,staggerChildren:O,staggerDirection:N}=d;return hAe(r,t,R+b,O,N,s)}:()=>Promise.resolve(),{when:v}=d;if(v){const[b,R]=v==="beforeChildren"?[p,E]:[E,p];return b().then(()=>R())}else return Promise.all([p(),E(s.delay)])}function hAe(r,t,s=0,a=0,l=1,d){const p=[],E=(r.variantChildren.size-1)*a,v=l===1?(b=0)=>b*a:(b=0)=>E-b*a;return Array.from(r.variantChildren).sort(fAe).forEach((b,R)=>{b.notify("AnimationStart",t),p.push(K2(b,t,{...d,delay:s+v(R)}).then(()=>b.notify("AnimationComplete",t)))}),Promise.all(p)}function fAe(r,t){return r.sortNodePosition(t)}function pAe(r,t,s={}){r.notify("AnimationStart",t);let a;if(Array.isArray(t)){const l=t.map(d=>K2(r,d,s));a=Promise.all(l)}else if(typeof t=="string")a=K2(r,t,s);else{const l=typeof t=="function"?xN(r,t,s.custom):t;a=Promise.all(_Z(r,l,s))}return a.then(()=>{r.notify("AnimationComplete",t)})}const mAe=CV.length;function EZ(r){if(!r)return;if(!r.isControllingVariants){const s=r.parent?EZ(r.parent)||{}:{};return r.props.initial!==void 0&&(s.initial=r.props.initial),s}const t={};for(let s=0;s<mAe;s++){const a=CV[s],l=r.props[a];(Lw(l)||l===!1)&&(t[a]=l)}return t}const gAe=[...RV].reverse(),_Ae=RV.length;function EAe(r){return t=>Promise.all(t.map(({animation:s,options:a})=>pAe(r,s,a)))}function yAe(r){let t=EAe(r),s=t$(),a=!0;const l=v=>(b,R)=>{var O;const N=xN(r,R,v==="exit"?(O=r.presenceContext)===null||O===void 0?void 0:O.custom:void 0);if(N){const{transition:F,transitionEnd:H,...z}=N;b={...b,...z,...H}}return b};function d(v){t=v(r)}function p(v){const{props:b}=r,R=EZ(r.parent)||{},O=[],N=new Set;let F={},H=1/0;for(let G=0;G<_Ae;G++){const ee=gAe[G],J=s[ee],re=b[ee]!==void 0?b[ee]:R[ee],de=Lw(re),se=ee===v?J.isActive:null;se===!1&&(H=G);let ye=re===R[ee]&&re!==b[ee]&&de;if(ye&&a&&r.manuallyAnimateOnMount&&(ye=!1),J.protectedKeys={...F},!J.isActive&&se===null||!re&&!J.prevProp||DN(re)||typeof re=="boolean")continue;const Q=vAe(J.prevProp,re);let ne=Q||ee===v&&J.isActive&&!ye&&de||G>H&&de,oe=!1;const ue=Array.isArray(re)?re:[re];let Ee=ue.reduce(l(ee),{});se===!1&&(Ee={});const{prevResolvedValues:fe={}}=J,le={...fe,...Ee},Le=Oe=>{ne=!0,N.has(Oe)&&(oe=!0,N.delete(Oe)),J.needsAnimating[Oe]=!0;const Ue=r.getValue(Oe);Ue&&(Ue.liveStyle=!1)};for(const Oe in le){const Ue=Ee[Oe],Me=fe[Oe];if(F.hasOwnProperty(Oe))continue;let it=!1;M2(Ue)&&M2(Me)?it=!NQ(Ue,Me):it=Ue!==Me,it?Ue!=null?Le(Oe):N.add(Oe):Ue!==void 0&&N.has(Oe)?Le(Oe):J.protectedKeys[Oe]=!0}J.prevProp=re,J.prevResolvedValues=Ee,J.isActive&&(F={...F,...Ee}),a&&r.blockInitialAnimation&&(ne=!1),ne&&(!(ye&&Q)||oe)&&O.push(...ue.map(Oe=>({animation:Oe,options:{type:ee}})))}if(N.size){const G={};N.forEach(ee=>{const J=r.getBaseTarget(ee),re=r.getValue(ee);re&&(re.liveStyle=!0),G[ee]=J??null}),O.push({animation:G})}let z=!!O.length;return a&&(b.initial===!1||b.initial===b.animate)&&!r.manuallyAnimateOnMount&&(z=!1),a=!1,z?t(O):Promise.resolve()}function E(v,b){var R;if(s[v].isActive===b)return Promise.resolve();(R=r.variantChildren)===null||R===void 0||R.forEach(N=>{var F;return(F=N.animationState)===null||F===void 0?void 0:F.setActive(v,b)}),s[v].isActive=b;const O=p(v);for(const N in s)s[N].protectedKeys={};return O}return{animateChanges:p,setActive:E,setAnimateFunction:d,getState:()=>s,reset:()=>{s=t$(),a=!0}}}function vAe(r,t){return typeof t=="string"?t!==r:Array.isArray(t)?!NQ(t,r):!1}function R_(r=!1){return{isActive:r,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function t$(){return{animate:R_(!0),whileInView:R_(),whileHover:R_(),whileTap:R_(),whileDrag:R_(),whileFocus:R_(),exit:R_()}}class Ym{constructor(t){this.isMounted=!1,this.node=t}update(){}}class SAe extends Ym{constructor(t){super(t),t.animationState||(t.animationState=yAe(t))}updateAnimationControlsSubscription(){const{animate:t}=this.node.getProps();DN(t)&&(this.unmountControls=t.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:t}=this.node.getProps(),{animate:s}=this.node.prevProps||{};t!==s&&this.updateAnimationControlsSubscription()}unmount(){var t;this.node.animationState.reset(),(t=this.unmountControls)===null||t===void 0||t.call(this)}}let TAe=0;class bAe extends Ym{constructor(){super(...arguments),this.id=TAe++}update(){if(!this.node.presenceContext)return;const{isPresent:t,onExitComplete:s}=this.node.presenceContext,{isPresent:a}=this.node.prevPresenceContext||{};if(!this.node.animationState||t===a)return;const l=this.node.animationState.setActive("exit",!t);s&&!t&&l.then(()=>s(this.id))}mount(){const{register:t}=this.node.presenceContext||{};t&&(this.unmount=t(this.id))}unmount(){}}const wAe={animation:{Feature:SAe},exit:{Feature:bAe}};function Vw(r,t,s,a={passive:!0}){return r.addEventListener(t,s,a),()=>r.removeEventListener(t,s)}function pR(r){return{point:{x:r.pageX,y:r.pageY}}}const RAe=r=>t=>BV(t)&&r(t,pR(t));function _w(r,t,s,a){return Vw(r,t,RAe(s),a)}const n$=(r,t)=>Math.abs(r-t);function CAe(r,t){const s=n$(r.x,t.x),a=n$(r.y,t.y);return Math.sqrt(s**2+a**2)}class yZ{constructor(t,s,{transformPagePoint:a,contextWindow:l,dragSnapToOrigin:d=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const O=kM(this.lastMoveEventInfo,this.history),N=this.startEvent!==null,F=CAe(O.offset,{x:0,y:0})>=3;if(!N&&!F)return;const{point:H}=O,{timestamp:z}=Go;this.history.push({...H,timestamp:z});const{onStart:G,onMove:ee}=this.handlers;N||(G&&G(this.lastMoveEvent,O),this.startEvent=this.lastMoveEvent),ee&&ee(this.lastMoveEvent,O)},this.handlePointerMove=(O,N)=>{this.lastMoveEvent=O,this.lastMoveEventInfo=NM(N,this.transformPagePoint),xi.update(this.updatePoint,!0)},this.handlePointerUp=(O,N)=>{this.end();const{onEnd:F,onSessionEnd:H,resumeAnimation:z}=this.handlers;if(this.dragSnapToOrigin&&z&&z(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const G=kM(O.type==="pointercancel"?this.lastMoveEventInfo:NM(N,this.transformPagePoint),this.history);this.startEvent&&F&&F(O,G),H&&H(O,G)},!BV(t))return;this.dragSnapToOrigin=d,this.handlers=s,this.transformPagePoint=a,this.contextWindow=l||window;const p=pR(t),E=NM(p,this.transformPagePoint),{point:v}=E,{timestamp:b}=Go;this.history=[{...v,timestamp:b}];const{onSessionStart:R}=s;R&&R(t,kM(E,this.history)),this.removeListeners=fR(_w(this.contextWindow,"pointermove",this.handlePointerMove),_w(this.contextWindow,"pointerup",this.handlePointerUp),_w(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(t){this.handlers=t}end(){this.removeListeners&&this.removeListeners(),Vm(this.updatePoint)}}function NM(r,t){return t?{point:t(r.point)}:r}function r$(r,t){return{x:r.x-t.x,y:r.y-t.y}}function kM({point:r},t){return{point:r,delta:r$(r,vZ(t)),offset:r$(r,IAe(t)),velocity:AAe(t,.1)}}function IAe(r){return r[0]}function vZ(r){return r[r.length-1]}function AAe(r,t){if(r.length<2)return{x:0,y:0};let s=r.length-1,a=null;const l=vZ(r);for(;s>=0&&(a=r[s],!(l.timestamp-a.timestamp>Jf(t)));)s--;if(!a)return{x:0,y:0};const d=Qf(l.timestamp-a.timestamp);if(d===0)return{x:0,y:0};const p={x:(l.x-a.x)/d,y:(l.y-a.y)/d};return p.x===1/0&&(p.x=0),p.y===1/0&&(p.y=0),p}const SZ=1e-4,OAe=1-SZ,PAe=1+SZ,TZ=.01,NAe=0-TZ,kAe=0+TZ;function _l(r){return r.max-r.min}function DAe(r,t,s){return Math.abs(r-t)<=s}function i$(r,t,s,a=.5){r.origin=a,r.originPoint=Ji(t.min,t.max,r.origin),r.scale=_l(s)/_l(t),r.translate=Ji(s.min,s.max,r.origin)-r.originPoint,(r.scale>=OAe&&r.scale<=PAe||isNaN(r.scale))&&(r.scale=1),(r.translate>=NAe&&r.translate<=kAe||isNaN(r.translate))&&(r.translate=0)}function Ew(r,t,s,a){i$(r.x,t.x,s.x,a?a.originX:void 0),i$(r.y,t.y,s.y,a?a.originY:void 0)}function s$(r,t,s){r.min=s.min+t.min,r.max=r.min+_l(t)}function LAe(r,t,s){s$(r.x,t.x,s.x),s$(r.y,t.y,s.y)}function o$(r,t,s){r.min=t.min-s.min,r.max=r.min+_l(t)}function yw(r,t,s){o$(r.x,t.x,s.x),o$(r.y,t.y,s.y)}function xAe(r,{min:t,max:s},a){return t!==void 0&&r<t?r=a?Ji(t,r,a.min):Math.max(r,t):s!==void 0&&r>s&&(r=a?Ji(s,r,a.max):Math.min(r,s)),r}function a$(r,t,s){return{min:t!==void 0?r.min+t:void 0,max:s!==void 0?r.max+s-(r.max-r.min):void 0}}function MAe(r,{top:t,left:s,bottom:a,right:l}){return{x:a$(r.x,s,l),y:a$(r.y,t,a)}}function c$(r,t){let s=t.min-r.min,a=t.max-r.max;return t.max-t.min<r.max-r.min&&([s,a]=[a,s]),{min:s,max:a}}function UAe(r,t){return{x:c$(r.x,t.x),y:c$(r.y,t.y)}}function VAe(r,t){let s=.5;const a=_l(r),l=_l(t);return l>a?s=bS(t.min,t.max-a,r.min):a>l&&(s=bS(r.min,r.max-l,t.min)),np(0,1,s)}function FAe(r,t){const s={};return t.min!==void 0&&(s.min=t.min-r.min),t.max!==void 0&&(s.max=t.max-r.min),s}const q2=.35;function jAe(r=q2){return r===!1?r=0:r===!0&&(r=q2),{x:l$(r,"left","right"),y:l$(r,"top","bottom")}}function l$(r,t,s){return{min:u$(r,t),max:u$(r,s)}}function u$(r,t){return typeof r=="number"?r:r[t]||0}const d$=()=>({translate:0,scale:1,origin:0,originPoint:0}),Qv=()=>({x:d$(),y:d$()}),h$=()=>({min:0,max:0}),Ts=()=>({x:h$(),y:h$()});function su(r){return[r("x"),r("y")]}function bZ({top:r,left:t,right:s,bottom:a}){return{x:{min:t,max:s},y:{min:r,max:a}}}function BAe({x:r,y:t}){return{top:t.min,right:r.max,bottom:t.max,left:r.min}}function WAe(r,t){if(!t)return r;const s=t({x:r.left,y:r.top}),a=t({x:r.right,y:r.bottom});return{top:s.y,left:s.x,bottom:a.y,right:a.x}}function DM(r){return r===void 0||r===1}function $2({scale:r,scaleX:t,scaleY:s}){return!DM(r)||!DM(t)||!DM(s)}function I_(r){return $2(r)||wZ(r)||r.z||r.rotate||r.rotateX||r.rotateY||r.skewX||r.skewY}function wZ(r){return f$(r.x)||f$(r.y)}function f$(r){return r&&r!=="0%"}function HP(r,t,s){const a=r-s,l=t*a;return s+l}function p$(r,t,s,a,l){return l!==void 0&&(r=HP(r,l,a)),HP(r,s,a)+t}function Y2(r,t=0,s=1,a,l){r.min=p$(r.min,t,s,a,l),r.max=p$(r.max,t,s,a,l)}function RZ(r,{x:t,y:s}){Y2(r.x,t.translate,t.scale,t.originPoint),Y2(r.y,s.translate,s.scale,s.originPoint)}const m$=.999999999999,g$=1.0000000000001;function GAe(r,t,s,a=!1){const l=s.length;if(!l)return;t.x=t.y=1;let d,p;for(let E=0;E<l;E++){d=s[E],p=d.projectionDelta;const{visualElement:v}=d.options;v&&v.props.style&&v.props.style.display==="contents"||(a&&d.options.layoutScroll&&d.scroll&&d!==d.root&&eS(r,{x:-d.scroll.offset.x,y:-d.scroll.offset.y}),p&&(t.x*=p.x.scale,t.y*=p.y.scale,RZ(r,p)),a&&I_(d.latestValues)&&eS(r,d.latestValues))}t.x<g$&&t.x>m$&&(t.x=1),t.y<g$&&t.y>m$&&(t.y=1)}function Zv(r,t){r.min=r.min+t,r.max=r.max+t}function _$(r,t,s,a,l=.5){const d=Ji(r.min,r.max,l);Y2(r,t,s,d,a)}function eS(r,t){_$(r.x,t.x,t.scaleX,t.scale,t.originX),_$(r.y,t.y,t.scaleY,t.scale,t.originY)}function CZ(r,t){return bZ(WAe(r.getBoundingClientRect(),t))}function zAe(r,t,s){const a=CZ(r,s),{scroll:l}=t;return l&&(Zv(a.x,l.offset.x),Zv(a.y,l.offset.y)),a}const IZ=({current:r})=>r?r.ownerDocument.defaultView:null,HAe=new WeakMap;class KAe{constructor(t){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=Ts(),this.visualElement=t}start(t,{snapToCursor:s=!1}={}){const{presenceContext:a}=this.visualElement;if(a&&a.isPresent===!1)return;const l=R=>{const{dragSnapToOrigin:O}=this.getProps();O?this.pauseAnimation():this.stopAnimation(),s&&this.snapToCursor(pR(R).point)},d=(R,O)=>{const{drag:N,dragPropagation:F,onDragStart:H}=this.getProps();if(N&&!F&&(this.openDragLock&&this.openDragLock(),this.openDragLock=VCe(N),!this.openDragLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),su(G=>{let ee=this.getAxisMotionValue(G).get()||0;if(vh.test(ee)){const{projection:J}=this.visualElement;if(J&&J.layout){const re=J.layout.layoutBox[G];re&&(ee=_l(re)*(parseFloat(ee)/100))}}this.originPoint[G]=ee}),H&&xi.postRender(()=>H(R,O)),F2(this.visualElement,"transform");const{animationState:z}=this.visualElement;z&&z.setActive("whileDrag",!0)},p=(R,O)=>{const{dragPropagation:N,dragDirectionLock:F,onDirectionLock:H,onDrag:z}=this.getProps();if(!N&&!this.openDragLock)return;const{offset:G}=O;if(F&&this.currentDirection===null){this.currentDirection=qAe(G),this.currentDirection!==null&&H&&H(this.currentDirection);return}this.updateAxis("x",O.point,G),this.updateAxis("y",O.point,G),this.visualElement.render(),z&&z(R,O)},E=(R,O)=>this.stop(R,O),v=()=>su(R=>{var O;return this.getAnimationState(R)==="paused"&&((O=this.getAxisMotionValue(R).animation)===null||O===void 0?void 0:O.play())}),{dragSnapToOrigin:b}=this.getProps();this.panSession=new yZ(t,{onSessionStart:l,onStart:d,onMove:p,onSessionEnd:E,resumeAnimation:v},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:b,contextWindow:IZ(this.visualElement)})}stop(t,s){const a=this.isDragging;if(this.cancel(),!a)return;const{velocity:l}=s;this.startAnimation(l);const{onDragEnd:d}=this.getProps();d&&xi.postRender(()=>d(t,s))}cancel(){this.isDragging=!1;const{projection:t,animationState:s}=this.visualElement;t&&(t.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:a}=this.getProps();!a&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),s&&s.setActive("whileDrag",!1)}updateAxis(t,s,a){const{drag:l}=this.getProps();if(!a||!DO(t,l,this.currentDirection))return;const d=this.getAxisMotionValue(t);let p=this.originPoint[t]+a[t];this.constraints&&this.constraints[t]&&(p=xAe(p,this.constraints[t],this.elastic[t])),d.set(p)}resolveConstraints(){var t;const{dragConstraints:s,dragElastic:a}=this.getProps(),l=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(t=this.visualElement.projection)===null||t===void 0?void 0:t.layout,d=this.constraints;s&&Xv(s)?this.constraints||(this.constraints=this.resolveRefConstraints()):s&&l?this.constraints=MAe(l.layoutBox,s):this.constraints=!1,this.elastic=jAe(a),d!==this.constraints&&l&&this.constraints&&!this.hasMutatedConstraints&&su(p=>{this.constraints!==!1&&this.getAxisMotionValue(p)&&(this.constraints[p]=FAe(l.layoutBox[p],this.constraints[p]))})}resolveRefConstraints(){const{dragConstraints:t,onMeasureDragConstraints:s}=this.getProps();if(!t||!Xv(t))return!1;const a=t.current,{projection:l}=this.visualElement;if(!l||!l.layout)return!1;const d=zAe(a,l.root,this.visualElement.getTransformPagePoint());let p=UAe(l.layout.layoutBox,d);if(s){const E=s(BAe(p));this.hasMutatedConstraints=!!E,E&&(p=bZ(E))}return p}startAnimation(t){const{drag:s,dragMomentum:a,dragElastic:l,dragTransition:d,dragSnapToOrigin:p,onDragTransitionEnd:E}=this.getProps(),v=this.constraints||{},b=su(R=>{if(!DO(R,s,this.currentDirection))return;let O=v&&v[R]||{};p&&(O={min:0,max:0});const N=l?200:1e6,F=l?40:1e7,H={type:"inertia",velocity:a?t[R]:0,bounceStiffness:N,bounceDamping:F,timeConstant:750,restDelta:1,restSpeed:10,...d,...O};return this.startAxisValueAnimation(R,H)});return Promise.all(b).then(E)}startAxisValueAnimation(t,s){const a=this.getAxisMotionValue(t);return F2(this.visualElement,t),a.start(ZV(t,a,0,s,this.visualElement,!1))}stopAnimation(){su(t=>this.getAxisMotionValue(t).stop())}pauseAnimation(){su(t=>{var s;return(s=this.getAxisMotionValue(t).animation)===null||s===void 0?void 0:s.pause()})}getAnimationState(t){var s;return(s=this.getAxisMotionValue(t).animation)===null||s===void 0?void 0:s.state}getAxisMotionValue(t){const s=`_drag${t.toUpperCase()}`,a=this.visualElement.getProps(),l=a[s];return l||this.visualElement.getValue(t,(a.initial?a.initial[t]:void 0)||0)}snapToCursor(t){su(s=>{const{drag:a}=this.getProps();if(!DO(s,a,this.currentDirection))return;const{projection:l}=this.visualElement,d=this.getAxisMotionValue(s);if(l&&l.layout){const{min:p,max:E}=l.layout.layoutBox[s];d.set(t[s]-Ji(p,E,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:t,dragConstraints:s}=this.getProps(),{projection:a}=this.visualElement;if(!Xv(s)||!a||!this.constraints)return;this.stopAnimation();const l={x:0,y:0};su(p=>{const E=this.getAxisMotionValue(p);if(E&&this.constraints!==!1){const v=E.get();l[p]=VAe({min:v,max:v},this.constraints[p])}});const{transformTemplate:d}=this.visualElement.getProps();this.visualElement.current.style.transform=d?d({},""):"none",a.root&&a.root.updateScroll(),a.updateLayout(),this.resolveConstraints(),su(p=>{if(!DO(p,t,null))return;const E=this.getAxisMotionValue(p),{min:v,max:b}=this.constraints[p];E.set(Ji(v,b,l[p]))})}addListeners(){if(!this.visualElement.current)return;HAe.set(this.visualElement,this);const t=this.visualElement.current,s=_w(t,"pointerdown",v=>{const{drag:b,dragListener:R=!0}=this.getProps();b&&R&&this.start(v)}),a=()=>{const{dragConstraints:v}=this.getProps();Xv(v)&&v.current&&(this.constraints=this.resolveRefConstraints())},{projection:l}=this.visualElement,d=l.addEventListener("measure",a);l&&!l.layout&&(l.root&&l.root.updateScroll(),l.updateLayout()),xi.read(a);const p=Vw(window,"resize",()=>this.scalePositionWithinConstraints()),E=l.addEventListener("didUpdate",({delta:v,hasLayoutChanged:b})=>{this.isDragging&&b&&(su(R=>{const O=this.getAxisMotionValue(R);O&&(this.originPoint[R]+=v[R].translate,O.set(O.get()+v[R].translate))}),this.visualElement.render())});return()=>{p(),s(),d(),E&&E()}}getProps(){const t=this.visualElement.getProps(),{drag:s=!1,dragDirectionLock:a=!1,dragPropagation:l=!1,dragConstraints:d=!1,dragElastic:p=q2,dragMomentum:E=!0}=t;return{...t,drag:s,dragDirectionLock:a,dragPropagation:l,dragConstraints:d,dragElastic:p,dragMomentum:E}}}function DO(r,t,s){return(t===!0||t===r)&&(s===null||s===r)}function qAe(r,t=10){let s=null;return Math.abs(r.y)>t?s="y":Math.abs(r.x)>t&&(s="x"),s}class $Ae extends Ym{constructor(t){super(t),this.removeGroupControls=gl,this.removeListeners=gl,this.controls=new KAe(t)}mount(){const{dragControls:t}=this.node.getProps();t&&(this.removeGroupControls=t.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||gl}unmount(){this.removeGroupControls(),this.removeListeners()}}const E$=r=>(t,s)=>{r&&xi.postRender(()=>r(t,s))};class YAe extends Ym{constructor(){super(...arguments),this.removePointerDownListener=gl}onPointerDown(t){this.session=new yZ(t,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:IZ(this.node)})}createPanHandlers(){const{onPanSessionStart:t,onPanStart:s,onPan:a,onPanEnd:l}=this.node.getProps();return{onSessionStart:E$(t),onStart:E$(s),onMove:a,onEnd:(d,p)=>{delete this.session,l&&xi.postRender(()=>l(d,p))}}}mount(){this.removePointerDownListener=_w(this.node.current,"pointerdown",t=>this.onPointerDown(t))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const pP={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function y$(r,t){return t.max===t.min?0:r/(t.max-t.min)*100}const Cb={correct:(r,t)=>{if(!t.target)return r;if(typeof r=="string")if(Pn.test(r))r=parseFloat(r);else return r;const s=y$(r,t.target.x),a=y$(r,t.target.y);return`${s}% ${a}%`}},XAe={correct:(r,{treeScale:t,projectionDelta:s})=>{const a=r,l=Fm.parse(r);if(l.length>5)return a;const d=Fm.createTransformer(r),p=typeof l[0]!="number"?1:0,E=s.x.scale*t.x,v=s.y.scale*t.y;l[0+p]/=E,l[1+p]/=v;const b=Ji(E,v,.5);return typeof l[2+p]=="number"&&(l[2+p]/=b),typeof l[3+p]=="number"&&(l[3+p]/=b),d(l)}};class JAe extends V.Component{componentDidMount(){const{visualElement:t,layoutGroup:s,switchLayoutGroup:a,layoutId:l}=this.props,{projection:d}=t;_Ce(QAe),d&&(s.group&&s.group.add(d),a&&a.register&&l&&a.register(d),d.root.didUpdate(),d.addEventListener("animationComplete",()=>{this.safeToRemove()}),d.setOptions({...d.options,onExitComplete:()=>this.safeToRemove()})),pP.hasEverUpdated=!0}getSnapshotBeforeUpdate(t){const{layoutDependency:s,visualElement:a,drag:l,isPresent:d}=this.props,p=a.projection;return p&&(p.isPresent=d,l||t.layoutDependency!==s||s===void 0?p.willUpdate():this.safeToRemove(),t.isPresent!==d&&(d?p.promote():p.relegate()||xi.postRender(()=>{const E=p.getStack();(!E||!E.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:t}=this.props.visualElement;t&&(t.root.didUpdate(),AV.postRender(()=>{!t.currentAnimation&&t.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:t,layoutGroup:s,switchLayoutGroup:a}=this.props,{projection:l}=t;l&&(l.scheduleCheckAfterUnmount(),s&&s.group&&s.group.remove(l),a&&a.deregister&&a.deregister(l))}safeToRemove(){const{safeToRemove:t}=this.props;t&&t()}render(){return null}}function AZ(r){const[t,s]=TV(),a=V.useContext(yV);return D.jsx(JAe,{...r,layoutGroup:a,switchLayoutGroup:V.useContext(EQ),isPresent:t,safeToRemove:s})}const QAe={borderRadius:{...Cb,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:Cb,borderTopRightRadius:Cb,borderBottomLeftRadius:Cb,borderBottomRightRadius:Cb,boxShadow:XAe};function ZAe(r,t,s){const a=Ta(r)?r:Mw(r);return a.start(ZV("",a,t,s)),a.animation}function eOe(r){return r instanceof SVGElement&&r.tagName!=="svg"}const tOe=(r,t)=>r.depth-t.depth;class nOe{constructor(){this.children=[],this.isDirty=!1}add(t){WV(this.children,t),this.isDirty=!0}remove(t){GV(this.children,t),this.isDirty=!0}forEach(t){this.isDirty&&this.children.sort(tOe),this.isDirty=!1,this.children.forEach(t)}}function rOe(r,t){const s=Sh.now(),a=({timestamp:l})=>{const d=l-s;d>=t&&(Vm(a),r(d-t))};return xi.read(a,!0),()=>Vm(a)}const OZ=["TopLeft","TopRight","BottomLeft","BottomRight"],iOe=OZ.length,v$=r=>typeof r=="string"?parseFloat(r):r,S$=r=>typeof r=="number"||Pn.test(r);function sOe(r,t,s,a,l,d){l?(r.opacity=Ji(0,s.opacity!==void 0?s.opacity:1,oOe(a)),r.opacityExit=Ji(t.opacity!==void 0?t.opacity:1,0,aOe(a))):d&&(r.opacity=Ji(t.opacity!==void 0?t.opacity:1,s.opacity!==void 0?s.opacity:1,a));for(let p=0;p<iOe;p++){const E=`border${OZ[p]}Radius`;let v=T$(t,E),b=T$(s,E);if(v===void 0&&b===void 0)continue;v||(v=0),b||(b=0),v===0||b===0||S$(v)===S$(b)?(r[E]=Math.max(Ji(v$(v),v$(b),a),0),(vh.test(b)||vh.test(v))&&(r[E]+="%")):r[E]=b}(t.rotate||s.rotate)&&(r.rotate=Ji(t.rotate||0,s.rotate||0,a))}function T$(r,t){return r[t]!==void 0?r[t]:r.borderRadius}const oOe=PZ(0,.5,$Q),aOe=PZ(.5,.95,gl);function PZ(r,t,s){return a=>a<r?0:a>t?1:s(bS(r,t,a))}function b$(r,t){r.min=t.min,r.max=t.max}function nu(r,t){b$(r.x,t.x),b$(r.y,t.y)}function w$(r,t){r.translate=t.translate,r.scale=t.scale,r.originPoint=t.originPoint,r.origin=t.origin}function R$(r,t,s,a,l){return r-=t,r=HP(r,1/s,a),l!==void 0&&(r=HP(r,1/l,a)),r}function cOe(r,t=0,s=1,a=.5,l,d=r,p=r){if(vh.test(t)&&(t=parseFloat(t),t=Ji(p.min,p.max,t/100)-p.min),typeof t!="number")return;let E=Ji(d.min,d.max,a);r===d&&(E-=t),r.min=R$(r.min,t,s,E,l),r.max=R$(r.max,t,s,E,l)}function C$(r,t,[s,a,l],d,p){cOe(r,t[s],t[a],t[l],t.scale,d,p)}const lOe=["x","scaleX","originX"],uOe=["y","scaleY","originY"];function I$(r,t,s,a){C$(r.x,t,lOe,s?s.x:void 0,a?a.x:void 0),C$(r.y,t,uOe,s?s.y:void 0,a?a.y:void 0)}function A$(r){return r.translate===0&&r.scale===1}function NZ(r){return A$(r.x)&&A$(r.y)}function O$(r,t){return r.min===t.min&&r.max===t.max}function dOe(r,t){return O$(r.x,t.x)&&O$(r.y,t.y)}function P$(r,t){return Math.round(r.min)===Math.round(t.min)&&Math.round(r.max)===Math.round(t.max)}function kZ(r,t){return P$(r.x,t.x)&&P$(r.y,t.y)}function N$(r){return _l(r.x)/_l(r.y)}function k$(r,t){return r.translate===t.translate&&r.scale===t.scale&&r.originPoint===t.originPoint}class hOe{constructor(){this.members=[]}add(t){WV(this.members,t),t.scheduleRender()}remove(t){if(GV(this.members,t),t===this.prevLead&&(this.prevLead=void 0),t===this.lead){const s=this.members[this.members.length-1];s&&this.promote(s)}}relegate(t){const s=this.members.findIndex(l=>t===l);if(s===0)return!1;let a;for(let l=s;l>=0;l--){const d=this.members[l];if(d.isPresent!==!1){a=d;break}}return a?(this.promote(a),!0):!1}promote(t,s){const a=this.lead;if(t!==a&&(this.prevLead=a,this.lead=t,t.show(),a)){a.instance&&a.scheduleRender(),t.scheduleRender(),t.resumeFrom=a,s&&(t.resumeFrom.preserveOpacity=!0),a.snapshot&&(t.snapshot=a.snapshot,t.snapshot.latestValues=a.animationValues||a.latestValues),t.root&&t.root.isUpdating&&(t.isLayoutDirty=!0);const{crossfade:l}=t.options;l===!1&&a.hide()}}exitAnimationComplete(){this.members.forEach(t=>{const{options:s,resumingFrom:a}=t;s.onExitComplete&&s.onExitComplete(),a&&a.options.onExitComplete&&a.options.onExitComplete()})}scheduleRender(){this.members.forEach(t=>{t.instance&&t.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function fOe(r,t,s){let a="";const l=r.x.translate/t.x,d=r.y.translate/t.y,p=(s==null?void 0:s.z)||0;if((l||d||p)&&(a=`translate3d(${l}px, ${d}px, ${p}px) `),(t.x!==1||t.y!==1)&&(a+=`scale(${1/t.x}, ${1/t.y}) `),s){const{transformPerspective:b,rotate:R,rotateX:O,rotateY:N,skewX:F,skewY:H}=s;b&&(a=`perspective(${b}px) ${a}`),R&&(a+=`rotate(${R}deg) `),O&&(a+=`rotateX(${O}deg) `),N&&(a+=`rotateY(${N}deg) `),F&&(a+=`skewX(${F}deg) `),H&&(a+=`skewY(${H}deg) `)}const E=r.x.scale*t.x,v=r.y.scale*t.y;return(E!==1||v!==1)&&(a+=`scale(${E}, ${v})`),a||"none"}const A_={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0},Jb=typeof window<"u"&&window.MotionDebug!==void 0,LM=["","X","Y","Z"],pOe={visibility:"hidden"},D$=1e3;let mOe=0;function xM(r,t,s,a){const{latestValues:l}=t;l[r]&&(s[r]=l[r],t.setStaticValue(r,0),a&&(a[r]=0))}function DZ(r){if(r.hasCheckedOptimisedAppear=!0,r.root===r)return;const{visualElement:t}=r.options;if(!t)return;const s=BQ(t);if(window.MotionHasOptimisedAnimation(s,"transform")){const{layout:l,layoutId:d}=r.options;window.MotionCancelOptimisedAnimation(s,"transform",xi,!(l||d))}const{parent:a}=r;a&&!a.hasCheckedOptimisedAppear&&DZ(a)}function LZ({attachResizeListener:r,defaultParent:t,measureScroll:s,checkIsScrollRoot:a,resetTransform:l}){return class{constructor(p={},E=t==null?void 0:t()){this.id=mOe++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,Jb&&(A_.totalNodes=A_.resolvedTargetDeltas=A_.recalculatedProjection=0),this.nodes.forEach(EOe),this.nodes.forEach(bOe),this.nodes.forEach(wOe),this.nodes.forEach(yOe),Jb&&window.MotionDebug.record(A_)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=p,this.root=E?E.root||E:this,this.path=E?[...E.path,E]:[],this.parent=E,this.depth=E?E.depth+1:0;for(let v=0;v<this.path.length;v++)this.path[v].shouldResetTransform=!0;this.root===this&&(this.nodes=new nOe)}addEventListener(p,E){return this.eventHandlers.has(p)||this.eventHandlers.set(p,new zV),this.eventHandlers.get(p).add(E)}notifyListeners(p,...E){const v=this.eventHandlers.get(p);v&&v.notify(...E)}hasListeners(p){return this.eventHandlers.has(p)}mount(p,E=this.root.hasTreeAnimated){if(this.instance)return;this.isSVG=eOe(p),this.instance=p;const{layoutId:v,layout:b,visualElement:R}=this.options;if(R&&!R.current&&R.mount(p),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),E&&(b||v)&&(this.isLayoutDirty=!0),r){let O;const N=()=>this.root.updateBlockedByResize=!1;r(p,()=>{this.root.updateBlockedByResize=!0,O&&O(),O=rOe(N,250),pP.hasAnimatedSinceResize&&(pP.hasAnimatedSinceResize=!1,this.nodes.forEach(x$))})}v&&this.root.registerSharedNode(v,this),this.options.animate!==!1&&R&&(v||b)&&this.addEventListener("didUpdate",({delta:O,hasLayoutChanged:N,hasRelativeTargetChanged:F,layout:H})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const z=this.options.transition||R.getDefaultTransition()||OOe,{onLayoutAnimationStart:G,onLayoutAnimationComplete:ee}=R.getProps(),J=!this.targetLayout||!kZ(this.targetLayout,H)||F,re=!N&&F;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||re||N&&(J||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(O,re);const de={...VV(z,"layout"),onPlay:G,onComplete:ee};(R.shouldReduceMotion||this.options.layoutRoot)&&(de.delay=0,de.type=!1),this.startAnimation(de)}else N||x$(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=H})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const p=this.getStack();p&&p.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,Vm(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(ROe),this.animationId++)}getTransformTemplate(){const{visualElement:p}=this.options;return p&&p.getProps().transformTemplate}willUpdate(p=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&DZ(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let R=0;R<this.path.length;R++){const O=this.path[R];O.shouldResetTransform=!0,O.updateScroll("snapshot"),O.options.layoutRoot&&O.willUpdate(!1)}const{layoutId:E,layout:v}=this.options;if(E===void 0&&!v)return;const b=this.getTransformTemplate();this.prevTransformTemplateValue=b?b(this.latestValues,""):void 0,this.updateSnapshot(),p&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(L$);return}this.isUpdating||this.nodes.forEach(SOe),this.isUpdating=!1,this.nodes.forEach(TOe),this.nodes.forEach(gOe),this.nodes.forEach(_Oe),this.clearAllSnapshots();const E=Sh.now();Go.delta=np(0,1e3/60,E-Go.timestamp),Go.timestamp=E,Go.isProcessing=!0,CM.update.process(Go),CM.preRender.process(Go),CM.render.process(Go),Go.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,AV.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(vOe),this.sharedNodes.forEach(COe)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,xi.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){xi.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure())}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let v=0;v<this.path.length;v++)this.path[v].updateScroll();const p=this.layout;this.layout=this.measure(!1),this.layoutCorrected=Ts(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:E}=this.options;E&&E.notify("LayoutMeasure",this.layout.layoutBox,p?p.layoutBox:void 0)}updateScroll(p="measure"){let E=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===p&&(E=!1),E){const v=a(this.instance);this.scroll={animationId:this.root.animationId,phase:p,isRoot:v,offset:s(this.instance),wasRoot:this.scroll?this.scroll.isRoot:v}}}resetTransform(){if(!l)return;const p=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,E=this.projectionDelta&&!NZ(this.projectionDelta),v=this.getTransformTemplate(),b=v?v(this.latestValues,""):void 0,R=b!==this.prevTransformTemplateValue;p&&(E||I_(this.latestValues)||R)&&(l(this.instance,b),this.shouldResetTransform=!1,this.scheduleRender())}measure(p=!0){const E=this.measurePageBox();let v=this.removeElementScroll(E);return p&&(v=this.removeTransform(v)),POe(v),{animationId:this.root.animationId,measuredBox:E,layoutBox:v,latestValues:{},source:this.id}}measurePageBox(){var p;const{visualElement:E}=this.options;if(!E)return Ts();const v=E.measureViewportBox();if(!(((p=this.scroll)===null||p===void 0?void 0:p.wasRoot)||this.path.some(NOe))){const{scroll:R}=this.root;R&&(Zv(v.x,R.offset.x),Zv(v.y,R.offset.y))}return v}removeElementScroll(p){var E;const v=Ts();if(nu(v,p),!((E=this.scroll)===null||E===void 0)&&E.wasRoot)return v;for(let b=0;b<this.path.length;b++){const R=this.path[b],{scroll:O,options:N}=R;R!==this.root&&O&&N.layoutScroll&&(O.wasRoot&&nu(v,p),Zv(v.x,O.offset.x),Zv(v.y,O.offset.y))}return v}applyTransform(p,E=!1){const v=Ts();nu(v,p);for(let b=0;b<this.path.length;b++){const R=this.path[b];!E&&R.options.layoutScroll&&R.scroll&&R!==R.root&&eS(v,{x:-R.scroll.offset.x,y:-R.scroll.offset.y}),I_(R.latestValues)&&eS(v,R.latestValues)}return I_(this.latestValues)&&eS(v,this.latestValues),v}removeTransform(p){const E=Ts();nu(E,p);for(let v=0;v<this.path.length;v++){const b=this.path[v];if(!b.instance||!I_(b.latestValues))continue;$2(b.latestValues)&&b.updateSnapshot();const R=Ts(),O=b.measurePageBox();nu(R,O),I$(E,b.latestValues,b.snapshot?b.snapshot.layoutBox:void 0,R)}return I_(this.latestValues)&&I$(E,this.latestValues),E}setTargetDelta(p){this.targetDelta=p,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(p){this.options={...this.options,...p,crossfade:p.crossfade!==void 0?p.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Go.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(p=!1){var E;const v=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=v.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=v.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=v.isSharedProjectionDirty);const b=!!this.resumingFrom||this!==v;if(!(p||b&&this.isSharedProjectionDirty||this.isProjectionDirty||!((E=this.parent)===null||E===void 0)&&E.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:O,layoutId:N}=this.options;if(!(!this.layout||!(O||N))){if(this.resolvedRelativeTargetAt=Go.timestamp,!this.targetDelta&&!this.relativeTarget){const F=this.getClosestProjectingParent();F&&F.layout&&this.animationProgress!==1?(this.relativeParent=F,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Ts(),this.relativeTargetOrigin=Ts(),yw(this.relativeTargetOrigin,this.layout.layoutBox,F.layout.layoutBox),nu(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)){if(this.target||(this.target=Ts(),this.targetWithTransforms=Ts()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),LAe(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):nu(this.target,this.layout.layoutBox),RZ(this.target,this.targetDelta)):nu(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const F=this.getClosestProjectingParent();F&&!!F.resumingFrom==!!this.resumingFrom&&!F.options.layoutScroll&&F.target&&this.animationProgress!==1?(this.relativeParent=F,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Ts(),this.relativeTargetOrigin=Ts(),yw(this.relativeTargetOrigin,this.target,F.target),nu(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}Jb&&A_.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(!(!this.parent||$2(this.parent.latestValues)||wZ(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var p;const E=this.getLead(),v=!!this.resumingFrom||this!==E;let b=!0;if((this.isProjectionDirty||!((p=this.parent)===null||p===void 0)&&p.isProjectionDirty)&&(b=!1),v&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(b=!1),this.resolvedRelativeTargetAt===Go.timestamp&&(b=!1),b)return;const{layout:R,layoutId:O}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(R||O))return;nu(this.layoutCorrected,this.layout.layoutBox);const N=this.treeScale.x,F=this.treeScale.y;GAe(this.layoutCorrected,this.treeScale,this.path,v),E.layout&&!E.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(E.target=E.layout.layoutBox,E.targetWithTransforms=Ts());const{target:H}=E;if(!H){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(w$(this.prevProjectionDelta.x,this.projectionDelta.x),w$(this.prevProjectionDelta.y,this.projectionDelta.y)),Ew(this.projectionDelta,this.layoutCorrected,H,this.latestValues),(this.treeScale.x!==N||this.treeScale.y!==F||!k$(this.projectionDelta.x,this.prevProjectionDelta.x)||!k$(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",H)),Jb&&A_.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(p=!0){var E;if((E=this.options.visualElement)===null||E===void 0||E.scheduleRender(),p){const v=this.getStack();v&&v.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=Qv(),this.projectionDelta=Qv(),this.projectionDeltaWithTransform=Qv()}setAnimationOrigin(p,E=!1){const v=this.snapshot,b=v?v.latestValues:{},R={...this.latestValues},O=Qv();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!E;const N=Ts(),F=v?v.source:void 0,H=this.layout?this.layout.source:void 0,z=F!==H,G=this.getStack(),ee=!G||G.members.length<=1,J=!!(z&&!ee&&this.options.crossfade===!0&&!this.path.some(AOe));this.animationProgress=0;let re;this.mixTargetDelta=de=>{const se=de/1e3;M$(O.x,p.x,se),M$(O.y,p.y,se),this.setTargetDelta(O),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(yw(N,this.layout.layoutBox,this.relativeParent.layout.layoutBox),IOe(this.relativeTarget,this.relativeTargetOrigin,N,se),re&&dOe(this.relativeTarget,re)&&(this.isProjectionDirty=!1),re||(re=Ts()),nu(re,this.relativeTarget)),z&&(this.animationValues=R,sOe(R,b,this.latestValues,se,J,ee)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=se},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(p){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(Vm(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=xi.update(()=>{pP.hasAnimatedSinceResize=!0,this.currentAnimation=ZAe(0,D$,{...p,onUpdate:E=>{this.mixTargetDelta(E),p.onUpdate&&p.onUpdate(E)},onComplete:()=>{p.onComplete&&p.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const p=this.getStack();p&&p.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(D$),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const p=this.getLead();let{targetWithTransforms:E,target:v,layout:b,latestValues:R}=p;if(!(!E||!v||!b)){if(this!==p&&this.layout&&b&&xZ(this.options.animationType,this.layout.layoutBox,b.layoutBox)){v=this.target||Ts();const O=_l(this.layout.layoutBox.x);v.x.min=p.target.x.min,v.x.max=v.x.min+O;const N=_l(this.layout.layoutBox.y);v.y.min=p.target.y.min,v.y.max=v.y.min+N}nu(E,v),eS(E,R),Ew(this.projectionDeltaWithTransform,this.layoutCorrected,E,R)}}registerSharedNode(p,E){this.sharedNodes.has(p)||this.sharedNodes.set(p,new hOe),this.sharedNodes.get(p).add(E);const b=E.options.initialPromotionConfig;E.promote({transition:b?b.transition:void 0,preserveFollowOpacity:b&&b.shouldPreserveFollowOpacity?b.shouldPreserveFollowOpacity(E):void 0})}isLead(){const p=this.getStack();return p?p.lead===this:!0}getLead(){var p;const{layoutId:E}=this.options;return E?((p=this.getStack())===null||p===void 0?void 0:p.lead)||this:this}getPrevLead(){var p;const{layoutId:E}=this.options;return E?(p=this.getStack())===null||p===void 0?void 0:p.prevLead:void 0}getStack(){const{layoutId:p}=this.options;if(p)return this.root.sharedNodes.get(p)}promote({needsReset:p,transition:E,preserveFollowOpacity:v}={}){const b=this.getStack();b&&b.promote(this,v),p&&(this.projectionDelta=void 0,this.needsReset=!0),E&&this.setOptions({transition:E})}relegate(){const p=this.getStack();return p?p.relegate(this):!1}resetSkewAndRotation(){const{visualElement:p}=this.options;if(!p)return;let E=!1;const{latestValues:v}=p;if((v.z||v.rotate||v.rotateX||v.rotateY||v.rotateZ||v.skewX||v.skewY)&&(E=!0),!E)return;const b={};v.z&&xM("z",p,b,this.animationValues);for(let R=0;R<LM.length;R++)xM(`rotate${LM[R]}`,p,b,this.animationValues),xM(`skew${LM[R]}`,p,b,this.animationValues);p.render();for(const R in b)p.setStaticValue(R,b[R]),this.animationValues&&(this.animationValues[R]=b[R]);p.scheduleRender()}getProjectionStyles(p){var E,v;if(!this.instance||this.isSVG)return;if(!this.isVisible)return pOe;const b={visibility:""},R=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,b.opacity="",b.pointerEvents=hP(p==null?void 0:p.pointerEvents)||"",b.transform=R?R(this.latestValues,""):"none",b;const O=this.getLead();if(!this.projectionDelta||!this.layout||!O.target){const z={};return this.options.layoutId&&(z.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,z.pointerEvents=hP(p==null?void 0:p.pointerEvents)||""),this.hasProjected&&!I_(this.latestValues)&&(z.transform=R?R({},""):"none",this.hasProjected=!1),z}const N=O.animationValues||O.latestValues;this.applyTransformsToTarget(),b.transform=fOe(this.projectionDeltaWithTransform,this.treeScale,N),R&&(b.transform=R(N,b.transform));const{x:F,y:H}=this.projectionDelta;b.transformOrigin=`${F.origin*100}% ${H.origin*100}% 0`,O.animationValues?b.opacity=O===this?(v=(E=N.opacity)!==null&&E!==void 0?E:this.latestValues.opacity)!==null&&v!==void 0?v:1:this.preserveOpacity?this.latestValues.opacity:N.opacityExit:b.opacity=O===this?N.opacity!==void 0?N.opacity:"":N.opacityExit!==void 0?N.opacityExit:0;for(const z in jP){if(N[z]===void 0)continue;const{correct:G,applyTo:ee}=jP[z],J=b.transform==="none"?N[z]:G(N[z],O);if(ee){const re=ee.length;for(let de=0;de<re;de++)b[ee[de]]=J}else b[z]=J}return this.options.layoutId&&(b.pointerEvents=O===this?hP(p==null?void 0:p.pointerEvents)||"":"none"),b}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(p=>{var E;return(E=p.currentAnimation)===null||E===void 0?void 0:E.stop()}),this.root.nodes.forEach(L$),this.root.sharedNodes.clear()}}}function gOe(r){r.updateLayout()}function _Oe(r){var t;const s=((t=r.resumeFrom)===null||t===void 0?void 0:t.snapshot)||r.snapshot;if(r.isLead()&&r.layout&&s&&r.hasListeners("didUpdate")){const{layoutBox:a,measuredBox:l}=r.layout,{animationType:d}=r.options,p=s.source!==r.layout.source;d==="size"?su(O=>{const N=p?s.measuredBox[O]:s.layoutBox[O],F=_l(N);N.min=a[O].min,N.max=N.min+F}):xZ(d,s.layoutBox,a)&&su(O=>{const N=p?s.measuredBox[O]:s.layoutBox[O],F=_l(a[O]);N.max=N.min+F,r.relativeTarget&&!r.currentAnimation&&(r.isProjectionDirty=!0,r.relativeTarget[O].max=r.relativeTarget[O].min+F)});const E=Qv();Ew(E,a,s.layoutBox);const v=Qv();p?Ew(v,r.applyTransform(l,!0),s.measuredBox):Ew(v,a,s.layoutBox);const b=!NZ(E);let R=!1;if(!r.resumeFrom){const O=r.getClosestProjectingParent();if(O&&!O.resumeFrom){const{snapshot:N,layout:F}=O;if(N&&F){const H=Ts();yw(H,s.layoutBox,N.layoutBox);const z=Ts();yw(z,a,F.layoutBox),kZ(H,z)||(R=!0),O.options.layoutRoot&&(r.relativeTarget=z,r.relativeTargetOrigin=H,r.relativeParent=O)}}}r.notifyListeners("didUpdate",{layout:a,snapshot:s,delta:v,layoutDelta:E,hasLayoutChanged:b,hasRelativeTargetChanged:R})}else if(r.isLead()){const{onExitComplete:a}=r.options;a&&a()}r.options.transition=void 0}function EOe(r){Jb&&A_.totalNodes++,r.parent&&(r.isProjecting()||(r.isProjectionDirty=r.parent.isProjectionDirty),r.isSharedProjectionDirty||(r.isSharedProjectionDirty=!!(r.isProjectionDirty||r.parent.isProjectionDirty||r.parent.isSharedProjectionDirty)),r.isTransformDirty||(r.isTransformDirty=r.parent.isTransformDirty))}function yOe(r){r.isProjectionDirty=r.isSharedProjectionDirty=r.isTransformDirty=!1}function vOe(r){r.clearSnapshot()}function L$(r){r.clearMeasurements()}function SOe(r){r.isLayoutDirty=!1}function TOe(r){const{visualElement:t}=r.options;t&&t.getProps().onBeforeLayoutMeasure&&t.notify("BeforeLayoutMeasure"),r.resetTransform()}function x$(r){r.finishAnimation(),r.targetDelta=r.relativeTarget=r.target=void 0,r.isProjectionDirty=!0}function bOe(r){r.resolveTargetDelta()}function wOe(r){r.calcProjection()}function ROe(r){r.resetSkewAndRotation()}function COe(r){r.removeLeadSnapshot()}function M$(r,t,s){r.translate=Ji(t.translate,0,s),r.scale=Ji(t.scale,1,s),r.origin=t.origin,r.originPoint=t.originPoint}function U$(r,t,s,a){r.min=Ji(t.min,s.min,a),r.max=Ji(t.max,s.max,a)}function IOe(r,t,s,a){U$(r.x,t.x,s.x,a),U$(r.y,t.y,s.y,a)}function AOe(r){return r.animationValues&&r.animationValues.opacityExit!==void 0}const OOe={duration:.45,ease:[.4,0,.1,1]},V$=r=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(r),F$=V$("applewebkit/")&&!V$("chrome/")?Math.round:gl;function j$(r){r.min=F$(r.min),r.max=F$(r.max)}function POe(r){j$(r.x),j$(r.y)}function xZ(r,t,s){return r==="position"||r==="preserve-aspect"&&!DAe(N$(t),N$(s),.2)}function NOe(r){var t;return r!==r.root&&((t=r.scroll)===null||t===void 0?void 0:t.wasRoot)}const kOe=LZ({attachResizeListener:(r,t)=>Vw(r,"resize",t),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),MM={current:void 0},MZ=LZ({measureScroll:r=>({x:r.scrollLeft,y:r.scrollTop}),defaultParent:()=>{if(!MM.current){const r=new kOe({});r.mount(window),r.setOptions({layoutScroll:!0}),MM.current=r}return MM.current},resetTransform:(r,t)=>{r.style.transform=t!==void 0?t:"none"},checkIsScrollRoot:r=>window.getComputedStyle(r).position==="fixed"}),DOe={pan:{Feature:YAe},drag:{Feature:$Ae,ProjectionNode:MZ,MeasureLayout:AZ}};function B$(r,t,s){const{props:a}=r;r.animationState&&a.whileHover&&r.animationState.setActive("whileHover",s==="Start");const l="onHover"+s,d=a[l];d&&xi.postRender(()=>d(t,pR(t)))}class LOe extends Ym{mount(){const{current:t}=this.node;t&&(this.unmount=DCe(t,s=>(B$(this.node,s,"Start"),a=>B$(this.node,a,"End"))))}unmount(){}}class xOe extends Ym{constructor(){super(...arguments),this.isActive=!1}onFocus(){let t=!1;try{t=this.node.current.matches(":focus-visible")}catch{t=!0}!t||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=fR(Vw(this.node.current,"focus",()=>this.onFocus()),Vw(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function W$(r,t,s){const{props:a}=r;r.animationState&&a.whileTap&&r.animationState.setActive("whileTap",s==="Start");const l="onTap"+(s==="End"?"":s),d=a[l];d&&xi.postRender(()=>d(t,pR(t)))}class MOe extends Ym{mount(){const{current:t}=this.node;t&&(this.unmount=UCe(t,s=>(W$(this.node,s,"Start"),(a,{success:l})=>W$(this.node,a,l?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const X2=new WeakMap,UM=new WeakMap,UOe=r=>{const t=X2.get(r.target);t&&t(r)},VOe=r=>{r.forEach(UOe)};function FOe({root:r,...t}){const s=r||document;UM.has(s)||UM.set(s,{});const a=UM.get(s),l=JSON.stringify(t);return a[l]||(a[l]=new IntersectionObserver(VOe,{root:r,...t})),a[l]}function jOe(r,t,s){const a=FOe(t);return X2.set(r,s),a.observe(r),()=>{X2.delete(r),a.unobserve(r)}}const BOe={some:0,all:1};class WOe extends Ym{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:t={}}=this.node.getProps(),{root:s,margin:a,amount:l="some",once:d}=t,p={root:s?s.current:void 0,rootMargin:a,threshold:typeof l=="number"?l:BOe[l]},E=v=>{const{isIntersecting:b}=v;if(this.isInView===b||(this.isInView=b,d&&!b&&this.hasEnteredView))return;b&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",b);const{onViewportEnter:R,onViewportLeave:O}=this.node.getProps(),N=b?R:O;N&&N(v)};return jOe(this.node.current,p,E)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:t,prevProps:s}=this.node;["amount","margin","root"].some(GOe(t,s))&&this.startObserver()}unmount(){}}function GOe({viewport:r={}},{viewport:t={}}={}){return s=>r[s]!==t[s]}const zOe={inView:{Feature:WOe},tap:{Feature:MOe},focus:{Feature:xOe},hover:{Feature:LOe}},HOe={layout:{ProjectionNode:MZ,MeasureLayout:AZ}},J2={current:null},UZ={current:!1};function KOe(){if(UZ.current=!0,!!bV)if(window.matchMedia){const r=window.matchMedia("(prefers-reduced-motion)"),t=()=>J2.current=r.matches;r.addListener(t),t()}else J2.current=!1}const qOe=[...cZ,ya,Fm],$Oe=r=>qOe.find(aZ(r)),G$=new WeakMap;function YOe(r,t,s){for(const a in t){const l=t[a],d=s[a];if(Ta(l))r.addValue(a,l);else if(Ta(d))r.addValue(a,Mw(l,{owner:r}));else if(d!==l)if(r.hasValue(a)){const p=r.getValue(a);p.liveStyle===!0?p.jump(l):p.hasAnimated||p.set(l)}else{const p=r.getStaticValue(a);r.addValue(a,Mw(p!==void 0?p:l,{owner:r}))}}for(const a in s)t[a]===void 0&&r.removeValue(a);return t}const z$=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class XOe{scrapeMotionValuesFromProps(t,s,a){return{}}constructor({parent:t,props:s,presenceContext:a,reducedMotionConfig:l,blockInitialAnimation:d,visualState:p},E={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=XV,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const F=Sh.now();this.renderScheduledAt<F&&(this.renderScheduledAt=F,xi.render(this.render,!1,!0))};const{latestValues:v,renderState:b,onUpdate:R}=p;this.onUpdate=R,this.latestValues=v,this.baseTarget={...v},this.initialValues=s.initial?{...v}:{},this.renderState=b,this.parent=t,this.props=s,this.presenceContext=a,this.depth=t?t.depth+1:0,this.reducedMotionConfig=l,this.options=E,this.blockInitialAnimation=!!d,this.isControllingVariants=LN(s),this.isVariantNode=gQ(s),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(t&&t.current);const{willChange:O,...N}=this.scrapeMotionValuesFromProps(s,{},this);for(const F in N){const H=N[F];v[F]!==void 0&&Ta(H)&&H.set(v[F],!1)}}mount(t){this.current=t,G$.set(t,this),this.projection&&!this.projection.instance&&this.projection.mount(t),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((s,a)=>this.bindToMotionValue(a,s)),UZ.current||KOe(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:J2.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){G$.delete(this.current),this.projection&&this.projection.unmount(),Vm(this.notifyUpdate),Vm(this.render),this.valueSubscriptions.forEach(t=>t()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const t in this.events)this.events[t].clear();for(const t in this.features){const s=this.features[t];s&&(s.unmount(),s.isMounted=!1)}this.current=null}bindToMotionValue(t,s){this.valueSubscriptions.has(t)&&this.valueSubscriptions.get(t)();const a=cE.has(t),l=s.on("change",E=>{this.latestValues[t]=E,this.props.onUpdate&&xi.preRender(this.notifyUpdate),a&&this.projection&&(this.projection.isTransformDirty=!0)}),d=s.on("renderRequest",this.scheduleRender);let p;window.MotionCheckAppearSync&&(p=window.MotionCheckAppearSync(this,t,s)),this.valueSubscriptions.set(t,()=>{l(),d(),p&&p(),s.owner&&s.stop()})}sortNodePosition(t){return!this.current||!this.sortInstanceNodePosition||this.type!==t.type?0:this.sortInstanceNodePosition(this.current,t.current)}updateFeatures(){let t="animation";for(t in wS){const s=wS[t];if(!s)continue;const{isEnabled:a,Feature:l}=s;if(!this.features[t]&&l&&a(this.props)&&(this.features[t]=new l(this)),this.features[t]){const d=this.features[t];d.isMounted?d.update():(d.mount(),d.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):Ts()}getStaticValue(t){return this.latestValues[t]}setStaticValue(t,s){this.latestValues[t]=s}update(t,s){(t.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=t,this.prevPresenceContext=this.presenceContext,this.presenceContext=s;for(let a=0;a<z$.length;a++){const l=z$[a];this.propEventSubscriptions[l]&&(this.propEventSubscriptions[l](),delete this.propEventSubscriptions[l]);const d="on"+l,p=t[d];p&&(this.propEventSubscriptions[l]=this.on(l,p))}this.prevMotionValues=YOe(this,this.scrapeMotionValuesFromProps(t,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue(),this.onUpdate&&this.onUpdate(this)}getProps(){return this.props}getVariant(t){return this.props.variants?this.props.variants[t]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(t){const s=this.getClosestVariantNode();if(s)return s.variantChildren&&s.variantChildren.add(t),()=>s.variantChildren.delete(t)}addValue(t,s){const a=this.values.get(t);s!==a&&(a&&this.removeValue(t),this.bindToMotionValue(t,s),this.values.set(t,s),this.latestValues[t]=s.get())}removeValue(t){this.values.delete(t);const s=this.valueSubscriptions.get(t);s&&(s(),this.valueSubscriptions.delete(t)),delete this.latestValues[t],this.removeValueFromRenderState(t,this.renderState)}hasValue(t){return this.values.has(t)}getValue(t,s){if(this.props.values&&this.props.values[t])return this.props.values[t];let a=this.values.get(t);return a===void 0&&s!==void 0&&(a=Mw(s===null?void 0:s,{owner:this}),this.addValue(t,a)),a}readValue(t,s){var a;let l=this.latestValues[t]!==void 0||!this.current?this.latestValues[t]:(a=this.getBaseTargetFromProps(this.props,t))!==null&&a!==void 0?a:this.readValueFromInstance(this.current,t,this.options);return l!=null&&(typeof l=="string"&&(sZ(l)||XQ(l))?l=parseFloat(l):!$Oe(l)&&Fm.test(s)&&(l=nZ(t,s)),this.setBaseTarget(t,Ta(l)?l.get():l)),Ta(l)?l.get():l}setBaseTarget(t,s){this.baseTarget[t]=s}getBaseTarget(t){var s;const{initial:a}=this.props;let l;if(typeof a=="string"||typeof a=="object"){const p=PV(this.props,a,(s=this.presenceContext)===null||s===void 0?void 0:s.custom);p&&(l=p[t])}if(a&&l!==void 0)return l;const d=this.getBaseTargetFromProps(this.props,t);return d!==void 0&&!Ta(d)?d:this.initialValues[t]!==void 0&&l===void 0?void 0:this.baseTarget[t]}on(t,s){return this.events[t]||(this.events[t]=new zV),this.events[t].add(s)}notify(t,...s){this.events[t]&&this.events[t].notify(...s)}}class VZ extends XOe{constructor(){super(...arguments),this.KeyframeResolver=lZ}sortInstanceNodePosition(t,s){return t.compareDocumentPosition(s)&2?1:-1}getBaseTargetFromProps(t,s){return t.style?t.style[s]:void 0}removeValueFromRenderState(t,{vars:s,style:a}){delete s[t],delete a[t]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:t}=this.props;Ta(t)&&(this.childSubscription=t.on("change",s=>{this.current&&(this.current.textContent=`${s}`)}))}}function JOe(r){return window.getComputedStyle(r)}class QOe extends VZ{constructor(){super(...arguments),this.type="html",this.renderInstance=RQ}readValueFromInstance(t,s){if(cE.has(s)){const a=YV(s);return a&&a.default||0}else{const a=JOe(t),l=(TQ(s)?a.getPropertyValue(s):a[s])||0;return typeof l=="string"?l.trim():l}}measureInstanceViewportBox(t,{transformPagePoint:s}){return CZ(t,s)}build(t,s,a){DV(t,s,a.transformTemplate)}scrapeMotionValuesFromProps(t,s,a){return UV(t,s,a)}}class ZOe extends VZ{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=Ts}getBaseTargetFromProps(t,s){return t[s]}readValueFromInstance(t,s){if(cE.has(s)){const a=YV(s);return a&&a.default||0}return s=CQ.has(s)?s:IV(s),t.getAttribute(s)}scrapeMotionValuesFromProps(t,s,a){return OQ(t,s,a)}build(t,s,a){LV(t,s,this.isSVGTag,a.transformTemplate)}renderInstance(t,s,a,l){IQ(t,s,a,l)}mount(t){this.isSVGTag=MV(t.tagName),super.mount(t)}}const ePe=(r,t)=>OV(r)?new ZOe(t):new QOe(t,{allowProjection:r!==V.Fragment}),tPe=CCe({...wAe,...zOe,...DOe,...HOe},ePe),Dh=BRe(tPe),nPe=(r,t)=>r.find(s=>s.id===t);function H$(r,t){const s=FZ(r,t),a=s?r[s].findIndex(l=>l.id===t):-1;return{position:s,index:a}}function FZ(r,t){for(const[s,a]of Object.entries(r))if(nPe(a,t))return s}function rPe(r){const t=r.includes("right"),s=r.includes("left");let a="center";return t&&(a="flex-end"),s&&(a="flex-start"),{display:"flex",flexDirection:"column",alignItems:a}}function iPe(r){const s=r==="top"||r==="bottom"?"0 auto":void 0,a=r.includes("top")?"env(safe-area-inset-top, 0px)":void 0,l=r.includes("bottom")?"env(safe-area-inset-bottom, 0px)":void 0,d=r.includes("left")?void 0:"env(safe-area-inset-right, 0px)",p=r.includes("right")?void 0:"env(safe-area-inset-left, 0px)";return{position:"fixed",zIndex:"var(--toast-z-index, 5500)",pointerEvents:"none",display:"flex",flexDirection:"column",margin:s,top:a,bottom:l,right:d,left:p}}var sPe=/^((children|dangerouslySetInnerHTML|key|ref|autoFocus|defaultValue|defaultChecked|innerHTML|suppressContentEditableWarning|suppressHydrationWarning|valueLink|abbr|accept|acceptCharset|accessKey|action|allow|allowUserMedia|allowPaymentRequest|allowFullScreen|allowTransparency|alt|async|autoComplete|autoPlay|capture|cellPadding|cellSpacing|challenge|charSet|checked|cite|classID|className|cols|colSpan|content|contentEditable|contextMenu|controls|controlsList|coords|crossOrigin|data|dateTime|decoding|default|defer|dir|disabled|disablePictureInPicture|disableRemotePlayback|download|draggable|encType|enterKeyHint|fetchpriority|fetchPriority|form|formAction|formEncType|formMethod|formNoValidate|formTarget|frameBorder|headers|height|hidden|high|href|hrefLang|htmlFor|httpEquiv|id|inputMode|integrity|is|keyParams|keyType|kind|label|lang|list|loading|loop|low|marginHeight|marginWidth|max|maxLength|media|mediaGroup|method|min|minLength|multiple|muted|name|nonce|noValidate|open|optimum|pattern|placeholder|playsInline|poster|preload|profile|radioGroup|readOnly|referrerPolicy|rel|required|reversed|role|rows|rowSpan|sandbox|scope|scoped|scrolling|seamless|selected|shape|size|sizes|slot|span|spellCheck|src|srcDoc|srcLang|srcSet|start|step|style|summary|tabIndex|target|title|translate|type|useMap|value|width|wmode|wrap|about|datatype|inlist|prefix|property|resource|typeof|vocab|autoCapitalize|autoCorrect|autoSave|color|incremental|fallback|inert|itemProp|itemScope|itemType|itemID|itemRef|on|option|results|security|unselectable|accentHeight|accumulate|additive|alignmentBaseline|allowReorder|alphabetic|amplitude|arabicForm|ascent|attributeName|attributeType|autoReverse|azimuth|baseFrequency|baselineShift|baseProfile|bbox|begin|bias|by|calcMode|capHeight|clip|clipPathUnits|clipPath|clipRule|colorInterpolation|colorInterpolationFilters|colorProfile|colorRendering|contentScriptType|contentStyleType|cursor|cx|cy|d|decelerate|descent|diffuseConstant|direction|display|divisor|dominantBaseline|dur|dx|dy|edgeMode|elevation|enableBackground|end|exponent|externalResourcesRequired|fill|fillOpacity|fillRule|filter|filterRes|filterUnits|floodColor|floodOpacity|focusable|fontFamily|fontSize|fontSizeAdjust|fontStretch|fontStyle|fontVariant|fontWeight|format|from|fr|fx|fy|g1|g2|glyphName|glyphOrientationHorizontal|glyphOrientationVertical|glyphRef|gradientTransform|gradientUnits|hanging|horizAdvX|horizOriginX|ideographic|imageRendering|in|in2|intercept|k|k1|k2|k3|k4|kernelMatrix|kernelUnitLength|kerning|keyPoints|keySplines|keyTimes|lengthAdjust|letterSpacing|lightingColor|limitingConeAngle|local|markerEnd|markerMid|markerStart|markerHeight|markerUnits|markerWidth|mask|maskContentUnits|maskUnits|mathematical|mode|numOctaves|offset|opacity|operator|order|orient|orientation|origin|overflow|overlinePosition|overlineThickness|panose1|paintOrder|pathLength|patternContentUnits|patternTransform|patternUnits|pointerEvents|points|pointsAtX|pointsAtY|pointsAtZ|preserveAlpha|preserveAspectRatio|primitiveUnits|r|radius|refX|refY|renderingIntent|repeatCount|repeatDur|requiredExtensions|requiredFeatures|restart|result|rotate|rx|ry|scale|seed|shapeRendering|slope|spacing|specularConstant|specularExponent|speed|spreadMethod|startOffset|stdDeviation|stemh|stemv|stitchTiles|stopColor|stopOpacity|strikethroughPosition|strikethroughThickness|string|stroke|strokeDasharray|strokeDashoffset|strokeLinecap|strokeLinejoin|strokeMiterlimit|strokeOpacity|strokeWidth|surfaceScale|systemLanguage|tableValues|targetX|targetY|textAnchor|textDecoration|textRendering|textLength|to|transform|u1|u2|underlinePosition|underlineThickness|unicode|unicodeBidi|unicodeRange|unitsPerEm|vAlphabetic|vHanging|vIdeographic|vMathematical|values|vectorEffect|version|vertAdvY|vertOriginX|vertOriginY|viewBox|viewTarget|visibility|widths|wordSpacing|writingMode|x|xHeight|x1|x2|xChannelSelector|xlinkActuate|xlinkArcrole|xlinkHref|xlinkRole|xlinkShow|xlinkTitle|xlinkType|xmlBase|xmlns|xmlnsXlink|xmlLang|xmlSpace|y|y1|y2|yChannelSelector|z|zoomAndPan|for|class|autofocus)|(([Dd][Aa][Tt][Aa]|[Aa][Rr][Ii][Aa]|x)-.*))$/,oPe=eQ(function(r){return sPe.test(r)||r.charCodeAt(0)===111&&r.charCodeAt(1)===110&&r.charCodeAt(2)<91}),aPe=oPe,cPe=function(t){return t!=="theme"},K$=function(t){return typeof t=="string"&&t.charCodeAt(0)>96?aPe:cPe},q$=function(t,s,a){var l;if(s){var d=s.shouldForwardProp;l=t.__emotion_forwardProp&&d?function(p){return t.__emotion_forwardProp(p)&&d(p)}:d}return typeof l!="function"&&a&&(l=t.__emotion_forwardProp),l},lPe=function(t){var s=t.cache,a=t.serialized,l=t.isStringTag;return hV(s,a,l),sQ(function(){return fV(s,a,l)}),null},uPe=function r(t,s){var a=t.__emotion_real===t,l=a&&t.__emotion_base||t,d,p;s!==void 0&&(d=s.label,p=s.target);var E=q$(t,s,a),v=E||K$(l),b=!v("as");return function(){var R=arguments,O=a&&t.__emotion_styles!==void 0?t.__emotion_styles.slice(0):[];if(d!==void 0&&O.push("label:"+d+";"),R[0]==null||R[0].raw===void 0)O.push.apply(O,R);else{var N=R[0];O.push(N[0]);for(var F=R.length,H=1;H<F;H++)O.push(R[H],N[H])}var z=mV(function(G,ee,J){var re=b&&G.as||l,de="",se=[],ye=G;if(G.theme==null){ye={};for(var Q in G)ye[Q]=G[Q];ye.theme=V.useContext(TS)}typeof G.className=="string"?de=nQ(ee.registered,se,G.className):G.className!=null&&(de=G.className+" ");var ne=ON(O.concat(se),ee.registered,ye);de+=ee.key+"-"+ne.name,p!==void 0&&(de+=" "+p);var oe=b&&E===void 0?K$(re):v,ue={};for(var Ee in G)b&&Ee==="as"||oe(Ee)&&(ue[Ee]=G[Ee]);return ue.className=de,J&&(ue.ref=J),V.createElement(V.Fragment,null,V.createElement(lPe,{cache:ee,serialized:ne,isStringTag:typeof re=="string"}),V.createElement(re,ue))});return z.displayName=d!==void 0?d:"Styled("+(typeof l=="string"?l:l.displayName||l.name||"Component")+")",z.defaultProps=t.defaultProps,z.__emotion_real=z,z.__emotion_base=l,z.__emotion_styles=O,z.__emotion_forwardProp=E,Object.defineProperty(z,"toString",{value:function(){return"."+p}}),z.withComponent=function(G,ee){var J=r(G,$_({},s,ee,{shouldForwardProp:q$(z,ee,!0)}));return J.apply(void 0,O)},z}},dPe=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","marquee","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"],Q2=uPe.bind(null);dPe.forEach(function(r){Q2[r]=Q2(r)});const hPe=new Set([...LEe,"textStyle","layerStyle","apply","noOfLines","focusBorderColor","errorBorderColor","as","__css","css","sx"]),fPe=new Set(["htmlWidth","htmlHeight","htmlSize","htmlTranslate"]);function pPe(r){return(fPe.has(r)||!hPe.has(r))&&r[0]!=="_"}const mPe=d_e(Q2),gPe=({baseStyle:r})=>t=>{const{theme:s,css:a,__css:l,sx:d,...p}=t,[E]=v_e(p,MEe),v=xc(r,t),b=Jge({},l,v,vN(E),d),R=DJ(b)(t.theme);return a?[R,a]:R};function VM(r,t){const{baseStyle:s,...a}=t??{};a.shouldForwardProp||(a.shouldForwardProp=pPe);const l=gPe({baseStyle:s}),d=mPe(r,a)(l);return V.forwardRef(function(v,b){const{children:R,...O}=v,{colorMode:N,forced:F}=NN(),H=F?N:void 0;return V.createElement(d,{ref:b,"data-theme":H,...O},R)})}function _Pe(){const r=new Map;return new Proxy(VM,{apply(t,s,a){return VM(...a)},get(t,s){return r.has(s)||r.set(s,VM(s)),r.get(s)}})}const Ot=_Pe(),EPe={initial:r=>{const{position:t}=r,s=["top","bottom"].includes(t)?"y":"x";let a=["top-right","bottom-right"].includes(t)?1:-1;return t==="bottom"&&(a=1),{opacity:0,[s]:a*24}},animate:{opacity:1,y:0,x:0,scale:1,transition:{duration:.4,ease:[.4,0,.2,1]}},exit:{opacity:0,scale:.85,transition:{duration:.2,ease:[.4,0,1,1]}}},jZ=V.memo(r=>{const{id:t,message:s,onCloseComplete:a,onRequestRemove:l,requestClose:d=!1,position:p="bottom",duration:E=5e3,containerStyle:v,motionVariants:b=EPe,toastSpacing:R="0.5rem"}=r,[O,N]=V.useState(E),F=kRe();Um(()=>{F||a==null||a()},[F]),Um(()=>{N(E)},[E]);const H=()=>N(null),z=()=>N(E),G=()=>{F&&l()};V.useEffect(()=>{F&&d&&l()},[F,d,l]),V_e(G,O);const ee=V.useMemo(()=>({pointerEvents:"auto",maxWidth:560,minWidth:300,margin:R,...v}),[v,R]),J=V.useMemo(()=>rPe(p),[p]);return D.jsx(Dh.div,{layout:!0,className:"chakra-toast",variants:b,initial:"initial",animate:"animate",exit:"exit",onHoverStart:H,onHoverEnd:z,custom:{position:p},style:J,children:D.jsx(Ot.div,{role:"status","aria-atomic":"true",className:"chakra-toast__inner",__css:ee,children:xc(s,{id:t,onClose:G})})})});jZ.displayName="ToastComponent";function qt(r){return V.forwardRef(r)}var FM,$$;function yPe(){if($$)return FM;$$=1;var r=typeof Element<"u",t=typeof Map=="function",s=typeof Set=="function",a=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function l(d,p){if(d===p)return!0;if(d&&p&&typeof d=="object"&&typeof p=="object"){if(d.constructor!==p.constructor)return!1;var E,v,b;if(Array.isArray(d)){if(E=d.length,E!=p.length)return!1;for(v=E;v--!==0;)if(!l(d[v],p[v]))return!1;return!0}var R;if(t&&d instanceof Map&&p instanceof Map){if(d.size!==p.size)return!1;for(R=d.entries();!(v=R.next()).done;)if(!p.has(v.value[0]))return!1;for(R=d.entries();!(v=R.next()).done;)if(!l(v.value[1],p.get(v.value[0])))return!1;return!0}if(s&&d instanceof Set&&p instanceof Set){if(d.size!==p.size)return!1;for(R=d.entries();!(v=R.next()).done;)if(!p.has(v.value[0]))return!1;return!0}if(a&&ArrayBuffer.isView(d)&&ArrayBuffer.isView(p)){if(E=d.length,E!=p.length)return!1;for(v=E;v--!==0;)if(d[v]!==p[v])return!1;return!0}if(d.constructor===RegExp)return d.source===p.source&&d.flags===p.flags;if(d.valueOf!==Object.prototype.valueOf&&typeof d.valueOf=="function"&&typeof p.valueOf=="function")return d.valueOf()===p.valueOf();if(d.toString!==Object.prototype.toString&&typeof d.toString=="function"&&typeof p.toString=="function")return d.toString()===p.toString();if(b=Object.keys(d),E=b.length,E!==Object.keys(p).length)return!1;for(v=E;v--!==0;)if(!Object.prototype.hasOwnProperty.call(p,b[v]))return!1;if(r&&d instanceof Element)return!1;for(v=E;v--!==0;)if(!((b[v]==="_owner"||b[v]==="__v"||b[v]==="__o")&&d.$$typeof)&&!l(d[b[v]],p[b[v]]))return!1;return!0}return d!==d&&p!==p}return FM=function(p,E){try{return l(p,E)}catch(v){if((v.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw v}},FM}var vPe=yPe();const SPe=BS(vPe);function qS(){const r=V.useContext(TS);if(!r)throw Error("useTheme: `theme` is undefined. Seems you forgot to wrap your app in `<ChakraProvider />` or `<ThemeProvider />`");return r}function BZ(){const r=NN(),t=qS();return{...r,theme:t}}function TPe(r,t,s){if(t==null)return t;const a=l=>{var d,p;return(p=(d=r.__cssMap)==null?void 0:d[l])==null?void 0:p.value};return a(t)??a(s)??s}function bPe(r,t,s){const a=Array.isArray(t)?t:[t],l=Array.isArray(s)?s:[s];return d=>{const p=l.filter(Boolean),E=a.map((v,b)=>{const R=`${r}.${v}`;return TPe(d,R,p[b]??v)});return Array.isArray(t)?E:E[0]}}function WZ(r,t={}){const{styleConfig:s,...a}=t,{theme:l,colorMode:d}=BZ(),p=r?gJ(l,`components.${r}`):void 0,E=s||p,v=gh({theme:l,colorMode:d},(E==null?void 0:E.defaultProps)??{},vN(sR(a,["children"])),(R,O)=>R?void 0:O),b=V.useRef({});if(E){const O=qEe(E)(v);SPe(b.current,O)||(b.current=O)}return b.current}function fu(r,t={}){return WZ(r,t)}function jc(r,t={}){return WZ(r,t)}const Y$={path:D.jsxs("g",{stroke:"currentColor",strokeWidth:"1.5",children:[D.jsx("path",{strokeLinecap:"round",fill:"none",d:"M9,9a3,3,0,1,1,4,2.829,1.5,1.5,0,0,0-1,1.415V14.25"}),D.jsx("path",{fill:"currentColor",strokeLinecap:"round",d:"M12,17.25a.375.375,0,1,0,.375.375A.375.375,0,0,0,12,17.25h0"}),D.jsx("circle",{fill:"none",strokeMiterlimit:"10",cx:"12",cy:"12",r:"11.25"})]}),viewBox:"0 0 24 24"},Xm=qt((r,t)=>{const{as:s,viewBox:a,color:l="currentColor",focusable:d=!1,children:p,className:E,__css:v,...b}=r,R=dn("chakra-icon",E),O=fu("Icon",r),N={w:"1em",h:"1em",display:"inline-block",lineHeight:"1em",flexShrink:0,color:l,...v,...O},F={ref:t,focusable:d,className:R,__css:N},H=a??Y$.viewBox;if(s&&typeof s!="string")return D.jsx(Ot.svg,{as:s,...F,...b});const z=p??Y$.path;return D.jsx(Ot.svg,{verticalAlign:"middle",viewBox:H,...F,...b,children:z})});Xm.displayName="Icon";function wPe(r){return D.jsx(Xm,{viewBox:"0 0 24 24",...r,children:D.jsx("path",{fill:"currentColor",d:"M12,0A12,12,0,1,0,24,12,12.014,12.014,0,0,0,12,0Zm6.927,8.2-6.845,9.289a1.011,1.011,0,0,1-1.43.188L5.764,13.769a1,1,0,1,1,1.25-1.562l4.076,3.261,6.227-8.451A1,1,0,1,1,18.927,8.2Z"})})}function RPe(r){return D.jsx(Xm,{viewBox:"0 0 24 24",...r,children:D.jsx("path",{fill:"currentColor",d:"M12,0A12,12,0,1,0,24,12,12.013,12.013,0,0,0,12,0Zm.25,5a1.5,1.5,0,1,1-1.5,1.5A1.5,1.5,0,0,1,12.25,5ZM14.5,18.5h-4a1,1,0,0,1,0-2h.75a.25.25,0,0,0,.25-.25v-4.5a.25.25,0,0,0-.25-.25H10.5a1,1,0,0,1,0-2h1a2,2,0,0,1,2,2v4.75a.25.25,0,0,0,.25.25h.75a1,1,0,1,1,0,2Z"})})}function X$(r){return D.jsx(Xm,{viewBox:"0 0 24 24",...r,children:D.jsx("path",{fill:"currentColor",d:"M11.983,0a12.206,12.206,0,0,0-8.51,3.653A11.8,11.8,0,0,0,0,12.207,11.779,11.779,0,0,0,11.8,24h.214A12.111,12.111,0,0,0,24,11.791h0A11.766,11.766,0,0,0,11.983,0ZM10.5,16.542a1.476,1.476,0,0,1,1.449-1.53h.027a1.527,1.527,0,0,1,1.523,1.47,1.475,1.475,0,0,1-1.449,1.53h-.027A1.529,1.529,0,0,1,10.5,16.542ZM11,12.5v-6a1,1,0,0,1,2,0v6a1,1,0,1,1-2,0Z"})})}const CPe=lR({"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}}),$S=qt((r,t)=>{const s=fu("Spinner",r),{label:a="Loading...",thickness:l="2px",speed:d="0.45s",emptyColor:p="transparent",className:E,...v}=zi(r),b=dn("chakra-spinner",E),R={display:"inline-block",borderColor:"currentColor",borderStyle:"solid",borderRadius:"99999px",borderWidth:l,borderBottomColor:p,borderLeftColor:p,animation:`${CPe} ${d} linear infinite`,...s};return D.jsx(Ot.div,{ref:t,__css:R,className:b,...v,children:a&&D.jsx(Ot.span,{srOnly:!0,children:a})})});$S.displayName="Spinner";const[IPe,eF]=Mi({name:"AlertContext",hookName:"useAlertContext",providerName:"<Alert />"}),[APe,tF]=Mi({name:"AlertStylesContext",hookName:"useAlertStyles",providerName:"<Alert />"}),GZ={info:{icon:RPe,colorScheme:"blue"},warning:{icon:X$,colorScheme:"orange"},success:{icon:wPe,colorScheme:"green"},error:{icon:X$,colorScheme:"red"},loading:{icon:$S,colorScheme:"blue"}};function OPe(r){return GZ[r].colorScheme}function PPe(r){return GZ[r].icon}const UN=qt(function(t,s){const{status:a="info",addRole:l=!0,...d}=zi(t),p=t.colorScheme??OPe(a),E=jc("Alert",{...t,colorScheme:p}),v={width:"100%",display:"flex",alignItems:"center",position:"relative",overflow:"hidden",...E.container};return D.jsx(IPe,{value:{status:a},children:D.jsx(APe,{value:E,children:D.jsx(Ot.div,{"data-status":a,role:l?"alert":void 0,ref:s,...d,className:dn("chakra-alert",t.className),__css:v})})})});UN.displayName="Alert";function VN(r){const{status:t}=eF(),s=PPe(t),a=tF(),l=t==="loading"?a.spinner:a.icon;return D.jsx(Ot.span,{display:"inherit","data-status":t,...r,className:dn("chakra-alert__icon",r.className),__css:l,children:r.children||D.jsx(s,{h:"100%",w:"100%"})})}VN.displayName="AlertIcon";const zZ=qt(function(t,s){const a=tF(),{status:l}=eF();return D.jsx(Ot.div,{ref:s,"data-status":l,...t,className:dn("chakra-alert__title",t.className),__css:a.title})});zZ.displayName="AlertTitle";const HZ=qt(function(t,s){const{status:a}=eF(),l=tF(),d={display:"inline",...l.description};return D.jsx(Ot.div,{ref:s,"data-status":a,...t,className:dn("chakra-alert__desc",t.className),__css:d})});HZ.displayName="AlertDescription";function NPe(r){return D.jsx(Xm,{focusable:"false","aria-hidden":!0,...r,children:D.jsx("path",{fill:"currentColor",d:"M.439,21.44a1.5,1.5,0,0,0,2.122,2.121L11.823,14.3a.25.25,0,0,1,.354,0l9.262,9.263a1.5,1.5,0,1,0,2.122-2.121L14.3,12.177a.25.25,0,0,1,0-.354l9.263-9.262A1.5,1.5,0,0,0,21.439.44L12.177,9.7a.25.25,0,0,1-.354,0L2.561.44A1.5,1.5,0,0,0,.439,2.561L9.7,11.823a.25.25,0,0,1,0,.354Z"})})}const nF=qt(function(t,s){const a=fu("CloseButton",t),{children:l,isDisabled:d,__css:p,...E}=zi(t),v={outline:0,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0};return D.jsx(Ot.button,{type:"button","aria-label":"Close",ref:s,disabled:d,__css:{...v,...a,...p},...E,children:l||D.jsx(NPe,{width:"1em",height:"1em"})})});nF.displayName="CloseButton";const kPe=r=>{const{status:t,variant:s="solid",id:a,title:l,isClosable:d,onClose:p,description:E,colorScheme:v,icon:b}=r,R=a?{root:`toast-${a}`,title:`toast-${a}-title`,description:`toast-${a}-description`}:void 0;return D.jsxs(UN,{addRole:!1,status:t,variant:s,id:R==null?void 0:R.root,alignItems:"start",borderRadius:"md",boxShadow:"lg",paddingEnd:8,textAlign:"start",width:"auto",colorScheme:v,children:[D.jsx(VN,{children:b}),D.jsxs(Ot.div,{flex:"1",maxWidth:"100%",children:[l&&D.jsx(zZ,{id:R==null?void 0:R.title,children:l}),E&&D.jsx(HZ,{id:R==null?void 0:R.description,display:"block",children:E})]}),d&&D.jsx(nF,{size:"sm",onClick:p,position:"absolute",insetEnd:1,top:1})]})};function KZ(r={}){const{render:t,toastComponent:s=kPe}=r;return l=>typeof t=="function"?t({...l,...r}):D.jsx(s,{...l,...r})}const DPe={top:[],"top-left":[],"top-right":[],"bottom-left":[],bottom:[],"bottom-right":[]},fh=LPe(DPe);function LPe(r){let t=r;const s=new Set,a=l=>{t=l(t),s.forEach(d=>d())};return{getState:()=>t,subscribe:l=>(s.add(l),()=>{a(()=>r),s.delete(l)}),removeToast:(l,d)=>{a(p=>({...p,[d]:p[d].filter(E=>E.id!=l)}))},notify:(l,d)=>{const p=xPe(l,d),{position:E,id:v}=p;return a(b=>{const O=E.includes("top")?[p,...b[E]??[]]:[...b[E]??[],p];return{...b,[E]:O}}),v},update:(l,d)=>{l&&a(p=>{const E={...p},{position:v,index:b}=H$(E,l);return v&&b!==-1&&(E[v][b]={...E[v][b],...d,message:KZ(d)}),E})},closeAll:({positions:l}={})=>{a(d=>(l??["bottom","bottom-right","bottom-left","top","top-left","top-right"]).reduce((v,b)=>(v[b]=d[b].map(R=>({...R,requestClose:!0})),v),{...d}))},close:l=>{a(d=>{const p=FZ(d,l);return p?{...d,[p]:d[p].map(E=>E.id==l?{...E,requestClose:!0}:E)}:d})},isActive:l=>!!H$(fh.getState(),l).position}}let J$=0;function xPe(r,t={}){J$+=1;const s=t.id??J$,a=t.position??"bottom";return{id:s,message:r,position:a,duration:t.duration,onCloseComplete:t.onCloseComplete,onRequestRemove:()=>fh.removeToast(String(s),a),status:t.status,requestClose:!1,containerStyle:t.containerStyle}}var qZ=aJ();const[$Z,MPe]=Mi({strict:!1,name:"PortalContext"}),rF="chakra-portal",UPe=".chakra-portal",VPe=r=>D.jsx("div",{className:"chakra-portal-zIndex",style:{position:"absolute",zIndex:r.zIndex,top:0,left:0,right:0},children:r.children}),FPe=r=>{const{appendToParentPortal:t,children:s}=r,[a,l]=V.useState(null),d=V.useRef(null),[,p]=V.useState({});V.useEffect(()=>p({}),[]);const E=MPe(),v=CRe();Nm(()=>{if(!a)return;const R=a.ownerDocument,O=t?E??R.body:R.body;if(!O)return;d.current=R.createElement("div"),d.current.className=rF,O.appendChild(d.current),p({});const N=d.current;return()=>{O.contains(N)&&O.removeChild(N)}},[a]);const b=v!=null&&v.zIndex?D.jsx(VPe,{zIndex:v==null?void 0:v.zIndex,children:s}):s;return d.current?qZ.createPortal(D.jsx($Z,{value:d.current,children:b}),d.current):D.jsx("span",{ref:R=>{R&&l(R)}})},jPe=r=>{const{children:t,containerRef:s,appendToParentPortal:a}=r,l=s.current,d=l??(typeof window<"u"?document.body:void 0),p=V.useMemo(()=>{const v=l==null?void 0:l.ownerDocument.createElement("div");return v&&(v.className=rF),v},[l]),[,E]=V.useState({});return Nm(()=>E({}),[]),Nm(()=>{if(!(!p||!d))return d.appendChild(p),()=>{d.removeChild(p)}},[p,d]),d&&p?qZ.createPortal(D.jsx($Z,{value:a?p:null,children:t}),p):null};function pu(r){const t={appendToParentPortal:!0,...r},{containerRef:s,...a}=t;return s?D.jsx(jPe,{containerRef:s,...a}):D.jsx(FPe,{...a})}pu.className=rF;pu.selector=UPe;pu.displayName="Portal";const[BPe,WPe]=Mi({name:"ToastOptionsContext",strict:!1}),GPe=r=>{const t=V.useSyncExternalStore(fh.subscribe,fh.getState,fh.getState),{motionVariants:s,component:a=jZ,portalProps:l,animatePresenceProps:d}=r,E=Object.keys(t).map(v=>{const b=t[v];return D.jsx("div",{role:"region","aria-live":"polite","aria-label":`Notifications-${v}`,id:`chakra-toast-manager-${v}`,style:iPe(v),children:D.jsx(zS,{...d,initial:!1,children:b.map(R=>D.jsx(a,{motionVariants:s,...R},R.id))})},v)});return D.jsx(pu,{...l,children:E})},zPe=r=>function({children:s,theme:a=r,toastOptions:l,...d}){return D.jsxs(IRe,{theme:a,...d,children:[D.jsx(BPe,{value:l==null?void 0:l.defaultOptions,children:s}),D.jsx(GPe,{...l})]})},FN=zPe(ywe);function Q$(r){return r.sort((t,s)=>{const a=t.compareDocumentPosition(s);if(a&Node.DOCUMENT_POSITION_FOLLOWING||a&Node.DOCUMENT_POSITION_CONTAINED_BY)return-1;if(a&Node.DOCUMENT_POSITION_PRECEDING||a&Node.DOCUMENT_POSITION_CONTAINS)return 1;if(a&Node.DOCUMENT_POSITION_DISCONNECTED||a&Node.DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC)throw Error("Cannot sort the given nodes.");return 0})}const HPe=r=>typeof r=="object"&&"nodeType"in r&&r.nodeType===Node.ELEMENT_NODE;function Z$(r,t,s){let a=r+1;return s&&a>=t&&(a=0),a}function e7(r,t,s){let a=r-1;return s&&a<0&&(a=t),a}const jM=typeof window<"u"?V.useLayoutEffect:V.useEffect,t7=r=>r;var KPe=Object.defineProperty,qPe=(r,t,s)=>t in r?KPe(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,ps=(r,t,s)=>(qPe(r,typeof t!="symbol"?t+"":t,s),s);class $Pe{constructor(){ps(this,"descendants",new Map),ps(this,"register",t=>{if(t!=null)return HPe(t)?this.registerNode(t):s=>{this.registerNode(s,t)}}),ps(this,"unregister",t=>{this.descendants.delete(t);const s=Q$(Array.from(this.descendants.keys()));this.assignIndex(s)}),ps(this,"destroy",()=>{this.descendants.clear()}),ps(this,"assignIndex",t=>{this.descendants.forEach(s=>{const a=t.indexOf(s.node);s.index=a,s.node.dataset.index=s.index.toString()})}),ps(this,"count",()=>this.descendants.size),ps(this,"enabledCount",()=>this.enabledValues().length),ps(this,"values",()=>Array.from(this.descendants.values()).sort((s,a)=>s.index-a.index)),ps(this,"enabledValues",()=>this.values().filter(t=>!t.disabled)),ps(this,"item",t=>{if(this.count()!==0)return this.values()[t]}),ps(this,"enabledItem",t=>{if(this.enabledCount()!==0)return this.enabledValues()[t]}),ps(this,"first",()=>this.item(0)),ps(this,"firstEnabled",()=>this.enabledItem(0)),ps(this,"last",()=>this.item(this.descendants.size-1)),ps(this,"lastEnabled",()=>{const t=this.enabledValues().length-1;return this.enabledItem(t)}),ps(this,"indexOf",t=>{var s;return t?((s=this.descendants.get(t))==null?void 0:s.index)??-1:-1}),ps(this,"enabledIndexOf",t=>t==null?-1:this.enabledValues().findIndex(s=>s.node.isSameNode(t))),ps(this,"next",(t,s=!0)=>{const a=Z$(t,this.count(),s);return this.item(a)}),ps(this,"nextEnabled",(t,s=!0)=>{const a=this.item(t);if(!a)return;const l=this.enabledIndexOf(a.node),d=Z$(l,this.enabledCount(),s);return this.enabledItem(d)}),ps(this,"prev",(t,s=!0)=>{const a=e7(t,this.count()-1,s);return this.item(a)}),ps(this,"prevEnabled",(t,s=!0)=>{const a=this.item(t);if(!a)return;const l=this.enabledIndexOf(a.node),d=e7(l,this.enabledCount()-1,s);return this.enabledItem(d)}),ps(this,"registerNode",(t,s)=>{if(!t||this.descendants.has(t))return;const a=Array.from(this.descendants.keys()).concat(t),l=Q$(a);s!=null&&s.disabled&&(s.disabled=!!s.disabled);const d={node:t,index:-1,...s};this.descendants.set(t,d),this.assignIndex(l)})}}function YZ(){const[r,t]=Mi({name:"DescendantsProvider",errorMessage:"useDescendantsContext must be used within DescendantsProvider"});return[r,t,()=>{const l=V.useRef(new $Pe);return jM(()=>()=>l.current.destroy()),l.current},l=>{const d=t(),[p,E]=V.useState(-1),v=V.useRef(null);jM(()=>()=>{v.current&&d.unregister(v.current)},[]),jM(()=>{if(!v.current)return;const R=Number(v.current.dataset.index);p!=R&&!Number.isNaN(R)&&E(R)});const b=t7(l?d.register(l):d.register);return{descendants:d,index:p,enabledIndex:d.enabledIndexOf(v.current),register:Gi(b,v)}}]}const n7={easeIn:[.4,0,1,1],easeOut:[0,0,.2,1]},W_={enter:{duration:.2,ease:n7.easeOut},exit:{duration:.1,ease:n7.easeIn}},G_={enter:(r,t)=>({...r,delay:typeof t=="number"?t:t==null?void 0:t.enter}),exit:(r,t)=>({...r,delay:typeof t=="number"?t:t==null?void 0:t.exit})},XZ=qt(function(r,t){const{ratio:s=4/3,children:a,className:l,...d}=r,p=V.Children.only(a),E=dn("chakra-aspect-ratio",l);return D.jsx(Ot.div,{ref:t,position:"relative",className:E,_before:{height:0,content:'""',display:"block",paddingBottom:SN(s,v=>`${1/v*100}%`)},__css:{"& > *:not(style)":{overflow:"hidden",position:"absolute",top:"0",right:"0",bottom:"0",left:"0",display:"flex",justifyContent:"center",alignItems:"center",width:"100%",height:"100%"},"& > img, & > video":{objectFit:"cover"}},...d,children:p})});XZ.displayName="AspectRatio";const[YPe,XPe]=Mi({name:"AvatarStylesContext",hookName:"useAvatarStyles",providerName:"<Avatar/>"});function JPe(r){const t=r.trim().split(" "),s=t[0]??"",a=t.length>1?t[t.length-1]:"";return s&&a?`${s.charAt(0)}${a.charAt(0)}`:s.charAt(0)}function JZ(r){const{name:t,getInitials:s,...a}=r,l=XPe();return D.jsx(Ot.div,{role:"img","aria-label":t,...a,__css:l.label,children:t?s==null?void 0:s(t):null})}JZ.displayName="AvatarName";const QZ=r=>D.jsxs(Ot.svg,{viewBox:"0 0 128 128",color:"#fff",width:"100%",height:"100%",className:"chakra-avatar__svg",...r,children:[D.jsx("path",{fill:"currentColor",d:"M103,102.1388 C93.094,111.92 79.3504,118 64.1638,118 C48.8056,118 34.9294,111.768 25,101.7892 L25,95.2 C25,86.8096 31.981,80 40.6,80 L87.4,80 C96.019,80 103,86.8096 103,95.2 L103,102.1388 Z"}),D.jsx("path",{fill:"currentColor",d:"M63.9961647,24 C51.2938136,24 41,34.2938136 41,46.9961647 C41,59.7061864 51.2938136,70 63.9961647,70 C76.6985159,70 87,59.7061864 87,46.9961647 C87,34.2938136 76.6985159,24 63.9961647,24"})]});function ZZ(r){const{loading:t,src:s,srcSet:a,onLoad:l,onError:d,crossOrigin:p,sizes:E,ignoreFallback:v}=r,[b,R]=V.useState("pending");V.useEffect(()=>{R(s?"loading":"pending")},[s]);const O=V.useRef(null),N=V.useCallback(()=>{if(!s)return;F();const H=new Image;H.src=s,p&&(H.crossOrigin=p),a&&(H.srcset=a),E&&(H.sizes=E),t&&(H.loading=t),H.onload=z=>{F(),R("loaded"),l==null||l(z)},H.onerror=z=>{F(),R("failed"),d==null||d(z)},O.current=H},[s,p,a,E,l,d,t]),F=()=>{O.current&&(O.current.onload=null,O.current.onerror=null,O.current=null)};return Nm(()=>{if(!v)return b==="loading"&&N(),()=>{F()}},[b,N,v]),v?"loaded":b}const QPe=(r,t)=>r!=="loaded"&&t==="beforeLoadOrError"||r==="failed"&&t==="onError";function eee(r){const{src:t,srcSet:s,onError:a,onLoad:l,getInitials:d,name:p,borderRadius:E,loading:v,iconLabel:b,icon:R=D.jsx(QZ,{}),ignoreFallback:O,referrerPolicy:N,crossOrigin:F}=r,z=ZZ({src:t,onError:a,crossOrigin:F,ignoreFallback:O})==="loaded";return!t||!z?p?D.jsx(JZ,{className:"chakra-avatar__initials",getInitials:d,name:p}):V.cloneElement(R,{role:"img","aria-label":b}):D.jsx(Ot.img,{src:t,srcSet:s,alt:p??b,onLoad:l,referrerPolicy:N,crossOrigin:F??void 0,className:"chakra-avatar__img",loading:v,__css:{width:"100%",height:"100%",objectFit:"cover",borderRadius:E}})}eee.displayName="AvatarImage";const ZPe={display:"inline-flex",alignItems:"center",justifyContent:"center",textAlign:"center",textTransform:"uppercase",fontWeight:"medium",position:"relative",flexShrink:0},Oh=qt((r,t)=>{const s=jc("Avatar",r),[a,l]=V.useState(!1),{src:d,srcSet:p,name:E,showBorder:v,borderRadius:b="full",onError:R,onLoad:O,getInitials:N=JPe,icon:F=D.jsx(QZ,{}),iconLabel:H=" avatar",loading:z,children:G,borderColor:ee,ignoreFallback:J,crossOrigin:re,referrerPolicy:de,...se}=zi(r),ye={borderRadius:b,borderWidth:v?"2px":void 0,...ZPe,...s.container};return ee&&(ye.borderColor=ee),D.jsx(Ot.span,{ref:t,...se,className:dn("chakra-avatar",r.className),"data-loaded":zn(a),__css:ye,children:D.jsxs(YPe,{value:s,children:[D.jsx(eee,{src:d,srcSet:p,loading:z,onLoad:Yn(O,()=>{l(!0)}),onError:R,getInitials:N,name:E,borderRadius:b,icon:F,iconLabel:H,ignoreFallback:J,crossOrigin:re,referrerPolicy:de}),G]})})});Oh.displayName="Avatar";const tee=qt(function(t,s){const a=fu("Badge",t),{className:l,...d}=zi(t);return D.jsx(Ot.span,{ref:s,className:dn("chakra-badge",t.className),...d,__css:{display:"inline-block",whiteSpace:"nowrap",verticalAlign:"middle",...a}})});tee.displayName="Badge";const Gt=Ot("div");Gt.displayName="Box";const[R6e,eNe]=Mi({strict:!1,name:"ButtonGroupContext"});function Qb(r){const{children:t,className:s,...a}=r,l=V.isValidElement(t)?V.cloneElement(t,{"aria-hidden":!0,focusable:!1}):t,d=dn("chakra-button__icon",s);return D.jsx(Ot.span,{display:"inline-flex",alignSelf:"center",flexShrink:0,...a,className:d,children:l})}Qb.displayName="ButtonIcon";function Z2(r){const{label:t,placement:s,spacing:a="0.5rem",children:l=D.jsx($S,{color:"currentColor",width:"1em",height:"1em"}),className:d,__css:p,...E}=r,v=dn("chakra-button__spinner",d),b=s==="start"?"marginEnd":"marginStart",R=V.useMemo(()=>({display:"flex",alignItems:"center",position:t?"relative":"absolute",[b]:t?a:0,fontSize:"1em",lineHeight:"normal",...p}),[p,t,b,a]);return D.jsx(Ot.div,{className:v,...E,__css:R,children:l})}Z2.displayName="ButtonSpinner";function tNe(r){const[t,s]=V.useState(!r);return{ref:V.useCallback(d=>{d&&s(d.tagName==="BUTTON")},[]),type:t?"button":void 0}}const qa=qt((r,t)=>{const s=eNe(),a=fu("Button",{...s,...r}),{isDisabled:l=s==null?void 0:s.isDisabled,isLoading:d,isActive:p,children:E,leftIcon:v,rightIcon:b,loadingText:R,iconSpacing:O="0.5rem",type:N,spinner:F,spinnerPlacement:H="start",className:z,as:G,shouldWrapChildren:ee,...J}=zi(r),re=V.useMemo(()=>{const Q={...a==null?void 0:a._focus,zIndex:1};return{display:"inline-flex",appearance:"none",alignItems:"center",justifyContent:"center",userSelect:"none",position:"relative",whiteSpace:"nowrap",verticalAlign:"middle",outline:"none",...a,...!!s&&{_focus:Q}}},[a,s]),{ref:de,type:se}=tNe(G),ye={rightIcon:b,leftIcon:v,iconSpacing:O,children:E,shouldWrapChildren:ee};return D.jsxs(Ot.button,{disabled:l||d,ref:U_e(t,de),as:G,type:N??se,"data-active":zn(p),"data-loading":zn(d),__css:re,className:dn("chakra-button",z),...J,children:[d&&H==="start"&&D.jsx(Z2,{className:"chakra-button__spinner--start",label:R,placement:"start",spacing:O,children:F}),d?R||D.jsx(Ot.span,{opacity:0,children:D.jsx(r7,{...ye})}):D.jsx(r7,{...ye}),d&&H==="end"&&D.jsx(Z2,{className:"chakra-button__spinner--end",label:R,placement:"end",spacing:O,children:F})]})});qa.displayName="Button";function r7(r){const{leftIcon:t,rightIcon:s,children:a,iconSpacing:l,shouldWrapChildren:d}=r;return d?D.jsxs("span",{style:{display:"contents"},children:[t&&D.jsx(Qb,{marginEnd:l,children:t}),a,s&&D.jsx(Qb,{marginStart:l,children:s})]}):D.jsxs(D.Fragment,{children:[t&&D.jsx(Qb,{marginEnd:l,children:t}),a,s&&D.jsx(Qb,{marginStart:l,children:s})]})}const dl=qt((r,t)=>{const{icon:s,children:a,isRound:l,"aria-label":d,...p}=r,E=s||a,v=V.isValidElement(E)?V.cloneElement(E,{"aria-hidden":!0,focusable:!1}):null;return D.jsx(qa,{px:"0",py:"0",borderRadius:l?"full":void 0,ref:t,"aria-label":d,...p,children:v})});dl.displayName="IconButton";const nee=Ot("div",{baseStyle:{display:"flex",alignItems:"center",justifyContent:"center"}});nee.displayName="Center";const nNe={horizontal:{insetStart:"50%",transform:"translateX(-50%)"},vertical:{top:"50%",transform:"translateY(-50%)"},both:{insetStart:"50%",top:"50%",transform:"translate(-50%, -50%)"}};qt(function(t,s){const{axis:a="both",...l}=t;return D.jsx(Ot.div,{ref:s,__css:nNe[a],...l,position:"absolute"})});var rNe=()=>typeof document<"u",i7=!1,mR=null,Y_=!1,eU=!1,tU=new Set;function iF(r,t){tU.forEach(s=>s(r,t))}var iNe=typeof window<"u"&&window.navigator!=null?/^Mac/.test(window.navigator.platform):!1;function sNe(r){return!(r.metaKey||!iNe&&r.altKey||r.ctrlKey||r.key==="Control"||r.key==="Shift"||r.key==="Meta")}function s7(r){Y_=!0,sNe(r)&&(mR="keyboard",iF("keyboard",r))}function Nv(r){if(mR="pointer",r.type==="mousedown"||r.type==="pointerdown"){Y_=!0;const t=r.composedPath?r.composedPath()[0]:r.target;let s=!1;try{s=t.matches(":focus-visible")}catch{}if(s)return;iF("pointer",r)}}function oNe(r){return r.mozInputSource===0&&r.isTrusted?!0:r.detail===0&&!r.pointerType}function aNe(r){oNe(r)&&(Y_=!0,mR="virtual")}function cNe(r){r.target===window||r.target===document||r.target instanceof Element&&r.target.hasAttribute("tabindex")||(!Y_&&!eU&&(mR="virtual",iF("virtual",r)),Y_=!1,eU=!1)}function lNe(){Y_=!1,eU=!0}function o7(){return mR!=="pointer"}function uNe(){if(!rNe()||i7)return;const{focus:r}=HTMLElement.prototype;HTMLElement.prototype.focus=function(...s){Y_=!0,r.apply(this,s)},document.addEventListener("keydown",s7,!0),document.addEventListener("keyup",s7,!0),document.addEventListener("click",aNe,!0),window.addEventListener("focus",cNe,!0),window.addEventListener("blur",lNe,!1),typeof PointerEvent<"u"?(document.addEventListener("pointerdown",Nv,!0),document.addEventListener("pointermove",Nv,!0),document.addEventListener("pointerup",Nv,!0)):(document.addEventListener("mousedown",Nv,!0),document.addEventListener("mousemove",Nv,!0),document.addEventListener("mouseup",Nv,!0)),i7=!0}function dNe(r){uNe(),r(o7());const t=()=>r(o7());return tU.add(t),()=>{tU.delete(t)}}const[hNe,ree]=Mi({name:"FormControlStylesContext",errorMessage:`useFormControlStyles returned is 'undefined'. Seems you forgot to wrap the components in "<FormControl />" `}),[fNe,YS]=Mi({strict:!1,name:"FormControlContext"});function pNe(r){const{id:t,isRequired:s,isInvalid:a,isDisabled:l,isReadOnly:d,...p}=r,E=V.useId(),v=t||`field-${E}`,b=`${v}-label`,R=`${v}-feedback`,O=`${v}-helptext`,[N,F]=V.useState(!1),[H,z]=V.useState(!1),[G,ee]=V.useState(!1),J=V.useCallback((Q={},ne=null)=>({id:O,...Q,ref:Gi(ne,oe=>{oe&&z(!0)})}),[O]),re=V.useCallback((Q={},ne=null)=>({...Q,ref:ne,"data-focus":zn(G),"data-disabled":zn(l),"data-invalid":zn(a),"data-readonly":zn(d),id:Q.id!==void 0?Q.id:b,htmlFor:Q.htmlFor!==void 0?Q.htmlFor:v}),[v,l,G,a,d,b]),de=V.useCallback((Q={},ne=null)=>({id:R,...Q,ref:Gi(ne,oe=>{oe&&F(!0)}),"aria-live":"polite"}),[R]),se=V.useCallback((Q={},ne=null)=>({...Q,...p,ref:ne,role:"group","data-focus":zn(G),"data-disabled":zn(l),"data-invalid":zn(a),"data-readonly":zn(d)}),[p,l,G,a,d]),ye=V.useCallback((Q={},ne=null)=>({...Q,ref:ne,role:"presentation","aria-hidden":!0,children:Q.children||"*"}),[]);return{isRequired:!!s,isInvalid:!!a,isReadOnly:!!d,isDisabled:!!l,isFocused:!!G,onFocus:()=>ee(!0),onBlur:()=>ee(!1),hasFeedbackText:N,setHasFeedbackText:F,hasHelpText:H,setHasHelpText:z,id:v,labelId:b,feedbackId:R,helpTextId:O,htmlProps:p,getHelpTextProps:J,getErrorMessageProps:de,getRootProps:se,getLabelProps:re,getRequiredIndicatorProps:ye}}const gs=qt(function(t,s){const a=jc("Form",t),l=zi(t),{getRootProps:d,htmlProps:p,...E}=pNe(l),v=dn("chakra-form-control",t.className);return D.jsx(fNe,{value:E,children:D.jsx(hNe,{value:a,children:D.jsx(Ot.div,{...d({},s),className:v,__css:a.container})})})});gs.displayName="FormControl";const mNe=qt(function(t,s){const a=YS(),l=ree(),d=dn("chakra-form__helper-text",t.className);return D.jsx(Ot.div,{...a==null?void 0:a.getHelpTextProps(t,s),__css:l.helperText,className:d})});mNe.displayName="FormHelperText";function iee(r){const{isDisabled:t,isInvalid:s,isReadOnly:a,isRequired:l,...d}=see(r);return{...d,disabled:t,readOnly:a,required:l,"aria-invalid":nS(s),"aria-required":nS(l),"aria-readonly":nS(a)}}function see(r){const t=YS(),{id:s,disabled:a,readOnly:l,required:d,isRequired:p,isInvalid:E,isReadOnly:v,isDisabled:b,onFocus:R,onBlur:O,...N}=r,F=r["aria-describedby"]?[r["aria-describedby"]]:[];return t!=null&&t.hasFeedbackText&&(t!=null&&t.isInvalid)&&F.push(t.feedbackId),t!=null&&t.hasHelpText&&F.push(t.helpTextId),{...N,"aria-describedby":F.join(" ")||void 0,id:s??(t==null?void 0:t.id),isDisabled:a??b??(t==null?void 0:t.isDisabled),isReadOnly:l??v??(t==null?void 0:t.isReadOnly),isRequired:d??p??(t==null?void 0:t.isRequired),isInvalid:E??(t==null?void 0:t.isInvalid),onFocus:Yn(t==null?void 0:t.onFocus,R),onBlur:Yn(t==null?void 0:t.onBlur,O)}}const gNe={border:"0",clip:"rect(0, 0, 0, 0)",height:"1px",width:"1px",margin:"-1px",padding:"0",overflow:"hidden",whiteSpace:"nowrap",position:"absolute"};function _Ne(r={}){const t=see(r),{isDisabled:s,isReadOnly:a,isRequired:l,isInvalid:d,id:p,onBlur:E,onFocus:v,"aria-describedby":b}=t,{defaultChecked:R,isChecked:O,isFocusable:N,onChange:F,isIndeterminate:H,name:z,value:G,tabIndex:ee=void 0,"aria-label":J,"aria-labelledby":re,"aria-invalid":de,...se}=r,ye=sR(se,["isDisabled","isReadOnly","isRequired","isInvalid","id","onBlur","onFocus","aria-describedby"]),Q=Mc(F),ne=Mc(E),oe=Mc(v),[ue,Ee]=V.useState(!1),[fe,le]=V.useState(!1),[Le,pt]=V.useState(!1),[et,Oe]=V.useState(!1);V.useEffect(()=>dNe(Ee),[]);const Ue=V.useRef(null),[Me,it]=V.useState(!0),[Ae,qe]=V.useState(!!R),Ze=O!==void 0,Fe=Ze?O:Ae,lt=V.useCallback(Zt=>{if(a||s){Zt.preventDefault();return}Ze||qe(Fe?Zt.currentTarget.checked:H?!0:Zt.currentTarget.checked),Q==null||Q(Zt)},[a,s,Fe,Ze,H,Q]);Nm(()=>{Ue.current&&(Ue.current.indeterminate=!!H)},[H]),Um(()=>{s&&le(!1)},[s,le]),Nm(()=>{const Zt=Ue.current;if(!(Zt!=null&&Zt.form))return;const Zn=()=>{qe(!!R)};return Zt.form.addEventListener("reset",Zn),()=>{var zt;return(zt=Zt.form)==null?void 0:zt.removeEventListener("reset",Zn)}},[]);const Et=s&&!N,Nt=V.useCallback(Zt=>{Zt.key===" "&&Oe(!0)},[Oe]),$t=V.useCallback(Zt=>{Zt.key===" "&&Oe(!1)},[Oe]);Nm(()=>{if(!Ue.current)return;Ue.current.checked!==Fe&&qe(Ue.current.checked)},[Ue.current]);const xt=V.useCallback((Zt={},Zn=null)=>{const zt=ve=>{fe&&ve.preventDefault(),Oe(!0)};return{...Zt,ref:Zn,"data-active":zn(et),"data-hover":zn(Le),"data-checked":zn(Fe),"data-focus":zn(fe),"data-focus-visible":zn(fe&&ue),"data-indeterminate":zn(H),"data-disabled":zn(s),"data-invalid":zn(d),"data-readonly":zn(a),"aria-hidden":!0,onMouseDown:Yn(Zt.onMouseDown,zt),onMouseUp:Yn(Zt.onMouseUp,()=>Oe(!1)),onMouseEnter:Yn(Zt.onMouseEnter,()=>pt(!0)),onMouseLeave:Yn(Zt.onMouseLeave,()=>pt(!1))}},[et,Fe,s,fe,ue,Le,H,d,a]),En=V.useCallback((Zt={},Zn=null)=>({...Zt,ref:Zn,"data-active":zn(et),"data-hover":zn(Le),"data-checked":zn(Fe),"data-focus":zn(fe),"data-focus-visible":zn(fe&&ue),"data-indeterminate":zn(H),"data-disabled":zn(s),"data-invalid":zn(d),"data-readonly":zn(a)}),[et,Fe,s,fe,ue,Le,H,d,a]),In=V.useCallback((Zt={},Zn=null)=>({...ye,htmlFor:Me?p:void 0,...Zt,ref:Gi(Zn,zt=>{zt&&it(zt.tagName==="LABEL")}),onClick:Yn(Zt.onClick,()=>{var zt;Me||((zt=Ue.current)==null||zt.click(),requestAnimationFrame(()=>{var ve;(ve=Ue.current)==null||ve.focus({preventScroll:!0})}))}),"data-disabled":zn(s),"data-checked":zn(Fe),"data-invalid":zn(d)}),[ye,s,Fe,d,Me,p]),hn=V.useCallback((Zt={},Zn=null)=>({...Zt,ref:Gi(Ue,Zn),type:"checkbox",name:z,value:G,id:p,tabIndex:ee,onChange:Yn(Zt.onChange,lt),onBlur:Yn(Zt.onBlur,ne,()=>le(!1)),onFocus:Yn(Zt.onFocus,oe,()=>le(!0)),onKeyDown:Yn(Zt.onKeyDown,Nt),onKeyUp:Yn(Zt.onKeyUp,$t),required:l,checked:Fe,disabled:Et,readOnly:a,"aria-label":J,"aria-labelledby":re,"aria-invalid":de?!!de:d,"aria-describedby":b,"aria-disabled":s,"aria-checked":H?"mixed":Fe,style:gNe}),[z,G,p,ee,lt,ne,oe,Nt,$t,l,Fe,Et,a,J,re,de,d,b,s,H]),Kn=V.useCallback((Zt={},Zn=null)=>({...Zt,ref:Zn,onMouseDown:Yn(Zt.onMouseDown,ENe),"data-disabled":zn(s),"data-checked":zn(Fe),"data-invalid":zn(d)}),[Fe,s,d]);return{state:{isInvalid:d,isFocused:fe,isChecked:Fe,isActive:et,isHovered:Le,isIndeterminate:H,isDisabled:s,isReadOnly:a,isRequired:l},getRootProps:In,getCheckboxProps:xt,getIndicatorProps:En,getInputProps:hn,getLabelProps:Kn,htmlProps:ye}}function ENe(r){r.preventDefault(),r.stopPropagation()}const mP=qt(function(t,s){const{className:a,centerContent:l,...d}=zi(t),p=fu("Container",t);return D.jsx(Ot.div,{ref:s,className:dn("chakra-container",a),...d,__css:{...p,...l&&{display:"flex",flexDirection:"column",alignItems:"center"}}})});mP.displayName="Container";const Fw=qt(function(t,s){const{borderLeftWidth:a,borderBottomWidth:l,borderTopWidth:d,borderRightWidth:p,borderWidth:E,borderStyle:v,borderColor:b,...R}=fu("Divider",t),{className:O,orientation:N="horizontal",__css:F,...H}=zi(t),z={vertical:{borderLeftWidth:a||p||E||"1px",height:"100%"},horizontal:{borderBottomWidth:l||d||E||"1px",width:"100%"}};return D.jsx(Ot.hr,{ref:s,"aria-orientation":N,...H,__css:{...R,border:"0",borderColor:b,borderStyle:v,...z[N],...F},className:dn("chakra-divider",O)})});Fw.displayName="Divider";const kc=qt(function(t,s){const{direction:a,align:l,justify:d,wrap:p,basis:E,grow:v,shrink:b,...R}=t,O={display:"flex",flexDirection:a,alignItems:l,justifyContent:d,flexWrap:p,flexBasis:E,flexGrow:v,flexShrink:b};return D.jsx(Ot.div,{ref:s,__css:O,...R})});kc.displayName="Flex";function yNe(r,t){if(r==null)return{};var s={};for(var a in r)if({}.hasOwnProperty.call(r,a)){if(t.indexOf(a)!==-1)continue;s[a]=r[a]}return s}var BM={exports:{}},WM,a7;function vNe(){if(a7)return WM;a7=1;var r="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return WM=r,WM}var GM,c7;function SNe(){if(c7)return GM;c7=1;var r=vNe();function t(){}function s(){}return s.resetWarningCache=t,GM=function(){function a(p,E,v,b,R,O){if(O!==r){var N=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw N.name="Invariant Violation",N}}a.isRequired=a;function l(){return a}var d={array:a,bigint:a,bool:a,func:a,number:a,object:a,string:a,symbol:a,any:a,arrayOf:l,element:a,elementType:a,instanceOf:l,node:a,objectOf:l,oneOf:l,oneOfType:l,shape:l,exact:l,checkPropTypes:s,resetWarningCache:t};return d.PropTypes=d,d},GM}var l7;function TNe(){return l7||(l7=1,BM.exports=SNe()()),BM.exports}var bNe=TNe();const xr=BS(bNe);var nU="data-focus-lock",oee="data-focus-lock-disabled",wNe="data-no-focus-lock",RNe="data-autofocus-inside",CNe="data-no-autofocus";function zM(r,t){return typeof r=="function"?r(t):r&&(r.current=t),r}function INe(r,t){var s=V.useState(function(){return{value:r,callback:t,facade:{get current(){return s.value},set current(a){var l=s.value;l!==a&&(s.value=a,s.callback(a,l))}}}})[0];return s.callback=t,s.facade}var ANe=typeof window<"u"?V.useLayoutEffect:V.useEffect,u7=new WeakMap;function aee(r,t){var s=INe(null,function(a){return r.forEach(function(l){return zM(l,a)})});return ANe(function(){var a=u7.get(s);if(a){var l=new Set(a),d=new Set(r),p=s.current;l.forEach(function(E){d.has(E)||zM(E,null)}),d.forEach(function(E){l.has(E)||zM(E,p)})}u7.set(s,r)},[r]),s}var HM={width:"1px",height:"0px",padding:0,overflow:"hidden",position:"fixed",top:"1px",left:"1px"},ph=function(){return ph=Object.assign||function(t){for(var s,a=1,l=arguments.length;a<l;a++){s=arguments[a];for(var d in s)Object.prototype.hasOwnProperty.call(s,d)&&(t[d]=s[d])}return t},ph.apply(this,arguments)};function gR(r,t){var s={};for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&t.indexOf(a)<0&&(s[a]=r[a]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,a=Object.getOwnPropertySymbols(r);l<a.length;l++)t.indexOf(a[l])<0&&Object.prototype.propertyIsEnumerable.call(r,a[l])&&(s[a[l]]=r[a[l]]);return s}function ONe(r,t,s){if(s||arguments.length===2)for(var a=0,l=t.length,d;a<l;a++)(d||!(a in t))&&(d||(d=Array.prototype.slice.call(t,0,a)),d[a]=t[a]);return r.concat(d||Array.prototype.slice.call(t))}function cee(r){return r}function lee(r,t){t===void 0&&(t=cee);var s=[],a=!1,l={read:function(){if(a)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return s.length?s[s.length-1]:r},useMedium:function(d){var p=t(d,a);return s.push(p),function(){s=s.filter(function(E){return E!==p})}},assignSyncMedium:function(d){for(a=!0;s.length;){var p=s;s=[],p.forEach(d)}s={push:function(E){return d(E)},filter:function(){return s}}},assignMedium:function(d){a=!0;var p=[];if(s.length){var E=s;s=[],E.forEach(d),p=s}var v=function(){var R=p;p=[],R.forEach(d)},b=function(){return Promise.resolve().then(v)};b(),s={push:function(R){p.push(R),b()},filter:function(R){return p=p.filter(R),s}}}};return l}function sF(r,t){return t===void 0&&(t=cee),lee(r,t)}function uee(r){r===void 0&&(r={});var t=lee(null);return t.options=ph({async:!0,ssr:!1},r),t}var dee=function(r){var t=r.sideCar,s=gR(r,["sideCar"]);if(!t)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var a=t.read();if(!a)throw new Error("Sidecar medium not found");return V.createElement(a,ph({},s))};dee.isSideCarExport=!0;function PNe(r,t){return r.useMedium(t),dee}var hee=sF({},function(r){var t=r.target,s=r.currentTarget;return{target:t,currentTarget:s}}),fee=sF(),NNe=sF(),kNe=uee({async:!0,ssr:typeof document<"u"}),DNe=V.createContext(void 0),LNe=[],oF=V.forwardRef(function(t,s){var a,l=V.useState(),d=l[0],p=l[1],E=V.useRef(),v=V.useRef(!1),b=V.useRef(null),R=V.useState({}),O=R[1],N=t.children,F=t.disabled,H=F===void 0?!1:F,z=t.noFocusGuards,G=z===void 0?!1:z,ee=t.persistentFocus,J=ee===void 0?!1:ee,re=t.crossFrame,de=re===void 0?!0:re,se=t.autoFocus,ye=se===void 0?!0:se;t.allowTextSelection;var Q=t.group,ne=t.className,oe=t.whiteList,ue=t.hasPositiveIndices,Ee=t.shards,fe=Ee===void 0?LNe:Ee,le=t.as,Le=le===void 0?"div":le,pt=t.lockProps,et=pt===void 0?{}:pt,Oe=t.sideCar,Ue=t.returnFocus,Me=Ue===void 0?!1:Ue,it=t.focusOptions,Ae=t.onActivation,qe=t.onDeactivation,Ze=V.useState({}),Fe=Ze[0],lt=V.useCallback(function(Zn){var zt=Zn.captureFocusRestore;if(!b.current){var ve,Ne=(ve=document)==null?void 0:ve.activeElement;b.current=Ne,Ne!==document.body&&(b.current=zt(Ne))}E.current&&Ae&&Ae(E.current),v.current=!0,O()},[Ae]),Et=V.useCallback(function(){v.current=!1,qe&&qe(E.current),O()},[qe]),Nt=V.useCallback(function(Zn){var zt=b.current;if(zt){var ve=(typeof zt=="function"?zt():zt)||document.body,Ne=typeof Me=="function"?Me(ve):Me;if(Ne){var We=typeof Ne=="object"?Ne:void 0;b.current=null,Zn?Promise.resolve().then(function(){return ve.focus(We)}):ve.focus(We)}}},[Me]),$t=V.useCallback(function(Zn){v.current&&hee.useMedium(Zn)},[]),xt=fee.useMedium,En=V.useCallback(function(Zn){E.current!==Zn&&(E.current=Zn,p(Zn))},[]),In=$_((a={},a[oee]=H&&"disabled",a[nU]=Q,a),et),hn=G!==!0,Kn=hn&&G!=="tail",Ar=aee([s,En]),Zt=V.useMemo(function(){return{observed:E,shards:fe,enabled:!H,active:v.current}},[H,v.current,fe,d]);return Zr.createElement(V.Fragment,null,hn&&[Zr.createElement("div",{key:"guard-first","data-focus-guard":!0,tabIndex:H?-1:0,style:HM}),ue?Zr.createElement("div",{key:"guard-nearest","data-focus-guard":!0,tabIndex:H?-1:1,style:HM}):null],!H&&Zr.createElement(Oe,{id:Fe,sideCar:kNe,observed:d,disabled:H,persistentFocus:J,crossFrame:de,autoFocus:ye,whiteList:oe,shards:fe,onActivation:lt,onDeactivation:Et,returnFocus:Nt,focusOptions:it,noFocusGuards:G}),Zr.createElement(Le,$_({ref:Ar},In,{className:ne,onBlur:xt,onFocus:$t}),Zr.createElement(DNe.Provider,{value:Zt},N)),Kn&&Zr.createElement("div",{"data-focus-guard":!0,tabIndex:H?-1:0,style:HM}))});oF.propTypes={};function rU(r,t){return rU=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(s,a){return s.__proto__=a,s},rU(r,t)}function xNe(r,t){r.prototype=Object.create(t.prototype),r.prototype.constructor=r,rU(r,t)}function jw(r){"@babel/helpers - typeof";return jw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},jw(r)}function MNe(r,t){if(jw(r)!="object"||!r)return r;var s=r[Symbol.toPrimitive];if(s!==void 0){var a=s.call(r,t);if(jw(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(r)}function UNe(r){var t=MNe(r,"string");return jw(t)=="symbol"?t:t+""}function VNe(r,t,s){return(t=UNe(t))in r?Object.defineProperty(r,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):r[t]=s,r}function FNe(r,t){function s(a){return a.displayName||a.name||"Component"}return function(l){var d=[],p;function E(){p=r(d.map(function(b){return b.props})),t(p)}var v=function(b){xNe(R,b);function R(){return b.apply(this,arguments)||this}R.peek=function(){return p};var O=R.prototype;return O.componentDidMount=function(){d.push(this),E()},O.componentDidUpdate=function(){E()},O.componentWillUnmount=function(){var F=d.indexOf(this);d.splice(F,1),E()},O.render=function(){return Zr.createElement(l,this.props)},R}(V.PureComponent);return VNe(v,"displayName","SideEffect("+s(l)+")"),v}}var Lh=function(r){for(var t=Array(r.length),s=0;s<r.length;++s)t[s]=r[s];return t},X_=function(r){return Array.isArray(r)?r:[r]},pee=function(r){return Array.isArray(r)?r[0]:r},jNe=function(r){if(r.nodeType!==Node.ELEMENT_NODE)return!1;var t=window.getComputedStyle(r,null);return!t||!t.getPropertyValue?!1:t.getPropertyValue("display")==="none"||t.getPropertyValue("visibility")==="hidden"},mee=function(r){return r.parentNode&&r.parentNode.nodeType===Node.DOCUMENT_FRAGMENT_NODE?r.parentNode.host:r.parentNode},gee=function(r){return r===document||r&&r.nodeType===Node.DOCUMENT_NODE},BNe=function(r){return r.hasAttribute("inert")},WNe=function(r,t){return!r||gee(r)||!jNe(r)&&!BNe(r)&&t(mee(r))},_ee=function(r,t){var s=r.get(t);if(s!==void 0)return s;var a=WNe(t,_ee.bind(void 0,r));return r.set(t,a),a},GNe=function(r,t){return r&&!gee(r)?KNe(r)?t(mee(r)):!1:!0},Eee=function(r,t){var s=r.get(t);if(s!==void 0)return s;var a=GNe(t,Eee.bind(void 0,r));return r.set(t,a),a},yee=function(r){return r.dataset},zNe=function(r){return r.tagName==="BUTTON"},vee=function(r){return r.tagName==="INPUT"},See=function(r){return vee(r)&&r.type==="radio"},HNe=function(r){return!((vee(r)||zNe(r))&&(r.type==="hidden"||r.disabled))},KNe=function(r){var t=r.getAttribute(CNe);return![!0,"true",""].includes(t)},aF=function(r){var t;return!!(r&&(!((t=yee(r))===null||t===void 0)&&t.focusGuard))},iU=function(r){return!aF(r)},qNe=function(r){return!!r},$Ne=function(r,t){var s=Math.max(0,r.tabIndex),a=Math.max(0,t.tabIndex),l=s-a,d=r.index-t.index;if(l){if(!s)return 1;if(!a)return-1}return l||d},YNe=function(r){return r.tabIndex<0&&!r.hasAttribute("tabindex")?0:r.tabIndex},cF=function(r,t,s){return Lh(r).map(function(a,l){var d=YNe(a);return{node:a,index:l,tabIndex:s&&d===-1?(a.dataset||{}).focusGuard?0:-1:d}}).filter(function(a){return!t||a.tabIndex>=0}).sort($Ne)},XNe=["button:enabled","select:enabled","textarea:enabled","input:enabled","a[href]","area[href]","summary","iframe","object","embed","audio[controls]","video[controls]","[tabindex]","[contenteditable]","[autofocus]"],lF=XNe.join(","),JNe="".concat(lF,", [data-focus-guard]"),Tee=function(r,t){return Lh((r.shadowRoot||r).children).reduce(function(s,a){return s.concat(a.matches(t?JNe:lF)?[a]:[],Tee(a))},[])},QNe=function(r,t){var s;return r instanceof HTMLIFrameElement&&(!((s=r.contentDocument)===null||s===void 0)&&s.body)?CS([r.contentDocument.body],t):[r]},CS=function(r,t){return r.reduce(function(s,a){var l,d=Tee(a,t),p=(l=[]).concat.apply(l,d.map(function(E){return QNe(E,t)}));return s.concat(p,a.parentNode?Lh(a.parentNode.querySelectorAll(lF)).filter(function(E){return E===a}):[])},[])},ZNe=function(r){var t=r.querySelectorAll("[".concat(RNe,"]"));return Lh(t).map(function(s){return CS([s])}).reduce(function(s,a){return s.concat(a)},[])},uF=function(r,t){return Lh(r).filter(function(s){return _ee(t,s)}).filter(function(s){return HNe(s)})},d7=function(r,t){return t===void 0&&(t=new Map),Lh(r).filter(function(s){return Eee(t,s)})},dF=function(r,t,s){return cF(uF(CS(r,s),t),!0,s)},Bw=function(r,t){return cF(uF(CS(r),t),!1)},eke=function(r,t){return uF(ZNe(r),t)},z_=function(r,t){return r.shadowRoot?z_(r.shadowRoot,t):Object.getPrototypeOf(r).contains!==void 0&&Object.getPrototypeOf(r).contains.call(r,t)?!0:Lh(r.children).some(function(s){var a;if(s instanceof HTMLIFrameElement){var l=(a=s.contentDocument)===null||a===void 0?void 0:a.body;return l?z_(l,t):!1}return z_(s,t)})},tke=function(r){for(var t=new Set,s=r.length,a=0;a<s;a+=1)for(var l=a+1;l<s;l+=1){var d=r[a].compareDocumentPosition(r[l]);(d&Node.DOCUMENT_POSITION_CONTAINED_BY)>0&&t.add(l),(d&Node.DOCUMENT_POSITION_CONTAINS)>0&&t.add(a)}return r.filter(function(p,E){return!t.has(E)})},bee=function(r){return r.parentNode?bee(r.parentNode):r},hF=function(r){var t=X_(r);return t.filter(Boolean).reduce(function(s,a){var l=a.getAttribute(nU);return s.push.apply(s,l?tke(Lh(bee(a).querySelectorAll("[".concat(nU,'="').concat(l,'"]:not([').concat(oee,'="disabled"])')))):[a]),s},[])},nke=function(r){try{return r()}catch{return}},Ww=function(r){if(r===void 0&&(r=document),!(!r||!r.activeElement)){var t=r.activeElement;return t.shadowRoot?Ww(t.shadowRoot):t instanceof HTMLIFrameElement&&nke(function(){return t.contentWindow.document})?Ww(t.contentWindow.document):t}},rke=function(r,t){return r===t},ike=function(r,t){return!!Lh(r.querySelectorAll("iframe")).some(function(s){return rke(s,t)})},wee=function(r,t){return t===void 0&&(t=Ww(pee(r).ownerDocument)),!t||t.dataset&&t.dataset.focusGuard?!1:hF(r).some(function(s){return z_(s,t)||ike(s,t)})},ske=function(r){r===void 0&&(r=document);var t=Ww(r);return t?Lh(r.querySelectorAll("[".concat(wNe,"]"))).some(function(s){return z_(s,t)}):!1},oke=function(r,t){return t.filter(See).filter(function(s){return s.name===r.name}).filter(function(s){return s.checked})[0]||r},fF=function(r,t){return See(r)&&r.name?oke(r,t):r},ake=function(r){var t=new Set;return r.forEach(function(s){return t.add(fF(s,r))}),r.filter(function(s){return t.has(s)})},h7=function(r){return r[0]&&r.length>1?fF(r[0],r):r[0]},f7=function(r,t){return r.indexOf(fF(t,r))},sU="NEW_FOCUS",cke=function(r,t,s,a,l){var d=r.length,p=r[0],E=r[d-1],v=aF(a);if(!(a&&r.indexOf(a)>=0)){var b=a!==void 0?s.indexOf(a):-1,R=l?s.indexOf(l):b,O=l?r.indexOf(l):-1;if(b===-1)return O!==-1?O:sU;if(O===-1)return sU;var N=b-R,F=s.indexOf(p),H=s.indexOf(E),z=ake(s),G=a!==void 0?z.indexOf(a):-1,ee=l?z.indexOf(l):G,J=z.filter(function(ne){return ne.tabIndex>=0}),re=a!==void 0?J.indexOf(a):-1,de=l?J.indexOf(l):re,se=re>=0&&de>=0?de-re:ee-G;if(!N&&O>=0||t.length===0)return O;var ye=f7(r,t[0]),Q=f7(r,t[t.length-1]);if(b<=F&&v&&Math.abs(N)>1)return Q;if(b>=H&&v&&Math.abs(N)>1)return ye;if(N&&Math.abs(se)>1)return O;if(b<=F)return Q;if(b>H)return ye;if(N)return Math.abs(N)>1?O:(d+O+N)%d}},lke=function(r){return function(t){var s,a=(s=yee(t))===null||s===void 0?void 0:s.autofocus;return t.autofocus||a!==void 0&&a!=="false"||r.indexOf(t)>=0}},p7=function(r,t,s){var a=r.map(function(d){var p=d.node;return p}),l=d7(a.filter(lke(s)));return l&&l.length?h7(l):h7(d7(t))},oU=function(r,t){return t===void 0&&(t=[]),t.push(r),r.parentNode&&oU(r.parentNode.host||r.parentNode,t),t},KM=function(r,t){for(var s=oU(r),a=oU(t),l=0;l<s.length;l+=1){var d=s[l];if(a.indexOf(d)>=0)return d}return!1},Ree=function(r,t,s){var a=X_(r),l=X_(t),d=a[0],p=!1;return l.filter(Boolean).forEach(function(E){p=KM(p||E,E)||p,s.filter(Boolean).forEach(function(v){var b=KM(d,v);b&&(!p||z_(b,p)?p=b:p=KM(b,p))})}),p},m7=function(r,t){return r.reduce(function(s,a){return s.concat(eke(a,t))},[])},uke=function(r,t){var s=new Map;return t.forEach(function(a){return s.set(a.node,a)}),r.map(function(a){return s.get(a)}).filter(qNe)},dke=function(r,t){var s=Ww(X_(r).length>0?document:pee(r).ownerDocument),a=hF(r).filter(iU),l=Ree(s||r,r,a),d=new Map,p=Bw(a,d),E=p.filter(function(H){var z=H.node;return iU(z)});if(E[0]){var v=Bw([l],d).map(function(H){var z=H.node;return z}),b=uke(v,E),R=b.map(function(H){var z=H.node;return z}),O=b.filter(function(H){var z=H.tabIndex;return z>=0}).map(function(H){var z=H.node;return z}),N=cke(R,O,v,s,t);if(N===sU){var F=p7(p,O,m7(a,d))||p7(p,R,m7(a,d));if(F)return{node:F};console.warn("focus-lock: cannot find any node to move focus into");return}return N===void 0?N:b[N]}},hke=function(r){var t=hF(r).filter(iU),s=Ree(r,r,t),a=cF(CS([s],!0),!0,!0),l=CS(t,!1);return a.map(function(d){var p=d.node,E=d.index;return{node:p,index:E,lockItem:l.indexOf(p)>=0,guard:aF(p)}})},pF=function(r,t){r&&("focus"in r&&r.focus(t),"contentWindow"in r&&r.contentWindow&&r.contentWindow.focus())},qM=0,$M=!1,Cee=function(r,t,s){s===void 0&&(s={});var a=dke(r,t);if(!$M&&a){if(qM>2){console.error("FocusLock: focus-fighting detected. Only one focus management system could be active. See https://github.com/theKashey/focus-lock/#focus-fighting"),$M=!0,setTimeout(function(){$M=!1},1);return}qM++,pF(a.node,s.focusOptions),qM--}};function Ib(r){if(!r)return null;if(typeof WeakRef>"u")return function(){return r||null};var t=r?new WeakRef(r):null;return function(){return(t==null?void 0:t.deref())||null}}var fke=function(r){if(!r)return null;for(var t=[],s=r;s&&s!==document.body;)t.push({current:Ib(s),parent:Ib(s.parentElement),left:Ib(s.previousElementSibling),right:Ib(s.nextElementSibling)}),s=s.parentElement;return{element:Ib(r),stack:t,ownerDocument:r.ownerDocument}},pke=function(r){var t,s,a,l,d;if(r)for(var p=r.stack,E=r.ownerDocument,v=new Map,b=0,R=p;b<R.length;b++){var O=R[b],N=(t=O.parent)===null||t===void 0?void 0:t.call(O);if(N&&E.contains(N)){for(var F=(s=O.left)===null||s===void 0?void 0:s.call(O),H=O.current(),z=N.contains(H)?H:void 0,G=(a=O.right)===null||a===void 0?void 0:a.call(O),ee=dF([N],v),J=(d=(l=z??(F==null?void 0:F.nextElementSibling))!==null&&l!==void 0?l:G)!==null&&d!==void 0?d:F;J;){for(var re=0,de=ee;re<de.length;re++){var se=de[re];if(J!=null&&J.contains(se.node))return se.node}J=J.nextElementSibling}if(ee.length)return ee[0].node}}},Iee=function(r){var t=fke(r);return function(){return pke(t)}},mke=function(r,t,s){if(!r||!t)return console.error("no element or scope given"),{};var a=X_(t);if(a.every(function(p){return!z_(p,r)}))return console.error("Active element is not contained in the scope"),{};var l=s?dF(a,new Map):Bw(a,new Map),d=l.findIndex(function(p){var E=p.node;return E===r});if(d!==-1)return{prev:l[d-1],next:l[d+1],first:l[0],last:l[l.length-1]}},gke=function(r,t){var s=t?dF(X_(r),new Map):Bw(X_(r),new Map);return{first:s[0],last:s[s.length-1]}},_ke=function(r){return Object.assign({scope:document.body,cycle:!0,onlyTabbable:!0},r)},Aee=function(r,t,s){t===void 0&&(t={});var a=_ke(t),l=mke(r,a.scope,a.onlyTabbable);if(l){var d=s(l,a.cycle);d&&pF(d.node,a.focusOptions)}},Eke=function(r,t){t===void 0&&(t={}),Aee(r,t,function(s,a){var l=s.next,d=s.first;return l||a&&d})},yke=function(r,t){t===void 0&&(t={}),Aee(r,t,function(s,a){var l=s.prev,d=s.last;return l||a&&d})},Oee=function(r,t,s){var a,l=gke(r,(a=t.onlyTabbable)!==null&&a!==void 0?a:!0),d=l[s];d&&pF(d.node,t.focusOptions)},vke=function(r,t){t===void 0&&(t={}),Oee(r,t,"first")},Ske=function(r,t){t===void 0&&(t={}),Oee(r,t,"last")};function mF(r){setTimeout(r,1)}var Tke=function(t){return t&&"current"in t?t.current:t},Pee=function(){return document&&document.activeElement===document.body},bke=function(){return Pee()||ske()},dS=null,Oc=null,g7=function(){return null},hS=null,Gw=!1,gF=!1,wke=function(){return!0},Rke=function(t){return(dS.whiteList||wke)(t)},Cke=function(t,s){hS={observerNode:t,portaledElement:s}},Ike=function(t){return hS&&hS.portaledElement===t};function _7(r,t,s,a){var l=null,d=r;do{var p=a[d];if(p.guard)p.node.dataset.focusAutoGuard&&(l=p);else if(p.lockItem){if(d!==r)return;l=null}else break}while((d+=s)!==t);l&&(l.node.tabIndex=0)}var Ake=function(t){return t?!!Gw:Gw==="meanwhile"},Oke=function r(t,s,a){return s&&(s.host===t&&(!s.activeElement||a.contains(s.activeElement))||s.parentNode&&r(t,s.parentNode,a))},Pke=function(t,s){return s.some(function(a){return Oke(t,a,a)})},Nee=function(t){return Bw(t,new Map)},Nke=function(t){return!Nee([t.parentNode]).some(function(s){return s.node===t})},KP=function(){var t=!1;if(dS){var s=dS,a=s.observed,l=s.persistentFocus,d=s.autoFocus,p=s.shards,E=s.crossFrame,v=s.focusOptions,b=s.noFocusGuards,R=a||hS&&hS.portaledElement;if(Pee()&&Oc&&Oc!==document.body&&(!document.body.contains(Oc)||Nke(Oc))){var O=g7();O&&O.focus()}var N=document&&document.activeElement;if(R){var F=[R].concat(p.map(Tke).filter(Boolean)),H=function(){if(!Ake(E)||!b||!Oc||gF)return!1;var re=Nee(F),de=re.findIndex(function(se){var ye=se.node;return ye===Oc});return de===0||de===re.length-1};if((!N||Rke(N))&&(l||H()||!bke()||!Oc&&d)&&(R&&!(wee(F)||N&&Pke(N,F)||Ike(N))&&(document&&!Oc&&N&&!d?(N.blur&&N.blur(),document.body.focus()):(t=Cee(F,Oc,{focusOptions:v}),hS={})),Oc=document&&document.activeElement,Oc!==document.body&&(g7=Iee(Oc)),Gw=!1),document&&N!==document.activeElement&&document.querySelector("[data-focus-auto-guard]")){var z=document&&document.activeElement,G=hke(F),ee=G.map(function(J){var re=J.node;return re}).indexOf(z);ee>-1&&(G.filter(function(J){var re=J.guard,de=J.node;return re&&de.dataset.focusAutoGuard}).forEach(function(J){var re=J.node;return re.removeAttribute("tabIndex")}),_7(ee,G.length,1,G),_7(ee,-1,-1,G))}}}return t},kee=function(t){KP()&&t&&(t.stopPropagation(),t.preventDefault())},_F=function(){return mF(KP)},kke=function(t){var s=t.target,a=t.currentTarget;a.contains(s)||Cke(a,s)},Dke=function(){return null},Dee=function(){gF=!0},Lee=function(){gF=!1,Gw="just",mF(function(){Gw="meanwhile"})},Lke=function(){document.addEventListener("focusin",kee),document.addEventListener("focusout",_F),window.addEventListener("focus",Dee),window.addEventListener("blur",Lee)},xke=function(){document.removeEventListener("focusin",kee),document.removeEventListener("focusout",_F),window.removeEventListener("focus",Dee),window.removeEventListener("blur",Lee)};function Mke(r){return r.filter(function(t){var s=t.disabled;return!s})}var xee={moveFocusInside:Cee,focusInside:wee,focusNextElement:Eke,focusPrevElement:yke,focusFirstElement:vke,focusLastElement:Ske,captureFocusRestore:Iee};function Uke(r){var t=r.slice(-1)[0];t&&!dS&&Lke();var s=dS,a=s&&t&&t.id===s.id;dS=t,s&&!a&&(s.onDeactivation(),r.filter(function(l){var d=l.id;return d===s.id}).length||s.returnFocus(!t)),t?(Oc=null,(!a||s.observed!==t.observed)&&t.onActivation(xee),KP(),mF(KP)):(xke(),Oc=null)}hee.assignSyncMedium(kke);fee.assignMedium(_F);NNe.assignMedium(function(r){return r(xee)});const Vke=FNe(Mke,Uke)(Dke);var aU=V.forwardRef(function(t,s){return Zr.createElement(oF,$_({sideCar:Vke,ref:s},t))}),Mee=oF.propTypes||{};Mee.sideCar;yNe(Mee,["sideCar"]);aU.propTypes={};const Fke=aU.default??aU,Uee=r=>{const{initialFocusRef:t,finalFocusRef:s,contentRef:a,restoreFocus:l,children:d,isDisabled:p,autoFocus:E,persistentFocus:v,lockFocusAcrossFrames:b}=r,R=V.useCallback(()=>{t!=null&&t.current?t.current.focus():a!=null&&a.current&&mJ(a.current).length===0&&requestAnimationFrame(()=>{var H;(H=a.current)==null||H.focus()})},[t,a]),O=V.useCallback(()=>{var F;(F=s==null?void 0:s.current)==null||F.focus()},[s]),N=l&&!s;return D.jsx(Fke,{crossFrame:b,persistentFocus:v,autoFocus:E,disabled:p,onActivation:R,onDeactivation:O,returnFocus:N,children:d})};Uee.displayName="FocusLock";const[jke,Bke]=Mi({name:"FormErrorStylesContext",errorMessage:`useFormErrorStyles returned is 'undefined'. Seems you forgot to wrap the components in "<FormError />" `}),Wf=qt((r,t)=>{const s=jc("FormError",r),a=zi(r),l=YS();return l!=null&&l.isInvalid?D.jsx(jke,{value:s,children:D.jsx(Ot.div,{...l==null?void 0:l.getErrorMessageProps(a,t),className:dn("chakra-form__error-message",r.className),__css:{display:"flex",alignItems:"center",...s.text}})}):null});Wf.displayName="FormErrorMessage";const Wke=qt((r,t)=>{const s=Bke(),a=YS();if(!(a!=null&&a.isInvalid))return null;const l=dn("chakra-form__error-icon",r.className);return D.jsx(Xm,{ref:t,"aria-hidden":!0,...r,__css:s.icon,className:l,children:D.jsx("path",{fill:"currentColor",d:"M11.983,0a12.206,12.206,0,0,0-8.51,3.653A11.8,11.8,0,0,0,0,12.207,11.779,11.779,0,0,0,11.8,24h.214A12.111,12.111,0,0,0,24,11.791h0A11.766,11.766,0,0,0,11.983,0ZM10.5,16.542a1.476,1.476,0,0,1,1.449-1.53h.027a1.527,1.527,0,0,1,1.523,1.47,1.475,1.475,0,0,1-1.449,1.53h-.027A1.529,1.529,0,0,1,10.5,16.542ZM11,12.5v-6a1,1,0,0,1,2,0v6a1,1,0,1,1-2,0Z"})})});Wke.displayName="FormErrorIcon";const ou=qt(function(t,s){const a=fu("FormLabel",t),l=zi(t),{className:d,children:p,requiredIndicator:E=D.jsx(Vee,{}),optionalIndicator:v=null,...b}=l,R=YS(),O=(R==null?void 0:R.getLabelProps(b,s))??{ref:s,...b};return D.jsxs(Ot.label,{...O,className:dn("chakra-form__label",l.className),__css:{display:"block",textAlign:"start",...a},children:[p,R!=null&&R.isRequired?E:v]})});ou.displayName="FormLabel";const Vee=qt(function(t,s){const a=YS(),l=ree();if(!(a!=null&&a.isRequired))return null;const d=dn("chakra-form__required-indicator",t.className);return D.jsx(Ot.span,{...a==null?void 0:a.getRequiredIndicatorProps(t,s),__css:l.requiredIndicator,className:d})});Vee.displayName="RequiredIndicator";const Fee=qt(function(t,s){const{templateAreas:a,gap:l,rowGap:d,columnGap:p,column:E,row:v,autoFlow:b,autoRows:R,templateRows:O,autoColumns:N,templateColumns:F,...H}=t,z={display:"grid",gridTemplateAreas:a,gridGap:l,gridRowGap:d,gridColumnGap:p,gridAutoColumns:N,gridColumn:E,gridRow:v,gridAutoFlow:b,gridAutoRows:R,gridTemplateRows:O,gridTemplateColumns:F};return D.jsx(Ot.div,{ref:s,__css:z,...H})});Fee.displayName="Grid";const jee=qt(function(t,s){const{columns:a,spacingX:l,spacingY:d,spacing:p,minChildWidth:E,...v}=t,b=qS(),R=E?zke(E,b):Hke(a);return D.jsx(Fee,{ref:s,gap:p,columnGap:l,rowGap:d,templateColumns:R,...v})});jee.displayName="SimpleGrid";function Gke(r){return typeof r=="number"?`${r}px`:r}function zke(r,t){return SN(r,s=>{const a=bPe("sizes",s,Gke(s))(t);return s===null?null:`repeat(auto-fit, minmax(${a}, 1fr))`})}function Hke(r){return SN(r,t=>t===null?null:`repeat(${t}, minmax(0, 1fr))`)}function XS(r){const{viewBox:t="0 0 24 24",d:s,displayName:a,defaultProps:l={}}=r,d=V.Children.toArray(r.path),p=qt((E,v)=>D.jsx(Xm,{ref:v,viewBox:t,...l,...E,children:d.length?d:D.jsx("path",{fill:"currentColor",d:s})}));return p.displayName=a,p}const cU=qt(function(t,s){const{htmlWidth:a,htmlHeight:l,alt:d,...p}=t;return D.jsx("img",{width:a,height:l,ref:s,alt:d,...p})});cU.displayName="NativeImage";const EF=qt(function(t,s){const{fallbackSrc:a,fallback:l,src:d,srcSet:p,align:E,fit:v,loading:b,ignoreFallback:R,crossOrigin:O,fallbackStrategy:N="beforeLoadOrError",referrerPolicy:F,...H}=t,z=a!==void 0||l!==void 0,G=b!=null||R||!z,ee=ZZ({...t,crossOrigin:O,ignoreFallback:G}),J=QPe(ee,N),re={ref:s,objectFit:v,objectPosition:E,...G?H:sR(H,["onError","onLoad"])};return J?l||D.jsx(Ot.img,{as:cU,className:"chakra-image__placeholder",src:a,...re}):D.jsx(Ot.img,{as:cU,src:d,srcSet:p,crossOrigin:O,loading:b,referrerPolicy:F,className:"chakra-image",...re})});EF.displayName="Image";const zo=qt(function(t,s){const{htmlSize:a,...l}=t,d=jc("Input",l),p=zi(l),E=iee(p),v=dn("chakra-input",t.className);return D.jsx(Ot.input,{size:a,...E,__css:d.field,ref:s,className:v})});zo.displayName="Input";zo.id="Input";const[Kke,qke]=Mi({name:"InputGroupStylesContext",errorMessage:`useInputGroupStyles returned is 'undefined'. Seems you forgot to wrap the components in "<InputGroup />" `}),lU=qt(function(t,s){const a=jc("Input",t),{children:l,className:d,...p}=zi(t),E=dn("chakra-input__group",d),v={},b=eV(l),R=a.field;b.forEach(N=>{a&&(R&&N.type.id==="InputLeftElement"&&(v.paddingStart=R.height??R.h),R&&N.type.id==="InputRightElement"&&(v.paddingEnd=R.height??R.h),N.type.id==="InputRightAddon"&&(v.borderEndRadius=0),N.type.id==="InputLeftAddon"&&(v.borderStartRadius=0))});const O=b.map(N=>{var H,z;const F=vN({size:((H=N.props)==null?void 0:H.size)||t.size,variant:((z=N.props)==null?void 0:z.variant)||t.variant});return N.type.id!=="Input"?V.cloneElement(N,F):V.cloneElement(N,Object.assign(F,v,N.props))});return D.jsx(Ot.div,{className:E,ref:s,__css:{width:"100%",display:"flex",position:"relative",isolation:"isolate",...a.group},"data-group":!0,...p,children:D.jsx(Kke,{value:a,children:O})})});lU.displayName="InputGroup";const $ke=Ot("div",{baseStyle:{display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",top:"0",zIndex:2}}),jN=qt(function(t,s){const{placement:a="left",...l}=t,d=qke(),p=d.field,v={[a==="left"?"insetStart":"insetEnd"]:"0",width:(p==null?void 0:p.height)??(p==null?void 0:p.h),height:(p==null?void 0:p.height)??(p==null?void 0:p.h),fontSize:p==null?void 0:p.fontSize,...d.element};return D.jsx($ke,{ref:s,__css:v,...l})});jN.id="InputElement";jN.displayName="InputElement";const qP=qt(function(t,s){const{className:a,...l}=t,d=dn("chakra-input__left-element",a);return D.jsx(jN,{ref:s,placement:"left",className:d,...l})});qP.id="InputLeftElement";qP.displayName="InputLeftElement";const Bee=qt(function(t,s){const{className:a,...l}=t,d=dn("chakra-input__right-element",a);return D.jsx(jN,{ref:s,placement:"right",className:d,...l})});Bee.id="InputRightElement";Bee.displayName="InputRightElement";const Ph=qt(function(t,s){const a=fu("Link",t),{className:l,isExternal:d,...p}=zi(t);return D.jsx(Ot.a,{target:d?"_blank":void 0,rel:d?"noopener":void 0,ref:s,className:dn("chakra-link",l),...p,__css:a})});Ph.displayName="Link";function Yke(r,t,s,a){if(t==null)return a;if(!a)return r.find(p=>s(p).toLowerCase().startsWith(t.toLowerCase()));const l=r.filter(d=>s(d).toLowerCase().startsWith(t.toLowerCase()));if(l.length>0){let d;return l.includes(a)?(d=l.indexOf(a)+1,d===l.length&&(d=0),l[d]):(d=r.indexOf(l[0]),r[d])}return a}function Xke(r){const{key:t}=r;return t.length===1||t.length>1&&/[^a-zA-Z0-9]/.test(t)}function Jke(r={}){const{timeout:t=300,preventDefault:s=()=>!0}=r,[a,l]=V.useState([]),d=V.useRef(void 0),p=()=>{d.current&&(clearTimeout(d.current),d.current=null)},E=()=>{p(),d.current=setTimeout(()=>{l([]),d.current=null},t)};V.useEffect(()=>p,[]);function v(b){return R=>{if(R.key==="Backspace"){const O=[...a];O.pop(),l(O);return}if(Xke(R)){const O=a.concat(R.key);s(R)&&(R.preventDefault(),R.stopPropagation()),l(O),b(O.join("")),E()}}}return v}var Uc="top",du="bottom",hu="right",Vc="left",yF="auto",_R=[Uc,du,hu,Vc],IS="start",zw="end",Qke="clippingParents",Wee="viewport",Ab="popper",Zke="reference",E7=_R.reduce(function(r,t){return r.concat([t+"-"+IS,t+"-"+zw])},[]),Gee=[].concat(_R,[yF]).reduce(function(r,t){return r.concat([t,t+"-"+IS,t+"-"+zw])},[]),eDe="beforeRead",tDe="read",nDe="afterRead",rDe="beforeMain",iDe="main",sDe="afterMain",oDe="beforeWrite",aDe="write",cDe="afterWrite",lDe=[eDe,tDe,nDe,rDe,iDe,sDe,oDe,aDe,cDe];function Nh(r){return r?(r.nodeName||"").toLowerCase():null}function El(r){if(r==null)return window;if(r.toString()!=="[object Window]"){var t=r.ownerDocument;return t&&t.defaultView||window}return r}function J_(r){var t=El(r).Element;return r instanceof t||r instanceof Element}function cu(r){var t=El(r).HTMLElement;return r instanceof t||r instanceof HTMLElement}function vF(r){if(typeof ShadowRoot>"u")return!1;var t=El(r).ShadowRoot;return r instanceof t||r instanceof ShadowRoot}function uDe(r){var t=r.state;Object.keys(t.elements).forEach(function(s){var a=t.styles[s]||{},l=t.attributes[s]||{},d=t.elements[s];!cu(d)||!Nh(d)||(Object.assign(d.style,a),Object.keys(l).forEach(function(p){var E=l[p];E===!1?d.removeAttribute(p):d.setAttribute(p,E===!0?"":E)}))})}function dDe(r){var t=r.state,s={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(t.elements.popper.style,s.popper),t.styles=s,t.elements.arrow&&Object.assign(t.elements.arrow.style,s.arrow),function(){Object.keys(t.elements).forEach(function(a){var l=t.elements[a],d=t.attributes[a]||{},p=Object.keys(t.styles.hasOwnProperty(a)?t.styles[a]:s[a]),E=p.reduce(function(v,b){return v[b]="",v},{});!cu(l)||!Nh(l)||(Object.assign(l.style,E),Object.keys(d).forEach(function(v){l.removeAttribute(v)}))})}}const hDe={name:"applyStyles",enabled:!0,phase:"write",fn:uDe,effect:dDe,requires:["computeStyles"]};function Th(r){return r.split("-")[0]}var H_=Math.max,$P=Math.min,AS=Math.round;function uU(){var r=navigator.userAgentData;return r!=null&&r.brands&&Array.isArray(r.brands)?r.brands.map(function(t){return t.brand+"/"+t.version}).join(" "):navigator.userAgent}function zee(){return!/^((?!chrome|android).)*safari/i.test(uU())}function OS(r,t,s){t===void 0&&(t=!1),s===void 0&&(s=!1);var a=r.getBoundingClientRect(),l=1,d=1;t&&cu(r)&&(l=r.offsetWidth>0&&AS(a.width)/r.offsetWidth||1,d=r.offsetHeight>0&&AS(a.height)/r.offsetHeight||1);var p=J_(r)?El(r):window,E=p.visualViewport,v=!zee()&&s,b=(a.left+(v&&E?E.offsetLeft:0))/l,R=(a.top+(v&&E?E.offsetTop:0))/d,O=a.width/l,N=a.height/d;return{width:O,height:N,top:R,right:b+O,bottom:R+N,left:b,x:b,y:R}}function SF(r){var t=OS(r),s=r.offsetWidth,a=r.offsetHeight;return Math.abs(t.width-s)<=1&&(s=t.width),Math.abs(t.height-a)<=1&&(a=t.height),{x:r.offsetLeft,y:r.offsetTop,width:s,height:a}}function Hee(r,t){var s=t.getRootNode&&t.getRootNode();if(r.contains(t))return!0;if(s&&vF(s)){var a=t;do{if(a&&r.isSameNode(a))return!0;a=a.parentNode||a.host}while(a)}return!1}function rp(r){return El(r).getComputedStyle(r)}function fDe(r){return["table","td","th"].indexOf(Nh(r))>=0}function Jm(r){return((J_(r)?r.ownerDocument:r.document)||window.document).documentElement}function BN(r){return Nh(r)==="html"?r:r.assignedSlot||r.parentNode||(vF(r)?r.host:null)||Jm(r)}function y7(r){return!cu(r)||rp(r).position==="fixed"?null:r.offsetParent}function pDe(r){var t=/firefox/i.test(uU()),s=/Trident/i.test(uU());if(s&&cu(r)){var a=rp(r);if(a.position==="fixed")return null}var l=BN(r);for(vF(l)&&(l=l.host);cu(l)&&["html","body"].indexOf(Nh(l))<0;){var d=rp(l);if(d.transform!=="none"||d.perspective!=="none"||d.contain==="paint"||["transform","perspective"].indexOf(d.willChange)!==-1||t&&d.willChange==="filter"||t&&d.filter&&d.filter!=="none")return l;l=l.parentNode}return null}function ER(r){for(var t=El(r),s=y7(r);s&&fDe(s)&&rp(s).position==="static";)s=y7(s);return s&&(Nh(s)==="html"||Nh(s)==="body"&&rp(s).position==="static")?t:s||pDe(r)||t}function TF(r){return["top","bottom"].indexOf(r)>=0?"x":"y"}function vw(r,t,s){return H_(r,$P(t,s))}function mDe(r,t,s){var a=vw(r,t,s);return a>s?s:a}function Kee(){return{top:0,right:0,bottom:0,left:0}}function qee(r){return Object.assign({},Kee(),r)}function $ee(r,t){return t.reduce(function(s,a){return s[a]=r,s},{})}var gDe=function(t,s){return t=typeof t=="function"?t(Object.assign({},s.rects,{placement:s.placement})):t,qee(typeof t!="number"?t:$ee(t,_R))};function _De(r){var t,s=r.state,a=r.name,l=r.options,d=s.elements.arrow,p=s.modifiersData.popperOffsets,E=Th(s.placement),v=TF(E),b=[Vc,hu].indexOf(E)>=0,R=b?"height":"width";if(!(!d||!p)){var O=gDe(l.padding,s),N=SF(d),F=v==="y"?Uc:Vc,H=v==="y"?du:hu,z=s.rects.reference[R]+s.rects.reference[v]-p[v]-s.rects.popper[R],G=p[v]-s.rects.reference[v],ee=ER(d),J=ee?v==="y"?ee.clientHeight||0:ee.clientWidth||0:0,re=z/2-G/2,de=O[F],se=J-N[R]-O[H],ye=J/2-N[R]/2+re,Q=vw(de,ye,se),ne=v;s.modifiersData[a]=(t={},t[ne]=Q,t.centerOffset=Q-ye,t)}}function EDe(r){var t=r.state,s=r.options,a=s.element,l=a===void 0?"[data-popper-arrow]":a;l!=null&&(typeof l=="string"&&(l=t.elements.popper.querySelector(l),!l)||Hee(t.elements.popper,l)&&(t.elements.arrow=l))}const yDe={name:"arrow",enabled:!0,phase:"main",fn:_De,effect:EDe,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function PS(r){return r.split("-")[1]}var vDe={top:"auto",right:"auto",bottom:"auto",left:"auto"};function SDe(r,t){var s=r.x,a=r.y,l=t.devicePixelRatio||1;return{x:AS(s*l)/l||0,y:AS(a*l)/l||0}}function v7(r){var t,s=r.popper,a=r.popperRect,l=r.placement,d=r.variation,p=r.offsets,E=r.position,v=r.gpuAcceleration,b=r.adaptive,R=r.roundOffsets,O=r.isFixed,N=p.x,F=N===void 0?0:N,H=p.y,z=H===void 0?0:H,G=typeof R=="function"?R({x:F,y:z}):{x:F,y:z};F=G.x,z=G.y;var ee=p.hasOwnProperty("x"),J=p.hasOwnProperty("y"),re=Vc,de=Uc,se=window;if(b){var ye=ER(s),Q="clientHeight",ne="clientWidth";if(ye===El(s)&&(ye=Jm(s),rp(ye).position!=="static"&&E==="absolute"&&(Q="scrollHeight",ne="scrollWidth")),ye=ye,l===Uc||(l===Vc||l===hu)&&d===zw){de=du;var oe=O&&ye===se&&se.visualViewport?se.visualViewport.height:ye[Q];z-=oe-a.height,z*=v?1:-1}if(l===Vc||(l===Uc||l===du)&&d===zw){re=hu;var ue=O&&ye===se&&se.visualViewport?se.visualViewport.width:ye[ne];F-=ue-a.width,F*=v?1:-1}}var Ee=Object.assign({position:E},b&&vDe),fe=R===!0?SDe({x:F,y:z},El(s)):{x:F,y:z};if(F=fe.x,z=fe.y,v){var le;return Object.assign({},Ee,(le={},le[de]=J?"0":"",le[re]=ee?"0":"",le.transform=(se.devicePixelRatio||1)<=1?"translate("+F+"px, "+z+"px)":"translate3d("+F+"px, "+z+"px, 0)",le))}return Object.assign({},Ee,(t={},t[de]=J?z+"px":"",t[re]=ee?F+"px":"",t.transform="",t))}function TDe(r){var t=r.state,s=r.options,a=s.gpuAcceleration,l=a===void 0?!0:a,d=s.adaptive,p=d===void 0?!0:d,E=s.roundOffsets,v=E===void 0?!0:E,b={placement:Th(t.placement),variation:PS(t.placement),popper:t.elements.popper,popperRect:t.rects.popper,gpuAcceleration:l,isFixed:t.options.strategy==="fixed"};t.modifiersData.popperOffsets!=null&&(t.styles.popper=Object.assign({},t.styles.popper,v7(Object.assign({},b,{offsets:t.modifiersData.popperOffsets,position:t.options.strategy,adaptive:p,roundOffsets:v})))),t.modifiersData.arrow!=null&&(t.styles.arrow=Object.assign({},t.styles.arrow,v7(Object.assign({},b,{offsets:t.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:v})))),t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-placement":t.placement})}const bDe={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:TDe,data:{}};var LO={passive:!0};function wDe(r){var t=r.state,s=r.instance,a=r.options,l=a.scroll,d=l===void 0?!0:l,p=a.resize,E=p===void 0?!0:p,v=El(t.elements.popper),b=[].concat(t.scrollParents.reference,t.scrollParents.popper);return d&&b.forEach(function(R){R.addEventListener("scroll",s.update,LO)}),E&&v.addEventListener("resize",s.update,LO),function(){d&&b.forEach(function(R){R.removeEventListener("scroll",s.update,LO)}),E&&v.removeEventListener("resize",s.update,LO)}}const RDe={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:wDe,data:{}};var CDe={left:"right",right:"left",bottom:"top",top:"bottom"};function gP(r){return r.replace(/left|right|bottom|top/g,function(t){return CDe[t]})}var IDe={start:"end",end:"start"};function S7(r){return r.replace(/start|end/g,function(t){return IDe[t]})}function bF(r){var t=El(r),s=t.pageXOffset,a=t.pageYOffset;return{scrollLeft:s,scrollTop:a}}function wF(r){return OS(Jm(r)).left+bF(r).scrollLeft}function ADe(r,t){var s=El(r),a=Jm(r),l=s.visualViewport,d=a.clientWidth,p=a.clientHeight,E=0,v=0;if(l){d=l.width,p=l.height;var b=zee();(b||!b&&t==="fixed")&&(E=l.offsetLeft,v=l.offsetTop)}return{width:d,height:p,x:E+wF(r),y:v}}function ODe(r){var t,s=Jm(r),a=bF(r),l=(t=r.ownerDocument)==null?void 0:t.body,d=H_(s.scrollWidth,s.clientWidth,l?l.scrollWidth:0,l?l.clientWidth:0),p=H_(s.scrollHeight,s.clientHeight,l?l.scrollHeight:0,l?l.clientHeight:0),E=-a.scrollLeft+wF(r),v=-a.scrollTop;return rp(l||s).direction==="rtl"&&(E+=H_(s.clientWidth,l?l.clientWidth:0)-d),{width:d,height:p,x:E,y:v}}function RF(r){var t=rp(r),s=t.overflow,a=t.overflowX,l=t.overflowY;return/auto|scroll|overlay|hidden/.test(s+l+a)}function Yee(r){return["html","body","#document"].indexOf(Nh(r))>=0?r.ownerDocument.body:cu(r)&&RF(r)?r:Yee(BN(r))}function Sw(r,t){var s;t===void 0&&(t=[]);var a=Yee(r),l=a===((s=r.ownerDocument)==null?void 0:s.body),d=El(a),p=l?[d].concat(d.visualViewport||[],RF(a)?a:[]):a,E=t.concat(p);return l?E:E.concat(Sw(BN(p)))}function dU(r){return Object.assign({},r,{left:r.x,top:r.y,right:r.x+r.width,bottom:r.y+r.height})}function PDe(r,t){var s=OS(r,!1,t==="fixed");return s.top=s.top+r.clientTop,s.left=s.left+r.clientLeft,s.bottom=s.top+r.clientHeight,s.right=s.left+r.clientWidth,s.width=r.clientWidth,s.height=r.clientHeight,s.x=s.left,s.y=s.top,s}function T7(r,t,s){return t===Wee?dU(ADe(r,s)):J_(t)?PDe(t,s):dU(ODe(Jm(r)))}function NDe(r){var t=Sw(BN(r)),s=["absolute","fixed"].indexOf(rp(r).position)>=0,a=s&&cu(r)?ER(r):r;return J_(a)?t.filter(function(l){return J_(l)&&Hee(l,a)&&Nh(l)!=="body"}):[]}function kDe(r,t,s,a){var l=t==="clippingParents"?NDe(r):[].concat(t),d=[].concat(l,[s]),p=d[0],E=d.reduce(function(v,b){var R=T7(r,b,a);return v.top=H_(R.top,v.top),v.right=$P(R.right,v.right),v.bottom=$P(R.bottom,v.bottom),v.left=H_(R.left,v.left),v},T7(r,p,a));return E.width=E.right-E.left,E.height=E.bottom-E.top,E.x=E.left,E.y=E.top,E}function Xee(r){var t=r.reference,s=r.element,a=r.placement,l=a?Th(a):null,d=a?PS(a):null,p=t.x+t.width/2-s.width/2,E=t.y+t.height/2-s.height/2,v;switch(l){case Uc:v={x:p,y:t.y-s.height};break;case du:v={x:p,y:t.y+t.height};break;case hu:v={x:t.x+t.width,y:E};break;case Vc:v={x:t.x-s.width,y:E};break;default:v={x:t.x,y:t.y}}var b=l?TF(l):null;if(b!=null){var R=b==="y"?"height":"width";switch(d){case IS:v[b]=v[b]-(t[R]/2-s[R]/2);break;case zw:v[b]=v[b]+(t[R]/2-s[R]/2);break}}return v}function Hw(r,t){t===void 0&&(t={});var s=t,a=s.placement,l=a===void 0?r.placement:a,d=s.strategy,p=d===void 0?r.strategy:d,E=s.boundary,v=E===void 0?Qke:E,b=s.rootBoundary,R=b===void 0?Wee:b,O=s.elementContext,N=O===void 0?Ab:O,F=s.altBoundary,H=F===void 0?!1:F,z=s.padding,G=z===void 0?0:z,ee=qee(typeof G!="number"?G:$ee(G,_R)),J=N===Ab?Zke:Ab,re=r.rects.popper,de=r.elements[H?J:N],se=kDe(J_(de)?de:de.contextElement||Jm(r.elements.popper),v,R,p),ye=OS(r.elements.reference),Q=Xee({reference:ye,element:re,placement:l}),ne=dU(Object.assign({},re,Q)),oe=N===Ab?ne:ye,ue={top:se.top-oe.top+ee.top,bottom:oe.bottom-se.bottom+ee.bottom,left:se.left-oe.left+ee.left,right:oe.right-se.right+ee.right},Ee=r.modifiersData.offset;if(N===Ab&&Ee){var fe=Ee[l];Object.keys(ue).forEach(function(le){var Le=[hu,du].indexOf(le)>=0?1:-1,pt=[Uc,du].indexOf(le)>=0?"y":"x";ue[le]+=fe[pt]*Le})}return ue}function DDe(r,t){t===void 0&&(t={});var s=t,a=s.placement,l=s.boundary,d=s.rootBoundary,p=s.padding,E=s.flipVariations,v=s.allowedAutoPlacements,b=v===void 0?Gee:v,R=PS(a),O=R?E?E7:E7.filter(function(H){return PS(H)===R}):_R,N=O.filter(function(H){return b.indexOf(H)>=0});N.length===0&&(N=O);var F=N.reduce(function(H,z){return H[z]=Hw(r,{placement:z,boundary:l,rootBoundary:d,padding:p})[Th(z)],H},{});return Object.keys(F).sort(function(H,z){return F[H]-F[z]})}function LDe(r){if(Th(r)===yF)return[];var t=gP(r);return[S7(r),t,S7(t)]}function xDe(r){var t=r.state,s=r.options,a=r.name;if(!t.modifiersData[a]._skip){for(var l=s.mainAxis,d=l===void 0?!0:l,p=s.altAxis,E=p===void 0?!0:p,v=s.fallbackPlacements,b=s.padding,R=s.boundary,O=s.rootBoundary,N=s.altBoundary,F=s.flipVariations,H=F===void 0?!0:F,z=s.allowedAutoPlacements,G=t.options.placement,ee=Th(G),J=ee===G,re=v||(J||!H?[gP(G)]:LDe(G)),de=[G].concat(re).reduce(function(Fe,lt){return Fe.concat(Th(lt)===yF?DDe(t,{placement:lt,boundary:R,rootBoundary:O,padding:b,flipVariations:H,allowedAutoPlacements:z}):lt)},[]),se=t.rects.reference,ye=t.rects.popper,Q=new Map,ne=!0,oe=de[0],ue=0;ue<de.length;ue++){var Ee=de[ue],fe=Th(Ee),le=PS(Ee)===IS,Le=[Uc,du].indexOf(fe)>=0,pt=Le?"width":"height",et=Hw(t,{placement:Ee,boundary:R,rootBoundary:O,altBoundary:N,padding:b}),Oe=Le?le?hu:Vc:le?du:Uc;se[pt]>ye[pt]&&(Oe=gP(Oe));var Ue=gP(Oe),Me=[];if(d&&Me.push(et[fe]<=0),E&&Me.push(et[Oe]<=0,et[Ue]<=0),Me.every(function(Fe){return Fe})){oe=Ee,ne=!1;break}Q.set(Ee,Me)}if(ne)for(var it=H?3:1,Ae=function(lt){var Et=de.find(function(Nt){var $t=Q.get(Nt);if($t)return $t.slice(0,lt).every(function(xt){return xt})});if(Et)return oe=Et,"break"},qe=it;qe>0;qe--){var Ze=Ae(qe);if(Ze==="break")break}t.placement!==oe&&(t.modifiersData[a]._skip=!0,t.placement=oe,t.reset=!0)}}const MDe={name:"flip",enabled:!0,phase:"main",fn:xDe,requiresIfExists:["offset"],data:{_skip:!1}};function b7(r,t,s){return s===void 0&&(s={x:0,y:0}),{top:r.top-t.height-s.y,right:r.right-t.width+s.x,bottom:r.bottom-t.height+s.y,left:r.left-t.width-s.x}}function w7(r){return[Uc,hu,du,Vc].some(function(t){return r[t]>=0})}function UDe(r){var t=r.state,s=r.name,a=t.rects.reference,l=t.rects.popper,d=t.modifiersData.preventOverflow,p=Hw(t,{elementContext:"reference"}),E=Hw(t,{altBoundary:!0}),v=b7(p,a),b=b7(E,l,d),R=w7(v),O=w7(b);t.modifiersData[s]={referenceClippingOffsets:v,popperEscapeOffsets:b,isReferenceHidden:R,hasPopperEscaped:O},t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-reference-hidden":R,"data-popper-escaped":O})}const VDe={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:UDe};function FDe(r,t,s){var a=Th(r),l=[Vc,Uc].indexOf(a)>=0?-1:1,d=typeof s=="function"?s(Object.assign({},t,{placement:r})):s,p=d[0],E=d[1];return p=p||0,E=(E||0)*l,[Vc,hu].indexOf(a)>=0?{x:E,y:p}:{x:p,y:E}}function jDe(r){var t=r.state,s=r.options,a=r.name,l=s.offset,d=l===void 0?[0,0]:l,p=Gee.reduce(function(R,O){return R[O]=FDe(O,t.rects,d),R},{}),E=p[t.placement],v=E.x,b=E.y;t.modifiersData.popperOffsets!=null&&(t.modifiersData.popperOffsets.x+=v,t.modifiersData.popperOffsets.y+=b),t.modifiersData[a]=p}const BDe={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:jDe};function WDe(r){var t=r.state,s=r.name;t.modifiersData[s]=Xee({reference:t.rects.reference,element:t.rects.popper,placement:t.placement})}const GDe={name:"popperOffsets",enabled:!0,phase:"read",fn:WDe,data:{}};function zDe(r){return r==="x"?"y":"x"}function HDe(r){var t=r.state,s=r.options,a=r.name,l=s.mainAxis,d=l===void 0?!0:l,p=s.altAxis,E=p===void 0?!1:p,v=s.boundary,b=s.rootBoundary,R=s.altBoundary,O=s.padding,N=s.tether,F=N===void 0?!0:N,H=s.tetherOffset,z=H===void 0?0:H,G=Hw(t,{boundary:v,rootBoundary:b,padding:O,altBoundary:R}),ee=Th(t.placement),J=PS(t.placement),re=!J,de=TF(ee),se=zDe(de),ye=t.modifiersData.popperOffsets,Q=t.rects.reference,ne=t.rects.popper,oe=typeof z=="function"?z(Object.assign({},t.rects,{placement:t.placement})):z,ue=typeof oe=="number"?{mainAxis:oe,altAxis:oe}:Object.assign({mainAxis:0,altAxis:0},oe),Ee=t.modifiersData.offset?t.modifiersData.offset[t.placement]:null,fe={x:0,y:0};if(ye){if(d){var le,Le=de==="y"?Uc:Vc,pt=de==="y"?du:hu,et=de==="y"?"height":"width",Oe=ye[de],Ue=Oe+G[Le],Me=Oe-G[pt],it=F?-ne[et]/2:0,Ae=J===IS?Q[et]:ne[et],qe=J===IS?-ne[et]:-Q[et],Ze=t.elements.arrow,Fe=F&&Ze?SF(Ze):{width:0,height:0},lt=t.modifiersData["arrow#persistent"]?t.modifiersData["arrow#persistent"].padding:Kee(),Et=lt[Le],Nt=lt[pt],$t=vw(0,Q[et],Fe[et]),xt=re?Q[et]/2-it-$t-Et-ue.mainAxis:Ae-$t-Et-ue.mainAxis,En=re?-Q[et]/2+it+$t+Nt+ue.mainAxis:qe+$t+Nt+ue.mainAxis,In=t.elements.arrow&&ER(t.elements.arrow),hn=In?de==="y"?In.clientTop||0:In.clientLeft||0:0,Kn=(le=Ee==null?void 0:Ee[de])!=null?le:0,Ar=Oe+xt-Kn-hn,Zt=Oe+En-Kn,Zn=vw(F?$P(Ue,Ar):Ue,Oe,F?H_(Me,Zt):Me);ye[de]=Zn,fe[de]=Zn-Oe}if(E){var zt,ve=de==="x"?Uc:Vc,Ne=de==="x"?du:hu,We=ye[se],dt=se==="y"?"height":"width",mt=We+G[ve],gt=We-G[Ne],Vt=[Uc,Vc].indexOf(ee)!==-1,_n=(zt=Ee==null?void 0:Ee[se])!=null?zt:0,kn=Vt?mt:We-Q[dt]-ne[dt]-_n+ue.altAxis,rn=Vt?We+Q[dt]+ne[dt]-_n-ue.altAxis:gt,ur=F&&Vt?mDe(kn,We,rn):vw(F?kn:mt,We,F?rn:gt);ye[se]=ur,fe[se]=ur-We}t.modifiersData[a]=fe}}const KDe={name:"preventOverflow",enabled:!0,phase:"main",fn:HDe,requiresIfExists:["offset"]};function qDe(r){return{scrollLeft:r.scrollLeft,scrollTop:r.scrollTop}}function $De(r){return r===El(r)||!cu(r)?bF(r):qDe(r)}function YDe(r){var t=r.getBoundingClientRect(),s=AS(t.width)/r.offsetWidth||1,a=AS(t.height)/r.offsetHeight||1;return s!==1||a!==1}function XDe(r,t,s){s===void 0&&(s=!1);var a=cu(t),l=cu(t)&&YDe(t),d=Jm(t),p=OS(r,l,s),E={scrollLeft:0,scrollTop:0},v={x:0,y:0};return(a||!a&&!s)&&((Nh(t)!=="body"||RF(d))&&(E=$De(t)),cu(t)?(v=OS(t,!0),v.x+=t.clientLeft,v.y+=t.clientTop):d&&(v.x=wF(d))),{x:p.left+E.scrollLeft-v.x,y:p.top+E.scrollTop-v.y,width:p.width,height:p.height}}function JDe(r){var t=new Map,s=new Set,a=[];r.forEach(function(d){t.set(d.name,d)});function l(d){s.add(d.name);var p=[].concat(d.requires||[],d.requiresIfExists||[]);p.forEach(function(E){if(!s.has(E)){var v=t.get(E);v&&l(v)}}),a.push(d)}return r.forEach(function(d){s.has(d.name)||l(d)}),a}function QDe(r){var t=JDe(r);return lDe.reduce(function(s,a){return s.concat(t.filter(function(l){return l.phase===a}))},[])}function ZDe(r){var t;return function(){return t||(t=new Promise(function(s){Promise.resolve().then(function(){t=void 0,s(r())})})),t}}function e1e(r){var t=r.reduce(function(s,a){var l=s[a.name];return s[a.name]=l?Object.assign({},l,a,{options:Object.assign({},l.options,a.options),data:Object.assign({},l.data,a.data)}):a,s},{});return Object.keys(t).map(function(s){return t[s]})}var R7={placement:"bottom",modifiers:[],strategy:"absolute"};function C7(){for(var r=arguments.length,t=new Array(r),s=0;s<r;s++)t[s]=arguments[s];return!t.some(function(a){return!(a&&typeof a.getBoundingClientRect=="function")})}function t1e(r){r===void 0&&(r={});var t=r,s=t.defaultModifiers,a=s===void 0?[]:s,l=t.defaultOptions,d=l===void 0?R7:l;return function(E,v,b){b===void 0&&(b=d);var R={placement:"bottom",orderedModifiers:[],options:Object.assign({},R7,d),modifiersData:{},elements:{reference:E,popper:v},attributes:{},styles:{}},O=[],N=!1,F={state:R,setOptions:function(ee){var J=typeof ee=="function"?ee(R.options):ee;z(),R.options=Object.assign({},d,R.options,J),R.scrollParents={reference:J_(E)?Sw(E):E.contextElement?Sw(E.contextElement):[],popper:Sw(v)};var re=QDe(e1e([].concat(a,R.options.modifiers)));return R.orderedModifiers=re.filter(function(de){return de.enabled}),H(),F.update()},forceUpdate:function(){if(!N){var ee=R.elements,J=ee.reference,re=ee.popper;if(C7(J,re)){R.rects={reference:XDe(J,ER(re),R.options.strategy==="fixed"),popper:SF(re)},R.reset=!1,R.placement=R.options.placement,R.orderedModifiers.forEach(function(ue){return R.modifiersData[ue.name]=Object.assign({},ue.data)});for(var de=0;de<R.orderedModifiers.length;de++){if(R.reset===!0){R.reset=!1,de=-1;continue}var se=R.orderedModifiers[de],ye=se.fn,Q=se.options,ne=Q===void 0?{}:Q,oe=se.name;typeof ye=="function"&&(R=ye({state:R,options:ne,name:oe,instance:F})||R)}}}},update:ZDe(function(){return new Promise(function(G){F.forceUpdate(),G(R)})}),destroy:function(){z(),N=!0}};if(!C7(E,v))return F;F.setOptions(b).then(function(G){!N&&b.onFirstUpdate&&b.onFirstUpdate(G)});function H(){R.orderedModifiers.forEach(function(G){var ee=G.name,J=G.options,re=J===void 0?{}:J,de=G.effect;if(typeof de=="function"){var se=de({state:R,name:ee,instance:F,options:re}),ye=function(){};O.push(se||ye)}})}function z(){O.forEach(function(G){return G()}),O=[]}return F}}var n1e=[RDe,GDe,bDe,hDe,BDe,MDe,KDe,yDe,VDe],r1e=t1e({defaultModifiers:n1e});const kv=(r,t)=>({var:r,varRef:t?`var(${r}, ${t})`:`var(${r})`}),xs={arrowShadowColor:kv("--popper-arrow-shadow-color"),arrowSize:kv("--popper-arrow-size","8px"),arrowSizeHalf:kv("--popper-arrow-size-half"),arrowBg:kv("--popper-arrow-bg"),transformOrigin:kv("--popper-transform-origin"),arrowOffset:kv("--popper-arrow-offset")};function i1e(r){if(r.includes("top"))return"1px 1px 0px 0 var(--popper-arrow-shadow-color)";if(r.includes("bottom"))return"-1px -1px 0px 0 var(--popper-arrow-shadow-color)";if(r.includes("right"))return"-1px 1px 0px 0 var(--popper-arrow-shadow-color)";if(r.includes("left"))return"1px -1px 0px 0 var(--popper-arrow-shadow-color)"}const s1e={top:"bottom center","top-start":"bottom left","top-end":"bottom right",bottom:"top center","bottom-start":"top left","bottom-end":"top right",left:"right center","left-start":"right top","left-end":"right bottom",right:"left center","right-start":"left top","right-end":"left bottom"},o1e=r=>s1e[r],I7={scroll:!0,resize:!0};function a1e(r){let t;return typeof r=="object"?t={enabled:!0,options:{...I7,...r}}:t={enabled:r,options:I7},t}const c1e={name:"matchWidth",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:({state:r})=>{r.styles.popper.width=`${r.rects.reference.width}px`},effect:({state:r})=>()=>{const t=r.elements.reference;r.elements.popper.style.width=`${t.offsetWidth}px`}},l1e={name:"transformOrigin",enabled:!0,phase:"write",fn:({state:r})=>{A7(r)},effect:({state:r})=>()=>{A7(r)}},A7=r=>{r.elements.popper.style.setProperty(xs.transformOrigin.var,o1e(r.placement))},u1e={name:"positionArrow",enabled:!0,phase:"afterWrite",fn:({state:r})=>{d1e(r)}},d1e=r=>{var s;if(!r.placement)return;const t=h1e(r.placement);if((s=r.elements)!=null&&s.arrow&&t){Object.assign(r.elements.arrow.style,{[t.property]:t.value,width:xs.arrowSize.varRef,height:xs.arrowSize.varRef,zIndex:-1});const a={[xs.arrowSizeHalf.var]:`calc(${xs.arrowSize.varRef} / 2 - 1px)`,[xs.arrowOffset.var]:`calc(${xs.arrowSizeHalf.varRef} * -1)`};for(const l in a)r.elements.arrow.style.setProperty(l,a[l])}},h1e=r=>{if(r.startsWith("top"))return{property:"bottom",value:xs.arrowOffset.varRef};if(r.startsWith("bottom"))return{property:"top",value:xs.arrowOffset.varRef};if(r.startsWith("left"))return{property:"right",value:xs.arrowOffset.varRef};if(r.startsWith("right"))return{property:"left",value:xs.arrowOffset.varRef}},f1e={name:"innerArrow",enabled:!0,phase:"main",requires:["arrow"],fn:({state:r})=>{O7(r)},effect:({state:r})=>()=>{O7(r)}},O7=r=>{if(!r.elements.arrow)return;const t=r.elements.arrow.querySelector("[data-popper-arrow-inner]");if(!t)return;const s=i1e(r.placement);s&&t.style.setProperty("--popper-arrow-default-shadow",s),Object.assign(t.style,{transform:"rotate(45deg)",background:xs.arrowBg.varRef,top:0,left:0,width:"100%",height:"100%",position:"absolute",zIndex:"inherit",boxShadow:"var(--popper-arrow-shadow, var(--popper-arrow-default-shadow))"})},p1e={"start-start":{ltr:"left-start",rtl:"right-start"},"start-end":{ltr:"left-end",rtl:"right-end"},"end-start":{ltr:"right-start",rtl:"left-start"},"end-end":{ltr:"right-end",rtl:"left-end"},start:{ltr:"left",rtl:"right"},end:{ltr:"right",rtl:"left"}},m1e={"auto-start":"auto-end","auto-end":"auto-start","top-start":"top-end","top-end":"top-start","bottom-start":"bottom-end","bottom-end":"bottom-start"};function g1e(r,t="ltr"){var a;const s=((a=p1e[r])==null?void 0:a[t])||r;return t==="ltr"?s:m1e[r]??s}function CF(r={}){const{enabled:t=!0,modifiers:s,placement:a="bottom",strategy:l="absolute",arrowPadding:d=8,eventListeners:p=!0,offset:E,gutter:v=8,flip:b=!0,boundary:R="clippingParents",preventOverflow:O=!0,matchWidth:N,direction:F="ltr"}=r,H=V.useRef(null),z=V.useRef(null),G=V.useRef(null),ee=g1e(a,F),J=V.useRef(()=>{}),re=V.useCallback(()=>{var ue;!t||!H.current||!z.current||((ue=J.current)==null||ue.call(J),G.current=r1e(H.current,z.current,{placement:ee,modifiers:[f1e,u1e,l1e,{...c1e,enabled:!!N},{name:"eventListeners",...a1e(p)},{name:"arrow",options:{padding:d}},{name:"offset",options:{offset:E??[0,v]}},{name:"flip",enabled:!!b,options:{padding:8}},{name:"preventOverflow",enabled:!!O,options:{boundary:R}},...s??[]],strategy:l}),G.current.forceUpdate(),J.current=G.current.destroy)},[ee,t,s,N,p,d,E,v,b,O,R,l]);V.useEffect(()=>()=>{var ue;!H.current&&!z.current&&((ue=G.current)==null||ue.destroy(),G.current=null)},[]);const de=V.useCallback(ue=>{H.current=ue,re()},[re]),se=V.useCallback((ue={},Ee=null)=>({...ue,ref:Gi(de,Ee)}),[de]),ye=V.useCallback(ue=>{z.current=ue,re()},[re]),Q=V.useCallback((ue={},Ee=null)=>({...ue,ref:Gi(ye,Ee),style:{...ue.style,position:l,minWidth:N?void 0:"max-content",inset:"0 auto auto 0"}}),[l,ye,N]),ne=V.useCallback((ue={},Ee=null)=>{const{size:fe,shadowColor:le,bg:Le,style:pt,...et}=ue;return{...et,ref:Ee,"data-popper-arrow":"",style:_1e(ue)}},[]),oe=V.useCallback((ue={},Ee=null)=>({...ue,ref:Ee,"data-popper-arrow-inner":""}),[]);return{update(){var ue;(ue=G.current)==null||ue.update()},forceUpdate(){var ue;(ue=G.current)==null||ue.forceUpdate()},transformOrigin:xs.transformOrigin.varRef,referenceRef:de,popperRef:ye,getPopperProps:Q,getArrowProps:ne,getArrowInnerProps:oe,getReferenceProps:se}}function _1e(r){const{size:t,shadowColor:s,bg:a,style:l}=r,d={...l,position:"absolute"};return t&&(d["--popper-arrow-size"]=t),s&&(d["--popper-arrow-shadow-color"]=s),a&&(d["--popper-arrow-bg"]=a),d}function E1e(){const r=V.useRef(new Map),t=r.current,s=V.useCallback((l,d,p,E)=>{r.current.set(p,{type:d,el:l,options:E}),l.addEventListener(d,p,E)},[]),a=V.useCallback((l,d,p,E)=>{l.removeEventListener(d,p,E),r.current.delete(p)},[]);return V.useEffect(()=>()=>{t.forEach((l,d)=>{a(l.el,l.type,d,l.options)})},[a,t]),{add:s,remove:a}}function YM(r){var l,d;const t=((d=(l=r.composedPath)==null?void 0:l.call(r))==null?void 0:d[0])??r.target,{tagName:s,isContentEditable:a}=t;return s!=="INPUT"&&s!=="TEXTAREA"&&a!==!0}function Jee(r={}){const{ref:t,isDisabled:s,isFocusable:a,clickOnEnter:l=!0,clickOnSpace:d=!0,onMouseDown:p,onMouseUp:E,onClick:v,onKeyDown:b,onKeyUp:R,tabIndex:O,onMouseOver:N,onMouseLeave:F,...H}=r,[z,G]=V.useState(!0),[ee,J]=V.useState(!1),re=E1e(),de=Oe=>{Oe&&Oe.tagName!=="BUTTON"&&G(!1)},se=z?O:O||0,ye=s&&!a,Q=V.useCallback(Oe=>{if(s){Oe.stopPropagation(),Oe.preventDefault();return}Oe.currentTarget.focus(),v==null||v(Oe)},[s,v]),ne=V.useCallback(Oe=>{ee&&YM(Oe)&&(Oe.preventDefault(),Oe.stopPropagation(),J(!1),re.remove(document,"keyup",ne,!1))},[ee,re]),oe=V.useCallback(Oe=>{if(b==null||b(Oe),s||Oe.defaultPrevented||Oe.metaKey||!YM(Oe.nativeEvent)||z)return;const Ue=l&&Oe.key==="Enter";d&&Oe.key===" "&&(Oe.preventDefault(),J(!0)),Ue&&(Oe.preventDefault(),Oe.currentTarget.click()),re.add(document,"keyup",ne,!1)},[s,z,b,l,d,re,ne]),ue=V.useCallback(Oe=>{if(R==null||R(Oe),s||Oe.defaultPrevented||Oe.metaKey||!YM(Oe.nativeEvent)||z)return;d&&Oe.key===" "&&(Oe.preventDefault(),J(!1),Oe.currentTarget.click())},[d,z,s,R]),Ee=V.useCallback(Oe=>{Oe.button===0&&(J(!1),re.remove(document,"mouseup",Ee,!1))},[re]),fe=V.useCallback(Oe=>{if(Oe.button!==0)return;if(s){Oe.stopPropagation(),Oe.preventDefault();return}z||J(!0),Oe.currentTarget.focus({preventScroll:!0}),re.add(document,"mouseup",Ee,!1),p==null||p(Oe)},[s,z,p,re,Ee]),le=V.useCallback(Oe=>{Oe.button===0&&(z||J(!1),E==null||E(Oe))},[E,z]),Le=V.useCallback(Oe=>{if(s){Oe.preventDefault();return}N==null||N(Oe)},[s,N]),pt=V.useCallback(Oe=>{ee&&(Oe.preventDefault(),J(!1)),F==null||F(Oe)},[ee,F]),et=Gi(t,de);return z?{...H,ref:et,type:"button","aria-disabled":ye?void 0:s,disabled:ye,onClick:Q,onMouseDown:p,onMouseUp:E,onKeyUp:R,onKeyDown:b,onMouseOver:N,onMouseLeave:F}:{...H,ref:et,role:"button","data-active":zn(ee),"aria-disabled":s?"true":void 0,tabIndex:ye?void 0:se,onClick:Q,onMouseDown:fe,onMouseUp:le,onKeyUp:ue,onKeyDown:oe,onMouseOver:Le,onMouseLeave:pt}}const[y1e,v1e,S1e,T1e]=YZ(),[b1e,yR]=Mi({strict:!1,name:"MenuContext"});function Qee(r){return(r==null?void 0:r.ownerDocument)??document}function w1e(r){return Qee(r).activeElement===r}function R1e(r={}){const{id:t,closeOnSelect:s=!0,closeOnBlur:a=!0,initialFocusRef:l,autoSelect:d=!0,isLazy:p,isOpen:E,defaultIsOpen:v,onClose:b,onOpen:R,placement:O="bottom-start",lazyBehavior:N="unmount",direction:F,computePositionOnMount:H=!1,...z}=r,G=V.useRef(null),ee=V.useRef(null),J=V.useRef(!0),re=S1e(),de=V.useCallback(()=>{requestAnimationFrame(()=>{var Ze;(Ze=G.current)==null||Ze.focus({preventScroll:!1})})},[]),se=V.useCallback(()=>{const Ze=setTimeout(()=>{var Fe,lt;if(l)(Fe=l.current)==null||Fe.focus();else if(!re.count())(lt=G.current)==null||lt.focus({preventScroll:!1});else{const Et=re.firstEnabled();Et&&Le(Et.index)}});Me.current.add(Ze)},[re,l]),ye=V.useCallback(()=>{const Ze=setTimeout(()=>{var Fe;if(!re.count())(Fe=G.current)==null||Fe.focus({preventScroll:!1});else{const lt=re.lastEnabled();lt&&Le(lt.index)}});Me.current.add(Ze)},[re]),Q=V.useCallback(()=>{R==null||R(),d?se():de()},[d,se,de,R]),{isOpen:ne,onOpen:oe,onClose:ue,onToggle:Ee}=WS({isOpen:E,defaultIsOpen:v,onClose:b,onOpen:Q});wJ({enabled:ne&&a,ref:G,handler:Ze=>{var lt,Et,Nt;const Fe=((Et=(lt=Ze.composedPath)==null?void 0:lt.call(Ze))==null?void 0:Et[0])??Ze.target;(Nt=ee.current)!=null&&Nt.contains(Fe)||ue()}});const fe=CF({...z,enabled:ne||H,placement:O,direction:F}),[le,Le]=V.useState(-1);SJ(G,{focusRef:ee,visible:ne,shouldFocus:!0});const pt=yJ({isOpen:ne,ref:G}),[et,Oe]=x_e(t,"menu-button","menu-list"),Ue=V.useCallback(()=>{oe(),de()},[oe,de]),Me=V.useRef(new Set([]));V.useEffect(()=>{const Ze=Me.current;return()=>{Ze.forEach(Fe=>clearTimeout(Fe)),Ze.clear()}},[]),Um(()=>{var Ze;ne||(Le(-1),(Ze=G.current)==null||Ze.scrollTo(0,0))},[ne]),Um(()=>{ne&&le===-1&&de()},[le,ne]),V.useEffect(()=>{var Fe;if(!ne)return;const Ze=re.item(le);(Fe=Ze==null?void 0:Ze.node)==null||Fe.focus({preventScroll:!J.current})},[re,le,ne]);const it=V.useCallback(()=>{oe(),se()},[se,oe]),Ae=V.useCallback(()=>{J.current=!0,oe(),ye()},[oe,ye]),qe=V.useCallback(()=>{var Nt,$t;const Ze=Qee(G.current),Fe=(Nt=G.current)==null?void 0:Nt.contains(Ze.activeElement);if(!(ne&&!Fe))return;const Et=($t=re.item(le))==null?void 0:$t.node;Et==null||Et.focus({preventScroll:!J.current})},[ne,le,re]);return{openAndFocusMenu:Ue,openAndFocusFirstItem:it,openAndFocusLastItem:Ae,onTransitionEnd:qe,unstable__animationState:pt,descendants:re,popper:fe,buttonId:et,menuId:Oe,forceUpdate:fe.forceUpdate,orientation:"vertical",isOpen:ne,onToggle:Ee,onOpen:oe,onClose:ue,menuRef:G,buttonRef:ee,focusedIndex:le,closeOnSelect:s,closeOnBlur:a,autoSelect:d,setFocusedIndex:Le,isLazy:p,lazyBehavior:N,initialFocusRef:l,scrollIntoViewRef:J}}function C1e(r={},t=null){const s=yR(),{onToggle:a,popper:l,openAndFocusFirstItem:d,openAndFocusLastItem:p,scrollIntoViewRef:E}=s,v=V.useCallback(b=>{const R=b.key,N={Enter:d,ArrowDown:d,ArrowUp:p}[R];N&&(E.current=!0,b.preventDefault(),b.stopPropagation(),N(b))},[d,p,E]);return{...r,ref:Gi(s.buttonRef,t,l.referenceRef),id:s.buttonId,"data-active":zn(s.isOpen),"aria-expanded":s.isOpen,"aria-haspopup":"menu","aria-controls":s.menuId,onClick:Yn(r.onClick,a),onKeyDown:Yn(r.onKeyDown,v)}}function hU(r){var t;return P1e(r)&&!!((t=r==null?void 0:r.getAttribute("role"))!=null&&t.startsWith("menuitem"))}function I1e(r={},t=null){const s=yR();if(!s)throw new Error("useMenuContext: context is undefined. Seems you forgot to wrap component within <Menu>");const{focusedIndex:a,setFocusedIndex:l,menuRef:d,isOpen:p,onClose:E,menuId:v,isLazy:b,lazyBehavior:R,scrollIntoViewRef:O,unstable__animationState:N}=s,F=v1e(),H=Jke({preventDefault:J=>J.key!==" "&&hU(J.target)}),z=V.useCallback(J=>{if(!J.currentTarget.contains(J.target))return;const re=J.key,se={Tab:Q=>Q.preventDefault(),Escape:Q=>{Q.stopPropagation(),E()},ArrowDown:()=>{O.current=!0;const Q=F.nextEnabled(a)??F.firstEnabled();Q&&l(Q.index)},ArrowUp:()=>{O.current=!0;const Q=F.prevEnabled(a)??F.firstEnabled();Q&&l(Q.index)}}[re];if(se){J.preventDefault(),se(J);return}const ye=H(Q=>{const ne=Yke(F.values(),Q,oe=>{var ue;return((ue=oe==null?void 0:oe.node)==null?void 0:ue.textContent)??""},F.item(a));if(ne){const oe=F.indexOf(ne.node);l(oe)}});hU(J.target)&&ye(J)},[F,a,H,E,l,O]),G=V.useRef(!1);p&&(G.current=!0);const ee=tV({wasSelected:G.current,enabled:b,mode:R,isSelected:N.present});return{...r,ref:Gi(d,t),children:ee?r.children:null,tabIndex:-1,role:"menu",id:v,style:{...r.style,transformOrigin:"var(--popper-transform-origin)"},"aria-orientation":"vertical",onKeyDown:Yn(r.onKeyDown,z)}}function A1e(r={}){const{popper:t,isOpen:s}=yR();return t.getPopperProps({...r,style:{visibility:s?"visible":"hidden",...r.style}})}function O1e(r={},t=null){const{onMouseEnter:s,onMouseMove:a,onMouseLeave:l,onClick:d,onFocus:p,isDisabled:E,isFocusable:v,closeOnSelect:b,type:R,...O}=r,N=yR(),{setFocusedIndex:F,focusedIndex:H,closeOnSelect:z,onClose:G,menuId:ee,scrollIntoViewRef:J}=N,re=V.useRef(null),de=`${ee}-menuitem-${V.useId()}`,{index:se,register:ye}=T1e({disabled:E&&!v}),Q=V.useCallback(Le=>{s==null||s(Le),!E&&(J.current=!1,F(se))},[F,se,E,s,J]),ne=V.useCallback(Le=>{a==null||a(Le),re.current&&!w1e(re.current)&&Q(Le)},[Q,a]),oe=V.useCallback(Le=>{l==null||l(Le),!E&&F(-1)},[F,E,l]),ue=V.useCallback(Le=>{d==null||d(Le),hU(Le.currentTarget)&&(b??z)&&G()},[G,d,z,b]),Ee=V.useCallback(Le=>{p==null||p(Le),F(se)},[F,p,se]),fe=se===H,le=Jee({onClick:ue,onFocus:Ee,onMouseEnter:Q,onMouseMove:ne,onMouseLeave:oe,ref:Gi(ye,re,t),isDisabled:E,isFocusable:v});return{...O,...le,type:R??le.type,id:de,role:"menuitem",tabIndex:fe?0:-1}}function P1e(r){if(!N1e(r))return!1;const t=r.ownerDocument.defaultView??window;return r instanceof t.HTMLElement}function N1e(r){return r!=null&&typeof r=="object"&&"nodeType"in r&&r.nodeType===Node.ELEMENT_NODE}const[k1e,vR]=Mi({name:"MenuStylesContext",errorMessage:`useMenuStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Menu />" `}),IF=r=>{const{children:t}=r,s=jc("Menu",r),a=zi(r),{direction:l}=qS(),{descendants:d,...p}=R1e({...a,direction:l}),E=V.useMemo(()=>p,[p]),{isOpen:v,onClose:b,forceUpdate:R}=E;return D.jsx(y1e,{value:d,children:D.jsx(b1e,{value:E,children:D.jsx(k1e,{value:s,children:xc(t,{isOpen:v,onClose:b,forceUpdate:R})})})})};IF.displayName="Menu";const D1e=qt((r,t)=>{const s=vR();return D.jsx(Ot.button,{ref:t,...r,__css:{display:"inline-flex",appearance:"none",alignItems:"center",outline:0,...s.button}})}),AF=qt((r,t)=>{const{children:s,as:a,...l}=r,d=C1e(l,t),p=a||D1e;return D.jsx(p,{...d,className:dn("chakra-menu__menu-button",r.className),children:D.jsx(Ot.span,{__css:{pointerEvents:"none",flex:"1 1 auto",minW:0},children:r.children})})});AF.displayName="MenuButton";const Zee=qt((r,t)=>{const s=vR();return D.jsx(Ot.span,{ref:t,...r,__css:s.command,className:"chakra-menu__command"})});Zee.displayName="MenuCommand";const ete=r=>{const{className:t,children:s,...a}=r,l=vR(),d=V.Children.only(s),p=V.isValidElement(d)?V.cloneElement(d,{focusable:"false","aria-hidden":!0,className:dn("chakra-menu__icon",d.props.className)}):null,E=dn("chakra-menu__icon-wrapper",t);return D.jsx(Ot.span,{className:E,...a,__css:l.icon,children:p})};ete.displayName="MenuIcon";const L1e=qt((r,t)=>{const{type:s,...a}=r,l=vR(),d=a.as||s?s??void 0:"button",p=V.useMemo(()=>({textDecoration:"none",color:"inherit",userSelect:"none",display:"flex",width:"100%",alignItems:"center",textAlign:"start",flex:"0 0 auto",outline:0,...l.item}),[l.item]);return D.jsx(Ot.button,{ref:t,type:d,...a,__css:p})}),Zb=qt((r,t)=>{const{icon:s,iconSpacing:a="0.75rem",command:l,commandSpacing:d="0.75rem",children:p,...E}=r,v=O1e(E,t),R=s||l?D.jsx("span",{style:{pointerEvents:"none",flex:1},children:p}):p;return D.jsxs(L1e,{...v,className:dn("chakra-menu__menuitem",v.className),children:[s&&D.jsx(ete,{fontSize:"0.8em",marginEnd:a,children:s}),R,l&&D.jsx(Zee,{marginStart:d,children:l})]})});Zb.displayName="MenuItem";const x1e={enter:{visibility:"visible",opacity:1,scale:1,transition:{duration:.2,ease:[.4,0,.2,1]}},exit:{transitionEnd:{visibility:"hidden"},opacity:0,scale:.8,transition:{duration:.1,easings:"easeOut"}}},M1e=Ot(Dh.div),OF=qt(function(t,s){var N;const{rootProps:a,motionProps:l,...d}=t,{isOpen:p,onTransitionEnd:E,unstable__animationState:v}=yR(),b=I1e(d,s),R=A1e(a),O=vR();return D.jsx(Ot.div,{...R,__css:{zIndex:t.zIndex??((N=O.list)==null?void 0:N.zIndex)},children:D.jsx(M1e,{variants:x1e,initial:!1,animate:p?"enter":"exit",__css:{outline:0,...O.list},...l,...b,className:dn("chakra-menu__menu-list",b.className),onUpdate:E,onAnimationComplete:fJ(v.onComplete,b.onAnimationComplete)})})});OF.displayName="MenuList";var U1e=function(r){if(typeof document>"u")return null;var t=Array.isArray(r)?r[0]:r;return t.ownerDocument.body},Dv=new WeakMap,xO=new WeakMap,MO={},XM=0,tte=function(r){return r&&(r.host||tte(r.parentNode))},V1e=function(r,t){return t.map(function(s){if(r.contains(s))return s;var a=tte(s);return a&&r.contains(a)?a:(console.error("aria-hidden",s,"in not contained inside",r,". Doing nothing"),null)}).filter(function(s){return!!s})},F1e=function(r,t,s,a){var l=V1e(t,Array.isArray(r)?r:[r]);MO[s]||(MO[s]=new WeakMap);var d=MO[s],p=[],E=new Set,v=new Set(l),b=function(O){!O||E.has(O)||(E.add(O),b(O.parentNode))};l.forEach(b);var R=function(O){!O||v.has(O)||Array.prototype.forEach.call(O.children,function(N){if(E.has(N))R(N);else try{var F=N.getAttribute(a),H=F!==null&&F!=="false",z=(Dv.get(N)||0)+1,G=(d.get(N)||0)+1;Dv.set(N,z),d.set(N,G),p.push(N),z===1&&H&&xO.set(N,!0),G===1&&N.setAttribute(s,"true"),H||N.setAttribute(a,"true")}catch(ee){console.error("aria-hidden: cannot operate on ",N,ee)}})};return R(t),E.clear(),XM++,function(){p.forEach(function(O){var N=Dv.get(O)-1,F=d.get(O)-1;Dv.set(O,N),d.set(O,F),N||(xO.has(O)||O.removeAttribute(a),xO.delete(O)),F||O.removeAttribute(s)}),XM--,XM||(Dv=new WeakMap,Dv=new WeakMap,xO=new WeakMap,MO={})}},j1e=function(r,t,s){s===void 0&&(s="data-aria-hidden");var a=Array.from(Array.isArray(r)?r:[r]),l=U1e(r);return l?(a.push.apply(a,Array.from(l.querySelectorAll("[aria-live]"))),F1e(a,l,s,"aria-hidden")):function(){return null}},B1e=Object.defineProperty,W1e=(r,t,s)=>t in r?B1e(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,G1e=(r,t,s)=>(W1e(r,t+"",s),s);class z1e{constructor(){G1e(this,"modals"),this.modals=new Set}add(t){return this.modals.add(t),this.modals.size}remove(t){this.modals.delete(t)}isTopModal(t){if(!t)return!1;const s=Array.from(this.modals)[this.modals.size-1];return t===s}}const fU=new z1e;function nte(r,t){const[s,a]=V.useState(0);return V.useEffect(()=>{const l=r.current;if(l){if(t){const d=fU.add(l);a(d)}return()=>{fU.remove(l),a(0)}}},[t,r]),s}function H1e(r){const{isOpen:t,onClose:s,id:a,closeOnOverlayClick:l=!0,closeOnEsc:d=!0,useInert:p=!0,onOverlayClick:E,onEsc:v}=r,b=V.useRef(null),R=V.useRef(null),[O,N,F]=q1e(a,"chakra-modal","chakra-modal--header","chakra-modal--body");K1e(b,t&&p);const H=nte(b,t),z=V.useRef(null),G=V.useCallback(oe=>{z.current=oe.target},[]),ee=V.useCallback(oe=>{oe.key==="Escape"&&(oe.stopPropagation(),d&&(s==null||s()),v==null||v())},[d,s,v]),[J,re]=V.useState(!1),[de,se]=V.useState(!1),ye=V.useCallback((oe={},ue=null)=>({role:"dialog",...oe,ref:Gi(ue,b),id:O,tabIndex:-1,"aria-modal":!0,"aria-labelledby":J?N:void 0,"aria-describedby":de?F:void 0,onClick:Yn(oe.onClick,Ee=>Ee.stopPropagation())}),[F,de,O,N,J]),Q=V.useCallback(oe=>{oe.stopPropagation(),z.current===oe.target&&fU.isTopModal(b.current)&&(l&&(s==null||s()),E==null||E())},[s,l,E]),ne=V.useCallback((oe={},ue=null)=>({...oe,ref:Gi(ue,R),onClick:Yn(oe.onClick,Q),onKeyDown:Yn(oe.onKeyDown,ee),onMouseDown:Yn(oe.onMouseDown,G)}),[ee,G,Q]);return{isOpen:t,onClose:s,headerId:N,bodyId:F,setBodyMounted:se,setHeaderMounted:re,dialogRef:b,overlayRef:R,getDialogProps:ye,getDialogContainerProps:ne,index:H}}function K1e(r,t){const s=r.current;V.useEffect(()=>{if(!(!r.current||!t))return j1e(r.current)},[t,r,s])}function q1e(r,...t){const s=V.useId(),a=r||s;return V.useMemo(()=>t.map(l=>`${l}-${a}`),[a,t])}const[$1e,JS]=Mi({name:"ModalStylesContext",errorMessage:`useModalStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Modal />" `}),[Y1e,Q_]=Mi({strict:!0,name:"ModalContext",errorMessage:"useModalContext: `context` is undefined. Seems you forgot to wrap modal components in `<Modal />`"}),xh=r=>{const t={scrollBehavior:"outside",autoFocus:!0,trapFocus:!0,returnFocusOnClose:!0,blockScrollOnMount:!0,allowPinchZoom:!1,preserveScrollBarGap:!0,motionPreset:"scale",...r,lockFocusAcrossFrames:r.lockFocusAcrossFrames||!0},{portalProps:s,children:a,autoFocus:l,trapFocus:d,initialFocusRef:p,finalFocusRef:E,returnFocusOnClose:v,blockScrollOnMount:b,allowPinchZoom:R,preserveScrollBarGap:O,motionPreset:N,lockFocusAcrossFrames:F,animatePresenceProps:H,onCloseComplete:z}=t,G=jc("Modal",t),J={...H1e(t),autoFocus:l,trapFocus:d,initialFocusRef:p,finalFocusRef:E,returnFocusOnClose:v,blockScrollOnMount:b,allowPinchZoom:R,preserveScrollBarGap:O,motionPreset:N,lockFocusAcrossFrames:F};return D.jsx(Y1e,{value:J,children:D.jsx($1e,{value:G,children:D.jsx(zS,{...H,onExitComplete:z,children:J.isOpen&&D.jsx(pu,{...s,children:a})})})})};xh.displayName="Modal";var _P="right-scroll-bar-position",EP="width-before-scroll-bar",X1e="with-scroll-bars-hidden",J1e="--removed-body-scroll-bar-size",rte=uee(),JM=function(){},WN=V.forwardRef(function(r,t){var s=V.useRef(null),a=V.useState({onScrollCapture:JM,onWheelCapture:JM,onTouchMoveCapture:JM}),l=a[0],d=a[1],p=r.forwardProps,E=r.children,v=r.className,b=r.removeScrollBar,R=r.enabled,O=r.shards,N=r.sideCar,F=r.noIsolation,H=r.inert,z=r.allowPinchZoom,G=r.as,ee=G===void 0?"div":G,J=r.gapMode,re=gR(r,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),de=N,se=aee([s,t]),ye=ph(ph({},re),l);return V.createElement(V.Fragment,null,R&&V.createElement(de,{sideCar:rte,removeScrollBar:b,shards:O,noIsolation:F,inert:H,setCallbacks:d,allowPinchZoom:!!z,lockRef:s,gapMode:J}),p?V.cloneElement(V.Children.only(E),ph(ph({},ye),{ref:se})):V.createElement(ee,ph({},ye,{className:v,ref:se}),E))});WN.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};WN.classNames={fullWidth:EP,zeroRight:_P};var Q1e=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function Z1e(){if(!document)return null;var r=document.createElement("style");r.type="text/css";var t=Q1e();return t&&r.setAttribute("nonce",t),r}function eLe(r,t){r.styleSheet?r.styleSheet.cssText=t:r.appendChild(document.createTextNode(t))}function tLe(r){var t=document.head||document.getElementsByTagName("head")[0];t.appendChild(r)}var nLe=function(){var r=0,t=null;return{add:function(s){r==0&&(t=Z1e())&&(eLe(t,s),tLe(t)),r++},remove:function(){r--,!r&&t&&(t.parentNode&&t.parentNode.removeChild(t),t=null)}}},rLe=function(){var r=nLe();return function(t,s){V.useEffect(function(){return r.add(t),function(){r.remove()}},[t&&s])}},ite=function(){var r=rLe(),t=function(s){var a=s.styles,l=s.dynamic;return r(a,l),null};return t},iLe={left:0,top:0,right:0,gap:0},QM=function(r){return parseInt(r||"",10)||0},sLe=function(r){var t=window.getComputedStyle(document.body),s=t[r==="padding"?"paddingLeft":"marginLeft"],a=t[r==="padding"?"paddingTop":"marginTop"],l=t[r==="padding"?"paddingRight":"marginRight"];return[QM(s),QM(a),QM(l)]},oLe=function(r){if(r===void 0&&(r="margin"),typeof window>"u")return iLe;var t=sLe(r),s=document.documentElement.clientWidth,a=window.innerWidth;return{left:t[0],top:t[1],right:t[2],gap:Math.max(0,a-s+t[2]-t[0])}},aLe=ite(),fS="data-scroll-locked",cLe=function(r,t,s,a){var l=r.left,d=r.top,p=r.right,E=r.gap;return s===void 0&&(s="margin"),`
  .`.concat(X1e,` {
   overflow: hidden `).concat(a,`;
   padding-right: `).concat(E,"px ").concat(a,`;
  }
  body[`).concat(fS,`] {
    overflow: hidden `).concat(a,`;
    overscroll-behavior: contain;
    `).concat([t&&"position: relative ".concat(a,";"),s==="margin"&&`
    padding-left: `.concat(l,`px;
    padding-top: `).concat(d,`px;
    padding-right: `).concat(p,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(E,"px ").concat(a,`;
    `),s==="padding"&&"padding-right: ".concat(E,"px ").concat(a,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(_P,` {
    right: `).concat(E,"px ").concat(a,`;
  }
  
  .`).concat(EP,` {
    margin-right: `).concat(E,"px ").concat(a,`;
  }
  
  .`).concat(_P," .").concat(_P,` {
    right: 0 `).concat(a,`;
  }
  
  .`).concat(EP," .").concat(EP,` {
    margin-right: 0 `).concat(a,`;
  }
  
  body[`).concat(fS,`] {
    `).concat(J1e,": ").concat(E,`px;
  }
`)},P7=function(){var r=parseInt(document.body.getAttribute(fS)||"0",10);return isFinite(r)?r:0},lLe=function(){V.useEffect(function(){return document.body.setAttribute(fS,(P7()+1).toString()),function(){var r=P7()-1;r<=0?document.body.removeAttribute(fS):document.body.setAttribute(fS,r.toString())}},[])},uLe=function(r){var t=r.noRelative,s=r.noImportant,a=r.gapMode,l=a===void 0?"margin":a;lLe();var d=V.useMemo(function(){return oLe(l)},[l]);return V.createElement(aLe,{styles:cLe(d,!t,l,s?"":"!important")})},pU=!1;if(typeof window<"u")try{var UO=Object.defineProperty({},"passive",{get:function(){return pU=!0,!0}});window.addEventListener("test",UO,UO),window.removeEventListener("test",UO,UO)}catch{pU=!1}var Lv=pU?{passive:!1}:!1,dLe=function(r){return r.tagName==="TEXTAREA"},ste=function(r,t){if(!(r instanceof Element))return!1;var s=window.getComputedStyle(r);return s[t]!=="hidden"&&!(s.overflowY===s.overflowX&&!dLe(r)&&s[t]==="visible")},hLe=function(r){return ste(r,"overflowY")},fLe=function(r){return ste(r,"overflowX")},N7=function(r,t){var s=t.ownerDocument,a=t;do{typeof ShadowRoot<"u"&&a instanceof ShadowRoot&&(a=a.host);var l=ote(r,a);if(l){var d=ate(r,a),p=d[1],E=d[2];if(p>E)return!0}a=a.parentNode}while(a&&a!==s.body);return!1},pLe=function(r){var t=r.scrollTop,s=r.scrollHeight,a=r.clientHeight;return[t,s,a]},mLe=function(r){var t=r.scrollLeft,s=r.scrollWidth,a=r.clientWidth;return[t,s,a]},ote=function(r,t){return r==="v"?hLe(t):fLe(t)},ate=function(r,t){return r==="v"?pLe(t):mLe(t)},gLe=function(r,t){return r==="h"&&t==="rtl"?-1:1},_Le=function(r,t,s,a,l){var d=gLe(r,window.getComputedStyle(t).direction),p=d*a,E=s.target,v=t.contains(E),b=!1,R=p>0,O=0,N=0;do{var F=ate(r,E),H=F[0],z=F[1],G=F[2],ee=z-G-d*H;(H||ee)&&ote(r,E)&&(O+=ee,N+=H),E instanceof ShadowRoot?E=E.host:E=E.parentNode}while(!v&&E!==document.body||v&&(t.contains(E)||t===E));return(R&&Math.abs(O)<1||!R&&Math.abs(N)<1)&&(b=!0),b},VO=function(r){return"changedTouches"in r?[r.changedTouches[0].clientX,r.changedTouches[0].clientY]:[0,0]},k7=function(r){return[r.deltaX,r.deltaY]},D7=function(r){return r&&"current"in r?r.current:r},ELe=function(r,t){return r[0]===t[0]&&r[1]===t[1]},yLe=function(r){return`
  .block-interactivity-`.concat(r,` {pointer-events: none;}
  .allow-interactivity-`).concat(r,` {pointer-events: all;}
`)},vLe=0,xv=[];function SLe(r){var t=V.useRef([]),s=V.useRef([0,0]),a=V.useRef(),l=V.useState(vLe++)[0],d=V.useState(ite)[0],p=V.useRef(r);V.useEffect(function(){p.current=r},[r]),V.useEffect(function(){if(r.inert){document.body.classList.add("block-interactivity-".concat(l));var z=ONe([r.lockRef.current],(r.shards||[]).map(D7),!0).filter(Boolean);return z.forEach(function(G){return G.classList.add("allow-interactivity-".concat(l))}),function(){document.body.classList.remove("block-interactivity-".concat(l)),z.forEach(function(G){return G.classList.remove("allow-interactivity-".concat(l))})}}},[r.inert,r.lockRef.current,r.shards]);var E=V.useCallback(function(z,G){if("touches"in z&&z.touches.length===2||z.type==="wheel"&&z.ctrlKey)return!p.current.allowPinchZoom;var ee=VO(z),J=s.current,re="deltaX"in z?z.deltaX:J[0]-ee[0],de="deltaY"in z?z.deltaY:J[1]-ee[1],se,ye=z.target,Q=Math.abs(re)>Math.abs(de)?"h":"v";if("touches"in z&&Q==="h"&&ye.type==="range")return!1;var ne=N7(Q,ye);if(!ne)return!0;if(ne?se=Q:(se=Q==="v"?"h":"v",ne=N7(Q,ye)),!ne)return!1;if(!a.current&&"changedTouches"in z&&(re||de)&&(a.current=se),!se)return!0;var oe=a.current||se;return _Le(oe,G,z,oe==="h"?re:de)},[]),v=V.useCallback(function(z){var G=z;if(!(!xv.length||xv[xv.length-1]!==d)){var ee="deltaY"in G?k7(G):VO(G),J=t.current.filter(function(se){return se.name===G.type&&(se.target===G.target||G.target===se.shadowParent)&&ELe(se.delta,ee)})[0];if(J&&J.should){G.cancelable&&G.preventDefault();return}if(!J){var re=(p.current.shards||[]).map(D7).filter(Boolean).filter(function(se){return se.contains(G.target)}),de=re.length>0?E(G,re[0]):!p.current.noIsolation;de&&G.cancelable&&G.preventDefault()}}},[]),b=V.useCallback(function(z,G,ee,J){var re={name:z,delta:G,target:ee,should:J,shadowParent:TLe(ee)};t.current.push(re),setTimeout(function(){t.current=t.current.filter(function(de){return de!==re})},1)},[]),R=V.useCallback(function(z){s.current=VO(z),a.current=void 0},[]),O=V.useCallback(function(z){b(z.type,k7(z),z.target,E(z,r.lockRef.current))},[]),N=V.useCallback(function(z){b(z.type,VO(z),z.target,E(z,r.lockRef.current))},[]);V.useEffect(function(){return xv.push(d),r.setCallbacks({onScrollCapture:O,onWheelCapture:O,onTouchMoveCapture:N}),document.addEventListener("wheel",v,Lv),document.addEventListener("touchmove",v,Lv),document.addEventListener("touchstart",R,Lv),function(){xv=xv.filter(function(z){return z!==d}),document.removeEventListener("wheel",v,Lv),document.removeEventListener("touchmove",v,Lv),document.removeEventListener("touchstart",R,Lv)}},[]);var F=r.removeScrollBar,H=r.inert;return V.createElement(V.Fragment,null,H?V.createElement(d,{styles:yLe(l)}):null,F?V.createElement(uLe,{gapMode:r.gapMode}):null)}function TLe(r){for(var t=null;r!==null;)r instanceof ShadowRoot&&(t=r.host,r=r.host),r=r.parentNode;return t}const bLe=PNe(rte,SLe);var cte=V.forwardRef(function(r,t){return V.createElement(WN,ph({},r,{ref:t,sideCar:bLe}))});cte.classNames=WN.classNames;function wLe(r){const{autoFocus:t,trapFocus:s,dialogRef:a,initialFocusRef:l,blockScrollOnMount:d,allowPinchZoom:p,finalFocusRef:E,returnFocusOnClose:v,preserveScrollBarGap:b,lockFocusAcrossFrames:R,isOpen:O}=Q_(),[N,F]=TV();V.useEffect(()=>{!N&&F&&setTimeout(F)},[N,F]);const H=nte(a,O);return D.jsx(Uee,{autoFocus:t,isDisabled:!s,initialFocusRef:l,finalFocusRef:E,restoreFocus:v,contentRef:a,lockFocusAcrossFrames:R,children:D.jsx(cte,{removeScrollBar:!b,allowPinchZoom:p,enabled:H===1&&d,forwardProps:!0,children:r.children})})}const RLe={initial:({offsetX:r,offsetY:t,transition:s,transitionEnd:a,delay:l})=>({opacity:0,x:r,y:t,transition:(s==null?void 0:s.exit)??G_.exit(W_.exit,l),transitionEnd:a==null?void 0:a.exit}),enter:({transition:r,transitionEnd:t,delay:s})=>({opacity:1,x:0,y:0,transition:(r==null?void 0:r.enter)??G_.enter(W_.enter,s),transitionEnd:t==null?void 0:t.enter}),exit:({offsetY:r,offsetX:t,transition:s,transitionEnd:a,reverse:l,delay:d})=>{const p={x:t,y:r};return{opacity:0,transition:(s==null?void 0:s.exit)??G_.exit(W_.exit,d),...l?{...p,transitionEnd:a==null?void 0:a.exit}:{transitionEnd:{...p,...a==null?void 0:a.exit}}}}},ew={initial:"initial",animate:"enter",exit:"exit",variants:RLe},CLe=V.forwardRef(function(t,s){const{unmountOnExit:a,in:l,reverse:d=!0,className:p,offsetX:E=0,offsetY:v=8,transition:b,transitionEnd:R,delay:O,animatePresenceProps:N,...F}=t,H=a?l&&a:!0,z=l||a?"enter":"exit",G={offsetX:E,offsetY:v,reverse:d,transition:b,transitionEnd:R,delay:O};return D.jsx(zS,{...N,custom:G,children:H&&D.jsx(Dh.div,{ref:s,className:dn("chakra-offset-slide",p),custom:G,...ew,animate:z,...F})})});CLe.displayName="SlideFade";const ILe={exit:({reverse:r,initialScale:t,transition:s,transitionEnd:a,delay:l})=>({opacity:0,...r?{scale:t,transitionEnd:a==null?void 0:a.exit}:{transitionEnd:{scale:t,...a==null?void 0:a.exit}},transition:(s==null?void 0:s.exit)??G_.exit(W_.exit,l)}),enter:({transitionEnd:r,transition:t,delay:s})=>({opacity:1,scale:1,transition:(t==null?void 0:t.enter)??G_.enter(W_.enter,s),transitionEnd:r==null?void 0:r.enter})},lte={initial:"exit",animate:"enter",exit:"exit",variants:ILe},ALe=V.forwardRef(function(t,s){const{unmountOnExit:a,in:l,reverse:d=!0,initialScale:p=.95,className:E,transition:v,transitionEnd:b,delay:R,animatePresenceProps:O,...N}=t,F=a?l&&a:!0,H=l||a?"enter":"exit",z={initialScale:p,reverse:d,transition:v,transitionEnd:b,delay:R};return D.jsx(zS,{...O,custom:z,children:F&&D.jsx(Dh.div,{ref:s,className:dn("chakra-offset-slide",E),...lte,animate:H,custom:z,...N})})});ALe.displayName="ScaleFade";const OLe={slideInBottom:{...ew,custom:{offsetY:16,reverse:!0}},slideInRight:{...ew,custom:{offsetX:16,reverse:!0}},slideInTop:{...ew,custom:{offsetY:-16,reverse:!0}},slideInLeft:{...ew,custom:{offsetX:-16,reverse:!0}},scale:{...lte,custom:{initialScale:.95,reverse:!0}},none:{}},PLe=Ot(Dh.section),NLe=r=>OLe[r||"none"],ute=V.forwardRef((r,t)=>{const{preset:s,motionProps:a=NLe(s),...l}=r;return D.jsx(PLe,{ref:t,...a,...l})});ute.displayName="ModalTransition";const Mh=qt((r,t)=>{const{className:s,children:a,containerProps:l,motionProps:d,...p}=r,{getDialogProps:E,getDialogContainerProps:v}=Q_(),b=E(p,t),R=v(l),O=dn("chakra-modal__content",s),N=JS(),F={display:"flex",flexDirection:"column",position:"relative",width:"100%",outline:0,...N.dialog},H={display:"flex",width:"100vw",height:"$100vh",position:"fixed",left:0,top:0,...N.dialogContainer},{motionPreset:z}=Q_();return D.jsx(wLe,{children:D.jsx(Ot.div,{...R,className:"chakra-modal__content-container",tabIndex:-1,__css:H,children:D.jsx(ute,{preset:z,motionProps:d,className:O,...b,__css:F,children:a})})})});Mh.displayName="ModalContent";const Uh=qt((r,t)=>{const{className:s,...a}=r,{bodyId:l,setBodyMounted:d}=Q_();V.useEffect(()=>(d(!0),()=>d(!1)),[d]);const p=dn("chakra-modal__body",s),E=JS();return D.jsx(Ot.div,{ref:t,className:p,id:l,...a,__css:E.body})});Uh.displayName="ModalBody";const Vh=qt((r,t)=>{const{onClick:s,className:a,...l}=r,{onClose:d}=Q_(),p=dn("chakra-modal__close-btn",a),E=JS();return D.jsx(nF,{ref:t,__css:E.closeButton,className:p,onClick:Yn(s,v=>{v.stopPropagation(),d()}),...l})});Vh.displayName="ModalCloseButton";const GN=qt((r,t)=>{const{className:s,...a}=r,l=dn("chakra-modal__footer",s),d=JS(),p={display:"flex",alignItems:"center",justifyContent:"flex-end",...d.footer};return D.jsx(Ot.footer,{ref:t,...a,__css:p,className:l})});GN.displayName="ModalFooter";const cp=qt((r,t)=>{const{className:s,...a}=r,{headerId:l,setHeaderMounted:d}=Q_();V.useEffect(()=>(d(!0),()=>d(!1)),[d]);const p=dn("chakra-modal__header",s),E=JS(),v={flex:0,...E.header};return D.jsx(Ot.header,{ref:t,className:p,id:l,...a,__css:v})});cp.displayName="ModalHeader";const kLe={enter:({transition:r,transitionEnd:t,delay:s}={})=>({opacity:1,transition:(r==null?void 0:r.enter)??G_.enter(W_.enter,s),transitionEnd:t==null?void 0:t.enter}),exit:({transition:r,transitionEnd:t,delay:s}={})=>({opacity:0,transition:(r==null?void 0:r.exit)??G_.exit(W_.exit,s),transitionEnd:t==null?void 0:t.exit})},dte={initial:"exit",animate:"enter",exit:"exit",variants:kLe},DLe=V.forwardRef(function(t,s){const{unmountOnExit:a,in:l,className:d,transition:p,transitionEnd:E,delay:v,animatePresenceProps:b,...R}=t,O=l||a?"enter":"exit",N=a?l&&a:!0,F={transition:p,transitionEnd:E,delay:v};return D.jsx(zS,{...b,custom:F,children:N&&D.jsx(Dh.div,{ref:s,className:dn("chakra-fade",d),custom:F,...dte,animate:O,...R})})});DLe.displayName="Fade";const LLe=Ot(Dh.div),Fh=qt((r,t)=>{const{className:s,transition:a,motionProps:l,...d}=r,p=dn("chakra-modal__overlay",s),v={pos:"fixed",left:"0",top:"0",w:"100vw",h:"100vh",...JS().overlay},{motionPreset:b}=Q_(),O=l||(b==="none"?{}:dte);return D.jsx(LLe,{...O,__css:v,ref:t,className:p,...d})});Fh.displayName="ModalOverlay";const[xLe,zN]=Mi({name:"PopoverContext",errorMessage:"usePopoverContext: `context` is undefined. Seems you forgot to wrap all popover components within `<Popover />`"}),[MLe,hte]=Mi({name:"PopoverStylesContext",errorMessage:`usePopoverStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Popover />" `}),Mv={click:"click",hover:"hover"};function ULe(r={}){const{closeOnBlur:t=!0,closeOnEsc:s=!0,initialFocusRef:a,id:l,returnFocusOnClose:d=!0,autoFocus:p=!0,arrowSize:E,arrowShadowColor:v,trigger:b=Mv.click,openDelay:R=200,closeDelay:O=200,isLazy:N,lazyBehavior:F="unmount",computePositionOnMount:H,...z}=r,{isOpen:G,onClose:ee,onOpen:J,onToggle:re}=WS(r),[de,se]=V.useState(d);V.useEffect(()=>se(d),[d]);const ye=V.useRef(null),Q=V.useRef(null),ne=V.useRef(null),oe=V.useRef(!1),ue=V.useRef(!1);G&&(ue.current=!0);const[Ee,fe]=V.useState(!1),[le,Le]=V.useState(!1),pt=V.useId(),et=l??pt,[Oe,Ue,Me,it]=["popover-trigger","popover-content","popover-header","popover-body"].map(zt=>`${zt}-${et}`),{referenceRef:Ae,getArrowProps:qe,getPopperProps:Ze,getArrowInnerProps:Fe,forceUpdate:lt}=CF({...z,enabled:G||!!H}),Et=yJ({isOpen:G,ref:ne});D_e({enabled:G,ref:Q}),SJ(ne,{focusRef:Q,visible:G,shouldFocus:de&&b===Mv.click}),R_e(ne,{focusRef:a,visible:G,shouldFocus:p&&b===Mv.click}),wJ({enabled:G&&t,ref:ne,handler(zt){var Ne;const ve=((Ne=zt.composedPath)==null?void 0:Ne.call(zt)[0])??[zt.target];FO(Q.current,ve)||(ve&&se(!LP(ve)),ee())}});const Nt=tV({wasSelected:ue.current,enabled:N,mode:F,isSelected:Et.present}),$t=V.useCallback((zt={},ve=null)=>{const Ne={...zt,style:{...zt.style,transformOrigin:xs.transformOrigin.varRef,[xs.arrowSize.var]:E?`${E}px`:void 0,[xs.arrowShadowColor.var]:v},ref:Gi(ne,ve),children:Nt?zt.children:null,id:Ue,tabIndex:-1,role:"dialog",onKeyDown:Yn(zt.onKeyDown,We=>{We.nativeEvent.isComposing||s&&We.key==="Escape"&&(We.preventDefault(),We.stopPropagation(),ee())}),onBlur:Yn(zt.onBlur,We=>{const dt=L7(We),mt=FO(ne.current,dt),gt=FO(Q.current,dt),Vt=!mt&&!gt;dt&&se(!LP(dt)),G&&t&&Vt&&ee()}),"aria-labelledby":Ee?Me:void 0,"aria-describedby":le?it:void 0};return b===Mv.hover&&(Ne.role="tooltip",Ne.onMouseEnter=Yn(zt.onMouseEnter,()=>{oe.current=!0}),Ne.onMouseLeave=Yn(zt.onMouseLeave,We=>{We.nativeEvent.relatedTarget!==null&&(oe.current=!1,setTimeout(()=>ee(),O))})),Ne},[Nt,Ue,Ee,Me,le,it,b,s,ee,G,t,O,v,E]),xt=V.useCallback((zt={},ve=null)=>Ze({...zt,style:{visibility:G?"visible":"hidden",...zt.style}},ve),[G,Ze]),En=V.useCallback((zt,ve=null)=>({...zt,ref:Gi(ve,ye,Ae)}),[ye,Ae]),In=V.useRef(void 0),hn=V.useRef(void 0),Kn=V.useCallback(zt=>{ye.current==null&&Ae(zt)},[Ae]),Ar=V.useCallback((zt={},ve=null)=>{const Ne={...zt,ref:Gi(Q,ve,Kn),id:Oe,"aria-haspopup":"dialog","aria-expanded":G,"aria-controls":Ue};return b===Mv.click&&(Ne.onClick=Yn(zt.onClick,re)),b===Mv.hover&&(Ne.onFocus=Yn(zt.onFocus,()=>{In.current===void 0&&J()}),Ne.onBlur=Yn(zt.onBlur,We=>{const dt=L7(We),mt=!FO(ne.current,dt);G&&t&&mt&&ee()}),Ne.onKeyDown=Yn(zt.onKeyDown,We=>{We.key==="Escape"&&ee()}),Ne.onMouseEnter=Yn(zt.onMouseEnter,()=>{oe.current=!0,In.current=window.setTimeout(()=>J(),R)}),Ne.onMouseLeave=Yn(zt.onMouseLeave,()=>{oe.current=!1,In.current&&(clearTimeout(In.current),In.current=void 0),hn.current=window.setTimeout(()=>{oe.current===!1&&ee()},O)})),Ne},[Oe,G,Ue,b,Kn,re,J,t,ee,R,O]);V.useEffect(()=>()=>{In.current&&clearTimeout(In.current),hn.current&&clearTimeout(hn.current)},[]);const Zt=V.useCallback((zt={},ve=null)=>({...zt,id:Me,ref:Gi(ve,Ne=>{fe(!!Ne)})}),[Me]),Zn=V.useCallback((zt={},ve=null)=>({...zt,id:it,ref:Gi(ve,Ne=>{Le(!!Ne)})}),[it]);return{forceUpdate:lt,isOpen:G,onAnimationComplete:Et.onComplete,onClose:ee,getAnchorProps:En,getArrowProps:qe,getArrowInnerProps:Fe,getPopoverPositionerProps:xt,getPopoverProps:$t,getTriggerProps:Ar,getHeaderProps:Zt,getBodyProps:Zn}}function FO(r,t){return r===t||(r==null?void 0:r.contains(t))}function L7(r){const t=r.currentTarget.ownerDocument.activeElement;return r.relatedTarget??t}function fte(r){const t=jc("Popover",r),{children:s,...a}=zi(r),l=qS(),d=ULe({...a,direction:l.direction});return D.jsx(xLe,{value:d,children:D.jsx(MLe,{value:t,children:xc(s,{isOpen:d.isOpen,onClose:d.onClose,forceUpdate:d.forceUpdate})})})}fte.displayName="Popover";function pte(r){var s;const t=V.version;return typeof t!="string"||t.startsWith("18.")?r==null?void 0:r.ref:(s=r==null?void 0:r.props)==null?void 0:s.ref}const mte=qt(function(t,s){const{getBodyProps:a}=zN(),l=hte();return D.jsx(Ot.div,{...a(t,s),className:dn("chakra-popover__body",t.className),__css:l.body})});mte.displayName="PopoverBody";function VLe(r){if(r)return{enter:{...r.enter,visibility:"visible"},exit:{...r.exit,transitionEnd:{visibility:"hidden"}}}}const FLe={exit:{opacity:0,scale:.95,transition:{duration:.1,ease:[.4,0,1,1]}},enter:{scale:1,opacity:1,transition:{duration:.15,ease:[0,0,.2,1]}}},jLe=Ot(Dh.section),gte=qt(function(t,s){const{variants:a=FLe,...l}=t,{isOpen:d}=zN();return D.jsx(jLe,{ref:s,variants:VLe(a),initial:!1,animate:d?"enter":"exit",...l})});gte.displayName="PopoverTransition";const _te=qt(function(t,s){const{rootProps:a,motionProps:l,...d}=t,{getPopoverProps:p,getPopoverPositionerProps:E,onAnimationComplete:v}=zN(),b=hte(),R={position:"relative",display:"flex",flexDirection:"column",...b.content};return D.jsx(Ot.div,{...E(a),__css:b.popper,className:"chakra-popover__popper",children:D.jsx(gte,{...l,...p(d,s),onAnimationComplete:fJ(v,d.onAnimationComplete),className:dn("chakra-popover__content",t.className),__css:R})})});_te.displayName="PopoverContent";function Ete(r){const t=V.Children.only(r.children),{getTriggerProps:s}=zN();return D.jsx(D.Fragment,{children:V.cloneElement(t,s(t.props,pte(t)))})}Ete.displayName="PopoverTrigger";function BLe(r,t,s){return(r-t)*100/(s-t)}lR({"0%":{strokeDasharray:"1, 400",strokeDashoffset:"0"},"50%":{strokeDasharray:"400, 400",strokeDashoffset:"-100"},"100%":{strokeDasharray:"400, 400",strokeDashoffset:"-260"}});lR({"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}});const WLe=lR({"0%":{left:"-40%"},"100%":{left:"100%"}}),GLe=lR({from:{backgroundPosition:"1rem 0"},to:{backgroundPosition:"0 0"}});function zLe(r){const{value:t=0,min:s,max:a,valueText:l,getValueText:d,isIndeterminate:p,role:E="progressbar"}=r,v=BLe(t,s,a);return{bind:{"data-indeterminate":p?"":void 0,"aria-valuemax":a,"aria-valuemin":s,"aria-valuenow":p?void 0:t,"aria-valuetext":(()=>{if(t!=null)return typeof d=="function"?d(t,v):l})(),role:E},percent:v,value:t}}const[HLe,KLe]=Mi({name:"ProgressStylesContext",errorMessage:`useProgressStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Progress />" `}),qLe=qt((r,t)=>{const{min:s,max:a,value:l,isIndeterminate:d,role:p,...E}=r,v=zLe({value:l,min:s,max:a,isIndeterminate:d,role:p}),R={height:"100%",...KLe().filledTrack};return D.jsx(Ot.div,{ref:t,style:{width:`${v.percent}%`,...E.style},...v.bind,...E,__css:R})}),PF=qt((r,t)=>{var Q;const{value:s,min:a=0,max:l=100,hasStripe:d,isAnimated:p,children:E,borderRadius:v,isIndeterminate:b,"aria-label":R,"aria-labelledby":O,"aria-valuetext":N,title:F,role:H,...z}=zi(r),G=jc("Progress",r),ee=v??((Q=G.track)==null?void 0:Q.borderRadius),J={animation:`${GLe} 1s linear infinite`},se={...!b&&d&&p&&J,...b&&{position:"absolute",willChange:"left",minWidth:"50%",animation:`${WLe} 1s ease infinite normal none running`}},ye={overflow:"hidden",position:"relative",...G.track};return D.jsx(Ot.div,{ref:t,borderRadius:ee,__css:ye,...z,children:D.jsxs(HLe,{value:G,children:[D.jsx(qLe,{"aria-label":R,"aria-labelledby":O,"aria-valuetext":N,min:a,max:l,value:s,isIndeterminate:b,css:se,borderRadius:ee,title:F,role:H}),E]})})});PF.displayName="Progress";const yte=qt(function(t,s){const{children:a,placeholder:l,className:d,...p}=t;return D.jsxs(Ot.select,{...p,ref:s,className:dn("chakra-select",d),children:[l&&D.jsx("option",{value:"",children:l}),a]})});yte.displayName="SelectField";const vte=qt((r,t)=>{var re;const s=jc("Select",r),{rootProps:a,placeholder:l,icon:d,color:p,height:E,h:v,minH:b,minHeight:R,iconColor:O,iconSize:N,...F}=zi(r),[H,z]=y_e(F,DEe),G=iee(z),ee={width:"100%",height:"fit-content",position:"relative",color:p},J={paddingEnd:"2rem",...s.field,_focus:{zIndex:"unset",...(re=s.field)==null?void 0:re._focus}};return D.jsxs(Ot.div,{className:"chakra-select__wrapper",__css:ee,...H,...a,children:[D.jsx(yte,{ref:t,height:v??E,minH:b??R,placeholder:l,...G,__css:J,children:r.children}),D.jsx(Ste,{"data-disabled":zn(G.disabled),...(O||p)&&{color:O||p},__css:s.icon,...N&&{fontSize:N},children:d})]})});vte.displayName="Select";const $Le=r=>D.jsx("svg",{viewBox:"0 0 24 24",...r,children:D.jsx("path",{fill:"currentColor",d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"})}),YLe=Ot("div",{baseStyle:{position:"absolute",display:"inline-flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",top:"50%",transform:"translateY(-50%)"}}),Ste=r=>{const{children:t=D.jsx($Le,{}),...s}=r,a=V.cloneElement(t,{role:"presentation",className:"chakra-select__icon",focusable:!1,"aria-hidden":!0,style:{width:"1em",height:"1em",color:"currentColor"}});return D.jsx(YLe,{...s,className:"chakra-select__icon-wrapper",children:V.isValidElement(t)?a:null})};Ste.displayName="SelectIcon";function ZM(r){const{orientation:t,vertical:s,horizontal:a}=r;return t==="vertical"?s:a}function XLe(r){const{orientation:t,thumbPercents:s,isReversed:a}=r,l=F=>({position:"absolute",userSelect:"none",WebkitUserSelect:"none",MozUserSelect:"none",msUserSelect:"none",touchAction:"none",...ZM({orientation:t,vertical:{bottom:`calc(${s[F]}% - var(--slider-thumb-size) / 2)`},horizontal:{left:`calc(${s[F]}% - var(--slider-thumb-size) / 2)`}})}),d={position:"relative",touchAction:"none",WebkitTapHighlightColor:"rgba(0,0,0,0)",userSelect:"none",outline:0},p={position:"absolute",...ZM({orientation:t,vertical:{left:"50%",transform:"translateX(-50%)",height:"100%"},horizontal:{top:"50%",transform:"translateY(-50%)",width:"100%"}})},E=s.length===1,v=[0,a?100-s[0]:s[0]],b=E?v:s;let R=b[0];!E&&a&&(R=100-R);const O=Math.abs(b[b.length-1]-b[0]),N={...p,...ZM({orientation:t,vertical:a?{height:`${O}%`,top:`${R}%`}:{height:`${O}%`,bottom:`${R}%`},horizontal:a?{width:`${O}%`,right:`${R}%`}:{width:`${O}%`,left:`${R}%`}})};return{trackStyle:p,innerTrackStyle:N,rootStyle:d,getThumbStyle:l}}function JLe(r){const{isReversed:t,direction:s,orientation:a}=r;return s==="ltr"||a==="vertical"?t:!t}function QLe(r){const{min:t=0,max:s=100,onChange:a,value:l,defaultValue:d,isReversed:p,direction:E="ltr",orientation:v="horizontal",id:b,isDisabled:R,isReadOnly:O,onChangeStart:N,onChangeEnd:F,step:H=1,getAriaValueText:z,"aria-valuetext":G,"aria-label":ee,"aria-labelledby":J,name:re,focusThumbOnChange:de=!0,...se}=r,ye=Mc(N),Q=Mc(F),ne=Mc(z),oe=JLe({isReversed:p,direction:E,orientation:v}),[ue,Ee]=vJ({value:l,defaultValue:d??exe(t,s),onChange:a}),[fe,le]=V.useState(!1),[Le,pt]=V.useState(!1),et=!(R||O),Oe=(s-t)/10,Ue=H||(s-t)/100,Me=nM(ue,t,s),it=s-Me+t,qe=KK(oe?it:Me,t,s),Ze=v==="vertical",Fe=bJ({min:t,max:s,step:H,isDisabled:R,value:Me,isInteractive:et,isReversed:oe,isVertical:Ze,eventSource:null,focusThumbOnChange:de,orientation:v}),lt=V.useRef(null),Et=V.useRef(null),Nt=V.useRef(null),$t=V.useId(),xt=b??$t,[En,In]=[`slider-thumb-${xt}`,`slider-track-${xt}`],hn=V.useCallback(kt=>{var eo;if(!lt.current)return;const tn=Fe.current;tn.eventSource="pointer";const Hi=lt.current.getBoundingClientRect(),{clientX:Cs,clientY:Vs}=((eo=kt.touches)==null?void 0:eo[0])??kt,li=Ze?Hi.bottom-Vs:Cs-Hi.left,Ca=Ze?Hi.height:Hi.width;let Bc=li/Ca;oe&&(Bc=1-Bc);let Zs=m_e(Bc,tn.min,tn.max);return tn.step&&(Zs=parseFloat(qK(Zs,tn.min,tn.step))),Zs=nM(Zs,tn.min,tn.max),Zs},[Ze,oe,Fe]),Kn=V.useCallback(kt=>{const tn=Fe.current;tn.isInteractive&&(kt=parseFloat(qK(kt,tn.min,Ue)),kt=nM(kt,tn.min,tn.max),Ee(kt))},[Ue,Ee,Fe]),Ar=V.useMemo(()=>({stepUp(kt=Ue){const tn=oe?Me-kt:Me+kt;Kn(tn)},stepDown(kt=Ue){const tn=oe?Me+kt:Me-kt;Kn(tn)},reset(){Kn(d||0)},stepTo(kt){Kn(kt)}}),[Kn,oe,Me,Ue,d]),Zt=V.useCallback(kt=>{const tn=Fe.current,Cs={ArrowRight:()=>Ar.stepUp(),ArrowUp:()=>Ar.stepUp(),ArrowLeft:()=>Ar.stepDown(),ArrowDown:()=>Ar.stepDown(),PageUp:()=>Ar.stepUp(Oe),PageDown:()=>Ar.stepDown(Oe),Home:()=>Kn(tn.min),End:()=>Kn(tn.max)}[kt.key];Cs&&(kt.preventDefault(),kt.stopPropagation(),Cs(kt),tn.eventSource="keyboard")},[Ar,Kn,Oe,Fe]),Zn=(ne==null?void 0:ne(Me))??G,{getThumbStyle:zt,rootStyle:ve,trackStyle:Ne,innerTrackStyle:We}=V.useMemo(()=>{const kt=Fe.current;return XLe({isReversed:oe,orientation:kt.orientation,thumbPercents:[qe]})},[oe,qe,Fe]),dt=V.useCallback(()=>{Fe.current.focusThumbOnChange&&setTimeout(()=>{var tn;return(tn=Et.current)==null?void 0:tn.focus()})},[Fe]);Um(()=>{const kt=Fe.current;dt(),kt.eventSource==="keyboard"&&(Q==null||Q(kt.value))},[Me,Q]);function mt(kt){const tn=hn(kt);tn!=null&&tn!==Fe.current.value&&Ee(tn)}Z_e(Nt,{onPanSessionStart(kt){const tn=Fe.current;tn.isInteractive&&(le(!0),dt(),mt(kt),ye==null||ye(tn.value))},onPanSessionEnd(){const kt=Fe.current;kt.isInteractive&&(le(!1),Q==null||Q(kt.value))},onPan(kt){Fe.current.isInteractive&&mt(kt)}});const gt=V.useCallback((kt={},tn=null)=>({...kt,...se,ref:Gi(tn,Nt),tabIndex:-1,"aria-disabled":nS(R),"data-focused":zn(Le),style:{...kt.style,...ve}}),[se,R,Le,ve]),Vt=V.useCallback((kt={},tn=null)=>({...kt,ref:Gi(tn,lt),id:In,"data-disabled":zn(R),style:{...kt.style,...Ne}}),[R,In,Ne]),_n=V.useCallback((kt={},tn=null)=>({...kt,ref:tn,style:{...kt.style,...We}}),[We]),kn=V.useCallback((kt={},tn=null)=>({...kt,ref:Gi(tn,Et),role:"slider",tabIndex:et?0:void 0,id:En,"data-active":zn(fe),"aria-valuetext":Zn,"aria-valuemin":t,"aria-valuemax":s,"aria-valuenow":Me,"aria-orientation":v,"aria-disabled":nS(R),"aria-readonly":nS(O),"aria-label":ee,"aria-labelledby":ee?void 0:J,style:{...kt.style,...zt(0)},onKeyDown:Yn(kt.onKeyDown,Zt),onFocus:Yn(kt.onFocus,()=>pt(!0)),onBlur:Yn(kt.onBlur,()=>pt(!1))}),[et,En,fe,Zn,t,s,Me,v,R,O,ee,J,zt,Zt]),rn=V.useCallback((kt,tn=null)=>{const Hi=!(kt.value<t||kt.value>s),Cs=Me>=kt.value,Vs=KK(kt.value,t,s),li={position:"absolute",pointerEvents:"none",...ZLe({orientation:v,vertical:{bottom:oe?`${100-Vs}%`:`${Vs}%`},horizontal:{left:oe?`${100-Vs}%`:`${Vs}%`}})};return{...kt,ref:tn,role:"presentation","aria-hidden":!0,"data-disabled":zn(R),"data-invalid":zn(!Hi),"data-highlighted":zn(Cs),style:{...kt.style,...li}}},[R,oe,s,t,v,Me]),ur=V.useCallback((kt={},tn=null)=>({...kt,ref:tn,type:"hidden",value:Me,name:re}),[re,Me]);return{state:{value:Me,isFocused:Le,isDragging:fe},actions:Ar,getRootProps:gt,getTrackProps:Vt,getInnerTrackProps:_n,getThumbProps:kn,getMarkerProps:rn,getInputProps:ur}}function ZLe(r){const{orientation:t,vertical:s,horizontal:a}=r;return t==="vertical"?s:a}function exe(r,t){return t<r?r:r+(t-r)/2}const[txe,HN]=Mi({name:"SliderContext",hookName:"useSliderContext",providerName:"<Slider />"}),[nxe,KN]=Mi({name:"SliderStylesContext",hookName:"useSliderStyles",providerName:"<Slider />"}),mU=qt((r,t)=>{const s={...r,orientation:(r==null?void 0:r.orientation)??"horizontal"},a=jc("Slider",s),l=zi(s),{direction:d}=qS();l.direction=d;const{getInputProps:p,getRootProps:E,...v}=QLe(l),b=E(),R=p({},t);return D.jsx(txe,{value:v,children:D.jsx(nxe,{value:a,children:D.jsxs(Ot.div,{...b,className:dn("chakra-slider",s.className),__css:a.container,children:[s.children,D.jsx("input",{...R})]})})})});mU.displayName="Slider";const gU=qt((r,t)=>{const{getThumbProps:s}=HN(),a=KN(),l=s(r,t);return D.jsx(Ot.div,{...l,className:dn("chakra-slider__thumb",r.className),__css:a.thumb})});gU.displayName="SliderThumb";const _U=qt((r,t)=>{const{getTrackProps:s}=HN(),a=KN(),l=s(r,t);return D.jsx(Ot.div,{...l,className:dn("chakra-slider__track",r.className),__css:a.track})});_U.displayName="SliderTrack";const EU=qt((r,t)=>{const{getInnerTrackProps:s}=HN(),a=KN(),l=s(r,t);return D.jsx(Ot.div,{...l,className:dn("chakra-slider__filled-track",r.className),__css:a.filledTrack})});EU.displayName="SliderFilledTrack";const rxe=qt((r,t)=>{const{getMarkerProps:s}=HN(),a=KN(),l=s(r,t);return D.jsx(Ot.div,{...l,className:dn("chakra-slider__marker",r.className),__css:a.mark})});rxe.displayName="SliderMark";const Tte=Ot("div",{baseStyle:{flex:1,justifySelf:"stretch",alignSelf:"stretch"}});Tte.displayName="Spacer";const bte=r=>D.jsx(Ot.div,{className:"chakra-stack__item",...r,__css:{display:"inline-block",flex:"0 0 auto",minWidth:0,...r.__css}});bte.displayName="StackItem";function ixe(r){const{spacing:t,direction:s}=r,a={column:{my:t,mx:0,borderLeftWidth:0,borderBottomWidth:"1px"},"column-reverse":{my:t,mx:0,borderLeftWidth:0,borderBottomWidth:"1px"},row:{mx:t,my:0,borderLeftWidth:"1px",borderBottomWidth:0},"row-reverse":{mx:t,my:0,borderLeftWidth:"1px",borderBottomWidth:0}};return{"&":SN(s,l=>a[l])}}const NF=qt((r,t)=>{const{isInline:s,direction:a,align:l,justify:d,spacing:p="0.5rem",wrap:E,children:v,divider:b,className:R,shouldWrapChildren:O,...N}=r,F=s?"row":a??"column",H=V.useMemo(()=>ixe({spacing:p,direction:F}),[p,F]),z=!!b,G=!O&&!z,ee=V.useMemo(()=>{const re=eV(v);return G?re:re.map((de,se)=>{const ye=typeof de.key<"u"?de.key:se,Q=se+1===re.length,oe=O?D.jsx(bte,{children:de},ye):de;if(!z)return oe;const ue=V.cloneElement(b,{__css:H}),Ee=Q?null:ue;return D.jsxs(V.Fragment,{children:[oe,Ee]},ye)})},[b,H,z,G,O,v]),J=dn("chakra-stack",R);return D.jsx(Ot.div,{ref:t,display:"flex",alignItems:l,justifyContent:d,flexDirection:F,flexWrap:E,gap:z?void 0:p,className:J,...N,children:ee})});NF.displayName="Stack";const NS=qt((r,t)=>D.jsx(NF,{align:"center",...r,direction:"row",ref:t}));NS.displayName="HStack";const Us=qt((r,t)=>D.jsx(NF,{align:"center",...r,direction:"column",ref:t}));Us.displayName="VStack";const yP=qt(function(t,s){const a=jc("Switch",t),{spacing:l="0.5rem",children:d,...p}=zi(t),{getIndicatorProps:E,getInputProps:v,getCheckboxProps:b,getRootProps:R,getLabelProps:O}=_Ne(p),N=V.useMemo(()=>({display:"inline-block",position:"relative",verticalAlign:"middle",lineHeight:0,...a.container}),[a.container]),F=V.useMemo(()=>({display:"inline-flex",flexShrink:0,justifyContent:"flex-start",boxSizing:"content-box",cursor:"pointer",...a.track}),[a.track]),H=V.useMemo(()=>({userSelect:"none",marginStart:l,...a.label}),[l,a.label]);return D.jsxs(Ot.label,{...R(),className:dn("chakra-switch",t.className),__css:N,children:[D.jsx("input",{className:"chakra-switch__input",...v({},s)}),D.jsx(Ot.span,{...b(),className:"chakra-switch__track",__css:F,children:D.jsx(Ot.span,{__css:a.thumb,className:"chakra-switch__thumb",...E()})}),d&&D.jsx(Ot.span,{className:"chakra-switch__label",...O(),__css:H,children:d})]})});yP.displayName="Switch";const[sxe,oxe,axe,cxe]=YZ();function lxe(r){const{defaultIndex:t,onChange:s,index:a,isManual:l,isLazy:d,lazyBehavior:p="unmount",orientation:E="horizontal",direction:v="ltr",...b}=r,[R,O]=V.useState(t??0),[N,F]=vJ({defaultValue:t??0,value:a,onChange:s});V.useEffect(()=>{a!=null&&O(a)},[a]);const H=axe(),z=V.useId();return{id:`tabs-${r.id??z}`,selectedIndex:N,focusedIndex:R,setSelectedIndex:F,setFocusedIndex:O,isManual:l,isLazy:d,lazyBehavior:p,orientation:E,descendants:H,direction:v,htmlProps:b}}const[uxe,qN]=Mi({name:"TabsContext",errorMessage:"useTabsContext: `context` is undefined. Seems you forgot to wrap all tabs components within <Tabs />"});function dxe(r){const{focusedIndex:t,orientation:s,direction:a}=qN(),l=oxe(),d=V.useCallback(p=>{const E=()=>{var re;const J=l.nextEnabled(t);J&&((re=J.node)==null||re.focus())},v=()=>{var re;const J=l.prevEnabled(t);J&&((re=J.node)==null||re.focus())},b=()=>{var re;const J=l.firstEnabled();J&&((re=J.node)==null||re.focus())},R=()=>{var re;const J=l.lastEnabled();J&&((re=J.node)==null||re.focus())},O=s==="horizontal",N=s==="vertical",F=p.key,H=a==="ltr"?"ArrowLeft":"ArrowRight",z=a==="ltr"?"ArrowRight":"ArrowLeft",ee={[H]:()=>O&&v(),[z]:()=>O&&E(),ArrowDown:()=>N&&E(),ArrowUp:()=>N&&v(),Home:b,End:R}[F];ee&&(p.preventDefault(),ee(p))},[l,t,s,a]);return{...r,role:"tablist","aria-orientation":s,onKeyDown:Yn(r.onKeyDown,d)}}function hxe(r){const{isDisabled:t=!1,isFocusable:s=!1,...a}=r,{setSelectedIndex:l,isManual:d,id:p,setFocusedIndex:E,selectedIndex:v}=qN(),{index:b,register:R}=cxe({disabled:t&&!s}),O=b===v,N=()=>{l(b)},F=()=>{E(b),!d&&!(t&&s)&&l(b)};return{...Jee({...a,ref:Gi(R,r.ref),isDisabled:t,isFocusable:s,onClick:Yn(r.onClick,N)}),id:wte(p,b),role:"tab",tabIndex:O?0:-1,type:"button","aria-selected":O,"aria-controls":Rte(p,b),onFocus:t?void 0:Yn(r.onFocus,F)}}const[fxe,pxe]=Mi({});function mxe(r){const t=qN(),{id:s,selectedIndex:a}=t,d=eV(r.children).map((p,E)=>V.createElement(fxe,{key:p.key??E,value:{isSelected:E===a,id:Rte(s,E),tabId:wte(s,E),selectedIndex:a}},p));return{...r,children:d}}function gxe(r){const{children:t,...s}=r,{isLazy:a,lazyBehavior:l}=qN(),{isSelected:d,id:p,tabId:E}=pxe(),v=V.useRef(!1);d&&(v.current=!0);const b=tV({wasSelected:v.current,isSelected:d,enabled:a,mode:l});return{tabIndex:0,...s,children:b?t:null,role:"tabpanel","aria-labelledby":E,hidden:!d,id:p}}function wte(r,t){return`${r}--tab-${t}`}function Rte(r,t){return`${r}--tabpanel-${t}`}const[_xe,$N]=Mi({name:"TabsStylesContext",errorMessage:`useTabsStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Tabs />" `}),Cte=qt(function(t,s){const a=jc("Tabs",t),{children:l,className:d,...p}=zi(t),{htmlProps:E,descendants:v,...b}=lxe(p),R=V.useMemo(()=>b,[b]),{isFitted:O,...N}=E,F={position:"relative",...a.root};return D.jsx(sxe,{value:v,children:D.jsx(uxe,{value:R,children:D.jsx(_xe,{value:a,children:D.jsx(Ot.div,{className:dn("chakra-tabs",d),ref:s,...N,__css:F,children:l})})})})});Cte.displayName="Tabs";const yU=qt(function(t,s){const a=$N(),l=hxe({...t,ref:s}),d={outline:"0",display:"flex",alignItems:"center",justifyContent:"center",...a.tab};return D.jsx(Ot.button,{...l,className:dn("chakra-tabs__tab",t.className),__css:d})});yU.displayName="Tab";const Ite=qt(function(t,s){const a=dxe({...t,ref:s}),l=$N(),d={display:"flex",...l.tablist};return D.jsx(Ot.div,{...a,className:dn("chakra-tabs__tablist",t.className),__css:d})});Ite.displayName="TabList";const vU=qt(function(t,s){const a=gxe({...t,ref:s}),l=$N();return D.jsx(Ot.div,{outline:"0",...a,className:dn("chakra-tabs__tab-panel",t.className),__css:l.tabpanel})});vU.displayName="TabPanel";const Ate=qt(function(t,s){const a=mxe(t),l=$N();return D.jsx(Ot.div,{...a,width:"100%",ref:s,className:dn("chakra-tabs__tab-panels",t.className),__css:l.tabpanels})});Ate.displayName="TabPanels";function Exe(r,t){const s=r??"bottom",l={"top-start":{ltr:"top-left",rtl:"top-right"},"top-end":{ltr:"top-right",rtl:"top-left"},"bottom-start":{ltr:"bottom-left",rtl:"bottom-right"},"bottom-end":{ltr:"bottom-right",rtl:"bottom-left"}}[s];return(l==null?void 0:l[t])??s}function yxe(r,t){const s=l=>({...t,...l,position:Exe((l==null?void 0:l.position)??(t==null?void 0:t.position),r)}),a=l=>{const d=s(l),p=KZ(d);return fh.notify(p,d)};return a.update=(l,d)=>{fh.update(l,s(d))},a.promise=(l,d)=>{const p=a({...d.loading,status:"loading",duration:null});l.then(E=>a.update(p,{status:"success",duration:5e3,...xc(d.success,E)})).catch(E=>a.update(p,{status:"error",duration:5e3,...xc(d.error,E)}))},a.closeAll=fh.closeAll,a.close=fh.close,a.isActive=fh.isActive,a}function QS(r){const{theme:t}=BZ(),s=WPe();return V.useMemo(()=>yxe(t.direction,{...s,...r}),[r,t.direction,s])}const vxe={exit:{scale:.85,opacity:0,transition:{opacity:{duration:.15,easings:"easeInOut"},scale:{duration:.2,easings:"easeInOut"}}},enter:{scale:1,opacity:1,transition:{opacity:{easings:"easeOut",duration:.2},scale:{duration:.2,ease:[.175,.885,.4,1.1]}}}},SU=r=>{var t;return((t=r.current)==null?void 0:t.ownerDocument)||document},vP=r=>{var t,s;return((s=(t=r.current)==null?void 0:t.ownerDocument)==null?void 0:s.defaultView)||window};function Sxe(r={}){const{openDelay:t=0,closeDelay:s=0,closeOnClick:a=!0,closeOnMouseDown:l,closeOnScroll:d,closeOnPointerDown:p=l,closeOnEsc:E=!0,onOpen:v,onClose:b,placement:R,id:O,isOpen:N,defaultIsOpen:F,arrowSize:H=10,arrowShadowColor:z,arrowPadding:G,modifiers:ee,isDisabled:J,gutter:re,offset:de,direction:se,...ye}=r,{isOpen:Q,onOpen:ne,onClose:oe}=WS({isOpen:N,defaultIsOpen:F,onOpen:v,onClose:b}),{referenceRef:ue,getPopperProps:Ee,getArrowInnerProps:fe,getArrowProps:le}=CF({enabled:Q,placement:R,arrowPadding:G,modifiers:ee,gutter:re,offset:de,direction:se}),Le=V.useId(),et=`tooltip-${O??Le}`,Oe=V.useRef(null),Ue=V.useRef(void 0),Me=V.useCallback(()=>{Ue.current&&(clearTimeout(Ue.current),Ue.current=void 0)},[]),it=V.useRef(void 0),Ae=V.useCallback(()=>{it.current&&(clearTimeout(it.current),it.current=void 0)},[]),qe=V.useCallback(()=>{Ae(),oe()},[oe,Ae]),Ze=Txe(Oe,qe),Fe=V.useCallback(()=>{if(!J&&!Ue.current){Q&&Ze();const hn=vP(Oe);Ue.current=hn.setTimeout(ne,t)}},[Ze,J,Q,ne,t]),lt=V.useCallback(()=>{Me();const hn=vP(Oe);it.current=hn.setTimeout(qe,s)},[s,qe,Me]),Et=V.useCallback(()=>{Q&&a&&lt()},[a,lt,Q]),Nt=V.useCallback(()=>{Q&&p&&lt()},[p,lt,Q]),$t=V.useCallback(hn=>{Q&&hn.key==="Escape"&&lt()},[Q,lt]);rS(()=>SU(Oe),"keydown",E?$t:void 0),rS(()=>{if(!d)return null;const hn=Oe.current;if(!hn)return null;const Kn=EJ(hn);return Kn.localName==="body"?vP(Oe):Kn},"scroll",()=>{Q&&d&&qe()},{passive:!0,capture:!0}),V.useEffect(()=>{J&&(Me(),Q&&oe())},[J,Q,oe,Me]),V.useEffect(()=>()=>{Me(),Ae()},[Me,Ae]),rS(()=>Oe.current,"pointerleave",lt);const xt=V.useCallback((hn={},Kn=null)=>({...hn,ref:Gi(Oe,Kn,ue),onPointerEnter:Yn(hn.onPointerEnter,Zt=>{Zt.pointerType!=="touch"&&Fe()}),onClick:Yn(hn.onClick,Et),onPointerDown:Yn(hn.onPointerDown,Nt),onFocus:Yn(hn.onFocus,Fe),onBlur:Yn(hn.onBlur,lt),"aria-describedby":Q?et:void 0}),[Fe,lt,Nt,Q,et,Et,ue]),En=V.useCallback((hn={},Kn=null)=>Ee({...hn,style:{...hn.style,[xs.arrowSize.var]:H?`${H}px`:void 0,[xs.arrowShadowColor.var]:z}},Kn),[Ee,H,z]),In=V.useCallback((hn={},Kn=null)=>{const Ar={...hn.style,position:"relative",transformOrigin:xs.transformOrigin.varRef};return{ref:Kn,...ye,...hn,id:et,role:"tooltip",style:Ar}},[ye,et]);return{isOpen:Q,show:Fe,hide:lt,getTriggerProps:xt,getTooltipProps:In,getTooltipPositionerProps:En,getArrowProps:le,getArrowInnerProps:fe}}const e2="chakra-ui:close-tooltip";function Txe(r,t){return V.useEffect(()=>{const s=SU(r);return s.addEventListener(e2,t),()=>s.removeEventListener(e2,t)},[t,r]),()=>{const s=SU(r),a=vP(r);s.dispatchEvent(new a.CustomEvent(e2))}}const bxe=Ot(Dh.div),SR=qt((r,t)=>{const s=fu("Tooltip",r),a=zi(r),l=qS(),{children:d,label:p,shouldWrapChildren:E,"aria-label":v,hasArrow:b,bg:R,portalProps:O,background:N,backgroundColor:F,bgColor:H,motionProps:z,animatePresenceProps:G,...ee}=a,J=N??F??R??H;if(J){s.bg=J;const ue=GEe(l,"colors",J);s[xs.arrowBg.var]=ue}const re=Sxe({...ee,direction:l.direction}),de=!V.isValidElement(d)||E;let se;if(de)se=D.jsx(Ot.span,{display:"inline-block",tabIndex:0,...re.getTriggerProps(),children:d});else{const ue=V.Children.only(d);se=V.cloneElement(ue,re.getTriggerProps(ue.props,pte(ue)))}const ye=!!v,Q=re.getTooltipProps({},t),ne=ye?sR(Q,["role","id"]):Q,oe=_J(Q,["role","id"]);return p?D.jsxs(D.Fragment,{children:[se,D.jsx(zS,{...G,children:re.isOpen&&D.jsx(pu,{...O,children:D.jsx(Ot.div,{...re.getTooltipPositionerProps(),__css:{zIndex:s.zIndex,pointerEvents:"none"},children:D.jsxs(bxe,{variants:vxe,initial:"exit",animate:"enter",exit:"exit",...z,...ne,__css:s,children:[p,ye&&D.jsx(Ot.span,{srOnly:!0,...oe,children:v}),b&&D.jsx(Ot.div,{"data-popper-arrow":!0,className:"chakra-tooltip__arrow-wrapper",children:D.jsx(Ot.div,{"data-popper-arrow-inner":!0,className:"chakra-tooltip__arrow",__css:{bg:s.bg}})})]})})})})]}):D.jsx(D.Fragment,{children:d})});SR.displayName="Tooltip";const kF=qt(function(t,s){const a=fu("Heading",t),{className:l,...d}=zi(t);return D.jsx(Ot.h2,{ref:s,className:dn("chakra-heading",t.className),...d,__css:a})});kF.displayName="Heading";const gn=qt(function(t,s){const a=fu("Text",t),{className:l,align:d,decoration:p,casing:E,...v}=zi(t),b=vN({textAlign:t.align,textDecoration:t.decoration,textTransform:t.casing});return D.jsx(Ot.p,{ref:s,className:dn("chakra-text",t.className),...b,...v,__css:a})});gn.displayName="Text";const wxe="modulepreload",Rxe=function(r,t){return new URL(r,t).href},x7={},t2=function(t,s,a){let l=Promise.resolve();if(s&&s.length>0){const p=document.getElementsByTagName("link"),E=document.querySelector("meta[property=csp-nonce]"),v=(E==null?void 0:E.nonce)||(E==null?void 0:E.getAttribute("nonce"));l=Promise.allSettled(s.map(b=>{if(b=Rxe(b,a),b in x7)return;x7[b]=!0;const R=b.endsWith(".css"),O=R?'[rel="stylesheet"]':"";if(!!a)for(let H=p.length-1;H>=0;H--){const z=p[H];if(z.href===b&&(!R||z.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${b}"]${O}`))return;const F=document.createElement("link");if(F.rel=R?"stylesheet":wxe,R||(F.as="script"),F.crossOrigin="",F.href=b,v&&F.setAttribute("nonce",v),document.head.appendChild(F),R)return new Promise((H,z)=>{F.addEventListener("load",H),F.addEventListener("error",()=>z(new Error(`Unable to preload CSS for ${b}`)))})}))}function d(p){const E=new Event("vite:preloadError",{cancelable:!0});if(E.payload=p,window.dispatchEvent(E),!E.defaultPrevented)throw p}return l.then(p=>{for(const E of p||[])E.status==="rejected"&&d(E.reason);return t().catch(d)})},jO=()=>{const r=new Date,t=r.getHours().toString().padStart(2,"0"),s=r.getMinutes().toString().padStart(2,"0"),a=r.getSeconds().toString().padStart(2,"0"),l=r.getMilliseconds().toString().padStart(3,"0");return`${t}:${s}:${a}.${l}`},Rt={log:(...r)=>{{const t=r.map((s,a)=>a===0&&typeof s=="string"?`
${s}`:s);console.log(`[LOG] [${jO()}] `,...t)}},error:(...r)=>{{const t=r.map((s,a)=>a===0&&typeof s=="string"?`
${s}`:s);console.error(`[ERROR] [${jO()}] `,...t)}},warn:(...r)=>{{const t=r.map((s,a)=>a===0&&typeof s=="string"?`
${s}`:s);console.warn(`[WARN] [${jO()}]`,...t)}},trace:r=>{console.trace(`[TRACE] [${jO()}] ${r}`)}};async function Kw(r){let t;try{switch(r){case"default":t=await t2(()=>import("./index.v0.1.5.js"),[],import.meta.url);break;default:t=await t2(()=>import("./index.v0.1.5.js"),[],import.meta.url)}return t.default}catch(s){return Rt.error("Failed to load theme:",s),t=await t2(()=>import("./index.v0.1.5.js"),[],import.meta.url),t.default}}const Cxe=()=>{};var M7={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ote=function(r){const t=[];let s=0;for(let a=0;a<r.length;a++){let l=r.charCodeAt(a);l<128?t[s++]=l:l<2048?(t[s++]=l>>6|192,t[s++]=l&63|128):(l&64512)===55296&&a+1<r.length&&(r.charCodeAt(a+1)&64512)===56320?(l=65536+((l&1023)<<10)+(r.charCodeAt(++a)&1023),t[s++]=l>>18|240,t[s++]=l>>12&63|128,t[s++]=l>>6&63|128,t[s++]=l&63|128):(t[s++]=l>>12|224,t[s++]=l>>6&63|128,t[s++]=l&63|128)}return t},Ixe=function(r){const t=[];let s=0,a=0;for(;s<r.length;){const l=r[s++];if(l<128)t[a++]=String.fromCharCode(l);else if(l>191&&l<224){const d=r[s++];t[a++]=String.fromCharCode((l&31)<<6|d&63)}else if(l>239&&l<365){const d=r[s++],p=r[s++],E=r[s++],v=((l&7)<<18|(d&63)<<12|(p&63)<<6|E&63)-65536;t[a++]=String.fromCharCode(55296+(v>>10)),t[a++]=String.fromCharCode(56320+(v&1023))}else{const d=r[s++],p=r[s++];t[a++]=String.fromCharCode((l&15)<<12|(d&63)<<6|p&63)}}return t.join("")},Pte={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(r,t){if(!Array.isArray(r))throw Error("encodeByteArray takes an array as a parameter");this.init_();const s=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,a=[];for(let l=0;l<r.length;l+=3){const d=r[l],p=l+1<r.length,E=p?r[l+1]:0,v=l+2<r.length,b=v?r[l+2]:0,R=d>>2,O=(d&3)<<4|E>>4;let N=(E&15)<<2|b>>6,F=b&63;v||(F=64,p||(N=64)),a.push(s[R],s[O],s[N],s[F])}return a.join("")},encodeString(r,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(r):this.encodeByteArray(Ote(r),t)},decodeString(r,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(r):Ixe(this.decodeStringToByteArray(r,t))},decodeStringToByteArray(r,t){this.init_();const s=t?this.charToByteMapWebSafe_:this.charToByteMap_,a=[];for(let l=0;l<r.length;){const d=s[r.charAt(l++)],E=l<r.length?s[r.charAt(l)]:0;++l;const b=l<r.length?s[r.charAt(l)]:64;++l;const O=l<r.length?s[r.charAt(l)]:64;if(++l,d==null||E==null||b==null||O==null)throw new Axe;const N=d<<2|E>>4;if(a.push(N),b!==64){const F=E<<4&240|b>>2;if(a.push(F),O!==64){const H=b<<6&192|O;a.push(H)}}}return a},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let r=0;r<this.ENCODED_VALS.length;r++)this.byteToCharMap_[r]=this.ENCODED_VALS.charAt(r),this.charToByteMap_[this.byteToCharMap_[r]]=r,this.byteToCharMapWebSafe_[r]=this.ENCODED_VALS_WEBSAFE.charAt(r),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[r]]=r,r>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(r)]=r,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(r)]=r)}}};class Axe extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Oxe=function(r){const t=Ote(r);return Pte.encodeByteArray(t,!0)},YP=function(r){return Oxe(r).replace(/\./g,"")},Nte=function(r){try{return Pte.decodeString(r,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pxe(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nxe=()=>Pxe().__FIREBASE_DEFAULTS__,kxe=()=>{if(typeof process>"u"||typeof M7>"u")return;const r=M7.__FIREBASE_DEFAULTS__;if(r)return JSON.parse(r)},Dxe=()=>{if(typeof document>"u")return;let r;try{r=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const t=r&&Nte(r[1]);return t&&JSON.parse(t)},YN=()=>{try{return Cxe()||Nxe()||kxe()||Dxe()}catch(r){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${r}`);return}},kte=r=>{var t,s;return(s=(t=YN())===null||t===void 0?void 0:t.emulatorHosts)===null||s===void 0?void 0:s[r]},Dte=r=>{const t=kte(r);if(!t)return;const s=t.lastIndexOf(":");if(s<=0||s+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const a=parseInt(t.substring(s+1),10);return t[0]==="["?[t.substring(1,s-1),a]:[t.substring(0,s),a]},Lte=()=>{var r;return(r=YN())===null||r===void 0?void 0:r.config},xte=r=>{var t;return(t=YN())===null||t===void 0?void 0:t[`_${r}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lxe{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((t,s)=>{this.resolve=t,this.reject=s})}wrapCallback(t){return(s,a)=>{s?this.reject(s):this.resolve(a),typeof t=="function"&&(this.promise.catch(()=>{}),t.length===1?t(s):t(s,a))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mte(r,t){if(r.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const s={alg:"none",type:"JWT"},a=t||"demo-project",l=r.iat||0,d=r.sub||r.user_id;if(!d)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const p=Object.assign({iss:`https://securetoken.google.com/${a}`,aud:a,iat:l,exp:l+3600,auth_time:l,sub:d,user_id:d,firebase:{sign_in_provider:"custom",identities:{}}},r);return[YP(JSON.stringify(s)),YP(JSON.stringify(p)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wa(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function xxe(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(wa())}function Mxe(){var r;const t=(r=YN())===null||r===void 0?void 0:r.forceEnvironment;if(t==="node")return!0;if(t==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function Uxe(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function Vxe(){const r=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof r=="object"&&r.id!==void 0}function Fxe(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function jxe(){const r=wa();return r.indexOf("MSIE ")>=0||r.indexOf("Trident/")>=0}function Bxe(){return!Mxe()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Wxe(){try{return typeof indexedDB=="object"}catch{return!1}}function Gxe(){return new Promise((r,t)=>{try{let s=!0;const a="validate-browser-context-for-indexeddb-analytics-module",l=self.indexedDB.open(a);l.onsuccess=()=>{l.result.close(),s||self.indexedDB.deleteDatabase(a),r(!0)},l.onupgradeneeded=()=>{s=!1},l.onerror=()=>{var d;t(((d=l.error)===null||d===void 0?void 0:d.message)||"")}}catch(s){t(s)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zxe="FirebaseError";class jh extends Error{constructor(t,s,a){super(s),this.code=t,this.customData=a,this.name=zxe,Object.setPrototypeOf(this,jh.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,TR.prototype.create)}}class TR{constructor(t,s,a){this.service=t,this.serviceName=s,this.errors=a}create(t,...s){const a=s[0]||{},l=`${this.service}/${t}`,d=this.errors[t],p=d?Hxe(d,a):"Error",E=`${this.serviceName}: ${p} (${l}).`;return new jh(l,E,a)}}function Hxe(r,t){return r.replace(Kxe,(s,a)=>{const l=t[a];return l!=null?String(l):`<${a}?>`})}const Kxe=/\{\$([^}]+)}/g;function qxe(r){for(const t in r)if(Object.prototype.hasOwnProperty.call(r,t))return!1;return!0}function Z_(r,t){if(r===t)return!0;const s=Object.keys(r),a=Object.keys(t);for(const l of s){if(!a.includes(l))return!1;const d=r[l],p=t[l];if(U7(d)&&U7(p)){if(!Z_(d,p))return!1}else if(d!==p)return!1}for(const l of a)if(!s.includes(l))return!1;return!0}function U7(r){return r!==null&&typeof r=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bR(r){const t=[];for(const[s,a]of Object.entries(r))Array.isArray(a)?a.forEach(l=>{t.push(encodeURIComponent(s)+"="+encodeURIComponent(l))}):t.push(encodeURIComponent(s)+"="+encodeURIComponent(a));return t.length?"&"+t.join("&"):""}function tw(r){const t={};return r.replace(/^\?/,"").split("&").forEach(a=>{if(a){const[l,d]=a.split("=");t[decodeURIComponent(l)]=decodeURIComponent(d)}}),t}function nw(r){const t=r.indexOf("?");if(!t)return"";const s=r.indexOf("#",t);return r.substring(t,s>0?s:void 0)}function $xe(r,t){const s=new Yxe(r,t);return s.subscribe.bind(s)}class Yxe{constructor(t,s){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=s,this.task.then(()=>{t(this)}).catch(a=>{this.error(a)})}next(t){this.forEachObserver(s=>{s.next(t)})}error(t){this.forEachObserver(s=>{s.error(t)}),this.close(t)}complete(){this.forEachObserver(t=>{t.complete()}),this.close()}subscribe(t,s,a){let l;if(t===void 0&&s===void 0&&a===void 0)throw new Error("Missing Observer.");Xxe(t,["next","error","complete"])?l=t:l={next:t,error:s,complete:a},l.next===void 0&&(l.next=n2),l.error===void 0&&(l.error=n2),l.complete===void 0&&(l.complete=n2);const d=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?l.error(this.finalError):l.complete()}catch{}}),this.observers.push(l),d}unsubscribeOne(t){this.observers===void 0||this.observers[t]===void 0||(delete this.observers[t],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(t){if(!this.finalized)for(let s=0;s<this.observers.length;s++)this.sendOne(s,t)}sendOne(t,s){this.task.then(()=>{if(this.observers!==void 0&&this.observers[t]!==void 0)try{s(this.observers[t])}catch(a){typeof console<"u"&&console.error&&console.error(a)}})}close(t){this.finalized||(this.finalized=!0,t!==void 0&&(this.finalError=t),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function Xxe(r,t){if(typeof r!="object"||r===null)return!1;for(const s of t)if(s in r&&typeof r[s]=="function")return!0;return!1}function n2(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qi(r){return r&&r._delegate?r._delegate:r}let jm=class{constructor(t,s,a){this.name=t,this.instanceFactory=s,this.type=a,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const O_="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jxe{constructor(t,s){this.name=t,this.container=s,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const s=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(s)){const a=new Lxe;if(this.instancesDeferred.set(s,a),this.isInitialized(s)||this.shouldAutoInitialize())try{const l=this.getOrInitializeService({instanceIdentifier:s});l&&a.resolve(l)}catch{}}return this.instancesDeferred.get(s).promise}getImmediate(t){var s;const a=this.normalizeInstanceIdentifier(t==null?void 0:t.identifier),l=(s=t==null?void 0:t.optional)!==null&&s!==void 0?s:!1;if(this.isInitialized(a)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:a})}catch(d){if(l)return null;throw d}else{if(l)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,!!this.shouldAutoInitialize()){if(Zxe(t))try{this.getOrInitializeService({instanceIdentifier:O_})}catch{}for(const[s,a]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(s);try{const d=this.getOrInitializeService({instanceIdentifier:l});a.resolve(d)}catch{}}}}clearInstance(t=O_){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter(s=>"INTERNAL"in s).map(s=>s.INTERNAL.delete()),...t.filter(s=>"_delete"in s).map(s=>s._delete())])}isComponentSet(){return this.component!=null}isInitialized(t=O_){return this.instances.has(t)}getOptions(t=O_){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:s={}}=t,a=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(a))throw Error(`${this.name}(${a}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const l=this.getOrInitializeService({instanceIdentifier:a,options:s});for(const[d,p]of this.instancesDeferred.entries()){const E=this.normalizeInstanceIdentifier(d);a===E&&p.resolve(l)}return l}onInit(t,s){var a;const l=this.normalizeInstanceIdentifier(s),d=(a=this.onInitCallbacks.get(l))!==null&&a!==void 0?a:new Set;d.add(t),this.onInitCallbacks.set(l,d);const p=this.instances.get(l);return p&&t(p,l),()=>{d.delete(t)}}invokeOnInitCallbacks(t,s){const a=this.onInitCallbacks.get(s);if(a)for(const l of a)try{l(t,s)}catch{}}getOrInitializeService({instanceIdentifier:t,options:s={}}){let a=this.instances.get(t);if(!a&&this.component&&(a=this.component.instanceFactory(this.container,{instanceIdentifier:Qxe(t),options:s}),this.instances.set(t,a),this.instancesOptions.set(t,s),this.invokeOnInitCallbacks(a,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,a)}catch{}return a||null}normalizeInstanceIdentifier(t=O_){return this.component?this.component.multipleInstances?t:O_:t}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function Qxe(r){return r===O_?void 0:r}function Zxe(r){return r.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eMe{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const s=this.getProvider(t.name);if(s.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);s.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const s=new Jxe(t,this);return this.providers.set(t,s),s}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var _r;(function(r){r[r.DEBUG=0]="DEBUG",r[r.VERBOSE=1]="VERBOSE",r[r.INFO=2]="INFO",r[r.WARN=3]="WARN",r[r.ERROR=4]="ERROR",r[r.SILENT=5]="SILENT"})(_r||(_r={}));const tMe={debug:_r.DEBUG,verbose:_r.VERBOSE,info:_r.INFO,warn:_r.WARN,error:_r.ERROR,silent:_r.SILENT},nMe=_r.INFO,rMe={[_r.DEBUG]:"log",[_r.VERBOSE]:"log",[_r.INFO]:"info",[_r.WARN]:"warn",[_r.ERROR]:"error"},iMe=(r,t,...s)=>{if(t<r.logLevel)return;const a=new Date().toISOString(),l=rMe[t];if(l)console[l](`[${a}]  ${r.name}:`,...s);else throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class DF{constructor(t){this.name=t,this._logLevel=nMe,this._logHandler=iMe,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in _r))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel=typeof t=="string"?tMe[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if(typeof t!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,_r.DEBUG,...t),this._logHandler(this,_r.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,_r.VERBOSE,...t),this._logHandler(this,_r.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,_r.INFO,...t),this._logHandler(this,_r.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,_r.WARN,...t),this._logHandler(this,_r.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,_r.ERROR,...t),this._logHandler(this,_r.ERROR,...t)}}const sMe=(r,t)=>t.some(s=>r instanceof s);let V7,F7;function oMe(){return V7||(V7=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function aMe(){return F7||(F7=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Ute=new WeakMap,TU=new WeakMap,Vte=new WeakMap,r2=new WeakMap,LF=new WeakMap;function cMe(r){const t=new Promise((s,a)=>{const l=()=>{r.removeEventListener("success",d),r.removeEventListener("error",p)},d=()=>{s(km(r.result)),l()},p=()=>{a(r.error),l()};r.addEventListener("success",d),r.addEventListener("error",p)});return t.then(s=>{s instanceof IDBCursor&&Ute.set(s,r)}).catch(()=>{}),LF.set(t,r),t}function lMe(r){if(TU.has(r))return;const t=new Promise((s,a)=>{const l=()=>{r.removeEventListener("complete",d),r.removeEventListener("error",p),r.removeEventListener("abort",p)},d=()=>{s(),l()},p=()=>{a(r.error||new DOMException("AbortError","AbortError")),l()};r.addEventListener("complete",d),r.addEventListener("error",p),r.addEventListener("abort",p)});TU.set(r,t)}let bU={get(r,t,s){if(r instanceof IDBTransaction){if(t==="done")return TU.get(r);if(t==="objectStoreNames")return r.objectStoreNames||Vte.get(r);if(t==="store")return s.objectStoreNames[1]?void 0:s.objectStore(s.objectStoreNames[0])}return km(r[t])},set(r,t,s){return r[t]=s,!0},has(r,t){return r instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in r}};function uMe(r){bU=r(bU)}function dMe(r){return r===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...s){const a=r.call(i2(this),t,...s);return Vte.set(a,t.sort?t.sort():[t]),km(a)}:aMe().includes(r)?function(...t){return r.apply(i2(this),t),km(Ute.get(this))}:function(...t){return km(r.apply(i2(this),t))}}function hMe(r){return typeof r=="function"?dMe(r):(r instanceof IDBTransaction&&lMe(r),sMe(r,oMe())?new Proxy(r,bU):r)}function km(r){if(r instanceof IDBRequest)return cMe(r);if(r2.has(r))return r2.get(r);const t=hMe(r);return t!==r&&(r2.set(r,t),LF.set(t,r)),t}const i2=r=>LF.get(r);function fMe(r,t,{blocked:s,upgrade:a,blocking:l,terminated:d}={}){const p=indexedDB.open(r,t),E=km(p);return a&&p.addEventListener("upgradeneeded",v=>{a(km(p.result),v.oldVersion,v.newVersion,km(p.transaction),v)}),s&&p.addEventListener("blocked",v=>s(v.oldVersion,v.newVersion,v)),E.then(v=>{d&&v.addEventListener("close",()=>d()),l&&v.addEventListener("versionchange",b=>l(b.oldVersion,b.newVersion,b))}).catch(()=>{}),E}const pMe=["get","getKey","getAll","getAllKeys","count"],mMe=["put","add","delete","clear"],s2=new Map;function j7(r,t){if(!(r instanceof IDBDatabase&&!(t in r)&&typeof t=="string"))return;if(s2.get(t))return s2.get(t);const s=t.replace(/FromIndex$/,""),a=t!==s,l=mMe.includes(s);if(!(s in(a?IDBIndex:IDBObjectStore).prototype)||!(l||pMe.includes(s)))return;const d=async function(p,...E){const v=this.transaction(p,l?"readwrite":"readonly");let b=v.store;return a&&(b=b.index(E.shift())),(await Promise.all([b[s](...E),l&&v.done]))[0]};return s2.set(t,d),d}uMe(r=>({...r,get:(t,s,a)=>j7(t,s)||r.get(t,s,a),has:(t,s)=>!!j7(t,s)||r.has(t,s)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gMe{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(s=>{if(_Me(s)){const a=s.getImmediate();return`${a.library}/${a.version}`}else return null}).filter(s=>s).join(" ")}}function _Me(r){const t=r.getComponent();return(t==null?void 0:t.type)==="VERSION"}const wU="@firebase/app",B7="0.11.2";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ip=new DF("@firebase/app"),EMe="@firebase/app-compat",yMe="@firebase/analytics-compat",vMe="@firebase/analytics",SMe="@firebase/app-check-compat",TMe="@firebase/app-check",bMe="@firebase/auth",wMe="@firebase/auth-compat",RMe="@firebase/database",CMe="@firebase/data-connect",IMe="@firebase/database-compat",AMe="@firebase/functions",OMe="@firebase/functions-compat",PMe="@firebase/installations",NMe="@firebase/installations-compat",kMe="@firebase/messaging",DMe="@firebase/messaging-compat",LMe="@firebase/performance",xMe="@firebase/performance-compat",MMe="@firebase/remote-config",UMe="@firebase/remote-config-compat",VMe="@firebase/storage",FMe="@firebase/storage-compat",jMe="@firebase/firestore",BMe="@firebase/vertexai",WMe="@firebase/firestore-compat",GMe="firebase",zMe="11.4.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RU="[DEFAULT]",HMe={[wU]:"fire-core",[EMe]:"fire-core-compat",[vMe]:"fire-analytics",[yMe]:"fire-analytics-compat",[TMe]:"fire-app-check",[SMe]:"fire-app-check-compat",[bMe]:"fire-auth",[wMe]:"fire-auth-compat",[RMe]:"fire-rtdb",[CMe]:"fire-data-connect",[IMe]:"fire-rtdb-compat",[AMe]:"fire-fn",[OMe]:"fire-fn-compat",[PMe]:"fire-iid",[NMe]:"fire-iid-compat",[kMe]:"fire-fcm",[DMe]:"fire-fcm-compat",[LMe]:"fire-perf",[xMe]:"fire-perf-compat",[MMe]:"fire-rc",[UMe]:"fire-rc-compat",[VMe]:"fire-gcs",[FMe]:"fire-gcs-compat",[jMe]:"fire-fst",[WMe]:"fire-fst-compat",[BMe]:"fire-vertex","fire-js":"fire-js",[GMe]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XP=new Map,KMe=new Map,CU=new Map;function W7(r,t){try{r.container.addComponent(t)}catch(s){ip.debug(`Component ${t.name} failed to register with FirebaseApp ${r.name}`,s)}}function eE(r){const t=r.name;if(CU.has(t))return ip.debug(`There were multiple attempts to register component ${t}.`),!1;CU.set(t,r);for(const s of XP.values())W7(s,r);for(const s of KMe.values())W7(s,r);return!0}function XN(r,t){const s=r.container.getProvider("heartbeat").getImmediate({optional:!0});return s&&s.triggerHeartbeat(),r.container.getProvider(t)}function ul(r){return r==null?!1:r.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qMe={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Dm=new TR("app","Firebase",qMe);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $Me{constructor(t,s,a){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},s),this._name=s.name,this._automaticDataCollectionEnabled=s.automaticDataCollectionEnabled,this._container=a,this.container.addComponent(new jm("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw Dm.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lE=zMe;function Fte(r,t={}){let s=r;typeof t!="object"&&(t={name:t});const a=Object.assign({name:RU,automaticDataCollectionEnabled:!1},t),l=a.name;if(typeof l!="string"||!l)throw Dm.create("bad-app-name",{appName:String(l)});if(s||(s=Lte()),!s)throw Dm.create("no-options");const d=XP.get(l);if(d){if(Z_(s,d.options)&&Z_(a,d.config))return d;throw Dm.create("duplicate-app",{appName:l})}const p=new eMe(l);for(const v of CU.values())p.addComponent(v);const E=new $Me(s,a,p);return XP.set(l,E),E}function xF(r=RU){const t=XP.get(r);if(!t&&r===RU&&Lte())return Fte();if(!t)throw Dm.create("no-app",{appName:r});return t}function bh(r,t,s){var a;let l=(a=HMe[r])!==null&&a!==void 0?a:r;s&&(l+=`-${s}`);const d=l.match(/\s|\//),p=t.match(/\s|\//);if(d||p){const E=[`Unable to register library "${l}" with version "${t}":`];d&&E.push(`library name "${l}" contains illegal characters (whitespace or "/")`),d&&p&&E.push("and"),p&&E.push(`version name "${t}" contains illegal characters (whitespace or "/")`),ip.warn(E.join(" "));return}eE(new jm(`${l}-version`,()=>({library:l,version:t}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YMe="firebase-heartbeat-database",XMe=1,qw="firebase-heartbeat-store";let o2=null;function jte(){return o2||(o2=fMe(YMe,XMe,{upgrade:(r,t)=>{switch(t){case 0:try{r.createObjectStore(qw)}catch(s){console.warn(s)}}}}).catch(r=>{throw Dm.create("idb-open",{originalErrorMessage:r.message})})),o2}async function JMe(r){try{const s=(await jte()).transaction(qw),a=await s.objectStore(qw).get(Bte(r));return await s.done,a}catch(t){if(t instanceof jh)ip.warn(t.message);else{const s=Dm.create("idb-get",{originalErrorMessage:t==null?void 0:t.message});ip.warn(s.message)}}}async function G7(r,t){try{const a=(await jte()).transaction(qw,"readwrite");await a.objectStore(qw).put(t,Bte(r)),await a.done}catch(s){if(s instanceof jh)ip.warn(s.message);else{const a=Dm.create("idb-set",{originalErrorMessage:s==null?void 0:s.message});ip.warn(a.message)}}}function Bte(r){return`${r.name}!${r.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QMe=1024,ZMe=30;class e2e{constructor(t){this.container=t,this._heartbeatsCache=null;const s=this.container.getProvider("app").getImmediate();this._storage=new n2e(s),this._heartbeatsCachePromise=this._storage.read().then(a=>(this._heartbeatsCache=a,a))}async triggerHeartbeat(){var t,s;try{const l=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),d=z7();if(((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((s=this._heartbeatsCache)===null||s===void 0?void 0:s.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===d||this._heartbeatsCache.heartbeats.some(p=>p.date===d))return;if(this._heartbeatsCache.heartbeats.push({date:d,agent:l}),this._heartbeatsCache.heartbeats.length>ZMe){const p=r2e(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(p,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(a){ip.warn(a)}}async getHeartbeatsHeader(){var t;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const s=z7(),{heartbeatsToSend:a,unsentEntries:l}=t2e(this._heartbeatsCache.heartbeats),d=YP(JSON.stringify({version:2,heartbeats:a}));return this._heartbeatsCache.lastSentHeartbeatDate=s,l.length>0?(this._heartbeatsCache.heartbeats=l,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),d}catch(s){return ip.warn(s),""}}}function z7(){return new Date().toISOString().substring(0,10)}function t2e(r,t=QMe){const s=[];let a=r.slice();for(const l of r){const d=s.find(p=>p.agent===l.agent);if(d){if(d.dates.push(l.date),H7(s)>t){d.dates.pop();break}}else if(s.push({agent:l.agent,dates:[l.date]}),H7(s)>t){s.pop();break}a=a.slice(1)}return{heartbeatsToSend:s,unsentEntries:a}}class n2e{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Wxe()?Gxe().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const s=await JMe(this.app);return s!=null&&s.heartbeats?s:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(t){var s;if(await this._canUseIndexedDBPromise){const l=await this.read();return G7(this.app,{lastSentHeartbeatDate:(s=t.lastSentHeartbeatDate)!==null&&s!==void 0?s:l.lastSentHeartbeatDate,heartbeats:t.heartbeats})}else return}async add(t){var s;if(await this._canUseIndexedDBPromise){const l=await this.read();return G7(this.app,{lastSentHeartbeatDate:(s=t.lastSentHeartbeatDate)!==null&&s!==void 0?s:l.lastSentHeartbeatDate,heartbeats:[...l.heartbeats,...t.heartbeats]})}else return}}function H7(r){return YP(JSON.stringify({version:2,heartbeats:r})).length}function r2e(r){if(r.length===0)return-1;let t=0,s=r[0].date;for(let a=1;a<r.length;a++)r[a].date<s&&(s=r[a].date,t=a);return t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function i2e(r){eE(new jm("platform-logger",t=>new gMe(t),"PRIVATE")),eE(new jm("heartbeat",t=>new e2e(t),"PRIVATE")),bh(wU,B7,r),bh(wU,B7,"esm2017"),bh("fire-js","")}i2e("");function Wte(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const s2e=Wte,Gte=new TR("auth","Firebase",Wte());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JP=new DF("@firebase/auth");function o2e(r,...t){JP.logLevel<=_r.WARN&&JP.warn(`Auth (${lE}): ${r}`,...t)}function SP(r,...t){JP.logLevel<=_r.ERROR&&JP.error(`Auth (${lE}): ${r}`,...t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ld(r,...t){throw MF(r,...t)}function wh(r,...t){return MF(r,...t)}function zte(r,t,s){const a=Object.assign(Object.assign({},s2e()),{[t]:s});return new TR("auth","Firebase",a).create(t,{appName:r.name})}function Zf(r){return zte(r,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function MF(r,...t){if(typeof r!="string"){const s=t[0],a=[...t.slice(1)];return a[0]&&(a[0].appName=r.name),r._errorFactory.create(s,...a)}return Gte.create(r,...t)}function Nn(r,t,...s){if(!r)throw MF(t,...s)}function qf(r){const t="INTERNAL ASSERTION FAILED: "+r;throw SP(t),new Error(t)}function sp(r,t){r||qf(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function IU(){var r;return typeof self<"u"&&((r=self.location)===null||r===void 0?void 0:r.href)||""}function a2e(){return K7()==="http:"||K7()==="https:"}function K7(){var r;return typeof self<"u"&&((r=self.location)===null||r===void 0?void 0:r.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function c2e(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(a2e()||Vxe()||"connection"in navigator)?navigator.onLine:!0}function l2e(){if(typeof navigator>"u")return null;const r=navigator;return r.languages&&r.languages[0]||r.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wR{constructor(t,s){this.shortDelay=t,this.longDelay=s,sp(s>t,"Short delay should be less than long delay!"),this.isMobile=xxe()||Fxe()}get(){return c2e()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function UF(r,t){sp(r.emulator,"Emulator should always be set here");const{url:s}=r.emulator;return t?`${s}${t.startsWith("/")?t.slice(1):t}`:s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hte{static initialize(t,s,a){this.fetchImpl=t,s&&(this.headersImpl=s),a&&(this.responseImpl=a)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;qf("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;qf("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;qf("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const u2e={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const d2e=new wR(3e4,6e4);function Qm(r,t){return r.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:r.tenantId}):t}async function Zm(r,t,s,a,l={}){return Kte(r,l,async()=>{let d={},p={};a&&(t==="GET"?p=a:d={body:JSON.stringify(a)});const E=bR(Object.assign({key:r.config.apiKey},p)).slice(1),v=await r._getAdditionalHeaders();v["Content-Type"]="application/json",r.languageCode&&(v["X-Firebase-Locale"]=r.languageCode);const b=Object.assign({method:t,headers:v},d);return Uxe()||(b.referrerPolicy="no-referrer"),Hte.fetch()(qte(r,r.config.apiHost,s,E),b)})}async function Kte(r,t,s){r._canInitEmulator=!1;const a=Object.assign(Object.assign({},u2e),t);try{const l=new f2e(r),d=await Promise.race([s(),l.promise]);l.clearNetworkTimeout();const p=await d.json();if("needConfirmation"in p)throw BO(r,"account-exists-with-different-credential",p);if(d.ok&&!("errorMessage"in p))return p;{const E=d.ok?p.errorMessage:p.error.message,[v,b]=E.split(" : ");if(v==="FEDERATED_USER_ID_ALREADY_LINKED")throw BO(r,"credential-already-in-use",p);if(v==="EMAIL_EXISTS")throw BO(r,"email-already-in-use",p);if(v==="USER_DISABLED")throw BO(r,"user-disabled",p);const R=a[v]||v.toLowerCase().replace(/[_\s]+/g,"-");if(b)throw zte(r,R,b);ld(r,R)}}catch(l){if(l instanceof jh)throw l;ld(r,"network-request-failed",{message:String(l)})}}async function RR(r,t,s,a,l={}){const d=await Zm(r,t,s,a,l);return"mfaPendingCredential"in d&&ld(r,"multi-factor-auth-required",{_serverResponse:d}),d}function qte(r,t,s,a){const l=`${t}${s}?${a}`;return r.config.emulator?UF(r.config,l):`${r.config.apiScheme}://${l}`}function h2e(r){switch(r){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class f2e{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(t){this.auth=t,this.timer=null,this.promise=new Promise((s,a)=>{this.timer=setTimeout(()=>a(wh(this.auth,"network-request-failed")),d2e.get())})}}function BO(r,t,s){const a={appName:r.name};s.email&&(a.email=s.email),s.phoneNumber&&(a.phoneNumber=s.phoneNumber);const l=wh(r,t,a);return l.customData._tokenResponse=s,l}function q7(r){return r!==void 0&&r.enterprise!==void 0}class p2e{constructor(t){if(this.siteKey="",this.recaptchaEnforcementState=[],t.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=t.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=t.recaptchaEnforcementState}getProviderEnforcementState(t){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const s of this.recaptchaEnforcementState)if(s.provider&&s.provider===t)return h2e(s.enforcementState);return null}isProviderEnabled(t){return this.getProviderEnforcementState(t)==="ENFORCE"||this.getProviderEnforcementState(t)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function m2e(r,t){return Zm(r,"GET","/v2/recaptchaConfig",Qm(r,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function g2e(r,t){return Zm(r,"POST","/v1/accounts:delete",t)}async function $te(r,t){return Zm(r,"POST","/v1/accounts:lookup",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tw(r){if(r)try{const t=new Date(Number(r));if(!isNaN(t.getTime()))return t.toUTCString()}catch{}}async function _2e(r,t=!1){const s=Qi(r),a=await s.getIdToken(t),l=VF(a);Nn(l&&l.exp&&l.auth_time&&l.iat,s.auth,"internal-error");const d=typeof l.firebase=="object"?l.firebase:void 0,p=d==null?void 0:d.sign_in_provider;return{claims:l,token:a,authTime:Tw(a2(l.auth_time)),issuedAtTime:Tw(a2(l.iat)),expirationTime:Tw(a2(l.exp)),signInProvider:p||null,signInSecondFactor:(d==null?void 0:d.sign_in_second_factor)||null}}function a2(r){return Number(r)*1e3}function VF(r){const[t,s,a]=r.split(".");if(t===void 0||s===void 0||a===void 0)return SP("JWT malformed, contained fewer than 3 sections"),null;try{const l=Nte(s);return l?JSON.parse(l):(SP("Failed to decode base64 JWT payload"),null)}catch(l){return SP("Caught error parsing JWT payload as JSON",l==null?void 0:l.toString()),null}}function $7(r){const t=VF(r);return Nn(t,"internal-error"),Nn(typeof t.exp<"u","internal-error"),Nn(typeof t.iat<"u","internal-error"),Number(t.exp)-Number(t.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function $w(r,t,s=!1){if(s)return t;try{return await t}catch(a){throw a instanceof jh&&E2e(a)&&r.auth.currentUser===r&&await r.auth.signOut(),a}}function E2e({code:r}){return r==="auth/user-disabled"||r==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class y2e{constructor(t){this.user=t,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(t){var s;if(t){const a=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),a}else{this.errorBackoff=3e4;const l=((s=this.user.stsTokenManager.expirationTime)!==null&&s!==void 0?s:0)-Date.now()-3e5;return Math.max(0,l)}}schedule(t=!1){if(!this.isRunning)return;const s=this.getInterval(t);this.timerId=setTimeout(async()=>{await this.iteration()},s)}async iteration(){try{await this.user.getIdToken(!0)}catch(t){(t==null?void 0:t.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AU{constructor(t,s){this.createdAt=t,this.lastLoginAt=s,this._initializeTime()}_initializeTime(){this.lastSignInTime=Tw(this.lastLoginAt),this.creationTime=Tw(this.createdAt)}_copy(t){this.createdAt=t.createdAt,this.lastLoginAt=t.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function QP(r){var t;const s=r.auth,a=await r.getIdToken(),l=await $w(r,$te(s,{idToken:a}));Nn(l==null?void 0:l.users.length,s,"internal-error");const d=l.users[0];r._notifyReloadListener(d);const p=!((t=d.providerUserInfo)===null||t===void 0)&&t.length?Yte(d.providerUserInfo):[],E=S2e(r.providerData,p),v=r.isAnonymous,b=!(r.email&&d.passwordHash)&&!(E!=null&&E.length),R=v?b:!1,O={uid:d.localId,displayName:d.displayName||null,photoURL:d.photoUrl||null,email:d.email||null,emailVerified:d.emailVerified||!1,phoneNumber:d.phoneNumber||null,tenantId:d.tenantId||null,providerData:E,metadata:new AU(d.createdAt,d.lastLoginAt),isAnonymous:R};Object.assign(r,O)}async function v2e(r){const t=Qi(r);await QP(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}function S2e(r,t){return[...r.filter(a=>!t.some(l=>l.providerId===a.providerId)),...t]}function Yte(r){return r.map(t=>{var{providerId:s}=t,a=gR(t,["providerId"]);return{providerId:s,uid:a.rawId||"",displayName:a.displayName||null,email:a.email||null,phoneNumber:a.phoneNumber||null,photoURL:a.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function T2e(r,t){const s=await Kte(r,{},async()=>{const a=bR({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:l,apiKey:d}=r.config,p=qte(r,l,"/v1/token",`key=${d}`),E=await r._getAdditionalHeaders();return E["Content-Type"]="application/x-www-form-urlencoded",Hte.fetch()(p,{method:"POST",headers:E,body:a})});return{accessToken:s.access_token,expiresIn:s.expires_in,refreshToken:s.refresh_token}}async function b2e(r,t){return Zm(r,"POST","/v2/accounts:revokeToken",Qm(r,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pS{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(t){Nn(t.idToken,"internal-error"),Nn(typeof t.idToken<"u","internal-error"),Nn(typeof t.refreshToken<"u","internal-error");const s="expiresIn"in t&&typeof t.expiresIn<"u"?Number(t.expiresIn):$7(t.idToken);this.updateTokensAndExpiration(t.idToken,t.refreshToken,s)}updateFromIdToken(t){Nn(t.length!==0,"internal-error");const s=$7(t);this.updateTokensAndExpiration(t,null,s)}async getToken(t,s=!1){return!s&&this.accessToken&&!this.isExpired?this.accessToken:(Nn(this.refreshToken,t,"user-token-expired"),this.refreshToken?(await this.refresh(t,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(t,s){const{accessToken:a,refreshToken:l,expiresIn:d}=await T2e(t,s);this.updateTokensAndExpiration(a,l,Number(d))}updateTokensAndExpiration(t,s,a){this.refreshToken=s||null,this.accessToken=t||null,this.expirationTime=Date.now()+a*1e3}static fromJSON(t,s){const{refreshToken:a,accessToken:l,expirationTime:d}=s,p=new pS;return a&&(Nn(typeof a=="string","internal-error",{appName:t}),p.refreshToken=a),l&&(Nn(typeof l=="string","internal-error",{appName:t}),p.accessToken=l),d&&(Nn(typeof d=="number","internal-error",{appName:t}),p.expirationTime=d),p}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(t){this.accessToken=t.accessToken,this.refreshToken=t.refreshToken,this.expirationTime=t.expirationTime}_clone(){return Object.assign(new pS,this.toJSON())}_performRefresh(){return qf("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vm(r,t){Nn(typeof r=="string"||typeof r>"u","internal-error",{appName:t})}class $f{constructor(t){var{uid:s,auth:a,stsTokenManager:l}=t,d=gR(t,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new y2e(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=s,this.auth=a,this.stsTokenManager=l,this.accessToken=l.accessToken,this.displayName=d.displayName||null,this.email=d.email||null,this.emailVerified=d.emailVerified||!1,this.phoneNumber=d.phoneNumber||null,this.photoURL=d.photoURL||null,this.isAnonymous=d.isAnonymous||!1,this.tenantId=d.tenantId||null,this.providerData=d.providerData?[...d.providerData]:[],this.metadata=new AU(d.createdAt||void 0,d.lastLoginAt||void 0)}async getIdToken(t){const s=await $w(this,this.stsTokenManager.getToken(this.auth,t));return Nn(s,this.auth,"internal-error"),this.accessToken!==s&&(this.accessToken=s,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),s}getIdTokenResult(t){return _2e(this,t)}reload(){return v2e(this)}_assign(t){this!==t&&(Nn(this.uid===t.uid,this.auth,"internal-error"),this.displayName=t.displayName,this.photoURL=t.photoURL,this.email=t.email,this.emailVerified=t.emailVerified,this.phoneNumber=t.phoneNumber,this.isAnonymous=t.isAnonymous,this.tenantId=t.tenantId,this.providerData=t.providerData.map(s=>Object.assign({},s)),this.metadata._copy(t.metadata),this.stsTokenManager._assign(t.stsTokenManager))}_clone(t){const s=new $f(Object.assign(Object.assign({},this),{auth:t,stsTokenManager:this.stsTokenManager._clone()}));return s.metadata._copy(this.metadata),s}_onReload(t){Nn(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=t,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(t){this.reloadListener?this.reloadListener(t):this.reloadUserInfo=t}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(t,s=!1){let a=!1;t.idToken&&t.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(t),a=!0),s&&await QP(this),await this.auth._persistUserIfCurrent(this),a&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(ul(this.auth.app))return Promise.reject(Zf(this.auth));const t=await this.getIdToken();return await $w(this,g2e(this.auth,{idToken:t})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(t=>Object.assign({},t)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(t,s){var a,l,d,p,E,v,b,R;const O=(a=s.displayName)!==null&&a!==void 0?a:void 0,N=(l=s.email)!==null&&l!==void 0?l:void 0,F=(d=s.phoneNumber)!==null&&d!==void 0?d:void 0,H=(p=s.photoURL)!==null&&p!==void 0?p:void 0,z=(E=s.tenantId)!==null&&E!==void 0?E:void 0,G=(v=s._redirectEventId)!==null&&v!==void 0?v:void 0,ee=(b=s.createdAt)!==null&&b!==void 0?b:void 0,J=(R=s.lastLoginAt)!==null&&R!==void 0?R:void 0,{uid:re,emailVerified:de,isAnonymous:se,providerData:ye,stsTokenManager:Q}=s;Nn(re&&Q,t,"internal-error");const ne=pS.fromJSON(this.name,Q);Nn(typeof re=="string",t,"internal-error"),vm(O,t.name),vm(N,t.name),Nn(typeof de=="boolean",t,"internal-error"),Nn(typeof se=="boolean",t,"internal-error"),vm(F,t.name),vm(H,t.name),vm(z,t.name),vm(G,t.name),vm(ee,t.name),vm(J,t.name);const oe=new $f({uid:re,auth:t,email:N,emailVerified:de,displayName:O,isAnonymous:se,photoURL:H,phoneNumber:F,tenantId:z,stsTokenManager:ne,createdAt:ee,lastLoginAt:J});return ye&&Array.isArray(ye)&&(oe.providerData=ye.map(ue=>Object.assign({},ue))),G&&(oe._redirectEventId=G),oe}static async _fromIdTokenResponse(t,s,a=!1){const l=new pS;l.updateFromServerResponse(s);const d=new $f({uid:s.localId,auth:t,stsTokenManager:l,isAnonymous:a});return await QP(d),d}static async _fromGetAccountInfoResponse(t,s,a){const l=s.users[0];Nn(l.localId!==void 0,"internal-error");const d=l.providerUserInfo!==void 0?Yte(l.providerUserInfo):[],p=!(l.email&&l.passwordHash)&&!(d!=null&&d.length),E=new pS;E.updateFromIdToken(a);const v=new $f({uid:l.localId,auth:t,stsTokenManager:E,isAnonymous:p}),b={uid:l.localId,displayName:l.displayName||null,photoURL:l.photoUrl||null,email:l.email||null,emailVerified:l.emailVerified||!1,phoneNumber:l.phoneNumber||null,tenantId:l.tenantId||null,providerData:d,metadata:new AU(l.createdAt,l.lastLoginAt),isAnonymous:!(l.email&&l.passwordHash)&&!(d!=null&&d.length)};return Object.assign(v,b),v}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Y7=new Map;function Yf(r){sp(r instanceof Function,"Expected a class definition");let t=Y7.get(r);return t?(sp(t instanceof r,"Instance stored in cache mismatched with class"),t):(t=new r,Y7.set(r,t),t)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xte{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(t,s){this.storage[t]=s}async _get(t){const s=this.storage[t];return s===void 0?null:s}async _remove(t){delete this.storage[t]}_addListener(t,s){}_removeListener(t,s){}}Xte.type="NONE";const X7=Xte;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function TP(r,t,s){return`firebase:${r}:${t}:${s}`}class mS{constructor(t,s,a){this.persistence=t,this.auth=s,this.userKey=a;const{config:l,name:d}=this.auth;this.fullUserKey=TP(this.userKey,l.apiKey,d),this.fullPersistenceKey=TP("persistence",l.apiKey,d),this.boundEventHandler=s._onStorageEvent.bind(s),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(t){return this.persistence._set(this.fullUserKey,t.toJSON())}async getCurrentUser(){const t=await this.persistence._get(this.fullUserKey);return t?$f._fromJSON(this.auth,t):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(t){if(this.persistence===t)return;const s=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=t,s)return this.setCurrentUser(s)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(t,s,a="authUser"){if(!s.length)return new mS(Yf(X7),t,a);const l=(await Promise.all(s.map(async b=>{if(await b._isAvailable())return b}))).filter(b=>b);let d=l[0]||Yf(X7);const p=TP(a,t.config.apiKey,t.name);let E=null;for(const b of s)try{const R=await b._get(p);if(R){const O=$f._fromJSON(t,R);b!==d&&(E=O),d=b;break}}catch{}const v=l.filter(b=>b._shouldAllowMigration);return!d._shouldAllowMigration||!v.length?new mS(d,t,a):(d=v[0],E&&await d._set(p,E.toJSON()),await Promise.all(s.map(async b=>{if(b!==d)try{await b._remove(p)}catch{}})),new mS(d,t,a))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function J7(r){const t=r.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(ene(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(Jte(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(nne(t))return"Blackberry";if(rne(t))return"Webos";if(Qte(t))return"Safari";if((t.includes("chrome/")||Zte(t))&&!t.includes("edge/"))return"Chrome";if(tne(t))return"Android";{const s=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,a=r.match(s);if((a==null?void 0:a.length)===2)return a[1]}return"Other"}function Jte(r=wa()){return/firefox\//i.test(r)}function Qte(r=wa()){const t=r.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function Zte(r=wa()){return/crios\//i.test(r)}function ene(r=wa()){return/iemobile/i.test(r)}function tne(r=wa()){return/android/i.test(r)}function nne(r=wa()){return/blackberry/i.test(r)}function rne(r=wa()){return/webos/i.test(r)}function FF(r=wa()){return/iphone|ipad|ipod/i.test(r)||/macintosh/i.test(r)&&/mobile/i.test(r)}function w2e(r=wa()){var t;return FF(r)&&!!(!((t=window.navigator)===null||t===void 0)&&t.standalone)}function R2e(){return jxe()&&document.documentMode===10}function ine(r=wa()){return FF(r)||tne(r)||rne(r)||nne(r)||/windows phone/i.test(r)||ene(r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sne(r,t=[]){let s;switch(r){case"Browser":s=J7(wa());break;case"Worker":s=`${J7(wa())}-${r}`;break;default:s=r}const a=t.length?t.join(","):"FirebaseCore-web";return`${s}/JsCore/${lE}/${a}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class C2e{constructor(t){this.auth=t,this.queue=[]}pushCallback(t,s){const a=d=>new Promise((p,E)=>{try{const v=t(d);p(v)}catch(v){E(v)}});a.onAbort=s,this.queue.push(a);const l=this.queue.length-1;return()=>{this.queue[l]=()=>Promise.resolve()}}async runMiddleware(t){if(this.auth.currentUser===t)return;const s=[];try{for(const a of this.queue)await a(t),a.onAbort&&s.push(a.onAbort)}catch(a){s.reverse();for(const l of s)try{l()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:a==null?void 0:a.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function I2e(r,t={}){return Zm(r,"GET","/v2/passwordPolicy",Qm(r,t))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const A2e=6;class O2e{constructor(t){var s,a,l,d;const p=t.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(s=p.minPasswordLength)!==null&&s!==void 0?s:A2e,p.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=p.maxPasswordLength),p.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=p.containsLowercaseCharacter),p.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=p.containsUppercaseCharacter),p.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=p.containsNumericCharacter),p.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=p.containsNonAlphanumericCharacter),this.enforcementState=t.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(l=(a=t.allowedNonAlphanumericCharacters)===null||a===void 0?void 0:a.join(""))!==null&&l!==void 0?l:"",this.forceUpgradeOnSignin=(d=t.forceUpgradeOnSignin)!==null&&d!==void 0?d:!1,this.schemaVersion=t.schemaVersion}validatePassword(t){var s,a,l,d,p,E;const v={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(t,v),this.validatePasswordCharacterOptions(t,v),v.isValid&&(v.isValid=(s=v.meetsMinPasswordLength)!==null&&s!==void 0?s:!0),v.isValid&&(v.isValid=(a=v.meetsMaxPasswordLength)!==null&&a!==void 0?a:!0),v.isValid&&(v.isValid=(l=v.containsLowercaseLetter)!==null&&l!==void 0?l:!0),v.isValid&&(v.isValid=(d=v.containsUppercaseLetter)!==null&&d!==void 0?d:!0),v.isValid&&(v.isValid=(p=v.containsNumericCharacter)!==null&&p!==void 0?p:!0),v.isValid&&(v.isValid=(E=v.containsNonAlphanumericCharacter)!==null&&E!==void 0?E:!0),v}validatePasswordLengthOptions(t,s){const a=this.customStrengthOptions.minPasswordLength,l=this.customStrengthOptions.maxPasswordLength;a&&(s.meetsMinPasswordLength=t.length>=a),l&&(s.meetsMaxPasswordLength=t.length<=l)}validatePasswordCharacterOptions(t,s){this.updatePasswordCharacterOptionsStatuses(s,!1,!1,!1,!1);let a;for(let l=0;l<t.length;l++)a=t.charAt(l),this.updatePasswordCharacterOptionsStatuses(s,a>="a"&&a<="z",a>="A"&&a<="Z",a>="0"&&a<="9",this.allowedNonAlphanumericCharacters.includes(a))}updatePasswordCharacterOptionsStatuses(t,s,a,l,d){this.customStrengthOptions.containsLowercaseLetter&&(t.containsLowercaseLetter||(t.containsLowercaseLetter=s)),this.customStrengthOptions.containsUppercaseLetter&&(t.containsUppercaseLetter||(t.containsUppercaseLetter=a)),this.customStrengthOptions.containsNumericCharacter&&(t.containsNumericCharacter||(t.containsNumericCharacter=l)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(t.containsNonAlphanumericCharacter||(t.containsNonAlphanumericCharacter=d))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class P2e{constructor(t,s,a,l){this.app=t,this.heartbeatServiceProvider=s,this.appCheckServiceProvider=a,this.config=l,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Q7(this),this.idTokenSubscription=new Q7(this),this.beforeStateQueue=new C2e(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Gte,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=t.name,this.clientVersion=l.sdkClientVersion}_initializeWithPersistence(t,s){return s&&(this._popupRedirectResolver=Yf(s)),this._initializationPromise=this.queue(async()=>{var a,l;if(!this._deleted&&(this.persistenceManager=await mS.create(this,t),!this._deleted)){if(!((a=this._popupRedirectResolver)===null||a===void 0)&&a._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(s),this.lastNotifiedUid=((l=this.currentUser)===null||l===void 0?void 0:l.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const t=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!t)){if(this.currentUser&&t&&this.currentUser.uid===t.uid){this._currentUser._assign(t),await this.currentUser.getIdToken();return}await this._updateCurrentUser(t,!0)}}async initializeCurrentUserFromIdToken(t){try{const s=await $te(this,{idToken:t}),a=await $f._fromGetAccountInfoResponse(this,s,t);await this.directlySetCurrentUser(a)}catch(s){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",s),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(t){var s;if(ul(this.app)){const p=this.app.settings.authIdToken;return p?new Promise(E=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(p).then(E,E))}):this.directlySetCurrentUser(null)}const a=await this.assertedPersistence.getCurrentUser();let l=a,d=!1;if(t&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const p=(s=this.redirectUser)===null||s===void 0?void 0:s._redirectEventId,E=l==null?void 0:l._redirectEventId,v=await this.tryRedirectSignIn(t);(!p||p===E)&&(v!=null&&v.user)&&(l=v.user,d=!0)}if(!l)return this.directlySetCurrentUser(null);if(!l._redirectEventId){if(d)try{await this.beforeStateQueue.runMiddleware(l)}catch(p){l=a,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(p))}return l?this.reloadAndSetCurrentUserOrClear(l):this.directlySetCurrentUser(null)}return Nn(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===l._redirectEventId?this.directlySetCurrentUser(l):this.reloadAndSetCurrentUserOrClear(l)}async tryRedirectSignIn(t){let s=null;try{s=await this._popupRedirectResolver._completeRedirectFn(this,t,!0)}catch{await this._setRedirectUser(null)}return s}async reloadAndSetCurrentUserOrClear(t){try{await QP(t)}catch(s){if((s==null?void 0:s.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(t)}useDeviceLanguage(){this.languageCode=l2e()}async _delete(){this._deleted=!0}async updateCurrentUser(t){if(ul(this.app))return Promise.reject(Zf(this));const s=t?Qi(t):null;return s&&Nn(s.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(s&&s._clone(this))}async _updateCurrentUser(t,s=!1){if(!this._deleted)return t&&Nn(this.tenantId===t.tenantId,this,"tenant-id-mismatch"),s||await this.beforeStateQueue.runMiddleware(t),this.queue(async()=>{await this.directlySetCurrentUser(t),this.notifyAuthListeners()})}async signOut(){return ul(this.app)?Promise.reject(Zf(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(t){return ul(this.app)?Promise.reject(Zf(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Yf(t))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(t){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const s=this._getPasswordPolicyInternal();return s.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):s.validatePassword(t)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const t=await I2e(this),s=new O2e(t);this.tenantId===null?this._projectPasswordPolicy=s:this._tenantPasswordPolicies[this.tenantId]=s}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(t){this._errorFactory=new TR("auth","Firebase",t())}onAuthStateChanged(t,s,a){return this.registerStateListener(this.authStateSubscription,t,s,a)}beforeAuthStateChanged(t,s){return this.beforeStateQueue.pushCallback(t,s)}onIdTokenChanged(t,s,a){return this.registerStateListener(this.idTokenSubscription,t,s,a)}authStateReady(){return new Promise((t,s)=>{if(this.currentUser)t();else{const a=this.onAuthStateChanged(()=>{a(),t()},s)}})}async revokeAccessToken(t){if(this.currentUser){const s=await this.currentUser.getIdToken(),a={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:t,idToken:s};this.tenantId!=null&&(a.tenantId=this.tenantId),await b2e(this,a)}}toJSON(){var t;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(t=this._currentUser)===null||t===void 0?void 0:t.toJSON()}}async _setRedirectUser(t,s){const a=await this.getOrInitRedirectPersistenceManager(s);return t===null?a.removeCurrentUser():a.setCurrentUser(t)}async getOrInitRedirectPersistenceManager(t){if(!this.redirectPersistenceManager){const s=t&&Yf(t)||this._popupRedirectResolver;Nn(s,this,"argument-error"),this.redirectPersistenceManager=await mS.create(this,[Yf(s._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(t){var s,a;return this._isInitialized&&await this.queue(async()=>{}),((s=this._currentUser)===null||s===void 0?void 0:s._redirectEventId)===t?this._currentUser:((a=this.redirectUser)===null||a===void 0?void 0:a._redirectEventId)===t?this.redirectUser:null}async _persistUserIfCurrent(t){if(t===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(t))}_notifyListenersIfCurrent(t){t===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var t,s;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const a=(s=(t=this.currentUser)===null||t===void 0?void 0:t.uid)!==null&&s!==void 0?s:null;this.lastNotifiedUid!==a&&(this.lastNotifiedUid=a,this.authStateSubscription.next(this.currentUser))}registerStateListener(t,s,a,l){if(this._deleted)return()=>{};const d=typeof s=="function"?s:s.next.bind(s);let p=!1;const E=this._isInitialized?Promise.resolve():this._initializationPromise;if(Nn(E,this,"internal-error"),E.then(()=>{p||d(this.currentUser)}),typeof s=="function"){const v=t.addObserver(s,a,l);return()=>{p=!0,v()}}else{const v=t.addObserver(s);return()=>{p=!0,v()}}}async directlySetCurrentUser(t){this.currentUser&&this.currentUser!==t&&this._currentUser._stopProactiveRefresh(),t&&this.isProactiveRefreshEnabled&&t._startProactiveRefresh(),this.currentUser=t,t?await this.assertedPersistence.setCurrentUser(t):await this.assertedPersistence.removeCurrentUser()}queue(t){return this.operations=this.operations.then(t,t),this.operations}get assertedPersistence(){return Nn(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(t){!t||this.frameworks.includes(t)||(this.frameworks.push(t),this.frameworks.sort(),this.clientVersion=sne(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var t;const s={"X-Client-Version":this.clientVersion};this.app.options.appId&&(s["X-Firebase-gmpid"]=this.app.options.appId);const a=await((t=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||t===void 0?void 0:t.getHeartbeatsHeader());a&&(s["X-Firebase-Client"]=a);const l=await this._getAppCheckToken();return l&&(s["X-Firebase-AppCheck"]=l),s}async _getAppCheckToken(){var t;if(ul(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const s=await((t=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||t===void 0?void 0:t.getToken());return s!=null&&s.error&&o2e(`Error while retrieving App Check token: ${s.error}`),s==null?void 0:s.token}}function uE(r){return Qi(r)}class Q7{constructor(t){this.auth=t,this.observer=null,this.addObserver=$xe(s=>this.observer=s)}get next(){return Nn(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let JN={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function N2e(r){JN=r}function one(r){return JN.loadJS(r)}function k2e(){return JN.recaptchaEnterpriseScript}function D2e(){return JN.gapiScript}function L2e(r){return`__${r}${Math.floor(Math.random()*1e6)}`}class x2e{constructor(){this.enterprise=new M2e}ready(t){t()}execute(t,s){return Promise.resolve("token")}render(t,s){return""}}class M2e{ready(t){t()}execute(t,s){return Promise.resolve("token")}render(t,s){return""}}const U2e="recaptcha-enterprise",ane="NO_RECAPTCHA";class V2e{constructor(t){this.type=U2e,this.auth=uE(t)}async verify(t="verify",s=!1){async function a(d){if(!s){if(d.tenantId==null&&d._agentRecaptchaConfig!=null)return d._agentRecaptchaConfig.siteKey;if(d.tenantId!=null&&d._tenantRecaptchaConfigs[d.tenantId]!==void 0)return d._tenantRecaptchaConfigs[d.tenantId].siteKey}return new Promise(async(p,E)=>{m2e(d,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(v=>{if(v.recaptchaKey===void 0)E(new Error("recaptcha Enterprise site key undefined"));else{const b=new p2e(v);return d.tenantId==null?d._agentRecaptchaConfig=b:d._tenantRecaptchaConfigs[d.tenantId]=b,p(b.siteKey)}}).catch(v=>{E(v)})})}function l(d,p,E){const v=window.grecaptcha;q7(v)?v.enterprise.ready(()=>{v.enterprise.execute(d,{action:t}).then(b=>{p(b)}).catch(()=>{p(ane)})}):E(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new x2e().execute("siteKey",{action:"verify"}):new Promise((d,p)=>{a(this.auth).then(E=>{if(!s&&q7(window.grecaptcha))l(E,d,p);else{if(typeof window>"u"){p(new Error("RecaptchaVerifier is only supported in browser"));return}let v=k2e();v.length!==0&&(v+=E),one(v).then(()=>{l(E,d,p)}).catch(b=>{p(b)})}}).catch(E=>{p(E)})})}}async function Z7(r,t,s,a=!1,l=!1){const d=new V2e(r);let p;if(l)p=ane;else try{p=await d.verify(s)}catch{p=await d.verify(s,!0)}const E=Object.assign({},t);if(s==="mfaSmsEnrollment"||s==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in E){const v=E.phoneEnrollmentInfo.phoneNumber,b=E.phoneEnrollmentInfo.recaptchaToken;Object.assign(E,{phoneEnrollmentInfo:{phoneNumber:v,recaptchaToken:b,captchaResponse:p,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in E){const v=E.phoneSignInInfo.recaptchaToken;Object.assign(E,{phoneSignInInfo:{recaptchaToken:v,captchaResponse:p,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return E}return a?Object.assign(E,{captchaResp:p}):Object.assign(E,{captchaResponse:p}),Object.assign(E,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(E,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),E}async function OU(r,t,s,a,l){var d;if(!((d=r._getRecaptchaConfig())===null||d===void 0)&&d.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const p=await Z7(r,t,s,s==="getOobCode");return a(r,p)}else return a(r,t).catch(async p=>{if(p.code==="auth/missing-recaptcha-token"){console.log(`${s} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const E=await Z7(r,t,s,s==="getOobCode");return a(r,E)}else return Promise.reject(p)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function F2e(r,t){const s=XN(r,"auth");if(s.isInitialized()){const l=s.getImmediate(),d=s.getOptions();if(Z_(d,t??{}))return l;ld(l,"already-initialized")}return s.initialize({options:t})}function j2e(r,t){const s=(t==null?void 0:t.persistence)||[],a=(Array.isArray(s)?s:[s]).map(Yf);t!=null&&t.errorMap&&r._updateErrorMap(t.errorMap),r._initializeWithPersistence(a,t==null?void 0:t.popupRedirectResolver)}function B2e(r,t,s){const a=uE(r);Nn(/^https?:\/\//.test(t),a,"invalid-emulator-scheme");const l=!1,d=cne(t),{host:p,port:E}=W2e(t),v=E===null?"":`:${E}`,b={url:`${d}//${p}${v}/`},R=Object.freeze({host:p,port:E,protocol:d.replace(":",""),options:Object.freeze({disableWarnings:l})});if(!a._canInitEmulator){Nn(a.config.emulator&&a.emulatorConfig,a,"emulator-config-failed"),Nn(Z_(b,a.config.emulator)&&Z_(R,a.emulatorConfig),a,"emulator-config-failed");return}a.config.emulator=b,a.emulatorConfig=R,a.settings.appVerificationDisabledForTesting=!0,G2e()}function cne(r){const t=r.indexOf(":");return t<0?"":r.substr(0,t+1)}function W2e(r){const t=cne(r),s=/(\/\/)?([^?#/]+)/.exec(r.substr(t.length));if(!s)return{host:"",port:null};const a=s[2].split("@").pop()||"",l=/^(\[[^\]]+\])(:|$)/.exec(a);if(l){const d=l[1];return{host:d,port:eY(a.substr(d.length+1))}}else{const[d,p]=a.split(":");return{host:d,port:eY(p)}}}function eY(r){if(!r)return null;const t=Number(r);return isNaN(t)?null:t}function G2e(){function r(){const t=document.createElement("p"),s=t.style;t.innerText="Running in emulator mode. Do not use with production credentials.",s.position="fixed",s.width="100%",s.backgroundColor="#ffffff",s.border=".1em solid #000000",s.color="#b50000",s.bottom="0px",s.left="0px",s.margin="0px",s.zIndex="10000",s.textAlign="center",t.classList.add("firebase-emulator-warning"),document.body.appendChild(t)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",r):r())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jF{constructor(t,s){this.providerId=t,this.signInMethod=s}toJSON(){return qf("not implemented")}_getIdTokenResponse(t){return qf("not implemented")}_linkToIdToken(t,s){return qf("not implemented")}_getReauthenticationResolver(t){return qf("not implemented")}}async function z2e(r,t){return Zm(r,"POST","/v1/accounts:signUp",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function H2e(r,t){return RR(r,"POST","/v1/accounts:signInWithPassword",Qm(r,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function K2e(r,t){return RR(r,"POST","/v1/accounts:signInWithEmailLink",Qm(r,t))}async function q2e(r,t){return RR(r,"POST","/v1/accounts:signInWithEmailLink",Qm(r,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yw extends jF{constructor(t,s,a,l=null){super("password",a),this._email=t,this._password=s,this._tenantId=l}static _fromEmailAndPassword(t,s){return new Yw(t,s,"password")}static _fromEmailAndCode(t,s,a=null){return new Yw(t,s,"emailLink",a)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(t){const s=typeof t=="string"?JSON.parse(t):t;if(s!=null&&s.email&&(s!=null&&s.password)){if(s.signInMethod==="password")return this._fromEmailAndPassword(s.email,s.password);if(s.signInMethod==="emailLink")return this._fromEmailAndCode(s.email,s.password,s.tenantId)}return null}async _getIdTokenResponse(t){switch(this.signInMethod){case"password":const s={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return OU(t,s,"signInWithPassword",H2e);case"emailLink":return K2e(t,{email:this._email,oobCode:this._password});default:ld(t,"internal-error")}}async _linkToIdToken(t,s){switch(this.signInMethod){case"password":const a={idToken:s,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return OU(t,a,"signUpPassword",z2e);case"emailLink":return q2e(t,{idToken:s,email:this._email,oobCode:this._password});default:ld(t,"internal-error")}}_getReauthenticationResolver(t){return this._getIdTokenResponse(t)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function gS(r,t){return RR(r,"POST","/v1/accounts:signInWithIdp",Qm(r,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $2e="http://localhost";class tE extends jF{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(t){const s=new tE(t.providerId,t.signInMethod);return t.idToken||t.accessToken?(t.idToken&&(s.idToken=t.idToken),t.accessToken&&(s.accessToken=t.accessToken),t.nonce&&!t.pendingToken&&(s.nonce=t.nonce),t.pendingToken&&(s.pendingToken=t.pendingToken)):t.oauthToken&&t.oauthTokenSecret?(s.accessToken=t.oauthToken,s.secret=t.oauthTokenSecret):ld("argument-error"),s}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(t){const s=typeof t=="string"?JSON.parse(t):t,{providerId:a,signInMethod:l}=s,d=gR(s,["providerId","signInMethod"]);if(!a||!l)return null;const p=new tE(a,l);return p.idToken=d.idToken||void 0,p.accessToken=d.accessToken||void 0,p.secret=d.secret,p.nonce=d.nonce,p.pendingToken=d.pendingToken||null,p}_getIdTokenResponse(t){const s=this.buildRequest();return gS(t,s)}_linkToIdToken(t,s){const a=this.buildRequest();return a.idToken=s,gS(t,a)}_getReauthenticationResolver(t){const s=this.buildRequest();return s.autoCreate=!1,gS(t,s)}buildRequest(){const t={requestUri:$2e,returnSecureToken:!0};if(this.pendingToken)t.pendingToken=this.pendingToken;else{const s={};this.idToken&&(s.id_token=this.idToken),this.accessToken&&(s.access_token=this.accessToken),this.secret&&(s.oauth_token_secret=this.secret),s.providerId=this.providerId,this.nonce&&!this.pendingToken&&(s.nonce=this.nonce),t.postBody=bR(s)}return t}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Y2e(r){switch(r){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function X2e(r){const t=tw(nw(r)).link,s=t?tw(nw(t)).deep_link_id:null,a=tw(nw(r)).deep_link_id;return(a?tw(nw(a)).link:null)||a||s||t||r}class BF{constructor(t){var s,a,l,d,p,E;const v=tw(nw(t)),b=(s=v.apiKey)!==null&&s!==void 0?s:null,R=(a=v.oobCode)!==null&&a!==void 0?a:null,O=Y2e((l=v.mode)!==null&&l!==void 0?l:null);Nn(b&&R&&O,"argument-error"),this.apiKey=b,this.operation=O,this.code=R,this.continueUrl=(d=v.continueUrl)!==null&&d!==void 0?d:null,this.languageCode=(p=v.languageCode)!==null&&p!==void 0?p:null,this.tenantId=(E=v.tenantId)!==null&&E!==void 0?E:null}static parseLink(t){const s=X2e(t);try{return new BF(s)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZS{constructor(){this.providerId=ZS.PROVIDER_ID}static credential(t,s){return Yw._fromEmailAndPassword(t,s)}static credentialWithLink(t,s){const a=BF.parseLink(s);return Nn(a,"argument-error"),Yw._fromEmailAndCode(t,a.code,a.tenantId)}}ZS.PROVIDER_ID="password";ZS.EMAIL_PASSWORD_SIGN_IN_METHOD="password";ZS.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lne{constructor(t){this.providerId=t,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(t){this.defaultLanguageCode=t}setCustomParameters(t){return this.customParameters=t,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CR extends lne{constructor(){super(...arguments),this.scopes=[]}addScope(t){return this.scopes.includes(t)||this.scopes.push(t),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rm extends CR{constructor(){super("facebook.com")}static credential(t){return tE._fromParams({providerId:Rm.PROVIDER_ID,signInMethod:Rm.FACEBOOK_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return Rm.credentialFromTaggedObject(t)}static credentialFromError(t){return Rm.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t)||!t.oauthAccessToken)return null;try{return Rm.credential(t.oauthAccessToken)}catch{return null}}}Rm.FACEBOOK_SIGN_IN_METHOD="facebook.com";Rm.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cm extends CR{constructor(){super("google.com"),this.addScope("profile")}static credential(t,s){return tE._fromParams({providerId:Cm.PROVIDER_ID,signInMethod:Cm.GOOGLE_SIGN_IN_METHOD,idToken:t,accessToken:s})}static credentialFromResult(t){return Cm.credentialFromTaggedObject(t)}static credentialFromError(t){return Cm.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthIdToken:s,oauthAccessToken:a}=t;if(!s&&!a)return null;try{return Cm.credential(s,a)}catch{return null}}}Cm.GOOGLE_SIGN_IN_METHOD="google.com";Cm.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Im extends CR{constructor(){super("github.com")}static credential(t){return tE._fromParams({providerId:Im.PROVIDER_ID,signInMethod:Im.GITHUB_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return Im.credentialFromTaggedObject(t)}static credentialFromError(t){return Im.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t)||!t.oauthAccessToken)return null;try{return Im.credential(t.oauthAccessToken)}catch{return null}}}Im.GITHUB_SIGN_IN_METHOD="github.com";Im.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Am extends CR{constructor(){super("twitter.com")}static credential(t,s){return tE._fromParams({providerId:Am.PROVIDER_ID,signInMethod:Am.TWITTER_SIGN_IN_METHOD,oauthToken:t,oauthTokenSecret:s})}static credentialFromResult(t){return Am.credentialFromTaggedObject(t)}static credentialFromError(t){return Am.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthAccessToken:s,oauthTokenSecret:a}=t;if(!s||!a)return null;try{return Am.credential(s,a)}catch{return null}}}Am.TWITTER_SIGN_IN_METHOD="twitter.com";Am.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function J2e(r,t){return RR(r,"POST","/v1/accounts:signUp",Qm(r,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nE{constructor(t){this.user=t.user,this.providerId=t.providerId,this._tokenResponse=t._tokenResponse,this.operationType=t.operationType}static async _fromIdTokenResponse(t,s,a,l=!1){const d=await $f._fromIdTokenResponse(t,a,l),p=tY(a);return new nE({user:d,providerId:p,_tokenResponse:a,operationType:s})}static async _forOperation(t,s,a){await t._updateTokensIfNecessary(a,!0);const l=tY(a);return new nE({user:t,providerId:l,_tokenResponse:a,operationType:s})}}function tY(r){return r.providerId?r.providerId:"phoneNumber"in r?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZP extends jh{constructor(t,s,a,l){var d;super(s.code,s.message),this.operationType=a,this.user=l,Object.setPrototypeOf(this,ZP.prototype),this.customData={appName:t.name,tenantId:(d=t.tenantId)!==null&&d!==void 0?d:void 0,_serverResponse:s.customData._serverResponse,operationType:a}}static _fromErrorAndOperation(t,s,a,l){return new ZP(t,s,a,l)}}function une(r,t,s,a){return(t==="reauthenticate"?s._getReauthenticationResolver(r):s._getIdTokenResponse(r)).catch(d=>{throw d.code==="auth/multi-factor-auth-required"?ZP._fromErrorAndOperation(r,d,t,a):d})}async function Q2e(r,t,s=!1){const a=await $w(r,t._linkToIdToken(r.auth,await r.getIdToken()),s);return nE._forOperation(r,"link",a)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Z2e(r,t,s=!1){const{auth:a}=r;if(ul(a.app))return Promise.reject(Zf(a));const l="reauthenticate";try{const d=await $w(r,une(a,l,t,r),s);Nn(d.idToken,a,"internal-error");const p=VF(d.idToken);Nn(p,a,"internal-error");const{sub:E}=p;return Nn(r.uid===E,a,"user-mismatch"),nE._forOperation(r,l,d)}catch(d){throw(d==null?void 0:d.code)==="auth/user-not-found"&&ld(a,"user-mismatch"),d}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function dne(r,t,s=!1){if(ul(r.app))return Promise.reject(Zf(r));const a="signIn",l=await une(r,a,t),d=await nE._fromIdTokenResponse(r,a,l);return s||await r._updateCurrentUser(d.user),d}async function eUe(r,t){return dne(uE(r),t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function hne(r){const t=uE(r);t._getPasswordPolicyInternal()&&await t._updatePasswordPolicy()}async function tUe(r,t,s){if(ul(r.app))return Promise.reject(Zf(r));const a=uE(r),p=await OU(a,{returnSecureToken:!0,email:t,password:s,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",J2e).catch(v=>{throw v.code==="auth/password-does-not-meet-requirements"&&hne(r),v}),E=await nE._fromIdTokenResponse(a,"signIn",p);return await a._updateCurrentUser(E.user),E}function nUe(r,t,s){return ul(r.app)?Promise.reject(Zf(r)):eUe(Qi(r),ZS.credential(t,s)).catch(async a=>{throw a.code==="auth/password-does-not-meet-requirements"&&hne(r),a})}function rUe(r,t,s,a){return Qi(r).onIdTokenChanged(t,s,a)}function iUe(r,t,s){return Qi(r).beforeAuthStateChanged(t,s)}function sUe(r,t,s,a){return Qi(r).onAuthStateChanged(t,s,a)}function oUe(r){return Qi(r).signOut()}const eN="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fne{constructor(t,s){this.storageRetriever=t,this.type=s}_isAvailable(){try{return this.storage?(this.storage.setItem(eN,"1"),this.storage.removeItem(eN),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(t,s){return this.storage.setItem(t,JSON.stringify(s)),Promise.resolve()}_get(t){const s=this.storage.getItem(t);return Promise.resolve(s?JSON.parse(s):null)}_remove(t){return this.storage.removeItem(t),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aUe=1e3,cUe=10;class pne extends fne{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(t,s)=>this.onStorageEvent(t,s),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=ine(),this._shouldAllowMigration=!0}forAllChangedKeys(t){for(const s of Object.keys(this.listeners)){const a=this.storage.getItem(s),l=this.localCache[s];a!==l&&t(s,l,a)}}onStorageEvent(t,s=!1){if(!t.key){this.forAllChangedKeys((p,E,v)=>{this.notifyListeners(p,v)});return}const a=t.key;s?this.detachListener():this.stopPolling();const l=()=>{const p=this.storage.getItem(a);!s&&this.localCache[a]===p||this.notifyListeners(a,p)},d=this.storage.getItem(a);R2e()&&d!==t.newValue&&t.newValue!==t.oldValue?setTimeout(l,cUe):l()}notifyListeners(t,s){this.localCache[t]=s;const a=this.listeners[t];if(a)for(const l of Array.from(a))l(s&&JSON.parse(s))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((t,s,a)=>{this.onStorageEvent(new StorageEvent("storage",{key:t,oldValue:s,newValue:a}),!0)})},aUe)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(t,s){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[t]||(this.listeners[t]=new Set,this.localCache[t]=this.storage.getItem(t)),this.listeners[t].add(s)}_removeListener(t,s){this.listeners[t]&&(this.listeners[t].delete(s),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(t,s){await super._set(t,s),this.localCache[t]=JSON.stringify(s)}async _get(t){const s=await super._get(t);return this.localCache[t]=JSON.stringify(s),s}async _remove(t){await super._remove(t),delete this.localCache[t]}}pne.type="LOCAL";const lUe=pne;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mne extends fne{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(t,s){}_removeListener(t,s){}}mne.type="SESSION";const gne=mne;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uUe(r){return Promise.all(r.map(async t=>{try{return{fulfilled:!0,value:await t}}catch(s){return{fulfilled:!1,reason:s}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QN{constructor(t){this.eventTarget=t,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){const s=this.receivers.find(l=>l.isListeningto(t));if(s)return s;const a=new QN(t);return this.receivers.push(a),a}isListeningto(t){return this.eventTarget===t}async handleEvent(t){const s=t,{eventId:a,eventType:l,data:d}=s.data,p=this.handlersMap[l];if(!(p!=null&&p.size))return;s.ports[0].postMessage({status:"ack",eventId:a,eventType:l});const E=Array.from(p).map(async b=>b(s.origin,d)),v=await uUe(E);s.ports[0].postMessage({status:"done",eventId:a,eventType:l,response:v})}_subscribe(t,s){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[t]||(this.handlersMap[t]=new Set),this.handlersMap[t].add(s)}_unsubscribe(t,s){this.handlersMap[t]&&s&&this.handlersMap[t].delete(s),(!s||this.handlersMap[t].size===0)&&delete this.handlersMap[t],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}QN.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function WF(r="",t=10){let s="";for(let a=0;a<t;a++)s+=Math.floor(Math.random()*10);return r+s}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dUe{constructor(t){this.target=t,this.handlers=new Set}removeMessageHandler(t){t.messageChannel&&(t.messageChannel.port1.removeEventListener("message",t.onMessage),t.messageChannel.port1.close()),this.handlers.delete(t)}async _send(t,s,a=50){const l=typeof MessageChannel<"u"?new MessageChannel:null;if(!l)throw new Error("connection_unavailable");let d,p;return new Promise((E,v)=>{const b=WF("",20);l.port1.start();const R=setTimeout(()=>{v(new Error("unsupported_event"))},a);p={messageChannel:l,onMessage(O){const N=O;if(N.data.eventId===b)switch(N.data.status){case"ack":clearTimeout(R),d=setTimeout(()=>{v(new Error("timeout"))},3e3);break;case"done":clearTimeout(d),E(N.data.response);break;default:clearTimeout(R),clearTimeout(d),v(new Error("invalid_response"));break}}},this.handlers.add(p),l.port1.addEventListener("message",p.onMessage),this.target.postMessage({eventType:t,eventId:b,data:s},[l.port2])}).finally(()=>{p&&this.removeMessageHandler(p)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rh(){return window}function hUe(r){Rh().location.href=r}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _ne(){return typeof Rh().WorkerGlobalScope<"u"&&typeof Rh().importScripts=="function"}async function fUe(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function pUe(){var r;return((r=navigator==null?void 0:navigator.serviceWorker)===null||r===void 0?void 0:r.controller)||null}function mUe(){return _ne()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ene="firebaseLocalStorageDb",gUe=1,tN="firebaseLocalStorage",yne="fbase_key";class IR{constructor(t){this.request=t}toPromise(){return new Promise((t,s)=>{this.request.addEventListener("success",()=>{t(this.request.result)}),this.request.addEventListener("error",()=>{s(this.request.error)})})}}function ZN(r,t){return r.transaction([tN],t?"readwrite":"readonly").objectStore(tN)}function _Ue(){const r=indexedDB.deleteDatabase(Ene);return new IR(r).toPromise()}function PU(){const r=indexedDB.open(Ene,gUe);return new Promise((t,s)=>{r.addEventListener("error",()=>{s(r.error)}),r.addEventListener("upgradeneeded",()=>{const a=r.result;try{a.createObjectStore(tN,{keyPath:yne})}catch(l){s(l)}}),r.addEventListener("success",async()=>{const a=r.result;a.objectStoreNames.contains(tN)?t(a):(a.close(),await _Ue(),t(await PU()))})})}async function nY(r,t,s){const a=ZN(r,!0).put({[yne]:t,value:s});return new IR(a).toPromise()}async function EUe(r,t){const s=ZN(r,!1).get(t),a=await new IR(s).toPromise();return a===void 0?null:a.value}function rY(r,t){const s=ZN(r,!0).delete(t);return new IR(s).toPromise()}const yUe=800,vUe=3;class vne{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await PU(),this.db)}async _withRetries(t){let s=0;for(;;)try{const a=await this._openDb();return await t(a)}catch(a){if(s++>vUe)throw a;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return _ne()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=QN._getInstance(mUe()),this.receiver._subscribe("keyChanged",async(t,s)=>({keyProcessed:(await this._poll()).includes(s.key)})),this.receiver._subscribe("ping",async(t,s)=>["keyChanged"])}async initializeSender(){var t,s;if(this.activeServiceWorker=await fUe(),!this.activeServiceWorker)return;this.sender=new dUe(this.activeServiceWorker);const a=await this.sender._send("ping",{},800);a&&!((t=a[0])===null||t===void 0)&&t.fulfilled&&!((s=a[0])===null||s===void 0)&&s.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(t){if(!(!this.sender||!this.activeServiceWorker||pUe()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:t},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const t=await PU();return await nY(t,eN,"1"),await rY(t,eN),!0}catch{}return!1}async _withPendingWrite(t){this.pendingWrites++;try{await t()}finally{this.pendingWrites--}}async _set(t,s){return this._withPendingWrite(async()=>(await this._withRetries(a=>nY(a,t,s)),this.localCache[t]=s,this.notifyServiceWorker(t)))}async _get(t){const s=await this._withRetries(a=>EUe(a,t));return this.localCache[t]=s,s}async _remove(t){return this._withPendingWrite(async()=>(await this._withRetries(s=>rY(s,t)),delete this.localCache[t],this.notifyServiceWorker(t)))}async _poll(){const t=await this._withRetries(l=>{const d=ZN(l,!1).getAll();return new IR(d).toPromise()});if(!t)return[];if(this.pendingWrites!==0)return[];const s=[],a=new Set;if(t.length!==0)for(const{fbase_key:l,value:d}of t)a.add(l),JSON.stringify(this.localCache[l])!==JSON.stringify(d)&&(this.notifyListeners(l,d),s.push(l));for(const l of Object.keys(this.localCache))this.localCache[l]&&!a.has(l)&&(this.notifyListeners(l,null),s.push(l));return s}notifyListeners(t,s){this.localCache[t]=s;const a=this.listeners[t];if(a)for(const l of Array.from(a))l(s)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),yUe)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(t,s){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[t]||(this.listeners[t]=new Set,this._get(t)),this.listeners[t].add(s)}_removeListener(t,s){this.listeners[t]&&(this.listeners[t].delete(s),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&this.stopPolling()}}vne.type="LOCAL";const SUe=vne;new wR(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function TUe(r,t){return t?Yf(t):(Nn(r._popupRedirectResolver,r,"argument-error"),r._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GF extends jF{constructor(t){super("custom","custom"),this.params=t}_getIdTokenResponse(t){return gS(t,this._buildIdpRequest())}_linkToIdToken(t,s){return gS(t,this._buildIdpRequest(s))}_getReauthenticationResolver(t){return gS(t,this._buildIdpRequest())}_buildIdpRequest(t){const s={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return t&&(s.idToken=t),s}}function bUe(r){return dne(r.auth,new GF(r),r.bypassAuthState)}function wUe(r){const{auth:t,user:s}=r;return Nn(s,t,"internal-error"),Z2e(s,new GF(r),r.bypassAuthState)}async function RUe(r){const{auth:t,user:s}=r;return Nn(s,t,"internal-error"),Q2e(s,new GF(r),r.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sne{constructor(t,s,a,l,d=!1){this.auth=t,this.resolver=a,this.user=l,this.bypassAuthState=d,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(s)?s:[s]}execute(){return new Promise(async(t,s)=>{this.pendingPromise={resolve:t,reject:s};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(a){this.reject(a)}})}async onAuthEvent(t){const{urlResponse:s,sessionId:a,postBody:l,tenantId:d,error:p,type:E}=t;if(p){this.reject(p);return}const v={auth:this.auth,requestUri:s,sessionId:a,tenantId:d||void 0,postBody:l||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(E)(v))}catch(b){this.reject(b)}}onError(t){this.reject(t)}getIdpTask(t){switch(t){case"signInViaPopup":case"signInViaRedirect":return bUe;case"linkViaPopup":case"linkViaRedirect":return RUe;case"reauthViaPopup":case"reauthViaRedirect":return wUe;default:ld(this.auth,"internal-error")}}resolve(t){sp(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(t),this.unregisterAndCleanUp()}reject(t){sp(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(t),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CUe=new wR(2e3,1e4);class tS extends Sne{constructor(t,s,a,l,d){super(t,s,l,d),this.provider=a,this.authWindow=null,this.pollId=null,tS.currentPopupAction&&tS.currentPopupAction.cancel(),tS.currentPopupAction=this}async executeNotNull(){const t=await this.execute();return Nn(t,this.auth,"internal-error"),t}async onExecution(){sp(this.filter.length===1,"Popup operations only handle one event");const t=WF();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],t),this.authWindow.associatedEvent=t,this.resolver._originValidation(this.auth).catch(s=>{this.reject(s)}),this.resolver._isIframeWebStorageSupported(this.auth,s=>{s||this.reject(wh(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var t;return((t=this.authWindow)===null||t===void 0?void 0:t.associatedEvent)||null}cancel(){this.reject(wh(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,tS.currentPopupAction=null}pollUserCancellation(){const t=()=>{var s,a;if(!((a=(s=this.authWindow)===null||s===void 0?void 0:s.window)===null||a===void 0)&&a.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(wh(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(t,CUe.get())};t()}}tS.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IUe="pendingRedirect",bP=new Map;class AUe extends Sne{constructor(t,s,a=!1){super(t,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],s,void 0,a),this.eventId=null}async execute(){let t=bP.get(this.auth._key());if(!t){try{const a=await OUe(this.resolver,this.auth)?await super.execute():null;t=()=>Promise.resolve(a)}catch(s){t=()=>Promise.reject(s)}bP.set(this.auth._key(),t)}return this.bypassAuthState||bP.set(this.auth._key(),()=>Promise.resolve(null)),t()}async onAuthEvent(t){if(t.type==="signInViaRedirect")return super.onAuthEvent(t);if(t.type==="unknown"){this.resolve(null);return}if(t.eventId){const s=await this.auth._redirectUserForId(t.eventId);if(s)return this.user=s,super.onAuthEvent(t);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function OUe(r,t){const s=kUe(t),a=NUe(r);if(!await a._isAvailable())return!1;const l=await a._get(s)==="true";return await a._remove(s),l}function PUe(r,t){bP.set(r._key(),t)}function NUe(r){return Yf(r._redirectPersistence)}function kUe(r){return TP(IUe,r.config.apiKey,r.name)}async function DUe(r,t,s=!1){if(ul(r.app))return Promise.reject(Zf(r));const a=uE(r),l=TUe(a,t),p=await new AUe(a,l,s).execute();return p&&!s&&(delete p.user._redirectEventId,await a._persistUserIfCurrent(p.user),await a._setRedirectUser(null,t)),p}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LUe=10*60*1e3;class xUe{constructor(t){this.auth=t,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(t){this.consumers.add(t),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,t)&&(this.sendToConsumer(this.queuedRedirectEvent,t),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(t){this.consumers.delete(t)}onEvent(t){if(this.hasEventBeenHandled(t))return!1;let s=!1;return this.consumers.forEach(a=>{this.isEventForConsumer(t,a)&&(s=!0,this.sendToConsumer(t,a),this.saveEventToCache(t))}),this.hasHandledPotentialRedirect||!MUe(t)||(this.hasHandledPotentialRedirect=!0,s||(this.queuedRedirectEvent=t,s=!0)),s}sendToConsumer(t,s){var a;if(t.error&&!Tne(t)){const l=((a=t.error.code)===null||a===void 0?void 0:a.split("auth/")[1])||"internal-error";s.onError(wh(this.auth,l))}else s.onAuthEvent(t)}isEventForConsumer(t,s){const a=s.eventId===null||!!t.eventId&&t.eventId===s.eventId;return s.filter.includes(t.type)&&a}hasEventBeenHandled(t){return Date.now()-this.lastProcessedEventTime>=LUe&&this.cachedEventUids.clear(),this.cachedEventUids.has(iY(t))}saveEventToCache(t){this.cachedEventUids.add(iY(t)),this.lastProcessedEventTime=Date.now()}}function iY(r){return[r.type,r.eventId,r.sessionId,r.tenantId].filter(t=>t).join("-")}function Tne({type:r,error:t}){return r==="unknown"&&(t==null?void 0:t.code)==="auth/no-auth-event"}function MUe(r){switch(r.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Tne(r);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function UUe(r,t={}){return Zm(r,"GET","/v1/projects",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VUe=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,FUe=/^https?/;async function jUe(r){if(r.config.emulator)return;const{authorizedDomains:t}=await UUe(r);for(const s of t)try{if(BUe(s))return}catch{}ld(r,"unauthorized-domain")}function BUe(r){const t=IU(),{protocol:s,hostname:a}=new URL(t);if(r.startsWith("chrome-extension://")){const p=new URL(r);return p.hostname===""&&a===""?s==="chrome-extension:"&&r.replace("chrome-extension://","")===t.replace("chrome-extension://",""):s==="chrome-extension:"&&p.hostname===a}if(!FUe.test(s))return!1;if(VUe.test(r))return a===r;const l=r.replace(/\./g,"\\.");return new RegExp("^(.+\\."+l+"|"+l+")$","i").test(a)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WUe=new wR(3e4,6e4);function sY(){const r=Rh().___jsl;if(r!=null&&r.H){for(const t of Object.keys(r.H))if(r.H[t].r=r.H[t].r||[],r.H[t].L=r.H[t].L||[],r.H[t].r=[...r.H[t].L],r.CP)for(let s=0;s<r.CP.length;s++)r.CP[s]=null}}function GUe(r){return new Promise((t,s)=>{var a,l,d;function p(){sY(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{sY(),s(wh(r,"network-request-failed"))},timeout:WUe.get()})}if(!((l=(a=Rh().gapi)===null||a===void 0?void 0:a.iframes)===null||l===void 0)&&l.Iframe)t(gapi.iframes.getContext());else if(!((d=Rh().gapi)===null||d===void 0)&&d.load)p();else{const E=L2e("iframefcb");return Rh()[E]=()=>{gapi.load?p():s(wh(r,"network-request-failed"))},one(`${D2e()}?onload=${E}`).catch(v=>s(v))}}).catch(t=>{throw wP=null,t})}let wP=null;function zUe(r){return wP=wP||GUe(r),wP}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HUe=new wR(5e3,15e3),KUe="__/auth/iframe",qUe="emulator/auth/iframe",$Ue={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},YUe=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function XUe(r){const t=r.config;Nn(t.authDomain,r,"auth-domain-config-required");const s=t.emulator?UF(t,qUe):`https://${r.config.authDomain}/${KUe}`,a={apiKey:t.apiKey,appName:r.name,v:lE},l=YUe.get(r.config.apiHost);l&&(a.eid=l);const d=r._getFrameworks();return d.length&&(a.fw=d.join(",")),`${s}?${bR(a).slice(1)}`}async function JUe(r){const t=await zUe(r),s=Rh().gapi;return Nn(s,r,"internal-error"),t.open({where:document.body,url:XUe(r),messageHandlersFilter:s.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:$Ue,dontclear:!0},a=>new Promise(async(l,d)=>{await a.restyle({setHideOnLeave:!1});const p=wh(r,"network-request-failed"),E=Rh().setTimeout(()=>{d(p)},HUe.get());function v(){Rh().clearTimeout(E),l(a)}a.ping(v).then(v,()=>{d(p)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QUe={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},ZUe=500,eVe=600,tVe="_blank",nVe="http://localhost";class oY{constructor(t){this.window=t,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function rVe(r,t,s,a=ZUe,l=eVe){const d=Math.max((window.screen.availHeight-l)/2,0).toString(),p=Math.max((window.screen.availWidth-a)/2,0).toString();let E="";const v=Object.assign(Object.assign({},QUe),{width:a.toString(),height:l.toString(),top:d,left:p}),b=wa().toLowerCase();s&&(E=Zte(b)?tVe:s),Jte(b)&&(t=t||nVe,v.scrollbars="yes");const R=Object.entries(v).reduce((N,[F,H])=>`${N}${F}=${H},`,"");if(w2e(b)&&E!=="_self")return iVe(t||"",E),new oY(null);const O=window.open(t||"",E,R);Nn(O,r,"popup-blocked");try{O.focus()}catch{}return new oY(O)}function iVe(r,t){const s=document.createElement("a");s.href=r,s.target=t;const a=document.createEvent("MouseEvent");a.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),s.dispatchEvent(a)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sVe="__/auth/handler",oVe="emulator/auth/handler",aVe=encodeURIComponent("fac");async function aY(r,t,s,a,l,d){Nn(r.config.authDomain,r,"auth-domain-config-required"),Nn(r.config.apiKey,r,"invalid-api-key");const p={apiKey:r.config.apiKey,appName:r.name,authType:s,redirectUrl:a,v:lE,eventId:l};if(t instanceof lne){t.setDefaultLanguage(r.languageCode),p.providerId=t.providerId||"",qxe(t.getCustomParameters())||(p.customParameters=JSON.stringify(t.getCustomParameters()));for(const[R,O]of Object.entries({}))p[R]=O}if(t instanceof CR){const R=t.getScopes().filter(O=>O!=="");R.length>0&&(p.scopes=R.join(","))}r.tenantId&&(p.tid=r.tenantId);const E=p;for(const R of Object.keys(E))E[R]===void 0&&delete E[R];const v=await r._getAppCheckToken(),b=v?`#${aVe}=${encodeURIComponent(v)}`:"";return`${cVe(r)}?${bR(E).slice(1)}${b}`}function cVe({config:r}){return r.emulator?UF(r,oVe):`https://${r.authDomain}/${sVe}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const c2="webStorageSupport";class lVe{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=gne,this._completeRedirectFn=DUe,this._overrideRedirectResult=PUe}async _openPopup(t,s,a,l){var d;sp((d=this.eventManagers[t._key()])===null||d===void 0?void 0:d.manager,"_initialize() not called before _openPopup()");const p=await aY(t,s,a,IU(),l);return rVe(t,p,WF())}async _openRedirect(t,s,a,l){await this._originValidation(t);const d=await aY(t,s,a,IU(),l);return hUe(d),new Promise(()=>{})}_initialize(t){const s=t._key();if(this.eventManagers[s]){const{manager:l,promise:d}=this.eventManagers[s];return l?Promise.resolve(l):(sp(d,"If manager is not set, promise should be"),d)}const a=this.initAndGetManager(t);return this.eventManagers[s]={promise:a},a.catch(()=>{delete this.eventManagers[s]}),a}async initAndGetManager(t){const s=await JUe(t),a=new xUe(t);return s.register("authEvent",l=>(Nn(l==null?void 0:l.authEvent,t,"invalid-auth-event"),{status:a.onEvent(l.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[t._key()]={manager:a},this.iframes[t._key()]=s,a}_isIframeWebStorageSupported(t,s){this.iframes[t._key()].send(c2,{type:c2},l=>{var d;const p=(d=l==null?void 0:l[0])===null||d===void 0?void 0:d[c2];p!==void 0&&s(!!p),ld(t,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(t){const s=t._key();return this.originValidationPromises[s]||(this.originValidationPromises[s]=jUe(t)),this.originValidationPromises[s]}get _shouldInitProactively(){return ine()||Qte()||FF()}}const uVe=lVe;var cY="@firebase/auth",lY="1.9.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dVe{constructor(t){this.auth=t,this.internalListeners=new Map}getUid(){var t;return this.assertAuthConfigured(),((t=this.auth.currentUser)===null||t===void 0?void 0:t.uid)||null}async getToken(t){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(t)}:null}addAuthTokenListener(t){if(this.assertAuthConfigured(),this.internalListeners.has(t))return;const s=this.auth.onIdTokenChanged(a=>{t((a==null?void 0:a.stsTokenManager.accessToken)||null)});this.internalListeners.set(t,s),this.updateProactiveRefresh()}removeAuthTokenListener(t){this.assertAuthConfigured();const s=this.internalListeners.get(t);s&&(this.internalListeners.delete(t),s(),this.updateProactiveRefresh())}assertAuthConfigured(){Nn(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hVe(r){switch(r){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function fVe(r){eE(new jm("auth",(t,{options:s})=>{const a=t.getProvider("app").getImmediate(),l=t.getProvider("heartbeat"),d=t.getProvider("app-check-internal"),{apiKey:p,authDomain:E}=a.options;Nn(p&&!p.includes(":"),"invalid-api-key",{appName:a.name});const v={apiKey:p,authDomain:E,clientPlatform:r,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:sne(r)},b=new P2e(a,l,d,v);return j2e(b,s),b},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((t,s,a)=>{t.getProvider("auth-internal").initialize()})),eE(new jm("auth-internal",t=>{const s=uE(t.getProvider("auth").getImmediate());return(a=>new dVe(a))(s)},"PRIVATE").setInstantiationMode("EXPLICIT")),bh(cY,lY,hVe(r)),bh(cY,lY,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pVe=5*60,mVe=xte("authIdTokenMaxAge")||pVe;let uY=null;const gVe=r=>async t=>{const s=t&&await t.getIdTokenResult(),a=s&&(new Date().getTime()-Date.parse(s.issuedAtTime))/1e3;if(a&&a>mVe)return;const l=s==null?void 0:s.token;uY!==l&&(uY=l,await fetch(r,{method:l?"POST":"DELETE",headers:l?{Authorization:`Bearer ${l}`}:{}}))};function bne(r=xF()){const t=XN(r,"auth");if(t.isInitialized())return t.getImmediate();const s=F2e(r,{popupRedirectResolver:uVe,persistence:[SUe,lUe,gne]}),a=xte("authTokenSyncURL");if(a&&typeof isSecureContext=="boolean"&&isSecureContext){const d=new URL(a,location.origin);if(location.origin===d.origin){const p=gVe(d.toString());iUe(s,p,()=>p(s.currentUser)),rUe(s,E=>p(E))}}const l=kte("auth");return l&&B2e(s,`http://${l}`),s}function _Ve(){var r,t;return(t=(r=document.getElementsByTagName("head"))===null||r===void 0?void 0:r[0])!==null&&t!==void 0?t:document}N2e({loadJS(r){return new Promise((t,s)=>{const a=document.createElement("script");a.setAttribute("src",r),a.onload=t,a.onerror=l=>{const d=wh("internal-error");d.customData=l,s(d)},a.type="text/javascript",a.charset="UTF-8",_Ve().appendChild(a)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});fVe("Browser");var dY=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Lm,wne;(function(){var r;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function t(Q,ne){function oe(){}oe.prototype=ne.prototype,Q.D=ne.prototype,Q.prototype=new oe,Q.prototype.constructor=Q,Q.C=function(ue,Ee,fe){for(var le=Array(arguments.length-2),Le=2;Le<arguments.length;Le++)le[Le-2]=arguments[Le];return ne.prototype[Ee].apply(ue,le)}}function s(){this.blockSize=-1}function a(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}t(a,s),a.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function l(Q,ne,oe){oe||(oe=0);var ue=Array(16);if(typeof ne=="string")for(var Ee=0;16>Ee;++Ee)ue[Ee]=ne.charCodeAt(oe++)|ne.charCodeAt(oe++)<<8|ne.charCodeAt(oe++)<<16|ne.charCodeAt(oe++)<<24;else for(Ee=0;16>Ee;++Ee)ue[Ee]=ne[oe++]|ne[oe++]<<8|ne[oe++]<<16|ne[oe++]<<24;ne=Q.g[0],oe=Q.g[1],Ee=Q.g[2];var fe=Q.g[3],le=ne+(fe^oe&(Ee^fe))+ue[0]+3614090360&4294967295;ne=oe+(le<<7&4294967295|le>>>25),le=fe+(Ee^ne&(oe^Ee))+ue[1]+3905402710&4294967295,fe=ne+(le<<12&4294967295|le>>>20),le=Ee+(oe^fe&(ne^oe))+ue[2]+606105819&4294967295,Ee=fe+(le<<17&4294967295|le>>>15),le=oe+(ne^Ee&(fe^ne))+ue[3]+3250441966&4294967295,oe=Ee+(le<<22&4294967295|le>>>10),le=ne+(fe^oe&(Ee^fe))+ue[4]+4118548399&4294967295,ne=oe+(le<<7&4294967295|le>>>25),le=fe+(Ee^ne&(oe^Ee))+ue[5]+1200080426&4294967295,fe=ne+(le<<12&4294967295|le>>>20),le=Ee+(oe^fe&(ne^oe))+ue[6]+2821735955&4294967295,Ee=fe+(le<<17&4294967295|le>>>15),le=oe+(ne^Ee&(fe^ne))+ue[7]+4249261313&4294967295,oe=Ee+(le<<22&4294967295|le>>>10),le=ne+(fe^oe&(Ee^fe))+ue[8]+1770035416&4294967295,ne=oe+(le<<7&4294967295|le>>>25),le=fe+(Ee^ne&(oe^Ee))+ue[9]+2336552879&4294967295,fe=ne+(le<<12&4294967295|le>>>20),le=Ee+(oe^fe&(ne^oe))+ue[10]+4294925233&4294967295,Ee=fe+(le<<17&4294967295|le>>>15),le=oe+(ne^Ee&(fe^ne))+ue[11]+2304563134&4294967295,oe=Ee+(le<<22&4294967295|le>>>10),le=ne+(fe^oe&(Ee^fe))+ue[12]+1804603682&4294967295,ne=oe+(le<<7&4294967295|le>>>25),le=fe+(Ee^ne&(oe^Ee))+ue[13]+4254626195&4294967295,fe=ne+(le<<12&4294967295|le>>>20),le=Ee+(oe^fe&(ne^oe))+ue[14]+2792965006&4294967295,Ee=fe+(le<<17&4294967295|le>>>15),le=oe+(ne^Ee&(fe^ne))+ue[15]+1236535329&4294967295,oe=Ee+(le<<22&4294967295|le>>>10),le=ne+(Ee^fe&(oe^Ee))+ue[1]+4129170786&4294967295,ne=oe+(le<<5&4294967295|le>>>27),le=fe+(oe^Ee&(ne^oe))+ue[6]+3225465664&4294967295,fe=ne+(le<<9&4294967295|le>>>23),le=Ee+(ne^oe&(fe^ne))+ue[11]+643717713&4294967295,Ee=fe+(le<<14&4294967295|le>>>18),le=oe+(fe^ne&(Ee^fe))+ue[0]+3921069994&4294967295,oe=Ee+(le<<20&4294967295|le>>>12),le=ne+(Ee^fe&(oe^Ee))+ue[5]+3593408605&4294967295,ne=oe+(le<<5&4294967295|le>>>27),le=fe+(oe^Ee&(ne^oe))+ue[10]+38016083&4294967295,fe=ne+(le<<9&4294967295|le>>>23),le=Ee+(ne^oe&(fe^ne))+ue[15]+3634488961&4294967295,Ee=fe+(le<<14&4294967295|le>>>18),le=oe+(fe^ne&(Ee^fe))+ue[4]+3889429448&4294967295,oe=Ee+(le<<20&4294967295|le>>>12),le=ne+(Ee^fe&(oe^Ee))+ue[9]+568446438&4294967295,ne=oe+(le<<5&4294967295|le>>>27),le=fe+(oe^Ee&(ne^oe))+ue[14]+3275163606&4294967295,fe=ne+(le<<9&4294967295|le>>>23),le=Ee+(ne^oe&(fe^ne))+ue[3]+4107603335&4294967295,Ee=fe+(le<<14&4294967295|le>>>18),le=oe+(fe^ne&(Ee^fe))+ue[8]+1163531501&4294967295,oe=Ee+(le<<20&4294967295|le>>>12),le=ne+(Ee^fe&(oe^Ee))+ue[13]+2850285829&4294967295,ne=oe+(le<<5&4294967295|le>>>27),le=fe+(oe^Ee&(ne^oe))+ue[2]+4243563512&4294967295,fe=ne+(le<<9&4294967295|le>>>23),le=Ee+(ne^oe&(fe^ne))+ue[7]+1735328473&4294967295,Ee=fe+(le<<14&4294967295|le>>>18),le=oe+(fe^ne&(Ee^fe))+ue[12]+2368359562&4294967295,oe=Ee+(le<<20&4294967295|le>>>12),le=ne+(oe^Ee^fe)+ue[5]+4294588738&4294967295,ne=oe+(le<<4&4294967295|le>>>28),le=fe+(ne^oe^Ee)+ue[8]+2272392833&4294967295,fe=ne+(le<<11&4294967295|le>>>21),le=Ee+(fe^ne^oe)+ue[11]+1839030562&4294967295,Ee=fe+(le<<16&4294967295|le>>>16),le=oe+(Ee^fe^ne)+ue[14]+4259657740&4294967295,oe=Ee+(le<<23&4294967295|le>>>9),le=ne+(oe^Ee^fe)+ue[1]+2763975236&4294967295,ne=oe+(le<<4&4294967295|le>>>28),le=fe+(ne^oe^Ee)+ue[4]+1272893353&4294967295,fe=ne+(le<<11&4294967295|le>>>21),le=Ee+(fe^ne^oe)+ue[7]+4139469664&4294967295,Ee=fe+(le<<16&4294967295|le>>>16),le=oe+(Ee^fe^ne)+ue[10]+3200236656&4294967295,oe=Ee+(le<<23&4294967295|le>>>9),le=ne+(oe^Ee^fe)+ue[13]+681279174&4294967295,ne=oe+(le<<4&4294967295|le>>>28),le=fe+(ne^oe^Ee)+ue[0]+3936430074&4294967295,fe=ne+(le<<11&4294967295|le>>>21),le=Ee+(fe^ne^oe)+ue[3]+3572445317&4294967295,Ee=fe+(le<<16&4294967295|le>>>16),le=oe+(Ee^fe^ne)+ue[6]+76029189&4294967295,oe=Ee+(le<<23&4294967295|le>>>9),le=ne+(oe^Ee^fe)+ue[9]+3654602809&4294967295,ne=oe+(le<<4&4294967295|le>>>28),le=fe+(ne^oe^Ee)+ue[12]+3873151461&4294967295,fe=ne+(le<<11&4294967295|le>>>21),le=Ee+(fe^ne^oe)+ue[15]+530742520&4294967295,Ee=fe+(le<<16&4294967295|le>>>16),le=oe+(Ee^fe^ne)+ue[2]+3299628645&4294967295,oe=Ee+(le<<23&4294967295|le>>>9),le=ne+(Ee^(oe|~fe))+ue[0]+4096336452&4294967295,ne=oe+(le<<6&4294967295|le>>>26),le=fe+(oe^(ne|~Ee))+ue[7]+1126891415&4294967295,fe=ne+(le<<10&4294967295|le>>>22),le=Ee+(ne^(fe|~oe))+ue[14]+2878612391&4294967295,Ee=fe+(le<<15&4294967295|le>>>17),le=oe+(fe^(Ee|~ne))+ue[5]+4237533241&4294967295,oe=Ee+(le<<21&4294967295|le>>>11),le=ne+(Ee^(oe|~fe))+ue[12]+1700485571&4294967295,ne=oe+(le<<6&4294967295|le>>>26),le=fe+(oe^(ne|~Ee))+ue[3]+2399980690&4294967295,fe=ne+(le<<10&4294967295|le>>>22),le=Ee+(ne^(fe|~oe))+ue[10]+4293915773&4294967295,Ee=fe+(le<<15&4294967295|le>>>17),le=oe+(fe^(Ee|~ne))+ue[1]+2240044497&4294967295,oe=Ee+(le<<21&4294967295|le>>>11),le=ne+(Ee^(oe|~fe))+ue[8]+1873313359&4294967295,ne=oe+(le<<6&4294967295|le>>>26),le=fe+(oe^(ne|~Ee))+ue[15]+4264355552&4294967295,fe=ne+(le<<10&4294967295|le>>>22),le=Ee+(ne^(fe|~oe))+ue[6]+2734768916&4294967295,Ee=fe+(le<<15&4294967295|le>>>17),le=oe+(fe^(Ee|~ne))+ue[13]+1309151649&4294967295,oe=Ee+(le<<21&4294967295|le>>>11),le=ne+(Ee^(oe|~fe))+ue[4]+4149444226&4294967295,ne=oe+(le<<6&4294967295|le>>>26),le=fe+(oe^(ne|~Ee))+ue[11]+3174756917&4294967295,fe=ne+(le<<10&4294967295|le>>>22),le=Ee+(ne^(fe|~oe))+ue[2]+718787259&4294967295,Ee=fe+(le<<15&4294967295|le>>>17),le=oe+(fe^(Ee|~ne))+ue[9]+3951481745&4294967295,Q.g[0]=Q.g[0]+ne&4294967295,Q.g[1]=Q.g[1]+(Ee+(le<<21&4294967295|le>>>11))&4294967295,Q.g[2]=Q.g[2]+Ee&4294967295,Q.g[3]=Q.g[3]+fe&4294967295}a.prototype.u=function(Q,ne){ne===void 0&&(ne=Q.length);for(var oe=ne-this.blockSize,ue=this.B,Ee=this.h,fe=0;fe<ne;){if(Ee==0)for(;fe<=oe;)l(this,Q,fe),fe+=this.blockSize;if(typeof Q=="string"){for(;fe<ne;)if(ue[Ee++]=Q.charCodeAt(fe++),Ee==this.blockSize){l(this,ue),Ee=0;break}}else for(;fe<ne;)if(ue[Ee++]=Q[fe++],Ee==this.blockSize){l(this,ue),Ee=0;break}}this.h=Ee,this.o+=ne},a.prototype.v=function(){var Q=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);Q[0]=128;for(var ne=1;ne<Q.length-8;++ne)Q[ne]=0;var oe=8*this.o;for(ne=Q.length-8;ne<Q.length;++ne)Q[ne]=oe&255,oe/=256;for(this.u(Q),Q=Array(16),ne=oe=0;4>ne;++ne)for(var ue=0;32>ue;ue+=8)Q[oe++]=this.g[ne]>>>ue&255;return Q};function d(Q,ne){var oe=E;return Object.prototype.hasOwnProperty.call(oe,Q)?oe[Q]:oe[Q]=ne(Q)}function p(Q,ne){this.h=ne;for(var oe=[],ue=!0,Ee=Q.length-1;0<=Ee;Ee--){var fe=Q[Ee]|0;ue&&fe==ne||(oe[Ee]=fe,ue=!1)}this.g=oe}var E={};function v(Q){return-128<=Q&&128>Q?d(Q,function(ne){return new p([ne|0],0>ne?-1:0)}):new p([Q|0],0>Q?-1:0)}function b(Q){if(isNaN(Q)||!isFinite(Q))return O;if(0>Q)return G(b(-Q));for(var ne=[],oe=1,ue=0;Q>=oe;ue++)ne[ue]=Q/oe|0,oe*=4294967296;return new p(ne,0)}function R(Q,ne){if(Q.length==0)throw Error("number format error: empty string");if(ne=ne||10,2>ne||36<ne)throw Error("radix out of range: "+ne);if(Q.charAt(0)=="-")return G(R(Q.substring(1),ne));if(0<=Q.indexOf("-"))throw Error('number format error: interior "-" character');for(var oe=b(Math.pow(ne,8)),ue=O,Ee=0;Ee<Q.length;Ee+=8){var fe=Math.min(8,Q.length-Ee),le=parseInt(Q.substring(Ee,Ee+fe),ne);8>fe?(fe=b(Math.pow(ne,fe)),ue=ue.j(fe).add(b(le))):(ue=ue.j(oe),ue=ue.add(b(le)))}return ue}var O=v(0),N=v(1),F=v(16777216);r=p.prototype,r.m=function(){if(z(this))return-G(this).m();for(var Q=0,ne=1,oe=0;oe<this.g.length;oe++){var ue=this.i(oe);Q+=(0<=ue?ue:4294967296+ue)*ne,ne*=4294967296}return Q},r.toString=function(Q){if(Q=Q||10,2>Q||36<Q)throw Error("radix out of range: "+Q);if(H(this))return"0";if(z(this))return"-"+G(this).toString(Q);for(var ne=b(Math.pow(Q,6)),oe=this,ue="";;){var Ee=de(oe,ne).g;oe=ee(oe,Ee.j(ne));var fe=((0<oe.g.length?oe.g[0]:oe.h)>>>0).toString(Q);if(oe=Ee,H(oe))return fe+ue;for(;6>fe.length;)fe="0"+fe;ue=fe+ue}},r.i=function(Q){return 0>Q?0:Q<this.g.length?this.g[Q]:this.h};function H(Q){if(Q.h!=0)return!1;for(var ne=0;ne<Q.g.length;ne++)if(Q.g[ne]!=0)return!1;return!0}function z(Q){return Q.h==-1}r.l=function(Q){return Q=ee(this,Q),z(Q)?-1:H(Q)?0:1};function G(Q){for(var ne=Q.g.length,oe=[],ue=0;ue<ne;ue++)oe[ue]=~Q.g[ue];return new p(oe,~Q.h).add(N)}r.abs=function(){return z(this)?G(this):this},r.add=function(Q){for(var ne=Math.max(this.g.length,Q.g.length),oe=[],ue=0,Ee=0;Ee<=ne;Ee++){var fe=ue+(this.i(Ee)&65535)+(Q.i(Ee)&65535),le=(fe>>>16)+(this.i(Ee)>>>16)+(Q.i(Ee)>>>16);ue=le>>>16,fe&=65535,le&=65535,oe[Ee]=le<<16|fe}return new p(oe,oe[oe.length-1]&-2147483648?-1:0)};function ee(Q,ne){return Q.add(G(ne))}r.j=function(Q){if(H(this)||H(Q))return O;if(z(this))return z(Q)?G(this).j(G(Q)):G(G(this).j(Q));if(z(Q))return G(this.j(G(Q)));if(0>this.l(F)&&0>Q.l(F))return b(this.m()*Q.m());for(var ne=this.g.length+Q.g.length,oe=[],ue=0;ue<2*ne;ue++)oe[ue]=0;for(ue=0;ue<this.g.length;ue++)for(var Ee=0;Ee<Q.g.length;Ee++){var fe=this.i(ue)>>>16,le=this.i(ue)&65535,Le=Q.i(Ee)>>>16,pt=Q.i(Ee)&65535;oe[2*ue+2*Ee]+=le*pt,J(oe,2*ue+2*Ee),oe[2*ue+2*Ee+1]+=fe*pt,J(oe,2*ue+2*Ee+1),oe[2*ue+2*Ee+1]+=le*Le,J(oe,2*ue+2*Ee+1),oe[2*ue+2*Ee+2]+=fe*Le,J(oe,2*ue+2*Ee+2)}for(ue=0;ue<ne;ue++)oe[ue]=oe[2*ue+1]<<16|oe[2*ue];for(ue=ne;ue<2*ne;ue++)oe[ue]=0;return new p(oe,0)};function J(Q,ne){for(;(Q[ne]&65535)!=Q[ne];)Q[ne+1]+=Q[ne]>>>16,Q[ne]&=65535,ne++}function re(Q,ne){this.g=Q,this.h=ne}function de(Q,ne){if(H(ne))throw Error("division by zero");if(H(Q))return new re(O,O);if(z(Q))return ne=de(G(Q),ne),new re(G(ne.g),G(ne.h));if(z(ne))return ne=de(Q,G(ne)),new re(G(ne.g),ne.h);if(30<Q.g.length){if(z(Q)||z(ne))throw Error("slowDivide_ only works with positive integers.");for(var oe=N,ue=ne;0>=ue.l(Q);)oe=se(oe),ue=se(ue);var Ee=ye(oe,1),fe=ye(ue,1);for(ue=ye(ue,2),oe=ye(oe,2);!H(ue);){var le=fe.add(ue);0>=le.l(Q)&&(Ee=Ee.add(oe),fe=le),ue=ye(ue,1),oe=ye(oe,1)}return ne=ee(Q,Ee.j(ne)),new re(Ee,ne)}for(Ee=O;0<=Q.l(ne);){for(oe=Math.max(1,Math.floor(Q.m()/ne.m())),ue=Math.ceil(Math.log(oe)/Math.LN2),ue=48>=ue?1:Math.pow(2,ue-48),fe=b(oe),le=fe.j(ne);z(le)||0<le.l(Q);)oe-=ue,fe=b(oe),le=fe.j(ne);H(fe)&&(fe=N),Ee=Ee.add(fe),Q=ee(Q,le)}return new re(Ee,Q)}r.A=function(Q){return de(this,Q).h},r.and=function(Q){for(var ne=Math.max(this.g.length,Q.g.length),oe=[],ue=0;ue<ne;ue++)oe[ue]=this.i(ue)&Q.i(ue);return new p(oe,this.h&Q.h)},r.or=function(Q){for(var ne=Math.max(this.g.length,Q.g.length),oe=[],ue=0;ue<ne;ue++)oe[ue]=this.i(ue)|Q.i(ue);return new p(oe,this.h|Q.h)},r.xor=function(Q){for(var ne=Math.max(this.g.length,Q.g.length),oe=[],ue=0;ue<ne;ue++)oe[ue]=this.i(ue)^Q.i(ue);return new p(oe,this.h^Q.h)};function se(Q){for(var ne=Q.g.length+1,oe=[],ue=0;ue<ne;ue++)oe[ue]=Q.i(ue)<<1|Q.i(ue-1)>>>31;return new p(oe,Q.h)}function ye(Q,ne){var oe=ne>>5;ne%=32;for(var ue=Q.g.length-oe,Ee=[],fe=0;fe<ue;fe++)Ee[fe]=0<ne?Q.i(fe+oe)>>>ne|Q.i(fe+oe+1)<<32-ne:Q.i(fe+oe);return new p(Ee,Q.h)}a.prototype.digest=a.prototype.v,a.prototype.reset=a.prototype.s,a.prototype.update=a.prototype.u,wne=a,p.prototype.add=p.prototype.add,p.prototype.multiply=p.prototype.j,p.prototype.modulo=p.prototype.A,p.prototype.compare=p.prototype.l,p.prototype.toNumber=p.prototype.m,p.prototype.toString=p.prototype.toString,p.prototype.getBits=p.prototype.i,p.fromNumber=b,p.fromString=R,Lm=p}).apply(typeof dY<"u"?dY:typeof self<"u"?self:typeof window<"u"?window:{});var WO=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Rne,rw,Cne,RP,NU,Ine,Ane,One;(function(){var r,t=typeof Object.defineProperties=="function"?Object.defineProperty:function(C,j,X){return C==Array.prototype||C==Object.prototype||(C[j]=X.value),C};function s(C){C=[typeof globalThis=="object"&&globalThis,C,typeof window=="object"&&window,typeof self=="object"&&self,typeof WO=="object"&&WO];for(var j=0;j<C.length;++j){var X=C[j];if(X&&X.Math==Math)return X}throw Error("Cannot find global object")}var a=s(this);function l(C,j){if(j)e:{var X=a;C=C.split(".");for(var he=0;he<C.length-1;he++){var je=C[he];if(!(je in X))break e;X=X[je]}C=C[C.length-1],he=X[C],j=j(he),j!=he&&j!=null&&t(X,C,{configurable:!0,writable:!0,value:j})}}function d(C,j){C instanceof String&&(C+="");var X=0,he=!1,je={next:function(){if(!he&&X<C.length){var Je=X++;return{value:j(Je,C[Je]),done:!1}}return he=!0,{done:!0,value:void 0}}};return je[Symbol.iterator]=function(){return je},je}l("Array.prototype.values",function(C){return C||function(){return d(this,function(j,X){return X})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var p=p||{},E=this||self;function v(C){var j=typeof C;return j=j!="object"?j:C?Array.isArray(C)?"array":j:"null",j=="array"||j=="object"&&typeof C.length=="number"}function b(C){var j=typeof C;return j=="object"&&C!=null||j=="function"}function R(C,j,X){return C.call.apply(C.bind,arguments)}function O(C,j,X){if(!C)throw Error();if(2<arguments.length){var he=Array.prototype.slice.call(arguments,2);return function(){var je=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(je,he),C.apply(j,je)}}return function(){return C.apply(j,arguments)}}function N(C,j,X){return N=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?R:O,N.apply(null,arguments)}function F(C,j){var X=Array.prototype.slice.call(arguments,1);return function(){var he=X.slice();return he.push.apply(he,arguments),C.apply(this,he)}}function H(C,j){function X(){}X.prototype=j.prototype,C.aa=j.prototype,C.prototype=new X,C.prototype.constructor=C,C.Qb=function(he,je,Je){for(var It=Array(arguments.length-2),Br=2;Br<arguments.length;Br++)It[Br-2]=arguments[Br];return j.prototype[je].apply(he,It)}}function z(C){const j=C.length;if(0<j){const X=Array(j);for(let he=0;he<j;he++)X[he]=C[he];return X}return[]}function G(C,j){for(let X=1;X<arguments.length;X++){const he=arguments[X];if(v(he)){const je=C.length||0,Je=he.length||0;C.length=je+Je;for(let It=0;It<Je;It++)C[je+It]=he[It]}else C.push(he)}}class ee{constructor(j,X){this.i=j,this.j=X,this.h=0,this.g=null}get(){let j;return 0<this.h?(this.h--,j=this.g,this.g=j.next,j.next=null):j=this.i(),j}}function J(C){return/^[\s\xa0]*$/.test(C)}function re(){var C=E.navigator;return C&&(C=C.userAgent)?C:""}function de(C){return de[" "](C),C}de[" "]=function(){};var se=re().indexOf("Gecko")!=-1&&!(re().toLowerCase().indexOf("webkit")!=-1&&re().indexOf("Edge")==-1)&&!(re().indexOf("Trident")!=-1||re().indexOf("MSIE")!=-1)&&re().indexOf("Edge")==-1;function ye(C,j,X){for(const he in C)j.call(X,C[he],he,C)}function Q(C,j){for(const X in C)j.call(void 0,C[X],X,C)}function ne(C){const j={};for(const X in C)j[X]=C[X];return j}const oe="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ue(C,j){let X,he;for(let je=1;je<arguments.length;je++){he=arguments[je];for(X in he)C[X]=he[X];for(let Je=0;Je<oe.length;Je++)X=oe[Je],Object.prototype.hasOwnProperty.call(he,X)&&(C[X]=he[X])}}function Ee(C){var j=1;C=C.split(":");const X=[];for(;0<j&&C.length;)X.push(C.shift()),j--;return C.length&&X.push(C.join(":")),X}function fe(C){E.setTimeout(()=>{throw C},0)}function le(){var C=Me;let j=null;return C.g&&(j=C.g,C.g=C.g.next,C.g||(C.h=null),j.next=null),j}class Le{constructor(){this.h=this.g=null}add(j,X){const he=pt.get();he.set(j,X),this.h?this.h.next=he:this.g=he,this.h=he}}var pt=new ee(()=>new et,C=>C.reset());class et{constructor(){this.next=this.g=this.h=null}set(j,X){this.h=j,this.g=X,this.next=null}reset(){this.next=this.g=this.h=null}}let Oe,Ue=!1,Me=new Le,it=()=>{const C=E.Promise.resolve(void 0);Oe=()=>{C.then(Ae)}};var Ae=()=>{for(var C;C=le();){try{C.h.call(C.g)}catch(X){fe(X)}var j=pt;j.j(C),100>j.h&&(j.h++,C.next=j.g,j.g=C)}Ue=!1};function qe(){this.s=this.s,this.C=this.C}qe.prototype.s=!1,qe.prototype.ma=function(){this.s||(this.s=!0,this.N())},qe.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Ze(C,j){this.type=C,this.g=this.target=j,this.defaultPrevented=!1}Ze.prototype.h=function(){this.defaultPrevented=!0};var Fe=function(){if(!E.addEventListener||!Object.defineProperty)return!1;var C=!1,j=Object.defineProperty({},"passive",{get:function(){C=!0}});try{const X=()=>{};E.addEventListener("test",X,j),E.removeEventListener("test",X,j)}catch{}return C}();function lt(C,j){if(Ze.call(this,C?C.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,C){var X=this.type=C.type,he=C.changedTouches&&C.changedTouches.length?C.changedTouches[0]:null;if(this.target=C.target||C.srcElement,this.g=j,j=C.relatedTarget){if(se){e:{try{de(j.nodeName);var je=!0;break e}catch{}je=!1}je||(j=null)}}else X=="mouseover"?j=C.fromElement:X=="mouseout"&&(j=C.toElement);this.relatedTarget=j,he?(this.clientX=he.clientX!==void 0?he.clientX:he.pageX,this.clientY=he.clientY!==void 0?he.clientY:he.pageY,this.screenX=he.screenX||0,this.screenY=he.screenY||0):(this.clientX=C.clientX!==void 0?C.clientX:C.pageX,this.clientY=C.clientY!==void 0?C.clientY:C.pageY,this.screenX=C.screenX||0,this.screenY=C.screenY||0),this.button=C.button,this.key=C.key||"",this.ctrlKey=C.ctrlKey,this.altKey=C.altKey,this.shiftKey=C.shiftKey,this.metaKey=C.metaKey,this.pointerId=C.pointerId||0,this.pointerType=typeof C.pointerType=="string"?C.pointerType:Et[C.pointerType]||"",this.state=C.state,this.i=C,C.defaultPrevented&&lt.aa.h.call(this)}}H(lt,Ze);var Et={2:"touch",3:"pen",4:"mouse"};lt.prototype.h=function(){lt.aa.h.call(this);var C=this.i;C.preventDefault?C.preventDefault():C.returnValue=!1};var Nt="closure_listenable_"+(1e6*Math.random()|0),$t=0;function xt(C,j,X,he,je){this.listener=C,this.proxy=null,this.src=j,this.type=X,this.capture=!!he,this.ha=je,this.key=++$t,this.da=this.fa=!1}function En(C){C.da=!0,C.listener=null,C.proxy=null,C.src=null,C.ha=null}function In(C){this.src=C,this.g={},this.h=0}In.prototype.add=function(C,j,X,he,je){var Je=C.toString();C=this.g[Je],C||(C=this.g[Je]=[],this.h++);var It=Kn(C,j,he,je);return-1<It?(j=C[It],X||(j.fa=!1)):(j=new xt(j,this.src,Je,!!he,je),j.fa=X,C.push(j)),j};function hn(C,j){var X=j.type;if(X in C.g){var he=C.g[X],je=Array.prototype.indexOf.call(he,j,void 0),Je;(Je=0<=je)&&Array.prototype.splice.call(he,je,1),Je&&(En(j),C.g[X].length==0&&(delete C.g[X],C.h--))}}function Kn(C,j,X,he){for(var je=0;je<C.length;++je){var Je=C[je];if(!Je.da&&Je.listener==j&&Je.capture==!!X&&Je.ha==he)return je}return-1}var Ar="closure_lm_"+(1e6*Math.random()|0),Zt={};function Zn(C,j,X,he,je){if(Array.isArray(j)){for(var Je=0;Je<j.length;Je++)Zn(C,j[Je],X,he,je);return null}return X=_n(X),C&&C[Nt]?C.K(j,X,b(he)?!!he.capture:!1,je):zt(C,j,X,!1,he,je)}function zt(C,j,X,he,je,Je){if(!j)throw Error("Invalid event type");var It=b(je)?!!je.capture:!!je,Br=gt(C);if(Br||(C[Ar]=Br=new In(C)),X=Br.add(j,X,he,It,Je),X.proxy)return X;if(he=ve(),X.proxy=he,he.src=C,he.listener=X,C.addEventListener)Fe||(je=It),je===void 0&&(je=!1),C.addEventListener(j.toString(),he,je);else if(C.attachEvent)C.attachEvent(dt(j.toString()),he);else if(C.addListener&&C.removeListener)C.addListener(he);else throw Error("addEventListener and attachEvent are unavailable.");return X}function ve(){function C(X){return j.call(C.src,C.listener,X)}const j=mt;return C}function Ne(C,j,X,he,je){if(Array.isArray(j))for(var Je=0;Je<j.length;Je++)Ne(C,j[Je],X,he,je);else he=b(he)?!!he.capture:!!he,X=_n(X),C&&C[Nt]?(C=C.i,j=String(j).toString(),j in C.g&&(Je=C.g[j],X=Kn(Je,X,he,je),-1<X&&(En(Je[X]),Array.prototype.splice.call(Je,X,1),Je.length==0&&(delete C.g[j],C.h--)))):C&&(C=gt(C))&&(j=C.g[j.toString()],C=-1,j&&(C=Kn(j,X,he,je)),(X=-1<C?j[C]:null)&&We(X))}function We(C){if(typeof C!="number"&&C&&!C.da){var j=C.src;if(j&&j[Nt])hn(j.i,C);else{var X=C.type,he=C.proxy;j.removeEventListener?j.removeEventListener(X,he,C.capture):j.detachEvent?j.detachEvent(dt(X),he):j.addListener&&j.removeListener&&j.removeListener(he),(X=gt(j))?(hn(X,C),X.h==0&&(X.src=null,j[Ar]=null)):En(C)}}}function dt(C){return C in Zt?Zt[C]:Zt[C]="on"+C}function mt(C,j){if(C.da)C=!0;else{j=new lt(j,this);var X=C.listener,he=C.ha||C.src;C.fa&&We(C),C=X.call(he,j)}return C}function gt(C){return C=C[Ar],C instanceof In?C:null}var Vt="__closure_events_fn_"+(1e9*Math.random()>>>0);function _n(C){return typeof C=="function"?C:(C[Vt]||(C[Vt]=function(j){return C.handleEvent(j)}),C[Vt])}function kn(){qe.call(this),this.i=new In(this),this.M=this,this.F=null}H(kn,qe),kn.prototype[Nt]=!0,kn.prototype.removeEventListener=function(C,j,X,he){Ne(this,C,j,X,he)};function rn(C,j){var X,he=C.F;if(he)for(X=[];he;he=he.F)X.push(he);if(C=C.M,he=j.type||j,typeof j=="string")j=new Ze(j,C);else if(j instanceof Ze)j.target=j.target||C;else{var je=j;j=new Ze(he,C),ue(j,je)}if(je=!0,X)for(var Je=X.length-1;0<=Je;Je--){var It=j.g=X[Je];je=ur(It,he,!0,j)&&je}if(It=j.g=C,je=ur(It,he,!0,j)&&je,je=ur(It,he,!1,j)&&je,X)for(Je=0;Je<X.length;Je++)It=j.g=X[Je],je=ur(It,he,!1,j)&&je}kn.prototype.N=function(){if(kn.aa.N.call(this),this.i){var C=this.i,j;for(j in C.g){for(var X=C.g[j],he=0;he<X.length;he++)En(X[he]);delete C.g[j],C.h--}}this.F=null},kn.prototype.K=function(C,j,X,he){return this.i.add(String(C),j,!1,X,he)},kn.prototype.L=function(C,j,X,he){return this.i.add(String(C),j,!0,X,he)};function ur(C,j,X,he){if(j=C.i.g[String(j)],!j)return!0;j=j.concat();for(var je=!0,Je=0;Je<j.length;++Je){var It=j[Je];if(It&&!It.da&&It.capture==X){var Br=It.listener,ti=It.ha||It.src;It.fa&&hn(C.i,It),je=Br.call(ti,he)!==!1&&je}}return je&&!he.defaultPrevented}function $a(C,j,X){if(typeof C=="function")X&&(C=N(C,X));else if(C&&typeof C.handleEvent=="function")C=N(C.handleEvent,C);else throw Error("Invalid listener argument");return 2147483647<Number(j)?-1:E.setTimeout(C,j||0)}function kt(C){C.g=$a(()=>{C.g=null,C.i&&(C.i=!1,kt(C))},C.l);const j=C.h;C.h=null,C.m.apply(null,j)}class tn extends qe{constructor(j,X){super(),this.m=j,this.l=X,this.h=null,this.i=!1,this.g=null}j(j){this.h=arguments,this.g?this.i=!0:kt(this)}N(){super.N(),this.g&&(E.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Hi(C){qe.call(this),this.h=C,this.g={}}H(Hi,qe);var Cs=[];function Vs(C){ye(C.g,function(j,X){this.g.hasOwnProperty(X)&&We(j)},C),C.g={}}Hi.prototype.N=function(){Hi.aa.N.call(this),Vs(this)},Hi.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var li=E.JSON.stringify,Ca=E.JSON.parse,Bc=class{stringify(C){return E.JSON.stringify(C,void 0)}parse(C){return E.JSON.parse(C,void 0)}};function Zs(){}Zs.prototype.h=null;function eo(C){return C.h||(C.h=C.i())}function yl(){}var Is={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Ya(){Ze.call(this,"d")}H(Ya,Ze);function Yo(){Ze.call(this,"c")}H(Yo,Ze);var Xa={},Wc=null;function mu(){return Wc=Wc||new kn}Xa.La="serverreachability";function Ja(C){Ze.call(this,Xa.La,C)}H(Ja,Ze);function Gc(C){const j=mu();rn(j,new Ja(j))}Xa.STAT_EVENT="statevent";function Eo(C,j){Ze.call(this,Xa.STAT_EVENT,C),this.stat=j}H(Eo,Ze);function Ri(C){const j=mu();rn(j,new Eo(j,C))}Xa.Ma="timingevent";function es(C,j){Ze.call(this,Xa.Ma,C),this.size=j}H(es,Ze);function Ia(C,j){if(typeof C!="function")throw Error("Fn must not be null and must be a function");return E.setTimeout(function(){C()},j)}function gu(){this.g=!0}gu.prototype.xa=function(){this.g=!1};function Qa(C,j,X,he,je,Je){C.info(function(){if(C.g)if(Je)for(var It="",Br=Je.split("&"),ti=0;ti<Br.length;ti++){var pr=Br[ti].split("=");if(1<pr.length){var Os=pr[0];pr=pr[1];var ns=Os.split("_");It=2<=ns.length&&ns[1]=="type"?It+(Os+"="+pr+"&"):It+(Os+"=redacted&")}}else It=null;else It=Je;return"XMLHTTP REQ ("+he+") [attempt "+je+"]: "+j+`
`+X+`
`+It})}function Xo(C,j,X,he,je,Je,It){C.info(function(){return"XMLHTTP RESP ("+he+") [ attempt "+je+"]: "+j+`
`+X+`
`+Je+" "+It})}function Jo(C,j,X,he){C.info(function(){return"XMLHTTP TEXT ("+j+"): "+rg(C,X)+(he?" "+he:"")})}function hd(C,j){C.info(function(){return"TIMEOUT: "+j})}gu.prototype.info=function(){};function rg(C,j){if(!C.g)return j;if(!j)return null;try{var X=JSON.parse(j);if(X){for(C=0;C<X.length;C++)if(Array.isArray(X[C])){var he=X[C];if(!(2>he.length)){var je=he[1];if(Array.isArray(je)&&!(1>je.length)){var Je=je[0];if(Je!="noop"&&Je!="stop"&&Je!="close")for(var It=1;It<je.length;It++)je[It]=""}}}}return li(X)}catch{return j}}var _u={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Bh={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},As;function Eu(){}H(Eu,Zs),Eu.prototype.g=function(){return new XMLHttpRequest},Eu.prototype.i=function(){return{}},As=new Eu;function Qo(C,j,X,he){this.j=C,this.i=j,this.l=X,this.R=he||1,this.U=new Hi(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new fd}function fd(){this.i=null,this.g="",this.h=!1}var pd={},Aa={};function md(C,j,X){C.L=1,C.v=Pa(vo(j)),C.m=X,C.P=!0,yu(C,null)}function yu(C,j){C.F=Date.now(),Mr(C),C.A=vo(C.v);var X=C.A,he=C.R;Array.isArray(he)||(he=[String(he)]),Rl(X.i,"t",he),C.C=0,X=C.j.J,C.h=new fd,C.g=mE(C.j,X?j:null,!C.m),0<C.O&&(C.M=new tn(N(C.Y,C,C.g),C.O)),j=C.U,X=C.g,he=C.ca;var je="readystatechange";Array.isArray(je)||(je&&(Cs[0]=je.toString()),je=Cs);for(var Je=0;Je<je.length;Je++){var It=Zn(X,je[Je],he||j.handleEvent,!1,j.h||j);if(!It)break;j.g[It.key]=It}j=C.H?ne(C.H):{},C.m?(C.u||(C.u="POST"),j["Content-Type"]="application/x-www-form-urlencoded",C.g.ea(C.A,C.u,C.m,j)):(C.u="GET",C.g.ea(C.A,C.u,null,j)),Gc(),Qa(C.i,C.u,C.A,C.l,C.R,C.m)}Qo.prototype.ca=function(C){C=C.target;const j=this.M;j&&di(C)==3?j.j():this.Y(C)},Qo.prototype.Y=function(C){try{if(C==this.g)e:{const ns=di(this.g);var j=this.g.Ba();const Na=this.g.Z();if(!(3>ns)&&(ns!=3||this.g&&(this.h.h||this.g.oa()||_s(this.g)))){this.J||ns!=4||j==7||(j==8||0>=Na?Gc(3):Gc(2)),Za(this);var X=this.g.Z();this.X=X;t:if(yo(this)){var he=_s(this.g);C="";var je=he.length,Je=di(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Zo(this),zc(this);var It="";break t}this.h.i=new E.TextDecoder}for(j=0;j<je;j++)this.h.h=!0,C+=this.h.i.decode(he[j],{stream:!(Je&&j==je-1)});he.length=0,this.h.g+=C,this.C=0,It=this.h.g}else It=this.g.oa();if(this.o=X==200,Xo(this.i,this.u,this.A,this.l,this.R,ns,X),this.o){if(this.T&&!this.K){t:{if(this.g){var Br,ti=this.g;if((Br=ti.g?ti.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!J(Br)){var pr=Br;break t}}pr=null}if(X=pr)Jo(this.i,this.l,X,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Wh(this,X);else{this.o=!1,this.s=3,Ri(12),Zo(this),zc(this);break e}}if(this.P){X=!0;let Po;for(;!this.J&&this.C<It.length;)if(Po=gd(this,It),Po==Aa){ns==4&&(this.s=4,Ri(14),X=!1),Jo(this.i,this.l,null,"[Incomplete Response]");break}else if(Po==pd){this.s=4,Ri(15),Jo(this.i,this.l,It,"[Invalid Chunk]"),X=!1;break}else Jo(this.i,this.l,Po,null),Wh(this,Po);if(yo(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),ns!=4||It.length!=0||this.h.h||(this.s=1,Ri(16),X=!1),this.o=this.o&&X,!X)Jo(this.i,this.l,It,"[Invalid Chunked Response]"),Zo(this),zc(this);else if(0<It.length&&!this.W){this.W=!0;var Os=this.j;Os.g==this&&Os.ba&&!Os.M&&(Os.j.info("Great, no buffering proxy detected. Bytes received: "+It.length),sg(Os),Os.M=!0,Ri(11))}}else Jo(this.i,this.l,It,null),Wh(this,It);ns==4&&Zo(this),this.o&&!this.J&&(ns==4?yp(this.j,this):(this.o=!1,Mr(this)))}else Co(this.g),X==400&&0<It.indexOf("Unknown SID")?(this.s=3,Ri(12)):(this.s=0,Ri(13)),Zo(this),zc(this)}}}catch{}finally{}};function yo(C){return C.g?C.u=="GET"&&C.L!=2&&C.j.Ca:!1}function gd(C,j){var X=C.C,he=j.indexOf(`
`,X);return he==-1?Aa:(X=Number(j.substring(X,he)),isNaN(X)?pd:(he+=1,he+X>j.length?Aa:(j=j.slice(he,he+X),C.C=he+X,j)))}Qo.prototype.cancel=function(){this.J=!0,Zo(this)};function Mr(C){C.S=Date.now()+C.I,ui(C,C.I)}function ui(C,j){if(C.B!=null)throw Error("WatchDog timer not null");C.B=Ia(N(C.ba,C),j)}function Za(C){C.B&&(E.clearTimeout(C.B),C.B=null)}Qo.prototype.ba=function(){this.B=null;const C=Date.now();0<=C-this.S?(hd(this.i,this.A),this.L!=2&&(Gc(),Ri(17)),Zo(this),this.s=2,zc(this)):ui(this,this.S-C)};function zc(C){C.j.G==0||C.J||yp(C.j,C)}function Zo(C){Za(C);var j=C.M;j&&typeof j.ma=="function"&&j.ma(),C.M=null,Vs(C.U),C.g&&(j=C.g,C.g=null,j.abort(),j.ma())}function Wh(C,j){try{var X=C.j;if(X.G!=0&&(X.g==C||Fs(X.h,C))){if(!C.K&&Fs(X.h,C)&&X.G==3){try{var he=X.Da.g.parse(j)}catch{he=null}if(Array.isArray(he)&&he.length==3){var je=he;if(je[0]==0){e:if(!X.u){if(X.g)if(X.g.F+3e3<C.F)Ep(X),Yc(X);else break e;_p(X),Ri(18)}}else X.za=je[1],0<X.za-X.T&&37500>je[2]&&X.F&&X.v==0&&!X.C&&(X.C=Ia(N(X.Za,X),6e3));if(1>=dp(X.h)&&X.ca){try{X.ca()}catch{}X.ca=void 0}}else Cu(X,11)}else if((C.K||X.g==C)&&Ep(X),!J(j))for(je=X.Da.g.parse(j),j=0;j<je.length;j++){let pr=je[j];if(X.T=pr[0],pr=pr[1],X.G==2)if(pr[0]=="c"){X.K=pr[1],X.ia=pr[2];const Os=pr[3];Os!=null&&(X.la=Os,X.j.info("VER="+X.la));const ns=pr[4];ns!=null&&(X.Aa=ns,X.j.info("SVER="+X.Aa));const Na=pr[5];Na!=null&&typeof Na=="number"&&0<Na&&(he=1.5*Na,X.L=he,X.j.info("backChannelRequestTimeoutMs_="+he)),he=X;const Po=C.g;if(Po){const qh=Po.g?Po.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(qh){var Je=he.h;Je.g||qh.indexOf("spdy")==-1&&qh.indexOf("quic")==-1&&qh.indexOf("h2")==-1||(Je.j=Je.l,Je.g=new Set,Je.h&&(Gh(Je,Je.h),Je.h=null))}if(he.D){const Sp=Po.g?Po.g.getResponseHeader("X-HTTP-Session-Id"):null;Sp&&(he.ya=Sp,jr(he.I,he.D,Sp))}}X.G=3,X.l&&X.l.ua(),X.ba&&(X.R=Date.now()-C.F,X.j.info("Handshake RTT: "+X.R+"ms")),he=X;var It=C;if(he.qa=og(he,he.J?he.ia:null,he.W),It.K){Hc(he.h,It);var Br=It,ti=he.L;ti&&(Br.I=ti),Br.B&&(Za(Br),Mr(Br)),he.g=It}else Il(he);0<X.i.length&&nc(X)}else pr[0]!="stop"&&pr[0]!="close"||Cu(X,7);else X.G==3&&(pr[0]=="stop"||pr[0]=="close"?pr[0]=="stop"?Cu(X,7):Ui(X):pr[0]!="noop"&&X.l&&X.l.ta(pr),X.v=0)}}Gc(4)}catch{}}var _d=class{constructor(C,j){this.g=C,this.map=j}};function vl(C){this.l=C||10,E.PerformanceNavigationTiming?(C=E.performance.getEntriesByType("navigation"),C=0<C.length&&(C[0].nextHopProtocol=="hq"||C[0].nextHopProtocol=="h2")):C=!!(E.chrome&&E.chrome.loadTimes&&E.chrome.loadTimes()&&E.chrome.loadTimes().wasFetchedViaSpdy),this.j=C?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function to(C){return C.h?!0:C.g?C.g.size>=C.j:!1}function dp(C){return C.h?1:C.g?C.g.size:0}function Fs(C,j){return C.h?C.h==j:C.g?C.g.has(j):!1}function Gh(C,j){C.g?C.g.add(j):C.h=j}function Hc(C,j){C.h&&C.h==j?C.h=null:C.g&&C.g.has(j)&&C.g.delete(j)}vl.prototype.cancel=function(){if(this.i=Ed(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const C of this.g.values())C.cancel();this.g.clear()}};function Ed(C){if(C.h!=null)return C.i.concat(C.h.D);if(C.g!=null&&C.g.size!==0){let j=C.i;for(const X of C.g.values())j=j.concat(X.D);return j}return z(C.i)}function yd(C){if(C.V&&typeof C.V=="function")return C.V();if(typeof Map<"u"&&C instanceof Map||typeof Set<"u"&&C instanceof Set)return Array.from(C.values());if(typeof C=="string")return C.split("");if(v(C)){for(var j=[],X=C.length,he=0;he<X;he++)j.push(C[he]);return j}j=[],X=0;for(he in C)j[X++]=C[he];return j}function ar(C){if(C.na&&typeof C.na=="function")return C.na();if(!C.V||typeof C.V!="function"){if(typeof Map<"u"&&C instanceof Map)return Array.from(C.keys());if(!(typeof Set<"u"&&C instanceof Set)){if(v(C)||typeof C=="string"){var j=[];C=C.length;for(var X=0;X<C;X++)j.push(X);return j}j=[],X=0;for(const he in C)j[X++]=he;return j}}}function Sl(C,j){if(C.forEach&&typeof C.forEach=="function")C.forEach(j,void 0);else if(v(C)||typeof C=="string")Array.prototype.forEach.call(C,j,void 0);else for(var X=ar(C),he=yd(C),je=he.length,Je=0;Je<je;Je++)j.call(void 0,he[Je],X&&X[Je],C)}var Tl=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function vu(C,j){if(C){C=C.split("&");for(var X=0;X<C.length;X++){var he=C[X].indexOf("="),je=null;if(0<=he){var Je=C[X].substring(0,he);je=C[X].substring(he+1)}else Je=C[X];j(Je,je?decodeURIComponent(je.replace(/\+/g," ")):"")}}}function Oa(C){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,C instanceof Oa){this.h=C.h,Su(this,C.j),this.o=C.o,this.g=C.g,Kc(this,C.s),this.l=C.l;var j=C.i,X=new So;X.i=j.i,j.g&&(X.g=new Map(j.g),X.h=j.h),bl(this,X),this.m=C.m}else C&&(j=String(C).match(Tl))?(this.h=!1,Su(this,j[1]||"",!0),this.o=er(j[2]||""),this.g=er(j[3]||"",!0),Kc(this,j[4]),this.l=er(j[5]||"",!0),bl(this,j[6]||"",!0),this.m=er(j[7]||"")):(this.h=!1,this.i=new So(null,this.h))}Oa.prototype.toString=function(){var C=[],j=this.j;j&&C.push(ec(j,wl,!0),":");var X=this.g;return(X||j=="file")&&(C.push("//"),(j=this.o)&&C.push(ec(j,wl,!0),"@"),C.push(encodeURIComponent(String(X)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),X=this.s,X!=null&&C.push(":",String(X))),(X=this.l)&&(this.g&&X.charAt(0)!="/"&&C.push("/"),C.push(ec(X,X.charAt(0)=="/"?zh:vd,!0))),(X=this.i.toString())&&C.push("?",X),(X=this.m)&&C.push("#",ec(X,Hh)),C.join("")};function vo(C){return new Oa(C)}function Su(C,j,X){C.j=X?er(j,!0):j,C.j&&(C.j=C.j.replace(/:$/,""))}function Kc(C,j){if(j){if(j=Number(j),isNaN(j)||0>j)throw Error("Bad port number "+j);C.s=j}else C.s=null}function bl(C,j,X){j instanceof So?(C.i=j,Ro(C.i,C.h)):(X||(j=ec(j,fp)),C.i=new So(j,C.h))}function jr(C,j,X){C.i.set(j,X)}function Pa(C){return jr(C,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),C}function er(C,j){return C?j?decodeURI(C.replace(/%25/g,"%2525")):decodeURIComponent(C):""}function ec(C,j,X){return typeof C=="string"?(C=encodeURI(C).replace(j,hp),X&&(C=C.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),C):null}function hp(C){return C=C.charCodeAt(0),"%"+(C>>4&15).toString(16)+(C&15).toString(16)}var wl=/[#\/\?@]/g,vd=/[#\?:]/g,zh=/[#\?]/g,fp=/[#\?@]/g,Hh=/#/g;function So(C,j){this.h=this.g=null,this.i=C||null,this.j=!!j}function Ki(C){C.g||(C.g=new Map,C.h=0,C.i&&vu(C.i,function(j,X){C.add(decodeURIComponent(j.replace(/\+/g," ")),X)}))}r=So.prototype,r.add=function(C,j){Ki(this),this.i=null,C=wo(this,C);var X=this.g.get(C);return X||this.g.set(C,X=[]),X.push(j),this.h+=1,this};function To(C,j){Ki(C),j=wo(C,j),C.g.has(j)&&(C.i=null,C.h-=C.g.get(j).length,C.g.delete(j))}function bo(C,j){return Ki(C),j=wo(C,j),C.g.has(j)}r.forEach=function(C,j){Ki(this),this.g.forEach(function(X,he){X.forEach(function(je){C.call(j,je,he,this)},this)},this)},r.na=function(){Ki(this);const C=Array.from(this.g.values()),j=Array.from(this.g.keys()),X=[];for(let he=0;he<j.length;he++){const je=C[he];for(let Je=0;Je<je.length;Je++)X.push(j[he])}return X},r.V=function(C){Ki(this);let j=[];if(typeof C=="string")bo(this,C)&&(j=j.concat(this.g.get(wo(this,C))));else{C=Array.from(this.g.values());for(let X=0;X<C.length;X++)j=j.concat(C[X])}return j},r.set=function(C,j){return Ki(this),this.i=null,C=wo(this,C),bo(this,C)&&(this.h-=this.g.get(C).length),this.g.set(C,[j]),this.h+=1,this},r.get=function(C,j){return C?(C=this.V(C),0<C.length?String(C[0]):j):j};function Rl(C,j,X){To(C,j),0<X.length&&(C.i=null,C.g.set(wo(C,j),z(X)),C.h+=X.length)}r.toString=function(){if(this.i)return this.i;if(!this.g)return"";const C=[],j=Array.from(this.g.keys());for(var X=0;X<j.length;X++){var he=j[X];const Je=encodeURIComponent(String(he)),It=this.V(he);for(he=0;he<It.length;he++){var je=Je;It[he]!==""&&(je+="="+encodeURIComponent(String(It[he]))),C.push(je)}}return this.i=C.join("&")};function wo(C,j){return j=String(j),C.j&&(j=j.toLowerCase()),j}function Ro(C,j){j&&!C.j&&(Ki(C),C.i=null,C.g.forEach(function(X,he){var je=he.toLowerCase();he!=je&&(To(this,he),Rl(this,je,X))},C)),C.j=j}function pp(C,j){const X=new gu;if(E.Image){const he=new Image;he.onload=F(ts,X,"TestLoadImage: loaded",!0,j,he),he.onerror=F(ts,X,"TestLoadImage: error",!1,j,he),he.onabort=F(ts,X,"TestLoadImage: abort",!1,j,he),he.ontimeout=F(ts,X,"TestLoadImage: timeout",!1,j,he),E.setTimeout(function(){he.ontimeout&&he.ontimeout()},1e4),he.src=C}else j(!1)}function tc(C,j){const X=new gu,he=new AbortController,je=setTimeout(()=>{he.abort(),ts(X,"TestPingServer: timeout",!1,j)},1e4);fetch(C,{signal:he.signal}).then(Je=>{clearTimeout(je),Je.ok?ts(X,"TestPingServer: ok",!0,j):ts(X,"TestPingServer: server error",!1,j)}).catch(()=>{clearTimeout(je),ts(X,"TestPingServer: error",!1,j)})}function ts(C,j,X,he,je){try{je&&(je.onload=null,je.onerror=null,je.onabort=null,je.ontimeout=null),he(X)}catch{}}function Tu(){this.g=new Bc}function Kh(C,j,X){const he=X||"";try{Sl(C,function(je,Je){let It=je;b(je)&&(It=li(je)),j.push(he+Je+"="+encodeURIComponent(It))})}catch(je){throw j.push(he+"type="+encodeURIComponent("_badmap")),je}}function qc(C){this.l=C.Ub||null,this.j=C.eb||!1}H(qc,Zs),qc.prototype.g=function(){return new Cl(this.l,this.j)},qc.prototype.i=function(C){return function(){return C}}({});function Cl(C,j){kn.call(this),this.D=C,this.o=j,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}H(Cl,kn),r=Cl.prototype,r.open=function(C,j){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=C,this.A=j,this.readyState=1,ta(this)},r.send=function(C){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const j={headers:this.u,method:this.B,credentials:this.m,cache:void 0};C&&(j.body=C),(this.D||E).fetch(new Request(this.A,j)).then(this.Sa.bind(this),this.ga.bind(this))},r.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,ea(this)),this.readyState=0},r.Sa=function(C){if(this.g&&(this.l=C,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=C.headers,this.readyState=2,ta(this)),this.g&&(this.readyState=3,ta(this),this.g)))if(this.responseType==="arraybuffer")C.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof E.ReadableStream<"u"&&"body"in C){if(this.j=C.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;mp(this)}else C.text().then(this.Ra.bind(this),this.ga.bind(this))};function mp(C){C.j.read().then(C.Pa.bind(C)).catch(C.ga.bind(C))}r.Pa=function(C){if(this.g){if(this.o&&C.value)this.response.push(C.value);else if(!this.o){var j=C.value?C.value:new Uint8Array(0);(j=this.v.decode(j,{stream:!C.done}))&&(this.response=this.responseText+=j)}C.done?ea(this):ta(this),this.readyState==3&&mp(this)}},r.Ra=function(C){this.g&&(this.response=this.responseText=C,ea(this))},r.Qa=function(C){this.g&&(this.response=C,ea(this))},r.ga=function(){this.g&&ea(this)};function ea(C){C.readyState=4,C.l=null,C.j=null,C.v=null,ta(C)}r.setRequestHeader=function(C,j){this.u.append(C,j)},r.getResponseHeader=function(C){return this.h&&this.h.get(C.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";const C=[],j=this.h.entries();for(var X=j.next();!X.done;)X=X.value,C.push(X[0]+": "+X[1]),X=j.next();return C.join(`\r
`)};function ta(C){C.onreadystatechange&&C.onreadystatechange.call(C)}Object.defineProperty(Cl.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(C){this.m=C?"include":"same-origin"}});function $c(C){let j="";return ye(C,function(X,he){j+=he,j+=":",j+=X,j+=`\r
`}),j}function _e(C,j,X){e:{for(he in X){var he=!1;break e}he=!0}he||(X=$c(X),typeof C=="string"?X!=null&&encodeURIComponent(String(X)):jr(C,j,X))}function Re(C){kn.call(this),this.headers=new Map,this.o=C||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}H(Re,kn);var Ke=/^https?$/i,Bt=["POST","PUT"];r=Re.prototype,r.Ha=function(C){this.J=C},r.ea=function(C,j,X,he){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+C);j=j?j.toUpperCase():"GET",this.D=C,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():As.g(),this.v=this.o?eo(this.o):eo(As),this.g.onreadystatechange=N(this.Ea,this);try{this.B=!0,this.g.open(j,String(C),!0),this.B=!1}catch(Je){Wn(this,Je);return}if(C=X||"",X=new Map(this.headers),he)if(Object.getPrototypeOf(he)===Object.prototype)for(var je in he)X.set(je,he[je]);else if(typeof he.keys=="function"&&typeof he.get=="function")for(const Je of he.keys())X.set(Je,he.get(Je));else throw Error("Unknown input type for opt_headers: "+String(he));he=Array.from(X.keys()).find(Je=>Je.toLowerCase()=="content-type"),je=E.FormData&&C instanceof E.FormData,!(0<=Array.prototype.indexOf.call(Bt,j,void 0))||he||je||X.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[Je,It]of X)this.g.setRequestHeader(Je,It);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Or(this),this.u=!0,this.g.send(C),this.u=!1}catch(Je){Wn(this,Je)}};function Wn(C,j){C.h=!1,C.g&&(C.j=!0,C.g.abort(),C.j=!1),C.l=j,C.m=5,fr(C),nn(C)}function fr(C){C.A||(C.A=!0,rn(C,"complete"),rn(C,"error"))}r.abort=function(C){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=C||7,rn(this,"complete"),rn(this,"abort"),nn(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),nn(this,!0)),Re.aa.N.call(this)},r.Ea=function(){this.s||(this.B||this.u||this.j?Ur(this):this.bb())},r.bb=function(){Ur(this)};function Ur(C){if(C.h&&typeof p<"u"&&(!C.v[1]||di(C)!=4||C.Z()!=2)){if(C.u&&di(C)==4)$a(C.Ea,0,C);else if(rn(C,"readystatechange"),di(C)==4){C.h=!1;try{const It=C.Z();e:switch(It){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var j=!0;break e;default:j=!1}var X;if(!(X=j)){var he;if(he=It===0){var je=String(C.D).match(Tl)[1]||null;!je&&E.self&&E.self.location&&(je=E.self.location.protocol.slice(0,-1)),he=!Ke.test(je?je.toLowerCase():"")}X=he}if(X)rn(C,"complete"),rn(C,"success");else{C.m=6;try{var Je=2<di(C)?C.g.statusText:""}catch{Je=""}C.l=Je+" ["+C.Z()+"]",fr(C)}}finally{nn(C)}}}}function nn(C,j){if(C.g){Or(C);const X=C.g,he=C.v[0]?()=>{}:null;C.g=null,C.v=null,j||rn(C,"ready");try{X.onreadystatechange=he}catch{}}}function Or(C){C.I&&(E.clearTimeout(C.I),C.I=null)}r.isActive=function(){return!!this.g};function di(C){return C.g?C.g.readyState:0}r.Z=function(){try{return 2<di(this)?this.g.status:-1}catch{return-1}},r.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},r.Oa=function(C){if(this.g){var j=this.g.responseText;return C&&j.indexOf(C)==0&&(j=j.substring(C.length)),Ca(j)}};function _s(C){try{if(!C.g)return null;if("response"in C.g)return C.g.response;switch(C.H){case"":case"text":return C.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in C.g)return C.g.mozResponseArrayBuffer}return null}catch{return null}}function Co(C){const j={};C=(C.g&&2<=di(C)&&C.g.getAllResponseHeaders()||"").split(`\r
`);for(let he=0;he<C.length;he++){if(J(C[he]))continue;var X=Ee(C[he]);const je=X[0];if(X=X[1],typeof X!="string")continue;X=X.trim();const Je=j[je]||[];j[je]=Je,Je.push(X)}Q(j,function(he){return he.join(", ")})}r.Ba=function(){return this.m},r.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Io(C,j,X){return X&&X.internalChannelParams&&X.internalChannelParams[C]||j}function bu(C){this.Aa=0,this.i=[],this.j=new gu,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Io("failFast",!1,C),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Io("baseRetryDelayMs",5e3,C),this.cb=Io("retryDelaySeedMs",1e4,C),this.Wa=Io("forwardChannelMaxRetries",2,C),this.wa=Io("forwardChannelRequestTimeoutMs",2e4,C),this.pa=C&&C.xmlHttpFactory||void 0,this.Xa=C&&C.Tb||void 0,this.Ca=C&&C.useFetchStreams||!1,this.L=void 0,this.J=C&&C.supportsCrossDomainXhr||!1,this.K="",this.h=new vl(C&&C.concurrentRequestLimit),this.Da=new Tu,this.P=C&&C.fastHandshake||!1,this.O=C&&C.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=C&&C.Rb||!1,C&&C.xa&&this.j.xa(),C&&C.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&C&&C.detectBufferingProxy||!1,this.ja=void 0,C&&C.longPollingTimeout&&0<C.longPollingTimeout&&(this.ja=C.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}r=bu.prototype,r.la=8,r.G=1,r.connect=function(C,j,X,he){Ri(0),this.W=C,this.H=j||{},X&&he!==void 0&&(this.H.OSID=X,this.H.OAID=he),this.F=this.X,this.I=og(this,null,this.W),nc(this)};function Ui(C){if(Sd(C),C.G==3){var j=C.U++,X=vo(C.I);if(jr(X,"SID",C.K),jr(X,"RID",j),jr(X,"TYPE","terminate"),wu(C,X),j=new Qo(C,C.j,j),j.L=2,j.v=Pa(vo(X)),X=!1,E.navigator&&E.navigator.sendBeacon)try{X=E.navigator.sendBeacon(j.v.toString(),"")}catch{}!X&&E.Image&&(new Image().src=j.v,X=!0),X||(j.g=mE(j.j,null),j.g.ea(j.v)),j.F=Date.now(),Mr(j)}Iu(C)}function Yc(C){C.g&&(sg(C),C.g.cancel(),C.g=null)}function Sd(C){Yc(C),C.u&&(E.clearTimeout(C.u),C.u=null),Ep(C),C.h.cancel(),C.s&&(typeof C.s=="number"&&E.clearTimeout(C.s),C.s=null)}function nc(C){if(!to(C.h)&&!C.s){C.s=!0;var j=C.Ga;Oe||it(),Ue||(Oe(),Ue=!0),Me.add(j,C),C.B=0}}function ig(C,j){return dp(C.h)>=C.h.j-(C.s?1:0)?!1:C.s?(C.i=j.D.concat(C.i),!0):C.G==1||C.G==2||C.B>=(C.Va?0:C.Wa)?!1:(C.s=Ia(N(C.Ga,C,j),Ru(C,C.B)),C.B++,!0)}r.Ga=function(C){if(this.s)if(this.s=null,this.G==1){if(!C){this.U=Math.floor(1e5*Math.random()),C=this.U++;const je=new Qo(this,this.j,C);let Je=this.o;if(this.S&&(Je?(Je=ne(Je),ue(Je,this.S)):Je=this.S),this.m!==null||this.O||(je.H=Je,Je=null),this.P)e:{for(var j=0,X=0;X<this.i.length;X++){t:{var he=this.i[X];if("__data__"in he.map&&(he=he.map.__data__,typeof he=="string")){he=he.length;break t}he=void 0}if(he===void 0)break;if(j+=he,4096<j){j=X;break e}if(j===4096||X===this.i.length-1){j=X+1;break e}}j=1e3}else j=1e3;j=Ao(this,je,j),X=vo(this.I),jr(X,"RID",C),jr(X,"CVER",22),this.D&&jr(X,"X-HTTP-Session-Id",this.D),wu(this,X),Je&&(this.O?j="headers="+encodeURIComponent(String($c(Je)))+"&"+j:this.m&&_e(X,this.m,Je)),Gh(this.h,je),this.Ua&&jr(X,"TYPE","init"),this.P?(jr(X,"$req",j),jr(X,"SID","null"),je.T=!0,md(je,X,null)):md(je,X,j),this.G=2}}else this.G==3&&(C?gp(this,C):this.i.length==0||to(this.h)||gp(this))};function gp(C,j){var X;j?X=j.l:X=C.U++;const he=vo(C.I);jr(he,"SID",C.K),jr(he,"RID",X),jr(he,"AID",C.T),wu(C,he),C.m&&C.o&&_e(he,C.m,C.o),X=new Qo(C,C.j,X,C.B+1),C.m===null&&(X.H=C.o),j&&(C.i=j.D.concat(C.i)),j=Ao(C,X,1e3),X.I=Math.round(.5*C.wa)+Math.round(.5*C.wa*Math.random()),Gh(C.h,X),md(X,he,j)}function wu(C,j){C.H&&ye(C.H,function(X,he){jr(j,he,X)}),C.l&&Sl({},function(X,he){jr(j,he,X)})}function Ao(C,j,X){X=Math.min(C.i.length,X);var he=C.l?N(C.l.Na,C.l,C):null;e:{var je=C.i;let Je=-1;for(;;){const It=["count="+X];Je==-1?0<X?(Je=je[0].g,It.push("ofs="+Je)):Je=0:It.push("ofs="+Je);let Br=!0;for(let ti=0;ti<X;ti++){let pr=je[ti].g;const Os=je[ti].map;if(pr-=Je,0>pr)Je=Math.max(0,je[ti].g-100),Br=!1;else try{Kh(Os,It,"req"+pr+"_")}catch{he&&he(Os)}}if(Br){he=It.join("&");break e}}}return C=C.i.splice(0,X),j.D=C,he}function Il(C){if(!C.g&&!C.u){C.Y=1;var j=C.Fa;Oe||it(),Ue||(Oe(),Ue=!0),Me.add(j,C),C.v=0}}function _p(C){return C.g||C.u||3<=C.v?!1:(C.Y++,C.u=Ia(N(C.Fa,C),Ru(C,C.v)),C.v++,!0)}r.Fa=function(){if(this.u=null,pE(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var C=2*this.R;this.j.info("BP detection timer enabled: "+C),this.A=Ia(N(this.ab,this),C)}},r.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Ri(10),Yc(this),pE(this))};function sg(C){C.A!=null&&(E.clearTimeout(C.A),C.A=null)}function pE(C){C.g=new Qo(C,C.j,"rpc",C.Y),C.m===null&&(C.g.H=C.o),C.g.O=0;var j=vo(C.qa);jr(j,"RID","rpc"),jr(j,"SID",C.K),jr(j,"AID",C.T),jr(j,"CI",C.F?"0":"1"),!C.F&&C.ja&&jr(j,"TO",C.ja),jr(j,"TYPE","xmlhttp"),wu(C,j),C.m&&C.o&&_e(j,C.m,C.o),C.L&&(C.g.I=C.L);var X=C.g;C=C.ia,X.L=1,X.v=Pa(vo(j)),X.m=null,X.P=!0,yu(X,C)}r.Za=function(){this.C!=null&&(this.C=null,Yc(this),_p(this),Ri(19))};function Ep(C){C.C!=null&&(E.clearTimeout(C.C),C.C=null)}function yp(C,j){var X=null;if(C.g==j){Ep(C),sg(C),C.g=null;var he=2}else if(Fs(C.h,j))X=j.D,Hc(C.h,j),he=1;else return;if(C.G!=0){if(j.o)if(he==1){X=j.m?j.m.length:0,j=Date.now()-j.F;var je=C.B;he=mu(),rn(he,new es(he,X)),nc(C)}else Il(C);else if(je=j.s,je==3||je==0&&0<j.X||!(he==1&&ig(C,j)||he==2&&_p(C)))switch(X&&0<X.length&&(j=C.h,j.i=j.i.concat(X)),je){case 1:Cu(C,5);break;case 4:Cu(C,10);break;case 3:Cu(C,6);break;default:Cu(C,2)}}}function Ru(C,j){let X=C.Ta+Math.floor(Math.random()*C.cb);return C.isActive()||(X*=2),X*j}function Cu(C,j){if(C.j.info("Error code "+j),j==2){var X=N(C.fb,C),he=C.Xa;const je=!he;he=new Oa(he||"//www.google.com/images/cleardot.gif"),E.location&&E.location.protocol=="http"||Su(he,"https"),Pa(he),je?pp(he.toString(),X):tc(he.toString(),X)}else Ri(2);C.G=0,C.l&&C.l.sa(j),Iu(C),Sd(C)}r.fb=function(C){C?(this.j.info("Successfully pinged google.com"),Ri(2)):(this.j.info("Failed to ping google.com"),Ri(1))};function Iu(C){if(C.G=0,C.ka=[],C.l){const j=Ed(C.h);(j.length!=0||C.i.length!=0)&&(G(C.ka,j),G(C.ka,C.i),C.h.i.length=0,z(C.i),C.i.length=0),C.l.ra()}}function og(C,j,X){var he=X instanceof Oa?vo(X):new Oa(X);if(he.g!="")j&&(he.g=j+"."+he.g),Kc(he,he.s);else{var je=E.location;he=je.protocol,j=j?j+"."+je.hostname:je.hostname,je=+je.port;var Je=new Oa(null);he&&Su(Je,he),j&&(Je.g=j),je&&Kc(Je,je),X&&(Je.l=X),he=Je}return X=C.D,j=C.ya,X&&j&&jr(he,X,j),jr(he,"VER",C.la),wu(C,he),he}function mE(C,j,X){if(j&&!C.J)throw Error("Can't create secondary domain capable XhrIo object.");return j=C.Ca&&!C.pa?new Re(new qc({eb:X})):new Re(C.pa),j.Ha(C.J),j}r.isActive=function(){return!!this.l&&this.l.isActive(this)};function Dn(){}r=Dn.prototype,r.ua=function(){},r.ta=function(){},r.sa=function(){},r.ra=function(){},r.isActive=function(){return!0},r.Na=function(){};function vp(){}vp.prototype.g=function(C,j){return new Oo(C,j)};function Oo(C,j){kn.call(this),this.g=new bu(j),this.l=C,this.h=j&&j.messageUrlParams||null,C=j&&j.messageHeaders||null,j&&j.clientProtocolHeaderRequired&&(C?C["X-Client-Protocol"]="webchannel":C={"X-Client-Protocol":"webchannel"}),this.g.o=C,C=j&&j.initMessageHeaders||null,j&&j.messageContentType&&(C?C["X-WebChannel-Content-Type"]=j.messageContentType:C={"X-WebChannel-Content-Type":j.messageContentType}),j&&j.va&&(C?C["X-WebChannel-Client-Profile"]=j.va:C={"X-WebChannel-Client-Profile":j.va}),this.g.S=C,(C=j&&j.Sb)&&!J(C)&&(this.g.m=C),this.v=j&&j.supportsCrossDomainXhr||!1,this.u=j&&j.sendRawJson||!1,(j=j&&j.httpSessionIdParam)&&!J(j)&&(this.g.D=j,C=this.h,C!==null&&j in C&&(C=this.h,j in C&&delete C[j])),this.j=new rc(this)}H(Oo,kn),Oo.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Oo.prototype.close=function(){Ui(this.g)},Oo.prototype.o=function(C){var j=this.g;if(typeof C=="string"){var X={};X.__data__=C,C=X}else this.u&&(X={},X.__data__=li(C),C=X);j.i.push(new _d(j.Ya++,C)),j.G==3&&nc(j)},Oo.prototype.N=function(){this.g.l=null,delete this.j,Ui(this.g),delete this.g,Oo.aa.N.call(this)};function gE(C){Ya.call(this),C.__headers__&&(this.headers=C.__headers__,this.statusCode=C.__status__,delete C.__headers__,delete C.__status__);var j=C.__sm__;if(j){e:{for(const X in j){C=X;break e}C=void 0}(this.i=C)&&(C=this.i,j=j!==null&&C in j?j[C]:void 0),this.data=j}else this.data=C}H(gE,Ya);function _E(){Yo.call(this),this.status=1}H(_E,Yo);function rc(C){this.g=C}H(rc,Dn),rc.prototype.ua=function(){rn(this.g,"a")},rc.prototype.ta=function(C){rn(this.g,new gE(C))},rc.prototype.sa=function(C){rn(this.g,new _E)},rc.prototype.ra=function(){rn(this.g,"b")},vp.prototype.createWebChannel=vp.prototype.g,Oo.prototype.send=Oo.prototype.o,Oo.prototype.open=Oo.prototype.m,Oo.prototype.close=Oo.prototype.close,One=function(){return new vp},Ane=function(){return mu()},Ine=Xa,NU={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},_u.NO_ERROR=0,_u.TIMEOUT=8,_u.HTTP_ERROR=6,RP=_u,Bh.COMPLETE="complete",Cne=Bh,yl.EventType=Is,Is.OPEN="a",Is.CLOSE="b",Is.ERROR="c",Is.MESSAGE="d",kn.prototype.listen=kn.prototype.K,rw=yl,Re.prototype.listenOnce=Re.prototype.L,Re.prototype.getLastError=Re.prototype.Ka,Re.prototype.getLastErrorCode=Re.prototype.Ba,Re.prototype.getStatus=Re.prototype.Z,Re.prototype.getResponseJson=Re.prototype.Oa,Re.prototype.getResponseText=Re.prototype.oa,Re.prototype.send=Re.prototype.ea,Re.prototype.setWithCredentials=Re.prototype.Ha,Rne=Re}).apply(typeof WO<"u"?WO:typeof self<"u"?self:typeof window<"u"?window:{});const hY="@firebase/firestore",fY="4.7.9";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class va{constructor(t){this.uid=t}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}va.UNAUTHENTICATED=new va(null),va.GOOGLE_CREDENTIALS=new va("google-credentials-uid"),va.FIRST_PARTY=new va("first-party-uid"),va.MOCK_USER=new va("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let eT="11.4.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rE=new DF("@firebase/firestore");function Fv(){return rE.logLevel}function Kt(r,...t){if(rE.logLevel<=_r.DEBUG){const s=t.map(zF);rE.debug(`Firestore (${eT}): ${r}`,...s)}}function op(r,...t){if(rE.logLevel<=_r.ERROR){const s=t.map(zF);rE.error(`Firestore (${eT}): ${r}`,...s)}}function kS(r,...t){if(rE.logLevel<=_r.WARN){const s=t.map(zF);rE.warn(`Firestore (${eT}): ${r}`,...s)}}function zF(r){if(typeof r=="string")return r;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(s){return JSON.stringify(s)}(r)}catch{return r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Un(r="Unexpected state"){const t=`FIRESTORE (${eT}) INTERNAL ASSERTION FAILED: `+r;throw op(t),new Error(t)}function ei(r,t){r||Un()}function Hn(r,t){return r}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ct={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Mt extends jh{constructor(t,s){super(t,s),this.code=t,this.message=s,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ep{constructor(){this.promise=new Promise((t,s)=>{this.resolve=t,this.reject=s})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pne{constructor(t,s){this.user=s,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class EVe{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,s){t.enqueueRetryable(()=>s(va.UNAUTHENTICATED))}shutdown(){}}class yVe{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,s){this.changeListener=s,t.enqueueRetryable(()=>s(this.token.user))}shutdown(){this.changeListener=null}}class vVe{constructor(t){this.t=t,this.currentUser=va.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,s){ei(this.o===void 0);let a=this.i;const l=v=>this.i!==a?(a=this.i,s(v)):Promise.resolve();let d=new ep;this.o=()=>{this.i++,this.currentUser=this.u(),d.resolve(),d=new ep,t.enqueueRetryable(()=>l(this.currentUser))};const p=()=>{const v=d;t.enqueueRetryable(async()=>{await v.promise,await l(this.currentUser)})},E=v=>{Kt("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=v,this.o&&(this.auth.addAuthTokenListener(this.o),p())};this.t.onInit(v=>E(v)),setTimeout(()=>{if(!this.auth){const v=this.t.getImmediate({optional:!0});v?E(v):(Kt("FirebaseAuthCredentialsProvider","Auth not yet detected"),d.resolve(),d=new ep)}},0),p()}getToken(){const t=this.i,s=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(s).then(a=>this.i!==t?(Kt("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):a?(ei(typeof a.accessToken=="string"),new Pne(a.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const t=this.auth&&this.auth.getUid();return ei(t===null||typeof t=="string"),new va(t)}}class SVe{constructor(t,s,a){this.l=t,this.h=s,this.P=a,this.type="FirstParty",this.user=va.FIRST_PARTY,this.T=new Map}I(){return this.P?this.P():null}get headers(){this.T.set("X-Goog-AuthUser",this.l);const t=this.I();return t&&this.T.set("Authorization",t),this.h&&this.T.set("X-Goog-Iam-Authorization-Token",this.h),this.T}}class TVe{constructor(t,s,a){this.l=t,this.h=s,this.P=a}getToken(){return Promise.resolve(new SVe(this.l,this.h,this.P))}start(t,s){t.enqueueRetryable(()=>s(va.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class pY{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class bVe{constructor(t,s){this.A=s,this.forceRefresh=!1,this.appCheck=null,this.R=null,this.V=null,ul(t)&&t.settings.appCheckToken&&(this.V=t.settings.appCheckToken)}start(t,s){ei(this.o===void 0);const a=d=>{d.error!=null&&Kt("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${d.error.message}`);const p=d.token!==this.R;return this.R=d.token,Kt("FirebaseAppCheckTokenProvider",`Received ${p?"new":"existing"} token.`),p?s(d.token):Promise.resolve()};this.o=d=>{t.enqueueRetryable(()=>a(d))};const l=d=>{Kt("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=d,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(d=>l(d)),setTimeout(()=>{if(!this.appCheck){const d=this.A.getImmediate({optional:!0});d?l(d):Kt("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.V)return Promise.resolve(new pY(this.V));const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then(s=>s?(ei(typeof s.token=="string"),this.R=s.token,new pY(s.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wVe(r){const t=typeof self<"u"&&(self.crypto||self.msCrypto),s=new Uint8Array(r);if(t&&typeof t.getRandomValues=="function")t.getRandomValues(s);else for(let a=0;a<r;a++)s[a]=Math.floor(256*Math.random());return s}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nne{static newId(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",s=62*Math.floor(4.129032258064516);let a="";for(;a.length<20;){const l=wVe(40);for(let d=0;d<l.length;++d)a.length<20&&l[d]<s&&(a+=t.charAt(l[d]%62))}return a}}function wr(r,t){return r<t?-1:r>t?1:0}function DS(r,t,s){return r.length===t.length&&r.every((a,l)=>s(a,t[l]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mY=-62135596800,gY=1e6;class Xs{static now(){return Xs.fromMillis(Date.now())}static fromDate(t){return Xs.fromMillis(t.getTime())}static fromMillis(t){const s=Math.floor(t/1e3),a=Math.floor((t-1e3*s)*gY);return new Xs(s,a)}constructor(t,s){if(this.seconds=t,this.nanoseconds=s,s<0)throw new Mt(ct.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+s);if(s>=1e9)throw new Mt(ct.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+s);if(t<mY)throw new Mt(ct.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new Mt(ct.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/gY}_compareTo(t){return this.seconds===t.seconds?wr(this.nanoseconds,t.nanoseconds):wr(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const t=this.seconds-mY;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bn{static fromTimestamp(t){return new Bn(t)}static min(){return new Bn(new Xs(0,0))}static max(){return new Bn(new Xs(253402300799,999999999))}constructor(t){this.timestamp=t}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _Y="__name__";class lh{constructor(t,s,a){s===void 0?s=0:s>t.length&&Un(),a===void 0?a=t.length-s:a>t.length-s&&Un(),this.segments=t,this.offset=s,this.len=a}get length(){return this.len}isEqual(t){return lh.comparator(this,t)===0}child(t){const s=this.segments.slice(this.offset,this.limit());return t instanceof lh?t.forEach(a=>{s.push(a)}):s.push(t),this.construct(s)}limit(){return this.offset+this.length}popFirst(t){return t=t===void 0?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return this.length===0}isPrefixOf(t){if(t.length<this.length)return!1;for(let s=0;s<this.length;s++)if(this.get(s)!==t.get(s))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let s=0;s<this.length;s++)if(this.get(s)!==t.get(s))return!1;return!0}forEach(t){for(let s=this.offset,a=this.limit();s<a;s++)t(this.segments[s])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,s){const a=Math.min(t.length,s.length);for(let l=0;l<a;l++){const d=lh.compareSegments(t.get(l),s.get(l));if(d!==0)return d}return Math.sign(t.length-s.length)}static compareSegments(t,s){const a=lh.isNumericId(t),l=lh.isNumericId(s);return a&&!l?-1:!a&&l?1:a&&l?lh.extractNumericId(t).compare(lh.extractNumericId(s)):t<s?-1:t>s?1:0}static isNumericId(t){return t.startsWith("__id")&&t.endsWith("__")}static extractNumericId(t){return Lm.fromString(t.substring(4,t.length-2))}}class bi extends lh{construct(t,s,a){return new bi(t,s,a)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){const s=[];for(const a of t){if(a.indexOf("//")>=0)throw new Mt(ct.INVALID_ARGUMENT,`Invalid segment (${a}). Paths must not contain // in them.`);s.push(...a.split("/").filter(l=>l.length>0))}return new bi(s)}static emptyPath(){return new bi([])}}const RVe=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class qo extends lh{construct(t,s,a){return new qo(t,s,a)}static isValidIdentifier(t){return RVe.test(t)}canonicalString(){return this.toArray().map(t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),qo.isValidIdentifier(t)||(t="`"+t+"`"),t)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===_Y}static keyField(){return new qo([_Y])}static fromServerFormat(t){const s=[];let a="",l=0;const d=()=>{if(a.length===0)throw new Mt(ct.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);s.push(a),a=""};let p=!1;for(;l<t.length;){const E=t[l];if(E==="\\"){if(l+1===t.length)throw new Mt(ct.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const v=t[l+1];if(v!=="\\"&&v!=="."&&v!=="`")throw new Mt(ct.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);a+=v,l+=2}else E==="`"?(p=!p,l++):E!=="."||p?(a+=E,l++):(d(),l++)}if(d(),p)throw new Mt(ct.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new qo(s)}static emptyPath(){return new qo([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class un{constructor(t){this.path=t}static fromPath(t){return new un(bi.fromString(t))}static fromName(t){return new un(bi.fromString(t).popFirst(5))}static empty(){return new un(bi.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return t!==null&&bi.comparator(this.path,t.path)===0}toString(){return this.path.toString()}static comparator(t,s){return bi.comparator(t.path,s.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new un(new bi(t.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xw=-1;function CVe(r,t){const s=r.toTimestamp().seconds,a=r.toTimestamp().nanoseconds+1,l=Bn.fromTimestamp(a===1e9?new Xs(s+1,0):new Xs(s,a));return new Bm(l,un.empty(),t)}function IVe(r){return new Bm(r.readTime,r.key,Xw)}class Bm{constructor(t,s,a){this.readTime=t,this.documentKey=s,this.largestBatchId=a}static min(){return new Bm(Bn.min(),un.empty(),Xw)}static max(){return new Bm(Bn.max(),un.empty(),Xw)}}function AVe(r,t){let s=r.readTime.compareTo(t.readTime);return s!==0?s:(s=un.comparator(r.documentKey,t.documentKey),s!==0?s:wr(r.largestBatchId,t.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OVe="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class PVe{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(t=>t())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function tT(r){if(r.code!==ct.FAILED_PRECONDITION||r.message!==OVe)throw r;Kt("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _t{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(s=>{this.isDone=!0,this.result=s,this.nextCallback&&this.nextCallback(s)},s=>{this.isDone=!0,this.error=s,this.catchCallback&&this.catchCallback(s)})}catch(t){return this.next(void 0,t)}next(t,s){return this.callbackAttached&&Un(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(s,this.error):this.wrapSuccess(t,this.result):new _t((a,l)=>{this.nextCallback=d=>{this.wrapSuccess(t,d).next(a,l)},this.catchCallback=d=>{this.wrapFailure(s,d).next(a,l)}})}toPromise(){return new Promise((t,s)=>{this.next(t,s)})}wrapUserFunction(t){try{const s=t();return s instanceof _t?s:_t.resolve(s)}catch(s){return _t.reject(s)}}wrapSuccess(t,s){return t?this.wrapUserFunction(()=>t(s)):_t.resolve(s)}wrapFailure(t,s){return t?this.wrapUserFunction(()=>t(s)):_t.reject(s)}static resolve(t){return new _t((s,a)=>{s(t)})}static reject(t){return new _t((s,a)=>{a(t)})}static waitFor(t){return new _t((s,a)=>{let l=0,d=0,p=!1;t.forEach(E=>{++l,E.next(()=>{++d,p&&d===l&&s()},v=>a(v))}),p=!0,d===l&&s()})}static or(t){let s=_t.resolve(!1);for(const a of t)s=s.next(l=>l?_t.resolve(l):a());return s}static forEach(t,s){const a=[];return t.forEach((l,d)=>{a.push(s.call(this,l,d))}),this.waitFor(a)}static mapArray(t,s){return new _t((a,l)=>{const d=t.length,p=new Array(d);let E=0;for(let v=0;v<d;v++){const b=v;s(t[b]).next(R=>{p[b]=R,++E,E===d&&a(p)},R=>l(R))}})}static doWhile(t,s){return new _t((a,l)=>{const d=()=>{t()===!0?s().next(()=>{d()},l):a()};d()})}}function NVe(r){const t=r.match(/Android ([\d.]+)/i),s=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(s)}function nT(r){return r.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ek{constructor(t,s){this.previousValue=t,s&&(s.sequenceNumberHandler=a=>this.oe(a),this._e=a=>s.writeSequenceNumber(a))}oe(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this._e&&this._e(t),t}}ek.ae=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HF=-1;function tk(r){return r==null}function nN(r){return r===0&&1/r==-1/0}function kVe(r){return typeof r=="number"&&Number.isInteger(r)&&!nN(r)&&r<=Number.MAX_SAFE_INTEGER&&r>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kne="";function DVe(r){let t="";for(let s=0;s<r.length;s++)t.length>0&&(t=EY(t)),t=LVe(r.get(s),t);return EY(t)}function LVe(r,t){let s=t;const a=r.length;for(let l=0;l<a;l++){const d=r.charAt(l);switch(d){case"\0":s+="";break;case kne:s+="";break;default:s+=d}}return s}function EY(r){return r+kne+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yY(r){let t=0;for(const s in r)Object.prototype.hasOwnProperty.call(r,s)&&t++;return t}function eg(r,t){for(const s in r)Object.prototype.hasOwnProperty.call(r,s)&&t(s,r[s])}function Dne(r){for(const t in r)if(Object.prototype.hasOwnProperty.call(r,t))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zi{constructor(t,s){this.comparator=t,this.root=s||Ho.EMPTY}insert(t,s){return new Zi(this.comparator,this.root.insert(t,s,this.comparator).copy(null,null,Ho.BLACK,null,null))}remove(t){return new Zi(this.comparator,this.root.remove(t,this.comparator).copy(null,null,Ho.BLACK,null,null))}get(t){let s=this.root;for(;!s.isEmpty();){const a=this.comparator(t,s.key);if(a===0)return s.value;a<0?s=s.left:a>0&&(s=s.right)}return null}indexOf(t){let s=0,a=this.root;for(;!a.isEmpty();){const l=this.comparator(t,a.key);if(l===0)return s+a.left.size;l<0?a=a.left:(s+=a.left.size+1,a=a.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal((s,a)=>(t(s,a),!1))}toString(){const t=[];return this.inorderTraversal((s,a)=>(t.push(`${s}:${a}`),!1)),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new GO(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new GO(this.root,t,this.comparator,!1)}getReverseIterator(){return new GO(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new GO(this.root,t,this.comparator,!0)}}class GO{constructor(t,s,a,l){this.isReverse=l,this.nodeStack=[];let d=1;for(;!t.isEmpty();)if(d=s?a(t.key,s):1,s&&l&&(d*=-1),d<0)t=this.isReverse?t.left:t.right;else{if(d===0){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const s={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return s}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class Ho{constructor(t,s,a,l,d){this.key=t,this.value=s,this.color=a??Ho.RED,this.left=l??Ho.EMPTY,this.right=d??Ho.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,s,a,l,d){return new Ho(t??this.key,s??this.value,a??this.color,l??this.left,d??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,s,a){let l=this;const d=a(t,l.key);return l=d<0?l.copy(null,null,null,l.left.insert(t,s,a),null):d===0?l.copy(null,s,null,null,null):l.copy(null,null,null,null,l.right.insert(t,s,a)),l.fixUp()}removeMin(){if(this.left.isEmpty())return Ho.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,s){let a,l=this;if(s(t,l.key)<0)l.left.isEmpty()||l.left.isRed()||l.left.left.isRed()||(l=l.moveRedLeft()),l=l.copy(null,null,null,l.left.remove(t,s),null);else{if(l.left.isRed()&&(l=l.rotateRight()),l.right.isEmpty()||l.right.isRed()||l.right.left.isRed()||(l=l.moveRedRight()),s(t,l.key)===0){if(l.right.isEmpty())return Ho.EMPTY;a=l.right.min(),l=l.copy(a.key,a.value,null,null,l.right.removeMin())}l=l.copy(null,null,null,null,l.right.remove(t,s))}return l.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,Ho.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,Ho.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),s=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,s)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw Un();const t=this.left.check();if(t!==this.right.check())throw Un();return t+(this.isRed()?0:1)}}Ho.EMPTY=null,Ho.RED=!0,Ho.BLACK=!1;Ho.EMPTY=new class{constructor(){this.size=0}get key(){throw Un()}get value(){throw Un()}get color(){throw Un()}get left(){throw Un()}get right(){throw Un()}copy(t,s,a,l,d){return this}insert(t,s,a){return new Ho(t,s)}remove(t,s){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Js{constructor(t){this.comparator=t,this.data=new Zi(this.comparator)}has(t){return this.data.get(t)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal((s,a)=>(t(s),!1))}forEachInRange(t,s){const a=this.data.getIteratorFrom(t[0]);for(;a.hasNext();){const l=a.getNext();if(this.comparator(l.key,t[1])>=0)return;s(l.key)}}forEachWhile(t,s){let a;for(a=s!==void 0?this.data.getIteratorFrom(s):this.data.getIterator();a.hasNext();)if(!t(a.getNext().key))return}firstAfterOrEqual(t){const s=this.data.getIteratorFrom(t);return s.hasNext()?s.getNext().key:null}getIterator(){return new vY(this.data.getIterator())}getIteratorFrom(t){return new vY(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let s=this;return s.size<t.size&&(s=t,t=this),t.forEach(a=>{s=s.add(a)}),s}isEqual(t){if(!(t instanceof Js)||this.size!==t.size)return!1;const s=this.data.getIterator(),a=t.data.getIterator();for(;s.hasNext();){const l=s.getNext().key,d=a.getNext().key;if(this.comparator(l,d)!==0)return!1}return!0}toArray(){const t=[];return this.forEach(s=>{t.push(s)}),t}toString(){const t=[];return this.forEach(s=>t.push(s)),"SortedSet("+t.toString()+")"}copy(t){const s=new Js(this.comparator);return s.data=t,s}}class vY{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hl{constructor(t){this.fields=t,t.sort(qo.comparator)}static empty(){return new hl([])}unionWith(t){let s=new Js(qo.comparator);for(const a of this.fields)s=s.add(a);for(const a of t)s=s.add(a);return new hl(s.toArray())}covers(t){for(const s of this.fields)if(s.isPrefixOf(t))return!0;return!1}isEqual(t){return DS(this.fields,t.fields,(s,a)=>s.isEqual(a))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lne extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $o{constructor(t){this.binaryString=t}static fromBase64String(t){const s=function(l){try{return atob(l)}catch(d){throw typeof DOMException<"u"&&d instanceof DOMException?new Lne("Invalid base64 string: "+d):d}}(t);return new $o(s)}static fromUint8Array(t){const s=function(l){let d="";for(let p=0;p<l.length;++p)d+=String.fromCharCode(l[p]);return d}(t);return new $o(s)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(s){return btoa(s)}(this.binaryString)}toUint8Array(){return function(s){const a=new Uint8Array(s.length);for(let l=0;l<s.length;l++)a[l]=s.charCodeAt(l);return a}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return wr(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}$o.EMPTY_BYTE_STRING=new $o("");const xVe=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Wm(r){if(ei(!!r),typeof r=="string"){let t=0;const s=xVe.exec(r);if(ei(!!s),s[1]){let l=s[1];l=(l+"000000000").substr(0,9),t=Number(l)}const a=new Date(r);return{seconds:Math.floor(a.getTime()/1e3),nanos:t}}return{seconds:bs(r.seconds),nanos:bs(r.nanos)}}function bs(r){return typeof r=="number"?r:typeof r=="string"?Number(r):0}function Gm(r){return typeof r=="string"?$o.fromBase64String(r):$o.fromUint8Array(r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xne="server_timestamp",Mne="__type__",Une="__previous_value__",Vne="__local_write_time__";function nk(r){var t,s;return((s=(((t=r==null?void 0:r.mapValue)===null||t===void 0?void 0:t.fields)||{})[Mne])===null||s===void 0?void 0:s.stringValue)===xne}function rk(r){const t=r.mapValue.fields[Une];return nk(t)?rk(t):t}function Jw(r){const t=Wm(r.mapValue.fields[Vne].timestampValue);return new Xs(t.seconds,t.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MVe{constructor(t,s,a,l,d,p,E,v,b){this.databaseId=t,this.appId=s,this.persistenceKey=a,this.host=l,this.ssl=d,this.forceLongPolling=p,this.autoDetectLongPolling=E,this.longPollingOptions=v,this.useFetchStreams=b}}const rN="(default)";class Qw{constructor(t,s){this.projectId=t,this.database=s||rN}static empty(){return new Qw("","")}get isDefaultDatabase(){return this.database===rN}isEqual(t){return t instanceof Qw&&t.projectId===this.projectId&&t.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fne="__type__",UVe="__max__",zO={mapValue:{}},jne="__vector__",iN="value";function zm(r){return"nullValue"in r?0:"booleanValue"in r?1:"integerValue"in r||"doubleValue"in r?2:"timestampValue"in r?3:"stringValue"in r?5:"bytesValue"in r?6:"referenceValue"in r?7:"geoPointValue"in r?8:"arrayValue"in r?9:"mapValue"in r?nk(r)?4:FVe(r)?9007199254740991:VVe(r)?10:11:Un()}function kh(r,t){if(r===t)return!0;const s=zm(r);if(s!==zm(t))return!1;switch(s){case 0:case 9007199254740991:return!0;case 1:return r.booleanValue===t.booleanValue;case 4:return Jw(r).isEqual(Jw(t));case 3:return function(l,d){if(typeof l.timestampValue=="string"&&typeof d.timestampValue=="string"&&l.timestampValue.length===d.timestampValue.length)return l.timestampValue===d.timestampValue;const p=Wm(l.timestampValue),E=Wm(d.timestampValue);return p.seconds===E.seconds&&p.nanos===E.nanos}(r,t);case 5:return r.stringValue===t.stringValue;case 6:return function(l,d){return Gm(l.bytesValue).isEqual(Gm(d.bytesValue))}(r,t);case 7:return r.referenceValue===t.referenceValue;case 8:return function(l,d){return bs(l.geoPointValue.latitude)===bs(d.geoPointValue.latitude)&&bs(l.geoPointValue.longitude)===bs(d.geoPointValue.longitude)}(r,t);case 2:return function(l,d){if("integerValue"in l&&"integerValue"in d)return bs(l.integerValue)===bs(d.integerValue);if("doubleValue"in l&&"doubleValue"in d){const p=bs(l.doubleValue),E=bs(d.doubleValue);return p===E?nN(p)===nN(E):isNaN(p)&&isNaN(E)}return!1}(r,t);case 9:return DS(r.arrayValue.values||[],t.arrayValue.values||[],kh);case 10:case 11:return function(l,d){const p=l.mapValue.fields||{},E=d.mapValue.fields||{};if(yY(p)!==yY(E))return!1;for(const v in p)if(p.hasOwnProperty(v)&&(E[v]===void 0||!kh(p[v],E[v])))return!1;return!0}(r,t);default:return Un()}}function Zw(r,t){return(r.values||[]).find(s=>kh(s,t))!==void 0}function LS(r,t){if(r===t)return 0;const s=zm(r),a=zm(t);if(s!==a)return wr(s,a);switch(s){case 0:case 9007199254740991:return 0;case 1:return wr(r.booleanValue,t.booleanValue);case 2:return function(d,p){const E=bs(d.integerValue||d.doubleValue),v=bs(p.integerValue||p.doubleValue);return E<v?-1:E>v?1:E===v?0:isNaN(E)?isNaN(v)?0:-1:1}(r,t);case 3:return SY(r.timestampValue,t.timestampValue);case 4:return SY(Jw(r),Jw(t));case 5:return wr(r.stringValue,t.stringValue);case 6:return function(d,p){const E=Gm(d),v=Gm(p);return E.compareTo(v)}(r.bytesValue,t.bytesValue);case 7:return function(d,p){const E=d.split("/"),v=p.split("/");for(let b=0;b<E.length&&b<v.length;b++){const R=wr(E[b],v[b]);if(R!==0)return R}return wr(E.length,v.length)}(r.referenceValue,t.referenceValue);case 8:return function(d,p){const E=wr(bs(d.latitude),bs(p.latitude));return E!==0?E:wr(bs(d.longitude),bs(p.longitude))}(r.geoPointValue,t.geoPointValue);case 9:return TY(r.arrayValue,t.arrayValue);case 10:return function(d,p){var E,v,b,R;const O=d.fields||{},N=p.fields||{},F=(E=O[iN])===null||E===void 0?void 0:E.arrayValue,H=(v=N[iN])===null||v===void 0?void 0:v.arrayValue,z=wr(((b=F==null?void 0:F.values)===null||b===void 0?void 0:b.length)||0,((R=H==null?void 0:H.values)===null||R===void 0?void 0:R.length)||0);return z!==0?z:TY(F,H)}(r.mapValue,t.mapValue);case 11:return function(d,p){if(d===zO.mapValue&&p===zO.mapValue)return 0;if(d===zO.mapValue)return 1;if(p===zO.mapValue)return-1;const E=d.fields||{},v=Object.keys(E),b=p.fields||{},R=Object.keys(b);v.sort(),R.sort();for(let O=0;O<v.length&&O<R.length;++O){const N=wr(v[O],R[O]);if(N!==0)return N;const F=LS(E[v[O]],b[R[O]]);if(F!==0)return F}return wr(v.length,R.length)}(r.mapValue,t.mapValue);default:throw Un()}}function SY(r,t){if(typeof r=="string"&&typeof t=="string"&&r.length===t.length)return wr(r,t);const s=Wm(r),a=Wm(t),l=wr(s.seconds,a.seconds);return l!==0?l:wr(s.nanos,a.nanos)}function TY(r,t){const s=r.values||[],a=t.values||[];for(let l=0;l<s.length&&l<a.length;++l){const d=LS(s[l],a[l]);if(d)return d}return wr(s.length,a.length)}function xS(r){return kU(r)}function kU(r){return"nullValue"in r?"null":"booleanValue"in r?""+r.booleanValue:"integerValue"in r?""+r.integerValue:"doubleValue"in r?""+r.doubleValue:"timestampValue"in r?function(s){const a=Wm(s);return`time(${a.seconds},${a.nanos})`}(r.timestampValue):"stringValue"in r?r.stringValue:"bytesValue"in r?function(s){return Gm(s).toBase64()}(r.bytesValue):"referenceValue"in r?function(s){return un.fromName(s).toString()}(r.referenceValue):"geoPointValue"in r?function(s){return`geo(${s.latitude},${s.longitude})`}(r.geoPointValue):"arrayValue"in r?function(s){let a="[",l=!0;for(const d of s.values||[])l?l=!1:a+=",",a+=kU(d);return a+"]"}(r.arrayValue):"mapValue"in r?function(s){const a=Object.keys(s.fields||{}).sort();let l="{",d=!0;for(const p of a)d?d=!1:l+=",",l+=`${p}:${kU(s.fields[p])}`;return l+"}"}(r.mapValue):Un()}function CP(r){switch(zm(r)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const t=rk(r);return t?16+CP(t):16;case 5:return 2*r.stringValue.length;case 6:return Gm(r.bytesValue).approximateByteSize();case 7:return r.referenceValue.length;case 9:return function(a){return(a.values||[]).reduce((l,d)=>l+CP(d),0)}(r.arrayValue);case 10:case 11:return function(a){let l=0;return eg(a.fields,(d,p)=>{l+=d.length+CP(p)}),l}(r.mapValue);default:throw Un()}}function sN(r,t){return{referenceValue:`projects/${r.projectId}/databases/${r.database}/documents/${t.path.canonicalString()}`}}function DU(r){return!!r&&"integerValue"in r}function KF(r){return!!r&&"arrayValue"in r}function bY(r){return!!r&&"nullValue"in r}function wY(r){return!!r&&"doubleValue"in r&&isNaN(Number(r.doubleValue))}function IP(r){return!!r&&"mapValue"in r}function VVe(r){var t,s;return((s=(((t=r==null?void 0:r.mapValue)===null||t===void 0?void 0:t.fields)||{})[Fne])===null||s===void 0?void 0:s.stringValue)===jne}function bw(r){if(r.geoPointValue)return{geoPointValue:Object.assign({},r.geoPointValue)};if(r.timestampValue&&typeof r.timestampValue=="object")return{timestampValue:Object.assign({},r.timestampValue)};if(r.mapValue){const t={mapValue:{fields:{}}};return eg(r.mapValue.fields,(s,a)=>t.mapValue.fields[s]=bw(a)),t}if(r.arrayValue){const t={arrayValue:{values:[]}};for(let s=0;s<(r.arrayValue.values||[]).length;++s)t.arrayValue.values[s]=bw(r.arrayValue.values[s]);return t}return Object.assign({},r)}function FVe(r){return(((r.mapValue||{}).fields||{}).__type__||{}).stringValue===UVe}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lc{constructor(t){this.value=t}static empty(){return new Lc({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let s=this.value;for(let a=0;a<t.length-1;++a)if(s=(s.mapValue.fields||{})[t.get(a)],!IP(s))return null;return s=(s.mapValue.fields||{})[t.lastSegment()],s||null}}set(t,s){this.getFieldsMap(t.popLast())[t.lastSegment()]=bw(s)}setAll(t){let s=qo.emptyPath(),a={},l=[];t.forEach((p,E)=>{if(!s.isImmediateParentOf(E)){const v=this.getFieldsMap(s);this.applyChanges(v,a,l),a={},l=[],s=E.popLast()}p?a[E.lastSegment()]=bw(p):l.push(E.lastSegment())});const d=this.getFieldsMap(s);this.applyChanges(d,a,l)}delete(t){const s=this.field(t.popLast());IP(s)&&s.mapValue.fields&&delete s.mapValue.fields[t.lastSegment()]}isEqual(t){return kh(this.value,t.value)}getFieldsMap(t){let s=this.value;s.mapValue.fields||(s.mapValue={fields:{}});for(let a=0;a<t.length;++a){let l=s.mapValue.fields[t.get(a)];IP(l)&&l.mapValue.fields||(l={mapValue:{fields:{}}},s.mapValue.fields[t.get(a)]=l),s=l}return s.mapValue.fields}applyChanges(t,s,a){eg(s,(l,d)=>t[l]=d);for(const l of a)delete t[l]}clone(){return new Lc(bw(this.value))}}function Bne(r){const t=[];return eg(r.fields,(s,a)=>{const l=new qo([s]);if(IP(a)){const d=Bne(a.mapValue).fields;if(d.length===0)t.push(l);else for(const p of d)t.push(l.child(p))}else t.push(l)}),new hl(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sa{constructor(t,s,a,l,d,p,E){this.key=t,this.documentType=s,this.version=a,this.readTime=l,this.createTime=d,this.data=p,this.documentState=E}static newInvalidDocument(t){return new Sa(t,0,Bn.min(),Bn.min(),Bn.min(),Lc.empty(),0)}static newFoundDocument(t,s,a,l){return new Sa(t,1,s,Bn.min(),a,l,0)}static newNoDocument(t,s){return new Sa(t,2,s,Bn.min(),Bn.min(),Lc.empty(),0)}static newUnknownDocument(t,s){return new Sa(t,3,s,Bn.min(),Bn.min(),Lc.empty(),2)}convertToFoundDocument(t,s){return!this.createTime.isEqual(Bn.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=t),this.version=t,this.documentType=1,this.data=s,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=Lc.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=Lc.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Bn.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(t){return t instanceof Sa&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new Sa(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MS{constructor(t,s){this.position=t,this.inclusive=s}}function RY(r,t,s){let a=0;for(let l=0;l<r.position.length;l++){const d=t[l],p=r.position[l];if(d.field.isKeyField()?a=un.comparator(un.fromName(p.referenceValue),s.key):a=LS(p,s.data.field(d.field)),d.dir==="desc"&&(a*=-1),a!==0)break}return a}function CY(r,t){if(r===null)return t===null;if(t===null||r.inclusive!==t.inclusive||r.position.length!==t.position.length)return!1;for(let s=0;s<r.position.length;s++)if(!kh(r.position[s],t.position[s]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eR{constructor(t,s="asc"){this.field=t,this.dir=s}}function jVe(r,t){return r.dir===t.dir&&r.field.isEqual(t.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wne{}class Ms extends Wne{constructor(t,s,a){super(),this.field=t,this.op=s,this.value=a}static create(t,s,a){return t.isKeyField()?s==="in"||s==="not-in"?this.createKeyFieldInFilter(t,s,a):new WVe(t,s,a):s==="array-contains"?new HVe(t,a):s==="in"?new KVe(t,a):s==="not-in"?new qVe(t,a):s==="array-contains-any"?new $Ve(t,a):new Ms(t,s,a)}static createKeyFieldInFilter(t,s,a){return s==="in"?new GVe(t,a):new zVe(t,a)}matches(t){const s=t.data.field(this.field);return this.op==="!="?s!==null&&this.matchesComparison(LS(s,this.value)):s!==null&&zm(this.value)===zm(s)&&this.matchesComparison(LS(s,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return t===0;case"!=":return t!==0;case">":return t>0;case">=":return t>=0;default:return Un()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class ud extends Wne{constructor(t,s){super(),this.filters=t,this.op=s,this.ce=null}static create(t,s){return new ud(t,s)}matches(t){return Gne(this)?this.filters.find(s=>!s.matches(t))===void 0:this.filters.find(s=>s.matches(t))!==void 0}getFlattenedFilters(){return this.ce!==null||(this.ce=this.filters.reduce((t,s)=>t.concat(s.getFlattenedFilters()),[])),this.ce}getFilters(){return Object.assign([],this.filters)}}function Gne(r){return r.op==="and"}function zne(r){return BVe(r)&&Gne(r)}function BVe(r){for(const t of r.filters)if(t instanceof ud)return!1;return!0}function LU(r){if(r instanceof Ms)return r.field.canonicalString()+r.op.toString()+xS(r.value);if(zne(r))return r.filters.map(t=>LU(t)).join(",");{const t=r.filters.map(s=>LU(s)).join(",");return`${r.op}(${t})`}}function Hne(r,t){return r instanceof Ms?function(a,l){return l instanceof Ms&&a.op===l.op&&a.field.isEqual(l.field)&&kh(a.value,l.value)}(r,t):r instanceof ud?function(a,l){return l instanceof ud&&a.op===l.op&&a.filters.length===l.filters.length?a.filters.reduce((d,p,E)=>d&&Hne(p,l.filters[E]),!0):!1}(r,t):void Un()}function Kne(r){return r instanceof Ms?function(s){return`${s.field.canonicalString()} ${s.op} ${xS(s.value)}`}(r):r instanceof ud?function(s){return s.op.toString()+" {"+s.getFilters().map(Kne).join(" ,")+"}"}(r):"Filter"}class WVe extends Ms{constructor(t,s,a){super(t,s,a),this.key=un.fromName(a.referenceValue)}matches(t){const s=un.comparator(t.key,this.key);return this.matchesComparison(s)}}class GVe extends Ms{constructor(t,s){super(t,"in",s),this.keys=qne("in",s)}matches(t){return this.keys.some(s=>s.isEqual(t.key))}}class zVe extends Ms{constructor(t,s){super(t,"not-in",s),this.keys=qne("not-in",s)}matches(t){return!this.keys.some(s=>s.isEqual(t.key))}}function qne(r,t){var s;return(((s=t.arrayValue)===null||s===void 0?void 0:s.values)||[]).map(a=>un.fromName(a.referenceValue))}class HVe extends Ms{constructor(t,s){super(t,"array-contains",s)}matches(t){const s=t.data.field(this.field);return KF(s)&&Zw(s.arrayValue,this.value)}}class KVe extends Ms{constructor(t,s){super(t,"in",s)}matches(t){const s=t.data.field(this.field);return s!==null&&Zw(this.value.arrayValue,s)}}class qVe extends Ms{constructor(t,s){super(t,"not-in",s)}matches(t){if(Zw(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const s=t.data.field(this.field);return s!==null&&!Zw(this.value.arrayValue,s)}}class $Ve extends Ms{constructor(t,s){super(t,"array-contains-any",s)}matches(t){const s=t.data.field(this.field);return!(!KF(s)||!s.arrayValue.values)&&s.arrayValue.values.some(a=>Zw(this.value.arrayValue,a))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YVe{constructor(t,s=null,a=[],l=[],d=null,p=null,E=null){this.path=t,this.collectionGroup=s,this.orderBy=a,this.filters=l,this.limit=d,this.startAt=p,this.endAt=E,this.le=null}}function IY(r,t=null,s=[],a=[],l=null,d=null,p=null){return new YVe(r,t,s,a,l,d,p)}function qF(r){const t=Hn(r);if(t.le===null){let s=t.path.canonicalString();t.collectionGroup!==null&&(s+="|cg:"+t.collectionGroup),s+="|f:",s+=t.filters.map(a=>LU(a)).join(","),s+="|ob:",s+=t.orderBy.map(a=>function(d){return d.field.canonicalString()+d.dir}(a)).join(","),tk(t.limit)||(s+="|l:",s+=t.limit),t.startAt&&(s+="|lb:",s+=t.startAt.inclusive?"b:":"a:",s+=t.startAt.position.map(a=>xS(a)).join(",")),t.endAt&&(s+="|ub:",s+=t.endAt.inclusive?"a:":"b:",s+=t.endAt.position.map(a=>xS(a)).join(",")),t.le=s}return t.le}function $F(r,t){if(r.limit!==t.limit||r.orderBy.length!==t.orderBy.length)return!1;for(let s=0;s<r.orderBy.length;s++)if(!jVe(r.orderBy[s],t.orderBy[s]))return!1;if(r.filters.length!==t.filters.length)return!1;for(let s=0;s<r.filters.length;s++)if(!Hne(r.filters[s],t.filters[s]))return!1;return r.collectionGroup===t.collectionGroup&&!!r.path.isEqual(t.path)&&!!CY(r.startAt,t.startAt)&&CY(r.endAt,t.endAt)}function xU(r){return un.isDocumentKey(r.path)&&r.collectionGroup===null&&r.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dE{constructor(t,s=null,a=[],l=[],d=null,p="F",E=null,v=null){this.path=t,this.collectionGroup=s,this.explicitOrderBy=a,this.filters=l,this.limit=d,this.limitType=p,this.startAt=E,this.endAt=v,this.he=null,this.Pe=null,this.Te=null,this.startAt,this.endAt}}function XVe(r,t,s,a,l,d,p,E){return new dE(r,t,s,a,l,d,p,E)}function ik(r){return new dE(r)}function AY(r){return r.filters.length===0&&r.limit===null&&r.startAt==null&&r.endAt==null&&(r.explicitOrderBy.length===0||r.explicitOrderBy.length===1&&r.explicitOrderBy[0].field.isKeyField())}function YF(r){return r.collectionGroup!==null}function _S(r){const t=Hn(r);if(t.he===null){t.he=[];const s=new Set;for(const d of t.explicitOrderBy)t.he.push(d),s.add(d.field.canonicalString());const a=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(p){let E=new Js(qo.comparator);return p.filters.forEach(v=>{v.getFlattenedFilters().forEach(b=>{b.isInequality()&&(E=E.add(b.field))})}),E})(t).forEach(d=>{s.has(d.canonicalString())||d.isKeyField()||t.he.push(new eR(d,a))}),s.has(qo.keyField().canonicalString())||t.he.push(new eR(qo.keyField(),a))}return t.he}function Ch(r){const t=Hn(r);return t.Pe||(t.Pe=JVe(t,_S(r))),t.Pe}function JVe(r,t){if(r.limitType==="F")return IY(r.path,r.collectionGroup,t,r.filters,r.limit,r.startAt,r.endAt);{t=t.map(l=>{const d=l.dir==="desc"?"asc":"desc";return new eR(l.field,d)});const s=r.endAt?new MS(r.endAt.position,r.endAt.inclusive):null,a=r.startAt?new MS(r.startAt.position,r.startAt.inclusive):null;return IY(r.path,r.collectionGroup,t,r.filters,r.limit,s,a)}}function MU(r,t){const s=r.filters.concat([t]);return new dE(r.path,r.collectionGroup,r.explicitOrderBy.slice(),s,r.limit,r.limitType,r.startAt,r.endAt)}function UU(r,t,s){return new dE(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),t,s,r.startAt,r.endAt)}function sk(r,t){return $F(Ch(r),Ch(t))&&r.limitType===t.limitType}function $ne(r){return`${qF(Ch(r))}|lt:${r.limitType}`}function jv(r){return`Query(target=${function(s){let a=s.path.canonicalString();return s.collectionGroup!==null&&(a+=" collectionGroup="+s.collectionGroup),s.filters.length>0&&(a+=`, filters: [${s.filters.map(l=>Kne(l)).join(", ")}]`),tk(s.limit)||(a+=", limit: "+s.limit),s.orderBy.length>0&&(a+=`, orderBy: [${s.orderBy.map(l=>function(p){return`${p.field.canonicalString()} (${p.dir})`}(l)).join(", ")}]`),s.startAt&&(a+=", startAt: ",a+=s.startAt.inclusive?"b:":"a:",a+=s.startAt.position.map(l=>xS(l)).join(",")),s.endAt&&(a+=", endAt: ",a+=s.endAt.inclusive?"a:":"b:",a+=s.endAt.position.map(l=>xS(l)).join(",")),`Target(${a})`}(Ch(r))}; limitType=${r.limitType})`}function ok(r,t){return t.isFoundDocument()&&function(a,l){const d=l.key.path;return a.collectionGroup!==null?l.key.hasCollectionId(a.collectionGroup)&&a.path.isPrefixOf(d):un.isDocumentKey(a.path)?a.path.isEqual(d):a.path.isImmediateParentOf(d)}(r,t)&&function(a,l){for(const d of _S(a))if(!d.field.isKeyField()&&l.data.field(d.field)===null)return!1;return!0}(r,t)&&function(a,l){for(const d of a.filters)if(!d.matches(l))return!1;return!0}(r,t)&&function(a,l){return!(a.startAt&&!function(p,E,v){const b=RY(p,E,v);return p.inclusive?b<=0:b<0}(a.startAt,_S(a),l)||a.endAt&&!function(p,E,v){const b=RY(p,E,v);return p.inclusive?b>=0:b>0}(a.endAt,_S(a),l))}(r,t)}function QVe(r){return r.collectionGroup||(r.path.length%2==1?r.path.lastSegment():r.path.get(r.path.length-2))}function Yne(r){return(t,s)=>{let a=!1;for(const l of _S(r)){const d=ZVe(l,t,s);if(d!==0)return d;a=a||l.field.isKeyField()}return 0}}function ZVe(r,t,s){const a=r.field.isKeyField()?un.comparator(t.key,s.key):function(d,p,E){const v=p.data.field(d),b=E.data.field(d);return v!==null&&b!==null?LS(v,b):Un()}(r.field,t,s);switch(r.dir){case"asc":return a;case"desc":return-1*a;default:return Un()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hE{constructor(t,s){this.mapKeyFn=t,this.equalsFn=s,this.inner={},this.innerSize=0}get(t){const s=this.mapKeyFn(t),a=this.inner[s];if(a!==void 0){for(const[l,d]of a)if(this.equalsFn(l,t))return d}}has(t){return this.get(t)!==void 0}set(t,s){const a=this.mapKeyFn(t),l=this.inner[a];if(l===void 0)return this.inner[a]=[[t,s]],void this.innerSize++;for(let d=0;d<l.length;d++)if(this.equalsFn(l[d][0],t))return void(l[d]=[t,s]);l.push([t,s]),this.innerSize++}delete(t){const s=this.mapKeyFn(t),a=this.inner[s];if(a===void 0)return!1;for(let l=0;l<a.length;l++)if(this.equalsFn(a[l][0],t))return a.length===1?delete this.inner[s]:a.splice(l,1),this.innerSize--,!0;return!1}forEach(t){eg(this.inner,(s,a)=>{for(const[l,d]of a)t(l,d)})}isEmpty(){return Dne(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eFe=new Zi(un.comparator);function ap(){return eFe}const Xne=new Zi(un.comparator);function iw(...r){let t=Xne;for(const s of r)t=t.insert(s.key,s);return t}function Jne(r){let t=Xne;return r.forEach((s,a)=>t=t.insert(s,a.overlayedDocument)),t}function M_(){return ww()}function Qne(){return ww()}function ww(){return new hE(r=>r.toString(),(r,t)=>r.isEqual(t))}const tFe=new Zi(un.comparator),nFe=new Js(un.comparator);function Er(...r){let t=nFe;for(const s of r)t=t.add(s);return t}const rFe=new Js(wr);function iFe(){return rFe}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function XF(r,t){if(r.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:nN(t)?"-0":t}}function Zne(r){return{integerValue:""+r}}function sFe(r,t){return kVe(t)?Zne(t):XF(r,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ak{constructor(){this._=void 0}}function oFe(r,t,s){return r instanceof oN?function(l,d){const p={fields:{[Mne]:{stringValue:xne},[Vne]:{timestampValue:{seconds:l.seconds,nanos:l.nanoseconds}}}};return d&&nk(d)&&(d=rk(d)),d&&(p.fields[Une]=d),{mapValue:p}}(s,t):r instanceof tR?tre(r,t):r instanceof nR?nre(r,t):function(l,d){const p=ere(l,d),E=OY(p)+OY(l.Ie);return DU(p)&&DU(l.Ie)?Zne(E):XF(l.serializer,E)}(r,t)}function aFe(r,t,s){return r instanceof tR?tre(r,t):r instanceof nR?nre(r,t):s}function ere(r,t){return r instanceof aN?function(a){return DU(a)||function(d){return!!d&&"doubleValue"in d}(a)}(t)?t:{integerValue:0}:null}class oN extends ak{}class tR extends ak{constructor(t){super(),this.elements=t}}function tre(r,t){const s=rre(t);for(const a of r.elements)s.some(l=>kh(l,a))||s.push(a);return{arrayValue:{values:s}}}class nR extends ak{constructor(t){super(),this.elements=t}}function nre(r,t){let s=rre(t);for(const a of r.elements)s=s.filter(l=>!kh(l,a));return{arrayValue:{values:s}}}class aN extends ak{constructor(t,s){super(),this.serializer=t,this.Ie=s}}function OY(r){return bs(r.integerValue||r.doubleValue)}function rre(r){return KF(r)&&r.arrayValue.values?r.arrayValue.values.slice():[]}function cFe(r,t){return r.field.isEqual(t.field)&&function(a,l){return a instanceof tR&&l instanceof tR||a instanceof nR&&l instanceof nR?DS(a.elements,l.elements,kh):a instanceof aN&&l instanceof aN?kh(a.Ie,l.Ie):a instanceof oN&&l instanceof oN}(r.transform,t.transform)}class lFe{constructor(t,s){this.version=t,this.transformResults=s}}class Ih{constructor(t,s){this.updateTime=t,this.exists=s}static none(){return new Ih}static exists(t){return new Ih(void 0,t)}static updateTime(t){return new Ih(t)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function AP(r,t){return r.updateTime!==void 0?t.isFoundDocument()&&t.version.isEqual(r.updateTime):r.exists===void 0||r.exists===t.isFoundDocument()}class ck{}function ire(r,t){if(!r.hasLocalMutations||t&&t.fields.length===0)return null;if(t===null)return r.isNoDocument()?new ore(r.key,Ih.none()):new AR(r.key,r.data,Ih.none());{const s=r.data,a=Lc.empty();let l=new Js(qo.comparator);for(let d of t.fields)if(!l.has(d)){let p=s.field(d);p===null&&d.length>1&&(d=d.popLast(),p=s.field(d)),p===null?a.delete(d):a.set(d,p),l=l.add(d)}return new tg(r.key,a,new hl(l.toArray()),Ih.none())}}function uFe(r,t,s){r instanceof AR?function(l,d,p){const E=l.value.clone(),v=NY(l.fieldTransforms,d,p.transformResults);E.setAll(v),d.convertToFoundDocument(p.version,E).setHasCommittedMutations()}(r,t,s):r instanceof tg?function(l,d,p){if(!AP(l.precondition,d))return void d.convertToUnknownDocument(p.version);const E=NY(l.fieldTransforms,d,p.transformResults),v=d.data;v.setAll(sre(l)),v.setAll(E),d.convertToFoundDocument(p.version,v).setHasCommittedMutations()}(r,t,s):function(l,d,p){d.convertToNoDocument(p.version).setHasCommittedMutations()}(0,t,s)}function Rw(r,t,s,a){return r instanceof AR?function(d,p,E,v){if(!AP(d.precondition,p))return E;const b=d.value.clone(),R=kY(d.fieldTransforms,v,p);return b.setAll(R),p.convertToFoundDocument(p.version,b).setHasLocalMutations(),null}(r,t,s,a):r instanceof tg?function(d,p,E,v){if(!AP(d.precondition,p))return E;const b=kY(d.fieldTransforms,v,p),R=p.data;return R.setAll(sre(d)),R.setAll(b),p.convertToFoundDocument(p.version,R).setHasLocalMutations(),E===null?null:E.unionWith(d.fieldMask.fields).unionWith(d.fieldTransforms.map(O=>O.field))}(r,t,s,a):function(d,p,E){return AP(d.precondition,p)?(p.convertToNoDocument(p.version).setHasLocalMutations(),null):E}(r,t,s)}function dFe(r,t){let s=null;for(const a of r.fieldTransforms){const l=t.data.field(a.field),d=ere(a.transform,l||null);d!=null&&(s===null&&(s=Lc.empty()),s.set(a.field,d))}return s||null}function PY(r,t){return r.type===t.type&&!!r.key.isEqual(t.key)&&!!r.precondition.isEqual(t.precondition)&&!!function(a,l){return a===void 0&&l===void 0||!(!a||!l)&&DS(a,l,(d,p)=>cFe(d,p))}(r.fieldTransforms,t.fieldTransforms)&&(r.type===0?r.value.isEqual(t.value):r.type!==1||r.data.isEqual(t.data)&&r.fieldMask.isEqual(t.fieldMask))}class AR extends ck{constructor(t,s,a,l=[]){super(),this.key=t,this.value=s,this.precondition=a,this.fieldTransforms=l,this.type=0}getFieldMask(){return null}}class tg extends ck{constructor(t,s,a,l,d=[]){super(),this.key=t,this.data=s,this.fieldMask=a,this.precondition=l,this.fieldTransforms=d,this.type=1}getFieldMask(){return this.fieldMask}}function sre(r){const t=new Map;return r.fieldMask.fields.forEach(s=>{if(!s.isEmpty()){const a=r.data.field(s);t.set(s,a)}}),t}function NY(r,t,s){const a=new Map;ei(r.length===s.length);for(let l=0;l<s.length;l++){const d=r[l],p=d.transform,E=t.data.field(d.field);a.set(d.field,aFe(p,E,s[l]))}return a}function kY(r,t,s){const a=new Map;for(const l of r){const d=l.transform,p=s.data.field(l.field);a.set(l.field,oFe(d,p,t))}return a}class ore extends ck{constructor(t,s){super(),this.key=t,this.precondition=s,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class hFe extends ck{constructor(t,s){super(),this.key=t,this.precondition=s,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fFe{constructor(t,s,a,l){this.batchId=t,this.localWriteTime=s,this.baseMutations=a,this.mutations=l}applyToRemoteDocument(t,s){const a=s.mutationResults;for(let l=0;l<this.mutations.length;l++){const d=this.mutations[l];d.key.isEqual(t.key)&&uFe(d,t,a[l])}}applyToLocalView(t,s){for(const a of this.baseMutations)a.key.isEqual(t.key)&&(s=Rw(a,t,s,this.localWriteTime));for(const a of this.mutations)a.key.isEqual(t.key)&&(s=Rw(a,t,s,this.localWriteTime));return s}applyToLocalDocumentSet(t,s){const a=Qne();return this.mutations.forEach(l=>{const d=t.get(l.key),p=d.overlayedDocument;let E=this.applyToLocalView(p,d.mutatedFields);E=s.has(l.key)?null:E;const v=ire(p,E);v!==null&&a.set(l.key,v),p.isValidDocument()||p.convertToNoDocument(Bn.min())}),a}keys(){return this.mutations.reduce((t,s)=>t.add(s.key),Er())}isEqual(t){return this.batchId===t.batchId&&DS(this.mutations,t.mutations,(s,a)=>PY(s,a))&&DS(this.baseMutations,t.baseMutations,(s,a)=>PY(s,a))}}class JF{constructor(t,s,a,l){this.batch=t,this.commitVersion=s,this.mutationResults=a,this.docVersions=l}static from(t,s,a){ei(t.mutations.length===a.length);let l=function(){return tFe}();const d=t.mutations;for(let p=0;p<d.length;p++)l=l.insert(d[p].key,a[p].version);return new JF(t,s,a,l)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pFe{constructor(t,s){this.largestBatchId=t,this.mutation=s}getKey(){return this.mutation.key}isEqual(t){return t!==null&&this.mutation===t.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mFe{constructor(t,s){this.count=t,this.unchangedNames=s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ks,Ir;function gFe(r){switch(r){case ct.OK:return Un();case ct.CANCELLED:case ct.UNKNOWN:case ct.DEADLINE_EXCEEDED:case ct.RESOURCE_EXHAUSTED:case ct.INTERNAL:case ct.UNAVAILABLE:case ct.UNAUTHENTICATED:return!1;case ct.INVALID_ARGUMENT:case ct.NOT_FOUND:case ct.ALREADY_EXISTS:case ct.PERMISSION_DENIED:case ct.FAILED_PRECONDITION:case ct.ABORTED:case ct.OUT_OF_RANGE:case ct.UNIMPLEMENTED:case ct.DATA_LOSS:return!0;default:return Un()}}function are(r){if(r===void 0)return op("GRPC error has no .code"),ct.UNKNOWN;switch(r){case ks.OK:return ct.OK;case ks.CANCELLED:return ct.CANCELLED;case ks.UNKNOWN:return ct.UNKNOWN;case ks.DEADLINE_EXCEEDED:return ct.DEADLINE_EXCEEDED;case ks.RESOURCE_EXHAUSTED:return ct.RESOURCE_EXHAUSTED;case ks.INTERNAL:return ct.INTERNAL;case ks.UNAVAILABLE:return ct.UNAVAILABLE;case ks.UNAUTHENTICATED:return ct.UNAUTHENTICATED;case ks.INVALID_ARGUMENT:return ct.INVALID_ARGUMENT;case ks.NOT_FOUND:return ct.NOT_FOUND;case ks.ALREADY_EXISTS:return ct.ALREADY_EXISTS;case ks.PERMISSION_DENIED:return ct.PERMISSION_DENIED;case ks.FAILED_PRECONDITION:return ct.FAILED_PRECONDITION;case ks.ABORTED:return ct.ABORTED;case ks.OUT_OF_RANGE:return ct.OUT_OF_RANGE;case ks.UNIMPLEMENTED:return ct.UNIMPLEMENTED;case ks.DATA_LOSS:return ct.DATA_LOSS;default:return Un()}}(Ir=ks||(ks={}))[Ir.OK=0]="OK",Ir[Ir.CANCELLED=1]="CANCELLED",Ir[Ir.UNKNOWN=2]="UNKNOWN",Ir[Ir.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Ir[Ir.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Ir[Ir.NOT_FOUND=5]="NOT_FOUND",Ir[Ir.ALREADY_EXISTS=6]="ALREADY_EXISTS",Ir[Ir.PERMISSION_DENIED=7]="PERMISSION_DENIED",Ir[Ir.UNAUTHENTICATED=16]="UNAUTHENTICATED",Ir[Ir.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Ir[Ir.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Ir[Ir.ABORTED=10]="ABORTED",Ir[Ir.OUT_OF_RANGE=11]="OUT_OF_RANGE",Ir[Ir.UNIMPLEMENTED=12]="UNIMPLEMENTED",Ir[Ir.INTERNAL=13]="INTERNAL",Ir[Ir.UNAVAILABLE=14]="UNAVAILABLE",Ir[Ir.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _Fe(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const EFe=new Lm([4294967295,4294967295],0);function DY(r){const t=_Fe().encode(r),s=new wne;return s.update(t),new Uint8Array(s.digest())}function LY(r){const t=new DataView(r.buffer),s=t.getUint32(0,!0),a=t.getUint32(4,!0),l=t.getUint32(8,!0),d=t.getUint32(12,!0);return[new Lm([s,a],0),new Lm([l,d],0)]}class QF{constructor(t,s,a){if(this.bitmap=t,this.padding=s,this.hashCount=a,s<0||s>=8)throw new sw(`Invalid padding: ${s}`);if(a<0)throw new sw(`Invalid hash count: ${a}`);if(t.length>0&&this.hashCount===0)throw new sw(`Invalid hash count: ${a}`);if(t.length===0&&s!==0)throw new sw(`Invalid padding when bitmap length is 0: ${s}`);this.Ee=8*t.length-s,this.de=Lm.fromNumber(this.Ee)}Ae(t,s,a){let l=t.add(s.multiply(Lm.fromNumber(a)));return l.compare(EFe)===1&&(l=new Lm([l.getBits(0),l.getBits(1)],0)),l.modulo(this.de).toNumber()}Re(t){return!!(this.bitmap[Math.floor(t/8)]&1<<t%8)}mightContain(t){if(this.Ee===0)return!1;const s=DY(t),[a,l]=LY(s);for(let d=0;d<this.hashCount;d++){const p=this.Ae(a,l,d);if(!this.Re(p))return!1}return!0}static create(t,s,a){const l=t%8==0?0:8-t%8,d=new Uint8Array(Math.ceil(t/8)),p=new QF(d,l,s);return a.forEach(E=>p.insert(E)),p}insert(t){if(this.Ee===0)return;const s=DY(t),[a,l]=LY(s);for(let d=0;d<this.hashCount;d++){const p=this.Ae(a,l,d);this.Ve(p)}}Ve(t){const s=Math.floor(t/8),a=t%8;this.bitmap[s]|=1<<a}}class sw extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lk{constructor(t,s,a,l,d){this.snapshotVersion=t,this.targetChanges=s,this.targetMismatches=a,this.documentUpdates=l,this.resolvedLimboDocuments=d}static createSynthesizedRemoteEventForCurrentChange(t,s,a){const l=new Map;return l.set(t,OR.createSynthesizedTargetChangeForCurrentChange(t,s,a)),new lk(Bn.min(),l,new Zi(wr),ap(),Er())}}class OR{constructor(t,s,a,l,d){this.resumeToken=t,this.current=s,this.addedDocuments=a,this.modifiedDocuments=l,this.removedDocuments=d}static createSynthesizedTargetChangeForCurrentChange(t,s,a){return new OR(a,s,Er(),Er(),Er())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OP{constructor(t,s,a,l){this.me=t,this.removedTargetIds=s,this.key=a,this.fe=l}}class cre{constructor(t,s){this.targetId=t,this.ge=s}}class lre{constructor(t,s,a=$o.EMPTY_BYTE_STRING,l=null){this.state=t,this.targetIds=s,this.resumeToken=a,this.cause=l}}class xY{constructor(){this.pe=0,this.ye=MY(),this.we=$o.EMPTY_BYTE_STRING,this.be=!1,this.Se=!0}get current(){return this.be}get resumeToken(){return this.we}get De(){return this.pe!==0}get ve(){return this.Se}Ce(t){t.approximateByteSize()>0&&(this.Se=!0,this.we=t)}Fe(){let t=Er(),s=Er(),a=Er();return this.ye.forEach((l,d)=>{switch(d){case 0:t=t.add(l);break;case 2:s=s.add(l);break;case 1:a=a.add(l);break;default:Un()}}),new OR(this.we,this.be,t,s,a)}Me(){this.Se=!1,this.ye=MY()}xe(t,s){this.Se=!0,this.ye=this.ye.insert(t,s)}Oe(t){this.Se=!0,this.ye=this.ye.remove(t)}Ne(){this.pe+=1}Be(){this.pe-=1,ei(this.pe>=0)}Le(){this.Se=!0,this.be=!0}}class yFe{constructor(t){this.ke=t,this.qe=new Map,this.Qe=ap(),this.$e=HO(),this.Ke=HO(),this.Ue=new Zi(wr)}We(t){for(const s of t.me)t.fe&&t.fe.isFoundDocument()?this.Ge(s,t.fe):this.ze(s,t.key,t.fe);for(const s of t.removedTargetIds)this.ze(s,t.key,t.fe)}je(t){this.forEachTarget(t,s=>{const a=this.He(s);switch(t.state){case 0:this.Je(s)&&a.Ce(t.resumeToken);break;case 1:a.Be(),a.De||a.Me(),a.Ce(t.resumeToken);break;case 2:a.Be(),a.De||this.removeTarget(s);break;case 3:this.Je(s)&&(a.Le(),a.Ce(t.resumeToken));break;case 4:this.Je(s)&&(this.Ye(s),a.Ce(t.resumeToken));break;default:Un()}})}forEachTarget(t,s){t.targetIds.length>0?t.targetIds.forEach(s):this.qe.forEach((a,l)=>{this.Je(l)&&s(l)})}Ze(t){const s=t.targetId,a=t.ge.count,l=this.Xe(s);if(l){const d=l.target;if(xU(d))if(a===0){const p=new un(d.path);this.ze(s,p,Sa.newNoDocument(p,Bn.min()))}else ei(a===1);else{const p=this.et(s);if(p!==a){const E=this.tt(t),v=E?this.nt(E,t,p):1;if(v!==0){this.Ye(s);const b=v===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ue=this.Ue.insert(s,b)}}}}}tt(t){const s=t.ge.unchangedNames;if(!s||!s.bits)return null;const{bits:{bitmap:a="",padding:l=0},hashCount:d=0}=s;let p,E;try{p=Gm(a).toUint8Array()}catch(v){if(v instanceof Lne)return kS("Decoding the base64 bloom filter in existence filter failed ("+v.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw v}try{E=new QF(p,l,d)}catch(v){return kS(v instanceof sw?"BloomFilter error: ":"Applying bloom filter failed: ",v),null}return E.Ee===0?null:E}nt(t,s,a){return s.ge.count===a-this.st(t,s.targetId)?0:2}st(t,s){const a=this.ke.getRemoteKeysForTarget(s);let l=0;return a.forEach(d=>{const p=this.ke.it(),E=`projects/${p.projectId}/databases/${p.database}/documents/${d.path.canonicalString()}`;t.mightContain(E)||(this.ze(s,d,null),l++)}),l}ot(t){const s=new Map;this.qe.forEach((d,p)=>{const E=this.Xe(p);if(E){if(d.current&&xU(E.target)){const v=new un(E.target.path);this._t(v).has(p)||this.ut(p,v)||this.ze(p,v,Sa.newNoDocument(v,t))}d.ve&&(s.set(p,d.Fe()),d.Me())}});let a=Er();this.Ke.forEach((d,p)=>{let E=!0;p.forEachWhile(v=>{const b=this.Xe(v);return!b||b.purpose==="TargetPurposeLimboResolution"||(E=!1,!1)}),E&&(a=a.add(d))}),this.Qe.forEach((d,p)=>p.setReadTime(t));const l=new lk(t,s,this.Ue,this.Qe,a);return this.Qe=ap(),this.$e=HO(),this.Ke=HO(),this.Ue=new Zi(wr),l}Ge(t,s){if(!this.Je(t))return;const a=this.ut(t,s.key)?2:0;this.He(t).xe(s.key,a),this.Qe=this.Qe.insert(s.key,s),this.$e=this.$e.insert(s.key,this._t(s.key).add(t)),this.Ke=this.Ke.insert(s.key,this.ct(s.key).add(t))}ze(t,s,a){if(!this.Je(t))return;const l=this.He(t);this.ut(t,s)?l.xe(s,1):l.Oe(s),this.Ke=this.Ke.insert(s,this.ct(s).delete(t)),this.Ke=this.Ke.insert(s,this.ct(s).add(t)),a&&(this.Qe=this.Qe.insert(s,a))}removeTarget(t){this.qe.delete(t)}et(t){const s=this.He(t).Fe();return this.ke.getRemoteKeysForTarget(t).size+s.addedDocuments.size-s.removedDocuments.size}Ne(t){this.He(t).Ne()}He(t){let s=this.qe.get(t);return s||(s=new xY,this.qe.set(t,s)),s}ct(t){let s=this.Ke.get(t);return s||(s=new Js(wr),this.Ke=this.Ke.insert(t,s)),s}_t(t){let s=this.$e.get(t);return s||(s=new Js(wr),this.$e=this.$e.insert(t,s)),s}Je(t){const s=this.Xe(t)!==null;return s||Kt("WatchChangeAggregator","Detected inactive target",t),s}Xe(t){const s=this.qe.get(t);return s&&s.De?null:this.ke.lt(t)}Ye(t){this.qe.set(t,new xY),this.ke.getRemoteKeysForTarget(t).forEach(s=>{this.ze(t,s,null)})}ut(t,s){return this.ke.getRemoteKeysForTarget(t).has(s)}}function HO(){return new Zi(un.comparator)}function MY(){return new Zi(un.comparator)}const vFe={asc:"ASCENDING",desc:"DESCENDING"},SFe={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},TFe={and:"AND",or:"OR"};class bFe{constructor(t,s){this.databaseId=t,this.useProto3Json=s}}function VU(r,t){return r.useProto3Json||tk(t)?t:{value:t}}function cN(r,t){return r.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function ure(r,t){return r.useProto3Json?t.toBase64():t.toUint8Array()}function wFe(r,t){return cN(r,t.toTimestamp())}function Ah(r){return ei(!!r),Bn.fromTimestamp(function(s){const a=Wm(s);return new Xs(a.seconds,a.nanos)}(r))}function ZF(r,t){return FU(r,t).canonicalString()}function FU(r,t){const s=function(l){return new bi(["projects",l.projectId,"databases",l.database])}(r).child("documents");return t===void 0?s:s.child(t)}function dre(r){const t=bi.fromString(r);return ei(gre(t)),t}function jU(r,t){return ZF(r.databaseId,t.path)}function l2(r,t){const s=dre(t);if(s.get(1)!==r.databaseId.projectId)throw new Mt(ct.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+s.get(1)+" vs "+r.databaseId.projectId);if(s.get(3)!==r.databaseId.database)throw new Mt(ct.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+s.get(3)+" vs "+r.databaseId.database);return new un(fre(s))}function hre(r,t){return ZF(r.databaseId,t)}function RFe(r){const t=dre(r);return t.length===4?bi.emptyPath():fre(t)}function BU(r){return new bi(["projects",r.databaseId.projectId,"databases",r.databaseId.database]).canonicalString()}function fre(r){return ei(r.length>4&&r.get(4)==="documents"),r.popFirst(5)}function UY(r,t,s){return{name:jU(r,t),fields:s.value.mapValue.fields}}function CFe(r,t){let s;if("targetChange"in t){t.targetChange;const a=function(b){return b==="NO_CHANGE"?0:b==="ADD"?1:b==="REMOVE"?2:b==="CURRENT"?3:b==="RESET"?4:Un()}(t.targetChange.targetChangeType||"NO_CHANGE"),l=t.targetChange.targetIds||[],d=function(b,R){return b.useProto3Json?(ei(R===void 0||typeof R=="string"),$o.fromBase64String(R||"")):(ei(R===void 0||R instanceof Buffer||R instanceof Uint8Array),$o.fromUint8Array(R||new Uint8Array))}(r,t.targetChange.resumeToken),p=t.targetChange.cause,E=p&&function(b){const R=b.code===void 0?ct.UNKNOWN:are(b.code);return new Mt(R,b.message||"")}(p);s=new lre(a,l,d,E||null)}else if("documentChange"in t){t.documentChange;const a=t.documentChange;a.document,a.document.name,a.document.updateTime;const l=l2(r,a.document.name),d=Ah(a.document.updateTime),p=a.document.createTime?Ah(a.document.createTime):Bn.min(),E=new Lc({mapValue:{fields:a.document.fields}}),v=Sa.newFoundDocument(l,d,p,E),b=a.targetIds||[],R=a.removedTargetIds||[];s=new OP(b,R,v.key,v)}else if("documentDelete"in t){t.documentDelete;const a=t.documentDelete;a.document;const l=l2(r,a.document),d=a.readTime?Ah(a.readTime):Bn.min(),p=Sa.newNoDocument(l,d),E=a.removedTargetIds||[];s=new OP([],E,p.key,p)}else if("documentRemove"in t){t.documentRemove;const a=t.documentRemove;a.document;const l=l2(r,a.document),d=a.removedTargetIds||[];s=new OP([],d,l,null)}else{if(!("filter"in t))return Un();{t.filter;const a=t.filter;a.targetId;const{count:l=0,unchangedNames:d}=a,p=new mFe(l,d),E=a.targetId;s=new cre(E,p)}}return s}function IFe(r,t){let s;if(t instanceof AR)s={update:UY(r,t.key,t.value)};else if(t instanceof ore)s={delete:jU(r,t.key)};else if(t instanceof tg)s={update:UY(r,t.key,t.data),updateMask:MFe(t.fieldMask)};else{if(!(t instanceof hFe))return Un();s={verify:jU(r,t.key)}}return t.fieldTransforms.length>0&&(s.updateTransforms=t.fieldTransforms.map(a=>function(d,p){const E=p.transform;if(E instanceof oN)return{fieldPath:p.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(E instanceof tR)return{fieldPath:p.field.canonicalString(),appendMissingElements:{values:E.elements}};if(E instanceof nR)return{fieldPath:p.field.canonicalString(),removeAllFromArray:{values:E.elements}};if(E instanceof aN)return{fieldPath:p.field.canonicalString(),increment:E.Ie};throw Un()}(0,a))),t.precondition.isNone||(s.currentDocument=function(l,d){return d.updateTime!==void 0?{updateTime:wFe(l,d.updateTime)}:d.exists!==void 0?{exists:d.exists}:Un()}(r,t.precondition)),s}function AFe(r,t){return r&&r.length>0?(ei(t!==void 0),r.map(s=>function(l,d){let p=l.updateTime?Ah(l.updateTime):Ah(d);return p.isEqual(Bn.min())&&(p=Ah(d)),new lFe(p,l.transformResults||[])}(s,t))):[]}function OFe(r,t){return{documents:[hre(r,t.path)]}}function PFe(r,t){const s={structuredQuery:{}},a=t.path;let l;t.collectionGroup!==null?(l=a,s.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(l=a.popLast(),s.structuredQuery.from=[{collectionId:a.lastSegment()}]),s.parent=hre(r,l);const d=function(b){if(b.length!==0)return mre(ud.create(b,"and"))}(t.filters);d&&(s.structuredQuery.where=d);const p=function(b){if(b.length!==0)return b.map(R=>function(N){return{field:Bv(N.field),direction:DFe(N.dir)}}(R))}(t.orderBy);p&&(s.structuredQuery.orderBy=p);const E=VU(r,t.limit);return E!==null&&(s.structuredQuery.limit=E),t.startAt&&(s.structuredQuery.startAt=function(b){return{before:b.inclusive,values:b.position}}(t.startAt)),t.endAt&&(s.structuredQuery.endAt=function(b){return{before:!b.inclusive,values:b.position}}(t.endAt)),{ht:s,parent:l}}function NFe(r){let t=RFe(r.parent);const s=r.structuredQuery,a=s.from?s.from.length:0;let l=null;if(a>0){ei(a===1);const R=s.from[0];R.allDescendants?l=R.collectionId:t=t.child(R.collectionId)}let d=[];s.where&&(d=function(O){const N=pre(O);return N instanceof ud&&zne(N)?N.getFilters():[N]}(s.where));let p=[];s.orderBy&&(p=function(O){return O.map(N=>function(H){return new eR(Wv(H.field),function(G){switch(G){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(H.direction))}(N))}(s.orderBy));let E=null;s.limit&&(E=function(O){let N;return N=typeof O=="object"?O.value:O,tk(N)?null:N}(s.limit));let v=null;s.startAt&&(v=function(O){const N=!!O.before,F=O.values||[];return new MS(F,N)}(s.startAt));let b=null;return s.endAt&&(b=function(O){const N=!O.before,F=O.values||[];return new MS(F,N)}(s.endAt)),XVe(t,l,p,d,E,"F",v,b)}function kFe(r,t){const s=function(l){switch(l){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Un()}}(t.purpose);return s==null?null:{"goog-listen-tags":s}}function pre(r){return r.unaryFilter!==void 0?function(s){switch(s.unaryFilter.op){case"IS_NAN":const a=Wv(s.unaryFilter.field);return Ms.create(a,"==",{doubleValue:NaN});case"IS_NULL":const l=Wv(s.unaryFilter.field);return Ms.create(l,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const d=Wv(s.unaryFilter.field);return Ms.create(d,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const p=Wv(s.unaryFilter.field);return Ms.create(p,"!=",{nullValue:"NULL_VALUE"});default:return Un()}}(r):r.fieldFilter!==void 0?function(s){return Ms.create(Wv(s.fieldFilter.field),function(l){switch(l){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Un()}}(s.fieldFilter.op),s.fieldFilter.value)}(r):r.compositeFilter!==void 0?function(s){return ud.create(s.compositeFilter.filters.map(a=>pre(a)),function(l){switch(l){case"AND":return"and";case"OR":return"or";default:return Un()}}(s.compositeFilter.op))}(r):Un()}function DFe(r){return vFe[r]}function LFe(r){return SFe[r]}function xFe(r){return TFe[r]}function Bv(r){return{fieldPath:r.canonicalString()}}function Wv(r){return qo.fromServerFormat(r.fieldPath)}function mre(r){return r instanceof Ms?function(s){if(s.op==="=="){if(wY(s.value))return{unaryFilter:{field:Bv(s.field),op:"IS_NAN"}};if(bY(s.value))return{unaryFilter:{field:Bv(s.field),op:"IS_NULL"}}}else if(s.op==="!="){if(wY(s.value))return{unaryFilter:{field:Bv(s.field),op:"IS_NOT_NAN"}};if(bY(s.value))return{unaryFilter:{field:Bv(s.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Bv(s.field),op:LFe(s.op),value:s.value}}}(r):r instanceof ud?function(s){const a=s.getFilters().map(l=>mre(l));return a.length===1?a[0]:{compositeFilter:{op:xFe(s.op),filters:a}}}(r):Un()}function MFe(r){const t=[];return r.fields.forEach(s=>t.push(s.canonicalString())),{fieldPaths:t}}function gre(r){return r.length>=4&&r.get(0)==="projects"&&r.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pm{constructor(t,s,a,l,d=Bn.min(),p=Bn.min(),E=$o.EMPTY_BYTE_STRING,v=null){this.target=t,this.targetId=s,this.purpose=a,this.sequenceNumber=l,this.snapshotVersion=d,this.lastLimboFreeSnapshotVersion=p,this.resumeToken=E,this.expectedCount=v}withSequenceNumber(t){return new Pm(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,s){return new Pm(this.target,this.targetId,this.purpose,this.sequenceNumber,s,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new Pm(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new Pm(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UFe{constructor(t){this.Tt=t}}function VFe(r){const t=NFe({parent:r.parent,structuredQuery:r.structuredQuery});return r.limitType==="LAST"?UU(t,t.limit,"L"):t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FFe{constructor(){this.Tn=new jFe}addToCollectionParentIndex(t,s){return this.Tn.add(s),_t.resolve()}getCollectionParents(t,s){return _t.resolve(this.Tn.getEntries(s))}addFieldIndex(t,s){return _t.resolve()}deleteFieldIndex(t,s){return _t.resolve()}deleteAllFieldIndexes(t){return _t.resolve()}createTargetIndexes(t,s){return _t.resolve()}getDocumentsMatchingTarget(t,s){return _t.resolve(null)}getIndexType(t,s){return _t.resolve(0)}getFieldIndexes(t,s){return _t.resolve([])}getNextCollectionGroupToUpdate(t){return _t.resolve(null)}getMinOffset(t,s){return _t.resolve(Bm.min())}getMinOffsetFromCollectionGroup(t,s){return _t.resolve(Bm.min())}updateCollectionGroup(t,s,a){return _t.resolve()}updateIndexEntries(t,s){return _t.resolve()}}class jFe{constructor(){this.index={}}add(t){const s=t.lastSegment(),a=t.popLast(),l=this.index[s]||new Js(bi.comparator),d=!l.has(a);return this.index[s]=l.add(a),d}has(t){const s=t.lastSegment(),a=t.popLast(),l=this.index[s];return l&&l.has(a)}getEntries(t){return(this.index[t]||new Js(bi.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VY={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},_re=41943040;class Nc{static withCacheSize(t){return new Nc(t,Nc.DEFAULT_COLLECTION_PERCENTILE,Nc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(t,s,a){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=s,this.maximumSequenceNumbersToCollect=a}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Nc.DEFAULT_COLLECTION_PERCENTILE=10,Nc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Nc.DEFAULT=new Nc(_re,Nc.DEFAULT_COLLECTION_PERCENTILE,Nc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Nc.DISABLED=new Nc(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class US{constructor(t){this.$n=t}next(){return this.$n+=2,this.$n}static Kn(){return new US(0)}static Un(){return new US(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FY="LruGarbageCollector",BFe=1048576;function jY([r,t],[s,a]){const l=wr(r,s);return l===0?wr(t,a):l}class WFe{constructor(t){this.Hn=t,this.buffer=new Js(jY),this.Jn=0}Yn(){return++this.Jn}Zn(t){const s=[t,this.Yn()];if(this.buffer.size<this.Hn)this.buffer=this.buffer.add(s);else{const a=this.buffer.last();jY(s,a)<0&&(this.buffer=this.buffer.delete(a).add(s))}}get maxValue(){return this.buffer.last()[0]}}class GFe{constructor(t,s,a){this.garbageCollector=t,this.asyncQueue=s,this.localStore=a,this.Xn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.er(6e4)}stop(){this.Xn&&(this.Xn.cancel(),this.Xn=null)}get started(){return this.Xn!==null}er(t){Kt(FY,`Garbage collection scheduled in ${t}ms`),this.Xn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,async()=>{this.Xn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(s){nT(s)?Kt(FY,"Ignoring IndexedDB error during garbage collection: ",s):await tT(s)}await this.er(3e5)})}}class zFe{constructor(t,s){this.tr=t,this.params=s}calculateTargetCount(t,s){return this.tr.nr(t).next(a=>Math.floor(s/100*a))}nthSequenceNumber(t,s){if(s===0)return _t.resolve(ek.ae);const a=new WFe(s);return this.tr.forEachTarget(t,l=>a.Zn(l.sequenceNumber)).next(()=>this.tr.rr(t,l=>a.Zn(l))).next(()=>a.maxValue)}removeTargets(t,s,a){return this.tr.removeTargets(t,s,a)}removeOrphanedDocuments(t,s){return this.tr.removeOrphanedDocuments(t,s)}collect(t,s){return this.params.cacheSizeCollectionThreshold===-1?(Kt("LruGarbageCollector","Garbage collection skipped; disabled"),_t.resolve(VY)):this.getCacheSize(t).next(a=>a<this.params.cacheSizeCollectionThreshold?(Kt("LruGarbageCollector",`Garbage collection skipped; Cache size ${a} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),VY):this.ir(t,s))}getCacheSize(t){return this.tr.getCacheSize(t)}ir(t,s){let a,l,d,p,E,v,b;const R=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(O=>(O>this.params.maximumSequenceNumbersToCollect?(Kt("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${O}`),l=this.params.maximumSequenceNumbersToCollect):l=O,p=Date.now(),this.nthSequenceNumber(t,l))).next(O=>(a=O,E=Date.now(),this.removeTargets(t,a,s))).next(O=>(d=O,v=Date.now(),this.removeOrphanedDocuments(t,a))).next(O=>(b=Date.now(),Fv()<=_r.DEBUG&&Kt("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${p-R}ms
	Determined least recently used ${l} in `+(E-p)+`ms
	Removed ${d} targets in `+(v-E)+`ms
	Removed ${O} documents in `+(b-v)+`ms
Total Duration: ${b-R}ms`),_t.resolve({didRun:!0,sequenceNumbersCollected:l,targetsRemoved:d,documentsRemoved:O})))}}function HFe(r,t){return new zFe(r,t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KFe{constructor(){this.changes=new hE(t=>t.toString(),(t,s)=>t.isEqual(s)),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,s){this.assertNotApplied(),this.changes.set(t,Sa.newInvalidDocument(t).setReadTime(s))}getEntry(t,s){this.assertNotApplied();const a=this.changes.get(s);return a!==void 0?_t.resolve(a):this.getFromCache(t,s)}getEntries(t,s){return this.getAllFromCache(t,s)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qFe{constructor(t,s){this.overlayedDocument=t,this.mutatedFields=s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $Fe{constructor(t,s,a,l){this.remoteDocumentCache=t,this.mutationQueue=s,this.documentOverlayCache=a,this.indexManager=l}getDocument(t,s){let a=null;return this.documentOverlayCache.getOverlay(t,s).next(l=>(a=l,this.remoteDocumentCache.getEntry(t,s))).next(l=>(a!==null&&Rw(a.mutation,l,hl.empty(),Xs.now()),l))}getDocuments(t,s){return this.remoteDocumentCache.getEntries(t,s).next(a=>this.getLocalViewOfDocuments(t,a,Er()).next(()=>a))}getLocalViewOfDocuments(t,s,a=Er()){const l=M_();return this.populateOverlays(t,l,s).next(()=>this.computeViews(t,s,l,a).next(d=>{let p=iw();return d.forEach((E,v)=>{p=p.insert(E,v.overlayedDocument)}),p}))}getOverlayedDocuments(t,s){const a=M_();return this.populateOverlays(t,a,s).next(()=>this.computeViews(t,s,a,Er()))}populateOverlays(t,s,a){const l=[];return a.forEach(d=>{s.has(d)||l.push(d)}),this.documentOverlayCache.getOverlays(t,l).next(d=>{d.forEach((p,E)=>{s.set(p,E)})})}computeViews(t,s,a,l){let d=ap();const p=ww(),E=function(){return ww()}();return s.forEach((v,b)=>{const R=a.get(b.key);l.has(b.key)&&(R===void 0||R.mutation instanceof tg)?d=d.insert(b.key,b):R!==void 0?(p.set(b.key,R.mutation.getFieldMask()),Rw(R.mutation,b,R.mutation.getFieldMask(),Xs.now())):p.set(b.key,hl.empty())}),this.recalculateAndSaveOverlays(t,d).next(v=>(v.forEach((b,R)=>p.set(b,R)),s.forEach((b,R)=>{var O;return E.set(b,new qFe(R,(O=p.get(b))!==null&&O!==void 0?O:null))}),E))}recalculateAndSaveOverlays(t,s){const a=ww();let l=new Zi((p,E)=>p-E),d=Er();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,s).next(p=>{for(const E of p)E.keys().forEach(v=>{const b=s.get(v);if(b===null)return;let R=a.get(v)||hl.empty();R=E.applyToLocalView(b,R),a.set(v,R);const O=(l.get(E.batchId)||Er()).add(v);l=l.insert(E.batchId,O)})}).next(()=>{const p=[],E=l.getReverseIterator();for(;E.hasNext();){const v=E.getNext(),b=v.key,R=v.value,O=Qne();R.forEach(N=>{if(!d.has(N)){const F=ire(s.get(N),a.get(N));F!==null&&O.set(N,F),d=d.add(N)}}),p.push(this.documentOverlayCache.saveOverlays(t,b,O))}return _t.waitFor(p)}).next(()=>a)}recalculateAndSaveOverlaysForDocumentKeys(t,s){return this.remoteDocumentCache.getEntries(t,s).next(a=>this.recalculateAndSaveOverlays(t,a))}getDocumentsMatchingQuery(t,s,a,l){return function(p){return un.isDocumentKey(p.path)&&p.collectionGroup===null&&p.filters.length===0}(s)?this.getDocumentsMatchingDocumentQuery(t,s.path):YF(s)?this.getDocumentsMatchingCollectionGroupQuery(t,s,a,l):this.getDocumentsMatchingCollectionQuery(t,s,a,l)}getNextDocuments(t,s,a,l){return this.remoteDocumentCache.getAllFromCollectionGroup(t,s,a,l).next(d=>{const p=l-d.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,s,a.largestBatchId,l-d.size):_t.resolve(M_());let E=Xw,v=d;return p.next(b=>_t.forEach(b,(R,O)=>(E<O.largestBatchId&&(E=O.largestBatchId),d.get(R)?_t.resolve():this.remoteDocumentCache.getEntry(t,R).next(N=>{v=v.insert(R,N)}))).next(()=>this.populateOverlays(t,b,d)).next(()=>this.computeViews(t,v,b,Er())).next(R=>({batchId:E,changes:Jne(R)})))})}getDocumentsMatchingDocumentQuery(t,s){return this.getDocument(t,new un(s)).next(a=>{let l=iw();return a.isFoundDocument()&&(l=l.insert(a.key,a)),l})}getDocumentsMatchingCollectionGroupQuery(t,s,a,l){const d=s.collectionGroup;let p=iw();return this.indexManager.getCollectionParents(t,d).next(E=>_t.forEach(E,v=>{const b=function(O,N){return new dE(N,null,O.explicitOrderBy.slice(),O.filters.slice(),O.limit,O.limitType,O.startAt,O.endAt)}(s,v.child(d));return this.getDocumentsMatchingCollectionQuery(t,b,a,l).next(R=>{R.forEach((O,N)=>{p=p.insert(O,N)})})}).next(()=>p))}getDocumentsMatchingCollectionQuery(t,s,a,l){let d;return this.documentOverlayCache.getOverlaysForCollection(t,s.path,a.largestBatchId).next(p=>(d=p,this.remoteDocumentCache.getDocumentsMatchingQuery(t,s,a,d,l))).next(p=>{d.forEach((v,b)=>{const R=b.getKey();p.get(R)===null&&(p=p.insert(R,Sa.newInvalidDocument(R)))});let E=iw();return p.forEach((v,b)=>{const R=d.get(v);R!==void 0&&Rw(R.mutation,b,hl.empty(),Xs.now()),ok(s,b)&&(E=E.insert(v,b))}),E})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YFe{constructor(t){this.serializer=t,this.dr=new Map,this.Ar=new Map}getBundleMetadata(t,s){return _t.resolve(this.dr.get(s))}saveBundleMetadata(t,s){return this.dr.set(s.id,function(l){return{id:l.id,version:l.version,createTime:Ah(l.createTime)}}(s)),_t.resolve()}getNamedQuery(t,s){return _t.resolve(this.Ar.get(s))}saveNamedQuery(t,s){return this.Ar.set(s.name,function(l){return{name:l.name,query:VFe(l.bundledQuery),readTime:Ah(l.readTime)}}(s)),_t.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XFe{constructor(){this.overlays=new Zi(un.comparator),this.Rr=new Map}getOverlay(t,s){return _t.resolve(this.overlays.get(s))}getOverlays(t,s){const a=M_();return _t.forEach(s,l=>this.getOverlay(t,l).next(d=>{d!==null&&a.set(l,d)})).next(()=>a)}saveOverlays(t,s,a){return a.forEach((l,d)=>{this.Et(t,s,d)}),_t.resolve()}removeOverlaysForBatchId(t,s,a){const l=this.Rr.get(a);return l!==void 0&&(l.forEach(d=>this.overlays=this.overlays.remove(d)),this.Rr.delete(a)),_t.resolve()}getOverlaysForCollection(t,s,a){const l=M_(),d=s.length+1,p=new un(s.child("")),E=this.overlays.getIteratorFrom(p);for(;E.hasNext();){const v=E.getNext().value,b=v.getKey();if(!s.isPrefixOf(b.path))break;b.path.length===d&&v.largestBatchId>a&&l.set(v.getKey(),v)}return _t.resolve(l)}getOverlaysForCollectionGroup(t,s,a,l){let d=new Zi((b,R)=>b-R);const p=this.overlays.getIterator();for(;p.hasNext();){const b=p.getNext().value;if(b.getKey().getCollectionGroup()===s&&b.largestBatchId>a){let R=d.get(b.largestBatchId);R===null&&(R=M_(),d=d.insert(b.largestBatchId,R)),R.set(b.getKey(),b)}}const E=M_(),v=d.getIterator();for(;v.hasNext()&&(v.getNext().value.forEach((b,R)=>E.set(b,R)),!(E.size()>=l)););return _t.resolve(E)}Et(t,s,a){const l=this.overlays.get(a.key);if(l!==null){const p=this.Rr.get(l.largestBatchId).delete(a.key);this.Rr.set(l.largestBatchId,p)}this.overlays=this.overlays.insert(a.key,new pFe(s,a));let d=this.Rr.get(s);d===void 0&&(d=Er(),this.Rr.set(s,d)),this.Rr.set(s,d.add(a.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JFe{constructor(){this.sessionToken=$o.EMPTY_BYTE_STRING}getSessionToken(t){return _t.resolve(this.sessionToken)}setSessionToken(t,s){return this.sessionToken=s,_t.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ej{constructor(){this.Vr=new Js(mo.mr),this.gr=new Js(mo.pr)}isEmpty(){return this.Vr.isEmpty()}addReference(t,s){const a=new mo(t,s);this.Vr=this.Vr.add(a),this.gr=this.gr.add(a)}yr(t,s){t.forEach(a=>this.addReference(a,s))}removeReference(t,s){this.wr(new mo(t,s))}br(t,s){t.forEach(a=>this.removeReference(a,s))}Sr(t){const s=new un(new bi([])),a=new mo(s,t),l=new mo(s,t+1),d=[];return this.gr.forEachInRange([a,l],p=>{this.wr(p),d.push(p.key)}),d}Dr(){this.Vr.forEach(t=>this.wr(t))}wr(t){this.Vr=this.Vr.delete(t),this.gr=this.gr.delete(t)}vr(t){const s=new un(new bi([])),a=new mo(s,t),l=new mo(s,t+1);let d=Er();return this.gr.forEachInRange([a,l],p=>{d=d.add(p.key)}),d}containsKey(t){const s=new mo(t,0),a=this.Vr.firstAfterOrEqual(s);return a!==null&&t.isEqual(a.key)}}class mo{constructor(t,s){this.key=t,this.Cr=s}static mr(t,s){return un.comparator(t.key,s.key)||wr(t.Cr,s.Cr)}static pr(t,s){return wr(t.Cr,s.Cr)||un.comparator(t.key,s.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QFe{constructor(t,s){this.indexManager=t,this.referenceDelegate=s,this.mutationQueue=[],this.Fr=1,this.Mr=new Js(mo.mr)}checkEmpty(t){return _t.resolve(this.mutationQueue.length===0)}addMutationBatch(t,s,a,l){const d=this.Fr;this.Fr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const p=new fFe(d,s,a,l);this.mutationQueue.push(p);for(const E of l)this.Mr=this.Mr.add(new mo(E.key,d)),this.indexManager.addToCollectionParentIndex(t,E.key.path.popLast());return _t.resolve(p)}lookupMutationBatch(t,s){return _t.resolve(this.Or(s))}getNextMutationBatchAfterBatchId(t,s){const a=s+1,l=this.Nr(a),d=l<0?0:l;return _t.resolve(this.mutationQueue.length>d?this.mutationQueue[d]:null)}getHighestUnacknowledgedBatchId(){return _t.resolve(this.mutationQueue.length===0?HF:this.Fr-1)}getAllMutationBatches(t){return _t.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,s){const a=new mo(s,0),l=new mo(s,Number.POSITIVE_INFINITY),d=[];return this.Mr.forEachInRange([a,l],p=>{const E=this.Or(p.Cr);d.push(E)}),_t.resolve(d)}getAllMutationBatchesAffectingDocumentKeys(t,s){let a=new Js(wr);return s.forEach(l=>{const d=new mo(l,0),p=new mo(l,Number.POSITIVE_INFINITY);this.Mr.forEachInRange([d,p],E=>{a=a.add(E.Cr)})}),_t.resolve(this.Br(a))}getAllMutationBatchesAffectingQuery(t,s){const a=s.path,l=a.length+1;let d=a;un.isDocumentKey(d)||(d=d.child(""));const p=new mo(new un(d),0);let E=new Js(wr);return this.Mr.forEachWhile(v=>{const b=v.key.path;return!!a.isPrefixOf(b)&&(b.length===l&&(E=E.add(v.Cr)),!0)},p),_t.resolve(this.Br(E))}Br(t){const s=[];return t.forEach(a=>{const l=this.Or(a);l!==null&&s.push(l)}),s}removeMutationBatch(t,s){ei(this.Lr(s.batchId,"removed")===0),this.mutationQueue.shift();let a=this.Mr;return _t.forEach(s.mutations,l=>{const d=new mo(l.key,s.batchId);return a=a.delete(d),this.referenceDelegate.markPotentiallyOrphaned(t,l.key)}).next(()=>{this.Mr=a})}qn(t){}containsKey(t,s){const a=new mo(s,0),l=this.Mr.firstAfterOrEqual(a);return _t.resolve(s.isEqual(l&&l.key))}performConsistencyCheck(t){return this.mutationQueue.length,_t.resolve()}Lr(t,s){return this.Nr(t)}Nr(t){return this.mutationQueue.length===0?0:t-this.mutationQueue[0].batchId}Or(t){const s=this.Nr(t);return s<0||s>=this.mutationQueue.length?null:this.mutationQueue[s]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZFe{constructor(t){this.kr=t,this.docs=function(){return new Zi(un.comparator)}(),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,s){const a=s.key,l=this.docs.get(a),d=l?l.size:0,p=this.kr(s);return this.docs=this.docs.insert(a,{document:s.mutableCopy(),size:p}),this.size+=p-d,this.indexManager.addToCollectionParentIndex(t,a.path.popLast())}removeEntry(t){const s=this.docs.get(t);s&&(this.docs=this.docs.remove(t),this.size-=s.size)}getEntry(t,s){const a=this.docs.get(s);return _t.resolve(a?a.document.mutableCopy():Sa.newInvalidDocument(s))}getEntries(t,s){let a=ap();return s.forEach(l=>{const d=this.docs.get(l);a=a.insert(l,d?d.document.mutableCopy():Sa.newInvalidDocument(l))}),_t.resolve(a)}getDocumentsMatchingQuery(t,s,a,l){let d=ap();const p=s.path,E=new un(p.child("__id-9223372036854775808__")),v=this.docs.getIteratorFrom(E);for(;v.hasNext();){const{key:b,value:{document:R}}=v.getNext();if(!p.isPrefixOf(b.path))break;b.path.length>p.length+1||AVe(IVe(R),a)<=0||(l.has(R.key)||ok(s,R))&&(d=d.insert(R.key,R.mutableCopy()))}return _t.resolve(d)}getAllFromCollectionGroup(t,s,a,l){Un()}qr(t,s){return _t.forEach(this.docs,a=>s(a))}newChangeBuffer(t){return new eje(this)}getSize(t){return _t.resolve(this.size)}}class eje extends KFe{constructor(t){super(),this.Ir=t}applyChanges(t){const s=[];return this.changes.forEach((a,l)=>{l.isValidDocument()?s.push(this.Ir.addEntry(t,l)):this.Ir.removeEntry(a)}),_t.waitFor(s)}getFromCache(t,s){return this.Ir.getEntry(t,s)}getAllFromCache(t,s){return this.Ir.getEntries(t,s)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tje{constructor(t){this.persistence=t,this.Qr=new hE(s=>qF(s),$F),this.lastRemoteSnapshotVersion=Bn.min(),this.highestTargetId=0,this.$r=0,this.Kr=new ej,this.targetCount=0,this.Ur=US.Kn()}forEachTarget(t,s){return this.Qr.forEach((a,l)=>s(l)),_t.resolve()}getLastRemoteSnapshotVersion(t){return _t.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return _t.resolve(this.$r)}allocateTargetId(t){return this.highestTargetId=this.Ur.next(),_t.resolve(this.highestTargetId)}setTargetsMetadata(t,s,a){return a&&(this.lastRemoteSnapshotVersion=a),s>this.$r&&(this.$r=s),_t.resolve()}zn(t){this.Qr.set(t.target,t);const s=t.targetId;s>this.highestTargetId&&(this.Ur=new US(s),this.highestTargetId=s),t.sequenceNumber>this.$r&&(this.$r=t.sequenceNumber)}addTargetData(t,s){return this.zn(s),this.targetCount+=1,_t.resolve()}updateTargetData(t,s){return this.zn(s),_t.resolve()}removeTargetData(t,s){return this.Qr.delete(s.target),this.Kr.Sr(s.targetId),this.targetCount-=1,_t.resolve()}removeTargets(t,s,a){let l=0;const d=[];return this.Qr.forEach((p,E)=>{E.sequenceNumber<=s&&a.get(E.targetId)===null&&(this.Qr.delete(p),d.push(this.removeMatchingKeysForTargetId(t,E.targetId)),l++)}),_t.waitFor(d).next(()=>l)}getTargetCount(t){return _t.resolve(this.targetCount)}getTargetData(t,s){const a=this.Qr.get(s)||null;return _t.resolve(a)}addMatchingKeys(t,s,a){return this.Kr.yr(s,a),_t.resolve()}removeMatchingKeys(t,s,a){this.Kr.br(s,a);const l=this.persistence.referenceDelegate,d=[];return l&&s.forEach(p=>{d.push(l.markPotentiallyOrphaned(t,p))}),_t.waitFor(d)}removeMatchingKeysForTargetId(t,s){return this.Kr.Sr(s),_t.resolve()}getMatchingKeysForTargetId(t,s){const a=this.Kr.vr(s);return _t.resolve(a)}containsKey(t,s){return _t.resolve(this.Kr.containsKey(s))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ere{constructor(t,s){this.Wr={},this.overlays={},this.Gr=new ek(0),this.zr=!1,this.zr=!0,this.jr=new JFe,this.referenceDelegate=t(this),this.Hr=new tje(this),this.indexManager=new FFe,this.remoteDocumentCache=function(l){return new ZFe(l)}(a=>this.referenceDelegate.Jr(a)),this.serializer=new UFe(s),this.Yr=new YFe(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.zr=!1,Promise.resolve()}get started(){return this.zr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let s=this.overlays[t.toKey()];return s||(s=new XFe,this.overlays[t.toKey()]=s),s}getMutationQueue(t,s){let a=this.Wr[t.toKey()];return a||(a=new QFe(s,this.referenceDelegate),this.Wr[t.toKey()]=a),a}getGlobalsCache(){return this.jr}getTargetCache(){return this.Hr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Yr}runTransaction(t,s,a){Kt("MemoryPersistence","Starting transaction:",t);const l=new nje(this.Gr.next());return this.referenceDelegate.Zr(),a(l).next(d=>this.referenceDelegate.Xr(l).next(()=>d)).toPromise().then(d=>(l.raiseOnCommittedEvent(),d))}ei(t,s){return _t.or(Object.values(this.Wr).map(a=>()=>a.containsKey(t,s)))}}class nje extends PVe{constructor(t){super(),this.currentSequenceNumber=t}}class tj{constructor(t){this.persistence=t,this.ti=new ej,this.ni=null}static ri(t){return new tj(t)}get ii(){if(this.ni)return this.ni;throw Un()}addReference(t,s,a){return this.ti.addReference(a,s),this.ii.delete(a.toString()),_t.resolve()}removeReference(t,s,a){return this.ti.removeReference(a,s),this.ii.add(a.toString()),_t.resolve()}markPotentiallyOrphaned(t,s){return this.ii.add(s.toString()),_t.resolve()}removeTarget(t,s){this.ti.Sr(s.targetId).forEach(l=>this.ii.add(l.toString()));const a=this.persistence.getTargetCache();return a.getMatchingKeysForTargetId(t,s.targetId).next(l=>{l.forEach(d=>this.ii.add(d.toString()))}).next(()=>a.removeTargetData(t,s))}Zr(){this.ni=new Set}Xr(t){const s=this.persistence.getRemoteDocumentCache().newChangeBuffer();return _t.forEach(this.ii,a=>{const l=un.fromPath(a);return this.si(t,l).next(d=>{d||s.removeEntry(l,Bn.min())})}).next(()=>(this.ni=null,s.apply(t)))}updateLimboDocument(t,s){return this.si(t,s).next(a=>{a?this.ii.delete(s.toString()):this.ii.add(s.toString())})}Jr(t){return 0}si(t,s){return _t.or([()=>_t.resolve(this.ti.containsKey(s)),()=>this.persistence.getTargetCache().containsKey(t,s),()=>this.persistence.ei(t,s)])}}class lN{constructor(t,s){this.persistence=t,this.oi=new hE(a=>DVe(a.path),(a,l)=>a.isEqual(l)),this.garbageCollector=HFe(this,s)}static ri(t,s){return new lN(t,s)}Zr(){}Xr(t){return _t.resolve()}forEachTarget(t,s){return this.persistence.getTargetCache().forEachTarget(t,s)}nr(t){const s=this.sr(t);return this.persistence.getTargetCache().getTargetCount(t).next(a=>s.next(l=>a+l))}sr(t){let s=0;return this.rr(t,a=>{s++}).next(()=>s)}rr(t,s){return _t.forEach(this.oi,(a,l)=>this.ar(t,a,l).next(d=>d?_t.resolve():s(l)))}removeTargets(t,s,a){return this.persistence.getTargetCache().removeTargets(t,s,a)}removeOrphanedDocuments(t,s){let a=0;const l=this.persistence.getRemoteDocumentCache(),d=l.newChangeBuffer();return l.qr(t,p=>this.ar(t,p,s).next(E=>{E||(a++,d.removeEntry(p,Bn.min()))})).next(()=>d.apply(t)).next(()=>a)}markPotentiallyOrphaned(t,s){return this.oi.set(s,t.currentSequenceNumber),_t.resolve()}removeTarget(t,s){const a=s.withSequenceNumber(t.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(t,a)}addReference(t,s,a){return this.oi.set(a,t.currentSequenceNumber),_t.resolve()}removeReference(t,s,a){return this.oi.set(a,t.currentSequenceNumber),_t.resolve()}updateLimboDocument(t,s){return this.oi.set(s,t.currentSequenceNumber),_t.resolve()}Jr(t){let s=t.key.toString().length;return t.isFoundDocument()&&(s+=CP(t.data.value)),s}ar(t,s,a){return _t.or([()=>this.persistence.ei(t,s),()=>this.persistence.getTargetCache().containsKey(t,s),()=>{const l=this.oi.get(s);return _t.resolve(l!==void 0&&l>a)}])}getCacheSize(t){return this.persistence.getRemoteDocumentCache().getSize(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nj{constructor(t,s,a,l){this.targetId=t,this.fromCache=s,this.Hi=a,this.Ji=l}static Yi(t,s){let a=Er(),l=Er();for(const d of s.docChanges)switch(d.type){case 0:a=a.add(d.doc.key);break;case 1:l=l.add(d.doc.key)}return new nj(t,s.fromCache,a,l)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rje{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ije{constructor(){this.Zi=!1,this.Xi=!1,this.es=100,this.ts=function(){return Bxe()?8:NVe(wa())>0?6:4}()}initialize(t,s){this.ns=t,this.indexManager=s,this.Zi=!0}getDocumentsMatchingQuery(t,s,a,l){const d={result:null};return this.rs(t,s).next(p=>{d.result=p}).next(()=>{if(!d.result)return this.ss(t,s,l,a).next(p=>{d.result=p})}).next(()=>{if(d.result)return;const p=new rje;return this._s(t,s,p).next(E=>{if(d.result=E,this.Xi)return this.us(t,s,p,E.size)})}).next(()=>d.result)}us(t,s,a,l){return a.documentReadCount<this.es?(Fv()<=_r.DEBUG&&Kt("QueryEngine","SDK will not create cache indexes for query:",jv(s),"since it only creates cache indexes for collection contains","more than or equal to",this.es,"documents"),_t.resolve()):(Fv()<=_r.DEBUG&&Kt("QueryEngine","Query:",jv(s),"scans",a.documentReadCount,"local documents and returns",l,"documents as results."),a.documentReadCount>this.ts*l?(Fv()<=_r.DEBUG&&Kt("QueryEngine","The SDK decides to create cache indexes for query:",jv(s),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,Ch(s))):_t.resolve())}rs(t,s){if(AY(s))return _t.resolve(null);let a=Ch(s);return this.indexManager.getIndexType(t,a).next(l=>l===0?null:(s.limit!==null&&l===1&&(s=UU(s,null,"F"),a=Ch(s)),this.indexManager.getDocumentsMatchingTarget(t,a).next(d=>{const p=Er(...d);return this.ns.getDocuments(t,p).next(E=>this.indexManager.getMinOffset(t,a).next(v=>{const b=this.cs(s,E);return this.ls(s,b,p,v.readTime)?this.rs(t,UU(s,null,"F")):this.hs(t,b,s,v)}))})))}ss(t,s,a,l){return AY(s)||l.isEqual(Bn.min())?_t.resolve(null):this.ns.getDocuments(t,a).next(d=>{const p=this.cs(s,d);return this.ls(s,p,a,l)?_t.resolve(null):(Fv()<=_r.DEBUG&&Kt("QueryEngine","Re-using previous result from %s to execute query: %s",l.toString(),jv(s)),this.hs(t,p,s,CVe(l,Xw)).next(E=>E))})}cs(t,s){let a=new Js(Yne(t));return s.forEach((l,d)=>{ok(t,d)&&(a=a.add(d))}),a}ls(t,s,a,l){if(t.limit===null)return!1;if(a.size!==s.size)return!0;const d=t.limitType==="F"?s.last():s.first();return!!d&&(d.hasPendingWrites||d.version.compareTo(l)>0)}_s(t,s,a){return Fv()<=_r.DEBUG&&Kt("QueryEngine","Using full collection scan to execute query:",jv(s)),this.ns.getDocumentsMatchingQuery(t,s,Bm.min(),a)}hs(t,s,a,l){return this.ns.getDocumentsMatchingQuery(t,a,l).next(d=>(s.forEach(p=>{d=d.insert(p.key,p)}),d))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rj="LocalStore",sje=3e8;class oje{constructor(t,s,a,l){this.persistence=t,this.Ps=s,this.serializer=l,this.Ts=new Zi(wr),this.Is=new hE(d=>qF(d),$F),this.Es=new Map,this.ds=t.getRemoteDocumentCache(),this.Hr=t.getTargetCache(),this.Yr=t.getBundleCache(),this.As(a)}As(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new $Fe(this.ds,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.ds.setIndexManager(this.indexManager),this.Ps.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",s=>t.collect(s,this.Ts))}}function aje(r,t,s,a){return new oje(r,t,s,a)}async function yre(r,t){const s=Hn(r);return await s.persistence.runTransaction("Handle user change","readonly",a=>{let l;return s.mutationQueue.getAllMutationBatches(a).next(d=>(l=d,s.As(t),s.mutationQueue.getAllMutationBatches(a))).next(d=>{const p=[],E=[];let v=Er();for(const b of l){p.push(b.batchId);for(const R of b.mutations)v=v.add(R.key)}for(const b of d){E.push(b.batchId);for(const R of b.mutations)v=v.add(R.key)}return s.localDocuments.getDocuments(a,v).next(b=>({Rs:b,removedBatchIds:p,addedBatchIds:E}))})})}function cje(r,t){const s=Hn(r);return s.persistence.runTransaction("Acknowledge batch","readwrite-primary",a=>{const l=t.batch.keys(),d=s.ds.newChangeBuffer({trackRemovals:!0});return function(E,v,b,R){const O=b.batch,N=O.keys();let F=_t.resolve();return N.forEach(H=>{F=F.next(()=>R.getEntry(v,H)).next(z=>{const G=b.docVersions.get(H);ei(G!==null),z.version.compareTo(G)<0&&(O.applyToRemoteDocument(z,b),z.isValidDocument()&&(z.setReadTime(b.commitVersion),R.addEntry(z)))})}),F.next(()=>E.mutationQueue.removeMutationBatch(v,O))}(s,a,t,d).next(()=>d.apply(a)).next(()=>s.mutationQueue.performConsistencyCheck(a)).next(()=>s.documentOverlayCache.removeOverlaysForBatchId(a,l,t.batch.batchId)).next(()=>s.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(a,function(E){let v=Er();for(let b=0;b<E.mutationResults.length;++b)E.mutationResults[b].transformResults.length>0&&(v=v.add(E.batch.mutations[b].key));return v}(t))).next(()=>s.localDocuments.getDocuments(a,l))})}function vre(r){const t=Hn(r);return t.persistence.runTransaction("Get last remote snapshot version","readonly",s=>t.Hr.getLastRemoteSnapshotVersion(s))}function lje(r,t){const s=Hn(r),a=t.snapshotVersion;let l=s.Ts;return s.persistence.runTransaction("Apply remote event","readwrite-primary",d=>{const p=s.ds.newChangeBuffer({trackRemovals:!0});l=s.Ts;const E=[];t.targetChanges.forEach((R,O)=>{const N=l.get(O);if(!N)return;E.push(s.Hr.removeMatchingKeys(d,R.removedDocuments,O).next(()=>s.Hr.addMatchingKeys(d,R.addedDocuments,O)));let F=N.withSequenceNumber(d.currentSequenceNumber);t.targetMismatches.get(O)!==null?F=F.withResumeToken($o.EMPTY_BYTE_STRING,Bn.min()).withLastLimboFreeSnapshotVersion(Bn.min()):R.resumeToken.approximateByteSize()>0&&(F=F.withResumeToken(R.resumeToken,a)),l=l.insert(O,F),function(z,G,ee){return z.resumeToken.approximateByteSize()===0||G.snapshotVersion.toMicroseconds()-z.snapshotVersion.toMicroseconds()>=sje?!0:ee.addedDocuments.size+ee.modifiedDocuments.size+ee.removedDocuments.size>0}(N,F,R)&&E.push(s.Hr.updateTargetData(d,F))});let v=ap(),b=Er();if(t.documentUpdates.forEach(R=>{t.resolvedLimboDocuments.has(R)&&E.push(s.persistence.referenceDelegate.updateLimboDocument(d,R))}),E.push(uje(d,p,t.documentUpdates).next(R=>{v=R.Vs,b=R.fs})),!a.isEqual(Bn.min())){const R=s.Hr.getLastRemoteSnapshotVersion(d).next(O=>s.Hr.setTargetsMetadata(d,d.currentSequenceNumber,a));E.push(R)}return _t.waitFor(E).next(()=>p.apply(d)).next(()=>s.localDocuments.getLocalViewOfDocuments(d,v,b)).next(()=>v)}).then(d=>(s.Ts=l,d))}function uje(r,t,s){let a=Er(),l=Er();return s.forEach(d=>a=a.add(d)),t.getEntries(r,a).next(d=>{let p=ap();return s.forEach((E,v)=>{const b=d.get(E);v.isFoundDocument()!==b.isFoundDocument()&&(l=l.add(E)),v.isNoDocument()&&v.version.isEqual(Bn.min())?(t.removeEntry(E,v.readTime),p=p.insert(E,v)):!b.isValidDocument()||v.version.compareTo(b.version)>0||v.version.compareTo(b.version)===0&&b.hasPendingWrites?(t.addEntry(v),p=p.insert(E,v)):Kt(rj,"Ignoring outdated watch update for ",E,". Current version:",b.version," Watch version:",v.version)}),{Vs:p,fs:l}})}function dje(r,t){const s=Hn(r);return s.persistence.runTransaction("Get next mutation batch","readonly",a=>(t===void 0&&(t=HF),s.mutationQueue.getNextMutationBatchAfterBatchId(a,t)))}function hje(r,t){const s=Hn(r);return s.persistence.runTransaction("Allocate target","readwrite",a=>{let l;return s.Hr.getTargetData(a,t).next(d=>d?(l=d,_t.resolve(l)):s.Hr.allocateTargetId(a).next(p=>(l=new Pm(t,p,"TargetPurposeListen",a.currentSequenceNumber),s.Hr.addTargetData(a,l).next(()=>l))))}).then(a=>{const l=s.Ts.get(a.targetId);return(l===null||a.snapshotVersion.compareTo(l.snapshotVersion)>0)&&(s.Ts=s.Ts.insert(a.targetId,a),s.Is.set(t,a.targetId)),a})}async function WU(r,t,s){const a=Hn(r),l=a.Ts.get(t),d=s?"readwrite":"readwrite-primary";try{s||await a.persistence.runTransaction("Release target",d,p=>a.persistence.referenceDelegate.removeTarget(p,l))}catch(p){if(!nT(p))throw p;Kt(rj,`Failed to update sequence numbers for target ${t}: ${p}`)}a.Ts=a.Ts.remove(t),a.Is.delete(l.target)}function BY(r,t,s){const a=Hn(r);let l=Bn.min(),d=Er();return a.persistence.runTransaction("Execute query","readwrite",p=>function(v,b,R){const O=Hn(v),N=O.Is.get(R);return N!==void 0?_t.resolve(O.Ts.get(N)):O.Hr.getTargetData(b,R)}(a,p,Ch(t)).next(E=>{if(E)return l=E.lastLimboFreeSnapshotVersion,a.Hr.getMatchingKeysForTargetId(p,E.targetId).next(v=>{d=v})}).next(()=>a.Ps.getDocumentsMatchingQuery(p,t,s?l:Bn.min(),s?d:Er())).next(E=>(fje(a,QVe(t),E),{documents:E,gs:d})))}function fje(r,t,s){let a=r.Es.get(t)||Bn.min();s.forEach((l,d)=>{d.readTime.compareTo(a)>0&&(a=d.readTime)}),r.Es.set(t,a)}class WY{constructor(){this.activeTargetIds=iFe()}Ds(t){this.activeTargetIds=this.activeTargetIds.add(t)}vs(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Ss(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class pje{constructor(){this.ho=new WY,this.Po={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,s,a){}addLocalQueryTarget(t,s=!0){return s&&this.ho.Ds(t),this.Po[t]||"not-current"}updateQueryState(t,s,a){this.Po[t]=s}removeLocalQueryTarget(t){this.ho.vs(t)}isLocalQueryTarget(t){return this.ho.activeTargetIds.has(t)}clearQueryState(t){delete this.Po[t]}getAllActiveQueryTargets(){return this.ho.activeTargetIds}isActiveQueryTarget(t){return this.ho.activeTargetIds.has(t)}start(){return this.ho=new WY,Promise.resolve()}handleUserChange(t,s,a){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mje{To(t){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GY="ConnectivityMonitor";class zY{constructor(){this.Io=()=>this.Eo(),this.Ao=()=>this.Ro(),this.Vo=[],this.mo()}To(t){this.Vo.push(t)}shutdown(){window.removeEventListener("online",this.Io),window.removeEventListener("offline",this.Ao)}mo(){window.addEventListener("online",this.Io),window.addEventListener("offline",this.Ao)}Eo(){Kt(GY,"Network connectivity changed: AVAILABLE");for(const t of this.Vo)t(0)}Ro(){Kt(GY,"Network connectivity changed: UNAVAILABLE");for(const t of this.Vo)t(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let KO=null;function GU(){return KO===null?KO=function(){return 268435456+Math.round(2147483648*Math.random())}():KO++,"0x"+KO.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const u2="RestConnection",gje={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class _je{get fo(){return!1}constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const s=t.ssl?"https":"http",a=encodeURIComponent(this.databaseId.projectId),l=encodeURIComponent(this.databaseId.database);this.po=s+"://"+t.host,this.yo=`projects/${a}/databases/${l}`,this.wo=this.databaseId.database===rN?`project_id=${a}`:`project_id=${a}&database_id=${l}`}bo(t,s,a,l,d){const p=GU(),E=this.So(t,s.toUriEncodedString());Kt(u2,`Sending RPC '${t}' ${p}:`,E,a);const v={"google-cloud-resource-prefix":this.yo,"x-goog-request-params":this.wo};return this.Do(v,l,d),this.vo(t,E,v,a).then(b=>(Kt(u2,`Received RPC '${t}' ${p}: `,b),b),b=>{throw kS(u2,`RPC '${t}' ${p} failed with error: `,b,"url: ",E,"request:",a),b})}Co(t,s,a,l,d,p){return this.bo(t,s,a,l,d)}Do(t,s,a){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+eT}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),s&&s.headers.forEach((l,d)=>t[d]=l),a&&a.headers.forEach((l,d)=>t[d]=l)}So(t,s){const a=gje[t];return`${this.po}/v1/${s}:${a}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Eje{constructor(t){this.Fo=t.Fo,this.Mo=t.Mo}xo(t){this.Oo=t}No(t){this.Bo=t}Lo(t){this.ko=t}onMessage(t){this.qo=t}close(){this.Mo()}send(t){this.Fo(t)}Qo(){this.Oo()}$o(){this.Bo()}Ko(t){this.ko(t)}Uo(t){this.qo(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _a="WebChannelConnection";class yje extends _je{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}vo(t,s,a,l){const d=GU();return new Promise((p,E)=>{const v=new Rne;v.setWithCredentials(!0),v.listenOnce(Cne.COMPLETE,()=>{try{switch(v.getLastErrorCode()){case RP.NO_ERROR:const R=v.getResponseJson();Kt(_a,`XHR for RPC '${t}' ${d} received:`,JSON.stringify(R)),p(R);break;case RP.TIMEOUT:Kt(_a,`RPC '${t}' ${d} timed out`),E(new Mt(ct.DEADLINE_EXCEEDED,"Request time out"));break;case RP.HTTP_ERROR:const O=v.getStatus();if(Kt(_a,`RPC '${t}' ${d} failed with status:`,O,"response text:",v.getResponseText()),O>0){let N=v.getResponseJson();Array.isArray(N)&&(N=N[0]);const F=N==null?void 0:N.error;if(F&&F.status&&F.message){const H=function(G){const ee=G.toLowerCase().replace(/_/g,"-");return Object.values(ct).indexOf(ee)>=0?ee:ct.UNKNOWN}(F.status);E(new Mt(H,F.message))}else E(new Mt(ct.UNKNOWN,"Server responded with status "+v.getStatus()))}else E(new Mt(ct.UNAVAILABLE,"Connection failed."));break;default:Un()}}finally{Kt(_a,`RPC '${t}' ${d} completed.`)}});const b=JSON.stringify(l);Kt(_a,`RPC '${t}' ${d} sending request:`,l),v.send(s,"POST",b,a,15)})}Wo(t,s,a){const l=GU(),d=[this.po,"/","google.firestore.v1.Firestore","/",t,"/channel"],p=One(),E=Ane(),v={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},b=this.longPollingOptions.timeoutSeconds;b!==void 0&&(v.longPollingTimeout=Math.round(1e3*b)),this.useFetchStreams&&(v.useFetchStreams=!0),this.Do(v.initMessageHeaders,s,a),v.encodeInitMessageHeaders=!0;const R=d.join("");Kt(_a,`Creating RPC '${t}' stream ${l}: ${R}`,v);const O=p.createWebChannel(R,v);let N=!1,F=!1;const H=new Eje({Fo:G=>{F?Kt(_a,`Not sending because RPC '${t}' stream ${l} is closed:`,G):(N||(Kt(_a,`Opening RPC '${t}' stream ${l} transport.`),O.open(),N=!0),Kt(_a,`RPC '${t}' stream ${l} sending:`,G),O.send(G))},Mo:()=>O.close()}),z=(G,ee,J)=>{G.listen(ee,re=>{try{J(re)}catch(de){setTimeout(()=>{throw de},0)}})};return z(O,rw.EventType.OPEN,()=>{F||(Kt(_a,`RPC '${t}' stream ${l} transport opened.`),H.Qo())}),z(O,rw.EventType.CLOSE,()=>{F||(F=!0,Kt(_a,`RPC '${t}' stream ${l} transport closed`),H.Ko())}),z(O,rw.EventType.ERROR,G=>{F||(F=!0,kS(_a,`RPC '${t}' stream ${l} transport errored:`,G),H.Ko(new Mt(ct.UNAVAILABLE,"The operation could not be completed")))}),z(O,rw.EventType.MESSAGE,G=>{var ee;if(!F){const J=G.data[0];ei(!!J);const re=J,de=(re==null?void 0:re.error)||((ee=re[0])===null||ee===void 0?void 0:ee.error);if(de){Kt(_a,`RPC '${t}' stream ${l} received error:`,de);const se=de.status;let ye=function(oe){const ue=ks[oe];if(ue!==void 0)return are(ue)}(se),Q=de.message;ye===void 0&&(ye=ct.INTERNAL,Q="Unknown error status: "+se+" with message "+de.message),F=!0,H.Ko(new Mt(ye,Q)),O.close()}else Kt(_a,`RPC '${t}' stream ${l} received:`,J),H.Uo(J)}}),z(E,Ine.STAT_EVENT,G=>{G.stat===NU.PROXY?Kt(_a,`RPC '${t}' stream ${l} detected buffering proxy`):G.stat===NU.NOPROXY&&Kt(_a,`RPC '${t}' stream ${l} detected no buffering proxy`)}),setTimeout(()=>{H.$o()},0),H}}function d2(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uk(r){return new bFe(r,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sre{constructor(t,s,a=1e3,l=1.5,d=6e4){this.Ti=t,this.timerId=s,this.Go=a,this.zo=l,this.jo=d,this.Ho=0,this.Jo=null,this.Yo=Date.now(),this.reset()}reset(){this.Ho=0}Zo(){this.Ho=this.jo}Xo(t){this.cancel();const s=Math.floor(this.Ho+this.e_()),a=Math.max(0,Date.now()-this.Yo),l=Math.max(0,s-a);l>0&&Kt("ExponentialBackoff",`Backing off for ${l} ms (base delay: ${this.Ho} ms, delay with jitter: ${s} ms, last attempt: ${a} ms ago)`),this.Jo=this.Ti.enqueueAfterDelay(this.timerId,l,()=>(this.Yo=Date.now(),t())),this.Ho*=this.zo,this.Ho<this.Go&&(this.Ho=this.Go),this.Ho>this.jo&&(this.Ho=this.jo)}t_(){this.Jo!==null&&(this.Jo.skipDelay(),this.Jo=null)}cancel(){this.Jo!==null&&(this.Jo.cancel(),this.Jo=null)}e_(){return(Math.random()-.5)*this.Ho}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HY="PersistentStream";class Tre{constructor(t,s,a,l,d,p,E,v){this.Ti=t,this.n_=a,this.r_=l,this.connection=d,this.authCredentialsProvider=p,this.appCheckCredentialsProvider=E,this.listener=v,this.state=0,this.i_=0,this.s_=null,this.o_=null,this.stream=null,this.__=0,this.a_=new Sre(t,s)}u_(){return this.state===1||this.state===5||this.c_()}c_(){return this.state===2||this.state===3}start(){this.__=0,this.state!==4?this.auth():this.l_()}async stop(){this.u_()&&await this.close(0)}h_(){this.state=0,this.a_.reset()}P_(){this.c_()&&this.s_===null&&(this.s_=this.Ti.enqueueAfterDelay(this.n_,6e4,()=>this.T_()))}I_(t){this.E_(),this.stream.send(t)}async T_(){if(this.c_())return this.close(0)}E_(){this.s_&&(this.s_.cancel(),this.s_=null)}d_(){this.o_&&(this.o_.cancel(),this.o_=null)}async close(t,s){this.E_(),this.d_(),this.a_.cancel(),this.i_++,t!==4?this.a_.reset():s&&s.code===ct.RESOURCE_EXHAUSTED?(op(s.toString()),op("Using maximum backoff delay to prevent overloading the backend."),this.a_.Zo()):s&&s.code===ct.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.A_(),this.stream.close(),this.stream=null),this.state=t,await this.listener.Lo(s)}A_(){}auth(){this.state=1;const t=this.R_(this.i_),s=this.i_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([a,l])=>{this.i_===s&&this.V_(a,l)},a=>{t(()=>{const l=new Mt(ct.UNKNOWN,"Fetching auth token failed: "+a.message);return this.m_(l)})})}V_(t,s){const a=this.R_(this.i_);this.stream=this.f_(t,s),this.stream.xo(()=>{a(()=>this.listener.xo())}),this.stream.No(()=>{a(()=>(this.state=2,this.o_=this.Ti.enqueueAfterDelay(this.r_,1e4,()=>(this.c_()&&(this.state=3),Promise.resolve())),this.listener.No()))}),this.stream.Lo(l=>{a(()=>this.m_(l))}),this.stream.onMessage(l=>{a(()=>++this.__==1?this.g_(l):this.onNext(l))})}l_(){this.state=5,this.a_.Xo(async()=>{this.state=0,this.start()})}m_(t){return Kt(HY,`close with error: ${t}`),this.stream=null,this.close(4,t)}R_(t){return s=>{this.Ti.enqueueAndForget(()=>this.i_===t?s():(Kt(HY,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class vje extends Tre{constructor(t,s,a,l,d,p){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",s,a,l,p),this.serializer=d}f_(t,s){return this.connection.Wo("Listen",t,s)}g_(t){return this.onNext(t)}onNext(t){this.a_.reset();const s=CFe(this.serializer,t),a=function(d){if(!("targetChange"in d))return Bn.min();const p=d.targetChange;return p.targetIds&&p.targetIds.length?Bn.min():p.readTime?Ah(p.readTime):Bn.min()}(t);return this.listener.p_(s,a)}y_(t){const s={};s.database=BU(this.serializer),s.addTarget=function(d,p){let E;const v=p.target;if(E=xU(v)?{documents:OFe(d,v)}:{query:PFe(d,v).ht},E.targetId=p.targetId,p.resumeToken.approximateByteSize()>0){E.resumeToken=ure(d,p.resumeToken);const b=VU(d,p.expectedCount);b!==null&&(E.expectedCount=b)}else if(p.snapshotVersion.compareTo(Bn.min())>0){E.readTime=cN(d,p.snapshotVersion.toTimestamp());const b=VU(d,p.expectedCount);b!==null&&(E.expectedCount=b)}return E}(this.serializer,t);const a=kFe(this.serializer,t);a&&(s.labels=a),this.I_(s)}w_(t){const s={};s.database=BU(this.serializer),s.removeTarget=t,this.I_(s)}}class Sje extends Tre{constructor(t,s,a,l,d,p){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",s,a,l,p),this.serializer=d}get b_(){return this.__>0}start(){this.lastStreamToken=void 0,super.start()}A_(){this.b_&&this.S_([])}f_(t,s){return this.connection.Wo("Write",t,s)}g_(t){return ei(!!t.streamToken),this.lastStreamToken=t.streamToken,ei(!t.writeResults||t.writeResults.length===0),this.listener.D_()}onNext(t){ei(!!t.streamToken),this.lastStreamToken=t.streamToken,this.a_.reset();const s=AFe(t.writeResults,t.commitTime),a=Ah(t.commitTime);return this.listener.v_(a,s)}C_(){const t={};t.database=BU(this.serializer),this.I_(t)}S_(t){const s={streamToken:this.lastStreamToken,writes:t.map(a=>IFe(this.serializer,a))};this.I_(s)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tje{}class bje extends Tje{constructor(t,s,a,l){super(),this.authCredentials=t,this.appCheckCredentials=s,this.connection=a,this.serializer=l,this.F_=!1}M_(){if(this.F_)throw new Mt(ct.FAILED_PRECONDITION,"The client has already been terminated.")}bo(t,s,a,l){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([d,p])=>this.connection.bo(t,FU(s,a),l,d,p)).catch(d=>{throw d.name==="FirebaseError"?(d.code===ct.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),d):new Mt(ct.UNKNOWN,d.toString())})}Co(t,s,a,l,d){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([p,E])=>this.connection.Co(t,FU(s,a),l,p,E,d)).catch(p=>{throw p.name==="FirebaseError"?(p.code===ct.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),p):new Mt(ct.UNKNOWN,p.toString())})}terminate(){this.F_=!0,this.connection.terminate()}}class wje{constructor(t,s){this.asyncQueue=t,this.onlineStateHandler=s,this.state="Unknown",this.x_=0,this.O_=null,this.N_=!0}B_(){this.x_===0&&(this.L_("Unknown"),this.O_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.O_=null,this.k_("Backend didn't respond within 10 seconds."),this.L_("Offline"),Promise.resolve())))}q_(t){this.state==="Online"?this.L_("Unknown"):(this.x_++,this.x_>=1&&(this.Q_(),this.k_(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.L_("Offline")))}set(t){this.Q_(),this.x_=0,t==="Online"&&(this.N_=!1),this.L_(t)}L_(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}k_(t){const s=`Could not reach Cloud Firestore backend. ${t}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.N_?(op(s),this.N_=!1):Kt("OnlineStateTracker",s)}Q_(){this.O_!==null&&(this.O_.cancel(),this.O_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iE="RemoteStore";class Rje{constructor(t,s,a,l,d){this.localStore=t,this.datastore=s,this.asyncQueue=a,this.remoteSyncer={},this.K_=[],this.U_=new Map,this.W_=new Set,this.G_=[],this.z_=d,this.z_.To(p=>{a.enqueueAndForget(async()=>{fE(this)&&(Kt(iE,"Restarting streams for network reachability change."),await async function(v){const b=Hn(v);b.W_.add(4),await PR(b),b.j_.set("Unknown"),b.W_.delete(4),await dk(b)}(this))})}),this.j_=new wje(a,l)}}async function dk(r){if(fE(r))for(const t of r.G_)await t(!0)}async function PR(r){for(const t of r.G_)await t(!1)}function bre(r,t){const s=Hn(r);s.U_.has(t.targetId)||(s.U_.set(t.targetId,t),aj(s)?oj(s):rT(s).c_()&&sj(s,t))}function ij(r,t){const s=Hn(r),a=rT(s);s.U_.delete(t),a.c_()&&wre(s,t),s.U_.size===0&&(a.c_()?a.P_():fE(s)&&s.j_.set("Unknown"))}function sj(r,t){if(r.H_.Ne(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(Bn.min())>0){const s=r.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(s)}rT(r).y_(t)}function wre(r,t){r.H_.Ne(t),rT(r).w_(t)}function oj(r){r.H_=new yFe({getRemoteKeysForTarget:t=>r.remoteSyncer.getRemoteKeysForTarget(t),lt:t=>r.U_.get(t)||null,it:()=>r.datastore.serializer.databaseId}),rT(r).start(),r.j_.B_()}function aj(r){return fE(r)&&!rT(r).u_()&&r.U_.size>0}function fE(r){return Hn(r).W_.size===0}function Rre(r){r.H_=void 0}async function Cje(r){r.j_.set("Online")}async function Ije(r){r.U_.forEach((t,s)=>{sj(r,t)})}async function Aje(r,t){Rre(r),aj(r)?(r.j_.q_(t),oj(r)):r.j_.set("Unknown")}async function Oje(r,t,s){if(r.j_.set("Online"),t instanceof lre&&t.state===2&&t.cause)try{await async function(l,d){const p=d.cause;for(const E of d.targetIds)l.U_.has(E)&&(await l.remoteSyncer.rejectListen(E,p),l.U_.delete(E),l.H_.removeTarget(E))}(r,t)}catch(a){Kt(iE,"Failed to remove targets %s: %s ",t.targetIds.join(","),a),await uN(r,a)}else if(t instanceof OP?r.H_.We(t):t instanceof cre?r.H_.Ze(t):r.H_.je(t),!s.isEqual(Bn.min()))try{const a=await vre(r.localStore);s.compareTo(a)>=0&&await function(d,p){const E=d.H_.ot(p);return E.targetChanges.forEach((v,b)=>{if(v.resumeToken.approximateByteSize()>0){const R=d.U_.get(b);R&&d.U_.set(b,R.withResumeToken(v.resumeToken,p))}}),E.targetMismatches.forEach((v,b)=>{const R=d.U_.get(v);if(!R)return;d.U_.set(v,R.withResumeToken($o.EMPTY_BYTE_STRING,R.snapshotVersion)),wre(d,v);const O=new Pm(R.target,v,b,R.sequenceNumber);sj(d,O)}),d.remoteSyncer.applyRemoteEvent(E)}(r,s)}catch(a){Kt(iE,"Failed to raise snapshot:",a),await uN(r,a)}}async function uN(r,t,s){if(!nT(t))throw t;r.W_.add(1),await PR(r),r.j_.set("Offline"),s||(s=()=>vre(r.localStore)),r.asyncQueue.enqueueRetryable(async()=>{Kt(iE,"Retrying IndexedDB access"),await s(),r.W_.delete(1),await dk(r)})}function Cre(r,t){return t().catch(s=>uN(r,s,t))}async function hk(r){const t=Hn(r),s=Hm(t);let a=t.K_.length>0?t.K_[t.K_.length-1].batchId:HF;for(;Pje(t);)try{const l=await dje(t.localStore,a);if(l===null){t.K_.length===0&&s.P_();break}a=l.batchId,Nje(t,l)}catch(l){await uN(t,l)}Ire(t)&&Are(t)}function Pje(r){return fE(r)&&r.K_.length<10}function Nje(r,t){r.K_.push(t);const s=Hm(r);s.c_()&&s.b_&&s.S_(t.mutations)}function Ire(r){return fE(r)&&!Hm(r).u_()&&r.K_.length>0}function Are(r){Hm(r).start()}async function kje(r){Hm(r).C_()}async function Dje(r){const t=Hm(r);for(const s of r.K_)t.S_(s.mutations)}async function Lje(r,t,s){const a=r.K_.shift(),l=JF.from(a,t,s);await Cre(r,()=>r.remoteSyncer.applySuccessfulWrite(l)),await hk(r)}async function xje(r,t){t&&Hm(r).b_&&await async function(a,l){if(function(p){return gFe(p)&&p!==ct.ABORTED}(l.code)){const d=a.K_.shift();Hm(a).h_(),await Cre(a,()=>a.remoteSyncer.rejectFailedWrite(d.batchId,l)),await hk(a)}}(r,t),Ire(r)&&Are(r)}async function KY(r,t){const s=Hn(r);s.asyncQueue.verifyOperationInProgress(),Kt(iE,"RemoteStore received new credentials");const a=fE(s);s.W_.add(3),await PR(s),a&&s.j_.set("Unknown"),await s.remoteSyncer.handleCredentialChange(t),s.W_.delete(3),await dk(s)}async function Mje(r,t){const s=Hn(r);t?(s.W_.delete(2),await dk(s)):t||(s.W_.add(2),await PR(s),s.j_.set("Unknown"))}function rT(r){return r.J_||(r.J_=function(s,a,l){const d=Hn(s);return d.M_(),new vje(a,d.connection,d.authCredentials,d.appCheckCredentials,d.serializer,l)}(r.datastore,r.asyncQueue,{xo:Cje.bind(null,r),No:Ije.bind(null,r),Lo:Aje.bind(null,r),p_:Oje.bind(null,r)}),r.G_.push(async t=>{t?(r.J_.h_(),aj(r)?oj(r):r.j_.set("Unknown")):(await r.J_.stop(),Rre(r))})),r.J_}function Hm(r){return r.Y_||(r.Y_=function(s,a,l){const d=Hn(s);return d.M_(),new Sje(a,d.connection,d.authCredentials,d.appCheckCredentials,d.serializer,l)}(r.datastore,r.asyncQueue,{xo:()=>Promise.resolve(),No:kje.bind(null,r),Lo:xje.bind(null,r),D_:Dje.bind(null,r),v_:Lje.bind(null,r)}),r.G_.push(async t=>{t?(r.Y_.h_(),await hk(r)):(await r.Y_.stop(),r.K_.length>0&&(Kt(iE,`Stopping write stream with ${r.K_.length} pending writes`),r.K_=[]))})),r.Y_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cj{constructor(t,s,a,l,d){this.asyncQueue=t,this.timerId=s,this.targetTimeMs=a,this.op=l,this.removalCallback=d,this.deferred=new ep,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(p=>{})}get promise(){return this.deferred.promise}static createAndSchedule(t,s,a,l,d){const p=Date.now()+a,E=new cj(t,s,p,l,d);return E.start(a),E}start(t){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Mt(ct.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(t=>this.deferred.resolve(t))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function lj(r,t){if(op("AsyncQueue",`${t}: ${r}`),nT(r))return new Mt(ct.UNAVAILABLE,`${t}: ${r}`);throw r}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ES{static emptySet(t){return new ES(t.comparator)}constructor(t){this.comparator=t?(s,a)=>t(s,a)||un.comparator(s.key,a.key):(s,a)=>un.comparator(s.key,a.key),this.keyedMap=iw(),this.sortedSet=new Zi(this.comparator)}has(t){return this.keyedMap.get(t)!=null}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const s=this.keyedMap.get(t);return s?this.sortedSet.indexOf(s):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal((s,a)=>(t(s),!1))}add(t){const s=this.delete(t.key);return s.copy(s.keyedMap.insert(t.key,t),s.sortedSet.insert(t,null))}delete(t){const s=this.get(t);return s?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(s)):this}isEqual(t){if(!(t instanceof ES)||this.size!==t.size)return!1;const s=this.sortedSet.getIterator(),a=t.sortedSet.getIterator();for(;s.hasNext();){const l=s.getNext().key,d=a.getNext().key;if(!l.isEqual(d))return!1}return!0}toString(){const t=[];return this.forEach(s=>{t.push(s.toString())}),t.length===0?"DocumentSet ()":`DocumentSet (
  `+t.join(`  
`)+`
)`}copy(t,s){const a=new ES;return a.comparator=this.comparator,a.keyedMap=t,a.sortedSet=s,a}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qY{constructor(){this.Z_=new Zi(un.comparator)}track(t){const s=t.doc.key,a=this.Z_.get(s);a?t.type!==0&&a.type===3?this.Z_=this.Z_.insert(s,t):t.type===3&&a.type!==1?this.Z_=this.Z_.insert(s,{type:a.type,doc:t.doc}):t.type===2&&a.type===2?this.Z_=this.Z_.insert(s,{type:2,doc:t.doc}):t.type===2&&a.type===0?this.Z_=this.Z_.insert(s,{type:0,doc:t.doc}):t.type===1&&a.type===0?this.Z_=this.Z_.remove(s):t.type===1&&a.type===2?this.Z_=this.Z_.insert(s,{type:1,doc:a.doc}):t.type===0&&a.type===1?this.Z_=this.Z_.insert(s,{type:2,doc:t.doc}):Un():this.Z_=this.Z_.insert(s,t)}X_(){const t=[];return this.Z_.inorderTraversal((s,a)=>{t.push(a)}),t}}class VS{constructor(t,s,a,l,d,p,E,v,b){this.query=t,this.docs=s,this.oldDocs=a,this.docChanges=l,this.mutatedKeys=d,this.fromCache=p,this.syncStateChanged=E,this.excludesMetadataChanges=v,this.hasCachedResults=b}static fromInitialDocuments(t,s,a,l,d){const p=[];return s.forEach(E=>{p.push({type:0,doc:E})}),new VS(t,s,ES.emptySet(s),p,a,l,!0,!1,d)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&sk(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const s=this.docChanges,a=t.docChanges;if(s.length!==a.length)return!1;for(let l=0;l<s.length;l++)if(s[l].type!==a[l].type||!s[l].doc.isEqual(a[l].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uje{constructor(){this.ea=void 0,this.ta=[]}na(){return this.ta.some(t=>t.ra())}}class Vje{constructor(){this.queries=$Y(),this.onlineState="Unknown",this.ia=new Set}terminate(){(function(s,a){const l=Hn(s),d=l.queries;l.queries=$Y(),d.forEach((p,E)=>{for(const v of E.ta)v.onError(a)})})(this,new Mt(ct.ABORTED,"Firestore shutting down"))}}function $Y(){return new hE(r=>$ne(r),sk)}async function uj(r,t){const s=Hn(r);let a=3;const l=t.query;let d=s.queries.get(l);d?!d.na()&&t.ra()&&(a=2):(d=new Uje,a=t.ra()?0:1);try{switch(a){case 0:d.ea=await s.onListen(l,!0);break;case 1:d.ea=await s.onListen(l,!1);break;case 2:await s.onFirstRemoteStoreListen(l)}}catch(p){const E=lj(p,`Initialization of query '${jv(t.query)}' failed`);return void t.onError(E)}s.queries.set(l,d),d.ta.push(t),t.sa(s.onlineState),d.ea&&t.oa(d.ea)&&hj(s)}async function dj(r,t){const s=Hn(r),a=t.query;let l=3;const d=s.queries.get(a);if(d){const p=d.ta.indexOf(t);p>=0&&(d.ta.splice(p,1),d.ta.length===0?l=t.ra()?0:1:!d.na()&&t.ra()&&(l=2))}switch(l){case 0:return s.queries.delete(a),s.onUnlisten(a,!0);case 1:return s.queries.delete(a),s.onUnlisten(a,!1);case 2:return s.onLastRemoteStoreUnlisten(a);default:return}}function Fje(r,t){const s=Hn(r);let a=!1;for(const l of t){const d=l.query,p=s.queries.get(d);if(p){for(const E of p.ta)E.oa(l)&&(a=!0);p.ea=l}}a&&hj(s)}function jje(r,t,s){const a=Hn(r),l=a.queries.get(t);if(l)for(const d of l.ta)d.onError(s);a.queries.delete(t)}function hj(r){r.ia.forEach(t=>{t.next()})}var zU,YY;(YY=zU||(zU={}))._a="default",YY.Cache="cache";class fj{constructor(t,s,a){this.query=t,this.aa=s,this.ua=!1,this.ca=null,this.onlineState="Unknown",this.options=a||{}}oa(t){if(!this.options.includeMetadataChanges){const a=[];for(const l of t.docChanges)l.type!==3&&a.push(l);t=new VS(t.query,t.docs,t.oldDocs,a,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let s=!1;return this.ua?this.la(t)&&(this.aa.next(t),s=!0):this.ha(t,this.onlineState)&&(this.Pa(t),s=!0),this.ca=t,s}onError(t){this.aa.error(t)}sa(t){this.onlineState=t;let s=!1;return this.ca&&!this.ua&&this.ha(this.ca,t)&&(this.Pa(this.ca),s=!0),s}ha(t,s){if(!t.fromCache||!this.ra())return!0;const a=s!=="Offline";return(!this.options.Ta||!a)&&(!t.docs.isEmpty()||t.hasCachedResults||s==="Offline")}la(t){if(t.docChanges.length>0)return!0;const s=this.ca&&this.ca.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!s)&&this.options.includeMetadataChanges===!0}Pa(t){t=VS.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.ua=!0,this.aa.next(t)}ra(){return this.options.source!==zU.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ore{constructor(t){this.key=t}}class Pre{constructor(t){this.key=t}}class Bje{constructor(t,s){this.query=t,this.fa=s,this.ga=null,this.hasCachedResults=!1,this.current=!1,this.pa=Er(),this.mutatedKeys=Er(),this.ya=Yne(t),this.wa=new ES(this.ya)}get ba(){return this.fa}Sa(t,s){const a=s?s.Da:new qY,l=s?s.wa:this.wa;let d=s?s.mutatedKeys:this.mutatedKeys,p=l,E=!1;const v=this.query.limitType==="F"&&l.size===this.query.limit?l.last():null,b=this.query.limitType==="L"&&l.size===this.query.limit?l.first():null;if(t.inorderTraversal((R,O)=>{const N=l.get(R),F=ok(this.query,O)?O:null,H=!!N&&this.mutatedKeys.has(N.key),z=!!F&&(F.hasLocalMutations||this.mutatedKeys.has(F.key)&&F.hasCommittedMutations);let G=!1;N&&F?N.data.isEqual(F.data)?H!==z&&(a.track({type:3,doc:F}),G=!0):this.va(N,F)||(a.track({type:2,doc:F}),G=!0,(v&&this.ya(F,v)>0||b&&this.ya(F,b)<0)&&(E=!0)):!N&&F?(a.track({type:0,doc:F}),G=!0):N&&!F&&(a.track({type:1,doc:N}),G=!0,(v||b)&&(E=!0)),G&&(F?(p=p.add(F),d=z?d.add(R):d.delete(R)):(p=p.delete(R),d=d.delete(R)))}),this.query.limit!==null)for(;p.size>this.query.limit;){const R=this.query.limitType==="F"?p.last():p.first();p=p.delete(R.key),d=d.delete(R.key),a.track({type:1,doc:R})}return{wa:p,Da:a,ls:E,mutatedKeys:d}}va(t,s){return t.hasLocalMutations&&s.hasCommittedMutations&&!s.hasLocalMutations}applyChanges(t,s,a,l){const d=this.wa;this.wa=t.wa,this.mutatedKeys=t.mutatedKeys;const p=t.Da.X_();p.sort((R,O)=>function(F,H){const z=G=>{switch(G){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Un()}};return z(F)-z(H)}(R.type,O.type)||this.ya(R.doc,O.doc)),this.Ca(a),l=l!=null&&l;const E=s&&!l?this.Fa():[],v=this.pa.size===0&&this.current&&!l?1:0,b=v!==this.ga;return this.ga=v,p.length!==0||b?{snapshot:new VS(this.query,t.wa,d,p,t.mutatedKeys,v===0,b,!1,!!a&&a.resumeToken.approximateByteSize()>0),Ma:E}:{Ma:E}}sa(t){return this.current&&t==="Offline"?(this.current=!1,this.applyChanges({wa:this.wa,Da:new qY,mutatedKeys:this.mutatedKeys,ls:!1},!1)):{Ma:[]}}xa(t){return!this.fa.has(t)&&!!this.wa.has(t)&&!this.wa.get(t).hasLocalMutations}Ca(t){t&&(t.addedDocuments.forEach(s=>this.fa=this.fa.add(s)),t.modifiedDocuments.forEach(s=>{}),t.removedDocuments.forEach(s=>this.fa=this.fa.delete(s)),this.current=t.current)}Fa(){if(!this.current)return[];const t=this.pa;this.pa=Er(),this.wa.forEach(a=>{this.xa(a.key)&&(this.pa=this.pa.add(a.key))});const s=[];return t.forEach(a=>{this.pa.has(a)||s.push(new Pre(a))}),this.pa.forEach(a=>{t.has(a)||s.push(new Ore(a))}),s}Oa(t){this.fa=t.gs,this.pa=Er();const s=this.Sa(t.documents);return this.applyChanges(s,!0)}Na(){return VS.fromInitialDocuments(this.query,this.wa,this.mutatedKeys,this.ga===0,this.hasCachedResults)}}const pj="SyncEngine";class Wje{constructor(t,s,a){this.query=t,this.targetId=s,this.view=a}}class Gje{constructor(t){this.key=t,this.Ba=!1}}class zje{constructor(t,s,a,l,d,p){this.localStore=t,this.remoteStore=s,this.eventManager=a,this.sharedClientState=l,this.currentUser=d,this.maxConcurrentLimboResolutions=p,this.La={},this.ka=new hE(E=>$ne(E),sk),this.qa=new Map,this.Qa=new Set,this.$a=new Zi(un.comparator),this.Ka=new Map,this.Ua=new ej,this.Wa={},this.Ga=new Map,this.za=US.Un(),this.onlineState="Unknown",this.ja=void 0}get isPrimaryClient(){return this.ja===!0}}async function Hje(r,t,s=!0){const a=Mre(r);let l;const d=a.ka.get(t);return d?(a.sharedClientState.addLocalQueryTarget(d.targetId),l=d.view.Na()):l=await Nre(a,t,s,!0),l}async function Kje(r,t){const s=Mre(r);await Nre(s,t,!0,!1)}async function Nre(r,t,s,a){const l=await hje(r.localStore,Ch(t)),d=l.targetId,p=r.sharedClientState.addLocalQueryTarget(d,s);let E;return a&&(E=await qje(r,t,d,p==="current",l.resumeToken)),r.isPrimaryClient&&s&&bre(r.remoteStore,l),E}async function qje(r,t,s,a,l){r.Ha=(O,N,F)=>async function(z,G,ee,J){let re=G.view.Sa(ee);re.ls&&(re=await BY(z.localStore,G.query,!1).then(({documents:Q})=>G.view.Sa(Q,re)));const de=J&&J.targetChanges.get(G.targetId),se=J&&J.targetMismatches.get(G.targetId)!=null,ye=G.view.applyChanges(re,z.isPrimaryClient,de,se);return JY(z,G.targetId,ye.Ma),ye.snapshot}(r,O,N,F);const d=await BY(r.localStore,t,!0),p=new Bje(t,d.gs),E=p.Sa(d.documents),v=OR.createSynthesizedTargetChangeForCurrentChange(s,a&&r.onlineState!=="Offline",l),b=p.applyChanges(E,r.isPrimaryClient,v);JY(r,s,b.Ma);const R=new Wje(t,s,p);return r.ka.set(t,R),r.qa.has(s)?r.qa.get(s).push(t):r.qa.set(s,[t]),b.snapshot}async function $je(r,t,s){const a=Hn(r),l=a.ka.get(t),d=a.qa.get(l.targetId);if(d.length>1)return a.qa.set(l.targetId,d.filter(p=>!sk(p,t))),void a.ka.delete(t);a.isPrimaryClient?(a.sharedClientState.removeLocalQueryTarget(l.targetId),a.sharedClientState.isActiveQueryTarget(l.targetId)||await WU(a.localStore,l.targetId,!1).then(()=>{a.sharedClientState.clearQueryState(l.targetId),s&&ij(a.remoteStore,l.targetId),HU(a,l.targetId)}).catch(tT)):(HU(a,l.targetId),await WU(a.localStore,l.targetId,!0))}async function Yje(r,t){const s=Hn(r),a=s.ka.get(t),l=s.qa.get(a.targetId);s.isPrimaryClient&&l.length===1&&(s.sharedClientState.removeLocalQueryTarget(a.targetId),ij(s.remoteStore,a.targetId))}async function Xje(r,t,s){const a=rBe(r);try{const l=await function(p,E){const v=Hn(p),b=Xs.now(),R=E.reduce((F,H)=>F.add(H.key),Er());let O,N;return v.persistence.runTransaction("Locally write mutations","readwrite",F=>{let H=ap(),z=Er();return v.ds.getEntries(F,R).next(G=>{H=G,H.forEach((ee,J)=>{J.isValidDocument()||(z=z.add(ee))})}).next(()=>v.localDocuments.getOverlayedDocuments(F,H)).next(G=>{O=G;const ee=[];for(const J of E){const re=dFe(J,O.get(J.key).overlayedDocument);re!=null&&ee.push(new tg(J.key,re,Bne(re.value.mapValue),Ih.exists(!0)))}return v.mutationQueue.addMutationBatch(F,b,ee,E)}).next(G=>{N=G;const ee=G.applyToLocalDocumentSet(O,z);return v.documentOverlayCache.saveOverlays(F,G.batchId,ee)})}).then(()=>({batchId:N.batchId,changes:Jne(O)}))}(a.localStore,t);a.sharedClientState.addPendingMutation(l.batchId),function(p,E,v){let b=p.Wa[p.currentUser.toKey()];b||(b=new Zi(wr)),b=b.insert(E,v),p.Wa[p.currentUser.toKey()]=b}(a,l.batchId,s),await NR(a,l.changes),await hk(a.remoteStore)}catch(l){const d=lj(l,"Failed to persist write");s.reject(d)}}async function kre(r,t){const s=Hn(r);try{const a=await lje(s.localStore,t);t.targetChanges.forEach((l,d)=>{const p=s.Ka.get(d);p&&(ei(l.addedDocuments.size+l.modifiedDocuments.size+l.removedDocuments.size<=1),l.addedDocuments.size>0?p.Ba=!0:l.modifiedDocuments.size>0?ei(p.Ba):l.removedDocuments.size>0&&(ei(p.Ba),p.Ba=!1))}),await NR(s,a,t)}catch(a){await tT(a)}}function XY(r,t,s){const a=Hn(r);if(a.isPrimaryClient&&s===0||!a.isPrimaryClient&&s===1){const l=[];a.ka.forEach((d,p)=>{const E=p.view.sa(t);E.snapshot&&l.push(E.snapshot)}),function(p,E){const v=Hn(p);v.onlineState=E;let b=!1;v.queries.forEach((R,O)=>{for(const N of O.ta)N.sa(E)&&(b=!0)}),b&&hj(v)}(a.eventManager,t),l.length&&a.La.p_(l),a.onlineState=t,a.isPrimaryClient&&a.sharedClientState.setOnlineState(t)}}async function Jje(r,t,s){const a=Hn(r);a.sharedClientState.updateQueryState(t,"rejected",s);const l=a.Ka.get(t),d=l&&l.key;if(d){let p=new Zi(un.comparator);p=p.insert(d,Sa.newNoDocument(d,Bn.min()));const E=Er().add(d),v=new lk(Bn.min(),new Map,new Zi(wr),p,E);await kre(a,v),a.$a=a.$a.remove(d),a.Ka.delete(t),mj(a)}else await WU(a.localStore,t,!1).then(()=>HU(a,t,s)).catch(tT)}async function Qje(r,t){const s=Hn(r),a=t.batch.batchId;try{const l=await cje(s.localStore,t);Lre(s,a,null),Dre(s,a),s.sharedClientState.updateMutationState(a,"acknowledged"),await NR(s,l)}catch(l){await tT(l)}}async function Zje(r,t,s){const a=Hn(r);try{const l=await function(p,E){const v=Hn(p);return v.persistence.runTransaction("Reject batch","readwrite-primary",b=>{let R;return v.mutationQueue.lookupMutationBatch(b,E).next(O=>(ei(O!==null),R=O.keys(),v.mutationQueue.removeMutationBatch(b,O))).next(()=>v.mutationQueue.performConsistencyCheck(b)).next(()=>v.documentOverlayCache.removeOverlaysForBatchId(b,R,E)).next(()=>v.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(b,R)).next(()=>v.localDocuments.getDocuments(b,R))})}(a.localStore,t);Lre(a,t,s),Dre(a,t),a.sharedClientState.updateMutationState(t,"rejected",s),await NR(a,l)}catch(l){await tT(l)}}function Dre(r,t){(r.Ga.get(t)||[]).forEach(s=>{s.resolve()}),r.Ga.delete(t)}function Lre(r,t,s){const a=Hn(r);let l=a.Wa[a.currentUser.toKey()];if(l){const d=l.get(t);d&&(s?d.reject(s):d.resolve(),l=l.remove(t)),a.Wa[a.currentUser.toKey()]=l}}function HU(r,t,s=null){r.sharedClientState.removeLocalQueryTarget(t);for(const a of r.qa.get(t))r.ka.delete(a),s&&r.La.Ja(a,s);r.qa.delete(t),r.isPrimaryClient&&r.Ua.Sr(t).forEach(a=>{r.Ua.containsKey(a)||xre(r,a)})}function xre(r,t){r.Qa.delete(t.path.canonicalString());const s=r.$a.get(t);s!==null&&(ij(r.remoteStore,s),r.$a=r.$a.remove(t),r.Ka.delete(s),mj(r))}function JY(r,t,s){for(const a of s)a instanceof Ore?(r.Ua.addReference(a.key,t),eBe(r,a)):a instanceof Pre?(Kt(pj,"Document no longer in limbo: "+a.key),r.Ua.removeReference(a.key,t),r.Ua.containsKey(a.key)||xre(r,a.key)):Un()}function eBe(r,t){const s=t.key,a=s.path.canonicalString();r.$a.get(s)||r.Qa.has(a)||(Kt(pj,"New document in limbo: "+s),r.Qa.add(a),mj(r))}function mj(r){for(;r.Qa.size>0&&r.$a.size<r.maxConcurrentLimboResolutions;){const t=r.Qa.values().next().value;r.Qa.delete(t);const s=new un(bi.fromString(t)),a=r.za.next();r.Ka.set(a,new Gje(s)),r.$a=r.$a.insert(s,a),bre(r.remoteStore,new Pm(Ch(ik(s.path)),a,"TargetPurposeLimboResolution",ek.ae))}}async function NR(r,t,s){const a=Hn(r),l=[],d=[],p=[];a.ka.isEmpty()||(a.ka.forEach((E,v)=>{p.push(a.Ha(v,t,s).then(b=>{var R;if((b||s)&&a.isPrimaryClient){const O=b?!b.fromCache:(R=s==null?void 0:s.targetChanges.get(v.targetId))===null||R===void 0?void 0:R.current;a.sharedClientState.updateQueryState(v.targetId,O?"current":"not-current")}if(b){l.push(b);const O=nj.Yi(v.targetId,b);d.push(O)}}))}),await Promise.all(p),a.La.p_(l),await async function(v,b){const R=Hn(v);try{await R.persistence.runTransaction("notifyLocalViewChanges","readwrite",O=>_t.forEach(b,N=>_t.forEach(N.Hi,F=>R.persistence.referenceDelegate.addReference(O,N.targetId,F)).next(()=>_t.forEach(N.Ji,F=>R.persistence.referenceDelegate.removeReference(O,N.targetId,F)))))}catch(O){if(!nT(O))throw O;Kt(rj,"Failed to update sequence numbers: "+O)}for(const O of b){const N=O.targetId;if(!O.fromCache){const F=R.Ts.get(N),H=F.snapshotVersion,z=F.withLastLimboFreeSnapshotVersion(H);R.Ts=R.Ts.insert(N,z)}}}(a.localStore,d))}async function tBe(r,t){const s=Hn(r);if(!s.currentUser.isEqual(t)){Kt(pj,"User change. New user:",t.toKey());const a=await yre(s.localStore,t);s.currentUser=t,function(d,p){d.Ga.forEach(E=>{E.forEach(v=>{v.reject(new Mt(ct.CANCELLED,p))})}),d.Ga.clear()}(s,"'waitForPendingWrites' promise is rejected due to a user change."),s.sharedClientState.handleUserChange(t,a.removedBatchIds,a.addedBatchIds),await NR(s,a.Rs)}}function nBe(r,t){const s=Hn(r),a=s.Ka.get(t);if(a&&a.Ba)return Er().add(a.key);{let l=Er();const d=s.qa.get(t);if(!d)return l;for(const p of d){const E=s.ka.get(p);l=l.unionWith(E.view.ba)}return l}}function Mre(r){const t=Hn(r);return t.remoteStore.remoteSyncer.applyRemoteEvent=kre.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=nBe.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Jje.bind(null,t),t.La.p_=Fje.bind(null,t.eventManager),t.La.Ja=jje.bind(null,t.eventManager),t}function rBe(r){const t=Hn(r);return t.remoteStore.remoteSyncer.applySuccessfulWrite=Qje.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=Zje.bind(null,t),t}class dN{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(t){this.serializer=uk(t.databaseInfo.databaseId),this.sharedClientState=this.Za(t),this.persistence=this.Xa(t),await this.persistence.start(),this.localStore=this.eu(t),this.gcScheduler=this.tu(t,this.localStore),this.indexBackfillerScheduler=this.nu(t,this.localStore)}tu(t,s){return null}nu(t,s){return null}eu(t){return aje(this.persistence,new ije,t.initialUser,this.serializer)}Xa(t){return new Ere(tj.ri,this.serializer)}Za(t){return new pje}async terminate(){var t,s;(t=this.gcScheduler)===null||t===void 0||t.stop(),(s=this.indexBackfillerScheduler)===null||s===void 0||s.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}dN.provider={build:()=>new dN};class iBe extends dN{constructor(t){super(),this.cacheSizeBytes=t}tu(t,s){ei(this.persistence.referenceDelegate instanceof lN);const a=this.persistence.referenceDelegate.garbageCollector;return new GFe(a,t.asyncQueue,s)}Xa(t){const s=this.cacheSizeBytes!==void 0?Nc.withCacheSize(this.cacheSizeBytes):Nc.DEFAULT;return new Ere(a=>lN.ri(a,s),this.serializer)}}class KU{async initialize(t,s){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(s),this.remoteStore=this.createRemoteStore(s),this.eventManager=this.createEventManager(s),this.syncEngine=this.createSyncEngine(s,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=a=>XY(this.syncEngine,a,1),this.remoteStore.remoteSyncer.handleCredentialChange=tBe.bind(null,this.syncEngine),await Mje(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return function(){return new Vje}()}createDatastore(t){const s=uk(t.databaseInfo.databaseId),a=function(d){return new yje(d)}(t.databaseInfo);return function(d,p,E,v){return new bje(d,p,E,v)}(t.authCredentials,t.appCheckCredentials,a,s)}createRemoteStore(t){return function(a,l,d,p,E){return new Rje(a,l,d,p,E)}(this.localStore,this.datastore,t.asyncQueue,s=>XY(this.syncEngine,s,0),function(){return zY.D()?new zY:new mje}())}createSyncEngine(t,s){return function(l,d,p,E,v,b,R){const O=new zje(l,d,p,E,v,b);return R&&(O.ja=!0),O}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,s)}async terminate(){var t,s;await async function(l){const d=Hn(l);Kt(iE,"RemoteStore shutting down."),d.W_.add(5),await PR(d),d.z_.shutdown(),d.j_.set("Unknown")}(this.remoteStore),(t=this.datastore)===null||t===void 0||t.terminate(),(s=this.eventManager)===null||s===void 0||s.terminate()}}KU.provider={build:()=>new KU};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gj{constructor(t){this.observer=t,this.muted=!1}next(t){this.muted||this.observer.next&&this.iu(this.observer.next,t)}error(t){this.muted||(this.observer.error?this.iu(this.observer.error,t):op("Uncaught Error in snapshot listener:",t.toString()))}su(){this.muted=!0}iu(t,s){setTimeout(()=>{this.muted||t(s)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Km="FirestoreClient";class sBe{constructor(t,s,a,l,d){this.authCredentials=t,this.appCheckCredentials=s,this.asyncQueue=a,this.databaseInfo=l,this.user=va.UNAUTHENTICATED,this.clientId=Nne.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=d,this.authCredentials.start(a,async p=>{Kt(Km,"Received user=",p.uid),await this.authCredentialListener(p),this.user=p}),this.appCheckCredentials.start(a,p=>(Kt(Km,"Received new app check token=",p),this.appCheckCredentialListener(p,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}terminate(){this.asyncQueue.enterRestrictedMode();const t=new ep;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(s){const a=lj(s,"Failed to shutdown persistence");t.reject(a)}}),t.promise}}async function h2(r,t){r.asyncQueue.verifyOperationInProgress(),Kt(Km,"Initializing OfflineComponentProvider");const s=r.configuration;await t.initialize(s);let a=s.initialUser;r.setCredentialChangeListener(async l=>{a.isEqual(l)||(await yre(t.localStore,l),a=l)}),t.persistence.setDatabaseDeletedListener(()=>r.terminate()),r._offlineComponents=t}async function QY(r,t){r.asyncQueue.verifyOperationInProgress();const s=await oBe(r);Kt(Km,"Initializing OnlineComponentProvider"),await t.initialize(s,r.configuration),r.setCredentialChangeListener(a=>KY(t.remoteStore,a)),r.setAppCheckTokenChangeListener((a,l)=>KY(t.remoteStore,l)),r._onlineComponents=t}async function oBe(r){if(!r._offlineComponents)if(r._uninitializedComponentsProvider){Kt(Km,"Using user provided OfflineComponentProvider");try{await h2(r,r._uninitializedComponentsProvider._offline)}catch(t){const s=t;if(!function(l){return l.name==="FirebaseError"?l.code===ct.FAILED_PRECONDITION||l.code===ct.UNIMPLEMENTED:!(typeof DOMException<"u"&&l instanceof DOMException)||l.code===22||l.code===20||l.code===11}(s))throw s;kS("Error using user provided cache. Falling back to memory cache: "+s),await h2(r,new dN)}}else Kt(Km,"Using default OfflineComponentProvider"),await h2(r,new iBe(void 0));return r._offlineComponents}async function Ure(r){return r._onlineComponents||(r._uninitializedComponentsProvider?(Kt(Km,"Using user provided OnlineComponentProvider"),await QY(r,r._uninitializedComponentsProvider._online)):(Kt(Km,"Using default OnlineComponentProvider"),await QY(r,new KU))),r._onlineComponents}function aBe(r){return Ure(r).then(t=>t.syncEngine)}async function hN(r){const t=await Ure(r),s=t.eventManager;return s.onListen=Hje.bind(null,t.syncEngine),s.onUnlisten=$je.bind(null,t.syncEngine),s.onFirstRemoteStoreListen=Kje.bind(null,t.syncEngine),s.onLastRemoteStoreUnlisten=Yje.bind(null,t.syncEngine),s}function cBe(r,t,s={}){const a=new ep;return r.asyncQueue.enqueueAndForget(async()=>function(d,p,E,v,b){const R=new gj({next:N=>{R.su(),p.enqueueAndForget(()=>dj(d,O));const F=N.docs.has(E);!F&&N.fromCache?b.reject(new Mt(ct.UNAVAILABLE,"Failed to get document because the client is offline.")):F&&N.fromCache&&v&&v.source==="server"?b.reject(new Mt(ct.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):b.resolve(N)},error:N=>b.reject(N)}),O=new fj(ik(E.path),R,{includeMetadataChanges:!0,Ta:!0});return uj(d,O)}(await hN(r),r.asyncQueue,t,s,a)),a.promise}function lBe(r,t,s={}){const a=new ep;return r.asyncQueue.enqueueAndForget(async()=>function(d,p,E,v,b){const R=new gj({next:N=>{R.su(),p.enqueueAndForget(()=>dj(d,O)),N.fromCache&&v.source==="server"?b.reject(new Mt(ct.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):b.resolve(N)},error:N=>b.reject(N)}),O=new fj(E,R,{includeMetadataChanges:!0,Ta:!0});return uj(d,O)}(await hN(r),r.asyncQueue,t,s,a)),a.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vre(r){const t={};return r.timeoutSeconds!==void 0&&(t.timeoutSeconds=r.timeoutSeconds),t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZY=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fre(r,t,s){if(!s)throw new Mt(ct.INVALID_ARGUMENT,`Function ${r}() cannot be called with an empty ${t}.`)}function uBe(r,t,s,a){if(t===!0&&a===!0)throw new Mt(ct.INVALID_ARGUMENT,`${r} and ${s} cannot be used together.`)}function eX(r){if(!un.isDocumentKey(r))throw new Mt(ct.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${r} has ${r.length}.`)}function tX(r){if(un.isDocumentKey(r))throw new Mt(ct.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${r} has ${r.length}.`)}function fk(r){if(r===void 0)return"undefined";if(r===null)return"null";if(typeof r=="string")return r.length>20&&(r=`${r.substring(0,20)}...`),JSON.stringify(r);if(typeof r=="number"||typeof r=="boolean")return""+r;if(typeof r=="object"){if(r instanceof Array)return"an array";{const t=function(a){return a.constructor?a.constructor.name:null}(r);return t?`a custom ${t} object`:"an object"}}return typeof r=="function"?"a function":Un()}function lu(r,t){if("_delegate"in r&&(r=r._delegate),!(r instanceof t)){if(t.name===r.constructor.name)throw new Mt(ct.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const s=fk(r);throw new Mt(ct.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${s}`)}}return r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jre="firestore.googleapis.com",nX=!0;class rX{constructor(t){var s,a;if(t.host===void 0){if(t.ssl!==void 0)throw new Mt(ct.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=jre,this.ssl=nX}else this.host=t.host,this.ssl=(s=t.ssl)!==null&&s!==void 0?s:nX;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,t.cacheSizeBytes===void 0)this.cacheSizeBytes=_re;else{if(t.cacheSizeBytes!==-1&&t.cacheSizeBytes<BFe)throw new Mt(ct.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}uBe("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:t.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Vre((a=t.experimentalLongPollingOptions)!==null&&a!==void 0?a:{}),function(d){if(d.timeoutSeconds!==void 0){if(isNaN(d.timeoutSeconds))throw new Mt(ct.INVALID_ARGUMENT,`invalid long polling timeout: ${d.timeoutSeconds} (must not be NaN)`);if(d.timeoutSeconds<5)throw new Mt(ct.INVALID_ARGUMENT,`invalid long polling timeout: ${d.timeoutSeconds} (minimum allowed value is 5)`);if(d.timeoutSeconds>30)throw new Mt(ct.INVALID_ARGUMENT,`invalid long polling timeout: ${d.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(a,l){return a.timeoutSeconds===l.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class pk{constructor(t,s,a,l){this._authCredentials=t,this._appCheckCredentials=s,this._databaseId=a,this._app=l,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new rX({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Mt(ct.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(t){if(this._settingsFrozen)throw new Mt(ct.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new rX(t),this._emulatorOptions=t.emulatorOptions||{},t.credentials!==void 0&&(this._authCredentials=function(a){if(!a)return new EVe;switch(a.type){case"firstParty":return new TVe(a.sessionIndex||"0",a.iamToken||null,a.authTokenFactory||null);case"provider":return a.client;default:throw new Mt(ct.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(s){const a=ZY.get(s);a&&(Kt("ComponentProvider","Removing Datastore"),ZY.delete(s),a.terminate())}(this),Promise.resolve()}}function dBe(r,t,s,a={}){var l;const d=(r=lu(r,pk))._getSettings(),p=Object.assign(Object.assign({},d),{emulatorOptions:r._getEmulatorOptions()}),E=`${t}:${s}`;d.host!==jre&&d.host!==E&&kS("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const v=Object.assign(Object.assign({},d),{host:E,ssl:!1,emulatorOptions:a});if(!Z_(v,p)&&(r._setSettings(v),a.mockUserToken)){let b,R;if(typeof a.mockUserToken=="string")b=a.mockUserToken,R=va.MOCK_USER;else{b=Mte(a.mockUserToken,(l=r._app)===null||l===void 0?void 0:l.options.projectId);const O=a.mockUserToken.sub||a.mockUserToken.user_id;if(!O)throw new Mt(ct.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");R=new va(O)}r._authCredentials=new yVe(new Pne(b,R))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lp{constructor(t,s,a){this.converter=s,this._query=a,this.type="query",this.firestore=t}withConverter(t){return new lp(this.firestore,t,this._query)}}class ba{constructor(t,s,a){this.converter=s,this._key=a,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new xm(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new ba(this.firestore,t,this._key)}}class xm extends lp{constructor(t,s,a){super(t,s,ik(a)),this._path=a,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new ba(this.firestore,null,new un(t))}withConverter(t){return new xm(this.firestore,t,this._path)}}function Bre(r,t,...s){if(r=Qi(r),Fre("collection","path",t),r instanceof pk){const a=bi.fromString(t,...s);return tX(a),new xm(r,null,a)}{if(!(r instanceof ba||r instanceof xm))throw new Mt(ct.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const a=r._path.child(bi.fromString(t,...s));return tX(a),new xm(r.firestore,null,a)}}function FS(r,t,...s){if(r=Qi(r),arguments.length===1&&(t=Nne.newId()),Fre("doc","path",t),r instanceof pk){const a=bi.fromString(t,...s);return eX(a),new ba(r,null,new un(a))}{if(!(r instanceof ba||r instanceof xm))throw new Mt(ct.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const a=r._path.child(bi.fromString(t,...s));return eX(a),new ba(r.firestore,r instanceof xm?r.converter:null,new un(a))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iX="AsyncQueue";class sX{constructor(t=Promise.resolve()){this.Vu=[],this.mu=!1,this.fu=[],this.gu=null,this.pu=!1,this.yu=!1,this.wu=[],this.a_=new Sre(this,"async_queue_retry"),this.bu=()=>{const a=d2();a&&Kt(iX,"Visibility state changed to "+a.visibilityState),this.a_.t_()},this.Su=t;const s=d2();s&&typeof s.addEventListener=="function"&&s.addEventListener("visibilitychange",this.bu)}get isShuttingDown(){return this.mu}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.Du(),this.vu(t)}enterRestrictedMode(t){if(!this.mu){this.mu=!0,this.yu=t||!1;const s=d2();s&&typeof s.removeEventListener=="function"&&s.removeEventListener("visibilitychange",this.bu)}}enqueue(t){if(this.Du(),this.mu)return new Promise(()=>{});const s=new ep;return this.vu(()=>this.mu&&this.yu?Promise.resolve():(t().then(s.resolve,s.reject),s.promise)).then(()=>s.promise)}enqueueRetryable(t){this.enqueueAndForget(()=>(this.Vu.push(t),this.Cu()))}async Cu(){if(this.Vu.length!==0){try{await this.Vu[0](),this.Vu.shift(),this.a_.reset()}catch(t){if(!nT(t))throw t;Kt(iX,"Operation failed with retryable error: "+t)}this.Vu.length>0&&this.a_.Xo(()=>this.Cu())}}vu(t){const s=this.Su.then(()=>(this.pu=!0,t().catch(a=>{this.gu=a,this.pu=!1;const l=function(p){let E=p.message||"";return p.stack&&(E=p.stack.includes(p.message)?p.stack:p.message+`
`+p.stack),E}(a);throw op("INTERNAL UNHANDLED ERROR: ",l),a}).then(a=>(this.pu=!1,a))));return this.Su=s,s}enqueueAfterDelay(t,s,a){this.Du(),this.wu.indexOf(t)>-1&&(s=0);const l=cj.createAndSchedule(this,t,s,a,d=>this.Fu(d));return this.fu.push(l),l}Du(){this.gu&&Un()}verifyOperationInProgress(){}async Mu(){let t;do t=this.Su,await t;while(t!==this.Su)}xu(t){for(const s of this.fu)if(s.timerId===t)return!0;return!1}Ou(t){return this.Mu().then(()=>{this.fu.sort((s,a)=>s.targetTimeMs-a.targetTimeMs);for(const s of this.fu)if(s.skipDelay(),t!=="all"&&s.timerId===t)break;return this.Mu()})}Nu(t){this.wu.push(t)}Fu(t){const s=this.fu.indexOf(t);this.fu.splice(s,1)}}function oX(r){return function(s,a){if(typeof s!="object"||s===null)return!1;const l=s;for(const d of a)if(d in l&&typeof l[d]=="function")return!0;return!1}(r,["next","error","complete"])}class sE extends pk{constructor(t,s,a,l){super(t,s,a,l),this.type="firestore",this._queue=new sX,this._persistenceKey=(l==null?void 0:l.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const t=this._firestoreClient.terminate();this._queue=new sX(t),this._firestoreClient=void 0,await t}}}function hBe(r,t){const s=typeof r=="object"?r:xF(),a=typeof r=="string"?r:rN,l=XN(s,"firestore").getImmediate({identifier:a});if(!l._initialized){const d=Dte("firestore");d&&dBe(l,...d)}return l}function mk(r){if(r._terminated)throw new Mt(ct.FAILED_PRECONDITION,"The client has already been terminated.");return r._firestoreClient||fBe(r),r._firestoreClient}function fBe(r){var t,s,a;const l=r._freezeSettings(),d=function(E,v,b,R){return new MVe(E,v,b,R.host,R.ssl,R.experimentalForceLongPolling,R.experimentalAutoDetectLongPolling,Vre(R.experimentalLongPollingOptions),R.useFetchStreams)}(r._databaseId,((t=r._app)===null||t===void 0?void 0:t.options.appId)||"",r._persistenceKey,l);r._componentsProvider||!((s=l.localCache)===null||s===void 0)&&s._offlineComponentProvider&&(!((a=l.localCache)===null||a===void 0)&&a._onlineComponentProvider)&&(r._componentsProvider={_offline:l.localCache._offlineComponentProvider,_online:l.localCache._onlineComponentProvider}),r._firestoreClient=new sBe(r._authCredentials,r._appCheckCredentials,r._queue,d,r._componentsProvider&&function(E){const v=E==null?void 0:E._online.build();return{_offline:E==null?void 0:E._offline.build(v),_online:v}}(r._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jS{constructor(t){this._byteString=t}static fromBase64String(t){try{return new jS($o.fromBase64String(t))}catch(s){throw new Mt(ct.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+s)}}static fromUint8Array(t){return new jS($o.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gk{constructor(...t){for(let s=0;s<t.length;++s)if(t[s].length===0)throw new Mt(ct.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new qo(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _j{constructor(t){this._methodName=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ej{constructor(t,s){if(!isFinite(t)||t<-90||t>90)throw new Mt(ct.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(s)||s<-180||s>180)throw new Mt(ct.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+s);this._lat=t,this._long=s}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return wr(this._lat,t._lat)||wr(this._long,t._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yj{constructor(t){this._values=(t||[]).map(s=>s)}toArray(){return this._values.map(t=>t)}isEqual(t){return function(a,l){if(a.length!==l.length)return!1;for(let d=0;d<a.length;++d)if(a[d]!==l[d])return!1;return!0}(this._values,t._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pBe=/^__.*__$/;class mBe{constructor(t,s,a){this.data=t,this.fieldMask=s,this.fieldTransforms=a}toMutation(t,s){return this.fieldMask!==null?new tg(t,this.data,this.fieldMask,s,this.fieldTransforms):new AR(t,this.data,s,this.fieldTransforms)}}class Wre{constructor(t,s,a){this.data=t,this.fieldMask=s,this.fieldTransforms=a}toMutation(t,s){return new tg(t,this.data,this.fieldMask,s,this.fieldTransforms)}}function Gre(r){switch(r){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Un()}}class vj{constructor(t,s,a,l,d,p){this.settings=t,this.databaseId=s,this.serializer=a,this.ignoreUndefinedProperties=l,d===void 0&&this.Bu(),this.fieldTransforms=d||[],this.fieldMask=p||[]}get path(){return this.settings.path}get Lu(){return this.settings.Lu}ku(t){return new vj(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}qu(t){var s;const a=(s=this.path)===null||s===void 0?void 0:s.child(t),l=this.ku({path:a,Qu:!1});return l.$u(t),l}Ku(t){var s;const a=(s=this.path)===null||s===void 0?void 0:s.child(t),l=this.ku({path:a,Qu:!1});return l.Bu(),l}Uu(t){return this.ku({path:void 0,Qu:!0})}Wu(t){return fN(t,this.settings.methodName,this.settings.Gu||!1,this.path,this.settings.zu)}contains(t){return this.fieldMask.find(s=>t.isPrefixOf(s))!==void 0||this.fieldTransforms.find(s=>t.isPrefixOf(s.field))!==void 0}Bu(){if(this.path)for(let t=0;t<this.path.length;t++)this.$u(this.path.get(t))}$u(t){if(t.length===0)throw this.Wu("Document fields must not be empty");if(Gre(this.Lu)&&pBe.test(t))throw this.Wu('Document fields cannot begin and end with "__"')}}class gBe{constructor(t,s,a){this.databaseId=t,this.ignoreUndefinedProperties=s,this.serializer=a||uk(t)}ju(t,s,a,l=!1){return new vj({Lu:t,methodName:s,zu:a,path:qo.emptyPath(),Qu:!1,Gu:l},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function _k(r){const t=r._freezeSettings(),s=uk(r._databaseId);return new gBe(r._databaseId,!!t.ignoreUndefinedProperties,s)}function _Be(r,t,s,a,l,d={}){const p=r.ju(d.merge||d.mergeFields?2:0,t,s,l);Sj("Data must be an object, but it was:",p,a);const E=Hre(a,p);let v,b;if(d.merge)v=new hl(p.fieldMask),b=p.fieldTransforms;else if(d.mergeFields){const R=[];for(const O of d.mergeFields){const N=qU(t,O,s);if(!p.contains(N))throw new Mt(ct.INVALID_ARGUMENT,`Field '${N}' is specified in your field mask but missing from your input data.`);qre(R,N)||R.push(N)}v=new hl(R),b=p.fieldTransforms.filter(O=>v.covers(O.field))}else v=null,b=p.fieldTransforms;return new mBe(new Lc(E),v,b)}class Ek extends _j{_toFieldTransform(t){if(t.Lu!==2)throw t.Lu===1?t.Wu(`${this._methodName}() can only appear at the top level of your update data`):t.Wu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof Ek}}function EBe(r,t,s,a){const l=r.ju(1,t,s);Sj("Data must be an object, but it was:",l,a);const d=[],p=Lc.empty();eg(a,(v,b)=>{const R=Tj(t,v,s);b=Qi(b);const O=l.Ku(R);if(b instanceof Ek)d.push(R);else{const N=kR(b,O);N!=null&&(d.push(R),p.set(R,N))}});const E=new hl(d);return new Wre(p,E,l.fieldTransforms)}function yBe(r,t,s,a,l,d){const p=r.ju(1,t,s),E=[qU(t,a,s)],v=[l];if(d.length%2!=0)throw new Mt(ct.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let N=0;N<d.length;N+=2)E.push(qU(t,d[N])),v.push(d[N+1]);const b=[],R=Lc.empty();for(let N=E.length-1;N>=0;--N)if(!qre(b,E[N])){const F=E[N];let H=v[N];H=Qi(H);const z=p.Ku(F);if(H instanceof Ek)b.push(F);else{const G=kR(H,z);G!=null&&(b.push(F),R.set(F,G))}}const O=new hl(b);return new Wre(R,O,p.fieldTransforms)}function zre(r,t,s,a=!1){return kR(s,r.ju(a?4:3,t))}function kR(r,t){if(Kre(r=Qi(r)))return Sj("Unsupported field value:",t,r),Hre(r,t);if(r instanceof _j)return function(a,l){if(!Gre(l.Lu))throw l.Wu(`${a._methodName}() can only be used with update() and set()`);if(!l.path)throw l.Wu(`${a._methodName}() is not currently supported inside arrays`);const d=a._toFieldTransform(l);d&&l.fieldTransforms.push(d)}(r,t),null;if(r===void 0&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),r instanceof Array){if(t.settings.Qu&&t.Lu!==4)throw t.Wu("Nested arrays are not supported");return function(a,l){const d=[];let p=0;for(const E of a){let v=kR(E,l.Uu(p));v==null&&(v={nullValue:"NULL_VALUE"}),d.push(v),p++}return{arrayValue:{values:d}}}(r,t)}return function(a,l){if((a=Qi(a))===null)return{nullValue:"NULL_VALUE"};if(typeof a=="number")return sFe(l.serializer,a);if(typeof a=="boolean")return{booleanValue:a};if(typeof a=="string")return{stringValue:a};if(a instanceof Date){const d=Xs.fromDate(a);return{timestampValue:cN(l.serializer,d)}}if(a instanceof Xs){const d=new Xs(a.seconds,1e3*Math.floor(a.nanoseconds/1e3));return{timestampValue:cN(l.serializer,d)}}if(a instanceof Ej)return{geoPointValue:{latitude:a.latitude,longitude:a.longitude}};if(a instanceof jS)return{bytesValue:ure(l.serializer,a._byteString)};if(a instanceof ba){const d=l.databaseId,p=a.firestore._databaseId;if(!p.isEqual(d))throw l.Wu(`Document reference is for database ${p.projectId}/${p.database} but should be for database ${d.projectId}/${d.database}`);return{referenceValue:ZF(a.firestore._databaseId||l.databaseId,a._key.path)}}if(a instanceof yj)return function(p,E){return{mapValue:{fields:{[Fne]:{stringValue:jne},[iN]:{arrayValue:{values:p.toArray().map(b=>{if(typeof b!="number")throw E.Wu("VectorValues must only contain numeric values.");return XF(E.serializer,b)})}}}}}}(a,l);throw l.Wu(`Unsupported field value: ${fk(a)}`)}(r,t)}function Hre(r,t){const s={};return Dne(r)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):eg(r,(a,l)=>{const d=kR(l,t.qu(a));d!=null&&(s[a]=d)}),{mapValue:{fields:s}}}function Kre(r){return!(typeof r!="object"||r===null||r instanceof Array||r instanceof Date||r instanceof Xs||r instanceof Ej||r instanceof jS||r instanceof ba||r instanceof _j||r instanceof yj)}function Sj(r,t,s){if(!Kre(s)||!function(l){return typeof l=="object"&&l!==null&&(Object.getPrototypeOf(l)===Object.prototype||Object.getPrototypeOf(l)===null)}(s)){const a=fk(s);throw a==="an object"?t.Wu(r+" a custom object"):t.Wu(r+" "+a)}}function qU(r,t,s){if((t=Qi(t))instanceof gk)return t._internalPath;if(typeof t=="string")return Tj(r,t);throw fN("Field path arguments must be of type string or ",r,!1,void 0,s)}const vBe=new RegExp("[~\\*/\\[\\]]");function Tj(r,t,s){if(t.search(vBe)>=0)throw fN(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,r,!1,void 0,s);try{return new gk(...t.split("."))._internalPath}catch{throw fN(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,r,!1,void 0,s)}}function fN(r,t,s,a,l){const d=a&&!a.isEmpty(),p=l!==void 0;let E=`Function ${t}() called with invalid data`;s&&(E+=" (via `toFirestore()`)"),E+=". ";let v="";return(d||p)&&(v+=" (found",d&&(v+=` in field ${a}`),p&&(v+=` in document ${l}`),v+=")"),new Mt(ct.INVALID_ARGUMENT,E+r+v)}function qre(r,t){return r.some(s=>s.isEqual(t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bj{constructor(t,s,a,l,d){this._firestore=t,this._userDataWriter=s,this._key=a,this._document=l,this._converter=d}get id(){return this._key.path.lastSegment()}get ref(){return new ba(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const t=new SBe(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const s=this._document.data.field(wj("DocumentSnapshot.get",t));if(s!==null)return this._userDataWriter.convertValue(s)}}}class SBe extends bj{data(){return super.data()}}function wj(r,t){return typeof t=="string"?Tj(r,t):t instanceof gk?t._internalPath:t._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $re(r){if(r.limitType==="L"&&r.explicitOrderBy.length===0)throw new Mt(ct.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Rj{}class Cj extends Rj{}function TBe(r,t,...s){let a=[];t instanceof Rj&&a.push(t),a=a.concat(s),function(d){const p=d.filter(v=>v instanceof Aj).length,E=d.filter(v=>v instanceof Ij).length;if(p>1||p>0&&E>0)throw new Mt(ct.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(a);for(const l of a)r=l._apply(r);return r}class Ij extends Cj{constructor(t,s,a){super(),this._field=t,this._op=s,this._value=a,this.type="where"}static _create(t,s,a){return new Ij(t,s,a)}_apply(t){const s=this._parse(t);return Yre(t._query,s),new lp(t.firestore,t.converter,MU(t._query,s))}_parse(t){const s=_k(t.firestore);return function(d,p,E,v,b,R,O){let N;if(b.isKeyField()){if(R==="array-contains"||R==="array-contains-any")throw new Mt(ct.INVALID_ARGUMENT,`Invalid Query. You can't perform '${R}' queries on documentId().`);if(R==="in"||R==="not-in"){cX(O,R);const H=[];for(const z of O)H.push(aX(v,d,z));N={arrayValue:{values:H}}}else N=aX(v,d,O)}else R!=="in"&&R!=="not-in"&&R!=="array-contains-any"||cX(O,R),N=zre(E,p,O,R==="in"||R==="not-in");return Ms.create(b,R,N)}(t._query,"where",s,t.firestore._databaseId,this._field,this._op,this._value)}}class Aj extends Rj{constructor(t,s){super(),this.type=t,this._queryConstraints=s}static _create(t,s){return new Aj(t,s)}_parse(t){const s=this._queryConstraints.map(a=>a._parse(t)).filter(a=>a.getFilters().length>0);return s.length===1?s[0]:ud.create(s,this._getOperator())}_apply(t){const s=this._parse(t);return s.getFilters().length===0?t:(function(l,d){let p=l;const E=d.getFlattenedFilters();for(const v of E)Yre(p,v),p=MU(p,v)}(t._query,s),new lp(t.firestore,t.converter,MU(t._query,s)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class Oj extends Cj{constructor(t,s){super(),this._field=t,this._direction=s,this.type="orderBy"}static _create(t,s){return new Oj(t,s)}_apply(t){const s=function(l,d,p){if(l.startAt!==null)throw new Mt(ct.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(l.endAt!==null)throw new Mt(ct.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new eR(d,p)}(t._query,this._field,this._direction);return new lp(t.firestore,t.converter,function(l,d){const p=l.explicitOrderBy.concat([d]);return new dE(l.path,l.collectionGroup,p,l.filters.slice(),l.limit,l.limitType,l.startAt,l.endAt)}(t._query,s))}}function bBe(r,t="asc"){const s=t,a=wj("orderBy",r);return Oj._create(a,s)}class Pj extends Cj{constructor(t,s,a){super(),this.type=t,this._docOrFields=s,this._inclusive=a}static _create(t,s,a){return new Pj(t,s,a)}_apply(t){const s=RBe(t,this.type,this._docOrFields,this._inclusive);return new lp(t.firestore,t.converter,function(l,d){return new dE(l.path,l.collectionGroup,l.explicitOrderBy.slice(),l.filters.slice(),l.limit,l.limitType,d,l.endAt)}(t._query,s))}}function wBe(...r){return Pj._create("startAt",r,!0)}function RBe(r,t,s,a){if(s[0]=Qi(s[0]),s[0]instanceof bj)return function(d,p,E,v,b){if(!v)throw new Mt(ct.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${E}().`);const R=[];for(const O of _S(d))if(O.field.isKeyField())R.push(sN(p,v.key));else{const N=v.data.field(O.field);if(nk(N))throw new Mt(ct.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+O.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(N===null){const F=O.field.canonicalString();throw new Mt(ct.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${F}' (used as the orderBy) does not exist.`)}R.push(N)}return new MS(R,b)}(r._query,r.firestore._databaseId,t,s[0]._document,a);{const l=_k(r.firestore);return function(p,E,v,b,R,O){const N=p.explicitOrderBy;if(R.length>N.length)throw new Mt(ct.INVALID_ARGUMENT,`Too many arguments provided to ${b}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const F=[];for(let H=0;H<R.length;H++){const z=R[H];if(N[H].field.isKeyField()){if(typeof z!="string")throw new Mt(ct.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${b}(), but got a ${typeof z}`);if(!YF(p)&&z.indexOf("/")!==-1)throw new Mt(ct.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${b}() must be a plain document ID, but '${z}' contains a slash.`);const G=p.path.child(bi.fromString(z));if(!un.isDocumentKey(G))throw new Mt(ct.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${b}() must result in a valid document path, but '${G}' is not because it contains an odd number of segments.`);const ee=new un(G);F.push(sN(E,ee))}else{const G=zre(v,b,z);F.push(G)}}return new MS(F,O)}(r._query,r.firestore._databaseId,l,t,s,a)}}function aX(r,t,s){if(typeof(s=Qi(s))=="string"){if(s==="")throw new Mt(ct.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!YF(t)&&s.indexOf("/")!==-1)throw new Mt(ct.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${s}' contains a '/' character.`);const a=t.path.child(bi.fromString(s));if(!un.isDocumentKey(a))throw new Mt(ct.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${a}' is not because it has an odd number of segments (${a.length}).`);return sN(r,new un(a))}if(s instanceof ba)return sN(r,s._key);throw new Mt(ct.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${fk(s)}.`)}function cX(r,t){if(!Array.isArray(r)||r.length===0)throw new Mt(ct.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function Yre(r,t){const s=function(l,d){for(const p of l)for(const E of p.getFlattenedFilters())if(d.indexOf(E.op)>=0)return E.op;return null}(r.filters,function(l){switch(l){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(s!==null)throw s===t.op?new Mt(ct.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new Mt(ct.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${s.toString()}' filters.`)}class CBe{convertValue(t,s="none"){switch(zm(t)){case 0:return null;case 1:return t.booleanValue;case 2:return bs(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,s);case 5:return t.stringValue;case 6:return this.convertBytes(Gm(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,s);case 11:return this.convertObject(t.mapValue,s);case 10:return this.convertVectorValue(t.mapValue);default:throw Un()}}convertObject(t,s){return this.convertObjectMap(t.fields,s)}convertObjectMap(t,s="none"){const a={};return eg(t,(l,d)=>{a[l]=this.convertValue(d,s)}),a}convertVectorValue(t){var s,a,l;const d=(l=(a=(s=t.fields)===null||s===void 0?void 0:s[iN].arrayValue)===null||a===void 0?void 0:a.values)===null||l===void 0?void 0:l.map(p=>bs(p.doubleValue));return new yj(d)}convertGeoPoint(t){return new Ej(bs(t.latitude),bs(t.longitude))}convertArray(t,s){return(t.values||[]).map(a=>this.convertValue(a,s))}convertServerTimestamp(t,s){switch(s){case"previous":const a=rk(t);return a==null?null:this.convertValue(a,s);case"estimate":return this.convertTimestamp(Jw(t));default:return null}}convertTimestamp(t){const s=Wm(t);return new Xs(s.seconds,s.nanos)}convertDocumentKey(t,s){const a=bi.fromString(t);ei(gre(a));const l=new Qw(a.get(1),a.get(3)),d=new un(a.popFirst(5));return l.isEqual(s)||op(`Document ${d} contains a document reference within a different database (${l.projectId}/${l.database}) which is not supported. It will be treated as a reference in the current database (${s.projectId}/${s.database}) instead.`),d}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function IBe(r,t,s){let a;return a=r?r.toFirestore(t):t,a}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ow{constructor(t,s){this.hasPendingWrites=t,this.fromCache=s}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class Xre extends bj{constructor(t,s,a,l,d,p){super(t,s,a,l,p),this._firestore=t,this._firestoreImpl=t,this.metadata=d}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const s=new PP(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(s,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,s={}){if(this._document){const a=this._document.data.field(wj("DocumentSnapshot.get",t));if(a!==null)return this._userDataWriter.convertValue(a,s.serverTimestamps)}}}class PP extends Xre{data(t={}){return super.data(t)}}class Jre{constructor(t,s,a,l){this._firestore=t,this._userDataWriter=s,this._snapshot=l,this.metadata=new ow(l.hasPendingWrites,l.fromCache),this.query=a}get docs(){const t=[];return this.forEach(s=>t.push(s)),t}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(t,s){this._snapshot.docs.forEach(a=>{t.call(s,new PP(this._firestore,this._userDataWriter,a.key,a,new ow(this._snapshot.mutatedKeys.has(a.key),this._snapshot.fromCache),this.query.converter))})}docChanges(t={}){const s=!!t.includeMetadataChanges;if(s&&this._snapshot.excludesMetadataChanges)throw new Mt(ct.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===s||(this._cachedChanges=function(l,d){if(l._snapshot.oldDocs.isEmpty()){let p=0;return l._snapshot.docChanges.map(E=>{const v=new PP(l._firestore,l._userDataWriter,E.doc.key,E.doc,new ow(l._snapshot.mutatedKeys.has(E.doc.key),l._snapshot.fromCache),l.query.converter);return E.doc,{type:"added",doc:v,oldIndex:-1,newIndex:p++}})}{let p=l._snapshot.oldDocs;return l._snapshot.docChanges.filter(E=>d||E.type!==3).map(E=>{const v=new PP(l._firestore,l._userDataWriter,E.doc.key,E.doc,new ow(l._snapshot.mutatedKeys.has(E.doc.key),l._snapshot.fromCache),l.query.converter);let b=-1,R=-1;return E.type!==0&&(b=p.indexOf(E.doc.key),p=p.delete(E.doc.key)),E.type!==1&&(p=p.add(E.doc),R=p.indexOf(E.doc.key)),{type:ABe(E.type),doc:v,oldIndex:b,newIndex:R}})}}(this,s),this._cachedChangesIncludeMetadataChanges=s),this._cachedChanges}}function ABe(r){switch(r){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Un()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $U(r){r=lu(r,ba);const t=lu(r.firestore,sE);return cBe(mk(t),r._key).then(s=>tie(t,r,s))}class Nj extends CBe{constructor(t){super(),this.firestore=t}convertBytes(t){return new jS(t)}convertReference(t){const s=this.convertDocumentKey(t,this.firestore._databaseId);return new ba(this.firestore,null,s)}}function OBe(r){r=lu(r,lp);const t=lu(r.firestore,sE),s=mk(t),a=new Nj(t);return $re(r._query),lBe(s,r._query).then(l=>new Jre(t,a,r,l))}function PBe(r,t,s){r=lu(r,ba);const a=lu(r.firestore,sE),l=IBe(r.converter,t);return eie(a,[_Be(_k(a),"setDoc",r._key,l,r.converter!==null,s).toMutation(r._key,Ih.none())])}function Qre(r,t,s,...a){r=lu(r,ba);const l=lu(r.firestore,sE),d=_k(l);let p;return p=typeof(t=Qi(t))=="string"||t instanceof gk?yBe(d,"updateDoc",r._key,t,s,a):EBe(d,"updateDoc",r._key,t),eie(l,[p.toMutation(r._key,Ih.exists(!0))])}function Zre(r,...t){var s,a,l;r=Qi(r);let d={includeMetadataChanges:!1,source:"default"},p=0;typeof t[p]!="object"||oX(t[p])||(d=t[p],p++);const E={includeMetadataChanges:d.includeMetadataChanges,source:d.source};if(oX(t[p])){const O=t[p];t[p]=(s=O.next)===null||s===void 0?void 0:s.bind(O),t[p+1]=(a=O.error)===null||a===void 0?void 0:a.bind(O),t[p+2]=(l=O.complete)===null||l===void 0?void 0:l.bind(O)}let v,b,R;if(r instanceof ba)b=lu(r.firestore,sE),R=ik(r._key.path),v={next:O=>{t[p]&&t[p](tie(b,r,O))},error:t[p+1],complete:t[p+2]};else{const O=lu(r,lp);b=lu(O.firestore,sE),R=O._query;const N=new Nj(b);v={next:F=>{t[p]&&t[p](new Jre(b,N,O,F))},error:t[p+1],complete:t[p+2]},$re(r._query)}return function(N,F,H,z){const G=new gj(z),ee=new fj(F,G,H);return N.asyncQueue.enqueueAndForget(async()=>uj(await hN(N),ee)),()=>{G.su(),N.asyncQueue.enqueueAndForget(async()=>dj(await hN(N),ee))}}(mk(b),R,E,v)}function eie(r,t){return function(a,l){const d=new ep;return a.asyncQueue.enqueueAndForget(async()=>Xje(await aBe(a),l,d)),d.promise}(mk(r),t)}function tie(r,t,s){const a=s.docs.get(t._key),l=new Nj(r);return new Xre(r,l,t._key,a,new ow(s.hasPendingWrites,s.fromCache),t.converter)}(function(t,s=!0){(function(l){eT=l})(lE),eE(new jm("firestore",(a,{instanceIdentifier:l,options:d})=>{const p=a.getProvider("app").getImmediate(),E=new sE(new vVe(a.getProvider("auth-internal")),new bVe(p,a.getProvider("app-check-internal")),function(b,R){if(!Object.prototype.hasOwnProperty.apply(b.options,["projectId"]))throw new Mt(ct.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Qw(b.options.projectId,R)}(p,l),p);return d=Object.assign({useFetchStreams:s},d),E._setSettings(d),E},"PUBLIC").setMultipleInstances(!0)),bh(hY,fY,t),bh(hY,fY,"esm2017")})();var NBe="firebase",kBe="11.4.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */bh(NBe,kBe,"app");const DBe={apiKey:"AIzaSyCaxoNKRIMaXhotGzdAjXc5gkARoqtS3bU",authDomain:"disruptive-metaverse.firebaseapp.com",projectId:"disruptive-metaverse",storageBucket:"disruptive-metaverse.appspot.com",messagingSenderId:"294433070603",appId:"1:294433070603:web:136cddd196eea9614fb10e"},nie=Fte(DBe),LBe=bne(nie),qm=hBe(nie),$m=async r=>{try{Rt.log("userFirestore: Get user Profile data for user ID: "+r);const t=FS(qm,"users",r),s=await $U(t);return s.exists()?(Rt.log("userFirestore: Found Profile for : "+s.data().Nickname),s.data()):(Rt.error("userFirestore: user profile document not found"),null)}catch(t){throw Rt.error("userFirestore: Error fetching user profile data:",t),t}},xBe=async(r,t,s)=>{try{const l=(await tUe(LBe,r,t)).user,d=FS(qm,"users",l.uid);return await PBe(d,{email:l.email,createdAt:new Date,...s}),Rt.log("userFirestore: User created successfully."),l}catch(a){throw Rt.error("userFirestore: Error creating user:",a),a}},rie=async(r,t)=>{try{Rt.log(`userFirestore: Updating rpmURL for user ID: ${r}`);const s=FS(qm,"users",r);await Qre(s,{rpmURL:t,lastUpdated:new Date().toISOString()}),Rt.log("userFirestore: rpmURL updated successfully.")}catch(s){throw Rt.error("userFirestore: Error updating rpmURL:",s),s}},MBe=["email","name","rpmURL","Nickname","created_on","height_cm","companyName","firstName","lastName","linkedInProfile"],aw={sendUserToUnity:"sendUserToUnity"};class UBe{constructor(){this.events={}}subscribe(t,s){this.events[t]||(this.events[t]=[]),this.events[t].push(s)}publish(t,s){const a=this.events[t];a?(a.forEach(l=>{l(s)}),Rt.log(`EventBus: Published event '${t}'`)):Rt.log(`EventBus: No subscribers for event '${t}'`)}unsubscribe(t,s){var l;const a=(l=this.events[t])==null?void 0:l.indexOf(s);a>-1&&this.events[t].splice(a,1)}}const cw=new UBe,Ra=V.createContext(null),yk=({children:r})=>{const[t,s]=V.useState(null),a=V.useRef(null),[l,d]=V.useState(!0),p=bne(),E=G=>G?G.Nickname?G.Nickname:`${G.firstName} ${G.lastName}`:"Anon";V.useEffect(()=>{const G=sUe(p,async ee=>{if(Rt.log("UserProvider: Firebase onAuthStateChanged() fired"),ee)try{const J=await $m(ee.uid),re=E(J),de={uid:ee.uid,email:ee.email,...J,displayName:re};console.log(de),s(de),a.current=de,O(de)}catch(J){Rt.error("UserProvider: Error fetching user profile data:",J)}else s(null),a.current=null;d(!1)});return()=>{G&&G()}},[]);const v=async(G,ee,J)=>{try{const{firstName:re,lastName:de}=J,se=`${re}${de.charAt(0).toUpperCase()}`,ye={...J,Nickname:se,rpmURL:"https://models.readyplayer.me/67c8408d38f7924e15a8bd0a.glb"},Q=await xBe(G,ee,ye);s(Q),a.current=Q}catch(re){throw Rt.error("UserProvider: Error creating user:",re),re}},b=async(G,ee)=>{try{const J=await nUe(p,G,ee),re=await $m(J.user.uid),de=E(re),se={uid:J.user.uid,email:J.user.email,...re,displayName:de};s(se),O(se)}catch(J){throw Rt.error("UserProvider: Error signing in:",J),J}},R=async()=>{try{await oUe(p),s(null),Rt.log("UserProvider: User signed out.")}catch(G){throw Rt.error("UserProvider: Error signing out:",G),G}},O=()=>{const G=a.current;if(G){const ee=N(G);Rt.log("UserProvider: sendUserToUnity() using the eventBus",ee),cw.publish(aw.sendUserToUnity,ee)}else Rt.log("UserProvider: No current user to send to Unity.")},N=G=>{const ee={};return[...MBe,"uid"].forEach(re=>{G.hasOwnProperty(re)&&(ee[re]=G[re])}),ee},F=async G=>{if(!t||!t.uid)return!1;try{const ee=await getSpaceItem(G);return ee.usersAllowed.includes(t.uid)||ee.userAdmin.includes(t.uid)||ee.usersModerators.includes(t.uid)}catch(ee){return Rt.error("UserProvider: Error verifying user access to space:",ee),!1}},H=async G=>{if(!t||!t.uid)return!1;try{return(await getSpaceItem(G)).userAdmin.includes(t.uid)}catch(ee){return Rt.error("UserProvider: Error verifying user admin status for space:",ee),!1}},z=async G=>{if(!t||!t.uid)return!1;try{return(await getSpaceItem(G)).usersModerators.includes(t.uid)}catch(ee){return Rt.error("UserProvider: Error verifying user moderator status for space:",ee),!1}};return D.jsx(Ra.Provider,{value:{user:t,loading:l,register:v,signIn:b,signOut:R,sendUserToUnity:O,userHasAccessToSpace:F,userIsAdminOfSpace:H,userIsModeratorOfSpace:z},children:r})},iie=V.createContext(),up=()=>V.useContext(iie),kj=({children:r})=>{const[t,s]=V.useState(!1),a=V.useRef(null),[l,d]=V.useState(!1);V.useEffect(()=>{const v=()=>{const b=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent);d(b)};return v(),window.addEventListener("resize",v),()=>window.removeEventListener("resize",v)},[]);const p=V.useCallback(v=>{a.current=v},[]),E=V.useCallback(()=>{const v=a.current;if(!v)return;const b=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;if(l){console.log("Attempting mobile fullscreen...");const R=v.querySelector("video")||v;if(/iPhone|iPad|iPod/i.test(navigator.userAgent)){if(R.webkitEnterFullscreen)try{R.webkitEnterFullscreen(),s(!0);return}catch(O){console.error("iOS fullscreen error:",O)}try{if(R.webkitRequestFullscreen){R.webkitRequestFullscreen(),s(!0);return}}catch(O){console.error("iOS fallback fullscreen error:",O)}}if(/Android/i.test(navigator.userAgent))try{b?(document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen(),s(!1)):(v.requestFullscreen?v.requestFullscreen():v.webkitRequestFullscreen?v.webkitRequestFullscreen():v.mozRequestFullScreen?v.mozRequestFullScreen():v.msRequestFullscreen&&v.msRequestFullscreen(),s(!0));return}catch(O){console.error("Android fullscreen error:",O)}}try{b?document.exitFullscreen?document.exitFullscreen().then(()=>{s(!1)}).catch(R=>console.error("Error exiting fullscreen:",R)):document.webkitExitFullscreen?(document.webkitExitFullscreen(),s(!1)):document.mozCancelFullScreen?(document.mozCancelFullScreen(),s(!1)):document.msExitFullscreen&&(document.msExitFullscreen(),s(!1)):v.requestFullscreen?v.requestFullscreen().then(()=>{s(!0)}).catch(R=>console.error("Error entering fullscreen:",R)):v.webkitRequestFullscreen?(v.webkitRequestFullscreen(),s(!0)):v.mozRequestFullScreen?(v.mozRequestFullScreen(),s(!0)):v.msRequestFullscreen&&(v.msRequestFullscreen(),s(!0))}catch(R){console.error("Fullscreen error:",R)}},[l]);return V.useEffect(()=>{const v=()=>{const b=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;s(!!b)};return document.addEventListener("fullscreenchange",v),document.addEventListener("webkitfullscreenchange",v),document.addEventListener("mozfullscreenchange",v),document.addEventListener("MSFullscreenChange",v),()=>{document.removeEventListener("fullscreenchange",v),document.removeEventListener("webkitfullscreenchange",v),document.removeEventListener("mozfullscreenchange",v),document.removeEventListener("MSFullscreenChange",v)}},[]),D.jsx(iie.Provider,{value:{isFullscreen:t,toggleFullscreen:E,fullscreenRef:a,setFullscreenRef:p,isMobile:l},children:D.jsx("div",{ref:p,style:{position:"relative",zIndex:1,width:"100%",height:"100%",overflow:"hidden"},children:r})})},VBe=XS({d:"M19.5,9.5h-.75V6.75a6.75,6.75,0,0,0-13.5,0V9.5H4.5a2,2,0,0,0-2,2V22a2,2,0,0,0,2,2h15a2,2,0,0,0,2-2V11.5A2,2,0,0,0,19.5,9.5Zm-9.5,6a2,2,0,1,1,3,1.723V19.5a1,1,0,0,1-2,0V17.223A1.994,1.994,0,0,1,10,15.5ZM7.75,6.75a4.25,4.25,0,0,1,8.5,0V9a.5.5,0,0,1-.5.5H8.25a.5.5,0,0,1-.5-.5Z",displayName:"LockIcon"}),FBe=XS({displayName:"ChevronDownIcon",d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"}),jBe=XS({displayName:"EmailIcon",path:D.jsxs("g",{fill:"currentColor",children:[D.jsx("path",{d:"M11.114,14.556a1.252,1.252,0,0,0,1.768,0L22.568,4.87a.5.5,0,0,0-.281-.849A1.966,1.966,0,0,0,22,4H2a1.966,1.966,0,0,0-.289.021.5.5,0,0,0-.281.849Z"}),D.jsx("path",{d:"M23.888,5.832a.182.182,0,0,0-.2.039l-6.2,6.2a.251.251,0,0,0,0,.354l5.043,5.043a.75.75,0,1,1-1.06,1.061l-5.043-5.043a.25.25,0,0,0-.354,0l-2.129,2.129a2.75,2.75,0,0,1-3.888,0L7.926,13.488a.251.251,0,0,0-.354,0L2.529,18.531a.75.75,0,0,1-1.06-1.061l5.043-5.043a.251.251,0,0,0,0-.354l-6.2-6.2a.18.18,0,0,0-.2-.039A.182.182,0,0,0,0,6V18a2,2,0,0,0,2,2H22a2,2,0,0,0,2-2V6A.181.181,0,0,0,23.888,5.832Z"})]})}),BBe=XS({displayName:"CloseIcon",d:"M.439,21.44a1.5,1.5,0,0,0,2.122,2.121L11.823,14.3a.25.25,0,0,1,.354,0l9.262,9.263a1.5,1.5,0,1,0,2.122-2.121L14.3,12.177a.25.25,0,0,1,0-.354l9.263-9.262A1.5,1.5,0,0,0,21.439.44L12.177,9.7a.25.25,0,0,1-.354,0L2.561.44A1.5,1.5,0,0,0,.439,2.561L9.7,11.823a.25.25,0,0,1,0,.354Z"}),WBe=XS({displayName:"QuestionOutlineIcon",path:D.jsxs("g",{stroke:"currentColor",strokeWidth:"1.5",children:[D.jsx("path",{strokeLinecap:"round",fill:"none",d:"M9,9a3,3,0,1,1,4,2.829,1.5,1.5,0,0,0-1,1.415V14.25"}),D.jsx("path",{fill:"none",strokeLinecap:"round",d:"M12,17.25a.375.375,0,1,0,.375.375A.375.375,0,0,0,12,17.25h0"}),D.jsx("circle",{fill:"none",strokeMiterlimit:"10",cx:"12",cy:"12",r:"11.25"})]})}),GBe=XS({displayName:"HamburgerIcon",viewBox:"0 0 24 24",d:"M 3 5 A 1.0001 1.0001 0 1 0 3 7 L 21 7 A 1.0001 1.0001 0 1 0 21 5 L 3 5 z M 3 11 A 1.0001 1.0001 0 1 0 3 13 L 21 13 A 1.0001 1.0001 0 1 0 21 11 L 3 11 z M 3 17 A 1.0001 1.0001 0 1 0 3 19 L 21 19 A 1.0001 1.0001 0 1 0 21 17 L 3 17 z"});var DR=r=>r.type==="checkbox",U_=r=>r instanceof Date,za=r=>r==null;const sie=r=>typeof r=="object";var Rs=r=>!za(r)&&!Array.isArray(r)&&sie(r)&&!U_(r),zBe=r=>Rs(r)&&r.target?DR(r.target)?r.target.checked:r.target.value:r,HBe=r=>r.substring(0,r.search(/\.\d+(\.|$)/))||r,KBe=(r,t)=>r.has(HBe(t)),qBe=r=>{const t=r.constructor&&r.constructor.prototype;return Rs(t)&&t.hasOwnProperty("isPrototypeOf")},Dj=typeof window<"u"&&typeof window.HTMLElement<"u"&&typeof document<"u";function ru(r){let t;const s=Array.isArray(r),a=typeof FileList<"u"?r instanceof FileList:!1;if(r instanceof Date)t=new Date(r);else if(r instanceof Set)t=new Set(r);else if(!(Dj&&(r instanceof Blob||a))&&(s||Rs(r)))if(t=s?[]:{},!s&&!qBe(r))t=r;else for(const l in r)r.hasOwnProperty(l)&&(t[l]=ru(r[l]));else return r;return t}var vk=r=>Array.isArray(r)?r.filter(Boolean):[],Ds=r=>r===void 0,en=(r,t,s)=>{if(!t||!Rs(r))return s;const a=vk(t.split(/[,[\].]+?/)).reduce((l,d)=>za(l)?l:l[d],r);return Ds(a)||a===r?Ds(r[t])?s:r[t]:a},uh=r=>typeof r=="boolean",Lj=r=>/^\w*$/.test(r),oie=r=>vk(r.replace(/["|']|\]/g,"").split(/\.|\[/)),Li=(r,t,s)=>{let a=-1;const l=Lj(t)?[t]:oie(t),d=l.length,p=d-1;for(;++a<d;){const E=l[a];let v=s;if(a!==p){const b=r[E];v=Rs(b)||Array.isArray(b)?b:isNaN(+l[a+1])?{}:[]}if(E==="__proto__"||E==="constructor"||E==="prototype")return;r[E]=v,r=r[E]}return r};const lX={BLUR:"blur",FOCUS_OUT:"focusout"},cd={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},Ff={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"};Zr.createContext(null);var $Be=(r,t,s,a=!0)=>{const l={defaultValues:t._defaultValues};for(const d in r)Object.defineProperty(l,d,{get:()=>{const p=d;return t._proxyFormState[p]!==cd.all&&(t._proxyFormState[p]=!a||cd.all),r[p]}});return l},Pc=r=>Rs(r)&&!Object.keys(r).length,YBe=(r,t,s,a)=>{s(r);const{name:l,...d}=r;return Pc(d)||Object.keys(d).length>=Object.keys(t).length||Object.keys(d).find(p=>t[p]===cd.all)},NP=r=>Array.isArray(r)?r:[r];function XBe(r){const t=Zr.useRef(r);t.current=r,Zr.useEffect(()=>{const s=!r.disabled&&t.current.subject&&t.current.subject.subscribe({next:t.current.next});return()=>{s&&s.unsubscribe()}},[r.disabled])}var _h=r=>typeof r=="string",JBe=(r,t,s,a,l)=>_h(r)?(a&&t.watch.add(r),en(s,r,l)):Array.isArray(r)?r.map(d=>(a&&t.watch.add(d),en(s,d))):(a&&(t.watchAll=!0),s),QBe=(r,t,s,a,l)=>t?{...s[r],types:{...s[r]&&s[r].types?s[r].types:{},[a]:l||!0}}:{},uX=r=>({isOnSubmit:!r||r===cd.onSubmit,isOnBlur:r===cd.onBlur,isOnChange:r===cd.onChange,isOnAll:r===cd.all,isOnTouch:r===cd.onTouched}),dX=(r,t,s)=>!s&&(t.watchAll||t.watch.has(r)||[...t.watch].some(a=>r.startsWith(a)&&/^\.\w+/.test(r.slice(a.length))));const Cw=(r,t,s,a)=>{for(const l of s||Object.keys(r)){const d=en(r,l);if(d){const{_f:p,...E}=d;if(p){if(p.refs&&p.refs[0]&&t(p.refs[0],l)&&!a)return!0;if(p.ref&&t(p.ref,p.name)&&!a)return!0;if(Cw(E,t))break}else if(Rs(E)&&Cw(E,t))break}}};var ZBe=(r,t,s)=>{const a=NP(en(r,s));return Li(a,"root",t[s]),Li(r,s,a),r},xj=r=>r.type==="file",mh=r=>typeof r=="function",pN=r=>{if(!Dj)return!1;const t=r?r.ownerDocument:0;return r instanceof(t&&t.defaultView?t.defaultView.HTMLElement:HTMLElement)},kP=r=>_h(r),Mj=r=>r.type==="radio",mN=r=>r instanceof RegExp;const hX={value:!1,isValid:!1},fX={value:!0,isValid:!0};var aie=r=>{if(Array.isArray(r)){if(r.length>1){const t=r.filter(s=>s&&s.checked&&!s.disabled).map(s=>s.value);return{value:t,isValid:!!t.length}}return r[0].checked&&!r[0].disabled?r[0].attributes&&!Ds(r[0].attributes.value)?Ds(r[0].value)||r[0].value===""?fX:{value:r[0].value,isValid:!0}:fX:hX}return hX};const pX={isValid:!1,value:null};var cie=r=>Array.isArray(r)?r.reduce((t,s)=>s&&s.checked&&!s.disabled?{isValid:!0,value:s.value}:t,pX):pX;function mX(r,t,s="validate"){if(kP(r)||Array.isArray(r)&&r.every(kP)||uh(r)&&!r)return{type:s,message:kP(r)?r:"",ref:t}}var Uv=r=>Rs(r)&&!mN(r)?r:{value:r,message:""},gX=async(r,t,s,a,l,d)=>{const{ref:p,refs:E,required:v,maxLength:b,minLength:R,min:O,max:N,pattern:F,validate:H,name:z,valueAsNumber:G,mount:ee}=r._f,J=en(s,z);if(!ee||t.has(z))return{};const re=E?E[0]:p,de=fe=>{l&&re.reportValidity&&(re.setCustomValidity(uh(fe)?"":fe||""),re.reportValidity())},se={},ye=Mj(p),Q=DR(p),ne=ye||Q,oe=(G||xj(p))&&Ds(p.value)&&Ds(J)||pN(p)&&p.value===""||J===""||Array.isArray(J)&&!J.length,ue=QBe.bind(null,z,a,se),Ee=(fe,le,Le,pt=Ff.maxLength,et=Ff.minLength)=>{const Oe=fe?le:Le;se[z]={type:fe?pt:et,message:Oe,ref:p,...ue(fe?pt:et,Oe)}};if(d?!Array.isArray(J)||!J.length:v&&(!ne&&(oe||za(J))||uh(J)&&!J||Q&&!aie(E).isValid||ye&&!cie(E).isValid)){const{value:fe,message:le}=kP(v)?{value:!!v,message:v}:Uv(v);if(fe&&(se[z]={type:Ff.required,message:le,ref:re,...ue(Ff.required,le)},!a))return de(le),se}if(!oe&&(!za(O)||!za(N))){let fe,le;const Le=Uv(N),pt=Uv(O);if(!za(J)&&!isNaN(J)){const et=p.valueAsNumber||J&&+J;za(Le.value)||(fe=et>Le.value),za(pt.value)||(le=et<pt.value)}else{const et=p.valueAsDate||new Date(J),Oe=it=>new Date(new Date().toDateString()+" "+it),Ue=p.type=="time",Me=p.type=="week";_h(Le.value)&&J&&(fe=Ue?Oe(J)>Oe(Le.value):Me?J>Le.value:et>new Date(Le.value)),_h(pt.value)&&J&&(le=Ue?Oe(J)<Oe(pt.value):Me?J<pt.value:et<new Date(pt.value))}if((fe||le)&&(Ee(!!fe,Le.message,pt.message,Ff.max,Ff.min),!a))return de(se[z].message),se}if((b||R)&&!oe&&(_h(J)||d&&Array.isArray(J))){const fe=Uv(b),le=Uv(R),Le=!za(fe.value)&&J.length>+fe.value,pt=!za(le.value)&&J.length<+le.value;if((Le||pt)&&(Ee(Le,fe.message,le.message),!a))return de(se[z].message),se}if(F&&!oe&&_h(J)){const{value:fe,message:le}=Uv(F);if(mN(fe)&&!J.match(fe)&&(se[z]={type:Ff.pattern,message:le,ref:p,...ue(Ff.pattern,le)},!a))return de(le),se}if(H){if(mh(H)){const fe=await H(J,s),le=mX(fe,re);if(le&&(se[z]={...le,...ue(Ff.validate,le.message)},!a))return de(le.message),se}else if(Rs(H)){let fe={};for(const le in H){if(!Pc(fe)&&!a)break;const Le=mX(await H[le](J,s),re,le);Le&&(fe={...Le,...ue(le,Le.message)},de(Le.message),a&&(se[z]=fe))}if(!Pc(fe)&&(se[z]={ref:re,...fe},!a))return se}}return de(!0),se};function e4e(r,t){const s=t.slice(0,-1).length;let a=0;for(;a<s;)r=Ds(r)?a++:r[t[a++]];return r}function t4e(r){for(const t in r)if(r.hasOwnProperty(t)&&!Ds(r[t]))return!1;return!0}function Ys(r,t){const s=Array.isArray(t)?t:Lj(t)?[t]:oie(t),a=s.length===1?r:e4e(r,s),l=s.length-1,d=s[l];return a&&delete a[d],l!==0&&(Rs(a)&&Pc(a)||Array.isArray(a)&&t4e(a))&&Ys(r,s.slice(0,-1)),r}var f2=()=>{let r=[];return{get observers(){return r},next:l=>{for(const d of r)d.next&&d.next(l)},subscribe:l=>(r.push(l),{unsubscribe:()=>{r=r.filter(d=>d!==l)}}),unsubscribe:()=>{r=[]}}},YU=r=>za(r)||!sie(r);function Om(r,t){if(YU(r)||YU(t))return r===t;if(U_(r)&&U_(t))return r.getTime()===t.getTime();const s=Object.keys(r),a=Object.keys(t);if(s.length!==a.length)return!1;for(const l of s){const d=r[l];if(!a.includes(l))return!1;if(l!=="ref"){const p=t[l];if(U_(d)&&U_(p)||Rs(d)&&Rs(p)||Array.isArray(d)&&Array.isArray(p)?!Om(d,p):d!==p)return!1}}return!0}var lie=r=>r.type==="select-multiple",n4e=r=>Mj(r)||DR(r),p2=r=>pN(r)&&r.isConnected,uie=r=>{for(const t in r)if(mh(r[t]))return!0;return!1};function gN(r,t={}){const s=Array.isArray(r);if(Rs(r)||s)for(const a in r)Array.isArray(r[a])||Rs(r[a])&&!uie(r[a])?(t[a]=Array.isArray(r[a])?[]:{},gN(r[a],t[a])):za(r[a])||(t[a]=!0);return t}function die(r,t,s){const a=Array.isArray(r);if(Rs(r)||a)for(const l in r)Array.isArray(r[l])||Rs(r[l])&&!uie(r[l])?Ds(t)||YU(s[l])?s[l]=Array.isArray(r[l])?gN(r[l],[]):{...gN(r[l])}:die(r[l],za(t)?{}:t[l],s[l]):s[l]=!Om(r[l],t[l]);return s}var Ob=(r,t)=>die(r,t,gN(t)),hie=(r,{valueAsNumber:t,valueAsDate:s,setValueAs:a})=>Ds(r)?r:t?r===""?NaN:r&&+r:s&&_h(r)?new Date(r):a?a(r):r;function m2(r){const t=r.ref;return xj(t)?t.files:Mj(t)?cie(r.refs).value:lie(t)?[...t.selectedOptions].map(({value:s})=>s):DR(t)?aie(r.refs).value:hie(Ds(t.value)?r.ref.value:t.value,r)}var r4e=(r,t,s,a)=>{const l={};for(const d of r){const p=en(t,d);p&&Li(l,d,p._f)}return{criteriaMode:s,names:[...r],fields:l,shouldUseNativeValidation:a}},Pb=r=>Ds(r)?r:mN(r)?r.source:Rs(r)?mN(r.value)?r.value.source:r.value:r;const _X="AsyncFunction";var i4e=r=>!!r&&!!r.validate&&!!(mh(r.validate)&&r.validate.constructor.name===_X||Rs(r.validate)&&Object.values(r.validate).find(t=>t.constructor.name===_X)),s4e=r=>r.mount&&(r.required||r.min||r.max||r.maxLength||r.minLength||r.pattern||r.validate);function EX(r,t,s){const a=en(r,s);if(a||Lj(s))return{error:a,name:s};const l=s.split(".");for(;l.length;){const d=l.join("."),p=en(t,d),E=en(r,d);if(p&&!Array.isArray(p)&&s!==d)return{name:s};if(E&&E.type)return{name:d,error:E};l.pop()}return{name:s}}var o4e=(r,t,s,a,l)=>l.isOnAll?!1:!s&&l.isOnTouch?!(t||r):(s?a.isOnBlur:l.isOnBlur)?!r:(s?a.isOnChange:l.isOnChange)?r:!0,a4e=(r,t)=>!vk(en(r,t)).length&&Ys(r,t);const c4e={mode:cd.onSubmit,reValidateMode:cd.onChange,shouldFocusError:!0};function l4e(r={}){let t={...c4e,...r},s={submitCount:0,isDirty:!1,isLoading:mh(t.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:t.errors||{},disabled:t.disabled||!1},a={},l=Rs(t.defaultValues)||Rs(t.values)?ru(t.defaultValues||t.values)||{}:{},d=t.shouldUnregister?{}:ru(l),p={action:!1,mount:!1,watch:!1},E={mount:new Set,disabled:new Set,unMount:new Set,array:new Set,watch:new Set},v,b=0;const R={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1},O={values:f2(),array:f2(),state:f2()},N=uX(t.mode),F=uX(t.reValidateMode),H=t.criteriaMode===cd.all,z=ve=>Ne=>{clearTimeout(b),b=setTimeout(ve,Ne)},G=async ve=>{if(!t.disabled&&(R.isValid||ve)){const Ne=t.resolver?Pc((await ne()).errors):await ue(a,!0);Ne!==s.isValid&&O.state.next({isValid:Ne})}},ee=(ve,Ne)=>{!t.disabled&&(R.isValidating||R.validatingFields)&&((ve||Array.from(E.mount)).forEach(We=>{We&&(Ne?Li(s.validatingFields,We,Ne):Ys(s.validatingFields,We))}),O.state.next({validatingFields:s.validatingFields,isValidating:!Pc(s.validatingFields)}))},J=(ve,Ne=[],We,dt,mt=!0,gt=!0)=>{if(dt&&We&&!t.disabled){if(p.action=!0,gt&&Array.isArray(en(a,ve))){const Vt=We(en(a,ve),dt.argA,dt.argB);mt&&Li(a,ve,Vt)}if(gt&&Array.isArray(en(s.errors,ve))){const Vt=We(en(s.errors,ve),dt.argA,dt.argB);mt&&Li(s.errors,ve,Vt),a4e(s.errors,ve)}if(R.touchedFields&&gt&&Array.isArray(en(s.touchedFields,ve))){const Vt=We(en(s.touchedFields,ve),dt.argA,dt.argB);mt&&Li(s.touchedFields,ve,Vt)}R.dirtyFields&&(s.dirtyFields=Ob(l,d)),O.state.next({name:ve,isDirty:fe(ve,Ne),dirtyFields:s.dirtyFields,errors:s.errors,isValid:s.isValid})}else Li(d,ve,Ne)},re=(ve,Ne)=>{Li(s.errors,ve,Ne),O.state.next({errors:s.errors})},de=ve=>{s.errors=ve,O.state.next({errors:s.errors,isValid:!1})},se=(ve,Ne,We,dt)=>{const mt=en(a,ve);if(mt){const gt=en(d,ve,Ds(We)?en(l,ve):We);Ds(gt)||dt&&dt.defaultChecked||Ne?Li(d,ve,Ne?gt:m2(mt._f)):pt(ve,gt),p.mount&&G()}},ye=(ve,Ne,We,dt,mt)=>{let gt=!1,Vt=!1;const _n={name:ve};if(!t.disabled){const kn=!!(en(a,ve)&&en(a,ve)._f&&en(a,ve)._f.disabled);if(!We||dt){R.isDirty&&(Vt=s.isDirty,s.isDirty=_n.isDirty=fe(),gt=Vt!==_n.isDirty);const rn=kn||Om(en(l,ve),Ne);Vt=!!(!kn&&en(s.dirtyFields,ve)),rn||kn?Ys(s.dirtyFields,ve):Li(s.dirtyFields,ve,!0),_n.dirtyFields=s.dirtyFields,gt=gt||R.dirtyFields&&Vt!==!rn}if(We){const rn=en(s.touchedFields,ve);rn||(Li(s.touchedFields,ve,We),_n.touchedFields=s.touchedFields,gt=gt||R.touchedFields&&rn!==We)}gt&&mt&&O.state.next(_n)}return gt?_n:{}},Q=(ve,Ne,We,dt)=>{const mt=en(s.errors,ve),gt=R.isValid&&uh(Ne)&&s.isValid!==Ne;if(t.delayError&&We?(v=z(()=>re(ve,We)),v(t.delayError)):(clearTimeout(b),v=null,We?Li(s.errors,ve,We):Ys(s.errors,ve)),(We?!Om(mt,We):mt)||!Pc(dt)||gt){const Vt={...dt,...gt&&uh(Ne)?{isValid:Ne}:{},errors:s.errors,name:ve};s={...s,...Vt},O.state.next(Vt)}},ne=async ve=>{ee(ve,!0);const Ne=await t.resolver(d,t.context,r4e(ve||E.mount,a,t.criteriaMode,t.shouldUseNativeValidation));return ee(ve),Ne},oe=async ve=>{const{errors:Ne}=await ne(ve);if(ve)for(const We of ve){const dt=en(Ne,We);dt?Li(s.errors,We,dt):Ys(s.errors,We)}else s.errors=Ne;return Ne},ue=async(ve,Ne,We={valid:!0})=>{for(const dt in ve){const mt=ve[dt];if(mt){const{_f:gt,...Vt}=mt;if(gt){const _n=E.array.has(gt.name),kn=mt._f&&i4e(mt._f);kn&&R.validatingFields&&ee([dt],!0);const rn=await gX(mt,E.disabled,d,H,t.shouldUseNativeValidation&&!Ne,_n);if(kn&&R.validatingFields&&ee([dt]),rn[gt.name]&&(We.valid=!1,Ne))break;!Ne&&(en(rn,gt.name)?_n?ZBe(s.errors,rn,gt.name):Li(s.errors,gt.name,rn[gt.name]):Ys(s.errors,gt.name))}!Pc(Vt)&&await ue(Vt,Ne,We)}}return We.valid},Ee=()=>{for(const ve of E.unMount){const Ne=en(a,ve);Ne&&(Ne._f.refs?Ne._f.refs.every(We=>!p2(We)):!p2(Ne._f.ref))&&Et(ve)}E.unMount=new Set},fe=(ve,Ne)=>!t.disabled&&(ve&&Ne&&Li(d,ve,Ne),!Om(Ae(),l)),le=(ve,Ne,We)=>JBe(ve,E,{...p.mount?d:Ds(Ne)?l:_h(ve)?{[ve]:Ne}:Ne},We,Ne),Le=ve=>vk(en(p.mount?d:l,ve,t.shouldUnregister?en(l,ve,[]):[])),pt=(ve,Ne,We={})=>{const dt=en(a,ve);let mt=Ne;if(dt){const gt=dt._f;gt&&(!gt.disabled&&Li(d,ve,hie(Ne,gt)),mt=pN(gt.ref)&&za(Ne)?"":Ne,lie(gt.ref)?[...gt.ref.options].forEach(Vt=>Vt.selected=mt.includes(Vt.value)):gt.refs?DR(gt.ref)?gt.refs.length>1?gt.refs.forEach(Vt=>(!Vt.defaultChecked||!Vt.disabled)&&(Vt.checked=Array.isArray(mt)?!!mt.find(_n=>_n===Vt.value):mt===Vt.value)):gt.refs[0]&&(gt.refs[0].checked=!!mt):gt.refs.forEach(Vt=>Vt.checked=Vt.value===mt):xj(gt.ref)?gt.ref.value="":(gt.ref.value=mt,gt.ref.type||O.values.next({name:ve,values:{...d}})))}(We.shouldDirty||We.shouldTouch)&&ye(ve,mt,We.shouldTouch,We.shouldDirty,!0),We.shouldValidate&&it(ve)},et=(ve,Ne,We)=>{for(const dt in Ne){const mt=Ne[dt],gt=`${ve}.${dt}`,Vt=en(a,gt);(E.array.has(ve)||Rs(mt)||Vt&&!Vt._f)&&!U_(mt)?et(gt,mt,We):pt(gt,mt,We)}},Oe=(ve,Ne,We={})=>{const dt=en(a,ve),mt=E.array.has(ve),gt=ru(Ne);Li(d,ve,gt),mt?(O.array.next({name:ve,values:{...d}}),(R.isDirty||R.dirtyFields)&&We.shouldDirty&&O.state.next({name:ve,dirtyFields:Ob(l,d),isDirty:fe(ve,gt)})):dt&&!dt._f&&!za(gt)?et(ve,gt,We):pt(ve,gt,We),dX(ve,E)&&O.state.next({...s}),O.values.next({name:p.mount?ve:void 0,values:{...d}})},Ue=async ve=>{p.mount=!0;const Ne=ve.target;let We=Ne.name,dt=!0;const mt=en(a,We),gt=()=>Ne.type?m2(mt._f):zBe(ve),Vt=_n=>{dt=Number.isNaN(_n)||U_(_n)&&isNaN(_n.getTime())||Om(_n,en(d,We,_n))};if(mt){let _n,kn;const rn=gt(),ur=ve.type===lX.BLUR||ve.type===lX.FOCUS_OUT,$a=!s4e(mt._f)&&!t.resolver&&!en(s.errors,We)&&!mt._f.deps||o4e(ur,en(s.touchedFields,We),s.isSubmitted,F,N),kt=dX(We,E,ur);Li(d,We,rn),ur?(mt._f.onBlur&&mt._f.onBlur(ve),v&&v(0)):mt._f.onChange&&mt._f.onChange(ve);const tn=ye(We,rn,ur,!1),Hi=!Pc(tn)||kt;if(!ur&&O.values.next({name:We,type:ve.type,values:{...d}}),$a)return R.isValid&&(t.mode==="onBlur"&&ur?G():ur||G()),Hi&&O.state.next({name:We,...kt?{}:tn});if(!ur&&kt&&O.state.next({...s}),t.resolver){const{errors:Cs}=await ne([We]);if(Vt(rn),dt){const Vs=EX(s.errors,a,We),li=EX(Cs,a,Vs.name||We);_n=li.error,We=li.name,kn=Pc(Cs)}}else ee([We],!0),_n=(await gX(mt,E.disabled,d,H,t.shouldUseNativeValidation))[We],ee([We]),Vt(rn),dt&&(_n?kn=!1:R.isValid&&(kn=await ue(a,!0)));dt&&(mt._f.deps&&it(mt._f.deps),Q(We,kn,_n,tn))}},Me=(ve,Ne)=>{if(en(s.errors,Ne)&&ve.focus)return ve.focus(),1},it=async(ve,Ne={})=>{let We,dt;const mt=NP(ve);if(t.resolver){const gt=await oe(Ds(ve)?ve:mt);We=Pc(gt),dt=ve?!mt.some(Vt=>en(gt,Vt)):We}else ve?(dt=(await Promise.all(mt.map(async gt=>{const Vt=en(a,gt);return await ue(Vt&&Vt._f?{[gt]:Vt}:Vt)}))).every(Boolean),!(!dt&&!s.isValid)&&G()):dt=We=await ue(a);return O.state.next({...!_h(ve)||R.isValid&&We!==s.isValid?{}:{name:ve},...t.resolver||!ve?{isValid:We}:{},errors:s.errors}),Ne.shouldFocus&&!dt&&Cw(a,Me,ve?mt:E.mount),dt},Ae=ve=>{const Ne={...p.mount?d:l};return Ds(ve)?Ne:_h(ve)?en(Ne,ve):ve.map(We=>en(Ne,We))},qe=(ve,Ne)=>({invalid:!!en((Ne||s).errors,ve),isDirty:!!en((Ne||s).dirtyFields,ve),error:en((Ne||s).errors,ve),isValidating:!!en(s.validatingFields,ve),isTouched:!!en((Ne||s).touchedFields,ve)}),Ze=ve=>{ve&&NP(ve).forEach(Ne=>Ys(s.errors,Ne)),O.state.next({errors:ve?s.errors:{}})},Fe=(ve,Ne,We)=>{const dt=(en(a,ve,{_f:{}})._f||{}).ref,mt=en(s.errors,ve)||{},{ref:gt,message:Vt,type:_n,...kn}=mt;Li(s.errors,ve,{...kn,...Ne,ref:dt}),O.state.next({name:ve,errors:s.errors,isValid:!1}),We&&We.shouldFocus&&dt&&dt.focus&&dt.focus()},lt=(ve,Ne)=>mh(ve)?O.values.subscribe({next:We=>ve(le(void 0,Ne),We)}):le(ve,Ne,!0),Et=(ve,Ne={})=>{for(const We of ve?NP(ve):E.mount)E.mount.delete(We),E.array.delete(We),Ne.keepValue||(Ys(a,We),Ys(d,We)),!Ne.keepError&&Ys(s.errors,We),!Ne.keepDirty&&Ys(s.dirtyFields,We),!Ne.keepTouched&&Ys(s.touchedFields,We),!Ne.keepIsValidating&&Ys(s.validatingFields,We),!t.shouldUnregister&&!Ne.keepDefaultValue&&Ys(l,We);O.values.next({values:{...d}}),O.state.next({...s,...Ne.keepDirty?{isDirty:fe()}:{}}),!Ne.keepIsValid&&G()},Nt=({disabled:ve,name:Ne,field:We,fields:dt})=>{(uh(ve)&&p.mount||ve||E.disabled.has(Ne))&&(ve?E.disabled.add(Ne):E.disabled.delete(Ne),ye(Ne,m2(We?We._f:en(dt,Ne)._f),!1,!1,!0))},$t=(ve,Ne={})=>{let We=en(a,ve);const dt=uh(Ne.disabled)||uh(t.disabled);return Li(a,ve,{...We||{},_f:{...We&&We._f?We._f:{ref:{name:ve}},name:ve,mount:!0,...Ne}}),E.mount.add(ve),We?Nt({field:We,disabled:uh(Ne.disabled)?Ne.disabled:t.disabled,name:ve}):se(ve,!0,Ne.value),{...dt?{disabled:Ne.disabled||t.disabled}:{},...t.progressive?{required:!!Ne.required,min:Pb(Ne.min),max:Pb(Ne.max),minLength:Pb(Ne.minLength),maxLength:Pb(Ne.maxLength),pattern:Pb(Ne.pattern)}:{},name:ve,onChange:Ue,onBlur:Ue,ref:mt=>{if(mt){$t(ve,Ne),We=en(a,ve);const gt=Ds(mt.value)&&mt.querySelectorAll&&mt.querySelectorAll("input,select,textarea")[0]||mt,Vt=n4e(gt),_n=We._f.refs||[];if(Vt?_n.find(kn=>kn===gt):gt===We._f.ref)return;Li(a,ve,{_f:{...We._f,...Vt?{refs:[..._n.filter(p2),gt,...Array.isArray(en(l,ve))?[{}]:[]],ref:{type:gt.type,name:ve}}:{ref:gt}}}),se(ve,!1,void 0,gt)}else We=en(a,ve,{}),We._f&&(We._f.mount=!1),(t.shouldUnregister||Ne.shouldUnregister)&&!(KBe(E.array,ve)&&p.action)&&E.unMount.add(ve)}}},xt=()=>t.shouldFocusError&&Cw(a,Me,E.mount),En=ve=>{uh(ve)&&(O.state.next({disabled:ve}),Cw(a,(Ne,We)=>{const dt=en(a,We);dt&&(Ne.disabled=dt._f.disabled||ve,Array.isArray(dt._f.refs)&&dt._f.refs.forEach(mt=>{mt.disabled=dt._f.disabled||ve}))},0,!1))},In=(ve,Ne)=>async We=>{let dt;We&&(We.preventDefault&&We.preventDefault(),We.persist&&We.persist());let mt=ru(d);if(E.disabled.size)for(const gt of E.disabled)Li(mt,gt,void 0);if(O.state.next({isSubmitting:!0}),t.resolver){const{errors:gt,values:Vt}=await ne();s.errors=gt,mt=Vt}else await ue(a);if(Ys(s.errors,"root"),Pc(s.errors)){O.state.next({errors:{}});try{await ve(mt,We)}catch(gt){dt=gt}}else Ne&&await Ne({...s.errors},We),xt(),setTimeout(xt);if(O.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:Pc(s.errors)&&!dt,submitCount:s.submitCount+1,errors:s.errors}),dt)throw dt},hn=(ve,Ne={})=>{en(a,ve)&&(Ds(Ne.defaultValue)?Oe(ve,ru(en(l,ve))):(Oe(ve,Ne.defaultValue),Li(l,ve,ru(Ne.defaultValue))),Ne.keepTouched||Ys(s.touchedFields,ve),Ne.keepDirty||(Ys(s.dirtyFields,ve),s.isDirty=Ne.defaultValue?fe(ve,ru(en(l,ve))):fe()),Ne.keepError||(Ys(s.errors,ve),R.isValid&&G()),O.state.next({...s}))},Kn=(ve,Ne={})=>{const We=ve?ru(ve):l,dt=ru(We),mt=Pc(ve),gt=mt?l:dt;if(Ne.keepDefaultValues||(l=We),!Ne.keepValues){if(Ne.keepDirtyValues){const Vt=new Set([...E.mount,...Object.keys(Ob(l,d))]);for(const _n of Array.from(Vt))en(s.dirtyFields,_n)?Li(gt,_n,en(d,_n)):Oe(_n,en(gt,_n))}else{if(Dj&&Ds(ve))for(const Vt of E.mount){const _n=en(a,Vt);if(_n&&_n._f){const kn=Array.isArray(_n._f.refs)?_n._f.refs[0]:_n._f.ref;if(pN(kn)){const rn=kn.closest("form");if(rn){rn.reset();break}}}}a={}}d=t.shouldUnregister?Ne.keepDefaultValues?ru(l):{}:ru(gt),O.array.next({values:{...gt}}),O.values.next({values:{...gt}})}E={mount:Ne.keepDirtyValues?E.mount:new Set,unMount:new Set,array:new Set,disabled:new Set,watch:new Set,watchAll:!1,focus:""},p.mount=!R.isValid||!!Ne.keepIsValid||!!Ne.keepDirtyValues,p.watch=!!t.shouldUnregister,O.state.next({submitCount:Ne.keepSubmitCount?s.submitCount:0,isDirty:mt?!1:Ne.keepDirty?s.isDirty:!!(Ne.keepDefaultValues&&!Om(ve,l)),isSubmitted:Ne.keepIsSubmitted?s.isSubmitted:!1,dirtyFields:mt?{}:Ne.keepDirtyValues?Ne.keepDefaultValues&&d?Ob(l,d):s.dirtyFields:Ne.keepDefaultValues&&ve?Ob(l,ve):Ne.keepDirty?s.dirtyFields:{},touchedFields:Ne.keepTouched?s.touchedFields:{},errors:Ne.keepErrors?s.errors:{},isSubmitSuccessful:Ne.keepIsSubmitSuccessful?s.isSubmitSuccessful:!1,isSubmitting:!1})},Ar=(ve,Ne)=>Kn(mh(ve)?ve(d):ve,Ne);return{control:{register:$t,unregister:Et,getFieldState:qe,handleSubmit:In,setError:Fe,_executeSchema:ne,_getWatch:le,_getDirty:fe,_updateValid:G,_removeUnmounted:Ee,_updateFieldArray:J,_updateDisabledField:Nt,_getFieldArray:Le,_reset:Kn,_resetDefaultValues:()=>mh(t.defaultValues)&&t.defaultValues().then(ve=>{Ar(ve,t.resetOptions),O.state.next({isLoading:!1})}),_updateFormState:ve=>{s={...s,...ve}},_disableForm:En,_subjects:O,_proxyFormState:R,_setErrors:de,get _fields(){return a},get _formValues(){return d},get _state(){return p},set _state(ve){p=ve},get _defaultValues(){return l},get _names(){return E},set _names(ve){E=ve},get _formState(){return s},set _formState(ve){s=ve},get _options(){return t},set _options(ve){t={...t,...ve}}},trigger:it,register:$t,handleSubmit:In,watch:lt,setValue:Oe,getValues:Ae,reset:Ar,resetField:hn,clearErrors:Ze,unregister:Et,setError:Fe,setFocus:(ve,Ne={})=>{const We=en(a,ve),dt=We&&We._f;if(dt){const mt=dt.refs?dt.refs[0]:dt.ref;mt.focus&&(mt.focus(),Ne.shouldSelect&&mh(mt.select)&&mt.select())}},getFieldState:qe}}function fie(r={}){const t=Zr.useRef(void 0),s=Zr.useRef(void 0),[a,l]=Zr.useState({isDirty:!1,isValidating:!1,isLoading:mh(r.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:r.errors||{},disabled:r.disabled||!1,defaultValues:mh(r.defaultValues)?void 0:r.defaultValues});t.current||(t.current={...l4e(r),formState:a});const d=t.current.control;return d._options=r,XBe({subject:d._subjects.state,next:p=>{YBe(p,d._proxyFormState,d._updateFormState)&&l({...d._formState})}}),Zr.useEffect(()=>d._disableForm(r.disabled),[d,r.disabled]),Zr.useEffect(()=>{if(d._proxyFormState.isDirty){const p=d._getDirty();p!==a.isDirty&&d._subjects.state.next({isDirty:p})}},[d,a.isDirty]),Zr.useEffect(()=>{r.values&&!Om(r.values,s.current)?(d._reset(r.values,d._options.resetOptions),s.current=r.values,l(p=>({...p}))):d._resetDefaultValues()},[r.values,d]),Zr.useEffect(()=>{r.errors&&d._setErrors(r.errors)},[r.errors,d]),Zr.useEffect(()=>{d._state.mount||(d._updateValid(),d._state.mount=!0),d._state.watch&&(d._state.watch=!1,d._subjects.state.next({...d._formState})),d._removeUnmounted()}),Zr.useEffect(()=>{r.shouldUnregister&&d._subjects.values.next({values:d._getWatch()})},[r.shouldUnregister,d]),t.current.formState=$Be(a,d),t.current}const pie=r=>{V.useEffect(()=>{if(!window.unityInstance)return;const t=()=>{try{window.unityInstance.SendMessage("WebGLInputManager","Disable"),Rt.log("Unity input disabled")}catch(a){Rt.error("Failed to disable Unity input:",a)}},s=()=>{try{window.unityInstance.SendMessage("WebGLInputManager","Enable"),Rt.log("Unity input enabled")}catch(a){Rt.error("Failed to enable Unity input:",a)}};return r?t():s(),()=>{r&&s()}},[r])};function Sk({mode:r,label:t,buttonProps:s={},isOpen:a,onClose:l}){const{register:d,handleSubmit:p,formState:{errors:E}}=fie(),{register:v}=V.useContext(Ra),b=QS(),{fullscreenRef:R}=up(),[O,N]=V.useState(!1),[F,H]=V.useState(!1),z=a!==void 0?a:O,G=l||(()=>N(!1));pie(z);const ee=async de=>{const{email:se,password:ye,confirmPassword:Q,...ne}=de;if(ye!==Q){b({title:"Error",description:"Passwords do not match.",status:"error",duration:3e3,isClosable:!0,position:"top"});return}H(!0);try{await v(se,ye,ne),Rt.log("User: Registration process complete."),G(),b({title:"Registration Successful",description:"Your account has been created.",status:"success",duration:3e3,isClosable:!0,position:"top"})}catch(oe){Rt.error("User: Registration Error:",oe),b({title:"Error",description:"An error occurred during registration. Please try again.",status:"error",duration:3e3,isClosable:!0,position:"top"})}finally{H(!1)}},J=()=>{l?l():N(!O)},re=r==="link"?D.jsx(Ph,{variant:"header",onClick:J,children:t}):D.jsx(qa,{onClick:J,...s,children:t});return D.jsxs(D.Fragment,{children:[!a&&re,D.jsxs(xh,{isOpen:z,onClose:G,size:"md",portalProps:{containerRef:R},isCentered:!0,motionPreset:"slideInBottom",blockScrollOnMount:!1,children:[D.jsx(Fh,{bg:"blackAlpha.800",backdropFilter:"blur(5px)"}),D.jsxs(Mh,{bg:"gray.800",borderRadius:"xl",boxShadow:"xl",color:"white",maxW:"md",mx:4,position:"relative",zIndex:9999,sx:{isolation:"isolate","& input":{position:"relative",zIndex:1e4,isolation:"isolate"},"& *":{pointerEvents:"auto !important"}},onKeyDown:de=>{de.stopPropagation()},children:[D.jsxs(cp,{p:8,textAlign:"center",children:[D.jsx(kF,{size:"lg",mb:2,children:"Create Account"}),D.jsx(gn,{fontSize:"sm",color:"gray.400",children:"Fill in your details to get started"})]}),D.jsx(Vh,{color:"gray.400"}),D.jsx(Uh,{px:8,children:D.jsx("form",{onSubmit:p(ee),children:D.jsxs(Us,{spacing:4,children:[D.jsxs(gs,{isInvalid:E.companyName,isRequired:!0,children:[D.jsx(zo,{placeholder:"Company Name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("companyName",{required:"Company name is required"})}),D.jsx(Wf,{children:E.companyName&&E.companyName.message})]}),D.jsxs(kc,{gap:4,w:"100%",children:[D.jsxs(gs,{isInvalid:E.firstName,isRequired:!0,children:[D.jsx(zo,{placeholder:"First Name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("firstName",{required:"First name is required"})}),D.jsx(Wf,{children:E.firstName&&E.firstName.message})]}),D.jsxs(gs,{isInvalid:E.lastName,isRequired:!0,children:[D.jsx(zo,{placeholder:"Last Name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("lastName",{required:"Last name is required"})}),D.jsx(Wf,{children:E.lastName&&E.lastName.message})]})]}),D.jsxs(gs,{isInvalid:E.email,isRequired:!0,children:[D.jsx(zo,{type:"email",placeholder:"Work Email Address",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("email",{required:"Email is required",pattern:{value:/^[^@ \t\r\n]+@[^@ \t\r\n]+\.[^@ \t\r\n]+$/,message:"Invalid email address"}})}),D.jsx(Wf,{children:E.email&&E.email.message})]}),D.jsxs(kc,{gap:4,w:"100%",children:[D.jsxs(gs,{isInvalid:E.password,isRequired:!0,children:[D.jsx(zo,{type:"password",placeholder:"Password",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("password",{required:"Password is required",minLength:{value:8,message:"Password must be at least 8 characters long"}})}),D.jsx(Wf,{children:E.password&&E.password.message})]}),D.jsxs(gs,{isInvalid:E.confirmPassword,isRequired:!0,children:[D.jsx(zo,{type:"password",placeholder:"Confirm Password",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("confirmPassword",{required:"Confirm password is required"})}),D.jsx(Wf,{children:E.confirmPassword&&E.confirmPassword.message})]})]}),D.jsx(gs,{children:D.jsx(zo,{placeholder:"Access Code",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("accessCode")})}),D.jsx(gs,{children:D.jsx(zo,{placeholder:"LinkedIn Profile (optional)",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("linkedInProfile")})})]})})}),D.jsxs(GN,{px:8,pb:8,flexDirection:"column",gap:4,children:[D.jsx(qa,{type:"submit",colorScheme:"blue",size:"lg",width:"100%",onClick:p(ee),isLoading:F,loadingText:"Creating Account",children:"Create Account"}),D.jsxs(gn,{fontSize:"sm",color:"gray.400",textAlign:"center",children:["Already have an account?"," ",D.jsx(Ph,{color:"blue.400",onClick:G,children:"Sign In"})]})]})]})]})]})}Sk.propTypes={mode:xr.oneOf(["button","link"]),label:xr.string,buttonProps:xr.object,isOpen:xr.bool,onClose:xr.func};function Tk({mode:r,label:t,buttonProps:s={}}){const{signIn:a}=V.useContext(Ra),{fullscreenRef:l}=up(),d=QS(),{register:p,handleSubmit:E,formState:{errors:v,isSubmitting:b}}=fie({defaultValues:{email:"neil@pursey.net",password:"123456"}}),[R,O]=V.useState(!1),[N,F]=V.useState(!1);pie(R);const H=async J=>{try{await a(J.email,J.password),Rt.log("User: Sign-in process complete."),O(!1),window.location.reload()}catch(re){Rt.error("User: SignIn Error:",re),d({title:"Error",description:"An error occurred while logging in. Please check your credentials.",status:"error",duration:1e4,isClosable:!0,position:"top",container:l.current})}},z=()=>O(J=>!J),G=()=>{O(!1),F(!0)},ee=r==="link"?D.jsx(Ph,{variant:"header",onClick:z,children:t}):D.jsx(qa,{onClick:z,...s,children:t});return D.jsxs(D.Fragment,{children:[ee,D.jsxs(xh,{isOpen:R,onClose:z,size:"md",portalProps:{containerRef:l},isCentered:!0,motionPreset:"slideInBottom",blockScrollOnMount:!1,children:[D.jsx(Fh,{bg:"blackAlpha.800",backdropFilter:"blur(5px)"}),D.jsx("form",{onSubmit:E(H),children:D.jsxs(Mh,{bg:"gray.800",borderRadius:"xl",boxShadow:"xl",color:"white",maxW:"md",mx:4,position:"relative",zIndex:9999,sx:{isolation:"isolate","& input":{position:"relative",zIndex:1e4,isolation:"isolate"},"& *":{pointerEvents:"auto !important"}},onKeyDown:J=>{J.stopPropagation()},children:[D.jsxs(cp,{p:8,textAlign:"center",children:[D.jsx(kF,{size:"lg",mb:2,children:"Welcome Back"}),D.jsx(gn,{fontSize:"sm",color:"gray.400",children:"Enter your credentials to access your account"})]}),D.jsx(Vh,{color:"gray.400"}),D.jsx(Uh,{px:8,pb:8,children:D.jsxs(Us,{spacing:4,children:[D.jsxs(gs,{isInvalid:v.email,children:[D.jsxs(lU,{children:[D.jsx(qP,{pointerEvents:"none",children:D.jsx(jBe,{color:"gray.500"})}),D.jsx(zo,{type:"email",placeholder:"Email",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...p("email",{required:"Email is required."})})]}),D.jsx(Wf,{children:v.email&&v.email.message})]}),D.jsxs(gs,{isInvalid:v.password,children:[D.jsxs(lU,{children:[D.jsx(qP,{pointerEvents:"none",children:D.jsx(VBe,{color:"gray.500"})}),D.jsx(zo,{type:"password",placeholder:"Password",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...p("password",{required:"Password is required."})})]}),D.jsx(Wf,{children:v.password&&v.password.message})]})]})}),D.jsxs(GN,{px:8,pb:8,flexDirection:"column",gap:4,children:[D.jsx(qa,{type:"submit",colorScheme:"blue",size:"lg",width:"100%",isLoading:b,loadingText:"Signing In",children:"Sign In"}),D.jsxs(gn,{fontSize:"sm",color:"gray.400",textAlign:"center",children:["Don't have an account?"," ",D.jsx(Ph,{color:"blue.400",onClick:G,children:"Sign Up"})]})]})]})})]}),D.jsx(Sk,{mode:"link",isOpen:N,onClose:()=>F(!1)})]})}Tk.propTypes={mode:xr.oneOf(["button","link"]),label:xr.string,buttonProps:xr.object};Tk.defaultProps={mode:"button",label:"Sign In"};function bk({mode:r,label:t}){const s=QS(),{signOut:a}=V.useContext(Ra),{fullscreenRef:l}=up(),d=async()=>{try{await a(),s({title:"Logged Out",description:"You have been successfully logged out.",status:"success",duration:3e3,isClosable:!0,position:"top",container:l.current}),window.location.href="/"}catch(E){console.error("SignOut Error:",E),s({title:"Error",description:"An error occurred while logging out.",status:"error",duration:3e3,isClosable:!0,position:"top",container:l.current})}},p=r==="link"?D.jsx(Ph,{variant:"header",onClick:d,style:{cursor:"pointer"},children:t}):null;return D.jsx(D.Fragment,{children:p})}bk.propTypes={mode:xr.oneOf(["button","link"]),label:xr.string};bk.defaultProps={mode:"button",label:"Sign Out"};const u4e=()=>{const[r,t]=V.useState(!1);return V.useEffect(()=>{var s,a,l;if(r){const d=document.querySelector("#unity-canvas");d&&(d.blur(),d.style.pointerEvents="none");const p=(a=(s=window.unityInstance)==null?void 0:s.Module)==null?void 0:a.WebGLInputHandler;(l=window.unityInstance)!=null&&l.Module&&(window.unityInstance.Module.WebGLInputHandler=null);const E=v=>{v.stopImmediatePropagation(),v.stopPropagation()};return document.addEventListener("keydown",E,!0),document.addEventListener("keyup",E,!0),document.addEventListener("keypress",E,!0),document.addEventListener("keydown",E,!1),document.addEventListener("keyup",E,!1),document.addEventListener("keypress",E,!1),()=>{var v;(v=window.unityInstance)!=null&&v.Module&&p&&(window.unityInstance.Module.WebGLInputHandler=p),d&&(d.style.pointerEvents="auto"),document.removeEventListener("keydown",E,!0),document.removeEventListener("keyup",E,!0),document.removeEventListener("keypress",E,!0),document.removeEventListener("keydown",E,!1),document.removeEventListener("keyup",E,!1),document.removeEventListener("keypress",E,!1)}}},[r]),[r,t]},d4e=({isOpen:r,onClose:t,user:s,profileImageUrl:a})=>{const[l,d]=V.useState(!1),[p,E]=V.useState({Nickname:(s==null?void 0:s.Nickname)||"",companyName:(s==null?void 0:s.companyName)||"",firstName:(s==null?void 0:s.firstName)||"",lastName:(s==null?void 0:s.lastName)||"",linkedInProfile:(s==null?void 0:s.linkedInProfile)||""}),[v,b]=V.useState(!1),[R,O]=u4e(),N=QS(),{sendUserToUnity:F}=V.useContext(Ra),H=V.useRef(null);V.useEffect(()=>{E({Nickname:(s==null?void 0:s.Nickname)||"",companyName:(s==null?void 0:s.companyName)||"",firstName:(s==null?void 0:s.firstName)||"",lastName:(s==null?void 0:s.lastName)||"",linkedInProfile:(s==null?void 0:s.linkedInProfile)||""})},[s]),V.useEffect(()=>{if(l&&H.current){const de=()=>{H.current.focus(),O(!0);const Q=document.querySelector("#unity-canvas");Q&&Q.blur()};de();const se=setTimeout(de,100),ye=setTimeout(de,300);return()=>{clearTimeout(se),clearTimeout(ye)}}else O(!1)},[l,O]);const z=()=>{d(!1),O(!1),t()},G=de=>{const{name:se,value:ye}=de.target;E(Q=>({...Q,[se]:ye}))},ee=async()=>{if(p.Nickname.trim()===""){N({title:"Error",description:"Nickname cannot be empty",status:"error",duration:3e3,isClosable:!0});return}b(!0);try{const de=FS(qm,"users",s.uid),se=Zre(de,ye=>{ye.exists()&&ye.data().Nickname===p.Nickname&&(F(),se())});await Qre(de,{...p,lastUpdated:new Date().toISOString()}),await updateUser(),E({Nickname:p.Nickname,companyName:p.companyName,firstName:p.firstName,lastName:p.lastName,linkedInProfile:p.linkedInProfile}),N({title:"Success",description:"Profile updated successfully",status:"success",duration:3e3,isClosable:!0}),d(!1)}catch(de){N({title:"Error",description:"Failed to update profile",status:"error",duration:3e3,isClosable:!0}),console.error("Error updating profile:",de)}finally{b(!1)}},J=()=>D.jsxs(Us,{spacing:4,align:"stretch",w:"100%",children:[D.jsx(kc,{direction:"column",align:"center",gap:2,children:D.jsx(gn,{fontSize:"2xl",fontWeight:"bold",children:s.Nickname})}),D.jsxs(Us,{spacing:3,align:"stretch",bg:"gray.700",p:4,borderRadius:"md",children:[D.jsxs(kc,{direction:"column",children:[D.jsx(gn,{color:"gray.400",fontSize:"sm",children:"Company"}),D.jsx(gn,{children:s.companyName||"Not specified"})]}),D.jsxs(kc,{direction:"column",children:[D.jsx(gn,{color:"gray.400",fontSize:"sm",children:"Full Name"}),D.jsx(gn,{children:`${s.firstName||""} ${s.lastName||""}`.trim()||"Not specified"})]}),D.jsxs(kc,{direction:"column",children:[D.jsx(gn,{color:"gray.400",fontSize:"sm",children:"LinkedIn"}),D.jsx(gn,{children:s.linkedInProfile||"Not specified"})]})]}),D.jsx(qa,{onClick:()=>d(!0),size:"sm",variant:"outline",_hover:{bg:"gray.700"},color:"white",borderColor:"gray.600",children:"Edit Profile"})]}),re=()=>D.jsxs(Us,{spacing:4,align:"stretch",w:"100%",children:[D.jsxs(gs,{children:[D.jsx(ou,{color:"gray.400",fontSize:"sm",children:"Nickname"}),D.jsx(zo,{ref:H,name:"Nickname",value:p.Nickname,onChange:G,onFocus:()=>{O(!0);const de=document.querySelector("#unity-canvas");de&&de.blur()},placeholder:"Enter nickname",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"}})]}),D.jsxs(gs,{children:[D.jsx(ou,{color:"gray.400",fontSize:"sm",children:"Company Name"}),D.jsx(zo,{name:"companyName",value:p.companyName,onChange:G,placeholder:"Enter company name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"}})]}),D.jsxs(kc,{gap:4,children:[D.jsxs(gs,{children:[D.jsx(ou,{color:"gray.400",fontSize:"sm",children:"First Name"}),D.jsx(zo,{name:"firstName",value:p.firstName,onChange:G,placeholder:"Enter first name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"}})]}),D.jsxs(gs,{children:[D.jsx(ou,{color:"gray.400",fontSize:"sm",children:"Last Name"}),D.jsx(zo,{name:"lastName",value:p.lastName,onChange:G,placeholder:"Enter last name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"}})]})]}),D.jsxs(gs,{children:[D.jsx(ou,{color:"gray.400",fontSize:"sm",children:"LinkedIn Profile"}),D.jsx(zo,{name:"linkedInProfile",value:p.linkedInProfile,onChange:G,placeholder:"Enter LinkedIn profile URL",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"}})]}),D.jsxs(kc,{gap:2,justify:"flex-end",mt:2,children:[D.jsx(qa,{onClick:()=>{E({Nickname:(s==null?void 0:s.Nickname)||"",companyName:(s==null?void 0:s.companyName)||"",firstName:(s==null?void 0:s.firstName)||"",lastName:(s==null?void 0:s.lastName)||"",linkedInProfile:(s==null?void 0:s.linkedInProfile)||""}),d(!1)},variant:"outline",size:"sm",isDisabled:v,color:"white",borderColor:"gray.600",_hover:{bg:"gray.700"},children:"Cancel"}),D.jsx(qa,{onClick:ee,colorScheme:"blue",size:"sm",isLoading:v,children:"Save Changes"})]})]});return D.jsxs(xh,{isOpen:r,onClose:z,isCentered:!0,closeOnOverlayClick:!l,trapFocus:!0,blockScrollOnMount:!1,size:"md",children:[D.jsx(Fh,{backdropFilter:"blur(10px)"}),D.jsxs(Mh,{bg:"gray.800",color:"white",children:[D.jsx(cp,{children:"Profile"}),D.jsx(Vh,{}),D.jsx(Uh,{pb:6,children:D.jsxs(Us,{spacing:6,children:[D.jsx(Oh,{src:a,size:"2xl",borderRadius:"full"}),l?re():J()]})})]})]})},qO={bg:"white",color:"black",borderRadius:"full",px:"6",py:"2",height:"auto",fontSize:"md",fontWeight:"medium",_hover:{bg:"gray.100"},display:"flex",alignItems:"center",gap:2},mie=()=>{const{user:r,updateUser:t}=V.useContext(Ra),[s,a]=V.useState(!0),{isOpen:l,onOpen:d,onClose:p}=WS();V.useEffect(()=>{const b=setTimeout(()=>{a(!1)},500);return()=>clearTimeout(b)},[]);const E=()=>{p(),t()},v=r!=null&&r.rpmURL?r.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null;return s?null:D.jsx(kc,{align:"center",gap:"4",children:r?D.jsxs(D.Fragment,{children:[D.jsx(d4e,{isOpen:l,onClose:E,user:r,profileImageUrl:v}),D.jsxs(IF,{children:[D.jsx(AF,{as:Gt,cursor:"pointer",children:D.jsx(kc,{align:"center",height:"40px",px:4,borderRadius:"full",border:"1px solid rgba(255, 255, 255, 0.3)",transition:"all 0.2s",sx:{"&:hover":{border:"2px solid white"}},children:D.jsxs(kc,{align:"center",gap:"3",children:[D.jsx(Gt,{width:"28px",height:"28px",borderRadius:"full",overflow:"hidden",bg:"white",display:"flex",alignItems:"center",justifyContent:"center",children:D.jsx(Oh,{src:v,width:"100%",height:"100%",borderRadius:"full"})}),D.jsx(gn,{color:"white",fontWeight:"medium",children:r.Nickname}),D.jsx(Gt,{display:"flex",alignItems:"center",height:"28px",children:D.jsx(FBe,{color:"white",w:4,h:4})})]})})}),D.jsx(pu,{children:D.jsxs(OF,{bg:"gray.800",borderColor:"gray.700",zIndex:9999,children:[D.jsxs(Gt,{p:4,display:"flex",alignItems:"center",gap:3,children:[D.jsx(Oh,{src:v,size:"md",borderRadius:"full"}),D.jsx(gn,{fontSize:"xl",fontWeight:"bold",color:"white",children:r.Nickname})]}),D.jsx(Fw,{borderColor:"gray.700"}),D.jsx(Zb,{_hover:{bg:"gray.700"},color:"white",bg:"gray.800",children:"My Spaces"}),D.jsx(Zb,{onClick:d,_hover:{bg:"gray.700"},color:"white",bg:"gray.800",children:"View Profile"}),D.jsx(Fw,{borderColor:"gray.700"}),D.jsx(Zb,{_hover:{bg:"gray.700"},color:"white",bg:"gray.800",children:"Support"}),D.jsx(Zb,{_hover:{bg:"gray.700"},color:"white",bg:"gray.800",children:D.jsx(bk,{mode:"link",label:"Log out",linkProps:{color:"white",_hover:{textDecoration:"none"}}})})]})})]})]}):D.jsxs(D.Fragment,{children:[D.jsx(Sk,{mode:"button",label:"Register",buttonProps:{...qO,width:["100%","auto"]},customButton:D.jsxs(qa,{...qO,children:[D.jsx(Gt,{as:"span",fontSize:"xl",children:""}),"Register"]})}),D.jsx(Tk,{mode:"button",label:"Sign In",buttonProps:{...qO,width:["100%","auto"]},customButton:D.jsxs(qa,{...qO,children:[D.jsx(Gt,{as:"span",fontSize:"xl",children:""}),"Sign In"]})})]})})},g2=document.getElementById("header-auth-root");if(g2){const r=g2.getAttribute("data-theme")||"default",t=()=>{const[s,a]=V.useState(null);return V.useEffect(()=>{Kw(r).then(a)},[]),s?D.jsx(FN,{theme:s,children:D.jsx(yk,{children:D.jsx(kj,{children:D.jsx(mie,{})})})}):D.jsx("div",{children:"Loading theme..."})};EN.createRoot(g2).render(D.jsx(t,{}))}else console.error("Root element 'header-auth-root' not found.");var _2={},Nb={},kb={},yX;function h4e(){if(yX)return kb;yX=1,Object.defineProperty(kb,"__esModule",{value:!0}),kb.useUnityCanvasId=void 0;var r=uu(),t=0,s="react-unity-webgl-canvas",a=function(l){if(l.id!==void 0)return l.id;var d=(0,r.useMemo)(function(){return[s,++t].join("-")},[]);return d};return kb.useUnityCanvasId=a,kb}var jf={},Db={},vX;function gie(){if(vX)return Db;vX=1,Object.defineProperty(Db,"__esModule",{value:!0}),Db.UnityLoaderStatus=void 0;var r;return function(t){t.Idle="Idle",t.Loading="Loading",t.Loaded="Loaded",t.Error="Error"}(r||(Db.UnityLoaderStatus=r={})),Db}var Lb={},SX;function Uj(){return SX||(SX=1,Object.defineProperty(Lb,"__esModule",{value:!0}),Lb.isBrowserEnvironment=void 0,Lb.isBrowserEnvironment=typeof window<"u"&&typeof document<"u"),Lb}var TX;function f4e(){if(TX)return jf;TX=1;var r=jf&&jf.__awaiter||function(p,E,v,b){function R(O){return O instanceof v?O:new v(function(N){N(O)})}return new(v||(v=Promise))(function(O,N){function F(G){try{z(b.next(G))}catch(ee){N(ee)}}function H(G){try{z(b.throw(G))}catch(ee){N(ee)}}function z(G){G.done?O(G.value):R(G.value).then(F,H)}z((b=b.apply(p,E||[])).next())})},t=jf&&jf.__generator||function(p,E){var v={label:0,sent:function(){if(O[0]&1)throw O[1];return O[1]},trys:[],ops:[]},b,R,O,N=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return N.next=F(0),N.throw=F(1),N.return=F(2),typeof Symbol=="function"&&(N[Symbol.iterator]=function(){return this}),N;function F(z){return function(G){return H([z,G])}}function H(z){if(b)throw new TypeError("Generator is already executing.");for(;N&&(N=0,z[0]&&(v=0)),v;)try{if(b=1,R&&(O=z[0]&2?R.return:z[0]?R.throw||((O=R.return)&&O.call(R),0):R.next)&&!(O=O.call(R,z[1])).done)return O;switch(R=0,O&&(z=[z[0]&2,O.value]),z[0]){case 0:case 1:O=z;break;case 4:return v.label++,{value:z[1],done:!1};case 5:v.label++,R=z[1],z=[0];continue;case 7:z=v.ops.pop(),v.trys.pop();continue;default:if(O=v.trys,!(O=O.length>0&&O[O.length-1])&&(z[0]===6||z[0]===2)){v=0;continue}if(z[0]===3&&(!O||z[1]>O[0]&&z[1]<O[3])){v.label=z[1];break}if(z[0]===6&&v.label<O[1]){v.label=O[1],O=z;break}if(O&&v.label<O[2]){v.label=O[2],v.ops.push(z);break}O[2]&&v.ops.pop(),v.trys.pop();continue}z=E.call(p,v)}catch(G){z=[6,G],R=0}finally{b=O=0}if(z[0]&5)throw z[1];return{value:z[0]?z[1]:void 0,done:!0}}};Object.defineProperty(jf,"__esModule",{value:!0}),jf.useUnityInstance=void 0;var s=uu(),a=gie(),l=Uj(),d=function(p,E,v,b){(0,s.useEffect)(function(){(function(){return r(void 0,void 0,void 0,function(){var R,O;return t(this,function(N){switch(N.label){case 0:if(l.isBrowserEnvironment===!1)return[2];if(p!==a.UnityLoaderStatus.Loaded||E===null)return b.setUnityInstance(null),b.setInitialisationError(null),[2];N.label=1;case 1:return N.trys.push([1,3,,4]),[4,window.createUnityInstance(E,v,b.setLoadingProgression)];case 2:return R=N.sent(),b.setUnityInstance(R),b.setInitialisationError(null),[3,4];case 3:return O=N.sent(),b.setUnityInstance(null),b.setInitialisationError(O),[3,4];case 4:return[2]}})})})()},[p,E,v,b])};return jf.useUnityInstance=d,jf}var xb={},bX;function p4e(){if(bX)return xb;bX=1,Object.defineProperty(xb,"__esModule",{value:!0}),xb.useUnityArguments=void 0;var r=uu(),t=function(s){return(0,r.useMemo)(function(){return{dataUrl:s.unityProvider.unityConfig.dataUrl,frameworkUrl:s.unityProvider.unityConfig.frameworkUrl,codeUrl:s.unityProvider.unityConfig.codeUrl,streamingAssetsUrl:s.unityProvider.unityConfig.streamingAssetsUrl,memoryUrl:s.unityProvider.unityConfig.memoryUrl,symbolsUrl:s.unityProvider.unityConfig.symbolsUrl,workerUrl:s.unityProvider.unityConfig.workerUrl,companyName:s.unityProvider.unityConfig.companyName,productName:s.unityProvider.unityConfig.productName,productVersion:s.unityProvider.unityConfig.productVersion,webglContextAttributes:s.unityProvider.unityConfig.webglContextAttributes||{},cacheControl:s.unityProvider.unityConfig.cacheControl||function(){return"must-revalidate"},devicePixelRatio:s.devicePixelRatio||1,autoSyncPersistentDataPath:s.autoSyncPersistentDataPath,matchWebGLToCanvasSize:typeof s.matchWebGLToCanvasSize=="boolean"?s.matchWebGLToCanvasSize:!0,disabledCanvasEvents:s.disabledCanvasEvents||["contextmenu","dragstart"],print:function(a){},printErr:function(a){}}},[])};return xb.useUnityArguments=t,xb}var Mb={},wX;function m4e(){if(wX)return Mb;wX=1,Object.defineProperty(Mb,"__esModule",{value:!0}),Mb.useUnityLoader=void 0;var r=uu(),t=Uj(),s=gie(),a=function(l){var d=(0,r.useState)(s.UnityLoaderStatus.Loading),p=d[0],E=d[1];return(0,r.useEffect)(function(){if(t.isBrowserEnvironment!==!1){if(l.loaderUrl===null){E(s.UnityLoaderStatus.Idle);return}var v=window.document.querySelector('script[src="'.concat(l.loaderUrl,'"]'));v===null?(v=window.document.createElement("script"),v.type="text/javascript",v.src=l.loaderUrl,v.async=!0,v.setAttribute("data-status","loading"),window.document.body.appendChild(v),v.addEventListener("load",function(){return v==null?void 0:v.setAttribute("data-status","loaded")}),v.addEventListener("error",function(){return v==null?void 0:v.setAttribute("data-status","error")})):E(v.getAttribute("data-status")==="loaded"?s.UnityLoaderStatus.Loaded:s.UnityLoaderStatus.Error);var b=function(R){return E(R.type==="load"?s.UnityLoaderStatus.Loaded:s.UnityLoaderStatus.Error)};return v.addEventListener("load",b),v.addEventListener("error",b),function(){v!==null&&(v.removeEventListener("load",b),v.removeEventListener("error",b),window.document.body.removeChild(v))}}},[l.loaderUrl]),p};return Mb.useUnityLoader=a,Mb}var RX;function g4e(){if(RX)return Nb;RX=1,Object.defineProperty(Nb,"__esModule",{value:!0}),Nb.Unity=void 0;var r=uu(),t=uu(),s=h4e(),a=f4e(),l=p4e(),d=m4e(),p=(0,t.forwardRef)(function(E,v){var b=(0,t.useRef)(null),R=(0,s.useUnityCanvasId)(E),O=(0,l.useUnityArguments)(E),N=(0,d.useUnityLoader)(E.unityProvider.unityConfig);return(0,a.useUnityInstance)(N,b.current,O,E.unityProvider),(0,r.useImperativeHandle)(v,function(){return b.current}),(0,r.createElement)("canvas",{ref:b,id:R,style:E.style,className:E.className,tabIndex:E.tabIndex})});return Nb.Unity=p,Nb}var Bf={},Ub={},CX;function _ie(){if(CX)return Ub;CX=1,Object.defineProperty(Ub,"__esModule",{value:!0}),Ub.errorMessages=void 0;var r={genericNoUnityInstance:"No Unity Instance found.",requestFullscreenNoUnityInstance:"Unable to Set Fullscreen while Unity is not Instantiated.",requestPointerLockNoUnityInstanceOrCanvas:"Unable to Request Pointer Lock while Unity is not Instantiated or the Canvas is not found.",sendMessageNoUnityInstance:"Unable to Send Message while Unity is not Instantiated.",quitNoUnityInstance:"Unable to Quit Unity while Unity is not Instantiated.",screenshotNoUnityInstanceOrCanvas:"Unable to Take Screenshot while Unity is not Instantiated or Canvas is not available.",noEventListener:"Unable to find Event Listener in Event System for Event"};return Ub.errorMessages=r,Ub}var C_={},IX;function _4e(){if(IX)return C_;IX=1;var r=C_&&C_.__spreadArray||function(E,v,b){if(b||arguments.length===2)for(var R=0,O=v.length,N;R<O;R++)(N||!(R in v))&&(N||(N=Array.prototype.slice.call(v,0,R)),N[R]=v[R]);return E.concat(N||Array.prototype.slice.call(v))};Object.defineProperty(C_,"__esModule",{value:!0}),C_.useEventSystem=void 0;var t=uu(),s=_ie(),a=Uj(),l=[],d=function(E){for(var v=[],b=1;b<arguments.length;b++)v[b-1]=arguments[b];var R=void 0;return l.forEach(function(O){R=O.apply(void 0,r([E],v,!1))}),R};a.isBrowserEnvironment===!0&&(window.dispatchReactUnityEvent=d);var p=function(){var E=(0,t.useRef)([]),v=(0,t.useCallback)(function(O,N){E.current=r(r([],E.current,!0),[{eventName:O,callback:N}],!1)},[E]),b=(0,t.useCallback)(function(O,N){E.current=E.current.filter(function(F){return F.eventName!==O&&F.callback!==N})},[E]),R=(0,t.useCallback)(function(O){for(var N=[],F=1;F<arguments.length;F++)N[F-1]=arguments[F];var H=E.current.find(function(z){return z.eventName===O});if(typeof H>"u"){console.warn(s.errorMessages.noEventListener,{eventName:O});return}return H.callback.apply(H,N)},[E]);return(0,t.useEffect)(function(){return l.push(R),function(){l.splice(l.indexOf(R),1)}},[R]),{addEventListener:v,removeEventListener:b}};return C_.useEventSystem=p,C_}var Vb={},AX;function E4e(){if(AX)return Vb;AX=1,Object.defineProperty(Vb,"__esModule",{value:!0}),Vb.useNullableState=void 0;var r=uu(),t=function(s){return(0,r.useState)(s||null)};return Vb.useNullableState=t,Vb}var OX;function y4e(){if(OX)return Bf;OX=1;var r=Bf&&Bf.__awaiter||function(E,v,b,R){function O(N){return N instanceof b?N:new b(function(F){F(N)})}return new(b||(b=Promise))(function(N,F){function H(ee){try{G(R.next(ee))}catch(J){F(J)}}function z(ee){try{G(R.throw(ee))}catch(J){F(J)}}function G(ee){ee.done?N(ee.value):O(ee.value).then(H,z)}G((R=R.apply(E,v||[])).next())})},t=Bf&&Bf.__generator||function(E,v){var b={label:0,sent:function(){if(N[0]&1)throw N[1];return N[1]},trys:[],ops:[]},R,O,N,F=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return F.next=H(0),F.throw=H(1),F.return=H(2),typeof Symbol=="function"&&(F[Symbol.iterator]=function(){return this}),F;function H(G){return function(ee){return z([G,ee])}}function z(G){if(R)throw new TypeError("Generator is already executing.");for(;F&&(F=0,G[0]&&(b=0)),b;)try{if(R=1,O&&(N=G[0]&2?O.return:G[0]?O.throw||((N=O.return)&&N.call(O),0):O.next)&&!(N=N.call(O,G[1])).done)return N;switch(O=0,N&&(G=[G[0]&2,N.value]),G[0]){case 0:case 1:N=G;break;case 4:return b.label++,{value:G[1],done:!1};case 5:b.label++,O=G[1],G=[0];continue;case 7:G=b.ops.pop(),b.trys.pop();continue;default:if(N=b.trys,!(N=N.length>0&&N[N.length-1])&&(G[0]===6||G[0]===2)){b=0;continue}if(G[0]===3&&(!N||G[1]>N[0]&&G[1]<N[3])){b.label=G[1];break}if(G[0]===6&&b.label<N[1]){b.label=N[1],N=G;break}if(N&&b.label<N[2]){b.label=N[2],b.ops.push(G);break}N[2]&&b.ops.pop(),b.trys.pop();continue}G=v.call(E,b)}catch(ee){G=[6,ee],O=0}finally{R=N=0}if(G[0]&5)throw G[1];return{value:G[0]?G[1]:void 0,done:!0}}};Object.defineProperty(Bf,"__esModule",{value:!0}),Bf.useUnityContext=void 0;var s=uu(),a=_ie(),l=_4e(),d=E4e(),p=function(E){var v=(0,d.useNullableState)(),b=v[0],R=v[1],O=(0,s.useState)(0),N=O[0],F=O[1],H=(0,s.useState)(!1),z=H[0],G=H[1],ee=(0,d.useNullableState)(),J=ee[0],re=ee[1],de=(0,l.useEventSystem)(),se=(0,s.useRef)({setLoadingProgression:F,setInitialisationError:re,setUnityInstance:R,setIsLoaded:G,unityConfig:E}),ye=(0,s.useCallback)(function(fe){if(b===null){console.warn(a.errorMessages.requestFullscreenNoUnityInstance);return}b.SetFullscreen(fe===!0?1:0)},[b]),Q=(0,s.useCallback)(function(){if(b===null||typeof b.Module.canvas>"u"){console.warn(a.errorMessages.requestPointerLockNoUnityInstanceOrCanvas);return}return b.Module.canvas.requestPointerLock()},[b]),ne=(0,s.useCallback)(function(fe,le,Le){if(b===null){console.warn(a.errorMessages.sendMessageNoUnityInstance);return}b.SendMessage(fe,le,Le)},[b]),oe=(0,s.useCallback)(function(fe,le){if(b===null||typeof b.Module.canvas>"u"){console.warn(a.errorMessages.screenshotNoUnityInstanceOrCanvas);return}return b.Module.canvas.toDataURL(fe,le)},[b]),ue=(0,s.useCallback)(function(){return b===null?(console.warn(a.errorMessages.quitNoUnityInstance),Promise.reject()):b.Quit()},[b]),Ee=(0,s.useCallback)(function(){return r(void 0,void 0,void 0,function(){var fe;return t(this,function(le){switch(le.label){case 0:return b===null||typeof b.Module.canvas>"u"?(console.warn(a.errorMessages.genericNoUnityInstance),[2,Promise.reject()]):(fe=b.Module.canvas,document.body.appendChild(fe),fe.style.display="none",[4,ue()]);case 1:return le.sent(),fe.remove(),[2]}})})},[b]);return(0,s.useEffect)(function(){G(N===1)},[N]),{unityProvider:se.current,loadingProgression:N,initialisationError:J,isLoaded:z,UNSAFE__unityInstance:b,requestFullscreen:ye,requestPointerLock:Q,sendMessage:ne,takeScreenshot:oe,unload:ue,UNSAFE__detachAndUnloadImmediate:Ee,addEventListener:de.addEventListener,removeEventListener:de.removeEventListener}};return Bf.useUnityContext=p,Bf}var PX;function v4e(){return PX||(PX=1,function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.useUnityContext=r.Unity=void 0;var t=g4e();Object.defineProperty(r,"Unity",{enumerable:!0,get:function(){return t.Unity}});var s=y4e();Object.defineProperty(r,"useUnityContext",{enumerable:!0,get:function(){return s.useUnityContext}})}(_2)),_2}var Eie=v4e();const sd="[UnityProvider]",yie=V.createContext(),S4e=({spaceID:r,children:t,loaderUrl:s,dataUrl:a,frameworkUrl:l,codeUrl:d,loadingBackground:p,showLoginButton:E,showDisruptiveLogo:v})=>{Rt.log(`${sd} Initializing with spaceID:`,r),Rt.log(`${sd} Unity URLs:`,{loaderUrl:s,dataUrl:a,frameworkUrl:l,codeUrl:d});const{unityProvider:b,loadingProgression:R,isLoaded:O,sendMessage:N,addEventListener:F,removeEventListener:H,error:z}=Eie.useUnityContext({loaderUrl:s,dataUrl:a,frameworkUrl:l,codeUrl:d}),G=V.useRef(null),ee=V.useRef(Date.now());V.useEffect(()=>{const se=()=>{document.hidden?(Rt.log(`${sd} Page hidden, starting keep-alive`),J()):(Rt.log(`${sd} Page visible, stopping keep-alive`),re())};return document.addEventListener("visibilitychange",se),()=>{document.removeEventListener("visibilitychange",se),re()}},[]),V.useEffect(()=>{const se=()=>{ee.current=Date.now(),document.hidden&&N("WebGLInputManager","KeepAlive")};return window.addEventListener("mousemove",se),window.addEventListener("keydown",se),window.addEventListener("touchstart",se),()=>{window.removeEventListener("mousemove",se),window.removeEventListener("keydown",se),window.removeEventListener("touchstart",se)}},[N]);const J=()=>{G.current||(G.current=setInterval(()=>{O&&document.hidden&&(N("WebGLInputManager","KeepAlive"),Rt.debug(`${sd} Sent keep-alive message`))},1e4))},re=()=>{G.current&&(clearInterval(G.current),G.current=null)};V.useEffect(()=>(Rt.log(`${sd} Component mounted`),()=>{Rt.log(`${sd} Component unmounting`),re()}),[]),V.useEffect(()=>{Rt.log(`${sd} Loading progress:`,R)},[R]),V.useEffect(()=>{O&&(Rt.log(`${sd} Unity instance loaded for:`,r),document.hidden&&J())},[O,r]),V.useEffect(()=>{z&&Rt.error(`${sd} Unity error:`,z)},[z]);const de={spaceID:r,unityProvider:b,loadingProgression:R,isLoaded:O,sendMessage:N,addEventListener:F,removeEventListener:H};return Rt.log(`${sd} Rendering provider with instance:`,de),D.jsx(yie.Provider,{value:de,children:t})},iT=()=>V.useContext(yie);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vie="firebasestorage.googleapis.com",Sie="storageBucket",T4e=2*60*1e3,b4e=10*60*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _o extends jh{constructor(t,s,a=0){super(E2(t),`Firebase Storage: ${s} (${E2(t)})`),this.status_=a,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,_o.prototype)}get status(){return this.status_}set status(t){this.status_=t}_codeEquals(t){return E2(t)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(t){this.customData.serverResponse=t,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var go;(function(r){r.UNKNOWN="unknown",r.OBJECT_NOT_FOUND="object-not-found",r.BUCKET_NOT_FOUND="bucket-not-found",r.PROJECT_NOT_FOUND="project-not-found",r.QUOTA_EXCEEDED="quota-exceeded",r.UNAUTHENTICATED="unauthenticated",r.UNAUTHORIZED="unauthorized",r.UNAUTHORIZED_APP="unauthorized-app",r.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",r.INVALID_CHECKSUM="invalid-checksum",r.CANCELED="canceled",r.INVALID_EVENT_NAME="invalid-event-name",r.INVALID_URL="invalid-url",r.INVALID_DEFAULT_BUCKET="invalid-default-bucket",r.NO_DEFAULT_BUCKET="no-default-bucket",r.CANNOT_SLICE_BLOB="cannot-slice-blob",r.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",r.NO_DOWNLOAD_URL="no-download-url",r.INVALID_ARGUMENT="invalid-argument",r.INVALID_ARGUMENT_COUNT="invalid-argument-count",r.APP_DELETED="app-deleted",r.INVALID_ROOT_OPERATION="invalid-root-operation",r.INVALID_FORMAT="invalid-format",r.INTERNAL_ERROR="internal-error",r.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(go||(go={}));function E2(r){return"storage/"+r}function Tie(){const r="An unknown error occurred, please check the error payload for server response.";return new _o(go.UNKNOWN,r)}function w4e(r){return new _o(go.OBJECT_NOT_FOUND,"Object '"+r+"' does not exist.")}function R4e(r){return new _o(go.QUOTA_EXCEEDED,"Quota for bucket '"+r+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function C4e(){const r="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new _o(go.UNAUTHENTICATED,r)}function I4e(){return new _o(go.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function A4e(r){return new _o(go.UNAUTHORIZED,"User does not have permission to access '"+r+"'.")}function O4e(){return new _o(go.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function P4e(){return new _o(go.CANCELED,"User canceled the upload/download.")}function N4e(r){return new _o(go.INVALID_URL,"Invalid URL '"+r+"'.")}function k4e(r){return new _o(go.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+r+"'.")}function D4e(){return new _o(go.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+Sie+"' property when initializing the app?")}function L4e(){return new _o(go.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function XU(r){return new _o(go.INVALID_ARGUMENT,r)}function bie(){return new _o(go.APP_DELETED,"The Firebase app was deleted.")}function x4e(r){return new _o(go.INVALID_ROOT_OPERATION,"The operation '"+r+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function Fb(r){throw new _o(go.INTERNAL_ERROR,"Internal error: "+r)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fl{constructor(t,s){this.bucket=t,this.path_=s}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const t=encodeURIComponent;return"/b/"+t(this.bucket)+"/o/"+t(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(t,s){let a;try{a=fl.makeFromUrl(t,s)}catch{return new fl(t,"")}if(a.path==="")return a;throw k4e(t)}static makeFromUrl(t,s){let a=null;const l="([A-Za-z0-9.\\-_]+)";function d(de){de.path.charAt(de.path.length-1)==="/"&&(de.path_=de.path_.slice(0,-1))}const p="(/(.*))?$",E=new RegExp("^gs://"+l+p,"i"),v={bucket:1,path:3};function b(de){de.path_=decodeURIComponent(de.path)}const R="v[A-Za-z0-9_]+",O=s.replace(/[.]/g,"\\."),N="(/([^?#]*).*)?$",F=new RegExp(`^https?://${O}/${R}/b/${l}/o${N}`,"i"),H={bucket:1,path:3},z=s===vie?"(?:storage.googleapis.com|storage.cloud.google.com)":s,G="([^?#]*)",ee=new RegExp(`^https?://${z}/${l}/${G}`,"i"),re=[{regex:E,indices:v,postModify:d},{regex:F,indices:H,postModify:b},{regex:ee,indices:{bucket:1,path:2},postModify:b}];for(let de=0;de<re.length;de++){const se=re[de],ye=se.regex.exec(t);if(ye){const Q=ye[se.indices.bucket];let ne=ye[se.indices.path];ne||(ne=""),a=new fl(Q,ne),se.postModify(a);break}}if(a==null)throw N4e(t);return a}}class M4e{constructor(t){this.promise_=Promise.reject(t)}getPromise(){return this.promise_}cancel(t=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function U4e(r,t,s){let a=1,l=null,d=null,p=!1,E=0;function v(){return E===2}let b=!1;function R(...G){b||(b=!0,t.apply(null,G))}function O(G){l=setTimeout(()=>{l=null,r(F,v())},G)}function N(){d&&clearTimeout(d)}function F(G,...ee){if(b){N();return}if(G){N(),R.call(null,G,...ee);return}if(v()||p){N(),R.call(null,G,...ee);return}a<64&&(a*=2);let re;E===1?(E=2,re=0):re=(a+Math.random())*1e3,O(re)}let H=!1;function z(G){H||(H=!0,N(),!b&&(l!==null?(G||(E=2),clearTimeout(l),O(0)):G||(E=1)))}return O(0),d=setTimeout(()=>{p=!0,z(!0)},s),z}function V4e(r){r(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function F4e(r){return r!==void 0}function j4e(r){return typeof r=="object"&&!Array.isArray(r)}function wie(r){return typeof r=="string"||r instanceof String}function NX(r,t,s,a){if(a<t)throw XU(`Invalid value for '${r}'. Expected ${t} or greater.`);if(a>s)throw XU(`Invalid value for '${r}'. Expected ${s} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rie(r,t,s){let a=t;return s==null&&(a=`https://${t}`),`${s}://${a}/v0${r}`}function Cie(r){const t=encodeURIComponent;let s="?";for(const a in r)if(r.hasOwnProperty(a)){const l=t(a)+"="+t(r[a]);s=s+l+"&"}return s=s.slice(0,-1),s}var K_;(function(r){r[r.NO_ERROR=0]="NO_ERROR",r[r.NETWORK_ERROR=1]="NETWORK_ERROR",r[r.ABORT=2]="ABORT"})(K_||(K_={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function B4e(r,t){const s=r>=500&&r<600,l=[408,429].indexOf(r)!==-1,d=t.indexOf(r)!==-1;return s||l||d}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class W4e{constructor(t,s,a,l,d,p,E,v,b,R,O,N=!0){this.url_=t,this.method_=s,this.headers_=a,this.body_=l,this.successCodes_=d,this.additionalRetryCodes_=p,this.callback_=E,this.errorCallback_=v,this.timeout_=b,this.progressCallback_=R,this.connectionFactory_=O,this.retry=N,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((F,H)=>{this.resolve_=F,this.reject_=H,this.start_()})}start_(){const t=(a,l)=>{if(l){a(!1,new $O(!1,null,!0));return}const d=this.connectionFactory_();this.pendingConnection_=d;const p=E=>{const v=E.loaded,b=E.lengthComputable?E.total:-1;this.progressCallback_!==null&&this.progressCallback_(v,b)};this.progressCallback_!==null&&d.addUploadProgressListener(p),d.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&d.removeUploadProgressListener(p),this.pendingConnection_=null;const E=d.getErrorCode()===K_.NO_ERROR,v=d.getStatus();if(!E||B4e(v,this.additionalRetryCodes_)&&this.retry){const R=d.getErrorCode()===K_.ABORT;a(!1,new $O(!1,null,R));return}const b=this.successCodes_.indexOf(v)!==-1;a(!0,new $O(b,d))})},s=(a,l)=>{const d=this.resolve_,p=this.reject_,E=l.connection;if(l.wasSuccessCode)try{const v=this.callback_(E,E.getResponse());F4e(v)?d(v):d()}catch(v){p(v)}else if(E!==null){const v=Tie();v.serverResponse=E.getErrorText(),this.errorCallback_?p(this.errorCallback_(E,v)):p(v)}else if(l.canceled){const v=this.appDelete_?bie():P4e();p(v)}else{const v=O4e();p(v)}};this.canceled_?s(!1,new $O(!1,null,!0)):this.backoffId_=U4e(t,s,this.timeout_)}getPromise(){return this.promise_}cancel(t){this.canceled_=!0,this.appDelete_=t||!1,this.backoffId_!==null&&V4e(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class $O{constructor(t,s,a){this.wasSuccessCode=t,this.connection=s,this.canceled=!!a}}function G4e(r,t){t!==null&&t.length>0&&(r.Authorization="Firebase "+t)}function z4e(r,t){r["X-Firebase-Storage-Version"]="webjs/"+(t??"AppManager")}function H4e(r,t){t&&(r["X-Firebase-GMPID"]=t)}function K4e(r,t){t!==null&&(r["X-Firebase-AppCheck"]=t)}function q4e(r,t,s,a,l,d,p=!0){const E=Cie(r.urlParams),v=r.url+E,b=Object.assign({},r.headers);return H4e(b,t),G4e(b,s),z4e(b,d),K4e(b,a),new W4e(v,r.method,b,r.body,r.successCodes,r.additionalRetryCodes,r.handler,r.errorHandler,r.timeout,r.progressCallback,l,p)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Iie(r){let t;try{t=JSON.parse(r)}catch{return null}return j4e(t)?t:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $4e(r){if(r.length===0)return null;const t=r.lastIndexOf("/");return t===-1?"":r.slice(0,t)}function Y4e(r,t){const s=t.split("/").filter(a=>a.length>0).join("/");return r.length===0?s:r+"/"+s}function Aie(r){const t=r.lastIndexOf("/",r.length-2);return t===-1?r:r.slice(t+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function X4e(r,t){return t}class Ga{constructor(t,s,a,l){this.server=t,this.local=s||t,this.writable=!!a,this.xform=l||X4e}}let YO=null;function J4e(r){return!wie(r)||r.length<2?r:Aie(r)}function Q4e(){if(YO)return YO;const r=[];r.push(new Ga("bucket")),r.push(new Ga("generation")),r.push(new Ga("metageneration")),r.push(new Ga("name","fullPath",!0));function t(d,p){return J4e(p)}const s=new Ga("name");s.xform=t,r.push(s);function a(d,p){return p!==void 0?Number(p):p}const l=new Ga("size");return l.xform=a,r.push(l),r.push(new Ga("timeCreated")),r.push(new Ga("updated")),r.push(new Ga("md5Hash",null,!0)),r.push(new Ga("cacheControl",null,!0)),r.push(new Ga("contentDisposition",null,!0)),r.push(new Ga("contentEncoding",null,!0)),r.push(new Ga("contentLanguage",null,!0)),r.push(new Ga("contentType",null,!0)),r.push(new Ga("metadata","customMetadata",!0)),YO=r,YO}function Z4e(r,t){function s(){const a=r.bucket,l=r.fullPath,d=new fl(a,l);return t._makeStorageReference(d)}Object.defineProperty(r,"ref",{get:s})}function e3e(r,t,s){const a={};a.type="file";const l=s.length;for(let d=0;d<l;d++){const p=s[d];a[p.local]=p.xform(a,t[p.server])}return Z4e(a,r),a}function t3e(r,t,s){const a=Iie(t);return a===null?null:e3e(r,a,s)}function n3e(r,t,s,a){const l=Iie(t);if(l===null||!wie(l.downloadTokens))return null;const d=l.downloadTokens;if(d.length===0)return null;const p=encodeURIComponent;return d.split(",").map(b=>{const R=r.bucket,O=r.fullPath,N="/b/"+p(R)+"/o/"+p(O),F=Rie(N,s,a),H=Cie({alt:"media",token:b});return F+H})[0]}class r3e{constructor(t,s,a,l){this.url=t,this.method=s,this.handler=a,this.timeout=l,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function i3e(r){if(!r)throw Tie()}function s3e(r,t){function s(a,l){const d=t3e(r,l,t);return i3e(d!==null),n3e(d,l,r.host,r._protocol)}return s}function o3e(r){function t(s,a){let l;return s.getStatus()===401?s.getErrorText().includes("Firebase App Check token is invalid")?l=I4e():l=C4e():s.getStatus()===402?l=R4e(r.bucket):s.getStatus()===403?l=A4e(r.path):l=a,l.status=s.getStatus(),l.serverResponse=a.serverResponse,l}return t}function a3e(r){const t=o3e(r);function s(a,l){let d=t(a,l);return a.getStatus()===404&&(d=w4e(r.path)),d.serverResponse=l.serverResponse,d}return s}function c3e(r,t,s){const a=t.fullServerUrl(),l=Rie(a,r.host,r._protocol),d="GET",p=r.maxOperationRetryTime,E=new r3e(l,d,s3e(r,s),p);return E.errorHandler=a3e(t),E}class l3e{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=K_.NO_ERROR,this.sendPromise_=new Promise(t=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=K_.ABORT,t()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=K_.NETWORK_ERROR,t()}),this.xhr_.addEventListener("load",()=>{t()})})}send(t,s,a,l){if(this.sent_)throw Fb("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(s,t,!0),l!==void 0)for(const d in l)l.hasOwnProperty(d)&&this.xhr_.setRequestHeader(d,l[d].toString());return a!==void 0?this.xhr_.send(a):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw Fb("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw Fb("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw Fb("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw Fb("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(t){return this.xhr_.getResponseHeader(t)}addUploadProgressListener(t){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",t)}removeUploadProgressListener(t){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",t)}}class u3e extends l3e{initXhr(){this.xhr_.responseType="text"}}function d3e(){return new u3e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oE{constructor(t,s){this._service=t,s instanceof fl?this._location=s:this._location=fl.makeFromUrl(s,t.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(t,s){return new oE(t,s)}get root(){const t=new fl(this._location.bucket,"");return this._newRef(this._service,t)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return Aie(this._location.path)}get storage(){return this._service}get parent(){const t=$4e(this._location.path);if(t===null)return null;const s=new fl(this._location.bucket,t);return new oE(this._service,s)}_throwIfRoot(t){if(this._location.path==="")throw x4e(t)}}function h3e(r){r._throwIfRoot("getDownloadURL");const t=c3e(r.storage,r._location,Q4e());return r.storage.makeRequestWithTokens(t,d3e).then(s=>{if(s===null)throw L4e();return s})}function f3e(r,t){const s=Y4e(r._location.path,t),a=new fl(r._location.bucket,s);return new oE(r.storage,a)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function p3e(r){return/^[A-Za-z]+:\/\//.test(r)}function m3e(r,t){return new oE(r,t)}function Oie(r,t){if(r instanceof Vj){const s=r;if(s._bucket==null)throw D4e();const a=new oE(s,s._bucket);return t!=null?Oie(a,t):a}else return t!==void 0?f3e(r,t):r}function g3e(r,t){if(t&&p3e(t)){if(r instanceof Vj)return m3e(r,t);throw XU("To use ref(service, url), the first argument must be a Storage instance.")}else return Oie(r,t)}function kX(r,t){const s=t==null?void 0:t[Sie];return s==null?null:fl.makeFromBucketSpec(s,r)}function _3e(r,t,s,a={}){r.host=`${t}:${s}`,r._protocol="http";const{mockUserToken:l}=a;l&&(r._overrideAuthToken=typeof l=="string"?l:Mte(l,r.app.options.projectId))}class Vj{constructor(t,s,a,l,d){this.app=t,this._authProvider=s,this._appCheckProvider=a,this._url=l,this._firebaseVersion=d,this._bucket=null,this._host=vie,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=T4e,this._maxUploadRetryTime=b4e,this._requests=new Set,l!=null?this._bucket=fl.makeFromBucketSpec(l,this._host):this._bucket=kX(this._host,this.app.options)}get host(){return this._host}set host(t){this._host=t,this._url!=null?this._bucket=fl.makeFromBucketSpec(this._url,t):this._bucket=kX(t,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(t){NX("time",0,Number.POSITIVE_INFINITY,t),this._maxUploadRetryTime=t}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(t){NX("time",0,Number.POSITIVE_INFINITY,t),this._maxOperationRetryTime=t}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const t=this._authProvider.getImmediate({optional:!0});if(t){const s=await t.getToken();if(s!==null)return s.accessToken}return null}async _getAppCheckToken(){if(ul(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const t=this._appCheckProvider.getImmediate({optional:!0});return t?(await t.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(t=>t.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(t){return new oE(this,t)}_makeRequest(t,s,a,l,d=!0){if(this._deleted)return new M4e(bie());{const p=q4e(t,this._appId,a,l,s,this._firebaseVersion,d);return this._requests.add(p),p.getPromise().then(()=>this._requests.delete(p),()=>this._requests.delete(p)),p}}async makeRequestWithTokens(t,s){const[a,l]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(t,s,a,l).getPromise()}}const DX="@firebase/storage",LX="0.13.7";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pie="storage";function E3e(r){return r=Qi(r),h3e(r)}function y3e(r,t){return r=Qi(r),g3e(r,t)}function v3e(r=xF(),t){r=Qi(r);const a=XN(r,Pie).getImmediate({identifier:t}),l=Dte("storage");return l&&S3e(a,...l),a}function S3e(r,t,s,a={}){_3e(r,t,s,a)}function T3e(r,{instanceIdentifier:t}){const s=r.getProvider("app").getImmediate(),a=r.getProvider("auth-internal"),l=r.getProvider("app-check-internal");return new Vj(s,a,l,t,lE)}function b3e(){eE(new jm(Pie,T3e,"PUBLIC").setMultipleInstances(!0)),bh(DX,LX,""),bh(DX,LX,"esm2017")}b3e();const Nie=async r=>{const t=v3e(),s=y3e(t,r);try{return await E3e(s)}catch(a){throw Rt.error("Failed to fetch HTTP URL from gs:// URL:","/src/packages/shared/firebase/firebaseStorage.js",a),a}};let w3e={};const R3e=async r=>{try{const t=FS(qm,"spaces",r),s=await $U(t);if(s.exists()){let a=s.data();if(a.webglBuildId){const l=FS(qm,"webglBuilds",a.webglBuildId),d=await $U(l);if(d.exists()){const p=d.data();a={...a,...p}}else Rt.warn(`spacesFirestore: No document found for webglBuildId: ${a.webglBuildId}`)}return a=await C3e(a),a=I3e(a),console.log("Space data:",a),Rt.log(`spacesFirestore: Caching space data for: ${r}`),w3e[r]=a,a}else return Rt.warn(`spacesFirestore: No document found for item ID: ${r}`),null}catch(t){throw Rt.error("spacesFirestore: Error fetching item data:",t),t}},C3e=async r=>{const s=["gsUrlCode","gsUrlData","gsUrlFramework","gsUrlLoader","gsUrlLoadingBackground"].map(async a=>{const l=r[a];l&&l.startsWith("gs://")&&(r[a]=await Nie(l))});return await Promise.all(s),r},I3e=r=>{const{gsUrlCode:t,gsUrlData:s,gsUrlFramework:a,gsUrlLoader:l,...d}=r;return{...d,codeUrl:t,dataUrl:s,frameworkUrl:a,loaderUrl:l}};let y2={};const kie=async r=>{Rt.log("spacesFirestore: Get Videos from Firestore for space: ",r);try{if(y2[r])return Rt.log("spacesFirestore: Returning cached videos for space:",r),y2[r];const t=Bre(qm,`spaces/${r}/videos`),s=await OBe(t),a=[];return s.forEach(l=>{a.push({id:l.id,...l.data()})}),y2[r]=a,a}catch(t){throw Rt.error("spacesFirestore: Error fetching Space videos from Firestore:",t),t}},wk=()=>{const{sendMessage:r,isLoaded:t}=iT(),s=V.useRef([]),a=V.useCallback(()=>{if(t)for(;s.current.length>0;){const{eventName:d,data:p}=s.current.shift();Rt.log("useSendUnityEvent: Processing queued event to Unity:",d,p);try{r("ReactIncomingEvent","HandleEvent",JSON.stringify({eventName:d,data:JSON.stringify(p)}))}catch(E){Rt.error("useSendUnityEvent: Error sending event to Unity:",E),s.current.unshift({eventName:d,data:p});break}}},[r,t]);return V.useEffect(()=>{const d=setInterval(()=>{a()},1e3);return()=>clearInterval(d)},[a]),V.useCallback((d,p)=>{Rt.log("useSendUnityEvent: Queuing event for Unity:",d),s.current.push({eventName:d,data:p}),a()},[a])},LR=()=>{const{addEventListener:r,removeEventListener:t}=iT();return V.useCallback((s,a)=>{const l=d=>{Rt.log(s+" unity message received.");let p=null;if(d)try{p=JSON.parse(d)}catch(E){Rt.warn("Failed to parse JSON data from Unity message:",E)}a(p)};return r(s,l),()=>{t(s,l)}},[r,t])},A3e=()=>{const[r,t]=V.useState(!1),s=LR();return V.useEffect(()=>{const l=s("FirstSceneLoaded",()=>{Rt.log("FirstSceneLoaded unity message received."),t(!0)});return()=>{l()}},[s]),r},O3e=r=>{const[t,s]=V.useState(null),a=LR(),{spaceID:l}=iT();return V.useEffect(()=>{let p=!0;const v=a("PlayVideo",async b=>{try{const{gameObjectName:R}=b;if(!R){Rt.error("Game object name is missing in Unity event data.");return}const O=await kie(l);Rt.log("SPACES VIDEOS",O);const N=O.find(F=>F.id===R);N&&p?(s(N.url),Rt.log("Video URL set to:",N.url)):console.error("Video not found for game object:",R)}catch(R){console.error("Error fetching space videos:",R)}});return()=>{p=!1,v()}},[a,l,r]),[t,()=>{s(null)}]},P3e=()=>{const r=LR(),{sendUserToUnity:t}=V.useContext(Ra);return V.useEffect(()=>{const a=r("RequestUserForUnity",()=>{Rt.log("React: Request from Unity to send user data"),t()});return()=>{a()}},[r,t]),!0},N3e=()=>{const{spaceID:r}=iT(),t=wk();V.useEffect(()=>{(async()=>{try{if(!r)throw new Error("spaceID is not defined.");const a=await kie(r),l=async E=>{const v=`https://vimeo.com/api/oembed.json?url=${E}`,b=await fetch(v);if(!b.ok)throw new Error(`Failed to fetch thumbnail: ${b.statusText}`);const R=await b.json(),O=R.thumbnail_url.replace(/_\d+x\d+/,""),N=["640x360","295x166"];let F=null;for(let H of N){const z=`https://i.vimeocdn.com/filter/overlay?src0=${encodeURIComponent(`${O}_${H}`)}&src1=http://f.vimeocdn.com/p/images/crawler_play.png`;try{if((await fetch(z,{method:"HEAD"})).ok){F=z;break}}catch(G){console.warn(`Failed to validate thumbnail URL: ${z}`,G)}}return F||R.thumbnail_url},d=a.map(async E=>{const v=await l(E.url);return{gameObjectName:E.id,thumbnailUrl:v}}),p=await Promise.all(d);Rt.log("Fetched Thumbnails",p),p.forEach(({gameObjectName:E,thumbnailUrl:v})=>{t("SetThumbnail",{gameObjectName:E,thumbnailUrl:v})})}catch(a){Rt.error("Error fetching thumbnails:",a)}})()},[t,r])},k3e=()=>{const[r,t]=V.useState(null),s=LR();return console.log(" Nameplate click hook initialized"),V.useEffect(()=>{console.log(" Setting up nameplate click listener...");const d=s("OpenNameplateModal",p=>{if(console.log(" Nameplate click detected!",p),!p){console.warn(" Received empty data in nameplate click handler");return}try{const E=typeof p=="string"?JSON.parse(p):p;t({playerName:E.playerName,playerId:E.playerId,uid:E.uid,isLocalPlayer:E.isLocalPlayer}),console.log(" Processed nameplate data:",E)}catch(E){console.error(" Error processing nameplate data:",E)}});return()=>{console.log(" Cleaning up nameplate click listener"),typeof d=="function"&&d()}},[s]),[r,()=>{console.log(" Resetting nameplate data"),t(null)}]},Die=()=>{const[r,t]=V.useState([]),s=LR();return V.useEffect(()=>{let a=!0,l=null;const d=()=>{window.unityInstance&&(Rt.log("Requesting fresh player list"),window.unityInstance.SendMessage("NetworkManager","RequestPlayerList"))},p=F=>{if(a){Rt.log("UpdatePlayerList unity message received.");try{let H=[];if(typeof F=="object"&&F!==null?H=F.players||[]:H=JSON.parse(F).players||[],Array.isArray(H)){const z=Array.from(new Map(H.map(G=>[G.playerId,G])).values());t(z),l&&(clearTimeout(l),l=null)}}catch(H){Rt.error("Error handling player list data:",H),l||(l=setTimeout(d,1e3))}}},E=()=>{Rt.log("Player disconnected, requesting fresh player list"),d()},v=()=>{Rt.log("Player left, requesting fresh player list"),d()};d();const b=s("UpdatePlayerList",p),R=s("PlayerDisconnected",E),O=s("PlayerLeft",v),N=setInterval(d,5e3);return()=>{a=!1,l&&clearTimeout(l),typeof b=="function"&&b(),typeof R=="function"&&R(),typeof O=="function"&&O(),clearInterval(N)}},[s]),r},D3e=r=>({opacity:1});xr.string.isRequired,xr.func.isRequired;function L3e(){const{loadingProgression:r,isLoaded:t,error:s}=iT(),{user:a}=V.useContext(Ra),[l,d]=V.useState(!1),[p,E]=V.useState(!1);return V.useEffect(()=>{d(!a&&r===0)},[a,r]),D.jsx(D.Fragment,{children:l?D.jsx(Gt,{position:"absolute",zIndex:"1",width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",children:D.jsxs(Us,{spacing:4,padding:6,borderRadius:"md",backgroundColor:"rgba(0, 0, 0, 0.8)",color:"white",children:[D.jsx(gn,{fontSize:"xl",fontWeight:"bold",children:"Sign In Required"}),D.jsx(gn,{textAlign:"center",children:"Please sign in to enter The Disruptive Spaces"}),D.jsx(qa,{colorScheme:"blue",size:"lg",width:"200px",onClick:()=>E(!0),children:"Sign In"})]})}):D.jsx(Gt,{position:"absolute",zIndex:"1",width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",transition:"opacity 3s ease-in-out",opacity:t?0:1,children:D.jsxs(kc,{flexDirection:"column",alignItems:"center",padding:4,marginY:4,borderRadius:"md",backgroundColor:"rgba(0, 0, 0, 0.8)",color:"white",zIndex:"1",children:[D.jsx(gn,{fontWeight:"bold",children:"Entering The Disruptive Spaces"}),D.jsxs(gn,{fontSize:"sm",children:[t?"World Initialising":"World loading","."]}),D.jsx(PF,{value:r*100,size:"lg",width:"100%",marginY:2})]})})})}function x3e(){const{user:r}=V.useContext(Ra);return D.jsx("div",{children:r!==null?D.jsx("div",{children:D.jsx(bk,{})}):D.jsxs("div",{children:[D.jsx(Sk,{}),D.jsx(Tk,{})]})})}function M3e(){const{fullscreenRef:r}=up(),[t,s]=V.useState(!1),a=()=>{s(!t)};return D.jsxs(D.Fragment,{children:[D.jsx(SR,{label:"Help",hasArrow:!0,placement:"top",closeOnClick:!0,portalProps:{containerRef:r},children:D.jsx(dl,{"aria-label":"Controller Help",icon:D.jsx(WBe,{}),onClick:a,variant:"iconButton"})}),D.jsxs(xh,{isOpen:t,onClose:a,size:"md",portalProps:{containerRef:r},children:[D.jsx(Fh,{}),D.jsxs(Mh,{children:[D.jsx(cp,{children:"Notes"}),D.jsx(Vh,{}),D.jsx(Uh,{children:D.jsx(gn,{variant:"formIntro",children:"The help button is showing so we can see the blur and transparency styles on the button."})}),D.jsx(GN,{children:D.jsx(qa,{variant:"primary",onClick:a,children:"Close"})})]})]})]})}var Lie={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},xX=Zr.createContext&&Zr.createContext(Lie),Mm=function(){return Mm=Object.assign||function(r){for(var t,s=1,a=arguments.length;s<a;s++){t=arguments[s];for(var l in t)Object.prototype.hasOwnProperty.call(t,l)&&(r[l]=t[l])}return r},Mm.apply(this,arguments)},U3e=function(r,t){var s={};for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&t.indexOf(a)<0&&(s[a]=r[a]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,a=Object.getOwnPropertySymbols(r);l<a.length;l++)t.indexOf(a[l])<0&&Object.prototype.propertyIsEnumerable.call(r,a[l])&&(s[a[l]]=r[a[l]]);return s};function xie(r){return r&&r.map(function(t,s){return Zr.createElement(t.tag,Mm({key:s},t.attr),xie(t.child))})}function ng(r){return function(t){return Zr.createElement(V3e,Mm({attr:Mm({},r.attr)},t),xie(r.child))}}function V3e(r){var t=function(s){var a=r.attr,l=r.size,d=r.title,p=U3e(r,["attr","size","title"]),E=l||s.size||"1em",v;return s.className&&(v=s.className),r.className&&(v=(v?v+" ":"")+r.className),Zr.createElement("svg",Mm({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},s.attr,a,p,{className:v,style:Mm(Mm({color:r.color||s.color},s.style),r.style),height:E,width:E,xmlns:"http://www.w3.org/2000/svg"}),d&&Zr.createElement("title",null,d),r.children)};return xX!==void 0?Zr.createElement(xX.Consumer,null,function(s){return t(s)}):t(Lie)}function Mie(r){return ng({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"}}]})(r)}function Uie(r){return ng({attr:{viewBox:"0 0 496 512"},child:[{tag:"path",attr:{d:"M336.5 160C322 70.7 287.8 8 248 8s-74 62.7-88.5 152h177zM152 256c0 22.2 1.2 43.5 3.3 64h185.3c2.1-20.5 3.3-41.8 3.3-64s-1.2-43.5-3.3-64H155.3c-2.1 20.5-3.3 41.8-3.3 64zm324.7-96c-28.6-67.9-86.5-120.4-158-141.6 24.4 33.8 41.2 84.7 50 141.6h108zM177.2 18.4C105.8 39.6 47.8 92.1 19.3 160h108c8.7-56.9 25.5-107.8 49.9-141.6zM487.4 192H372.7c2.1 21 3.3 42.5 3.3 64s-1.2 43-3.3 64h114.6c5.5-20.5 8.6-41.8 8.6-64s-3.1-43.5-8.5-64zM120 256c0-21.5 1.2-43 3.3-64H8.6C3.2 212.5 0 233.8 0 256s3.2 43.5 8.6 64h114.6c-2-21-3.2-42.5-3.2-64zm39.5 96c14.5 89.3 48.7 152 88.5 152s74-62.7 88.5-152h-177zm159.3 141.6c71.4-21.2 129.4-73.7 158-141.6h-108c-8.8 56.9-25.6 107.8-50 141.6zM19.3 352c28.6 67.9 86.5 120.4 158 141.6-24.4-33.8-41.2-84.7-50-141.6h-108z"}}]})(r)}function JU(r){return ng({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M633.82 458.1l-157.8-121.96C488.61 312.13 496 285.01 496 256v-48c0-8.84-7.16-16-16-16h-16c-8.84 0-16 7.16-16 16v48c0 17.92-3.96 34.8-10.72 50.2l-26.55-20.52c3.1-9.4 5.28-19.22 5.28-29.67V96c0-53.02-42.98-96-96-96s-96 42.98-96 96v45.36L45.47 3.37C38.49-2.05 28.43-.8 23.01 6.18L3.37 31.45C-2.05 38.42-.8 48.47 6.18 53.9l588.36 454.73c6.98 5.43 17.03 4.17 22.46-2.81l19.64-25.27c5.41-6.97 4.16-17.02-2.82-22.45zM400 464h-56v-33.77c11.66-1.6 22.85-4.54 33.67-8.31l-50.11-38.73c-6.71.4-13.41.87-20.35.2-55.85-5.45-98.74-48.63-111.18-101.85L144 241.31v6.85c0 89.64 63.97 169.55 152 181.69V464h-56c-8.84 0-16 7.16-16 16v16c0 8.84 7.16 16 16 16h160c8.84 0 16-7.16 16-16v-16c0-8.84-7.16-16-16-16z"}}]})(r)}function QU(r){return ng({attr:{viewBox:"0 0 352 512"},child:[{tag:"path",attr:{d:"M176 352c53.02 0 96-42.98 96-96V96c0-53.02-42.98-96-96-96S80 42.98 80 96v160c0 53.02 42.98 96 96 96zm160-160h-16c-8.84 0-16 7.16-16 16v48c0 74.8-64.49 134.82-140.79 127.38C96.71 376.89 48 317.11 48 250.3V208c0-8.84-7.16-16-16-16H16c-8.84 0-16 7.16-16 16v40.16c0 89.64 63.97 169.55 152 181.69V464H96c-8.84 0-16 7.16-16 16v16c0 8.84 7.16 16 16 16h160c8.84 0 16-7.16 16-16v-16c0-8.84-7.16-16-16-16h-56v-33.77C285.71 418.47 352 344.9 352 256v-48c0-8.84-7.16-16-16-16z"}}]})(r)}function F3e(r){return ng({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M416 208H272V64c0-17.67-14.33-32-32-32h-32c-17.67 0-32 14.33-32 32v144H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h144v144c0 17.67 14.33 32 32 32h32c17.67 0 32-14.33 32-32V304h144c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z"}}]})(r)}function j3e(r){return ng({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M96 224c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm448 0c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm32 32h-64c-17.6 0-33.5 7.1-45.1 18.6 40.3 22.1 68.9 62 75.1 109.4h66c17.7 0 32-14.3 32-32v-32c0-35.3-28.7-64-64-64zm-256 0c61.9 0 112-50.1 112-112S381.9 32 320 32 208 82.1 208 144s50.1 112 112 112zm76.8 32h-8.3c-20.8 10-43.9 16-68.5 16s-47.6-6-68.5-16h-8.3C179.6 288 128 339.6 128 403.2V432c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48v-28.8c0-63.6-51.6-115.2-115.2-115.2zm-223.7-13.4C161.5 263.1 145.6 256 128 256H64c-35.3 0-64 28.7-64 64v32c0 17.7 14.3 32 32 32h65.9c6.3-47.4 34.9-87.3 75.2-109.4z"}}]})(r)}function Vie({open:r,onClose:t}){const s=V.useRef(null),a=wk(),{user:l}=V.useContext(Ra),d=v=>{s.current&&!s.current.contains(v.target)&&t()},p=async v=>{const b=E(v);if((b==null?void 0:b.source)==="readyplayerme"&&(b.eventName==="v1.frame.ready"&&s.current.contentWindow.postMessage(JSON.stringify({target:"readyplayerme",type:"subscribe",eventName:"v1.**"}),"*"),b.eventName==="v1.avatar.exported")){const R=b.data.url;if(console.log(`Avatar URL: ${R}`),a("AvatarUrlFromReact",{url:R}),l&&l.uid)try{await rie(l.uid,R),t()}catch(O){console.error("Error updating RPM URL:",O)}else console.error("No authenticated user found to update rpmURL.")}},E=v=>{try{return JSON.parse(v.data)}catch{return null}};return V.useEffect(()=>(r&&(document.addEventListener("mousedown",d),window.addEventListener("message",p)),()=>{document.removeEventListener("mousedown",d),window.removeEventListener("message",p)}),[r]),r&&D.jsx(pu,{children:D.jsx(Gt,{position:"fixed",top:"0",left:"0",width:"100%",height:"100%",bg:"rgba(0, 0, 0, 0.8)",zIndex:1e4,display:"flex",justifyContent:"center",alignItems:"center",onClick:v=>v.stopPropagation(),children:D.jsx(Gt,{position:"relative",maxWidth:"1080px",maxHeight:"800px",width:"90%",height:"90%",children:D.jsx("iframe",{ref:s,src:"https://spacesmetaverse.readyplayer.me/avatar?frameApi",title:"Ready Player Me",width:"100%",height:"100%",style:{border:"none",borderRadius:"8px"},allow:"camera *; microphone *; clipboard-write"})})})})}function B3e({isOpen:r,onClose:t}){const[s,a]=V.useState(!1),[l,d]=V.useState(null),{user:p}=V.useContext(Ra),E=wk(),v=H=>{H.stopPropagation(),a(!0)},b=()=>{a(!1),t()},R=async H=>{if(d(H),p&&p.uid)try{await rie(p.uid,H.url),E("AvatarUrlFromReact",{url:H.url}),t()}catch(z){console.error("Error updating RPM URL:",z)}else console.error("No authenticated user found to update rpmURL.")},O=pRe("gray.200","whiteAlpha.300"),N="rgba(0, 0, 0, 0.3)",F=[{id:1,url:"https://models.readyplayer.me/67c8408d38f7924e15a8bd0a.glb",name:"Default Avatar 1"},{id:2,url:"https://models.readyplayer.me/67c8576838e3cf57cc697c15.glb",name:"Default Avatar 2"},{id:3,url:"https://models.readyplayer.me/67c884144c4878c55e515ff5.glb",name:"Default Avatar 3"},{id:4,url:"https://models.readyplayer.me/67c885af25f4d62e75c0ff1e.glb",name:"Default Avatar 4"},{id:5,url:"https://models.readyplayer.me/67c8860f4c4878c55e5189b6.glb",name:"Default Avatar 5"},{id:6,url:"https://models.readyplayer.me/67c8869db6d0b438b7abd822.glb",name:"Default Avatar 6"},{id:7,url:"https://models.readyplayer.me/67c886ed28ee0e0bfac89688.glb",name:"Default Avatar 7"},{id:8,url:"https://models.readyplayer.me/67c88731795ea3e2e6ea84db.glb",name:"Default Avatar 8"},{id:9,url:"https://models.readyplayer.me/67c8878b0cdc0f22383f0f8f.glb",name:"Default Avatar 9"}];return D.jsxs(D.Fragment,{children:[D.jsx(pu,{children:D.jsxs(xh,{isOpen:r,onClose:t,isCentered:!0,size:"xl",zIndex:9999,children:[D.jsx(Fh,{bg:"rgba(0, 0, 0, 0.7)"}),D.jsxs(Mh,{bg:"gray.800",color:"white",maxW:"900px",children:[D.jsx(cp,{fontSize:"lg",children:"Customise Your Avatar"}),D.jsx(Vh,{color:"white",_hover:{bg:"transparent",color:"whiteAlpha.800"},_focus:{boxShadow:"none"},size:"lg",position:"absolute",right:2,top:2}),D.jsx(Uh,{pb:4,children:D.jsxs(Us,{spacing:4,align:"stretch",children:[D.jsx(gn,{fontSize:"sm",children:"Choose from our collection or create your own unique avatar"}),D.jsxs(jee,{columns:5,spacing:2,children:[D.jsx(Gt,{position:"relative",cursor:"pointer",borderWidth:"2px",borderStyle:"dashed",borderColor:O,borderRadius:"lg",overflow:"hidden",onClick:v,_hover:{bg:N},transition:"all 0.2s",display:"flex",alignItems:"center",justifyContent:"center",aspectRatio:"1",children:D.jsxs(Us,{spacing:1,children:[D.jsx(Xm,{as:F3e,boxSize:4}),D.jsx(gn,{fontSize:"xs",children:"Create Custom Avatar"})]})}),F.map(H=>D.jsxs(Gt,{position:"relative",cursor:"pointer",borderWidth:"2px",borderColor:(l==null?void 0:l.id)===H.id?"blue.400":O,borderRadius:"lg",overflow:"hidden",onClick:()=>R(H),_hover:{bg:N},transition:"all 0.2s",aspectRatio:"1",children:[D.jsx(EF,{src:H.url.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"),alt:H.name,width:"100%",height:"100%",objectFit:"cover"}),D.jsx(Gt,{position:"absolute",bottom:"0",left:"0",right:"0",p:1,bg:"rgba(0, 0, 0, 0.7)",children:D.jsx(gn,{fontSize:"xs",children:H.name})})]},H.id))]})]})})]})]})}),s&&D.jsx(Vie,{open:s,onClose:b})]})}function W3e(){const{fullscreenRef:r}=up(),[t,s]=V.useState(!1),[a,l]=V.useState(!1),[d,p]=V.useState(!1),[E,v]=V.useState(!1),{user:b}=V.useContext(Ra),[R,O]=V.useState(null),[N,F]=V.useState(!0),H=(J,re)=>!J||!re?"?":`${J.charAt(0)}${re.charAt(0)}`.toUpperCase(),z=async()=>{if(b!=null&&b.uid){F(!0);try{const J=await $m(b.uid);O({rpmURL:J.rpmURL?J.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null,firstName:J.firstName,lastName:J.lastName})}catch(J){console.error("Error fetching profile data:",J)}finally{F(!1)}}};V.useEffect(()=>{z()},[b==null?void 0:b.uid]),V.useEffect(()=>{const J=()=>{s(!0)};return window.addEventListener("PlayerInstantiated",J),()=>{window.removeEventListener("PlayerInstantiated",J)}},[]);const G=()=>l(!a),ee=()=>{l(!1),z()};return t?D.jsxs(D.Fragment,{children:[D.jsx(SR,{label:"Edit Avatar",hasArrow:!0,placement:"top",closeOnClick:!0,isOpen:E,portalProps:{containerRef:r},children:D.jsxs(Gt,{position:"relative",onMouseEnter:()=>{p(!0),v(!0)},onMouseLeave:()=>{p(!1),v(!1)},cursor:"pointer",onClick:G,children:[D.jsx(Oh,{src:N||R==null?void 0:R.rpmURL,size:"md",borderRadius:"full",bg:"white",name:N?H(R==null?void 0:R.firstName,R==null?void 0:R.lastName):" ",borderWidth:"1px",borderColor:"whiteAlpha.300"}),d&&D.jsx(Gt,{position:"absolute",top:"0",left:"0",right:"0",bottom:"0",display:"flex",alignItems:"center",justifyContent:"center",bg:"rgba(0, 0, 0, 0.4)",borderRadius:"full",children:D.jsx(gn,{fontSize:"xs",fontWeight:"bold",color:"white",children:"Edit"})})]})}),D.jsx(B3e,{isOpen:a,onClose:ee})]}):null}function G3e(r){return ng({attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M391 240.9c-.8-6.6-8.9-9.4-13.6-4.7l-43.7 43.7L200 146.3a8.03 8.03 0 0 0-11.3 0l-42.4 42.3a8.03 8.03 0 0 0 0 11.3L280 333.6l-43.9 43.9a8.01 8.01 0 0 0 4.7 13.6L401 410c5.1.6 9.5-3.7 8.9-8.9L391 240.9zm10.1 373.2L240.8 633c-6.6.8-9.4 8.9-4.7 13.6l43.9 43.9L146.3 824a8.03 8.03 0 0 0 0 11.3l42.4 42.3c3.1 3.1 8.2 3.1 11.3 0L333.7 744l43.7 43.7A8.01 8.01 0 0 0 391 783l18.9-160.1c.6-5.1-3.7-9.4-8.8-8.8zm221.8-204.2L783.2 391c6.6-.8 9.4-8.9 4.7-13.6L744 333.6 877.7 200c3.1-3.1 3.1-8.2 0-11.3l-42.4-42.3a8.03 8.03 0 0 0-11.3 0L690.3 279.9l-43.7-43.7a8.01 8.01 0 0 0-13.6 4.7L614.1 401c-.6 5.2 3.7 9.5 8.8 8.9zM744 690.4l43.9-43.9a8.01 8.01 0 0 0-4.7-13.6L623 614c-5.1-.6-9.5 3.7-8.9 8.9L633 783.1c.8 6.6 8.9 9.4 13.6 4.7l43.7-43.7L824 877.7c3.1 3.1 8.2 3.1 11.3 0l42.4-42.3c3.1-3.1 3.1-8.2 0-11.3L744 690.4z"}}]})(r)}function z3e(r){return ng({attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M290 236.4l43.9-43.9a8.01 8.01 0 0 0-4.7-13.6L169 160c-5.1-.6-9.5 3.7-8.9 8.9L179 329.1c.8 6.6 8.9 9.4 13.6 4.7l43.7-43.7L370 423.7c3.1 3.1 8.2 3.1 11.3 0l42.4-42.3c3.1-3.1 3.1-8.2 0-11.3L290 236.4zm352.7 187.3c3.1 3.1 8.2 3.1 11.3 0l133.7-133.6 43.7 43.7a8.01 8.01 0 0 0 13.6-4.7L863.9 169c.6-5.1-3.7-9.5-8.9-8.9L694.8 179c-6.6.8-9.4 8.9-4.7 13.6l43.9 43.9L600.3 370a8.03 8.03 0 0 0 0 11.3l42.4 42.4zM845 694.9c-.8-6.6-8.9-9.4-13.6-4.7l-43.7 43.7L654 600.3a8.03 8.03 0 0 0-11.3 0l-42.4 42.3a8.03 8.03 0 0 0 0 11.3L734 787.6l-43.9 43.9a8.01 8.01 0 0 0 4.7 13.6L855 864c5.1.6 9.5-3.7 8.9-8.9L845 694.9zm-463.7-94.6a8.03 8.03 0 0 0-11.3 0L236.3 733.9l-43.7-43.7a8.01 8.01 0 0 0-13.6 4.7L160.1 855c-.6 5.1 3.7 9.5 8.9 8.9L329.2 845c6.6-.8 9.4-8.9 4.7-13.6L290 787.6 423.7 654c3.1-3.1 3.1-8.2 0-11.3l-42.4-42.4z"}}]})(r)}function H3e(){const{isFullscreen:r,toggleFullscreen:t,fullscreenRef:s,isMobile:a}=up(),l=QS();V.useEffect(()=>{const p=E=>{console.error("Fullscreen error:",E),l({title:"Fullscreen Error",description:"Could not enter fullscreen mode. Try tapping the button again or use the browser's fullscreen option.",status:"error",duration:5e3,isClosable:!0,position:"top"})};return document.addEventListener("fullscreenerror",p),document.addEventListener("webkitfullscreenerror",p),document.addEventListener("mozfullscreenerror",p),document.addEventListener("MSFullscreenError",p),()=>{document.removeEventListener("fullscreenerror",p),document.removeEventListener("webkitfullscreenerror",p),document.removeEventListener("mozfullscreenerror",p),document.removeEventListener("MSFullscreenError",p)}},[l]);const d=()=>{s.current?(a&&/iPhone|iPad|iPod/i.test(navigator.userAgent)&&!r&&l({title:"Mobile Fullscreen",description:"Tap the button again if fullscreen doesn't activate. For iOS, you may need to use the browser's share button and 'Add to Home Screen' for the best experience.",status:"info",duration:5e3,isClosable:!0,position:"top"}),t()):(console.error("Fullscreen target not set"),l({title:"Fullscreen Error",description:"Could not find fullscreen target element.",status:"error",duration:3e3,isClosable:!0,position:"top"}))};return D.jsx(SR,{label:r?"Exit Fullscreen":"Enter Fullscreen",hasArrow:!0,placement:"bottom",closeOnClick:!0,portalProps:{containerRef:s},children:D.jsx(dl,{"aria-label":r?"Exit Fullscreen":"Enter Fullscreen",icon:r?D.jsx(G3e,{}):D.jsx(z3e,{}),onClick:d,variant:"iconButton",size:a?"lg":"md"})})}const K3e=()=>(N3e(),null),MX={iframeContainer:{position:"relative",paddingBottom:"56.25%",height:0,overflow:"hidden",width:"100%"},iframe:{position:"absolute",top:0,left:0,width:"100%",height:"100%",border:"none"}};function q3e(){const{isOpen:r,onOpen:t,onClose:s}=WS(),{fullscreenRef:a}=up(),[l,d]=O3e(!1);V.useEffect(()=>{Rt.log("VideoPlayer: Current video URL:",l),l&&(Rt.log("VideoPlayer: Opening modal for video URL:",l),t())},[l,t]);const p=()=>{Rt.log("VideoPlayer: Closing modal"),d(),s()};return D.jsx(pu,{containerRef:a,children:D.jsxs(xh,{isOpen:r,onClose:p,size:"lg",isCentered:!0,portalProps:{containerRef:a},children:[D.jsx(Fh,{bg:"rgba(0, 0, 0, 0.8)"}),D.jsxs(Mh,{bg:"gray.900",color:"white",borderRadius:"lg",overflow:"hidden",maxWidth:"80vw",maxHeight:"80vh",display:"flex",justifyContent:"center",alignItems:"center",position:"relative",zIndex:"modal",children:[D.jsx(Vh,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",zIndex:"modal",_hover:{bg:"gray.600"},_focus:{boxShadow:"none"},position:"absolute",top:"10px",right:"10px"}),D.jsx(Uh,{p:0,width:"100%",children:l&&D.jsx(Gt,{style:MX.iframeContainer,children:D.jsx("iframe",{src:l,style:MX.iframe,allow:"autoplay; fullscreen",allowFullScreen:!0,title:"Video Player"})})})]})]})})}function $3e({isOpen:r,onClose:t,playerName:s,playerId:a,uid:l}){const[d,p]=V.useState(null),[E,v]=V.useState(!0),[b,R]=V.useState(null);return V.useEffect(()=>{r&&(async()=>{if(v(!0),R(null),!l){Rt.warn("NameplateModal: No UID provided for player:",s),R("No user ID available for this player"),v(!1);return}try{Rt.log("NameplateModal: Fetching profile for UID:",l);const N=await $m(l);N?p({firstName:N.firstName,lastName:N.lastName,linkedinUrl:N.linkedinUrl,websiteUrl:N.websiteUrl,rpmURL:N.rpmURL?N.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null}):R("Could not find profile data for this player")}catch(N){Rt.error("Error fetching profile data:",N),R("Error loading profile data")}finally{v(!1)}})()},[l,r,s]),D.jsxs(xh,{isOpen:r,onClose:t,isCentered:!0,size:"md",children:[D.jsx(Fh,{backdropFilter:"blur(10px)"}),D.jsxs(Mh,{bg:"gray.900",color:"white",borderRadius:"xl",children:[D.jsx(cp,{children:"Player Info"}),D.jsx(Vh,{}),D.jsx(Uh,{pb:6,children:E?D.jsx(nee,{py:8,children:D.jsx($S,{size:"xl",color:"blue.400"})}):b?D.jsxs(UN,{status:"warning",variant:"solid",borderRadius:"md",children:[D.jsx(VN,{}),b]}):D.jsxs(Us,{spacing:4,align:"center",children:[D.jsx(Oh,{size:"2xl",src:d==null?void 0:d.rpmURL,bg:"whiteAlpha.300",name:s,borderWidth:"2px",borderColor:"whiteAlpha.300"}),D.jsxs(Us,{spacing:1,children:[D.jsx(gn,{fontSize:"2xl",fontWeight:"bold",children:s}),(d==null?void 0:d.firstName)&&D.jsxs(gn,{fontSize:"md",color:"gray.400",children:[d.firstName," ",d.lastName]}),D.jsxs(gn,{fontSize:"xs",color:"gray.500",mt:1,children:["ID: ",a]})]}),((d==null?void 0:d.linkedinUrl)||(d==null?void 0:d.websiteUrl))&&D.jsxs(D.Fragment,{children:[D.jsx(Fw,{borderColor:"whiteAlpha.300"}),D.jsxs(NS,{spacing:4,pt:2,children:[(d==null?void 0:d.linkedinUrl)&&D.jsx(Ph,{href:d.linkedinUrl,isExternal:!0,children:D.jsx(dl,{icon:D.jsx(Mie,{}),variant:"ghost",colorScheme:"linkedin",size:"lg","aria-label":"LinkedIn profile",_hover:{bg:"whiteAlpha.200"}})}),(d==null?void 0:d.websiteUrl)&&D.jsx(Ph,{href:d.websiteUrl,isExternal:!0,children:D.jsx(dl,{icon:D.jsx(Uie,{}),variant:"ghost",colorScheme:"blue",size:"lg","aria-label":"Personal website",_hover:{bg:"whiteAlpha.200"}})})]})]})]})})]})]})}const Y3e=({isVisible:r,onToggleVisibility:t})=>{const s=Die(),[a,l]=V.useState(!1),[d,p]=V.useState([]),[E,v]=V.useState(!1),[b,R]=V.useState({}),[O,N]=V.useState({}),F=window.currentUser||{};V.useEffect(()=>{const re={};s.forEach(de=>{if(de.uid){if(de.isLocalPlayer&&window.agoraClient&&window.agoraClient.client)re[de.uid]=window.agoraClient.client.uid;else if(window.agoraClient&&window.agoraClient.client&&window.agoraClient.client.remoteUsers){const se=window.agoraClient.client.remoteUsers,ye=se.find(Q=>String(Q.uid)===String(de.uid));if(ye)re[de.uid]=ye.uid;else{const Q=se.find(ne=>typeof ne.uid=="string"&&ne.uid.includes(de.uid));if(Q)re[de.uid]=Q.uid;else{const ne=se.find(oe=>typeof de.uid=="string"&&de.uid.includes(String(oe.uid)));if(ne)re[de.uid]=ne.uid;else{const oe=se.filter(ue=>!(typeof ue.uid=="string"&&ue.uid.startsWith("screen-")));oe.length===1&&!de.isLocalPlayer&&(console.log(`Special case: Mapping player ${de.playerName} (${de.uid}) to the only remote user: ${oe[0].uid}`),re[de.uid]=oe[0].uid)}}}}}}),N(re)},[s]);const H=()=>{if(window.agoraClient&&typeof window.agoraClient.isVoiceEnabled=="boolean"){const re=window.agoraClient.isVoiceEnabled;re!==E&&(console.log("UnityPlayerList: Updating mic state from window.agoraClient:",re),v(re))}if(window.agoraClient&&window.agoraClient.client&&window.agoraClient.client.remoteUsers){const re=window.agoraClient.client.remoteUsers,de={};re.forEach(se=>{typeof se.uid=="string"&&se.uid.startsWith("screen-")||(de[se.uid]=!!se.audioTrack&&!se.audioTrack.muted)}),JSON.stringify(de)!==JSON.stringify(b)&&(console.log("UnityPlayerList: Updating active mics:",de),R(de))}};V.useEffect(()=>{const re=setInterval(H,500),de=se=>{console.log("UnityPlayerList: Voice toggle event received:",se.detail),se.detail&&typeof se.detail.enabled=="boolean"&&v(se.detail.enabled)};return window.addEventListener("VoiceToggled",de),H(),()=>{clearInterval(re),window.removeEventListener("VoiceToggled",de)}},[]),V.useEffect(()=>{const re=()=>{Rt.log("UnityPlayerList: Player instantiated, showing list"),l(!0)};return window.addEventListener("PlayerInstantiated",re),window.isPlayerInstantiated&&(Rt.log("UnityPlayerList: Player was already instantiated"),l(!0)),()=>{window.removeEventListener("PlayerInstantiated",re)}},[]),V.useEffect(()=>{(async()=>{const de=await Promise.all(s.map(async se=>{if(se.uid)try{const ye=await $m(se.uid);return{...se,firstName:ye.firstName,lastName:ye.lastName,linkedInProfile:ye.linkedInProfile,websiteUrl:ye.websiteUrl,rpmURL:ye.rpmURL?ye.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null}}catch(ye){return Rt.error(`Error fetching data for player ${se.playerName}:`,ye),se}return se}));p(de)})()},[s]);const z=[...d].sort((re,de)=>re.isLocalPlayer?-1:de.isLocalPlayer?1:0),G=()=>{Rt.log("UnityPlayerList: Toggling visibility"),t&&t()},ee=re=>!!(re.isLocalPlayer||F&&F.uid&&re.uid===F.uid),J=re=>{try{if(ee(re))return window.agoraClient&&typeof window.agoraClient.isVoiceEnabled=="boolean"?window.agoraClient.isVoiceEnabled:E;if(re.uid){if(b[re.uid])return!0;const de=O[re.uid];if(de&&b[de])return!0;const se=parseInt(re.uid);if(!isNaN(se)&&b[se])return!0}return!1}catch(de){return console.error("Error in hasActiveMic:",de),!1}};return D.jsxs(Gt,{position:"absolute",top:"100px",right:"20px",zIndex:"1",bg:"rgba(0,0,0,0.4)",p:4,borderRadius:"md",color:"white",minWidth:"200px",maxHeight:"300px",visibility:a&&r?"visible":"hidden",role:"group",children:[D.jsx(Gt,{position:"absolute",top:2,right:2,opacity:0,_groupHover:{opacity:1},transition:"opacity 0.2s",children:D.jsx(dl,{icon:D.jsx(BBe,{boxSize:3}),size:"xs","aria-label":"Close list",variant:"unstyled",color:"white",onClick:G,_hover:{opacity:.8}})}),D.jsxs(gn,{fontWeight:"bold",mb:2,fontSize:"sm",children:["People Online: ",s.length]}),D.jsx(Gt,{maxHeight:"200px",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"4px"},"&::-webkit-scrollbar-track":{background:"rgba(0,0,0,0.1)"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"2px"}},children:D.jsx(Us,{align:"stretch",spacing:1,width:"100%",children:z.map((re,de)=>{const se=ee(re),ye=J(re);return D.jsx(Gt,{children:D.jsxs(fte,{placement:"left",trigger:"hover",children:[D.jsx(Ete,{children:D.jsxs(NS,{width:"100%",spacing:2,p:1,borderRadius:"md",_hover:{bg:"whiteAlpha.200"},transition:"background 0.2s",children:[D.jsx(Oh,{size:"xs",src:re.rpmURL,bg:"whiteAlpha.400",name:" ",borderWidth:"1px",borderColor:"whiteAlpha.300"}),D.jsx(gn,{fontSize:"xs",children:re.playerName}),D.jsx(Tte,{}),ye?D.jsx(Gt,{color:"green.400",children:D.jsx(QU,{})}):D.jsx(Gt,{color:"red.400",children:D.jsx(JU,{})}),se&&D.jsx(gn,{fontSize:"xs",color:"gray.300",ml:1,children:"(you)"})]})}),D.jsx(_te,{bg:"rgba(0,0,0,0.4)",border:"none",boxShadow:"lg",color:"white",p:3,width:"auto",minWidth:"200px",ml:"-20px",position:"absolute",left:"-220px",top:"-100px",transform:"none !important",children:D.jsx(mte,{children:D.jsxs(Us,{align:"center",spacing:2,children:[D.jsx(Oh,{size:"lg",src:re.rpmURL,bg:"whiteAlpha.400",name:" ",borderWidth:"2px",borderColor:"whiteAlpha.300"}),D.jsx(gn,{fontSize:"lg",fontWeight:"bold",children:re.playerName}),re.firstName&&D.jsxs(gn,{fontSize:"sm",color:"gray.300",children:[re.firstName," ",re.lastName]}),D.jsxs(NS,{spacing:4,pt:2,children:[re.linkedInProfile&&D.jsx(Ph,{href:re.linkedInProfile,isExternal:!0,children:D.jsx(dl,{icon:D.jsx(Mie,{}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"LinkedIn profile",_hover:{bg:"whiteAlpha.200"}})}),re.websiteUrl&&D.jsx(Ph,{href:re.websiteUrl,isExternal:!0,children:D.jsx(dl,{icon:D.jsx(Uie,{}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"Personal website",_hover:{bg:"whiteAlpha.200"}})}),D.jsx(dl,{icon:ye?D.jsx(QU,{}):D.jsx(JU,{}),variant:"ghost",colorScheme:ye?"green":"red",size:"sm","aria-label":"Microphone status",isDisabled:!0})]})]})})})]})},de)})})})]})};var DP={exports:{}},X3e=DP.exports,UX;function J3e(){return UX||(UX=1,function(r,t){(function(s,a){r.exports=a()})(X3e,function(){function s(e,n){return n.forEach(function(i){i&&typeof i!="string"&&!Array.isArray(i)&&Object.keys(i).forEach(function(o){if(o!=="default"&&!(o in e)){var c=Object.getOwnPropertyDescriptor(i,o);Object.defineProperty(e,o,c.get?c:{enumerable:!0,get:function(){return i[o]}})}})}),Object.freeze(e)}var a=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof D_<"u"?D_:typeof self<"u"?self:{};function l(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var d=function(e){try{return!!e()}catch{return!0}},p=!d(function(){var e=(function(){}).bind();return typeof e!="function"||e.hasOwnProperty("prototype")}),E=p,v=Function.prototype,b=v.call,R=E&&v.bind.bind(b,b),O=E?R:function(e){return function(){return b.apply(e,arguments)}},N=O({}.isPrototypeOf),F=function(e){return e&&e.Math==Math&&e},H=F(typeof globalThis=="object"&&globalThis)||F(typeof window=="object"&&window)||F(typeof self=="object"&&self)||F(typeof a=="object"&&a)||function(){return this}()||a||Function("return this")(),z=p,G=Function.prototype,ee=G.apply,J=G.call,re=typeof Reflect=="object"&&Reflect.apply||(z?J.bind(ee):function(){return J.apply(ee,arguments)}),de=O,se=de({}.toString),ye=de("".slice),Q=function(e){return ye(se(e),8,-1)},ne=Q,oe=O,ue=function(e){if(ne(e)==="Function")return oe(e)},Ee=typeof document=="object"&&document.all,fe={all:Ee,IS_HTMLDDA:Ee===void 0&&Ee!==void 0},le=fe.all,Le=fe.IS_HTMLDDA?function(e){return typeof e=="function"||e===le}:function(e){return typeof e=="function"},pt={},et=!d(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),Oe=p,Ue=Function.prototype.call,Me=Oe?Ue.bind(Ue):function(){return Ue.apply(Ue,arguments)},it={},Ae={}.propertyIsEnumerable,qe=Object.getOwnPropertyDescriptor,Ze=qe&&!Ae.call({1:2},1);it.f=Ze?function(e){var n=qe(this,e);return!!n&&n.enumerable}:Ae;var Fe,lt,Et=function(e,n){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:n}},Nt=d,$t=Q,xt=Object,En=O("".split),In=Nt(function(){return!xt("z").propertyIsEnumerable(0)})?function(e){return $t(e)=="String"?En(e,""):xt(e)}:xt,hn=function(e){return e==null},Kn=hn,Ar=TypeError,Zt=function(e){if(Kn(e))throw Ar("Can't call method on "+e);return e},Zn=In,zt=Zt,ve=function(e){return Zn(zt(e))},Ne=Le,We=fe.all,dt=fe.IS_HTMLDDA?function(e){return typeof e=="object"?e!==null:Ne(e)||e===We}:function(e){return typeof e=="object"?e!==null:Ne(e)},mt={},gt=mt,Vt=H,_n=Le,kn=function(e){return _n(e)?e:void 0},rn=function(e,n){return arguments.length<2?kn(gt[e])||kn(Vt[e]):gt[e]&&gt[e][n]||Vt[e]&&Vt[e][n]},ur=typeof navigator<"u"&&String(navigator.userAgent)||"",$a=H,kt=ur,tn=$a.process,Hi=$a.Deno,Cs=tn&&tn.versions||Hi&&Hi.version,Vs=Cs&&Cs.v8;Vs&&(lt=(Fe=Vs.split("."))[0]>0&&Fe[0]<4?1:+(Fe[0]+Fe[1])),!lt&&kt&&(!(Fe=kt.match(/Edge\/(\d+)/))||Fe[1]>=74)&&(Fe=kt.match(/Chrome\/(\d+)/))&&(lt=+Fe[1]);var li=lt,Ca=li,Bc=d,Zs=H.String,eo=!!Object.getOwnPropertySymbols&&!Bc(function(){var e=Symbol();return!Zs(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&Ca&&Ca<41}),yl=eo&&!Symbol.sham&&typeof Symbol.iterator=="symbol",Is=rn,Ya=Le,Yo=N,Xa=Object,Wc=yl?function(e){return typeof e=="symbol"}:function(e){var n=Is("Symbol");return Ya(n)&&Yo(n.prototype,Xa(e))},mu=String,Ja=function(e){try{return mu(e)}catch{return"Object"}},Gc=Le,Eo=Ja,Ri=TypeError,es=function(e){if(Gc(e))return e;throw Ri(Eo(e)+" is not a function")},Ia=es,gu=hn,Qa=function(e,n){var i=e[n];return gu(i)?void 0:Ia(i)},Xo=Me,Jo=Le,hd=dt,rg=TypeError,_u={exports:{}},Bh=H,As=Object.defineProperty,Eu=function(e,n){try{As(Bh,e,{value:n,configurable:!0,writable:!0})}catch{Bh[e]=n}return n},Qo="__core-js_shared__",fd=H[Qo]||Eu(Qo,{}),pd=fd;(_u.exports=function(e,n){return pd[e]||(pd[e]=n!==void 0?n:{})})("versions",[]).push({version:"3.31.1",mode:"pure",copyright:" 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.31.1/LICENSE",source:"https://github.com/zloirock/core-js"});var Aa=_u.exports,md=Zt,yu=Object,yo=function(e){return yu(md(e))},gd=yo,Mr=O({}.hasOwnProperty),ui=Object.hasOwn||function(e,n){return Mr(gd(e),n)},Za=O,zc=0,Zo=Math.random(),Wh=Za(1 .toString),_d=function(e){return"Symbol("+(e===void 0?"":e)+")_"+Wh(++zc+Zo,36)},vl=Aa,to=ui,dp=_d,Fs=eo,Gh=yl,Hc=H.Symbol,Ed=vl("wks"),yd=Gh?Hc.for||Hc:Hc&&Hc.withoutSetter||dp,ar=function(e){return to(Ed,e)||(Ed[e]=Fs&&to(Hc,e)?Hc[e]:yd("Symbol."+e)),Ed[e]},Sl=Me,Tl=dt,vu=Wc,Oa=Qa,vo=function(e,n){var i,o;if(Jo(i=e.toString)&&!hd(o=Xo(i,e))||Jo(i=e.valueOf)&&!hd(o=Xo(i,e)))return o;throw rg("Can't convert object to primitive value")},Su=TypeError,Kc=ar("toPrimitive"),bl=function(e,n){if(!Tl(e)||vu(e))return e;var i,o=Oa(e,Kc);if(o){if(i=Sl(o,e,n),!Tl(i)||vu(i))return i;throw Su("Can't convert object to primitive value")}return vo(e)},jr=Wc,Pa=function(e){var n=bl(e,"string");return jr(n)?n:n+""},er=dt,ec=H.document,hp=er(ec)&&er(ec.createElement),wl=function(e){return hp?ec.createElement(e):{}},vd=wl,zh=!et&&!d(function(){return Object.defineProperty(vd("div"),"a",{get:function(){return 7}}).a!=7}),fp=et,Hh=Me,So=it,Ki=Et,To=ve,bo=Pa,Rl=ui,wo=zh,Ro=Object.getOwnPropertyDescriptor;pt.f=fp?Ro:function(e,n){if(e=To(e),n=bo(n),wo)try{return Ro(e,n)}catch{}if(Rl(e,n))return Ki(!Hh(So.f,e,n),e[n])};var pp=d,tc=Le,ts=/#|\.prototype\./,Tu=function(e,n){var i=qc[Kh(e)];return i==mp||i!=Cl&&(tc(n)?pp(n):!!n)},Kh=Tu.normalize=function(e){return String(e).replace(ts,".").toLowerCase()},qc=Tu.data={},Cl=Tu.NATIVE="N",mp=Tu.POLYFILL="P",ea=Tu,ta=es,$c=p,_e=ue(ue.bind),Re=function(e,n){return ta(e),n===void 0?e:$c?_e(e,n):function(){return e.apply(n,arguments)}},Ke={},Bt=et&&d(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),Wn=dt,fr=String,Ur=TypeError,nn=function(e){if(Wn(e))return e;throw Ur(fr(e)+" is not an object")},Or=et,di=zh,_s=Bt,Co=nn,Io=Pa,bu=TypeError,Ui=Object.defineProperty,Yc=Object.getOwnPropertyDescriptor,Sd="enumerable",nc="configurable",ig="writable";Ke.f=Or?_s?function(e,n,i){if(Co(e),n=Io(n),Co(i),typeof e=="function"&&n==="prototype"&&"value"in i&&ig in i&&!i[ig]){var o=Yc(e,n);o&&o[ig]&&(e[n]=i.value,i={configurable:nc in i?i[nc]:o[nc],enumerable:Sd in i?i[Sd]:o[Sd],writable:!1})}return Ui(e,n,i)}:Ui:function(e,n,i){if(Co(e),n=Io(n),Co(i),di)try{return Ui(e,n,i)}catch{}if("get"in i||"set"in i)throw bu("Accessors not supported");return"value"in i&&(e[n]=i.value),e};var gp=Ke,wu=Et,Ao=et?function(e,n,i){return gp.f(e,n,wu(1,i))}:function(e,n,i){return e[n]=i,e},Il=H,_p=re,sg=ue,pE=Le,Ep=pt.f,yp=ea,Ru=mt,Cu=Re,Iu=Ao,og=ui,mE=function(e){var n=function(i,o,c){if(this instanceof n){switch(arguments.length){case 0:return new e;case 1:return new e(i);case 2:return new e(i,o)}return new e(i,o,c)}return _p(e,this,arguments)};return n.prototype=e.prototype,n},Dn=function(e,n){var i,o,c,u,h,m,_,y,S,w=e.target,I=e.global,P=e.stat,B=e.proto,M=I?Il:P?Il[w]:(Il[w]||{}).prototype,U=I?Ru:Ru[w]||Iu(Ru,w,{})[w],q=U.prototype;for(u in n)o=!(i=yp(I?u:w+(P?".":"#")+u,e.forced))&&M&&og(M,u),m=U[u],o&&(_=e.dontCallGetSet?(S=Ep(M,u))&&S.value:M[u]),h=o&&_?_:n[u],o&&typeof m==typeof h||(y=e.bind&&o?Cu(h,Il):e.wrap&&o?mE(h):B&&pE(h)?sg(h):h,(e.sham||h&&h.sham||m&&m.sham)&&Iu(y,"sham",!0),Iu(U,u,y),B&&(og(Ru,c=w+"Prototype")||Iu(Ru,c,{}),Iu(Ru[c],u,h),e.real&&q&&(i||!q[u])&&Iu(q,u,h)))},vp=Math.ceil,Oo=Math.floor,gE=Math.trunc||function(e){var n=+e;return(n>0?Oo:vp)(n)},_E=gE,rc=function(e){var n=+e;return n!=n||n===0?0:_E(n)},C=rc,j=Math.max,X=Math.min,he=function(e,n){var i=C(e);return i<0?j(i+n,0):X(i,n)},je=rc,Je=Math.min,It=function(e){return e>0?Je(je(e),9007199254740991):0},Br=It,ti=function(e){return Br(e.length)},pr=ve,Os=he,ns=ti,Na=function(e){return function(n,i,o){var c,u=pr(n),h=ns(u),m=Os(o,h);if(e&&i!=i){for(;h>m;)if((c=u[m++])!=c)return!0}else for(;h>m;m++)if((e||m in u)&&u[m]===i)return e||m||0;return!e&&-1}},Po={includes:Na(!0),indexOf:Na(!1)},qh=Po.includes;Dn({target:"Array",proto:!0,forced:d(function(){return!Array(1).includes()})},{includes:function(e){return qh(this,e,arguments.length>1?arguments[1]:void 0)}});var Sp=mt,ka=function(e){return Sp[e+"Prototype"]},xR=ka("Array").includes,MR=dt,Tp=Q,Ck=ar("match"),UR=function(e){var n;return MR(e)&&((n=e[Ck])!==void 0?!!n:Tp(e)=="RegExp")},Ik=UR,VR=TypeError,sT={};sT[ar("toStringTag")]="z";var $h=String(sT)==="[object z]",ag=$h,Ak=Le,Yh=Q,Ok=ar("toStringTag"),FR=Object,oT=Yh(function(){return arguments}())=="Arguments",ic=ag?Yh:function(e){var n,i,o;return e===void 0?"Undefined":e===null?"Null":typeof(i=function(c,u){try{return c[u]}catch{}}(n=FR(e),Ok))=="string"?i:oT?Yh(n):(o=Yh(n))=="Object"&&Ak(n.callee)?"Arguments":o},jR=ic,BR=String,na=function(e){if(jR(e)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return BR(e)},Pk=ar("match"),Nk=Dn,kk=function(e){if(Ik(e))throw VR("The method doesn't accept regular expressions");return e},Dk=Zt,WR=na,Xc=function(e){var n=/./;try{"/./"[e](n)}catch{try{return n[Pk]=!1,"/./"[e](n)}catch{}}return!1},cg=O("".indexOf);Nk({target:"String",proto:!0,forced:!Xc("includes")},{includes:function(e){return!!~cg(WR(Dk(this)),WR(kk(e)),arguments.length>1?arguments[1]:void 0)}});var GR=ka("String").includes,aT=N,zR=xR,HR=GR,lg=Array.prototype,cT=String.prototype,Lk=function(e){var n=e.includes;return e===lg||aT(lg,e)&&n===lg.includes?zR:typeof e=="string"||e===cT||aT(cT,e)&&n===cT.includes?HR:n},Xe=l(Lk),lT=es,ug=yo,uT=In,KR=ti,EE=TypeError,bp=function(e){return function(n,i,o,c){lT(i);var u=ug(n),h=uT(u),m=KR(u),_=e?m-1:0,y=e?-1:1;if(o<2)for(;;){if(_ in h){c=h[_],_+=y;break}if(_+=y,e?_<0:m<=_)throw EE("Reduce of empty array with no initial value")}for(;e?_>=0:m>_;_+=y)_ in h&&(c=i(c,h[_],_,u));return c}},dT={left:bp(!1)},qR=d,Xh=function(e,n){var i=[][e];return!!i&&qR(function(){i.call(null,n||function(){return 1},1)})},Jh=typeof process<"u"&&Q(process)=="process",$R=dT.left;Dn({target:"Array",proto:!0,forced:!Jh&&li>79&&li<83||!Xh("reduce")},{reduce:function(e){var n=arguments.length;return $R(this,e,n,n>1?arguments[1]:void 0)}});var YR=ka("Array").reduce,XR=N,JR=YR,yE=Array.prototype,Td=function(e){var n=e.reduce;return e===yE||XR(yE,e)&&n===yE.reduce?JR:n},vE=Td,Da=l(vE),xk=Q,dg=Array.isArray||function(e){return xk(e)=="Array"},hg=Dn,Mk=dg,QR=O([].reverse),hT=[1,2];hg({target:"Array",proto:!0,forced:String(hT)===String(hT.reverse())},{reverse:function(){return Mk(this)&&(this.length=this.length),QR(this)}});var _i=ka("Array").reverse,fT=N,SE=_i,Qh=Array.prototype,ZR=function(e){var n=e.reverse;return e===Qh||fT(Qh,e)&&n===Qh.reverse?SE:n},TE=ZR,wp=l(TE),bE=_d,Zh=Aa("keys"),fg=function(e){return Zh[e]||(Zh[e]=bE(e))},Uk=!d(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),Vk=ui,eC=Le,wE=yo,RE=Uk,CE=fg("IE_PROTO"),pg=Object,pT=pg.prototype,mg=RE?pg.getPrototypeOf:function(e){var n=wE(e);if(Vk(n,CE))return n[CE];var i=n.constructor;return eC(i)&&n instanceof i?i.prototype:n instanceof pg?pT:null},Fk=O,tC=es,jk=Le,Bk=String,mT=TypeError,bd=function(e,n,i){try{return Fk(tC(Object.getOwnPropertyDescriptor(e,n)[i]))}catch{}},nC=nn,Rp=function(e){if(typeof e=="object"||jk(e))return e;throw mT("Can't set "+Bk(e)+" as a prototype")},Al=Object.setPrototypeOf||("__proto__"in{}?function(){var e,n=!1,i={};try{(e=bd(Object.prototype,"__proto__","set"))(i,[]),n=i instanceof Array}catch{}return function(o,c){return nC(o),Rp(c),n?e(o,c):o.__proto__=c,o}}():void 0),wd={},sc={},gg=ui,Wk=ve,Gk=Po.indexOf,ef=sc,Cp=O([].push),tf=function(e,n){var i,o=Wk(e),c=0,u=[];for(i in o)!gg(ef,i)&&gg(o,i)&&Cp(u,i);for(;n.length>c;)gg(o,i=n[c++])&&(~Gk(u,i)||Cp(u,i));return u},Ip=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],gT=tf,Ap=Ip.concat("length","prototype");wd.f=Object.getOwnPropertyNames||function(e){return gT(e,Ap)};var oc={};oc.f=Object.getOwnPropertySymbols;var Ei=rn,hi=wd,Rd=oc,no=nn,ra=O([].concat),nf=Ei("Reflect","ownKeys")||function(e){var n=hi.f(no(e)),i=Rd.f;return i?ra(n,i(e)):n},rf=ui,ia=nf,IE=pt,rC=Ke,AE={},OE=tf,iC=Ip,ac=Object.keys||function(e){return OE(e,iC)},PE=et,_T=Bt,sC=Ke,zk=nn,Cd=ve,Op=ac;AE.f=PE&&!_T?Object.defineProperties:function(e,n){zk(e);for(var i,o=Cd(n),c=Op(n),u=c.length,h=0;u>h;)sC.f(e,i=c[h++],o[i]);return e};var Au,_g=rn("document","documentElement"),NE=nn,cc=AE,La=Ip,sf=sc,Ou=_g,Pu=wl,Nu="prototype",kE="script",DE=fg("IE_PROTO"),Eg=function(){},sa=function(e){return"<"+kE+">"+e+"</"+kE+">"},oa=function(e){e.write(sa("")),e.close();var n=e.parentWindow.Object;return e=null,n},ni=function(){try{Au=new ActiveXObject("htmlfile")}catch{}var e,n,i;ni=typeof document<"u"?document.domain&&Au?oa(Au):(n=Pu("iframe"),i="java"+kE+":",n.style.display="none",Ou.appendChild(n),n.src=String(i),(e=n.contentWindow.document).open(),e.write(sa("document.F=Object")),e.close(),e.F):oa(Au);for(var o=La.length;o--;)delete ni[Nu][La[o]];return ni()};sf[DE]=!0;var No=Object.create||function(e,n){var i;return e!==null?(Eg[Nu]=NE(e),i=new Eg,Eg[Nu]=null,i[DE]=e):i=ni(),n===void 0?i:cc.f(i,n)},oC=dt,aC=Ao,LE=Error,ET=O("".replace),cC=String(LE("zxcasd").stack),yg=/\n\s*at [^:]*:[^\n]*/,lC=yg.test(cC),Pp=Et,yT=!d(function(){var e=Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",Pp(1,7)),e.stack!==7)}),Hk=Ao,vg=function(e,n){if(lC&&typeof e=="string"&&!LE.prepareStackTrace)for(;n--;)e=ET(e,yg,"");return e},xE=yT,vT=Error.captureStackTrace,Id={},Np=Id,uC=ar("iterator"),ME=Array.prototype,Sg=function(e){return e!==void 0&&(Np.Array===e||ME[uC]===e)},kp=ic,UE=Qa,ST=hn,TT=Id,bT=ar("iterator"),ku=function(e){if(!ST(e))return UE(e,bT)||UE(e,"@@iterator")||TT[kp(e)]},lc=Me,of=es,wT=nn,dC=Ja,Du=ku,Ad=TypeError,Tg=function(e,n){var i=arguments.length<2?Du(e):n;if(of(i))return wT(lc(i,e));throw Ad(dC(e)+" is not iterable")},hC=Me,Ol=nn,Od=Qa,bg=function(e,n,i){var o,c;Ol(e);try{if(!(o=Od(e,"return"))){if(n==="throw")throw i;return i}o=hC(o,e)}catch(u){c=!0,o=u}if(n==="throw")throw i;if(c)throw o;return Ol(o),i},fC=Re,VE=Me,pC=nn,wg=Ja,Pl=Sg,Rg=ti,Dp=N,af=Tg,RT=ku,cf=bg,mC=TypeError,Lp=function(e,n){this.stopped=e,this.result=n},Si=Lp.prototype,Pd=function(e,n,i){var o,c,u,h,m,_,y,S=i&&i.that,w=!(!i||!i.AS_ENTRIES),I=!(!i||!i.IS_RECORD),P=!(!i||!i.IS_ITERATOR),B=!(!i||!i.INTERRUPTED),M=fC(n,S),U=function($){return o&&cf(o,"normal",$),new Lp(!0,$)},q=function($){return w?(pC($),B?M($[0],$[1],U):M($[0],$[1])):B?M($,U):M($)};if(I)o=e.iterator;else if(P)o=e;else{if(!(c=RT(e)))throw mC(wg(e)+" is not iterable");if(Pl(c)){for(u=0,h=Rg(e);h>u;u++)if((m=q(e[u]))&&Dp(Si,m))return m;return new Lp(!1)}o=af(e,c)}for(_=I?e.next:o.next;!(y=VE(_,o)).done;){try{m=q(y.value)}catch($){cf(o,"throw",$)}if(typeof m=="object"&&m&&Dp(Si,m))return m}return new Lp(!1)},CT=na,IT=Dn,FE=N,AT=mg,Nl=Al,Ci=function(e,n,i){for(var o=ia(n),c=rC.f,u=IE.f,h=0;h<o.length;h++){var m=o[h];rf(e,m)||i&&rf(i,m)||c(e,m,u(n,m))}},rs=No,is=Ao,xp=Et,Cg=function(e,n){oC(n)&&"cause"in n&&aC(e,"cause",n.cause)},Ig=function(e,n,i,o){xE&&(vT?vT(e,n):Hk(e,"stack",vg(i,o)))},Kk=Pd,ro=function(e,n){return e===void 0?arguments.length<2?"":n:CT(e)},OT=ar("toStringTag"),Mp=Error,PT=[].push,ko=function(e,n){var i,o=FE(aa,this);Nl?i=Nl(Mp(),o?AT(this):aa):(i=o?this:rs(aa),is(i,OT,"Error")),n!==void 0&&is(i,"message",ro(n)),Ig(i,ko,i.stack,1),arguments.length>2&&Cg(i,arguments[2]);var c=[];return Kk(e,PT,{that:c}),is(i,"errors",c),i};Nl?Nl(ko,Mp):Ci(ko,Mp,{name:!0});var aa=ko.prototype=rs(Mp.prototype,{constructor:xp(1,ko),message:xp(1,""),name:xp(1,"AggregateError")});IT({global:!0},{AggregateError:ko});var Nd,lf,Up,gC=Le,NT=H.WeakMap,_C=gC(NT)&&/native code/.test(String(NT)),kT=H,EC=dt,yC=Ao,jE=ui,BE=fd,Ag=fg,vC=sc,Og="Object already initialized",Vp=kT.TypeError,SC=kT.WeakMap;if(_C||BE.state){var uc=BE.state||(BE.state=new SC);uc.get=uc.get,uc.has=uc.has,uc.set=uc.set,Nd=function(e,n){if(uc.has(e))throw Vp(Og);return n.facade=e,uc.set(e,n),n},lf=function(e){return uc.get(e)||{}},Up=function(e){return uc.has(e)}}else{var uf=Ag("state");vC[uf]=!0,Nd=function(e,n){if(jE(e,uf))throw Vp(Og);return n.facade=e,yC(e,uf,n),n},lf=function(e){return jE(e,uf)?e[uf]:{}},Up=function(e){return jE(e,uf)}}var kd,DT,LT,Lu={set:Nd,get:lf,has:Up,enforce:function(e){return Up(e)?lf(e):Nd(e,{})},getterFor:function(e){return function(n){var i;if(!EC(n)||(i=lf(n)).type!==e)throw Vp("Incompatible receiver, "+e+" required");return i}}},WE=et,TC=ui,xT=Function.prototype,qk=WE&&Object.getOwnPropertyDescriptor,MT=TC(xT,"name"),bC={PROPER:MT&&(function(){}).name==="something",CONFIGURABLE:MT&&(!WE||WE&&qk(xT,"name").configurable)},$k=Ao,xu=function(e,n,i,o){return o&&o.enumerable?e[n]=i:$k(e,n,i),e},wC=d,RC=Le,GE=dt,Yk=No,CC=mg,Xk=xu,xa=ar("iterator"),zE=!1;[].keys&&("next"in(LT=[].keys())?(DT=CC(CC(LT)))!==Object.prototype&&(kd=DT):zE=!0);var HE=!GE(kd)||wC(function(){var e={};return kd[xa].call(e)!==e});RC((kd=HE?{}:Yk(kd))[xa])||Xk(kd,xa,function(){return this});var UT={IteratorPrototype:kd,BUGGY_SAFARI_ITERATORS:zE},IC=ic,AC=$h?{}.toString:function(){return"[object "+IC(this)+"]"},VT=$h,Fp=Ke.f,FT=Ao,jT=ui,Jk=AC,BT=ar("toStringTag"),Mu=function(e,n,i,o){if(e){var c=i?e:e.prototype;jT(c,BT)||Fp(c,BT,{configurable:!0,value:n}),o&&!VT&&FT(c,"toString",Jk)}},OC=UT.IteratorPrototype,PC=No,NC=Et,Qk=Mu,ca=Id,Do=function(){return this},KE=function(e,n,i,o){var c=n+" Iterator";return e.prototype=PC(OC,{next:NC(+!o,i)}),Qk(e,c,!1,!0),ca[c]=Do,e},kC=Dn,DC=Me,LC=bC,xC=KE,WT=mg,MC=Mu,qE=xu,GT=Id,UC=UT,zT=LC.PROPER,jp=UC.BUGGY_SAFARI_ITERATORS,$E=ar("iterator"),YE="keys",df="values",VC="entries",FC=function(){return this},XE=function(e,n,i,o,c,u,h){xC(i,n,o);var m,_,y,S=function(q){if(q===c&&M)return M;if(!jp&&q in P)return P[q];switch(q){case YE:case df:case VC:return function(){return new i(this,q)}}return function(){return new i(this)}},w=n+" Iterator",I=!1,P=e.prototype,B=P[$E]||P["@@iterator"]||c&&P[c],M=!jp&&B||S(c),U=n=="Array"&&P.entries||B;if(U&&(m=WT(U.call(new e)))!==Object.prototype&&m.next&&(MC(m,w,!0,!0),GT[w]=FC),zT&&c==df&&B&&B.name!==df&&(I=!0,M=function(){return DC(B,this)}),c)if(_={values:S(df),keys:u?M:S(YE),entries:S(VC)},h)for(y in _)(jp||I||!(y in P))&&qE(P,y,_[y]);else kC({target:n,proto:!0,forced:jp||I},_);return h&&P[$E]!==M&&qE(P,$E,M,{}),GT[n]=M,_},JE=function(e,n){return{value:e,done:n}},QE=ve,kl=Id,jC=Lu;Ke.f;var BC=XE,ZE=JE,HT="Array Iterator",WC=jC.set,Pg=jC.getterFor(HT);BC(Array,"Array",function(e,n){WC(this,{type:HT,target:QE(e),index:0,kind:n})},function(){var e=Pg(this),n=e.target,i=e.kind,o=e.index++;return!n||o>=n.length?(e.target=void 0,ZE(void 0,!0)):ZE(i=="keys"?o:i=="values"?n[o]:[o,n[o]],!1)},"values"),kl.Arguments=kl.Array;var io=Ke,ey=function(e,n,i){return io.f(e,n,i)},Zk=rn,ty=ey,so=et,GC=ar("species"),Ht=N,Bp=TypeError,Ng=function(e,n){if(Ht(n,e))return e;throw Bp("Incorrect invocation")},zC=Le,KT=fd,kg=O(Function.toString);zC(KT.inspectSource)||(KT.inspectSource=function(e){return kg(e)});var Dg=KT.inspectSource,qT=O,HC=d,$T=Le,KC=ic,YT=Dg,ny=function(){},js=[],dc=rn("Reflect","construct"),Dl=/^\s*(?:class|function)\b/,qC=qT(Dl.exec),$C=!Dl.exec(ny),Lo=function(e){if(!$T(e))return!1;try{return dc(ny,js,e),!0}catch{return!1}},XT=function(e){if(!$T(e))return!1;switch(KC(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return $C||!!qC(Dl,YT(e))}catch{return!0}};XT.sham=!0;var la,Wp,JT,ry,Lg=!dc||HC(function(){var e;return Lo(Lo.call)||!Lo(Object)||!Lo(function(){e=!0})||e})?XT:Lo,YC=Lg,eD=Ja,iy=TypeError,sy=nn,hc=function(e){if(YC(e))return e;throw iy(eD(e)+" is not a constructor")},yr=hn,Ps=ar("species"),Vi=function(e,n){var i,o=sy(e).constructor;return o===void 0||yr(i=sy(o)[Ps])?n:hc(i)},ss=O([].slice),Ma=TypeError,Jc=function(e,n){if(e<n)throw Ma("Not enough arguments");return e},os=/(?:ipad|iphone|ipod).*applewebkit/i.test(ur),Bs=H,hf=re,oy=Re,ay=Le,xg=ui,xo=d,cy=_g,Gp=ss,Ll=wl,ly=Jc,QT=os,Dd=Jh,zp=Bs.setImmediate,xl=Bs.clearImmediate,uy=Bs.process,ff=Bs.Dispatch,ZT=Bs.Function,Mg=Bs.MessageChannel,dy=Bs.String,Ws=0,fc={},pc="onreadystatechange";xo(function(){la=Bs.location});var oo=function(e){if(xg(fc,e)){var n=fc[e];delete fc[e],n()}},hy=function(e){return function(){oo(e)}},fy=function(e){oo(e.data)},py=function(e){Bs.postMessage(dy(e),la.protocol+"//"+la.host)};zp&&xl||(zp=function(e){ly(arguments.length,1);var n=ay(e)?e:ZT(e),i=Gp(arguments,1);return fc[++Ws]=function(){hf(n,void 0,i)},Wp(Ws),Ws},xl=function(e){delete fc[e]},Dd?Wp=function(e){uy.nextTick(hy(e))}:ff&&ff.now?Wp=function(e){ff.now(hy(e))}:Mg&&!QT?(ry=(JT=new Mg).port2,JT.port1.onmessage=fy,Wp=oy(ry.postMessage,ry)):Bs.addEventListener&&ay(Bs.postMessage)&&!Bs.importScripts&&la&&la.protocol!=="file:"&&!xo(py)?(Wp=py,Bs.addEventListener("message",fy,!1)):Wp=pc in Ll("script")?function(e){cy.appendChild(Ll("script"))[pc]=function(){cy.removeChild(this),oo(e)}}:function(e){setTimeout(hy(e),0)});var my={set:zp,clear:xl},Uu=function(){this.head=null,this.tail=null};Uu.prototype={add:function(e){var n={item:e,next:null},i=this.tail;i?i.next=n:this.head=n,this.tail=n},get:function(){var e=this.head;if(e)return(this.head=e.next)===null&&(this.tail=null),e.item}};var pf,Ug,Vu,Vg,Ld,e0=Uu,XC=/ipad|iphone|ipod/i.test(ur)&&typeof Pebble<"u",t0=/web0s(?!.*chrome)/i.test(ur),Ml=H,JC=Re,tD=pt.f,gy=my.set,QC=e0,mf=os,nD=XC,Hp=t0,_y=Jh,Ii=Ml.MutationObserver||Ml.WebKitMutationObserver,ZC=Ml.document,n0=Ml.process,Ey=Ml.Promise,eI=tD(Ml,"queueMicrotask"),yy=eI&&eI.value;if(!yy){var Fg=new QC,vy=function(){var e,n;for(_y&&(e=n0.domain)&&e.exit();n=Fg.get();)try{n()}catch(i){throw Fg.head&&pf(),i}e&&e.enter()};mf||_y||Hp||!Ii||!ZC?!nD&&Ey&&Ey.resolve?((Vg=Ey.resolve(void 0)).constructor=Ey,Ld=JC(Vg.then,Vg),pf=function(){Ld(vy)}):_y?pf=function(){n0.nextTick(vy)}:(gy=JC(gy,Ml),pf=function(){gy(vy)}):(Ug=!0,Vu=ZC.createTextNode(""),new Ii(vy).observe(Vu,{characterData:!0}),pf=function(){Vu.data=Ug=!Ug}),yy=function(e){Fg.head||pf(),Fg.add(e)}}var Ua=yy,xd=function(e){try{return{error:!1,value:e()}}catch(n){return{error:!0,value:n}}},gf=H.Promise,Fu=typeof Deno=="object"&&Deno&&typeof Deno.version=="object",Sy=!Fu&&!Jh&&typeof window=="object"&&typeof document=="object",_f=H,Md=gf,r0=Le,i0=ea,rD=Dg,s0=ar,iD=Sy,tI=Fu,Ty=li,jg=Md&&Md.prototype,by=s0("species"),o0=r0(_f.PromiseRejectionEvent),a0=i0("Promise",function(){var e=rD(Md),n=e!==String(Md);if(!n&&Ty===66||!jg.catch||!jg.finally)return!0;if(!Ty||Ty<51||!/native code/.test(e)){var i=new Md(function(c){c(1)}),o=function(c){c(function(){},function(){})};if((i.constructor={})[by]=o,!(i.then(function(){})instanceof o))return!0}return!n&&(iD||tI)&&!o0}),Bg={CONSTRUCTOR:a0,REJECTION_EVENT:o0},Qc={},wy=es,Ry=TypeError,c0=function(e){var n,i;this.promise=new e(function(o,c){if(n!==void 0||i!==void 0)throw Ry("Bad Promise constructor");n=o,i=c}),this.resolve=wy(n),this.reject=wy(i)};Qc.f=function(e){return new c0(e)};var Kp,l0,sD=Dn,Ef=Jh,Ud=H,ju=Me,oD=xu,Cy=Mu,f=function(e){var n=Zk(e);so&&n&&!n[GC]&&ty(n,GC,{configurable:!0,get:function(){return this}})},g=es,T=Le,A=dt,x=Ng,W=Vi,ie=my.set,Se=Ua,Ie=function(e,n){try{arguments.length==1?console.error(e):console.error(e,n)}catch{}},$e=xd,St=e0,Tt=Lu,vt=gf,Ft=Bg,Yt=Qc,Xt="Promise",Fi=Ft.CONSTRUCTOR,Ge=Ft.REJECTION_EVENT,Pe=Tt.getterFor(Xt),He=Tt.set,wt=vt&&vt.prototype,Jt=vt,on=wt,fn=Ud.TypeError,An=Ud.document,as=Ud.process,mr=Yt.f,Vd=mr,aD=!!(An&&An.createEvent&&Ud.dispatchEvent),Bj="unhandledrejection",Wj=function(e){var n;return!(!A(e)||!T(n=e.then))&&n},Gj=function(e,n){var i,o,c,u=n.value,h=n.state==1,m=h?e.ok:e.fail,_=e.resolve,y=e.reject,S=e.domain;try{m?(h||(n.rejection===2&&Qie(n),n.rejection=1),m===!0?i=u:(S&&S.enter(),i=m(u),S&&(S.exit(),c=!0)),i===e.promise?y(fn("Promise-chain cycle")):(o=Wj(i))?ju(o,i,_,y):_(i)):y(u)}catch(w){S&&!c&&S.exit(),y(w)}},zj=function(e,n){e.notified||(e.notified=!0,Se(function(){for(var i,o=e.reactions;i=o.get();)Gj(i,e);e.notified=!1,n&&!e.rejection&&Jie(e)}))},Hj=function(e,n,i){var o,c;aD?((o=An.createEvent("Event")).promise=n,o.reason=i,o.initEvent(e,!1,!0),Ud.dispatchEvent(o)):o={promise:n,reason:i},!Ge&&(c=Ud["on"+e])?c(o):e===Bj&&Ie("Unhandled promise rejection",i)},Jie=function(e){ju(ie,Ud,function(){var n,i=e.facade,o=e.value;if(Kj(e)&&(n=$e(function(){Ef?as.emit("unhandledRejection",o,i):Hj(Bj,i,o)}),e.rejection=Ef||Kj(e)?2:1,n.error))throw n.value})},Kj=function(e){return e.rejection!==1&&!e.parent},Qie=function(e){ju(ie,Ud,function(){var n=e.facade;Ef?as.emit("rejectionHandled",n):Hj("rejectionhandled",n,e.value)})},Iy=function(e,n,i){return function(o){e(n,o,i)}},Ay=function(e,n,i){e.done||(e.done=!0,i&&(e=i),e.value=n,e.state=2,zj(e,!0))},cD=function(e,n,i){if(!e.done){e.done=!0,i&&(e=i);try{if(e.facade===n)throw fn("Promise can't be resolved itself");var o=Wj(n);o?Se(function(){var c={done:!1};try{ju(o,n,Iy(cD,c,e),Iy(Ay,c,e))}catch(u){Ay(c,u,e)}}):(e.value=n,e.state=1,zj(e,!1))}catch(c){Ay({done:!1},c,e)}}};Fi&&(on=(Jt=function(e){x(this,on),g(e),ju(Kp,this);var n=Pe(this);try{e(Iy(cD,n),Iy(Ay,n))}catch(i){Ay(n,i)}}).prototype,(Kp=function(e){He(this,{type:Xt,done:!1,notified:!1,parent:!1,reactions:new St,rejection:!1,state:0,value:void 0})}).prototype=oD(on,"then",function(e,n){var i=Pe(this),o=mr(W(this,Jt));return i.parent=!0,o.ok=!T(e)||e,o.fail=T(n)&&n,o.domain=Ef?as.domain:void 0,i.state==0?i.reactions.add(o):Se(function(){Gj(o,i)}),o.promise}),l0=function(){var e=new Kp,n=Pe(e);this.promise=e,this.resolve=Iy(cD,n),this.reject=Iy(Ay,n)},Yt.f=mr=function(e){return e===Jt||e===void 0?new l0(e):Vd(e)}),sD({global:!0,wrap:!0,forced:Fi},{Promise:Jt}),Cy(Jt,Xt,!1,!0),f(Xt);var qj=ar("iterator"),$j=!1;try{var Zie=0,Yj={next:function(){return{done:!!Zie++}},return:function(){$j=!0}};Yj[qj]=function(){return this},Array.from(Yj,function(){throw 2})}catch{}var ese=gf,tse=function(e,n){if(!$j)return!1;var i=!1;try{var o={};o[qj]=function(){return{next:function(){return{done:i=!0}}}},e(o)}catch{}return i},nI=Bg.CONSTRUCTOR||!tse(function(e){ese.all(e).then(void 0,function(){})}),nse=Me,rse=es,ise=Qc,sse=xd,ose=Pd;Dn({target:"Promise",stat:!0,forced:nI},{all:function(e){var n=this,i=ise.f(n),o=i.resolve,c=i.reject,u=sse(function(){var h=rse(n.resolve),m=[],_=0,y=1;ose(e,function(S){var w=_++,I=!1;y++,nse(h,n,S).then(function(P){I||(I=!0,m[w]=P,--y||o(m))},c)}),--y||o(m)});return u.error&&c(u.value),i.promise}});var ase=Dn,cse=Bg.CONSTRUCTOR;gf&&gf.prototype,ase({target:"Promise",proto:!0,forced:cse,real:!0},{catch:function(e){return this.then(void 0,e)}});var lse=Me,use=es,dse=Qc,hse=xd,fse=Pd;Dn({target:"Promise",stat:!0,forced:nI},{race:function(e){var n=this,i=dse.f(n),o=i.reject,c=hse(function(){var u=use(n.resolve);fse(e,function(h){lse(u,n,h).then(i.resolve,o)})});return c.error&&o(c.value),i.promise}});var pse=Me,mse=Qc;Dn({target:"Promise",stat:!0,forced:Bg.CONSTRUCTOR},{reject:function(e){var n=mse.f(this);return pse(n.reject,void 0,e),n.promise}});var gse=nn,_se=dt,Ese=Qc,Xj=function(e,n){if(gse(e),_se(n)&&n.constructor===e)return n;var i=Ese.f(e);return(0,i.resolve)(n),i.promise},yse=Dn,vse=gf,Sse=Bg.CONSTRUCTOR,Tse=Xj,bse=rn("Promise"),wse=!Sse;yse({target:"Promise",stat:!0,forced:!0},{resolve:function(e){return Tse(wse&&this===bse?vse:this,e)}});var Rse=Me,Cse=es,Ise=Qc,Ase=xd,Ose=Pd;Dn({target:"Promise",stat:!0,forced:nI},{allSettled:function(e){var n=this,i=Ise.f(n),o=i.resolve,c=i.reject,u=Ase(function(){var h=Cse(n.resolve),m=[],_=0,y=1;Ose(e,function(S){var w=_++,I=!1;y++,Rse(h,n,S).then(function(P){I||(I=!0,m[w]={status:"fulfilled",value:P},--y||o(m))},function(P){I||(I=!0,m[w]={status:"rejected",reason:P},--y||o(m))})}),--y||o(m)});return u.error&&c(u.value),i.promise}});var Pse=Me,Nse=es,kse=rn,Dse=Qc,Lse=xd,xse=Pd,Jj="No one promise resolved";Dn({target:"Promise",stat:!0,forced:nI},{any:function(e){var n=this,i=kse("AggregateError"),o=Dse.f(n),c=o.resolve,u=o.reject,h=Lse(function(){var m=Nse(n.resolve),_=[],y=0,S=1,w=!1;xse(e,function(I){var P=y++,B=!1;S++,Pse(m,n,I).then(function(M){B||w||(w=!0,c(M))},function(M){B||w||(B=!0,_[P]=M,--S||u(new i(_,Jj)))})}),--S||u(new i(_,Jj))});return h.error&&u(h.value),o.promise}});var Mse=Dn,lD=gf,Use=d,Vse=rn,Fse=Le,jse=Vi,Qj=Xj,Bse=lD&&lD.prototype;Mse({target:"Promise",proto:!0,real:!0,forced:!!lD&&Use(function(){Bse.finally.call({then:function(){}},function(){})})},{finally:function(e){var n=jse(this,Vse("Promise")),i=Fse(e);return this.then(i?function(o){return Qj(n,e()).then(function(){return o})}:e,i?function(o){return Qj(n,e()).then(function(){throw o})}:e)}});var uD=O,Wse=rc,Gse=na,zse=Zt,Hse=uD("".charAt),Zj=uD("".charCodeAt),Kse=uD("".slice),eB=function(e){return function(n,i){var o,c,u=Gse(zse(n)),h=Wse(i),m=u.length;return h<0||h>=m?e?"":void 0:(o=Zj(u,h))<55296||o>56319||h+1===m||(c=Zj(u,h+1))<56320||c>57343?e?Hse(u,h):o:e?Kse(u,h,h+2):c-56320+(o-55296<<10)+65536}},dD={codeAt:eB(!1),charAt:eB(!0)},qse=dD.charAt,$se=na,tB=Lu,Yse=XE,nB=JE,rB="String Iterator",Xse=tB.set,Jse=tB.getterFor(rB);Yse(String,"String",function(e){Xse(this,{type:rB,string:$se(e),index:0})},function(){var e,n=Jse(this),i=n.string,o=n.index;return o>=i.length?nB(void 0,!0):(e=qse(i,o),n.index+=e.length,nB(e,!1))});var Qse=mt.Promise,Zse={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},eoe=H,toe=ic,noe=Ao,iB=Id,sB=ar("toStringTag");for(var hD in Zse){var oB=eoe[hD],fD=oB&&oB.prototype;fD&&toe(fD)!==sB&&noe(fD,sB,hD),iB[hD]=iB.Array}var aB=Qse,tt=l(aB),roe=ka("Array").values,ioe=ic,soe=ui,ooe=N,aoe=roe,pD=Array.prototype,coe={DOMTokenList:!0,NodeList:!0},loe=function(e){var n=e.values;return e===pD||ooe(pD,e)&&n===pD.values||soe(coe,ioe(e))?aoe:n},mc=l(loe),uoe=d,doe=ar("iterator"),mD=!uoe(function(){var e=new URL("b?a=1&b=2&c=3","http://a"),n=e.searchParams,i=new URLSearchParams("a=1&a=2"),o="";return e.pathname="c%20d",n.forEach(function(c,u){n.delete("b"),o+=u+c}),i.delete("a",2),!e.toJSON||!i.has("a",1)||i.has("a",2)||!n.size&&!0||!n.sort||e.href!=="http://a/c%20d?a=1&c=3"||n.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!n[doe]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("http://").host!=="xn--e1aybc"||new URL("http://a#").hash!=="#%D0%B1"||o!=="a1c3"||new URL("http://x",void 0).host!=="x"}),hoe=xu,foe=Pa,poe=Ke,moe=Et,rI=function(e,n,i){var o=foe(n);o in e?poe.f(e,o,moe(0,i)):e[o]=i},cB=he,goe=ti,_oe=rI,Eoe=Array,yoe=Math.max,gD=function(e,n,i){for(var o=goe(e),c=cB(n,o),u=cB(i===void 0?o:i,o),h=Eoe(yoe(u-c,0)),m=0;c<u;c++,m++)_oe(h,m,e[c]);return h.length=m,h},lB=gD,voe=Math.floor,_D=function(e,n){var i=e.length,o=voe(i/2);return i<8?Soe(e,n):Toe(e,_D(lB(e,0,o),n),_D(lB(e,o),n),n)},Soe=function(e,n){for(var i,o,c=e.length,u=1;u<c;){for(o=u,i=e[u];o&&n(e[o-1],i)>0;)e[o]=e[--o];o!==u++&&(e[o]=i)}return e},Toe=function(e,n,i,o){for(var c=n.length,u=i.length,h=0,m=0;h<c||m<u;)e[h+m]=h<c&&m<u?o(n[h],i[m])<=0?n[h++]:i[m++]:h<c?n[h++]:i[m++];return e},uB=_D,ED=Dn,Oy=H,iI=Me,Fd=O,Py=et,dB=mD,hB=xu,boe=ey,woe=function(e,n,i){for(var o in n)i&&i.unsafe&&e[o]?e[o]=n[o]:hoe(e,o,n[o],i);return e},Roe=Mu,Coe=KE,yD=Lu,fB=Ng,vD=Le,Ioe=ui,Aoe=Re,Ooe=ic,Poe=nn,pB=dt,Va=na,Noe=No,mB=Et,SD=Tg,koe=ku,Ny=Jc,Doe=uB,Loe=ar("iterator"),u0="URLSearchParams",gB=u0+"Iterator",_B=yD.set,Ul=yD.getterFor(u0),xoe=yD.getterFor(gB),Moe=Object.getOwnPropertyDescriptor,TD=function(e){if(!Py)return Oy[e];var n=Moe(Oy,e);return n&&n.value},EB=TD("fetch"),sI=TD("Request"),d0=TD("Headers"),bD=sI&&sI.prototype,yB=d0&&d0.prototype,Uoe=Oy.RegExp,Voe=Oy.TypeError,vB=Oy.decodeURIComponent,Foe=Oy.encodeURIComponent,joe=Fd("".charAt),SB=Fd([].join),Wg=Fd([].push),wD=Fd("".replace),Boe=Fd([].shift),TB=Fd([].splice),bB=Fd("".split),Woe=Fd("".slice),Goe=/\+/g,wB=Array(4),zoe=function(e){return wB[e-1]||(wB[e-1]=Uoe("((?:%[\\da-f]{2}){"+e+"})","gi"))},Hoe=function(e){try{return vB(e)}catch{return e}},RB=function(e){var n=wD(e,Goe," "),i=4;try{return vB(n)}catch{for(;i;)n=wD(n,zoe(i--),Hoe);return n}},Koe=/[!'()~]|%20/g,qoe={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},$oe=function(e){return qoe[e]},CB=function(e){return wD(Foe(e),Koe,$oe)},RD=Coe(function(e,n){_B(this,{type:gB,iterator:SD(Ul(e).entries),kind:n})},"Iterator",function(){var e=xoe(this),n=e.kind,i=e.iterator.next(),o=i.value;return i.done||(i.value=n==="keys"?o.key:n==="values"?o.value:[o.key,o.value]),i},!0),IB=function(e){this.entries=[],this.url=null,e!==void 0&&(pB(e)?this.parseObject(e):this.parseQuery(typeof e=="string"?joe(e,0)==="?"?Woe(e,1):e:Va(e)))};IB.prototype={type:u0,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var n,i,o,c,u,h,m,_=koe(e);if(_)for(i=(n=SD(e,_)).next;!(o=iI(i,n)).done;){if(u=(c=SD(Poe(o.value))).next,(h=iI(u,c)).done||(m=iI(u,c)).done||!iI(u,c).done)throw Voe("Expected sequence with length 2");Wg(this.entries,{key:Va(h.value),value:Va(m.value)})}else for(var y in e)Ioe(e,y)&&Wg(this.entries,{key:y,value:Va(e[y])})},parseQuery:function(e){if(e)for(var n,i,o=bB(e,"&"),c=0;c<o.length;)(n=o[c++]).length&&(i=bB(n,"="),Wg(this.entries,{key:RB(Boe(i)),value:RB(SB(i,"="))}))},serialize:function(){for(var e,n=this.entries,i=[],o=0;o<n.length;)e=n[o++],Wg(i,CB(e.key)+"="+CB(e.value));return SB(i,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var oI=function(){fB(this,ky);var e=_B(this,new IB(arguments.length>0?arguments[0]:void 0));Py||(this.size=e.entries.length)},ky=oI.prototype;if(woe(ky,{append:function(e,n){var i=Ul(this);Ny(arguments.length,2),Wg(i.entries,{key:Va(e),value:Va(n)}),Py||this.length++,i.updateURL()},delete:function(e){for(var n=Ul(this),i=Ny(arguments.length,1),o=n.entries,c=Va(e),u=i<2?void 0:arguments[1],h=u===void 0?u:Va(u),m=0;m<o.length;){var _=o[m];if(_.key!==c||h!==void 0&&_.value!==h)m++;else if(TB(o,m,1),h!==void 0)break}Py||(this.size=o.length),n.updateURL()},get:function(e){var n=Ul(this).entries;Ny(arguments.length,1);for(var i=Va(e),o=0;o<n.length;o++)if(n[o].key===i)return n[o].value;return null},getAll:function(e){var n=Ul(this).entries;Ny(arguments.length,1);for(var i=Va(e),o=[],c=0;c<n.length;c++)n[c].key===i&&Wg(o,n[c].value);return o},has:function(e){for(var n=Ul(this).entries,i=Ny(arguments.length,1),o=Va(e),c=i<2?void 0:arguments[1],u=c===void 0?c:Va(c),h=0;h<n.length;){var m=n[h++];if(m.key===o&&(u===void 0||m.value===u))return!0}return!1},set:function(e,n){var i=Ul(this);Ny(arguments.length,1);for(var o,c=i.entries,u=!1,h=Va(e),m=Va(n),_=0;_<c.length;_++)(o=c[_]).key===h&&(u?TB(c,_--,1):(u=!0,o.value=m));u||Wg(c,{key:h,value:m}),Py||(this.size=c.length),i.updateURL()},sort:function(){var e=Ul(this);Doe(e.entries,function(n,i){return n.key>i.key?1:-1}),e.updateURL()},forEach:function(e){for(var n,i=Ul(this).entries,o=Aoe(e,arguments.length>1?arguments[1]:void 0),c=0;c<i.length;)o((n=i[c++]).value,n.key,this)},keys:function(){return new RD(this,"keys")},values:function(){return new RD(this,"values")},entries:function(){return new RD(this,"entries")}},{enumerable:!0}),hB(ky,Loe,ky.entries,{}),hB(ky,"toString",function(){return Ul(this).serialize()},{enumerable:!0}),Py&&boe(ky,"size",{get:function(){return Ul(this).entries.length},configurable:!0,enumerable:!0}),Roe(oI,u0),ED({global:!0,forced:!dB},{URLSearchParams:oI}),!dB&&vD(d0)){var Yoe=Fd(yB.has),Xoe=Fd(yB.set),AB=function(e){if(pB(e)){var n,i=e.body;if(Ooe(i)===u0)return n=e.headers?new d0(e.headers):new d0,Yoe(n,"content-type")||Xoe(n,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),Noe(e,{body:mB(0,Va(i)),headers:mB(0,n)})}return e};if(vD(EB)&&ED({global:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return EB(e,arguments.length>1?AB(arguments[1]):{})}}),vD(sI)){var CD=function(e){return fB(this,bD),new sI(e,arguments.length>1?AB(arguments[1]):{})};bD.constructor=CD,CD.prototype=bD,ED({global:!0,dontCallGetSet:!0,forced:!0},{Request:CD})}}var Vl,Joe={URLSearchParams:oI,getState:Ul},Qoe=mt.URLSearchParams,OB=et,Zoe=O,eae=Me,tae=d,ID=ac,nae=oc,rae=it,iae=yo,sae=In,Dy=Object.assign,PB=Object.defineProperty,oae=Zoe([].concat),aae=!Dy||tae(function(){if(OB&&Dy({b:1},Dy(PB({},"a",{enumerable:!0,get:function(){PB(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var e={},n={},i=Symbol(),o="abcdefghijklmnopqrst";return e[i]=7,o.split("").forEach(function(c){n[c]=c}),Dy({},e)[i]!=7||ID(Dy({},n)).join("")!=o})?function(e,n){for(var i=iae(e),o=arguments.length,c=1,u=nae.f,h=rae.f;o>c;)for(var m,_=sae(arguments[c++]),y=u?oae(ID(_),u(_)):ID(_),S=y.length,w=0;S>w;)m=y[w++],OB&&!eae(h,_,m)||(i[m]=_[m]);return i}:Dy,cae=nn,lae=bg,uae=Re,dae=Me,hae=yo,fae=function(e,n,i,o){try{return o?n(cae(i)[0],i[1]):n(i)}catch(c){lae(e,"throw",c)}},pae=Sg,mae=Lg,gae=ti,NB=rI,_ae=Tg,Eae=ku,kB=Array,Gg=O,AD=2147483647,yae=/[^\0-\u007E]/,DB=/[.\u3002\uFF0E\uFF61]/g,LB="Overflow: input needs wider integers to process",xB=RangeError,vae=Gg(DB.exec),Ly=Math.floor,OD=String.fromCharCode,MB=Gg("".charCodeAt),UB=Gg([].join),qp=Gg([].push),Sae=Gg("".replace),Tae=Gg("".split),bae=Gg("".toLowerCase),VB=function(e){return e+22+75*(e<26)},wae=function(e,n,i){var o=0;for(e=i?Ly(e/700):e>>1,e+=Ly(e/n);e>455;)e=Ly(e/35),o+=36;return Ly(o+36*e/(e+38))},Rae=function(e){var n=[];e=function(q){for(var $=[],ae=0,me=q.length;ae<me;){var ge=MB(q,ae++);if(ge>=55296&&ge<=56319&&ae<me){var pe=MB(q,ae++);(64512&pe)==56320?qp($,((1023&ge)<<10)+(1023&pe)+65536):(qp($,ge),ae--)}else qp($,ge)}return $}(e);var i,o,c=e.length,u=128,h=0,m=72;for(i=0;i<e.length;i++)(o=e[i])<128&&qp(n,OD(o));var _=n.length,y=_;for(_&&qp(n,"-");y<c;){var S=AD;for(i=0;i<e.length;i++)(o=e[i])>=u&&o<S&&(S=o);var w=y+1;if(S-u>Ly((AD-h)/w))throw xB(LB);for(h+=(S-u)*w,u=S,i=0;i<e.length;i++){if((o=e[i])<u&&++h>AD)throw xB(LB);if(o==u){for(var I=h,P=36;;){var B=P<=m?1:P>=m+26?26:P-m;if(I<B)break;var M=I-B,U=36-B;qp(n,OD(VB(B+M%U))),I=Ly(M/U),P+=36}qp(n,OD(VB(I))),m=wae(h,w,y==_),h=0,y++}}h++,u++}return UB(n,"")},Cae=Dn,PD=et,Iae=mD,ND=H,FB=Re,Fl=O,aI=xu,jl=ey,Aae=Ng,kD=ui,DD=aae,xy=function(e){var n=hae(e),i=mae(this),o=arguments.length,c=o>1?arguments[1]:void 0,u=c!==void 0;u&&(c=uae(c,o>2?arguments[2]:void 0));var h,m,_,y,S,w,I=Eae(n),P=0;if(!I||this===kB&&pae(I))for(h=gae(n),m=i?new this(h):kB(h);h>P;P++)w=u?c(n[P],P):n[P],NB(m,P,w);else for(S=(y=_ae(n,I)).next,m=i?new this:[];!(_=dae(S,y)).done;P++)w=u?fae(y,c,[_.value,P],!0):_.value,NB(m,P,w);return m.length=P,m},Bu=gD,Oae=dD.codeAt,Pae=function(e){var n,i,o=[],c=Tae(Sae(bae(e),DB,"."),".");for(n=0;n<c.length;n++)i=c[n],qp(o,vae(yae,i)?"xn--"+Rae(i):i);return UB(o,".")},yf=na,Nae=Mu,kae=Jc,jB=Joe,BB=Lu,Dae=BB.set,cI=BB.getterFor("URL"),Lae=jB.URLSearchParams,xae=jB.getState,h0=ND.URL,LD=ND.TypeError,lI=ND.parseInt,Mae=Math.floor,WB=Math.pow,Bl=Fl("".charAt),Wu=Fl(/./.exec),f0=Fl([].join),Uae=Fl(1 .toString),Vae=Fl([].pop),My=Fl([].push),xD=Fl("".replace),Fae=Fl([].shift),jae=Fl("".split),p0=Fl("".slice),uI=Fl("".toLowerCase),Bae=Fl([].unshift),MD="Invalid scheme",zg="Invalid host",GB="Invalid port",zB=/[a-z]/i,Wae=/[\d+-.a-z]/i,UD=/\d/,Gae=/^0x/i,zae=/^[0-7]+$/,Hae=/^\d+$/,HB=/^[\da-f]+$/i,Kae=/[\0\t\n\r #%/:<>?@[\\\]^|]/,qae=/[\0\t\n\r #/:<>?@[\\\]^|]/,$ae=/^[\u0000-\u0020]+/,Yae=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,Xae=/[\t\n\r]/g,m0=function(e){var n,i,o,c;if(typeof e=="number"){for(n=[],i=0;i<4;i++)Bae(n,e%256),e=Mae(e/256);return f0(n,".")}if(typeof e=="object"){for(n="",o=function(u){for(var h=null,m=1,_=null,y=0,S=0;S<8;S++)u[S]!==0?(y>m&&(h=_,m=y),_=null,y=0):(_===null&&(_=S),++y);return y>m&&(h=_,m=y),h}(e),i=0;i<8;i++)c&&e[i]===0||(c&&(c=!1),o===i?(n+=i?":":"::",c=!0):(n+=Uae(e[i],16),i<7&&(n+=":")));return"["+n+"]"}return e},dI={},KB=DD({},dI,{" ":1,'"':1,"<":1,">":1,"`":1}),qB=DD({},KB,{"#":1,"?":1,"{":1,"}":1}),VD=DD({},qB,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),$p=function(e,n){var i=Oae(e,0);return i>32&&i<127&&!kD(n,e)?e:encodeURIComponent(e)},hI={ftp:21,file:null,http:80,https:443,ws:80,wss:443},g0=function(e,n){var i;return e.length==2&&Wu(zB,Bl(e,0))&&((i=Bl(e,1))==":"||!n&&i=="|")},$B=function(e){var n;return e.length>1&&g0(p0(e,0,2))&&(e.length==2||(n=Bl(e,2))==="/"||n==="\\"||n==="?"||n==="#")},Jae=function(e){return e==="."||uI(e)==="%2e"},FD={},YB={},jD={},XB={},JB={},BD={},QB={},ZB={},fI={},pI={},WD={},GD={},zD={},HD={},e4={},KD={},Uy={},jd={},t4={},Hg={},vf={},qD=function(e,n,i){var o,c,u,h=yf(e);if(n){if(c=this.parse(h))throw LD(c);this.searchParams=null}else{if(i!==void 0&&(o=new qD(i,!0)),c=this.parse(h,null,o))throw LD(c);(u=xae(new Lae)).bindURL(this),this.searchParams=u}};qD.prototype={type:"URL",parse:function(e,n,i){var o,c,u,h,m,_=this,y=n||FD,S=0,w="",I=!1,P=!1,B=!1;for(e=yf(e),n||(_.scheme="",_.username="",_.password="",_.host=null,_.port=null,_.path=[],_.query=null,_.fragment=null,_.cannotBeABaseURL=!1,e=xD(e,$ae,""),e=xD(e,Yae,"$1")),e=xD(e,Xae,""),o=xy(e);S<=o.length;){switch(c=o[S],y){case FD:if(!c||!Wu(zB,c)){if(n)return MD;y=jD;continue}w+=uI(c),y=YB;break;case YB:if(c&&(Wu(Wae,c)||c=="+"||c=="-"||c=="."))w+=uI(c);else{if(c!=":"){if(n)return MD;w="",y=jD,S=0;continue}if(n&&(_.isSpecial()!=kD(hI,w)||w=="file"&&(_.includesCredentials()||_.port!==null)||_.scheme=="file"&&!_.host))return;if(_.scheme=w,n)return void(_.isSpecial()&&hI[_.scheme]==_.port&&(_.port=null));w="",_.scheme=="file"?y=HD:_.isSpecial()&&i&&i.scheme==_.scheme?y=XB:_.isSpecial()?y=ZB:o[S+1]=="/"?(y=JB,S++):(_.cannotBeABaseURL=!0,My(_.path,""),y=t4)}break;case jD:if(!i||i.cannotBeABaseURL&&c!="#")return MD;if(i.cannotBeABaseURL&&c=="#"){_.scheme=i.scheme,_.path=Bu(i.path),_.query=i.query,_.fragment="",_.cannotBeABaseURL=!0,y=vf;break}y=i.scheme=="file"?HD:BD;continue;case XB:if(c!="/"||o[S+1]!="/"){y=BD;continue}y=fI,S++;break;case JB:if(c=="/"){y=pI;break}y=jd;continue;case BD:if(_.scheme=i.scheme,c==Vl)_.username=i.username,_.password=i.password,_.host=i.host,_.port=i.port,_.path=Bu(i.path),_.query=i.query;else if(c=="/"||c=="\\"&&_.isSpecial())y=QB;else if(c=="?")_.username=i.username,_.password=i.password,_.host=i.host,_.port=i.port,_.path=Bu(i.path),_.query="",y=Hg;else{if(c!="#"){_.username=i.username,_.password=i.password,_.host=i.host,_.port=i.port,_.path=Bu(i.path),_.path.length--,y=jd;continue}_.username=i.username,_.password=i.password,_.host=i.host,_.port=i.port,_.path=Bu(i.path),_.query=i.query,_.fragment="",y=vf}break;case QB:if(!_.isSpecial()||c!="/"&&c!="\\"){if(c!="/"){_.username=i.username,_.password=i.password,_.host=i.host,_.port=i.port,y=jd;continue}y=pI}else y=fI;break;case ZB:if(y=fI,c!="/"||Bl(w,S+1)!="/")continue;S++;break;case fI:if(c!="/"&&c!="\\"){y=pI;continue}break;case pI:if(c=="@"){I&&(w="%40"+w),I=!0,u=xy(w);for(var M=0;M<u.length;M++){var U=u[M];if(U!=":"||B){var q=$p(U,VD);B?_.password+=q:_.username+=q}else B=!0}w=""}else if(c==Vl||c=="/"||c=="?"||c=="#"||c=="\\"&&_.isSpecial()){if(I&&w=="")return"Invalid authority";S-=xy(w).length+1,w="",y=WD}else w+=c;break;case WD:case GD:if(n&&_.scheme=="file"){y=KD;continue}if(c!=":"||P){if(c==Vl||c=="/"||c=="?"||c=="#"||c=="\\"&&_.isSpecial()){if(_.isSpecial()&&w=="")return zg;if(n&&w==""&&(_.includesCredentials()||_.port!==null))return;if(h=_.parseHost(w))return h;if(w="",y=Uy,n)return;continue}c=="["?P=!0:c=="]"&&(P=!1),w+=c}else{if(w=="")return zg;if(h=_.parseHost(w))return h;if(w="",y=zD,n==GD)return}break;case zD:if(!Wu(UD,c)){if(c==Vl||c=="/"||c=="?"||c=="#"||c=="\\"&&_.isSpecial()||n){if(w!=""){var $=lI(w,10);if($>65535)return GB;_.port=_.isSpecial()&&$===hI[_.scheme]?null:$,w=""}if(n)return;y=Uy;continue}return GB}w+=c;break;case HD:if(_.scheme="file",c=="/"||c=="\\")y=e4;else{if(!i||i.scheme!="file"){y=jd;continue}if(c==Vl)_.host=i.host,_.path=Bu(i.path),_.query=i.query;else if(c=="?")_.host=i.host,_.path=Bu(i.path),_.query="",y=Hg;else{if(c!="#"){$B(f0(Bu(o,S),""))||(_.host=i.host,_.path=Bu(i.path),_.shortenPath()),y=jd;continue}_.host=i.host,_.path=Bu(i.path),_.query=i.query,_.fragment="",y=vf}}break;case e4:if(c=="/"||c=="\\"){y=KD;break}i&&i.scheme=="file"&&!$B(f0(Bu(o,S),""))&&(g0(i.path[0],!0)?My(_.path,i.path[0]):_.host=i.host),y=jd;continue;case KD:if(c==Vl||c=="/"||c=="\\"||c=="?"||c=="#"){if(!n&&g0(w))y=jd;else if(w==""){if(_.host="",n)return;y=Uy}else{if(h=_.parseHost(w))return h;if(_.host=="localhost"&&(_.host=""),n)return;w="",y=Uy}continue}w+=c;break;case Uy:if(_.isSpecial()){if(y=jd,c!="/"&&c!="\\")continue}else if(n||c!="?")if(n||c!="#"){if(c!=Vl&&(y=jd,c!="/"))continue}else _.fragment="",y=vf;else _.query="",y=Hg;break;case jd:if(c==Vl||c=="/"||c=="\\"&&_.isSpecial()||!n&&(c=="?"||c=="#")){if((m=uI(m=w))===".."||m==="%2e."||m===".%2e"||m==="%2e%2e"?(_.shortenPath(),c=="/"||c=="\\"&&_.isSpecial()||My(_.path,"")):Jae(w)?c=="/"||c=="\\"&&_.isSpecial()||My(_.path,""):(_.scheme=="file"&&!_.path.length&&g0(w)&&(_.host&&(_.host=""),w=Bl(w,0)+":"),My(_.path,w)),w="",_.scheme=="file"&&(c==Vl||c=="?"||c=="#"))for(;_.path.length>1&&_.path[0]==="";)Fae(_.path);c=="?"?(_.query="",y=Hg):c=="#"&&(_.fragment="",y=vf)}else w+=$p(c,qB);break;case t4:c=="?"?(_.query="",y=Hg):c=="#"?(_.fragment="",y=vf):c!=Vl&&(_.path[0]+=$p(c,dI));break;case Hg:n||c!="#"?c!=Vl&&(c=="'"&&_.isSpecial()?_.query+="%27":_.query+=c=="#"?"%23":$p(c,dI)):(_.fragment="",y=vf);break;case vf:c!=Vl&&(_.fragment+=$p(c,KB))}S++}},parseHost:function(e){var n,i,o;if(Bl(e,0)=="["){if(Bl(e,e.length-1)!="]"||(n=function(c){var u,h,m,_,y,S,w,I=[0,0,0,0,0,0,0,0],P=0,B=null,M=0,U=function(){return Bl(c,M)};if(U()==":"){if(Bl(c,1)!=":")return;M+=2,B=++P}for(;U();){if(P==8)return;if(U()!=":"){for(u=h=0;h<4&&Wu(HB,U());)u=16*u+lI(U(),16),M++,h++;if(U()=="."){if(h==0||(M-=h,P>6))return;for(m=0;U();){if(_=null,m>0){if(!(U()=="."&&m<4))return;M++}if(!Wu(UD,U()))return;for(;Wu(UD,U());){if(y=lI(U(),10),_===null)_=y;else{if(_==0)return;_=10*_+y}if(_>255)return;M++}I[P]=256*I[P]+_,++m!=2&&m!=4||P++}if(m!=4)return;break}if(U()==":"){if(M++,!U())return}else if(U())return;I[P++]=u}else{if(B!==null)return;M++,B=++P}}if(B!==null)for(S=P-B,P=7;P!=0&&S>0;)w=I[P],I[P--]=I[B+S-1],I[B+--S]=w;else if(P!=8)return;return I}(p0(e,1,-1)),!n))return zg;this.host=n}else if(this.isSpecial()){if(e=Pae(e),Wu(Kae,e)||(n=function(c){var u,h,m,_,y,S,w,I=jae(c,".");if(I.length&&I[I.length-1]==""&&I.length--,(u=I.length)>4)return c;for(h=[],m=0;m<u;m++){if((_=I[m])=="")return c;if(y=10,_.length>1&&Bl(_,0)=="0"&&(y=Wu(Gae,_)?16:8,_=p0(_,y==8?1:2)),_==="")S=0;else{if(!Wu(y==10?Hae:y==8?zae:HB,_))return c;S=lI(_,y)}My(h,S)}for(m=0;m<u;m++)if(S=h[m],m==u-1){if(S>=WB(256,5-u))return null}else if(S>255)return null;for(w=Vae(h),m=0;m<h.length;m++)w+=h[m]*WB(256,3-m);return w}(e),n===null))return zg;this.host=n}else{if(Wu(qae,e))return zg;for(n="",i=xy(e),o=0;o<i.length;o++)n+=$p(i[o],dI);this.host=n}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme=="file"},includesCredentials:function(){return this.username!=""||this.password!=""},isSpecial:function(){return kD(hI,this.scheme)},shortenPath:function(){var e=this.path,n=e.length;!n||this.scheme=="file"&&n==1&&g0(e[0],!0)||e.length--},serialize:function(){var e=this,n=e.scheme,i=e.username,o=e.password,c=e.host,u=e.port,h=e.path,m=e.query,_=e.fragment,y=n+":";return c!==null?(y+="//",e.includesCredentials()&&(y+=i+(o?":"+o:"")+"@"),y+=m0(c),u!==null&&(y+=":"+u)):n=="file"&&(y+="//"),y+=e.cannotBeABaseURL?h[0]:h.length?"/"+f0(h,"/"):"",m!==null&&(y+="?"+m),_!==null&&(y+="#"+_),y},setHref:function(e){var n=this.parse(e);if(n)throw LD(n);this.searchParams.update()},getOrigin:function(){var e=this.scheme,n=this.port;if(e=="blob")try{return new Vy(e.path[0]).origin}catch{return"null"}return e!="file"&&this.isSpecial()?e+"://"+m0(this.host)+(n!==null?":"+n:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(yf(e)+":",FD)},getUsername:function(){return this.username},setUsername:function(e){var n=xy(yf(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var i=0;i<n.length;i++)this.username+=$p(n[i],VD)}},getPassword:function(){return this.password},setPassword:function(e){var n=xy(yf(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var i=0;i<n.length;i++)this.password+=$p(n[i],VD)}},getHost:function(){var e=this.host,n=this.port;return e===null?"":n===null?m0(e):m0(e)+":"+n},setHost:function(e){this.cannotBeABaseURL||this.parse(e,WD)},getHostname:function(){var e=this.host;return e===null?"":m0(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,GD)},getPort:function(){var e=this.port;return e===null?"":yf(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||((e=yf(e))==""?this.port=null:this.parse(e,zD))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+f0(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,Uy))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){(e=yf(e))==""?this.query=null:(Bl(e,0)=="?"&&(e=p0(e,1)),this.query="",this.parse(e,Hg)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){(e=yf(e))!=""?(Bl(e,0)=="#"&&(e=p0(e,1)),this.fragment="",this.parse(e,vf)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var Vy=function(e){var n=Aae(this,Fa),i=kae(arguments.length,1)>1?arguments[1]:void 0,o=Dae(n,new qD(e,!1,i));PD||(n.href=o.serialize(),n.origin=o.getOrigin(),n.protocol=o.getProtocol(),n.username=o.getUsername(),n.password=o.getPassword(),n.host=o.getHost(),n.hostname=o.getHostname(),n.port=o.getPort(),n.pathname=o.getPathname(),n.search=o.getSearch(),n.searchParams=o.getSearchParams(),n.hash=o.getHash())},Fa=Vy.prototype,Wl=function(e,n){return{get:function(){return cI(this)[e]()},set:n&&function(i){return cI(this)[n](i)},configurable:!0,enumerable:!0}};if(PD&&(jl(Fa,"href",Wl("serialize","setHref")),jl(Fa,"origin",Wl("getOrigin")),jl(Fa,"protocol",Wl("getProtocol","setProtocol")),jl(Fa,"username",Wl("getUsername","setUsername")),jl(Fa,"password",Wl("getPassword","setPassword")),jl(Fa,"host",Wl("getHost","setHost")),jl(Fa,"hostname",Wl("getHostname","setHostname")),jl(Fa,"port",Wl("getPort","setPort")),jl(Fa,"pathname",Wl("getPathname","setPathname")),jl(Fa,"search",Wl("getSearch","setSearch")),jl(Fa,"searchParams",Wl("getSearchParams")),jl(Fa,"hash",Wl("getHash","setHash"))),aI(Fa,"toJSON",function(){return cI(this).serialize()},{enumerable:!0}),aI(Fa,"toString",function(){return cI(this).serialize()},{enumerable:!0}),h0){var n4=h0.createObjectURL,r4=h0.revokeObjectURL;n4&&aI(Vy,"createObjectURL",FB(n4,h0)),r4&&aI(Vy,"revokeObjectURL",FB(r4,h0))}Nae(Vy,"URL"),Cae({global:!0,forced:!Iae,sham:!PD},{URL:Vy});var Qae=Dn,Zae=d,ece=Jc,i4=na,tce=mD,s4=rn("URL");Qae({target:"URL",stat:!0,forced:!(tce&&Zae(function(){s4.canParse()}))},{canParse:function(e){var n=ece(arguments.length,1),i=i4(e),o=n<2||arguments[1]===void 0?void 0:i4(arguments[1]);try{return!!new s4(i,o)}catch{return!1}}});var mI=l(mt.URL);let o4=!0,a4=!0;function gI(e,n,i){const o=e.match(n);return o&&o.length>=i&&parseInt(o[i],10)}function Kg(e,n,i){if(!e.RTCPeerConnection)return;const o=e.RTCPeerConnection.prototype,c=o.addEventListener;o.addEventListener=function(h,m){if(h!==n)return c.apply(this,arguments);const _=y=>{const S=i(y);S&&(m.handleEvent?m.handleEvent(S):m(S))};return this._eventMap=this._eventMap||{},this._eventMap[n]||(this._eventMap[n]=new Map),this._eventMap[n].set(m,_),c.apply(this,[h,_])};const u=o.removeEventListener;o.removeEventListener=function(h,m){if(h!==n||!this._eventMap||!this._eventMap[n])return u.apply(this,arguments);if(!this._eventMap[n].has(m))return u.apply(this,arguments);const _=this._eventMap[n].get(m);return this._eventMap[n].delete(m),this._eventMap[n].size===0&&delete this._eventMap[n],Object.keys(this._eventMap).length===0&&delete this._eventMap,u.apply(this,[h,_])},Object.defineProperty(o,"on"+n,{get(){return this["_on"+n]},set(h){this["_on"+n]&&(this.removeEventListener(n,this["_on"+n]),delete this["_on"+n]),h&&this.addEventListener(n,this["_on"+n]=h)},enumerable:!0,configurable:!0})}function nce(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(o4=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function rce(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(a4=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function c4(){if(typeof window=="object"){if(o4)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function $D(e,n){a4&&console.warn(e+" is deprecated, please use "+n+" instead.")}function l4(e){return Object.prototype.toString.call(e)==="[object Object]"}function u4(e){var n;return l4(e)?Da(n=Object.keys(e)).call(n,function(i,o){const c=l4(e[o]),u=c?u4(e[o]):e[o],h=c&&!Object.keys(u).length;return u===void 0||h?i:Object.assign(i,{[o]:u})},{}):e}function YD(e,n,i){n&&!i.has(n.id)&&(i.set(n.id,n),Object.keys(n).forEach(o=>{o.endsWith("Id")?YD(e,e.get(n[o]),i):o.endsWith("Ids")&&n[o].forEach(c=>{YD(e,e.get(c),i)})}))}function d4(e,n,i){const o=i?"outbound-rtp":"inbound-rtp",c=new Map;if(n===null)return c;const u=[];return e.forEach(h=>{h.type==="track"&&h.trackIdentifier===n.id&&u.push(h)}),u.forEach(h=>{e.forEach(m=>{m.type===o&&m.trackId===h.id&&YD(e,m,c)})}),c}const h4=c4;function f4(e,n){const i=e&&e.navigator;if(!i.mediaDevices)return;const o=function(h){if(typeof h!="object"||h.mandatory||h.optional)return h;const m={};return Object.keys(h).forEach(_=>{if(_==="require"||_==="advanced"||_==="mediaSource")return;const y=typeof h[_]=="object"?h[_]:{ideal:h[_]};y.exact!==void 0&&typeof y.exact=="number"&&(y.min=y.max=y.exact);const S=function(w,I){return w?w+I.charAt(0).toUpperCase()+I.slice(1):I==="deviceId"?"sourceId":I};if(y.ideal!==void 0){m.optional=m.optional||[];let w={};typeof y.ideal=="number"?(w[S("min",_)]=y.ideal,m.optional.push(w),w={},w[S("max",_)]=y.ideal,m.optional.push(w)):(w[S("",_)]=y.ideal,m.optional.push(w))}y.exact!==void 0&&typeof y.exact!="number"?(m.mandatory=m.mandatory||{},m.mandatory[S("",_)]=y.exact):["min","max"].forEach(w=>{y[w]!==void 0&&(m.mandatory=m.mandatory||{},m.mandatory[S(w,_)]=y[w])})}),h.advanced&&(m.optional=(m.optional||[]).concat(h.advanced)),m},c=function(h,m){if(n.version>=61)return m(h);if((h=JSON.parse(JSON.stringify(h)))&&typeof h.audio=="object"){const _=function(y,S,w){S in y&&!(w in y)&&(y[w]=y[S],delete y[S])};_((h=JSON.parse(JSON.stringify(h))).audio,"autoGainControl","googAutoGainControl"),_(h.audio,"noiseSuppression","googNoiseSuppression"),h.audio=o(h.audio)}if(h&&typeof h.video=="object"){let _=h.video.facingMode;_=_&&(typeof _=="object"?_:{ideal:_});const y=n.version<66;if(_&&(_.exact==="user"||_.exact==="environment"||_.ideal==="user"||_.ideal==="environment")&&(!i.mediaDevices.getSupportedConstraints||!i.mediaDevices.getSupportedConstraints().facingMode||y)){let S;if(delete h.video.facingMode,_.exact==="environment"||_.ideal==="environment"?S=["back","rear"]:_.exact!=="user"&&_.ideal!=="user"||(S=["front"]),S)return i.mediaDevices.enumerateDevices().then(w=>{let I=(w=w.filter(P=>P.kind==="videoinput")).find(P=>S.some(B=>{var M;return Xe(M=P.label.toLowerCase()).call(M,B)}));return!I&&w.length&&Xe(S).call(S,"back")&&(I=w[w.length-1]),I&&(h.video.deviceId=_.exact?{exact:I.deviceId}:{ideal:I.deviceId}),h.video=o(h.video),h4("chrome: "+JSON.stringify(h)),m(h)})}h.video=o(h.video)}return h4("chrome: "+JSON.stringify(h)),m(h)},u=function(h){return n.version>=64?h:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[h.name]||h.name,message:h.message,constraint:h.constraint||h.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(i.getUserMedia=(function(h,m,_){c(h,y=>{i.webkitGetUserMedia(y,m,S=>{_&&_(u(S))})})}).bind(i),i.mediaDevices.getUserMedia){const h=i.mediaDevices.getUserMedia.bind(i.mediaDevices);i.mediaDevices.getUserMedia=function(m){return c(m,_=>h(_).then(y=>{if(_.audio&&!y.getAudioTracks().length||_.video&&!y.getVideoTracks().length)throw y.getTracks().forEach(S=>{S.stop()}),new DOMException("","NotFoundError");return y},y=>tt.reject(u(y))))}}}function p4(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function m4(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(i){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=i)},enumerable:!0,configurable:!0});const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=i=>{i.stream.addEventListener("addtrack",o=>{let c;c=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===o.track.id):{track:o.track};const u=new Event("track");u.track=o.track,u.receiver=c,u.transceiver={receiver:c},u.streams=[i.stream],this.dispatchEvent(u)}),i.stream.getTracks().forEach(o=>{let c;c=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===o.id):{track:o};const u=new Event("track");u.track=o,u.receiver=c,u.transceiver={receiver:c},u.streams=[i.stream],this.dispatchEvent(u)})},this.addEventListener("addstream",this._ontrackpoly)),n.apply(this,arguments)}}else Kg(e,"track",n=>(n.transceiver||Object.defineProperty(n,"transceiver",{value:{receiver:n.receiver}}),n))}function g4(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const n=function(c,u){return{track:u,get dtmf(){return this._dtmf===void 0&&(u.kind==="audio"?this._dtmf=c.createDTMFSender(u):this._dtmf=null),this._dtmf},_pc:c}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const c=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(h,m){let _=c.apply(this,arguments);return _||(_=n(this,h),this._senders.push(_)),_};const u=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(h){u.apply(this,arguments);const m=this._senders.indexOf(h);m!==-1&&this._senders.splice(m,1)}}const i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(c){this._senders=this._senders||[],i.apply(this,[c]),c.getTracks().forEach(u=>{this._senders.push(n(this,u))})};const o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(c){this._senders=this._senders||[],o.apply(this,[c]),c.getTracks().forEach(u=>{const h=this._senders.find(m=>m.track===u);h&&this._senders.splice(this._senders.indexOf(h),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const n=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const i=n.apply(this,[]);return i.forEach(o=>o._pc=this),i},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function _4(e){if(!e.RTCPeerConnection)return;const n=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[i,o,c]=arguments;if(arguments.length>0&&typeof i=="function")return n.apply(this,arguments);if(n.length===0&&(arguments.length===0||typeof i!="function"))return n.apply(this,[]);const u=function(m){const _={};return m.result().forEach(y=>{const S={id:y.id,timestamp:y.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[y.type]||y.type};y.names().forEach(w=>{S[w]=y.stat(w)}),_[S.id]=S}),_},h=function(m){return new Map(Object.keys(m).map(_=>[_,m[_]]))};if(arguments.length>=2){const m=function(_){o(h(u(_)))};return n.apply(this,[m,i])}return new tt((m,_)=>{n.apply(this,[function(y){m(h(u(y)))},_])}).then(o,c)}}function E4(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const i=e.RTCPeerConnection.prototype.getSenders;i&&(e.RTCPeerConnection.prototype.getSenders=function(){const c=i.apply(this,[]);return c.forEach(u=>u._pc=this),c});const o=e.RTCPeerConnection.prototype.addTrack;o&&(e.RTCPeerConnection.prototype.addTrack=function(){const c=o.apply(this,arguments);return c._pc=this,c}),e.RTCRtpSender.prototype.getStats=function(){const c=this;return this._pc.getStats().then(u=>d4(u,c.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const i=e.RTCPeerConnection.prototype.getReceivers;i&&(e.RTCPeerConnection.prototype.getReceivers=function(){const o=i.apply(this,[]);return o.forEach(c=>c._pc=this),o}),Kg(e,"track",o=>(o.receiver._pc=o.srcElement,o)),e.RTCRtpReceiver.prototype.getStats=function(){const o=this;return this._pc.getStats().then(c=>d4(c,o.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const n=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const i=arguments[0];let o,c,u;return this.getSenders().forEach(h=>{h.track===i&&(o?u=!0:o=h)}),this.getReceivers().forEach(h=>(h.track===i&&(c?u=!0:c=h),h.track===i)),u||o&&c?tt.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):o?o.getStats():c?c.getStats():tt.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return n.apply(this,arguments)}}function y4(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(u=>this._shimmedLocalStreams[u][0])};const n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(u,h){if(!h)return n.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const m=n.apply(this,arguments);return this._shimmedLocalStreams[h.id]?this._shimmedLocalStreams[h.id].indexOf(m)===-1&&this._shimmedLocalStreams[h.id].push(m):this._shimmedLocalStreams[h.id]=[h,m],m};const i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(u){this._shimmedLocalStreams=this._shimmedLocalStreams||{},u.getTracks().forEach(_=>{if(this.getSenders().find(S=>S.track===_))throw new DOMException("Track already exists.","InvalidAccessError")});const h=this.getSenders();i.apply(this,arguments);const m=this.getSenders().filter(_=>h.indexOf(_)===-1);this._shimmedLocalStreams[u.id]=[u].concat(m)};const o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(u){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[u.id],o.apply(this,arguments)};const c=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(u){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},u&&Object.keys(this._shimmedLocalStreams).forEach(h=>{const m=this._shimmedLocalStreams[h].indexOf(u);m!==-1&&this._shimmedLocalStreams[h].splice(m,1),this._shimmedLocalStreams[h].length===1&&delete this._shimmedLocalStreams[h]}),c.apply(this,arguments)}}function v4(e,n){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&n.version>=65)return y4(e);const i=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const _=i.apply(this);return this._reverseStreams=this._reverseStreams||{},_.map(y=>this._reverseStreams[y.id])};const o=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(_){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},_.getTracks().forEach(y=>{if(this.getSenders().find(w=>w.track===y))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[_.id]){const y=new e.MediaStream(_.getTracks());this._streams[_.id]=y,this._reverseStreams[y.id]=_,_=y}o.apply(this,[_])};const c=e.RTCPeerConnection.prototype.removeStream;function u(_,y){let S=y.sdp;return Object.keys(_._reverseStreams||[]).forEach(w=>{const I=_._reverseStreams[w],P=_._streams[I.id];S=S.replace(new RegExp(P.id,"g"),I.id)}),new RTCSessionDescription({type:y.type,sdp:S})}e.RTCPeerConnection.prototype.removeStream=function(_){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},c.apply(this,[this._streams[_.id]||_]),delete this._reverseStreams[this._streams[_.id]?this._streams[_.id].id:_.id],delete this._streams[_.id]},e.RTCPeerConnection.prototype.addTrack=function(_,y){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const S=[].slice.call(arguments,1);if(S.length!==1||!S[0].getTracks().find(P=>P===_))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(P=>P.track===_))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const I=this._streams[y.id];if(I)I.addTrack(_),tt.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const P=new e.MediaStream([_]);this._streams[y.id]=P,this._reverseStreams[P.id]=y,this.addStream(P)}return this.getSenders().find(P=>P.track===_)},["createOffer","createAnswer"].forEach(function(_){const y=e.RTCPeerConnection.prototype[_],S={[_](){const w=arguments;return arguments.length&&typeof arguments[0]=="function"?y.apply(this,[I=>{const P=u(this,I);w[0].apply(null,[P])},I=>{w[1]&&w[1].apply(null,I)},arguments[2]]):y.apply(this,arguments).then(I=>u(this,I))}};e.RTCPeerConnection.prototype[_]=S[_]});const h=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(_,y){let S=y.sdp;return Object.keys(_._reverseStreams||[]).forEach(w=>{const I=_._reverseStreams[w],P=_._streams[I.id];S=S.replace(new RegExp(I.id,"g"),P.id)}),new RTCSessionDescription({type:y.type,sdp:S})}(this,arguments[0]),h.apply(this,arguments)):h.apply(this,arguments)};const m=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const _=m.get.apply(this);return _.type===""?_:u(this,_)}}),e.RTCPeerConnection.prototype.removeTrack=function(_){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!_._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(_._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let y;this._streams=this._streams||{},Object.keys(this._streams).forEach(S=>{this._streams[S].getTracks().find(w=>_.track===w)&&(y=this._streams[S])}),y&&(y.getTracks().length===1?this.removeStream(this._reverseStreams[y.id]):y.removeTrack(_.track),this.dispatchEvent(new Event("negotiationneeded")))}}function XD(e,n){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&n.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){const o=e.RTCPeerConnection.prototype[i],c={[i](){return arguments[0]=new(i==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),o.apply(this,arguments)}};e.RTCPeerConnection.prototype[i]=c[i]})}function S4(e,n){Kg(e,"negotiationneeded",i=>{const o=i.target;if(!(n.version<72||o.getConfiguration&&o.getConfiguration().sdpSemantics==="plan-b")||o.signalingState==="stable")return i})}var T4=Object.freeze({__proto__:null,fixNegotiationNeeded:S4,shimAddTrackRemoveTrack:v4,shimAddTrackRemoveTrackWithNative:y4,shimGetDisplayMedia:function(e,n){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(typeof n=="function"?e.navigator.mediaDevices.getDisplayMedia=function(i){return n(i).then(o=>{const c=i.video&&i.video.width,u=i.video&&i.video.height,h=i.video&&i.video.frameRate;return i.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:o,maxFrameRate:h||3}},c&&(i.video.mandatory.maxWidth=c),u&&(i.video.mandatory.maxHeight=u),e.navigator.mediaDevices.getUserMedia(i)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:g4,shimGetStats:_4,shimGetUserMedia:f4,shimMediaStream:p4,shimOnTrack:m4,shimPeerConnection:XD,shimSenderReceiverGetStats:E4});function b4(e,n){const i=e&&e.navigator,o=e&&e.MediaStreamTrack;if(i.getUserMedia=function(c,u,h){$D("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),i.mediaDevices.getUserMedia(c).then(u,h)},!(n.version>55&&"autoGainControl"in i.mediaDevices.getSupportedConstraints())){const c=function(h,m,_){m in h&&!(_ in h)&&(h[_]=h[m],delete h[m])},u=i.mediaDevices.getUserMedia.bind(i.mediaDevices);if(i.mediaDevices.getUserMedia=function(h){return typeof h=="object"&&typeof h.audio=="object"&&(h=JSON.parse(JSON.stringify(h)),c(h.audio,"autoGainControl","mozAutoGainControl"),c(h.audio,"noiseSuppression","mozNoiseSuppression")),u(h)},o&&o.prototype.getSettings){const h=o.prototype.getSettings;o.prototype.getSettings=function(){const m=h.apply(this,arguments);return c(m,"mozAutoGainControl","autoGainControl"),c(m,"mozNoiseSuppression","noiseSuppression"),m}}if(o&&o.prototype.applyConstraints){const h=o.prototype.applyConstraints;o.prototype.applyConstraints=function(m){return this.kind==="audio"&&typeof m=="object"&&(m=JSON.parse(JSON.stringify(m)),c(m,"autoGainControl","mozAutoGainControl"),c(m,"noiseSuppression","mozNoiseSuppression")),h.apply(this,[m])}}}}function w4(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function JD(e,n){if(typeof e!="object"||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),n.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(c){const u=e.RTCPeerConnection.prototype[c],h={[c](){return arguments[0]=new(c==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),u.apply(this,arguments)}};e.RTCPeerConnection.prototype[c]=h[c]});const i={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},o=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[c,u,h]=arguments;return o.apply(this,[c||null]).then(m=>{if(n.version<53&&!u)try{m.forEach(_=>{_.type=i[_.type]||_.type})}catch(_){if(_.name!=="TypeError")throw _;m.forEach((y,S)=>{m.set(S,Object.assign({},y,{type:i[y.type]||y.type}))})}return m}).then(u,h)}}function R4(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const n=e.RTCPeerConnection.prototype.getSenders;n&&(e.RTCPeerConnection.prototype.getSenders=function(){const o=n.apply(this,[]);return o.forEach(c=>c._pc=this),o});const i=e.RTCPeerConnection.prototype.addTrack;i&&(e.RTCPeerConnection.prototype.addTrack=function(){const o=i.apply(this,arguments);return o._pc=this,o}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):tt.resolve(new Map)}}function C4(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const n=e.RTCPeerConnection.prototype.getReceivers;n&&(e.RTCPeerConnection.prototype.getReceivers=function(){const i=n.apply(this,[]);return i.forEach(o=>o._pc=this),i}),Kg(e,"track",i=>(i.receiver._pc=i.srcElement,i)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function I4(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(n){$D("removeStream","removeTrack"),this.getSenders().forEach(i=>{var o;i.track&&Xe(o=n.getTracks()).call(o,i.track)&&this.removeTrack(i)})})}function A4(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function O4(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const n=e.RTCPeerConnection.prototype.addTransceiver;n&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let i=arguments[1]&&arguments[1].sendEncodings;i===void 0&&(i=[]),i=[...i];const o=i.length>0;o&&i.forEach(u=>{if("rid"in u&&!/^[a-z0-9]{0,16}$/i.test(u.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in u&&!(parseFloat(u.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in u&&!(parseFloat(u.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const c=n.apply(this,arguments);if(o){const{sender:u}=c,h=u.getParameters();(!("encodings"in h)||h.encodings.length===1&&Object.keys(h.encodings[0]).length===0)&&(h.encodings=i,u.sendEncodings=i,this.setParametersPromises.push(u.setParameters(h).then(()=>{delete u.sendEncodings}).catch(()=>{delete u.sendEncodings})))}return c})}function P4(e){if(typeof e!="object"||!e.RTCRtpSender)return;const n=e.RTCRtpSender.prototype.getParameters;n&&(e.RTCRtpSender.prototype.getParameters=function(){const i=n.apply(this,arguments);return"encodings"in i||(i.encodings=[].concat(this.sendEncodings||[{}])),i})}function N4(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const n=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?tt.all(this.setParametersPromises).then(()=>n.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):n.apply(this,arguments)}}function k4(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const n=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?tt.all(this.setParametersPromises).then(()=>n.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):n.apply(this,arguments)}}var D4=Object.freeze({__proto__:null,shimAddTransceiver:O4,shimCreateAnswer:k4,shimCreateOffer:N4,shimGetDisplayMedia:function(e,n){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(i){if(!i||!i.video){const o=new DOMException("getDisplayMedia without video constraints is undefined");return o.name="NotFoundError",o.code=8,tt.reject(o)}return i.video===!0?i.video={mediaSource:n}:i.video.mediaSource=n,e.navigator.mediaDevices.getUserMedia(i)})},shimGetParameters:P4,shimGetUserMedia:b4,shimOnTrack:w4,shimPeerConnection:JD,shimRTCDataChannel:A4,shimReceiverGetStats:C4,shimRemoveStream:I4,shimSenderGetStats:R4});function L4(e){if(typeof e=="object"&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(i){var o;this._localStreams||(this._localStreams=[]),Xe(o=this._localStreams).call(o,i)||this._localStreams.push(i),i.getAudioTracks().forEach(c=>n.call(this,c,i)),i.getVideoTracks().forEach(c=>n.call(this,c,i))},e.RTCPeerConnection.prototype.addTrack=function(i){for(var o=arguments.length,c=new Array(o>1?o-1:0),u=1;u<o;u++)c[u-1]=arguments[u];return c&&c.forEach(h=>{var m;this._localStreams?Xe(m=this._localStreams).call(m,h)||this._localStreams.push(h):this._localStreams=[h]}),n.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(n){this._localStreams||(this._localStreams=[]);const i=this._localStreams.indexOf(n);if(i===-1)return;this._localStreams.splice(i,1);const o=n.getTracks();this.getSenders().forEach(c=>{Xe(o).call(o,c.track)&&this.removeTrack(c)})})}}function x4(e){if(typeof e=="object"&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(i){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=i),this.addEventListener("track",this._onaddstreampoly=o=>{o.streams.forEach(c=>{var u;if(this._remoteStreams||(this._remoteStreams=[]),Xe(u=this._remoteStreams).call(u,c))return;this._remoteStreams.push(c);const h=new Event("addstream");h.stream=c,this.dispatchEvent(h)})})}});const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const i=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(o){o.streams.forEach(c=>{if(i._remoteStreams||(i._remoteStreams=[]),i._remoteStreams.indexOf(c)>=0)return;i._remoteStreams.push(c);const u=new Event("addstream");u.stream=c,i.dispatchEvent(u)})}),n.apply(i,arguments)}}}function M4(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const n=e.RTCPeerConnection.prototype,i=n.createOffer,o=n.createAnswer,c=n.setLocalDescription,u=n.setRemoteDescription,h=n.addIceCandidate;n.createOffer=function(_,y){const S=arguments.length>=2?arguments[2]:arguments[0],w=i.apply(this,[S]);return y?(w.then(_,y),tt.resolve()):w},n.createAnswer=function(_,y){const S=arguments.length>=2?arguments[2]:arguments[0],w=o.apply(this,[S]);return y?(w.then(_,y),tt.resolve()):w};let m=function(_,y,S){const w=c.apply(this,[_]);return S?(w.then(y,S),tt.resolve()):w};n.setLocalDescription=m,m=function(_,y,S){const w=u.apply(this,[_]);return S?(w.then(y,S),tt.resolve()):w},n.setRemoteDescription=m,m=function(_,y,S){const w=h.apply(this,[_]);return S?(w.then(y,S),tt.resolve()):w},n.addIceCandidate=m}function U4(e){const n=e&&e.navigator;if(n.mediaDevices&&n.mediaDevices.getUserMedia){const i=n.mediaDevices,o=i.getUserMedia.bind(i);n.mediaDevices.getUserMedia=c=>o(V4(c))}!n.getUserMedia&&n.mediaDevices&&n.mediaDevices.getUserMedia&&(n.getUserMedia=(function(i,o,c){n.mediaDevices.getUserMedia(i).then(o,c)}).bind(n))}function V4(e){return e&&e.video!==void 0?Object.assign({},e,{video:u4(e.video)}):e}function F4(e){if(!e.RTCPeerConnection)return;const n=e.RTCPeerConnection;e.RTCPeerConnection=function(i,o){if(i&&i.iceServers){const c=[];for(let u=0;u<i.iceServers.length;u++){let h=i.iceServers[u];!h.hasOwnProperty("urls")&&h.hasOwnProperty("url")?($D("RTCIceServer.url","RTCIceServer.urls"),h=JSON.parse(JSON.stringify(h)),h.urls=h.url,delete h.url,c.push(h)):c.push(i.iceServers[u])}i.iceServers=c}return new n(i,o)},e.RTCPeerConnection.prototype=n.prototype,"generateCertificate"in n&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>n.generateCertificate})}function j4(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function B4(e){const n=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(i){if(i){i.offerToReceiveAudio!==void 0&&(i.offerToReceiveAudio=!!i.offerToReceiveAudio);const o=this.getTransceivers().find(u=>u.receiver.track.kind==="audio");i.offerToReceiveAudio===!1&&o?o.direction==="sendrecv"?o.setDirection?o.setDirection("sendonly"):o.direction="sendonly":o.direction==="recvonly"&&(o.setDirection?o.setDirection("inactive"):o.direction="inactive"):i.offerToReceiveAudio!==!0||o||this.addTransceiver("audio",{direction:"recvonly"}),i.offerToReceiveVideo!==void 0&&(i.offerToReceiveVideo=!!i.offerToReceiveVideo);const c=this.getTransceivers().find(u=>u.receiver.track.kind==="video");i.offerToReceiveVideo===!1&&c?c.direction==="sendrecv"?c.setDirection?c.setDirection("sendonly"):c.direction="sendonly":c.direction==="recvonly"&&(c.setDirection?c.setDirection("inactive"):c.direction="inactive"):i.offerToReceiveVideo!==!0||c||this.addTransceiver("video",{direction:"recvonly"})}return n.apply(this,arguments)}}function W4(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var G4=Object.freeze({__proto__:null,shimAudioContext:W4,shimCallbacksAPI:M4,shimConstraints:V4,shimCreateOfferLegacy:B4,shimGetUserMedia:U4,shimLocalStreamsAPI:L4,shimRTCIceServerUrls:F4,shimRemoteStreamsAPI:x4,shimTrackEventTransceiver:j4}),z4=`	
\v\f\r \u2028\u2029\uFEFF`,ice=Zt,sce=na,QD=z4,H4=O("".replace),oce=RegExp("^["+QD+"]+"),ace=RegExp("(^|[^"+QD+"])["+QD+"]+$"),cce=function(e){return function(n){var i=sce(ice(n));return 1&e&&(i=H4(i,oce,"")),2&e&&(i=H4(i,ace,"$1")),i}},lce={trim:cce(3)},uce=bC.PROPER,dce=d,K4=z4,hce=lce.trim;Dn({target:"String",proto:!0,forced:function(e){return dce(function(){return!!K4[e]()||""[e]()!==""||uce&&K4[e].name!==e})}("trim")},{trim:function(){return hce(this)}});var fce=ka("String").trim,pce=N,mce=fce,ZD=String.prototype,gce=function(e){var n=e.trim;return typeof e=="string"||e===ZD||pce(ZD,e)&&n===ZD.trim?mce:n},Gs=l(gce),q4={exports:{}};(function(e){const n={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};n.localCName=n.generateIdentifier(),n.splitLines=function(i){return i.trim().split(`
`).map(o=>o.trim())},n.splitSections=function(i){return i.split(`
m=`).map((o,c)=>(c>0?"m="+o:o).trim()+`\r
`)},n.getDescription=function(i){const o=n.splitSections(i);return o&&o[0]},n.getMediaSections=function(i){const o=n.splitSections(i);return o.shift(),o},n.matchPrefix=function(i,o){return n.splitLines(i).filter(c=>c.indexOf(o)===0)},n.parseCandidate=function(i){let o;o=i.indexOf("a=candidate:")===0?i.substring(12).split(" "):i.substring(10).split(" ");const c={foundation:o[0],component:{1:"rtp",2:"rtcp"}[o[1]]||o[1],protocol:o[2].toLowerCase(),priority:parseInt(o[3],10),ip:o[4],address:o[4],port:parseInt(o[5],10),type:o[7]};for(let u=8;u<o.length;u+=2)switch(o[u]){case"raddr":c.relatedAddress=o[u+1];break;case"rport":c.relatedPort=parseInt(o[u+1],10);break;case"tcptype":c.tcpType=o[u+1];break;case"ufrag":c.ufrag=o[u+1],c.usernameFragment=o[u+1];break;default:c[o[u]]===void 0&&(c[o[u]]=o[u+1])}return c},n.writeCandidate=function(i){const o=[];o.push(i.foundation);const c=i.component;c==="rtp"?o.push(1):c==="rtcp"?o.push(2):o.push(c),o.push(i.protocol.toUpperCase()),o.push(i.priority),o.push(i.address||i.ip),o.push(i.port);const u=i.type;return o.push("typ"),o.push(u),u!=="host"&&i.relatedAddress&&i.relatedPort&&(o.push("raddr"),o.push(i.relatedAddress),o.push("rport"),o.push(i.relatedPort)),i.tcpType&&i.protocol.toLowerCase()==="tcp"&&(o.push("tcptype"),o.push(i.tcpType)),(i.usernameFragment||i.ufrag)&&(o.push("ufrag"),o.push(i.usernameFragment||i.ufrag)),"candidate:"+o.join(" ")},n.parseIceOptions=function(i){return i.substring(14).split(" ")},n.parseRtpMap=function(i){let o=i.substring(9).split(" ");const c={payloadType:parseInt(o.shift(),10)};return o=o[0].split("/"),c.name=o[0],c.clockRate=parseInt(o[1],10),c.channels=o.length===3?parseInt(o[2],10):1,c.numChannels=c.channels,c},n.writeRtpMap=function(i){let o=i.payloadType;i.preferredPayloadType!==void 0&&(o=i.preferredPayloadType);const c=i.channels||i.numChannels||1;return"a=rtpmap:"+o+" "+i.name+"/"+i.clockRate+(c!==1?"/"+c:"")+`\r
`},n.parseExtmap=function(i){const o=i.substring(9).split(" ");return{id:parseInt(o[0],10),direction:o[0].indexOf("/")>0?o[0].split("/")[1]:"sendrecv",uri:o[1],attributes:o.slice(2).join(" ")}},n.writeExtmap=function(i){return"a=extmap:"+(i.id||i.preferredId)+(i.direction&&i.direction!=="sendrecv"?"/"+i.direction:"")+" "+i.uri+(i.attributes?" "+i.attributes:"")+`\r
`},n.parseFmtp=function(i){const o={};let c;const u=i.substring(i.indexOf(" ")+1).split(";");for(let h=0;h<u.length;h++)c=u[h].trim().split("="),o[c[0].trim()]=c[1];return o},n.writeFmtp=function(i){let o="",c=i.payloadType;if(i.preferredPayloadType!==void 0&&(c=i.preferredPayloadType),i.parameters&&Object.keys(i.parameters).length){const u=[];Object.keys(i.parameters).forEach(h=>{i.parameters[h]!==void 0?u.push(h+"="+i.parameters[h]):u.push(h)}),o+="a=fmtp:"+c+" "+u.join(";")+`\r
`}return o},n.parseRtcpFb=function(i){const o=i.substring(i.indexOf(" ")+1).split(" ");return{type:o.shift(),parameter:o.join(" ")}},n.writeRtcpFb=function(i){let o="",c=i.payloadType;return i.preferredPayloadType!==void 0&&(c=i.preferredPayloadType),i.rtcpFeedback&&i.rtcpFeedback.length&&i.rtcpFeedback.forEach(u=>{o+="a=rtcp-fb:"+c+" "+u.type+(u.parameter&&u.parameter.length?" "+u.parameter:"")+`\r
`}),o},n.parseSsrcMedia=function(i){const o=i.indexOf(" "),c={ssrc:parseInt(i.substring(7,o),10)},u=i.indexOf(":",o);return u>-1?(c.attribute=i.substring(o+1,u),c.value=i.substring(u+1)):c.attribute=i.substring(o+1),c},n.parseSsrcGroup=function(i){const o=i.substring(13).split(" ");return{semantics:o.shift(),ssrcs:o.map(c=>parseInt(c,10))}},n.getMid=function(i){const o=n.matchPrefix(i,"a=mid:")[0];if(o)return o.substring(6)},n.parseFingerprint=function(i){const o=i.substring(14).split(" ");return{algorithm:o[0].toLowerCase(),value:o[1].toUpperCase()}},n.getDtlsParameters=function(i,o){return{role:"auto",fingerprints:n.matchPrefix(i+o,"a=fingerprint:").map(n.parseFingerprint)}},n.writeDtlsParameters=function(i,o){let c="a=setup:"+o+`\r
`;return i.fingerprints.forEach(u=>{c+="a=fingerprint:"+u.algorithm+" "+u.value+`\r
`}),c},n.parseCryptoLine=function(i){const o=i.substring(9).split(" ");return{tag:parseInt(o[0],10),cryptoSuite:o[1],keyParams:o[2],sessionParams:o.slice(3)}},n.writeCryptoLine=function(i){return"a=crypto:"+i.tag+" "+i.cryptoSuite+" "+(typeof i.keyParams=="object"?n.writeCryptoKeyParams(i.keyParams):i.keyParams)+(i.sessionParams?" "+i.sessionParams.join(" "):"")+`\r
`},n.parseCryptoKeyParams=function(i){if(i.indexOf("inline:")!==0)return null;const o=i.substring(7).split("|");return{keyMethod:"inline",keySalt:o[0],lifeTime:o[1],mkiValue:o[2]?o[2].split(":")[0]:void 0,mkiLength:o[2]?o[2].split(":")[1]:void 0}},n.writeCryptoKeyParams=function(i){return i.keyMethod+":"+i.keySalt+(i.lifeTime?"|"+i.lifeTime:"")+(i.mkiValue&&i.mkiLength?"|"+i.mkiValue+":"+i.mkiLength:"")},n.getCryptoParameters=function(i,o){return n.matchPrefix(i+o,"a=crypto:").map(n.parseCryptoLine)},n.getIceParameters=function(i,o){const c=n.matchPrefix(i+o,"a=ice-ufrag:")[0],u=n.matchPrefix(i+o,"a=ice-pwd:")[0];return c&&u?{usernameFragment:c.substring(12),password:u.substring(10)}:null},n.writeIceParameters=function(i){let o="a=ice-ufrag:"+i.usernameFragment+`\r
a=ice-pwd:`+i.password+`\r
`;return i.iceLite&&(o+=`a=ice-lite\r
`),o},n.parseRtpParameters=function(i){const o={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},c=n.splitLines(i)[0].split(" ");o.profile=c[2];for(let h=3;h<c.length;h++){const m=c[h],_=n.matchPrefix(i,"a=rtpmap:"+m+" ")[0];if(_){const y=n.parseRtpMap(_),S=n.matchPrefix(i,"a=fmtp:"+m+" ");switch(y.parameters=S.length?n.parseFmtp(S[0]):{},y.rtcpFeedback=n.matchPrefix(i,"a=rtcp-fb:"+m+" ").map(n.parseRtcpFb),o.codecs.push(y),y.name.toUpperCase()){case"RED":case"ULPFEC":o.fecMechanisms.push(y.name.toUpperCase())}}}n.matchPrefix(i,"a=extmap:").forEach(h=>{o.headerExtensions.push(n.parseExtmap(h))});const u=n.matchPrefix(i,"a=rtcp-fb:* ").map(n.parseRtcpFb);return o.codecs.forEach(h=>{u.forEach(m=>{h.rtcpFeedback.find(_=>_.type===m.type&&_.parameter===m.parameter)||h.rtcpFeedback.push(m)})}),o},n.writeRtpDescription=function(i,o){let c="";c+="m="+i+" ",c+=o.codecs.length>0?"9":"0",c+=" "+(o.profile||"UDP/TLS/RTP/SAVPF")+" ",c+=o.codecs.map(h=>h.preferredPayloadType!==void 0?h.preferredPayloadType:h.payloadType).join(" ")+`\r
`,c+=`c=IN IP4 0.0.0.0\r
`,c+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,o.codecs.forEach(h=>{c+=n.writeRtpMap(h),c+=n.writeFmtp(h),c+=n.writeRtcpFb(h)});let u=0;return o.codecs.forEach(h=>{h.maxptime>u&&(u=h.maxptime)}),u>0&&(c+="a=maxptime:"+u+`\r
`),o.headerExtensions&&o.headerExtensions.forEach(h=>{c+=n.writeExtmap(h)}),c},n.parseRtpEncodingParameters=function(i){const o=[],c=n.parseRtpParameters(i),u=c.fecMechanisms.indexOf("RED")!==-1,h=c.fecMechanisms.indexOf("ULPFEC")!==-1,m=n.matchPrefix(i,"a=ssrc:").map(I=>n.parseSsrcMedia(I)).filter(I=>I.attribute==="cname"),_=m.length>0&&m[0].ssrc;let y;const S=n.matchPrefix(i,"a=ssrc-group:FID").map(I=>I.substring(17).split(" ").map(P=>parseInt(P,10)));S.length>0&&S[0].length>1&&S[0][0]===_&&(y=S[0][1]),c.codecs.forEach(I=>{if(I.name.toUpperCase()==="RTX"&&I.parameters.apt){let P={ssrc:_,codecPayloadType:parseInt(I.parameters.apt,10)};_&&y&&(P.rtx={ssrc:y}),o.push(P),u&&(P=JSON.parse(JSON.stringify(P)),P.fec={ssrc:_,mechanism:h?"red+ulpfec":"red"},o.push(P))}}),o.length===0&&_&&o.push({ssrc:_});let w=n.matchPrefix(i,"b=");return w.length&&(w=w[0].indexOf("b=TIAS:")===0?parseInt(w[0].substring(7),10):w[0].indexOf("b=AS:")===0?1e3*parseInt(w[0].substring(5),10)*.95-16e3:void 0,o.forEach(I=>{I.maxBitrate=w})),o},n.parseRtcpParameters=function(i){const o={},c=n.matchPrefix(i,"a=ssrc:").map(m=>n.parseSsrcMedia(m)).filter(m=>m.attribute==="cname")[0];c&&(o.cname=c.value,o.ssrc=c.ssrc);const u=n.matchPrefix(i,"a=rtcp-rsize");o.reducedSize=u.length>0,o.compound=u.length===0;const h=n.matchPrefix(i,"a=rtcp-mux");return o.mux=h.length>0,o},n.writeRtcpParameters=function(i){let o="";return i.reducedSize&&(o+=`a=rtcp-rsize\r
`),i.mux&&(o+=`a=rtcp-mux\r
`),i.ssrc!==void 0&&i.cname&&(o+="a=ssrc:"+i.ssrc+" cname:"+i.cname+`\r
`),o},n.parseMsid=function(i){let o;const c=n.matchPrefix(i,"a=msid:");if(c.length===1)return o=c[0].substring(7).split(" "),{stream:o[0],track:o[1]};const u=n.matchPrefix(i,"a=ssrc:").map(h=>n.parseSsrcMedia(h)).filter(h=>h.attribute==="msid");return u.length>0?(o=u[0].value.split(" "),{stream:o[0],track:o[1]}):void 0},n.parseSctpDescription=function(i){const o=n.parseMLine(i),c=n.matchPrefix(i,"a=max-message-size:");let u;c.length>0&&(u=parseInt(c[0].substring(19),10)),isNaN(u)&&(u=65536);const h=n.matchPrefix(i,"a=sctp-port:");if(h.length>0)return{port:parseInt(h[0].substring(12),10),protocol:o.fmt,maxMessageSize:u};const m=n.matchPrefix(i,"a=sctpmap:");if(m.length>0){const _=m[0].substring(10).split(" ");return{port:parseInt(_[0],10),protocol:_[1],maxMessageSize:u}}},n.writeSctpDescription=function(i,o){let c=[];return c=i.protocol!=="DTLS/SCTP"?["m="+i.kind+" 9 "+i.protocol+" "+o.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+o.port+`\r
`]:["m="+i.kind+" 9 "+i.protocol+" "+o.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+o.port+" "+o.protocol+` 65535\r
`],o.maxMessageSize!==void 0&&c.push("a=max-message-size:"+o.maxMessageSize+`\r
`),c.join("")},n.generateSessionId=function(){return Math.random().toString().substr(2,22)},n.writeSessionBoilerplate=function(i,o,c){let u;const h=o!==void 0?o:2;return u=i||n.generateSessionId(),`v=0\r
o=`+(c||"thisisadapterortc")+" "+u+" "+h+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},n.getDirection=function(i,o){const c=n.splitLines(i);for(let u=0;u<c.length;u++)switch(c[u]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return c[u].substring(2)}return o?n.getDirection(o):"sendrecv"},n.getKind=function(i){return n.splitLines(i)[0].split(" ")[0].substring(2)},n.isRejected=function(i){return i.split(" ",2)[1]==="0"},n.parseMLine=function(i){const o=n.splitLines(i)[0].substring(2).split(" ");return{kind:o[0],port:parseInt(o[1],10),protocol:o[2],fmt:o.slice(3).join(" ")}},n.parseOLine=function(i){const o=n.matchPrefix(i,"o=")[0].substring(2).split(" ");return{username:o[0],sessionId:o[1],sessionVersion:parseInt(o[2],10),netType:o[3],addressType:o[4],address:o[5]}},n.isValidSDP=function(i){if(typeof i!="string"||i.length===0)return!1;const o=n.splitLines(i);for(let c=0;c<o.length;c++)if(o[c].length<2||o[c].charAt(1)!=="=")return!1;return!0},e.exports=n})(q4);var $4=q4.exports,Fy=l($4),_ce=s({__proto__:null,default:Fy},[$4]);function _I(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const n=e.RTCIceCandidate;e.RTCIceCandidate=function(i){if(typeof i=="object"&&i.candidate&&i.candidate.indexOf("a=")===0&&((i=JSON.parse(JSON.stringify(i))).candidate=i.candidate.substr(2)),i.candidate&&i.candidate.length){const o=new n(i),c=Fy.parseCandidate(i.candidate),u=Object.assign(o,c);return u.toJSON=function(){return{candidate:u.candidate,sdpMid:u.sdpMid,sdpMLineIndex:u.sdpMLineIndex,usernameFragment:u.usernameFragment}},u}return new n(i)},e.RTCIceCandidate.prototype=n.prototype,Kg(e,"icecandidate",i=>(i.candidate&&Object.defineProperty(i,"candidate",{value:new e.RTCIceCandidate(i.candidate),writable:"false"}),i))}function e1(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||Kg(e,"icecandidate",n=>{if(n.candidate){const i=Fy.parseCandidate(n.candidate.candidate);i.type==="relay"&&(n.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[i.priority>>24])}return n})}function EI(e,n){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const i=function(m){if(!m||!m.sdp)return!1;const _=Fy.splitSections(m.sdp);return _.shift(),_.some(y=>{const S=Fy.parseMLine(y);return S&&S.kind==="application"&&S.protocol.indexOf("SCTP")!==-1})},o=function(m){const _=m.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(_===null||_.length<2)return-1;const y=parseInt(_[1],10);return y!=y?-1:y},c=function(m){let _=65536;return n.browser==="firefox"&&(_=n.version<57?m===-1?16384:2147483637:n.version<60?n.version===57?65535:65536:2147483637),_},u=function(m,_){let y=65536;n.browser==="firefox"&&n.version===57&&(y=65535);const S=Fy.matchPrefix(m.sdp,"a=max-message-size:");return S.length>0?y=parseInt(S[0].substr(19),10):n.browser==="firefox"&&_!==-1&&(y=2147483637),y},h=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,n.browser==="chrome"&&n.version>=76){const{sdpSemantics:m}=this.getConfiguration();m==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(i(arguments[0])){const m=o(arguments[0]),_=c(m),y=u(arguments[0],m);let S;S=_===0&&y===0?Number.POSITIVE_INFINITY:_===0||y===0?Math.max(_,y):Math.min(_,y);const w={};Object.defineProperty(w,"maxMessageSize",{get:()=>S}),this._sctp=w}return h.apply(this,arguments)}}function yI(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function n(o,c){const u=o.send;o.send=function(){const h=arguments[0],m=h.length||h.size||h.byteLength;if(o.readyState==="open"&&c.sctp&&m>c.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+c.sctp.maxMessageSize+" bytes)");return u.apply(o,arguments)}}const i=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const o=i.apply(this,arguments);return n(o,this),o},Kg(e,"datachannel",o=>(n(o.channel,o.target),o))}function t1(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype;Object.defineProperty(n,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(n,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(i){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),i&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=i)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(i=>{const o=n[i];n[i]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=c=>{const u=c.target;if(u._lastConnectionState!==u.connectionState){u._lastConnectionState=u.connectionState;const h=new Event("connectionstatechange",c);u.dispatchEvent(h)}return c},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),o.apply(this,arguments)}})}function n1(e,n){if(!e.RTCPeerConnection||n.browser==="chrome"&&n.version>=71||n.browser==="safari"&&n.version>=605)return;const i=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(o){if(o&&o.sdp&&o.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const c=o.sdp.split(`
`).filter(u=>Gs(u).call(u)!=="a=extmap-allow-mixed").join(`
`);e.RTCSessionDescription&&o instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:o.type,sdp:c}):o.sdp=c}return i.apply(this,arguments)}}function vI(e,n){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const i=e.RTCPeerConnection.prototype.addIceCandidate;i&&i.length!==0&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(n.browser==="chrome"&&n.version<78||n.browser==="firefox"&&n.version<68||n.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?tt.resolve():i.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),tt.resolve())})}function SI(e,n){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const i=e.RTCPeerConnection.prototype.setLocalDescription;i&&i.length!==0&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let o=arguments[0]||{};if(typeof o!="object"||o.type&&o.sdp)return i.apply(this,arguments);if(o={type:o.type,sdp:o.sdp},!o.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":o.type="offer";break;default:o.type="answer"}return o.sdp||o.type!=="offer"&&o.type!=="answer"?i.apply(this,[o]):(o.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(c=>i.apply(this,[c]))})}var Ece=Object.freeze({__proto__:null,removeExtmapAllowMixed:n1,shimAddIceCandidateNullOrEmpty:vI,shimConnectionState:t1,shimMaxMessageSize:EI,shimParameterlessSetLocalDescription:SI,shimRTCIceCandidate:_I,shimRTCIceCandidateRelayProtocol:e1,shimSendThrowTypeError:yI});(function(){let{window:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const i=c4,o=function(u){const h={browser:null,version:null};if(u===void 0||!u.navigator)return h.browser="Not a browser.",h;const{navigator:m}=u;if(m.mozGetUserMedia)h.browser="firefox",h.version=gI(m.userAgent,/Firefox\/(\d+)\./,1);else if(m.webkitGetUserMedia||u.isSecureContext===!1&&u.webkitRTCPeerConnection)h.browser="chrome",h.version=gI(m.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!u.RTCPeerConnection||!m.userAgent.match(/AppleWebKit\/(\d+)\./))return h.browser="Not a supported browser.",h;h.browser="safari",h.version=gI(m.userAgent,/AppleWebKit\/(\d+)\./,1),h.supportsUnifiedPlan=u.RTCRtpTransceiver&&"currentDirection"in u.RTCRtpTransceiver.prototype}return h}(e),c={browserDetails:o,commonShim:Ece,extractVersion:gI,disableLog:nce,disableWarnings:rce,sdp:_ce};switch(o.browser){case"chrome":if(!T4||!XD||!n.shimChrome)return i("Chrome shim is not included in this adapter release."),c;if(o.version===null)return i("Chrome shim can not determine version, not shimming."),c;i("adapter.js shimming chrome."),c.browserShim=T4,vI(e,o),SI(e),f4(e,o),p4(e),XD(e,o),m4(e),v4(e,o),g4(e),_4(e),E4(e),S4(e,o),_I(e),e1(e),t1(e),EI(e,o),yI(e),n1(e,o);break;case"firefox":if(!D4||!JD||!n.shimFirefox)return i("Firefox shim is not included in this adapter release."),c;i("adapter.js shimming firefox."),c.browserShim=D4,vI(e,o),SI(e),b4(e,o),JD(e,o),w4(e),I4(e),R4(e),C4(e),A4(e),O4(e),P4(e),N4(e),k4(e),_I(e),t1(e),EI(e,o),yI(e);break;case"safari":if(!G4||!n.shimSafari)return i("Safari shim is not included in this adapter release."),c;i("adapter.js shimming safari."),c.browserShim=G4,vI(e,o),SI(e),F4(e),B4(e),M4(e),L4(e),x4(e),j4(e),U4(e),W4(e),_I(e),e1(e),EI(e,o),yI(e),n1(e,o);break;default:i("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var Y4=Ja,yce=TypeError,X4=ur.match(/firefox\/(\d+)/i),vce=!!X4&&+X4[1],Sce=/MSIE|Trident/.test(ur),J4=ur.match(/AppleWebKit\/(\d+)\./),Tce=!!J4&&+J4[1],bce=Dn,Q4=O,wce=es,Rce=yo,Z4=ti,Cce=function(e,n){if(!delete e[n])throw yce("Cannot delete property "+Y4(n)+" of "+Y4(e))},e3=na,r1=d,Ice=uB,Ace=Xh,t3=vce,Oce=Sce,n3=li,r3=Tce,Yp=[],i3=Q4(Yp.sort),Pce=Q4(Yp.push),Nce=r1(function(){Yp.sort(void 0)}),kce=r1(function(){Yp.sort(null)}),Dce=Ace("sort"),s3=!r1(function(){if(n3)return n3<70;if(!(t3&&t3>3)){if(Oce)return!0;if(r3)return r3<603;var e,n,i,o,c="";for(e=65;e<76;e++){switch(n=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:i=3;break;case 68:case 71:i=4;break;default:i=2}for(o=0;o<47;o++)Yp.push({k:n+o,v:i})}for(Yp.sort(function(u,h){return h.v-u.v}),o=0;o<Yp.length;o++)n=Yp[o].k.charAt(0),c.charAt(c.length-1)!==n&&(c+=n);return c!=="DGBEFHACIJK"}});bce({target:"Array",proto:!0,forced:Nce||!kce||!Dce||!s3},{sort:function(e){e!==void 0&&wce(e);var n=Rce(this);if(s3)return e===void 0?i3(n):i3(n,e);var i,o,c=[],u=Z4(n);for(o=0;o<u;o++)o in n&&Pce(c,n[o]);for(Ice(c,function(h){return function(m,_){return _===void 0?-1:m===void 0?1:h!==void 0?+h(m,_)||0:e3(m)>e3(_)?1:-1}}(e)),i=Z4(c),o=0;o<i;)n[o]=c[o++];for(;o<u;)Cce(n,o++);return n}});var Lce=ka("Array").sort,xce=N,Mce=Lce,i1=Array.prototype,Uce=function(e){var n=e.sort;return e===i1||xce(i1,e)&&n===i1.sort?Mce:n},_0=l(Uce),s1=H;Dn({global:!0,forced:s1.globalThis!==s1},{globalThis:s1});var o3=l(H),o1={exports:{}};(function(e,n){(function(i,o){var c="function",u="undefined",h="object",m="string",_="major",y="model",S="name",w="type",I="vendor",P="version",B="architecture",M="console",U="mobile",q="tablet",$="smarttv",ae="wearable",me="embedded",ge="Amazon",pe="Apple",we="ASUS",Be="BlackBerry",nt="Browser",st="Chrome",pn="Firefox",mn="Google",sr="Huawei",Xr="LG",Fr="Microsoft",Wo="Motorola",ke="Opera",Ye="Samsung",ft="Sharp",xe="Sony",L="Xiaomi",te="Zebra",ce="Facebook",ze="Chromium OS",jt="Mac OS",Qn=function(gi){for(var ki={},gr=0;gr<gi.length;gr++)ki[gi[gr].toUpperCase()]=gi[gr];return ki},Ni=function(gi,ki){return typeof gi===m&&ma(ki).indexOf(ma(gi))!==-1},ma=function(gi){return gi.toLowerCase()},Uf=function(gi,ki){if(typeof gi===m)return gi=gi.replace(/^\s\s*/,""),typeof ki===u?gi:gi.substring(0,350)},b_=function(gi,ki){for(var gr,Wa,sh,Jr,Mn,ga,_m=0;_m<ki.length&&!Mn;){var nd=ki[_m],DK=ki[_m+1];for(gr=Wa=0;gr<nd.length&&!Mn&&nd[gr];)if(Mn=nd[gr++].exec(gi))for(sh=0;sh<DK.length;sh++)ga=Mn[++Wa],typeof(Jr=DK[sh])===h&&Jr.length>0?Jr.length===2?typeof Jr[1]==c?this[Jr[0]]=Jr[1].call(this,ga):this[Jr[0]]=Jr[1]:Jr.length===3?typeof Jr[1]!==c||Jr[1].exec&&Jr[1].test?this[Jr[0]]=ga?ga.replace(Jr[1],Jr[2]):o:this[Jr[0]]=ga?Jr[1].call(this,ga,Jr[2]):o:Jr.length===4&&(this[Jr[0]]=ga?Jr[3].call(this,ga.replace(Jr[1],Jr[2])):o):this[Jr]=ga||o;_m+=2}},vb=function(gi,ki){for(var gr in ki)if(typeof ki[gr]===h&&ki[gr].length>0){for(var Wa=0;Wa<ki[gr].length;Wa++)if(Ni(ki[gr][Wa],gi))return gr==="?"?o:gr}else if(Ni(ki[gr],gi))return gr==="?"?o:gr;return gi},EO={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},yO={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[P,[S,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[P,[S,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[S,P],[/opios[\/ ]+([\w\.]+)/i],[P,[S,ke+" Mini"]],[/\bopr\/([\w\.]+)/i],[P,[S,ke]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[S,P],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[P,[S,"UC"+nt]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[P,[S,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[P,[S,"WeChat"]],[/konqueror\/([\w\.]+)/i],[P,[S,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[P,[S,"IE"]],[/yabrowser\/([\w\.]+)/i],[P,[S,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[S,/(.+)/,"$1 Secure "+nt],P],[/\bfocus\/([\w\.]+)/i],[P,[S,pn+" Focus"]],[/\bopt\/([\w\.]+)/i],[P,[S,ke+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[P,[S,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[P,[S,"Dolphin"]],[/coast\/([\w\.]+)/i],[P,[S,ke+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[P,[S,"MIUI "+nt]],[/fxios\/([-\w\.]+)/i],[P,[S,pn]],[/\bqihu|(qi?ho?o?|360)browser/i],[[S,"360 "+nt]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[S,/(.+)/,"$1 "+nt],P],[/(comodo_dragon)\/([\w\.]+)/i],[[S,/_/g," "],P],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[S,P],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[S],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[S,ce],P],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[S,P],[/\bgsa\/([\w\.]+) .*safari\//i],[P,[S,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[P,[S,st+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[S,st+" WebView"],P],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[P,[S,"Android "+nt]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[S,P],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[P,[S,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[P,S],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[S,[P,vb,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[S,P],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[S,"Netscape"],P],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[P,[S,pn+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[S,P],[/(cobalt)\/([\w\.]+)/i],[S,[P,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[B,"amd64"]],[/(ia32(?=;))/i],[[B,ma]],[/((?:i[346]|x)86)[;\)]/i],[[B,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[B,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[B,"armhf"]],[/windows (ce|mobile); ppc;/i],[[B,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[B,/ower/,"",ma]],[/(sun4\w)[;\)]/i],[[B,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[B,ma]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[y,[I,Ye],[w,q]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[y,[I,Ye],[w,U]],[/\((ip(?:hone|od)[\w ]*);/i],[y,[I,pe],[w,U]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[y,[I,pe],[w,q]],[/(macintosh);/i],[y,[I,pe]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[y,[I,ft],[w,U]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[y,[I,sr],[w,q]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[y,[I,sr],[w,U]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[y,/_/g," "],[I,L],[w,U]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[y,/_/g," "],[I,L],[w,q]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[y,[I,"OPPO"],[w,U]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[y,[I,"Vivo"],[w,U]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[y,[I,"Realme"],[w,U]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[y,[I,Wo],[w,U]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[y,[I,Wo],[w,q]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[y,[I,Xr],[w,q]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[y,[I,Xr],[w,U]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[y,[I,"Lenovo"],[w,q]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[y,/_/g," "],[I,"Nokia"],[w,U]],[/(pixel c)\b/i],[y,[I,mn],[w,q]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[y,[I,mn],[w,U]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[y,[I,xe],[w,U]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[y,"Xperia Tablet"],[I,xe],[w,q]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[y,[I,"OnePlus"],[w,U]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[y,[I,ge],[w,q]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[y,/(.+)/g,"Fire Phone $1"],[I,ge],[w,U]],[/(playbook);[-\w\),; ]+(rim)/i],[y,I,[w,q]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[y,[I,Be],[w,U]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[y,[I,we],[w,q]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[y,[I,we],[w,U]],[/(nexus 9)/i],[y,[I,"HTC"],[w,q]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[I,[y,/_/g," "],[w,U]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[y,[I,"Acer"],[w,q]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[y,[I,"Meizu"],[w,U]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[I,y,[w,U]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[I,y,[w,q]],[/(surface duo)/i],[y,[I,Fr],[w,q]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[y,[I,"Fairphone"],[w,U]],[/(u304aa)/i],[y,[I,"AT&T"],[w,U]],[/\bsie-(\w*)/i],[y,[I,"Siemens"],[w,U]],[/\b(rct\w+) b/i],[y,[I,"RCA"],[w,q]],[/\b(venue[\d ]{2,7}) b/i],[y,[I,"Dell"],[w,q]],[/\b(q(?:mv|ta)\w+) b/i],[y,[I,"Verizon"],[w,q]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[y,[I,"Barnes & Noble"],[w,q]],[/\b(tm\d{3}\w+) b/i],[y,[I,"NuVision"],[w,q]],[/\b(k88) b/i],[y,[I,"ZTE"],[w,q]],[/\b(nx\d{3}j) b/i],[y,[I,"ZTE"],[w,U]],[/\b(gen\d{3}) b.+49h/i],[y,[I,"Swiss"],[w,U]],[/\b(zur\d{3}) b/i],[y,[I,"Swiss"],[w,q]],[/\b((zeki)?tb.*\b) b/i],[y,[I,"Zeki"],[w,q]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[I,"Dragon Touch"],y,[w,q]],[/\b(ns-?\w{0,9}) b/i],[y,[I,"Insignia"],[w,q]],[/\b((nxa|next)-?\w{0,9}) b/i],[y,[I,"NextBook"],[w,q]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[I,"Voice"],y,[w,U]],[/\b(lvtel\-)?(v1[12]) b/i],[[I,"LvTel"],y,[w,U]],[/\b(ph-1) /i],[y,[I,"Essential"],[w,U]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[y,[I,"Envizen"],[w,q]],[/\b(trio[-\w\. ]+) b/i],[y,[I,"MachSpeed"],[w,q]],[/\btu_(1491) b/i],[y,[I,"Rotor"],[w,q]],[/(shield[\w ]+) b/i],[y,[I,"Nvidia"],[w,q]],[/(sprint) (\w+)/i],[I,y,[w,U]],[/(kin\.[onetw]{3})/i],[[y,/\./g," "],[I,Fr],[w,U]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[y,[I,te],[w,q]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[y,[I,te],[w,U]],[/smart-tv.+(samsung)/i],[I,[w,$]],[/hbbtv.+maple;(\d+)/i],[[y,/^/,"SmartTV"],[I,Ye],[w,$]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[I,Xr],[w,$]],[/(apple) ?tv/i],[I,[y,pe+" TV"],[w,$]],[/crkey/i],[[y,st+"cast"],[I,mn],[w,$]],[/droid.+aft(\w)( bui|\))/i],[y,[I,ge],[w,$]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[y,[I,ft],[w,$]],[/(bravia[\w ]+)( bui|\))/i],[y,[I,xe],[w,$]],[/(mitv-\w{5}) bui/i],[y,[I,L],[w,$]],[/Hbbtv.*(technisat) (.*);/i],[I,y,[w,$]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[I,Uf],[y,Uf],[w,$]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[w,$]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[I,y,[w,M]],[/droid.+; (shield) bui/i],[y,[I,"Nvidia"],[w,M]],[/(playstation [345portablevi]+)/i],[y,[I,xe],[w,M]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[y,[I,Fr],[w,M]],[/((pebble))app/i],[I,y,[w,ae]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[y,[I,pe],[w,ae]],[/droid.+; (glass) \d/i],[y,[I,mn],[w,ae]],[/droid.+; (wt63?0{2,3})\)/i],[y,[I,te],[w,ae]],[/(quest( 2| pro)?)/i],[y,[I,ce],[w,ae]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[I,[w,me]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[y,[w,U]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[y,[w,q]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[w,q]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[w,U]],[/(android[-\w\. ]{0,9});.+buil/i],[y,[I,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[P,[S,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[P,[S,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[S,P],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[P,S]],os:[[/microsoft (windows) (vista|xp)/i],[S,P],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[S,[P,vb,EO]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[S,"Windows"],[P,vb,EO]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[P,/_/g,"."],[S,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[S,jt],[P,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[P,S],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[S,P],[/\(bb(10);/i],[P,[S,Be]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[P,[S,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[P,[S,pn+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[P,[S,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[P,[S,"watchOS"]],[/crkey\/([\d\.]+)/i],[P,[S,st+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[S,ze],P],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[S,P],[/(sunos) ?([\w\.\d]*)/i],[[S,"Solaris"],P],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[S,P]]},ll=function(gi,ki){if(typeof gi===h&&(ki=gi,gi=o),!(this instanceof ll))return new ll(gi,ki).getResult();var gr=typeof i!==u&&i.navigator?i.navigator:o,Wa=gi||(gr&&gr.userAgent?gr.userAgent:""),sh=gr&&gr.userAgentData?gr.userAgentData:o,Jr=ki?function(Mn,ga){var _m={};for(var nd in Mn)ga[nd]&&ga[nd].length%2==0?_m[nd]=ga[nd].concat(Mn[nd]):_m[nd]=Mn[nd];return _m}(yO,ki):yO;return this.getBrowser=function(){var Mn={};return Mn[S]=o,Mn[P]=o,b_.call(Mn,Wa,Jr.browser),Mn[_]=function(ga){return typeof ga===m?ga.replace(/[^\d\.]/g,"").split(".")[0]:o}(Mn[P]),gr&&gr.brave&&typeof gr.brave.isBrave==c&&(Mn[S]="Brave"),Mn},this.getCPU=function(){var Mn={};return Mn[B]=o,b_.call(Mn,Wa,Jr.cpu),Mn},this.getDevice=function(){var Mn={};return Mn[I]=o,Mn[y]=o,Mn[w]=o,b_.call(Mn,Wa,Jr.device),!Mn[w]&&sh&&sh.mobile&&(Mn[w]=U),Mn[y]=="Macintosh"&&gr&&typeof gr.standalone!==u&&gr.maxTouchPoints&&gr.maxTouchPoints>2&&(Mn[y]="iPad",Mn[w]=q),Mn},this.getEngine=function(){var Mn={};return Mn[S]=o,Mn[P]=o,b_.call(Mn,Wa,Jr.engine),Mn},this.getOS=function(){var Mn={};return Mn[S]=o,Mn[P]=o,b_.call(Mn,Wa,Jr.os),!Mn[S]&&sh&&sh.platform!="Unknown"&&(Mn[S]=sh.platform.replace(/chrome os/i,ze).replace(/macos/i,jt)),Mn},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return Wa},this.setUA=function(Mn){return Wa=typeof Mn===m&&Mn.length>350?Uf(Mn,350):Mn,this},this.setUA(Wa),this};ll.VERSION="0.7.34",ll.BROWSER=Qn([S,P,_]),ll.CPU=Qn([B]),ll.DEVICE=Qn([y,I,w,M,U,$,q,ae,me]),ll.ENGINE=ll.OS=Qn([S,P]),e.exports&&(n=e.exports=ll),n.UAParser=ll;var gm=typeof i!==u&&(i.jQuery||i.Zepto);if(gm&&!gm.ua){var w_=new ll;gm.ua=w_.getResult(),gm.ua.get=function(){return w_.getUA()},gm.ua.set=function(gi){w_.setUA(gi);var ki=w_.getResult();for(var gr in ki)gm.ua[gr]=ki[gr]}}})(typeof window=="object"?window:a)})(o1,o1.exports);var Vce=l(o1.exports),Fce=ic,jce=ui,Bce=hn,Wce=Id,Gce=ar("iterator"),zce=Object,Hce=function(e){if(Bce(e))return!1;var n=zce(e);return n[Gce]!==void 0||"@@iterator"in n||jce(Wce,Fce(n))},Kce=l(Hce),a3=my.clear;Dn({global:!0,bind:!0,forced:H.clearImmediate!==a3},{clearImmediate:a3});var qce=typeof Bun=="function"&&Bun&&typeof Bun.version=="string",c3=H,$ce=re,Yce=Le,Xce=qce,Jce=ur,Qce=ss,Zce=Jc,ele=c3.Function,tle=/MSIE .\./.test(Jce)||Xce&&function(){var e=c3.Bun.version.split(".");return e.length<3||e[0]==0&&(e[1]<3||e[1]==3&&e[2]==0)}(),nle=Dn,l3=H,u3=my.set,rle=function(e,n){var i=1;return tle?function(o,c){var u=Zce(arguments.length,1)>i,h=Yce(o)?o:ele(o),m=u?Qce(arguments,i):[],_=u?function(){$ce(h,this,m)}:h;return e(_)}:e},d3=l3.setImmediate?rle(u3):u3;nle({global:!0,bind:!0,forced:l3.setImmediate!==d3},{setImmediate:d3});var h3=l(mt.setImmediate),ile=Dn,sle=Ua,ole=es,ale=Jc,cle=Jh,lle=H.process;ile({global:!0,dontCallGetSet:!0},{queueMicrotask:function(e){ale(arguments.length,1),ole(e);var n=cle&&lle.domain;sle(n?n.bind(e):e)}});var f3=l(mt.queueMicrotask);function p3(e,n){return function(){return e.apply(n,arguments)}}const{toString:ule}=Object.prototype,{getPrototypeOf:a1}=Object,TI=(c1=Object.create(null),e=>{const n=ule.call(e);return c1[n]||(c1[n]=n.slice(8,-1).toLowerCase())});var c1;const Gu=e=>(e=e.toLowerCase(),n=>TI(n)===e),bI=e=>n=>typeof n===e,{isArray:jy}=Array,E0=bI("undefined"),m3=Gu("ArrayBuffer"),dle=bI("string"),Zc=bI("function"),g3=bI("number"),wI=e=>e!==null&&typeof e=="object",RI=e=>{if(TI(e)!=="object")return!1;const n=a1(e);return!(n!==null&&n!==Object.prototype&&Object.getPrototypeOf(n)!==null||Symbol.toStringTag in e||Kce(e))},hle=Gu("Date"),fle=Gu("File"),ple=Gu("Blob"),mle=Gu("FileList"),gle=Gu("URLSearchParams"),[_le,Ele,yle,vle]=["ReadableStream","Request","Response","Headers"].map(Gu);function y0(e,n){let i,o,{allOwnKeys:c=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(e!=null)if(typeof e!="object"&&(e=[e]),jy(e))for(i=0,o=e.length;i<o;i++)n.call(null,e[i],i,e);else{const u=c?Object.getOwnPropertyNames(e):Object.keys(e),h=u.length;let m;for(i=0;i<h;i++)m=u[i],n.call(null,e[m],m,e)}}function _3(e,n){n=n.toLowerCase();const i=Object.keys(e);let o,c=i.length;for(;c-- >0;)if(o=i[c],n===o.toLowerCase())return o;return null}const qg=o3!==void 0?o3:typeof self<"u"?self:typeof window<"u"?window:D_,E3=e=>!E0(e)&&e!==qg,Sle=(l1=typeof Uint8Array<"u"&&a1(Uint8Array),e=>l1&&e instanceof l1);var l1;const Tle=Gu("HTMLFormElement"),y3=(e=>{let{hasOwnProperty:n}=e;return(i,o)=>n.call(i,o)})(Object.prototype),ble=Gu("RegExp"),v3=(e,n)=>{const i=Object.getOwnPropertyDescriptors(e),o={};y0(i,(c,u)=>{let h;(h=n(c,u,e))!==!1&&(o[u]=h||c)}),Object.defineProperties(e,o)},u1="abcdefghijklmnopqrstuvwxyz",S3="0123456789",T3={DIGIT:S3,ALPHA:u1,ALPHA_DIGIT:u1+u1.toUpperCase()+S3},wle=Gu("AsyncFunction"),b3=(w3=typeof h3=="function",R3=Zc(qg.postMessage),w3?h3:R3?(d1="axios@".concat(Math.random()),CI=[],qg.addEventListener("message",e=>{let{source:n,data:i}=e;n===qg&&i===d1&&CI.length&&CI.shift()()},!1),e=>{CI.push(e),qg.postMessage(d1,"*")}):e=>setTimeout(e));var w3,R3,d1,CI;const Rle=f3!==void 0?f3.bind(qg):typeof process<"u"&&process.nextTick||b3;var Qe={isArray:jy,isArrayBuffer:m3,isBuffer:function(e){return e!==null&&!E0(e)&&e.constructor!==null&&!E0(e.constructor)&&Zc(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let n;return e&&(typeof FormData=="function"&&e instanceof FormData||Zc(e.append)&&((n=TI(e))==="formdata"||n==="object"&&Zc(e.toString)&&e.toString()==="[object FormData]"))},isArrayBufferView:function(e){let n;return n=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&m3(e.buffer),n},isString:dle,isNumber:g3,isBoolean:e=>e===!0||e===!1,isObject:wI,isPlainObject:RI,isReadableStream:_le,isRequest:Ele,isResponse:yle,isHeaders:vle,isUndefined:E0,isDate:hle,isFile:fle,isBlob:ple,isRegExp:ble,isFunction:Zc,isStream:e=>wI(e)&&Zc(e.pipe),isURLSearchParams:gle,isTypedArray:Sle,isFileList:mle,forEach:y0,merge:function e(){const{caseless:n}=E3(this)&&this||{},i={},o=(c,u)=>{const h=n&&_3(i,u)||u;RI(i[h])&&RI(c)?i[h]=e(i[h],c):RI(c)?i[h]=e({},c):jy(c)?i[h]=c.slice():i[h]=c};for(let c=0,u=arguments.length;c<u;c++)arguments[c]&&y0(arguments[c],o);return i},extend:function(e,n,i){let{allOwnKeys:o}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return y0(n,(c,u)=>{i&&Zc(c)?e[u]=p3(c,i):e[u]=c},{allOwnKeys:o}),e},trim:e=>Gs(e)?Gs(e).call(e):e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),inherits:(e,n,i,o)=>{e.prototype=Object.create(n.prototype,o),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:n.prototype}),i&&Object.assign(e.prototype,i)},toFlatObject:(e,n,i,o)=>{let c,u,h;const m={};if(n=n||{},e==null)return n;do{for(c=Object.getOwnPropertyNames(e),u=c.length;u-- >0;)h=c[u],o&&!o(h,e,n)||m[h]||(n[h]=e[h],m[h]=!0);e=i!==!1&&a1(e)}while(e&&(!i||i(e,n))&&e!==Object.prototype);return n},kindOf:TI,kindOfTest:Gu,endsWith:(e,n,i)=>{e=String(e),(i===void 0||i>e.length)&&(i=e.length),i-=n.length;const o=e.indexOf(n,i);return o!==-1&&o===i},toArray:e=>{if(!e)return null;if(jy(e))return e;let n=e.length;if(!g3(n))return null;const i=new Array(n);for(;n-- >0;)i[n]=e[n];return i},forEachEntry:(e,n)=>{const i=(e&&e[Symbol.iterator]).call(e);let o;for(;(o=i.next())&&!o.done;){const c=o.value;n.call(e,c[0],c[1])}},matchAll:(e,n)=>{let i;const o=[];for(;(i=e.exec(n))!==null;)o.push(i);return o},isHTMLForm:Tle,hasOwnProperty:y3,hasOwnProp:y3,reduceDescriptors:v3,freezeMethods:e=>{v3(e,(n,i)=>{if(Zc(e)&&["arguments","caller","callee"].indexOf(i)!==-1)return!1;const o=e[i];Zc(o)&&(n.enumerable=!1,"writable"in n?n.writable=!1:n.set||(n.set=()=>{throw Error("Can not rewrite read-only method '"+i+"'")}))})},toObjectSet:(e,n)=>{const i={},o=c=>{c.forEach(u=>{i[u]=!0})};return jy(e)?o(e):o(String(e).split(n)),i},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(n,i,o){return i.toUpperCase()+o}),noop:()=>{},toFiniteNumber:(e,n)=>e!=null&&Number.isFinite(e=+e)?e:n,findKey:_3,global:qg,isContextDefined:E3,ALPHABET:T3,generateString:function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:T3.ALPHA_DIGIT,i="";const{length:o}=n;for(;e--;)i+=n[Math.random()*o|0];return i},isSpecCompliantForm:function(e){return!!(e&&Zc(e.append)&&e[Symbol.toStringTag]==="FormData"&&e[Symbol.iterator])},toJSONObject:e=>{const n=new Array(10),i=(o,c)=>{if(wI(o)){if(n.indexOf(o)>=0)return;if(!("toJSON"in o)){n[c]=o;const u=jy(o)?[]:{};return y0(o,(h,m)=>{const _=i(h,c+1);!E0(_)&&(u[m]=_)}),n[c]=void 0,u}}return o};return i(e,0)},isAsyncFn:wle,isThenable:e=>e&&(wI(e)||Zc(e))&&Zc(e.then)&&Zc(e.catch),setImmediate:b3,asap:Rle};function Xn(e,n,i,o,c){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",n&&(this.code=n),i&&(this.config=i),o&&(this.request=o),c&&(this.response=c,this.status=c.status?c.status:null)}Qe.inherits(Xn,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Qe.toJSONObject(this.config),code:this.code,status:this.status}}});const C3=Xn.prototype,I3={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{I3[e]={value:e}}),Object.defineProperties(Xn,I3),Object.defineProperty(C3,"isAxiosError",{value:!0}),Xn.from=(e,n,i,o,c,u)=>{const h=Object.create(C3);return Qe.toFlatObject(e,h,function(m){return m!==Error.prototype},m=>m!=="isAxiosError"),Xn.call(h,e.message,n,i,o,c),h.cause=e,h.name=e.name,u&&Object.assign(h,u),h};function h1(e){return Qe.isPlainObject(e)||Qe.isArray(e)}function A3(e){return Qe.endsWith(e,"[]")?e.slice(0,-2):e}function O3(e,n,i){return e?e.concat(n).map(function(o,c){return o=A3(o),!i&&c?"["+o+"]":o}).join(i?".":""):n}const Cle=Qe.toFlatObject(Qe,{},null,function(e){return/^is[A-Z]/.test(e)});function II(e,n,i){if(!Qe.isObject(e))throw new TypeError("target must be an object");n=n||new FormData;const o=(i=Qe.toFlatObject(i,{metaTokens:!0,dots:!1,indexes:!1},!1,function(I,P){return!Qe.isUndefined(P[I])})).metaTokens,c=i.visitor||y,u=i.dots,h=i.indexes,m=(i.Blob||typeof Blob<"u"&&Blob)&&Qe.isSpecCompliantForm(n);if(!Qe.isFunction(c))throw new TypeError("visitor must be a function");function _(I){if(I===null)return"";if(Qe.isDate(I))return I.toISOString();if(!m&&Qe.isBlob(I))throw new Xn("Blob is not supported. Use a Buffer instead.");return Qe.isArrayBuffer(I)||Qe.isTypedArray(I)?m&&typeof Blob=="function"?new Blob([I]):Buffer.from(I):I}function y(I,P,B){let M=I;if(I&&!B&&typeof I=="object"){if(Qe.endsWith(P,"{}"))P=o?P:P.slice(0,-2),I=JSON.stringify(I);else if(Qe.isArray(I)&&function(U){return Qe.isArray(U)&&!U.some(h1)}(I)||(Qe.isFileList(I)||Qe.endsWith(P,"[]"))&&(M=Qe.toArray(I)))return P=A3(P),M.forEach(function(U,q){!Qe.isUndefined(U)&&U!==null&&n.append(h===!0?O3([P],q,u):h===null?P:P+"[]",_(U))}),!1}return!!h1(I)||(n.append(O3(B,P,u),_(I)),!1)}const S=[],w=Object.assign(Cle,{defaultVisitor:y,convertValue:_,isVisitable:h1});if(!Qe.isObject(e))throw new TypeError("data must be an object");return function I(P,B){if(!Qe.isUndefined(P)){if(S.indexOf(P)!==-1)throw Error("Circular reference detected in "+B.join("."));S.push(P),Qe.forEach(P,function(M,U){(!(Qe.isUndefined(M)||M===null)&&c.call(n,M,Qe.isString(U)?Gs(U).call(U):U,B,w))===!0&&I(M,B?B.concat(U):[U])}),S.pop()}}(e),n}function P3(e){const n={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(i){return n[i]})}function f1(e,n){this._pairs=[],e&&II(e,this,n)}const N3=f1.prototype;function Ile(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function k3(e,n,i){if(!n)return e;const o=i&&i.encode||Ile;Qe.isFunction(i)&&(i={serialize:i});const c=i&&i.serialize;let u;if(u=c?c(n,i):Qe.isURLSearchParams(n)?n.toString():new f1(n,i).toString(o),u){const h=e.indexOf("#");h!==-1&&(e=e.slice(0,h)),e+=(e.indexOf("?")===-1?"?":"&")+u}return e}N3.append=function(e,n){this._pairs.push([e,n])},N3.toString=function(e){const n=e?function(i){return e.call(this,i,P3)}:P3;return this._pairs.map(function(i){return n(i[0])+"="+n(i[1])},"").join("&")};var D3=class{constructor(){this.handlers=[]}use(e,n,i){return this.handlers.push({fulfilled:e,rejected:n,synchronous:!!i&&i.synchronous,runWhen:i?i.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){Qe.forEach(this.handlers,function(n){n!==null&&e(n)})}},L3={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},x3={exports:{}},Ale=Dn,Ole=et,M3=Ke.f;Ale({target:"Object",stat:!0,forced:Object.defineProperty!==M3,sham:!Ole},{defineProperty:M3});var U3=mt.Object,Ple=x3.exports=function(e,n,i){return U3.defineProperty(e,n,i)};U3.defineProperty.sham&&(Ple.sham=!0);var V3=l(x3.exports),Nle=TypeError,F3=dg,kle=Lg,Dle=dt,Lle=ar("species"),j3=Array,xle=function(e){var n;return F3(e)&&(n=e.constructor,(kle(n)&&(n===j3||F3(n.prototype))||Dle(n)&&(n=n[Lle])===null)&&(n=void 0)),n===void 0?j3:n},B3=function(e,n){return new(xle(e))(n===0?0:n)},Mle=d,Ule=li,Vle=ar("species"),W3=function(e){return Ule>=51||!Mle(function(){var n=[];return(n.constructor={})[Vle]=function(){return{foo:1}},n[e](Boolean).foo!==1})},Fle=Dn,jle=d,Ble=dg,Wle=dt,Gle=yo,zle=ti,G3=function(e){if(e>9007199254740991)throw Nle("Maximum allowed index exceeded");return e},z3=rI,Hle=B3,Kle=W3,qle=li,H3=ar("isConcatSpreadable"),$le=qle>=51||!jle(function(){var e=[];return e[H3]=!1,e.concat()[0]!==e}),Yle=function(e){if(!Wle(e))return!1;var n=e[H3];return n!==void 0?!!n:Ble(e)};Fle({target:"Array",proto:!0,forced:!$le||!Kle("concat")},{concat:function(e){var n,i,o,c,u,h=Gle(this),m=Hle(h,0),_=0;for(n=-1,o=arguments.length;n<o;n++)if(Yle(u=n===-1?h:arguments[n]))for(c=zle(u),G3(_+c),i=0;i<c;i++,_++)i in u&&z3(m,_,u[i]);else G3(_+1),z3(m,_++,u);return m.length=_,m}});var K3={},Xle=Q,Jle=ve,q3=wd.f,Qle=gD,$3=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];K3.f=function(e){return $3&&Xle(e)=="Window"?function(n){try{return q3(n)}catch{return Qle($3)}}(e):q3(Jle(e))};var By={},Zle=ar;By.f=Zle;var Y3=mt,eue=ui,tue=By,nue=Ke.f,cs=function(e){var n=Y3.Symbol||(Y3.Symbol={});eue(n,e)||nue(n,e,{value:tue.f(e)})},rue=Me,iue=rn,sue=ar,oue=xu,X3=function(){var e=iue("Symbol"),n=e&&e.prototype,i=n&&n.valueOf,o=sue("toPrimitive");n&&!n[o]&&oue(n,o,function(c){return rue(i,this)},{})},aue=Re,cue=In,lue=yo,uue=ti,due=B3,J3=O([].push),hue=function(e){var n=e==1,i=e==2,o=e==3,c=e==4,u=e==6,h=e==7,m=e==5||u;return function(_,y,S,w){for(var I,P,B=lue(_),M=cue(B),U=aue(y,S),q=uue(M),$=0,ae=w||due,me=n?ae(_,q):i||h?ae(_,0):void 0;q>$;$++)if((m||$ in M)&&(P=U(I=M[$],$,B),e))if(n)me[$]=P;else if(P)switch(e){case 3:return!0;case 5:return I;case 6:return $;case 2:J3(me,I)}else switch(e){case 4:return!1;case 7:J3(me,I)}return u?-1:o||c?c:me}},Q3={forEach:hue(0)},AI=Dn,p1=H,m1=Me,fue=O,Wy=et,Gy=eo,pue=d,ao=ui,mue=N,g1=nn,OI=ve,_1=Pa,gue=na,E1=Et,v0=No,Z3=ac,_ue=wd,e5=K3,Eue=oc,t5=pt,n5=Ke,yue=AE,r5=it,i5=xu,vue=ey,y1=Aa,s5=sc,o5=_d,Sue=ar,Tue=By,bue=cs,wue=X3,Rue=Mu,a5=Lu,PI=Q3.forEach,gc=fg("hidden"),NI="Symbol",S0="prototype",Cue=a5.set,c5=a5.getterFor(NI),zu=Object[S0],$g=p1.Symbol,kI=$g&&$g[S0],Iue=p1.TypeError,v1=p1.QObject,l5=t5.f,Yg=n5.f,u5=e5.f,Aue=r5.f,d5=fue([].push),Sf=y1("symbols"),T0=y1("op-symbols"),Oue=y1("wks"),S1=!v1||!v1[S0]||!v1[S0].findChild,T1=Wy&&pue(function(){return v0(Yg({},"a",{get:function(){return Yg(this,"a",{value:7}).a}})).a!=7})?function(e,n,i){var o=l5(zu,n);o&&delete zu[n],Yg(e,n,i),o&&e!==zu&&Yg(zu,n,o)}:Yg,b1=function(e,n){var i=Sf[e]=v0(kI);return Cue(i,{type:NI,tag:e,description:n}),Wy||(i.description=n),i},DI=function(e,n,i){e===zu&&DI(T0,n,i),g1(e);var o=_1(n);return g1(i),ao(Sf,o)?(i.enumerable?(ao(e,gc)&&e[gc][o]&&(e[gc][o]=!1),i=v0(i,{enumerable:E1(0,!1)})):(ao(e,gc)||Yg(e,gc,E1(1,{})),e[gc][o]=!0),T1(e,o,i)):Yg(e,o,i)},w1=function(e,n){g1(e);var i=OI(n),o=Z3(i).concat(m5(i));return PI(o,function(c){Wy&&!m1(h5,i,c)||DI(e,c,i[c])}),e},h5=function(e){var n=_1(e),i=m1(Aue,this,n);return!(this===zu&&ao(Sf,n)&&!ao(T0,n))&&(!(i||!ao(this,n)||!ao(Sf,n)||ao(this,gc)&&this[gc][n])||i)},f5=function(e,n){var i=OI(e),o=_1(n);if(i!==zu||!ao(Sf,o)||ao(T0,o)){var c=l5(i,o);return!c||!ao(Sf,o)||ao(i,gc)&&i[gc][o]||(c.enumerable=!0),c}},p5=function(e){var n=u5(OI(e)),i=[];return PI(n,function(o){ao(Sf,o)||ao(s5,o)||d5(i,o)}),i},m5=function(e){var n=e===zu,i=u5(n?T0:OI(e)),o=[];return PI(i,function(c){!ao(Sf,c)||n&&!ao(zu,c)||d5(o,Sf[c])}),o};Gy||($g=function(){if(mue(kI,this))throw Iue("Symbol is not a constructor");var e=arguments.length&&arguments[0]!==void 0?gue(arguments[0]):void 0,n=o5(e),i=function(o){this===zu&&m1(i,T0,o),ao(this,gc)&&ao(this[gc],n)&&(this[gc][n]=!1),T1(this,n,E1(1,o))};return Wy&&S1&&T1(zu,n,{configurable:!0,set:i}),b1(n,e)},i5(kI=$g[S0],"toString",function(){return c5(this).tag}),i5($g,"withoutSetter",function(e){return b1(o5(e),e)}),r5.f=h5,n5.f=DI,yue.f=w1,t5.f=f5,_ue.f=e5.f=p5,Eue.f=m5,Tue.f=function(e){return b1(Sue(e),e)},Wy&&vue(kI,"description",{configurable:!0,get:function(){return c5(this).description}})),AI({global:!0,wrap:!0,forced:!Gy,sham:!Gy},{Symbol:$g}),PI(Z3(Oue),function(e){bue(e)}),AI({target:NI,stat:!0,forced:!Gy},{useSetter:function(){S1=!0},useSimple:function(){S1=!1}}),AI({target:"Object",stat:!0,forced:!Gy,sham:!Wy},{create:function(e,n){return n===void 0?v0(e):w1(v0(e),n)},defineProperty:DI,defineProperties:w1,getOwnPropertyDescriptor:f5}),AI({target:"Object",stat:!0,forced:!Gy},{getOwnPropertyNames:p5}),wue(),Rue($g,NI),s5[gc]=!0;var g5=eo&&!!Symbol.for&&!!Symbol.keyFor,Pue=Dn,Nue=rn,kue=ui,Due=na,_5=Aa,Lue=g5,R1=_5("string-to-symbol-registry"),xue=_5("symbol-to-string-registry");Pue({target:"Symbol",stat:!0,forced:!Lue},{for:function(e){var n=Due(e);if(kue(R1,n))return R1[n];var i=Nue("Symbol")(n);return R1[n]=i,xue[i]=n,i}});var Mue=Dn,Uue=ui,Vue=Wc,Fue=Ja,jue=g5,E5=Aa("symbol-to-string-registry");Mue({target:"Symbol",stat:!0,forced:!jue},{keyFor:function(e){if(!Vue(e))throw TypeError(Fue(e)+" is not a symbol");if(Uue(E5,e))return E5[e]}});var y5=dg,Bue=Le,v5=Q,Wue=na,S5=O([].push),Gue=Dn,T5=rn,b5=re,zue=Me,b0=O,w5=d,R5=Le,C5=Wc,I5=ss,Hue=function(e){if(Bue(e))return e;if(y5(e)){for(var n=e.length,i=[],o=0;o<n;o++){var c=e[o];typeof c=="string"?S5(i,c):typeof c!="number"&&v5(c)!="Number"&&v5(c)!="String"||S5(i,Wue(c))}var u=i.length,h=!0;return function(m,_){if(h)return h=!1,_;if(y5(this))return _;for(var y=0;y<u;y++)if(i[y]===m)return _}}},Kue=eo,que=String,Xp=T5("JSON","stringify"),LI=b0(/./.exec),A5=b0("".charAt),$ue=b0("".charCodeAt),Yue=b0("".replace),Xue=b0(1 .toString),Jue=/[\uD800-\uDFFF]/g,O5=/^[\uD800-\uDBFF]$/,P5=/^[\uDC00-\uDFFF]$/,N5=!Kue||w5(function(){var e=T5("Symbol")();return Xp([e])!="[null]"||Xp({a:e})!="{}"||Xp(Object(e))!="{}"}),k5=w5(function(){return Xp("\uDF06\uD834")!=='"\\udf06\\ud834"'||Xp("\uDEAD")!=='"\\udead"'}),Que=function(e,n){var i=I5(arguments),o=Hue(n);if(R5(o)||e!==void 0&&!C5(e))return i[1]=function(c,u){if(R5(o)&&(u=zue(o,this,que(c),u)),!C5(u))return u},b5(Xp,null,i)},Zue=function(e,n,i){var o=A5(i,n-1),c=A5(i,n+1);return LI(O5,e)&&!LI(P5,c)||LI(P5,e)&&!LI(O5,o)?"\\u"+Xue($ue(e,0),16):e};Xp&&Gue({target:"JSON",stat:!0,forced:N5||k5},{stringify:function(e,n,i){var o=I5(arguments),c=b5(N5?Que:Xp,null,o);return k5&&typeof c=="string"?Yue(c,Jue,Zue):c}});var D5=oc,ede=yo;Dn({target:"Object",stat:!0,forced:!eo||d(function(){D5.f(1)})},{getOwnPropertySymbols:function(e){var n=D5.f;return n?n(ede(e)):[]}}),cs("asyncIterator"),cs("hasInstance"),cs("isConcatSpreadable"),cs("iterator"),cs("match"),cs("matchAll"),cs("replace"),cs("search"),cs("species"),cs("split");var tde=X3;cs("toPrimitive"),tde();var nde=rn,rde=Mu;cs("toStringTag"),rde(nde("Symbol"),"Symbol"),cs("unscopables"),Mu(H.JSON,"JSON",!0);var ide=mt.Symbol,sde=ar,ode=Ke.f,L5=sde("metadata"),x5=Function.prototype;x5[L5]===void 0&&ode(x5,L5,{value:null}),cs("dispose"),cs("metadata");var ade=ide;cs("asyncDispose");var cde=O,C1=rn("Symbol"),lde=C1.keyFor,ude=cde(C1.prototype.valueOf),M5=C1.isRegisteredSymbol||function(e){try{return lde(ude(e))!==void 0}catch{return!1}};Dn({target:"Symbol",stat:!0},{isRegisteredSymbol:M5});for(var dde=Aa,U5=rn,hde=O,fde=Wc,pde=ar,xI=U5("Symbol"),V5=xI.isWellKnownSymbol,F5=U5("Object","getOwnPropertyNames"),mde=hde(xI.prototype.valueOf),j5=dde("wks"),I1=0,B5=F5(xI),gde=B5.length;I1<gde;I1++)try{var W5=B5[I1];fde(xI[W5])&&pde(W5)}catch{}var G5=function(e){if(V5&&V5(e))return!0;try{for(var n=mde(e),i=0,o=F5(j5),c=o.length;i<c;i++)if(j5[o[i]]==n)return!0}catch{}return!1};Dn({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:G5}),cs("matcher"),cs("observable"),Dn({target:"Symbol",stat:!0},{isRegistered:M5}),Dn({target:"Symbol",stat:!0,forced:!0},{isWellKnown:G5}),cs("metadataKey"),cs("patternMatch"),cs("replaceAll");var zy=l(ade),z5=l(By.f("iterator"));function w0(e){return w0=typeof zy=="function"&&typeof z5=="symbol"?function(n){return typeof n}:function(n){return n&&typeof zy=="function"&&n.constructor===zy&&n!==zy.prototype?"symbol":typeof n},w0(e)}var _de=l(By.f("toPrimitive"));function Ede(e){var n=function(i,o){if(w0(i)!=="object"||i===null)return i;var c=i[_de];if(c!==void 0){var u=c.call(i,o);if(w0(u)!=="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return(o==="string"?String:Number)(i)}(e,"string");return w0(n)==="symbol"?n:String(n)}function K(e,n,i){return(n=Ede(n))in e?V3(e,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[n]=i,e}var H5=l(Qoe),yde={isBrowser:!0,classes:{URLSearchParams:H5!==void 0?H5:f1,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const A1=typeof window<"u"&&typeof document<"u",O1=typeof navigator=="object"&&navigator||void 0,vde=A1&&(!O1||["ReactNative","NativeScript","NS"].indexOf(O1.product)<0),Sde=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Tde=A1&&window.location.href||"http://localhost";function K5(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function q5(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?K5(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):K5(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}var ua=q5(q5({},Object.freeze({__proto__:null,hasBrowserEnv:A1,hasStandardBrowserEnv:vde,hasStandardBrowserWebWorkerEnv:Sde,navigator:O1,origin:Tde})),yde),bde=nn,wde=Me,Rde=ui,Cde=N,Ide=function(){var e=bde(this),n="";return e.hasIndices&&(n+="d"),e.global&&(n+="g"),e.ignoreCase&&(n+="i"),e.multiline&&(n+="m"),e.dotAll&&(n+="s"),e.unicode&&(n+="u"),e.unicodeSets&&(n+="v"),e.sticky&&(n+="y"),n},$5=RegExp.prototype,Y5=function(e){var n=e.flags;return n!==void 0||"flags"in $5||Rde(e,"flags")||!Cde($5,e)?n:wde(Ide,e)},Ade=dD.charAt,X5=Me,Ode=nn,Pde=Le,Nde=Q,kde=/./.exec,Dde=TypeError,Lde=Dn,J5=Me,Q5=ue,xde=KE,MI=JE,Z5=Zt,e6=It,R0=na,Mde=nn,Ude=hn,Vde=Q,Fde=UR,t6=Y5,jde=Qa,Bde=d,Wde=Vi,Gde=function(e,n,i){return n+(i?Ade(e,n).length:1)},zde=function(e,n){var i=e.exec;if(Pde(i)){var o=X5(i,e,n);return o!==null&&Ode(o),o}if(Nde(e)==="RegExp")return X5(kde,e,n);throw Dde("RegExp#exec called on incompatible receiver")},n6=Lu,Hde=ar("matchAll"),r6="RegExp String",i6=r6+" Iterator",Kde=n6.set,qde=n6.getterFor(i6),$de=TypeError,P1=Q5("".indexOf),UI=Q5("".matchAll),N1=!!UI&&!Bde(function(){UI("a",/./)}),Yde=xde(function(e,n,i,o){Kde(this,{type:i6,regexp:e,string:n,global:i,unicode:o,done:!1})},r6,function(){var e=qde(this);if(e.done)return MI(void 0,!0);var n=e.regexp,i=e.string,o=zde(n,i);return o===null?(e.done=!0,MI(void 0,!0)):e.global?(R0(o[0])===""&&(n.lastIndex=Gde(i,e6(n.lastIndex),e.unicode)),MI(o,!1)):(e.done=!0,MI(o,!1))}),s6=function(e){var n,i,o,c=Mde(this),u=R0(e),h=Wde(c,RegExp),m=R0(t6(c));return n=new h(h===RegExp?c.source:c,m),i=!!~P1(m,"g"),o=!!~P1(m,"u"),n.lastIndex=e6(c.lastIndex),new Yde(n,u,i,o)};Lde({target:"String",proto:!0,forced:N1},{matchAll:function(e){var n,i,o,c,u=Z5(this);if(Ude(e)){if(N1)return UI(u,e)}else{if(Fde(e)&&(n=R0(Z5(t6(e))),!~P1(n,"g")))throw $de("`.matchAll` does not allow non-global regexes");if(N1)return UI(u,e);if((o=jde(e,Hde))===void 0&&Vde(e)=="RegExp"&&(o=s6),o)return J5(o,e,u)}return i=R0(u),c=new RegExp(e,"g"),J5(s6,c,i)}});var Xde=ka("String").matchAll,Jde=N,Qde=Xde,k1=String.prototype,Zde=function(e){var n=e.matchAll;return typeof e=="string"||e===k1||Jde(k1,e)&&n===k1.matchAll?Qde:n},ehe=l(Zde);function o6(e){function n(i,o,c,u){let h=i[u++];if(h==="__proto__")return!0;const m=Number.isFinite(+h),_=u>=i.length;return h=!h&&Qe.isArray(c)?c.length:h,_?(Qe.hasOwnProp(c,h)?c[h]=[c[h],o]:c[h]=o,!m):(c[h]&&Qe.isObject(c[h])||(c[h]=[]),n(i,o,c[h],u)&&Qe.isArray(c[h])&&(c[h]=function(y){const S={},w=Object.keys(y);let I;const P=w.length;let B;for(I=0;I<P;I++)B=w[I],S[B]=y[B];return S}(c[h])),!m)}if(Qe.isFormData(e)&&Qe.isFunction(e.entries)){const i={};return Qe.forEachEntry(e,(o,c)=>{n(function(u){return ehe(Qe).call(Qe,/\w+|\[(\w*)]/g,u).map(h=>h[0]==="[]"?"":h[1]||h[0])}(o),c,i,0)}),i}return null}const D1={transitional:L3,adapter:["xhr","http","fetch"],transformRequest:[function(e,n){const i=n.getContentType()||"",o=i.indexOf("application/json")>-1,c=Qe.isObject(e);if(c&&Qe.isHTMLForm(e)&&(e=new FormData(e)),Qe.isFormData(e))return o?JSON.stringify(o6(e)):e;if(Qe.isArrayBuffer(e)||Qe.isBuffer(e)||Qe.isStream(e)||Qe.isFile(e)||Qe.isBlob(e)||Qe.isReadableStream(e))return e;if(Qe.isArrayBufferView(e))return e.buffer;if(Qe.isURLSearchParams(e))return n.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let u;if(c){if(i.indexOf("application/x-www-form-urlencoded")>-1)return function(h,m){return II(h,new ua.classes.URLSearchParams,Object.assign({visitor:function(_,y,S,w){return ua.isNode&&Qe.isBuffer(_)?(this.append(y,_.toString("base64")),!1):w.defaultVisitor.apply(this,arguments)}},m))}(e,this.formSerializer).toString();if((u=Qe.isFileList(e))||i.indexOf("multipart/form-data")>-1){const h=this.env&&this.env.FormData;return II(u?{"files[]":e}:e,h&&new h,this.formSerializer)}}return c||o?(n.setContentType("application/json",!1),function(h,m,_){if(Qe.isString(h))try{return(m||JSON.parse)(h),Gs(Qe).call(Qe,h)}catch(y){if(y.name!=="SyntaxError")throw y}return(_||JSON.stringify)(h)}(e)):e}],transformResponse:[function(e){const n=this.transitional||D1.transitional,i=n&&n.forcedJSONParsing,o=this.responseType==="json";if(Qe.isResponse(e)||Qe.isReadableStream(e))return e;if(e&&Qe.isString(e)&&(i&&!this.responseType||o)){const c=!(n&&n.silentJSONParsing)&&o;try{return JSON.parse(e)}catch(u){if(c)throw u.name==="SyntaxError"?Xn.from(u,Xn.ERR_BAD_RESPONSE,this,null,this.response):u}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ua.classes.FormData,Blob:ua.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Qe.forEach(["delete","get","head","post","put","patch"],e=>{D1.headers[e]={}});var L1=D1;const the=Qe.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),a6=Symbol("internals");function C0(e){var n;return e&&Gs(n=String(e)).call(n).toLowerCase()}function VI(e){return e===!1||e==null?e:Qe.isArray(e)?e.map(VI):String(e)}function x1(e,n,i,o,c){return Qe.isFunction(o)?o.call(this,n,i):(c&&(n=i),Qe.isString(n)?Qe.isString(o)?n.indexOf(o)!==-1:Qe.isRegExp(o)?o.test(n):void 0:void 0)}class FI{constructor(n){n&&this.set(n)}set(n,i,o){const c=this;function u(_,y,S){const w=C0(y);if(!w)throw new Error("header name must be a non-empty string");const I=Qe.findKey(c,w);(!I||c[I]===void 0||S===!0||S===void 0&&c[I]!==!1)&&(c[I||y]=VI(_))}const h=(_,y)=>Qe.forEach(_,(S,w)=>u(S,w,y));if(Qe.isPlainObject(n)||n instanceof this.constructor)h(n,i);else if(Qe.isString(n)&&(n=Gs(n).call(n))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(Gs(m=n).call(m)))h((_=>{const y={};let S,w,I;return _&&_.split(`
`).forEach(function(P){var B,M;I=P.indexOf(":"),S=Gs(B=P.substring(0,I)).call(B).toLowerCase(),w=Gs(M=P.substring(I+1)).call(M),!S||y[S]&&the[S]||(S==="set-cookie"?y[S]?y[S].push(w):y[S]=[w]:y[S]=y[S]?y[S]+", "+w:w)}),y})(n),i);else if(Qe.isHeaders(n))for(const[_,y]of n.entries())u(y,_,o);else n!=null&&u(i,n,o);var m;return this}get(n,i){if(n=C0(n)){const o=Qe.findKey(this,n);if(o){const c=this[o];if(!i)return c;if(i===!0)return function(u){const h=Object.create(null),m=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let _;for(;_=m.exec(u);)h[_[1]]=_[2];return h}(c);if(Qe.isFunction(i))return i.call(this,c,o);if(Qe.isRegExp(i))return i.exec(c);throw new TypeError("parser must be boolean|regexp|function")}}}has(n,i){if(n=C0(n)){const o=Qe.findKey(this,n);return!(!o||this[o]===void 0||i&&!x1(0,this[o],o,i))}return!1}delete(n,i){const o=this;let c=!1;function u(h){if(h=C0(h)){const m=Qe.findKey(o,h);!m||i&&!x1(0,o[m],m,i)||(delete o[m],c=!0)}}return Qe.isArray(n)?n.forEach(u):u(n),c}clear(n){const i=Object.keys(this);let o=i.length,c=!1;for(;o--;){const u=i[o];n&&!x1(0,this[u],u,n,!0)||(delete this[u],c=!0)}return c}normalize(n){const i=this,o={};return Qe.forEach(this,(c,u)=>{var h;const m=Qe.findKey(o,u);if(m)return i[m]=VI(c),void delete i[u];const _=n?function(y){return Gs(y).call(y).toLowerCase().replace(/([a-z\d])(\w*)/g,(S,w,I)=>w.toUpperCase()+I)}(u):Gs(h=String(u)).call(h);_!==u&&delete i[u],i[_]=VI(c),o[_]=!0}),this}concat(){for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return this.constructor.concat(this,...i)}toJSON(n){const i=Object.create(null);return Qe.forEach(this,(o,c)=>{o!=null&&o!==!1&&(i[c]=n&&Qe.isArray(o)?o.join(", "):o)}),i}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(n=>{let[i,o]=n;return i+": "+o}).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(n){return n instanceof this?n:new this(n)}static concat(n){const i=new this(n);for(var o=arguments.length,c=new Array(o>1?o-1:0),u=1;u<o;u++)c[u-1]=arguments[u];return c.forEach(h=>i.set(h)),i}static accessor(n){const i=(this[a6]=this[a6]={accessors:{}}).accessors,o=this.prototype;function c(u){const h=C0(u);i[h]||(function(m,_){const y=Qe.toCamelCase(" "+_);["get","set","has"].forEach(S=>{Object.defineProperty(m,S+y,{value:function(w,I,P){return this[S].call(this,_,w,I,P)},configurable:!0})})}(o,u),i[h]=!0)}return Qe.isArray(n)?n.forEach(c):c(n),this}}FI.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),Qe.reduceDescriptors(FI.prototype,(e,n)=>{let{value:i}=e,o=n[0].toUpperCase()+n.slice(1);return{get:()=>i,set(c){this[o]=c}}}),Qe.freezeMethods(FI);var Hu=FI;function M1(e,n){const i=this||L1,o=n||i,c=Hu.from(o.headers);let u=o.data;return Qe.forEach(e,function(h){u=h.call(i,u,c.normalize(),n?n.status:void 0)}),c.normalize(),u}function c6(e){return!(!e||!e.__CANCEL__)}function Hy(e,n,i){Xn.call(this,e??"canceled",Xn.ERR_CANCELED,n,i),this.name="CanceledError"}function l6(e,n,i){const o=i.config.validateStatus;i.status&&o&&!o(i.status)?n(new Xn("Request failed with status code "+i.status,[Xn.ERR_BAD_REQUEST,Xn.ERR_BAD_RESPONSE][Math.floor(i.status/100)-4],i.config,i.request,i)):e(i)}Qe.inherits(Hy,Xn,{__CANCEL__:!0});const jI=function(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,o=0;const c=function(u,h){u=u||10;const m=new Array(u),_=new Array(u);let y,S=0,w=0;return h=h!==void 0?h:1e3,function(I){const P=Date.now(),B=_[w];y||(y=P),m[S]=I,_[S]=P;let M=w,U=0;for(;M!==S;)U+=m[M++],M%=u;if(S=(S+1)%u,S===w&&(w=(w+1)%u),P-y<h)return;const q=B&&P-B;return q?Math.round(1e3*U/q):void 0}}(50,250);return function(u,h){let m,_,y=0,S=1e3/h;const w=function(I){y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),m=null,_&&(clearTimeout(_),_=null),u.apply(null,I)};return[function(){const I=Date.now(),P=I-y;for(var B=arguments.length,M=new Array(B),U=0;U<B;U++)M[U]=arguments[U];P>=S?w(M,I):(m=M,_||(_=setTimeout(()=>{_=null,w(m)},S-P)))},()=>m&&w(m)]}(u=>{const h=u.loaded,m=u.lengthComputable?u.total:void 0,_=h-o,y=c(_);o=h,e({loaded:h,total:m,progress:m?h/m:void 0,bytes:_,rate:y||void 0,estimated:y&&m&&h<=m?(m-h)/y:void 0,event:u,lengthComputable:m!=null,[n?"download":"upload"]:!0})},i)},u6=(e,n)=>{const i=e!=null;return[o=>n[0]({lengthComputable:i,total:e,loaded:o}),n[1]]},d6=e=>function(){for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return Qe.asap(()=>e(...i))};var nhe=ua.hasStandardBrowserEnv?((e,n)=>i=>(i=new mI(i,ua.origin),e.protocol===i.protocol&&e.host===i.host&&(n||e.port===i.port)))(new mI(ua.origin),ua.navigator&&/(msie|trident)/i.test(ua.navigator.userAgent)):()=>!0,rhe=ua.hasStandardBrowserEnv?{write(e,n,i,o,c,u){const h=[e+"="+encodeURIComponent(n)];Qe.isNumber(i)&&h.push("expires="+new Date(i).toGMTString()),Qe.isString(o)&&h.push("path="+o),Qe.isString(c)&&h.push("domain="+c),u===!0&&h.push("secure"),document.cookie=h.join("; ")},read(e){const n=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return n?decodeURIComponent(n[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function h6(e,n){return e&&!function(i){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(i)}(n)?function(i,o){return o?i.replace(/\/?\/$/,"")+"/"+o.replace(/^\/+/,""):i}(e,n):n}function f6(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}const p6=e=>e instanceof Hu?function(n){for(var i=1;i<arguments.length;i++){var o=arguments[i]!=null?arguments[i]:{};i%2?f6(Object(o),!0).forEach(function(c){K(n,c,o[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):f6(Object(o)).forEach(function(c){Object.defineProperty(n,c,Object.getOwnPropertyDescriptor(o,c))})}return n}({},e):e;function Xg(e,n){n=n||{};const i={};function o(y,S,w,I){return Qe.isPlainObject(y)&&Qe.isPlainObject(S)?Qe.merge.call({caseless:I},y,S):Qe.isPlainObject(S)?Qe.merge({},S):Qe.isArray(S)?S.slice():S}function c(y,S,w,I){return Qe.isUndefined(S)?Qe.isUndefined(y)?void 0:o(void 0,y,0,I):o(y,S,0,I)}function u(y,S){if(!Qe.isUndefined(S))return o(void 0,S)}function h(y,S){return Qe.isUndefined(S)?Qe.isUndefined(y)?void 0:o(void 0,y):o(void 0,S)}function m(y,S,w){return w in n?o(y,S):w in e?o(void 0,y):void 0}const _={url:u,method:u,data:u,baseURL:h,transformRequest:h,transformResponse:h,paramsSerializer:h,timeout:h,timeoutMessage:h,withCredentials:h,withXSRFToken:h,adapter:h,responseType:h,xsrfCookieName:h,xsrfHeaderName:h,onUploadProgress:h,onDownloadProgress:h,decompress:h,maxContentLength:h,maxBodyLength:h,beforeRedirect:h,transport:h,httpAgent:h,httpsAgent:h,cancelToken:h,socketPath:h,responseEncoding:h,validateStatus:m,headers:(y,S,w)=>c(p6(y),p6(S),0,!0)};return Qe.forEach(Object.keys(Object.assign({},e,n)),function(y){const S=_[y]||c,w=S(e[y],n[y],y);Qe.isUndefined(w)&&S!==m||(i[y]=w)}),i}var m6=e=>{const n=Xg({},e);let i,{data:o,withXSRFToken:c,xsrfHeaderName:u,xsrfCookieName:h,headers:m,auth:_}=n;if(n.headers=m=Hu.from(m),n.url=k3(h6(n.baseURL,n.url),e.params,e.paramsSerializer),_&&m.set("Authorization","Basic "+btoa((_.username||"")+":"+(_.password?unescape(encodeURIComponent(_.password)):""))),Qe.isFormData(o)){if(ua.hasStandardBrowserEnv||ua.hasStandardBrowserWebWorkerEnv)m.setContentType(void 0);else if((i=m.getContentType())!==!1){const[y,...S]=i?i.split(";").map(w=>Gs(w).call(w)).filter(Boolean):[];m.setContentType([y||"multipart/form-data",...S].join("; "))}}if(ua.hasStandardBrowserEnv&&(c&&Qe.isFunction(c)&&(c=c(n)),c||c!==!1&&nhe(n.url))){const y=u&&h&&rhe.read(h);y&&m.set(u,y)}return n},ihe=typeof XMLHttpRequest<"u"&&function(e){return new tt(function(n,i){const o=m6(e);let c=o.data;const u=Hu.from(o.headers).normalize();let h,m,_,y,S,{responseType:w,onUploadProgress:I,onDownloadProgress:P}=o;function B(){y&&y(),S&&S(),o.cancelToken&&o.cancelToken.unsubscribe(h),o.signal&&o.signal.removeEventListener("abort",h)}let M=new XMLHttpRequest;function U(){if(!M)return;const $=Hu.from("getAllResponseHeaders"in M&&M.getAllResponseHeaders());l6(function(ae){n(ae),B()},function(ae){i(ae),B()},{data:w&&w!=="text"&&w!=="json"?M.response:M.responseText,status:M.status,statusText:M.statusText,headers:$,config:e,request:M}),M=null}M.open(o.method.toUpperCase(),o.url,!0),M.timeout=o.timeout,"onloadend"in M?M.onloadend=U:M.onreadystatechange=function(){M&&M.readyState===4&&(M.status!==0||M.responseURL&&M.responseURL.indexOf("file:")===0)&&setTimeout(U)},M.onabort=function(){M&&(i(new Xn("Request aborted",Xn.ECONNABORTED,e,M)),M=null)},M.onerror=function(){i(new Xn("Network Error",Xn.ERR_NETWORK,e,M)),M=null},M.ontimeout=function(){let $=o.timeout?"timeout of "+o.timeout+"ms exceeded":"timeout exceeded";const ae=o.transitional||L3;o.timeoutErrorMessage&&($=o.timeoutErrorMessage),i(new Xn($,ae.clarifyTimeoutError?Xn.ETIMEDOUT:Xn.ECONNABORTED,e,M)),M=null},c===void 0&&u.setContentType(null),"setRequestHeader"in M&&Qe.forEach(u.toJSON(),function($,ae){M.setRequestHeader(ae,$)}),Qe.isUndefined(o.withCredentials)||(M.withCredentials=!!o.withCredentials),w&&w!=="json"&&(M.responseType=o.responseType),P&&([_,S]=jI(P,!0),M.addEventListener("progress",_)),I&&M.upload&&([m,y]=jI(I),M.upload.addEventListener("progress",m),M.upload.addEventListener("loadend",y)),(o.cancelToken||o.signal)&&(h=$=>{M&&(i(!$||$.type?new Hy(null,e,M):$),M.abort(),M=null)},o.cancelToken&&o.cancelToken.subscribe(h),o.signal&&(o.signal.aborted?h():o.signal.addEventListener("abort",h)));const q=function($){const ae=/^([-+\w]{1,25})(:?\/\/|:)/.exec($);return ae&&ae[1]||""}(o.url);q&&ua.protocols.indexOf(q)===-1?i(new Xn("Unsupported protocol "+q+":",Xn.ERR_BAD_REQUEST,e)):M.send(c||null)})},she=(e,n)=>{const{length:i}=e=e?e.filter(Boolean):[];if(n||i){let o,c=new AbortController;const u=function(y){if(!o){o=!0,m();const S=y instanceof Error?y:this.reason;c.abort(S instanceof Xn?S:new Hy(S instanceof Error?S.message:S))}};let h=n&&setTimeout(()=>{h=null,u(new Xn("timeout ".concat(n," of ms exceeded"),Xn.ETIMEDOUT))},n);const m=()=>{e&&(h&&clearTimeout(h),h=null,e.forEach(y=>{y.unsubscribe?y.unsubscribe(u):y.removeEventListener("abort",u)}),e=null)};e.forEach(y=>y.addEventListener("abort",u));const{signal:_}=c;return _.unsubscribe=()=>Qe.asap(m),_}},ohe=aB,ahe=Qc;Dn({target:"Promise",stat:!0,forced:!0},{withResolvers:function(){var e=ahe.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}});var che=Qc,lhe=xd;Dn({target:"Promise",stat:!0,forced:!0},{try:function(e){var n=che.f(this),i=lhe(e);return(i.error?n.reject:n.resolve)(i.value),n.promise}});var U1=l(ohe),g6=By.f("asyncIterator"),uhe=l(g6);function V1(e,n){this.v=e,this.k=n}function I0(e){var n,i;function o(u,h){try{var m=e[u](h),_=m.value,y=_ instanceof V1;U1.resolve(y?_.v:_).then(function(S){if(y){var w=u==="return"?"return":"next";if(!_.k||S.done)return o(w,S);S=e[w](S).value}c(m.done?"return":"normal",S)},function(S){o("throw",S)})}catch(S){c("throw",S)}}function c(u,h){switch(u){case"return":n.resolve({value:h,done:!0});break;case"throw":n.reject(h);break;default:n.resolve({value:h,done:!1})}(n=n.next)?o(n.key,n.arg):i=null}this._invoke=function(u,h){return new U1(function(m,_){var y={key:u,arg:h,resolve:m,reject:_,next:null};i?i=i.next=y:(n=i=y,o(u,h))})},typeof e.return!="function"&&(this.return=void 0)}function el(e){return function(){return new I0(e.apply(this,arguments))}}function Sn(e){return new V1(e,0)}function BI(e){var n={},i=!1;function o(c,u){return i=!0,{done:!1,value:new V1(u=new U1(function(h){h(e[c](u))}),1)}}return n[zy!==void 0&&z5||"@@iterator"]=function(){return this},n.next=function(c){return i?(i=!1,c):o("next",c)},typeof e.throw=="function"&&(n.throw=function(c){if(i)throw i=!1,c;return o("throw",c)}),typeof e.return=="function"&&(n.return=function(c){return i?(i=!1,c):o("return",c)}),n}I0.prototype[typeof zy=="function"&&uhe||"@@asyncIterator"]=function(){return this},I0.prototype.next=function(e){return this._invoke("next",e)},I0.prototype.throw=function(e){return this._invoke("throw",e)},I0.prototype.return=function(e){return this._invoke("return",e)};var F1=l(g6);function j1(e){var n,i,o,c=2;for(typeof Symbol<"u"&&(i=F1,o=Symbol.iterator);c--;){if(i&&(n=e[i])!=null)return n.call(e);if(o&&(n=e[o])!=null)return new WI(n.call(e));i="@@asyncIterator",o="@@iterator"}throw new TypeError("Object is not async iterable")}function WI(e){function n(i){if(Object(i)!==i)return tt.reject(new TypeError(i+" is not an object."));var o=i.done;return tt.resolve(i.value).then(function(c){return{value:c,done:o}})}return WI=function(i){this.s=i,this.n=i.next},WI.prototype={s:null,n:null,next:function(){return n(this.n.apply(this.s,arguments))},return:function(i){var o=this.s.return;return o===void 0?tt.resolve({value:i,done:!0}):n(o.apply(this.s,arguments))},throw:function(i){var o=this.s.return;return o===void 0?tt.reject(i):n(o.apply(this.s,arguments))}},new WI(e)}const dhe=function*(e,n){let i=e.byteLength;if(!n||i<n)return void(yield e);let o,c=0;for(;c<i;)o=c+n,yield e.slice(c,o),c=o},hhe=function(){var e=el(function*(n,i){var o,c=!1,u=!1;try{for(var h,m=j1(fhe(n));c=!(h=yield Sn(m.next())).done;c=!1){const _=h.value;yield*BI(j1(dhe(_,i)))}}catch(_){u=!0,o=_}finally{try{c&&m.return!=null&&(yield Sn(m.return()))}finally{if(u)throw o}}});return function(n,i){return e.apply(this,arguments)}}(),fhe=function(){var e=el(function*(n){if(n[F1])return void(yield*BI(j1(n)));const i=n.getReader();try{for(;;){const{done:o,value:c}=yield Sn(i.read());if(o)break;yield c}}finally{yield Sn(i.cancel())}});return function(n){return e.apply(this,arguments)}}(),_6=(e,n,i,o)=>{const c=hhe(e,n);let u,h=0,m=_=>{u||(u=!0,o&&o(_))};return new ReadableStream({async pull(_){try{const{done:y,value:S}=await c.next();if(y)return m(),void _.close();let w=S.byteLength;if(i){let I=h+=w;i(I)}_.enqueue(new Uint8Array(S))}catch(y){throw m(y),y}},cancel:_=>(m(_),c.return())},{highWaterMark:2})};function E6(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function y6(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?E6(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):E6(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}const GI=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",v6=GI&&typeof ReadableStream=="function",phe=GI&&(typeof TextEncoder=="function"?(S6=new TextEncoder,e=>S6.encode(e)):async e=>new Uint8Array(await new Response(e).arrayBuffer()));var S6;const T6=function(e){try{for(var n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];return!!e(...i)}catch{return!1}},mhe=v6&&T6(()=>{let e=!1;const n=new Request(ua.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!n}),B1=v6&&T6(()=>Qe.isReadableStream(new Response("").body)),zI={stream:B1&&(e=>e.body)};var b6;GI&&(b6=new Response,["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!zI[e]&&(zI[e]=Qe.isFunction(b6[e])?n=>n[e]():(n,i)=>{throw new Xn("Response type '".concat(e,"' is not supported"),Xn.ERR_NOT_SUPPORT,i)})}));const ghe=async(e,n)=>{const i=Qe.toFiniteNumber(e.getContentLength());return i??(async o=>o==null?0:Qe.isBlob(o)?o.size:Qe.isSpecCompliantForm(o)?(await new Request(ua.origin,{method:"POST",body:o}).arrayBuffer()).byteLength:Qe.isArrayBufferView(o)||Qe.isArrayBuffer(o)?o.byteLength:(Qe.isURLSearchParams(o)&&(o+=""),Qe.isString(o)?(await phe(o)).byteLength:void 0))(n)};var _he=GI&&(async e=>{let{url:n,method:i,data:o,signal:c,cancelToken:u,timeout:h,onDownloadProgress:m,onUploadProgress:_,responseType:y,headers:S,withCredentials:w="same-origin",fetchOptions:I}=m6(e);y=y?(y+"").toLowerCase():"text";let P,B=she([c,u&&u.toAbortSignal()],h);const M=B&&B.unsubscribe&&(()=>{B.unsubscribe()});let U;try{if(_&&mhe&&i!=="get"&&i!=="head"&&(U=await ghe(S,o))!==0){let ge,pe=new Request(n,{method:"POST",body:o,duplex:"half"});if(Qe.isFormData(o)&&(ge=pe.headers.get("content-type"))&&S.setContentType(ge),pe.body){const[we,Be]=u6(U,jI(d6(_)));o=_6(pe.body,65536,we,Be)}}Qe.isString(w)||(w=w?"include":"omit");const q="credentials"in Request.prototype;P=new Request(n,y6(y6({},I),{},{signal:B,method:i.toUpperCase(),headers:S.normalize().toJSON(),body:o,duplex:"half",credentials:q?w:void 0}));let $=await fetch(P);const ae=B1&&(y==="stream"||y==="response");if(B1&&(m||ae&&M)){const ge={};["status","statusText","headers"].forEach(nt=>{ge[nt]=$[nt]});const pe=Qe.toFiniteNumber($.headers.get("content-length")),[we,Be]=m&&u6(pe,jI(d6(m),!0))||[];$=new Response(_6($.body,65536,we,()=>{Be&&Be(),M&&M()}),ge)}y=y||"text";let me=await zI[Qe.findKey(zI,y)||"text"]($,e);return!ae&&M&&M(),await new tt((ge,pe)=>{l6(ge,pe,{data:me,headers:Hu.from($.headers),status:$.status,statusText:$.statusText,config:e,request:P})})}catch(q){throw M&&M(),q&&q.name==="TypeError"&&/fetch/i.test(q.message)?Object.assign(new Xn("Network Error",Xn.ERR_NETWORK,e,P),{cause:q.cause||q}):Xn.from(q,q&&q.code,e,P)}});const W1={http:null,xhr:ihe,fetch:_he};Qe.forEach(W1,(e,n)=>{if(e){try{Object.defineProperty(e,"name",{value:n})}catch{}Object.defineProperty(e,"adapterName",{value:n})}});const w6=e=>"- ".concat(e),Ehe=e=>Qe.isFunction(e)||e===null||e===!1;var R6={getAdapter:e=>{e=Qe.isArray(e)?e:[e];const{length:n}=e;let i,o;const c={};for(let u=0;u<n;u++){let h;if(i=e[u],o=i,!Ehe(i)&&(o=W1[(h=String(i)).toLowerCase()],o===void 0))throw new Xn("Unknown adapter '".concat(h,"'"));if(o)break;c[h||"#"+u]=o}if(!o){const u=Object.entries(c).map(h=>{let[m,_]=h;return"adapter ".concat(m," ")+(_===!1?"is not supported by the environment":"is not available in the build")});throw new Xn("There is no suitable adapter to dispatch the request "+(n?u.length>1?`since :
`+u.map(w6).join(`
`):" "+w6(u[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return o},adapters:W1};function G1(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new Hy(null,e)}function C6(e){return G1(e),e.headers=Hu.from(e.headers),e.data=M1.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),R6.getAdapter(e.adapter||L1.adapter)(e).then(function(n){return G1(e),n.data=M1.call(e,e.transformResponse,n),n.headers=Hu.from(n.headers),n},function(n){return c6(n)||(G1(e),n&&n.response&&(n.response.data=M1.call(e,e.transformResponse,n.response),n.response.headers=Hu.from(n.response.headers))),tt.reject(n)})}const I6="1.7.9",HI={};["object","boolean","number","function","string","symbol"].forEach((e,n)=>{HI[e]=function(i){return typeof i===e||"a"+(n<1?"n ":" ")+e}});const A6={};HI.transitional=function(e,n,i){function o(c,u){return"[Axios v"+I6+"] Transitional option '"+c+"'"+u+(i?". "+i:"")}return(c,u,h)=>{if(e===!1)throw new Xn(o(u," has been removed"+(n?" in "+n:"")),Xn.ERR_DEPRECATED);return n&&!A6[u]&&(A6[u]=!0,console.warn(o(u," has been deprecated since v"+n+" and will be removed in the near future"))),!e||e(c,u,h)}},HI.spelling=function(e){return(n,i)=>(console.warn("".concat(i," is likely a misspelling of ").concat(e)),!0)};var KI={assertOptions:function(e,n,i){if(typeof e!="object")throw new Xn("options must be an object",Xn.ERR_BAD_OPTION_VALUE);const o=Object.keys(e);let c=o.length;for(;c-- >0;){const u=o[c],h=n[u];if(h){const m=e[u],_=m===void 0||h(m,u,e);if(_!==!0)throw new Xn("option "+u+" must be "+_,Xn.ERR_BAD_OPTION_VALUE)}else if(i!==!0)throw new Xn("Unknown option "+u,Xn.ERR_BAD_OPTION)}},validators:HI};const Bd=KI.validators;let qI=class{constructor(e){this.defaults=e,this.interceptors={request:new D3,response:new D3}}async request(e,n){try{return await this._request(e,n)}catch(i){if(i instanceof Error){let o={};Error.captureStackTrace?Error.captureStackTrace(o):o=new Error;const c=o.stack?o.stack.replace(/^.+\n/,""):"";try{i.stack?c&&!String(i.stack).endsWith(c.replace(/^.+\n.+\n/,""))&&(i.stack+=`
`+c):i.stack=c}catch{}}throw i}}_request(e,n){typeof e=="string"?(n=n||{}).url=e:n=e||{},n=Xg(this.defaults,n);const{transitional:i,paramsSerializer:o,headers:c}=n;i!==void 0&&KI.assertOptions(i,{silentJSONParsing:Bd.transitional(Bd.boolean),forcedJSONParsing:Bd.transitional(Bd.boolean),clarifyTimeoutError:Bd.transitional(Bd.boolean)},!1),o!=null&&(Qe.isFunction(o)?n.paramsSerializer={serialize:o}:KI.assertOptions(o,{encode:Bd.function,serialize:Bd.function},!0)),KI.assertOptions(n,{baseUrl:Bd.spelling("baseURL"),withXsrfToken:Bd.spelling("withXSRFToken")},!0),n.method=(n.method||this.defaults.method||"get").toLowerCase();let u=c&&Qe.merge(c.common,c[n.method]);c&&Qe.forEach(["delete","get","head","post","put","patch","common"],P=>{delete c[P]}),n.headers=Hu.concat(u,c);const h=[];let m=!0;this.interceptors.request.forEach(function(P){typeof P.runWhen=="function"&&P.runWhen(n)===!1||(m=m&&P.synchronous,h.unshift(P.fulfilled,P.rejected))});const _=[];let y;this.interceptors.response.forEach(function(P){_.push(P.fulfilled,P.rejected)});let S,w=0;if(!m){const P=[C6.bind(this),void 0];for(P.unshift.apply(P,h),P.push.apply(P,_),S=P.length,y=tt.resolve(n);w<S;)y=y.then(P[w++],P[w++]);return y}S=h.length;let I=n;for(w=0;w<S;){const P=h[w++],B=h[w++];try{I=P(I)}catch(M){B.call(this,M);break}}try{y=C6.call(this,I)}catch(P){return tt.reject(P)}for(w=0,S=_.length;w<S;)y=y.then(_[w++],_[w++]);return y}getUri(e){return k3(h6((e=Xg(this.defaults,e)).baseURL,e.url),e.params,e.paramsSerializer)}};Qe.forEach(["delete","get","head","options"],function(e){qI.prototype[e]=function(n,i){return this.request(Xg(i||{},{method:e,url:n,data:(i||{}).data}))}}),Qe.forEach(["post","put","patch"],function(e){function n(i){return function(o,c,u){return this.request(Xg(u||{},{method:e,headers:i?{"Content-Type":"multipart/form-data"}:{},url:o,data:c}))}}qI.prototype[e]=n(),qI.prototype[e+"Form"]=n(!0)});var $I=qI;class z1{constructor(n){if(typeof n!="function")throw new TypeError("executor must be a function.");let i;this.promise=new tt(function(c){i=c});const o=this;this.promise.then(c=>{if(!o._listeners)return;let u=o._listeners.length;for(;u-- >0;)o._listeners[u](c);o._listeners=null}),this.promise.then=c=>{let u;const h=new tt(m=>{o.subscribe(m),u=m}).then(c);return h.cancel=function(){o.unsubscribe(u)},h},n(function(c,u,h){o.reason||(o.reason=new Hy(c,u,h),i(o.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(n){this.reason?n(this.reason):this._listeners?this._listeners.push(n):this._listeners=[n]}unsubscribe(n){if(!this._listeners)return;const i=this._listeners.indexOf(n);i!==-1&&this._listeners.splice(i,1)}toAbortSignal(){const n=new AbortController,i=o=>{n.abort(o)};return this.subscribe(i),n.signal.unsubscribe=()=>this.unsubscribe(i),n.signal}static source(){let n;return{token:new z1(function(o){n=o}),cancel:n}}}var yhe=z1;const H1={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(H1).forEach(e=>{let[n,i]=e;H1[i]=n});var vhe=H1;const Ns=function e(n){const i=new $I(n),o=p3($I.prototype.request,i);return Qe.extend(o,$I.prototype,i,{allOwnKeys:!0}),Qe.extend(o,i,null,{allOwnKeys:!0}),o.create=function(c){return e(Xg(n,c))},o}(L1);Ns.Axios=$I,Ns.CanceledError=Hy,Ns.CancelToken=yhe,Ns.isCancel=c6,Ns.VERSION=I6,Ns.toFormData=II,Ns.AxiosError=Xn,Ns.Cancel=Ns.CanceledError,Ns.all=function(e){return tt.all(e)},Ns.spread=function(e){return function(n){return e.apply(null,n)}},Ns.isAxiosError=function(e){return Qe.isObject(e)&&e.isAxiosError===!0},Ns.mergeConfig=Xg,Ns.AxiosHeaders=Hu,Ns.formToJSON=e=>o6(Qe.isHTMLForm(e)?new FormData(e):e),Ns.getAdapter=R6.getAdapter,Ns.HttpStatusCode=vhe,Ns.default=Ns;var Mo=Ns;const She=()=>{};function A0(){const e={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:She};return e.promise=new tt((n,i)=>{e.resolve=o=>{e.isFinished||(e.isResolved=!0,e.isFinished=!0,n(o),e.value=o)},e.reject=o=>{e.isFinished||(e.isRejected=!0,e.isFinished=!0,i(o))}}),e}const YI=new Map,XI=new Map,Wd=new Map;let Ai=function(e){return e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.HARMONY_OS="HarmonyOS",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS="Mac OS",e.CHROMIUM_OS="Chromium OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot",e}({}),Ln=function(e){return e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger",e}({});const O6=new Vce;let Ku=O6.getResult(),K1=null;function Tn(e){if(!K1){Ku=O6.getResult();const n=function(m){if(m.engine.name==="Blink"&&m.browser.name!=="WeChat")return Ln.CHROME;switch(m.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return Ln.CHROME;case"Safari":case"Mobile Safari":return Ln.SAFARI;case"Edge":return Ln.EDGE;case"Firefox":return Ln.FIREFOX;case"QQ":case"QQBrowser":return Ln.QQ;case"Opera":return Ln.OPERA;case"WeChat":return Ln.WECHAT;default:return m.browser.name||""}}(Ku),i=P6(Ku),o=function(m){return m.os.name==="Windows"?m.os.version?m.os.name+" "+m.os.version:m.os.name:m.os.name||""}(Ku),c=Ku.os.version,u=P6(Ku,!1),h=Ku.device.type;if(!(n&&i&&o&&c))return{name:n,version:i,os:o,osVersion:c,browserVersion:u,deviceType:h};K1={name:n,version:i,os:o,osVersion:c,browserVersion:u,deviceType:h}}return K1}function P6(e){let n,i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return n=e.engine.name==="Blink"?e.engine.version||"":e.browser.version||"",i?n.split(".")[0]:n}function JI(){return Tn().os}function N6(){const e=Tn();return"".concat(e.os," ").concat(e.osVersion)}function QI(){const e=Tn();return!!(Ku.engine.name==="WebKit"&&e.os===Ai.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==Ln.SAFARI||co()&&e.name!==Ln.SAFARI)}function Tf(){return Tn().name===Ln.CHROME}function ls(){return Tn().name===Ln.SAFARI}function k6(){return Tn().name===Ln.EDGE}function Pr(){return Tn().name===Ln.FIREFOX}function co(){return Tn().os===Ai.IOS}function O0(e){const n=Tn();return!(n.name!==Ln.CHROME||!n.osVersion)&&Number(n.version)>=e}function D6(e){const n=Tn();return!(n.name!==Ln.CHROME||!n.osVersion)&&Number(n.version)<e}function q1(e,n,i){const o=Tn();return!(o.name!==e||!o.osVersion)&&(i?Number(o.version)>=n&&Number(o.version)<=i:Number(o.version)===n)}function $1(e){const n=Tn();return!(n.name!==Ln.EDGE||!n.osVersion)&&Number(n.version)>=e}function L6(e){const n=Tn();return!(n.name!==Ln.SAFARI||!n.osVersion)&&Number(n.version)>=e}function x6(e,n,i){const o=Tn();if(o.os!==Ai.IOS||!o.osVersion)return!1;const c=o.osVersion.split(".");return n&&Number(c[0])===e&&Number(c[1])<n||Number(c[0])<e}function M6(e,n,i){const o=Tn();if(o.name!==Ln.SAFARI||!o.osVersion||!o.browserVersion)return!1;const c=o.browserVersion.split(".");return i?n&&Number(c[0])===e&&Number(c[1])<n||Number(c[0])<e:n?Number(c[0])===e&&Number(c[1])<=n||Number(c[0])<e:Number(c[0])<=e}function Y1(e){const n=Tn();return!(n.name!==Ln.OPERA||!n.osVersion)&&Number(n.version)>=e}function U6(){const e=Tn();if(e.os!==Ai.IOS||!e.osVersion)return!1;const n=e.osVersion.split(".");return Number(n[0])<14||Number(n[0])===14&&Number(n[1])<=6}function Ky(){const e=Tn();if(e.os!==Ai.IOS||!e.osVersion)return!1;const n=e.osVersion.split(".");return Number(n[0])===15}function X1(){const e=Tn();if(e.os!==Ai.IOS||!e.osVersion)return!1;const n=e.osVersion.split(".");return Number(n[0])===16}function V6(){const e=Tn();if(e.os!==Ai.IOS||!e.osVersion)return!1;const n=e.osVersion.split(".");return Number(n[0])===15&&Number(n[1])>=1}function Gl(){return ls()&&navigator.maxTouchPoints>0}function F6(){return Tn().name===Ln.WECHAT}function j6(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function J1(){const e=JI();return function(){const{deviceType:n}=Tn();return n==="mobile"||n==="tablet"}()||e===Ai.ANDROID||e===Ai.IOS||e===Ai.HARMONY_OS}function bf(){const e=Tn();return e.name!==Ln.EDGE&&e.name!==Ln.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function ZI(){return JI()===Ai.ANDROID}function P0(){const e=Tn();return ZI()&&(e.name===Ln.CHROME||e.name===Ln.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function B6(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function ot(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?B6(Object(i),!0).forEach(function(o){Ut(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):B6(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function Ut(e,n,i){return(n=function(o){var c=function(u,h){if(typeof u!="object"||u===null)return u;var m=u[Symbol.toPrimitive];if(m!==void 0){var _=m.call(u,"string");if(typeof _!="object")return _;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(u)}(o);return typeof c=="symbol"?c:String(c)}(n))in e?Object.defineProperty(e,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[n]=i,e}let Y=function(e){return e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",e.DATACHANNEL_FAILED="DATACHANNEL_FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e.INVALID_PLUGIN="INVALID_PLUGIN",e.DISCONNECT_P2P="DISCONNECT_P2P",e.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",e.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",e.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",e.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",e.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",e.PROHIBITED_OPERATION="PROHIBITED_OPERATION",e.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",e.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",e}({}),Ce=class extends Error{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",i=arguments.length>2?arguments[2]:void 0;super(n),Ut(this,"code",void 0),Ut(this,"message",void 0),Ut(this,"data",void 0),Ut(this,"name","AgoraRTCException"),this.code=e,this.message="AgoraRTCError ".concat(this.code,": ").concat(n),this.data=i}toString(){return this.data?"".concat(this.message,`
data: `).concat(JSON.stringify(this.data)):this.message}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",n=arguments.length>1?arguments[1]:void 0;return e==="error"&&(n||console).error(this.toString()),e==="warning"&&(n||console).warn(this.toString()),this}throw(e){throw this.print("error",e),this}};function wf(e,n){if(typeof e!="boolean")throw new Ce(Y.INVALID_PARAMS,"Invalid ".concat(n,": The value is of the boolean type."))}function Ti(e,n,i){if(!Xe(i).call(i,e))throw new Ce(Y.INVALID_PARAMS,"".concat(n," can only be set as ").concat(JSON.stringify(i)))}function Jn(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(e<i||e>o||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(c){return typeof c=="number"&&c%1==0}(e))throw new Ce(Y.INVALID_PARAMS,"invalid ".concat(n,": the value range is [").concat(i,", ").concat(o,"]. integer only"))}function Q1(e,n){if(typeof e!="number"){if(!(e.min||e.max||e.ideal||e.exact))throw new Ce(Y.INVALID_PARAMS,"".concat(n," is not a valid ConstrainLong"));e.min!==void 0&&Jn(e.min,"".concat(n,".min"),0,1/0),e.max!==void 0&&Jn(e.max,"".concat(n,".max"),1,1/0),e.exact!==void 0&&Jn(e.exact,"".concat(n,".exact"),1,1/0),e.ideal!==void 0&&Jn(e.ideal,"".concat(n,".ideal"),1,1/0)}else Jn(e,n,1,1/0)}function qi(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,c=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(e==null)throw new Ce(Y.INVALID_PARAMS,"".concat(n||"param"," cannot be empty"));if(!W6(e,i,o,c))throw new Ce(Y.INVALID_PARAMS,"Invalid ".concat(n||"string param",": Length of the string: [").concat(i,",").concat(o,"].").concat(c?" ASCII characters only.":""))}function Rf(e,n){if(!Array.isArray(e))throw new Ce(Y.INVALID_PARAMS,"".concat(n," should be an array"))}function Nr(e){return e==null}function W6(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,o=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof e=="string"&&e.length<=i&&e.length>=n&&(!o||function(c){if(typeof c!="string")return!1;for(let u=0;u<c.length;u+=1){const h=c.charCodeAt(u);if(h<0||h>255)return!1}return!0}(e))}var N0=function(e){return e.COVERED="COVERED",e.POSITION="POSITION",e.SIZE="SIZE",e.STYLE="STYLE",e}(N0||{}),Z1=function(e){return e.UNMOUNTED="UNMOUNTED",e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",e}(Z1||{});const G6=new class{constructor(){Ut(this,"_clientSize",null),Ut(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),Ut(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),Ut(this,"getStyle",e=>window.getComputedStyle(e,null)),Ut(this,"checkCssVisibleProperty",e=>{var n;let i=!0;const o=this.getStyle(e),{display:c,visibility:u,opacity:h,filter:m}=o;return(c==="none"||Xe(n=["hidden","collapse"]).call(n,u)||Number(h)<.1)&&(i=!1),!!i&&(m&&m.split(" ").filter(_=>{var y;const S=_.split("(")[0];return Xe(y=["brightness","blur","opacity"]).call(y,S)}).map(_=>{const[y,S]=_.split(/\(|\)/);return[y,Number(S.match(/^[0-9\.]+/))]}).forEach(_=>{const[y,S]=_;switch(y){case"brightness":(S<.1||S>3)&&(i=!1);break;case"blur":S>3&&(i=!1);break;case"opacity":S<.1&&(i=!1)}}),i)}),Ut(this,"checkPropertyUpToAllParentNodes",(e,n)=>{let i=!0,o=!0;const c=h=>n(h);let u=e;for(;u&&o;)c(u)||(i=!1,o=!1),u=u.parentElement,u||(o=!1);return i}),Ut(this,"checkActualCssVisibleIncludeInherit",e=>this.checkPropertyUpToAllParentNodes(e,this.checkCssVisibleProperty)),Ut(this,"getSizeAboutClient",e=>{const{width:n,height:i,left:o,right:c,top:u,bottom:h}=e.getBoundingClientRect(),m=this.getClientWidth(),_=this.getClientHeight();return{width:n,height:i,left:o,right:c,top:u,bottom:h,clientWidth:m,clientHeight:_,clientMin:Math.min(m,_)}}),Ut(this,"checkActualSize",()=>{const{width:e,height:n,clientMin:i}=this._clientSize;return this.checkSizeIsVisible(e,n,i)}),Ut(this,"elementFromPoint",(e,n)=>document.elementFromPoint?document.elementFromPoint(e,n):null),Ut(this,"checkCoverForAPoint",(e,n,i)=>{const o=this.elementFromPoint(e,n);return o!==null&&o!==i}),Ut(this,"getPointPositionList",()=>{const{width:e,height:n,left:i,top:o}=this._clientSize,c=e/6,u=n/6,h=[],m=10**6;for(let _=0;_<5;_++)for(let y=0;y<5;y++){const S=(i*m+(_===0?.1:_===4?(c*_*m-1e5)/m:c*_)*m)/m,w=(o*m+(y===0?.1:y===4?(u*y*m-1e5)/m:u*y)*m)/m;h.push({x:S,y:w})}return[...h]}),Ut(this,"checkElementCover",e=>this.getPointPositionList().map(n=>this.checkCoverForAPoint(n.x,n.y,e)).filter(n=>!!n).length>6),Ut(this,"checkSizeIsVisible",(e,n,i)=>(e>50||i/e<=10)&&(n>50||i/n<=10)),Ut(this,"checkSizeOfPartInClient",()=>{const{left:e,right:n,top:i,bottom:o,clientHeight:c,clientWidth:u,clientMin:h}=this._clientSize;let m,_,y,S;if(e<0)m=0;else{if(!(e<u))return!1;m=e}if(n<0)return!1;if(_=n<u?n:u,i<0)y=0;else{if(!(i<c))return!1;y=i}if(o<0)return!1;S=o<c?o:c;const w=_-m,I=S-y;return this.checkSizeIsVisible(w,I,h)}),Ut(this,"returnHiddenResult",e=>(this._clientSize=null,{visible:!1,reason:e})),Ut(this,"checkOneElementVisible",e=>{if(e instanceof HTMLElement){if(this.checkElementIsMountedOnDom(e)){if(this.checkActualCssVisibleIncludeInherit(e)){if(this._clientSize=this.getSizeAboutClient(e),this.checkElementCover(e))return this.returnHiddenResult(N0.COVERED);{const n=this.checkActualSize(),i=this.checkSizeOfPartInClient();return n&&!i?this.returnHiddenResult(N0.POSITION):n?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(N0.SIZE)}}return this.returnHiddenResult(N0.STYLE)}return this.returnHiddenResult(Z1.UNMOUNTED)}return this.returnHiddenResult(Z1.INVALID_HTML_ELEMENT)}),Ut(this,"checkElementIsMountedOnDom",e=>this.checkPropertyUpToAllParentNodes(e,n=>n.nodeName.toUpperCase()!=="HTML"?n.parentElement!==null:!!document.documentElement))}};function eL(e){return new TextEncoder().encode(e)}const z6=function(e,n){const i=new Uint8Array(e.byteLength+n.byteLength);return i.set(new Uint8Array(e),0),i.set(new Uint8Array(n),e.byteLength),i},tL=async e=>function(n,i){let o="";return new Uint8Array(n).forEach(c=>{o+=c.toString(i).padStart(2,"0")}),o}(await crypto.subtle.digest("SHA-256",eL(e)),16);let Rr=class{constructor(){Ut(this,"_events",{}),Ut(this,"addListener",this.on)}getListeners(e){return this._events[e]?this._events[e].map(n=>n.listener):[]}on(e,n){this._events[e]||(this._events[e]=[]);const i=this._events[e];this._indexOfListener(i,n)===-1&&i.push({listener:n,once:!1})}once(e,n){this._events[e]||(this._events[e]=[]);const i=this._events[e];this._indexOfListener(i,n)===-1&&i.push({listener:n,once:!0})}off(e,n){if(!this._events[e])return;const i=this._events[e],o=this._indexOfListener(i,n);o!==-1&&i.splice(o,1),this._events[e].length===0&&delete this._events[e]}removeAllListeners(e){e?delete this._events[e]:this._events={}}emit(e){this._events[e]||(this._events[e]=[]);const n=this._events[e].map(u=>u);for(var i=arguments.length,o=new Array(i>1?i-1:0),c=1;c<i;c++)o[c-1]=arguments[c];for(let u=0;u<n.length;u+=1){const h=n[u];h.once&&this.off(e,h.listener),h.listener.apply(this,o||[])}}safeEmit(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];[...this._events[e]||[]].forEach(c=>{c.once&&this.off(e,c.listener);try{c.listener.apply(this,i)}catch(u){console.error("safeEmit event:".concat(e," error ").concat(u==null?void 0:u.toString()))}})}_indexOfListener(e,n){let i=e.length;for(;i--;)if(e[i].listener===n)return i;return-1}},k0=null;function H6(){if(k0)return k0;if(window.electron)return k0=window.electron;if(!window.require)return null;try{return k0=window.require("electron"),k0}catch{return null}}let fi=function(e){return e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.PRELOAD="PRELOAD",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.MASS_SUBSCRIBE="Client.massSubscribe",e.MASS_UNSUBSCRIBE="Client.massUnsubscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",e.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",e.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange",e.CONNECTION_STATE_CHANGE="connectionStateChange",e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",e.IMAGE_MODERATION_UPLOAD="imageModerationUpload",e.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",e}({}),kr=function(e){return e.TRACER="tracer",e}({});function K6(e){return Jn(e.timeout,"config.timeout",0,1e5),Jn(e.timeoutFactor,"config.timeoutFactor",0,100,!1),Jn(e.maxRetryCount,"config.maxRetryConfig",0,1/0),Jn(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let The=function(e){return e[e.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",e[e.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",e[e.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",e}({}),Vn=function(e){return e.LEAVE="LEAVE",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.UID_BANNED="UID_BANNED",e.FALLBACK="FALLBACK",e.IP_BANNED="IP_BANNED",e.CHANNEL_BANNED="CHANNEL_BANNED",e.LICENSE_MISSING="LICENSE_MISSING",e.LICENSE_EXPIRED="LICENSE_EXPIRED",e.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",e.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",e.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",e.LICENSE_ILLEGAL="LICENSE_ILLEGAL",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e}({});function D0(e){if(!Array.isArray(e)||e.length<1)return!1;try{e.forEach(n=>{if(!n.urls)throw Error()})}catch{return!1}return!0}function q6(e){return qi(e.turnServerURL,"turnServerURL"),qi(e.username,"username"),qi(e.password,"password"),e.udpport&&Jn(e.udpport,"udpport",1,99999,!0),e.forceturn&&wf(e.forceturn,"forceturn"),e.security&&wf(e.security,"security"),e.tcpport&&Jn(e.tcpport,"tcpport",1,99999,!0),!0}function nL(e){return e.level!==void 0&&Ti(e.level,"level",[1,2,3]),e.delay!==void 0&&Jn(e.delay,"delay",0,3e3,!0),!0}let an=function(e){return e.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",e.AUDIO_METADATA="audio-metadata",e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.EXCEPTION="exception",e.ERROR="error",e.P2P_LOST="p2p_lost",e.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",e.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",e.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",e.PUBLISHED_USER_LIST="published-user-list",e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",e.CONTENT_INSPECT_ERROR="content-inspect-error",e.CONTENT_INSPECT_RESULT="content-inspect-result",e.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",e}({}),us=function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",e}({}),ja=function(e){return e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({}),qy=function(e){return e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({});function ds(e,n){for(var i=arguments.length,o=new Array(i>2?i-2:0),c=2;c<i;c++)o[c-2]=arguments[c];return e.getListeners(n).length===0?tt.reject(new Ce(Y.UNEXPECTED_ERROR,"can not emit promise")):new tt((u,h)=>{e.emit(n,...o,u,h)})}function nr(e,n){if(e.getListeners(n).length===0)return tt.resolve();for(var i=arguments.length,o=new Array(i>2?i-2:0),c=2;c<i;c++)o[c-2]=arguments[c];return ds(e,n,...o)}function _c(e,n){if(e.getListeners(n).length===0)return null;for(var i=arguments.length,o=new Array(i>2?i-2:0),c=2;c<i;c++)o[c-2]=arguments[c];return L0(e,n,...o)}function L0(e,n){let i=null,o=null;for(var c=arguments.length,u=new Array(c>2?c-2:0),h=2;h<c;h++)u[h-2]=arguments[h];if(e.emit(n,...u,m=>{i=m},m=>{o=m}),o!==null)throw o;if(i===null)throw new Ce(Y.UNEXPECTED_ERROR,"handler is not sync");return i}const ri=new class extends Rr{set networkState(e){this.emit(qy.NETWORK_STATE_CHANGE,e,this._networkState),e===ja.ONLINE?this.emit(qy.ONLINE):e===ja.OFFLINE&&(this.onlineWaiter=new tt(n=>{this.once(qy.ONLINE,()=>{this.onlineWaiter=void 0,n(ja.ONLINE)})}),this.emit(qy.OFFLINE)),this._networkState=e}get networkState(){return this._networkState}get isOnline(){return this._networkState===ja.ONLINE}constructor(){super(),Ut(this,"_moduleName","network-indicator"),Ut(this,"_networkState",ja.ONLINE),Ut(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=ja.ONLINE}),window.addEventListener("offline",()=>{this.networkState=ja.OFFLINE})}};function eA(e,n){const i=e.indexOf(n);i!==-1&&e.splice(i,1)}function $y(e){const n=[];return e.forEach(i=>{n.indexOf(i)===-1&&n.push(i)}),n}function tA(e){tt!==void 0?tt.resolve().then(e):setTimeout(e,0)}function Dr(e){return JSON.parse(JSON.stringify(e))}function Jg(e){try{return Dr(e)}catch{return e}}const $6={};function Jp(e,n){$6[n]||($6[n]=!0,e())}function Qg(e){const n=window.atob(e),i=new Uint8Array(new ArrayBuffer(n.length));for(let o=0;o<n.length;o+=1)i[o]=n.charCodeAt(o);return i}function Qp(e){let n="";for(let i=0;i<e.length;i+=1)n+=String.fromCharCode(e[i]);return window.btoa(n)}function Y6(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,i=new TextEncoder().encode(e);if(i.length>n)i=i.slice(0,n);else if(i.length<n){const o=new Uint8Array(n);o.set(i),i=o}return i}function X6(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];const o=Da(n).call(n,(h,m)=>h+m.length,0),c=new Uint8Array(new ArrayBuffer(o));let u=0;return n.forEach(h=>{c.set(h,u),u+=h.length}),c}function Gd(e){return window.TextEncoder?new TextEncoder().encode(e).length:e.length}function J6(e){let n=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&e.realFormData&&(e=e.realFormData),e.forEach(i=>{n+=typeof i=="string"?Gd(i):i.size}),n+138}function bhe(e){const n=new Ce(Y.TIMEOUT,"timeout");return new tt((i,o)=>{window.setTimeout(()=>o(n),e)})}function $i(e){return new tt(n=>{window.setTimeout(n,e)})}function rr(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,n=arguments.length>1?arguments[1]:void 0;const i=Math.random().toString(16).substr(2,e).toLowerCase();return i.length===e?"".concat(n).concat(i):"".concat(n).concat(i)+rr(e-i.length,"")}function Zg(){return rr(32,"").toUpperCase()}const nA=()=>{},Q6=new class{constructor(){Ut(this,"fnMap",new Map)}throttleByKey(e,n,i,o){for(var c=arguments.length,u=new Array(c>4?c-4:0),h=4;h<c;h++)u[h-4]=arguments[h];if(this.fnMap.has(n)){const m=this.fnMap.get(n);if(m.threshold!==i){m.fn(...m.args),clearTimeout(m.timer);const _=window.setTimeout(()=>{const y=this.fnMap.get(n);y&&y.fn(...y.args),this.fnMap.delete(n)},i);this.fnMap.set(n,{fn:e,threshold:i,timer:_,args:u,skipFn:o})}else m.skipFn&&m.skipFn(...m.args),this.fnMap.set(n,ot(ot({},m),{},{fn:e,args:u,skipFn:o}))}else{const m=window.setTimeout(()=>{const _=this.fnMap.get(n);_&&_.fn(..._.args),this.fnMap.delete(n)},i);this.fnMap.set(n,{fn:e,threshold:i,timer:m,args:u,skipFn:o})}}},Z6=Q6.throttleByKey.bind(Q6);function eW(e){return typeof e=="object"&&e!==null&&!(e instanceof RegExp)}function rL(e,n){if(!eW(e)||!eW(n)||Array.isArray(e)&&!Array.isArray(n)||!Array.isArray(e)&&Array.isArray(n))return n;if(Array.isArray(n)&&Array.isArray(e)){const i=[...e];for(let o=0;o<n.length;o++)i[o]=rL(e[o],n[o]);return i}{const i=ot({},e);for(const o in n)Object.prototype.hasOwnProperty.call(n,o)&&(Object.prototype.hasOwnProperty.call(e,o)?i[o]=rL(e[o],n[o]):i[o]=n[o]);return i}}function tW(e,n){let i=[0];if(i=new Array(n).fill(0),e===0)return i;let o=0;for(;e>0&&(i[o]=255&e,e>>=8,o++,o!==n););return i}function iL(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function nW(e){const n="0123456789abcdef";function i(ae){let me,ge="";for(me=0;me<=3;me++)ge+=n.charAt(ae>>8*me+4&15)+n.charAt(ae>>8*me&15);return ge}function o(ae,me){const ge=(65535&ae)+(65535&me);return(ae>>16)+(me>>16)+(ge>>16)<<16|65535&ge}function c(ae,me,ge,pe,we,Be){return o(function(nt,st){return nt<<st|nt>>>32-st}(o(o(me,ae),o(pe,Be)),we),ge)}function u(ae,me,ge,pe,we,Be,nt){return c(me&ge|~me&pe,ae,me,we,Be,nt)}function h(ae,me,ge,pe,we,Be,nt){return c(me&pe|ge&~pe,ae,me,we,Be,nt)}function m(ae,me,ge,pe,we,Be,nt){return c(me^ge^pe,ae,me,we,Be,nt)}function _(ae,me,ge,pe,we,Be,nt){return c(ge^(me|~pe),ae,me,we,Be,nt)}const y=function(ae){let me;const ge=1+(ae.length+8>>6),pe=new Array(16*ge);for(me=0;me<16*ge;me++)pe[me]=0;for(me=0;me<ae.length;me++)pe[me>>2]|=ae.charCodeAt(me)<<me%4*8;return pe[me>>2]|=128<<me%4*8,pe[16*ge-2]=8*ae.length,pe}(e);let S,w,I,P,B,M=1732584193,U=-271733879,q=-1732584194,$=271733878;for(S=0;S<y.length;S+=16)w=M,I=U,P=q,B=$,M=u(M,U,q,$,y[S+0],7,-680876936),$=u($,M,U,q,y[S+1],12,-389564586),q=u(q,$,M,U,y[S+2],17,606105819),U=u(U,q,$,M,y[S+3],22,-1044525330),M=u(M,U,q,$,y[S+4],7,-176418897),$=u($,M,U,q,y[S+5],12,1200080426),q=u(q,$,M,U,y[S+6],17,-1473231341),U=u(U,q,$,M,y[S+7],22,-45705983),M=u(M,U,q,$,y[S+8],7,1770035416),$=u($,M,U,q,y[S+9],12,-1958414417),q=u(q,$,M,U,y[S+10],17,-42063),U=u(U,q,$,M,y[S+11],22,-1990404162),M=u(M,U,q,$,y[S+12],7,1804603682),$=u($,M,U,q,y[S+13],12,-40341101),q=u(q,$,M,U,y[S+14],17,-1502002290),U=u(U,q,$,M,y[S+15],22,1236535329),M=h(M,U,q,$,y[S+1],5,-165796510),$=h($,M,U,q,y[S+6],9,-1069501632),q=h(q,$,M,U,y[S+11],14,643717713),U=h(U,q,$,M,y[S+0],20,-373897302),M=h(M,U,q,$,y[S+5],5,-701558691),$=h($,M,U,q,y[S+10],9,38016083),q=h(q,$,M,U,y[S+15],14,-660478335),U=h(U,q,$,M,y[S+4],20,-405537848),M=h(M,U,q,$,y[S+9],5,568446438),$=h($,M,U,q,y[S+14],9,-1019803690),q=h(q,$,M,U,y[S+3],14,-187363961),U=h(U,q,$,M,y[S+8],20,1163531501),M=h(M,U,q,$,y[S+13],5,-1444681467),$=h($,M,U,q,y[S+2],9,-51403784),q=h(q,$,M,U,y[S+7],14,1735328473),U=h(U,q,$,M,y[S+12],20,-1926607734),M=m(M,U,q,$,y[S+5],4,-378558),$=m($,M,U,q,y[S+8],11,-2022574463),q=m(q,$,M,U,y[S+11],16,1839030562),U=m(U,q,$,M,y[S+14],23,-35309556),M=m(M,U,q,$,y[S+1],4,-1530992060),$=m($,M,U,q,y[S+4],11,1272893353),q=m(q,$,M,U,y[S+7],16,-155497632),U=m(U,q,$,M,y[S+10],23,-1094730640),M=m(M,U,q,$,y[S+13],4,681279174),$=m($,M,U,q,y[S+0],11,-358537222),q=m(q,$,M,U,y[S+3],16,-722521979),U=m(U,q,$,M,y[S+6],23,76029189),M=m(M,U,q,$,y[S+9],4,-640364487),$=m($,M,U,q,y[S+12],11,-421815835),q=m(q,$,M,U,y[S+15],16,530742520),U=m(U,q,$,M,y[S+2],23,-995338651),M=_(M,U,q,$,y[S+0],6,-198630844),$=_($,M,U,q,y[S+7],10,1126891415),q=_(q,$,M,U,y[S+14],15,-1416354905),U=_(U,q,$,M,y[S+5],21,-57434055),M=_(M,U,q,$,y[S+12],6,1700485571),$=_($,M,U,q,y[S+3],10,-1894986606),q=_(q,$,M,U,y[S+10],15,-1051523),U=_(U,q,$,M,y[S+1],21,-2054922799),M=_(M,U,q,$,y[S+8],6,1873313359),$=_($,M,U,q,y[S+15],10,-30611744),q=_(q,$,M,U,y[S+6],15,-1560198380),U=_(U,q,$,M,y[S+13],21,1309151649),M=_(M,U,q,$,y[S+4],6,-145523070),$=_($,M,U,q,y[S+11],10,-1120210379),q=_(q,$,M,U,y[S+2],15,718787259),U=_(U,q,$,M,y[S+9],21,-343485551),M=o(M,w),U=o(U,I),q=o(q,P),$=o($,B);return i(M)+i(U)+i(q)+i($)}let whe=1,rW=console,Es=class{static setLogger(e){rW=e}constructor(e,n){Ut(this,"id",void 0),Ut(this,"lockingPromise",tt.resolve()),Ut(this,"locks",0),Ut(this,"name",""),Ut(this,"lockId",void 0),this.lockId=whe++,e&&(this.name=e),n&&(this.id=n),this.logger("created")}logger(e,n){const i=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),o=e==="created"?"is ".concat(e,"."):"is ".concat(e,", current queue ").concat(this.locks,". ").concat(n??"");rW.debug("".concat(i," ").concat(o))}setId(e){this.id=e}get isLocked(){return this.locks>0}lock(e){let n;this.locks+=1,this.logger("locked",e);const i=new tt(c=>{n=()=>{this.locks-=1,this.logger("unlocked",e),c()}}),o=this.lockingPromise.then(()=>n);return this.lockingPromise=this.lockingPromise.then(()=>i),o}};function Yy(e,n){return function(i,o,c){const u=c.value;if(typeof u!="function")throw new Error("Cannot use mutex on object property.");return c.value=async function(){const h=this[n];if(!h)throw new Error("mutex property key ".concat(n," doesn't exist on ").concat(e));const m=await h.lock("From ".concat(e,".").concat(o));try{for(var _=arguments.length,y=new Array(_),S=0;S<_;S++)y[S]=arguments[S];return await u.apply(this,y)}finally{m()}},c}}const pi={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function sL(e,n){const i=Math.floor(n.timeout*Math.pow(n.timeoutFactor,e));return Math.min(n.maxRetryTimeout,i)}function qu(e,n,i,o){const c=Object.assign({},pi,o);let u=c.timeout;const h=async()=>{await function(y){return new tt(S=>{window.setTimeout(S,y)})}(u),u*=c.timeoutFactor,u=Math.min(c.maxRetryTimeout,u)};let m=!1;const _=new tt(async(y,S)=>{n=n||(()=>!1),i=i||(()=>!0);for(let w=0;w<c.maxRetryCount;w+=1){if(m)return S(new Ce(Y.OPERATION_ABORTED));try{const I=await e();if(!n(I,w)||w+1===c.maxRetryCount)return y(I);await h()}catch(I){if(!i(I,w)||w+1===c.maxRetryCount)return S(I);await h()}}});return _.cancel=()=>m=!0,_}let rA,iW=class{constructor(e){Ut(this,"input",[]),Ut(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}mean(){var e;return this.input.length===0?0:Da(e=this.input).call(e,(n,i)=>n+i)/this.input.length}},iA=0,oL=0;function aL(e,n,i,o){return new tt((c,u)=>{n.responseType=n.responseType||"json",n.data&&!i?(n.data=JSON.stringify(n.data),iA+=Gd(n.data)):i&&(n.data.size?iA+=n.data.size:n.data instanceof FormData?iA+=J6(n.data):iA+=Gd(JSON.stringify(n.data))),n.headers=n.headers||{},n.headers["Content-Type"]=n.headers["Content-Type"]||"application/json",n.method="POST",n.url=e,Mo.request(n).then(h=>{typeof h.data=="string"?oL+=Gd(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?oL+=h.data.byteLength:oL+=Gd(JSON.stringify(h.data)),c(h.data)}).catch(h=>{Mo.isCancel(h)?u(new Ce(Y.OPERATION_ABORTED,"cancel token canceled")):h.code==="ECONNABORTED"?u(new Ce(Y.NETWORK_TIMEOUT,h.message)):h.response?u(new Ce(Y.NETWORK_RESPONSE_ERROR,h.response.status)):u(new Ce(Y.NETWORK_ERROR,h.message))})})}async function Rhe(e,n){const i=new Blob([n.data],{type:"buffer"});return await aL(e,ot(ot({},n),{},{data:i,headers:{"Content-Type":"application/octet-stream"}}),!0)}const sW=()=>window.isSecureContext!==void 0;function zl(e){if(Array.isArray(e))return e.map(i=>i);if(!oW(e))return e;const n={};for(const i in e){const o=e[i];oW(o)||Array.isArray(o)?n[i]=zl(o):n[i]=o}return n}function oW(e){return!(typeof e!="object"||Array.isArray(e)||!e)}let cL=class{constructor(e){Ut(this,"input",[]),Ut(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}};const zd={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},x0={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:zd,remoteCandidate:zd},updateInterval:0},aW={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},cW={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},lW={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},uW={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0};let lL=class{constructor(e,n){Ut(this,"onFirstVideoReceived",void 0),Ut(this,"onFirstVideoDecoded",void 0),Ut(this,"onFirstAudioReceived",void 0),Ut(this,"onFirstVideoDecodedTimeout",void 0),Ut(this,"onFirstAudioDecoded",void 0),Ut(this,"onSelectedLocalCandidateChanged",void 0),Ut(this,"onSelectedRemoteCandidateChanged",void 0),Ut(this,"videoIsReady",!1),Ut(this,"videoIsReady2",{}),Ut(this,"pc",void 0),Ut(this,"options",void 0),Ut(this,"intervalTimer",void 0),Ut(this,"stats",zl(x0)),Ut(this,"isFirstVideoReceived",{}),Ut(this,"isFirstVideoDecoded",{}),Ut(this,"isFirstAudioReceived",{}),Ut(this,"isFirstAudioDecoded",{}),Ut(this,"isFirstVideoDecodedTimeout",{}),Ut(this,"lossRateWindowStats",[]),this.pc=e,this.options=n,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new tt(e=>{e({local:ot({},zd),remote:ot({},zd)})})}setVideoIsReady(e){this.videoIsReady=e}setVideoIsReady2(e,n){this.videoIsReady2[e]=n}getVideoIsReady(e){return this.videoIsReady2[e]||!1}setIsFirstAudioDecoded(e){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(e){this.lossRateWindowStats.push(e),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const n=this.lossRateWindowStats.length,i=["videoSend","audioSend","videoRecv","audioRecv"];let o=0,c=0,u=0,h=0;for(const m of i)e[m].forEach((_,y)=>{if(!this.lossRateWindowStats[n-1][m][y]||!this.lossRateWindowStats[0][m][y])return;const S=this.lossRateWindowStats[n-1][m][y].packets-this.lossRateWindowStats[0][m][y].packets,w=this.lossRateWindowStats[n-1][m][y].packetsLost-this.lossRateWindowStats[0][m][y].packetsLost;m==="videoSend"||m==="audioSend"?(o+=S,u+=w):(c+=S,h+=w),Number.isNaN(S)||Number.isNaN(S)?_.packetLostRate=0:_.packetLostRate=S<=0||w<=0?0:w/(S+w)});e.sendPacketLossRate=o<=0||u<=0?0:u/(o+u),e.recvPacketLossRate=c<=0||h<=0?0:h/(c+h)}},Che=class extends lL{constructor(){super(...arguments),Ut(this,"_stats",x0),Ut(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const e=await this._getStats(),n=this.statsResponsesToObjects(e);this._stats=zl(x0);const i=n.filter(c=>c.type==="ssrc");this.processSSRCStats(i);const o=n.find(c=>c.type==="VideoBwe");o&&this.processBandwidthStats(o),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(e){this._stats.bitrate={actualEncoded:Number(e.googActualEncBitrate),targetEncoded:Number(e.googTargetEncBitrate),retransmit:Number(e.googRetransmitBitrate),transmit:Number(e.googTransmitBitrate)},this._stats.sendBandwidth=Number(e.googAvailableSendBandwidth)}processSSRCStats(e){e.forEach(n=>{var i;const o=Xe(i=n.id).call(i,"send");switch("".concat(n.mediaType,"_").concat(o?"send":"recv")){case"video_send":{const c=zl(cW);c.codec=n.googCodecName,c.adaptionChangeReason="none",n.googCpuLimitedResolution&&(c.adaptionChangeReason="cpu"),n.googBandwidthLimitedResolution&&(c.adaptionChangeReason="bandwidth"),c.avgEncodeMs=Number(n.googAvgEncodeMs),c.inputFrame={width:Number(n.googFrameWidthInput)||Number(n.googFrameWidthSent),height:Number(n.googFrameHeightInput)||Number(n.googFrameHeightSent),frameRate:Number(n.googFrameRateInput)},c.sentFrame={width:Number(n.googFrameWidthSent),height:Number(n.googFrameHeightSent),frameRate:Number(n.googFrameRateInput)},c.firsCount=Number(n.googFirReceived),c.nacksCount=Number(n.googNacksReceived),c.plisCount=Number(n.googPlisReceived),c.frameCount=Number(n.framesEncoded),c.bytes=Number(n.bytesSent),c.packets=Number(n.packetsSent),c.packetsLost=Number(n.packetsLost),c.ssrc=Number(n.ssrc),c.rttMs=Number(n.googRtt||0),this._stats.videoSend.push(c),this._stats.rtt=c.rttMs;break}case"video_recv":{const c=zl(aW),u=this.lastDecodeVideoReceiverStats.get(Number(n.ssrc));if(c.codec=n.googCodecName,c.targetDelayMs=Number(n.googTargetDelayMs),c.renderDelayMs=Number(n.googRenderDelayMs),c.currentDelayMs=Number(n.googCurrentDelayMs),c.minPlayoutDelayMs=Number(n.googMinPlayoutDelayMs),c.decodeMs=Number(n.googDecodeMs),c.maxDecodeMs=Number(n.googMaxDecodeMs),c.receivedFrame={width:Number(n.googFrameWidthReceived),height:Number(n.googFrameHeightReceived),frameRate:Number(n.googFrameRateReceived)},c.decodedFrame={width:Number(n.googFrameWidthReceived),height:Number(n.googFrameHeightReceived),frameRate:Number(n.googFrameRateDecoded)},c.decodeFrameRate=Number(n.googFrameRateDecoded),c.outputFrame={width:Number(n.googFrameWidthReceived),height:Number(n.googFrameHeightReceived),frameRate:Number(n.googFrameRateOutput)},c.jitterBufferMs=Number(n.googJitterBufferMs),c.firsCount=Number(n.googFirsSent),c.nacksCount=Number(n.googNacksSent),c.plisCount=Number(n.googPlisSent),c.framesDecodeCount=Number(n.framesDecoded),c.bytes=Number(n.bytesReceived),c.packets=Number(n.packetsReceived),c.packetsLost=Number(n.packetsLost),c.ssrc=Number(n.ssrc),c.packets>0&&!this.isFirstVideoReceived[c.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(c.ssrc),this.isFirstVideoReceived[c.ssrc]=!0),c.framesDecodeCount>0&&!this.isFirstVideoDecoded[c.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(c.ssrc,c.decodedFrame.width,c.decodedFrame.height),this.isFirstVideoDecoded[c.ssrc]=!0),u){const h=u.stats,m=Date.now()-u.lts;c.framesDecodeFreezeTime=h.framesDecodeFreezeTime,c.framesDecodeInterval=h.framesDecodeInterval,c.framesDecodeCount>h.framesDecodeCount&&this.isFirstVideoDecoded[c.ssrc]?(u.lts=Date.now(),c.framesDecodeInterval=m,c.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(n.ssrc,10))?c.framesDecodeFreezeTime+=c.framesDecodeInterval:this.setVideoIsReady2(parseInt(n.ssrc,10),!0))):c.framesDecodeCount<u.stats.framesDecodeCount&&(c.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(c.ssrc,{stats:ot({},c),lts:Date.now()}),this._stats.videoRecv.push(c);break}case"audio_recv":{const c=zl(uW);c.codec=n.googCodecName,c.outputLevel=Math.abs(Number(n.audioOutputLevel))/32767,c.decodingCNG=Number(n.googDecodingCNG),c.decodingCTN=Number(n.googDecodingCTN),c.decodingCTSG=Number(n.googDecodingCTSG),c.decodingNormal=Number(n.googDecodingNormal),c.decodingPLC=Number(n.googDecodingPLC),c.decodingPLCCNG=Number(n.googDecodingPLCCNG),c.expandRate=Number(n.googExpandRate),c.accelerateRate=Number(n.googAccelerateRate),c.preemptiveExpandRate=Number(n.googPreemptiveExpandRate),c.secondaryDecodedRate=Number(n.googSecondaryDecodedRate),c.speechExpandRate=Number(n.googSpeechExpandRate),c.preferredJitterBufferMs=Number(n.googPreferredJitterBufferMs),c.jitterBufferMs=Number(n.googJitterBufferMs),c.jitterMs=Number(n.googJitterReceived),c.bytes=Number(n.bytesReceived),c.packets=Number(n.packetsReceived),c.packetsLost=Number(n.packetsLost),c.ssrc=Number(n.ssrc),c.receivedFrames=Number(n.googDecodingCTN)||Number(n.packetsReceived),c.droppedFrames=Number(n.googDecodingPLC)+Number(n.googDecodingPLCCNG)||Number(n.packetsLost),c.receivedFrames>0&&!this.isFirstAudioReceived[c.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(c.ssrc),this.isFirstAudioReceived[c.ssrc]=!0),c.decodingNormal>0&&!this.isFirstAudioDecoded[c.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(c.ssrc),this.isFirstAudioDecoded[c.ssrc]=!0),this._stats.audioRecv.push(c);break}case"audio_send":{const c=zl(lW);c.codec=n.googCodecName,c.inputLevel=Math.abs(Number(n.audioInputLevel))/32767,c.aecReturnLoss=Number(n.googEchoCancellationReturnLoss||0),c.aecReturnLossEnhancement=Number(n.googEchoCancellationReturnLossEnhancement||0),c.residualEchoLikelihood=Number(n.googResidualEchoLikelihood||0),c.residualEchoLikelihoodRecentMax=Number(n.googResidualEchoLikelihoodRecentMax||0),c.bytes=Number(n.bytesSent),c.packets=Number(n.packetsSent),c.packetsLost=Number(n.packetsLost),c.ssrc=Number(n.ssrc),c.rttMs=Number(n.googRtt||0),this._stats.rtt=c.rttMs,this._stats.audioSend.push(c);break}}})}_getStats(){return new tt((e,n)=>{this.pc.getStats(e,n)})}statsResponsesToObjects(e){const n=[];return e.result().forEach(i=>{const o={id:i.id,timestamp:i.timestamp.valueOf().toString(),type:i.type};i.names().forEach(c=>{o[c]=i.stat(c)}),n.push(o)}),n}},M0=function(e){return e.BANDWIDTH="bandwidth",e.CPU="cpu",e.NONE="none",e.OTHER="other",e}({}),sA=function(e){return e.L1T1="L1T1",e.L1T2="L1T2",e.L1T3="L1T3",e.L1T3_KEY="L1T3_KEY",e.L2T1_KEY="L2T1_KEY",e.L2T2_KEY="L2T2_KEY",e.L2T3_KEY="L2T3_KEY",e.L3T1_KEY="L3T1_KEY",e.L3T2_KEY="L3T2_KEY",e.L3T3_KEY="L3T3_KEY",e}({}),uL=function(e){return e[e.new=0]="new",e[e.connecting=1]="connecting",e[e.connected=2]="connected",e[e.disconnected=3]="disconnected",e[e.failed=4]="failed",e[e.closed=5]="closed",e}({}),Ec=function(e){return e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver",e}({});var Xy=function(e){return e[e.kNone=1]="kNone",e[e.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",e[e.kBytesToBits=8]="kBytesToBits",e}(Xy||{});function U0(e,n,i,o){let c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:Xy.kNone;if(!n)return;const u=Number(n[i]);if(typeof u!="number")return;const h=Number(n[o]);if(typeof h!="number")return;if(!e)return h?u/h*c:void 0;const m=Number(e[i]);if(typeof m!="number")return;const _=Number(e[o]);if(typeof _!="number")return;const y=h-_;return y?(u-m)/y*c:void 0}let dW=class extends lL{constructor(){super(...arguments),Ut(this,"_stats",x0),Ut(this,"report",void 0),Ut(this,"lastDecodeVideoReceiverStats",new Map),Ut(this,"lastVideoFramesRecv",new Map),Ut(this,"lastVideoFramesSent",new Map),Ut(this,"lastVideoFramesDecode",new Map),Ut(this,"lastVideoFramesOutput",new Map),Ut(this,"lastVideoJBDelay",new Map),Ut(this,"lastAudioJBDelay",new Map),Ut(this,"mediaBytesSent",new Map),Ut(this,"mediaBytesRetransmit",new Map),Ut(this,"mediaBytesTargetEncode",new Map),Ut(this,"lastDecodeAudioReceiverStats",new Map),Ut(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=zl(x0),this.report.forEach(e=>{switch(e.type){case Ec.OUTBOUND:case Ec.INBOUND:{const n=e.mediaType||e.kind,i=!n&&"frameWidth"in e,o=!n&&!("frameWidth"in e);e.type===Ec.OUTBOUND?n==="audio"||o?this.processAudioOutboundStats(e):(n==="video"||i)&&this.processVideoOutboundStats(e):e.type===Ec.INBOUND&&(n==="audio"||o?this.processAudioInboundStats(e):(n==="video"||i)&&this.processVideoInboundStats(e));break}case Ec.TRANSPORT:{const n=this.report.get(e.selectedCandidatePairId);n&&this.processCandidatePairStats(n);break}case Ec.CANDIDATE_PAIR:e.selected&&this.processCandidatePairStats(e)}}),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const e=await this.pc.getStats(),n={local:ot({},zd),remote:ot({},zd)};return e.forEach(i=>{let o;if(i.type===Ec.TRANSPORT&&(o=e.get(i.selectedCandidatePairId)),i.type===Ec.CANDIDATE_PAIR&&i.selected&&(o=i),o){const c=(u,h)=>{u.type=h.type,u.id=h.id,h.address&&(u.address=h.address),h.candidateType&&(u.candidateType=h.candidateType),h.port&&(u.port=h.port),h.priority&&(u.priority=h.priority),h.protocol&&(u.protocol=h.protocol),h.relayProtocol&&(u.relayProtocol=h.relayProtocol)};if(o.localCandidateId){const u=e.get(o.localCandidateId);u&&c(n.local,u)}if(o.remoteCandidateId){const u=e.get(o.remoteCandidateId);u&&c(n.remote,u)}}}),n}processCandidatePairStats(e){if(this._stats.sendBandwidth=e.availableOutgoingBitrate||0,e.currentRoundTripTime&&(this._stats.rtt=1e3*e.currentRoundTripTime),this._stats.videoSend.forEach(n=>{e.currentRoundTripTime&&(n.rttMs=1e3*e.currentRoundTripTime)}),this._stats.audioSend.forEach(n=>{e.currentRoundTripTime&&(n.rttMs=1e3*e.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=e.id,e.localCandidateId){const n=this.report.get(e.localCandidateId);n&&this.processCandidateStats(n)}if(e.remoteCandidateId){const n=this.report.get(e.remoteCandidateId);n&&this.processCandidateStats(n)}}processCandidateStats(e){let n;e.type===Ec.LOCAL_CANDIDATE&&(n=this._stats.selectedCandidatePair.localCandidate),e.type===Ec.REMOTE_CANDIDATE&&(n=this._stats.selectedCandidatePair.remoteCandidate),n&&(n.type=e.type,n.id=e.id,e.address&&(n.address=e.address),e.candidateType&&(n.candidateType=e.candidateType),e.port&&(n.port=e.port),e.priority&&(n.priority=e.priority),e.protocol&&(n.protocol=e.protocol),e.relayProtocol&&(n.relayProtocol=e.relayProtocol),e.type===Ec.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==n.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(ot({},n),ot({},this.stats.selectedCandidatePair.localCandidate)),e.type===Ec.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==n.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(ot({},n),ot({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(e){let n=this._stats.audioRecv.find(o=>o.ssrc===e.ssrc);n||(n=zl(uW),this._stats.audioRecv.push(n)),n.ssrc=e.ssrc,n.packets=e.packetsReceived,n.packetsLost=e.packetsLost,n.packetsDiscarded=e.packetsDiscarded,n.bytes=e.bytesReceived,n.jitterMs=1e3*e.jitter,n.retransmittedBytesReceived=e.retransmittedBytesReceived,n.retransmittedPacketsReceived=e.retransmittedPacketsReceived,n.totalProcessingDelay=e.totalProcessingDelay,n.jitterBufferEmittedCount=e.jitterBufferEmittedCount;const i=this.lastDecodeAudioReceiverStats.get(n.ssrc);n.avgProcessingDelayMs=U0(i,n,"totalProcessingDelay","jitterBufferEmittedCount",Xy.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(e,e.trackId,n),e.codecId&&(n.codec=this.getCodecFromCodecStats(e.codecId)),n.receivedFrames||(n.receivedFrames=e.packetsReceived),n.droppedFrames||(n.droppedFrames=e.packetsLost),n.receivedFrames>0&&!this.isFirstAudioReceived[n.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(n.ssrc),this.isFirstAudioReceived[n.ssrc]=!0),n.outputLevel&&n.outputLevel>0&&!this.isFirstAudioDecoded[n.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(n.ssrc),this.isFirstAudioDecoded[n.ssrc]=!0),typeof e.concealedSamples=="number"&&(n.concealedSamples=e.concealedSamples),this.lastDecodeAudioReceiverStats.set(n.ssrc,ot({},n))}processVideoInboundStats(e){let n=this._stats.videoRecv.find(h=>h.ssrc===e.ssrc);n||(n=zl(aW),this._stats.videoRecv.push(n)),n.ssrc=e.ssrc,n.packets=e.packetsReceived,n.packetsLost=e.packetsLost,n.bytes=e.bytesReceived,n.firsCount=e.firCount,n.nacksCount=e.nackCount,n.plisCount=e.pliCount,n.framesDecodeCount=e.framesDecoded,n.framesDroppedCount=e.framesDropped,n.totalInterFrameDelay=e.totalInterFrameDelay,n.totalSquaredInterFrameDelay=e.totalSquaredInterFrameDelay,n.totalFreezesDuration=e.totalFreezesDuration,n.totalProcessingDelay=e.totalProcessingDelay,n.packetsDiscarded=e.packetsDiscarded,n.framesAssembledFromMultiplePackets=e.framesAssembledFromMultiplePackets,n.totalAssemblyTime=e.totalAssemblyTime,n.keyFramesDecoded=e.keyFramesDecoded,n.retransmittedBytesReceived=e.retransmittedBytesReceived,n.retransmittedPacketsReceived=e.retransmittedPacketsReceived;const i=this.lastDecodeVideoReceiverStats.get(n.ssrc),o=this.lastVideoFramesDecode.get(n.ssrc),c=this.lastVideoFramesOutput.get(n.ssrc),u=Date.now();if(n.framesDecodeCount>0&&!this.isFirstVideoDecoded[n.ssrc]){const h=n.decodedFrame?n.decodedFrame.width:0,m=n.decodedFrame?n.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(n.ssrc,h,m),this.isFirstVideoDecoded[n.ssrc]=!0}if(i){const h=i.stats,m=u-i.lts;n.framesDecodeFreezeTime=h.framesDecodeFreezeTime,n.framesDecodeInterval=h.framesDecodeInterval,!this.isFirstVideoDecoded[n.ssrc]&&m>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[n.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(n.ssrc),this.isFirstVideoDecodedTimeout[n.ssrc]=!0),n.framesDecodeCount>h.framesDecodeCount&&this.isFirstVideoDecoded[n.ssrc]?(i.lts=Date.now(),n.framesDecodeInterval=m,n.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc))?n.framesDecodeFreezeTime+=n.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):n.framesDecodeCount<h.framesDecodeCount&&(n.framesDecodeInterval=0),e.framesDecoded&&e.qpSum&&(i.stats.framesDecodeCount>e.framesDecoded?n.qpSumPerFrame=e.qpSum/e.framesDecoded:n.qpSumPerFrame=(e.qpSum-i.qpSum)/(e.framesDecoded-i.stats.framesDecodeCount))}e.totalDecodeTime&&(n.decodeMs=1e3*e.totalDecodeTime,n.avgDecodeMs=U0(i==null?void 0:i.stats,n,"decodeMs","framesDecodeCount")),n.avgProcessingDelayMs=U0(i==null?void 0:i.stats,n,"totalProcessingDelay","framesDecodeCount",Xy.kMillisecondsFromSeconds),n.avgFramesAssembledFromMultiplePacketsMs=U0(i==null?void 0:i.stats,n,"totalAssemblyTime","framesAssembledFromMultiplePackets",Xy.kMillisecondsFromSeconds),n.avgInterFrameDelayMs=U0(i==null?void 0:i.stats,n,"totalInterFrameDelay","framesDecodeCount",Xy.kMillisecondsFromSeconds),o&&u-o.lts>=800?(n.decodeFrameRate=Math.round((n.framesDecodeCount-o.count)/((u-o.lts)/1e3)),this.lastVideoFramesDecode.set(n.ssrc,{count:n.framesDecodeCount,lts:u,rate:n.decodeFrameRate})):o?n.decodeFrameRate=o.rate:this.lastVideoFramesDecode.set(n.ssrc,{count:n.framesDecodeCount,lts:u,rate:0}),n.framesDroppedCount&&e.framesReceived&&(c&&u-c.lts>=800?(n.outputFrameRate=Math.round((e.framesReceived-n.framesDroppedCount-c.count)/((u-c.lts)/1e3)),this.lastVideoFramesOutput.set(n.ssrc,{count:e.framesReceived-n.framesDroppedCount,lts:u,rate:Math.max(n.outputFrameRate,0)})):c?n.outputFrameRate=c.rate:this.lastVideoFramesOutput.set(n.ssrc,{count:e.framesReceived-n.framesDroppedCount,lts:u,rate:0})),this.processVideoTrackReceiverStats(e,e.trackId,n),e.codecId&&(n.codec=this.getCodecFromCodecStats(e.codecId)),e.framerateMean&&(n.framesRateFirefox=e.framerateMean),n.packets>0&&!this.isFirstVideoReceived[n.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(n.ssrc),this.isFirstVideoReceived[n.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(n.ssrc,{stats:ot({},n),lts:i?i.lts:Date.now(),qpSum:e.qpSum})}processVideoOutboundStats(e){let n=this._stats.videoSend.find(o=>o.ssrc===e.ssrc);n||(n=zl(cW),this._stats.videoSend.push(n));const i=this.mediaBytesSent.get(e.ssrc);if(i)i.add(e.bytesSent);else{const o=new cL(10);o.add(e.bytesSent),this.mediaBytesSent.set(e.ssrc,o)}if(e.retransmittedBytesSent!==void 0){const o=this.mediaBytesRetransmit.get(e.ssrc);if(o)o.add(e.retransmittedBytesSent);else{const c=new cL(10);c.add(e.retransmittedBytesSent),this.mediaBytesRetransmit.set(e.ssrc,c)}}if(e.totalEncodedBytesTarget){const o=this.mediaBytesTargetEncode.get(e.ssrc);if(o)o.add(e.totalEncodedBytesTarget);else{const c=new cL(10);c.add(e.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(e.ssrc,c)}}if(n.ssrc=e.ssrc,n.bytes=e.bytesSent,n.packets=e.packetsSent,n.firsCount=e.firCount,n.nacksCount=e.nackCount,n.plisCount=e.pliCount,n.frameCount=e.framesEncoded,n.adaptionChangeReason=e.qualityLimitationReason,n.scalabilityMode=e.scalabilityMode,n.retransmittedBytesSent=e.retransmittedBytesSent,n.retransmittedPacketsSent=e.retransmittedPacketsSent,n.hugeFramesSent=e.hugeFramesSent,n.keyFramesEncoded=e.keyFramesEncoded,e.totalEncodeTime&&e.framesEncoded){const o=this.lastEncoderMs.get(e.ssrc);if(!o||o.lastFrameCount>e.framesEncoded)n.avgEncodeMs=1e3*e.totalEncodeTime/e.framesEncoded;else{const c=e.framesEncoded-o.lastFrameCount,u=e.totalEncodeTime-o.lastEncoderTime;n.avgEncodeMs=1e3*u/c}}if(e.framesEncoded&&e.qpSum){const o=this.lastEncoderMs.get(e.ssrc);!o||o.lastFrameCount>e.framesEncoded?n.qpSumPerFrame=e.qpSum/e.framesEncoded:n.qpSumPerFrame=(e.qpSum-o.lastQpSum)/(e.framesEncoded-o.lastFrameCount)}if(this.lastEncoderMs.set(e.ssrc,{lastFrameCount:e.framesEncoded,lastEncoderTime:e.totalEncodeTime,lastQpSum:e.qpSum,lts:Date.now()}),e.codecId&&(n.codec=this.getCodecFromCodecStats(e.codecId)),e.mediaSourceId&&this.processVideoMediaSource(e.mediaSourceId,n),this.processVideoTrackSenderStats(e,e.trackId,n),e.remoteId)this.processRemoteInboundStats(e.remoteId,n);else{const o=this.findRemoteStatsId(e.ssrc,Ec.REMOTE_INBOUND);o&&this.processRemoteInboundStats(o,n)}}processAudioOutboundStats(e){let n=this._stats.audioSend.find(i=>i.ssrc===e.ssrc);if(n||(n=zl(lW),this._stats.audioSend.push(n)),n.ssrc=e.ssrc,n.packets=e.packetsSent,n.bytes=e.bytesSent,n.retransmittedBytesSent=e.retransmittedBytesSent,n.retransmittedPacketsSent=e.retransmittedPacketsSent,e.mediaSourceId&&this.processAudioMediaSource(e.mediaSourceId,n),e.codecId&&(n.codec=this.getCodecFromCodecStats(e.codecId)),this.processAudioTrackSenderStats(e,e.trackId,n),e.remoteId)this.processRemoteInboundStats(e.remoteId,n);else{const i=this.findRemoteStatsId(e.ssrc,Ec.REMOTE_INBOUND);i&&this.processRemoteInboundStats(i,n)}}findRemoteStatsId(e,n){var i;const o=Array.from(mc(i=this.report).call(i)).find(c=>c.type===n&&c.ssrc===e);return o?o.id:null}processVideoMediaSource(e,n){const i=this.report.get(e);i&&i.width&&i.height&&i.framesPerSecond&&(n.inputFrame={width:i.width,height:i.height,frameRate:i.framesPerSecond})}processAudioMediaSource(e,n){const i=this.report.get(e);i&&(n.inputLevel=i.audioLevel)}processVideoTrackSenderStats(e,n,i){var o,c,u,h;const m=n?this.report.get(n):void 0,_=(o=m==null?void 0:m.framesSent)!==null&&o!==void 0?o:e.framesSent;if(typeof _!="number")return;let y=(c=m==null?void 0:m.frameWidth)!==null&&c!==void 0?c:e.frameWidth,S=(u=m==null?void 0:m.frameHeight)!==null&&u!==void 0?u:e.frameHeight,w=(h=m==null?void 0:m.framesPerSecond)!==null&&h!==void 0?h:e.framesPerSecond;if(typeof y=="number"&&typeof S=="number"||(y=0,S=0),w==null){const I=Date.now(),P=this.lastVideoFramesSent.get(i.ssrc);P&&I-P.lts>=800?(w=Math.round((_-P.count)/((I-P.lts)/1e3)),this.lastVideoFramesSent.set(i.ssrc,{count:_,lts:I,rate:w})):P?w=P.rate:this.lastVideoFramesSent.set(i.ssrc,{count:_,lts:I,rate:0})}i.sentFrame={width:y,height:S,frameRate:Math.max(0,w)}}processVideoTrackReceiverStats(e,n,i){var o,c,u,h,m;const _=n?this.report.get(n):void 0,y=(o=_==null?void 0:_.framesReceived)!==null&&o!==void 0?o:e.framesReceived,S=(c=_==null?void 0:_.frameWidth)!==null&&c!==void 0?c:e.frameWidth,w=(u=_==null?void 0:_.frameHeight)!==null&&u!==void 0?u:e.frameHeight,I=(h=_==null?void 0:_.jitterBufferDelay)!==null&&h!==void 0?h:e.jitterBufferDelay,P=(m=_==null?void 0:_.jitterBufferEmittedCount)!==null&&m!==void 0?m:e.jitterBufferEmittedCount;if(typeof y=="number"){const B=this.lastVideoFramesRecv.get(i.ssrc),M=Date.now();i.framesReceivedCount=y;let U=0;B&&M-B.lts>=800?(U=Math.round((y-B.count)/((M-B.lts)/1e3)),this.lastVideoFramesRecv.set(i.ssrc,{count:y,lts:M,rate:U})):B?U=B.rate:this.lastVideoFramesRecv.set(i.ssrc,{count:y,lts:M,rate:0}),i.receivedFrame={width:S||0,height:w||0,frameRate:U||0},i.decodedFrame={width:S||0,height:w||0,frameRate:i.decodeFrameRate||0},i.outputFrame={width:S||0,height:w||0,frameRate:i.outputFrameRate||i.decodeFrameRate||0}}if(I&&P){const B=this.lastVideoJBDelay.get(i.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let M=B.jitterBufferMs;const U=P-B.jitterBufferEmittedCount;U>0&&(M=1e3*(I-B.jitterBufferDelay)/U),i.jitterBufferMs=M,i.currentDelayMs=Math.round(M),this.lastVideoJBDelay.set(i.ssrc,{jitterBufferDelay:I,jitterBufferEmittedCount:P,jitterBufferMs:i.currentDelayMs})}}processAudioTrackSenderStats(e,n,i){var o,c,u,h;const m=n?this.report.get(n):void 0,_=(o=(c=m==null?void 0:m.echoReturnLoss)!==null&&c!==void 0?c:e.echoReturnLoss)!==null&&o!==void 0?o:0,y=(u=(h=m==null?void 0:m.echoReturnLossEnhancement)!==null&&h!==void 0?h:e.echoReturnLossEnhancement)!==null&&u!==void 0?u:0;i.aecReturnLoss=_,i.aecReturnLossEnhancement=y}processAudioTrackReceiverStats(e,n,i){var o,c,u,h,m,_,y;const S=n?this.report.get(n):void 0,w=(o=S==null?void 0:S.removedSamplesForAcceleration)!==null&&o!==void 0?o:e.removedSamplesForAcceleration,I=(c=S==null?void 0:S.totalSamplesReceived)!==null&&c!==void 0?c:e.totalSamplesReceived,P=(u=S==null?void 0:S.jitterBufferDelay)!==null&&u!==void 0?u:e.jitterBufferDelay,B=(h=S==null?void 0:S.jitterBufferEmittedCount)!==null&&h!==void 0?h:e.jitterBufferEmittedCount,M=(m=S==null?void 0:S.audioLevel)!==null&&m!==void 0?m:e==null?void 0:e.audioLevel,U=(_=S==null?void 0:S.totalSamplesDuration)!==null&&_!==void 0?_:e==null?void 0:e.totalSamplesDuration,q=(y=S==null?void 0:S.concealedSamples)!==null&&y!==void 0?y:e.concealedSamples;if(typeof I=="number"&&(i.totalSamplesReceived=I),w&&I&&(i.accelerateRate=w/I),P&&B){const ae=this.lastAudioJBDelay.get(i.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let me=ae.jitterBufferMs;const ge=B-ae.jitterBufferEmittedCount;ge>0&&(me=1e3*(P-ae.jitterBufferDelay)/ge),i.jitterBufferMs=Math.round(me),this.lastAudioJBDelay.set(i.ssrc,{jitterBufferDelay:P,jitterBufferEmittedCount:B,jitterBufferMs:i.jitterBufferMs})}i.outputLevel=M;let $=1920;U&&I&&($=I/U/50,i.receivedFrames=Math.round(I/$)),q&&(i.droppedFrames=Math.round(q/$))}processRemoteInboundStats(e,n){const i=this.report.get(e);i&&(n.packetsLost=i.packetsLost,i.roundTripTime&&(n.rttMs=1e3*i.roundTripTime),i.jitter&&(n.jitterMs=1e3*i.jitter),i.timestamp&&(n.timestamp=i.timestamp))}getCodecFromCodecStats(e){const n=this.report.get(e);if(!n)return"";const i=n.mimeType.match(/\/(.*)$/);return i&&i[1]?i[1]:""}updateSendBitrate(){let e=0,n=null,i=null;this.mediaBytesSent.forEach(c=>{e+=c.diffMean()}),this.mediaBytesRetransmit.forEach(c=>{n=n===null?c.diffMean():n+c.diffMean()}),this.mediaBytesTargetEncode.forEach(c=>{i=i===null?c.diffMean():i+c.diffMean()});const o=n!==null?e-n:e;this._stats.bitrate={actualEncoded:8*o/(this.options.updateInterval/1e3),transmit:8*e/(this.options.updateInterval/1e3)},n!==null&&(this._stats.bitrate.retransmit=8*n/(this.options.updateInterval/1e3)),i!==null&&(this._stats.bitrate.targetEncoded=8*i/(this.options.updateInterval/1e3))}},Ihe=class extends lL{updateStats(){return tt.resolve()}};function dL(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const u=function(){const h=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return h&&h[0]?Number(h[0].split("/")[1]):null}();return u?u<76?new Che(e,{updateInterval:n,lossRateInterval:i,freezeRateLimit:o,firstVideoDecodedTimeout:c}):new dW(e,{updateInterval:n,lossRateInterval:i,freezeRateLimit:o,firstVideoDecodedTimeout:c}):function(h){if(!window.RTCStatsReport)return!1;const m=h.getStats();return!!(m instanceof tt||function(_){return!!_&&(typeof _=="object"||typeof _=="function")&&typeof _.then=="function"}(m))}(e)?new dW(e,{updateInterval:n,lossRateInterval:i,freezeRateLimit:o,firstVideoDecodedTimeout:c}):new Ihe(e,{updateInterval:n,lossRateInterval:i,freezeRateLimit:o,firstVideoDecodedTimeout:c})}const hW="websdk_ng_install_id";function hL(){try{if(Z("INSTALL_ID"))return Z("INSTALL_ID");let e=window.localStorage.getItem(hW);return e||(e=Zg(),window.localStorage.setItem(hW,e)),qn("INSTALL_ID",e),e}catch{return}}const tl=function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;const n=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(n&&n[1]&&n[2]){const i=n[1],o=n[2];return"".concat(i,".").concat(o)}return"4.0.0.999"}("4.23.2"),fL=function(){try{return JSON.parse("true")===!0}catch{return!0}}();let e_=function(e){return e.Default="default",e.Auto="auto",e.Relay="relay",e.SdRtn="sd-rtn",e}({});const hs=function(){const e="us".concat("erna","me"),n="pa".concat("sswo","rd"),i=["t","s","t"];i.splice(1,0,"e");const o=i.join(""),c=[];for(let m=0;m<6;m++)c.push("1");const u=c.join(""),h={};return h[e]=o,h[n]=u,Object.assign(h,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=hs;const oA={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:2,ENABLE_AUT_FEEDBACK:!1,SVC_EXTENDED:["VP9"]},pL={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},mL="v4.23.2-0-g1599fdac-dirty(3/4/2025, 5:13:36 PM)",gL={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!1,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",USE_TURN_IP:!1,NEW_TURN_MODE:void 0,NEW_FORCE_TURN:!1},dr=ot(ot(ot({},gL),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS_METADATA:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:pL,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},oA),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1},{INSTALL_ID:""});function qn(e,n,i){var o,c,u;Xe(o=Object.keys(dr)).call(o,e)&&(!i&&Xe(c=Object.keys($u)).call(c,e)||(dr[e]=n,e!=="ENABLE_VIDEO_SEI"&&e!=="ENABLE_AUDIO_TOPN"&&e!=="ENABLE_AUDIO_METADATA"&&e!=="ENABLE_AUDIO_PTS_METADATA"||n!==!0||(dr.ENABLE_ENCODED_TRANSFORM=!0,e==="ENABLE_AUDIO_PTS_METADATA"&&(dr.ENABLE_AUDIO_METADATA=!0)),e==="USE_NEW_NETWORK_CONFIG"&&n&&(u=!!n,dr.USE_NEW_NETWORK_CONFIG=u,u&&(dr.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],dr.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],dr.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],dr.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],dr.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",dr.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",dr.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),e==="ENABLE_PRE_SUB"&&n&&(dr.ENABLE_INSTANT_VIDEO=!0,dr.ENABLE_PREALLOC_PC=!0),e==="ENABLE_SVC"&&n&&(dr.ENABLE_AUT_CC=!0),e==="NEW_FORCE_TURN"&&n&&(dr.NEW_TURN_MODE||(dr.NEW_TURN_MODE=4))))}function Z(e){return dr[e]}fL||(dr.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],dr.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],dr.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],dr.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],dr.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],dr.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],dr.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",dr.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",dr.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",dr.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",dr.AREAS=["NORTH_AMERICA","OVERSEA"]);let fW=function(e){return e[e.REALTIME=1]="REALTIME",e}({});const $u={};var cn=function(e){return e.SET_SESSION_ID="SET_SESSION_ID",e.SET_P2P_ID="SET_P2P_id",e.SET_DC_ID="SET_DC_id",e.SET_UID="SET_UID",e.SET_INT_UID="SET_INT_UID",e.SET_PUB_ID="SET_PUB_ID",e.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e.AVOID_JOIN_START="AVOID_JOIN_START",e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",e.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",e.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",e.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",e.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",e.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",e.RESET_KEY_METRICS="RESET_KEY_METRICS",e.SET_USE_P2P="SET_USE_P2P",e.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",e}(cn||{});let aA=function(e){return e.h264="h264",e.h265="h265",e.vp8="vp8",e.vp9="vp9",e.av1="av1",e}({});(function(e){e.opus="opus",e.pcma="pcma",e.pcmu="pcmu",e.g722="g722"})({});const pW=128,Ahe=96,mW=1e3,Jy=10;let Ohe=0;var gW=(()=>{var e={8:(o,c,u)=>{u.r(c),u.d(c,{Parser:()=>nt,Printer:()=>Xr,parse:()=>Ye,print:()=>ft});const h=`
`,m="".concat("\r").concat(h),_=" ";let y;function S(xe){return xe>="0"&&xe<="9"}function w(xe){return xe>="!"&&xe<="~"}function I(xe){return w(xe)||xe>=""&&xe<=""}function P(xe){return xe==="!"||xe>="#"&&xe<="'"||xe>="*"&&xe<="+"||xe>="-"&&xe<="."||xe>="0"&&xe<="9"||xe>="A"&&xe<="Z"||xe>="^"&&xe<="~"}function B(xe){return xe>="1"&&xe<="9"}function M(xe){return xe>="A"&&xe<="Z"||xe>="a"&&xe<="z"}function U(xe){return xe==="d"||xe==="h"||xe==="m"||xe==="s"}function q(xe){return xe>""&&xe<"	"||xe>"\v"&&xe<"\f"||xe>""&&xe<""}function $(xe){return M(xe)||S(xe)||xe==="+"||xe==="/"}function ae(xe){return S(xe)||M(xe)||xe==="+"||xe==="/"||xe==="-"||xe==="_"}function me(xe){return M(xe)||S(xe)||xe==="+"||xe==="/"}function ge(xe,L){var te=Object.keys(xe);if(Object.getOwnPropertySymbols){var ce=Object.getOwnPropertySymbols(xe);L&&(ce=ce.filter(function(ze){return Object.getOwnPropertyDescriptor(xe,ze).enumerable})),te.push.apply(te,ce)}return te}function pe(xe){for(var L=1;L<arguments.length;L++){var te=arguments[L]!=null?arguments[L]:{};L%2?ge(Object(te),!0).forEach(function(ce){we(xe,ce,te[ce])}):Object.getOwnPropertyDescriptors?Object.defineProperties(xe,Object.getOwnPropertyDescriptors(te)):ge(Object(te)).forEach(function(ce){Object.defineProperty(xe,ce,Object.getOwnPropertyDescriptor(te,ce))})}return xe}function we(xe,L,te){return L in xe?Object.defineProperty(xe,L,{value:te,enumerable:!0,configurable:!0,writable:!0}):xe[L]=te,xe}(function(xe){xe.VERSION="v",xe.ORIGIN="o",xe.SESSION_NAME="s",xe.INFORMATION="i",xe.URI="u",xe.EMAIL="e",xe.PHONE="p",xe.CONNECTION="c",xe.BANDWIDTH="b",xe.TIME="t",xe.REPEAT="r",xe.ZONE_ADJUSTMENTS="z",xe.KEY="k",xe.ATTRIBUTE="a",xe.MEDIA="m"})(y||(y={}));class Be{consumeText(L,te){let ce=te;for(;ce<L.length;){const ze=L[ce];if(ze==="\0"||ze==="\r"||ze===h)break;ce+=1}if(ce-te==0)throw new Error("Invalid text, at ".concat(L));return ce}consumeUnicastAddress(L,te,ce){return this.consumeTill(L,te,_)}consumeOneOrMore(L,te,ce){let ze=te;for(;ce(L[ze]);)ze++;if(ze-te==0)throw new Error("Invalid rule at ".concat(te,"."));return ze}consumeSpace(L,te){if(L[te]===_)return te+1;throw new Error("Invalid space at ".concat(te,"."))}consumeIP4Address(L,te){let ce=te;for(let ze=0;ze<4;ze++)if(ce=this.consumeDecimalUChar(L,ce),ze!==3){if(L[ce]!==".")throw new Error("Invalid IP4 address.");ce++}return ce}consumeDecimalUChar(L,te){let ce=te;for(let jt=0;jt<3&&S(L[ce]);jt++,ce++);if(ce-te==0)throw new Error("Invalid decimal uchar.");const ze=parseInt(L.slice(te,ce));if(ze>=0&&ze<=255)return ce;throw new Error("Invalid decimal uchar")}consumeIP6Address(L,te){let ce=this.consumeHexpart(L,te);return L[ce]===":"&&(ce+=1,ce=this.consumeIP4Address(L,ce)),ce}consumeHexpart(L,te){let ce=te;if(L[ce]===":"&&L[ce+1]===":"){ce+=2;try{ce=this.consumeHexseq(L,ce)}catch{}return ce}if(ce=this.consumeHexseq(L,ce),L[ce]===":"&&L[ce+1]===":"){ce+=2;try{ce=this.consumeHexseq(L,ce)}catch{}return ce}return ce}consumeHexseq(L,te){let ce=te;for(;ce=this.consumeHex4(L,ce),L[ce]===":"&&L[ce+1]!==":";)ce+=1;return ce}consumeHex4(L,te){let ce=0;for(;ce<4;ce++)if(!((ze=L[te+ce])>="0"&&ze<="9"||ze>="a"&&ze<="f"||ze>="A"&&ze<="F")){if(ce===0)throw new Error("Invalid hex 4");break}var ze;return te+ce}consumeFQDN(L,te){let ce=te;for(;S(L[ce])||M(L[ce])||L[ce]==="-"||L[ce]===".";)ce+=1;if(ce-te<4)throw new Error("Invalid FQDN");return ce}consumeExtnAddr(L,te){return this.consumeOneOrMore(L,te,I)}consumeMulticastAddress(L,te,ce){switch(ce){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(L,te);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(L,te);default:try{return this.consumeFQDN(L,te)}catch{return this.consumeExtnAddr(L,te)}}}consumeIP6MulticastAddress(L,te){const ce=this.consumeHexpart(L,te);return L[ce]==="/"?this.consumeInteger(L,ce+1):ce}consumeIP4MulticastAddress(L,te){let ce=te+3;const ze=L.slice(te,ce),jt=parseInt(ze);if(jt<224||jt>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let Qn=0;Qn<3;Qn++){if(L[ce]!==".")throw new Error("Invalid IP4 multicast address.");ce+=1,ce=this.consumeDecimalUChar(L,ce)}return L[ce]==="/"&&(ce+=1),ce=this.consumeTTL(L,ce),L[ce]==="/"&&(ce=this.consumeInteger(L,ce)),ce}consumeInteger(L,te){if(!B(L[te]))throw new Error("Invalid integer.");for(te+=1;S(L[te]);)te+=1;return te}consumeTTL(L,te){if(L[te]==="0")return te+1;if(!B(L[te]))throw new Error("Invalid TTL.");te+=1;for(let ce=0;ce<2&&S(L[te]);ce++)te+=1;return te}consumeToken(L,te){return this.consumeOneOrMore(L,te,P)}consumeTime(L,te){let ce=te;if(L[ce]==="0")return ce+1;for(B(L[ce])&&(ce+=1);S(L[ce]);)ce++;if(ce-te<10)throw new Error("Invalid time");return ce}consumeAddress(L,te){return this.consumeTill(L,te,_)}consumeTypedTime(L,te){let ce=te;return ce=this.consumeOneOrMore(L,ce,S),U(L[ce])?ce+1:ce}consumeRepeatInterval(L,te){if(!B(L[te]))throw new Error("Invalid repeat interval");for(te+=1;S(L[te]);)te+=1;return U(L[te])&&(te+=1),te}consumePort(L,te){return this.consumeOneOrMore(L,te,S)}consume(L,te,ce){for(let ze=0;ze<ce.length;ze++){if(te+ze>=L.length)throw new Error("consume exceeding value length");if(L[te+ze]!==ce[ze])throw new Error("consume ".concat(ce," failed at ").concat(ze))}return te+ce.length}consumeTill(L,te,ce){let ze=te;for(;ze<L.length&&(typeof ce!="string"||L[ze]!==ce)&&(typeof ce!="function"||!ce(L[ze]));)ze++;return ze}}class nt extends Be{constructor(){super(),we(this,"records",[]),we(this,"currentLine",0)}parse(L){const te=this.probeEOL(L);this.records=L.split(te).filter(w_=>!!Gs(w_).call(w_)).map(this.parseLine),this.currentLine=0;const ce=this.parseVersion(),ze=this.parseOrigin(),jt=this.parseSessionName(),Qn=this.parseInformation(),Ni=this.parseUri(),ma=this.parseEmail(),Uf=this.parsePhone(),b_=this.parseConnection(),vb=this.parseBandWidth(),EO=this.parseTimeFields(),yO=this.parseKey(),ll=this.parseSessionAttribute(),gm=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:ce,origin:ze,sessionName:jt,information:Qn,uri:Ni,emails:ma,phones:Uf,connection:b_,bandwidths:vb,timeFields:EO,key:yO,attributes:ll,mediaDescriptions:gm}}getCurrentRecord(){const L=this.records[this.currentLine];if(!L)throw new Error("Record doesn't exit.");return L}probeEOL(L){for(let te=0;te<L.length;te++)if(L[te]===h)return L[te-1]==="\r"?m:h;throw new Error("Invalid newline character.")}parseLine(L,te){if(L.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const ce=L[0];if(L[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:ce,value:L.slice(2),line:te,cur:0}}parseSessionAttribute(){const L=new pn;for(;this.currentLine<this.records.length;){const te=this.getCurrentRecord();if(te.type!==y.ATTRIBUTE)break;const ce={attField:this.extractOneOrMore(te,ze=>P(ze)&&ze!==":"),_cur:0};te.value[te.cur]===":"&&(te.cur+=1,ce.attValue=this.extractOneOrMore(te,q)),L.parse(ce),this.currentLine++}return L.digest()}parseMediaAttributes(L){const te=new mn(L);for(;this.currentLine<this.records.length;){const ce=this.getCurrentRecord();if(ce.type!==y.ATTRIBUTE)break;const ze={attField:this.extractOneOrMore(ce,jt=>P(jt)&&jt!==":"),_cur:0};ce.value[ce.cur]===":"&&(ce.cur+=1,ze.attValue=this.extractOneOrMore(ce,q)),te.parse(ze),this.currentLine++}return te.digest()}parseKey(){const L=this.getCurrentRecord();if(L.type===y.KEY){if(L.value==="prompt"||L.value==="clear:"||L.value==="base64:"||L.value==="uri:")return L.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const L=this.getCurrentRecord();if(L.type===y.ZONE_ADJUSTMENTS){const te=[];for(;;)try{const ce=this.extract(L,this.consumeTime);this.consumeSpaceForRecord(L);let ze=!1;L.value[L.cur]==="-"&&(ze=!0,L.cur+=1);const jt=this.extract(L,this.consumeTypedTime);te.push({time:ce,typedTime:jt,back:ze})}catch{break}if(te.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,te}return[]}parseRepeat(){const L=[];for(;;){const te=this.getCurrentRecord();if(te.type!==y.REPEAT)break;{const ce=this.extract(te,this.consumeRepeatInterval),ze=this.parseTypedTime(te);L.push({repeatInterval:ce,typedTimes:ze}),this.currentLine++}}return L}parseTypedTime(L){const te=[];for(;;)try{this.consumeSpaceForRecord(L),te.push(this.extract(L,this.consumeTypedTime))}catch{break}if(te.length===0)throw new Error("Invalid typed time.");return te}parseTime(){const L=this.getCurrentRecord(),te=this.extract(L,this.consumeTime);this.consumeSpaceForRecord(L);const ce=this.extract(L,this.consumeTime);return this.currentLine++,{startTime:te,stopTime:ce}}parseBandWidth(){const L=[];for(;this.currentLine<this.records.length;){const te=this.getCurrentRecord();if(te.type!==y.BANDWIDTH)break;{const ce=this.extractOneOrMore(te,P);if(te.value[te.cur]!==":")throw new Error("Invalid bandwidth field.");te.cur++;const ze=this.extractOneOrMore(te,S);L.push({bwtype:ce,bandwidth:ze}),this.currentLine++}}return L}parseVersion(){const L=this.getCurrentRecord();if(L.type!==y.VERSION)throw new Error("first sdp record must be version");const te=L.value.slice(0,this.consumeOneOrMore(L.value,0,S));if(te.length!==L.value.length)throw new Error('invalid proto version, "v='.concat(L.value,'"'));return this.currentLine++,te}parseOrigin(){const L=this.getCurrentRecord();if(L.type!==y.ORIGIN)throw new Error("second line of sdp must be origin");const te=this.extractOneOrMore(L,I);this.consumeSpaceForRecord(L);const ce=this.extractOneOrMore(L,S);this.consumeSpaceForRecord(L);const ze=this.extractOneOrMore(L,S);this.consumeSpaceForRecord(L);const jt=this.extractOneOrMore(L,P);this.consumeSpaceForRecord(L);const Qn=this.extractOneOrMore(L,P);this.consumeSpaceForRecord(L);const Ni=this.extract(L,this.consumeUnicastAddress);return this.currentLine++,{username:te,sessId:ce,sessVersion:ze,nettype:jt,addrtype:Qn,unicastAddress:Ni}}parseSessionName(){const L=this.getCurrentRecord();if(L.type===y.SESSION_NAME){const te=this.extract(L,this.consumeText);return this.currentLine++,te}}parseInformation(){const L=this.getCurrentRecord();if(L.type!==y.INFORMATION)return;const te=this.extract(L,this.consumeText);return this.currentLine++,te}parseUri(){const L=this.getCurrentRecord();if(L.type===y.URI)return this.currentLine++,L.value}parseEmail(){const L=[];for(;;){const te=this.getCurrentRecord();if(te.type!==y.EMAIL)break;L.push(te.value),this.currentLine++}return L}parsePhone(){const L=[];for(;;){const te=this.getCurrentRecord();if(te.type!==y.PHONE)break;L.push(te.value),this.currentLine++}return L}parseConnection(){const L=this.getCurrentRecord();if(L.type===y.CONNECTION){const te=this.extractOneOrMore(L,P);this.consumeSpaceForRecord(L);const ce=this.extractOneOrMore(L,P);this.consumeSpaceForRecord(L);const ze=this.extract(L,this.consumeAddress);return this.currentLine++,{nettype:te,addrtype:ce,address:ze}}}parseMedia(){const L=this.getCurrentRecord(),te=this.extract(L,this.consumeToken);this.consumeSpaceForRecord(L);let ce=this.extract(L,this.consumePort);L.value[L.cur]==="/"&&(L.cur+=1,ce+=this.extract(L,this.consumeInteger)),this.consumeSpaceForRecord(L);const ze=[];for(ze.push(this.extract(L,this.consumeToken));L.value[L.cur]==="/";)L.cur+=1,ze.push(this.extract(L,this.consumeToken));if(ze.length===0)throw new Error("Invalid proto");const jt=this.parseFmt(L);return this.currentLine++,{mediaType:te,port:ce,protos:ze,fmts:jt}}parseTimeFields(){const L=[];for(;this.getCurrentRecord().type===y.TIME;){const te=this.parseTime(),ce=this.parseRepeat(),ze=this.parseZone();L.push({time:te,repeats:ce,zones:ze})}return L}parseMediaDescription(){const L=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===y.MEDIA;){const te=this.parseMedia(),ce=this.parseInformation(),ze=this.parseConnections(),jt=this.parseBandWidth(),Qn=this.parseKey(),Ni=this.parseMediaAttributes(te);L.push({media:te,information:ce,connections:ze,bandwidths:jt,key:Qn,attributes:Ni})}return L}parseConnections(){const L=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===y.CONNECTION;)L.push(this.parseConnection());return L}parseFmt(L){const te=[];for(;;)try{this.consumeSpaceForRecord(L),te.push(this.extract(L,this.consumeToken))}catch{break}if(te.length===0)throw new Error("Invalid fmts");return te}extract(L,te){for(var ce=arguments.length,ze=new Array(ce>2?ce-2:0),jt=2;jt<ce;jt++)ze[jt-2]=arguments[jt];const Qn=te.call(this,L.value,L.cur,...ze),Ni=L.value.slice(L.cur,Qn);return L.cur=Qn,Ni}extractOneOrMore(L,te){const ce=this.consumeOneOrMore(L.value,L.cur,te),ze=L.value.slice(L.cur,ce);return L.cur=ce,ze}consumeSpaceForRecord(L){if(L.value[L.cur]!==_)throw new Error("Invalid space at ".concat(L.cur,"."));L.cur+=1}}class st extends Be{constructor(){super(...arguments),we(this,"attributes",void 0),we(this,"digested",!1)}extractOneOrMore(L,te,ce){const ze=this.consumeOneOrMore(L.attValue,L._cur,te),jt=L.attValue.slice(L._cur,ze),[Qn,Ni]=ce||[];if(typeof Qn=="number"&&jt.length<Qn)throw new Error("error in length, should be more or equal than ".concat(Qn," characters."));if(typeof Ni=="number"&&jt.length>Ni)throw new Error("error in length, should be less or equal than ".concat(Ni," characters."));return L._cur=ze,jt}consumeAttributeSpace(L){if(L.attValue[L._cur]!==_)throw new Error("Invalid space at ".concat(L._cur,"."));L._cur+=1}extract(L,te){if(!L.attValue)throw new Error("Nothing to extract from attValue.");for(var ce=arguments.length,ze=new Array(ce>2?ce-2:0),jt=2;jt<ce;jt++)ze[jt-2]=arguments[jt];const Qn=te.call(this,L.attValue,L._cur,...ze),Ni=L.attValue.slice(L._cur,Qn);return L._cur=Qn,Ni}atEnd(L){if(!L.attValue)throw new Error;return L._cur>=L.attValue.length}peekChar(L){if(!L.attValue)throw new Error;return L.attValue[L._cur]}peek(L,te){if(!L.attValue)throw new Error;for(let ce=0;ce<te.length;ce++)if(te[ce]!==L.attValue[L._cur+ce])return!1;return!0}parseIceUfrag(L){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(L,$,[4,256])}parseIcePwd(L){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(L,$,[22,256])}parseIceOptions(L){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const te=[];for(;!this.atEnd(L);){te.push(this.extractOneOrMore(L,$));try{this.consumeAttributeSpace(L)}catch(ce){if(this.atEnd(L))break;throw ce}}this.attributes.iceOptions=te}parseFingerprint(L){const te=this.extract(L,this.consumeToken);this.consumeAttributeSpace(L);const ce=this.extract(L,this.consumeTill);this.attributes.fingerprints.push({hashFunction:te,fingerprint:ce})}parseExtmap(L){const te=this.extractOneOrMore(L,S);let ce;this.peekChar(L)==="/"&&(this.extract(L,this.consume,"/"),ce=this.extract(L,this.consumeToken)),this.consumeAttributeSpace(L);const ze=this.extract(L,this.consumeTill,_),jt=pe(pe({entry:parseInt(te,10)},ce&&{direction:ce}),{},{extensionName:ze});this.peekChar(L)===_&&(this.consumeAttributeSpace(L),jt.extensionAttributes=this.extract(L,this.consumeTill)),this.attributes.extmaps.push(jt)}parseSetup(L){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const te=this.extract(L,this.consumeTill);if(te!=="active"&&te!=="passive"&&te!=="actpass"&&te!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=te}}class pn extends st{constructor(){super(...arguments),we(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(L){if(this.digested)throw new Error("already digested");try{switch(L.attField){case"group":this.parseGroup(L);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(L);break;case"ice-pwd":this.parseIcePwd(L);break;case"ice-options":this.parseIceOptions(L);break;case"fingerprint":this.parseFingerprint(L);break;case"setup":this.parseSetup(L);break;case"tls-id":this.parseTlsId(L);break;case"identity":this.parseIdentity(L);break;case"extmap":this.parseExtmap(L);break;case"msid-semantic":this.parseMsidSemantic(L);break;default:L.ignored=!0,this.attributes.unrecognized.push(L)}}catch(te){throw console.error("parsing session attribute ".concat(L.attField,' error, "a=').concat(L.attField,":").concat(L.attValue,'"')),te}if(!L.ignored&&L.attValue&&!this.atEnd(L))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(L){const te=this.extract(L,this.consumeToken),ce=[];for(;!this.atEnd(L)&&this.peekChar(L)===_;)this.consumeAttributeSpace(L),ce.push(this.extract(L,this.consumeToken));this.attributes.groups.push({semantic:te,identificationTag:ce})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(L){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(L,ae)}parseIdentity(L){const te=this.extractOneOrMore(L,me),ce=[];for(;!this.atEnd(L)&&this.peekChar(L)===_;){this.consumeAttributeSpace(L);const ze=this.extract(L,this.consumeToken);this.extract(L,this.consume,"=");const jt=this.extractOneOrMore(L,Qn=>Qn!==_&&q(Qn));ce.push({name:ze,value:jt})}this.attributes.identities.push({assertionValue:te,extensions:ce})}parseMsidSemantic(L){this.peekChar(L)===_&&this.consumeAttributeSpace(L);const te={semantic:this.extract(L,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(L)}catch{break}if(this.peekChar(L)==="*"){this.extract(L,this.consume,"*"),te.applyForAll=!0;break}{const ce=this.extract(L,this.consumeTill,_);te.identifierList.push(ce)}}this.attributes.msidSemantic=te}}class mn extends st{constructor(L){super(),we(this,"attributes",void 0),L.protos.indexOf("RTP")!==-1||L.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(L){if(this.digested)throw new Error("already digested");try{switch(L.attField){case"extmap":this.parseExtmap(L);break;case"setup":this.parseSetup(L);break;case"ice-ufrag":this.parseIceUfrag(L);break;case"ice-pwd":this.parseIcePwd(L);break;case"ice-options":this.parseIceOptions(L);break;case"candidate":this.parseCandidate(L);break;case"remote-candidate":this.parseRemoteCandidate(L);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(L);break;case"rtpmap":this.parseRtpmap(L);break;case"ptime":this.parsePtime(L);break;case"maxptime":this.parseMaxPtime(L);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(L);break;case"ssrc":this.parseSSRC(L);break;case"fmtp":this.parseFmtp(L);break;case"rtcp-fb":this.parseRtcpFb(L);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(L);break;case"mid":this.parseMid(L);break;case"msid":this.parseMsid(L);break;case"imageattr":this.parseImageAttr(L);break;case"rid":this.parseRid(L);break;case"simulcast":this.parseSimulcast(L);break;case"sctp-port":this.parseSctpPort(L);break;case"max-message-size":this.parseMaxMessageSize(L);break;case"ssrc-group":this.parseSSRCGroup(L);break;default:L.ignored=!0,this.attributes.unrecognized.push(L)}}catch(te){throw console.error("parsing media attribute ".concat(L.attField,' error, "a=').concat(L.attField,":").concat(L.attValue,'"')),te}if(!L.ignored&&L.attValue&&!this.atEnd(L))throw new Error("attribute parsing error")}parseCandidate(L){const te=this.extractOneOrMore(L,$,[1,32]);this.consumeAttributeSpace(L);const ce=this.extractOneOrMore(L,S,[1,5]);this.consumeAttributeSpace(L);const ze=this.extract(L,this.consumeToken);this.consumeAttributeSpace(L);const jt=this.extractOneOrMore(L,S,[1,10]);this.consumeAttributeSpace(L);const Qn=this.extract(L,this.consumeAddress);this.consumeAttributeSpace(L);const Ni=this.extract(L,this.consumePort);this.consumeAttributeSpace(L),this.extract(L,this.consume,"typ"),this.consumeAttributeSpace(L);const ma={foundation:te,componentId:ce,transport:ze,priority:jt,connectionAddress:Qn,port:Ni,type:this.extract(L,this.consumeToken),extension:{}};for(this.peek(L," raddr")&&(this.extract(L,this.consume," raddr"),this.consumeAttributeSpace(L),ma.relAddr=this.extract(L,this.consumeAddress)),this.peek(L," rport")&&(this.extract(L,this.consume," rport"),this.consumeAttributeSpace(L),ma.relPort=this.extract(L,this.consumePort));this.peekChar(L)===_;){this.consumeAttributeSpace(L);const Uf=this.extract(L,this.consumeToken);this.consumeAttributeSpace(L),ma.extension[Uf]=this.extractOneOrMore(L,w)}this.attributes.candidates.push(ma)}parseRemoteCandidate(L){const te=[];for(;;){const ce=this.extractOneOrMore(L,S,[1,5]);this.consumeAttributeSpace(L);const ze=this.extract(L,this.consumeAddress);this.consumeAttributeSpace(L);const jt=this.extract(L,this.consumePort);te.push({componentId:ce,connectionAddress:ze,port:jt});try{this.consumeAttributeSpace(L)}catch{break}}this.attributes.remoteCandidatesList.push(te)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(L){const te=this.extract(L,this.consumeToken);this.consumeAttributeSpace(L);const ce=this.extract(L,this.consumeTill,"/");this.extract(L,this.consume,"/");const ze={encodingName:ce,clockRate:this.extractOneOrMore(L,S)};this.atEnd(L)||this.peekChar(L)!=="/"||(this.extract(L,this.consume,"/"),ze.encodingParameters=parseInt(this.extract(L,this.consumeTill),10));const jt=this.attributes.payloads.find(Qn=>Qn.payloadType===parseInt(te,10));jt?jt.rtpMap=ze:this.attributes.payloads.push({payloadType:parseInt(te,10),rtpMap:ze,rtcpFeedbacks:[]})}parsePtime(L){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(L,this.consumeTill)}parseMaxPtime(L){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(L,this.consumeTill)}parseDirection(L){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=L.attField}parseSSRC(L){const te=this.extractOneOrMore(L,S);this.consumeAttributeSpace(L);const ce=this.extract(L,this.consumeTill,":");let ze;this.peekChar(L)===":"&&(this.extract(L,this.consume,":"),ze=this.extract(L,this.consumeTill));const jt=this.attributes.ssrcs.find(Qn=>Qn.ssrcId===parseInt(te,10));jt?jt.attributes[ce]=ze:this.attributes.ssrcs.push({ssrcId:parseInt(te,10),attributes:{[ce]:ze}})}parseFmtp(L){const te=this.extract(L,this.consumeTill,_);this.consumeAttributeSpace(L);const ce=this.extract(L,this.consumeTill),ze={};ce.split(";").forEach(Qn=>{let[Ni,ma]=Qn.split("=");Ni=Gs(Ni).call(Ni);const Uf=typeof ma=="string"?Gs(ma).call(ma):null;typeof Ni=="string"&&Ni.length>0&&(ze[Ni]=Uf)});const jt=this.attributes.payloads.find(Qn=>Qn.payloadType===parseInt(te,10));jt?jt.fmtp={parameters:ze}:this.attributes.payloads.push({payloadType:parseInt(te,10),rtcpFeedbacks:[],fmtp:{parameters:ze}})}parseFmtParameters(L){const te={},ce=this.extract(L,this.consumeTill,"=");L._cur++;const ze=this.extract(L,this.consumeTill,";");for(te[ce]=ze;L.attValue[L._cur]===";";){const jt=this.extract(L,this.consumeTill,"=");L._cur++;const Qn=this.extract(L,this.consumeTill,";");te[jt]=Qn}return te}parseRtcpFb(L){let te="";te=this.peekChar(L)==="*"?this.extract(L,this.consume,"*"):this.extract(L,this.consumeTill,_),this.consumeAttributeSpace(L);const ce=this.extract(L,this.consumeTill,_);let ze;if(ce==="trr-int")ze={type:ce,interval:this.extract(L,this.consumeTill)};else{const jt={type:ce};this.peekChar(L)===_&&(this.consumeAttributeSpace(L),jt.parameter=this.extract(L,this.consumeToken),this.peekChar(L)===_&&(jt.additional=this.extract(L,this.consumeTill))),ze=jt}if(te==="*")this.attributes.rtcpFeedbackWildcards.push(ze);else{const jt=this.attributes.payloads.find(Qn=>Qn.payloadType===parseInt(te,10));jt?jt.rtcpFeedbacks.push(ze):this.attributes.payloads.push({payloadType:parseInt(te,10),rtcpFeedbacks:[ze]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(L){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const te={port:this.extract(L,this.consumePort)};this.peekChar(L)===_&&(this.consumeAttributeSpace(L),te.netType=this.extractOneOrMore(L,P),this.consumeAttributeSpace(L),te.addressType=this.extractOneOrMore(L,P),this.consumeAttributeSpace(L),te.address=this.extract(L,this.consumeAddress)),this.attributes.rtcp=te}parseMsid(L){const te={id:this.extractOneOrMore(L,P,[1,64])};this.peekChar(L)===_&&(this.consumeAttributeSpace(L),te.appdata=this.extractOneOrMore(L,P,[1,64])),this.attributes.msids.push(te)}parseImageAttr(L){this.attributes.imageattr.push(L.attValue)}parseRid(L){const te=this.extractOneOrMore(L,ze=>M(ze)||S(ze)||ze==="_"||ze==="-");this.consumeAttributeSpace(L);const ce={id:te,direction:this.extract(L,this.consumeToken),params:[]};if(this.peekChar(L)===_){if(this.consumeAttributeSpace(L),this.peek(L,"pt=")){this.extract(L,this.consume,"pt=");const ze=[];for(;;){const jt=this.extract(L,this.consumeToken);ze.push(jt);try{this.extract(L,this.consume,",")}catch{break}}ce.payloads=ze,this.peekChar(L)===_&&this.extract(L,this.consume,_)}for(;;){const ze=this.extract(L,this.consumeToken);switch(ze){case"depend":{const jt={type:ze,rids:this.extract(L,this.consume,"=").split(",")};ce.params.push(jt);break}default:{const jt={type:ze};this.peekChar(L)==="="&&(this.extract(L,this.consume,"="),jt.val=this.extract(L,this.consumeTill,";")),ce.params.push(jt)}}try{this.extract(L,this.consume,";")}catch{break}}}this.attributes.rids.push(ce)}parseSimulcast(L){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=L.attValue,this.extract(L,this.consumeTill)}parseSctpPort(L){this.attributes.sctpPort=this.extractOneOrMore(L,S,[1,5])}parseMaxMessageSize(L){this.attributes.maxMessageSize=this.extractOneOrMore(L,S,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(L){this.attributes.mid=this.extract(L,this.consumeToken)}parseSSRCGroup(L){const te=this.extract(L,this.consumeToken),ce=[];for(;;)try{this.consumeAttributeSpace(L);const ze=this.extract(L,this.consumeInteger);ce.push(parseInt(ze,10))}catch{break}this.attributes.ssrcGroups.push({semantic:te,ssrcIds:ce})}}function sr(xe,L,te){return L in xe?Object.defineProperty(xe,L,{value:te,enumerable:!0,configurable:!0,writable:!0}):xe[L]=te,xe}class Xr{constructor(){sr(this,"eol",m)}print(L,te){let ce="";return te&&(this.eol=te),ce+=this.printVersion(L.version),ce+=this.printOrigin(L.origin),ce+=this.printSessionName(L.sessionName),ce+=this.printInformation(L.information),ce+=this.printUri(L.uri),ce+=this.printEmail(L.emails),ce+=this.printPhone(L.phones),ce+=this.printConnection(L.connection),ce+=this.printBandwidth(L.bandwidths),ce+=this.printTimeFields(L.timeFields),ce+=this.printKey(L.key),ce+=this.printSessionAttributes(L.attributes),ce+=this.printMediaDescription(L.mediaDescriptions),ce}printVersion(L){return"v=".concat(L).concat(this.eol)}printOrigin(L){return"o=".concat(L.username," ").concat(L.sessId," ").concat(L.sessVersion," ").concat(L.nettype," ").concat(L.addrtype," ").concat(L.unicastAddress).concat(this.eol)}printSessionName(L){return L?"s=".concat(L).concat(this.eol):""}printInformation(L){return L?"i=".concat(L).concat(this.eol):""}printUri(L){return L?"u=".concat(L).concat(this.eol):""}printEmail(L){let te="";for(const ce of L)te+="e=".concat(ce).concat(this.eol);return te}printPhone(L){let te="";for(const ce of L)te+="e=".concat(ce).concat(this.eol);return te}printConnection(L){return L?"c=".concat(L.nettype," ").concat(L.addrtype," ").concat(L.address).concat(this.eol):""}printBandwidth(L){let te="";for(const ce of L)te+="b=".concat(ce.bwtype,":").concat(ce.bandwidth).concat(this.eol);return te}printTimeFields(L){let te="";for(const ce of L){te+="t=".concat(ce.time.startTime," ").concat(ce.time.startTime).concat(this.eol);for(const ze of ce.repeats)te+="r=".concat(ze.repeatInterval," ").concat(ze.typedTimes.join(" ")).concat(this.eol);ce.zoneAdjustments&&(te+="z=",te+="z=".concat(ce.zoneAdjustments.map(ze=>"".concat(ze.time," ").concat(ze.back?"-":""," ").concat(ze.typedTime)).join(" ")).concat(this.eol),te+=this.eol)}return te}printKey(L){return L?"k=".concat(L).concat(this.eol):""}printAttributes(L){let te="";for(const ce of L)te+="a=".concat(ce.attField).concat(ce.attValue?":".concat(ce.attValue):"").concat(this.eol);return te}printMediaDescription(L){let te="";for(const ce of L)te+=this.printMedia(ce.media),te+=this.printInformation(ce.information),te+=this.printConnections(ce.connections),te+=this.printBandwidth(ce.bandwidths),te+=this.printKey(ce.key),te+=this.printMediaAttributes(ce);return te}printConnections(L){let te="";for(const ce of L)te+=this.printConnection(ce);return te}printMedia(L){return"m=".concat(L.mediaType," ").concat(L.port," ").concat(L.protos.join("/")," ").concat(L.fmts.join(" ")).concat(this.eol)}printSessionAttributes(L){return new Wo(this.eol).print(L)}printMediaAttributes(L){return new ke(this.eol).print(L)}}class Fr{constructor(L){sr(this,"eol",void 0),this.eol=L}printIceUfrag(L){return L===void 0?"":"a=ice-ufrag:".concat(L).concat(this.eol)}printIcePwd(L){return L===void 0?"":"a=ice-pwd:".concat(L).concat(this.eol)}printIceOptions(L){return L===void 0?"":"a=ice-options:".concat(L.join(_)).concat(this.eol)}printFingerprints(L){return L.length>0?L.map(te=>"a=fingerprint:".concat(te.hashFunction).concat(_).concat(te.fingerprint)).join(this.eol)+this.eol:""}printExtmap(L){return L.map(te=>"a=extmap:".concat(te.entry).concat(te.direction?"/".concat(te.direction):"").concat(_).concat(te.extensionName).concat(te.extensionAttributes?"".concat(_).concat(te.extensionAttributes):"").concat(this.eol)).join("")}printSetup(L){return L===void 0?"":"a=setup:".concat(L).concat(this.eol)}printUnrecognized(L){return L.map(te=>"a=".concat(te.attField).concat(te.attValue?":".concat(te.attValue):"").concat(this.eol)).join("")}}class Wo extends Fr{print(L){let te="";return te+=this.printGroups(L.groups),te+=this.printMsidSemantic(L.msidSemantic),te+=this.printIceLite(L.iceLite),te+=this.printIceUfrag(L.iceUfrag),te+=this.printIcePwd(L.icePwd),te+=this.printIceOptions(L.iceOptions),te+=this.printFingerprints(L.fingerprints),te+=this.printSetup(L.setup),te+=this.printTlsId(L.tlsId),te+=this.printIdentity(L.identities),te+=this.printExtmap(L.extmaps),te+=this.printUnrecognized(L.unrecognized),te}printGroups(L){let te="";return L.length>0&&(te+=L.map(ce=>"a=group:".concat(ce.semantic).concat(ce.identificationTag.map(ze=>"".concat(_).concat(ze)).join("")).concat(this.eol)).join("")),te}printIceLite(L){return L===void 0?"":"a=ice-lite"+this.eol}printTlsId(L){return L?"a=tls-id:".concat(L).concat(this.eol):""}printIdentity(L){return L.length===0?"":L.map(te=>"a=identity:".concat(te.assertionValue).concat(te.extensions.map(ce=>"".concat(_).concat(ce.name).concat(ce.value?"=".concat(ce.value):"")))).join(this.eol)+this.eol}printMsidSemantic(L){if(!L)return"";let te="a=msid-semantic:".concat(L.semantic);return L.applyForAll?te+="".concat(_,"*"):L.identifierList.length>0&&(te+=L.identifierList.map(ce=>"".concat(_).concat(ce))),te+this.eol}}class ke extends Fr{print(L){const te=L.attributes;let ce="";return ce+=this.printRTCP(te.rtcp),ce+=this.printIceUfrag(te.iceUfrag),ce+=this.printIcePwd(te.icePwd),ce+=this.printIceOptions(te.iceOptions),ce+=this.printCandidates(te.candidates),ce+=this.printRemoteCandidatesList(te.remoteCandidatesList),ce+=this.printEndOfCandidates(te.endOfCandidates),ce+=this.printFingerprints(te.fingerprints),ce+=this.printSetup(te.setup),ce+=this.printMid(te.mid),ce+=this.printExtmap(te.extmaps),ce+=this.printRTPRelated(te),ce+=this.printPtime(te.ptime),ce+=this.printMaxPtime(te.maxPtime),ce+=this.printDirection(te.direction),ce+=this.printSSRCGroups(te.ssrcGroups),ce+=this.printSSRC(te.ssrcs),ce+=this.printRTCPMux(te.rtcpMux),ce+=this.printRTCPMuxOnly(te.rtcpMuxOnly),ce+=this.printRTCPRsize(te.rtcpRsize),ce+=this.printMSId(te.msids),ce+=this.printImageattr(te.imageattr),ce+=this.printRid(te.rids),ce+=this.printSimulcast(te.simulcast),ce+=this.printSCTPPort(te.sctpPort),ce+=this.printMaxMessageSize(te.maxMessageSize),ce+=this.printUnrecognized(te.unrecognized),ce}printCandidates(L){return L.map(te=>"a=candidate:".concat(te.foundation).concat(_).concat(te.componentId).concat(_).concat(te.transport).concat(_).concat(te.priority).concat(_).concat(te.connectionAddress).concat(_).concat(te.port).concat(_,"typ").concat(_).concat(te.type).concat(te.relAddr?"".concat(_,"raddr").concat(_).concat(te.relAddr):"").concat(te.relPort?"".concat(_,"rport").concat(_).concat(te.relPort):"").concat(Object.keys(te.extension).map(ce=>"".concat(_).concat(ce).concat(_).concat(te.extension[ce])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(L){return L.map(te=>"a=remote-candidates:".concat(te.join(_)).concat(this.eol)).join("")}printEndOfCandidates(L){return L===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(L){if(!L.payloads)return"";const te=L.payloads;let ce="";ce+=L.rtcpFeedbackWildcards.map(ze=>this.printRTCPFeedback("*",ze)).join("");for(const ze of te)ce+=this.printRtpMap(ze.payloadType,ze.rtpMap),ce+=this.printFmtp(ze.payloadType,ze.fmtp),ce+=ze.rtcpFeedbacks.map(jt=>this.printRTCPFeedback(ze.payloadType,jt)).join("");return ce}printFmtp(L,te){if(!te)return"";const ce=Object.keys(te.parameters);return ce.length===1&&te.parameters[ce[0]]===null?"a=fmtp:".concat(L).concat(_).concat(ce[0]).concat(this.eol):"a=fmtp:".concat(L).concat(_).concat(Object.keys(te.parameters).map(ze=>"".concat(ze,"=").concat(te.parameters[ze])).join(";")).concat(this.eol)}printRtpMap(L,te){return te?"a=rtpmap:".concat(L).concat(_).concat(te.encodingName,"/").concat(te.clockRate).concat(te.encodingParameters?"/".concat(te.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(L,te){let ce="a=rtcp-fb:".concat(L).concat(_),ze=te;return ze.type==="trr-int"?ce+="ttr-int".concat(_).concat(ze.interval):(ce+="".concat(ze.type),ze.parameter&&(ce+="".concat(_).concat(ze.parameter),ze.additional&&(ce+="".concat(_).concat(ze.additional)))),ce+this.eol}printPtime(L){return L===void 0?"":"a=ptime:".concat(L).concat(this.eol)}printMaxPtime(L){return L===void 0?"":"a=maxptime:".concat(L).concat(this.eol)}printDirection(L){return L===void 0?"":"a=".concat(L).concat(this.eol)}printSSRC(L){return L.map(te=>Object.keys(te.attributes).map(ce=>"a=ssrc:".concat(te.ssrcId.toString(10)).concat(_).concat(ce).concat(te.attributes[ce]?":".concat(te.attributes[ce]):"").concat(this.eol)).join("")).join("")}printRTCPMux(L){return L===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(L){return L===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(L){return L===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(L){if(L===void 0)return"";let te="a=rtcp:".concat(L.port);return L.netType&&(te+="".concat(_).concat(L.netType)),L.addressType&&(te+="".concat(_).concat(L.addressType)),L.address&&(te+="".concat(_).concat(L.address)),te+this.eol}printMSId(L){return L.map(te=>"a=msid:".concat(te.id).concat(te.appdata?"".concat(_).concat(te.appdata):"").concat(this.eol)).join("")}printImageattr(L){return L.map(te=>"a=imageattr:".concat(te).concat(this.eol)).join("")}printRid(L){return L.map(te=>{let ce="a=rid:".concat(te.id).concat(_).concat(te.direction);return te.payloads&&(ce+="".concat(_,"pt=").concat(te.payloads.join(","))),te.params.length>0&&(ce+="".concat(_).concat(te.params.map(ze=>ze.type==="depend"?"depend=".concat(ze.rids.join(",")):"".concat(ze.type,"=").concat(ze.val)).join(";"))),ce+this.eol}).join("")}printSimulcast(L){return L===void 0?"":"a=simulcast:".concat(L).concat(this.eol)}printSCTPPort(L){return L===void 0?"":"a=sctp-port:".concat(L).concat(this.eol)}printMaxMessageSize(L){return L===void 0?"":"a=max-message-size:".concat(L).concat(this.eol)}printMid(L){return L===void 0?"":"a=mid:".concat(L).concat(this.eol)}printSSRCGroups(L){return L.map(te=>"a=ssrc-group:".concat(te.semantic).concat(te.ssrcIds.map(ce=>"".concat(_).concat(ce.toString(10))).join("")).concat(this.eol)).join("")}}function Ye(xe){return new nt().parse(xe)}function ft(xe,L){return new Xr().print(xe,L)}}},n={};function i(o){if(n[o])return n[o].exports;var c=n[o]={exports:{}};return e[o](c,c.exports,i),c.exports}return i.d=(o,c)=>{for(var u in c)i.o(c,u)&&!i.o(o,u)&&Object.defineProperty(o,u,{enumerable:!0,get:c[u]})},i.o=(o,c)=>Object.prototype.hasOwnProperty.call(o,c),i.r=o=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})},i(8)})();function da(e){return gW.parse(e)}function Zp(e,n){return gW.print(e,n)}var Phe=ka("Array").keys,Nhe=ic,khe=ui,Dhe=N,Lhe=Phe,_L=Array.prototype,xhe={DOMTokenList:!0,NodeList:!0},Mhe=function(e){var n=e.keys;return e===_L||Dhe(_L,e)&&n===_L.keys||khe(xhe,Nhe(e))?Lhe:n},yc=l(Mhe);function _W(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function Qt(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?_W(Object(i),!0).forEach(function(o){Lr(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):_W(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function Lr(e,n,i){return(n=function(o){var c=function(u,h){if(typeof u!="object"||u===null)return u;var m=u[Symbol.toPrimitive];if(m!==void 0){var _=m.call(u,"string");if(typeof _!="object")return _;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(u)}(o);return typeof c=="symbol"?c:String(c)}(n))in e?Object.defineProperty(e,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[n]=i,e}const EW=new class extends Rr{constructor(){super(...arguments),Lr(this,"currentUploadLogID",0)}reportLogUploadError(e){const{errorRange:n}=e;n[n.length-1]&&n[n.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=n[n.length-1],this.emit("REPORT_LOG_UPLOAD",e))}};class Uhe{constructor(n){Lr(this,"logger",void 0),Lr(this,"prefixLists",[]),this.logger=n}debug(){for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];this.logger.debug(...this.prefixLists,...i)}info(){for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];this.logger.info(...this.prefixLists,...i)}warning(){for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];this.logger.warning(...this.prefixLists,...i)}error(){for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];this.logger.error(...this.prefixLists,...i)}prefix(n){return this.prefixLists.push(n),this}popPrefix(){return this.prefixLists.pop(),this}}function EL(){const e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function yW(){const e=new Date,n=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return n?(n==null?void 0:n[0])+":"+e.getUTCMilliseconds():e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}const nl={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},cA=Date.now(),V0=e=>{for(const n in nl)if(Object.prototype.hasOwnProperty.call(nl,n)&&nl[n]===e)return n;return"DEFAULT"},k=new class{constructor(){Lr(this,"proxyServerURL",void 0),Lr(this,"logLevel",nl.DEBUG),Lr(this,"uploadState","collecting"),Lr(this,"uploadLogWaitingList",[]),Lr(this,"uploadLogUploadingList",[]),Lr(this,"uploadErrorCount",0),Lr(this,"currentLogID",0),Lr(this,"url",void 0),Lr(this,"extLog",(e,n)=>{this.appendLogToWaitingList(e,...n)})}debug(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];const o=[nl.DEBUG].concat(n);this.log.apply(this,o)}info(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];const o=[nl.INFO].concat(n);this.log.apply(this,o)}warning(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];const o=[nl.WARNING].concat(n);this.log.apply(this,o)}warn(){this.warning(...arguments)}error(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];const o=[nl.ERROR].concat(n);this.log.apply(this,o)}upload(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];const o=[nl.DEBUG].concat(n);this.uploadLog.apply(this,o)}setLogLevel(e){e=Math.min(Math.max(0,e),4),this.logLevel=e}enableLogUpload(){qn("UPLOAD_LOG",!0)}disableLogUpload(){qn("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e){this.proxyServerURL=e}prefix(e){return new Uhe(this).prefix(e)}log(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];if(Date.now()-cA<100)return void setTimeout(()=>{this.log(...n)},Date.now()-cA);const o=Math.max(0,Math.min(4,n[0]));if(n[0]=EL()+" Agora-SDK [".concat(V0(o),"]:"),this.appendLogToWaitingList(o,...n),o<this.logLevel)return;const c=EL()+" %cAgora-SDK [".concat(V0(o),"]:");let u=[];if(!Z("USE_NEW_LOG"))switch(o){case nl.DEBUG:u=[c,"color: #64B5F6;"].concat(n.slice(1)),console.log.apply(console,u);break;case nl.INFO:u=[c,"color: #1E88E5; font-weight: bold;"].concat(n.slice(1)),console.log.apply(console,u);break;case nl.WARNING:u=[c,"color: #FB8C00; font-weight: bold;"].concat(n.slice(1)),console.warn.apply(console,u);break;case nl.ERROR:u=[c,"color: #B00020; font-weight: bold;"].concat(n.slice(1)),console.error.apply(console,u)}}uploadLog(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];if(Date.now()-cA<100)return void setTimeout(()=>{this.uploadLog(...n)},Date.now()-cA);const o=Math.max(0,Math.min(4,n[0]));n[0]=EL()+" Agora-SDK [".concat(V0(o),"]:"),this.appendLogToWaitingList(o,...n)}appendLogToWaitingList(e){if(!Z("UPLOAD_LOG"))return;for(var n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];Array.isArray(i[0])?i[0][0]=yW()+" Agora-SDK [".concat(V0(e),"]:"):i[0]=yW()+" Agora-SDK [".concat(V0(e),"]:");let c="";i.forEach(u=>{typeof u=="object"&&(u=JSON.stringify(u)),c+="".concat(u," ")}),this.uploadLogWaitingList.push({payload_str:c,log_level:e,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const e=this.uploadLogUploadingList,n={sdk_version:tl,process_id:Z("PROCESS_ID"),payload:JSON.stringify(e)};return qu(async()=>{const i=await Mo.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(Z("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(Z("LOG_UPLOAD_SERVER"),"/upload/v1")),n,{responseType:"text"});if(i.data!=="OK"){const o=new Error("unexpected upload log response");throw o.response=i,o}},()=>(this.uploadLogUploadingList=[],!1),i=>{const o={status:-1,message:i.message,errorRange:e.map(c=>c.log_item_id)};return i.response?(o.status=i.response.status,o.data=i.response.data,o.headers=i.response.headers):i.request&&(o.status=i.request.status),EW.reportLogUploadError(o),!0},{timeout:Z("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:Z("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,Z("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),Z("UPLOAD_LOG_INTERVAL"))}).catch(e=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),Z("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),Z("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var vW;function Vhe(e){return qi(e.reportId,"params.reportId",0,100,!1),qi(e.category,"params.category",0,100,!1),qi(e.event,"params.event",0,100,!1),qi(e.label,"params.label",0,100,!1),Jn(e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(vW={}).FREE="free",vW.UPLOADING="uploading",function(e){e[e.MISC=0]="MISC",e[e.INTERNAL_EVENT=1]="INTERNAL_EVENT",e[e.PUBLIC_EVENT=2]="PUBLIC_EVENT",e[e.WEB_EVENT=3]="WEB_EVENT",e[e.INTERNAL_API=4]="INTERNAL_API",e[e.WEB_API=5]="WEB_API",e[e.PUBLIC_API=6]="PUBLIC_API"}({});const Fhe={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let Oi=function(e){return e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.WS_COMPRESSOR_INIT="ws_compressor_init",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.REJOIN_GATEWAY="rejoin_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics",e.PC_STATS="pc_stats",e.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",e.AB_TEST="ab_test",e}({}),vr=function(e){return e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",e.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",e.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",e.PC_STATS="io.agora.pb.Wrtc.PCStats",e.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",e.AB_TEST="io.agora.pb.Wrtc.ABTest",e}({});(function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let jhe=function(e){return e[e.SESSION=26]="SESSION",e[e.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",e[e.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",e[e.JOIN_GATEWAY=28]="JOIN_GATEWAY",e[e.PUBLISH=30]="PUBLISH",e[e.SUBSCRIBE=29]="SUBSCRIBE",e[e.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",e[e.STREAM_SWITCH=32]="STREAM_SWITCH",e[e.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",e[e.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",e[e.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",e[e.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",e[e.API_INVOKE=41]="API_INVOKE",e[e.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",e[e.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",e[e.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",e[e.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",e[e.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",e[e.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",e[e.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",e[e.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",e[e.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",e[e.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",e[e.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",e[e.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",e[e.USER_ANALYTICS=1e4]="USER_ANALYTICS",e[e.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",e}({});function At(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(n,i,o){const c=o.value;if(typeof c=="function"){const u=e.className||n.__className__||(n.constructor.name==="AgoraRTCClient"?"Client":n.constructor.name);o.value=function(){for(var h,m=arguments.length,_=new Array(m),y=0;y<m;y++)_[y]=arguments[y];let S=_;if(e.argsMap)try{S=e.argsMap(this,..._)}catch(I){k.warning(I),S=[]}try{JSON.stringify(S)}catch{k.warning("arguments for method ".concat(u,".").concat(String(i)," not serializable for apiInvoke.")),S=[]}const w=(e.report||yt).reportApiInvoke(this._sessionId||null,{id:this._clientId||((h=this.store)===null||h===void 0?void 0:h.clientId)||this._ID,name:"".concat(u,".").concat(String(i)),options:S,tag:kr.TRACER,reportResult:e.reportResult},e.throttleTime);try{const I=c.apply(this,_);return I instanceof tt?I.then(P=>(w.onSuccess(e.reportResult&&P),P)).catch(P=>{throw w.onError(P),P}):(w.onSuccess(e.reportResult&&I),I)}catch(I){throw w.onError(I),I}}}return o}}const yt=new class{constructor(){Lr(this,"baseInfoMap",new Map),Lr(this,"proxyServer",void 0),Lr(this,"eventUploadTimer",void 0),Lr(this,"setSessionIdTimer",void 0),Lr(this,"url",void 0),Lr(this,"sids",new Set),Lr(this,"backupUrl",void 0),Lr(this,"_appId",void 0),Lr(this,"_aid",0),Lr(this,"keyEventUploadPendingItems",[]),Lr(this,"normalEventUploadPendingItems",[]),Lr(this,"apiInvokeUploadPendingItems",[]),Lr(this,"apiInvokeCount",0),Lr(this,"apiInvokeLoggedCount",0),Lr(this,"ltsList",[]),Lr(this,"lastSendNormalEventTime",Date.now()),Lr(this,"customReportCounterTimer",void 0),Lr(this,"customReportCount",0),Lr(this,"extApiInvoke",async e=>{for(const n of e){const i=Qt(Qt({},n),{},{sid:null,invokeId:++this.apiInvokeCount,tag:kr.TRACER});this.sendApiInvoke(i)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),Z("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),Z("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(e){return this.baseInfoMap.get(e)}setAppId(e){this._appId=e,this._aid=parseInt(e.replace(/[a-fA-F0-9]{8}/g,n=>{let[i,o]=n;return i+o}),16)||0}reportApiInvoke(e,n,i){n.timeout=n.timeout||6e4,n.reportResult=n.reportResult===void 0||n.reportResult;const o=Date.now();this.apiInvokeCount+=1;const c=this.apiInvokeCount,u=!!Z("SHOW_REPORT_INVOKER_LOG"),h=!!Z("SHOW_REPORT_USER_INVOKER_LOG"),m=u||h&&n.id;m&&(this.apiInvokeLoggedCount+=1);const _=this.apiInvokeLoggedCount;function y(P,B){if(m){let M="[apiInvoke-".concat(_,"]");n.id&&(M+="[".concat(n.id,"]")),n.name&&(M+="[".concat(n.name,"]")),k.info("".concat(M," ").concat(P),P==="start"?n.options:B||"")}}const S=()=>({tag:n.tag,invokeId:c,sid:e,name:n.name,apiInvokeTime:o,options:n.options,states:n.states||null});y("start");let w=!1;$i(n.timeout).then(()=>{w||(this.sendApiInvoke(Qt(Qt({},S()),{},{error:Y.API_INVOKE_TIMEOUT,success:!1})),y("timeout"))});const I=new Ce(Y.UNEXPECTED_ERROR,"".concat(n.name,": this api invoke is end"));return{onSuccess:P=>{const B=()=>{if(w)throw I;return w=!0,this.sendApiInvoke(Qt(Qt({},S()),{},{success:!0},n.reportResult&&{result:P})),y("onSuccess"),P};return i?Z6(B,n.name+"Success",i,()=>w=!0):B()},onError:P=>{const B=()=>{if(w)throw P;w=!0,this.sendApiInvoke(Qt(Qt({},S()),{},{success:!1,error:P})),y("onFailure",P.toString())};return i?Z6(B,n.name+"Error",i,()=>w=!0):B()}}}sessionInit(e,n){if(this.baseInfoMap.has(e))return;const i=Date.now(),o=this.createBaseInfo(e,i);o.cname=n.cname;const c=Object.assign({},{willUploadConsoleLog:Z("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:fL?"global":"oversea",areas:Z("AREAS")&&Z("AREAS").join(",")},n.extend),{stringUid:u,channelProfile:h,channelMode:m,isABTestSuccess:_,lsid:y,clientRole:S}=n,w=Date.now(),I=Qt(Qt({},o),{},{eventType:Oi.SESSION_INIT,appid:n.appid,browser:navigator.userAgent,buildFormat:n.buildFormat,build:mL,lts:w,elapse:w-i,extend:JSON.stringify(c),mode:n.mode,process:Z("PROCESS_ID"),appType:Z("APP_TYPE"),success:!0,version:tl,stringUid:u,channelProfile:h,channelMode:m,isABTestSuccess:_,lsid:y,clientType:Xe(P=window.navigator.userAgent).call(P,"AgoraWebView")?42:20,clientRole:S,serviceId:Z("PROCESS_ID"),extensionID:Z("PLUGIN_INFO").join(",")||""});var P;this.send({type:vr.SESSION,data:I},!0)}joinChooseServer(e,n){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=Qt(Qt({},o),{},{role:n.role,eventType:Oi.JOIN_CHOOSE_SERVER,lts:c,eventElapse:n.elapse||c-n.lts,chooseServerAddr:n.csAddr,errorCode:n.ec,elapse:c-i.startTime,success:n.succ,chooseServerAddrList:JSON.stringify(n.serverList),uid:n.uid?parseInt(n.uid):null,cid:n.cid?parseInt(n.cid):null,chooseServerIp:n.csIp||"",opid:n.opid,unilbsServerIds:n.unilbsServerIds,extend:n.extend||void 0,isHttp3:n.isHttp3,corssRegionTagReq:n.corssRegionTagReq||void 0,corssRegionTagRes:n.corssRegionTagRes||void 0});this.send({type:vr.JOIN_CHOOSE_SERVER,data:u},!0)}reqUserAccount(e,n){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=Qt(Qt({},o),{},{eventType:Oi.REQ_USER_ACCOUNT,lts:c,success:n.success,serverAddress:n.serverAddr,stringUid:n.stringUid,uid:n.uid,errorCode:n.errorCode,elapse:n.elapse||c-i.startTime,eventElapse:c-n.lts,extend:JSON.stringify(n.extend)});this.send({type:vr.REQ_USER_ACCOUNT,data:u},!0)}joinGateway(e,n){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info;n.vid&&(o.vid=n.vid),o.uid=n.uid,o.cid=n.cid;const c=Date.now(),{firstSuccess:u,avoidJoinStartTime:h,addr:m,isProxy:_}=n,y=c-(u&&h?h:i.startTime),S=Qt(Qt({},o),{},{eventType:Oi.JOIN_GATEWAY,lts:c,gatewayAddr:n.addr,success:n.succ,errorCode:n.ec,errorMsg:n.errorMsg||"",elapse:y,eventElapse:c-n.lts,firstSuccess:u,signalChannel:n.signalChannel,preload:n.preload?1:0,installId:hL(),isABTestSuccess:n.isABTestSuccess?1:0}),w=S.success?1:0;if(n.succ&&(i.lastJoinSuccessTime=c),u)this.send({type:vr.JOIN_GATEWAY,data:S},!0);else{let I;if(m)if(_){const B=m.match(/h=(\d{1,3}-){3}\d{1,3}/g),M=m.match(/p=[0-9]{1,6}/g);I={isSuccess:w,gatewayIp:B&&B.length?B[0].split("=")[1].replace(/-/g,"."):"",port:M&&M.length?M[0].split("=")[1]:"",isProxy:_?1:0}}else{const B=m.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),M=m.match(/(:|p=)[0-9]{1,6}/g);I={isSuccess:w,gatewayIp:B&&B.length?B[0].split("//")[1].replace(/-/g,"."):"",port:M&&M.length?M[0].split(/:|p=/g)[1]:"",isProxy:_?1:0}}else I={isSuccess:w,gatewayIp:"",port:"",isProxy:_?1:0};delete S.success,delete S.eventType,delete S.firstSuccess,S.vid=Number(S.vid);const P=Object.assign({},S,I,{eventType:Oi.REJOIN_GATEWAY});this.send({type:vr.RE_JOIN_GATEWAY,data:P},!0)}}joinChannelTimeout(e,n){const i=this.baseInfoMap.get(e);if(!i)return;const o=Date.now(),c=Qt(Qt({},i.info),{},{lts:o,timeout:n,elapse:o-i.startTime});this.send({type:vr.JOIN_CHANNEL_TIMEOUT,data:c},!0)}publish(e,n){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=Qt(Qt({},o),{},{eventType:Oi.PUBLISH,lts:c,eventElapse:n.eventElapse,elapse:c-i.startTime,success:n.succ,errorCode:n.ec,videoName:n.videoName,audioName:n.audioName,screenName:n.screenName,screenshare:n.screenshare,audio:n.audio,video:n.video,p2pid:n.p2pid,publishRequestid:n.publishRequestid});this.send({type:vr.PUBLISH,data:u},!0)}subscribe(e,n,i){const o=this.baseInfoMap.get(e);if(!o)return;const c=o.info,u=Date.now(),h=Qt(Qt({},c),{},{eventType:Oi.SUBSCRIBE,lts:u,eventElapse:n.eventElapse,elapse:u-o.startTime,success:n.succ,errorCode:n.ec,video:n.video,audio:n.audio,subscribeRequestid:n.subscribeRequestid,p2pid:n.p2pid,preSsrc:n.preSsrc?1:0},i&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof n.peerid=="string"?h.peerSuid=n.peerid:h.peer=n.peerid,this.send({type:vr.SUBSCRIBE,data:h},!0)}wsCompressorInit(e){var n;const i=[...yc(n=this.baseInfoMap).call(n)],o=i.length?i[0]:"UnableToGetSid",c=this.baseInfoMap.get(o);if(!c)return;const u=c.info,h=Date.now(),m=Qt(Qt({},u),{},{eventType:Oi.WS_COMPRESSOR_INIT,lts:h,eventElapse:e.eventElapse,elapse:h-c.startTime,status:e.status?1:2});this.send({type:vr.WS_COMPRESSOR_INIT,data:m},!0)}firstRemoteVideoDecode(e,n,i,o){const c=this.baseInfoMap.get(e);if(!c)return;const u=c.info,h=Date.now(),m=Qt(Qt(Qt({},u),o),{},{elapse:h-c.startTime,eventType:n,lts:h,firstDecodeFrame:Math.max((o.firstFrame||h)-c.startTime,0),apEnd:Math.max(o.apEnd-c.startTime,0),apStart:Math.max(o.apStart-c.startTime,0),joinGwEnd:Math.max(o.joinGwEnd-c.startTime,0),joinGwStart:Math.max(o.joinGwStart-c.startTime,0),pcEnd:Math.max(o.pcEnd-c.startTime,0),pcStart:Math.max(o.pcStart-c.startTime,0),subscriberEnd:Math.max(o.subscriberEnd-c.startTime,0),subscriberStart:Math.max(o.subscriberStart-c.startTime,0),videoAddNotify:Math.max(o.videoAddNotify-c.startTime,0)});this.send({type:i,data:m},!0)}firstRemoteFrame(e,n,i,o){const c=this.baseInfoMap.get(e);if(!c)return;const u=c.info,h=Date.now(),m=Qt(Qt(Qt({},u),o),{},{elapse:h-c.startTime,eventType:n,lts:h});this.send({type:i,data:m},!0)}abTest(e,n){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=Qt(Qt(Qt({},o),n),{},{vid:o.vid===void 0?0:Number(o.vid),elapse:c-i.startTime,eventType:Oi.AB_TEST,lts:c});this.send({type:vr.AB_TEST,data:u},!0)}pcStats(e,n){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=Qt(Qt(Qt({},o),n),{},{vid:o.vid===void 0?0:Number(o.vid),elapse:c-i.startTime,eventType:Oi.PC_STATS,lts:c,preallocation:n.preallocation?1:0});this.send({type:vr.PC_STATS,data:u},!0)}updateRemoteRTPCapabilities(e,n){if(e){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=Qt(Qt(Qt({},o),n),{},{vid:o.vid===void 0?0:Number(o.vid),eventType:Oi.UPDATE_REMOTE_RTPCAPABILITIES,lts:c});this.send({type:vr.UPDATE_REMOTE_RTPCAPABILITIES,data:u},!0)}}onGatewayStream(e,n,i,o){const c=this.baseInfoMap.get(e);if(!c)return;const u=c.info,h=Date.now(),m=Qt(Qt(Qt({},u),o),{},{eventType:n,lts:h});this.send({type:i,data:m},!0)}streamSwitch(e,n){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=Qt(Qt({},o),{},{eventType:Oi.STREAM_SWITCH,lts:c,isDual:n.isdual,elapse:c-i.startTime,success:n.succ});this.send({type:vr.STREAM_SWITCH,data:u},!0)}requestProxyAppCenter(e,n){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=Qt(Qt({},o),{},{eventType:Oi.REQUEST_PROXY_APPCENTER,lts:c,eventElapse:c-n.lts,elapse:c-i.startTime,APAddr:n.APAddr,workerManagerList:n.workerManagerList,response:n.response,errorCode:n.ec,success:n.succ});this.send({type:vr.REQUEST_PROXY_APPCENTER,data:u},!0)}requestProxyWorkerManager(e,n){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=Qt(Qt({},o),{},{eventType:Oi.REQUEST_PROXY_WORKER_MANAGER,lts:c,eventElapse:c-n.lts,elapse:c-i.startTime,workerManagerAddr:n.workerManagerAddr,response:n.response,errorCode:n.ec,success:n.succ});this.send({type:vr.REQUEST_PROXY_WORKER_MANAGER,data:u},!0)}setProxyServer(e){this.proxyServer=e,e?k.debug("reportProxyServerurl: ".concat(e)):k.debug("disable reportProxyServerurl: ".concat(e))}peerPublishStatus(e,n){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=Qt(Qt({},o),{},{subscribeElapse:n.subscribeElapse,peer:n.peer,peerPublishDuration:Math.max(n.audioPublishDuration,n.videoPublishDuration),audiotag:n.audioPublishDuration>0?1:-1,videotag:n.videoPublishDuration>0?1:-1,lts:c,elapse:c-i.startTime,joinChannelSuccessElapse:c-(i.lastJoinSuccessTime||c),peerPublishDurationVideo:n.videoPublishDuration,peerPublishDurationAudio:n.audioPublishDuration});this.send({type:vr.PEER_PUBLISH_STATUS,data:u},!0)}workerEvent(e,n){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now();(function(u,h,m){const _=u[h];if(!_||typeof _!="string")return[u];u[h]="";const y=Gd(JSON.stringify(u));let S=0;const w=[];let I=0;for(let P=0;P<_.length;P++)I+=_.charCodeAt(P)<=127?1:3,I<=m-y||(w[w.length]=ot(ot({},u),{},{[h]:_.substring(S,P)}),S=P,I=_.charCodeAt(P)<=127?1:3);return S!==_.length-1&&(w[w.length]=ot(ot({},u),{},{[h]:_.substring(S)})),w})(Qt(Qt(Qt({},o),n),{},{elapse:c-i.startTime,lts:c,productType:"WebRTC"}),"payload",1300).forEach(u=>this.send({type:vr.WORKER_EVENT,data:u},!0))}apworkerEvent(e,n){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=Qt(Qt(Qt({},o),n),{},{elapse:c-i.startTime,lts:c});this.send({type:vr.AP_WORKER_EVENT,data:u},!0)}joinWebProxyAP(e,n){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=Qt(Qt(Qt({},o),n),{},{elapse:c-i.startTime,lts:c,extend:n.extend||void 0});this.send({type:vr.JOIN_WEB_PROXY_AP,data:u},!0)}WebSocketQuit(e,n){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=Qt(Qt(Qt({},o),n),{},{elapse:c-i.startTime,lts:c});this.send({type:vr.WEBSOCKET_QUIT,data:u},!0)}async sendCustomReportMessage(e,n){if(this.customReportCount+=n.length,this.customReportCount>Z("CUSTOM_REPORT_LIMIT"))throw new Ce(Y.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const i=Date.now(),o=n.map(c=>({type:vr.USER_ANALYTICS,data:Qt(Qt({sid:e},c),{},{lts:i})}));try{Z("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(o):await this.postDataToStatsCollector(o)}catch(c){throw k.error("send custom report message failed",c.toString()),new Ce(Y.CUSTOM_REPORT_SEND_FAILED,c.message)}}sendApiInvoke(e){const n=Z("NOT_REPORT_EVENT");if(e.tag&&Xe(n)&&Xe(n).call(n,e.tag))return!1;if(e.sid===null)return this.apiInvokeUploadPendingItems.push(e),!1;const i=this.baseInfoMap.get(e.sid);if(!i)return this.apiInvokeUploadPendingItems.push(e),!1;const{cname:o,uid:c,cid:u}=i.info;let h;if(e.lts=e.lts||Date.now(),e.error)if(e.error instanceof Ce){const{code:_,message:y}=e.error;h=_||y||e.error.toString()}else h=e.error.toString();const m={invokeId:e.invokeId,sid:e.sid,cname:o,cid:u,uid:c,lts:e.lts,success:e.success,elapse:e.lts-i.startTime,execElapse:e.lts-e.apiInvokeTime,apiName:e.name,options:e.options?JSON.stringify(e.options):void 0,execStates:e.states?JSON.stringify(e.states):void 0,execResult:e.result?JSON.stringify(e.result):void 0,errorCode:e.error?h:void 0,errorMsg:e.error?JSON.stringify(e.error):void 0};return this.send({type:vr.API_INVOKE,data:m},!1),!0}addSid(e){this.sids.add(e)}removeSid(e){this.sids.delete(e)}appendSessionId(){const e=this.apiInvokeUploadPendingItems;if(e.length===0)return;const n=Array.from(this.sids).find(i=>i!==null);n&&e.forEach(i=>{i&&(i.sid=n,this.sendApiInvoke(Object.assign({},i)))}),e.length=0}send(e,n){if(n)return this.keyEventUploadPendingItems.push(e),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(e),this.normalEventUploadPendingItems.length>Z("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(e,n){const i=[],o=[];for(;e.length;){const u=e.shift();i.length<20?i.push(u):o.push(u)}e.push(...o);for(const u of[...i]){var c;this.ltsList.indexOf(u.data.lts)!==-1?(u.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(u.data.lts)):(this.ltsList.push(u.data.lts),_0(c=this.ltsList).call(c,(h,m)=>h-m))}return n||(this.lastSendNormalEventTime=Date.now()),Z("ENABLE_EVENT_REPORT")&&i.length&&(Z("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(i):this.postDataToStatsCollector(i)).catch((u=>h=>{Z("EVENT_REPORT_RETRY")&&(n?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(u):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(u),this.normalEventUploadPendingItems.length>Z("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-Z("NORMAL_EVENT_QUEUE_CAPACITY")),k.warning("report: drop normal events"))))})(i)),e}async postDataToStatsCollector2(e){ri.networkState===ja.OFFLINE&&await tt.race([ri.onlineWaiter,$i(2*pi.maxRetryTimeout)]);const n=c=>{let u=new Uint8Array;return c.forEach(h=>{const m=eL(JSON.stringify(h.data)),_=new ArrayBuffer(5),y=(w=>{let I=0;return Object.entries(vr).forEach(P=>{let[B,M]=P;M===w.type&&(I=jhe[B])}),I})(h),S=new DataView(_);S.setUint16(0,m.byteLength,!0),S.setUint8(2,255&y),S.setUint8(3,y>>>8&255),S.setUint8(4,y>>>16&255),u=z6(u,new Uint8Array(_)),u=z6(u,m)}),u},i="event";let o=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(Z("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(i):"https://".concat(Z("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(i);for(let c=0;c<2;c+=1){c===1&&(o=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(Z("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(i):"https://".concat(Z("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(i));try{await aL(o,{timeout:1e4,data:n(e),headers:Qt(Qt({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(u){if(c===1)throw u;continue}return}}async postDataToStatsCollector(e){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const i=(m=>{const _=m&&m.data.sid&&this.baseInfoMap.get(m.data.sid);return _&&_.info.vid&&+_.info.vid||0})(e[0]),o=i?void 0:this._aid,c={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:e.map(m=>JSON.stringify(m)),vid:i,aid:o};ri.networkState===ja.OFFLINE&&await tt.race([ri.onlineWaiter,$i(2*pi.maxRetryTimeout)]);const u=n?"/events/proto-raws":"/events/messages";let h=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(Z("EVENT_REPORT_DOMAIN"),"&p=").concat(Z("STATS_COLLECTOR_PORT"),"&d=").concat(u):"https://".concat(Z("EVENT_REPORT_DOMAIN"),":").concat(Z("STATS_COLLECTOR_PORT")).concat(u));for(let m=0;m<2;m+=1){m===1&&(h=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(Z("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(Z("STATS_COLLECTOR_PORT"),"&d=").concat(u):"https://".concat(Z("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(Z("STATS_COLLECTOR_PORT")).concat(u)));try{n?await Rhe(h,{timeout:1e4,data:c}):await aL(h,{timeout:1e4,data:c})}catch(_){if(m===1)throw _;continue}return}}createBaseInfo(e,n){const i=Object.assign({},Fhe);return i.sid=e,this.baseInfoMap.set(e,{info:i,startTime:n}),i}reportResourceTiming(e,n){const i=performance.getEntriesByName(e),o=i[i.length-1];o&&this.reportApiInvoke(n,{name:"Client.resourceTiming",options:o,tag:kr.TRACER}).onSuccess()}};EW.on("REPORT_LOG_UPLOAD",e=>{e.networkState=ri.networkState,yt.reportApiInvoke(null,{name:"logUploadError",options:e,tag:kr.TRACER}).onSuccess("logUploadError")});class be extends Ce{constructor(n){super(n,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),Lr(this,"name","AgoraRTCException")}print(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(n,k)}throw(){super.throw(k)}}const Yi={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function On(){return Yi}function SW(){return"setSinkId"in HTMLAudioElement.prototype&&(!Z("RESTRICTION_SET_PLAYBACK_DEVICE")||(Tf()||k6())&&!J1())}function TW(){return!Yi.supportUnifiedPlan||Z("CHROME_FORCE_PLAN_B")&&bf()}let Xi=function(e){return e.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",e.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",e.IOS_INTERRUPTION_START="ios-interruption-start",e.IOS_INTERRUPTION_END="ios-interruption-end",e.STATE_CHANGE="state-change",e}({});function Qy(e,n,i){return{sampleRate:e,stereo:n,bitrate:i}}function bn(e,n,i,o,c){return{width:e,height:n,frameRate:i,bitrateMin:o,bitrateMax:c}}function Hl(e,n,i,o,c){return{width:{max:e},height:{max:n},frameRate:i,bitrateMin:o,bitrateMax:c}}function yL(e,n){return{numSpatialLayers:e,numTemporalLayers:n}}const Bhe={"90p":bn(160,90),"90p_1":bn(160,90),"120p":bn(160,120,15,30,65),"120p_1":bn(160,120,15,30,65),"120p_3":bn(120,120,15,30,50),"120p_4":bn(212,120),"180p":bn(320,180,15,30,140),"180p_1":bn(320,180,15,30,140),"180p_3":bn(180,180,15,30,100),"180p_4":bn(240,180,15,30,120),"240p":bn(320,240,15,40,200),"240p_1":bn(320,240,15,40,200),"240p_3":bn(240,240,15,40,140),"240p_4":bn(424,240,15,40,220),"360p":bn(640,360,15,80,400),"360p_1":bn(640,360,15,80,400),"360p_3":bn(360,360,15,80,260),"360p_4":bn(640,360,30,80,600),"360p_6":bn(360,360,30,80,400),"360p_7":bn(480,360,15,80,320),"360p_8":bn(480,360,30,80,490),"360p_9":bn(640,360,15,80,800),"360p_10":bn(640,360,24,80,800),"360p_11":bn(640,360,24,80,1e3),"480p":bn(640,480,15,100,500),"480p_1":bn(640,480,15,100,500),"480p_2":bn(640,480,30,100,1e3),"480p_3":bn(480,480,15,100,400),"480p_4":bn(640,480,30,100,750),"480p_6":bn(480,480,30,100,600),"480p_8":bn(848,480,15,100,610),"480p_9":bn(848,480,30,100,930),"480p_10":bn(640,480,10,100,400),"720p":bn(1280,720,15,120,1130),"720p_auto":bn(1280,720,30,900,3e3),"720p_1":bn(1280,720,15,120,1130),"720p_2":bn(1280,720,30,120,2e3),"720p_3":bn(1280,720,30,120,1710),"720p_5":bn(960,720,15,120,910),"720p_6":bn(960,720,30,120,1380),"1080p":bn(1920,1080,15,120,2080),"1080p_1":bn(1920,1080,15,120,2080),"1080p_2":bn(1920,1080,30,120,3e3),"1080p_3":bn(1920,1080,30,120,3150),"1080p_5":bn(1920,1080,60,120,4780),"1440p":bn(2560,1440,30,120,4850),"1440p_1":bn(2560,1440,30,120,4850),"1440p_2":bn(2560,1440,60,120,7350),"4k":bn(3840,2160,30,120,8910),"4k_1":bn(3840,2160,30,120,8910),"4k_3":bn(3840,2160,60,120,13500)},Whe={"480p":Hl(640,480,5),"480p_1":Hl(640,480,5),"480p_2":Hl(640,480,30),"480p_3":Hl(640,480,15),"720p":Hl(1280,720,5),"720p_auto":bn(1280,720,30,900,3e3),"720p_1":Hl(1280,720,5),"720p_2":Hl(1280,720,30),"720p_3":Hl(1280,720,15),"1080p":Hl(1920,1080,5),"1080p_1":Hl(1920,1080,5),"1080p_2":Hl(1920,1080,30),"1080p_3":Hl(1920,1080,15)},Ghe={"1SL1TL":yL(1,1),"3SL3TL":yL(3,3),"2SL3TL":yL(2,3)};function Hd(e){return e||(e="480p_1"),typeof e=="string"?Object.assign({},Bhe[e]):e}function vL(e){return typeof e=="string"?Object.assign({},Whe[e]):e}function lA(e){return typeof e=="string"?Object.assign({},Ghe[e]):e}const zhe={speech_low_quality:Qy(16e3,!1),speech_standard:Qy(32e3,!1,18),music_standard:Qy(48e3,!1),standard_stereo:Qy(48e3,!0,56),high_quality:Qy(48e3,!1,128),high_quality_stereo:Qy(48e3,!0,192)};function uA(e){return typeof e=="string"?Object.assign({},zhe[e]):e}const Zy=[];function bW(e){return Ti(e,"mediaSource",["screen","window","application"]),!0}let ut=function(e){return e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",e.NEED_CLOSE="@need_close",e.NEED_ENABLE_TRACK="@need_enable_track",e.NEED_DISABLE_TRACK="@need_disable_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_RTC_STATS="@get_rtc_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",e.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",e.NEED_MUTE_TRACK="@need_mute_track",e.NEED_UNMUTE_TRACK="@need_unmute_track",e}({}),ir=function(e){return e.SCREEN_TRACK="screen_track",e.CUSTOM_TRACK="custome_track",e.LOW_STREAM="low_stream",e.SCREEN_LOW_TRACK="screen_low_track",e}({}),ev=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e}({}),Hhe=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",e}({}),Khe=function(e){return e[e.DISABLE=0]="DISABLE",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.AUDIO_ONLY=2]="AUDIO_ONLY",e[e.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",e}({}),t_=function(e){return e.TRANSCEIVER_UPDATED="transceiver-updated",e.SEI_TO_SEND="sei-to-send",e.SEI_RECEIVED="sei-received",e.TRACK_UPDATED="track-updated",e}({}),tv=function(e){return e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.CLOSED="closed",e}({}),nv=function(e){return e.FIRST_FRAME_DECODED="first-frame-decoded",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.VIDEO_STATE_CHANGED="video-state-changed",e}({}),rv=function(e){return e.AUDIO="audio",e.VIDEO="video",e.DATA="data",e}({}),vc=function(e){return e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer",e.UPDATE_SOURCE="update_source",e}({});(function(e){e.UPDATE_TRACK_SOURCE="update-track-source"})({});const SL={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},TL={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},wW={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},qhe={uplinkNetworkQuality:0,downlinkNetworkQuality:0},RW={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let lo=function(e){return e.ON_TRACK="on_track",e.ON_NODE="on_node",e}({}),Sc=function(e){return e.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",e.REQUEST_CONSTRAINTS="request_constraints",e}({}),F0=function(e){return e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND",e}({}),n_=function(e){return e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",e}({}),zs=function(e){return e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied",e.LOADEDDATA="loadeddata",e}({}),Kd=function(e){return e[e.VideoStateStopped=0]="VideoStateStopped",e[e.VideoStateStarting=1]="VideoStateStarting",e[e.VideoStateDecoding=2]="VideoStateDecoding",e[e.VideoStateFrozen=3]="VideoStateFrozen",e}({});const bL={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let dA=function(e){return e.OPEN="open",e.MESSAGE="message",e.CLOSE="close",e.CLOSING="closing",e.ERROR="error",e}({});function CW(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function Sr(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?CW(Object(i),!0).forEach(function(o){Te(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):CW(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function Te(e,n,i){return(n=function(o){var c=function(u,h){if(typeof u!="object"||u===null)return u;var m=u[Symbol.toPrimitive];if(m!==void 0){var _=m.call(u,"string");if(typeof _!="object")return _;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(u)}(o);return typeof c=="symbol"?c:String(c)}(n))in e?Object.defineProperty(e,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[n]=i,e}function wn(e,n,i,o,c){var u,h,m={};return Object.keys(o).forEach(function(_){m[_]=o[_]}),m.enumerable=!!m.enumerable,m.configurable=!!m.configurable,("value"in m||m.initializer)&&(m.writable=!0),m=Da(u=wp(h=i.slice()).call(h)).call(u,function(_,y){return y(e,n,_)||_},m),c&&m.initializer!==void 0&&(m.value=m.initializer?m.initializer.call(c):void 0,m.initializer=void 0),m.initializer===void 0&&(Object.defineProperty(e,n,m),m=null),m}class IW extends Rr{set _mediaStreamTrack(n){n!==this.mediaStreamTrack&&(this.safeEmit(t_.TRACK_UPDATED,n),this.mediaStreamTrack=n)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(n,i){super(),Te(this,"trackMediaType",void 0),Te(this,"_ID",void 0),Te(this,"_rtpTransceiver",void 0),Te(this,"_lowRtpTransceiver",void 0),Te(this,"_hints",[]),Te(this,"_isClosed",!1),Te(this,"_originMediaStreamTrack",void 0),Te(this,"mediaStreamTrack",void 0),Te(this,"_external",{}),this._ID=i||rr(8,"track-"),this._originMediaStreamTrack=n,this.mediaStreamTrack=n,function(o){Xe(Zy).call(Zy,o)||Zy.push(o)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(n){return n||Jp(()=>{var i;yt.reportApiInvoke(null,{name:fi.GET_MEDIA_STREAM_TRACK,options:[],tag:kr.TRACER}).onSuccess(((i=this._mediaStreamTrack)===null||i===void 0?void 0:i.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(n){return n===ev.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(n){const i=Zy.indexOf(n);i!==-1&&Zy.splice(i,1)}(this),this.emit(tv.CLOSED),this.removeAllListeners(t_.SEI_RECEIVED)}_updateRtpTransceiver(n,i){if(i===ev.LOW_STREAM){if(this._lowRtpTransceiver===n)return;this._lowRtpTransceiver=n}else{if(this._rtpTransceiver===n)return;this._rtpTransceiver=n}this.emit(t_.TRANSCEIVER_UPDATED,n,i)}}class iv extends IW{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(n,i){super(n,i),Te(this,"_enabled",!0),Te(this,"_muted",!1),Te(this,"_isExternalTrack",!1),Te(this,"_isClosed",!1),Te(this,"_enabledMutex",void 0),Te(this,"processor",void 0),Te(this,"_processorContext",void 0),Te(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new Es("".concat(this.getTrackId())),n.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var n,i;return(n=(i=this._originMediaStreamTrack)===null||i===void 0?void 0:i.label)!==null&&n!==void 0?n:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,k.debug("[".concat(this.getTrackId(),"] close")),this.emit(ut.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(n,i){let o=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=o,n!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),i&&this._originMediaStreamTrack.stop()),n.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=n,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await nr(this,ut.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){k.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(tv.TRACK_ENDED)}stateCheck(n,i){if(k.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(n,": ").concat(i,"]")),wf(i,n),this._enabled&&this._muted&&n==="enabled"&&i===!1)throw new Ce(Y.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",k);if(!this._enabled&&!this._muted&&n==="muted"&&i===!0)throw new Ce(Y.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",k)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():tt.resolve([])}}const AW=window.AudioContext||window.webkitAudioContext;let Tc=null;const $n=new class extends Rr{constructor(){super(...arguments),Te(this,"prevState",void 0),Te(this,"curState",void 0),Te(this,"currentTime",void 0),Te(this,"currentTimeStuckAt",void 0),Te(this,"interruptDetectorTrack",void 0),Te(this,"onLocalAudioTrackMute",()=>{k.info("ios15-interruption-start"),this.emit(Xi.IOS_15_16_INTERRUPTION_START)}),Te(this,"onLocalAudioTrackUnmute",async()=>{k.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?k.info("ios15-interruption-end-canceled"):(Tc&&await Tc.suspend(),this.emit(Xi.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(e){k.debug("webaudio bindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(e){k.debug("webaudio unbindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function sv(){if(!Tc){if(function(){if(!AW)return void k.error("your browser is not support web audio");k.info("create audio context");const e=Sr({},Z("WEBAUDIO_INIT_OPTIONS"));k.debug("audio context init option:",JSON.stringify(e)),Tc=new AW(e),$n.curState=Tc.state,Tc.onstatechange=()=>{$n.prevState=$n.curState,$n.curState=Tc?Tc.state:void 0;const{prevState:n,curState:i}=$n,o=i==="running",c=i==="interrupted",u=n==="running",h=n==="suspended",m=n==="interrupted",_=Tn().osVersion;(co()||Gl())&&u&&c&&(k.info("ios".concat(_,"-interruption-start")),$n.emit(Xi.IOS_INTERRUPTION_START)),(co()||Gl())&&(h||m)&&o&&(k.info("ios".concat(_,"-interruption-end")),$n.emit(Xi.IOS_INTERRUPTION_END)),n!==i&&$n.emit(Xi.STATE_CHANGE,i,n)},setInterval(()=>{var n;const i=(n=Tc)===null||n===void 0?void 0:n.currentTime;$n.currentTime!==i?($n.currentTimeStuckAt&&(k.debug("AudioContext current time resume at ".concat(i)),$n.currentTimeStuckAt=void 0),$n.currentTime=i):(i!==$n.currentTimeStuckAt&&(yt.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:i},tag:kr.TRACER}).onSuccess(),k.warning("AudioContext current time stuck at ".concat(i))),$n.currentTimeStuckAt=i)},5e3),async function(n){const i=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let o,c=!1,u=!1,h=!1;function m(M){n.state==="running"?_(!1):co()||Gl()?n.state==="suspended"&&(_(!0),M&&n.resume().then(y,y)):n.state!=="closed"&&(_(!0),M&&n.resume().then(y,y))}function _(M){if(c!==M){c=M;for(let U=0,q=i;U<q.length;U+=1){const $=q[U];M?window.addEventListener($,S,{capture:!0,passive:!0}):window.removeEventListener($,S,{capture:!0,passive:!0})}}}function y(){m(!1)}function S(){m(!0)}function w(M){if(!h)if(o.paused)if(M){let U;I(!1),h=!0;try{U=o.play(),U?U.then(P,P):(o.addEventListener("playing",P),o.addEventListener("abort",P),o.addEventListener("error",P))}catch{P()}}else I(!0);else I(!1)}function I(M){if(u!==M){u=M;for(let U=0,q=i;U<q.length;U++){const $=q[U];M?window.addEventListener($,B,{capture:!0,passive:!0}):window.removeEventListener($,B,{capture:!0,passive:!0})}}}function P(){o.removeEventListener("playing",P),o.removeEventListener("abort",P),o.removeEventListener("error",P),h=!1,w(!1)}function B(){w(!0)}if(co()){const M=n.createMediaStreamDestination(),U=document.createElement("div");U.innerHTML="<audio x-webkit-airplay='deny'></audio>",o=U.children.item(0),o.controls=!1,o.disableRemotePlayback=!0,o.preload="auto",o.srcObject=M.stream,w(!0)}$n.on(Xi.STATE_CHANGE,function(){m(!0)}),m(!1)}(Tc)}(),!Tc)throw new Ce(Y.NOT_SUPPORTED,"can not create audio context");return Tc}return Tc}function r_(e){if(function(){if(wL!==null)return wL;const o=sv(),c=o.createBufferSource(),u=o.createGain(),h=o.createGain();c.connect(u),c.connect(h),c.disconnect(u);let m=!1;try{c.disconnect(u)}catch{m=!0}return c.disconnect(),wL=m,m}())return;const n=e.connect,i=e.disconnect;e.connect=(o,c,u)=>{var h;return e._inputNodes||(e._inputNodes=[]),Xe(h=e._inputNodes).call(h,o)||(o instanceof AudioNode?(e._inputNodes.push(o),n.call(e,o,c,u)):n.call(e,o,c)),e},e.disconnect=(o,c,u)=>{i.call(e),o?eA(e._inputNodes,o):e._inputNodes=[];for(const h of e._inputNodes)n.call(e,h)}}let wL=null;function RL(e,n){let i=!1;const o=1/n;if(Z("DISABLE_WEBAUDIO")){const c=window.setInterval(()=>{i?window.clearInterval(c):e(performance.now()/1e3)},1e3*o)}else{const c=sv();let u=c.createGain();u.gain.value=0,u.connect(c.destination);const h=()=>{if(i)return void(u=null);const m=c.createOscillator();m.onended=h,m.connect(u),m.start(0),m.stop(c.currentTime+o),e(c.currentTime)};h()}return()=>{i=!0}}class OW{constructor(){Te(this,"context",void 0),Te(this,"analyserNode",void 0),Te(this,"sourceNode",void 0),this.context=sv(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(n){if(n!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=n,n==null||n.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||co()||Gl()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const n=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(n);else{const o=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(o);for(let c=0;c<n.length;++c)n[c]=o[c]/128-1}const i=Da(n).call(n,(o,c)=>o+c*c,0)/n.length;return Math.max(10*Math.log10(i)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var n,i;(n=this.sourceNode)===null||n===void 0||n.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(i=this.sourceNode)===null||i===void 0||i.connect(this.analyserNode)}catch{k.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class PW extends Rr{get processSourceNode(){return this.sourceNode}set processedNode(n){var i;if(!this.isDestroyed&&this._processedNode!==n){try{var o;(o=this.sourceNode)===null||o===void 0||o.disconnect(this.outputNode)}catch{}(i=this._processedNode)===null||i===void 0||i.disconnect(),this._processedNode=n,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),Te(this,"outputNode",void 0),Te(this,"outputTrack",void 0),Te(this,"isPlayed",!1),Te(this,"sourceNode",void 0),Te(this,"context",void 0),Te(this,"audioBufferNode",void 0),Te(this,"destNode",void 0),Te(this,"audioOutputLevel",0),Te(this,"volumeLevelAnalyser",void 0),Te(this,"_processedNode",void 0),Te(this,"playNode",void 0),Te(this,"isDestroyed",!1),Te(this,"onNoAudioInput",void 0),Te(this,"isNoAudioInput",!1),Te(this,"_noAudioInputCount",0),this.context=sv(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),r_(this.outputNode),this.volumeLevelAnalyser=new OW}startGetAudioBuffer(n){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(n),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=i=>{this.emit(vc.ON_AUDIO_BUFFER,function(o){for(let c=0;c<o.outputBuffer.numberOfChannels;c+=1){const u=o.outputBuffer.getChannelData(c);for(let h=0;h<u.length;h+=1)u[h]=0}return o.inputBuffer}(i))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!On().webAudioMediaStreamDest)throw new Ce(Y.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(n){this.context.state!=="running"&&tA(()=>{$n.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=n||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(n>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;co()||Gl()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const i=this.volumeLevelAnalyser.getAnalyserNode();let o;i.getFloatTimeDomainData?(o=new Float32Array(i.fftSize),i.getFloatTimeDomainData(o)):(o=new Uint8Array(i.fftSize),i.getByteTimeDomainData(o));let c=!1;for(let u=0;u<o.length;u++)o[u]!==0&&(c=!0);return c?(this.isNoAudioInput=!1,!0):(await $i(200),await this.checkHasAudioInput(n?n+1:1)&&c)}getAudioVolume(){return this.outputNode.gain.value}setVolume(n){this.outputNode.gain.setValueAtTime(n,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var n,i;(n=this.processedNode)===null||n===void 0||n.disconnect(),(i=this.sourceNode)===null||i===void 0||i.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var n;this.processedNode?(n=this.processedNode)===null||n===void 0||n.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class NW extends PW{get isFreeze(){return!1}constructor(n,i,o){var c;if(super(),Te(this,"sourceNode",void 0),Te(this,"track",void 0),Te(this,"clonedTrack",void 0),Te(this,"audioElement",void 0),Te(this,"isCurrentTrackCloned",!1),Te(this,"isRemoteTrack",!1),Te(this,"originVolumeLevelAnalyser",void 0),Te(this,"rebuildWebAudio",async()=>{if(k.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void k.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>k.info("resume success")),k.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const m=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?m.stop():this.isCurrentTrackCloned=!0;const _=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(_),r_(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const y=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(y,this.context.currentTime),r_(this.outputNode),this.emit(vc.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=_,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),n.kind!=="audio")throw new Ce(Y.UNEXPECTED_ERROR);this.track=n;const u=new MediaStream([this.track]);if(this.isRemoteTrack=!!i,this.sourceNode=this.context.createMediaStreamSource(u),r_(this.sourceNode),o){const m=o.clone();m.enabled=!0,this.clonedTrack=m,k.debug("create an unmuted track ".concat(m.id," from the original track ").concat(o.id," to get the volume"));const _=this.context.createMediaStreamSource(new MediaStream([m]));r_(_),this.originVolumeLevelAnalyser=new OW,this.originVolumeLevelAnalyser.updateSource(_)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=u;const h=Tn();i&&h.os===Ai.IOS&&Number((c=h.osVersion)===null||c===void 0?void 0:c.split(".")[0])<15&&($n.on(Xi.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(m=>{m||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(n){this.sourceNode.disconnect(),this.track=n,this.isCurrentTrackCloned=!1;const i=new MediaStream([n]);this.sourceNode=this.context.createMediaStreamSource(i),r_(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(vc.UPDATE_SOURCE),this.audioElement.srcObject=i}destroy(){var n;this.audioElement.srcObject=null,this.audioElement.remove(),$n.off("state-change",this.rebuildWebAudio),(n=this.originVolumeLevelAnalyser)===null||n===void 0||n.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(n){return this.context.createMediaStreamSource(new MediaStream([n]))}updateOriginTrack(n){const i=n.clone();i.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=i),k.debug("create an unmuted track ".concat(i.id," from the original track ").concat(n.id," to get the volume"));const o=this.context.createMediaStreamSource(new MediaStream([i]));r_(o),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(o)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function kW(e,n,i){const o=(u,h)=>u?typeof u!="number"?u.max||u.exact||u.ideal||u.min||h:u:h,c={audio:!!i&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:o(n.height,1080),maxWidth:o(n.width,1920)}}};return n.frameRate&&typeof n.frameRate!="number"?(c.video.mandatory.maxFrameRate=n.frameRate.max,c.video.mandatory.minFrameRate=n.frameRate.min):typeof n.frameRate=="number"&&(c.video.mandatory.maxFrameRate=n.frameRate),await navigator.mediaDevices.getUserMedia(c)}async function $he(e,n){const i=await DW(e.mediaSource),{sourceId:o,audio:c}=await function(u){let h=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new tt((m,_)=>{const y=document.createElement("div");y.innerText="share screen",y.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const S=document.createElement("div");S.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const w=document.createElement("div");w.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",w.setAttribute("style","height: 12%;");const I=document.createElement("div");I.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const P=document.createElement("div");P.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const B=document.createElement("button");B.innerHTML="cancel",B.setAttribute("style","width: 85px;"),B.onclick=()=>{document.body.removeChild(q);const $=new Error("NotAllowedError");$.name="NotAllowedError",_($)};let M=h;const U=document.createElement("div");if(h){const $=document.createElement("input");$.setAttribute("type","checkbox");const ae=document.createElement("span");$.setAttribute("style","margin-right: 6px;"),ae.innerText="Share audio",$.checked=M,$.onchange=()=>{M=$.checked},U.appendChild($),U.appendChild(ae)}P.appendChild(U),P.appendChild(B),S.appendChild(w),S.appendChild(I),S.appendChild(P);const q=document.createElement("div");q.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),q.appendChild(y),q.appendChild(S),document.body.appendChild(q),u.map($=>{if($.id){const ae=document.createElement("div");ae.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let me=$.thumbnail;try{const{width:ge}=me.getSize();ge>1920&&(me=me.resize({width:1920}))}catch(ge){throw ge&&ge.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),ge}ae.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+me.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+$.name.replace(/[\u00A0-\u9999<>\&]/g,function(ge){return"&#"+ge.charCodeAt(0)+";"})+"</span>",ae.onclick=()=>{document.body.removeChild(q),m({sourceId:$.id,audio:M})},I.appendChild(ae)}})})}(i,n);return await kW(o,e,c)}async function DW(e){let n=["window","screen"];e!=="application"&&e!=="window"||(n=["window"]),e==="screen"&&(n=["screen"]);const i=H6();if(!i)throw console.error("failed to fetch electron, please mount it to window"),new Ce(Y.ELECTRON_IS_NULL);let o=null;try{var c;o=((c=i.desktopCapturer)===null||c===void 0?void 0:c.getSources({types:n}))||i.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:n})}catch{o=null}o&&o.then||(o=new tt((u,h)=>{i.desktopCapturer.getSources({types:n},(m,_)=>{m?h(m):u(_)})}));try{return await o}catch(u){throw new Ce(Y.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,u.toString())}}const CL=new Es("safari");let LW=!1,xW=!1;async function bc(e,n){let i=0,o=null;for(;i<2;)try{o=await Yhe(e,n,i>0);break}catch(c){if(c instanceof Ce)throw k.error("[".concat(n,"] ").concat(c.toString())),c;const u=hA(c.name||c.code||c,c.message);if(u.code===Y.MEDIA_OPTION_INVALID){k.debug("[".concat(n,"] detect media option invalid, retry")),i+=1,await $i(500);continue}throw k.error("[".concat(n,"] ").concat(u.toString())),u}if(!o)throw new Ce(Y.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return o}async function Yhe(e,n,i){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Ce(Y.NOT_SUPPORTED,"can not find getUserMedia");i&&(e.video&&(delete e.video.width,delete e.video.height),e.screen&&(delete e.screen.width,delete e.screen.height));const o=On(),c=new MediaStream;if(e.audioSource&&c.addTrack(e.audioSource),e.videoSource&&c.addTrack(e.videoSource),!e.audio&&!e.video&&!e.screen)return k.debug("Using Video Source/ Audio Source"),c;if(e.screen)if(H6())e.screen.sourceId?ov(c,await kW(e.screen.sourceId,e.screen,!!e.screenAudio)):ov(c,await $he(e.screen,!!e.screenAudio));else if(Tf()&&e.screen.extensionId&&e.screen.mandatory){if(!o.getStreamFromExtension)throw new Ce(Y.NOT_SUPPORTED,"This browser does not support screen sharing");k.debug("[".concat(n,'] Screen access on chrome stable, looking for extension"'));const I=await(h=e.screen.extensionId,m=n,new tt((P,B)=>{try{chrome.runtime.sendMessage(h,{getStream:!0},M=>{if(!M||!M.streamId)return k.error("[".concat(m,"] No response from Chrome Plugin. Plugin not installed properly"),M),void B(new Ce(Y.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));P(M.streamId)})}catch(M){k.error("[".concat(m,"] AgoraRTC screensharing plugin is not accessible(").concat(h,")"),M.toString()),B(new Ce(Y.CHROME_PLUGIN_NOT_INSTALL))}}));e.screen.mandatory.chromeMediaSourceId=I,ov(c,await navigator.mediaDevices.getUserMedia({video:{mandatory:e.screen.mandatory}}))}else if(o.getDisplayMedia){var u;e.screen.mediaSource&&bW(e.screen.mediaSource);const I={width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate,displaySurface:(u=e.screen.displaySurface)!==null&&u!==void 0?u:e.screen.mediaSource==="screen"?"monitor":e.screen.mediaSource},{selfBrowserSurface:P,surfaceSwitching:B,systemAudio:M,preferCurrentTab:U}=e.screen,q={selfBrowserSurface:P,surfaceSwitching:B,systemAudio:M,preferCurrentTab:U};!P&&delete q.selfBrowserSurface,!B&&delete q.surfaceSwitching,!M&&delete q.systemAudio,!U&&delete q.preferCurrentTab,k.debug("[".concat(n,"] getDisplayMedia:"),JSON.stringify({video:I,audio:e.screenAudio,controls:q})),ov(c,await navigator.mediaDevices.getDisplayMedia(Sr({video:I,audio:e.screenAudio},q)))}else{if(!Pr())throw k.error("[".concat(n,"] This browser does not support screenSharing")),new Ce(Y.NOT_SUPPORTED,"This browser does not support screen sharing");{e.screen.mediaSource&&bW(e.screen.mediaSource);const I={video:{mediaSource:e.screen.mediaSource,width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}};k.debug("[".concat(n,"] getUserMedia: ").concat(JSON.stringify(I))),ov(c,await navigator.mediaDevices.getUserMedia(I))}}var h,m;if(!e.video&&!e.audio)return c;let _={video:e.video,audio:e.audio},y=Z("MEDIA_DEVICE_CONSTRAINTS");if(y)try{typeof y=="string"&&(y=JSON.parse(y)),_=rL(_,y)}catch{}k.debug("[".concat(n,"] GetUserMedia"),JSON.stringify(_)),Tn();let S,w=null;(ls()||co()||QI())&&(w=await CL.lock());try{S=await navigator.mediaDevices.getUserMedia(_)}catch(I){throw w&&w(),I}return _.audio&&(LW=!0),_.video&&(xW=!0),ov(c,S),w&&w(),c}function hA(e,n){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new Ce(Y.MEDIA_OPTION_INVALID,"".concat(e,": ").concat(n));case"NotFoundError":case"DevicesNotFoundError":return new Ce(Y.DEVICE_NOT_FOUND,"".concat(e,": ").concat(n));case"NotSupportedError":return new Ce(Y.NOT_SUPPORTED,"".concat(e,": ").concat(n));case"NotReadableError":return new Ce(Y.NOT_READABLE,"".concat(e,": ").concat(n));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new Ce(Y.PERMISSION_DENIED,"".concat(e,": ").concat(n));case"ConstraintNotSatisfiedError":return new Ce(Y.CONSTRAINT_NOT_SATISFIED,"".concat(e,": ").concat(n));default:return k.error("getUserMedia unexpected error",e),new Ce(Y.UNEXPECTED_ERROR,"".concat(e,": ").concat(n))}}function ov(e,n){const i=e.getVideoTracks()[0],o=e.getAudioTracks()[0],c=n.getVideoTracks()[0],u=n.getAudioTracks()[0];u&&(o&&e.removeTrack(o),e.addTrack(u)),c&&(i&&e.removeTrack(i),e.addTrack(c))}const wc=new class extends Rr{get state(){return this._state}set state(e){e!==this._state&&(this.emit(n_.STATE_CHANGE,e),this._state=e)}constructor(){super(),Te(this,"_state",F0.IDLE),Te(this,"isAccessMicrophonePermission",!1),Te(this,"isAccessCameraPermission",!1),Te(this,"lastAccessMicrophonePermission",!1),Te(this,"lastAccessCameraPermission",!1),Te(this,"checkdeviceMatched",!1),Te(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(Z("ENUMERATE_DEVICES_INTERVAL")||(ZI()||JI()===Ai.HARMONY_OS)&&bf())&&this.updateDevicesInfo()},Z("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(e=>k.error(e.toString()))}async enumerateDevices(e,n){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new Ce(Y.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const o=await navigator.mediaDevices.enumerateDevices(),c=this.checkMediaDeviceInfoIsOk(o);let u=!this.isAccessMicrophonePermission&&e,h=!this.isAccessCameraPermission&&n;c.audio&&(u=!1),c.video&&(h=!1);let m=null,_=null,y=null;if(!i&&(u||h)){if(CL.isLocked&&(k.debug("[device manager] wait GUM lock"),(await CL.lock())(),k.debug("[device manager] GUM unlock")),LW&&(u=!1,this.isAccessMicrophonePermission=!0),xW&&(h=!1,this.isAccessCameraPermission=!0),k.debug("[device manager] check media device permissions",e,n,u,h),u&&h){try{y=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(S){const w=hA(S.name||S.code||S,S.message);if(w.code===Y.PERMISSION_DENIED)throw w;k.warning("getUserMedia failed in getDevices",w)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(u){try{m=await navigator.mediaDevices.getUserMedia({audio:e})}catch(S){const w=hA(S.name||S.code||S,S.message);if(w.code===Y.PERMISSION_DENIED)throw w;k.warning("getUserMedia failed in getDevices",w)}this.isAccessMicrophonePermission=!0}else if(h){try{_=await navigator.mediaDevices.getUserMedia({video:n})}catch(S){const w=hA(S.name||S.code||S,S.message);if(w.code===Y.PERMISSION_DENIED)throw w;k.warning("getUserMedia failed in getDevices",w)}this.isAccessCameraPermission=!0}k.debug("[device manager] mic permission",e,"cam permission",n)}try{const S=await navigator.mediaDevices.enumerateDevices();return m&&m.getTracks().forEach(w=>w.stop()),_&&_.getTracks().forEach(w=>w.stop()),y&&y.getTracks().forEach(w=>w.stop()),m=null,_=null,y=null,S}catch(S){return m&&m.getTracks().forEach(w=>w.stop()),_&&_.getTracks().forEach(w=>w.stop()),y&&y.getTracks().forEach(w=>w.stop()),m=null,_=null,y=null,new Ce(Y.ENUMERATE_DEVICES_FAILED,S.toString()).throw()}}async getRecordingDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(n=>n.kind==="audioinput")}async getCamerasDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,e)).filter(n=>n.kind==="videoinput")}async getSpeakers(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(n=>n.kind==="audiooutput")}searchDeviceIdByName(e){let n=null;return this.deviceInfoMap.forEach(i=>{i.device.label===e&&(n=i.device.deviceId)}),n}async getDeviceById(e){const n=(await this.enumerateDevices(!0,!0,!0)).find(i=>i.deviceId===e);if(!n)throw new Ce(Y.DEVICE_NOT_FOUND,"deviceId: ".concat(e));return n}async init(){this.state=F0.INITING;try{await this.updateDevicesInfo(),this.state=F0.INITEND}catch(e){throw k.warning("Device Detection functionality cannot start properly.",e.toString()),this.state=F0.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new Ce(Y.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),e}}async updateDevicesInfo(){const e=await this.enumerateDevices(!0,!0,!0),n=Date.now(),i=[];if(e[0]&&e[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const c=e.find(h=>h.kind==="audioinput"&&h.deviceId==="default"),u=e.find(h=>h.kind==="audiooutput"&&h.deviceId==="default");c&&u?u.groupId===c.groupId?k.debug("[device-check] default input ".concat(c.label," and output ").concat(u.label," is the same group")):k.debug("[device-check] default input ".concat(c.label," and output ").concat(u.label," is not the same group")):k.debug("[device-check] default input or output not found")}const o=this.checkMediaDeviceInfoIsOk(e);if(e.forEach(c=>{if(!c.deviceId)return;const u=this.deviceInfoMap.get("".concat(c.kind,"_").concat(c.deviceId));if((u?u.state:"INACTIVE")!=="ACTIVE"){const h={initAt:n,updateAt:n,device:c,state:"ACTIVE"};this.deviceInfoMap.set("".concat(c.kind,"_").concat(c.deviceId),h),i.push(h)}u&&(u.updateAt=n)}),this.deviceInfoMap.forEach((c,u)=>{c.state==="ACTIVE"&&c.updateAt!==n&&(c.state="INACTIVE",i.push(c))}),this.state!==F0.INITEND)return o.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(o.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));i.forEach(c=>{switch(c.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(n_.RECORDING_DEVICE_CHANGED,c);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(n_.CAMERA_DEVICE_CHANGED,c);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(n_.PLAYOUT_DEVICE_CHANGED,c)}}),o.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),o.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(e){const n=e.filter(c=>c.kind==="audioinput"),i=e.filter(c=>c.kind==="videoinput"),o={audio:!1,video:!1};for(const c of n)if(c.label&&c.deviceId){o.audio=!0;break}for(const c of i)if(c.label&&c.deviceId){o.video=!0;break}return o}};let IL=!1;const Rc=new class extends Rr{constructor(){super(...arguments),Te(this,"onAutoplayFailed",void 0),Te(this,"onAudioAutoplayFailed",void 0)}};function MW(){if(Tn(),!IL){const e=n=>{n.preventDefault(),IL=!1,P0()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};IL=!0,P0()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),k.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),Rc.onAutoplayFailed?Rc.onAutoplayFailed():Rc.onAudioAutoplayFailed?k.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):k.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),Rc.emit("autoplay-failed")}}function UW(e,n,i,o){if(!e)return;const c=yt.getBaseInfoBySessionId(e);if(!c)return;const u=c.info,h=Date.now(),m=Sr(Sr({},u),{},{vid:u.vid===void 0?0:Number(u.vid),lts:h,elapse:h-c.startTime,cbRegistered:Rc.onAutoplayFailed||Rc.onAudioAutoplayFailed?1:-1,errorMsg:i,mediaType:n,trackId:o,extend:void 0});yt.send({type:vr.AUTOPLAY_FAILED,data:m},!0)}const Xhe=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],Uo=new class{constructor(){Te(this,"onAutoplayFailed",void 0),Te(this,"elementMap",new Map),Te(this,"elementStateMap",new Map),Te(this,"elementsNeedToResume",[]),Te(this,"sinkIdMap",new Map),Te(this,"autoResumeAfterInterruption",e=>{Array.from(this.elementMap.entries()).forEach(n=>{let[i,o]=n;const c=this.elementStateMap.get(i),u=o.srcObject.getAudioTracks()[0],h=u&&u.readyState;if(k.debug("resume after interrupted, ele: ".concat(c," audio: ").concat(h," ").concat(e)),h==="live"){if(e)return o.pause(),void o.play();if($n.curState==="running")return Ky()?(o.pause(),void o.play()):void(c&&c==="paused"&&o.play())}})}),Te(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(e=>{let[n,i]=e;const o=i.srcObject.getAudioTracks()[0];o&&o.readyState==="live"&&(k.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),i.pause(),i.play())})}),this.autoResumeAudioElement(),$n.on(Xi.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),$n.on(Xi.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),$n.on(Xi.STATE_CHANGE,()=>{co()&&$n.prevState==="suspended"&&$n.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(e,n){const i=this.elementMap.get(e);if(this.sinkIdMap.set(e,n),i)try{await i.setSinkId(n)}catch(o){throw new Ce(Y.PERMISSION_DENIED,"can not set sink id: "+o.toString())}}play(e,n,i,o){if(this.elementMap.has(n))return;const c=document.createElement("audio");c.autoplay=!0,c.srcObject=new MediaStream([e]),this.bindAudioElementEvents(n,c),this.elementMap.set(n,c),this.elementStateMap.set(n,zs.INIT),this.setVolume(n,i);const u=this.sinkIdMap.get(n);if(u)try{c.setSinkId(u).catch(m=>{k.warning("[".concat(n,"] set sink id failed"),m.toString())})}catch(m){k.warning("[".concat(n,"] set sink id failed"),m.toString())}const h=c.play();h&&h.then&&h.catch(m=>{o&&UW(o,"audio",m.message,n),k.warning("audio element play warning",m.toString()),this.elementMap.has(n)&&m.name==="NotAllowedError"&&(k.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(c),tA(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),MW()}))})}updateTrack(e,n){const i=this.elementMap.get(e);i&&(i.srcObject=new MediaStream([n]))}isPlaying(e){return this.elementMap.has(e)&&this.elementStateMap.get(e)==="playing"}setVolume(e,n){const i=this.elementMap.get(e);i&&(n=Math.max(0,Math.min(100,n)),i.volume=n/100)}stop(e){const n=this.elementMap.get(e);if(this.sinkIdMap.delete(e),!n)return;const i=this.elementsNeedToResume.indexOf(n);this.elementsNeedToResume.splice(i,1),n.srcObject=null,n.remove(),this.elementMap.delete(e),this.elementStateMap.delete(e)}bindAudioElementEvents(e,n){Xhe.forEach(i=>{n.addEventListener(i,o=>{const c=this.elementStateMap.get(e),u=o.type==="pause"?"paused":o.type;if(k.debug("[".concat(e,"] audio-element-status change ").concat(c," => ").concat(u)),o.type==="error"){const h=n==null?void 0:n.error;h&&k.error("[".concat(e,"] media error, code: ").concat(h.code,", message: ").concat(h.message))}this.elementStateMap.set(e,u)})})}getPlayerState(e){return this.elementStateMap.get(e)||"uninit"}autoResumeAudioElement(){const e=()=>{this.elementsNeedToResume.forEach(n=>{n.play().then(i=>{k.debug("Auto resume audio element success")}).catch(i=>{k.warning("Auto resume audio element failed!",i)})}),this.elementsNeedToResume=[]};new tt(n=>{document.body?n():window.addEventListener("load",()=>n())}).then(()=>{P0()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0))})}};function $r(){return function(e,n,i){const o=i.value;return typeof o=="function"&&(i.value=function(){this._isClosed&&new Ce(Y.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",k);for(var c=arguments.length,u=new Array(c),h=0;h<c;h++)u[h]=arguments[h];const m=o.apply(this,u);return m instanceof tt?new tt((_,y)=>{m.then(_).catch(y)}):m}),i}}class VW extends Rr{constructor(n){super(),Te(this,"name","VideoProcessorDestination"),Te(this,"ID","0"),Te(this,"_source",void 0),Te(this,"videoContext",void 0),Te(this,"inputTrack",void 0),this.videoContext=n}get kind(){return"video"}get enabled(){return!0}pipe(){throw new Ce(Y.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new Ce(Y.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(n){if(n.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);n.track&&n.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=n.track,this.emit(lo.ON_TRACK,n.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(lo.ON_TRACK,void 0)}}class FW extends Rr{set chained(n){this._chained=n}get chained(){return this._chained}constructor(n,i){super(),Te(this,"constraintsMap",new Map),Te(this,"statsRegistry",[]),Te(this,"usageRegistry",[]),Te(this,"trackId",void 0),Te(this,"direction",void 0),Te(this,"_chained",!1),this.trackId=n,this.direction=i}async getConstraints(){return await ds(this,Sc.REQUEST_CONSTRAINTS)}async requestApplyConstraints(n,i){var o;return k.info("processor ".concat(i.name," requestApplyConstraints for ").concat(this.trackId)),n&&this.constraintsMap.set(i,n),nr(this,Sc.REQUEST_UPDATE_CONSTRAINTS,Array.from(mc(o=this.constraintsMap).call(o)))}async requestRevertConstraints(n){var i;if(this.constraintsMap.has(n))return k.info("processor ".concat(n.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(n),nr(this,Sc.REQUEST_UPDATE_CONSTRAINTS,Array.from(mc(i=this.constraintsMap).call(i)))}registerStats(n,i,o){this.statsRegistry.find(c=>c.processorID===n.ID&&c.processorName===n.name&&c.type===i)||this.statsRegistry.push({processorName:n.name,processorID:n.ID,type:i,cb:o})}unregisterStats(n,i){const o=this.statsRegistry.findIndex(c=>c.processorID===n.ID&&c.processorName===n.name&&c.type===i);o!==-1&&this.statsRegistry.splice(o,1)}gatherStats(){const n=[];for(const{processorID:i,processorName:o,type:c,cb:u}of this.statsRegistry)try{const h=u();n.push({processorID:i,processorName:o,type:c,stats:h})}catch(h){k.error(new Ce(Y.UNEXPECTED_ERROR,h.message))}return n}registerUsage(n,i){this.usageRegistry.find(o=>o.processorID===n.ID&&o.processorName===n.name)||this.usageRegistry.push({processorID:n.ID,processorName:n.name,cb:i})}unregisterUsage(n){const i=this.usageRegistry.findIndex(o=>o.processorID===n.ID&&o.processorName===n.name);i!==-1&&this.usageRegistry.splice(i,1)}async gatherUsage(){const n=[];if(!this.chained)return[];for(const{cb:i}of this.usageRegistry)try{let o=i();o instanceof tt&&(o=await o),n.push(Sr(Sr({},o),{},{direction:this.direction}))}catch(o){k.error("gather extension usage error",o)}return n}getDirection(){return this.direction}}class jW extends Rr{constructor(n){super(),Te(this,"name","AudioProcessorDestination"),Te(this,"ID","0"),Te(this,"inputTrack",void 0),Te(this,"inputNode",void 0),Te(this,"audioProcessorContext",void 0),Te(this,"_source",void 0),this.audioProcessorContext=n}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new Ce(Y.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new Ce(Y.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(lo.ON_TRACK,void 0),this.emit(lo.ON_NODE,void 0)}updateInput(n){if(n.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);n.track&&this.inputTrack!==n.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=n.track,this.emit(lo.ON_TRACK,this.inputTrack)),n.node&&this.inputNode!==n.node&&(this.audioProcessorContext.chained=!0,this.inputNode=n.node,this.emit(lo.ON_NODE,this.inputNode))}}class BW extends Rr{set chained(n){this._chained=n}get chained(){return this._chained}constructor(n,i,o){super(),Te(this,"constraintsMap",new Map),Te(this,"statsRegistry",[]),Te(this,"audioContext",void 0),Te(this,"trackId",void 0),Te(this,"direction",void 0),Te(this,"usageRegistry",[]),Te(this,"_chained",!1),this.audioContext=n,this.trackId=i,this.direction=o}async getConstraints(){return ds(this,Sc.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(n,i){var o;return k.info("processor ".concat(i.name," requestApplyConstraints for ").concat(this.trackId)),n&&this.constraintsMap.set(i,n),nr(this,Sc.REQUEST_UPDATE_CONSTRAINTS,Array.from(mc(o=this.constraintsMap).call(o)))}async requestRevertConstraints(n){var i;if(this.constraintsMap.has(n))return this.constraintsMap.delete(n),nr(this,Sc.REQUEST_UPDATE_CONSTRAINTS,Array.from(mc(i=this.constraintsMap).call(i)))}registerStats(n,i,o){this.statsRegistry.find(c=>c.processorID===n.ID&&c.processorName===n.name&&c.type===i)||this.statsRegistry.push({processorName:n.name,processorID:n.ID,type:i,cb:o})}unregisterStats(n,i){const o=this.statsRegistry.findIndex(c=>c.processorID===n.ID&&c.processorName===n.name&&c.type===i);o!==-1&&this.statsRegistry.splice(o,1)}gatherStats(){const n=[];for(const{processorID:i,processorName:o,type:c,cb:u}of this.statsRegistry)try{const h=u();n.push({processorID:i,processorName:o,type:c,stats:h})}catch(h){k.error(new Ce(Y.UNEXPECTED_ERROR,h.message))}return n}registerUsage(n,i){this.usageRegistry.find(o=>o.processorID===n.ID&&o.processorName===n.name)||this.usageRegistry.push({processorID:n.ID,processorName:n.name,cb:i})}unregisterUsage(n){const i=this.usageRegistry.findIndex(o=>o.processorID===n.ID&&o.processorName===n.name);i!==-1&&this.usageRegistry.splice(i,1)}async gatherUsage(){const n=[];if(!this.chained)return[];for(const{cb:i}of this.usageRegistry)try{let o=i();o instanceof tt&&(o=await o),n.push(Sr(Sr({},o),{},{direction:this.direction}))}catch(o){k.error("gather extension usage error",o)}return n}getDirection(){return this.direction}}class AL extends Rr{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),Te(this,"context",void 0),Te(this,"processSourceNode",void 0),Te(this,"outputTrack",void 0),Te(this,"processedNode",void 0),Te(this,"clonedTrack",void 0),Te(this,"outputNode",void 0),this.outputNode=new Jhe}setVolume(){}createOutputTrack(){throw new Ce(Y.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class Jhe{disconnect(){}connect(){}}function WW(e){return new tt((n,i)=>{let o=!1;const c=document.createElement("video");c.setAttribute("autoplay",""),c.setAttribute("muted",""),c.muted=!0,c.autoplay=!0,c.setAttribute("playsinline",""),c.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(c);const u=co()?"canplay":"playing";c.addEventListener(u,()=>{const h=c.videoWidth,m=c.videoHeight;!h&&Pr()||(o=!0,c.srcObject=null,c.remove(),n([h,m]))}),c.srcObject=new MediaStream([e]),c.play().catch(nA),setTimeout(()=>{o||(c.srcObject=null,c.remove(),n([c.videoWidth,c.videoHeight]))},4e3)})}function fA(e){const n={};e.facingMode&&(n.facingMode=e.facingMode),e.cameraId&&(n.deviceId={exact:e.cameraId});const i=Hd(e.encoderConfig);return i.width!=null&&(n.width=i.width),i.height!=null&&(n.height=i.height),!j6()&&i.frameRate&&(n.frameRate=i.frameRate),k6()&&typeof n.frameRate=="object"&&(n.frameRate.max=60),Pr()&&(n.frameRate={ideal:30,max:30}),n}function GW(e){const n={};return j6()||(e.AGC!==void 0&&(n.autoGainControl=e.AGC),e.AEC!==void 0&&(n.echoCancellation=e.AEC),e.ANS!==void 0&&(n.noiseSuppression=e.ANS,Tf()&&e.ANS&&(n.googHighpassFilter=e.ANS))),n}function zW(e){const n=GW(e);if(e.encoderConfig){const i=uA(e.encoderConfig);n.channelCount=i.stereo?2:1,n.sampleRate=i.sampleRate,n.sampleSize=i.sampleSize}return e.microphoneId&&(n.deviceId={exact:e.microphoneId}),ZI()&&(n.sampleRate=void 0),n}const Qhe=e=>{const n=e._encoderConfig;if(!n)return;const{frameRate:i,width:o,height:c}=e.getMediaStreamTrackSettings();let{frameRate:u=i,width:h=o,height:m=c}=n;if(!u||!h||!m)return;h=iL(h),m=iL(m),u=iL(u);const{max:_,min:y}=function(P,B,M){const U=200*Math.pow(M/15,.6)*Math.pow(P*B/640/360,.75);return{min:Math.floor(U),max:Math.floor(4*U)}}(h,m,u),{bitrateMax:S,bitrateMin:w}=n||{};S||k.debug("calculate bitrate: [w: ".concat(h,", h: ").concat(m,", fps: ").concat(u,"] => [brMax: ").concat(S,", brMin: ").concat(w,"]"));const{maxFramerate:I}=Z("ENCODER_CONFIG_LIMIT");return I&&typeof I=="number"&&(u=Math.min(u,I)),{frameRate:u,bitrateMax:S||_,bitrateMin:w||y,scaleResolutionDownBy:1,scale:0}},HW=async(e,n,i)=>await(async(o,c,u)=>{const h=function(y){const S=[];for(let w=0;w<y.length;w+=2)S.push(parseInt(y.slice(w,w+2),16));return Uint8Array.from(S)}(nW(""+c+u)).slice(0,16),m=h.slice(0,12),_=await window.crypto.subtle.importKey("raw",h,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:m},_,o))})(e.buffer,n,i),OL=e=>{const n=document.createElement("canvas");return n.width=2,n.height=2,new tt((i,o)=>{n.toBlob(async c=>{if(n.remove(),c){const u=await KW(c);i({buffer:u,width:n.width,height:n.height})}else o(new Ce(Y.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,1)})},KW=async e=>{const n=await e.arrayBuffer();return new Uint8Array(n)};var qW,$W,YW,XW,JW,QW,ZW,eG,tG,nG,rG,iG,sG,oG,aG,cG,lG,uG,Cr,dG,hG,fG,pG,mG,gG,qd,_G,EG,yG,vG,SG,TG,bG,wG,RG,CG,IG,AG,OG,fs;let Vr=(qW=At({argsMap:(e,n)=>[e.getTrackId(),n],throttleTime:300}),$W=At({argsMap:(e,n)=>[e.getTrackId(),n]}),YW=$r(),XW=Yy("LocalAudioTrack","_enabledMutex"),JW=At({argsMap:(e,n)=>[e.getTrackId(),n]}),QW=$r(),ZW=Yy("LocalAudioTrack","_enabledMutex"),eG=At({argsMap:(e,n)=>[e.getTrackId(),n]}),tG=$r(),nG=$r(),rG=$r(),iG=At({argsMap:e=>[e.getTrackId()]}),sG=$r(),oG=At({argsMap:e=>[e.getTrackId()]}),aG=$r(),cG=At({argsMap:e=>[e.getTrackId()]}),lG=At({argsMap:(e,n)=>[e.getTrackId(),n.name]}),uG=At({argsMap:e=>[e.getTrackId()]}),wn((Cr=class extends iv{get _source(){return this.initWebAudio()}set _source(e){this._trackSource=e}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?Uo.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(e,n,i,o){super(e,i),Te(this,"trackMediaType",rv.AUDIO),Te(this,"_encoderConfig",void 0),Te(this,"_trackSource",void 0),Te(this,"metadata",[]),Te(this,"_enabled",!0),Te(this,"_volume",100),Te(this,"_useAudioElement",!0),Te(this,"_bypassWebAudio",!1),Te(this,"processor",void 0),Te(this,"_processorContext",void 0),Te(this,"_processorDestination",void 0),Te(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=n,this._getOriginVolumeLevel=!!o,this._trackSource=new AL,Z("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),Z("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),ls()&&!Tc?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(e){Jn(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&Uo.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void k.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const n=this._source.createOutputTrack();this._mediaStreamTrack!==n&&(this._mediaStreamTrack=n,nr(this,ut.NEED_REPLACE_TRACK,this).then(()=>{k.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(i=>{k.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),i)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(e){if(!this._useAudioElement||!SW())throw new Ce(Y.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Uo.setSinkID(this.getTrackId(),e)}async setEnabled(e,n,i){return this._setEnabled(e,n,i)}async _setEnabled(e,n,i){if(!i){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(k.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){this._originMediaStreamTrack.enabled=!0;try{i||(this._enabled=!0),await nr(this,ut.NEED_ENABLE_TRACK,this),k.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(e," success"))}catch(o){throw i||(this._enabled=!1),k.error("[".concat(this.getTrackId(),"] setEnabled to true error"),o.toString()),o}}else{this._originMediaStreamTrack.enabled=!1,i||(this._enabled=!1);try{await nr(this,ut.NEED_DISABLE_TRACK,this)}catch(o){throw i||(this._enabled=!0),k.error("[".concat(this.getTrackId(),"] setEnabled to false error"),o.toString()),o}}}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,k.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await nr(this,ut.NEED_MUTE_TRACK,this):await nr(this,ut.NEED_UNMUTE_TRACK,this))}getStats(){return Jp(()=>{k.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),_c(this,ut.GET_STATS)||Sr({},SL)}setAudioFrameCallback(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(vc.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(n),this._source.removeAllListeners(vc.ON_AUDIO_BUFFER),this._source.on(vc.ON_AUDIO_BUFFER,i=>e(i))}play(){k.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(k.debug("[".concat(this.getTrackId(),"] start audio playback in element")),Uo.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){k.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?Uo.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];k.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Uo.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(e,n){this._originMediaStreamTrack!==e&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),n&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:e,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await nr(this,ut.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(e))}renewMediaStreamTrack(e){return tt.resolve(void 0)}pipe(e){if(this._bypassWebAudio)throw new Ce(Y.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new Ce(Y.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(!this.processor)return;const n=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,n.reset()}bindProcessorDestinationEvents(e){e.on(lo.ON_TRACK,async n=>{n?n!==this._mediaStreamTrack&&(this._mediaStreamTrack=n,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(n),await nr(this,ut.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await nr(this,ut.NEED_REPLACE_TRACK,this))}),e.on(lo.ON_NODE,n=>{this._source.processedNode=n})}unbindProcessorDestinationEvents(e){e.removeAllListeners(lo.ON_TRACK),e.removeAllListeners(lo.ON_NODE)}bindProcessorContextEvents(e){e.on(Sc.REQUEST_CONSTRAINTS,async n=>{n(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(e){e.removeAllListeners(Sc.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof AL&&(this._trackSource=new NW(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const e=new BW(this._source.context,this.getTrackId(),"local"),n=new jW(e);return this._processorContext=e,this._processorDestination=n,this.bindProcessorContextEvents(e),this.bindProcessorDestinationEvents(n),this._source.on(vc.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:e})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(Uo.stop(this.getTrackId()),this._source.play()),nr(this,ut.NEED_REPLACE_MIXING_TRACK,this).then(()=>{k.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(i=>{k.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),i)})),{processorContext:e,processorDestination:n}}}).prototype,"setVolume",[qW],Object.getOwnPropertyDescriptor(Cr.prototype,"setVolume"),Cr.prototype),wn(Cr.prototype,"setPlaybackDevice",[$W,YW],Object.getOwnPropertyDescriptor(Cr.prototype,"setPlaybackDevice"),Cr.prototype),wn(Cr.prototype,"setEnabled",[XW,JW,QW],Object.getOwnPropertyDescriptor(Cr.prototype,"setEnabled"),Cr.prototype),wn(Cr.prototype,"setMuted",[ZW,eG,tG],Object.getOwnPropertyDescriptor(Cr.prototype,"setMuted"),Cr.prototype),wn(Cr.prototype,"getStats",[nG],Object.getOwnPropertyDescriptor(Cr.prototype,"getStats"),Cr.prototype),wn(Cr.prototype,"setAudioFrameCallback",[rG],Object.getOwnPropertyDescriptor(Cr.prototype,"setAudioFrameCallback"),Cr.prototype),wn(Cr.prototype,"play",[iG,sG],Object.getOwnPropertyDescriptor(Cr.prototype,"play"),Cr.prototype),wn(Cr.prototype,"stop",[oG,aG],Object.getOwnPropertyDescriptor(Cr.prototype,"stop"),Cr.prototype),wn(Cr.prototype,"close",[cG],Object.getOwnPropertyDescriptor(Cr.prototype,"close"),Cr.prototype),wn(Cr.prototype,"pipe",[lG],Object.getOwnPropertyDescriptor(Cr.prototype,"pipe"),Cr.prototype),wn(Cr.prototype,"unpipe",[uG],Object.getOwnPropertyDescriptor(Cr.prototype,"unpipe"),Cr.prototype),Cr),pA=(dG=At({argsMap:(e,n)=>[e.getTrackId(),n]}),hG=$r(),fG=Yy("MicrophoneAudioTrack","_enabledMutex"),pG=At({argsMap:(e,n,i)=>[e.getTrackId(),n,i]}),mG=$r(),gG=At({argsMap:e=>[e.getTrackId()]}),wn((qd=class extends Vr{get __className__(){return"MicrophoneAudioTrack"}constructor(e,n,i,o){super(e,n.encoderConfig?uA(n.encoderConfig):{},o,Z("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),Te(this,"_config",void 0),Te(this,"_deviceName","default"),Te(this,"_constraints",void 0),Te(this,"_originalConstraints",void 0),Te(this,"_enabled",!0),this._config=n,this._constraints=i,this._originalConstraints=i,this._deviceName=e.label,typeof n.bypassWebAudio=="boolean"&&(this._bypassWebAudio=n.bypassWebAudio),(Ky()||X1())&&$n.bindInterruptDetectorTrack(this)}async setDevice(e){if(k.info("[".concat(this.getTrackId(),"] start set device to ").concat(e)),this._enabled)try{const n=await wc.getDeviceById(e),i={};i.audio=Sr({},this._constraints),i.audio.deviceId={exact:e},this._originMediaStreamTrack.stop();let o=null;try{o=await bc(i,this.getTrackId())}catch(c){throw k.error("[".concat(this.getTrackId(),"] setDevice failed"),c.toString()),o=await bc({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!1),c}await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!1),this._deviceName=n.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(n){throw k.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}else try{const n=await wc.getDeviceById(e);this._deviceName=n.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(n){throw k.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}k.info("[".concat(this.getTrackId(),"] set device to ").concat(e," success"))}async setEnabled(e,n,i){if(n)return k.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(e);if(!i){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(k.info("[".concat(this.getTrackId(),"] start setEnabled"),e),Z("AUTO_RESET_AUDIO_ROUTE")&&(co()||Gl())){const h=navigator.audioSession;h&&(e||(h.type="playback"),h.type="auto")}if(!e){var o;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(o=this._source.clonedTrack)===null||o===void 0||o.stop(),i||(this._enabled=!1);try{await nr(this,ut.NEED_DISABLE_TRACK,this)}catch(h){throw k.error("[".concat(this.getTrackId(),"] setEnabled false failed"),h.toString()),h}return}const c=Sr({},this._constraints),u=wc.searchDeviceIdByName(this._deviceName);u&&!c.deviceId&&(c.deviceId=u);try{i||(this._enabled=!0);const h=await bc({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(h.getAudioTracks()[0],!1),await nr(this,ut.NEED_ENABLE_TRACK,this)}catch(h){throw i||(this._enabled=!1),k.error("[".concat(this.getTrackId(),"] setEnabled true failed"),h.toString()),h}k.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(Ky()||X1())&&$n.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((co()||Gl())&&this._enabled&&!this._isClosed&&$n.duringInterruption){const e=async()=>{$n.off(Xi.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(k.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};$n.on(Xi.IOS_INTERRUPTION_END,e)}else k.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(tv.TRACK_ENDED)}async renewMediaStreamTrack(e){const n=e||this._constraints,i=wc.searchDeviceIdByName(this._deviceName);if(i&&!n.deviceId&&(n.deviceId=i),this._constraints=n,this._enabled){this._originMediaStreamTrack.stop();const o=await bc({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!0)}}bindProcessorContextEvents(e){super.bindProcessorContextEvents(e),e.on(Sc.REQUEST_UPDATE_CONSTRAINTS,async(n,i,o)=>{try{const c=Object.assign({},this._originalConstraints,...n);await this.renewMediaStreamTrack(c),i()}catch(c){o(c)}})}unbindProcessorContextEvents(e){super.unbindProcessorContextEvents(e),e.removeAllListeners(Sc.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[dG,hG],Object.getOwnPropertyDescriptor(qd.prototype,"setDevice"),qd.prototype),wn(qd.prototype,"setEnabled",[fG,pG,mG],Object.getOwnPropertyDescriptor(qd.prototype,"setEnabled"),qd.prototype),wn(qd.prototype,"close",[gG],Object.getOwnPropertyDescriptor(qd.prototype,"close"),qd.prototype),qd),Zhe=(_G=At({argsMap:(e,n)=>[e.getTrackId(),n,e.duration]}),EG=$r(),yG=At({argsMap:e=>[e.getTrackId()]}),vG=$r(),SG=At({argsMap:e=>[e.getTrackId()]}),TG=$r(),bG=At({argsMap:e=>[e.getTrackId()]}),wG=$r(),RG=At({argsMap:e=>[e.getTrackId()]}),CG=$r(),IG=At({argsMap:e=>[e.getTrackId()]}),AG=At({argsMap:e=>[e.getTrackId()]}),OG=$r(),wn((fs=class extends Vr{get __className__(){return"BufferSourceAudioTrack"}constructor(e,n,i,o){super(n.createOutputTrack(),i,o),Te(this,"source",void 0),Te(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=e,this._bufferSource=n,this._bufferSource.on(vc.AUDIO_SOURCE_STATE_CHANGE,c=>{this.safeEmit(tv.SOURCE_STATE_CHANGE,c)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(e){this._bufferSource.seekAudioBuffer(e)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(e){Jn(e,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e)}}).prototype,"startProcessAudioBuffer",[_G,EG],Object.getOwnPropertyDescriptor(fs.prototype,"startProcessAudioBuffer"),fs.prototype),wn(fs.prototype,"pauseProcessAudioBuffer",[yG,vG],Object.getOwnPropertyDescriptor(fs.prototype,"pauseProcessAudioBuffer"),fs.prototype),wn(fs.prototype,"seekAudioBuffer",[SG,TG],Object.getOwnPropertyDescriptor(fs.prototype,"seekAudioBuffer"),fs.prototype),wn(fs.prototype,"resumeProcessAudioBuffer",[bG,wG],Object.getOwnPropertyDescriptor(fs.prototype,"resumeProcessAudioBuffer"),fs.prototype),wn(fs.prototype,"stopProcessAudioBuffer",[RG,CG],Object.getOwnPropertyDescriptor(fs.prototype,"stopProcessAudioBuffer"),fs.prototype),wn(fs.prototype,"close",[IG],Object.getOwnPropertyDescriptor(fs.prototype,"close"),fs.prototype),wn(fs.prototype,"setAudioBufferPlaybackSpeed",[AG,OG],Object.getOwnPropertyDescriptor(fs.prototype,"setAudioBufferPlaybackSpeed"),fs.prototype),fs);class yi extends Vr{get __className__(){return"MixingAudioTrack"}get isActive(){for(const n of this.trackList)if(n._enabled&&!n._isClosed&&!n.muted)return!0;return!1}constructor(){const n=sv().createMediaStreamDestination();super(n.stream.getAudioTracks()[0],void 0,rr(8,"track-mix-")),Te(this,"trackList",void 0),Te(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=n,this.trackList=[]}hasAudioTrack(n){return this.trackList.indexOf(n)!==-1}addAudioTrack(n){this.trackList.indexOf(n)===-1?(k.debug("add ".concat(n.getTrackId()," to mixing track")),n._source.outputNode.connect(this.destNode),this.trackList.push(n),this.updateEncoderConfig()):k.debug("track ".concat(n.getTrackId()," is already added"))}removeAudioTrack(n){if(this.trackList.indexOf(n)!==-1){k.debug("remove ".concat(n.getTrackId()," from mixing track"));try{n._source.outputNode.disconnect(this.destNode)}catch{}eA(this.trackList,n),this.updateEncoderConfig()}}updateEncoderConfig(){const n={};this.trackList.forEach(i=>{i._encoderConfig&&((i._encoderConfig.bitrate||0)>(n.bitrate||0)&&(n.bitrate=i._encoderConfig.bitrate),(i._encoderConfig.sampleRate||0)>(n.sampleRate||0)&&(n.sampleRate=i._encoderConfig.sampleRate),(i._encoderConfig.sampleSize||0)>(n.sampleSize||0)&&(n.sampleSize=i._encoderConfig.sampleSize),i._encoderConfig.stereo&&(n.stereo=!0))}),this._encoderConfig=n}_updateRtpTransceiver(n){this._rtpTransceiver!==n&&(this._rtpTransceiver=n,this.trackList.forEach(i=>{i instanceof yi?i.emit(t_.TRANSCEIVER_UPDATED,n):i._updateRtpTransceiver(n)}))}}class efe extends PW{set currentState(n){n!==this._currentState&&(this._currentState=n,this.safeEmit(vc.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),Te(this,"audioBuffer",void 0),Te(this,"sourceNode",void 0),Te(this,"startPlayTime",0),Te(this,"startPlayOffset",0),Te(this,"pausePlayTime",0),Te(this,"options",void 0),Te(this,"currentLoopCount",0),Te(this,"currentPlaybackSpeed",100),Te(this,"_currentState","stopped"),this.audioBuffer=n,this.options=i,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(n){this.currentState==="stopped"?(this.options=n,this.startPlayOffset=this.options.startPlayTime||0):k.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(n){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=n,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=n))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(n){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=n/100),this.currentPlaybackSpeed=n}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const n=this.context.createBufferSource();return n.buffer=this.audioBuffer,n.loop=!!this.options.loop,n.connect(this.outputNode),n.playbackRate.value=this.currentPlaybackSpeed/100,n}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const PG=new Map;class PL{get rendFrameRate(){if(this.renderStats&&this.renderStats.curTs!==this.renderStats.lastTs){const n=this.renderStats.curTs-this.renderStats.lastTs,i=(this.renderStats.renderNum-this.renderStats.lastRenderNum)/n;return this.renderStats.lastRenderNum=this.renderStats.renderNum,this.renderStats.lastTs=this.renderStats.curTs,i}return 0}get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(n){n!==this._videoElementStatus&&(k.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(n)),this._videoElementStatus=n)}get videoState(){return this._videoState}set videoState(n){var i;n!==this._videoState&&(this._videoState=n,(i=this.onVideoStateChanged)===null||i===void 0||i.call(this,this.videoState))}constructor(n){Te(this,"trackId",void 0),Te(this,"config",void 0),Te(this,"onFirstVideoFrameDecoded",void 0),Te(this,"onVideoStateChanged",void 0),Te(this,"freezeTimeCounterList",[]),Te(this,"renderFreezeAccTime",0),Te(this,"isKeepLastFrame",!1),Te(this,"timeUpdatedCount",0),Te(this,"freezeTime",0),Te(this,"playbackTime",0),Te(this,"lastTimeUpdatedTime",0),Te(this,"autoplayFailed",!1),Te(this,"videoTrack",void 0),Te(this,"videoElement",void 0),Te(this,"cacheVideoElement",void 0),Te(this,"renderStats",void 0),Te(this,"_videoState",Kd.VideoStateStopped),Te(this,"videoElementCheckInterval",void 0),Te(this,"videoElementFreezeTimeout",void 0),Te(this,"_videoElementStatus",zs.NONE),Te(this,"isGettingVideoDimensions",!1),Te(this,"startGetVideoDimensions",()=>{const i=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return k.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(i,500)};!this.isGettingVideoDimensions&&i()}),Te(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&$n.curState==="running"&&(k.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(N6())),V6()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),Te(this,"handleVideoEvents",i=>{switch(i.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=zs.PLAYING;break;case"loadeddata":if(this.videoState=Kd.VideoStateStarting,this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=zs.CANPLAY;break;case"stalled":this.videoElementStatus=zs.STALLED;break;case"suspend":this.videoElementStatus=zs.SUSPEND;break;case"pause":this.videoElementStatus=zs.PAUSED,co()||Gl()||ls()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(k.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=zs.WAITING;break;case"abort":this.videoElementStatus=zs.ABORT;break;case"ended":this.videoElementStatus=zs.ENDED;break;case"emptied":this.videoElementStatus=zs.EMPTIED;break;case"error":{const o=this.videoElement.error;o&&(this.videoElementStatus=zs.ERROR,k.error("[".concat(this.trackId,"] media error: ").concat(o.message," (").concat(o.code,")")));break}case"timeupdate":{const o=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=o);const c=o-this.lastTimeUpdatedTime,u=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=o,Cf.lastVisibleTime<Cf.lastHiddenTime||u<Cf.lastHiddenTime||u<Cf.lastVisibleTime)return;for(c>Z("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=c),this.playbackTime+=c;this.playbackTime>=6e3;){this.playbackTime-=6e3;const h=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(h),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),Te(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(k.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(N6())),V6()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=n.trackId,this.config=n,n.element instanceof HTMLVideoElement?this.videoElement=n.element:this.videoElement=document.createElement("video"),$n.on(Xi.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),$n.on(Xi.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var n;return(n=this.videoElement.parentElement)!==null&&n!==void 0?n:void 0}updateConfig(n){this.config=n,this.trackId=n.trackId,n.element!==this.videoElement&&(this.destroy(),this.videoElement=n.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(n){this.videoTrack!==n&&(this.videoTrack=n,this.initVideoElement())}play(n){const i=this.videoElement.play();i&&i.catch&&i.catch(c=>{n&&UW(n,"video",c.message,this.trackId),c.name==="NotAllowedError"?(k.warning("detected video element autoplay failed",c),this.autoplayFailed=!0,this.handleAutoPlayFailed()):k.warning("[".concat(this.trackId,"] play warning: "),c)});const o=Tn();if((o.name==="Safari"&&Number(o.version)===15||Ky())&&i&&i.then){const c=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};i.then(c).catch(c)}}getCurrentFrame(){const n=document.createElement("canvas");n.width=this.videoElement.videoWidth,n.height=this.videoElement.videoHeight;const i=n.getContext("2d");if(!i)return k.error("create canvas context failed!"),new ImageData(2,2);i.drawImage(this.videoElement,0,0,n.width,n.height);const o=i.getImageData(0,0,n.width,n.height);return n.remove(),o}async getCurrentFrameToUint8Array(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const o=document.createElement("canvas");o.width=this.videoElement.videoWidth,o.height=this.videoElement.videoHeight;const c=o.getContext("2d");return c?(c.drawImage(this.videoElement,0,0,o.width,o.height),new tt((u,h)=>{o.toBlob(async m=>{if(o.remove(),m){const _=await KW(m);u({buffer:_,width:o.width,height:o.height})}else h(new Ce(Y.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},n,i<0?.1:i>1?1:i)})):await OL(n)}destroy(){this.renderStats=void 0,$n.off(Xi.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),$n.off(Xi.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=Kd.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=zs.INIT,!this.videoElementCheckInterval&&(NG.forEach(u=>{this.videoElement.addEventListener(u,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{(function(u){return u!==document.body&&document.body.contains(u)})(this.videoElement)||(this.videoElementStatus=zs.DESTROYED)},1e3),Z("ENABLE_VIDEO_FRAME_CALLBACK"))){var n,i;let u;const h=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",h),this.videoElementFreezeTimeout=window.setTimeout(m,Z("VIDEO_FREEZE_DURATION")))},m=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===Kd.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=Kd.VideoStateFrozen:document.addEventListener("visibilitychange",h))},_=(y,S)=>{if(this.videoElementStatus===zs.PLAYING){if(this.renderStats?(this.renderStats.renderNum++,this.renderStats.curTs=S.mediaTime):this.renderStats={lastTs:S.mediaTime,curTs:S.mediaTime,lastRenderNum:0,renderNum:0},u){const P=S.presentationTime-u.presentationTime;this.videoState===Kd.VideoStateStarting&&(this.videoState=Kd.VideoStateDecoding),this.videoState===Kd.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(m,Z("VIDEO_FREEZE_DURATION"))),P<Z("VIDEO_FREEZE_DURATION")&&this.videoState===Kd.VideoStateFrozen&&(this.videoState=Kd.VideoStateDecoding),P>Z("VIDEO_FREEZE_DURATION")&&Cf.lastVisibleTime>=Cf.lastHiddenTime&&u.timestamp>Cf.lastVisibleTime&&u.timestamp>Cf.lastHiddenTime&&(this.renderFreezeAccTime+=P)}u=Sr(Sr({},S),{},{timestamp:y})}var w,I;Z("ENABLE_VIDEO_FRAME_CALLBACK")&&((w=(I=this.videoElement).requestVideoFrameCallback)===null||w===void 0||w.call(I,_))};(n=(i=this.videoElement).requestVideoFrameCallback)===null||n===void 0||n.call(i,_)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),ZI()&&!Z("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const o=Tn();o.name==="Safari"&&Number(o.version)===15||Ky()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Pr()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Pr()&&this.videoElement.load());const c=this.videoElement.play();c!==void 0&&c.catch(u=>{k.debug("[".concat(this.trackId,"] playback interrupted"),u.toString())})}resetVideoElement(){NG.forEach(n=>{this.videoElement&&this.videoElement.removeEventListener(n,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=zs.NONE}handleAutoPlayFailed(){const n=i=>{i.preventDefault(),this.videoElement.play().then(()=>{k.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(o=>{k.error(o)}),this.autoplayFailed=!1,P0()?document.body.removeEventListener("click",n,!0):(document.body.removeEventListener("touchstart",n,!0),document.body.removeEventListener("mousedown",n,!0))};P0()?document.body.addEventListener("click",n,!0):(document.body.addEventListener("touchstart",n,!0),document.body.addEventListener("mousedown",n,!0)),MW()}}const NG=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class kG extends PL{constructor(n){super(n),Te(this,"container",void 0),Te(this,"slot",void 0),this.slot=n.element,this.updateConfig(n)}updateConfig(n){this.config=n,this.trackId=n.trackId;const i=n.element;i!==this.slot&&(this.destroy(),this.slot=i),this.createElements()}updateVideoTrack(n){this.videoTrack!==n&&(this.videoTrack=n,this.createElements())}play(n){var i;(i=this.container)!==null&&i!==void 0&&i.contains(this.videoElement)&&super.play(n)}getCurrentFrame(){var n;return(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(n){var i;let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(i=this.container)!==null&&i!==void 0&&i.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(n,o):await OL(n)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",Z("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var n;!this.container||(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var n;if((n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var n;(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var DG,LG,xG,MG,UG,VG,FG,jG,BG,WG,GG,zG,HG,KG,qG,$G,YG,XG,JG,QG,ZG,ez,tz,nz,yn,rz,iz,sz,oz,az,cz,lz,uz,Cc;let hr=(DG=At({argsMap:(e,n,i)=>[e.getTrackId(),typeof n=="string"?n:n instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",i]}),LG=$r(),xG=At({argsMap:e=>[e.getTrackId()]}),MG=Yy("LocalVideoTrack","_enabledMutex"),UG=At({argsMap:(e,n)=>[e.getTrackId(),n]}),VG=$r(),FG=Yy("LocalVideoTrack","_enabledMutex"),jG=At({argsMap:(e,n)=>[e.getTrackId(),n]}),BG=$r(),WG=At({argsMap:(e,n)=>[e.getTrackId(),n]}),GG=$r(),zG=$r(),HG=At({argsMap:(e,n,i)=>[e.getTrackId(),n,i]}),KG=$r(),qG=$r(),$G=$r(),YG=$r(),XG=$r(),JG=$r(),QG=$r(),ZG=At({argsMap:(e,n)=>[e.getTrackId(),n.name]}),ez=At({argsMap:e=>[e.getTrackId()]}),tz=At({argsMap:e=>[e.getTrackId()]}),nz=At({argsMap:(e,n,i)=>[e.getTrackId(),n.label,i]}),yn=class Fie extends iv{get videoHeight(){if(ls()){const{height:n}=this._mediaStreamTrack.getSettings();return this._videoHeight=n,this._videoHeight}return this._videoHeight}get videoWidth(){if(ls()){const{width:n}=this._mediaStreamTrack.getSettings();return this._videoWidth=n,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==zs.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(n){this._processorContext=n}get __className__(){return"LocalVideoTrack"}constructor(n,i,o,c,u,h){if(super(n,u),Te(this,"trackMediaType",rv.VIDEO),Te(this,"_player",void 0),Te(this,"isUseScaleResolutionDownBy",!1),Te(this,"_videoVisibleTimer",null),Te(this,"_previousVideoVisibleStatus",void 0),Te(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),Te(this,"_encoderConfig",void 0),Te(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),Te(this,"_optimizationMode",void 0),Te(this,"_videoHeight",void 0),Te(this,"_videoWidth",void 0),Te(this,"_forceBitrateLimit",void 0),Te(this,"_enabled",!0),Te(this,"_processorDestination",void 0),Te(this,"_processorContext",void 0),ls()){const{width:m,height:_}=n.getSettings();this._videoWidth=m,this._videoHeight=_}else this.updateMediaStreamTrackResolution();if(this._encoderConfig=i,this._scalabilityMode=o,this._optimizationMode=c,this._hints=h||[],this._hints.indexOf(ir.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(q1(Ln.CHROME,115)&&JI().indexOf("Windows")!==-1){const m=function(_,y){if("VideoFrame"in window&&"TransformStream"in window&&On().supportWebRTCInsertableStream){const S=new MediaStreamTrackProcessor(_),w=new MediaStreamTrackGenerator({kind:"video"});let I,P,B=Date.now();const M=()=>{U&&(clearInterval(U),U=void 0),I&&(I.close(),I=void 0),_.stop(),P=void 0,w.removeEventListener("ended",M)};let U=window.setInterval(()=>{if(P&&I&&Date.now()-B>1e3)try{w.readyState==="live"?P.enqueue(I.clone()):M()}catch{M()}},1e3);const q=new TransformStream({transform:($,ae)=>{w.readyState==="live"?(P=ae,B=Date.now(),I===void 0?(I=$,ae.enqueue($.clone())):(ae.enqueue(I),I=$)):$.close()}});return w.addEventListener("ended",M),S.readable.pipeThrough(q).pipeTo(w.writable),w}}(n);m&&(k.info("local screen video track begin to inject frame"),this._mediaStreamTrack=m)}i&&this._hints.indexOf(ir.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(i),this._processorContext=new FW(this.getTrackId(),"local"),this._processorDestination=new VW(this.processorContext),this.bindProcessorDestinationEvents()}play(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof n=="string"){const c=document.getElementById(n);c?n=c:(k.warning("[".concat(this.getTrackId(),'] can not find "#').concat(n,'" element, use document.body')),n=document.body)}k.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(n instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(i));const o=Sr(Sr(Sr({},this._getDefaultPlayerConfig()),i),{},{trackId:this.getTrackId(),element:n});this._player?this._player.updateConfig(o):(n instanceof HTMLVideoElement?this._player=new PL(o):this._player=new kG(o),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const c=this.getVideoElementVisibleStatus();this.safeEmit(tv.VIDEO_ELEMENT_VISIBLE_STATUS,c)}catch{}},Z("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,k.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(n,i){if(!i){if(n===this._enabled)return;this.stateCheck("enabled",n)}if(k.info("[".concat(this.getTrackId(),"] start setEnabled"),n),!n){this._originMediaStreamTrack.enabled=!1;try{await nr(this,ut.NEED_DISABLE_TRACK,this)}catch(o){throw k.error("[".concat(this.getTrackId(),"] setEnabled to false error"),o.toString()),o}return i||(this._enabled=!1),void k.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await nr(this,ut.NEED_ENABLE_TRACK,this)}catch(o){throw k.error("[".concat(this.getTrackId(),"] setEnabled to true error"),o.toString()),o}k.info("[".concat(this.getTrackId(),"] setEnabled to true success")),i||(this._enabled=!0)}async setMuted(n){n!==this._muted&&(this.stateCheck("muted",n),this._muted=n,this._originMediaStreamTrack.enabled=!n,k.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(n)),n?await nr(this,ut.NEED_MUTE_TRACK,this):await nr(this,ut.NEED_UNMUTE_TRACK,this))}async setEncoderConfiguration(n,i){if(!this._enabled)throw new Ce(Y.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(n=Hd(n),this._forceBitrateLimit&&(n.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:n.bitrateMax,n.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:n.bitrateMin),n.width||n.height||n.frameRate){const o=fA({encoderConfig:n});(ls()||co()||Gl())&&(o.deviceId=void 0),k.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(n),JSON.stringify(o));try{await this._originMediaStreamTrack.applyConstraints(o),this.updateMediaStreamTrackResolution()}catch(c){const u=new Ce(Y.UNEXPECTED_ERROR,c.toString());throw k.error("[".concat(this.getTrackId(),"] applyConstraints error"),u.toString()),u}}this._encoderConfig=n,this._hints.indexOf(ir.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await nr(this,ut.NEED_UPDATE_VIDEO_ENCODER,this)}catch(o){return o.throw(k)}}getStats(){return Jp(()=>{k.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),_c(this,ut.GET_STATS)||Sr({},TL)}async setBeautyEffect(n){k.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(n,i):await OL(n)}async setBitrateLimit(n){k.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(n))),n&&(this._forceBitrateLimit=n,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<n.max_bitrate?this._encoderConfig.bitrateMax:n.max_bitrate:this._encoderConfig.bitrateMax=n.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=n.min_bitrate))}async setOptimizationMode(n){if(n!=="motion"&&n!=="detail"&&n!=="balanced")return void k.error(Y.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const i=this._optimizationMode;try{this._optimizationMode=n,await nr(this,ut.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(o){throw this._optimizationMode=i,k.error("[".concat(this.getTrackId(),"] set optimization mode failed"),o.toString()),o}k.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(n,")"))}setScalabiltyMode(n){if(n.numSpatialLayers===1&&n.numTemporalLayers!==1)return k.error(Y.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=n,k.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(n,")"))}updateMediaStreamTrackResolution(){WW(this._originMediaStreamTrack).then(n=>{let[i,o]=n;this._videoHeight=o,this._videoWidth=i}).catch(nA)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(n){if(!this._enabled)throw new Ce(Y.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");k.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(n)),n=Hd(n),this._forceBitrateLimit&&(n.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:n.bitrateMax,n.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:n.bitrateMin),this._encoderConfig=n,this._hints.indexOf(ir.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await nr(this,ut.NEED_UPDATE_VIDEO_ENCODER,this)}catch(i){return i.throw(k)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:n,height:i,frameRate:o}=this.getMediaStreamTrackSettings();if(!n||!i||!o)return;const{bitrateMax:c,bitrateMin:u}=this._encoderConfig;if(u==null||c==null){const{max:h,min:m}=function(_,y,S,w,I){const P=Z("BITRATE_ADAPTER_TYPE");if(P==="DEFAULT_BITRATE")return{min:w,max:I};if(I===void 0){var B;const U=Math.floor(200*Math.pow(S/15,.6)*Math.pow(_*y/640/360,.75));I=P==="STANDARD_BITRATE"?4*U:2*U,w=(B=w)!==null&&B!==void 0?B:U}else{var M;w=(M=w)!==null&&M!==void 0?M:Math.floor(I/10)}return{min:w,max:I}}(n,i,o,u,c);this._encoderConfig.bitrateMin=m,this._encoderConfig.bitrateMax=h,k.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(n,", h: ").concat(i,", fps: ").concat(o,"] => [brMax: ").concat(h,", brMin: ").concat(m,"]"))}}getVideoElementVisibleStatus(){try{var n,i;const o=this==null||(n=this._player)===null||n===void 0?void 0:n.getContainerElement(),c={track:this,element:this==null||(i=this._player)===null||i===void 0?void 0:i.getVideoElement(),slot:o==null?void 0:o.parentElement},{element:u,slot:h}=c;if(this.isPlaying&&u instanceof HTMLVideoElement&&h instanceof HTMLElement){const m=G6.checkOneElementVisible(u),_=Object.assign({},m);if(_.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=_.visible;const y=yt.reportApiInvoke(null,{tag:kr.TRACER,name:fi.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});_.visible?y.onSuccess("Video is visible"):y.onSuccess("Invisible because of ".concat(_.reason))}return _}return}catch(o){throw new Ce(Y.GET_VIDEO_ELEMENT_VISIBLE_ERROR,o.message)}}async renewMediaStreamTrack(n){}pipe(n){if(this.processor===n)return n;if(n._source)throw new Ce(Y.INVALID_OPERATION,"Processor ".concat(n.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=n,this.processor._source=this,n.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),n}unpipe(){if(!this.processor)return;const n=this.processor;this.processor._source=void 0,this.processor=void 0,n.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(n){let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],o=this._encoderConfig;n&&(o=Sr(Sr({},o),Hd(n))),o=Jg(o);const c=rr(8,"track-video-cloned-"),u=new Fie(i?this._mediaStreamTrack.clone():this._mediaStreamTrack,o,Jg(this._scalabilityMode),this._optimizationMode,c,Jg(this._hints));return n&&o&&u.setEncoderConfiguration(o),k.debug("clone video track from ".concat(this.getTrackId()," to ").concat(c,", clone ").concat(i)),u}async replaceTrack(n,i){if(!(n instanceof MediaStreamTrack))throw new Ce(Y.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(n.kind!=="video")throw new Ce(Y.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(n,i,!0),this.updateMediaStreamTrackResolution()}sendSeiData(n){if(Jp(()=>{yt.reportApiInvoke(null,{name:fi.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:kr.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!Z("ENABLE_VIDEO_SEI")||!Z("ENABLE_ENCODED_TRANSFORM"))return void k.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(n instanceof Uint8Array==0)return new Ce(Y.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const i=this.getRTCRtpTransceiver();if(!i)return void k.warning("Video track is not published, SEI can not be send");const o=i.sender.getParameters();if(o.codecs.length===0)return;const c=o.codecs[0].mimeType.toLocaleLowerCase();c==="video/h264"?this.safeEmit("sei-to-send",n):k.warning("SEI is not supported by ".concat(c))}bindProcessorDestinationEvents(){this.processorDestination.on(lo.ON_TRACK,async n=>{n?n!==this._mediaStreamTrack&&(this._mediaStreamTrack=n,this._updatePlayerSource(),await nr(this,ut.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await nr(this,ut.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(lo.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(Sc.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(Sc.REQUEST_CONSTRAINTS)}},wn(yn.prototype,"play",[DG,LG],Object.getOwnPropertyDescriptor(yn.prototype,"play"),yn.prototype),wn(yn.prototype,"stop",[xG],Object.getOwnPropertyDescriptor(yn.prototype,"stop"),yn.prototype),wn(yn.prototype,"setEnabled",[MG,UG,VG],Object.getOwnPropertyDescriptor(yn.prototype,"setEnabled"),yn.prototype),wn(yn.prototype,"setMuted",[FG,jG,BG],Object.getOwnPropertyDescriptor(yn.prototype,"setMuted"),yn.prototype),wn(yn.prototype,"setEncoderConfiguration",[WG,GG],Object.getOwnPropertyDescriptor(yn.prototype,"setEncoderConfiguration"),yn.prototype),wn(yn.prototype,"getStats",[zG],Object.getOwnPropertyDescriptor(yn.prototype,"getStats"),yn.prototype),wn(yn.prototype,"setBeautyEffect",[HG,KG],Object.getOwnPropertyDescriptor(yn.prototype,"setBeautyEffect"),yn.prototype),wn(yn.prototype,"getCurrentFrameData",[qG],Object.getOwnPropertyDescriptor(yn.prototype,"getCurrentFrameData"),yn.prototype),wn(yn.prototype,"getCurrentFrameImage",[$G],Object.getOwnPropertyDescriptor(yn.prototype,"getCurrentFrameImage"),yn.prototype),wn(yn.prototype,"setBitrateLimit",[YG],Object.getOwnPropertyDescriptor(yn.prototype,"setBitrateLimit"),yn.prototype),wn(yn.prototype,"setOptimizationMode",[XG],Object.getOwnPropertyDescriptor(yn.prototype,"setOptimizationMode"),yn.prototype),wn(yn.prototype,"setScalabiltyMode",[JG],Object.getOwnPropertyDescriptor(yn.prototype,"setScalabiltyMode"),yn.prototype),wn(yn.prototype,"updateMediaStreamTrackResolution",[QG],Object.getOwnPropertyDescriptor(yn.prototype,"updateMediaStreamTrackResolution"),yn.prototype),wn(yn.prototype,"pipe",[ZG],Object.getOwnPropertyDescriptor(yn.prototype,"pipe"),yn.prototype),wn(yn.prototype,"unpipe",[ez],Object.getOwnPropertyDescriptor(yn.prototype,"unpipe"),yn.prototype),wn(yn.prototype,"close",[tz],Object.getOwnPropertyDescriptor(yn.prototype,"close"),yn.prototype),wn(yn.prototype,"replaceTrack",[nz],Object.getOwnPropertyDescriptor(yn.prototype,"replaceTrack"),yn.prototype),yn),NL=(rz=At({argsMap:(e,n)=>[e.getTrackId(),n]}),iz=$r(),sz=Yy("CameraVideoTrack","_enabledMutex"),oz=At({argsMap:(e,n)=>[e.getTrackId(),n]}),az=$r(),cz=At({argsMap:(e,n)=>[e.getTrackId(),n]}),lz=$r(),uz=At({argsMap:e=>[e.getTrackId()]}),Cc=class jie extends hr{get __className__(){return"CameraVideoTrack"}constructor(n,i,o,c,u,h){super(n,Hd(i.encoderConfig),c,u,h),Te(this,"_config",void 0),Te(this,"_originalConstraints",void 0),Te(this,"_constraints",void 0),Te(this,"_enabled",!0),Te(this,"_deviceName","default"),Te(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(Ky()||X1())&&!function(){const m=Tn();if(m.os!==Ai.IOS||!m.osVersion)return!1;const _=m.osVersion.split(".");return Number(_[0])===15&&Number(_[1])>=2}()&&F6()&&this._enabled&&!this._isClosed&&(k.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=i,this._originalConstraints=o,this._constraints=o,this._deviceName=n.label,this._encoderConfig=Hd(this._config.encoderConfig),$n.on(Xi.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),$n.on(Xi.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(n){return typeof n=="string"?this._setDeviceById(n):n.deviceId?this._setDeviceById(n.deviceId):n.facingMode?this._setDeviceByFacingModel(n.facingMode):void 0}async _setDeviceById(n){if(k.info("[".concat(this.getTrackId(),"] set device to ").concat(n)),this._enabled)try{const i=await wc.getDeviceById(n),o={};o.video=Sr({},this._constraints),o.video.deviceId={exact:n},o.video.facingMode=void 0,this._originMediaStreamTrack.stop();let c=null;try{c=await bc(o,this.getTrackId())}catch(u){throw k.error("[".concat(this.getTrackId(),"] setDevice failed"),u.toString()),c=await bc({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1),u}await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=i.label,this._config.cameraId=n,this._constraints.deviceId={exact:n}}catch(i){throw k.error("[".concat(this.getTrackId(),"] setDevice error"),i.toString()),i}else try{const i=await wc.getDeviceById(n);this._deviceName=i.label,this._config.cameraId=n,this._constraints.deviceId={exact:n}}catch(i){throw k.error("[".concat(this.getTrackId(),"] setDevice error"),i.toString()),i}k.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(n){k.info("[".concat(this.getTrackId(),"] set facingMode ").concat(n));const i={video:Sr(Sr({},this._constraints),{},{deviceId:void 0,facingMode:{exact:n}})};if(this._enabled){this._originMediaStreamTrack.stop();let o=null;try{o=await bc(i,this.getTrackId())}catch(c){throw k.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),c.toString()),o=await bc({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1),c}await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=n,this._config.cameraId=void 0,this._constraints=Sr({},i.video),k.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(n,i){if(!i){if(n===this._enabled)return;this.stateCheck("enabled",n)}if(k.info("[".concat(this.getTrackId(),"] start setEnabled"),n),n){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const o=await bc({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1)}await nr(this,ut.NEED_ENABLE_TRACK,this)}catch(o){throw k.error("[".concat(this.getTrackId(),"] setEnabled true error"),o.toString()),o}this.updateMediaStreamTrackResolution(),k.info("[".concat(this.getTrackId(),"] setEnabled to true success")),i||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),i||(this._enabled=!1);try{await nr(this,ut.NEED_DISABLE_TRACK,this)}catch(o){throw k.error("[".concat(this.getTrackId(),"] setEnabled to false error"),o.toString()),o}k.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(n,i){if(!this._enabled)throw new Ce(Y.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");n=Hd(n),this._forceBitrateLimit&&(n.bitrateMax=this._forceBitrateLimit.max_bitrate||n.bitrateMax,n.bitrateMin=this._forceBitrateLimit.min_bitrate||n.bitrateMin);const o=Dr(this._config);o.encoderConfig=n;const c=fA(o);(ls()||co()||Gl())&&(c.deviceId=void 0),k.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(n),JSON.stringify(c));try{await this._originMediaStreamTrack.applyConstraints(c),this.updateMediaStreamTrackResolution()}catch(u){const h=new Ce(Y.UNEXPECTED_ERROR,u.toString());throw k.error("[".concat(this.getTrackId(),"] applyConstraints error"),h.toString()),h}this._config=o,this._constraints=c,this._originalConstraints=c,this._encoderConfig=n,this._hints.indexOf(ir.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await nr(this,ut.NEED_UPDATE_VIDEO_ENCODER,this)}catch(u){return u.throw(k)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((co()||Gl())&&this._enabled&&!this._isClosed&&$n.duringInterruption){const n=async()=>{$n.off(Xi.IOS_INTERRUPTION_END,n),this._enabled&&!this._isClosed&&(k.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};$n.on(Xi.IOS_INTERRUPTION_END,n)}else k.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(tv.TRACK_ENDED)}async renewMediaStreamTrack(n){const i=n||this._constraints,o=wc.searchDeviceIdByName(this._deviceName);if(o&&!i.deviceId&&(i.deviceId={exact:o}),this._enabled){const c=await bc({video:i},this.getTrackId());this._constraints=i,await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),$n.off(Xi.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),$n.off(Xi.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(n){let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],o=this._encoderConfig;n&&(o=Sr(Sr({},o),Hd(n))),o=Jg(o);const c=rr(8,"track-cam-cloned-"),u=new jie(i?this._mediaStreamTrack.clone():this._mediaStreamTrack,Jg(Sr(Sr({},this._config),{},{encoderConfig:o})),Jg(this._constraints),Jg(this._scalabilityMode),this._optimizationMode,c);return n&&o&&u.setEncoderConfiguration(o),k.debug("clone track from ".concat(this.getTrackId()," to ").concat(c,", clone ").concat(i)),u}bindProcessorContextEvents(){this.processorContext.on(Sc.REQUEST_UPDATE_CONSTRAINTS,async(n,i,o)=>{try{const c=Object.assign({},this._originalConstraints,...n);await this.renewMediaStreamTrack(c),i()}catch(c){o(c)}}),this.processorContext.on(Sc.REQUEST_CONSTRAINTS,async n=>{n(this._originMediaStreamTrack.getSettings())})}},wn(Cc.prototype,"setDevice",[rz,iz],Object.getOwnPropertyDescriptor(Cc.prototype,"setDevice"),Cc.prototype),wn(Cc.prototype,"setEnabled",[sz,oz,az],Object.getOwnPropertyDescriptor(Cc.prototype,"setEnabled"),Cc.prototype),wn(Cc.prototype,"setEncoderConfiguration",[cz,lz],Object.getOwnPropertyDescriptor(Cc.prototype,"setEncoderConfiguration"),Cc.prototype),wn(Cc.prototype,"close",[uz],Object.getOwnPropertyDescriptor(Cc.prototype,"close"),Cc.prototype),Cc);function kL(e,n,i,o){i.optimizationMode&&(o&&o.width&&o.height?(i.encoderConfig=Sr(Sr({},o),{},{bitrateMin:o.bitrateMin,bitrateMax:o.bitrateMax}),i.optimizationMode!=="motion"&&i.optimizationMode!=="detail"||(n.contentHint=i.optimizationMode,n.contentHint===i.optimizationMode?k.debug("[".concat(e,"] set content hint to"),i.optimizationMode):k.debug("[".concat(e,"] set content hint failed")))):k.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}var dz,hz,fz,pz,rl,mz,gz,_z,Ez,yz,vz,Hs;class Sz extends IW{getUserId(){return this._userId}constructor(n,i,o,c){super(n,"track-".concat(n.kind,"-").concat(i,"-").concat(c.clientId,"_").concat(rr(5,""))),Te(this,"_userId",void 0),Te(this,"_uintId",void 0),Te(this,"_isDestroyed",!1),Te(this,"store",void 0),Te(this,"processor",void 0),Te(this,"processorContext",void 0),this._userId=i,this._uintId=o,this.store=c}_updateOriginMediaStreamTrack(n){this._originMediaStreamTrack=n,this._mediaStreamTrack=n,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,k.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let av=(dz=At({argsMap:(e,n,i)=>[e.getTrackId(),typeof n=="string"?n:n instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",i]}),hz=At({argsMap:e=>[e.getTrackId()]}),fz=At({argsMap:(e,n)=>[e.getTrackId(),n.name]}),pz=At({argsMap:e=>[e.getTrackId()]}),wn((rl=class extends Sz{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==zs.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(e,n,i,o){super(e,n,i,o),Te(this,"_videoVisibleTimer",null),Te(this,"_previousVideoVisibleStatus",void 0),Te(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),Te(this,"trackMediaType",rv.VIDEO),Te(this,"_videoWidth",void 0),Te(this,"_videoHeight",void 0),Te(this,"_player",void 0),Te(this,"processorDestination",void 0),Te(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new FW(this.getTrackId(),"remote"),this.processorDestination=new VW(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return Jp(()=>{k.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),_c(this,ut.GET_STATS)||Sr({},RW)}play(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof e=="string"){const o=document.getElementById(e);o?e=o:(k.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}k.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(n));const i=Sr(Sr({fit:"cover"},n),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(i):(e instanceof HTMLVideoElement?this._player=new PL(i):this._player=new kG(i),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(nv.FIRST_FRAME_DECODED)},this._player.onVideoStateChanged=o=>{this.safeEmit(nv.VIDEO_STATE_CHANGED,o)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const o=this.getVideoElementVisibleStatus();this.safeEmit(nv.VIDEO_ELEMENT_VISIBLE_STATUS,o)}catch{}},Z("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,k.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){WW(this._originMediaStreamTrack).then(e=>{let[n,i]=e;this._videoHeight=i,this._videoWidth=n}).catch(nA)}_updatePlayerSource(){k.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var e,n;const i=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),o={track:this,element:this==null||(n=this._player)===null||n===void 0?void 0:n.getVideoElement(),slot:i==null?void 0:i.parentElement},{element:c,slot:u}=o;if(this.isPlaying&&c instanceof HTMLVideoElement&&u instanceof HTMLElement){const h=G6.checkOneElementVisible(c),m=Object.assign({},h);if(m.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=m.visible;const _=yt.reportApiInvoke(null,{tag:kr.TRACER,name:fi.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});m.visible?_.onSuccess("Video is visible"):_.onSuccess("Invisible because of ".concat(m.reason))}return m}return}catch(i){throw new Ce(Y.GET_VIDEO_ELEMENT_VISIBLE_ERROR,i.message)}}pipe(e){if(this.processor===e)return e;if(e._source)throw new Ce(Y.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(lo.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(lo.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(e){this.emit(t_.SEI_RECEIVED,e)}}).prototype,"play",[dz],Object.getOwnPropertyDescriptor(rl.prototype,"play"),rl.prototype),wn(rl.prototype,"stop",[hz],Object.getOwnPropertyDescriptor(rl.prototype,"stop"),rl.prototype),wn(rl.prototype,"pipe",[fz],Object.getOwnPropertyDescriptor(rl.prototype,"pipe"),rl.prototype),wn(rl.prototype,"unpipe",[pz],Object.getOwnPropertyDescriptor(rl.prototype,"unpipe"),rl.prototype),rl),cv=(mz=At({argsMap:(e,n)=>[e.getTrackId(),n],throttleTime:300}),gz=At({argsMap:(e,n)=>[e.getTrackId(),n]}),_z=At({argsMap:e=>[e.getTrackId()]}),Ez=At({argsMap:e=>[e.getTrackId()]}),yz=At({argsMap:(e,n)=>[e.getTrackId(),n.name]}),vz=At({argsMap:e=>[e.getTrackId()]}),wn((Hs=class extends Sz{get isPlaying(){return this._useAudioElement?Uo.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(e,n,i,o){super(e,n,i,o),Te(this,"trackMediaType",rv.AUDIO),Te(this,"_source",void 0),Te(this,"_useAudioElement",!0),Te(this,"_volume",100),Te(this,"processorContext",void 0),Te(this,"processorDestination",void 0),Te(this,"_played",!1),Te(this,"_bypassWebAudio",!1),Z("DISABLE_WEBAUDIO")?(this._source=new AL,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new NW(e,!0),Z("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(vc.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(nv.FIRST_FRAME_DECODED)}),this.processorContext=new BW(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new jW(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(vc.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(vc.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(n),this._source.removeAllListeners(vc.ON_AUDIO_BUFFER),this._source.on(vc.ON_AUDIO_BUFFER,i=>e(i))}setVolume(e){this._volume=e,this._useAudioElement?Uo.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)}async setPlaybackDevice(e){if(!this._useAudioElement||!SW())throw new Ce(Y.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Uo.setSinkID(this.getTrackId(),e)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return Jp(()=>{k.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),_c(this,ut.GET_STATS)||Sr({},wW)}play(){k.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(k.debug("[".concat(this.getTrackId(),"] use audio element to play")),Uo.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){k.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?Uo.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];k.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Uo.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(e){if(this._bypassWebAudio)throw new Ce(Y.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new Ce(Y.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(this._bypassWebAudio)throw new Ce(Y.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const n=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,n.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(lo.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(lo.ON_NODE,e=>{this._source.processedNode=e;const n=!e;this._useAudioElement!==n&&(this._played?(this.stop(),this._useAudioElement=n,this.play()):this._useAudioElement=n)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(lo.ON_TRACK),this.processorDestination.removeAllListeners(lo.ON_NODE)}}).prototype,"setVolume",[mz],Object.getOwnPropertyDescriptor(Hs.prototype,"setVolume"),Hs.prototype),wn(Hs.prototype,"setPlaybackDevice",[gz],Object.getOwnPropertyDescriptor(Hs.prototype,"setPlaybackDevice"),Hs.prototype),wn(Hs.prototype,"play",[_z],Object.getOwnPropertyDescriptor(Hs.prototype,"play"),Hs.prototype),wn(Hs.prototype,"stop",[Ez],Object.getOwnPropertyDescriptor(Hs.prototype,"stop"),Hs.prototype),wn(Hs.prototype,"pipe",[yz],Object.getOwnPropertyDescriptor(Hs.prototype,"pipe"),Hs.prototype),wn(Hs.prototype,"unpipe",[vz],Object.getOwnPropertyDescriptor(Hs.prototype,"unpipe"),Hs.prototype),Hs);const Cf=new class extends Rr{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),Te(this,"_lastHiddenTime",0),Te(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),k.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};class Tz extends Rr{constructor(n,i){super(),Te(this,"trackMediaType",rv.DATA),Te(this,"_version",1),Te(this,"_type",3),Te(this,"_config",void 0),Te(this,"_originDataChannel",void 0),Te(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),Te(this,"_dataStreamPacketHandler",{serialize:o=>o,deserialize:o=>o}),Te(this,"_datachannelEventMap",new Map),this._config=n,i&&(this._originDataChannel=i,this._bandDataChannelEvents(i)),this._initPacketHeader()}useDataStream(n){this._dataStreamPacketHandler=n}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return Z("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var n,i;return(n=(i=this._originDataChannel)===null||i===void 0?void 0:i.readyState)!==null&&n!==void 0?n:"connecting"}get _originDataChannelId(){var n,i;return(n=(i=this._originDataChannel)===null||i===void 0?void 0:i.id)!==null&&n!==void 0?n:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new tt((n,i)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&n();const o=setTimeout(()=>{var c;i(new Ce(Y.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((c=this._originDataChannel)===null||c===void 0?void 0:c.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(o),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),n()},this._originDataChannel.onerror=()=>{throw clearTimeout(o),new Ce(Y.DATACHANNEL_CONNECTION_TIMEOUT)}}else i(new Ce(Y.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(n){this._originDataChannel=n,this._bandDataChannelEvents(n)}_initPacketHeader(){const n=new DataView(this._dataStreamPacketHeader);n.setUint16(0,this._version),n.setUint8(2,this._type),n.setUint8(3,this._config.id)}_bandDataChannelEvents(n){this._unbindDataChannelEvents(n),[dA.OPEN,dA.CLOSE,dA.ERROR].forEach(i=>{const o=()=>{this.emit(i)};this._datachannelEventMap.set(i,o),n.addEventListener(i,o)})}_unbindDataChannelEvents(n){Array.from(this._datachannelEventMap.entries()).forEach(i=>{let[o,c]=i;n.removeEventListener(o,c)}),this._datachannelEventMap.clear()}}class tfe extends Tz{constructor(n){super(n),Te(this,"_messageListener",void 0),this._messageListener=i=>{if(i.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const o=i.data.slice(0,this._dataStreamPacketHeader.byteLength),c=new DataView(o).getUint8(3);if(c!==this.id)return void(Z("SHOW_DATASTREAM2_LOG")&&k.debug("invalid datachannel id: ".concat(c," !== ").concat(this.id)));let u=i.data.slice(this._dataStreamPacketHeader.byteLength);u=this._dataStreamPacketHandler.deserialize(u),this.emit(dA.MESSAGE,u)}}_updateOriginDataChannel(n){super._updateOriginDataChannel(n),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class nfe extends Tz{send(n){if(this._originDataChannel){let i=n;i=this._dataStreamPacketHandler.serialize(n);const o=new Uint8Array(this._dataStreamPacketHeader.byteLength+i.byteLength);o.set(new Uint8Array(this._dataStreamPacketHeader),0),o.set(new Uint8Array(i),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(o.buffer)}}}function mA(){const e=new Blob([atob("ZnVuY3Rpb24gdCh0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLG89W10scj0wO2Zvcig7by5sZW5ndGg8bjspciszPG4mJjA9PT1hW3JdJiYwPT09YVtyKzFdJiYzPT09YVtyKzJdJiYoMD09PWFbciszXXx8MT09PWFbciszXXx8Mj09PWFbciszXXx8Mz09PWFbciszXSk/KG8ucHVzaChhW3JdLGFbcisxXSxhW3IrM10pLHIrPTQpOihvLnB1c2goYVtyXSkscisrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobyl9ZnVuY3Rpb24gZSh0LGUpe2NvbnN0IG49ZnVuY3Rpb24odCl7Y29uc3QgZT10Lmxlbmd0aDtsZXQgbj1bXSxhPTA7Zm9yKDthPGU7KWErMjxlJiYwPT09dFthXSYmMD09PXRbYSsxXSYmKDA9PT10W2ErMl18fDE9PT10W2ErMl18fDI9PT10W2ErMl18fDM9PT10W2ErMl0pPyhuLnB1c2godFthXSx0W2ErMV0sMyx0W2ErMl0pLGErPTMpOihuLnB1c2godFthXSksYSsrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobil9KGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxyPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNitvKzErYSt0LmJ5dGVMZW5ndGgpO3NbMF09MCxzWzFdPTAsc1syXT0wLHNbM109MSxzWzRdPTYsc1s1XT0xMDE7bGV0IGk9MDtmb3IoO2k8bzspc1s2K2ldPTI1NSxpKys7cmV0dXJuIHNbNitpXT1yLGkrKyxzLnNldChuLDYraSkscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNitpK2EpLHMuYnVmZmVyfWNvbnN0IG49NzEsYT0xLG89MixyPTEscz0yO3ZhciBpOyFmdW5jdGlvbih0KXt0W3QuQVVESU9fTEVWRUw9MV09IkFVRElPX0xFVkVMIix0W3QuTUVUQURBVEE9Ml09Ik1FVEFEQVRBIix0W3QuQVVESU9fNjRfQklUX1BUUz0zXT0iQVVESU9fNjRfQklUX1BUUyJ9KGl8fChpPXt9KSk7bmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJTYWZhcmkiKT4tMSYmLTE9PT1uYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoIkNocm9tZSIpJiYoc2VsZi5vbnJ0Y3RyYW5zZm9ybT1mPT57Y29uc3QgdT1mLnRyYW5zZm9ybWVyO2xldCBkPVtdLGw9W107dS5vcHRpb25zLnBvcnQub25tZXNzYWdlPXQ9Pnt0LmRhdGEuc2VpJiZkLnB1c2godC5kYXRhLnNlaSksdC5kYXRhLm1ldGFkYXRhJiZsLnB1c2godC5kYXRhLm1ldGFkYXRhKX0sc2VsZi5wb3N0TWVzc2FnZSgic3RhcnRlZCIpO2NvbnN0IGc9dS5yZWFkYWJsZS5nZXRSZWFkZXIoKSxjPXUud3JpdGFibGUuZ2V0V3JpdGVyKCk7InNlaS1yeCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiBlKG4pe2cucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IGU9ZnVuY3Rpb24oZSl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcoZS5kYXRhKTtsZXQgYT0wO2Zvcig7YSs0PGUuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PW4uZ2V0VWludDgoYSswKSYmMD09PW4uZ2V0VWludDgoYSsxKSYmMD09PW4uZ2V0VWludDgoYSsyKSYmMT09PW4uZ2V0VWludDgoYSszKSYmNj09PW4uZ2V0VWludDgoYSs0KSl7bGV0IG89YSs2LHI9MCxzPTA7Zm9yKDsyNTU9PT0ocz1uLmdldFVpbnQ4KG8rKykpOylyKz0yNTU7cis9cztjb25zdCBpPXQoZS5kYXRhLG8scik7cmV0dXJuIG5ldyBVaW50OEFycmF5KGkpfWErK31yZXR1cm4gbnVsbH0oYS52YWx1ZSk7ZSYmbi5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3NlaTplfSl9Yy53cml0ZShhLnZhbHVlKSxuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSxlKG4pfX0pKX0odSk6InNlaS10eCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KG4pe2cucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IHQ9ZC5zaGlmdCgpO3QmJihhLnZhbHVlLmRhdGE9ZShhLnZhbHVlLmRhdGEsdCkpfWMud3JpdGUoYS52YWx1ZSksbi5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3RyYW5zZm9ybWVkOiEwfSksdChuKX19KSl9KHUpOiJhdWRpby1tZXRhZGF0YS1yeCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KGUpe2cucmVhZCgpLnRoZW4oKGY9PntpZighZi5kb25lKXtpZihmLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZEF1ZGlvRnJhbWUpe2NvbnN0IHQ9ZnVuY3Rpb24odCxlPSExKXtjb25zdCBmPXQuZ2V0VWludDgoMCk7aWYoZiE9PW4pcmV0dXJuO2NvbnN0IHU9dC5nZXRVaW50MTYoMSksZD1hK28rdSxsPW5ldyBVaW50OEFycmF5KHQuYnl0ZUxlbmd0aC1kKTtsLnNldChuZXcgVWludDhBcnJheSh0LmJ1ZmZlcixkLHQuYnl0ZUxlbmd0aC1kKSk7Y29uc3QgZz17bTpmLHRsdkxlbjp1LHRsdjpbXSxmcmFtZTpsfTtsZXQgYz1hK287Zm9yKDtjPGQ7KXtjb25zdCBuPXQuZ2V0VWludDgoYyksYT10LmdldFVpbnQxNihjK3IpLG89citzO2lmKG49PT1pLkFVRElPX0xFVkVMKXtsZXQgcj10LmdldFVpbnQ4KGMrbyk7Zm9yKGxldCBlPTE7ZTxhO2UrKylyPXI8PDh8dC5nZXRVaW50OChjK28rZSk7Zy50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZT8xMjdecj4+MToxMjcmcn0pfWVsc2UgaWYobj09PWkuTUVUQURBVEF8fG49PT1pLkFVRElPXzY0X0JJVF9QVFMpe2NvbnN0IGU9bmV3IFVpbnQ4QXJyYXkoYSk7Zm9yKGxldCBuPTA7bjxhO24rKyllW25dPXQuZ2V0VWludDgoYytvK24pO2cudGx2LnB1c2goe3RhZzpuLGxlbmd0aDphLHZhbHVlOmV9KX1jKz1vK2F9cmV0dXJuIGd9KG5ldyBEYXRhVmlldyhmLnZhbHVlLmRhdGEpKTtpZih0KXtjb25zdCBuPXQudGx2LmZpbmQoKHQ9PnQudGFnPT09aS5NRVRBREFUQXx8dC50YWc9PT1pLkFVRElPXzY0X0JJVF9QVFMpKTtuJiZuLnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe21ldGFkYXRhOm4udmFsdWV9KSxmLnZhbHVlLmRhdGE9dC5mcmFtZS5idWZmZXJ9fWMud3JpdGUoZi52YWx1ZSksZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3RyYW5zZm9ybWVkOiEwfSksdChlKX19KSl9KHUpOiJhdWRpby1tZXRhZGF0YS10eCI9PT11Lm9wdGlvbnMubmFtZSYmZnVuY3Rpb24gdChlKXtnLnJlYWQoKS50aGVuKChmPT57aWYoIWYuZG9uZSl7aWYoZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe2dldE1ldGFkYXRhOiEwfSksZi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRBdWRpb0ZyYW1lKXtjb25zdCB0PWwuc2hpZnQoKTt0JiYoZi52YWx1ZS5kYXRhPWZ1bmN0aW9uKHQsZSxpKXtjb25zdCBmPWkuYnl0ZUxlbmd0aCx1PWYrcitzLGQ9YStvK3UsbD1uZXcgQXJyYXlCdWZmZXIodC5ieXRlTGVuZ3RoK2QpLGc9bmV3IERhdGFWaWV3KGwpO2cuc2V0VWludDgoMCxuKSxnLnNldFVpbnQxNigxLHUpLGcuc2V0VWludDgoMyxlKSxnLnNldFVpbnQxNig0LGYpO2ZvcihsZXQgdD0wO3Q8Zjt0KyspZy5zZXRVaW50OCg2K3QsaVt0XSk7Y29uc3QgYz1uZXcgVWludDhBcnJheShnLmJ1ZmZlcik7cmV0dXJuIGMuc2V0KG5ldyBVaW50OEFycmF5KHQpLGQpLGMuYnVmZmVyfShmLnZhbHVlLmRhdGEsaS5BVURJT182NF9CSVRfUFRTLHQpKX1jLndyaXRlKGYudmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfSh1KX0sc2VsZi5wb3N0TWVzc2FnZSgicmVnaXN0ZXJlZCIpKTsK")],{type:"text/javascript"});return setTimeout(()=>mI.revokeObjectURL(e),0),new Worker(mI.createObjectURL(e))}const bz=71,DL=1,LL=2,xL=1,wz=2;var If=function(e){return e[e.AUDIO_LEVEL=1]="AUDIO_LEVEL",e[e.METADATA=2]="METADATA",e[e.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",e}(If||{});function Rz(e){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const i=e.getUint8(0);if(i!==bz)return;const o=e.getUint16(1),c=DL+LL+o,u=new Uint8Array(e.byteLength-c);u.set(new Uint8Array(e.buffer,c,e.byteLength-c));const h={m:i,tlvLen:o,tlv:[],frame:u};let m=DL+LL;for(;m<c;){const _=e.getUint8(m),y=e.getUint16(m+xL),S=xL+wz;if(_===If.AUDIO_LEVEL){let w=e.getUint8(m+S);for(let I=1;I<y;I++)w=w<<8|e.getUint8(m+S+I);h.tlv.push({tag:_,length:y,value:n?127^w>>1:127&w})}else if(_===If.METADATA||_===If.AUDIO_64_BIT_PTS){const w=new Uint8Array(y);for(let I=0;I<y;I++)w[I]=e.getUint8(m+S+I);h.tlv.push({tag:_,length:y,value:w})}m+=S+y}return h}const gA=new Map,_A=127,i_=1e-10,ML=139/13,EA=new Map;function UL(e,n,i){const o="".concat(e,"-").concat(n,"-").concat(i);let c=0;return EA.has(o)?c=EA.get(o):(c=Math.log(function(h,m){const _=h-m;m<_&&(m=_);let y=1;for(let S=h,w=1;S>m;S--,w++)y=y*S/w;return y}(n,e))+e*Math.log(.5)+(n-e)*Math.log(1-.5)-Math.log(i)+i*e,EA.set(o,c)),c<i_&&(c=i_),c}function Cz(e,n,i){const o=n.length,c=e.length/o;let u=!1;for(let h=0,m=0;h<o;h++){let _=0;for(let y=m+c;m<y;m++)e[m]>i&&_++;n[h]!==_&&(n[h]=_,u=!0)}return u}window.cache=EA;let rfe=0;class Iz{constructor(n){Te(this,"id",void 0),Te(this,"immediates",[]),Te(this,"lastNonSilence",-1),Te(this,"immediateSpeechActivityScore",i_),Te(this,"lastLevelChangedTime",Date.now()),Te(this,"levels",[]),Te(this,"longs",[]),Te(this,"longSpeechActivityScore",i_),Te(this,"mediums",[]),Te(this,"mediumSpeechActivityScore",i_),Te(this,"minLevel",0),Te(this,"nextMinLevel",0),Te(this,"nextMinLevelWindowLength",0),Te(this,"energyScore",0),this.id=n||"".concat(rfe++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){const n=this.immediates,i=this.levels,o=this.minLevel+ML;let c=!1;for(let u=0;u<n.length;++u){let h=i[u];h<o&&(h=0);const m=Math.floor(h/ML);n[u]!==m&&(n[u]=m,c=!0)}return c}computeLongs(){return Cz(this.mediums,this.longs,4)}computeMediums(){return Cz(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=UL(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(n){this.longSpeechActivityScore=UL(this.longs[0],10,47),this.longSpeechActivityScore>i_&&(this.lastNonSilence=n)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=UL(this.mediums[0],5,24)}evaluateSpeechActivityScores(n){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(n)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var n;return"[".concat(wp(n=[...this.levels]).call(n).join(),"]")}getSpeechActivityScore(n){switch(n){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+n)}}levelChanged(n,i){if(this.lastLevelChangedTime<=i){this.lastLevelChangedTime=i;let o=n;return n<0&&(o=0),n>_A&&(o=_A),this.levels.unshift(o),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(o),o>=this.minLevel+ML?o:o/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(n){if(n!==0){if(this.minLevel===0||this.minLevel>n)return this.minLevel=n,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(this.nextMinLevel===0)return this.nextMinLevel=n,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>n&&(this.nextMinLevel=n),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let i=Math.sqrt(this.minLevel*this.nextMinLevel);i<0?i=0:i>_A&&(i=_A),this.minLevel=i,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class ife{constructor(n){Te(this,"algorithm",void 0),this.algorithm=n}execute(){let n=!this.algorithm;if(!n)try{const i=this.algorithm.runInDecisionMaker(this);i<=0?n=!0:setTimeout(this.execute.bind(this),i)}catch{n=!0}n&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class VL{constructor(n,i,o){Te(this,"isDominant",void 0),Te(this,"energyRanking",void 0),Te(this,"energyScore",void 0),this.isDominant=n,this.energyRanking=i,this.energyScore=o}}class sfe extends Rr{constructor(n){super(),Te(this,"dominantId",null),Te(this,"lastDecisionTime",0),Te(this,"lastLevelChangedTime",0),Te(this,"lastLevelIdleTime",0),Te(this,"relativeSpeechActivities",[]),Te(this,"speakers",new Map),Te(this,"enableSilence",!1),Te(this,"timeoutToSilenceInterval",0),Te(this,"decisionMaker",null),Te(this,"loudest",[]),Te(this,"numLoudestToTrack",3),Te(this,"energyExpireTimeMs",250),Te(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=n,this.enableSilence=n>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3,i=arguments.length>1?arguments[1]:void 0,o=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=n,i!=null&&(this.energyExpireTimeMs=i),o!=null&&(this.energyAlphaPct=o),this.loudest.length>n&&this.loudest.splice(n)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(n){return this.loudest.some(i=>i.id===n)}levelChanged(n,i){const o=Date.now(),c=this.getOrCreateSpeaker(n);this.lastLevelChangedTime<o&&(this.lastLevelChangedTime=o,this.maybeStartDecisionMaker());const u=c.levelChanged(i,o);return this.updateLoudestList(c,u,o)}runInDecisionMaker(n){return this.decisionMaker!==n||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(n){this.decisionMaker===n&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(n){n.forEach(i=>{this.speakers.has(i.id)||this.speakers.set(i.id,i)})}removeSpeakers(n){n.forEach(i=>{this.speakers.delete(i.id)})}getOrCreateSpeaker(n){let i=this.speakers.get(n);return i||(i=new Iz(n),this.speakers.set(n,i),this.maybeStartDecisionMaker()),i}updateLoudestList(n,i,o){const c=n.id===this.dominantId;if(i<0){let _=0;for(;_<this.loudest.length&&this.loudest[_]!==n;)++_;return new VL(c,_,n.energyScore)}if(n.energyScore=Math.floor((this.energyAlphaPct*i+(100-this.energyAlphaPct)*n.energyScore+50)/100),this.numLoudestToTrack===0)return new VL(c,0,n.energyScore);const u=o-this.energyExpireTimeMs;let h=0;for(;h<this.loudest.length;){const _=this.loudest[h];if(_.getLastLevelChangedTime()<u&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(h,1);else if(_.id!==n.id)++h;else if(this.loudest.splice(h,1),this.loudest.length<this.numLoudestToTrack)break}let m=0;for(;m<this.loudest.length&&!(this.loudest[m].energyScore<n.energyScore);)++m;return m<this.numLoudestToTrack&&(this.loudest.splice(m,0,n),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new VL(c,m,n.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new ife(this),this.decisionMaker.execute())}makeDecision(n){let i=null,o=null;const c=this.speakers.size;let u=null;if(c===0)u=null;else if(c===1){var h;const m=mc(h=this.speakers).call(h).next().value;this.enableSilence&&m&&(u=m.id,m.evaluateSpeechActivityScores(n),n-m.lastNonSilence>this.timeoutToSilenceInterval&&(u=null))}else{let m=this.dominantId==null?null:this.speakers.get(this.dominantId);if(m==null){const S=this.speakers.entries().next();S.value&&(u=S.value[0],m=S.value[1])}else u=m.id;m!=null&&m.evaluateSpeechActivityScores(n);const _=this.relativeSpeechActivities;let y=2;for(const S of this.speakers.entries()){const[w,I]=S;if(I===m)continue;I.evaluateSpeechActivityScores(n);for(let U=0;U<_.length;++U){const q=m==null?i_:m.getSpeechActivityScore(U);_[U]=Math.log(I.getSpeechActivityScore(U)/q)}const P=_[0],B=_[1],M=_[2];P>3&&B>2&&M>0&&B>y&&(y=B,u=w)}this.enableSilence&&m!=null&&u===m.id&&n-m.lastNonSilence>this.timeoutToSilenceInterval&&(u=null)}u==null&&!this.enableSilence||u===this.dominantId||(i=this.dominantId,this.dominantId=u,o=this.dominantId),o==null&&!this.enableSilence||o===i||this.emit("ActiveSpeakerChanged",o)}_runInDecisionMaker(){const n=Date.now(),i=300-(n-this.lastLevelIdleTime);let o=0;i<=0?(this.lastLevelIdleTime!==0&&this.timeoutIdleLevels(n),this.lastLevelIdleTime=n):o=i;let c=300-(n-this.lastDecisionTime);return c<=0&&(this.lastDecisionTime=n,this.makeDecision(n),c=300-(Date.now()-n)),c>0&&o>c&&(o=c),o}timeoutIdleLevels(n){const i=[];for(const c of mc(o=this.speakers).call(o)){var o;const u=n-c.getLastLevelChangedTime();36e5<u&&(this.dominantId==null||c.id!==this.dominantId)?i.push(c.id):300<u&&c.levelTimedOut()}i.forEach(c=>this.speakers.delete(c))}}const lv=new Map;let Yu=null,yA=null;const Az=3;let s_=[];const Xu=new Map,vA=new Map;class ofe{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(n,i){Te(this,"id",void 0),Te(this,"track",void 0),Te(this,"score",0),Te(this,"active",!0),Te(this,"muted",!1),Te(this,"timer",0),Te(this,"actives",0),Te(this,"inactives",0),this.id=n,this.track=i,this.setActive(Xu.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){const n=this.active;this.active=this.activeRate>=.8;const{actives:i,inactives:o}=function(){const c=[],u=[];return Array.from(mc(Xu).call(Xu)).forEach(h=>{h.active?c.push(h):u.push(h)}),{actives:c,inactives:u}}();if(i.length>3){let c;i.forEach(u=>{(!c||c.score>u.score)&&(c=u)}),c&&c.setActive(!1)}if(i.length<3&&o.length>0){let c;o.forEach(u=>{(!c||c.score<u.score)&&u.id!==this.id&&(c=u)}),c&&n&&!this.active&&(c.samples>40&&c.activeRate-this.activeRate>.4?c.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(n){this.active=n,this.resetTimer(),this.setMuted(!n)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){const n=function(i){let o;return Array.from(mc(Xu).call(Xu)).forEach(c=>{!c.active||c.id===i||c.samples<40||(!o||c.score<o.score)&&(o=c)}),o}(this.id);n&&this.activeRate-n.activeRate>.4&&(n.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){const n=function(i){let o;return Array.from(mc(Xu).call(Xu)).forEach(c=>{c.active||c.id===i||c.samples<40||(!o||c.score>o.score)&&(o=c)}),o}(this.id);n&&n.activeRate-this.activeRate>.4&&(n.setActive(!0),this.setActive(!1))}addSample(n){n?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()}setMuted(n){this.track&&(this.track.enabled=!n,this.muted=n)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout(()=>{if(this.samples!==0)return this.samples<50?this.resetTimer():void this.autoCheckActive()},1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let SA;function Oz(e){const n=Xu.get(e);n&&(Xu.delete(e),n.clearTimer())}const TA=new Map,afe=new Map;function cfe(e,n,i){let o=new Uint8Array(e,n,i),c=[],u=0;for(;c.length<i;)u+3<i&&o[u]===0&&o[u+1]===0&&o[u+2]===3&&(o[u+3]===0||o[u+3]===1||o[u+3]===2||o[u+3]===3)?(c.push(o[u],o[u+1],o[u+3]),u+=4):(c.push(o[u]),u++);return new Uint8Array(c)}const bA=new Map,j0=new Map;(function(){const e=Tn();Yi.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),Yi.getStreamFromExtension=e.name===Ln.CHROME&&Number(e.version)>34,Yi.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const n=new RTCPeerConnection;let i=!1;try{n.addTransceiver("audio"),i=!0}catch{}return n.close(),i}(),Yi.supportMinBitrate=e.name===Ln.CHROME||e.name===Ln.EDGE,Yi.supportSetRtpSenderParameters=function(){const n=Tn();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!bf()||!(!ls()&&!QI())||n.name===Ln.FIREFOX&&Number(n.version)>=64)}(),e.name===Ln.SAFARI&&(Number(e.version)>=14?Yi.supportDualStream=!0:Yi.supportDualStream=!1),Yi.webAudioMediaStreamDest=function(){const n=Tn();return!(n.name===Ln.SAFARI&&Number(n.version)<12)}(),Yi.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",Yi.supportWebGL=typeof WebGLRenderingContext<"u",Yi.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,bf()||(Yi.webAudioWithAEC=!0),Yi.supportShareAudio=function(){const n=Tn();return(n.os===Ai.WIN_10||n.os===Ai.WIN_81||n.os===Ai.WIN_7||n.os===Ai.LINUX||n.os===Ai.MAC_OS||n.os===Ai.CHROMIUM_OS)&&n.name===Ln.CHROME&&Number(n.version)>=74}(),Yi.supportDataChannel=!!(O0(76)||function(n){const i=Tn();return!(i.name!==Ln.FIREFOX||!i.osVersion)&&Number(i.version)>=n}(68)||L6(14)),Yi.supportPCSetConfiguration=function(){const n=window.RTCPeerConnection;return!Pr()&&!!n&&n.prototype.setConfiguration instanceof Function}(),Yi.supportWebRTCEncodedTransform=function(){const n=Tn();return n.name==="Chrome"&&Number(n.version)>=87||n.name==="Safari"&&Number(n.version)>=15}(),Yi.supportWebRTCInsertableStream=function(){const n=Tn();return(n.name===Ln.CHROME||n.name===Ln.EDGE)&&Number(n.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),Yi.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,Yi.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,tA(()=>{Yi.supportDualStreamEncoding=function(){const n=Tn();return!!Z("DISABLE_WEBAUDIO")||n.name==="Safari"&&Number(n.version)>=14||!!(n.name==="Chrome"&&/Windows/i.test(n.os||"")&&Number(n.version)>=100&&Z("CHROME_DUAL_STREAM_USE_ENCODING"))}(),k.debug("browser ua: ",navigator.userAgent),k.info("browser info: ",e),k.info("browser compatibility: ",Yi)})})();const lfe=["CHINA","GLOBAL"],Pz=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],o_=[],uv=[];function a_(e,n){return!!n&&o_.some(i=>i.uid===e&&i.channelName===n)}function FL(){return uv.length>0}var ufe=Q3.forEach,Nz=Xh("forEach")?[].forEach:function(e){return ufe(this,e,arguments.length>1?arguments[1]:void 0)};Dn({target:"Array",proto:!0,forced:[].forEach!=Nz},{forEach:Nz});var dfe=ka("Array").forEach,hfe=ic,ffe=ui,pfe=N,mfe=dfe,jL=Array.prototype,gfe={DOMTokenList:!0,NodeList:!0},_fe=function(e){var n=e.forEach;return e===jL||pfe(jL,e)&&n===jL.forEach||ffe(gfe,hfe(e))?mfe:n},Efe=l(_fe),yfe=yo,kz=ac;Dn({target:"Object",stat:!0,forced:d(function(){kz(1)})},{keys:function(e){return kz(yfe(e))}});var Dz=l(mt.Object.keys),vfe=l(vE),Sfe=l(TE),Tfe=Dn,Lz=dg,bfe=Lg,wfe=dt,xz=he,Rfe=ti,Cfe=ve,Ife=rI,Afe=ar,Ofe=ss,Pfe=W3("slice"),Nfe=Afe("species"),BL=Array,kfe=Math.max;Tfe({target:"Array",proto:!0,forced:!Pfe},{slice:function(e,n){var i,o,c,u=Cfe(this),h=Rfe(u),m=xz(e,h),_=xz(n===void 0?h:n,h);if(Lz(u)&&(i=u.constructor,(bfe(i)&&(i===BL||Lz(i.prototype))||wfe(i)&&(i=i[Nfe])===null)&&(i=void 0),i===BL||i===void 0))return Ofe(u,m,_);for(o=new(i===void 0?BL:i)(kfe(_-m,0)),c=0;m<_;m++,c++)m in u&&Ife(o,c,u[m]);return o.length=c,o}});var Dfe=ka("Array").slice,Lfe=N,xfe=Dfe,WL=Array.prototype,Mfe=function(e){var n=e.slice;return e===WL||Lfe(WL,e)&&n===WL.slice?xfe:n},Ufe=l(Mfe);function ht(e,n,i,o,c){var u,h,m,_={};return Efe(u=Dz(o)).call(u,function(y){_[y]=o[y]}),_.enumerable=!!_.enumerable,_.configurable=!!_.configurable,("value"in _||_.initializer)&&(_.writable=!0),_=vfe(h=Sfe(m=Ufe(i).call(i)).call(m)).call(h,function(y,S){return S(e,n,y)||y},_),c&&_.initializer!==void 0&&(_.value=_.initializer?_.initializer.call(c):void 0,_.initializer=void 0),_.initializer===void 0&&(V3(e,n,_),_=null),_}let wA=function(e){return e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",e}({}),GL=function(e){return e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR",e}({}),Kl=function(e){return e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",e}({}),uo=function(e){return e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",e[e.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",e}({}),Ct=function(e){return e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",e[e.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",e[e.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",e[e.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",e[e.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",e[e.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",e[e.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",e[e.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",e[e.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",e}({}),or=function(e){return e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed",e}({}),Lt=function(e){return e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.ABORT_P2P_EXECUTION="abort_p2p_execution",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success",e.JOIN_RESPONSE="join_response",e.PRE_CONNECT_PC="pre_connect_pc",e.P2P_CONNECTION="p2p_connection",e.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",e.P2P_SUBSCRIBE="p2p_subscribe",e.P2P_UNSUBSCRIBE="p2p_unsubscribe",e.P2P_EXCHANGE_SDP="p2p_exchange_sdp",e.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",e.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",e.RECOVER_NOTIFICATION="recover_notification",e}({}),Dt=function(e){return e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v3",e.REJOIN="rejoin_v3",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.PUBLISH_DATASTREAM="publish_datastream",e.UNPUBLISH="unpublish",e.UNPUBLISH_DATASTREAM="unpublish_datastream",e.SUBSCRIBE="subscribe",e.PRE_SUBSCRIBE="pre_subscribe",e.SUBSCRIBE_DATASTREAM="subscribe_datastream",e.SUBSCRIBE_STREAMS="subscribe_streams",e.UNSUBSCRIBE="unsubscribe",e.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",e.UNSUBSCRIBE_STREAMS="unsubscribe_streams",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.DEFAULT_VIDEO_STREAM="default_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer",e.RESTART_ICE="restart_ice",e.CONNECT_PC="connect_pc",e.SET_VIDEO_PROFILE="set_video_profile",e.SET_PARAMETER="set_parameter",e.SET_RTM2_FLAG="set_rtm2_flag",e}({}),B0=function(e){return e.WRTC_STATS="wrtc_stats",e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",e.DENOISER_STATS="denoiser_stats",e.EXTENSION_USAGE_STATS="extension_usage_stats",e}({}),ln=function(e){return e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_USER_LICENSE_BANNED="on_user_license_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.ON_P2P_OK="on_p2p_ok",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",e.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",e.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio",e.ON_PUBLISHED_USER_LIST="on_published_user_list",e}({}),ho=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({}),Wt=function(e){return e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls",e.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",e}({});function RA(e){if(typeof e!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e))throw k.error("Invalid Channel Name ".concat(e)),new be(Y.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function CA(e){if(n=e,!(typeof n=="number"&&Math.floor(n)===n&&0<=n&&n<=4294967295||W6(e,1,255)))throw new be(Y.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var n;typeof e=="string"&&k.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let Af=function(e){return e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e}({});const Vfe={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},zL={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function HL(e,n){qi(e.url,"".concat(n,".url"),1,1e3,!1),Nr(e.x)||Jn(e.x,"".concat(n,".x"),0,1e4),Nr(e.y)||Jn(e.y,"".concat(n,".y"),0,1e4),Nr(e.width)||Jn(e.width,"".concat(n,".width"),0,1e4),Nr(e.height)||Jn(e.height,"".concat(n,".height"),0,1e4),Nr(e.zOrder)||Jn(e.zOrder,"".concat(n,".zOrder"),0,255),Nr(e.alpha)||Jn(e.alpha,"".concat(n,".alpha"),0,1,!1)}const Ffe={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let em=function(e){return e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address",e}({}),KL=function(e){return e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",e}({}),vi=function(e){return e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",e}({});function Mz(e){if(!e.channelName)throw new be(Y.INVALID_PARAMS,"invalid channelName in info");if(typeof e.uid!="number")throw new be(Y.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&qi(e.token,"info.token",1,2047),CA(e.uid),RA(e.channelName),!0}let fo=function(e){return e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile",e}({}),Of=function(e){return e.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",e.NETWORK_CONNECTED="NETWORK_CONNECTED",e.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",e.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",e.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",e.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",e.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",e.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",e.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",e}({}),ha=function(e){return e.RELAY_STATE_IDLE="RELAY_STATE_IDLE",e.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",e.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",e.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",e}({}),dv=function(e){return e.RELAY_OK="RELAY_OK",e.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",e.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",e.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",e}({}),jn=function(e){return e.High="high",e.Low="low",e.Audio="audio",e.Screen="screen",e.ScreenLow="screen_low",e}({}),ji=function(e){return e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid",e.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",e.JOIN_RESPONSE="join-response",e.RESET_CONNECTION_EVENTS="reset-connection-events",e.PRE_CONNECT_PC="pre-connect_pc",e.UPDATE_GATEWAY_CONFIG="update-gateway-config",e}({}),IA=function(e){return e.P2P_DISCONNECTED="P2P_DISCONNECTED",e.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",e.TIMEOUT="TIMEOUT",e.UNKNOWN_REASON="UNKNOWN_REASON",e}({}),Pi=function(e){return e[e.Nothing=0]="Nothing",e[e.Audio=1]="Audio",e[e.LwoVideo=2]="LwoVideo",e[e.Video=4]="Video",e[e.Data=8]="Data",e[e.DataStream0=256]="DataStream0",e[e.DataStream1=512]="DataStream1",e[e.DataStream2=1024]="DataStream2",e[e.DataStream3=2048]="DataStream3",e[e.DataStream4=4096]="DataStream4",e[e.DataStream5=8192]="DataStream5",e[e.DataStream6=16384]="DataStream6",e[e.DataStream7=32768]="DataStream7",e}({}),xn=function(e){return e.CHINA="CHINA",e.ASIA="ASIA",e.NORTH_AMERICA="NORTH_AMERICA",e.EUROPE="EUROPE",e.JAPAN="JAPAN",e.INDIA="INDIA",e.KOREA="KOREA",e.HKMC="HKMC",e.US="US",e.OCEANIA="OCEANIA",e.SOUTH_AMERICA="SOUTH_AMERICA",e.AFRICA="AFRICA",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="EXTENSIONS",e}({});const Uz=[xn.AFRICA,xn.ASIA,xn.CHINA,xn.EUROPE,xn.GLOBAL,xn.INDIA,xn.JAPAN,xn.NORTH_AMERICA,xn.OCEANIA,xn.OVERSEA,xn.SOUTH_AMERICA];let ys=function(e){return e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.KOREA="KR",e.HKMC="HK",e.US="US",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="GLOBAL",e}({});const AA={CHINA:{},ASIA:{CODE:ys.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:ys.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:ys.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:ys.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:ys.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:ys.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:ys.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:ys.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:ys.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:ys.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:ys.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:ys.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:ys.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};fL&&(AA.CHINA={CODE:ys.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let W0=function(e){return e.UPDATE_BITRATE_LIMIT="update_bitrate_limit",e.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",e}({});function Vz(e){return!!e&&!(!e.uplink||!e.id)&&e.uplink.max_bitrate!==void 0&&e.uplink.min_bitrate!==void 0}class Fz extends Rr{constructor(n,i){super(),K(this,"onICEConnectionStateChange",void 0),K(this,"onConnectionStateChange",void 0),K(this,"onDTLSTransportStateChange",void 0),K(this,"onDTLSTransportError",void 0),K(this,"onICETransportStateChange",void 0),K(this,"onFirstAudioReceived",void 0),K(this,"onFirstVideoReceived",void 0),K(this,"onFirstAudioDecoded",void 0),K(this,"onFirstVideoDecoded",void 0),K(this,"onFirstVideoDecodedTimeout",void 0),K(this,"onSelectedLocalCandidateChanged",void 0),K(this,"onSelectedRemoteCandidateChanged",void 0),K(this,"onICECandidateError",void 0),K(this,"getLocalVideoStats",void 0)}}class jz extends Fz{constructor(n,i){super(n,i),K(this,"establishPromise",void 0)}}let at=function(e){return e.VIDEO="video",e.AUDIO="audio",e}({}),vs=function(e){return e.UDP_RELAY="udp_relay",e.UDP_TCP_RELAY="udp_tcp_relay",e.TCP_RELAY="tcp_relay",e.RELAY="relay",e}({}),Pf=function(e){return e[e.FIRST_CONNECTION=0]="FIRST_CONNECTION",e[e.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",e[e.RELAY_RESTART=2]="RELAY_RESTART",e[e.TCP_RESTART=3]="TCP_RESTART",e[e.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",e[e.OLD_RESTART=11]="OLD_RESTART",e[e.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",e}({});const Bz=["disconnected","failed"];let Ve=function(e){return e.LocalVideoTrack="videoTrack",e.LocalAudioTrack="audioTrack",e.LocalVideoLowTrack="videoLowTrack",e}({}),Fn=function(e){return e.New="new",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnected="disconnected",e}({}),bt=function(e){return e.AudioMetadata="audioMetadata",e.StateChange="stateChange",e.IceConnectionStateChange="iceConnectionStateChange",e.RequestMuteLocal="requestMuteLocal",e.RequestUnmuteLocal="requestUnmuteLocal",e.RequestRePublish="requestRePublish",e.RequestRePublishDataChannel="requestRePublishDataChannel",e.RequestReSubscribe="requestReSubscribe",e.RequestUploadStats="requestUploadStats",e.RequestUpload="requestUpload",e.MediaReconnectStart="MediaReconnectStart",e.MediaReconnectEnd="MediaReconnectEnd",e.NeedSignalRTT="NeedSignalRTT",e.RequestRestartICE="RequestRestartIce",e.PeerConnectionStateChange="PeerConnectionStateChange",e.RequestReconnect="RequestReconnect",e.RequestReconnectPC="RequestReconnectPC",e.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",e.P2PLost="P2PLost",e.UpdateVideoEncoder="UpdateVideoEncoder",e.ConnectionTypeChange="ConnectionTypeChange",e.RequestLowStreamParameter="RequestLowStreamParameter",e.QueryClientConnectionState="QueryClientConnectionState",e.LocalCandidate="LocalCandidate",e.RequestP2PMuteLocal="requestP2PMuteLocal",e.RequestP2PUnPublish="RequestP2PUnPublish",e.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",e.RequestP2PMuteRemote="RequestP2PMuteRemote",e.RequestP2PRestartICE="RequestP2PRestartICE",e}({}),ql=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),$l=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),Bi=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),Wz=function(e){return e.CONNECTED="transmitter:connected",e.RECONNECTING="transmitter:reconnecting",e.WILL_RECONNECT="transmitter:will_reconnect",e.CLOSED="transmitter:closed",e.FAILED="transmitter:failed",e.ON_MESSAGE="transmitter:on_message",e.REQUEST_NEW_URLS="transmitter:request_new_urls",e.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",e.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",e.FAILBACK="transmitter:failback",e.PRE_CONNECT_PC="transmitter:pre_connect_pc",e}({}),$d=function(e){return e.CAMERA_CHANGED="camera-changed",e.MICROPHONE_CHANGED="microphone-changed",e.PLAYBACK_DEVICE_CHANGED="playback-device-changed",e.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",e.AUTOPLAY_FAILED="autoplay-failed",e.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",e.SECURITY_POLICY_VIOLATION="security-policy-violation",e}({}),il=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),Ju=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),hv=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),Yr=function(e){return e.CALL="call",e.CANDIDATE="candidate",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.CONTROL="control",e.RESTART_ICE="restart_ice",e.ACK="ack",e.RESPONSE="response",e.JOIN="join",e.CHECK="check",e}({}),fv=function(e){return e.ABORT="abort",e}({}),tm=function(e){return e.MUTE_LOCAL_AUDIO="mute_local_audio",e.MUTE_LOCAL_VIDEO="mute_local_video",e.UNMUTE_LOCAL_AUDIO="unmute_local_audio",e.UNMUTE_LOCAL_VIDEO="unmute_local_video",e}({}),jfe=function(e){return e.P2P_TOKEN_TIMEOUT="p2p_token_timeout",e.P2P_TOKEN_CHANGED="p2p_token_changed",e}({});const Bfe={[wA.ACCESS_POINT]:{[uo.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[uo.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[uo.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[uo.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[uo.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[uo.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[uo.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[uo.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[uo.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[uo.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[uo.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[uo.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[uo.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[uo.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[uo.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[uo.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[uo.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[uo.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[wA.UNILBS]:{[Kl.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[Kl.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[Kl.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[Kl.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[Kl.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[Kl.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[Kl.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[Kl.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[Kl.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[Kl.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[Kl.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[Kl.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[wA.STRING_UID_ALLOCATOR]:{[GL.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[GL.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[GL.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function pv(e){const n=Bfe[Math.floor(e/1e4)];if(!n)return{desc:"unknown error",retry:!1};const i=n[e%1e4];if(!i){if(Math.floor(e/1e4)===wA.ACCESS_POINT){const o=e%1e4;if(o.toString()[0]==="1")return{desc:e.toString(),retry:!1};if(o.toString()[0]==="2")return{desc:e.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return i}const Wfe={[Ct.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[Ct.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[Ct.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[Ct.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[Ct.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[Ct.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[Ct.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[Ct.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[Ct.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[Ct.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[Ct.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[Ct.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[Ct.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[Ct.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[Ct.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[Ct.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[Ct.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[Ct.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[Ct.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[Ct.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[Ct.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[Ct.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[Ct.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[Ct.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[Ct.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[Ct.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[Ct.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[Ct.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[Ct.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[Ct.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[Ct.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[Ct.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[Ct.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[Ct.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[Ct.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[Ct.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[Ct.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[Ct.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[Ct.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[Ct.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[Ct.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[Ct.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Ct.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Ct.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[Ct.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[Ct.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[Ct.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[Ct.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[Ct.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[Ct.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[Ct.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[Ct.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[Ct.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[Ct.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[Ct.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[Ct.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[Ct.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[Ct.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[Ct.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[Ct.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[Ct.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[Ct.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[Ct.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[Ct.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function G0(e){return Wfe[e]||{desc:"UNKNOWN_ERROR_".concat(e),action:"failed"}}function Gz(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function qL(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?Gz(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Gz(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function zz(e,n){if(typeof e=="string")return e;const{proxy:i,host:o,port:c}=e;if(n){const u=Z("JOIN_GATEWAY_FALLBACK_PORT")||443;return u===443?"wss://".concat(o,"/ws/?p=").concat(Number(c)+150):"wss://".concat(o,":").concat(u,"/ws/?p=").concat(Number(c)+150)}return i?"wss://".concat(i,"/ws/?h=").concat(o,"&p=").concat(c):"wss://".concat(o,":").concat(c)}const Gfe=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,zfe=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,Hfe=/wss:\/\/(.+):([0-9]+)\/?/,Kfe=/wss:\/\/(.[^\/]+)\/?/;let qfe=0;class $fe{constructor(n,i){K(this,"id",0),K(this,"store",void 0),K(this,"recordIndex",void 0),K(this,"websockets",[]),K(this,"try443PortDuration",2e3),K(this,"forceCloseWSDuration",5e3),K(this,"try443PortTimeout",null),K(this,"forceCloseTimeout",null),K(this,"isTry443PortFailed",!1),K(this,"isNormalPortFailed",!1),K(this,"useDoubleDomain",!1),K(this,"useProxy",!1),K(this,"startTime",Date.now()),this.id=++qfe,this.try443PortDuration=Z("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=n||5e3,this.store=i}closeAllWebsockets(){this.websockets.forEach(n=>{n.onopen=null,n.onclose=null,n.onmessage=null,n.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var n;const i=Date.now()-this.startTime;for(var o=arguments.length,c=new Array(o),u=0;u<o;u++)c[u]=arguments[u];k.debug("[choose-best-ws ".concat((n=this.store)===null||n===void 0?void 0:n.clientId," ").concat(this.id,"] ").concat(i,"ms:"),...c)}createWebSocket(n,i,o){this.logger("createWebSocket:",n,{isTry443Port:i,hasTimeoutDetection:o});const c=Z("GATEWAY_DOMAINS"),u=Date.now(),h=[],m=c.find(I=>{var P;return Xe(P=n.host).call(P,I)});m||(this.useDoubleDomain=!1);const _=[];if(this.useDoubleDomain)c.forEach(I=>{_.push(zz(qL(qL({},n),{},{host:n.host.replace(m,I)}),i))});else{const I=qL({},n);if(i&&m){const P=c.find(B=>B!==m);P&&(I.host=I.host.replace(m,P))}_.push(zz(I,i))}try{_.forEach(I=>{const P=new WebSocket(I);P.binaryType="arraybuffer",h.push(P),this.logger("ws is connecting:",P.url)})}catch(I){if(this.logger("ws create failed"),h.forEach(P=>P.close()),h.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(n,i,o);if(!i&&Number(n.port)!==443)return this.createWebSocket(n,!0,o);throw new be(Y.WS_ERR,"init websocket failed! Error: ".concat(I.toString()))}const y=A0();this.store&&this.store.recordJoinChannelService({urls:h.map(I=>I.url),service:"gateway"},this.recordIndex),h.forEach(I=>{I.onopen=()=>{this.logger("onopen: ws ".concat(I.url," open cost ").concat(Date.now()-u,"ms")),this.websockets.forEach(P=>{P!==I&&(P.onopen=null,P.onclose=null,P.onmessage=null,P.close(),this.logger("close backup websocket: ".concat(P.url)))}),this.websockets.length=0,y.resolve(I)},I.onclose=P=>{this.logger("onclose: ws ".concat(I.url," closed cost ").concat(Date.now()-u,"ms state: ").concat(I.readyState));const B=h.every(M=>M.readyState===WebSocket.CLOSED||M.readyState===WebSocket.CLOSING);this.logger("".concat(i?"443":"47xx"," websocket closed, all failed: ").concat(B)),B&&(i||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(P.reason)),y.reject({code:P.code,reason:IA.A_ROUND_WS_FAILED})):!i&&B&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),w()),i?this.isTry443PortFailed=B:this.isNormalPortFailed=B},I.onmessage=P=>this.logger("".concat(I.url," onmessage: ").concat(P.data))}),this.websockets.push(...h);const S=()=>{this.websockets.forEach(I=>I.readyState!==WebSocket.OPEN&&I.close())},w=()=>{if(y.isResolved)return S();Tn().os===Ai.MAC_OS&&Pr()&&S(),this.createWebSocket(n,!0,!0).then(I=>{y.resolve(I)}).catch(I=>{this.isNormalPortFailed&&y.reject(I),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",y.isResolved),this.forceCloseTimeout=null,S()},this.forceCloseWSDuration)};return o||(()=>{if(i||this.useProxy)return this.logger("add 5s timeout at ".concat(i?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(()=>{this.forceCloseTimeout=null,S()},this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{this.logger("2s timeout, isWebsocket created: ",y.isResolved),this.try443PortTimeout=null,w()},this.try443PortDuration)})(),y.promise}chooseBestWebsocket(n,i,o,c){return this.useDoubleDomain=!!i,typeof n=="string"&&(n=function(u){let h,m,_;return[,h,m,_]=u.match(Gfe)||[],h||([,m,_]=u.match(zfe)||[]),m&&_||([,m,_]=u.match(Hfe)||[]),m&&_||([,m]=u.match(Kfe)||[]),m||k.warning("un-destructible url: ",u),{proxy:h,host:m,port:_||"443"}}(n)),this.recordIndex=c,this.useProxy=!!n.proxy,o&&this.useProxy&&(k.warn("cannot use 443 only when use proxy"),o=!1),this.createWebSocket(n,!!o,!1).finally(()=>this.clearTimeout())}}function Hz(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}class Kz extends Rr{get url(){return this.websocket&&this.websocket.url||null}get reconnectMode(){return this._reconnectMode}set reconnectMode(n){var i;Xe(i=["tryNext","recover"]).call(i,n)&&this.resetReconnectCount(n),this._reconnectMode=n}get state(){return this._state}set state(n){n!==this._state&&(this._state=n,this._state==="reconnecting"?this.emit(Wt.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(Wt.CONNECTED):this._state==="closed"?this.emit(Wt.CLOSED):this._state==="failed"&&this.emit(Wt.FAILED))}resetReconnectCount(n){k.debug("websocket reset reconnect count, reason: "+n),this.reconnectCount=0}constructor(n,i){let o=arguments.length>2&&arguments[2]!==void 0&&arguments[2],c=arguments.length>3&&arguments[3]!==void 0&&arguments[3],u=arguments.length>4&&arguments[4]!==void 0&&arguments[4],h=arguments.length>5?arguments[5]:void 0;super(),K(this,"connectionID",0),K(this,"currentURLIndex",0),K(this,"urls",[]),K(this,"_reconnectMode","tryNext"),K(this,"reconnectReason",void 0),K(this,"_initMutex",void 0),K(this,"name",void 0),K(this,"_state","closed"),K(this,"reconnectInterrupter",void 0),K(this,"websocket",void 0),K(this,"retryConfig",void 0),K(this,"reconnectCount",0),K(this,"forceCloseTimeout",5e3),K(this,"onlineReconnectListener",void 0),K(this,"useCompress",void 0),K(this,"tryDoubleDomain",!1),K(this,"use443PortOnly",!1),K(this,"wsInflateLength",0),K(this,"wsDeflateLength",0),K(this,"closeEstablishingWs",()=>{}),K(this,"store",void 0),K(this,"joinGatewayRecordIndex",void 0),this.store=h,this.name=n,this.retryConfig=function(w){for(var I=1;I<arguments.length;I++){var P=arguments[I]!=null?arguments[I]:{};I%2?Hz(Object(P),!0).forEach(function(B){K(w,B,P[B])}):Object.getOwnPropertyDescriptors?Object.defineProperties(w,Object.getOwnPropertyDescriptors(P)):Hz(Object(P)).forEach(function(B){Object.defineProperty(w,B,Object.getOwnPropertyDescriptor(P,B))})}return w}({},i),this.useCompress=o,this.tryDoubleDomain=c,this.use443PortOnly=u,this._initMutex=new Es("websocket",h?h.clientId:void 0);const{timeout:m,timeoutFactor:_}=i,y=Math.max(300,Math.floor(3*m/5)),S=Math.max(1.2,Math.floor(8*_)/10);ja.ONLINE&&(this.retryConfig.timeout=y,this.retryConfig.timeoutFactor=S),ri.on(qy.NETWORK_STATE_CHANGE,(w,I)=>{w!==I&&(this.resetReconnectCount("network state change: ".concat(I," -> ").concat(w)),w===ja.ONLINE?(this.retryConfig.timeout=y,this.retryConfig.timeoutFactor=S):(this.retryConfig.timeout=m,this.retryConfig.timeoutFactor=_))})}getConnection(){return this.websocket||void 0}async init(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const o=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=i,this.urls=n,this.state="connecting";try{const c=A0(),u=this.urls[this.currentURLIndex];Z("ENABLE_PREALLOC_PC")&&this.emit(Wz.PRE_CONNECT_PC),this.createWebSocketConnection(u).then(c.resolve).catch(c.reject),this.once(Wt.CLOSED,()=>{c.reject(new Ce(Y.WS_DISCONNECT))}),this.once(Wt.CONNECTED,c.resolve),await c.promise}catch{}finally{o()}}close(n,i){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const o=this.websocket;i?setTimeout(()=>o.close(),500):o.close(),this.websocket=void 0}this.state=n?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(n,i){if(!this.websocket)return void k.warning("[".concat(this.name,"] can not reconnect, no websocket"));n!==void 0&&(this.reconnectMode=n),k.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(i)]},this.joinGatewayRecordIndex);const o=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),o&&o.bind(this.websocket)({code:9999,reason:i})}sendMessage(n){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new Ce(Y.WS_ABORT,"websocket is not ready");try{i||(n=JSON.stringify(n)),this.websocket.send(n)}catch(o){throw new Ce(Y.WS_ERR,"send websocket message error"+o.toString())}}setWsInflateData(n){this.wsDeflateLength=this.wsDeflateLength+n.originLength,this.wsInflateLength=this.wsInflateLength+n.compressedLength}getWsInflateData(){const n=this.wsInflateLength,i=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:n,wsDeflateLength:i}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(n){var i;const o=A0();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const c=S=>{var w;(w=this.store)===null||w===void 0||w.signalChannelOpen(),k.debug("[".concat(this.name,"] websocket opened:"),S),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),o.resolve()},u=async S=>{var w;if(k.debug("[".concat(this.name,"] websocket close ").concat((w=this.websocket)===null||w===void 0?void 0:w.url,", code: ").concat(S.code,", reason: ").concat(S.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)o.reject(new Ce(Y.WS_DISCONNECT,"websocket close: ".concat(S.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=S.reason,this.state="reconnecting");const I=_c(this,Wt.WILL_RECONNECT,this.reconnectMode,S.reason)||this.reconnectMode,P=await this.reconnectWithAction(I);if(this.state==="closed")return void k.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!P)return o.reject(new Ce(Y.WS_DISCONNECT,"websocket reconnect failed: ".concat(S.code))),this.close(!0);o.resolve()}},h=S=>{this.emit(Wt.ON_MESSAGE,S)},m=S=>{k.warn("[".concat(this.connectionID,"] ws open error ").concat(S))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),Z("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(n=Z("GATEWAY_WSS_ADDRESS")),k.debug("[".concat(this.name,"] start connect, url:"),n);const _=(i=this.store)===null||i===void 0?void 0:i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var y;const S=await this.chooseBestWebsocketConnection(n);this.websocket=S,c&&c(this.websocket.url),this.websocket.onclose=u,this.websocket.onmessage=h,this.websocket.onerror=m,(y=this.store)===null||y===void 0||y.recordJoinChannelService({endTs:Date.now(),status:"success"},_),this.joinGatewayRecordIndex=_}catch(S){const w=this.state==="closed",I=S instanceof Ce,P=I&&S.code===Y.WS_ABORT,B=I&&S.code===Y.WS_ERR,M=I?S.message:S&&(S.reason||S.toString());k.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(M)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:P?"aborted":"error",errors:[S]},_),w||B?(o.reject(w?new Ce(Y.WS_DISCONNECT,"websocket is closed: ".concat(M)):new Ce(Y.WS_ERR,"init websocket failed: ".concat(M))),B&&k.error("[".concat(this.name,"] init websocket failed: ").concat(M))):u&&u(S)}return o.promise}async reconnectWithAction(n){let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;k.warning("[choose-best-ws] action: =>",n),this.onlineReconnectListener||ri.isOnline||!ri.onlineWaiter||(this.onlineReconnectListener=ri.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let o=!0;if(this.reconnectInterrupter=()=>o=!1,i){const h=sL(this.reconnectCount,this.retryConfig);k.debug("[".concat(this.name,"] wait ").concat(h,"ms to reconnect websocket, mode: ").concat(n)),await tt.race([$i(h),this.onlineReconnectListener||new tt(()=>{})])}if(this._state==="closed"||!o)return!1;this.reconnectCount+=1;const c=async(h,m)=>{this.emit(Wt.RECONNECT_CREATE_CONNECTION,m),await this.createWebSocketConnection(h)};try{if(n==="retry")await c(this.urls[this.currentURLIndex],n);else if(n==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);k.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await c(this.urls[this.currentURLIndex],n)}else n==="recover"&&(k.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await ds(this,Wt.REQUEST_NEW_URLS),this.currentURLIndex=0,await c(this.urls[this.currentURLIndex],n))}catch(h){var u;k.error("[".concat(this.name,"] reconnect failed ").concat(h&&h.toString()));const m=h==null||(u=h.data)===null||u===void 0?void 0:u.desc;return Array.isArray(m)&&Xe(m).call(m,"dynamic key expired")?(this.emit(Wt.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(n,i)}return!0}}class $L extends Kz{constructor(n,i){super(n,i,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(n,i){const o=A0(),c=function(h,m){return new $fe(h,m)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{k.debug("[choose-best-ws] close establishing websockets"),c.closeAllWebsockets(),o.reject(new Ce(Y.WS_ABORT,"choose best websocket aborted"))};const u=Z("GATEWAY_DOMAINS");return k.debug("[choose-best-ws] currentDomain: ",n,", domains: ",u,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),c.chooseBestWebsocket(n,this.tryDoubleDomain,this.use443PortOnly,i).then(o.resolve).catch(o.reject),o.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class z0 extends Kz{constructor(n,i){super(n,i,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(n,i){return new tt((o,c)=>{let u=!1;const h=[];this.closeEstablishingWs=()=>{k.debug("[choose-best-ws] close establishing websockets"),h.forEach(B=>{B.onclose=null,B.onopen=null,B.onmessage=null,B.close()}),c(new Ce(Y.WS_ABORT,"choose best websocket aborted"))};const m=Z("GATEWAY_DOMAINS");let _;const y=n.indexOf("?h="),S=m.find(B=>y!==-1?Xe(n).call(n,B,y):Xe(n).call(n,B));k.debug("[choose-best-ws] currentDomain: ",S,", domains: ",m);let w=!this.tryDoubleDomain||!S;if(!w&&S){var I;const B=Date.now();try{m.forEach(M=>{const U=y===-1?n.replace(S,M):n.substr(0,y)+n.substr(y).replace(S,M),q=new WebSocket(U);q.binaryType="arraybuffer",h.push(q),k.debug("[choose-best-ws] ws is connecting:",q.url)})}catch{for(k.debug("[choose-best-ws] ws create failed, fallback to single url"),h.forEach(U=>U.close());h.length;)h.pop();w=!0}(I=this.store)===null||I===void 0||I.recordJoinChannelService({urls:h.map(M=>M.url),service:"gateway"},i),h.forEach(M=>{M.onopen=()=>{if(u)return;const U=Date.now()-B;k.debug("[choose-best-ws] ws open cost ".concat(U,"ms")),h.filter(q=>q!==M).forEach(q=>{k.debug("[choose-best-ws]close backup websocket: ".concat(q.url)),q.close()}),u=!0,o(M)},M.onclose=U=>{_=U,!u&&(h.find(q=>!(q.readyState===WebSocket.CLOSED||q.readyState===WebSocket.CLOSING))||(k.debug("[choose-best-ws] all websocket is closed"),u=!0,c(_)))},M.onmessage=U=>{k.debug("[choose-best-ws]".concat(M.url," onmessage: ").concat(U.data))}}),$i(this.forceCloseTimeout).then(()=>{h.forEach(M=>{M.readyState!==WebSocket.OPEN&&M.close()})})}if(w){var P;let B;k.debug("[choose-best-ws] use single url: ",n),(P=this.store)===null||P===void 0||P.recordJoinChannelService({urls:[n],service:"gateway"},i);try{B=new WebSocket(n),h.push(B),B.binaryType="arraybuffer"}catch(M){const U=new Ce(Y.WS_ERR,"init websocket failed! Error: ".concat(M.toString()));return k.error("[".concat(this.name,"]").concat(U)),void c(U)}B.onopen=()=>{o(B)},B.onclose=M=>{c(M)},B.onmessage=M=>{k.debug("[choose-best-ws]".concat(B.url," onmessage: ").concat(M.data))},$i(this.forceCloseTimeout).then(()=>{B&&B.readyState!==WebSocket.OPEN&&B.close()})}}).then(o=>(this.closeEstablishingWs=void 0,o)).catch(o=>{throw this.closeEstablishingWs=void 0,o})}}class Yfe extends Rr{get connectionState(){return this._connectionState}set connectionState(n){n!==this._connectionState&&(this._connectionState=n,n===or.CONNECTED?this.emit(Lt.WS_CONNECTED):n===or.RECONNECTING?this.emit(Lt.WS_RECONNECTING,this._websocketReconnectReason):n===or.CLOSED&&this.emit(Lt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(n,i){super(),K(this,"_disconnectedReason",void 0),K(this,"_websocketReconnectReason",void 0),K(this,"_connectionState",or.CLOSED),K(this,"reconnectToken",void 0),K(this,"websocket",void 0),K(this,"openConnectionTime",void 0),K(this,"clientId",void 0),K(this,"lastMsgTime",Date.now()),K(this,"uploadCache",[]),K(this,"uploadCacheInterval",void 0),K(this,"rttRolling",new iW(5)),K(this,"pingpongTimer",void 0),K(this,"wsInflateDataTimer",void 0),K(this,"pingpongTimeoutCount",0),K(this,"joinResponse",void 0),K(this,"multiIpOption",void 0),K(this,"initError",void 0),K(this,"spec",void 0),K(this,"store",void 0),K(this,"onWebsocketMessage",o=>{if(o.data instanceof ArrayBuffer)return void this.emit(Lt.ON_BINARY_DATA,o.data);const c=JSON.parse(o.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){const u="res-@".concat(c._id);this.emit(u,c._result,c._message)}else if(Object.prototype.hasOwnProperty.call(c,"_type")){if(this.emit(c._type,c._message),c._type===ln.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===ln.ON_USER_BANNED)switch(c._message.error_code){case 14:this.close(Vn.UID_BANNED);break;case 15:this.close(Vn.IP_BANNED);break;case 16:this.close(Vn.CHANNEL_BANNED)}if(c._type===ln.ON_USER_LICENSE_BANNED)switch(c._message.error_code){case Ct.ERR_LICENSE_MISSING:this.close(Vn.LICENSE_MISSING);break;case Ct.ERR_LICENSE_EXPIRED:this.close(Vn.LICENSE_EXPIRED);break;case Ct.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Vn.LICENSE_MINUTES_EXCEEDED);break;case Ct.ERR_LICENSE_PERIOD_INVALID:this.close(Vn.LICENSE_PERIOD_INVALID);break;case Ct.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Vn.LICENSE_MULTIPLE_SDK_SERVICE);break;case Ct.ERR_LICENSE_ILLEGAL:this.close(Vn.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=n.clientId,this.spec=n,this.store=i,this.websocket=new $L("gateway-".concat(this.clientId),this.spec.retryConfig,!0,Z("JOIN_GATEWAY_USE_DUAL_DOMAIN"),Z("JOIN_GATEWAY_USE_443PORT_ONLY"),i),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===or.CONNECTED&&this.reconnect("retry",us.OFFLINE)})}async request(n,i,o,c){const u=rr(6,""),h={_id:u,_type:n,_message:i},m=this.websocket.connectionID,_=()=>new tt((B,M)=>{if(this.connectionState===or.CONNECTED)return B();const U=()=>{this.off(Lt.WS_CLOSED,q),B()},q=()=>{this.off(Lt.WS_CONNECTED,U),M(new be(Y.WS_ABORT))};this.once(Lt.WS_CONNECTED,U),this.once(Lt.WS_CLOSED,q),n!==Dt.PUBLISH&&n!==Dt.PUBLISH_DATASTREAM&&n!==Dt.SUBSCRIBE&&n!==Dt.SUBSCRIBE_DATASTREAM&&n!==Dt.UNSUBSCRIBE&&n!==Dt.UNSUBSCRIBE_DATASTREAM&&n!==Dt.UNPUBLISH&&n!==Dt.UNPUBLISH_DATASTREAM&&n!==Dt.CONTROL&&n!==Dt.RESTART_ICE||this.once(Lt.DISCONNECT_P2P,()=>{M(new be(Y.DISCONNECT_P2P))}),n!==Dt.PUBLISH&&n!==Dt.RESTART_ICE||this.once(Lt.ABORT_P2P_EXECUTION,()=>{M(new be(Y.DISCONNECT_P2P))})});if(this.connectionState!==or.CONNECTING&&this.connectionState!==or.RECONNECTING||n===Dt.JOIN||n===Dt.REJOIN||await _(),this.websocket.sendMessage(h,!0),c)return;const y=new tt((B,M)=>{let U=!1;const q=(ae,me)=>{U=!0,B({isSuccess:ae==="success",message:me||{}}),this.off(Lt.WS_CLOSED,$),this.off(Lt.WS_RECONNECTING,$),this.emit(Lt.REQUEST_SUCCESS,n,i)};this.once("res-@".concat(u),q);const $=()=>{M(new be(Y.WS_ABORT,"type: ".concat(n))),this.off(Lt.WS_CLOSED,$),this.off(Lt.WS_RECONNECTING,$),this.off("res-@".concat(u),q)};this.once(Lt.WS_CLOSED,$),this.once(Lt.WS_RECONNECTING,$),$i(Z("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==m||U||(k.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(n)),this.emit(Lt.REQUEST_TIMEOUT,n,i))})});let S=null;try{S=await y}catch(B){if(this.connectionState===or.CLOSED||n===Dt.LEAVE)throw new be(Y.WS_ABORT);return!this.spec.forceWaitGatewayResponse||o?B.throw():n===Dt.JOIN||n===Dt.REJOIN?null:(await _(),await this.request(n,i))}if(S.isSuccess)return S.message;const w=Number(S.message.error_code||S.message.code),I=G0(w),P=new be(Y.UNEXPECTED_RESPONSE,"".concat(I.desc,": ").concat(S.message.error_str),{code:w,data:S.message,desc:I.desc});return I.action==="success"?S.message:(k.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(n,", error_code: ").concat(w,", message: ").concat(I.desc,", action: ").concat(I.action)),w===Ct.ERR_TOO_MANY_BROADCASTERS?((n===Dt.JOIN||n===Dt.REJOIN)&&(this.initError=P,this.close()),P.throw()):I.action==="failed"?P.throw():I.action==="quit"?(this.initError=P,this.close(),P.throw()):(w===Ct.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=S.message.option,k.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",us.MULTI_IP)):this.reconnect(I.action,us.SERVER_ERROR),n===Dt.JOIN||n===Dt.REJOIN?null:await this.request(n,i)))}waitMessage(n,i){return new tt(o=>{const c=u=>{(!i||i(u))&&(this.off(n,c),o(u))};this.on(n,c)})}uploadWRTCStats(n){if(!this.store.sessionId)return void k.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const i={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:n};this.upload(B0.WRTC_STATS,i)}upload(n,i){const o={_type:n,_message:i};try{this.websocket.sendMessage(o)}catch{const u=Z("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(o),this.uploadCache.length>u&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==or.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},Z("UPLOAD_CACHE_INTERVAL")||2e3))}}send(n,i){const o={_type:n,_message:i};this.websocket.sendMessage(o)}init(n){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new tt((i,o)=>{this.once(Lt.WS_CONNECTED,()=>i(this.joinResponse)),this.once(Lt.WS_CLOSED,c=>o(this.initError||new be(Y.WS_ABORT,c))),this.connectionState=or.CONNECTING,this.websocket.init(n).catch(o),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=n||Vn.LEAVE,this.connectionState=or.CLOSED,k.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(Lt.ABORT_P2P_EXECUTION);const n=await ds(this,Lt.REQUEST_JOIN_INFO),i=await this.request(Dt.JOIN,n);if(!i)return this.emit(Lt.REPORT_JOIN_GATEWAY,IA.TIMEOUT,this.url||""),!1;this.joinResponse=i,this.emit(Lt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=or.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new be(Y.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const n=L0(this,Lt.REQUEST_REJOIN_INFO);n.token=this.reconnectToken;const i=await this.request(Dt.REJOIN,n);return!!i&&(this.connectionState=or.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),i.peers&&i.peers.forEach(o=>{this.emit(ln.ON_USER_ONLINE,{uid:o.uid}),o.audio&&this.emit(ln.ON_ADD_AUDIO_STREAM,{uid:o.uid,uint_id:o.uint_id,audio:!0,ssrcId:o.audio_ssrc}),o.video&&this.emit(ln.ON_ADD_VIDEO_STREAM,{uid:o.uid,uint_id:o.uint_id,video:!0,ssrcId:o.video_ssrc}),o.audio_mute?this.emit(ln.MUTE_AUDIO,{uid:o.uid}):this.emit(ln.UNMUTE_AUDIO,{uid:o.uid}),o.video_mute?this.emit(ln.MUTE_VIDEO,{uid:o.uid}):this.emit(ln.UNMUTE_VIDEO,{uid:o.uid}),o.audio_enable_local?this.emit(ln.ENABLE_LOCAL_AUDIO,{uid:o.uid}):this.emit(ln.DISABLE_LOCAL_AUDIO,{uid:o.uid}),o.video_enable_local?this.emit(ln.ENABLE_LOCAL_VIDEO,{uid:o.uid}):this.emit(ln.DISABLE_LOCAL_VIDEO,{uid:o.uid}),o.audio||o.video||this.emit(ln.ON_REMOVE_STREAM,{uid:o.uid,uint_id:o.uint_id})}),!0)}reconnect(n,i){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(n,i)}handleNotification(n){k.debug("[".concat(this.clientId,"] receive notification: "),n);const i=G0(n.code);if(n.code===28&&"detail"in n&&(k.info("[".concat(this.clientId,"] receive recover notification: "),n.detail),this.emit(Lt.RECOVER_NOTIFICATION,n.detail)),i.action!=="success"){if(i.action!=="failed")return i.action==="quit"?(i.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Vn.UID_BANNED),void this.close()):void this.reconnect(i.action,us.SERVER_ERROR);k.error("[".concat(this.clientId,"] ignore error: "),i.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const n=Z("PING_PONG_TIME_OUT"),i=Date.now();this.pingpongTimeoutCount>=n&&(k.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(i-this.lastMsgTime,"ms")),i-this.lastMsgTime>Z("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",us.TIMEOUT):this.request(Dt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const o=Date.now()-i;this.rttRolling.add(o),Z("REPORT_STATS")&&this.send(Dt.PING_BACK,{pingpongElapse:o})}).catch(o=>{})}handleWsInflateData(){const{wsInflateLength:n,wsDeflateLength:i}=this.websocket.getWsInflateData();n!==0&&i!==0&&this.upload(B0.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:i,ws_inflate_length:n})}handleWebsocketEvents(){this.websocket.on(Wt.RECONNECT_CREATE_CONNECTION,n=>{this.emit(Lt.WS_RECONNECT_CREATE_CONNECTION,n)}),this.websocket.on(Wt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Wt.CLOSED,()=>{this.connectionState=or.CLOSED}),this.websocket.on(Wt.FAILED,()=>{this._disconnectedReason=Vn.NETWORK_ERROR,this.connectionState=or.CLOSED}),this.websocket.on(Wt.RECONNECTING,n=>{this._websocketReconnectReason=n,this.joinResponse=void 0,this.connectionState===or.CONNECTED?this.connectionState=or.RECONNECTING:this.connectionState=or.CONNECTING}),this.websocket.on(Wt.WILL_RECONNECT,(n,i,o)=>{const c=L0(this,Lt.IS_P2P_DISCONNECTED),u=c||n!=="retry";c&&n==="retry"&&(k.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),n="tryNext",i=IA.P2P_DISCONNECTED),u&&(k.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(n)),this.emit(Lt.REPORT_JOIN_GATEWAY,i||IA.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(Lt.DISCONNECT_P2P)),o(n)}),this.websocket.on(Wt.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(n=>{k.warning("[".concat(this.clientId,"] rejoin failed ").concat(n)),this.reconnect("tryNext",us.SERVER_ERROR)}):this.join().catch(n=>{if(this.emit(Lt.REPORT_JOIN_GATEWAY,n,this.url||""),n instanceof be){if(n.code===Y.UNEXPECTED_RESPONSE&&n.data.code===Ct.ERR_NO_AUTHORIZED)return this.initError=new be(Y.TOKEN_EXPIRE,"dynamic key expired"),void this.close(Vn.TOKEN_EXPIRE);k.error("[".concat(this.clientId,"] join gateway request failed"),n.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",us.SERVER_ERROR):(this.initError=n,this.close())}})}),this.websocket.on(Wt.REQUEST_NEW_URLS,(n,i)=>{ds(this,Lt.REQUEST_RECOVER,this.multiIpOption).then(n).catch(i)}),this.websocket.on(Wt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(ln.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(Wz.PRE_CONNECT_PC,()=>{this.emit(Lt.PRE_CONNECT_PC)})}}let Xfe=function(e){return e.NATIVE_RTC="native_rtc",e.NATIVE_RTM="native_rtm",e.WEB_RTC="web_rtc",e.WEB_RTM="web_rtm",e}({}),ii=function(e){return e[e.CHOOSE_SERVER=11]="CHOOSE_SERVER",e[e.CLOUD_PROXY=18]="CLOUD_PROXY",e[e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",e[e.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",e}({});function qz(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function OA(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?qz(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):qz(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function nm(e){return e.match(/^[\.\:\d]+$/)?"".concat(e.replace(/[^\d]/g,"-"),".").concat(Z("TURN_DOMAIN")):(k.debug("Cannot recognized as ip address: ".concat(e,", use as host")),e)}function YL(e,n){e.addresses||(e.addresses=[]);const i=function(m,_){if(Z("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return m.map(w=>{let{ip:I,port:P}=w;return{address:"".concat(I,":").concat(P)}});const y=Z("GATEWAY_DOMAINS");let S=y[1]&&Xe(_).call(_,y[1])?1:0;return m.map(w=>{let{domain_prefix:I,port:P,ip:B}=w;if(I)return{address:"".concat(I,".").concat(y[S++%y.length],":").concat(P)};const M=/^[\.\:\d]+$/.test(B),U=M?"".concat(B.replace(/[^\d]/g,"-"),".").concat(y[S++%y.length],":").concat(P):"".concat(B,":").concat(P);return M||k.debug("Cannot recognized as ip address: ".concat(B,", use as host")),{ip:B,port:P,address:U}})}(e.addresses,n),o=Array.isArray(e.detail)&&e.detail[18];if(o&&typeof o=="string"){const m=o.split(";");for(let _=0;_<m.length;_++){var c;const y=Gs(c=m[_]).call(c);i[_]&&y&&(i[_].ip6=y)}}const u=e.detail&&e.detail.candidate;let h;if(u){const[m,_]=u.split(":");m&&_&&(h={port:Number(_),ip:m,address:"".concat(m,":").concat(_)})}return{gatewayAddrs:i,apGatewayAddress:h,uid:e.uid,cid:e.cid,cert:e.cert,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function Ba(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function $z(e){const n=e._encoderConfig;if(!n)return{};const i={resolution:n.width&&n.height?"".concat(Ba(n.width),"x").concat(Ba(n.height)):void 0,maxVideoBW:n.bitrateMax,minVideoBW:n.bitrateMin};return typeof n.frameRate=="number"?(i.maxFrameRate=n.frameRate,i.minFrameRate=n.frameRate):n.frameRate&&(i.maxFrameRate=n.frameRate.max||n.frameRate.ideal||n.frameRate.exact||n.frameRate.min,i.minFrameRate=n.frameRate.min||n.frameRate.ideal||n.frameRate.exact||n.frameRate.max),i}function Yz(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function H0(e,n){let i,o,c;switch(n){case ii.CHOOSE_SERVER:o=4096,c="choose server";break;case ii.CLOUD_PROXY:o=1048576,c="proxy";break;case ii.CLOUD_PROXY_5:o=4194304,c="proxy5";break;case ii.CLOUD_PROXY_FALLBACK:o=4194310,c="proxy fallback";break;default:throw new be(Y.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(e.response_body.forEach(u=>{u.buffer&&u.buffer.flag===o&&(i={code:u.buffer.code,addresses:(u.buffer.edges_services||[]).map(h=>OA(OA({},h),{},{ticket:u.buffer.cert})),server_ts:e.enter_ts,uid:u.buffer.uid,cid:u.buffer.cid,cname:u.buffer.cname,detail:OA(OA({},u.buffer.detail),e.detail),flag:u.buffer.flag,opid:e.opid,cert:u.buffer.cert})}),!i)throw new be(Y.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(c," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return i}async function Xz(e,n){return await tt.all(e.addresses.map(async i=>({address:Z("USE_TURN_IP")?i.ip:nm(i.ip),tcpport:i.port,udpport:i.port,username:n&&Z("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?n.toString():hs.username,password:n&&Z("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await tL(n.toString()):hs.password})))}function XL(e,n){const i=n.getMediaStreamTrack(!0).getSettings(),o=n.videoHeight||i.height,c=n.videoWidth||i.width;return o&&c?Math.max(Math.min(o,c)/Math.min(Ba(e.height),Ba(e.width)),1):(k.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function rm(e){let{candidateType:n,relayProtocol:i,type:o,address:c,port:u,protocol:h}=e;const m={candidateType:n,relayProtocol:i,protocol:h};if(o!=="local-candidate"){const _=c.split(".");_.length>=4&&(_[1]="*",_[2]="*"),m.address=_.join("."),m.port=u}return m}function PA(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Z("SVC_MODE");if(Z("ENABLE_SVC"))return function(n){return n in sA}(e)?e:sA.L1T3}const Jz={[at.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[at.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function NA(e,n,i){n.forEach(o=>{var c;const u=Jz[e].find(m=>{var _;let{key:y}=m;return Xe(_=o.extensionName).call(_,y)});if(!u)return;const h=i.find(m=>{let{extensionName:_}=m;return Xe(_).call(_,u.key)});h&&Xe(c=h.extensionName).call(c,"gdpr_forbidden")&&(o.extensionName=h.extensionName)})}function mv(e,n){n.forEach(i=>{var o;const c=Jz[e].find(u=>{var h;let{key:m}=u;return Xe(h=i.extensionName).call(h,m)});Xe(o=i.extensionName).call(o,"gdpr_forbidden")&&c&&(i.extensionName=c.extensionName)})}function Qz(e){return e==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"||Xe(e).call(e,"abs-send-time")}function kA(e){return e==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"||Xe(e).call(e,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function Zz(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function eH(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?Zz(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Zz(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function K0(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=arguments.length>3?arguments[3]:void 0;const{filterRTX:c,filterVideoFec:u,filterAudioFec:h,filterAudioCodec:m,filterVideoCodec:_}=n,{useXR:y}=i;let S=[],w=[],I=[],P=[],B=!1,M=!1;if(da(e).mediaDescriptions.forEach(q=>{o&&o!==q.attributes.direction||(q.media.mediaType!=="video"||B||(w=q.attributes.payloads,P=q.attributes.extmaps,B=!0),q.media.mediaType!=="audio"||M||(S=q.attributes.payloads,I=q.attributes.extmaps,M=!0))}),!P||w.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!I||S.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(w.forEach(q=>{var $;($=q.rtpMap)!==null&&$!==void 0&&$.clockRate&&(q.rtpMap.clockRate=parseInt(q.rtpMap.clockRate)),y&&q.rtcpFeedbacks.push({type:"rrtr"})}),S.forEach(q=>{var $;($=q.rtpMap)!==null&&$!==void 0&&$.clockRate&&(q.rtpMap.clockRate=parseInt(q.rtpMap.clockRate)),y&&q.rtcpFeedbacks.push({type:"rrtr"})}),c&&(S=S.filter(q=>{var $;return(($=q.rtpMap)===null||$===void 0?void 0:$.encodingName.toLowerCase())!=="rtx"}),w=w.filter(q=>{var $;return(($=q.rtpMap)===null||$===void 0?void 0:$.encodingName.toLowerCase())!=="rtx"})),u&&(w=w.filter(q=>{var $;return!/(red)|(ulpfec)|(flexfec)/i.test((($=q.rtpMap)===null||$===void 0?void 0:$.encodingName)||"")})),h&&(S=S.filter(q=>{var $;return!/(red)|(ulpfec)|(flexfec)/i.test((($=q.rtpMap)===null||$===void 0?void 0:$.encodingName)||"")})),m&&(m==null?void 0:m.length)>0&&(S=S.filter(q=>{var $;return Xe(m).call(m,(($=q.rtpMap)===null||$===void 0?void 0:$.encodingName.toLowerCase())||"")})),_&&(_==null?void 0:_.length)>0){const q=w.filter($=>{var ae;return Xe(_).call(_,((ae=$.rtpMap)===null||ae===void 0?void 0:ae.encodingName.toLowerCase())||"")});w=q.concat(c?[]:ZL(q,w))}const U=Z("UNSUPPORTED_VIDEO_CODEC");return U&&U.length>0&&(w=w.filter(q=>!(q.rtpMap&&Xe(U).call(U,q.rtpMap.encodingName.toLowerCase())))),{audioCodecs:S,videoCodecs:w,audioExtensions:I,videoExtensions:P}}function im(e){const n=da(e);let i,o;for(const c of n.mediaDescriptions){if(!i){const u=c.attributes.iceUfrag,h=c.attributes.icePwd;if(!u||!h)throw new Error("Cannot get iceUfrag or icePwd from SDP.");i={iceUfrag:u,icePwd:h}}if(!o){const u=c.attributes.fingerprints;u.length>0&&(o={fingerprints:u})}}if(!o&&n.attributes.fingerprints.length>0&&(o={fingerprints:n.attributes.fingerprints}),!o||!i)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:i,dtlsParameters:o}}function tH(e,n){const i=[],o=e.attributes.ssrcGroups.filter(h=>h.semantic==="FID"),c=e.attributes.ssrcGroups.find(h=>h.semantic==="SIM"),u=e.attributes.ssrcs;if(c)c.ssrcIds.forEach(h=>{var m;const _=(m=o.find(y=>y.ssrcIds[0]===h))===null||m===void 0?void 0:m.ssrcIds[1];i.push({ssrcId:h,rtx:n?_:void 0})});else if(o.length>0){const h=o[0].ssrcIds[0],m=o[0].ssrcIds[1];i.push({ssrcId:h,rtx:n?m:void 0})}else{if(u.length===0)throw new Error("No ssrcs found on local media description.");i.push({ssrcId:u[0].ssrcId})}return i}function nH(e,n,i){const{cname:o}=e;let c=[];n&&(c=rH(n)),c.length===0&&(c=e.iceParameters.candidates.map(S=>({foundation:S.foundation,componentId:"1",transport:S.protocol,priority:S.priority.toString(),connectionAddress:S.ip,port:S.port.toString(),type:S.type,extension:{}})),k.debug("Using candidates from gateway."));const u={fingerprints:e.dtlsParameters.fingerprints.map(S=>({hashFunction:S.algorithm,fingerprint:S.fingerprint}))},h={iceUfrag:e.iceParameters.iceUfrag,icePwd:e.iceParameters.icePwd};let m;switch(e.dtlsParameters.role){case"server":m="passive";break;case"client":m="active";break;case"auto":m="actpass"}const _=LA(e.rtpCapabilities),y=[];return Array.isArray(i)&&i.length>0&&i.forEach(S=>{y.push({kind:at.VIDEO,ssrcId:S.v,rtx:S.v_rtx,mslabel:"".concat(S.v,"_").concat(S.a)},{kind:at.AUDIO,ssrcId:S.a,mslabel:"".concat(S.v,"_").concat(S.a)})}),{dtlsParameters:u,iceParameters:h,candidates:c,rtpCapabilities:_,setup:m,cname:o,preSSRCs:y}}function rH(e){let n=[];return e.ip&&typeof e.port=="number"&&(n=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip,port:e.port.toString(),type:"host",extension:{}}],k.debug("Using remote candidate from AP ".concat(e.ip,":").concat(e.port)),e.ip6&&(n.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip6,port:e.port.toString(),type:"host",extension:{}}),k.debug("Using IPV6 remote candidate from AP ".concat(e.ip6,":").concat(e.port)))),n}function c_(e,n,i){const o=[],c=[];return e.forEach(u=>{let{ssrcId:h,rtx:m}=u;const _=rr(8,"track-"),y={ssrcId:h,attributes:eH({label:_,mslabel:i=i||rr(10,""),msid:"".concat(i," ").concat(_)},n&&{cname:n})};if(o.push(y),m!==void 0){const S={ssrcId:m,attributes:eH({label:_,mslabel:i,msid:"".concat(i," ").concat(_)},n&&{cname:n})};o.push(S),c.push({semantic:"FID",ssrcIds:[h,m]})}}),e.length>1&&c.push({semantic:"SIM",ssrcIds:e.map(u=>{let{ssrcId:h}=u;return h})}),{ssrcs:o,ssrcGroups:c}}function gv(e,n){n instanceof Vr&&e.attributes.payloads.forEach(i=>{var o;const c=(o=i.rtpMap)===null||o===void 0?void 0:o.encodingName.toLowerCase();if(!c||["opus","pcmu","pcma","g722"].indexOf(c)===-1)return;i.fmtp||(i.fmtp={parameters:{}}),i.fmtp.parameters.minptime="10",i.fmtp.parameters.useinbandfec="1";const u=n._encoderConfig;u&&c!=="pcmu"&&c!=="pcma"&&c!=="g722"&&(u.bitrate&&!Pr()&&(i.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*u.bitrate))),u.sampleRate&&(i.fmtp.parameters.maxplaybackrate="".concat(u.sampleRate),i.fmtp.parameters["sprop-maxcapturerate"]="".concat(u.sampleRate)),u.stereo&&(i.fmtp.parameters.stereo="1",i.fmtp.parameters["sprop-stereo"]="1"))})}function JL(e){const n=e.attributes.unrecognized.findIndex(i=>i.attField==="x-google-flag"&&i.attValue==="conference");n!==-1&&e.attributes.unrecognized.splice(n,1)}function QL(e,n){var i;if(!(n instanceof hr&&n._encoderConfig&&n._hints.indexOf(ir.SCREEN_TRACK)===-1))return;const o=n._encoderConfig;On().supportMinBitrate&&o.bitrateMin&&e.attributes.payloads.forEach(c=>{var u,h;Xe(u=["h264","h265","vp8","vp9","av1"]).call(u,((h=c.rtpMap)===null||h===void 0?void 0:h.encodingName.toLowerCase())||"")&&(c.fmtp||(c.fmtp={parameters:{}}),c.fmtp.parameters["x-google-min-bitrate"]="".concat(o.bitrateMin))}),On().supportMinBitrate&&!Xe(i=n._hints).call(i,ir.LOW_STREAM)&&o.bitrateMax&&e.attributes.payloads.forEach(c=>{var u,h;Xe(u=["h264","h265","vp8","vp9","av1"]).call(u,((h=c.rtpMap)===null||h===void 0?void 0:h.encodingName.toLowerCase())||"")&&(c.fmtp||(c.fmtp={parameters:{}}),c.fmtp.parameters["x-google-start-bitrate"]="".concat(Z("X_GOOGLE_START_BITRATE")||Math.floor(o.bitrateMax)))})}function iH(e){if(e.media.mediaType!=="video")return;const n=Tn();if(n.name!==Ln.SAFARI&&n.os!==Ai.IOS)return;const i=e.attributes.extmaps.findIndex(o=>/video-orientation/g.test(o.extensionName));i!==-1&&e.attributes.extmaps.splice(i,1)}function DA(e,n,i){if(!n)return;let o,c;if(e.media.mediaType==="video"?(o=i.videoExtensions,c=i.videoCodecs):(o=i.audioExtensions,c=i.audioCodecs),n.twcc===!0){const u=o.find(h=>kA(h.extensionName));if(u){const h=u.extensionName;e.attributes.extmaps.find(_=>kA(_.extensionName))||e.attributes.extmaps.push({entry:u.entry,extensionName:h}),function(_,y){return y.filter(S=>!!_.find(w=>w.payloadType===S.payloadType&&!!w.rtcpFeedbacks.find(I=>I.type==="transport-cc")))}(c,e.attributes.payloads).forEach(_=>{_.rtcpFeedbacks.find(y=>y.type==="transport-cc")||_.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(n.twcc===!1){const u=e.attributes.extmaps.findIndex(h=>kA(h.extensionName));u!==-1&&e.attributes.extmaps.splice(u,1),e.attributes.payloads.forEach(h=>{const m=h.rtcpFeedbacks.findIndex(_=>_.type==="transport-cc");m!==-1&&h.rtcpFeedbacks.splice(m,1)})}if(n.remb===!0){const u=o.find(h=>Qz(h.extensionName));if(u){const h=u.extensionName;e.attributes.extmaps.find(_=>_.extensionName===h)||e.attributes.extmaps.push({entry:u.entry,extensionName:h}),function(_,y){return y.filter(S=>!!_.find(w=>w.payloadType===S.payloadType&&!!w.rtcpFeedbacks.find(I=>I.type==="goog-remb")))}(c,e.attributes.payloads).forEach(_=>{_.rtcpFeedbacks.find(y=>y.type==="goog-remb")||_.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(n.remb===!1){const u=e.attributes.extmaps.findIndex(h=>Qz(h.extensionName));u!==-1&&e.attributes.extmaps.splice(u,1),e.attributes.payloads.forEach(h=>{const m=h.rtcpFeedbacks.findIndex(_=>_.type==="goog-remb");m!==-1&&h.rtcpFeedbacks.splice(m,1)})}}function sH(e,n,i){if(Pr()||e.media.mediaType!=="video"||!(n instanceof hr)||i!=="vp9"&&i!=="vp8"||i==="vp8"&&!Z("SIMULCAST")||i==="vp9"&&Z("ENABLE_SVC")||n._scalabilityMode===void 0||n._scalabilityMode.numSpatialLayers<=1)return;const o=i==="vp8"?2:n._scalabilityMode.numSpatialLayers,c=e.attributes.ssrcs[0],u=e.attributes.ssrcGroups.find(m=>m.semantic==="FID"&&m.ssrcIds[0]===c.ssrcId),h={semantic:"SIM",ssrcIds:[c.ssrcId]};for(let m=1;m<o;m++)e.attributes.ssrcs.push({ssrcId:c.ssrcId+m,attributes:Dr(c.attributes)}),h.ssrcIds.push(c.ssrcId+m),u&&(e.attributes.ssrcs.push({ssrcId:u.ssrcIds[1]+m,attributes:Dr(c.attributes)}),e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[c.ssrcId+m,u.ssrcIds[1]+m]}));e.attributes.ssrcGroups.unshift(h)}async function oH(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=new RTCPeerConnection;i.addTransceiver("video",{direction:"sendonly"}),i.addTransceiver("audio",{direction:"sendonly"}),i.addTransceiver("video",{direction:"recvonly"}),i.addTransceiver("audio",{direction:"recvonly"});const o=(await i.createOffer()).sdp,{send:c,recv:u,sendrecv:h}=function(){let m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},_=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},y=arguments.length>2?arguments[2]:void 0;const S=K0(y,m,_,"sendonly"),w=K0(y,m,_,"recvonly"),I={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},P={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},B={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Yl(S,w,"videoExtensions",I,P,B),Yl(S,w,"videoCodecs",I,P,B),Yl(S,w,"audioExtensions",I,P,B),Yl(S,w,"audioCodecs",I,P,B),Z("RAISE_H264_BASELINE_PRIORITY")){const M=[],U=[];B.videoCodecs.forEach((q,$)=>{var ae;if(((ae=q.rtpMap)===null||ae===void 0?void 0:ae.encodingName.toLocaleLowerCase())==="h264"){var me,ge;const pe=B.videoCodecs[$+1],we=pe&&dH(q,pe),Be=(me=q.fmtp)===null||me===void 0?void 0:me.parameters["profile-level-id"],nt=(ge=q.fmtp)===null||ge===void 0?void 0:ge.parameters["packetization-mode"];!Be||Be!==Z("FIRST_H264_PROFILE_LEVEL_ID")||Z("FIRST_PACKETIZATION_MODE")&&nt!==Z("FIRST_PACKETIZATION_MODE")?we?U.push([q,pe]):U.push([q]):we?M.push([q,pe]):M.push([q])}}),M.length>0&&U.length>0&&(k.debug("raising H264 baseline profile priority"),B.videoCodecs.forEach((q,$)=>{var ae;if(((ae=q.rtpMap)===null||ae===void 0?void 0:ae.encodingName.toLocaleLowerCase())==="h264"){const me=dH(q,B.videoCodecs[$+1]),ge=M.shift()||U.shift()||[];ge.length>0&&(me?B.videoCodecs.splice($,2,...ge):B.videoCodecs.splice($,1,...ge))}}),P.videoCodecs=P.videoCodecs.filter(q=>{var $,ae;return!((($=q.rtpMap)===null||$===void 0?void 0:$.encodingName.toLocaleLowerCase())==="h264"&&((ae=q.fmtp)===null||ae===void 0?void 0:ae.parameters["profile-level-id"])!==Z("FIRST_H264_PROFILE_LEVEL_ID"))}),Z("FILTER_SEND_H264_BASELINE")&&(I.videoCodecs=I.videoCodecs.filter(q=>{var $,ae;return!((($=q.rtpMap)===null||$===void 0?void 0:$.encodingName.toLocaleLowerCase())==="h264"&&((ae=q.fmtp)===null||ae===void 0?void 0:ae.parameters["profile-level-id"])!==Z("FIRST_H264_PROFILE_LEVEL_ID"))})))}return{send:I,recv:P,sendrecv:B}}(e,n,o);try{i.close()}catch{}return{send:c,recv:u,sendrecv:h}}function aH(){const e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},n=K0(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},o={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Yl(e,n,"videoExtensions",i,o,c),Yl(e,n,"videoCodecs",i,o,c),Yl(e,n,"audioExtensions",i,o,c),Yl(e,n,"audioCodecs",i,o,c),Z("RAISE_H264_BASELINE_PRIORITY")){const u=c.videoCodecs.findIndex(h=>h.rtpMap&&h.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&h.fmtp&&h.fmtp.parameters["profile-level-id"]==="42001f");if(u!==-1){const h=c.videoCodecs.findIndex(m=>m.rtpMap&&m.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(h<u){k.debug("raising H264 baseline profile priority");const m=c.videoCodecs[u];c.videoCodecs.splice(u,1),c.videoCodecs.splice(h,0,m)}h!==-1&&(o.videoCodecs=o.videoCodecs.filter(m=>!(m.rtpMap&&m.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&m.fmtp&&m.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:i,recv:o,sendrecv:c}}function Yl(e,n,i,o,c,u){if(i==="videoExtensions"||i==="audioExtensions"){const h=[];return e[i].forEach(m=>{n[i].some((_,y)=>{if(m.entry===_.entry&&m.extensionName===_.extensionName)return h.push(y),!0})?u[i].push(m):o[i].push(m)}),void n[i].forEach((m,_)=>{h.indexOf(_)===-1&&c[i].push(m)})}if(i==="videoCodecs"||i==="audioCodecs"){const h=[];return e[i].forEach(m=>{n[i].some((_,y)=>{if(m.payloadType===_.payloadType&&JSON.stringify(m)===JSON.stringify(_))return h.push(y),!0})?u[i].push(m):o[i].push(m)}),void n[i].forEach((m,_)=>{h.indexOf(_)===-1&&c[i].push(m)})}}function LA(e){const{send:n,recv:i,sendrecv:o}=e;if(!o){if(!n||!i)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:n,recv:i}}let c,u;return n?(c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c.audioCodecs=[...n.audioCodecs,...o.audioCodecs],c.videoCodecs=[...n.videoCodecs,...o.videoCodecs],c.audioExtensions=[...n.audioExtensions,...o.audioExtensions],c.videoExtensions=[...n.videoExtensions,...o.videoExtensions]):c=o,i?(u={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},u.audioCodecs=[...i.audioCodecs,...o.audioCodecs],u.videoCodecs=[...i.videoCodecs,...o.videoCodecs],u.audioExtensions=[...i.audioExtensions,...o.audioExtensions],u.videoExtensions=[...i.videoExtensions,...o.videoExtensions]):u=o,{send:c,recv:u}}function _v(e){e.media.mediaType==="audio"&&e.attributes.payloads.filter(n=>{var i;return((i=n.rtpMap)===null||i===void 0?void 0:i.encodingName.toLowerCase())==="opus"}).forEach(n=>{n.fmtp||(n.fmtp={parameters:{}}),n.fmtp.parameters.stereo="1",n.fmtp.parameters["sprop-stereo"]="1"})}function q0(e,n,i,o){let c=[];if(e===at.VIDEO){if(Z("H264_PROFILE_LEVEL_ID")&&o==="h264"&&(c=n.videoCodecs.filter(u=>{var h;return Xe(h=u.rtpMap&&u.rtpMap.encodingName.toLowerCase()||"").call(h,o)&&u&&u.fmtp&&u.fmtp.parameters["profile-level-id"]===Z("H264_PROFILE_LEVEL_ID")})),!Array.isArray(c)||c.length===0){let u=[];const h=[],m=[],_=[];if(i.videoCodecs.forEach(y=>{const S=y.rtpMap&&y.rtpMap.encodingName.toLowerCase()||"";Xe(S).call(S,o)?u.push(y):Xe(S).call(S,"vp9")?h.push(y):Xe(S).call(S,"vp8")?m.push(y):Xe(S).call(S,"h264")&&_.push(y)}),u.length===0){let y="";h.length!==0?(u=h,y="vp9"):m.length!==0?(u=m,y="vp8"):_.length!==0&&(u=_,y="h264"),k.warning("codec ".concat(o," not included in rtpCapabilities, fallback to default payloads: ").concat(y))}u.length!==0&&(c=n.videoCodecs.filter(y=>u.some(S=>S.payloadType===y.payloadType)))}if(c.length===0&&(k.warning("codec ".concat(o," not included in rtpCapabilities, fallback to default payloads: ").concat(n.videoCodecs[0].rtpMap&&n.videoCodecs[0].rtpMap.encodingName)),c=n.videoCodecs),Z("USE_PUB_RTX")||Z("USE_SUB_RTX")){const u=ZL(c,n.videoCodecs);c=[...c,...u]}}else c=n.audioCodecs.filter(u=>{var h;return Xe(h=u.rtpMap&&u.rtpMap.encodingName.toLowerCase()||"").call(h,o)}),c.length===0&&(k.warning("codec ".concat(o," not included in rtpCapabilities, fallback to opus")),c=n.audioCodecs.filter(u=>{var h;return Xe(h=u.rtpMap&&u.rtpMap.encodingName.toLowerCase()||"").call(h,"opus")}));return c}function ZL(e,n){const i=e.map(o=>o.payloadType.toString());return n.filter(o=>o.rtpMap&&o.rtpMap.encodingName==="rtx"&&o.fmtp&&o.fmtp.parameters.apt&&Xe(i).call(i,o.fmtp&&o.fmtp.parameters.apt))}async function $0(e,n,i){const o=n.toString(),c=lH(o,"offer","remote","exchangeSDP");await e.setRemoteDescription({type:"offer",sdp:o});const u=await e.createAnswer();if(!u.sdp)throw new Error("cannot get answer sdp");let h=u.sdp;h=cH(h,i||{}),c==null||c(h||""),await e.setLocalDescription({type:"answer",sdp:h})}function cH(e,n,i){const o=da(e),{useXR:c}=n;return o.mediaDescriptions.forEach(u=>{var h;u.attributes.mid&&(Array.isArray(i)&&!Xe(i).call(i,u.attributes.mid)||(u.media.mediaType==="audio"&&_v(u),c&&Xe(h=["audio","video"]).call(h,u.media.mediaType)&&u.attributes.payloads.forEach(m=>{m.rtcpFeedbacks.findIndex(_=>_.type==="rrtr")===-1&&m.rtcpFeedbacks.push({type:"rrtr"})})))}),Zp(o)}function lH(e,n,i,o){if(Z("SDP_LOGGING"))return k.upload("exchanging ".concat(i," ").concat(n," SDP during P2PConnection.").concat(o,`
`),e),n==="offer"?c=>{lH(c,"answer",i==="local"?"remote":"local",o)}:void 0}function uH(e){const n=Z("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(n)&&n.length>0)&&n.some(i=>Xe(e).call(e,i))}function dH(e,n){try{var i;return((i=e.fmtp)===null||i===void 0?void 0:i.parameters.apt)===n.payloadType.toString()}catch{return!1}}function hH(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function sl(e,n){return typeof Z(e)===n?Z(e):void 0}function Jfe(){try{const e=Z("EXPERIMENTS")||{};return typeof e=="string"||Array.isArray(e)?{}:function(n){for(var i=1;i<arguments.length;i++){var o=arguments[i]!=null?arguments[i]:{};i%2?hH(Object(o),!0).forEach(function(c){K(n,c,o[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):hH(Object(o)).forEach(function(c){Object.defineProperty(n,c,Object.getOwnPropertyDescriptor(o,c))})}return n}({},e)}catch(e){return k.debug("handle gateway attributes failed: ",e),{}}}const fH={};function sm(e){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&k.debug("install service ".concat(e.name)),fH[e.name]=e}function Nf(e){const n=fH[e];if(!n)throw new Ce(Y.INVALID_OPERATION,"".concat(e," not found, please use AgoraRTC.use(").concat(e,"Service) to load it first"));return n}function pH(e,n){return Nf("DataStream").create(e,n)}function xA(){return Nf("InterceptFrame").create()}function mH(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function kf(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?mH(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):mH(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}const ex=new Map;class Qfe extends Rr{get state(){return this._state}set state(n){if(n===this._state)return;const i=this._state;this._state=n,n==="DISCONNECTED"&&this._disconnectedReason?this.emit(ji.CONNECTION_STATE_CHANGE,n,i,this._disconnectedReason):this.emit(ji.CONNECTION_STATE_CHANGE,n,i)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(n){k.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(n)),this._joinGatewayStartTime=n}constructor(n,i){var o,c,u;super(),K(this,"store",void 0),K(this,"joinInfo",void 0),K(this,"key",void 0),K(this,"ntpOffset",0),K(this,"signal",void 0),K(this,"role",void 0),K(this,"inChannelInfo",{joinAt:null,duration:0}),K(this,"spec",void 0),K(this,"_state","DISCONNECTED"),K(this,"_statsCollector",void 0),K(this,"_disconnectedReason",void 0),K(this,"isSignalRecover",!1),K(this,"hasChangeBGPAddress",!1),K(this,"trafficStatsInterval",void 0),K(this,"networkQualityInterval",void 0),K(this,"_joinGatewayStartTime",0),K(this,"_signalTimeout",!1),K(this,"_clientRoleOptions",void 0),K(this,"_isProactiveJoin",!1),this.store=n,this.spec=i,this.signal=this.store.useP2P?(o={spec:kf(kf({},i),{},{retryConfig:i.websocketRetryConfig}),store:n},(c=(u=Nf("P2PChannel")).createSubmodule)===null||c===void 0?void 0:c.call(u,o)):new Yfe(kf(kf({},i),{},{retryConfig:i.websocketRetryConfig}),n),this._statsCollector=i.statsCollector,this.role=i.role||"audience",this._clientRoleOptions=i.clientRoleOptions,this.handleSignalEvents()}async join(n,i,o){this.store.joinGatewayStart(),n.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const c=Date.now();let u=ex.get(n.cname);if(u||(u=new Map,ex.set(n.cname,u)),this._isProactiveJoin=!0,u.has(n.uid)){const y=new be(Y.UID_CONFLICT);throw yt.joinGateway(n.sid,{lts:c,succ:!1,ec:y.code,addr:null,uid:n.uid,cid:n.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!n.proxyServer,signalChannel:"0",preload:n.preload}),y}u.set(n.uid,!0),this.joinInfo=n,this.key=i;let h=0;this.joinGatewayStartTime=c;const m=n.proxyServer;try{k.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(h));const y=n.gatewayAddrs.map(S=>{let{address:w}=S;const[I,P]=w.split(":"),B={host:I,port:P};return n.proxyServer&&(B.proxy=n.proxyServer),B});h=(await this.signal.init(y)).uid,k.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(h," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(y){var _;throw k.error("[".concat(this.store.clientId,"] User join failed"),y.toString()),yt.joinGateway(n.sid,{lts:c,succ:!1,ec:((_=y.data)===null||_===void 0?void 0:_.desc)||y.code,errorMsg:y.message,addr:this.signal.url,uid:n.uid,cid:n.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!m,signalChannel:"0",preload:n.preload}),u.delete(n.uid),this.signal.close(),y}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),k.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(y=>{k.warning("[".concat(this.store.clientId,"] get traffic stats error"),y.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(ji.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(ji.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(ji.NETWORK_QUALITY,{uplinkNetworkQuality:Yz(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:Yz(this._statsCollector.trafficStats.B_dnq)}):this.emit(ji.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),h}async leave(){let n=arguments.length>0&&arguments[0]!==void 0&&arguments[0],i=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){i!==Vn.FALLBACK&&(this.state="DISCONNECTING");try{n||this.signal.connectionState!==or.CONNECTED||await function(o,c){return c===1/0?o:tt.race([o,bhe(c)])}(this.signal.request(Dt.LEAVE,void 0,!0),3e3)}catch(o){k.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),o)}this.signal.close(i),i!==Vn.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(n,i,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new be(Y.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const c={state:"offer",p2p_id:this.store.p2pId,ortc:i,mode:this.spec.mode,extend:Z("PUB_EXTEND"),twcc:!!Z("PUBLISH_TWCC"),rtx:!!Z("USE_PUB_RTX")};try{return(await this.signal.request(Dt.PUBLISH,c,!0))._message}catch(u){if(o&&u.data&&u.data.code===Ct.ERR_PUBLISH_REQUEST_INVALID)return k.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),u.toString()),await this.tryUnpubBeforeRepub(n,i),this.publish(n,i,!1);throw u}}async publishDataChannel(n,i,o){var c;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new be(Y.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const u={stream_id:i.streamId,ordered:i.ordered?1:0,max_retrans_times:(c=i.maxRetransmits)!==null&&c!==void 0?c:10,channel_id:i.channelId,metadata:i.metadata};try{await this.signal.request(Dt.PUBLISH_DATASTREAM,u,!0)}catch(h){if(o&&h.data&&h.data.code===Ct.ERR_PUBLISH_REQUEST_INVALID)return k.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),h.toString()),await this.tryUnpubDataChannelBeforeRepub(n,i),this.publishDataChannel(n,i,!1);throw h}}async unpublish(n,i){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new be(Y.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(Dt.UNPUBLISH,{stream_id:i,ortc:n},!0)}catch(o){k.warning("[".concat(this.store.clientId,"] unpublish warning: "),o)}}async unpublishDataChannel(n){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new be(Y.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await tt.all(n.map(i=>this.signal.request(Dt.UNPUBLISH_DATASTREAM,{channel_id:i},!0)))}catch(i){k.warning("unpublish datachannels warning: ",i)}}async presubscribe(n,i,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new be(Y.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const c={stream_id:n,stream_type:i,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!Z("SUBSCRIBE_TWCC"),rtx:!!Z("USE_SUB_RTX")||void 0,extend:Z("SUB_EXTEND"),svc:Array.isArray(Z("SVC"))&&Z("SVC").length!==0?Z("SVC"):void 0};try{return await this.signal.request(Dt.PRE_SUBSCRIBE,c,!0)}catch(u){if(o&&u.data&&u.data.code===Ct.ERR_SUBSCRIBE_REQUEST_INVALID)return k.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),u.toString()),this.presubscribe(n,i,!1);throw u}}async subscribe(n,i,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new be(Y.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const c={stream_id:n,stream_type:i.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!Z("SUBSCRIBE_TWCC"),rtx:!!Z("USE_SUB_RTX"),extend:Z("SUB_EXTEND"),ssrcId:i.ssrcId,svc:Array.isArray(Z("SVC"))&&Z("SVC").length!==0?Z("SVC"):void 0};try{return(await this.signal.request(Dt.SUBSCRIBE,c,!0))._message}catch(u){if(o&&u.data&&u.data.code===Ct.ERR_SUBSCRIBE_REQUEST_INVALID)return k.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),u.toString()),await this.tryUnsubBeforeResub(n,i),await this.subscribe(n,i,!1);throw u}}async subscribeDataChannel(n,i,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new be(Y.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const c={uid:n,stream_id:i.id,channel_id:i.datachannelId};try{return void await this.signal.request(Dt.SUBSCRIBE_DATASTREAM,c,!0)}catch(u){if(o&&u.data&&u.data.code===Ct.ERR_SUBSCRIBE_REQUEST_INVALID)return k.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),u.toString()),await this.tryUnsubDataChannelBeforeResub(n,i),await this.subscribeDataChannel(n,i,!1);throw u}}async subscribeAll(n,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new be(Y.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const o={p2p_id:this.store.p2pId,users:n,dtx:!1,rtx:!!Z("USE_SUB_RTX"),twcc:!!Z("SUBSCRIBE_TWCC"),svc:Array.isArray(Z("SVC"))&&Z("SVC").length!==0?Z("SVC"):void 0};try{return await this.signal.request(Dt.SUBSCRIBE_STREAMS,o,!0)}catch(c){if(i&&c.data&&c.data.code===Ct.ERR_SUBSCRIBE_REQUEST_INVALID)return k.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),c.toString()),await this.tryMassUnsubBeforeResub(n),await this.subscribeAll(n,!1);throw c}}async setVideoProfile(n){const i=function(o){if(!(o.bitrateMax&&o.bitrateMin&&o.frameRate&&o.height&&o.width))return;let c=o.frameRate,u=o.width,h=o.height,m=!0;return typeof c!="number"&&(c=c.exact||c.ideal||c.max||c.min||0,c||(m=!1)),typeof u!="number"&&(u=u.exact||u.ideal||u.max||u.min||0,u||(m=!1)),typeof h!="number"&&(h=h.exact||h.ideal||h.max||h.min||0,c||(m=!1)),m?{stream_type:0,width:u,height:h,fps:c,start_bps:1e3*o.bitrateMax,min_bps:1e3*o.bitrateMin,target_bps:1e3*o.bitrateMax}:void 0}(n);if(i)return this.signal.request(Dt.SET_VIDEO_PROFILE,i);k.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(n,i){try{await this.signal.request(Dt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:n,stream_id:i},!0)}catch(o){k.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),o)}}async unsubscribeDataChannel(n,i){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new be(Y.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await tt.all(n.map(o=>this.signal.request(Dt.UNSUBSCRIBE_DATASTREAM,{stream_id:o,uid:i},!0)))}catch(o){k.warning("unsubscribeDataChannel warning: ",o)}}async massUnsubscribe(n){try{await this.signal.request(Dt.UNSUBSCRIBE_STREAMS,n,!0)}catch(i){k.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),i)}}async reconnectPC(n){const{iceParameters:i,dtlsParameters:o,rtpCapabilities:c}=n;return{gatewayEstablishParams:await this.signal.request(Dt.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:i,dtlsParameters:o,rtpCapabilities:c}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(Dt.GATEWAY_INFO)}async renewToken(n){await this.signal.request(Dt.RENEW_TOKEN,n),this.key=n.token}updateClientRole(n,i){i&&(this._clientRoleOptions=Object.assign({},i)),Z("CLIENT_ROLE_OPTIONS")&&(k.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(Z("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},Z("CLIENT_ROLE_OPTIONS"))),this.role=n}async setClientRole(n,i){if(i&&(this._clientRoleOptions=Object.assign({},i)),Z("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},Z("CLIENT_ROLE_OPTIONS")),k.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(Z("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),this.state!=="CONNECTED")return void(this.role=n);let o,c=0;n==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(o=this._clientRoleOptions.delay,c=1):c=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:c=0,await this.signal.request(Dt.SET_CLIENT_ROLE,{role:n,level:c,delay:o,client_ts:Date.now()}),this.role=n}async setRemoteVideoStreamType(n,i){await this.signal.request(Dt.SWITCH_VIDEO_STREAM,{stream_id:n,stream_type:i})}async setDefaultRemoteVideoStreamType(n){await this.signal.request(Dt.DEFAULT_VIDEO_STREAM,{stream_type:n})}async setStreamFallbackOption(n,i){await this.signal.request(Dt.SET_FALLBACK_OPTION,{stream_id:n,fallback_type:i})}async pickSVCLayer(n,i){await this.signal.request(Dt.PICK_SVC_LAYER,{stream_id:n,spatial_layer:i.spatialLayer,temporal_layer:i.temporalLayer})}async setRTM2Flag(n){await this.signal.request(Dt.SET_RTM2_FLAG,{rtm2_flag:n})}async sendExtensionMessage(n,i,o){if(this.store.useP2P)return this.signal.sendExtensionMessage(n,i,o)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),kf({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(Dt.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const n=ex.get(this.joinInfo.cname);n&&n.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const n=function(i){let o;return o=i.startsWith("dc")?i.match(/(dc\:\/\/)?([^:]+):(\d+)/):i.match(/(wss\:\/\/)?([^:]+):(\d+)/),o?{username:hs.username,password:hs.password,turnServerURL:o[2],tcpport:parseInt(o[3])+30,udpport:parseInt(o[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],n&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(kf(kf({},hs),{},{turnServerURL:n.turnServerURL,tcpport:n.tcpport,udpport:n.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const n=await this.signal.request(Dt.TRAFFIC_STATS,void 0,!0);n.timestamp=Date.now(),n.ntp_offset!=null&&(this.ntpOffset=n.ntp_offset),n.peer_delay.forEach(i=>{const o=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(c=>c.peer_uid===i.peer_uid);o&&o.B_st!==i.B_st&&tA(()=>{this.emit(ji.STREAM_TYPE_CHANGE,i.peer_uid,i.B_st)})}),this._statsCollector.updateTrafficStats(n)}getJoinMessage(n){if(!this.joinInfo||!this.key)throw new be(Y.UNEXPECTED_ERROR,"can not generate join message, no join info");const i=Object.assign({},this.joinInfo.apResponse);let o=Z("REPORT_APP_SCENARIO");if(typeof o!="string")try{o=JSON.stringify(o)}catch{o=void 0}var c;o&&o.length>128&&(o=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(ji.UPDATE_GATEWAY_CONFIG),c=this.store.clientId,Xe(uv).call(uv,c)||uv.push(c);const u=!(Pr()||D6(87)||TW())&&typeof Z("ENABLE_PRE_SUB")=="boolean"&&Z("ENABLE_PRE_SUB"),h=!TW()&&sl("ENABLE_PREALLOC_PC","boolean"),m=Jfe(),_=O0(87)||function(){const S=Tn();if(S.name!==Ln.SAFARI||!S.browserVersion)return!1;const w=S.browserVersion.split(".");return Number(w[0])>15||Number(w[0])===15&&Number(w[1])>=4}(),y=kf({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:tl,browser:navigator.userAgent,process_id:Z("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:i,extend:Z("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:o,attributes:{userAttributes:kf({enableEncodedTransform:!!Z("ENABLE_AUDIO_METADATA")&&_||!!Z("ENABLE_AUDIO_TOPN")&&q1(Ln.CHROME,87,116)||void 0,enableAudioMetadata:!!Z("ENABLE_AUDIO_METADATA")&&_,enableAudioPts:!!Z("ENABLE_AUDIO_PTS_METADATA")&&_,topnSmoothLevel:Z("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:Z("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:Z("TOPN_SWITCH_HOLD_MS"),topnAudioGain:Z("TOPN_AUDIO_GAIN"),enablePublishedUserList:Z("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:Z("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:sl("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:sl("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:sl("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:Z("USE_PUB_RTX")===!0||Z("USE_SUB_RTX")===!0||void 0,disableFEC:Z("DISABLE_FEC"),enableNTPReport:!!Z("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:!!Z("ENABLE_INSTANT_VIDEO")||void 0,enableFulllinkAvSync:!!Z("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:sl("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!Z("ENABLE_AUT_FEEDBACK")||void 0,rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!Z("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:sl("USE_XR","boolean"),enableLossbasedBwe:sl("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!Z("ENABLE_AUT_CC")||void 0,enableCCFallback:sl("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:h,preSubNum:u?sl("PRE_SUB_NUM","number"):void 0,enablePubTWCC:sl("PUBLISH_TWCC","boolean"),enableSubTWCC:sl("SUBSCRIBE_TWCC","boolean"),enablePubRTX:sl("USE_PUB_RTX","boolean"),enableSubRTX:sl("USE_SUB_RTX","boolean"),enableSubSVC:Z("ENABLE_SVC")?Z("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(Z("SVC"))&&Z("SVC").length!==0?Z("SVC"):void 0,enableSvcExtended:Z("ENABLE_SVC")&&Array.isArray(Z("SVC_EXTENDED"))&&Z("SVC_EXTENDED").length!==0?Z("SVC_EXTENDED"):void 0},m)},join_ts:this.joinGatewayStartTime},n);return this.joinInfo.stringUid&&(y.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(y.aes_mode=this.joinInfo.aesmode,Z("ENCRYPT_AES")?(y.aes_secret=this.joinInfo.aespassword,y.aes_encrypt=!0):y.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(y.aes_salt=this.joinInfo.aessalt)),i.addresses[this.signal.websocket.currentURLIndex]&&(y.ap_response.ticket=i.addresses[this.signal.websocket.currentURLIndex].ticket,delete i.addresses),this.joinInfo.defaultVideoStream!==void 0&&(y.default_video_stream=this.joinInfo.defaultVideoStream),y}getRejoinMessage(){if(!this.joinInfo)throw new be(Y.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(Lt.WS_RECONNECT_CREATE_CONNECTION,n=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(Lt.WS_RECONNECTING,n=>{this.joinInfo&&yt.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:n||us.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",yt.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(Lt.WS_CLOSED,n=>{let i;switch(n){case Vn.LEAVE:i=us.LEAVE;break;case Vn.UID_BANNED:case Vn.IP_BANNED:case Vn.CHANNEL_BANNED:case Vn.SERVER_ERROR:i=us.SERVER_ERROR;break;case Vn.FALLBACK:i=us.FALLBACK;break;case Vn.LICENSE_MISSING:case Vn.LICENSE_EXPIRED:case Vn.LICENSE_MINUTES_EXCEEDED:case Vn.LICENSE_PERIOD_INVALID:case Vn.LICENSE_MULTIPLE_SDK_SERVICE:case Vn.LICENSE_ILLEGAL:case Vn.TOKEN_EXPIRE:i=n;break;default:i=us.NETWORK_ERROR}k.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(i||"undefined -> "+us.NETWORK_ERROR)),this.joinInfo&&yt.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:n===Vn.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:i}),this._disconnectedReason=n,n!==Vn.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(Lt.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if(this.role==="audience"){const n=Z("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;n&&(n.level||n.delay)&&(k.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(n.level,", delay: ").concat(n.delay)),this.setClientRole(this.role,n))}if(yt.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1){const n=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!n)return void k.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(n));qn("EVENT_REPORT_DOMAIN",n[1]),qn("EVENT_REPORT_BACKUP_DOMAIN",n[1]),qn("LOG_UPLOAD_SERVER","".concat(n[1],":6444"))}}}),this.signal.on(ln.ON_UPLINK_STATS,n=>{this._statsCollector.updateUplinkStats(n)}),this.signal.on(Lt.REQUEST_RECOVER,(n,i,o)=>{if(!this.joinInfo)return o(new be(Y.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));n&&(this.joinInfo.multiIP=n,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,ds(this,ji.REQUEST_NEW_GATEWAY_LIST).then(i).catch(o)}),this.signal.on(Lt.REQUEST_JOIN_INFO,async(n,i,o)=>{var c;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void n(this.getJoinMessage({ortc:{}}));const u=Dr((c=this.joinInfo)===null||c===void 0?void 0:c.turnServer);if(Z("NEW_TURN_MODE")&&u){let y=u.servers,S=u.serversFromGateway;const w=this.signal.currentURLIndex;y.length>0&&(y=[y[w%y.length]],u.servers=y),Array.isArray(S)&&S.length>0&&(S=[S[0]],u.serversFromGateway=S),k.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(w))}const{iceParameters:h,dtlsParameters:m,rtpCapabilities:_}=await ds(this,ji.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:u});try{n(this.getJoinMessage({ortc:{iceParameters:h,dtlsParameters:m,rtpCapabilities:_,version:"2"}}))}catch(y){i(y)}}),this.signal.on(Lt.REQUEST_REJOIN_INFO,n=>{n(this.getRejoinMessage())}),this.signal.on(Lt.REPORT_JOIN_GATEWAY,(n,i)=>{if(!this.joinInfo)return;let o,c="";var u;n instanceof be?(o=((u=n.data)===null||u===void 0?void 0:u.desc)||n.code,c=n.message):o=n,yt.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:o,errorMsg:c,addr:i,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload})}),this.signal.on(Lt.IS_P2P_DISCONNECTED,n=>{n(L0(this,ji.IS_P2P_DISCONNECTED))}),this.signal.on(Lt.DISCONNECT_P2P,()=>{this.emit(ji.DISCONNECT_P2P)}),this.signal.on(Lt.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(Lt.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(Lt.JOIN_RESPONSE,n=>{const i=this.getCurrentGatewayAddress();this.emit(ji.JOIN_RESPONSE,n,i)}),this.signal.on(Lt.PRE_CONNECT_PC,async()=>{if(this.joinInfo){this.updateTurnConfigFromSignal();const n=this.getCurrentGatewayAddress(),i=Z("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(n&&i){const o=rH(n);this.emit(ji.PRE_CONNECT_PC,{candidates:o,fingerprint:i})}}}),this.signal.on(Lt.RECOVER_NOTIFICATION,n=>{this.joinInfo&&typeof Z("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat(Z("AP_REQUEST_DETAIL"),";").concat(n))})}async tryUnsubBeforeResub(n,i){try{await this.signal.request(Dt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:n,ortc:[i]},!0)}catch(o){throw k.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),o),o}}async tryUnsubDataChannelBeforeResub(n,i){try{await this.signal.request(Dt.UNSUBSCRIBE,{stream_id:i.id},!0)}catch(o){throw k.warning("unsubscribe datachannel warning",o),o}}async tryUnpubBeforeRepub(n,i){try{await this.signal.request(Dt.UNPUBLISH,{stream_id:n,ortc:i},!0)}catch(o){throw k.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),o),o}}async tryUnpubDataChannelBeforeRepub(n,i){try{await this.signal.request(Dt.UNPUBLISH_DATASTREAM,{channnel_id:i.channelId},!0)}catch(o){throw k.warning("unpublish datastream warning: ",o),o}}async tryMassUnsubBeforeResub(n){const i={users:n.map(o=>({stream_id:o.stream_id,stream_type:o.stream_type}))};try{await this.signal.request(Dt.UNSUBSCRIBE_STREAMS,i,!0)}catch(o){throw k.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),o),o}}async muteLocal(n,i){const o={action:n.find(c=>c.stream_type===jn.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:n,stream_id:i};try{await this.signal.request(Dt.CONTROL,o,!0,!0)}catch(c){throw k.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),c),c}}async unmuteLocal(n,i){const o={action:n.find(c=>c.stream_type===jn.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:n,stream_id:i};try{await this.signal.request(Dt.CONTROL,o,!0,!0)}catch(c){throw k.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),c),c}}async muteRemote(n,i){const o={action:n===at.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:i};try{await this.signal.request(Dt.CONTROL,o,!0,!0)}catch(c){throw k.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),c),c}}async unmuteRemote(n,i){const o={action:n===at.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:i};try{await this.signal.request(Dt.CONTROL,o,!0,!0)}catch(c){throw k.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),c),c}}uploadWRTCStats(n){this.signal.uploadWRTCStats(n)}upload(n,i){this.signal.upload(n,i)}getSignalRTT(){return this.signal.rtt}async restartICE(n){const i={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:n};try{return await this.signal.request(Dt.RESTART_ICE,i,!0)}catch(o){throw k.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),o),o}}reconnect(n,i){this.state==="CONNECTED"&&this.signal.reconnect(n||void 0,i||us.P2P_FAILED)}getCurrentGatewayAddress(){var n,i;if(!Z("GATEWAY_WSS_ADDRESS"))return Z("USE_CANDIDATE_FROM_AP_DETAIL")&&(n=this.joinInfo)!==null&&n!==void 0&&n.apGatewayAddress?(k.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(i=this.joinInfo)!==null&&i!==void 0&&i.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(n){await this.signal.request(Dt.SET_PARAMETER,{enablePublishAudioFilter:n})}}let MA=0,tx=0;function Qu(e,n,i,o){return new tt((c,u)=>{n.timeout=n.timeout||Z("HTTP_CONNECT_TIMEOUT"),n.responseType=n.responseType||"json",n.data&&!i?(n.data=JSON.stringify(n.data),MA+=Gd(n.data)):i&&(n.data.size?MA+=n.data.size:n.data instanceof FormData?MA+=J6(n.data):MA+=Gd(JSON.stringify(n.data))),n.headers=n.headers||{},n.headers["Content-Type"]=n.headers["Content-Type"]||"application/json",n.method="POST",n.url=e,Mo.request(n).then(h=>{typeof h.data=="string"?tx+=Gd(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?tx+=h.data.byteLength:tx+=Gd(JSON.stringify(h.data)),o&&c({data:h.data,headers:h.headers}),c(h.data)}).catch(h=>{Mo.isCancel(h)?u(new be(Y.OPERATION_ABORTED,"cancel token canceled")):h.code==="ECONNABORTED"?u(new be(Y.NETWORK_TIMEOUT,h.message)):h.response?u(new be(Y.NETWORK_RESPONSE_ERROR,h.response.status)):u(new be(Y.NETWORK_ERROR,h.message))})})}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var e;function n(ke){var Ye=0;return function(){return Ye<ke.length?{done:!1,value:ke[Ye++]}:{done:!0}}}var i=typeof Object.defineProperties=="function"?Object.defineProperty:function(ke,Ye,ft){return ke==Array.prototype||ke==Object.prototype||(ke[Ye]=ft.value),ke},o,c=function(ke){ke=[typeof globalThis=="object"&&globalThis,ke,typeof window=="object"&&window,typeof self=="object"&&self,typeof a=="object"&&a];for(var Ye=0;Ye<ke.length;++Ye){var ft=ke[Ye];if(ft&&ft.Math==Math)return ft}throw Error("Cannot find global object")}(this);function u(ke,Ye){if(Ye)e:{var ft=c;ke=ke.split(".");for(var xe=0;xe<ke.length-1;xe++){var L=ke[xe];if(!(L in ft))break e;ft=ft[L]}(Ye=Ye(xe=ft[ke=ke[ke.length-1]]))!=xe&&Ye!=null&&i(ft,ke,{configurable:!0,writable:!0,value:Ye})}}function h(ke){return(ke={next:ke})[Symbol.iterator]=function(){return this},ke}function m(ke){var Ye=typeof Symbol<"u"&&Symbol.iterator&&ke[Symbol.iterator];return Ye?Ye.call(ke):{next:n(ke)}}if(u("Symbol",function(ke){function Ye(L,te){this.A=L,i(this,"description",{configurable:!0,writable:!0,value:te})}if(ke)return ke;Ye.prototype.toString=function(){return this.A};var ft="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",xe=0;return function L(te){if(this instanceof L)throw new TypeError("Symbol is not a constructor");return new Ye(ft+(te||"")+"_"+xe++,te)}}),u("Symbol.iterator",function(ke){if(ke)return ke;ke=Symbol("Symbol.iterator");for(var Ye="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),ft=0;ft<Ye.length;ft++){var xe=c[Ye[ft]];typeof xe=="function"&&typeof xe.prototype[ke]!="function"&&i(xe.prototype,ke,{configurable:!0,writable:!0,value:function(){return h(n(this))}})}return ke}),typeof Object.setPrototypeOf=="function")o=Object.setPrototypeOf;else{var _;e:{var y={};try{y.__proto__={a:!0},_=y.a;break e}catch{}_=!1}o=_?function(ke,Ye){if(ke.__proto__=Ye,ke.__proto__!==Ye)throw new TypeError(ke+" is not extensible");return ke}:null}var S=o;function w(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function I(ke){if(ke.m)throw new TypeError("Generator is already running");ke.m=!0}function P(ke,Ye){return ke.h=3,{value:Ye}}function B(ke){this.g=new w,this.G=ke}function M(ke,Ye,ft,xe){try{var L=Ye.call(ke.g.j,ft);if(!(L instanceof Object))throw new TypeError("Iterator result "+L+" is not an object");if(!L.done)return ke.g.m=!1,L;var te=L.value}catch(ce){return ke.g.j=null,ke.g.s(ce),U(ke)}return ke.g.j=null,xe.call(ke.g,te),U(ke)}function U(ke){for(;ke.g.h;)try{var Ye=ke.G(ke.g);if(Ye)return ke.g.m=!1,{value:Ye.value,done:!1}}catch(ft){ke.g.v=void 0,ke.g.s(ft)}if(ke.g.m=!1,ke.g.l){if(Ye=ke.g.l,ke.g.l=null,Ye.F)throw Ye.D;return{value:Ye.return,done:!0}}return{value:void 0,done:!0}}function q(ke){this.next=function(Ye){return ke.o(Ye)},this.throw=function(Ye){return ke.s(Ye)},this.return=function(Ye){return function(ft,xe){I(ft.g);var L=ft.g.j;return L?M(ft,"return"in L?L.return:function(te){return{value:te,done:!0}},xe,ft.g.return):(ft.g.return(xe),U(ft))}(ke,Ye)},this[Symbol.iterator]=function(){return this}}function $(ke,Ye){return Ye=new q(new B(Ye)),S&&ke.prototype&&S(Ye,ke.prototype),Ye}if(w.prototype.o=function(ke){this.v=ke},w.prototype.s=function(ke){this.l={D:ke,F:!0},this.h=this.C||this.u},w.prototype.return=function(ke){this.l={return:ke},this.h=this.u},B.prototype.o=function(ke){return I(this.g),this.g.j?M(this,this.g.j.next,ke,this.g.o):(this.g.o(ke),U(this))},B.prototype.s=function(ke){return I(this.g),this.g.j?M(this,this.g.j.throw,ke,this.g.o):(this.g.s(ke),U(this))},u("Array.prototype.entries",function(ke){return ke||function(){return function(Ye,ft){Ye instanceof String&&(Ye+="");var xe=0,L=!1,te={next:function(){if(!L&&xe<Ye.length){var ce=xe++;return{value:ft(ce,Ye[ce]),done:!1}}return L=!0,{done:!0,value:void 0}}};return te[Symbol.iterator]=function(){return te},te}(this,function(Ye,ft){return[Ye,ft]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var ae=function(ke,Ye){for(var ft=0;ft<ke.length;ft++)Ye(ke[ft])},me=function(ke){return ke.replace(/\r?\n|\r/g,`\r
`)},ge=function(ke,Ye,ft){return Ye instanceof Blob?(ft=ft!==void 0?ft+"":typeof Ye.name=="string"?Ye.name:"blob",Ye.name===ft&&Object.prototype.toString.call(Ye)!=="[object Blob]"||(Ye=new File([Ye],ft)),[String(ke),Ye]):[String(ke),String(Ye)]},pe=function(ke,Ye){if(ke.length<Ye)throw new TypeError(Ye+" argument required, but only "+ke.length+" present.")},we=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,Be=we.FormData,nt=we.XMLHttpRequest&&we.XMLHttpRequest.prototype.send,st=we.Request&&we.fetch,pn=we.navigator&&we.navigator.sendBeacon,mn=we.Element&&we.Element.prototype,sr=we.Symbol&&Symbol.toStringTag;sr&&(Blob.prototype[sr]||(Blob.prototype[sr]="Blob"),"File"in we&&!File.prototype[sr]&&(File.prototype[sr]="File"));try{new File([],"")}catch{we.File=function(Ye,ft,xe){return Ye=new Blob(Ye,xe||{}),Object.defineProperties(Ye,{name:{value:ft},lastModified:{value:+(xe&&xe.lastModified!==void 0?new Date(xe.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),sr&&Object.defineProperty(Ye,sr,{value:"File"}),Ye}}var Xr=function(ke){return ke.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},Fr=function(ke){this.i=[];var Ye=this;ke&&ae(ke.elements,function(ft){if(ft.name&&!ft.disabled&&ft.type!=="submit"&&ft.type!=="button"&&!ft.matches("form fieldset[disabled] *"))if(ft.type==="file"){var xe=ft.files&&ft.files.length?ft.files:[new File([],"",{type:"application/octet-stream"})];ae(xe,function(L){Ye.append(ft.name,L)})}else ft.type==="select-multiple"||ft.type==="select-one"?ae(ft.options,function(L){!L.disabled&&L.selected&&Ye.append(ft.name,L.value)}):ft.type==="checkbox"||ft.type==="radio"?ft.checked&&Ye.append(ft.name,ft.value):(xe=ft.type==="textarea"?me(ft.value):ft.value,Ye.append(ft.name,xe))})};if((e=Fr.prototype).append=function(ke,Ye,ft){pe(arguments,2),this.i.push(ge(ke,Ye,ft))},e.delete=function(ke){pe(arguments,1);var Ye=[];ke=String(ke),ae(this.i,function(ft){ft[0]!==ke&&Ye.push(ft)}),this.i=Ye},e.entries=function ke(){var Ye,ft=this;return $(ke,function(xe){if(xe.h==1&&(Ye=0),xe.h!=3)return Ye<ft.i.length?xe=P(xe,ft.i[Ye]):(xe.h=0,xe=void 0),xe;Ye++,xe.h=2})},e.forEach=function(ke,Ye){pe(arguments,1);for(var ft=m(this),xe=ft.next();!xe.done;xe=ft.next()){var L=m(xe.value);xe=L.next().value,L=L.next().value,ke.call(Ye,L,xe,this)}},e.get=function(ke){pe(arguments,1);var Ye=this.i;ke=String(ke);for(var ft=0;ft<Ye.length;ft++)if(Ye[ft][0]===ke)return Ye[ft][1];return null},e.getAll=function(ke){pe(arguments,1);var Ye=[];return ke=String(ke),ae(this.i,function(ft){ft[0]===ke&&Ye.push(ft[1])}),Ye},e.has=function(ke){pe(arguments,1),ke=String(ke);for(var Ye=0;Ye<this.i.length;Ye++)if(this.i[Ye][0]===ke)return!0;return!1},e.keys=function ke(){var Ye,ft,xe,L,te=this;return $(ke,function(ce){if(ce.h==1&&(Ye=m(te),ft=Ye.next()),ce.h!=3)return ft.done?void(ce.h=0):(xe=ft.value,L=m(xe),P(ce,L.next().value));ft=Ye.next(),ce.h=2})},e.set=function(ke,Ye,ft){pe(arguments,2),ke=String(ke);var xe=[],L=ge(ke,Ye,ft),te=!0;ae(this.i,function(ce){ce[0]===ke?te&&(te=!xe.push(L)):xe.push(ce)}),te&&xe.push(L),this.i=xe},e.values=function ke(){var Ye,ft,xe,L,te=this;return $(ke,function(ce){if(ce.h==1&&(Ye=m(te),ft=Ye.next()),ce.h!=3)return ft.done?void(ce.h=0):(xe=ft.value,(L=m(xe)).next(),P(ce,L.next().value));ft=Ye.next(),ce.h=2})},Fr.prototype._asNative=function(){for(var ke=new Be,Ye=m(this),ft=Ye.next();!ft.done;ft=Ye.next()){var xe=m(ft.value);ft=xe.next().value,xe=xe.next().value,ke.append(ft,xe)}return ke},Fr.prototype._blob=function(){var ke="----formdata-polyfill-"+Math.random(),Ye=[],ft="--"+ke+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(xe,L){return typeof xe=="string"?Ye.push(ft+Xr(me(L))+`"\r
\r
`+me(xe)+`\r
`):Ye.push(ft+Xr(me(L))+'"; filename="'+Xr(xe.name)+`"\r
Content-Type: `+(xe.type||"application/octet-stream")+`\r
\r
`,xe,`\r
`)}),Ye.push("--"+ke+"--"),new Blob(Ye,{type:"multipart/form-data; boundary="+ke})},Fr.prototype[Symbol.iterator]=function(){return this.entries()},Fr.prototype.toString=function(){return"[object FormData]"},mn&&!mn.matches&&(mn.matches=mn.matchesSelector||mn.mozMatchesSelector||mn.msMatchesSelector||mn.oMatchesSelector||mn.webkitMatchesSelector||function(ke){for(var Ye=(ke=(this.document||this.ownerDocument).querySelectorAll(ke)).length;0<=--Ye&&ke.item(Ye)!==this;);return-1<Ye}),sr&&(Fr.prototype[sr]="FormData"),nt){var Wo=we.XMLHttpRequest.prototype.setRequestHeader;we.XMLHttpRequest.prototype.setRequestHeader=function(ke,Ye){Wo.call(this,ke,Ye),ke.toLowerCase()==="content-type"&&(this.B=!0)},we.XMLHttpRequest.prototype.send=function(ke){ke instanceof Fr?(ke=ke._blob(),this.B||this.setRequestHeader("Content-Type",ke.type),nt.call(this,ke)):nt.call(this,ke)}}st&&(we.fetch=function(ke,Ye){return Ye&&Ye.body&&Ye.body instanceof Fr&&(Ye.body=Ye.body._blob()),st.call(this,ke,Ye)}),pn&&(we.navigator.sendBeacon=function(ke,Ye){return Ye instanceof Fr&&(Ye=Ye._asNative()),pn.call(this,ke,Ye)}),we.FormData=Fr}})();const Y0=()=>{const e=Z("AREAS");return e.length===0&&e.push(xn.GLOBAL),Da(e).call(e,(n,i,o)=>{const c=gH(i);return c?o===0?c:"".concat(n,",").concat(c):n},"")},gH=e=>e===xn.OVERSEA?"".concat(ys.ASIA,",").concat(ys.EUROPE,",").concat(ys.AFRICA,",").concat(ys.NORTH_AMERICA,",").concat(ys.SOUTH_AMERICA,",").concat(ys.OCEANIA):ys[e],Zfe=e=>{const n={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return e.map(i=>{const o=AA[i],c=Object.keys(o);c&&c.map(u=>{u!=="CODE"&&(n[u]=n[u].concat(o[u]))})}),n},UA={GLOBAL:{ASIA:[xn.CHINA,xn.JAPAN,xn.INDIA,xn.KOREA,xn.HKMC],EUROPE:[],NORTH_AMERICA:[xn.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},VA=Object.keys(UA[xn.GLOBAL]),nx=[xn.CHINA,xn.NORTH_AMERICA,xn.EUROPE,xn.ASIA,xn.JAPAN,xn.INDIA,xn.OCEANIA,xn.SOUTH_AMERICA,xn.AFRICA,xn.KOREA,xn.HKMC,xn.US],epe=function(e,n){let i=[];if(Xe(e).call(e,xn.GLOBAL)){const u=[xn.GLOBAL,xn.OVERSEA],h=Object.keys(AA);if(n===xn.GLOBAL)throw new be(Y.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(n===xn.CHINA)i=[xn.OVERSEA];else if(c=n,Xe(VA).call(VA,c)){const m=(o=n,UA[xn.GLOBAL][o]||[]),_=[...u,n,...m];i=h.filter(y=>!Xe(_).call(_,y))}else if(function(m){let _=!1;return VA.forEach(y=>{var S;Xe(S=UA[xn.GLOBAL][y]).call(S,m)&&(_=!0)}),_}(n)){const m=function(y){let S;return VA.forEach(w=>{var I;Xe(I=UA[xn.GLOBAL][w]).call(I,y)&&(S=w)}),S}(n),_=[...u,m,n];i=h.filter(y=>!Xe(_).call(_,y))}else i=e;i=function(m){const _=[];return nx.forEach(y=>{Xe(m).call(m,y)&&_.push(y)}),_.concat(m.filter(y=>!Xe(nx).call(nx,y)))}(i)}else i=e;var o,c;return i};function _H(e){var n,i;if(!e&&Xe(n=Z("AREAS")).call(n,xn.EXTENSIONS))return k.debug("update area from ap : reset"),void rx(lfe,!0);if(!Xe(i=Z("AREAS")).call(i,xn.GLOBAL)||!e)return;let o=AA.EXTENSIONS;o&&(o={CODE:gH(xn.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e,".agora.io"),"cds-ap-web-2-".concat(e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e,".agora.io"),"sua-ap-web-2-".concat(e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e,".agora.io"),"uap-ap-web-2-".concat(e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e,".agora.io")]},k.debug("update area from ap success: ".concat(e,",config is "),o),qn("AREAS",[xn.EXTENSIONS],!0),Object.keys(o).map(c=>{c==="LOG_UPLOAD_SERVER"||c==="EVENT_REPORT_DOMAIN"||c==="EVENT_REPORT_BACKUP_DOMAIN"||c==="PROXY_SERVER_TYPE3"?qn(c,o[c][0]):qn(c,o[c])}))}function rx(e){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const i=yt.reportApiInvoke(null,{name:fi.SET_AREA,options:e,tag:kr.TRACER});try{let o=[];if(typeof e=="string"&&(o=[e]),Array.isArray(e)&&(e.forEach(u=>{if(!Xe(Uz).call(Uz,u))throw new be(Y.INVALID_PARAMS,"invalid area code")}),o=e),Object.prototype.toString.call(e)==="[object Object]"){const{areaCode:u,excludedArea:h}=e;if(!u)throw new be(Y.INVALID_PARAMS,"area code is needed");let m=u;typeof u=="string"&&(m=[u]),o=h?epe(m,h):m}if(!n){if($u.AREAS){const u=new be(Y.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return i.onError(u),void k.warning("setArea is prohibited because of config-distribute")}if(Xe(o).call(o,xn.GLOBAL)&&Z("AREAS")===xn.EXTENSIONS){const u=new be(Y.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return i.onError(u),void k.warning("setArea is prohibited because of ap extensions")}}qn("AREAS",o,n);const c=Zfe(o);Object.keys(c).map(u=>{u==="LOG_UPLOAD_SERVER"||u==="EVENT_REPORT_DOMAIN"||u==="EVENT_REPORT_BACKUP_DOMAIN"||u==="PROXY_SERVER_TYPE3"?qn(u,c[u][0]):qn(u,c[u])}),k.debug("set area success:",o.join(","))}catch(o){throw i.onError(o),o}i.onSuccess()}function EH(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function Yd(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?EH(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):EH(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}let ix=1;function tpe(e,n,i,o,c){ix+=1;const u={sid:i.sid,command:"convergeAllocateEdge",uid:"666",appId:i.appId,ts:Math.floor(Date.now()/1e3),seq:ix,requestId:ix,version:tl,cname:i.cname},h={service_name:n,json_body:JSON.stringify(u)};let m,_,y=e[0];return qu(async()=>{m=Date.now();const S=await Qu(y,{data:h,cancelToken:o,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(_=Date.now()-m,S.code!==0){const P=new be(Y.UNEXPECTED_RESPONSE,"live streaming ap error, code"+S.code,{retry:!0,responseTime:_});throw k.error(P.toString()),P}const w=JSON.parse(S.json_body);if(w.code!==200){const P=new be(Y.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(w.code,", reason: ").concat(w.reason),{code:w.code,responseTime:_});throw k.error(P.toString()),P}if(!w.servers||w.servers.length===0){const P=new be(Y.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:w.code,responseTime:_});throw k.error(P.toString()),P}const I=function(P,B){return{addressList:P.servers.map(M=>"wss://".concat(M.address.replace(/\./g,"-"),".").concat(Z("WORKER_DOMAIN"),":").concat(M.wss,"?serviceName=").concat(encodeURIComponent(B))),workerToken:P.workerToken,vid:P.vid}}(w,n);return Z("LIVE_STREAMING_ADDRESS")&&(I.addressList=Z("LIVE_STREAMING_ADDRESS")instanceof Array?Z("LIVE_STREAMING_ADDRESS"):[Z("LIVE_STREAMING_ADDRESS")]),Yd(Yd({},I),{},{responseTime:_})},(S,w)=>(yt.apworkerEvent(i.sid,{success:!0,sc:200,serviceName:n,responseDetail:JSON.stringify(S.addressList),firstSuccess:w===0,responseTime:_,serverIp:e[w%e.length]}),!1),(S,w)=>(yt.apworkerEvent(i.sid,{success:!1,sc:S.data&&S.data.code||200,serviceName:n,responseTime:_,serverIp:e[w%e.length]}),!!(S.code!==Y.OPERATION_ABORTED&&S.code!==Y.UNEXPECTED_RESPONSE||S.data&&S.data.retry)&&(y=e[(w+1)%e.length],!0)),c)}let sx=1;function yH(e,n,i,o){let{url:c,areaCode:u}=e;const{clientId:h,sid:m}=n,_=Date.now();let y;const S=n.role,[w,I]=ax(n,u,[ii.CHOOSE_SERVER]);let P=ri.networkState;return qu(async()=>{P&&ri.networkState===ja.OFFLINE&&ri.onlineWaiter&&await tt.race([ri.onlineWaiter,$i(o&&o.maxRetryTimeout||pi.maxRetryTimeout)]),P=ri.networkState;const{data:B,headers:M}=await Qu(c,{data:w,cancelToken:i,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);y=M.http3==="1"?1:-1,yt.reportResourceTiming(c,m),SH(B,c,n,_,[ii.CHOOSE_SERVER],y);const U=H0(B,ii.CHOOSE_SERVER);return ox(U),YL(U,c)},B=>(B&&yt.joinChooseServer(m,{role:S,lts:_,succ:!0,csAddr:c,opid:I,serverList:B.gatewayAddrs.map(M=>M.address),ec:null,cid:B.cid.toString(),uid:B.uid.toString(),csIp:B.csIp,unilbsServerIds:[ii.CHOOSE_SERVER].toString(),isHttp3:y,corssRegionTagReq:n.apRequestDetail,corssRegionTagRes:B.res.detail&&B.res.detail[38]}),!1),B=>B.code!==Y.OPERATION_ABORTED&&(B.code===Y.CAN_NOT_GET_GATEWAY_SERVER?B.data.retry:(yt.joinChooseServer(m,{role:S,lts:_,succ:!1,csAddr:c,serverList:null,opid:I,ec:B.code,csIp:B.data&&B.data.csIp,unilbsServerIds:[ii.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:P}),isHttp3:y,corssRegionTagReq:n.apRequestDetail}),k.warning("[".concat(h||"sid-".concat(m.slice(0,6)),"] Choose server network error, retry"),B),!0)),o)}function vH(e,n,i,o){let c,{url:u,areaCode:h,serviceIds:m}=e;const _=Date.now(),y=n.role,[S,w]=ax(n,h,m);let I;return qu(async()=>{I&&ri.networkState===ja.OFFLINE&&ri.onlineWaiter&&await tt.race([ri.onlineWaiter,$i(o&&o.maxRetryTimeout||pi.maxRetryTimeout)]),I=ri.networkState;const{data:P,headers:B}=await Qu(u,{data:S,cancelToken:i,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);c=B.http3==="1"?1:-1,yt.reportResourceTiming(u,n.sid),SH(P,u,n,_,m,c);const M=H0(P,ii.CHOOSE_SERVER),U=H0(P,n.cloudProxyServer==="proxy5"?ii.CLOUD_PROXY_5:n.cloudProxyServer==="proxy3"||n.cloudProxyServer==="proxy4"?ii.CLOUD_PROXY:ii.CLOUD_PROXY_FALLBACK);return ox(M),{gatewayInfo:YL(M,u),proxyInfo:U,url:u}},P=>(P.gatewayInfo&&yt.joinChooseServer(n.sid,{role:y,lts:_,succ:!0,csAddr:u,serverList:P.gatewayInfo.gatewayAddrs.map(B=>B.address),ec:null,opid:w,cid:P.gatewayInfo.cid.toString(),uid:P.gatewayInfo.uid.toString(),csIp:P.gatewayInfo.csIp,unilbsServerIds:m.toString(),isHttp3:c,corssRegionTagReq:n.apRequestDetail,corssRegionTagRes:P.gatewayInfo.res.detail&&P.gatewayInfo.res.detail[38]}),P.proxyInfo&&yt.joinWebProxyAP(n.sid,{lts:_,sucess:1,apServerAddr:u,turnServerAddrList:P.proxyInfo.addresses.map(B=>B.ip).join(","),errorCode:null,eventType:n.cloudProxyServer,unilbsServerIds:m.toString()}),!1),P=>P.code!==Y.OPERATION_ABORTED&&(P.code===Y.CAN_NOT_GET_GATEWAY_SERVER?P.data.retry:(yt.joinWebProxyAP(n.sid,{lts:_,sucess:0,apServerAddr:u,turnServerAddrList:null,errorCode:P.code,eventType:n.cloudProxyServer,unilbsServerIds:m.toString(),extend:JSON.stringify({networkState:I})}),k.warning("[".concat(n.clientId,"] multi unilbs network error, retry"),P),!0)),o)}const SH=(e,n,i,o,c,u)=>{const{sid:h,clientId:m,cloudProxyServer:_}=i,y=[],S=w=>{w.flag===4096?yt.joinChooseServer(h,{role:i.role,lts:o,succ:!1,csAddr:n,opid:e.opid,serverList:null,ec:w.error.message,csIp:w.error.data&&w.error.data.csIp,unilbsServerIds:c.toString(),isHttp3:u,corssRegionTagReq:i.apRequestDetail}):w.flag!==1048576&&w.flag!==4194304&&w.flag!==4194310||yt.joinWebProxyAP(h,{lts:o,sucess:0,apServerAddr:n,turnServerAddrList:null,errorCode:w.error.code,eventType:_,unilbsServerIds:c.toString()})};if(e.response_body.forEach(w=>{const I=w.buffer.code;if(w.uri===23&&I===0&&!w.buffer.edges_services)if(w.buffer.flag===4194310)k.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),w.buffer.edges_services=[];else{const P={error:new be(Y.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:w.buffer.flag};y.push(P),S(P)}if(I!==0){const P=pv(I),B={error:new be(Y.CAN_NOT_GET_GATEWAY_SERVER,P.desc,{desc:P.desc,retry:P.retry,csIp:e.detail[502]}),flag:w.buffer.flag};w.buffer.flag===4194310?k.warning(B.error.toString()):y.push(B),S(B)}}),y.length)throw k.warning("[".concat(m||"sid-".concat(h.slice(0,6)),"] multi unilbs ").concat(n," failed, ").concat(y.map(w=>"flag: ".concat(w.flag,", message: ").concat(w.error.message,", retry: ").concat(w.error.data.retry)).join(" | "))),new be(Y.CAN_NOT_GET_GATEWAY_SERVER,y.map(w=>"flag: ".concat(w.flag,", message: ").concat(w.error.message)).join(" | "),{retry:!!y.find(w=>w.error.data.retry),csIp:e.detail[502],desc:[...new Set(y.map(w=>{var I;return w==null||(I=w.error)===null||I===void 0||(I=I.data)===null||I===void 0?void 0:I.desc}).filter(w=>!!w))]})},ox=e=>{var n,i,o,c;if(e.addresses&&e.addresses.length===0&&e.code===0)throw new be(Y.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if(Z("AP_AREA")&&((o=e.detail)!==null&&o!==void 0&&o[23]&&typeof((c=e.detail)===null||c===void 0?void 0:c[23])=="string"?_H(e.detail[23].toLowerCase()):_H()),(n=e.detail)!==null&&n!==void 0&&n[19]&&typeof((i=e.detail)===null||i===void 0?void 0:i[19])=="string"){const h=e.detail[19],m=h==null?void 0:h.split(";");for(let _=0;_<m.length;_++){var u;const y=Gs(u=m[_]).call(u);e.addresses[_]&&m&&(e.addresses[_].fingerprint=y)}}if(Z("GATEWAY_ADDRESS")&&Z("GATEWAY_ADDRESS").length>0){k.debug("assign gateway address to",Z("GATEWAY_ADDRESS"));const h=Z("GATEWAY_ADDRESS").map(m=>{var _,y;const S=(_=(y=e.addresses.find(w=>w.ip===m.ip&&w.port===m.port))===null||y===void 0?void 0:y.fingerprint)!==null&&_!==void 0?_:"";return{ip:m.ip,port:m.port,ticket:e.addresses[0]&&e.addresses[0].ticket,fingerprint:S}});e.addresses=h}},npe=(e,n)=>{if(e.response_body&&e.response_body.length){const i=e.response_body[0];if(i.buffer.code!==0){const o=pv(i.buffer.code);throw new be(Y.UPDATE_TICKET_FAILED,"[".concat(i.buffer.code,"]: ").concat(o.desc),{retry:o.retry})}return i.buffer.ticket}throw k.debug("update ticket request received ap response without response body:",n),new be(Y.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},ax=(e,n,i)=>{const o=Math.floor(Math.random()*1e12),c=e.role==="host"?"1":e.role==="audience"?"2":void 0,u={appid:e.appId,client_ts:Date.now(),opid:o,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:Yd(Yd(Yd({6:e.stringUid,11:n,12:Z("USE_NEW_TOKEN")?"1":void 0},c?{17:c}:{}),{},{22:n},e.apRequestDetail?{33:e.apRequestDetail}:{}),e.apRTM?{26:"RTM2"}:{}),key:e.token,service_ids:i,uid:e.uid||0}}]};u.request_bodies.forEach(m=>{e.multiIP&&e.multiIP.gateway_ip&&(m.buffer.detail[5]=JSON.stringify({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))});const h=new FormData;return h.append("request",JSON.stringify(u)),[h,o]},rpe=(e,n)=>{const i=Math.floor(Math.random()*1e12),o={appid:e.appId,client_ts:Date.now(),opid:i,sid:e.sid,request_bodies:[{uri:28,buffer:{cname:e.cname,detail:{1:"",6:e.stringUid,12:"1"},token:e.token,service_ids:n,uid:e.uid||0,edges_services:e.apResponse.addresses.map(u=>({ip:u.ip,port:u.port}))}}]},c=new FormData;return c.append("request",JSON.stringify(o)),[c,i]};let Ev=0;function yv(e){return tt.all(e.map(n=>n.then(i=>{throw i},i=>i))).then(n=>{throw n},n=>n)}const X0=async e=>{let{fragementLength:n,referenceList:i,asyncMapHandler:o,allFailedhandler:c,promisesCollector:u}=e,h=0;const m=n;let _,y=0;const S=async()=>{const w=(()=>{const I=h*m,P=I+m;return i.slice(I,P).map(o)})();u&&u.push(...w);try{_=await yv(w)}catch(I){if(y+=m,h++,!(y>=i.length))return void await S();c(I)}w.forEach(I=>I.cancel())};return await S(),_},TH=async e=>{let{referenceList:n,asyncMapHandler:i,closeFn:o}=e;const c=n.length;let u=0;const h=async()=>{const m=i(n.shift());try{return await m}catch(_){if(u++,u>=c||o!=null&&o(_))throw _;return h()}};return h()};async function cx(e,n,i,o){return{gatewayInfo:await async function(u,h,m,_){let y=null;const S=[],w=async()=>{const P=Z("WEBCS_DOMAIN").slice(0,Z("AJAX_REQUEST_CONCURRENT")).map(U=>({url:u.proxyServer?"https://".concat(u.proxyServer,"/ap/?url=").concat(U+"/api/v2/transpond/webrtc?v=2"):"https://".concat(U,"/api/v2/transpond/webrtc?v=2"),areaCode:Y0()})),B=_.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:P.map(U=>U.url)}),M=await X0({fragementLength:Z("FRAGEMENT_LENGTH"),referenceList:P,asyncMapHandler:U=>(k.debug("[".concat(u.clientId,"] Connect to choose_server:"),U.url),yH(U,u,h,m)),allFailedhandler:U=>{throw _.recordJoinChannelService({endTs:Date.now(),status:"error",errors:U},B),U[0]},promisesCollector:S});return _.recordJoinChannelService({endTs:Date.now(),status:"success"},B),M},I=async()=>{if(await $i(1e3),y!==null)return y;const P=Z("WEBCS_DOMAIN_BACKUP_LIST").map(U=>({url:u.proxyServer?"https://".concat(u.proxyServer,"/ap/?url=").concat(U+"/api/v2/transpond/webrtc?v=2"):"https://".concat(U,"/api/v2/transpond/webrtc?v=2"),areaCode:Y0()})),B=_.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:P.map(U=>U.url)}),M=await X0({fragementLength:Z("FRAGEMENT_LENGTH"),referenceList:P,asyncMapHandler:U=>(k.debug("[".concat(u.clientId,"] Connect to backup choose_server:"),U.url),yH(U,u,h,m)),allFailedhandler:U=>{throw _.recordJoinChannelService({endTs:Date.now(),status:"error",errors:U},B),U[0]},promisesCollector:S});return _.recordJoinChannelService({endTs:Date.now(),status:"success"},B),M};try{return y=await yv([w(),I()]),S.length&&S.forEach(P=>P.cancel&&typeof P.cancel=="function"&&P.cancel()),y}catch(P){throw P[0]}}(e,n,i,o)}}async function bH(e,n,i,o,c){const u=e.cloudProxyServer;if(u==="disabled"){if(e.useLocalAccessPoint)return await cx(e,n,i,c);if(Z("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:I,proxyInfo:P}=await CH(e,n,i,c);if(e.turnServer&&e.turnServer.mode!=="auto")return{gatewayInfo:I};const B=P.map(M=>({turnServerURL:M.address,tcpport:M.tcpport||hs.tcpport,udpport:M.udpport||hs.udpport,username:M.username||hs.username,password:M.password||hs.password,forceturn:!1,security:!0}));if(c.useP2P){var h;const M=(h=e.uid)!==null&&h!==void 0?h:I.uid,U="glb:".concat(M.toString()),q=await tL(U),$=P.map(ae=>({turnServerURL:ae.address,tcpport:ae.tcpport||hs.tcpport,udpport:ae.udpport||hs.udpport,username:U,password:q,forceturn:!1,security:!0}));B.push(...$)}return e.turnServer={mode:"manual",servers:B},{gatewayInfo:I}}return await cx(e,n,i,c)}const{proxyInfo:m,gatewayInfo:_}=await CH(e,n,i,c),y={gatewayInfo:_},S=m.map(I=>({turnServerURL:I.address,tcpport:u==="proxy3"?void 0:I.tcpport?I.tcpport:hs.tcpport,udpport:u==="proxy4"?void 0:I.udpport?I.udpport:hs.udpport,username:I.username||hs.username,password:I.password||hs.password,forceturn:u!=="proxy4",security:u==="proxy5"}));if(c.useP2P){var w;const I=(w=e.uid)!==null&&w!==void 0?w:_.uid,P="glb:".concat(I.toString()),B=await tL(P),M=m.map(U=>({turnServerURL:U.address,tcpport:u==="proxy3"?void 0:U.tcpport||hs.tcpport,udpport:u==="proxy4"?void 0:U.udpport||hs.udpport,username:P,password:B,forceturn:u!=="proxy4",security:u==="proxy5"}));S.push(...M)}return e.turnServer={mode:"manual",servers:S},k.debug("[".concat(e.clientId,"] set proxy server: ").concat(e.proxyServer,", mode: ").concat(u)),y}async function wH(e,n,i,o,c){const u=Z("ACCOUNT_REGISTER").slice(0,Z("AJAX_REQUEST_CONCURRENT"));let h=[];h=n.proxyServer?u.map(_=>"https://".concat(n.proxyServer,"/ap/?url=").concat(_+"/api/v1")):u.map(_=>"https://".concat(_,"/api/v1"));const m=c==null?void 0:c.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:h});try{const _=await async function(y,S,w,I,P){const B=Date.now(),M={sid:w.sid,opid:10,appid:w.appId,string_uid:S};let U=y[0];const q=await qu(()=>Qu(U+"".concat(U.indexOf("?")===-1?"?":"&","action=stringuid"),{data:M,cancelToken:I,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),($,ae)=>{if($.code===0){if($.uid<=0||$.uid>=Math.pow(2,32))throw k.error("Invalid Uint Uid ".concat(S," => ").concat($.uid),$),yt.reqUserAccount(M.sid,{lts:B,success:!1,serverAddr:U,stringUid:M.string_uid,uid:$.uid,errorCode:Y.INVALID_UINT_UID_FROM_STRING_UID,extend:M}),new be(Y.INVALID_UINT_UID_FROM_STRING_UID);return yt.reqUserAccount(M.sid,{lts:B,success:!0,serverAddr:U,stringUid:M.string_uid,uid:$.uid,errorCode:null,extend:M}),!1}const me=pv($.code);return me.retry&&(U=y[(ae+1)%y.length]),yt.reqUserAccount(M.sid,{lts:B,success:!1,serverAddr:U,stringUid:M.string_uid,uid:$.uid,errorCode:me.desc,extend:M}),me.retry},($,ae)=>$.code!==Y.OPERATION_ABORTED&&(yt.reqUserAccount(M.sid,{lts:B,success:!1,serverAddr:U,stringUid:M.string_uid,uid:null,errorCode:$.code,extend:M}),U=y[(ae+1)%y.length],!0),P);if(q.code!==0){const $=pv(q.code);throw new be(Y.UNEXPECTED_RESPONSE,$.desc)}return q}(h,e,n,i,o);return c==null||c.recordJoinChannelService({status:"success",endTs:Date.now()},m),_.uid}catch(_){throw c==null||c.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[_]},m),_}}async function ipe(e,n,i){const o=Z("ACCOUNT_REGISTER");let c=[];c=n.proxyServer?o.map(u=>"https://".concat(n.proxyServer,"/ap/?url=").concat(u+"/api/v1")):o.map(u=>"https://".concat(u,"/api/v1"));try{return await TH({referenceList:c,asyncMapHandler:h=>async function(m,_,y,S){const w=Date.now(),I={sid:y.sid,opid:10,appid:y.appId,string_uid:_};try{const P=await Qu(m+"".concat(m.indexOf("?")===-1?"?":"&","action=stringuid"),{data:I,cancelToken:S,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(P.code!==0){const B=pv(P.code);throw new be(Y.UNEXPECTED_RESPONSE,"preload sua error:".concat(B.desc),B)}if(P.uid<=0||P.uid>=Math.pow(2,32))throw new be(Y.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:w,url:m,req:I,uid:P.uid,elapse:Date.now()-w}}catch(P){throw P}}(h,e,n,i),closeFn:h=>h.code===Y.OPERATION_ABORTED||h.code===Y.UNEXPECTED_RESPONSE&&!h.data.retry})}catch(u){throw u}}async function spe(e,n,i){const o=Z("CDS_AP").slice(0,Z("AJAX_REQUEST_CONCURRENT")).map(_=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(_+"/api/v1"):"https://".concat(_,"/api/v1?action=config")),c=o.map(_=>function(y,S,w,I){const P=Tn(),B={flag:64,cipher_method:0,features:Yd(Yd(Yd(Yd(Yd({install_id:hL(),device:P.name,system:P.os,system_general:navigator.userAgent,vendor:S.appId,version:tl,cname:S.cname,session_id:S.sid,proxyServer:S.proxyServer,sdk_type:Xfe.WEB_RTC,browser_name:P.name,browser_version:P.version,user_agent:navigator.userAgent,channel_name:S.cname},S.stringUid&&{string_uid:S.stringUid}),S.uid&&{uid:S.uid+""}),P.os&&{os_name:P.os}),P.osVersion&&{os_version:P.osVersion}),{},{detail:""})};return qu(()=>Qu(y,{data:B,timeout:1e3,cancelToken:w,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,M=>M.code!==Y.OPERATION_ABORTED,I)}(_,e,n,i));let u=null,h=null,m={};try{u=await yv(c)}catch(_){if(_.code===Y.OPERATION_ABORTED)throw _;h=_}if(c.forEach(_=>_.cancel()),yt.reportApiInvoke(e.sid,{name:fi.REQUEST_CONFIG_DISTRIBUTE,options:{error:h,res:u}}).onSuccess(),u&&u.test_tags)try{m=function(_){if(!_.test_tags)return{};const y=_.test_tags,S=Object.keys(y),w={};return S.forEach(I=>{var P;const B=Gs(P=I.slice(4)).call(P),M=JSON.parse(y[I]),U=M[1];w[B]={tag:M[0]||"",value:U}}),w}(u)}catch{}return m}async function RH(e,n){const i=Z("WEBCS_DOMAIN").concat(Z("WEBCS_DOMAIN_BACKUP_LIST")).map(o=>({url:"https://".concat(o,"/api/v2/transpond/webrtc?v=2"),areaCode:Y0(),serviceIds:[ii.CHOOSE_SERVER,ii.CLOUD_PROXY_FALLBACK]}));try{return await TH({referenceList:i,asyncMapHandler:c=>async function(u,h,m){let _,{url:y,areaCode:S,serviceIds:w}=u;const I=Date.now(),[P,B]=ax(h,S,w);let M=ri.networkState;try{M&&ri.networkState===ja.OFFLINE&&ri.onlineWaiter&&await tt.race([ri.onlineWaiter,$i(pi.maxRetryTimeout)]),M=ri.networkState;const{data:U,headers:q}=await Qu(y,{data:P,cancelToken:m,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);_=q.http3==="1"?1:-1,(ge=>{const pe=[];if(ge.response_body.forEach(we=>{const Be=we.buffer.code;if(we.uri===23&&Be===0&&!we.buffer.edges_services)if(we.buffer.flag===4194310)we.buffer.edges_services=[];else{const nt={error:new be(Y.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:ge.detail[502]}),flag:we.buffer.flag};pe.push(nt)}if(Be!==0){const nt=pv(Be),st={error:new be(Y.CAN_NOT_GET_GATEWAY_SERVER,nt.desc,{desc:nt.desc,retry:nt.retry,csIp:ge.detail[502]}),flag:we.buffer.flag};we.buffer.flag===4194310?k.warning(st.error.toString()):pe.push(st)}}),pe.length)throw new be(Y.CAN_NOT_GET_GATEWAY_SERVER,pe.map(we=>"flag: ".concat(we.flag,", message: ").concat(we.error.message)).join(" | "),{retry:!!pe.find(we=>we.error.data.retry),csIp:ge.detail[502],desc:[...new Set(pe.map(we=>{var Be;return we==null||(Be=we.error)===null||Be===void 0||(Be=Be.data)===null||Be===void 0?void 0:Be.desc}).filter(we=>!!we))]})})(U);const ae=H0(U,ii.CHOOSE_SERVER),me=H0(U,ii.CLOUD_PROXY_FALLBACK);return ox(ae),{gatewayInfo:YL(ae,y),proxyInfo:me,opid:B,requestTime:I,url:y,isHttp3:_,elapse:Date.now()-I}}catch(U){throw U}}(c,e,n),closeFn:c=>c.code===Y.OPERATION_ABORTED||c.code===Y.CAN_NOT_GET_GATEWAY_SERVER&&!c.data.retry})}catch(o){throw o}}async function CH(e,n,i,o){const c=Z("PROXY_SERVER_TYPE3"),u=(P,B,M)=>{let U=M||c;return Array.isArray(U)&&(U=B%2==0?c[1]:c[0]),"https://".concat(U,"/ap/?url=").concat(P)};let h=null;const m=[],_=async()=>{const P=Z("WEBCS_DOMAIN").slice(0,Z("AJAX_REQUEST_CONCURRENT")).map((U,q)=>{let $;return $=e.cloudProxyServer==="disabled"&&e.proxyServer?u("".concat(U,"/api/v2/transpond/webrtc?v=2"),q,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(U,"/api/v2/transpond/webrtc?v=2"):u("".concat(U,"/api/v2/transpond/webrtc?v=2"),q),{url:$,areaCode:Y0(),serviceIds:[ii.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?ii.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?ii.CLOUD_PROXY:ii.CLOUD_PROXY_FALLBACK]}}),B=o.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:P.map(U=>U.url)}),M=await X0({fragementLength:Z("FRAGEMENT_LENGTH"),referenceList:P,asyncMapHandler:U=>(k.debug("[".concat(e.clientId,"] Connect to choose_server:"),U.url),vH(U,e,n,i)),allFailedhandler:U=>{throw o.recordJoinChannelService({endTs:Date.now(),status:"error",errors:U},B),U[0]},promisesCollector:m});return o.recordJoinChannelService({endTs:Date.now(),status:"success"},B),M},y=async()=>{if(await $i(1e3),h!==null)return h;const P=Z("WEBCS_DOMAIN_BACKUP_LIST").map((U,q)=>{let $;return $=e.cloudProxyServer==="disabled"&&e.proxyServer?u("".concat(U,"/api/v2/transpond/webrtc?v=2"),q,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(U,"/api/v2/transpond/webrtc?v=2"):u("".concat(U,"/api/v2/transpond/webrtc?v=2"),q),{url:$,areaCode:Y0(),serviceIds:[ii.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?ii.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?ii.CLOUD_PROXY:ii.CLOUD_PROXY_FALLBACK]}}),B=o.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:P.map(U=>U.url)}),M=await X0({fragementLength:Z("FRAGEMENT_LENGTH"),referenceList:P,asyncMapHandler:U=>(k.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),U.url),vH(U,e,n,i)),allFailedhandler:U=>{throw o.recordJoinChannelService({endTs:Date.now(),status:"error",errors:U},B),U[0]},promisesCollector:m});return o.recordJoinChannelService({endTs:Date.now(),status:"success"},B),M};let S,w,I;try{({gatewayInfo:S,proxyInfo:w,url:I}=await yv([_(),y()]))}catch(P){throw P[0]}if(m.length&&m.forEach(P=>P.cancel&&typeof P.cancel=="function"&&P.cancel()),!S||!w)throw new be(Y.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(e.apUrl=I,e.cloudProxyServer!=="disabled"&&Array.isArray(c)&&I){const P=/^https?:\/\/(.+?)(\/.*)?$/.exec(I)[1];Xe(c).call(c,P)&&(e.proxyServer=P,k.setProxyServer(P),yt.setProxyServer(P))}return h={gatewayInfo:S,proxyInfo:await Xz(w,S.uid)},h}async function ope(e,n,i){const o=Z("UAP_AP").slice(0,Z("AJAX_REQUEST_CONCURRENT")).map(u=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(u+"/api/v1?action=uap"):"https://".concat(u,"/api/v1?action=uap")),c=o.map(u=>function(h,m,_,y){const S={command:"convergeAllocateEdge",sid:m.sid,appId:m.appId,token:m.token,ts:Date.now(),version:tl,cname:m.cname,uid:m.uid.toString(),requestId:sx,seq:sx};sx+=1;const w={service_name:"tele_channel",json_body:JSON.stringify(S)};return qu(async()=>{const I=await Qu(h,{data:w,cancelToken:_,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(I.code!==0){const B=new be(Y.UNEXPECTED_RESPONSE,"cross channel ap error, code"+I.code,{retry:!0});throw k.error(B.toString()),B}const P=JSON.parse(I.json_body);if(P.code!==200){const B=new be(Y.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(P.code,", reason: ").concat(P.reason));throw k.error(B.toString()),B}if(!P.servers||P.servers.length===0){const B=new be(Y.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw k.error(B.toString()),B}return{vid:P.vid,workerToken:P.workerToken,addressList:(Z("CHANNEL_MEDIA_RELAY_SERVERS")||P.servers).map(B=>"wss://".concat(B.address.replace(/\./g,"-"),".").concat(Z("WORKER_DOMAIN"),":").concat(B.wss))}},void 0,I=>!!(I.code!==Y.OPERATION_ABORTED&&I.code!==Y.UNEXPECTED_RESPONSE||I.data&&I.data.retry),y)}(u,e,n,i));try{const u=await yv(c);return c.forEach(h=>h.cancel()),u}catch(u){throw u[0]}}async function ape(e,n,i){let o=null;const c=[],u=async h=>{const m=Z(h?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(_=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(_+"/api/v2/transpond/webrtc?v=2"):"https://".concat(_,"/api/v2/transpond/webrtc?v=2"));return h&&(await $i(1e3),o!==null)?o:await X0({fragementLength:Z("FRAGEMENT_LENGTH"),referenceList:m,asyncMapHandler:_=>(k.debug("[".concat(e.clientId,"] update ticket, Connect to ").concat(h?"backup":""," choose_server:"),_),function(y,S,w,I){const[P]=rpe(S,[ii.CHOOSE_SERVER]);let B=ri.networkState;return qu(async()=>{B&&ri.networkState===ja.OFFLINE&&ri.onlineWaiter&&await tt.race([ri.onlineWaiter,$i(I&&I.maxRetryTimeout||pi.maxRetryTimeout)]),B=ri.networkState;const M=await Qu(y,{data:P,cancelToken:w,headers:{"Content-Type":"multipart/form-data;"}},!0);return npe(M,y)},()=>!1,M=>M.code!==Y.OPERATION_ABORTED&&(M.code===Y.UPDATE_TICKET_FAILED?M.data.retry:(k.warning("[".concat(S.clientId,"] update ticket network error, retry"),M),!0)),I)}(_,e,n,i)),allFailedhandler:_=>{throw _[0]},promisesCollector:c})};try{return o=await yv([u(!1),u(!0)]),c.length&&c.forEach(h=>h.cancel&&typeof h.cancel=="function"&&h.cancel()),o}catch(h){throw h[0]}}function IH(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function lx(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?IH(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):IH(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}class cpe extends Rr{get isSuccess(){return!!this.configs}constructor(n,i){super(),K(this,"configs",void 0),K(this,"store",void 0),K(this,"joinInfo",void 0),K(this,"cancelToken",void 0),K(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),K(this,"interval",void 0),K(this,"mutex",void 0),K(this,"mutableParamsRead",!1),K(this,"configCache",{}),K(this,"limit_bitrate",void 0),this.mutex=new Es("config-distribute",n),this.store=i}startGetConfigDistribute(n,i){this.joinInfo=n,this.cancelToken=i,this.interval&&this.stopGetConfigDistribute(),Z("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},Z("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,yt.reportApiInvoke(null,{options:void 0,name:fi.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:kr.TRACER}).onSuccess(JSON.stringify($u))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void k.debug("[config-distribute] get config distribute interrupted have no joininfo");let n;const i=await this.mutex.lock();try{n=await spe(this.joinInfo,this.cancelToken,this.retryConfig),k.debug("[config-distribute] get config distribute",JSON.stringify(n));const o=function(c){var u;const h=_0(u=Object.keys(c).filter(y=>/^webrtc_ng_global_parameter/.test(y))).call(u);for(let y=0;y<h.length;y++)for(let S=h.length-1;S>y;S--){const w=h[S],I=c[w].value;if(typeof I.__priority=="number"){const P=I.__priority,B=h[S-1],M=c[B].value;if(typeof M.__priority=="number"){if(!(P>M.__priority))continue;{const U=w;h[S]=h[S-1],h[S-1]=U}}else{const U=w;h[S]=h[S-1],h[S-1]=U}}}const m=Date.now();let _={};return h.forEach(y=>{const S=c[y].value.__expires;S&&S<=m||(_[y]=c[y])}),_}(n);this.cacheGlobalParameterConfig(o),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=o}catch(o){const c=new be(Y.NETWORK_RESPONSE_ERROR,o);k.warning("[config-distribute] ".concat(c.toString()))}finally{i()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(n){Vz(n)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==n.id&&this.emit(W0.UPDATE_BITRATE_LIMIT,n):this.emit(W0.UPDATE_BITRATE_LIMIT,n))}getLowStreamConfigDistribute(){return this.limit_bitrate&&lx({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(n){try{const i={},o=Object.keys(n),c=[];o.forEach(u=>{const h=n[u].value;i[u]=h;const m=h.__id;if(m&&this.configCache[u]&&this.configCache[u].__id===m)return;const _=h.__type,y=n[u].value,S=n[u].tag;let w=0;_?_===fW.REALTIME&&(w=1):Object.keys(y).some(I=>Object.prototype.hasOwnProperty.call(gL,I)||!FL()&&Object.prototype.hasOwnProperty.call(oA,I)?(w=1,!0):void 0),c.push({tag:S,isApplied:w,feature:u,params:JSON.stringify(h)})}),c.forEach(u=>{let{tag:h,feature:m,params:_,isApplied:y}=u;this.store.sessionId&&yt.abTest(this.store.sessionId,{intSucc:1,isApplied:y,tag:h,feature:m,params:_,cid:this.store.cid,uid:this.store.intUid})}),this.configCache=i}catch(i){k.debug("handleABTestConfigDistribute error",i)}}cacheGlobalParameterConfig(n){const i=function(c){const u={};return Object.keys(c).forEach(h=>{const m=c[h].value,_=m.__expires,y=m.__type;Object.keys(m).forEach(S=>{S==="__id"||S==="__type"||S==="__priority"||S==="__expires"||Object.prototype.hasOwnProperty.call(u,S)||(u[S]=lx(lx({value:m[S]},_&&{expires:_}),y&&{type:y}))})}),u}(n);try{var o;const c=(o=i.LIMIT_BITRATE)===null||o===void 0?void 0:o.value;delete i.LIMIT_BITRATE,c&&Vz(c)&&this.handleBitrateLimit(c),this.limit_bitrate=c,this.handleGlobalParameterConfig(i),this.handleABTestConfigDistribute(n),function(m){try{const _=Date.now();Object.keys(m).forEach(y=>{const{value:S,type:w,expires:I}=m[y];I&&I<=_||((w===fW.REALTIME||Object.prototype.hasOwnProperty.call(gL,y))&&($u[y]=S,dr[y]=S,k.debug("Update realtime parameters from config distribute",y,S)),w||FL()||!Object.prototype.hasOwnProperty.call(oA,y)||($u[y]=S,dr[y]=S,k.debug("Update gateway parameters from config distribute",y,S)))})}catch(_){k.error("Error update config immediately: ".concat(m),_.message)}}(i);const u=JSON.stringify(i),h=window.btoa(u);window.localStorage.setItem("websdk_ng_global_parameter",h),k.debug("Caching global parameters ".concat(u))}catch(c){k.error("Error caching global parameters:",c.message)}}handleGlobalParameterConfig(n){try{const i=Date.now();Object.keys(n).forEach(o=>{if(o==="CLIENT_ROLE_OPTIONS"&&Object.prototype.hasOwnProperty.call(dr,o)){const{value:c,expires:u}=n[o];if(u&&u<=i)return;(function(h,m){try{return typeof h=="object"&&typeof m=="object"&&JSON.stringify(h)===JSON.stringify(m)}catch{return!1}})(dr[o],c)||($u[o]=c,dr[o]=c,this.emit(W0.UPDATE_CLIENT_ROLE_OPTIONS,c),k.debug("Updating client role options: ".concat(JSON.stringify(c))))}})}catch(i){k.error("Error handling global parameter config:",i.message)}}}class lpe extends Rr{constructor(){super(...arguments),K(this,"resultStorage",new Map)}setLocalAudioStats(n,i,o){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",n,this.checkAudioInputLevel(o,i)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",n,this.checkSendAudioBitrate(o,i))}setLocalVideoStats(n,i,o){this.record("SEND_VIDEO_BITRATE_TOO_LOW",n,this.checkSendVideoBitrate(o,i)),this.record("FRAMERATE_INPUT_TOO_LOW",n,this.checkFramerateInput(o,i)),this.record("FRAMERATE_SENT_TOO_LOW",n,this.checkFramerateSent(o))}setRemoteAudioStats(n,i){const o=n.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",o,this.checkAudioOutputLevel(i))}setRemoteVideoStats(n,i){const o=n.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",o,this.checkVideoDecode(i))}record(n,i,o){if(Z("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(n)||this.resultStorage.set(n,{result:[],isPrevNormal:!0});const c=this.resultStorage.get(n);if(c&&(c.result.push(o),c.result.length>=5)){var u;const h=Xe(u=c.result).call(u,!0);c.isPrevNormal&&!h&&this.emit("exception",AH[n],n,i),!c.isPrevNormal&&h&&this.emit("exception",AH[n]+2e3,n+"_RECOVER",i),c.isPrevNormal=h,c.result=[]}}checkAudioOutputLevel(n){return!(n.receiveBitrate>0&&n.receiveLevel===0)}checkAudioInputLevel(n,i){return i instanceof yi&&!i.isActive||!!i.muted||n.sendVolumeLevel!==0}checkFramerateInput(n,i){let o=null;i._encoderConfig&&i._encoderConfig.frameRate&&(o=Ba(i._encoderConfig.frameRate));const c=n.captureFrameRate;return!o||!c||!(o>10&&c<5||o<10&&o>=5&&c<=1)}checkFramerateSent(n){return!(n.captureFrameRate&&n.sendFrameRate&&n.captureFrameRate>5&&n.sendFrameRate<=1)}checkSendVideoBitrate(n,i){return!!i.muted||n.sendBitrate!==0}checkSendAudioBitrate(n,i){return i instanceof yi&&!i.isActive||!!i.muted||n.sendBitrate!==0}checkVideoDecode(n){return n.receiveBitrate===0||n.decodeFrameRate!==0}}const AH={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},Ss=new class{markSubscribeStart(e,n){performance.mark("agora-web-sdk/".concat(e,"/subscribe-").concat(n))}markPublishStart(e,n){performance.mark("agora-web-sdk/".concat(e,"/publish-").concat(n))}measureFromSubscribeStart(e,n){const i=performance.getEntriesByName("agora-web-sdk/".concat(e,"/subscribe-").concat(n));if(i.length>0){const o=i[i.length-1];return Math.round(performance.now()-o.startTime)}return 0}measureFromPublishStart(e,n){const i=performance.getEntriesByName("agora-web-sdk/".concat(e,"/publish-").concat(n));if(i.length>0){const o=i[i.length-1];return Math.round(performance.now()-o.startTime)}return 0}};function OH(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function l_(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?OH(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):OH(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}class J0{constructor(n){K(this,"store",void 0),K(this,"onStatsException",void 0),K(this,"onUploadPublishDuration",void 0),K(this,"onStatsChanged",void 0),K(this,"localStats",new Map),K(this,"remoteStats",new Map),K(this,"updateStatsInterval",void 0),K(this,"trafficStats",void 0),K(this,"trafficStatsPeerList",[]),K(this,"uplinkStats",void 0),K(this,"exceptionMonitor",void 0),K(this,"p2pChannel",void 0),K(this,"scalabilityMode",sA.L1T1),K(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=n,this.exceptionMonitor=new lpe,this.exceptionMonitor.on("exception",(i,o,c)=>{this.onStatsException&&this.onStatsException(i,o,c)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(Ve.LocalAudioTrack)||l_({},SL)}getLocalVideoTrackStats(){return this.localStats.get(Ve.LocalVideoTrack)||l_({},TL)}getRemoteAudioTrackStats(n){const i=(u,h)=>{if(!this.trafficStats)return h;const m=this.trafficStats.peer_delay.find(_=>_.peer_uid===u);return m&&(h.publishDuration=m.B_ppad+(Date.now()-this.trafficStats.timestamp)),h},o={};if(n){var c;const u=(c=this.remoteStats.get(n))===null||c===void 0?void 0:c.audioStats;u&&(o[n]=i(n,u))}else Array.from(this.remoteStats.entries()).forEach(u=>{let[h,{audioStats:m}]=u;m&&(o[h]=i(h,m))});return o}getRemoteNetworkQualityStats(n){const i={};if(n){var o;const c=(o=this.remoteStats.get(n))===null||o===void 0?void 0:o.networkStats;c&&(i[n]=c)}else Array.from(this.remoteStats.entries()).forEach(c=>{let[u,{networkStats:h}]=c;h&&(i[u]=h)});return i}getRemoteVideoTrackStats(n){const i=(u,h)=>{if(!this.trafficStats)return h;const m=this.trafficStats.peer_delay.find(_=>_.peer_uid===u);return m&&(h.publishDuration=m.B_ppvd+(Date.now()-this.trafficStats.timestamp)),h},o={};if(n){var c;const u=(c=this.remoteStats.get(n))===null||c===void 0?void 0:c.videoStats;u&&(o[n]=i(n,u))}else Array.from(this.remoteStats.entries()).forEach(u=>{let[h,{videoStats:m}]=u;m&&(o[h]=i(h,m))});return o}getRTCStats(){let n=0,i=0,o=0,c=0;const u=this.localStats.get(Ve.LocalAudioTrack);u&&(n+=u.sendBytes,i+=u.sendBitrate);const h=this.localStats.get(Ve.LocalVideoTrack);h&&(n+=h.sendBytes,i+=h.sendBitrate);const m=this.localStats.get(Ve.LocalVideoLowTrack);m&&(n+=m.sendBytes,i+=m.sendBitrate),this.remoteStats.forEach(y=>{let{audioStats:S,videoStats:w}=y;S&&(o+=S.receiveBytes,c+=S.receiveBitrate),w&&(o+=w.receiveBytes,c+=w.receiveBitrate)});let _=1;return this.trafficStats&&(_+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:_,SendBitrate:i,SendBytes:n,RecvBytes:o,RecvBitrate:c,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(n){this.localStats.set(n,void 0)}removeLocalStats(n){n?this.localStats.delete(n):this.localStats.clear()}addRemoteStats(n){this.remoteStats.set(n,{})}removeRemoteStats(n){n?this.remoteStats.delete(n):this.remoteStats.clear()}addP2PChannel(n){this.p2pChannel=n}updateTrafficStats(n){n.peer_delay=n.peer_delay.filter(i=>i.B_ppad!==void 0||i.B_ppvd!==void 0),n.peer_delay.filter(i=>this.trafficStatsPeerList.indexOf(i.peer_uid)===-1).forEach(i=>{var o;const c=(o=this.p2pChannel)===null||o===void 0?void 0:o.getRemoteMedia(i.peer_uid),u=c!=null&&c.videoSSRC?Ss.measureFromSubscribeStart(this.store.clientId,c.videoSSRC):0,h=c!=null&&c.audioSSRC?Ss.measureFromSubscribeStart(this.store.clientId,c.audioSSRC):0;i.B_ppad!==void 0&&i.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(i.peer_uid,i.B_ppad,i.B_ppvd,u>h?u:h),this.trafficStatsPeerList.push(i.peer_uid))}),this.trafficStats=n}updateUplinkStats(n){this.uplinkStats&&this.uplinkStats.B_fir!==n.B_fir&&k.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(n.B_fir)),this.uplinkStats=n}static isRemoteVideoFreeze(n,i,o){if(!n)return!1;const c=!!o&&i.framesDecodeFreezeTime>o.framesDecodeFreezeTime,u=!o||i.framesDecodeCount>o.framesDecodeCount;return c||!u}static isRemoteAudioFreeze(n){return!!n&&n._isFreeze()}isLocalVideoFreeze(n){return!(!n.inputFrame||!n.sentFrame)&&n.inputFrame.frameRate>5&&n.sentFrame.frameRate<3}updateLocalStats(n){Array.from(this.localStats.entries()).forEach(i=>{let[o,c]=i;switch(o){case Ve.LocalVideoTrack:case Ve.LocalVideoLowTrack:{const h=c,m=l_({},TL),_=n.getStats(),y=n.getLocalMedia(o);if(_){const S=_.videoSend.find(w=>w.ssrc===(y==null?void 0:y.ssrcs[0].ssrcId));if(S){const w=n.getLocalVideoSize(),I=n.getEncoderConfig(Ve.LocalVideoTrack);S.codec!=="H264"&&S.codec!=="H265"&&S.codec!=="VP8"&&S.codec!=="VP9"&&S.codec!=="AV1X"&&S.codec!=="AV1"||(m.codecType=S.codec),m.sendBytes=S.bytes,m.sendBitrate=h?8*Math.max(0,m.sendBytes-h.sendBytes):0,S.inputFrame?(m.captureFrameRate=S.inputFrame.frameRate,m.captureResolutionHeight=S.inputFrame.height,m.captureResolutionWidth=S.inputFrame.width):w&&(m.captureResolutionWidth=w.width,m.captureResolutionHeight=w.height),S.sentFrame?(m.sendFrameRate=S.sentFrame.frameRate,m.sendResolutionHeight=S.sentFrame.height,m.sendResolutionWidth=S.sentFrame.width):w&&(m.sendResolutionWidth=w.width,m.sendResolutionHeight=w.height),S.avgEncodeMs&&(m.encodeDelay=S.avgEncodeMs),I&&I.bitrateMax&&(m.targetSendBitrate=1e3*I.bitrateMax),m.sendPackets=S.packets,m.sendPacketsLost=S.packetsLost,m.sendJitterMs=S.jitterMs,m.sendRttMs=S.rttMs,m.totalDuration=h?h.totalDuration+1:1,m.totalFreezeTime=h?h.totalFreezeTime:0,this.isLocalVideoFreeze(S)&&(m.totalFreezeTime+=1),S.scalabilityMode&&this.scalabilityMode!==S.scalabilityMode&&(k.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(S.scalabilityMode)),this.scalabilityMode=S.scalabilityMode)}this.trafficStats&&(m.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var u;this.localStats.set(o,m),((h==null?void 0:h.sendResolutionWidth)!==m.sendResolutionWidth||(h==null?void 0:h.sendResolutionHeight)!==m.sendResolutionHeight)&&((u=this.onStatsChanged)===null||u===void 0||u.call(this,"resolution",{width:m.sendResolutionWidth,height:m.sendResolutionHeight})),m&&y&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,y.track,m);break}case Ve.LocalAudioTrack:{const h=c,m=l_({},SL),_=n.getStats(),y=n.getLocalMedia(o);if(_){const S=_.audioSend.find(w=>w.ssrc===(y==null?void 0:y.ssrcs[0].ssrcId));if(S){if(S.codec!=="opus"&&S.codec!=="aac"&&S.codec!=="PCMU"&&S.codec!=="PCMA"&&S.codec!=="G722"||(m.codecType=S.codec),S.inputLevel)m.sendVolumeLevel=Math.round(32767*S.inputLevel);else{const w=n.getLocalAudioVolume();w&&(m.sendVolumeLevel=Math.round(32767*w))}m.sendBytes=S.bytes,m.sendPackets=S.packets,m.sendPacketsLost=S.packetsLost,m.sendJitterMs=S.jitterMs,m.sendRttMs=S.rttMs,m.sendBitrate=h?8*Math.max(0,m.sendBytes-h.sendBytes):0}}this.trafficStats&&(m.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(Ve.LocalAudioTrack,m),m&&y&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,y.track,m);break}}})}updateRemoteStats(n){Array.from(this.remoteStats.entries()).forEach(i=>{var o,c;let[u,{videoStats:h,audioStats:m,videoPcStats:_}]=i;const y=m,S=h,w=_,I=l_({},wW),P=l_({},RW),B=l_({},qhe),{audioTrack:M,videoTrack:U,audioSSRC:q,videoSSRC:$}=n.getRemoteMedia(u);let ae;ae=this.store.useP2P?n.getStats(!0):n.getStats();const me=(o=ae)===null||o===void 0?void 0:o.audioRecv.find(Be=>Be.ssrc===q),ge=(c=ae)===null||c===void 0?void 0:c.videoRecv.find(Be=>Be.ssrc===$),pe=this.trafficStats&&this.trafficStats.peer_delay.find(Be=>Be.peer_uid===u);if(me&&(me.codec!=="opus"&&me.codec!=="aac"&&me.codec!=="PCMU"&&me.codec!=="PCMA"&&me.codec!=="G722"||(I.codecType=me.codec),me.outputLevel?I.receiveLevel=Math.round(32767*me.outputLevel):M&&(I.receiveLevel=Math.round(32767*M.getVolumeLevel())),I.receiveBytes=me.bytes,I.receivePackets=me.packets,I.receivePacketsLost=me.packetsLost,I.receivePacketsDiscarded=me.packetsDiscarded,I.packetLossRate=I.receivePacketsLost/(I.receivePackets+I.receivePacketsLost),I.receiveBitrate=y?8*Math.max(0,I.receiveBytes-y.receiveBytes):0,I.totalDuration=y?y.totalDuration+1:1,I.totalFreezeTime=y?y.totalFreezeTime:0,I.freezeRate=I.totalFreezeTime/I.totalDuration,I.receiveDelay=me.jitterBufferMs,I.totalDuration>10&&J0.isRemoteAudioFreeze(M)&&(I.totalFreezeTime+=1)),ge){var we;ge.codec!=="H264"&&ge.codec!=="H265"&&ge.codec!=="VP8"&&ge.codec!=="VP9"&&ge.codec!=="AV1X"&&ge.codec!=="AV1"||(P.codecType=ge.codec),P.receiveBytes=ge.bytes,P.receiveBitrate=S?8*Math.max(0,P.receiveBytes-S.receiveBytes):0,P.decodeFrameRate=ge.decodeFrameRate<0?0:ge.decodeFrameRate,P.renderFrameRate=ge.decodeFrameRate<0?0:ge.decodeFrameRate,ge.outputFrame&&(P.renderFrameRate=ge.outputFrame.frameRate),ge.receivedFrame?(P.receiveFrameRate=ge.receivedFrame.frameRate,P.receiveResolutionHeight=ge.receivedFrame.height,P.receiveResolutionWidth=ge.receivedFrame.width):U&&(P.receiveResolutionHeight=U._videoHeight||0,P.receiveResolutionWidth=U._videoWidth||0),ge.framesRateFirefox!==void 0&&(P.receiveFrameRate=Math.round(ge.framesRateFirefox)),P.receivePackets=ge.packets,P.receivePacketsLost=ge.packetsLost,P.packetLossRate=P.receivePacketsLost/(P.receivePackets+P.receivePacketsLost);const Be=S?S.totalFreezeTime:0,nt=S?S.totalDuration:0;P.totalDuration=S?S.totalDuration+1:1,P.totalFreezeTime=(we=ge.totalFreezesDuration)!==null&&we!==void 0?we:Be||0,P.receiveDelay=ge.jitterBufferMs||0;const st=!!$&&n.getRemoteVideoIsReady($);ge.totalFreezesDuration===void 0&&U&&st&&J0.isRemoteVideoFreeze(U,ge,w)&&(P.totalFreezeTime+=1),P.freezeRate=Math.max(0,Math.min((P.totalFreezeTime-Be)/(P.totalDuration-nt),1))}pe&&(I.end2EndDelay=pe.B_ad,P.end2EndDelay=pe.B_vd,I.transportDelay=pe.B_ed,P.transportDelay=pe.B_ed,I.currentPacketLossRate=pe.B_ealr4/100,P.currentPacketLossRate=pe.B_evlr4/100,B.uplinkNetworkQuality=pe.B_punq?pe.B_punq:0,B.downlinkNetworkQuality=pe.B_pdnq?pe.B_pdnq:0),this.remoteStats.set(u,{audioStats:I,videoStats:P,videoPcStats:ge,networkStats:B}),M&&this.exceptionMonitor.setRemoteAudioStats(M,I),U&&this.exceptionMonitor.setRemoteVideoStats(U,P)})}}class PH{constructor(){K(this,"destChannelMediaInfos",new Map),K(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(n){Mz(n),this.srcChannelMediaInfo=n}addDestChannelInfo(n){Mz(n),this.destChannelMediaInfos.set(n.channelName,n)}removeDestChannelInfo(n){RA(n),this.destChannelMediaInfos.delete(n)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function NH(e){if(!(e instanceof PH))return new be(Y.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const n=e.getSrcChannelMediaInfo(),i=e.getDestChannelMediaInfo();if(!n)return new be(Y.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(i.size===0)return new be(Y.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class om{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(n,i){K(this,"uid",void 0),K(this,"_uintid",void 0),K(this,"_trust_in_room_",!0),K(this,"_trust_audio_enabled_state_",!0),K(this,"_trust_video_enabled_state_",!0),K(this,"_trust_audio_mute_state_",!0),K(this,"_trust_video_mute_state_",!0),K(this,"_audio_muted_",!1),K(this,"_video_muted_",!1),K(this,"_audio_enabled_",!0),K(this,"_video_enabled_",!0),K(this,"_audio_added_",!1),K(this,"_video_added_",!1),K(this,"_is_pre_created",!1),K(this,"_video_pre_subscribed",!1),K(this,"_audio_pre_subscribed",!1),K(this,"_trust_video_stream_added_state_",!0),K(this,"_trust_audio_stream_added_state_",!0),K(this,"_audioTrack",void 0),K(this,"_videoTrack",void 0),K(this,"_dataChannels",[]),K(this,"_audioSSRC",void 0),K(this,"_videoSSRC",void 0),K(this,"_audioOrtc",void 0),K(this,"_videoOrtc",void 0),K(this,"_cname",void 0),K(this,"_rtxSsrcId",void 0),K(this,"_videoMid",void 0),K(this,"_audioMid",void 0),this.uid=n,this._uintid=i}}function kH(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function DH(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?kH(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):kH(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}const Q0="9",LH=4e4;function xH(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function Df(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?xH(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):xH(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}var vv=function(e){return e[e.DOWN=0]="DOWN",e[e.UP=1]="UP",e}(vv||{});const FA=new Map;function MH(e,n,i,o){let{scale:c}=e;if(c===0&&o===vv.UP||c>=n.length-1&&o===vv.DOWN)return e;let u=Df(Df({},e),{},{scale:o===vv.DOWN?++c:--c});switch(i){case"maintain-framerate":u=Df(Df({},u),n[c].motion);break;case"maintain-resolution":u=Df(Df({},u),n[c].detail);break;case"balanced":u=Df(Df({},u),n[c].balanced)}return u}function UH(e,n){if(n){const i={overUse:0,underUse:0,adaptationList:VH(n)};FA.set(e,i)}else FA.delete(e)}function VH(e){const n=Df({},e),{bitrateMax:i,frameRate:o,scaleResolutionDownBy:c,bitrateMin:u}=n,{MIN_FRAME_RATE:h,MAX_THRESHOLD_FRAMERATE:m,MAX_SCALE:_,BITRATE_MIN_THRESHOLD:y,BITRATE_MAX_THRESHOLD:S,BWE_SCALE_UP_THRESHOLD:w,BWE_SCALE_DOWN_THRESHOLD:I,PERF_SCALE_DOWN_THRESHOLD:P,PERF_SCALE_UP_THRESHOLD:B,BALANCE_BITRATE_FACTOR:M,BALANCE_FRAMERATE_FACTOR:U,BALANCE_RESOLUTION_FACTOR:q,MOTION_RESOLUTION_FACTOR:$,MOTION_BITRATE_FACTOR:ae,DETAIL_FRAMERATE_FACTOR:me,DETAIL_BITRATE_FACTOR:ge}=pL,pe=Math.min(n.frameRate,m),we=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(I,1)*i),bwe_up:i,fps_down:Math.round(Math.pow(P,1)*pe),fps_up:o},balanced:{scaleResolutionDownBy:1,frameRate:o,bitrateMax:i,bitrateMin:u},motion:{scaleResolutionDownBy:1,frameRate:o,bitrateMax:i,bitrateMin:u},detail:{scaleResolutionDownBy:1,frameRate:o,bitrateMax:i,bitrateMin:u}}];for(let Be=1;Be<=_;Be++){const nt={bwe_up:Math.round(Math.pow(w,Be)*i),bwe_down:Math.round(Math.pow(I,Be+1)*i),fps_up:Math.round(Math.pow(B,Be)*pe),fps_down:Math.round(Math.pow(P,Be+1)*pe)},st={scaleResolutionDownBy:c/Math.pow(q,Be),frameRate:Math.max(Math.round(Math.pow(U,Be)*o),h),bitrateMax:Math.max(Math.round(Math.pow(M,Be)*i),S),bitrateMin:Math.max(Math.round(Math.pow(M,Be)*u),y)},pn={scaleResolutionDownBy:c/Math.pow($,Be),frameRate:o,bitrateMax:Math.max(Math.round(Math.pow(ae,Be)*i),S),bitrateMin:Math.max(Math.round(Math.pow(ae,Be)*u),y)},mn={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(me,Be)*o),h),bitrateMax:Math.max(Math.round(Math.pow(ge,Be)*i),S),bitrateMin:Math.max(Math.round(Math.pow(ge,Be)*u),y)};we.push({scale:Be,threshold:nt,balanced:st,motion:pn,detail:mn})}return we}function upe(e,n,i,o,c,u){const h=FA.get(e)||{overUse:0,underUse:0,adaptationList:VH(c)},{adaptationList:m}=h;FA.set(e,h);const{OVERUSE_TIMES_THRESHOLD:_,UNDERUSE_TIMES_THRESHOLD:y}=pL,{scale:S}=o;let w,I;return typeof n=="number"&&n>0&&function(P,B,M,U){if(B>=M.length)return!1;let{threshold:{fps_down:q}}=M[B];return Z("FORCE_AG_HIGH_FRAMERATE")&&U==="maintain-framerate"&&(q=M[0].threshold.fps_down),P<q}(n,S,m,u)&&(h.overUse++,I=M0.CPU,h.overUse>_)||typeof i=="number"&&i>0&&function(P,B,M){if(B>=M.length)return!1;const{threshold:{bwe_down:U}}=M[B];return P<U}(i,S,m)&&(h.overUse++,I=M0.BANDWIDTH,h.overUse>_)?(h.overUse=0,h.underUse=0,w=MH(o,m,u,vv.DOWN),[w,I]):(typeof n=="number"&&n>0&&typeof i=="number"&&i>0&&function(P,B,M,U){if(B===0)return;let{threshold:{fps_up:q}}=M[B];return Z("FORCE_AG_HIGH_FRAMERATE")&&U==="maintain-framerate"&&(q=M[1].threshold.fps_up),P>q}(n,S,m,u)&&function(P,B,M){if(B===0)return;const{threshold:{bwe_up:U}}=M[B];return P>U}(i,S,m)&&(h.underUse++,h.underUse>y&&(h.overUse=0,h.underUse=0,w=MH(o,m,u,vv.UP),w.scale===0&&(I=M0.NONE))),[w,I])}function FH(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function ux(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?FH(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):FH(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function dpe(e){var n;return!!Z("ENABLE_AG_ADAPTATION")&&!!(e instanceof NL||Xe(n=e._hints).call(n,ir.CUSTOM_TRACK))&&(!!Z("FORCE_SUPPORT_AG_ADAPTATION")||!!(function(i){const o=Tn();if(o.os!==Ai.IOS||!o.osVersion)return!1;const c=o.osVersion.split(".");return Number(c[0])>=i}(14)&&x6(17,4)||L6(14)&&M6(17,4,!0)))}const jA=new Map;function BA(e,n){const i=jA.get(e);if(i){const{timer:o}=i;window.clearTimeout(o),jA.delete(e)}n.qualityLimitationReason=M0.NONE,UH(e)}function hpe(e,n){var i;let o;switch(n){case Ve.LocalAudioTrack:o=jn.Audio;break;case Ve.LocalVideoTrack:o=Xe(i=e._hints).call(i,ir.SCREEN_TRACK)?jn.Screen:jn.High;break;case Ve.LocalVideoLowTrack:o=jn.Low}return o}function dx(e){const n=On();if(e.some(i=>i._bypassWebAudio))throw new Ce(Y.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!n.webAudioMediaStreamDest)throw new Ce(Y.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function hx(e,n){dx(e);const i=new yi;return e.forEach(o=>i.addAudioTrack(o)),i}const fpe=!On().supportUnifiedPlan||Z("CHROME_FORCE_PLAN_B")&&bf();function WA(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i;return fpe?(i={spec:n,store:e},Nf("PlanBConnection").create(i)):new Xd(n,e)}function fx(e){return e&&(e.iceConnectionState==="disconnected"||e.iceConnectionState==="checking"||e.iceConnectionState==="failed")}function jH(e){try{if(e.iceServers)return!1;if(e.turnServer&&e.turnServer.mode!=="off"){if(D0(e.turnServer.servers))return!1;if(Z("FORCE_TURN_TCP")||e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).some(n=>n.forceturn))return!0}return!1}catch{return!1}}var vn;function BH(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function Zu(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?BH(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):BH(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}let Xd=(vn=class P_ extends jz{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var n,i;return(n=(i=this.peerConnection.getReceivers()[0])===null||i===void 0||(i=i.transport)===null||i===void 0?void 0:i.state)!==null&&n!==void 0?n:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(n=>n.rtpMap&&n.rtpMap.encodingName.toLowerCase()||"").filter(n=>{var i;return Xe(i=Object.keys(aA)).call(i,n)}))]}constructor(n,i){super(n,i),K(this,"id",rr(5,"connection-")),K(this,"store",void 0),K(this,"peerConnection",void 0),K(this,"forceTurn",!1),K(this,"remoteSDP",void 0),K(this,"initialOffer",void 0),K(this,"transportEventReceiver",void 0),K(this,"statsFilter",void 0),K(this,"extension",{useXR:Z("USE_XR")}),K(this,"localCapabilities",void 0),K(this,"remoteCodecs",void 0),K(this,"localCandidateCount",0),K(this,"allCandidatesReceived",!1),K(this,"isPreallocation",!1),K(this,"preSSRCMap",new Map),K(this,"dataStreamChannelMap",new Map),K(this,"establishPromise",void 0),K(this,"recoveredDataChannelIds",[]),K(this,"currentDataChannelId",1),K(this,"supportAV1RtpSpec",!1),K(this,"mutex",void 0),K(this,"qualityLimitationReason",M0.NONE),K(this,"isFirstConnected",!1),this.store=i,this.forceTurn=jH(n),this.mutex=new Es("P2PConnection-mutex",i.clientId),this.peerConnection=new RTCPeerConnection(P_.resolvePCConfiguration(n),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=dL(this.peerConnection,Z("STATS_UPDATE_INTERVAL"),void 0,Pr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}getPreMedia(n){const i=this.preSSRCMap.get(n);if(i!==void 0){const o=this.peerConnection.getTransceivers().find(c=>c.mid===i);if(o)return{transceiver:o,track:o.receiver.track,id:i}}}async updateRemoteRTPCapabilities(n,i){if(this.remoteCodecs=i,!this.remoteSDP)return void k.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(i));if(this.remoteSDP.updateRemoteCodec(n,i,this.store.codec)){const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(o);const u=this.remoteSDP.toString();c==null||c(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}else k.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const o=await this.peerConnection.createOffer();if(!o.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const c=im(o.sdp),u=await oH({filterRTX:!Z("USE_PUB_RTX")&&!Z("USE_SUB_RTX"),filterVideoFec:Z("FILTER_VIDEO_FEC"),filterAudioFec:Z("FILTER_AUDIO_FEC"),filterVideoCodec:Z("FILTER_VIDEO_CODEC")},this.extension);if(this.localCapabilities=LA(u),this.initialOffer=o,Z("ENABLE_SVC")&&this.store.codec=="av1"){const m=await async function(){try{const _=new RTCPeerConnection;_.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:sA.L1T3}]});const y=await _.createOffer();if(!y.sdp)return void _.close();const S=da(y.sdp).mediaDescriptions[0];if(!S)return;const w=S.attributes.extmaps.find(I=>I.extensionName==="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension");return _.close(),w}catch{return}}();var n;m&&(this.supportAV1RtpSpec=!0,(n=u.send)===null||n===void 0||n.videoExtensions.push(m))}let h;return o.sdp&&uH(o.sdp)&&(h=Dr(u),(i=h).send&&(mv(at.VIDEO,i.send.videoExtensions),mv(at.AUDIO,i.send.audioExtensions)),i.recv&&(mv(at.VIDEO,i.recv.videoExtensions),mv(at.AUDIO,i.recv.audioExtensions)),i.sendrecv&&(mv(at.VIDEO,i.sendrecv.videoExtensions),mv(at.AUDIO,i.sendrecv.audioExtensions))),Zu(Zu({},c),{},{rtpCapabilities:h||u,offerSDP:o.sdp})}catch(o){throw new Ce(Y.GET_LOCAL_CONNECTION_PARAMS_FAILED,o.toString())}var i}async connect(n){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&uH(this.initialOffer.sdp)&&(i=n.rtpCapabilities,o=this.localCapabilities,i.send&&(NA(at.VIDEO,i.send.videoExtensions,o.send.videoExtensions),NA(at.AUDIO,i.send.audioExtensions,o.send.audioExtensions)),i.recv&&(NA(at.VIDEO,i.recv.videoExtensions,o.recv.videoExtensions),NA(at.AUDIO,i.recv.audioExtensions,o.recv.audioExtensions))),this.remoteSDP=new class{get localCapabilities(){return Dr(this._localCapabilities)}get rtpCapabilities(){return Dr(this._rtpCapabilities)}get candidates(){return Dr(this._candidates)}get iceParameters(){return Dr(this._iceParameters)}get dtlsParameters(){return Dr(this._dtlsParameters)}constructor(y){let S=arguments.length>1&&arguments[1]!==void 0&&arguments[1];K(this,"sessionDesc",void 0),K(this,"_localCapabilities",void 0),K(this,"_rtpCapabilities",void 0),K(this,"_candidates",void 0),K(this,"_originCandidates",void 0),K(this,"_iceParameters",void 0),K(this,"_isUseExtmapAllowMixed",void 0),K(this,"_dtlsParameters",void 0),K(this,"setup",void 0),K(this,"currentMidIndex",void 0),K(this,"cname",void 0),K(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=S,y=Dr(y);const{iceParameters:w,dtlsParameters:I,candidates:P,rtpCapabilities:B,setup:M,localCapabilities:U,cname:q}=y;this._rtpCapabilities=B,this._candidates=P,this._originCandidates=Dr(P),this._iceParameters=w,this._dtlsParameters=I,this._localCapabilities=U,this.setup=M,this.cname=q,this.sessionDesc=this.updateRemoteRTPCapabilities(B),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}preloadRemoteMedia(y){const S=this.candidates,w=this.dtlsParameters,I=this.iceParameters,P=this.rtpCapabilities.send;let B=this.sessionDesc.mediaDescriptions.length-1;for(let M=1;M<y;M++){const U=2*M+2e4,q=2*M+LH,{ssrcs:$,ssrcGroups:ae}=c_([{ssrcId:U}],this.cname),{ssrcs:me,ssrcGroups:ge}=c_([{ssrcId:q,rtx:Z("USE_SUB_RTX")?q+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:Q0,protos:["UDP","TLS","RTP","SAVPF"],fmts:P.videoCodecs.map(pe=>pe.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:I.iceUfrag,icePwd:I.icePwd,unrecognized:[],candidates:S,extmaps:P.videoExtensions,fingerprints:w.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:me,ssrcGroups:ge,rtcpFeedbackWildcards:[],payloads:P.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++B)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:Q0,protos:["UDP","TLS","RTP","SAVPF"],fmts:P.audioCodecs.map(pe=>pe.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:I.iceUfrag,icePwd:I.icePwd,unrecognized:[],candidates:S,extmaps:P.audioExtensions,fingerprints:w.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:$,ssrcGroups:ae,rtcpFeedbackWildcards:[],payloads:P.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++B)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return Zp(this.sessionDesc)}send(y,S,w,I){const{ssrcs:P,ssrcGroups:B}=c_(S,this.cname,Z("SYNC_GROUP")?w:void 0),M=this.findPreloadMediaDesc(P);if(M){if(Pr()&&this.firefoxSsrcMidMap.set(P[0].ssrcId,M.attributes.mid),I&&(I.twcc||I.remb)){const U=this.sessionDesc.mediaDescriptions.indexOf(M);return this.sessionDesc.mediaDescriptions[U]=this.mungSendMediaDesc(M,I),{mid:M.attributes.mid,needExchangeSDP:!0}}return{mid:M.attributes.mid,needExchangeSDP:!1}}{const U=this.findAvailableMediaIndex(y,P);let q;return U===-1||U===1&&(ls()||function(){const $=Tn();return!($.name!==Ln.CHROME||!$.osVersion)&&Number($.version)<=90}()||Z("ENABLE_ENCODED_TRANSFORM")&&Tf())||U===0&&Z("USE_SUB_RTX")||U6()?(q=this.createOrRecycleSendMedia(y,P,B,"sendonly",I),this.updateBundleMids()):(q=Dr(this.sessionDesc.mediaDescriptions[U]),q.attributes.direction="sendonly",q.attributes.ssrcs=P,q.attributes.ssrcGroups=B,this.sessionDesc.mediaDescriptions[U]=this.mungSendMediaDesc(q,I)),Pr()&&this.firefoxSsrcMidMap.set(P[0].ssrcId,q.attributes.mid),{mid:q.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:y,needExchangeSDP:S}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:y.attributes.mid,needExchangeSDP:S}}batchSend(y){const S=y.map(P=>{let{kind:B,ssrcMsg:M,mslabel:U}=P;return this.send(B,M,U)}),w=[];let I=!1;return S.forEach(P=>{let{mid:B,needExchangeSDP:M}=P;M&&(I=!0),w.push(B)}),{mids:w,needExchangeSDP:I}}stopSending(y){const S=this.sessionDesc.mediaDescriptions.filter(w=>w.attributes.mid&&y.indexOf(w.attributes.mid)!==-1);if(S.length!==y.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");S.forEach(w=>{w.attributes.mid==="0"||Pr()||U6()?w.attributes.ssrcs=[]:(w.attributes.ssrcs=[],w.attributes.direction="inactive",w.media.port="0")}),this.updateBundleMids()}mute(y){const S=this.sessionDesc.mediaDescriptions.find(w=>w.attributes.mid===y);if(!S)throw new Error("mediaDescription not found with ".concat(y," in remote SDP when calling RemoteSDP.mute."));S.attributes.direction="inactive"}unmute(y){const S=this.sessionDesc.mediaDescriptions.find(w=>w.attributes.mid===y);if(!S)throw new Error("mediaDescription not found with ".concat(y," in remote SDP when calling RemoteSDP.unmute."));S.attributes.direction="sendonly"}muteRemote(y){const S=this.sessionDesc.mediaDescriptions.filter(w=>Xe(y).call(y,w.attributes.mid||""));if(S.length!==y.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");S.forEach(w=>{w.attributes.direction="inactive"})}unmuteRemote(y){const S=this.sessionDesc.mediaDescriptions.filter(w=>Xe(y).call(y,w.attributes.mid||""));if(S.length!==y.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");S.forEach(w=>{w.attributes.direction="recvonly"})}receive(y,S,w,I){y.forEach((P,B)=>{this.createOrRecycleRecvMedia(P,[],"recvonly",S,w,I[B])}),this.updateBundleMids()}stopReceiving(y){const S=this.sessionDesc.mediaDescriptions.filter(w=>y.indexOf(w.attributes.mid)!==-1);if(S.length!==y.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");S.forEach(w=>{w.media.port="0",w.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(y){const S=this.sessionDesc||da((w=this._isUseExtmapAllowMixed,`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite`.concat(w?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`)));var w;this._rtpCapabilities=y;const I=this.rtpCapabilities.send,P=this.localCapabilities.send;for(const B of S.mediaDescriptions){if(B.attributes.iceUfrag=this._iceParameters.iceUfrag,B.attributes.icePwd=this._iceParameters.icePwd,B.attributes.fingerprints=this._dtlsParameters.fingerprints,B.attributes.candidates=this._candidates,B.attributes.setup=this.setup,B.media.mediaType==="application"&&(B.attributes.sctpPort="5000"),B.media.mediaType==="video"){if(I.videoCodecs.length===0){const M=P.videoCodecs.filter(U=>{var q,$;return(q=U.rtpMap)===null||q===void 0?void 0:Xe($=q.encodingName.toLowerCase()).call($,"vp8")})||[P.videoCodecs[0]];B.media.fmts=M.map(U=>U.payloadType.toString(10)),B.attributes.payloads=M,B.attributes.extmaps=[]}else if(B.media.fmts=I.videoCodecs.map(M=>M.payloadType.toString(10)),B.attributes.payloads=I.videoCodecs,B.attributes.extmaps=I.videoExtensions,Z("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:M,ssrcGroups:U}=c_([{ssrcId:LH,rtx:Z("USE_SUB_RTX")?40001:void 0}],this.cname);B.attributes.ssrcs=M,B.attributes.ssrcGroups=U}}if(B.media.mediaType==="audio"){if(I.audioCodecs.length===0){const M=P.audioCodecs.filter(U=>{var q,$;return(q=U.rtpMap)===null||q===void 0?void 0:Xe($=q.encodingName.toLowerCase()).call($,"opus")})||[P.audioCodecs[0]];B.media.fmts=M.map(U=>U.payloadType.toString(10)),B.attributes.payloads=M,B.attributes.extmaps=[]}else if(B.media.fmts=I.audioCodecs.map(M=>M.payloadType.toString(10)),B.attributes.payloads=I.audioCodecs,B.attributes.extmaps=I.audioExtensions,_v(B),Z("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:M,ssrcGroups:U}=c_([{ssrcId:2e4}],this.cname);B.attributes.ssrcs=M,B.attributes.ssrcGroups=U}}}return this.sessionDesc=S,this.currentMidIndex=S.mediaDescriptions.length-1,this.sessionDesc}updateCandidates(y){const S=this._originCandidates.filter(I=>I.transport==="udp"),w=[];if(S.forEach(I=>{w.push(DH(DH({},I),{},{foundation:"tcpcandidate",priority:Number(I.priority)-1+"",transport:"tcp",port:Number(I.port)+90+""}))}),S.length!==0){switch(y){case vs.TCP_RELAY:this._candidates=w;break;case vs.UDP_TCP_RELAY:case vs.RELAY:this._candidates=[...S,...w];break;default:this._candidates=S}for(const I of this.sessionDesc.mediaDescriptions)I.attributes.candidates=this.candidates}}restartICE(y){y=Dr(y),this._iceParameters=y,this.sessionDesc.mediaDescriptions.forEach(S=>{S.attributes.iceUfrag=y.iceUfrag,S.attributes.icePwd=y.icePwd})}predictReceivingMids(y){const S=[];for(let w=0;w<y;w++)S.push((this.currentMidIndex+w+1).toString(10));return S}findAvailableMediaIndex(y,S){return this.sessionDesc.mediaDescriptions.findIndex(w=>{const I=w.media.mediaType===y&&w.media.port!=="0"&&(w.attributes.direction==="sendonly"||w.attributes.direction==="sendrecv")&&w.attributes.ssrcs.length===0;if(Pr()){if(I){const P=this.firefoxSsrcMidMap.get(S[0].ssrcId);return!(P||w.attributes.mid!=="0"&&w.attributes.mid!=="1")||!(!P||P!==w.attributes.mid)}return!1}return I})}createOrRecycleDataChannel(){for(const w of this.sessionDesc.mediaDescriptions)if(w.media.mediaType==="application")return{mediaDesc:w,needExchangeSDP:!1};this.currentMidIndex+=1;const y="".concat(this.currentMidIndex),S={media:{mediaType:"application",port:Q0,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(y),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(S),{mediaDesc:S,needExchangeSDP:!0}}createOrRecycleRecvMedia(y,S,w,I,P,B){const M=y._mediaStreamTrack.kind,U=this.rtpCapabilities.recv,q=q0(M,U,this.localCapabilities.send,M===at.VIDEO?I:P),$=M===at.VIDEO?U.videoExtensions:U.audioExtensions;this.currentMidIndex+=1;const ae="".concat(this.currentMidIndex);let me={media:{mediaType:M,port:Q0,protos:["UDP","TLS","RTP","SAVPF"],fmts:q.map(pe=>pe.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:$,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:S,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:q,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:w,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(ae)}};me=this.mungRecvMediaDsec(me,y,B);const ge=this.findFirstClosedMedia(M);if(ge){const pe=this.sessionDesc.mediaDescriptions.indexOf(ge);this.sessionDesc.mediaDescriptions[pe]=me}else this.sessionDesc.mediaDescriptions.push(me);return me}updateRemoteCodec(y,S,w){const I=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(me=>me.rtpMap&&me.rtpMap.encodingName.toLowerCase()||"").filter(me=>{var ge;return Xe(ge=Object.keys(aA)).call(ge,me)}))],P=new Set(S);if(I.every(me=>P.has(me)))return k.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(S)),!1;const B=this._rtpCapabilities.recv.videoCodecs.filter(me=>S.some(ge=>{var pe;return Xe(pe=me.rtpMap&&me.rtpMap.encodingName.toLowerCase()||"").call(pe,ge)}));if(B.length===0)return k.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(I," codecs: ").concat(S)),!1;const M=[...new Set(B.map(me=>me.rtpMap&&me.rtpMap.encodingName.toLowerCase()||""))];let U;if(k.debug("updateRemoteCodec, from ".concat(I," to ").concat(M)),y.length===0)U=this.sessionDesc.mediaDescriptions.filter(me=>me.media.mediaType==="video"&&me.attributes.direction==="recvonly");else if(U=this.sessionDesc.mediaDescriptions.filter(me=>me.attributes.mid&&Xe(y).call(y,me.attributes.mid)&&me.attributes.direction==="recvonly"),U.length!==y.length)return k.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(y,", codecs: ").concat(S)),!1;if(Z("USE_PUB_RTX")||Z("USE_SUB_RTX")){const me=ZL(B,this.rtpCapabilities.recv.videoCodecs);B.push(...me)}this._rtpCapabilities.recv.videoCodecs=B;const q=this.localCapabilities.send,$=this.rtpCapabilities.recv,ae=q0(at.VIDEO,$,q,w);return U.forEach(me=>{const ge=ae.map(pe=>pe.payloadType.toString(10));k.debug("updateRemoteCodec mid: ".concat(me.attributes.mid,", from"),me.attributes.payloads,"to",ae),me.attributes.payloads=ae,me.media.fmts=ge}),!0}createOrRecycleSendMedia(y,S,w,I,P){const B=this.rtpCapabilities.send,M=y===at.VIDEO?B.videoCodecs:B.audioCodecs,U=y===at.VIDEO?B.videoExtensions:B.audioExtensions;this.currentMidIndex+=1;const q="".concat(this.currentMidIndex);let $={media:{mediaType:y,port:Q0,protos:["UDP","TLS","RTP","SAVPF"],fmts:M.map(me=>me.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:U,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:S,ssrcGroups:w,rtcpFeedbackWildcards:[],payloads:M,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:I,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(q)}};$=this.mungSendMediaDesc($,P);const ae=this.findFirstClosedMedia(y);if(ae){const me=this.sessionDesc.mediaDescriptions.indexOf(ae);this.sessionDesc.mediaDescriptions[me]=$}else this.sessionDesc.mediaDescriptions.push($);return $}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(y=>y.media.port!=="0").map(y=>y.attributes.mid)}mungRecvMediaDsec(y,S,w){const I=Dr(y);return JL(I),gv(I,S),QL(I,S),iH(I),DA(I,w,this.localCapabilities.send),I}mungSendMediaDesc(y,S){const w=Dr(y);return DA(w,S,this.localCapabilities.recv),_v(w),w}updateRecvMedia(y,S){const w=this.sessionDesc.mediaDescriptions.findIndex(I=>I.attributes.mid===y);if(w!==-1){const I=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[w],S);this.sessionDesc.mediaDescriptions[w]=I}}bumpMid(y){this.currentMidIndex+=y}findFirstClosedMedia(y){return this.sessionDesc.mediaDescriptions.find(S=>Pr()?S.media.port==="0"&&S.media.mediaType===y:S.media.port==="0")}findPreloadMediaDesc(y){return this.sessionDesc.mediaDescriptions.find(S=>{var w;return((w=S.attributes)===null||w===void 0||(w=w.ssrcs[0])===null||w===void 0?void 0:w.ssrcId)===y[0].ssrcId})}getSSRC(y){var S;return(S=this.sessionDesc.mediaDescriptions.find(w=>w.attributes.mid===y))===null||S===void 0?void 0:S.attributes.ssrcs}}(Zu(Zu({},n),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec),n.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const c=this.remoteSDP.toString(),u=cH(this.initialOffer.sdp,this.extension),h=this.logSDPExchange(u||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:u}),h==null||h(c),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c});const m=this.peerConnection.getTransceivers()[0];if(m!=null&&m.receiver&&this.tryBindTransportEvents(m.receiver),Z("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia(Z("PRELOAD_MEDIA_COUNT"));const y=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:y});const S=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(S)}const{preSSRCs:_}=n;if(Array.isArray(_)&&_.length>0){const{mids:y}=this.remoteSDP.batchSend(_.map(S=>({kind:S.kind,ssrcMsg:[{ssrcId:S.ssrcId,rtx:S.rtx}],mslabel:S.mslabel})));y.forEach((S,w)=>{this.preSSRCMap.set(_[w].ssrcId,S)}),await $0(this.peerConnection,this.remoteSDP,this.extension),k.debug("[".concat(this.store.clientId,"] [P2PConnection] pre-batchReceive exchange SDP."))}}catch(c){throw new Ce(Y.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(c.toString()))}var i,o}async updateRemoteConnect(n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");const{rtpCapabilities:i}=n;this.remoteSDP.updateRemoteRTPCapabilities(i),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const{preSSRCs:o}=n;if(Array.isArray(o)&&o.length>0){const{mids:c}=this.remoteSDP.batchSend(o.map(u=>Object.assign({},{kind:u.kind,ssrcMsg:[{ssrcId:u.ssrcId,rtx:u.rtx}],mslabel:u.mslabel})));c.forEach((u,h)=>{this.preSSRCMap.set(o[h].ssrcId,u)})}await $0(this.peerConnection,this.remoteSDP,this.extension),k.debug("[P2PConnection] updateRemoteRTPCapabilities by exchanging SDP.")}catch(i){throw new Ce(Y.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(i.toString()))}}send(n,i,o){var c=this;return el(function*(){const u=yield Sn(c.mutex.lock("From P2PConnection.send"));try{if(!c.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const h=[],m=PA();n.forEach(U=>{const q=c.peerConnection.addTransceiver(U._mediaStreamTrack,Zu({direction:"sendonly"},U.trackMediaType==="video"&&c.supportAV1RtpSpec&&m?{sendEncodings:[{scalabilityMode:m}]}:{}));h.push(q),U._updateRtpTransceiver(q)}),Pr()&&Z("SIMULCAST")===!0&&(yield Sn(c.applySimulcastForFirefox(h,n)));const _=yield Sn(c.peerConnection.createOffer()),y=c.remoteSDP.predictReceivingMids(n.length),S=c.mungSendOfferSDP(_.sdp,n,y),w=da(S),I=y.map(U=>{const q=w.mediaDescriptions.find($=>$.attributes.mid===U);if(!q)throw new Error("Cannot extract ssrc from mediaDescription.");return tH(q,Z("USE_PUB_RTX"))});let P;try{P=yield I}catch(U){P=[],c.remoteSDP.receive(n,i,o,P);const q=c.remoteSDP.toString();throw yield Sn(c.peerConnection.setLocalDescription({type:"offer",sdp:S})),yield Sn(c.peerConnection.setRemoteDescription({type:"answer",sdp:q})),yield Sn(c.stopSending(y,!0)),U}c.remoteSDP.receive(n,i,o,P);const B=c.remoteSDP.toString(),M=c.logSDPExchange(S,"offer","local","send");return yield Sn(c.peerConnection.setLocalDescription({type:"offer",sdp:S})),yield Sn(c.applySimulcastEncodings(h,n)),yield Sn(c.applySendEncodings(h,n)),M==null||M(B),yield Sn(c.peerConnection.setRemoteDescription({type:"answer",sdp:B})),h.map((U,q)=>{const $=y[q];return{localSSRC:I[q],id:$,transceiver:U}})}catch(h){throw h instanceof Ce?h:new Ce(Y.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{u()}})()}async createDataChannels(n,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let o=this.dataStreamChannelMap.get(n);if(o&&o.readyState==="open")k.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const u=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof u!="number")throw new Error("create DataChannel error, because cannot get dc id");o=this.peerConnection.createDataChannel("datastream-channel",{id:u,negotiated:!0,ordered:!1,maxRetransmits:Z("DATASTREAM_MAX_RETRANSMITS")}),o.binaryType="arraybuffer",this.dataStreamChannelMap.set(n,o)}i.forEach(u=>{u._updateOriginDataChannel(o)});const{needExchangeSDP:c}=this.remoteSDP.sendDataChannel();if(c){const u=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:u});const h=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(h),k.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else k.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(o){throw o instanceof Ce?o:new Ce(Y.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(o.toString()))}}async stopDataChannels(n){try{const i=this.dataStreamChannelMap.get(n);return i&&(i.id&&this.recoveredDataChannelIds.push(i.id),i.close()),void this.dataStreamChannelMap.delete(n)}catch(i){throw i instanceof Ce?i:new Ce(Y.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(i.toString()))}}async stopSending(n,i){const o=i?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const c=this.peerConnection.getTransceivers().filter(_=>n.indexOf(_.mid)!==-1);if(c.length!==n.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");c.map(_=>{var y;BA(this.id+_.mid,this),_.direction="inactive",(y=_.stop)===null||y===void 0||y.call(_)});const u=await this.peerConnection.createOffer(),h=this.logSDPExchange(u.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(u),this.remoteSDP.stopReceiving(n);const m=this.remoteSDP.toString();h==null||h(m),await this.peerConnection.setRemoteDescription({type:"answer",sdp:m})}catch(c){throw new Ce(Y.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(c.toString()))}finally{o&&o()}}async receive(n,i,o,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(n," before remoteSDP created."));const{mid:u,needExchangeSDP:h}=this.remoteSDP.send(n,i,o,c);h&&(await $0(this.peerConnection,this.remoteSDP,this.extension),k.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(n," by exchanging SDP.")));const m=this.peerConnection.getTransceivers().find(_=>_.mid===u);if(!m)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:m.receiver.track,id:u,transceiver:m}}catch(u){throw new Ce(Y.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async batchReceive(n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:i,needExchangeSDP:o}=this.remoteSDP.batchSend(n);return o&&(await $0(this.peerConnection,this.remoteSDP,this.extension),k.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),i.map(c=>{const u=this.peerConnection.getTransceivers().find(h=>h.mid===c);if(!u)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:u.receiver.track,id:c,transceiver:u}})}catch(i){throw new Ce(Y.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(i.toString()))}}async stopReceiving(n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");n.forEach(u=>{Array.from(this.preSSRCMap.entries()).some(h=>{let[m,_]=h;if(_===u)return this.preSSRCMap.delete(m),!0})}),this.remoteSDP.stopSending(n);const i=this.remoteSDP.toString(),o=this.logSDPExchange(i,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const c=await this.peerConnection.createAnswer();o==null||o(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(i){throw new Ce(Y.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}async muteRemote(n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(n," before remote SDP created."));this.remoteSDP.mute(n);const i=this.remoteSDP.toString(),o=this.logSDPExchange(i,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const c=await this.peerConnection.createAnswer();o==null||o(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(i){throw new Ce(Y.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(i.toString()))}}async unmuteRemote(n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(n," before remote SDP created."));this.remoteSDP.unmute(n);const i=this.remoteSDP.toString(),o=this.logSDPExchange(i,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const c=await this.peerConnection.createAnswer();o==null||o(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(i){throw new Ce(Y.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(i.toString()))}}async muteLocal(n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const i=this.peerConnection.getTransceivers().filter(h=>h.mid&&n.indexOf(h.mid)!==-1);if(i.length!==n.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(h=>{h.direction="inactive"});const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.muteRemote(n);const u=this.remoteSDP.toString();c==null||c(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(i){throw new Ce(Y.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(i.toString()))}}async unmuteLocal(n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const i=this.peerConnection.getTransceivers().filter(h=>h.mid&&n.indexOf(h.mid)!==-1);if(i.length!==n.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(async(h,m)=>{h.direction="sendonly"});const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.unmuteRemote(n),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(n,this.remoteCodecs,this.store.codec);const u=this.remoteSDP.toString();c==null||c(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(i){throw new Ce(Y.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(i.toString()))}}restartICE(n){var i=this;return el(function*(){const o=yield Sn(i.mutex.lock("From P2PConnection.restartICE"));try{if(!i.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const c=On().supportPCSetConfiguration,u=Z("FORCE_TURN_TCP")||i.forceTurn;if(n===vs.RELAY&&!c)return;if(c&&!u){const w=n===vs.RELAY?"relay":"all",I=i.peerConnection.getConfiguration();I.iceTransportPolicy!==w&&(k.debug("[".concat(i.store.clientId,"] restartICE change iceTransportPolicy from [").concat(I.iceTransportPolicy,"] to [").concat(w,"]")),I.iceTransportPolicy=w,i.peerConnection.setConfiguration(I))}i.remoteSDP.updateCandidates(n);const h=yield Sn(i.peerConnection.createOffer({iceRestart:!0}));if(!h.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const m=im(h.sdp),{remoteIceParameters:_}=yield m.iceParameters;i.remoteSDP.restartICE(_);const y=i.remoteSDP.toString(),S=i.logSDPExchange(h.sdp||"","offer","local","restartICE");i.store.descriptionStart(),yield Sn(i.peerConnection.setLocalDescription(h)),S==null||S(y),yield Sn(i.peerConnection.setRemoteDescription({type:"answer",sdp:y}))}catch(c){k.warning("[".concat(i.store.clientId,"] restart ICE failed, abort operation"),c)}finally{o()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const n=await this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates(vs.TCP_RELAY),await $0(this.peerConnection,this.remoteSDP,this.extension)}catch(i){k.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),i)}finally{n()}}close(){var n;this.peerConnection.getTransceivers().forEach(i=>{BA(this.id+i.mid,this)}),this.preSSRCMap.clear(),this.peerConnection.close(),(n=this.onConnectionStateChange)===null||n===void 0||n.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return Zu(Zu({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(n){return this.statsFilter.getVideoIsReady(n)}async updateEncoderConfig(n,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const o=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(o.sdp,[i],[n]);this.remoteSDP.updateRecvMedia(n,i);const u=this.remoteSDP.toString(),h=this.logSDPExchange(c,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),h==null||h(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(o){throw new Ce(Y.EXCHANGE_SDP_FAILED,o.toString())}}async updateSendParameters(n,i){const o=this.peerConnection.getTransceivers().filter(c=>c.mid===n);o.length===1&&(this.isVP8Simulcast(i)?Pr()||await this.applySimulcastEncodings(o,[i]):await this.applySendEncodings(o,[i]))}setStatsRemoteVideoIsReady(n,i){this.statsFilter.setVideoIsReady2(n,i)}async replaceTrack(n,i){const o=this.peerConnection.getTransceivers().find(c=>c.mid===i);o&&await o.sender.replaceTrack(n._mediaStreamTrack)}async getSelectedCandidatePair(){const n=this.peerConnection.getReceivers();if(n.length>0&&n[0].transport&&n[0].transport.iceTransport&&n[0].transport.iceTransport.getSelectedCandidatePair&&n[0].transport.iceTransport.getSelectedCandidatePair()){const i=n[0].transport.iceTransport,{local:o,remote:c}=i.getSelectedCandidatePair();return{local:Zu(Zu({},zd),{},{candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port}),remote:Zu(Zu({},zd),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var n;(n=this.onICEConnectionStateChange)===null||n===void 0||n.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var n;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(n=this.onConnectionStateChange)===null||n===void 0||n.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=n=>{if(n&&(n.errorCode||n.errorText)){var i;const o="code: ".concat(n.errorCode,", message: ").concat(n.errorText),c=n.port?"local: ".concat(n.port):"";k.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(o,"), url: ").concat(n.url||"",", host_candidate:").concat(c)),(i=this.onICECandidateError)===null||i===void 0||i.call(this,o)}},this.peerConnection.onicegatheringstatechange=n=>{n&&n.target&&"iceGatheringState"in n.target&&k.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(n.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=n=>{n.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,k.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,k.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},Z("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(n){const i={iceServers:[]};return n.iceServers?i.iceServers=n.iceServers:n.turnServer&&(D0(n.turnServer.servers)?i.iceServers=n.turnServer.servers:Z("NEW_TURN_MODE")&&i.iceServers?(Z("USE_TURN_SERVER_OF_GATEWAY")?n.turnServer.serversFromGateway&&i.iceServers.push(...P_.newTurnServerConfigToIceServers(n.turnServer.serversFromGateway)):i.iceServers.push(...P_.newTurnServerConfigToIceServers(n.turnServer.servers)),Z("NEW_FORCE_TURN")&&(i.iceTransportPolicy="relay")):n.turnServer.mode!=="off"&&(i.iceServers&&i.iceServers.push(...P_.turnServerConfigToIceServers(n.turnServer.servers)),Z("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&n.turnServer.serversFromGateway&&i.iceServers.push(...P_.turnServerConfigToIceServers(n.turnServer.serversFromGateway)),Z("FORCE_TURN_TCP")?i.iceTransportPolicy="relay":n.turnServer.servers.concat(n.turnServer.serversFromGateway||[]).forEach(o=>{o.forceturn&&(i.iceTransportPolicy="relay")}))),Z("ENABLE_ENCODED_TRANSFORM")&&On().supportWebRTCEncodedTransform&&(i.encodedInsertableStreams=!0),i}static turnServerConfigToIceServers(n){const i=[];return n.forEach(o=>{o.security?o.tcpport&&i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(nm(o.turnServerURL),":").concat(o.tcpport,"?transport=tcp")}):(o.udpport&&!Z("FORCE_TURN_TCP")&&i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.udpport,"?transport=udp")}),o.tcpport&&i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=tcp")}))}),i}static newTurnServerConfigToIceServers(n){const i=[];return n.forEach(o=>{const c=Z("NEW_TURN_MODE");c===1?i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=udp")}):c===2?i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=tcp")}):c===3?i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(nm(o.turnServerURL),":443?transport=tcp")}):c===4&&(i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=udp")}),i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=tcp")}),i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(nm(o.turnServerURL),":443?transport=tcp")}))}),i}tryBindTransportEvents(n){const i=n.transport;if(i){this.transportEventReceiver=n,i.onstatechange=()=>{var c;i!=null&&i.state&&((c=this.onDTLSTransportStateChange)===null||c===void 0||c.call(this,i.state))},i.onerror=c=>{var u;(u=this.onDTLSTransportError)===null||u===void 0||u.call(this,"error"in c?c.error:c)};const o=i.iceTransport;o&&(o.onstatechange=()=>{const c=i==null?void 0:i.iceTransport.state;var u;c&&((u=this.onICETransportStateChange)===null||u===void 0||u.call(this,c))},o.getSelectedCandidatePair&&(o.onselectedcandidatepairchange=()=>{if(o.getSelectedCandidatePair()){const{local:c,remote:u}=o.getSelectedCandidatePair();k.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:c.type,protocol:c.protocol}),", remote ").concat(JSON.stringify({candidateType:u.type,protocol:u.protocol,address:u.address,port:u.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(n,i){var o,c;if(i||(i=this.peerConnection.getSenders().find(U=>U.track===n._mediaStreamTrack)),!i)return k.warn("[".concat(n.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(n))return k.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!On().supportSetRtpSenderParameters)return k.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const u={},h={};switch(n._optimizationMode){case"motion":u.degradationPreference="maintain-framerate";break;case"detail":u.degradationPreference="maintain-resolution";break;case"balanced":u.degradationPreference="balanced"}const m=function(M,U){return M.getTransceivers().find(q=>q.sender.track===U||q.receiver.track===U)}(this.peerConnection,n._mediaStreamTrack),_=Qhe(n);if(dpe(n)&&m&&i&&_&&this.getLocalVideoStats&&Xe(o=["vp8","vp9"]).call(o,this.store.codec)){var y;const M=u.degradationPreference||(Xe(y=n._hints).call(y,ir.CUSTOM_TRACK)?Z("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(U,q,$,ae,me,ge){if(BA(U,$),me(q),ae!=="balanced"&&ae!=="maintain-framerate"&&ae!=="maintain-resolution")return;let pe=-1;UH(U,q);const we=window.setInterval(()=>{const nt=jA.get(U);if(!Z("ENABLE_AG_ADAPTATION")||!nt)return BA(U,$),void me(q);const st=ge();if(st.sendPackets>0&&st.OutgoingAvailableBandwidth>0){if(pe===-1)return void(pe=Date.now());if(Date.now()-pe<1e3)return;const pn=st.sendFrameRate,mn=st.OutgoingAvailableBandwidth,[sr,Xr]=upe(U,pn,mn,nt.adaptationConfig,q,ae);Xr&&($.qualityLimitationReason=Xr),sr&&nt.adaptationConfig.scale!==sr.scale&&(k.debug("[".concat(U,"] applyAdaptation: ").concat($.qualityLimitationReason,`
           sendFps `).concat(pn,", bwe ").concat(mn,", switch from ").concat(nt.adaptationConfig.scale," to ").concat(sr.scale," ")),nt.adaptationConfig=ux(ux({},nt.adaptationConfig),sr),me(sr))}},Z("CHECK_LOCAL_STATS_INTERVAL")),Be=ux({},q);jA.set(U,{timer:we,adaptationConfig:Be,originConfig:q,adaptationFunc:me}),k.debug("[".concat(U,"] start adaptation, originConfig: ").concat(JSON.stringify(q),", degradationPreference: ").concat(ae))})(this.id+m.mid,_,this,M,U=>{i&&this.updateAdaptation(i,U)},this.getLocalVideoStats.bind(this))}if(n._encoderConfig){var S;const{bitrateMax:M,frameRate:U,scaleResolutionDownBy:q}=n._encoderConfig;M&&(h.maxBitrate=1e3*M),(Xe(S=n._hints).call(S,ir.LOW_STREAM)||n.isUseScaleResolutionDownBy)&&(U&&(h.maxFramerate=Ba(U)),q&&q>=1&&(h.scaleResolutionDownBy=q))}const{maxFramerate:w}=Z("ENCODER_CONFIG_LIMIT");if(w&&typeof w=="number"&&(h.maxFramerate=h.maxFramerate?Math.min(h.maxFramerate,w):w),Z("DSCP_TYPE")&&bf()){var I;const M=Z("DSCP_TYPE");Xe(I=["very-low","low","medium","high"]).call(I,M)&&(h.networkPriority=M)}const P=i.getParameters(),B=(c=P.encodings)===null||c===void 0?void 0:c[0];Pr()&&!B&&(u.encodings=[h]),B&&Object.assign(B,h),Object.assign(P,u),k.debug("[".concat(n.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(P.encodings))),await i.setParameters(P),await async function(M,U,q){try{var $;if(!On().supportSetRtpSenderParameters||!function(we){return we==="vp9"||we==="av1"}(M)||!Z("ENABLE_SVC"))return;const ae={},me={},ge=U.getParameters(),pe=($=ge.encodings)===null||$===void 0?void 0:$[0];me.scalabilityMode=PA(q),pe&&Object.assign(pe,me),Object.assign(ge,ae),await U.setParameters(ge),k.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(ge.encodings)))}catch(ae){k.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",ae)}}(this.store.codec,i,Z("SVC_MODE"))}async updateAdaptation(n,i){var o,c;if(!n)return k.debug("[updateAdaptation] no rtpSender found");if(!On().supportSetRtpSenderParameters)return k.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const u={},{bitrateMax:h,frameRate:m,scaleResolutionDownBy:_}=i;h&&(u.maxBitrate=1e3*h),m&&(u.maxFramerate=Ba(m)),_&&_>=1&&Xe(o=["vp8","vp9"]).call(o,this.store.codec)&&(u.scaleResolutionDownBy=_);const y=n.getParameters(),S=(c=y.encodings)===null||c===void 0?void 0:c[0];S&&Object.assign(S,u),Object.assign(y,{});try{await n.setParameters(y),k.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(y.encodings)))}catch(w){!("transport"in n)||n.transport&&n.transport.state==="connected"?this.peerConnectionState!=="connected"?k.debug("[updateAdaptation] peerConnection not connected}"):k.debug("[updateAdaptation] updateRtpSenderEncodings failed",w):k.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(n,i){try{if(!On().supportSetRtpSenderParameters||n.length!==i.length)return;for(let o=0;o<n.length;o++){const c=n[o],u=i[o];u instanceof hr&&!this.isVP8Simulcast(u)&&await this.updateRtpSenderEncodings(u,c.sender)}}catch{k.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(n,i,o){const c=da(n);return i.forEach((u,h)=>{const m=o[h],_=c.mediaDescriptions.find(y=>y.attributes.mid===m);_&&(gv(_,u),sH(_,u,this.store.codec))}),Zp(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=n=>{var i;(i=this.onFirstAudioReceived)===null||i===void 0||i.call(this,n)},this.statsFilter.onFirstVideoReceived=n=>{var i;(i=this.onFirstVideoReceived)===null||i===void 0||i.call(this,n)},this.statsFilter.onFirstAudioDecoded=n=>{var i;(i=this.onFirstAudioDecoded)===null||i===void 0||i.call(this,n)},this.statsFilter.onFirstVideoDecoded=(n,i,o)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,n,i,o)},this.statsFilter.onSelectedLocalCandidateChanged=(n,i)=>{var o;(o=this.onSelectedLocalCandidateChanged)===null||o===void 0||o.call(this,n,i)},this.statsFilter.onSelectedRemoteCandidateChanged=(n,i)=>{var o;(o=this.onSelectedRemoteCandidateChanged)===null||o===void 0||o.call(this,n,i)},this.statsFilter.onFirstVideoDecodedTimeout=n=>{var i;(i=this.onFirstVideoDecodedTimeout)===null||i===void 0||i.call(this,n)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(n,i){if(n.length===i.length)for(let _=0;_<n.length;_++){var o,c,u,h,m;const y=n[_],S=i[_];if(S instanceof hr&&!Xe(o=S._hints).call(o,ir.LOW_STREAM)&&(c=S._encoderConfig)!==null&&c!==void 0&&c.bitrateMax&&((u=S._encoderConfig)===null||u===void 0?void 0:u.bitrateMax)>200&&(h=S._scalabilityMode)!==null&&h!==void 0&&h.numSpatialLayers&&((m=S._scalabilityMode)===null||m===void 0?void 0:m.numSpatialLayers)>1&&this.store.codec==="vp8"){const w={},I={high:1e3*(S._encoderConfig.bitrateMax-50),medium:5e4};w.encodings=[{rid:"m",active:!0,maxBitrate:I.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:I.high}];const P=y.sender.getParameters();await y.sender.setParameters(Object.assign(P,w))}}}async applySimulcastEncodings(n,i){if(!Pr()&&n.length===i.length)for(let o=0;o<n.length;o++){const c=i[o];if(c instanceof hr&&this.isVP8Simulcast(c)){const u=n[o],h={},m={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};h.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];const _=u.sender.getParameters();await u.sender.setParameters(Object.assign(_,h))}}}isVP8Simulcast(n){var i,o,c,u,h;return!!(n instanceof hr&&Z("SIMULCAST")&&this.store.codec==="vp8"&&!Xe(i=n._hints).call(i,ir.LOW_STREAM)&&(o=n._encoderConfig)!==null&&o!==void 0&&o.bitrateMax&&((c=n._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(u=n._scalabilityMode)!==null&&u!==void 0&&u.numSpatialLayers&&((h=n._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1)}logSDPExchange(n,i,o,c){if(Z("SDP_LOGGING"))return k.upload("[".concat(this.store.clientId,"] exchanging ").concat(o," ").concat(i," SDP during P2PConnection.").concat(c,`
`),n),i==="offer"?u=>{this.logSDPExchange(u,"answer",o==="local"?"remote":"local",c)}:void 0}async getRemoteSSRC(n){if(!this.remoteSDP)return;const i=this.remoteSDP.getSSRC(n);return i&&i.length!==0?i[0].ssrcId:void 0}setConfiguration(n){if(On().supportPCSetConfiguration){const i=P_.resolvePCConfiguration(n);this.peerConnection.setConfiguration(i)}}},ht(vn.prototype,"updateRemoteRTPCapabilities",[Vo],Object.getOwnPropertyDescriptor(vn.prototype,"updateRemoteRTPCapabilities"),vn.prototype),ht(vn.prototype,"connect",[Vo],Object.getOwnPropertyDescriptor(vn.prototype,"connect"),vn.prototype),ht(vn.prototype,"updateRemoteConnect",[Vo],Object.getOwnPropertyDescriptor(vn.prototype,"updateRemoteConnect"),vn.prototype),ht(vn.prototype,"createDataChannels",[Vo],Object.getOwnPropertyDescriptor(vn.prototype,"createDataChannels"),vn.prototype),ht(vn.prototype,"receive",[Vo],Object.getOwnPropertyDescriptor(vn.prototype,"receive"),vn.prototype),ht(vn.prototype,"batchReceive",[Vo],Object.getOwnPropertyDescriptor(vn.prototype,"batchReceive"),vn.prototype),ht(vn.prototype,"stopReceiving",[Vo],Object.getOwnPropertyDescriptor(vn.prototype,"stopReceiving"),vn.prototype),ht(vn.prototype,"muteRemote",[Vo],Object.getOwnPropertyDescriptor(vn.prototype,"muteRemote"),vn.prototype),ht(vn.prototype,"unmuteRemote",[Vo],Object.getOwnPropertyDescriptor(vn.prototype,"unmuteRemote"),vn.prototype),ht(vn.prototype,"muteLocal",[Vo],Object.getOwnPropertyDescriptor(vn.prototype,"muteLocal"),vn.prototype),ht(vn.prototype,"unmuteLocal",[Vo],Object.getOwnPropertyDescriptor(vn.prototype,"unmuteLocal"),vn.prototype),ht(vn.prototype,"close",[Vo],Object.getOwnPropertyDescriptor(vn.prototype,"close"),vn.prototype),ht(vn.prototype,"updateEncoderConfig",[Vo],Object.getOwnPropertyDescriptor(vn.prototype,"updateEncoderConfig"),vn.prototype),ht(vn.prototype,"updateSendParameters",[Vo],Object.getOwnPropertyDescriptor(vn.prototype,"updateSendParameters"),vn.prototype),ht(vn.prototype,"replaceTrack",[Vo],Object.getOwnPropertyDescriptor(vn.prototype,"replaceTrack"),vn.prototype),ht(vn.prototype,"updateAdaptation",[Vo],Object.getOwnPropertyDescriptor(vn.prototype,"updateAdaptation"),vn.prototype),ht(vn.prototype,"getRemoteSSRC",[Vo],Object.getOwnPropertyDescriptor(vn.prototype,"getRemoteSSRC"),vn.prototype),vn);function Vo(e,n,i){const o=e[n];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const c=this.mutex,u=await c.lock("From P2PConnection.".concat(n));try{for(var h=arguments.length,m=new Array(h),_=0;_<h;_++)m[_]=arguments[_];return await o.apply(this,m)}finally{u()}},i}function px(e,n){let i=document.createElement("video"),o=document.createElement("canvas");i.setAttribute("style","display:none"),o.setAttribute("style","display:none"),i.setAttribute("muted",""),i.muted=!0,i.setAttribute("autoplay",""),i.autoplay=!0,i.setAttribute("playsinline",""),o.width=Ba(n.width),o.height=Ba(n.height);const c=Ba(n.framerate||15);document.body.append(i),document.body.append(o);let u=e._mediaStreamTrack;i.srcObject=new MediaStream([u]),i.play();const h=o.getContext("2d");if(!h)throw new be(Y.UNEXPECTED_ERROR,"can not get canvas context");const m=On(),_=o.captureStream(m.supportRequestFrame?0:c).getVideoTracks()[0];_.canvas||(_.canvas=o),o.startCapture=()=>{if(!i)return o.stopCapture&&o.stopCapture();if(i.paused&&i.play(),i.videoHeight>2&&i.videoWidth>2){const S=i.videoWidth,w=i.videoHeight/S,I=o.width*w;Math.abs(I-o.height)>=2&&(k.debug("adjust low stream resolution","".concat(o.width,"x").concat(o.height," -> ").concat(o.width,"x").concat(I)),o.height=I)}h.drawImage(i,0,0,o.width,o.height),_.requestFrame&&_.requestFrame(),u!==e._mediaStreamTrack&&(u=e._mediaStreamTrack,i.srcObject=new MediaStream([u]))},o.stopCapture=RL(()=>o.startCapture&&o.startCapture(),c);const y=_.stop;return _.stop=()=>{y.call(_),i&&(i.remove(),i.srcObject=null,i=null),o&&(o.width=0,o.remove(),o.stopCapture&&o.stopCapture(),o.startCapture=void 0,o.stopCapture=void 0,o=null),k.debug("clean low stream renderer")},_}var GA=function(e){return e[e.HEIGHT=2033]="HEIGHT",e[e.FRAME_RATE=2034]="FRAME_RATE",e[e.WIDTH=2035]="WIDTH",e}(GA||{}),si=function(e){return e[e.FRAME_RATE=2002]="FRAME_RATE",e[e.WIDTH=2003]="WIDTH",e[e.HEIGHT=2004]="HEIGHT",e[e.PACKAGE_LOST=2005]="PACKAGE_LOST",e[e.AVG_ENCODE=2007]="AVG_ENCODE",e[e.NACKS=2009]="NACKS",e[e.PLIS=2010]="PLIS",e[e.FIRS=2011]="FIRS",e[e.BITRATE=2012]="BITRATE",e[e.PACKAGE_RATE=2031]="PACKAGE_RATE",e[e.ADAPTATION=2032]="ADAPTATION",e[e.ACTUAL_ENCODED=2060]="ACTUAL_ENCODED",e[e.BANDWIDTH=2061]="BANDWIDTH",e[e.RETRANSMIT=2062]="RETRANSMIT",e[e.TARGET_ENCODED=2064]="TARGET_ENCODED",e[e.TRANSMIT=2066]="TRANSMIT",e[e.FREEZE=2082]="FREEZE",e[e.DISABLED=2095]="DISABLED",e[e.PLAYER_STATUS=2128]="PLAYER_STATUS",e[e.QP_SUM=2143]="QP_SUM",e[e.BYTES_RETRANSMIT=2173]="BYTES_RETRANSMIT",e[e.PACKAGES_RETRANSMIT=2172]="PACKAGES_RETRANSMIT",e[e.HUGE_FRAME_SENT=2174]="HUGE_FRAME_SENT",e[e.KEY_FRAMES_ENCODED=2207]="KEY_FRAMES_ENCODED",e}(si||{}),u_=function(e){return e[e.BITRATE=2069]="BITRATE",e[e.PACKAGE_LOST=2070]="PACKAGE_LOST",e[e.PACKAGE_RATE=2071]="PACKAGE_RATE",e[e.HEIGHT=2073]="HEIGHT",e[e.FRAME_RATE=2075]="FRAME_RATE",e[e.WIDTH=2077]="WIDTH",e}(u_||{}),oi=function(e){return e[e.JITTER=-1]="JITTER",e[e.PACKAGE_LOST=2014]="PACKAGE_LOST",e[e.WIDTH=2018]="WIDTH",e[e.HEIGHT=2019]="HEIGHT",e[e.FRAME_RATE=2020]="FRAME_RATE",e[e.JITTER_BUFFER=2023]="JITTER_BUFFER",e[e.CURRENT_DELAY=2024]="CURRENT_DELAY",e[e.NACKS=2026]="NACKS",e[e.PLIS=2027]="PLIS",e[e.FIRS=2028]="FIRS",e[e.BITRATE=2029]="BITRATE",e[e.PACKAGE_RATE=2078]="PACKAGE_RATE",e[e.FREEZE=2084]="FREEZE",e[e.DISABLED=2101]="DISABLED",e[e.PLAYER_STATUS=2129]="PLAYER_STATUS",e[e.QP_SUM=2144]="QP_SUM",e[e.I_FRAME_DELAY=2149]="I_FRAME_DELAY",e[e.FRAMES_DROPPED=2181]="FRAMES_DROPPED",e[e.BYTES_RETRANSMIT=2175]="BYTES_RETRANSMIT",e[e.PACKAGES_RETRANSMIT=2176]="PACKAGES_RETRANSMIT",e[e.PACKAGES_DISCARDED=2198]="PACKAGES_DISCARDED",e[e.AVG_DECODE=2200]="AVG_DECODE",e[e.AVG_PROCESSING_DELAY=2202]="AVG_PROCESSING_DELAY",e[e.AVG_ASSEMBLY_TIME=2203]="AVG_ASSEMBLY_TIME",e[e.AVG_INTER_FRAME_DELAY=2204]="AVG_INTER_FRAME_DELAY",e[e.KEY_FRAMES_DECODED=2206]="KEY_FRAMES_DECODED",e}(oi||{}),d_=function(e){return e[e.FRAME_RATE_DECODE=2021]="FRAME_RATE_DECODE",e[e.FRAME_RATE_RENDER=2022]="FRAME_RATE_RENDER",e[e.FRAME_RATE_OUTPUT=2155]="FRAME_RATE_OUTPUT",e[e.FREEZE_TIME=2109]="FREEZE_TIME",e[e.FREEZE_TIME_RENDER=2147]="FREEZE_TIME_RENDER",e[e.FREEZE_DURATION=2156]="FREEZE_DURATION",e}(d_||{}),WH=function(e){return e[e.PCM_LEVEL=2104]="PCM_LEVEL",e}(WH||{}),Jd=function(e){return e[e.PACKAGE_LOST=-1]="PACKAGE_LOST",e[e.LEVEL=2038]="LEVEL",e[e.BITRATE=2039]="BITRATE",e[e.PACKAGE_RATE=2040]="PACKAGE_RATE",e[e.AEC_RETURN_LOSS=2041]="AEC_RETURN_LOSS",e[e.AEC_RETURN_LOSS_ENH=2042]="AEC_RETURN_LOSS_ENH",e[e.FREEZE=2081]="FREEZE",e[e.DISABLED=2096]="DISABLED",e[e.BYTES_RETRANSMIT=2179]="BYTES_RETRANSMIT",e[e.PACKAGES_RETRANSMIT=2180]="PACKAGES_RETRANSMIT",e}(Jd||{}),Fo=function(e){return e[e.BITRATE=2044]="BITRATE",e[e.PACKAGE_LOST=2045]="PACKAGE_LOST",e[e.PACKAGE_RATE=2046]="PACKAGE_RATE",e[e.CURRENT_DELAY=2047]="CURRENT_DELAY",e[e.JITTER_BUFFER=2054]="JITTER_BUFFER",e[e.JITTER=2055]="JITTER",e[e.FREEZE=2083]="FREEZE",e[e.DISABLED=2102]="DISABLED",e[e.PCM_LEVEL=2105]="PCM_LEVEL",e[e.PLAYER_STATUS=2130]="PLAYER_STATUS",e[e.CONCEALED_SAMPLES=2148]="CONCEALED_SAMPLES",e[e.BYTES_RETRANSMIT=2178]="BYTES_RETRANSMIT",e[e.PACKAGES_RETRANSMIT=2177]="PACKAGES_RETRANSMIT",e[e.PACKAGES_DISCARDED=2199]="PACKAGES_DISCARDED",e[e.AVG_PROCESSING_DELAY=2201]="AVG_PROCESSING_DELAY",e[e.TOTAL_SAMPLES_RECEIVED=2224]="TOTAL_SAMPLES_RECEIVED",e}(Fo||{}),GH=function(e){return e[e.FREEZE_TIME=-1]="FREEZE_TIME",e[e.LEVEL=2043]="LEVEL",e}(GH||{}),jo=function(e){return e[e.RTT=2006]="RTT",e[e.CONN_TYPE=801]="CONN_TYPE",e[e.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",e}(jo||{}),zA=function(e){return e[e.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",e}(zA||{});const h_=1e3,f_=6,HA=3,ppe=Math.max(f_,HA);function Pt(e,n,i){i!=null&&Number.isFinite(i)&&(e[n]=Math.round(Math.max(0,i)))}function zH(e){const n={[jo.CONN_TYPE]:0,[jo.RTT]:e.rtt,[jo.STATS_UPDATE_INTERVAL]:e.updateInterval?Math.round(Math.max(0,e.updateInterval)):void 0};switch(e.selectedCandidatePair.localCandidate.candidateType){case"relay":{const i=e.selectedCandidatePair.localCandidate.relayProtocol;i==="udp"&&(n[jo.CONN_TYPE]=1),i==="tcp"&&(n[jo.CONN_TYPE]=3),i==="tls"&&(n[jo.CONN_TYPE]=4);break}case"srflx":n[jo.CONN_TYPE]=2;break;case"unknown":n[jo.CONN_TYPE]=5;break;default:n[jo.CONN_TYPE]=0}return n}function HH(e){let n=0;switch(e){case"none":n=0;break;case"cpu":n=1;break;case"bandwidth":n=2;break;case"other":n=3}return n}class KH extends Rr{constructor(n){super(),K(this,"store",void 0),K(this,"uploadWRTCStatsTimer",void 0),K(this,"uploadOutboundDenoiserStatsTimer",void 0),K(this,"uploadExtStatsTimer",void 0),K(this,"uploadExtUsageStatsTimer",void 0),K(this,"uploadInboundExtStatsTimer",void 0),K(this,"requestStats",void 0),K(this,"requestTransportStats",void 0),K(this,"requestLocalMedia",void 0),K(this,"requestRemoteMedia",void 0),K(this,"requestAllTracks",void 0),K(this,"requestVideoIsReady",void 0),K(this,"requestUploadStats",void 0),K(this,"requestUpload",void 0),K(this,"uploadOutboundStarted",!1),K(this,"uploadInboundStarted",!1),K(this,"uploadTransportStarted",!1),K(this,"uploadBaseStatsStarted",!1),K(this,"uploadExtensionUsageStarted",!1),K(this,"lastRecvStats",void 0),K(this,"lastSendStats",void 0),K(this,"lastRefRecvStats",void 0),K(this,"lastRefSendStats",void 0),K(this,"lastFullRecvStats",void 0),K(this,"lastFullSendStats",void 0),K(this,"needUploadRenderFreezeTime",!0),this.store=n}uploadWRTCStats(n){if(!this.requestStats||!this.requestUploadStats)return;const i=n%HA==0,o=n%f_==0;let c,u;if(this.uploadTransportStarted&&(c=this.requestStats(),this.store.useP2P&&(u=this.requestStats(!0))),!c&&this.uploadOutboundStarted&&(c=this.requestStats()),!u&&this.uploadInboundStarted&&(u=this.requestStats(!0)),c||u){var h;const m={};if(this.uploadTransportStarted&&c){const y=this.getTransportStats(c,u,i);y&&(m.misc=[y])}if(this.uploadOutboundStarted&&c){const y=this.getOutboundStats(c,o?this.lastFullSendStats:i?this.lastRefSendStats:this.lastSendStats,i,o);y&&(m.outbound=[y])}if(this.uploadInboundStarted&&u){const y=this.getInboundStats(u,o?this.lastFullRecvStats:i?this.lastRefRecvStats:this.lastRecvStats,i,o);y&&(m.inbound=y)}const _=(h=this.requestTransportStats)===null||h===void 0?void 0:h.call(this).connectState;_&&(Array.isArray(m.misc)?m.misc[0]&&m.misc[0].addition&&(m.misc[0].addition[zA.RTC_PEER_CONNECTION_STATE]=uL[_]):m.misc=[{addition:{[zA.RTC_PEER_CONNECTION_STATE]:uL[_]}}]),this.requestUploadStats(m)}this.lastRecvStats=u,this.lastSendStats=c,o&&(this.lastFullRecvStats=u,this.lastFullSendStats=c),i&&(this.lastRefRecvStats=u,this.lastRefSendStats=c)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0;let n=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var i,o;const c=(i=this.requestTransportStats)===null||i===void 0?void 0:i.call(this);return void(c&&((o=this.requestUploadStats)===null||o===void 0||o.call(this,{misc:[{addition:{[zA.RTC_PEER_CONNECTION_STATE]:uL[c.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(n),++n===ppe+1&&(n=1)},h_)}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0)}getTransportStats(n,i,o){if(!this.requestStats)return;if(!o)return n.rtt==null?void 0:{addition:{[jo.RTT]:n.rtt,[jo.CONN_TYPE]:void 0,[jo.STATS_UPDATE_INTERVAL]:n.updateInterval||void 0}};const c=zH(n);if(this.store.useP2P){if(i){const u=zH(i);c[jo.CONN_TYPE]+=u[jo.CONN_TYPE]<<3}c[jo.CONN_TYPE]+=110}else c[jo.CONN_TYPE]+=100;return{addition:c}}getOutboundStats(n,i,o,c){if(!this.requestUploadStats||!this.requestLocalMedia)return;const u=this.requestLocalMedia();if(!u||u.length===0)return;let h,m,_;return u.forEach(y=>{let[S,{track:w,ssrcs:I}]=y;switch(S){case Ve.LocalVideoLowTrack:case Ve.LocalVideoTrack:if(S===Ve.LocalVideoTrack){const P=function(U,q,$,ae,me,ge){const pe=q.videoSend.find(st=>st.ssrc===U);if(!pe)return;const we={},{sentFrame:Be,inputFrame:nt}=pe;if(ge&&(Pt(we,si.QP_SUM,pe.qpSumPerFrame),nt&&Be)){const st=nt.frameRate,pn=Be.frameRate;we[si.FREEZE]=function(mn,sr){let Xr=!0;return Xr=!(mn<=5)&&(mn<=10?sr<3:mn<=20?sr<4:sr<5),Xr}(st,pn)?1:0}if(me){switch(Be&&(Pt(we,si.HEIGHT,Be.height),Pt(we,si.WIDTH,Be.width),Pt(we,si.FRAME_RATE,Be.frameRate)),we[si.DISABLED]=ae._originMediaStreamTrack&&!ae._originMediaStreamTrack.enabled||ae._mediaStreamTrack&&!ae._mediaStreamTrack.enabled?1:0,pe.adaptionChangeReason){case"none":we[si.ADAPTATION]=0;break;case"cpu":we[si.ADAPTATION]=1;break;case"bandwidth":we[si.ADAPTATION]=2;break;case"other":we[si.ADAPTATION]=3}let st=0;pe.adaptionChangeReason&&(st+=HH(pe.adaptionChangeReason)),q.qualityLimitationReason&&(st+=HH(q.qualityLimitationReason)<<3),we[si.ADAPTATION]=st,we[si.PLAYER_STATUS]=bL[ae._player?ae._player.videoElementStatus:"uninit"],Pt(we,si.NACKS,pe.nacksCount),Pt(we,si.PLIS,pe.plisCount),Pt(we,si.FIRS,pe.firsCount),Pt(we,si.AVG_ENCODE,pe.avgEncodeMs),Pt(we,si.HUGE_FRAME_SENT,pe.hugeFramesSent),Pt(we,si.BYTES_RETRANSMIT,pe.retransmittedBytesSent),Pt(we,si.PACKAGES_RETRANSMIT,pe.retransmittedPacketsSent),Pt(we,si.KEY_FRAMES_ENCODED,pe.keyFramesEncoded);const pn=$&&$.videoSend.find(mn=>mn.ssrc===U);if(pn){let mn=me?h_:h_*f_;pn.timestamp&&pe.timestamp&&(mn=pe.timestamp-pn.timestamp),pn.packets!=null&&pe.packets!=null&&Pt(we,si.PACKAGE_RATE,1e3*(pe.packets-pn.packets)/mn),pe.packetsLost!=null&&pn.packetsLost!=null&&Pt(we,si.PACKAGE_LOST,pe.packetsLost-pn.packetsLost),pn.bytes!=null&&pe.bytes!=null&&Pt(we,si.BITRATE,8*(pe.bytes-pn.bytes)/mn)}}return we}(I[0].ssrcId,n,i,w,o,c),B=w&&function(U,q,$,ae){const me=q.videoSend.find(pe=>pe.ssrc===U);if(!me)return null;const ge={};if(ae){const pe=me.inputFrame,we=pe&&pe.height||$.videoHeight||0,Be=pe&&pe.width||$.videoWidth||0,nt=pe&&pe.frameRate||0;Pt(ge,GA.HEIGHT,we),Pt(ge,GA.WIDTH,Be),Pt(ge,GA.FRAME_RATE,nt)}return ge}(I[0].ssrcId,n,w,o),M=function(U,q){const $={};return q&&(Pt($,si.RETRANSMIT,U.bitrate.retransmit),Pt($,si.TARGET_ENCODED,U.bitrate.targetEncoded),Pt($,si.ACTUAL_ENCODED,U.bitrate.actualEncoded),Pt($,si.TRANSMIT,U.bitrate.transmit),Pt($,si.BANDWIDTH,U.sendBandwidth)),$}(n,o);m=Object.assign({},P,B,M)}else _=function(P,B,M,U){const q=B.videoSend.find(ae=>ae.ssrc===P);if(!q)return;const $={};if(U){const ae=q.sentFrame;if(ae&&(Pt($,u_.HEIGHT,ae.height),Pt($,u_.WIDTH,ae.width),Pt($,u_.FRAME_RATE,ae.frameRate)),M){const me=M.videoSend.find(ge=>ge.ssrc===P);if(me){let ge=h_*f_;me.timestamp&&q.timestamp&&(ge=q.timestamp-me.timestamp),me.packets!=null&&q.packets!=null&&Pt($,u_.PACKAGE_RATE,1e3*(q.packets-me.packets)/ge),q.packetsLost!=null&&me.packetsLost!=null&&Pt($,u_.PACKAGE_LOST,q.packetsLost-me.packetsLost),me.bytes!=null&&q.bytes!=null&&Pt($,u_.BITRATE,8*(q.bytes-me.bytes)/ge)}}}return $}(I[0].ssrcId,n,i,o);break;case Ve.LocalAudioTrack:h=w&&function(P,B,M,U,q){const $=B.audioSend.find(me=>me.ssrc===P);if(!$)return;const ae={};if(q){ae[Jd.DISABLED]=U._originMediaStreamTrack&&!U._originMediaStreamTrack.enabled||U._mediaStreamTrack&&!U._mediaStreamTrack.enabled?1:0;const me=100*U._source.getAccurateVolumeLevel(),ge=$.inputLevel;if(ge!=null){const we=Math.ceil(50*Math.log10(100*ge+1));Pt(ae,Jd.LEVEL,we)}Pt(ae,WH.PCM_LEVEL,me),Pt(ae,Jd.AEC_RETURN_LOSS,$.aecReturnLoss),Pt(ae,Jd.AEC_RETURN_LOSS_ENH,$.aecReturnLossEnhancement),Pt(ae,Jd.BYTES_RETRANSMIT,$.retransmittedBytesSent),Pt(ae,Jd.PACKAGES_RETRANSMIT,$.retransmittedPacketsSent),ae[Jd.FREEZE]=0;const pe=M&&M.audioSend.find(we=>we.ssrc===P);if(pe){let we=h_*f_;pe.timestamp&&$.timestamp&&(we=$.timestamp-pe.timestamp),pe.bytes!=null&&$.bytes!=null&&Pt(ae,Jd.BITRATE,8*($.bytes-pe.bytes)/we),pe.packets!=null&&$.packets!=null&&Pt(ae,Jd.PACKAGE_RATE,1e3*($.packets-pe.packets)/we)}}return ae}(I[0].ssrcId,n,i,w,o)}}),{high:m,low:_,audio:h}}getInboundStats(n,i,o,c){if(!this.requestRemoteMedia)return;const u=this.requestRemoteMedia()||[],h=[];return u.forEach(m=>{let[_,y]=m;const S={peer:_.uid};if(y.has(at.VIDEO)&&_.videoTrack){const w=_._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(_._videoSSRC)||!1,I=_.videoTrack?function(P,B,M,U,q,$,ae,me){const ge=B.videoRecv.find(mn=>mn.ssrc===P);if(!ge)return;const pe={},{receivedFrame:we,outputFrame:Be,decodeFrameRate:nt}=ge,st=M&&M.videoRecv.find(mn=>mn.ssrc===P);if(Pt(pe,d_.FRAME_RATE_DECODE,nt),ge.framesRateFirefox&&Pt(pe,oi.FRAME_RATE,ge.framesRateFirefox),we&&Pt(pe,oi.FRAME_RATE,we.frameRate),Pt(pe,oi.FRAMES_DROPPED,ge.framesDroppedCount),Pt(pe,oi.BYTES_RETRANSMIT,ge.retransmittedBytesReceived),Pt(pe,oi.PACKAGES_RETRANSMIT,ge.retransmittedPacketsReceived),Pt(pe,oi.PACKAGES_DISCARDED,ge.packetsDiscarded),Pt(pe,oi.AVG_DECODE,ge.avgDecodeMs),Pt(pe,oi.AVG_PROCESSING_DELAY,ge.avgProcessingDelayMs),Pt(pe,oi.AVG_ASSEMBLY_TIME,ge.avgFramesAssembledFromMultiplePacketsMs),Pt(pe,oi.AVG_INTER_FRAME_DELAY,ge.avgInterFrameDelayMs),Pt(pe,oi.KEY_FRAMES_DECODED,ge.keyFramesDecoded),st){const mn=B.timestamp-M.timestamp||h_*(me?f_:ae?HA:1);ge.packetsLost!=null&&st.packetsLost!=null&&Pt(pe,oi.PACKAGE_LOST,ge.packetsLost-st.packetsLost),st.bytes!=null&&ge.bytes!=null&&Pt(pe,oi.BITRATE,8*(ge.bytes-st.bytes)/mn),st.packets!=null&&ge.packets!=null&&Pt(pe,oi.PACKAGE_RATE,1e3*(ge.packets-st.packets)/mn)}if(me&&(Pt(pe,oi.QP_SUM,ge.qpSumPerFrame),pe[oi.FREEZE]=q&&J0.isRemoteVideoFreeze(U,ge,st)?1:0),ae){var pn;we?(Pt(pe,oi.HEIGHT,we.height),Pt(pe,oi.WIDTH,we.width)):U&&(Pt(pe,oi.HEIGHT,U._videoHeight||0),Pt(pe,oi.WIDTH,U._videoWidth||0)),Be&&Pt(pe,d_.FRAME_RATE_OUTPUT,Be.frameRate);const mn=(pn=U._player)===null||pn===void 0?void 0:pn.rendFrameRate.toFixed(0);if(mn&&Pt(pe,d_.FRAME_RATE_RENDER,+mn),Pt(pe,oi.JITTER_BUFFER,ge.jitterBufferMs),Pt(pe,oi.CURRENT_DELAY,ge.currentDelayMs),Pt(pe,oi.FIRS,ge.firsCount),Pt(pe,oi.NACKS,ge.nacksCount),Pt(pe,oi.PLIS,ge.plisCount),U){pe[oi.DISABLED]=U._originMediaStreamTrack.enabled&&U._mediaStreamTrack.enabled?0:1;const sr=U._player;if(sr){const{freezeTimeCounterList:Xr,renderFreezeAccTime:Fr,videoElementStatus:Wo}=sr;if(Xr&&Xr.length>0&&Pt(pe,d_.FREEZE_TIME,Xr.splice(0,1)[0]),$&&Cf.visibility==="visible"&&Wo===zs.PLAYING&&On().supportRequestVideoFrameCallback){const ke=Math.min(6e3,Fr);sr.renderFreezeAccTime=Math.max(0,Fr-ke),Pt(pe,d_.FREEZE_TIME_RENDER,ke)}if(typeof ge.totalFreezesDuration=="number"){const ke=st&&st.totalFreezesDuration?ge.totalFreezesDuration-st.totalFreezesDuration:ge.totalFreezesDuration;Pt(pe,d_.FREEZE_DURATION,1e3*ke)}}}if(pe[oi.PLAYER_STATUS]=bL[U._player?U._player.videoElementStatus:"uninit"],st&&ge.totalInterFrameDelay!==void 0&&ge.totalSquaredInterFrameDelay!==void 0&&st.totalInterFrameDelay!==void 0&&st.totalSquaredInterFrameDelay!==void 0){const sr=ge.totalInterFrameDelay-st.totalInterFrameDelay,Xr=ge.totalSquaredInterFrameDelay-st.totalSquaredInterFrameDelay,Fr=ge.framesDecodeCount-st.framesDecodeCount,Wo=sr/Fr*1e3,ke=Math.round(1e3*Math.sqrt((Xr-Math.pow(sr,2)/Fr)/Fr));!isNaN(ke)&&Wo+ke>Math.max(3*Wo,Wo+150)&&(pe[oi.I_FRAME_DELAY]=ke)}}return pe}(_._videoSSRC,n,i,_.videoTrack,w===!0,this.needUploadRenderFreezeTime,o,c):void 0;I&&(S.video=I)}if(y.has(at.AUDIO)&&_.audioTrack){const w=_.audioTrack?function(I,P,B,M,U,q){const $=P.audioRecv.find(pe=>pe.ssrc===I);if(!$)return;const ae={},me=B&&B.audioRecv.find(pe=>pe.ssrc===I);if(Pt(ae,Fo.JITTER,$.jitterMs),Pt(ae,Fo.BYTES_RETRANSMIT,$.retransmittedBytesReceived),Pt(ae,Fo.PACKAGES_RETRANSMIT,$.retransmittedPacketsReceived),Pt(ae,Fo.PACKAGES_DISCARDED,$.packetsDiscarded),Pt(ae,Fo.AVG_PROCESSING_DELAY,$.avgProcessingDelayMs),me){const pe=P.timestamp-B.timestamp||h_*(q?f_:U?HA:1);$.packets!=null&&me.packets!=null&&Pt(ae,Fo.PACKAGE_RATE,1e3*($.packets-me.packets)/pe),U&&me.bytes!=null&&$.bytes!=null&&Pt(ae,Fo.BITRATE,8*($.bytes-me.bytes)/pe),$.packetsLost!=null&&me.packetsLost!=null&&Pt(ae,Fo.PACKAGE_LOST,$.packetsLost-me.packetsLost)}if(q){const{receivedFrames:pe,droppedFrames:we}=$;pe!=null&&we!=null&&(ae[Fo.FREEZE]=(ge=pe)===0||100*we/ge>20?1:0)}var ge;if(U){const pe=100*M._source.getAccurateVolumeLevel(),we=$.outputLevel;if(we!=null){const Be=Math.ceil(50*Math.log10(100*we+1));Pt(ae,GH.LEVEL,Be)}if(Pt(ae,Fo.PCM_LEVEL,pe),M&&(ae[Fo.DISABLED]=M._originMediaStreamTrack.enabled&&M._mediaStreamTrack.enabled?0:1),Pt(ae,Fo.JITTER_BUFFER,$.jitterBufferMs),Pt(ae,Fo.CURRENT_DELAY,$.jitterBufferMs),ae[Fo.PLAYER_STATUS]=bL[Uo.getPlayerState(M.getTrackId())],me){const Be=$.concealedSamples-me.concealedSamples;Be>0&&Pt(ae,Fo.CONCEALED_SAMPLES,Be);const nt=$.totalSamplesReceived-me.totalSamplesReceived;nt>0&&Pt(ae,Fo.TOTAL_SAMPLES_RECEIVED,nt)}}return ae}(_._audioSSRC,n,i,_.audioTrack,o,c):void 0;w&&(S.audio=w)}(S.video||S.audio)&&h.push(S)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,h}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;const n=(this.requestAllTracks()||[]).find(i=>i instanceof pA);if(n&&n._external.getDenoiserStats){const i=n._external.getDenoiserStats();i&&this.requestUpload(B0.DENOISER_STATS,i)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(n=>{n.getProcessorStats().forEach(i=>{this.requestUpload&&this.requestUpload(i.type,i.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(n=>{let[i,o]=n;o.has(at.VIDEO)&&i.videoTrack&&i.videoTrack.getProcessorStats().forEach(c=>{this.requestUpload&&this.requestUpload(c.type,c.stats)}),o.has(at.AUDIO)&&i.audioTrack&&i.audioTrack.getProcessorStats().forEach(c=>{this.requestUpload&&this.requestUpload(c.type,c.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0))}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const n=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{const i=Date.now(),o={connectionInterval:Z("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:i};let c=[];const u=this.requestAllTracks&&this.requestAllTracks()||[];for(const y of u)!y.muted&&y.enabled&&(c=c.concat(await y.getProcessorUsage()));const h=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[y,S]of h)S.has(at.VIDEO)&&y.videoTrack&&(c=c.concat(await y.videoTrack.getProcessorUsage())),S.has(at.AUDIO)&&y.audioTrack&&(c=c.concat(await y.audioTrack.getProcessorUsage()));if(c.length===0)return;o.details=function(y,S){const w={};for(const{id:M,value:U,level:q,direction:$}of y){var I;const ae=(I=S.get(M))!==null&&I!==void 0?I:0,me=U===2?ae+Z("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:ae;var P,B;S.set(M,me),w[M]?(U===2&&(w[M].value=U),q>w[M].level&&(w[M].level=q),$==="remote"&&(w[M].remoteUidCount+=1),w[M].totalTs=(P=S.get(M))!==null&&P!==void 0?P:0):w[M]={value:U,level:q,remoteUidCount:$==="local"?0:1,totalTs:(B=S.get(M))!==null&&B!==void 0?B:0}}return Object.keys(w).map(M=>{const{level:U,value:q,totalTs:$}=w[M];return{id:M,level:U,value:q,totalTs:$}})}(c,n);const m=Date.now(),_=m>i?m:i+1;this.requestUpload&&this.requestUpload(B0.EXTENSION_USAGE_STATS,{usageStats:o,sendTs:_})},Z("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1}}const mpe=Z("ICE_RESTART_INTERVAL");let KA=new Map,Sv=new Map,am=[vs.UDP_TCP_RELAY,vs.TCP_RELAY,vs.RELAY],mx=Z("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&On().supportPCSetConfiguration;function qH(e){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const i=KA.get(e.id);i&&(window.clearTimeout(i),KA.delete(e.id));const o=Sv.get(e.id);n&&o&&o.index===am.length-1&&(k.debug("[".concat(e.id,"] reset ICE restart policy")),Sv.delete(e.id))}function $H(e,n,i){if(KA.size===0&&Sv.size===0&&(Array.isArray(Z("RESTART_SEQUENCE"))&&Z("RESTART_SEQUENCE").length>0&&!function(m,_){if(m.length!==_.length)return!1;for(let y=0;y<m.length;y+=1){const S=m[y];if(m.filter(w=>w===S).length!==_.filter(w=>w===S).length)return!1}return!0}(am,Z("RESTART_SEQUENCE"))&&(am=Z("RESTART_SEQUENCE").filter(m=>{var _;if(Xe(_=Object.values(vs)).call(_,m))return!0}),k.debug("use reconnection policy from config distribution, queues: ".concat(am.join(" => ")))),mx=Z("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&On().supportPCSetConfiguration),am.length===0)return void i();let o,{index:c=0,type:u}=Sv.get(e.id)||{};if(mx&&u===vs.RELAY)return void i();let h=u&&c>=am.length-1;if(mx)u=vs.RELAY;else{if(h)return void i();u?(c++,u=am[c]):(u=am[0],c=0)}k.debug("[".concat(e.id,"] choose ICE restart policy: ").concat(u,", index: ").concat(c)),n(u),Sv.set(e.id,{index:c,type:u}),o=window.setTimeout(()=>$H(e,n,i),mpe),KA.set(e.id,o)}var sn;function YH(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function Qd(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?YH(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):YH(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function XH(e){var n,i,o,c=2;for(typeof Symbol<"u"&&(i=F1,o=Symbol.iterator);c--;){if(i&&(n=e[i])!=null)return n.call(e);if(o&&(n=e[o])!=null)return new qA(n.call(e));i="@@asyncIterator",o="@@iterator"}throw new TypeError("Object is not async iterable")}function qA(e){function n(i){if(Object(i)!==i)return tt.reject(new TypeError(i+" is not an object."));var o=i.done;return tt.resolve(i.value).then(function(c){return{value:c,done:o}})}return qA=function(i){this.s=i,this.n=i.next},qA.prototype={s:null,n:null,next:function(){return n(this.n.apply(this.s,arguments))},return:function(i){var o=this.s.return;return o===void 0?tt.resolve({value:i,done:!0}):n(o.apply(this.s,arguments))},throw:function(i){var o=this.s.return;return o===void 0?tt.reject(i):n(o.apply(this.s,arguments))}},new qA(e)}let Z0=(sn=class extends Rr{get state(){return this._state}set state(e){const n=this._state;this._state=e,this.emit(bt.StateChange,n,this._state)}constructor(e,n){super(),K(this,"isPlanB",void 0),K(this,"store",void 0),K(this,"statsUploader",void 0),K(this,"connection",void 0),K(this,"localTrackMap",new Map),K(this,"remoteUserMap",new Map),K(this,"localDataChannels",[]),K(this,"remoteDataChannelMap",new Map),K(this,"pendingLocalTracks",[]),K(this,"pendingRemoteTracks",[]),K(this,"pendingLocalDataChannels",[]),K(this,"pendingRemoteDataChannels",[]),K(this,"statsCollector",void 0),K(this,"shouldForwardP2PCreation",void 0),K(this,"iceFailedCount",0),K(this,"dtlsFailedCount",0),K(this,"mutex",void 0),K(this,"_state",Fn.Disconnected),K(this,"_pcStatsUploadType",Z("NEW_ICE_RESTART")?Pf.FIRST_CONNECTION:Pf.OLD_FIRST_CONNECTION),K(this,"_isStartRestartIce",!1),K(this,"_restartTimer",void 0),K(this,"_isTryConnecting",!1),K(this,"_iceError",null),K(this,"_forceTurn",!1),K(this,"_isWaitPcToRePub",!1),K(this,"handleMuteLocalTrack",async(i,o,c)=>{const u=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==Fn.Connected)return void c(new Ce(Y.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const h=this.filterTobeMutedTracks(i);if(h.length===0)return void o();const m=h.find(y=>y[0]==="videoLowTrack");m&&m[1].track._originMediaStreamTrack.stop(),await this.connection.muteLocal(h.map(y=>{let[,{id:S}]=y;return S}));const _=this.createMuteMessage(h);await nr(this,bt.RequestMuteLocal,_),o()}catch(h){c(h)}finally{u()}}),K(this,"handleUnmuteLocalTrack",async(i,o,c)=>{const u=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==Fn.Connected)return void c(new Ce(Y.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const h=this.filterTobeUnmutedTracks(i);if(h.length===0)return void o();const m=h.find(y=>y[0]==="videoLowTrack");if(m){const y=m[1];if(y.track._originMediaStreamTrack.stop(),!Z("DISABLE_DUAL_STREAM_USE_ENCODING")&&On().supportDualStreamEncoding){const S=i._mediaStreamTrack.clone();y.track._mediaStreamTrack=S,y.track._originMediaStreamTrack=S}else{const S=px(i,L0(this,bt.RequestLowStreamParameter));y.track._mediaStreamTrack=S,y.track._originMediaStreamTrack=S}await new tt((S,w)=>{this.handleReplaceTrack(y.track,S,w,!0)})}await this.connection.unmuteLocal(h.map(y=>{let[,{id:S}]=y;return S}));const _=this.createUnmuteMessage(h);await nr(this,bt.RequestUnmuteLocal,_),o()}catch(h){c(h)}finally{u()}}),K(this,"handleUpdateVideoEncoder",async(i,o,c,u)=>{let h;u||(h=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{const _=this.localTrackMap.get(Ve.LocalVideoTrack);if(!this.connection||!_||_.track!==i||this.state!==Fn.Connected)return void o();const{id:y,track:S}=_;await this.connection.updateSendParameters(y,S),await this.connection.updateEncoderConfig(y,S),this.emit(bt.UpdateVideoEncoder,S),o()}catch(_){c(_)}finally{var m;(m=h)===null||m===void 0||m()}}),K(this,"handleUpdateVideoSendParameters",async(i,o,c)=>{const u=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const h=this.localTrackMap.get(Ve.LocalVideoTrack);if(!this.connection||!h||h.track!==i||this.state!==Fn.Connected)return void o();const{id:m,track:_}=h;await this.connection.updateSendParameters(m,_),o()}catch(h){c(h)}finally{u()}}),K(this,"handleReplaceMixingTrack",async(i,o,c,u)=>{if(!this.connection||this.state!==Fn.Connected)return void o();const h=hx([i]);let m;k.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(h.getTrackId(),"]")),typeof u=="boolean"&&u||(m=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(i,h),o()}catch(y){c(y)}finally{var _;(_=m)===null||_===void 0||_()}}),K(this,"handleReplaceTrack",async(i,o,c,u)=>{let h;k.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(i.getTrackId(),"]")),typeof u=="boolean"&&u||(h=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var m;const y=Array.from(this.localTrackMap.entries()).find(S=>{let[,{track:w}]=S;return i===w});if(!this.connection||!y||this.state!==Fn.Connected)return void o();if(await((m=this.connection)===null||m===void 0?void 0:m.replaceTrack(i,y[1].id)),this.isPlanB){const S=y[1];S.id=i._mediaStreamTrack.id,this.localTrackMap.set(y[0],S)}if(y[0]===Ve.LocalVideoTrack&&!Z("DISABLE_DUAL_STREAM_USE_ENCODING")&&On().supportDualStreamEncoding){const S=this.localTrackMap.get(Ve.LocalVideoLowTrack);if(S){const w=i._mediaStreamTrack.clone();S.track._originMediaStreamTrack.stop(),S.track._mediaStreamTrack=w,S.track._originMediaStreamTrack=w,await new tt((I,P)=>{this.handleReplaceTrack(S.track,I,P,!0)})}}o()}catch(y){c(y)}finally{var _;(_=h)===null||_===void 0||_()}}),K(this,"handleGetRTCStats",i=>{i(this.statsCollector.getRTCStats())}),K(this,"handleGetLocalVideoStats",i=>{i(this.statsCollector.getLocalVideoTrackStats())}),K(this,"handleGetLocalAudioStats",i=>{i(this.statsCollector.getLocalAudioTrackStats())}),K(this,"handleGetRemoteVideoStats",i=>this.statsCollector.getRemoteVideoTrackStats(i.uid)[i.uid]),K(this,"handleGetRemoteAudioStats",i=>this.statsCollector.getRemoteAudioTrackStats(i.uid)[i.uid]),this.store=e,this.statsCollector=n,this.statsCollector.addP2PChannel(this),this.statsUploader=new KH(this.store),this.bindStatsUploaderEvents(),this.mutex=new Es("P2PChannel-mutex",this.store.clientId),this.isPlanB=!On().supportUnifiedPlan||Z("CHROME_FORCE_PLAN_B")&&bf(),this.shouldForwardP2PCreation=Z("FORWARD_P2P_CREATION")&&On().supportPCSetConfiguration&&J1(),this.shouldForwardP2PCreation&&(this.connection=WA(this.store),this.emit(bt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(e){var n;this.state=Fn.New,this._forceTurn=jH(e),k.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));const i=this.shouldForwardP2PCreation&&((n=this.connection)===null||n===void 0?void 0:n.peerConnectionState)==="closed";if(this.shouldForwardP2PCreation&&!i||(i&&this.connection&&(k.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=WA(this.store,e),this.emit(bt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new Ce(Y.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=Z("NEW_ICE_RESTART")?Pf.FIRST_CONNECTION:Pf.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(e),this.connection.establishPromise}async connect(e){if(!this.connection)throw new Ce(Y.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");Z("ENABLE_PREALLOC_PC")&&this.state===Fn.Connected?await this.connection.updateRemoteConnect(e):(this.store.peerConnectionStart(),await this.connection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Fn.Connected)}updateRemoteRTPCapabilities(e){const n=Array.from(this.localTrackMap.entries()).filter(c=>{var u;let[h]=c;return Xe(u=[Ve.LocalVideoLowTrack,Ve.LocalVideoTrack]).call(u,h)}),i=n.map(c=>{let[,{id:u}]=c;return u}),o=n.map(c=>{let[u]=c;return u});if(this.connection instanceof Xd){if(yt.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(o),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(e)}),!Xe(e).call(e,this.store.codec)){const c=["vp9","vp8","h264"].find(u=>Xe(e).call(e,u));c&&(this.store.codec=c,k.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(c,".")))}this.connection.updateRemoteRTPCapabilities(i,e)}}async getEstablishParams(){var e;if(this.connection instanceof Xd&&this.connection.peerConnectionState!=="closed"&&Xe(e=[Fn.New,Fn.Connected]).call(e,this.state))return this.connection.establishPromise}async publishDataChannel(e){if(!this.connection||this.state!==Fn.Connected){if(this.state===Fn.Disconnected)throw new Ce(Y.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return e.forEach(i=>{var o;Xe(o=this.pendingLocalDataChannels).call(o,i)||this.pendingLocalDataChannels.push(i)}),[]}const n=this.filterTobePublishedDataChannels(e);return n.length===0?[]:(n.forEach(i=>{const o=Date.now();this.store.publish(i.id.toString(),"datachannel",o)}),await this.connection.createDataChannels(this.store.uid,n),n.forEach(i=>{this.localDataChannels.push(i);const o=Date.now();this.store.publish(i.id+"","datachannel",void 0,o)}),e.map(i=>({streamId:i.id,ordered:i.ordered,maxRetransmits:i.maxRetransmits,metadata:i.metadata,channelId:i._originDataChannelId})))}publish(e,n,i){var o=this;return el(function*(){const c=yield Sn(o.mutex.lock("From P2PChannel.publish"));try{var u;const h=o.connection&&Xe(u=["disconnected","failed"]).call(u,o.connection.peerConnectionState);if(!o.connection||o.state!==Fn.Connected||h){if(o.state===Fn.Disconnected)throw new Ce(Y.UNEXPECTED_ERROR,"PeerConnection already disconnected.");o.throwIfTrackTypeNotMatch(e);const _=e.filter(y=>o.pendingLocalTracks.indexOf(y)===-1);return o.pendingLocalTracks=o.pendingLocalTracks.concat(_),void(h&&(o._isWaitPcToRePub=!0))}o.store.pubId=o.store.pubId+1,Ss.markPublishStart(o.store.clientId,o.store.pubId);const m=o.filterTobePublishedTracks(e,n,i);if(m.length===0)return void(yield Sn(o.tryToUnmuteAudio(e)));yield*BI(XH(o.doPublish(o.connection,m)))}finally{c()}})()}doPublish(e,n){var i=this;return el(function*(){n.forEach(I=>{let{track:P,type:B}=I;const M=Date.now();i.store.publish(P.getTrackId(),B===Ve.LocalAudioTrack?"audio":"video",M)}),i.bindLocalTrackEvents(n);const o=n.map(I=>{let{track:P}=I;return P}),c=yield Sn(e.send(o,i.store.codec,i.store.audioCodec)),u=(yield Sn(c.next())).value,h=i.createGatewayPublishMessage(n,u);let m;try{m=yield h}catch(I){throw c.throw(I),(I==null?void 0:I.code)===Y.WS_ABORT&&n.forEach(P=>{let{track:B}=P;i.pendingLocalTracks.indexOf(B)===-1&&i.pendingLocalTracks.push(B)}),i.unbindLocalTrackEvents(n),I}const _=i.mapPubResToRemoteConfig(h,m,o),y=(yield Sn(c.next(_))).value;if(i.state===Fn.Disconnected)throw new Ce(Y.UNEXPECTED_ERROR,"PeerConnection already disconnected.");Z("ENABLE_VIDEO_SEI");const S=Z("ENABLE_ENCODED_TRANSFORM"),w=Z("ENABLE_AUDIO_METADATA");o.forEach(async I=>{const P=I.getRTCRtpTransceiver();if(!P||!S)return;const{interceptLocalVideoFrame:B,interceptLocalAudioFrame:M}=xA();I.trackMediaType===at.VIDEO?await B(P.sender,I):I.trackMediaType===at.AUDIO&&await M(P.sender,{metadata:w?()=>{const U=I.metadata.shift();return U&&U.value}:void 0})}),n.forEach(I=>{let{type:P}=I;i.statsCollector.addLocalStats(P)}),i.assignLocalTracks(n,y),i.statsUploader.startUploadOutboundStats(),n.forEach(I=>{let{track:P,type:B}=I;const M=Date.now();i.store.publish(P.getTrackId(),B===Ve.LocalAudioTrack?"audio":"video",void 0,M)})})()}async updateVideoStreamParameter(e,n){const i=this.localTrackMap.get(n);if(!i||!this.connection)return;if(!(i.track instanceof hr))return k.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");const{track:o}=i,c=function(u,h){const m={};return u.height&&u.width&&(m.scaleResolutionDownBy=XL(u,h)),m.maxFramerate=u.framerate?Ba(u.framerate):void 0,m.maxBitrate=u.bitrate?1e3*u.bitrate:void 0,m}(e,o);if(o._encoderConfig||(o._encoderConfig={}),n!==Ve.LocalVideoLowTrack||!Z("DISABLE_DUAL_STREAM_USE_ENCODING")&&On().supportDualStreamEncoding)c.scaleResolutionDownBy!=null&&(o._encoderConfig.scaleResolutionDownBy=c.scaleResolutionDownBy);else{const u=o._originMediaStreamTrack;if(!u.canvas)return k.warn("[".concat(o.getTrackId(),"] no canvas on track"));(function(h,m){const _=h.canvas;m.width&&(_.width=Ba(m.width)),m.height&&(_.height=Ba(m.height)),m.framerate&&(_.stopCapture&&_.stopCapture(),_.stopCapture=RL(()=>{!_.startCapture&&_.stopCapture&&_.stopCapture(),_.startCapture&&_.startCapture()},Ba(m.framerate)))})(u,e)}c.maxBitrate!=null&&(o._encoderConfig.bitrateMax=c.maxBitrate/1e3),c.maxFramerate!=null&&(o._encoderConfig.frameRate&&typeof o._encoderConfig.frameRate=="object"?o._encoderConfig.frameRate.max=c.maxFramerate:o._encoderConfig.frameRate={max:c.maxFramerate}),k.debug("[".concat(o.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(o._encoderConfig))),await this.connection.updateRtpSenderEncodings(o)}publishLowStream(e){var n=this;return el(function*(){if(!n.connection||n.state!==Fn.Connected)return;const i=yield Sn(n.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const c=n.localTrackMap.get(Ve.LocalVideoTrack);if(!c)throw new Ce(Y.UNEXPECTED_ERROR,"Could not find high stream");if(n.localTrackMap.has(Ve.LocalVideoLowTrack))throw new Ce(Y.UNEXPECTED_ERROR,"[".concat(n.store.clientId,"] Can't publish low stream when stream already publish"));const u=[{track:n.getLowVideoTrack(c.track,e),type:Ve.LocalVideoLowTrack}];if(yield*BI(XH(n.doPublish(n.connection,u))),c.track.muted||!c.track.enabled){var o;const h=(o=n.localTrackMap.get(Ve.LocalVideoLowTrack))===null||o===void 0?void 0:o.id;h!==void 0&&(yield Sn(n.connection.muteLocal([h])))}}finally{i()}})()}async republish(){this.pendingLocalTracks.length>0&&(k.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await ds(this,bt.RequestRePublish,this.pendingLocalTracks),this.emit(bt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(k.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await ds(this,bt.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(e){for(let n=this.pendingRemoteTracks.length-1;n>=0;n--){const{user:i,kind:o}=this.pendingRemoteTracks[n];(o!==at.AUDIO||i._audio_added_&&i._audioSSRC)&&(o!==at.VIDEO||i._video_added_&&i._videoSSRC)||this.pendingRemoteTracks.splice(n,1)}if(e)await ds(this,bt.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:n,kind:i}of this.pendingRemoteTracks)await this.subscribe(n,i,i===at.VIDEO?n._videoSSRC:n._audioSSRC);this.pendingRemoteTracks.forEach(n=>{let{user:i}=n;this.emit(bt.MediaReconnectEnd,i.uid)}),this.pendingRemoteTracks=[]}async unpublish(e){if(!this.connection||this.state!==Fn.Connected)return void e.forEach(o=>{const c=this.pendingLocalTracks.indexOf(o);c!==-1&&this.pendingLocalTracks.splice(c,1)});const n=this.filterTobeUnpublishedTracks(e);if(n.length===0)return;const i=n.find(o=>o[0]==="videoLowTrack");return i&&i[1].track.close(),this.doUnpublish(this.connection,n)}async unpublishDataChannel(e){if(!this.connection||this.state!==Fn.Connected)return void e.forEach(i=>{const o=this.pendingLocalDataChannels.indexOf(i);o!==-1&&this.pendingLocalDataChannels.splice(o,1)});const n=this.filterTobeUnpublishedDataChannels(e);return n.length!==0?(n.forEach(i=>{const o=this.localDataChannels.indexOf(i);o!==-1&&this.localDataChannels.splice(o,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),n.map(i=>i.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==Fn.Connected)return;const e=this.localTrackMap.get(Ve.LocalVideoLowTrack);if(!e)return;e.track.close();const n=[[Ve.LocalVideoLowTrack,e]];return this.doUnpublish(this.connection,n)}async doUnpublish(e,n){const i=this.createGatewayUnpublishMessage(n);return await e.stopSending(n.map(o=>{let[,{id:c}]=o;return c})),this.withdrawLocalTracks(n),this.unbindLocalTrackEvents(n.map(o=>{let[c,{track:u}]=o;return{type:c,track:u}})),n.forEach(o=>{let[c]=o;this.statsCollector.removeLocalStats(c)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),i}async subscribeDataChannel(e,n){if(!this.connection||this.state!==Fn.Connected)throw new Ce(Y.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const i=n.filter(o=>{var c;return!((c=this.remoteDataChannelMap.get(e))!==null&&c!==void 0&&c.get(o.id))});if(i.length!==0)return await this.connection.createDataChannels(e.uid,i),i.forEach(o=>{var c;this.remoteDataChannelMap.has(e)?(c=this.remoteDataChannelMap.get(e))===null||c===void 0||c.set(o.id,o):this.remoteDataChannelMap.set(e,new Map([[o.id,o]]));const u=this.pendingRemoteDataChannels.findIndex(h=>{let{user:m,id:_}=h;return m.uid===e.uid&&_===o.id});u!==-1&&this.pendingRemoteDataChannels.splice(u,1)}),i.map(o=>o.id)}async subscribe(e,n,i,o,c){var u;if(!this.connection||this.state!==Fn.Connected)throw new Ce(Y.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((u=this.remoteUserMap.get(e))!==null&&u!==void 0&&u.has(n))return;let h,m,_;const y=this.connection.getPreMedia(i);if(y)k.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(i,", no need to send sub to gateway.")),_=y.transceiver,h=y.track,m=y.id;else if(c){const I=c.find(B=>{let{stream_type:M}=B;return M===n});if(!I)throw new Ce(Y.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(n," for user: ").concat(e.uid," because subscribe answer from gateway does not contain stream_type: ").concat(n,"."));const P=await this.connection.receive(n,I.ssrcs,String(e._uintid),I.attributes);this.connection instanceof Xd&&(_=P.transceiver),h=P.track,m=P.id}else{const I=await this.connection.receive(n,[{ssrcId:i,rtx:o}],String(e._uintid),void 0);this.connection instanceof Xd&&(_=I.transceiver),h=I.track,m=I.id}if(n===at.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(h):(e._audioTrack=new cv(h,e.uid,e._uintid,this.store),k.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),_&&e._audioTrack._updateRtpTransceiver(_),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(h):(e._videoTrack=new av(h,e.uid,e._uintid,this.store),k.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),_&&e._videoTrack._updateRtpTransceiver(_),this.bindRemoteTrackEvents(e,e._videoTrack)),_&&Z("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:I,interceptRemoteAudioFrame:P}=xA();n==at.VIDEO?await I(_.receiver,{onSei:Z("ENABLE_VIDEO_SEI")&&(B=>{var M;return(M=e._videoTrack)===null||M===void 0?void 0:M._onSei(B)})}):n==at.AUDIO&&await P(_.receiver,{enableTopn:!!Z("ENABLE_AUDIO_TOPN"),enableMetadata:!!Z("ENABLE_AUDIO_METADATA"),onMetadata:B=>{this.safeEmit(bt.AudioMetadata,B)}})}const S=this.remoteUserMap.get(e);S?S.set(n,m):this.remoteUserMap.set(e,new Map([[n,m]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats();const w=this.pendingRemoteTracks.findIndex(I=>{let{user:P,kind:B}=I;return P.uid===e.uid&&n===B});w!==-1&&(this.pendingRemoteTracks.splice(w,1),this.emit(bt.MediaReconnectEnd,e.uid))}async massSubscribe(e){return this.massSubscribeNoLock(e)}async massSubscribeNoLock(e){if(!this.connection||this.state!==Fn.Connected)throw new Ce(Y.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");e=e.filter(c=>{var u;let{user:h,mediaType:m}=c;return!((u=this.remoteUserMap.get(h))!==null&&u!==void 0&&u.has(m))});const n=[],i=new Map;e.forEach(c=>{if(!this.connection)return;const u=this.connection.getPreMedia(c.ssrcId);u?i.set(c.ssrcId,u):n.push(c)});const o=await this.connection.batchReceive(n.map(c=>{let{user:u,mediaType:h,ssrcId:m,rtxSsrcId:_}=c;return{kind:h,ssrcMsg:[{ssrcId:m,rtx:_}],mslabel:String(u._uintid)}}));n.forEach((c,u)=>{i.set(c.ssrcId,o[u])});for(const{user:c,mediaType:u,ssrcId:h}of e){const m=i.get(h);if(!m)return void k.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(c.uid," subscribe data,").concat(u,", ").concat(h));const{track:_,id:y,transceiver:S}=m;if(S&&Z("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:P,interceptRemoteAudioFrame:B}=xA();u==at.VIDEO?await P(S.receiver,{onSei:Z("ENABLE_VIDEO_SEI")&&(M=>{var U;return(U=c._videoTrack)===null||U===void 0?void 0:U._onSei(M)})}):u==at.AUDIO&&await B(S.receiver,{enableTopn:!!Z("ENABLE_AUDIO_TOPN"),enableMetadata:!!Z("ENABLE_AUDIO_METADATA"),onMetadata:M=>{this.safeEmit(bt.AudioMetadata,M)}})}if(u===at.AUDIO?(c._audioTrack?c._audioTrack._updateOriginMediaStreamTrack(_):(c._audioTrack=new cv(_,c.uid,c._uintid,this.store),k.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(c._audioTrack.getTrackId()))),S&&c._audioTrack._updateRtpTransceiver(S),this.bindRemoteTrackEvents(c,c._audioTrack)):(c._videoTrack?c._videoTrack._updateOriginMediaStreamTrack(_):(c._videoTrack=new av(_,c.uid,c._uintid,this.store),k.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(c._videoTrack.getTrackId()))),S&&c._videoTrack._updateRtpTransceiver(S),this.bindRemoteTrackEvents(c,c._videoTrack)),Z("ENABLE_VIDEO_SEI")&&S){const{interceptRemoteVideoFrame:P,interceptRemoteAudioFrame:B}=xA();u==at.VIDEO?await P(S.receiver,{onSei:M=>{var U;(U=c._videoTrack)===null||U===void 0||U._onSei(M)}}):u==at.AUDIO&&await B(S.receiver)}const w=this.remoteUserMap.get(c);w?w.set(u,y):this.remoteUserMap.set(c,new Map([[u,y]])),this.statsCollector.addRemoteStats(c.uid),this.statsUploader.startUploadInboundStats();const I=this.pendingRemoteTracks.findIndex(P=>{let{user:B,kind:M}=P;return B.uid===c.uid&&u===M});I!==-1&&(this.pendingRemoteTracks.splice(I,1),this.emit(bt.MediaReconnectEnd,c.uid))}}async unsubscribe(e,n,i){const o=this.pendingRemoteTracks.filter(h=>{let{user:m,kind:_}=h;return n!==void 0?m.uid===e.uid&&n===_:m.uid===e.uid});if(o.forEach(h=>{const m=this.pendingRemoteTracks.indexOf(h);this.pendingRemoteTracks.splice(m,1)}),this.connection&&this.state===Fn.Connected||i||o.forEach(h=>{let{kind:m}=h;var _;if(m===at.AUDIO)(_=e._audioTrack)===null||_===void 0||_._destroy(),e._audioTrack=void 0;else if(m===at.VIDEO){var y;(y=e._videoTrack)===null||y===void 0||y._destroy(),e._videoTrack=void 0}}),!this.connection||this.state!==Fn.Connected)return;const c=this.filterTobeUnSubscribedTracks(e,n);if(c.length===0)return;await this.connection.stopReceiving(c.map(h=>{let[,{id:m}]=h;return m}));const u=this.createUnsubscribeMessage(c);return this.withdrawRemoteTracks(c),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),c.forEach(h=>{let[m,{kind:_}]=h;var y,S;if(_===at.VIDEO&&m._videoSSRC&&((y=this.connection)===null||y===void 0||y.setStatsRemoteVideoIsReady(m._videoSSRC,!1)),_===at.VIDEO)this.unbindRemoteTrackEvents(m._videoTrack),i||((S=m._videoTrack)===null||S===void 0||S._destroy(),m._videoTrack=void 0);else if(_===at.AUDIO){var w;this.unbindRemoteTrackEvents(m._audioTrack),!i&&((w=m._audioTrack)===null||w===void 0||w._destroy(),m._audioTrack=void 0)}}),u}async unsubscribeDataChannel(e,n){if(n.forEach(c=>{const u=this.pendingRemoteDataChannels.findIndex(h=>h.id===c.id);u!==-1&&this.pendingRemoteDataChannels.splice(u,1)}),!this.connection)return;const i=this.filterTobeUnSubscribedDataChannels(e,n);if(i.length===0)return;n.forEach(c=>{c._close()});const o=this.remoteDataChannelMap.get(e);return i.forEach(c=>{o&&o.delete(c.id)}),o&&o.size===0&&(this.remoteDataChannelMap.delete(e),await this.connection.stopDataChannels(e.uid)),i.map(c=>c.id)}async massUnsubscribe(e){return this.massUnsubscribeNoLock(e)}async massUnsubscribeNoLock(e){let n=[];for(const{user:c,mediaType:u}of e){const h=this.pendingRemoteTracks.filter(m=>{let{user:_,kind:y}=m;return u!==void 0?_.uid===c.uid&&u===y:_.uid===c.uid});h.forEach(m=>{const _=this.pendingRemoteTracks.indexOf(m);this.pendingRemoteTracks.splice(_,1)}),n=n.concat(h)}if(!this.connection||this.state!==Fn.Connected)return void n.forEach(c=>{let{user:u,kind:h}=c;var m;if(h===at.AUDIO)(m=u._audioTrack)===null||m===void 0||m._destroy(),u._audioTrack=void 0;else if(h===at.VIDEO){var _;(_=u._videoTrack)===null||_===void 0||_._destroy(),u._videoTrack=void 0}});const i=Da(e).call(e,(c,u)=>{let{user:h,mediaType:m}=u;const _=this.filterTobeUnSubscribedTracks(h,m);return c.concat(_)},[]);if(i.length===0)return;await this.connection.stopReceiving(i.map(c=>{let[,{id:u}]=c;return u}));const o=this.createUnsubscribeAllMessage(i);return this.withdrawRemoteTracks(i),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),i.forEach(c=>{let[u,{kind:h}]=c;var m,_;if(h===at.VIDEO&&u._videoSSRC&&((m=this.connection)===null||m===void 0||m.setStatsRemoteVideoIsReady(u._videoSSRC,!1)),h===at.VIDEO)this.unbindRemoteTrackEvents(u._videoTrack),(_=u._videoTrack)===null||_===void 0||_._destroy(),u._videoTrack=void 0;else if(h===at.AUDIO){var y;this.unbindRemoteTrackEvents(u._audioTrack),(y=u._audioTrack)===null||y===void 0||y._destroy(),u._audioTrack=void 0}}),o}isPreSubScribe(e){return!this.connection||this.state!==Fn.Connected?!1:!!this.connection.getPreMedia(e)}async muteRemote(e,n){if(!this.connection)return;const i=this.remoteUserMap.get(e);if(!i)return void k.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid,"."));if(!i.get(n))return void k.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid," media type ").concat(n,"."));const o=n===at.VIDEO?e._videoSSRC:e._audioSSRC;o!==void 0&&this.connection.setStatsRemoteVideoIsReady(o,!1)}async unmuteRemote(e,n){return this.unmuteRemoteNoLock(e,n)}async unmuteRemoteNoLock(e,n){if(!this.connection)return;const i=this.remoteUserMap.get(e);if(!i)return void k.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid,"."));i.get(n)||k.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(n,"."))}addAudioMetadata(e){const n=this.localTrackMap.get(Ve.LocalAudioTrack),i=n&&n.track;i&&i.metadata.push(e)}getAllTracks(e){const n=this.localTrackMap.get(Ve.LocalAudioTrack);if((n==null?void 0:n.track)instanceof yi){const i=n.track;return Array.from(this.localTrackMap.entries()).filter(o=>{let[c]=o;return c!==Ve.LocalAudioTrack}).filter(o=>{let[c]=o;return!(e&&c===Ve.LocalVideoLowTrack)}).map(o=>{let[,{track:c}]=o;return c}).concat(i.trackList)}return Array.from(this.localTrackMap.entries()).filter(i=>{let[o]=i;return!(e&&o===Ve.LocalVideoLowTrack)}).map(i=>{let[,{track:o}]=i;return o})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(e,n,i,o,c){if(e){const h=this.localTrackMap.get(Ve.LocalAudioTrack),m=o?this.localTrackMap.get(Ve.LocalVideoLowTrack):this.localTrackMap.get(Ve.LocalVideoTrack);yt.publish(this.store.sessionId,{eventElapse:Ss.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:n,audioName:h==null?void 0:h.track.getTrackLabel(),videoName:m==null?void 0:m.track.getTrackLabel(),screenshare:(m==null?void 0:m.track._hints.indexOf(ir.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}else{var u;i||(i=[]);const h=i.find(_=>_ instanceof Vr),m=o?(u=this.localTrackMap.get(Ve.LocalVideoTrack))===null||u===void 0?void 0:u.track:i.find(_=>_ instanceof hr);yt.publish(this.store.sessionId,{eventElapse:Ss.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:n,audioName:h==null?void 0:h.getTrackLabel(),videoName:m==null?void 0:m.getTrackLabel(),screenshare:(m==null?void 0:m._hints.indexOf(ir.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}}reportSubscribeEvent(e,n,i,o){const c=o===at.VIDEO?i._videoSSRC:i._audioSSRC;c&&yt.subscribe(this.store.sessionId,{succ:e,ec:n,video:o===at.VIDEO,audio:o===at.AUDIO,peerid:i.uid,subscribeRequestid:c,p2pid:this.store.p2pId,eventElapse:Ss.measureFromSubscribeStart(this.store.clientId,c),preSsrc:this.isPreSubScribe(c)})}reset(){k.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new Es("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=WA(this.store),this.emit(bt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(Ve.LocalAudioTrack);if((e==null?void 0:e.track)instanceof yi){if(e.track.trackList.length>0){const n=e.track;e.track.trackList.forEach(i=>{n.removeAudioTrack(i)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=Fn.Disconnected}getStats(){var e;return(e=this.connection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(e){var n;return((n=this.connection)===null||n===void 0?void 0:n.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(Ve.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(Ve.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const n=this.localTrackMap.get(e);return n&&n.track instanceof hr||n&&n.track instanceof Vr?n.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,n){if(!e)return this.remoteUserMap.size>0;const i=this.remoteUserMap.get(e);return!!i&&(!n||i.has(n))}async hasRemoteMediaWithLock(e,n){if(!e)return this.remoteUserMap.size>0;const i=this.remoteUserMap.get(e);return!!i&&(!n||i.has(n))}getRemoteMedia(e){var n;const i=Array.from(yc(n=this.remoteUserMap).call(n)).find(o=>o.uid===e);return i?{audioTrack:i.audioTrack,audioSSRC:i._audioSSRC,videoTrack:i.videoTrack,videoSSRC:i._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(i=>{let[o]=i;return{uid:o.uid,level:o.audioTrack?100*o.audioTrack._source.getAccurateVolumeLevel():0}});const n=this.localTrackMap.get(Ve.LocalAudioTrack);return n&&e.push({level:100*n.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=_0(e).call(e,(i,o)=>i.level-o.level),e}async disconnectForReconnect(){this.connection&&(k.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=Fn.Reconnecting,Z("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[n]=e;var i;n._videoTrack&&n._videoTrack._player&&((i=n._videoTrack._player.getVideoElement())===null||i===void 0||i.pause(),n._videoTrack._player.isKeepLastFrame=!0,n._videoTrack._originMediaStreamTrack.stop())}),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=WA(this.store),this.emit(bt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var n;let[i,{track:o}]=e;switch(i){case Ve.LocalVideoTrack:Xe(n=o._hints).call(n,ir.LOW_STREAM)?o.close():this.pendingLocalTracks.push(o);break;case Ve.LocalAudioTrack:o instanceof yi?this.pendingLocalTracks=this.pendingLocalTracks.concat(o.trackList):this.pendingLocalTracks.push(o);case Ve.LocalVideoLowTrack:}}),this.emit(bt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[n,i]=e;Array.from(yc(i).call(i)).forEach(o=>{this.setPendingRemoteMedia(n,o)}),this.emit(bt.MediaReconnectStart,n.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(e=>{this.pendingLocalDataChannels.push(e)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(e=>{let[n,i]=e;Array.from(yc(i).call(i)).forEach(o=>{this.setPendingRemoteDataChannel(n,o)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),k.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(e,n){for(const i of this.pendingRemoteDataChannels){const{user:o,id:c}=i;if((e instanceof om?e.uid:e)===o.uid&&c===n)return!0}return!1}setPendingRemoteDataChannel(e,n){this.hasPendingRemoteDataChannel(e,n)||this.pendingRemoteDataChannels.push({user:e,id:n})}hasPendingRemoteMedia(e,n){for(const i of this.pendingRemoteTracks){const{user:o,kind:c}=i;if((e instanceof om?e.uid:e)===o.uid&&n===c)return!0}return!1}setPendingRemoteMedia(e,n){this.hasPendingRemoteMedia(e,n)||this.pendingRemoteTracks.push({user:e,kind:n})}restartICE(e){var n=this;return el(function*(){if(!n.connection||n.state!==Fn.Connected)return;const i=yield Sn(n.mutex.lock("From P2PChannel.restartICE"));let o;try{o=yield Sn(n.connection.restartICE(e));const u=yield Sn(o.next());if(u.done)return;const h=u.value,m=yield h;switch(fx(n.connection)&&n.reportPCStats(Date.now(),!1,n._pcStatsUploadType),e){case vs.UDP_TCP_RELAY:n._pcStatsUploadType=Pf.UDP_TCP_RESTART;break;case vs.TCP_RELAY:n._pcStatsUploadType=Pf.TCP_RESTART;break;case vs.RELAY:n._pcStatsUploadType=Pf.RELAY_RESTART;break;default:n._pcStatsUploadType=Pf.OLD_RESTART}n._isTryConnecting=!0,o.next(m)}catch(u){var c;(c=o)===null||c===void 0||c.throw(u)}finally{i()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats(),n=this.localTrackMap.get(Ve.LocalVideoTrack),i=this.localTrackMap.get(Ve.LocalAudioTrack),o=e.videoSend.find(P=>P.ssrc===(n==null?void 0:n.ssrcs[0].ssrcId)),c=e.audioSend.find(P=>P.ssrc===(i==null?void 0:i.ssrcs[0].ssrcId));if(!o||!c)return 1;const u=_c(this,bt.NeedSignalRTT),h=o?o.rttMs:void 0,m=c?c.rttMs:void 0,_=h&&m?(h+m)/2:h||m,y=(_&&u?(_+u)/2:_||u)||0,S=100*e.sendPacketLossRate*.7/50+.3*y/1500,w=S<.17?1:S<.36?2:S<.59?3:S<.1?4:5,I=n==null?void 0:n.track;if(I&&I._encoderConfig&&I._hints.indexOf(ir.SCREEN_TRACK)===-1){const P=I._encoderConfig.bitrateMax,B=e.bitrate.actualEncoded;if(P&&B){const M=(1e3*P-B)/(1e3*P);return Pz[M<.15?0:M<.3?1:M<.45?2:M<.6?3:4][w]}}return w}getDownlinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats();let n=0;return Array.from(this.remoteUserMap.entries()).forEach(i=>{let[o]=i;const c=o._audioSSRC,u=o._videoSSRC,h=e.audioRecv.find(B=>B.ssrc===c),m=e.videoRecv.find(B=>B.ssrc===u);if(!h&&!m)return void(n+=1);const _=_c(this,bt.NeedSignalRTT),y=e.rtt,S=(y&&_?(y+_)/2:y||_)||0,w=h?h.jitterMs:void 0,I=e.recvPacketLossRate;let P=.7*I*100/50+.3*S/1500;w&&(P=.6*I*100/50+.2*S/1500+.2*w/400),n+=P<.1?1:P<.17?2:P<.36?3:P<.59?4:5}),this.remoteUserMap.size>0?Math.round(n/this.remoteUserMap.size):n}async muteLocalTrack(e){return new tt((n,i)=>{this.handleMuteLocalTrack(e,n,i)})}async replaceTrack(e,n){var i;if(k.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(e.getTrackId(),"] to [").concat(n.getTrackId(),"]")),!this.connection||this.state!==Fn.Connected)return;const o=Array.from(this.localTrackMap.entries()).find(u=>{let[,{track:h}]=u;return e===h});if(!o)return;const c=o[0];if(e!==n&&(this.unbindLocalTrackEvents([{track:e,type:c}]),this.bindLocalTrackEvents([{track:n,type:c}]),o[1].track=n),await((i=this.connection)===null||i===void 0?void 0:i.replaceTrack(n,o[1].id)),this.isPlanB){const u=o[1];u.id=n._mediaStreamTrack.id,this.localTrackMap.set(c,u)}if(c===Ve.LocalVideoTrack&&!Z("DISABLE_DUAL_STREAM_USE_ENCODING")&&On().supportDualStreamEncoding){const u=this.localTrackMap.get(Ve.LocalVideoLowTrack);if(u){const h=e._mediaStreamTrack.clone();u.track._originMediaStreamTrack.stop(),u.track._mediaStreamTrack=h,u.track._originMediaStreamTrack=h,await new tt((m,_)=>{this.handleReplaceTrack(u.track,m,_,!0)})}}}filterTobePublishedTracks(e,n,i){const o=[],c=this.getAllTracks();e=$y(e=e.filter(_=>c.indexOf(_)===-1));let u,h=!1;const m=this.localTrackMap.get(Ve.LocalAudioTrack);for(const _ of e){if(_ instanceof hr&&(this.localTrackMap.has(Ve.LocalVideoTrack)||h?new Ce(Y.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(o.push({track:_,type:Ve.LocalVideoTrack}),h=!0),n)){const y=this.getLowVideoTrack(_,i);o.push({track:y,type:Ve.LocalVideoLowTrack})}if(_ instanceof Vr)if(m){const y=m.track;if(y instanceof yi)dx([_]),y.addAudioTrack(_),this.bindLocalAudioTrackEvents(_,!0);else{const S=hx([y,_]);k.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(S.getTrackId(),"]")),this.replaceTrack(y,S)}}else u instanceof yi?(dx([_]),u.addAudioTrack(_)):u||!_._useAudioElement&&On().webAudioMediaStreamDest&&!_._bypassWebAudio?u=hx(u?[_,u]:[_]):u=_}return u&&(k.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(u.getTrackId(),"]")),o.push({track:u,type:Ve.LocalAudioTrack})),o}filterTobeUnpublishedTracks(e){const n=[],i=this.getAllTracks();e=$y(e=e.filter(o=>i.indexOf(o)!==-1));for(const o of e){if(o instanceof Vr){const c=this.localTrackMap.get(Ve.LocalAudioTrack);if(!c)continue;c.track instanceof yi?(c.track.removeAudioTrack(o),this.unbindLocalAudioTrackEvents(o),c.track.trackList.length===0&&(n.push([Ve.LocalAudioTrack,c]),c.track.close())):n.push([Ve.LocalAudioTrack,c])}if(o instanceof hr){const c=this.localTrackMap.get(Ve.LocalVideoTrack);if(!c)continue;n.push([Ve.LocalVideoTrack,c]);const u=this.localTrackMap.get(Ve.LocalVideoLowTrack);u&&n.push([Ve.LocalVideoLowTrack,u])}}return n}filterTobePublishedDataChannels(e){return e=(e=$y(e)).filter(n=>this.localDataChannels.findIndex(i=>i.id===n.id)===-1)}filterTobeUnpublishedDataChannels(e){return e=(e=(e=$y(e)).filter(n=>this.localDataChannels.indexOf(n)!==-1)).filter(n=>n._originDataChannel)}bindLocalTrackEvents(e){e.forEach(n=>{let{track:i,type:o}=n;switch(o){case Ve.LocalVideoTrack:i.addListener(ut.GET_STATS,this.handleGetLocalVideoStats),i.addListener(ut.GET_RTC_STATS,this.handleGetRTCStats),i.addListener(ut.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(ut.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(ut.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.addListener(ut.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.addListener(ut.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.addListener(ut.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(ut.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Ve.LocalAudioTrack:this.bindLocalAudioTrackEvents(i);case Ve.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,n){e instanceof yi?e.trackList.forEach(i=>{i.addListener(ut.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(ut.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(ut.GET_STATS,this.handleGetLocalAudioStats),i.addListener(ut.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(ut.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(ut.GET_STATS,this.handleGetLocalAudioStats),e.addListener(ut.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(ut.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(ut.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(ut.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),n||(e.addListener(ut.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.addListener(ut.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(n=>{let[i,{track:o}]=n;return{track:o,type:i}})),e.forEach(n=>{let{track:i,type:o}=n;switch(o){case Ve.LocalVideoTrack:i.off(ut.GET_STATS,this.handleGetLocalVideoStats),i.off(ut.GET_RTC_STATS,this.handleGetRTCStats),i.off(ut.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.off(ut.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.off(ut.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.off(ut.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.off(ut.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.off(ut.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.off(ut.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Ve.LocalAudioTrack:this.unbindLocalAudioTrackEvents(i);case Ve.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof yi?e.trackList.forEach(n=>{n.off(ut.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(ut.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(ut.GET_STATS,this.handleGetLocalAudioStats),n.off(ut.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(ut.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(ut.GET_STATS,this.handleGetLocalAudioStats),e.off(ut.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(ut.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(ut.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(ut.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),e.off(ut.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(ut.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,n){n instanceof av&&n.addListener(ut.GET_STATS,i=>{i(this.handleGetRemoteVideoStats(e))}),n instanceof cv&&n.addListener(ut.GET_STATS,i=>{i(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(ut.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[n,i]=e;i.has(at.AUDIO)&&this.unbindRemoteTrackEvents(n._audioTrack),i.has(at.VIDEO)&&this.unbindRemoteTrackEvents(n._videoTrack)})}createGatewayPublishMessage(e,n){return e.map((i,o)=>{var c;let u,h,{track:m,type:_}=i;switch(_){case Ve.LocalAudioTrack:u=jn.Audio,h={dtx:m instanceof pA&&m._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case Ve.LocalVideoTrack:u=Xe(c=m._hints).call(c,ir.SCREEN_TRACK)?jn.Screen:jn.High,h=Qd(Qd({},$z(m)),{},{codec:this.store.codec,svc_mode:PA()});break;case Ve.LocalVideoLowTrack:u=jn.Low,h=Qd(Qd({},$z(m)),{},{codec:this.store.codec,svc_mode:PA()})}return{stream_type:u,attributes:h,ssrcs:n[o]}})}createGatewayUnpublishMessage(e){return e.map(n=>{var i;let o,[c,{track:u,ssrcs:h,id:m}]=n;switch(c){case Ve.LocalVideoTrack:o=Xe(i=u._hints).call(i,ir.SCREEN_TRACK)?jn.Screen:jn.High;break;case Ve.LocalAudioTrack:o=jn.Audio;break;case Ve.LocalVideoLowTrack:o=jn.Low}return{stream_type:o,ssrcs:h,mid:m}})}assignLocalTracks(e,n){e.forEach((i,o)=>{let{track:c,type:u}=i;this.localTrackMap.set(u,{track:c,id:n[o].id,ssrcs:n[o].localSSRC})})}withdrawLocalTracks(e){e.forEach(n=>{let[i]=n;this.localTrackMap.delete(i)})}bindConnectionEvents(e){e.onConnectionStateChange=async n=>{if(k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(n,")")),this.emit(bt.PeerConnectionStateChange,n),n==="connecting"&&e instanceof Xd&&!Pr()&&Z("FIRST_TCP_CANDIDATE")&&window.setTimeout(()=>{n==="connecting"&&e.extendCandidate()},Z("FIRST_TCP_CANDIDATE_INTERVAL")),n!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),n==="connected"&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),e instanceof Xd&&qH(e,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=Pf.DISCONNECTED_OR_FAILED,_c(this,bt.QueryClientConnectionState)==="CONNECTED"&&this._isWaitPcToRePub)){const i=this.pendingLocalTracks.map(c=>c.getTrackId()),o=this.pendingLocalDataChannels.map(c=>"dc_".concat(c.id));yt.reportApiInvoke(this.store.sessionId,{name:fi.REPUB_AFTER_PC_CONNECTED,options:i.concat(o),tag:kr.TRACER}).onSuccess(),this.republish()}if(Z("NEW_ICE_RESTART")&&e instanceof Xd&&!Pr()&&!this._forceTurn){if(Xe(Bz).call(Bz,n)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const i=c=>{fx(e)&&(k.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(c)),_c(this,bt.QueryClientConnectionState)==="CONNECTED"&&this.emit(bt.RequestRestartICE,c))},o=()=>{fx(e)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),k.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(bt.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout(()=>{$H(e,i,o)},800))}}else{if(n==="disconnected"&&e.iceConnectionState==="disconnected")return setTimeout(()=>{e.iceConnectionState==="disconnected"&&Z("ICE_RESTART")&&_c(this,bt.QueryClientConnectionState)==="CONNECTED"&&this.emit(bt.RequestRestartICE)},800),void setTimeout(()=>{e.peerConnectionState==="disconnected"&&(k.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout(()=>this.emit(bt.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);n==="failed"&&(k.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout(()=>this.emit(bt.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},e.onICEConnectionStateChange=n=>{n!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(n,")")),yt.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:n,tag:kr.TRACER}).onSuccess(),this.emit(bt.IceConnectionStateChange,n)},e.onICETransportStateChange=n=>{k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(n,")"))},e.onDTLSTransportStateChange=n=>{k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(n,")"))},e.onDTLSTransportError=n=>{k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(n,")"))},e.onFirstAudioDecoded=n=>{var i;const o=Array.from(yc(i=this.remoteUserMap).call(i)).find(u=>u._audioSSRC===n);var c;o&&(this.store.subscribe(o.uid,"audio",void 0,void 0,void 0,Date.now()),(c=o.audioTrack)===null||c===void 0||c.emit(nv.FIRST_FRAME_DECODED),yt.firstRemoteFrame(this.store.sessionId,Oi.FIRST_AUDIO_DECODE,vr.FIRST_AUDIO_DECODE,{peer:o._uintid,subscribeElapse:Ss.measureFromSubscribeStart(this.store.clientId,n),subscribeRequestid:n,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=n=>{var i;const o=Array.from(yc(i=this.remoteUserMap).call(i)).find(c=>c._audioSSRC===n);o&&yt.firstRemoteFrame(this.store.sessionId,Oi.FIRST_AUDIO_RECEIVED,vr.FIRST_AUDIO_RECEIVED,{peer:o._uintid,subscribeElapse:Ss.measureFromSubscribeStart(this.store.clientId,n),subscribeRequestid:n,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(n,i,o)=>{this.reportVideoFirstFrameDecoded(n,i,o)},e.onFirstVideoReceived=n=>{var i;const o=Array.from(yc(i=this.remoteUserMap).call(i)).find(c=>c._videoSSRC===n);o&&yt.firstRemoteFrame(this.store.sessionId,Oi.FIRST_VIDEO_RECEIVED,vr.FIRST_VIDEO_RECEIVED,{peer:o._uintid,subscribeElapse:Ss.measureFromSubscribeStart(this.store.clientId,n),subscribeRequestid:n,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(n,i)=>{const o=n.candidateType==="relay",c=i.candidateType==="relay";i.candidateType!=="unknown"&&o===c||this.emit(bt.ConnectionTypeChange,o),k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(rm(i))," -> ").concat(JSON.stringify(rm(n)),")"))},e.onSelectedRemoteCandidateChanged=(n,i)=>{k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(rm(i))," -> ").concat(JSON.stringify(rm(n)),")"))},e.onFirstVideoDecodedTimeout=n=>{this.reportVideoFirstFrameDecoded(n,void 0,void 0,!0)},e.getLocalVideoStats=()=>{const n=this.statsCollector.getLocalVideoTrackStats(),i=this.statsCollector.getRTCStats();return Qd(Qd({},n),i)},e.onICECandidateError=n=>{this._iceError=n}}resetConnection(e){e instanceof Xd&&function(n){Sv.delete(n.id),qH(n)}(e),e.close(),this.emit(bt.PeerConnectionStateChange,"closed"),function(n){n.onConnectionStateChange=void 0,n.onICEConnectionStateChange=void 0,n.onICETransportStateChange=void 0,n.onDTLSTransportStateChange=void 0,n.onDTLSTransportError=void 0,n.onFirstAudioDecoded=void 0,n.onFirstAudioReceived=void 0,n.onFirstVideoDecoded=void 0,n.onFirstVideoReceived=void 0,n.onSelectedLocalCandidateChanged=void 0,n.onSelectedRemoteCandidateChanged=void 0,n.onFirstVideoDecodedTimeout=void 0,n.getLocalVideoStats=void 0}(e),this._isWaitPcToRePub=!1}filterTobeMutedTracks(e){const n=[];if(this.getAllTracks().indexOf(e)===-1)return n;const i=this.localTrackMap.get(Ve.LocalAudioTrack);if(e instanceof Vr&&(i==null?void 0:i.track)instanceof yi)return i.track.isActive||n.push([Ve.LocalAudioTrack,i]),n;const o=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return e===u});if(o&&(n.push(o),o[0]===Ve.LocalVideoTrack)){const c=this.localTrackMap.get(Ve.LocalVideoLowTrack);c&&n.push([Ve.LocalVideoLowTrack,c])}return n}filterTobeUnmutedTracks(e){const n=[],i=this.localTrackMap.get(Ve.LocalAudioTrack);if(e instanceof Vr&&(i==null?void 0:i.track)instanceof yi)return i.track.isActive&&n.push([Ve.LocalAudioTrack,i]),n;const o=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return e===u});if(o)if(o[0]===Ve.LocalVideoTrack){n.push(o);const c=this.localTrackMap.get(Ve.LocalVideoLowTrack);c&&n.push([Ve.LocalVideoLowTrack,c])}else n.push(o);return n}createMuteMessage(e){return e.map(n=>{var i;let o,[c,{track:u,ssrcs:h,id:m}]=n;switch(c){case Ve.LocalAudioTrack:o=jn.Audio;break;case Ve.LocalVideoTrack:o=Xe(i=u._hints).call(i,ir.SCREEN_TRACK)?jn.Screen:jn.High;break;case Ve.LocalVideoLowTrack:o=jn.Low}return{stream_type:o,ssrcs:h,mid:m}})}createUnmuteMessage(e){return e.map(n=>{var i;let o,[c,{track:u,ssrcs:h,id:m}]=n;switch(c){case Ve.LocalAudioTrack:o=jn.Audio;break;case Ve.LocalVideoTrack:o=Xe(i=u._hints).call(i,ir.SCREEN_TRACK)?jn.Screen:jn.High;break;case Ve.LocalVideoLowTrack:o=jn.Low}return{stream_type:o,ssrcs:h,mid:m}})}filterTobeUnSubscribedTracks(e,n){const i=[],o=this.remoteUserMap.get(e);if(!o)return i;if(n){const c=o.get(n);if(!c)return i;i.push([e,{kind:n,id:c}])}else Array.from(o.entries()).forEach(c=>{let[u,h]=c;i.push([e,{kind:u,id:h}])});return i}filterTobeUnSubscribedDataChannels(e,n){const i=[];return n.forEach(o=>{var c;(c=this.remoteDataChannelMap.get(e))!==null&&c!==void 0&&c.has(o.id)&&i.push(o)}),i}createUnsubscribeMessage(e){const n=[];return e.forEach(i=>{let[o,{kind:c,id:u}]=i;switch(c){case at.VIDEO:return void(o._videoSSRC&&n.push({stream_type:at.VIDEO,ssrcId:o._videoSSRC}));case at.AUDIO:return void(o._audioSSRC&&n.push({stream_type:at.AUDIO,ssrcId:o._audioSSRC}))}}),n}createUnsubscribeAllMessage(e){const n=new Map;return e.forEach(i=>{let[o,{kind:c}]=i;if(n.has(o)){let u=n.get(o);c===at.VIDEO?u|=Pi.Video:u|=Pi.Audio,n.set(o,u)}else c===at.VIDEO?n.set(o,Pi.Video):n.set(o,Pi.Audio)}),{users:Array.from(n.entries()).map(i=>{let[o,c]=i;return{stream_id:o.uid,stream_type:c}})}}withdrawRemoteTracks(e){e.forEach(n=>{let[i,{kind:o}]=n;const c=this.remoteUserMap.get(i);c&&(c.delete(o),Array.from(c.entries()).length===0&&this.remoteUserMap.delete(i))})}async updateBitrateLimit(e){const n=this.localTrackMap.get(Ve.LocalVideoTrack),i=this.localTrackMap.get(Ve.LocalVideoLowTrack);n&&(await n.track.setBitrateLimit(e.uplink),await new tt((o,c)=>{this.handleUpdateVideoEncoder(n.track,o,c,!0)})),i&&e.low_stream_uplink&&(await i.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new tt((o,c)=>{this.handleUpdateVideoEncoder(i.track,o,c,!0)}))}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}mapPubResToRemoteConfig(e,n,i){return e.map((o,c)=>{var u;let{stream_type:h}=o;const m=(u=n.find(_=>{let{stream_type:y}=_;return h===y}))===null||u===void 0?void 0:u.attributes;if(m&&Z("DISABLE_SCREEN_SHARE_REMB")){const _=i[c]._hints;(Xe(_).call(_,ir.SCREEN_TRACK)||Xe(_).call(_,ir.SCREEN_LOW_TRACK))&&(m.remb=!1,k.debug("disable remb for screen share, hints:",_))}return m})}async tryToUnmuteAudio(e){for(let i=0;i<e.length;i++)if(e[i]instanceof Vr){var n;const o=this.filterTobeUnmutedTracks(e[i]);if(o.length===0)continue;await((n=this.connection)===null||n===void 0?void 0:n.unmuteLocal(o.map(u=>{let[,{id:h}]=u;return h})));const c=this.createUnmuteMessage(o);return void await nr(this,bt.RequestUnmuteLocal,c)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var n;return!((n=this.connection)===null||n===void 0||!n.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,n)=>this.emit(bt.RequestUpload,e,n),this.statsUploader.requestUploadStats=e=>this.emit(bt.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var e;return{connectState:((e=this.connection)===null||e===void 0?void 0:e.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await $i(sL(this.dtlsFailedCount,pi)),this.emit(bt.RequestReconnect)}async reconnectP2P(){const e=Array.from(this.localTrackMap.entries()),n=this.createGatewayUnpublishMessage(e);Array.from(this.remoteUserMap.entries()),n.length>0&&await ds(this,bt.RequestUnpublishForReconnectPC,n),this.disconnectForReconnect(),this.emit(bt.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(Ve.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof hr)}throwIfTrackTypeNotMatch(e){if(e.filter(n=>n instanceof hr).length>1)throw new Ce(Y.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(n=>n instanceof Vr).length>1&&(e.some(n=>n instanceof Vr&&n._bypassWebAudio)||!On().webAudioMediaStreamDest))throw new Ce(Y.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const n of e){if(n instanceof hr&&this.pendingLocalTracks.some(i=>i instanceof hr))throw new Ce(Y.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(n instanceof Vr&&this.pendingLocalTracks.some(i=>i instanceof Vr)&&(!On().webAudioMediaStreamDest||n._bypassWebAudio||this.pendingLocalTracks.some(i=>i instanceof Vr&&i._bypassWebAudio)))throw new Ce(Y.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,n){var i;const o=!Z("DISABLE_DUAL_STREAM_USE_ENCODING")&&On().supportDualStreamEncoding,c=Qd(Qd({},{width:160,height:120,framerate:15,bitrate:50}),n);let u;u=o?e._mediaStreamTrack.clone():px(e,c);const h=rr(8,"track-low-"),m=new hr(u,Qd(Qd({},o&&{scaleResolutionDownBy:XL(c,e)}),{},{frameRate:c.framerate,bitrateMax:c.bitrate,bitrateMin:c.bitrate}),void 0,void 0,h);return m.on(t_.TRANSCEIVER_UPDATED,_=>{e._updateRtpTransceiver(_,ev.LOW_STREAM)}),m._hints.push(ir.LOW_STREAM),Xe(i=e._hints).call(i,ir.SCREEN_TRACK)&&m._hints.push(ir.SCREEN_LOW_TRACK),e.on("sei-to-send",_=>{m.emit("sei-to-send",_)}),e.addListener(ut.NEED_CLOSE,()=>{m.close()}),m}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(e,n,i){let o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof Xd){var c,u,h,m;const _=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:y,dtlsTransportState:S,peerConnectionState:w}=this.connection,{local:I,remote:P}=await this.connection.getSelectedCandidatePair();yt.pcStats(this.store.sessionId,{startTime:_,eventElapse:e-_||0,iceconnectionsate:y,dtlsstate:S,connectionstate:w,intSucc:n?1:2,error:this._iceError||o||"",selectedLocalCandidateProtocol:(c=I==null?void 0:I.protocol)!==null&&c!==void 0?c:"",selectedLocalCandidateType:(u=I.candidateType)!==null&&u!==void 0?u:"",selectedLocalCandidateAddress:"".concat(I.address,":").concat(I.port),selectedRemoteCandidateProtocol:(h=P.protocol)!==null&&h!==void 0?h:"",selectedRemoteCandidateType:(m=P.candidateType)!==null&&m!==void 0?m:"",selectedRemoteCandidateAddress:"".concat(P.address,":").concat(P.port),restartCnt:i,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameDecoded(e,n,i,o){var c;const u=Array.from(yc(c=this.remoteUserMap).call(c)).find(h=>h._videoSSRC===e);if(u){o||this.store.subscribe(u.uid,"video",void 0,void 0,void 0,void 0,Date.now());const h=this.store.keyMetrics,m=h.subscribe.find(_=>_.userId===u.uid&&_.type==="video");yt.firstRemoteVideoDecode(this.store.sessionId,Oi.FIRST_VIDEO_DECODE,vr.FIRST_VIDEO_DECODE,{peer:u._uintid,videowidth:n,videoheight:i,subscribeElapse:Ss.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:h.requestAPEnd||0,apStart:h.requestAPStart||0,joinGwEnd:h.joinGatewayEnd||0,joinGwStart:h.joinGatewayStart||0,pcEnd:h.peerConnectionEnd||0,pcStart:h.peerConnectionStart||0,subscriberEnd:(m==null?void 0:m.subscribeEnd)||0,subscriberStart:(m==null?void 0:m.subscribeStart)||0,videoAddNotify:(m==null?void 0:m.streamAdded)||0,state:o?1:0,firstFrame:(m==null?void 0:m.firstFrame)||0})}}async remoteMediaSsrcChanged(e,n,i){if(!this.connection)return!1;const o=this.remoteUserMap.get(e);if(!o)return!1;const c=o.get(n);if(!c)return!1;const u=await this.connection.getRemoteSSRC(c);return u!==void 0&&u!==i}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[n,{track:i}]=e;n===Ve.LocalVideoLowTrack?i._updateRtpTransceiver(void 0,ev.LOW_STREAM):i._updateRtpTransceiver(void 0)})}},ht(sn.prototype,"startP2PConnection",[Ks],Object.getOwnPropertyDescriptor(sn.prototype,"startP2PConnection"),sn.prototype),ht(sn.prototype,"connect",[Ks],Object.getOwnPropertyDescriptor(sn.prototype,"connect"),sn.prototype),ht(sn.prototype,"updateRemoteRTPCapabilities",[Ks],Object.getOwnPropertyDescriptor(sn.prototype,"updateRemoteRTPCapabilities"),sn.prototype),ht(sn.prototype,"publishDataChannel",[Ks],Object.getOwnPropertyDescriptor(sn.prototype,"publishDataChannel"),sn.prototype),ht(sn.prototype,"unpublish",[Ks],Object.getOwnPropertyDescriptor(sn.prototype,"unpublish"),sn.prototype),ht(sn.prototype,"unpublishDataChannel",[Ks],Object.getOwnPropertyDescriptor(sn.prototype,"unpublishDataChannel"),sn.prototype),ht(sn.prototype,"unpublishLowStream",[Ks],Object.getOwnPropertyDescriptor(sn.prototype,"unpublishLowStream"),sn.prototype),ht(sn.prototype,"subscribeDataChannel",[Ks],Object.getOwnPropertyDescriptor(sn.prototype,"subscribeDataChannel"),sn.prototype),ht(sn.prototype,"subscribe",[Ks],Object.getOwnPropertyDescriptor(sn.prototype,"subscribe"),sn.prototype),ht(sn.prototype,"massSubscribe",[Ks],Object.getOwnPropertyDescriptor(sn.prototype,"massSubscribe"),sn.prototype),ht(sn.prototype,"unsubscribe",[Ks],Object.getOwnPropertyDescriptor(sn.prototype,"unsubscribe"),sn.prototype),ht(sn.prototype,"unsubscribeDataChannel",[Ks],Object.getOwnPropertyDescriptor(sn.prototype,"unsubscribeDataChannel"),sn.prototype),ht(sn.prototype,"massUnsubscribe",[Ks],Object.getOwnPropertyDescriptor(sn.prototype,"massUnsubscribe"),sn.prototype),ht(sn.prototype,"muteRemote",[Ks],Object.getOwnPropertyDescriptor(sn.prototype,"muteRemote"),sn.prototype),ht(sn.prototype,"unmuteRemote",[Ks],Object.getOwnPropertyDescriptor(sn.prototype,"unmuteRemote"),sn.prototype),ht(sn.prototype,"hasRemoteMediaWithLock",[Ks],Object.getOwnPropertyDescriptor(sn.prototype,"hasRemoteMediaWithLock"),sn.prototype),ht(sn.prototype,"disconnectForReconnect",[Ks],Object.getOwnPropertyDescriptor(sn.prototype,"disconnectForReconnect"),sn.prototype),ht(sn.prototype,"updateBitrateLimit",[Ks],Object.getOwnPropertyDescriptor(sn.prototype,"updateBitrateLimit"),sn.prototype),ht(sn.prototype,"remoteMediaSsrcChanged",[Ks],Object.getOwnPropertyDescriptor(sn.prototype,"remoteMediaSsrcChanged"),sn.prototype),sn);function Ks(e,n,i){const o=e[n];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const c=this.mutex,u=await c.lock("From P2PChannel.".concat(n));try{for(var h=arguments.length,m=new Array(h),_=0;_<h;_++)m[_]=arguments[_];return await o.apply(this,m)}finally{u()}},i}function JH(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function QH(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?JH(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):JH(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}const gpe=Date.now(),_pe=20,gx=new Map,$A=new Map;async function ZH(e){const n=gx.get(e),i=Array.isArray(n)&&n[n.length-1],o=$A.get(e);if(!i)return void(o.isSyncing=!1);const c={uid:i.uid,payload:i.payload};o.firstRecvTs===0&&(o.firstRecvTs=i.recvTs,o.firstSendTs=i.sendTs);const u=i.sendTs-o.firstSendTs,h=u-(Date.now()-o.firstRecvTs);h>0&&(o.firstRecvTs=Date.now()-u);let m=i.mediaDelay+h;m<=0?(n.pop(),e8(i.context,c),m=0):m=Math.min(m,_pe),setTimeout(()=>n.length&&ZH(e),m)}function e8(e,n){e.safeEmit(an.STREAM_MESSAGE,n.uid,n.payload),e.onStreamMessage&&e.onStreamMessage(n)}function Epe(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0;if(!e.syncWithAudio)return e8(i,{uid:e.uid,payload:e.payload});const o="".concat(i.id,"-").concat(e.uid),c=gx.get(o)||[],u=c.findIndex(y=>e.sendTs>=y.sendTs),h=QH(QH({},e),{},{context:i,mediaDelay:n,recvTs:Date.now()});u===-1?c.push(h):c.splice(u,0,h),gx.set(o,c);let m=!1;var _;$A.has(o)?m=!((_=$A.get(o))===null||_===void 0||!_.isSyncing):$A.set(o,{isSyncing:m,firstRecvTs:0,firstSendTs:0}),m||ZH(o)}const ype=Tn().name;function t8(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function n8(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?t8(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):t8(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}const Tv="websdk_ng_cache_parameter",vpe=Z("MAX_PRELOAD_ASYNC_LENGTH"),Spe=1e4,p_=new Map,m_=[];let _x=null,Ex=0,yx=0;const YA=new Map,Tpe=function(e,n){const i=[];let o=0;const c=async()=>{const u=i.shift();u&&await u(),i.length>0&&o<n?c():o--};return async function(){for(var u=arguments.length,h=new Array(u),m=0;m<u;m++)h[m]=arguments[m];return new tt(async(_,y)=>{i.push(async()=>{try{const S=await e(...h);_(S)}catch(S){y(S)}}),o<n&&(o++,c())})}}(r8,vpe),vx=Mo.CancelToken.source();async function r8(e,n,i,o,c,u){try{if(!Z("ENABLE_PRELOAD"))return;if(!On().supportWebCrypto)return void Jp(()=>{k.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!i&&i!==null)throw new Ce(Y.INVALID_PARAMS,"Invalid token: ".concat(i,". If you don not use token, set it to null"));i&&qi(i,"token",1,2047),qi(e,"appid",1,2047),RA(n),o&&CA(o);const h=Zg();k.debug("preload channel ".concat(n,", uid is ").concat(o));const m={appId:e,cname:n,token:i||e,uid:typeof o!="string"?o:null,sid:h,proxyServer:c};let _,y;typeof o=="string"?(m.stringUid=o,[y,_]=await tt.all([ipe(o,{sid:h,appId:e},vx.token),RH(n8(n8({},m),{},{token:i||e,uid:0}),vx.token)]),m.uid=y.uid,_.gatewayInfo.uid=m.uid,_.gatewayInfo.res.uid=m.uid):(u&&(m.stringUid=u),_=await RH(m,vx.token));const S={sid:h,appId:e,cname:n,token:i||e,uid:m.stringUid||o,intUid:m.uid||_.gatewayInfo.uid,stringUid:m.stringUid,ts:Date.now(),sua:y,ap:_};await async function(w){let I;try{w.uid&&s8({appId:w.appId,cname:w.cname,token:w.token,uid:w.uid,stringUid:w.stringUid});const P=l8(w),B=await async function(U,q){try{const $=await window.crypto.subtle.importKey("raw",Y6(q),"AES-GCM",!1,["encrypt"]),ae=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},$,Qg(window.btoa(JSON.stringify(U))));return Qp(new Uint8Array(ae))}catch{return}}(w,w.token||w.appId);if(!B)return;I=c8(Tv);const M=I?JSON.parse(I):[];M.push({[P]:B}),M.length>Z("AP_CACHE_NUM")&&M.shift(),XA(Tv,JSON.stringify(M))}catch(P){k.warn("Error caching server parameters:",P.message),XA(Tv,"")}}(S),Ex++}catch(h){throw yx++,function(m){_x||(_x=window.setTimeout(()=>{let y="";YA.forEach((S,w)=>{y+="".concat(w,": ").concat(S," ;")}),yt.reportApiInvoke(null,{name:fi.PRELOAD,options:{success:Ex,failed:yx,err:y}}).onError(m),Ex=0,yx=0,YA.clear(),_x=null},Spe));const _=YA.get(m.code)||0;YA.set(m.code,_+1)}(h),h}}async function i8(e){try{if(Z("AP_REQUEST_DETAIL")||Z("ENABLE_ROLE_SELECT_EDGE"))return;const n=s8(e);if(!n||e.cloudProxyServer!=="disabled")return;const i=await async function(o,c){try{const u=await window.crypto.subtle.importKey("raw",Y6(c),"AES-GCM",!1,["decrypt"]),h=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},u,Qg(o));return JSON.parse(window.atob(Qp(new Uint8Array(h))))}catch{return}}(n,e.token||e.appId);if(!i||!function(o,c){return o.cname===c.cname&&o.appId===c.appId&&o.token===c.token?c.stringUid?o.stringUid===c.stringUid:typeof c.uid=="number"?o.uid===c.uid:o.uid==c.uid:!1}(i,e))return;if(i&&Date.now()-i.ts<Z("AP_CACHE_LIFETIME"))return i}catch(n){k.warn("Error get preloadInfo",n.message)}}function s8(e){let n;try{if(n=c8(Tv),!n)return;const i=JSON.parse(n),o=l8(e),c=function(h,m){for(let _=h.length-1;_>=0;_--)if(m(h[_]))return _;return-1}(i,h=>o in h);if(c===-1)return;const u=i.splice(c,1)[0];return XA(Tv,JSON.stringify(i)),u[o]}catch(i){k.warn("Error delete preload info: ".concat(n),i.message),XA(Tv,"")}}function Sx(e){if(e){let n=p_.get(e);n&&(window.clearTimeout(n),n=null,p_.delete(e)),Xe(m_).call(m_,e)||e.cloudProxyServer!=="disabled"||m_.push(e)}if(p_.size<Z("AP_CACHE_NUM")&&m_.length>0){const n=m_.shift();p_.set(n,window.setTimeout(async()=>{const{appId:i,cname:o,token:c,stringUid:u,uid:h,proxyServer:m}=n;try{await Tpe(i,o,c,h,m,u),p_.has(n)&&Sx(n)}catch(_){k.warn("update preload failed",_.message),o8(n)}},Z("AP_UPDATE_INTERVAL")))}}function o8(e){const n=m_.indexOf(e);n!==-1&&m_.splice(n,1);let i=p_.get(e);i&&(window.clearTimeout(i),i=null,p_.delete(e),Sx())}function a8(e,n){const i=e.sua,o=e.ap;n&&i&&yt.reqUserAccount(e.sid,{lts:i.requestTime,elapse:i.elapse,success:!0,serverAddr:i.url,stringUid:n,uid:e.intUid,errorCode:null,extend:i.req}),yt.reportResourceTiming(e.ap.url,e.sid),yt.joinWebProxyAP(e.sid,{lts:o.requestTime,elapse:o.elapse,sucess:1,apServerAddr:o.url,turnServerAddrList:o.proxyInfo.addresses.map(c=>c.ip).join(","),eventType:"disabled",unilbsServerIds:[ii.CHOOSE_SERVER,ii.CLOUD_PROXY_FALLBACK].toString()}),yt.joinChooseServer(e.sid,{lts:o.requestTime,elapse:o.elapse,succ:!0,csAddr:o.url,opid:o.opid,serverList:o.gatewayInfo.gatewayAddrs.map(c=>c.address),ec:null,cid:o.gatewayInfo.cid.toString(),uid:o.gatewayInfo.uid.toString(),csIp:o.gatewayInfo.csIp,unilbsServerIds:[ii.CHOOSE_SERVER].toString(),isHttp3:o.isHttp3})}function c8(e){return window.atob(window.localStorage.getItem(e)||"")}function XA(e,n){window.localStorage.setItem(e,window.btoa(n))}function l8(e){let n="".concat(e.appId,"_").concat(e.cname);return typeof e.uid=="string"&&(n+="_s_".concat(e.uid)),typeof e.uid=="number"&&(n+="_".concat(e.uid)),e.token&&(n+="_".concat(e.token)),nW(n)}function bpe(e){let n=function(){const i=Cpe.pop();return i?(i.offset=i.limit=0,i):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(i,o){let c=i.appId;c!==void 0&&(ai(o,10),cm(o,c));let u=i.cid;u!==void 0&&(ai(o,16),ai(o,u));let h=i.cname;h!==void 0&&(ai(o,26),cm(o,h));let m=i.deviceId;m!==void 0&&(ai(o,34),cm(o,m));let _=i.elapse;_!==void 0&&(ai(o,40),lm(o,_));let y=i.fileSize;y!==void 0&&(ai(o,48),lm(o,bv(y)));let S=i.height;S!==void 0&&(ai(o,56),lm(o,bv(S)));let w=i.jpg;w!==void 0&&(ai(o,66),ai(o,w.length),d8(o,w));let I=i.networkType;I!==void 0&&(ai(o,72),lm(o,bv(I)));let P=i.osType;P!==void 0&&(ai(o,80),lm(o,bv(P)));let B=i.requestId;B!==void 0&&(ai(o,90),cm(o,B));let M=i.sdkVersion;M!==void 0&&(ai(o,98),cm(o,M));let U=i.sequence;U!==void 0&&(ai(o,104),lm(o,bv(U)));let q=i.sid;q!==void 0&&(ai(o,114),cm(o,q));let $=i.timestamp;$!==void 0&&(ai(o,120),lm(o,$));let ae=i.uid;ae!==void 0&&(ai(o,128),ai(o,ae));let me=i.vid;me!==void 0&&(ai(o,136),ai(o,me));let ge=i.width;ge!==void 0&&(ai(o,144),lm(o,bv(ge)));let pe=i.service;pe!==void 0&&(ai(o,152),ai(o,pe));let we=i.callbackData;we!==void 0&&(ai(o,162),ai(o,we.length),d8(o,we));let Be=i.ticket;Be!==void 0&&(ai(o,170),cm(o,Be));let nt=i.vendorConfigs;nt!==void 0&&(ai(o,178),cm(o,nt))}(e,n),function(i){let o=i.bytes,c=i.limit;return o.length===c?o:o.subarray(0,c)}(n)}function wpe(e){return function(i){let o={};e:for(;!Ipe(i);){let c=eb(i);switch(c>>>3){case 0:break e;case 1:o.code=eb(i);break;case 2:o.msg=h8(i,eb(i));break;case 3:o.requestId=h8(i,eb(i));break;case 4:o.timestamp=Ape(i,!1);break;default:Rpe(i,7&c)}}return o}({bytes:n=e,offset:0,limit:n.length});var n}function Rpe(e,n){switch(n){case 0:for(;128&Xl(e););break;case 2:Tx(e,eb(e));break;case 5:Tx(e,4);break;case 1:Tx(e,8);break;default:throw new Error("Unimplemented type: "+n)}}function bv(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let Cpe=[];function Tx(e,n){if(e.offset+n>e.limit)throw new Error("Skip past limit");e.offset+=n}function Ipe(e){return e.offset>=e.limit}function JA(e,n){let i=e.bytes,o=e.offset,c=e.limit,u=o+n;if(u>i.length){let h=new Uint8Array(2*u);h.set(i),e.bytes=h}return e.offset=u,u>c&&(e.limit=u),o}function u8(e,n){let i=e.offset;if(i+n>e.limit)throw new Error("Read past limit");return e.offset+=n,i}function d8(e,n){let i=JA(e,n.length);e.bytes.set(n,i)}function h8(e,n){let i=u8(e,n),o=String.fromCharCode,c=e.bytes,u="",h="";for(let m=0;m<n;m++){let _,y,S,w,I=c[m+i];(128&I)==0?h+=o(I):(224&I)==192?m+1>=n?h+=u:(_=c[m+i+1],(192&_)!=128?h+=u:(w=(31&I)<<6|63&_,w<128?h+=u:(h+=o(w),m++))):(240&I)==224?m+2>=n?h+=u:(_=c[m+i+1],y=c[m+i+2],(49344&(_|y<<8))!=32896?h+=u:(w=(15&I)<<12|(63&_)<<6|63&y,w<2048||w>=55296&&w<=57343?h+=u:(h+=o(w),m+=2))):(248&I)==240?m+3>=n?h+=u:(_=c[m+i+1],y=c[m+i+2],S=c[m+i+3],(12632256&(_|y<<8|S<<16))!=8421504?h+=u:(w=(7&I)<<18|(63&_)<<12|(63&y)<<6|63&S,w<65536||w>1114111?h+=u:(w-=65536,h+=o(55296+(w>>10),56320+(1023&w)),m+=3))):h+=u}return h}function cm(e,n){let i=n.length,o=0;for(let h=0;h<i;h++){let m=n.charCodeAt(h);m>=55296&&m<=56319&&h+1<i&&(m=(m<<10)+n.charCodeAt(++h)-56613888),o+=m<128?1:m<2048?2:m<65536?3:4}ai(e,o);let c=JA(e,o),u=e.bytes;for(let h=0;h<i;h++){let m=n.charCodeAt(h);m>=55296&&m<=56319&&h+1<i&&(m=(m<<10)+n.charCodeAt(++h)-56613888),m<128?u[c++]=m:(m<2048?u[c++]=m>>6&31|192:(m<65536?u[c++]=m>>12&15|224:(u[c++]=m>>18&7|240,u[c++]=m>>12&63|128),u[c++]=m>>6&63|128),u[c++]=63&m|128)}}function Xl(e){return e.bytes[u8(e,1)]}function f8(e,n){let i=JA(e,1);e.bytes[i]=n}function eb(e){let n,i=0,o=0;do n=Xl(e),i<32&&(o|=(127&n)<<i),i+=7;while(128&n);return o}function ai(e,n){for(n>>>=0;n>=128;)f8(e,127&n|128),n>>>=7;f8(e,n)}function Ape(e,n){let i,o=0,c=0,u=0;return i=Xl(e),o=127&i,128&i&&(i=Xl(e),o|=(127&i)<<7,128&i&&(i=Xl(e),o|=(127&i)<<14,128&i&&(i=Xl(e),o|=(127&i)<<21,128&i&&(i=Xl(e),c=127&i,128&i&&(i=Xl(e),c|=(127&i)<<7,128&i&&(i=Xl(e),c|=(127&i)<<14,128&i&&(i=Xl(e),c|=(127&i)<<21,128&i&&(i=Xl(e),u=127&i,128&i&&(i=Xl(e),u|=(127&i)<<7))))))))),{low:o|c<<28,high:c>>>4|u<<24,unsigned:n}}function lm(e,n){let i=n.low>>>0,o=(n.low>>>28|n.high<<4)>>>0,c=n.high>>>24,u=c===0?o===0?i<16384?i<128?1:2:i<1<<21?3:4:o<16384?o<128?5:6:o<1<<21?7:8:c<128?9:10,h=JA(e,u),m=e.bytes;switch(u){case 10:m[h+9]=c>>>7&1;case 9:m[h+8]=u!==9?128|c:127&c;case 8:m[h+7]=u!==8?o>>>21|128:o>>>21&127;case 7:m[h+6]=u!==7?o>>>14|128:o>>>14&127;case 6:m[h+5]=u!==6?o>>>7|128:o>>>7&127;case 5:m[h+4]=u!==5?128|o:127&o;case 4:m[h+3]=u!==4?i>>>21|128:i>>>21&127;case 3:m[h+2]=u!==3?i>>>14|128:i>>>14&127;case 2:m[h+1]=u!==2?i>>>7|128:i>>>7&127;case 1:m[h]=u!==1?128|i:127&i}}const p8={},m8={},QA=4294967296,Ope=QA*QA,Ppe=Ope/2;_8(0,!0);const g8=_8(0),Npe=tb(0,-2147483648,!1),kpe=tb(-1,2147483647,!1);function _8(e,n){let i,o,c;return n?(c=0<=(e>>>=0)&&e<256)&&(o=m8[e],o)?o:(i=tb(e,0,!0),c&&(m8[e]=i),i):(c=-128<=(e|=0)&&e<128)&&(o=p8[e],o)?o:(i=tb(e,e<0?-1:0,!1),c&&(p8[e]=i),i)}function tb(e,n,i){return{low:0|e,high:0|n,unsigned:!!i}}function E8(e,n){if(isNaN(e))return g8;{if(e<=-9223372036854776e3)return Npe;if(e+1>=Ppe)return kpe}return e<0?g8:tb(e%QA|0,e/QA|0,n)}function y8(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}class bx extends Rr{get connectionState(){return this._connectionState}set connectionState(n){if(this._connectionState===n)return;const i=this._connectionState;this._connectionState=n,this.emit(Ju.CONNECTION_STATE_CHANGE,n,i)}get quality(){return this._quality}set quality(n){this._quality=n>1?1:n<.1?.1:n,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(n){var i;super(),K(this,"name","AgoraRTCImageModeration"),K(this,"_connectionState",il.CONNECTING),K(this,"_sequence",0),K(this,"_moderationStartTime",void 0),K(this,"_workerConnection",void 0),K(this,"_workerMessageLengthLimit",void 0),K(this,"_qualityRatio",void 0),K(this,"_connectInfo",void 0),K(this,"_cancelTokenSource",Mo.CancelToken.source()),K(this,"_retryConfig",void 0),K(this,"_moderationInterval",void 0),K(this,"_moderationTimer",null),K(this,"_moderationMode",1),K(this,"_quality",1),K(this,"_qualityTimer",null),K(this,"_ticket",void 0),K(this,"_moderationIntervalMinimum",void 0),K(this,"_uploadFailedNum",0),K(this,"_uploadNum",0),K(this,"_uploadTimer",null),K(this,"_extraInfo",void 0),K(this,"_vendor",""),K(this,"_encoder",new TextEncoder),K(this,"_moderationId",void 0),K(this,"inspectImage",()=>{if(this.connectionState!==il.CONNECTED)throw new be(Y.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===il.CONNECTED?this.requestToInspectImage():k.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=rr(5,"image-moderation-"),this._workerMessageLengthLimit=Z("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=Z("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(i=n.interval)!==null&&i!==void 0?i:1e3,n.extraInfo&&(this._extraInfo=this._encoder.encode(n.extraInfo)),n.vendor&&(this._vendor=n.vendor),this._qualityRatio=Z("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new z0("worker-"+this._moderationId,pi),this.on(Ju.STATE_CHANGE,(o,c)=>{k.debug("[".concat(this._moderationId,"] Moderation operation :").concat(hv[o]," ").concat(c||""))}),this.handleWorkerEvents()}async init(n,i){this.emit(Ju.STATE_CHANGE,hv.CONNECT_AP),this._connectInfo=n;const o=this._cancelTokenSource.token;return this._retryConfig=i,new tt((c,u)=>{this.on(Ju.CONNECTION_STATE_CHANGE,(h,m)=>{h===il.CONNECTED&&c()}),this.requestAP(n,o,i).then(h=>{this.connectWorker(h)}).catch(h=>{u(h)})})}updateConfig(n){var i;this._moderationInterval=(i=n.interval)!==null&&i!==void 0?i:1e3,n.extraInfo&&(this._extraInfo=this._encoder.encode(n.extraInfo)),n.vendor&&(this._vendor=n.vendor),k.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(n))),this.connectionState===il.CONNECTED&&this.inspectImage()}async requestAP(n,i,o){const c=Z("WEBCS_DOMAIN").map(_=>"https://".concat(_,"/api/v1")),u=await function(_,y,S,w){let{appId:I,areaCode:P,cname:B,sid:M,token:U,uid:q}=y;Ev++;const $="moderation_plugin",ae={service_name:$,json_body:JSON.stringify({appId:I,areaCode:P,cname:B,command:"allocateEdge",requestId:Ev,seq:Ev,sid:M,appToken:U,ts:Date.now(),uid:q+""})};let me,ge,pe=_[0];return qu(async()=>{me=Date.now();const we=await Qu(pe,{data:ae,cancelToken:S,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(ge=Date.now()-me,we.code!==0){const st=new be(Y.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+we.code,{retry:!0,responseTime:ge});throw k.error(st.toString()),st}const Be=JSON.parse(we.json_body);if(Be.code!==200){const st=new be(Y.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(Be.code,", reason: ").concat(Be.reason),{code:Be.code,responseTime:ge});throw k.error(st.toString()),st}if(!Be.servers||!Array.isArray(Be.servers)||Be.servers.length===0){const st=new be(Y.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:Be.code,responseTime:ge});throw k.error(st.toString()),st}if(!Be.servers.some(st=>!!st.wss)){const st=new be(Y.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:Be.code,responseTime:ge});throw k.error(st.toString()),st}const nt=Z("IMAGE_MODERATION_WORKER_HOST");return{addressList:Be.servers.map(st=>{let{address:pn,wss:mn}=st;if(pn&&mn)return"wss://".concat(pn.replace(/\./g,"-"),".").concat(nt,":").concat(mn,"/moderation")}).filter(st=>!!st),workerToken:Be.workerToken,vid:Be.vid,ticket:Be.appTicket,responseTime:ge}},(we,Be)=>(yt.apworkerEvent(M,{success:!0,sc:200,serviceName:$,responseDetail:JSON.stringify(we.addressList),firstSuccess:Be===0,responseTime:ge,serverIp:_[Be%_.length]}),!1),(we,Be)=>(yt.apworkerEvent(M,{success:!1,sc:we.data&&we.data.code||200,serviceName:$,responseTime:ge,serverIp:_[Be%_.length]}),!!(we.code!==Y.OPERATION_ABORTED&&we.code!==Y.UNEXPECTED_RESPONSE||we.data&&we.data.retry)&&(pe=_[(Be+1)%_.length],!0)),w)}(c,n,i,o);this.emit(Ju.STATE_CHANGE,hv.AP_CONNECTED);const{addressList:h,ticket:m}=u;return this._ticket=m,h}async connectWorker(n){this.emit(Ju.STATE_CHANGE,hv.CONNECT_WORKER),await this._workerConnection.init(n,1e4)}handleWorkerEvents(){this._workerConnection.on(Wt.CONNECTED,async()=>{this.emit(Ju.STATE_CHANGE,hv.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=il.CONNECTED}),this._workerConnection.on(Wt.CLOSED,()=>{this.connectionState=il.CLOSED}),this._workerConnection.on(Wt.FAILED,()=>{this.connectionState=il.CLOSED}),this._workerConnection.on(Wt.RECONNECTING,()=>{this.connectionState=this.connectionState===il.CONNECTED?il.RECONNECTING:il.CONNECTING}),this._workerConnection.on(Wt.ON_MESSAGE,async n=>{if(n.data instanceof ArrayBuffer){const i=wpe(new Uint8Array(n.data));Z("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&k.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(i)),this._uploadNum++,i.code===void 0||i.code===0||(this._uploadFailedNum++,k.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(i.code,", msg is ").concat(i.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{yt.reportApiInvoke(this._connectInfo.sid||null,{name:fi.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,i.code],tag:kr.TRACER}).onError(new be(Y.IMAGE_MODERATION_UPLOAD_FAILED,i.msg)),this._uploadTimer=null},Z("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else k.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(Wt.WILL_RECONNECT,(n,i,o)=>{n==="recover"&&o(n),o("tryNext")}),this._workerConnection.on(Wt.REQUEST_NEW_URLS,(n,i)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(n).catch(i)})}static intToLong(n){return{low:n|=0,high:n>>31,unsigned:n>=0}}async requestToInspectImage(){const n=_c(this,Ju.CLIENT_LOCAL_VIDEO_TRACK),i={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(n){if(!n.isPlaying)return void(Z("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&k.debug("Only the track being played can be inspected"));this._sequence++;const o=await this.generateRequestData(n,i);this._workerConnection.sendMessage(o,!0,!0)}else Z("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&k.debug("Only the track being published can be inspected")}async generateRequestData(n,i){let{appId:o,cname:c,cid:u,vid:h,sid:m,uid:_}=i;const y=Date.now(),S=await n.getCurrentFrameImage("image/jpeg",this.quality),w=await HW(S,o,c),I=this._sequence+"-"+u+"-"+_+"-"+y+"-"+rr(12,""),P={appId:o,cid:u,cname:c,deviceId:"",elapse:bx.intToLong(Number(y-this._moderationStartTime)),fileSize:S.buffer.byteLength,height:S.height,width:S.width,jpg:w,networkType:6,osType:7,requestId:I,sdkVersion:"4.23.2",sequence:this._sequence,sid:m,timestamp:E8(y),uid:_,vid:h,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete P.callbackData;const B=bpe(P);if(B.byteLength<this._workerMessageLengthLimit){if(Z("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const M=function(U){for(var q=1;q<arguments.length;q++){var $=arguments[q]!=null?arguments[q]:{};q%2?y8(Object($),!0).forEach(function(ae){K(U,ae,$[ae])}):Object.getOwnPropertyDescriptors?Object.defineProperties(U,Object.getOwnPropertyDescriptors($)):y8(Object($)).forEach(function(ae){Object.defineProperty(U,ae,Object.getOwnPropertyDescriptor($,ae))})}return U}({},P);delete M.jpg,k.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(M))}return B}{const M=this.quality*this._qualityRatio;return this.quality=M,await this.generateRequestData(n,{appId:o,cname:c,cid:u,vid:h,sid:m,uid:_})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Mo.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=il.CLOSED,this.emit(Ju.STATE_CHANGE,hv.CLOSED)}}function v8(e){if(Jn(e.interval,"interval",1e3,1/0),e&&e.extraInfo&&e.extraInfo.length>1024)throw new be(Y.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(e&&e.vendor&&e.vendor.length>1024)throw new be(Y.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const Dpe={name:"ImageModeration",create:function(e){let{config:n}=e;return v8(n),new bx(n)}};var S8,T8,b8,w8,R8,C8,I8,A8,O8,P8,N8,k8,D8,L8,x8,M8,U8,V8,F8,j8,B8,W8,G8,z8,H8,K8,q8,$8,Y8,X8,J8,Q8,Z8,e9,t9,n9,r9,i9,s9,o9,a9,rt;function c9(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function Jl(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?c9(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):c9(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}Es.setLogger(k);let Lpe=(S8=At(),T8=At({argsMap:(e,n)=>{if(!Array.isArray(n)){if(!(n instanceof iv))return[n];n=[n]}return n.map(i=>i?Object(i).toString():"null")}}),b8=At({argsMap:(e,n)=>(n||(n=[]),Array.isArray(n)||n.trackMediaType!==rv.DATA?(Array.isArray(n)||(n=[n]),n.map(i=>i.getTrackId())):[n.getChannelId()])}),w8=At({argsMap:(e,n,i,o)=>[typeof n=="object"?n.uid:n,i,o]}),R8=At({argsMap:(e,n,i)=>[n,i]}),C8=At({argsMap:(e,n)=>n.map(i=>{let{user:o,mediaType:c}=i;return[o==null?void 0:o.uid,c]})}),I8=At({argsMap:(e,n,i,o)=>[typeof n=="object"?n.uid:n,i,o]}),A8=At({argsMap:(e,n)=>n.map(i=>{let{user:o,mediaType:c}=i;return{uid:o==null?void 0:o.uid,mediaType:c}})}),O8=At(),P8=At(),N8=At(),k8=At(),D8=At(),L8=At(),x8=At(),M8=At(),U8=At(),V8=At(),F8=At(),j8=At(),B8=At(),W8=At(),G8=At(),z8=At({argsMap:(e,n)=>[n]}),H8=At(),K8=At(),q8=At(),$8=At(),Y8=At(),X8=At(),J8=At(),Q8=At(),Z8=At({argsMap:(e,n)=>(Array.isArray(n)||(n=[n]),[JSON.stringify(n)])}),e9=At(),t9=At(),n9=At(),r9=At(),i9=At(),s9=At(),o9=At({reportResult:!0}),a9=At(),rt=class extends Rr{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var e;return((e=this._config)===null||e===void 0?void 0:e.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(e,n){let i;if(super(),K(this,"store",void 0),K(this,"_uid",void 0),K(this,"_channelName",void 0),K(this,"_uintUid",void 0),K(this,"_users",[]),K(this,"_config",void 0),K(this,"_clientId",void 0),K(this,"_appId",void 0),K(this,"_sessionId",null),K(this,"_key",void 0),K(this,"_rtmConfig",{}),K(this,"_joinInfo",void 0),K(this,"_gateway",void 0),K(this,"_statsCollector",void 0),K(this,"_configDistribute",void 0),K(this,"_leaveMutex",void 0),K(this,"_publishMutex",void 0),K(this,"_renewTokenMutex",void 0),K(this,"_subscribeMutex",void 0),K(this,"_encryptionMode","none"),K(this,"_encryptionSecret",null),K(this,"_encryptionSalt",null),K(this,"_encryptDataStream",!1),K(this,"_encryptDataStreamKey",null),K(this,"_encryptDataStreamIv",null),K(this,"_proxyServer",void 0),K(this,"_turnServer",{servers:[],mode:"auto"}),K(this,"_cloudProxyServerMode","disabled"),K(this,"_isDualStreamEnabled",!1),K(this,"_defaultStreamFallbackType",void 0),K(this,"_lowStreamParameter",void 0),K(this,"_streamFallbackTypeCacheMap",new Map),K(this,"_remoteStreamTypeCacheMap",new Map),K(this,"_axiosCancelSource",Mo.CancelToken.source()),K(this,"_audioVolumeIndicationInterval",void 0),K(this,"_networkQualityInterval",void 0),K(this,"_userOfflineTimeout",void 0),K(this,"_streamRemovedTimeout",void 0),K(this,"_liveTranscodeStreamingClient",void 0),K(this,"_liveRawStreamingClient",void 0),K(this,"_channelMediaRelayClient",void 0),K(this,"_networkQualitySensitivity","normal"),K(this,"_p2pChannel",void 0),K(this,"_useLocalAccessPoint",!1),K(this,"_setLocalAPVersion",void 0),K(this,"_joinAndNotLeaveYet",!1),K(this,"_numberOfJoinCount",0),K(this,"_remoteDefaultVideoStreamType",void 0),K(this,"_inspect",void 0),K(this,"_moderation",void 0),K(this,"_license",void 0),K(this,"_pendingPublishedUsers",[]),K(this,"ntpAlignErrorCount",0),K(this,"remoteInboundOffset",0),K(this,"_peerConnectionState",void 0),K(this,"_handleLocalTrackEnable",(c,u,h)=>{this.publish(c,!1).then(u).catch(h)}),K(this,"_handleLocalTrackDisable",(c,u,h)=>{this.unpublish(c).then(u).catch(h)}),K(this,"_handleUserOnline",c=>{if(Z("BLOCK_LOCAL_CLIENT")&&a_(c.uid,this.channelName))return void k.debug("[".concat(c.uid,"] will be ignored in local"));this.isStringUID&&typeof c.uid!="string"&&k.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const u=this._users.find(h=>h.uid===c.uid);if(u)u._trust_in_room_=!0,u._is_pre_created&&(u._is_pre_created=!1,this.safeEmit(an.USER_JOINED,u));else{const h=new om(c.uid,c.uint_id||c.uid);this._users.push(h),k.debug("[".concat(this._clientId,"] user online"),c.uid),this.safeEmit(an.USER_JOINED,h)}}),K(this,"_handleUserOffline",c=>{if(Z("BLOCK_LOCAL_CLIENT")&&a_(c.uid,this.channelName))return;const u=this._users.find(h=>h.uid===c.uid);u&&(this._handleRemoveStream(c),this._handleRemoveDataChannels(c),u._audio_pre_subscribed||u._video_pre_subscribed?u._is_pre_created=!0:eA(this._users,u),this._remoteStreamTypeCacheMap.delete(u.uid),this._streamFallbackTypeCacheMap.delete(u.uid),k.debug("[".concat(this._clientId,"] user offline"),c.uid,"reason:",c.reason),this.safeEmit(an.USER_LEAVED,u,c.reason))}),K(this,"_handleAddAudioOrVideoStream",(c,u,h,m,_,y,S)=>{if(Z("BLOCK_LOCAL_CLIENT")&&a_(u,this.channelName))return;const w=this._users.find(P=>P.uid===u);if(!w)return void k.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));k.debug("[".concat(this._clientId,"] stream added with uid ").concat(u,", type ").concat(c)),this.store.subscribe(w.uid,c,void 0,void 0,void 0,Date.now());const I=c==="audio"?w.hasAudio:w.hasVideo;w._uintid||(w._uintid=_||u),c==="audio"?w._trust_audio_stream_added_state_=!0:w._trust_video_stream_added_state_=!0,c==="audio"?(w._audio_added_=!0,h!==void 0&&(w._audioSSRC=h),m!==void 0&&(w._cname=m),y&&(w._audioOrtc=y)):(w._video_added_=!0,h!==void 0&&(w._videoSSRC=h),m!==void 0&&(w._cname=m),S!==void 0&&(w._rtxSsrcId=S),y&&(w._videoOrtc=y)),(c==="audio"?w.hasAudio:w.hasVideo)&&!I&&(k.info("[".concat(this._clientId,"] remote user ").concat(w.uid," published ").concat(c)),this.safeEmit(an.USER_PUBLISHED,w,c)),c==="video"?yt.onGatewayStream(this._sessionId,Oi.ON_ADD_VIDEO_STREAM,vr.ON_ADD_VIDEO_STREAM,{peer:_||u,ssrc:w._videoSSRC}):yt.onGatewayStream(this._sessionId,Oi.ON_ADD_AUDIO_STREAM,vr.ON_ADD_AUDIO_STREAM,{peer:_||u,ssrc:w._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(w,c,h).then(P=>{if(P&&(k.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(w.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof Z0))return this._p2pChannel.unsubscribe(w,c,!0).then(()=>this._subscribe(w,c,!0).catch(B=>{k.error("[".concat(this._clientId,"] resubscribe error"),B.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(w,c)&&(k.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(w.uid," after reconnect.")),this._subscribe(w,c,!0).catch(P=>{k.error("[".concat(this._clientId,"] resubscribe error"),P.toString())}))}),K(this,"_handleRemoveStream",c=>{if(Z("BLOCK_LOCAL_CLIENT")&&a_(c.uid,this.channelName))return;const u=this._users.find(m=>m.uid===c.uid);if(!u)return void k.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));k.debug("[".concat(this._clientId,"] stream removed with uid ").concat(c.uid));let h=()=>{};u.hasAudio&&u.hasVideo?h=()=>{k.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished audio track")),this.safeEmit(an.USER_UNPUBLISHED,u,"audio"),k.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished video track")),this.safeEmit(an.USER_UNPUBLISHED,u,"video")}:u.hasVideo?h=()=>{k.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished video track")),this.safeEmit(an.USER_UNPUBLISHED,u,"video")}:u.hasAudio&&(h=()=>{k.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished audio track")),this.safeEmit(an.USER_UNPUBLISHED,u,"audio")}),u._video_pre_subscribed||u._audio_pre_subscribed||(u._trust_audio_stream_added_state_=!0,u._trust_video_stream_added_state_=!0,u._audio_added_=!1,u._video_added_=!1,this._p2pChannel instanceof Z0&&this._p2pChannel.unsubscribe(u).then(m=>{if(m)return this._gateway.unsubscribe(m,u.uid)}),u._audioSSRC=void 0,u._videoSSRC=void 0,u._audioOrtc=void 0,u._videoOrtc=void 0,u._rtxSsrcId=void 0),yt.onGatewayStream(this._sessionId,Oi.ON_REMOVE_STREAM,vr.ON_REMOVE_STREAM,{peer:c.uint_id||c.uid}),h()}),K(this,"_handleSetStreamLocalEnable",(c,u,h)=>{if(Z("BLOCK_LOCAL_CLIENT")&&a_(u,this.channelName))return;const m=this._users.find(S=>S.uid===u);if(!m)return void k.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));k.debug("[".concat(this._clientId,"] local ").concat(c," ").concat(h?"enabled":"disabled"," with uid ").concat(u));const _=c==="audio"?m.hasAudio:m.hasVideo;if(c==="audio"){m._trust_audio_enabled_state_=!0;const S=m._audio_enabled_;if(m._audio_enabled_=h,m._audio_enabled_===S)return;{const w=m._audio_enabled_?"enable-local-audio":"disable-local-audio";k.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(u,", msg: ").concat(w)),this.safeEmit(an.USER_INFO_UPDATED,u,w)}}else{m._trust_video_enabled_state_=!0;const S=m._video_enabled_;if(m._video_enabled_=h,m._video_enabled_===S)return;{const w=m._video_enabled_?"enable-local-video":"disable-local-video";k.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(u,", msg: ").concat(w)),this.safeEmit(an.USER_INFO_UPDATED,u,w)}}const y=c==="audio"?m.hasAudio:m.hasVideo;return _!==y?!_&&y?(k.info("[".concat(this._clientId,"] remote user ").concat(u," published ").concat(c)),void this.safeEmit(an.USER_PUBLISHED,m,c)):(c==="video"&&m._videoTrack&&m._videoTrack._destroy(),c==="audio"&&m._audioTrack,this._p2pChannel.muteRemote(m,c),k.info("[".concat(this._clientId,"] remote user ").concat(u," unpublished ").concat(c)),void this.safeEmit(an.USER_UNPUBLISHED,m,c)):void 0}),K(this,"_handleMuteStream",(c,u,h)=>{if(Z("BLOCK_LOCAL_CLIENT")&&a_(c,this.channelName))return;k.debug("[".concat(this._clientId,"] receive mute message"),c,u,h);const m=this._users.find(S=>S.uid===c);if(!m)return void k.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(c));const _=u==="audio"?m.hasAudio:m.hasVideo;if(u==="audio"){m._trust_audio_mute_state_=!0;const S=m._audio_muted_;if(m._audio_muted_=h,m._audio_muted_===S)return;{const w=m._audio_muted_?"mute-audio":"unmute-audio";k.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(w)),this.safeEmit(an.USER_INFO_UPDATED,c,w)}}else{m._trust_video_mute_state_=!0;const S=m._video_muted_;if(m._video_muted_=h,m._video_muted_===S)return;{const w=m._video_muted_?"mute-video":"unmute-video";k.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(w)),this.safeEmit(an.USER_INFO_UPDATED,c,w)}}const y=u==="audio"?m.hasAudio:m.hasVideo;if(_!==y){if(!_&&y)return(u==="audio"?m._audioSSRC:m._videoSSRC)?(k.info("[".concat(this._clientId,"] remote user ").concat(c," published ").concat(u)),void this.safeEmit(an.USER_PUBLISHED,m,u)):void k.warning("[".concat(this._clientId,"] remote user ").concat(c," receive ").concat(u," unmute message  before add stream message, ").concat(u," SSRC doesn't exist yet."));u==="video"&&m._videoTrack&&!m._video_pre_subscribed&&m._videoTrack._destroy(),u==="audio"&&m._audioTrack,this._p2pChannel.muteRemote(m,u),k.info("[".concat(this._clientId,"] remote user ").concat(c," unpublished ").concat(u)),this.safeEmit(an.USER_UNPUBLISHED,m,u)}}),K(this,"_handleP2PLost",async c=>{k.debug("[".concat(this._clientId,"] receive p2p lost"),c),parseInt(c.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():k.warning("[".concat(this._clientId,"] P2PLost stream not found"),c)}),K(this,"_handleTokenWillExpire",()=>{k.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(an.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),K(this,"_handleBeforeUnload",c=>{c.type==="beforeunload"&&c.returnValue!==void 0&&c.returnValue!==""||(this.leave(),k.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),K(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(an.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const c={downlinkNetworkQuality:0,uplinkNetworkQuality:0};c.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),c.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(an.NETWORK_QUALITY,c)}),K(this,"_handleP2PAddAudioOrVideoStream",(c,u,h,m)=>{const _=this._users.find(S=>S.uid===u);if(!_)return void k.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));k.debug("[".concat(this._clientId,"] stream added with uid ").concat(u,", type ").concat(c)),this.store.subscribe(_.uid,c,void 0,void 0,void 0,Date.now());const y=c==="audio"?_.hasAudio:_.hasVideo;c==="audio"?_._trust_audio_stream_added_state_=!0:_._trust_video_stream_added_state_=!0,c==="audio"?(_._audio_added_=!0,h!==void 0&&(_._audioSSRC=h),m!==void 0&&(_._audioMid=m)):(_._video_added_=!0,h!==void 0&&(_._videoSSRC=h),m!==void 0&&(_._videoMid=m)),(c==="audio"?_.hasAudio:_.hasVideo)&&!y&&(k.info("[".concat(this._clientId,"] remote user ").concat(_.uid," published ").concat(c)),this.safeEmit(an.USER_PUBLISHED,_,c)),this._p2pChannel.hasPendingRemoteMedia(_,c)&&(k.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(_.uid," after reconnect.")),this._subscribe(_,c,!0).catch(S=>{k.error("[".concat(this._clientId,"] resubscribe error"),S.toString())}))}),this._config=e,this._clientId=n||rr(5,"client-"),this.store=new class{constructor(c,u,h,m){Ut(this,"state",void 0),this.state={codec:c,audioCodec:u,mode:h,clientId:m,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:e_.Default,hasStartJoinChannel:!1,isABTestSuccess:!1}}dispatch(c){this.state=function(u,h){switch(h.type){case cn.SET_SESSION_ID:return ot(ot({},u),{},{sessionId:h.sessionId});case cn.SET_P2P_ID:return ot(ot({},u),{},{p2pId:h.p2pId});case cn.SET_UID:return ot(ot({},u),{},{uid:h.uid});case cn.SET_INT_UID:return ot(ot({},u),{},{intUid:h.intUid});case cn.SET_PUB_ID:return ot(ot({},u),{},{pubId:h.pubId});case cn.KEY_METRIC_CLIENT_CREATED:return ot(ot({},u),{},{keyMetrics:ot(ot({},u.keyMetrics),{},{clientCreated:h.metric})});case cn.KEY_METRIC_JOIN_START:return ot(ot({},u),{},{keyMetrics:ot(ot({},u.keyMetrics),{},{joinStart:h.metric})});case cn.AVOID_JOIN_START:return ot(ot({},u),{},{avoidJoinStart:h.avoidJoinStart});case cn.KEY_METRIC_JOIN_END:return ot(ot({},u),{},{keyMetrics:ot(ot({},u.keyMetrics),{},{joinEnd:h.metric})});case cn.KEY_METRIC_REQUEST_AP_START:return ot(ot({},u),{},{keyMetrics:ot(ot({},u.keyMetrics),{},{requestAPStart:h.metric})});case cn.KEY_METRIC_REQUEST_AP_END:return ot(ot({},u),{},{keyMetrics:ot(ot({},u.keyMetrics),{},{requestAPEnd:h.metric})});case cn.KEY_METRIC_JOIN_GATEWAY_START:return ot(ot({},u),{},{keyMetrics:ot(ot({},u.keyMetrics),{},{joinGatewayStart:h.metric})});case cn.KEY_METRIC_JOIN_GATEWAY_END:return ot(ot({},u),{},{keyMetrics:ot(ot({},u.keyMetrics),{},{joinGatewayEnd:h.metric})});case cn.KEY_METRIC_PEER_CONNECTION_START:return ot(ot({},u),{},{keyMetrics:ot(ot({},u.keyMetrics),{},{peerConnectionStart:h.metric})});case cn.KEY_METRIC_PEER_CONNECTION_END:return ot(ot({},u),{},{keyMetrics:ot(ot({},u.keyMetrics),{},{peerConnectionEnd:h.metric})});case cn.KEY_METRIC_DESCRIPTION_START:return ot(ot({},u),{},{keyMetrics:ot(ot({},u.keyMetrics),{},{descriptionStart:h.metric})});case cn.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return ot(ot({},u),{},{keyMetrics:ot(ot({},u.keyMetrics),{},{signalChannelOpen:h.metric})});case cn.KEY_METRIC_ICE_CONNECTION_END:return ot(ot({},u),{},{keyMetrics:ot(ot({},u.keyMetrics),{},{iceConnectionEnd:h.metric})});case cn.KEY_METRIC_PUBLISH:{const m=u.keyMetrics.publish,_=m.findIndex(y=>y.trackId===h.metric.trackId);return _!==-1?(m[_]=ot(ot({},m[_]),h.metric),ot(ot({},u),{},{keyMetrics:ot(ot({},u.keyMetrics),{},{publish:[...m]})})):ot(ot({},u),{},{keyMetrics:ot(ot({},u.keyMetrics),{},{publish:[...u.keyMetrics.publish,h.metric]})})}case cn.KEY_METRIC_SUBSCRIBE:{const m=u.keyMetrics.subscribe,_=m.findIndex(y=>y.userId===h.metric.userId&&y.type===h.metric.type);return _!==-1?(m[_]=ot(ot({},m[_]),h.metric),ot(ot({},u),{},{keyMetrics:ot(ot({},u.keyMetrics),{},{subscribe:[...m]})})):ot(ot({},u),{},{keyMetrics:ot(ot({},u.keyMetrics),{},{subscribe:[...u.keyMetrics.subscribe,h.metric]})})}case cn.SET_CLOUD_PROXY_SERVER_MODE:return u.cloudProxyServerMode=h.mode,u;case cn.RECORD_JOIN_CHANNEL_SERVICE:return typeof h.index!="number"?u.joinChannelServiceRecords=[...u.joinChannelServiceRecords,h.record]:(u.joinChannelServiceRecords[h.index]=ot(ot({},u.joinChannelServiceRecords[h.index]),h.record),u.joinChannelServiceRecords=[...u.joinChannelServiceRecords]),u;case cn.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return u.joinChannelServiceRecords=[],u;case cn.RESET_KEY_METRICS:return u.keyMetrics={publish:[],subscribe:[]},u;case cn.SET_USE_P2P:return ot(ot({},u),{},{useP2P:h.val});case cn.SET_TRANSPORT_TYPE:return ot(ot({},u),{},{p2pTransport:h.val});default:return u}}(this.state,c)}set sessionId(c){this.dispatch({type:cn.SET_SESSION_ID,sessionId:c})}get sessionId(){return this.state.sessionId}set cid(c){this.state.cid=c}get cid(){return this.state.cid}set codec(c){this.state.codec=c}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(c){this.dispatch({type:cn.SET_P2P_ID,p2pId:c})}get p2pId(){return this.state.p2pId}set dcId(c){this.dispatch({type:cn.SET_DC_ID,dcId:c})}get dcId(){return this.state.dcId}set uid(c){this.dispatch({type:cn.SET_UID,uid:c})}get uid(){return this.state.uid}set intUid(c){this.dispatch({type:cn.SET_INT_UID,intUid:c})}get intUid(){return this.state.intUid}set pubId(c){this.dispatch({type:cn.SET_PUB_ID,pubId:c})}get pubId(){return this.state.pubId}set cloudProxyServerMode(c){this.dispatch({type:cn.SET_CLOUD_PROXY_SERVER_MODE,mode:c})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(c){this.dispatch({type:cn.SET_USE_P2P,val:c})}get useP2P(){return this.state.useP2P}set p2pTransport(c){this.dispatch({type:cn.SET_TRANSPORT_TYPE,val:c})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(c){this.state.hasStartJoinChannel=c}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(c){this.state.isABTestSuccess=c}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:cn.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:cn.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:cn.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:cn.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:cn.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:cn.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:cn.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:cn.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:cn.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:cn.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:cn.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:cn.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(c,u,h,m){this.dispatch({type:cn.KEY_METRIC_PUBLISH,metric:ot(ot({trackId:c,type:u},h&&{publishStart:h}),m&&{publishEnd:m})})}subscribe(c,u,h,m,_,y,S){this.dispatch({type:cn.KEY_METRIC_SUBSCRIBE,metric:ot(ot(ot(ot(ot({userId:c,type:u},h&&{subscribeStart:h}),m&&{subscribeEnd:m}),_&&{firstFrame:_}),y&&{streamAdded:y}),S&&{firstDecoded:S})})}massSubscribe(c,u,h,m){c.forEach(_=>{this.dispatch({type:cn.KEY_METRIC_SUBSCRIBE,metric:ot(ot(ot({userId:_.userId,type:_.type},u&&{subscribeStart:u}),h&&{subscribeEnd:h}),m&&{firstFrame:m})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(c,u){c.service==="gateway"&&Array.isArray(c.urls)&&(c.urls=c.urls.map(h=>h.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof u!="number"?(this.dispatch({type:cn.RECORD_JOIN_CHANNEL_SERVICE,record:ot(ot({},c),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(u<0||u>=this.state.joinChannelServiceRecords.length||this.dispatch({type:cn.RECORD_JOIN_CHANNEL_SERVICE,record:c,index:u}),u)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:cn.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:cn.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(c){this.dispatch({type:cn.AVOID_JOIN_START,avoidJoinStart:c})}}(e.codec,e.audioCodec,e.mode,this._clientId),this._leaveMutex=new Es("client-leave",this._clientId),this._publishMutex=new Es("client-publish",this._clientId),this._renewTokenMutex=new Es("client-renewtoken",this._clientId),this._subscribeMutex=new Es("client-subscribe",this._clientId),this.store.clientCreated(),e.proxyServer&&this.setProxyServer(e.proxyServer,!0),e.turnServer&&this.setTurnServer(e.turnServer,!0),k.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(tl," build: ").concat(mL,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),e.clientRoleOptions)try{nL(e.clientRoleOptions),i=Object.assign({},e.clientRoleOptions)}catch(c){k.warning("[".concat(this._clientId,"] ").concat(c.toString()))}var o;this._statsCollector=new J0(this.store),this._statsCollector.onStatsException=(c,u,h)=>{k.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(c,", msg: ").concat(u,", uid: ").concat(h)),this.safeEmit(an.EXCEPTION,{code:c,msg:u,uid:h})},this._statsCollector.onUploadPublishDuration=(c,u,h,m)=>{const _=this._users.find(y=>y.uid===c);_&&yt.peerPublishStatus(this._sessionId,{subscribeElapse:m,audioPublishDuration:u,videoPublishDuration:h,peer:_._uintid})},this.store.useP2P=e.mode==="p2p",this._gateway=new Qfe(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:e.websocketRetryConfig||pi,httpRetryConfig:e.httpRetryConfig||pi,forceWaitGatewayResponse:e.forceWaitGatewayResponse===void 0||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role,clientRoleOptions:i}),this._configDistribute=new cpe(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(o={store:this.store,statsCollector:this._statsCollector},Nf("P2PChannel").create(o)),this._handleP2PEvents()):this._p2pChannel=new Z0(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(e,n,i,o,c){let u=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],h=arguments.length>6&&arguments[6]!==void 0&&arguments[6];qn("JOIN_GATEWAY_USE_443PORT_ONLY",u),qn("JOIN_GATEWAY_USE_DUAL_DOMAIN",h);const m=this._gateway.signal.websocket;return m instanceof $L&&(m.use443PortOnly=u,m.tryDoubleDomain=h),async function(_,y,S){YI.get(_)||YI.set(_,[]),XI.get(_)||XI.set(_,y),Wd.get(_)||Wd.set(_,0);const w=YI.get(_),I=XI.get(_);if(!w||!I)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(Wd.get(_)===I){const q=A0();w.push(q),await q.promise}Wd.set(_,Wd.get(_)+1);for(var P=arguments.length,B=new Array(P>3?P-3:0),M=3;M<P;M++)B[M-3]=arguments[M];const U=await S(...B);return Wd.set(_,Wd.get(_)-1),Wd.get(_)===I-1&&w.length>0&&(w[0].resolve(),w.shift()),Wd.get(_)===0&&(YI.set(_,[]),XI.set(_,0),Wd.set(_,0)),U}("client.join",Z("JOIN_MAX_CONCURRENCY"),this.join.bind(this),e,n,i,o,c)}async join(e,n,i,o,c){const u=++this._numberOfJoinCount;this.store.joinStart(),o&&(this.store.uid=o);const h=(rA||rA||(rA=(window.location.protocol.split(":")[0]||"").toUpperCase(),rA))==="HTTPS",m=sW()?window.isSecureContext:"Browser Not Support";(!sW()&&!h||!window.isSecureContext)&&k.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser"),this.connectionState==="DISCONNECTED"&&(this.store.avoidJoinStart=Math.round(Date.now()),k.debug("[".concat(this._clientId,"] set avoidJoinStart to ").concat(this.store.avoidJoinStart))),yt.setAppId(e);try{if(!i&&i!==null)throw new be(Y.INVALID_PARAMS,"Invalid token: ".concat(i,". If you don not use token, set it to null"));i&&qi(i,"token",1,2047),qi(e,"appid",1,2047),RA(n),o&&CA(o),c&&qi(c,"optionalInfo",1,2047)}catch(M){throw yt.reportApiInvoke(Zg(),{name:fi.JOIN,options:[e,n,i,o],states:{isHttps:h,isSecureContext:m},tag:kr.TRACER}).onError(M),M}if(this._leaveMutex.isLocked&&(k.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),k.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const M=new be(Y.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw yt.reportApiInvoke(Zg(),{name:fi.JOIN,options:[e,n,i,o],states:{isHttps:h,isSecureContext:m},tag:kr.TRACER}).onError(M),M}this._gateway.state="CONNECTING";const _=await i8({appId:e,cname:n,uid:o,stringUid:typeof o=="string"?o:void 0,token:i||e,cloudProxyServer:this._cloudProxyServerMode});if(!this._joinAndNotLeaveYet)throw new be(Y.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));const y=(_==null?void 0:_.sid)||Zg();k.info("[".concat(this._clientId,"] start join channel ").concat(n,", join number: ").concat(u)),this._sessionId||(this._sessionId=y,this.store.sessionId=this._sessionId);const S=yt.reportApiInvoke(y,{id:this._clientId,name:fi.JOIN,options:[e,n,i,o],states:{isHttps:h,isSecureContext:m},tag:kr.TRACER}),w=Jl(Jl(Jl({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:e,sid:this._sessionId,cname:n,uid:typeof o!="string"?o:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:i||e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:c,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!_},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:Z("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(w.setLocalAPVersion=this._setLocalAPVersion),typeof o=="string"&&(w.stringUid=o,this._uintUid?(w.uid=this._uintUid,this._uintUid=void 0):w.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(w.aesmode=this._encryptionMode,w.aespassword=await(async M=>{const U=function(me){const ge=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),pe=new Uint8Array(new ArrayBuffer(ge.length));for(let we=0;we<ge.length;we+=1)pe[we]=ge.charCodeAt(we);return pe}(),q=await window.crypto.subtle.importKey("spki",U,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),$=eL(M),ae=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},q,$);return function(me){let ge="";for(let pe=0;pe<me.length;pe+=1)ge+=String.fromCharCode(me[pe]);return window.btoa(ge)}(new Uint8Array(ae))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new be(Y.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(w.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const M=new TextEncoder,U=Z("USE_PURE_ENCRYPTION_MASTER_KEY")?M.encode(w.appId+this._encryptionSecret+this._encryptionSecret):M.encode(w.appId+w.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(q,$,ae){const me=await window.crypto.subtle.importKey("raw",$,"PBKDF2",!1,["deriveBits","deriveKey"]),ge=q==="aes-128-gcm2"?128:256,pe=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:mW,hash:"SHA-256",salt:ae},me,ge+Ahe);return new Uint8Array(pe).subarray(ge/8)}(this._encryptionMode,U,Qg(this._encryptionSalt)),this._encryptDataStreamKey=await async function(q,$,ae){const me=await window.crypto.subtle.importKey("raw",$,"PBKDF2",!1,["deriveBits","deriveKey"]),ge=q==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:mW,hash:"SHA-256",salt:ae},me,{name:"AES-GCM",length:ge},!0,["encrypt","decrypt"])}(this._encryptionMode,U,Qg(this._encryptionSalt))}else m?k.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):k.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,k.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:n,appId:e,stringUid:w.stringUid});const I=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&I===this._sessionId&&yt.joinChannelTimeout(this._sessionId,5)},5e3);try{var P;let M;const U=w.cloudProxyServer;if(Xe(P=["proxy3","proxy4","proxy5"]).call(P,U)){const ge=Z("PROXY_SERVER_TYPE3");Array.isArray(ge)?w.proxyServer=ge[0]:w.proxyServer=ge}if(yt.setProxyServer(w.proxyServer),k.setProxyServer(w.proxyServer),this.store.requestAPStart(),_){if(k.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(w.stringUid?", ".concat(w.stringUid," => ").concat(_.intUid):""," ")),w.stringUid&&!w.uid&&(w.uid=_.intUid),M={gatewayInfo:_.ap.gatewayInfo},Z("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&w.turnServer.mode==="auto")if(_.ap.proxyInfo.addresses.length===0)k.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const ge=(await Xz(_.ap.proxyInfo,_.ap.gatewayInfo.uid)).map(pe=>({turnServerURL:pe.address,tcpport:pe.tcpport||hs.tcpport,udpport:pe.udpport||hs.udpport,username:pe.username||hs.username,password:pe.password||hs.password,forceturn:!1,security:!0}));w.turnServer={mode:"manual",servers:ge}}a8(_,w.stringUid)}else{if(w.stringUid&&!w.uid){let ge;[ge,M]=await tt.all([wH(w.stringUid,w,this._axiosCancelSource.token,this._config.httpRetryConfig||pi,this.store),bH(w,this._axiosCancelSource.token,this._config.httpRetryConfig||pi,!0,this.store)]),k.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(w.stringUid," => ").concat(ge)),w.uid=ge,M.gatewayInfo.uid=ge,M.gatewayInfo.res.uid=ge}else M=await bH(w,this._axiosCancelSource.token,this._config.httpRetryConfig||pi,!0,this.store);if(!this._joinAndNotLeaveYet)throw new be(Y.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(w,this._axiosCancelSource.token),this._configDistribute.on(W0.UPDATE_BITRATE_LIMIT,ge=>{this._p2pChannel.updateBitrateLimit(ge)}),this._configDistribute.on(W0.UPDATE_CLIENT_ROLE_OPTIONS,ge=>{this._setClientRoleOptions(ge)})},0),this._key=i||e;const q=M.gatewayInfo,$=w.uid?w.uid:q.uid;this._joinInfo=Jl(Jl({},w),{},{cid:q.cid,uid:$,vid:q.vid,apResponse:q.res,apGatewayAddress:q.apGatewayAddress,uni_lbs_ip:q.uni_lbs_ip,gatewayAddrs:q.gatewayAddrs}),this.store.intUid=$,this.store.cid=q.cid;const ae=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new be(Y.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));S.onSuccess(ae),this._appId=e,this._channelName=w.cname,this._uid=ae,this.store.uid=ae,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(ls()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);const me=w.stringUid?"string uid: ".concat(w.stringUid,",uid: ").concat(w.uid):"uid: ".concat(this._uid);return k.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(n,",").concat(me)),setTimeout(()=>{k.startUpload()},5e3),this.store.joinEnd(),B=this,Xe(o_).call(o_,B)||o_.push(B),this._cloudProxyServerMode==="disabled"&&On().supportWebCrypto&&Z("ENABLE_PRELOAD")&&Sx(this._joinInfo),ae}catch(M){const U=Array.isArray(M)?M[0]:M;throw U&&U.code===Y.OPERATION_ABORTED?k.warning("[".concat(this._clientId,"] join number: ").concat(u,", Joining channel failed, rollback"),U):k.error("[".concat(this._clientId,"] join number: ").concat(u,", Joining channel failed, rollback"),U),U.code!==Y.OPERATION_ABORTED&&this._numberOfJoinCount===u&&(this._gateway.state="DISCONNECTED",this._reset()),S.onError(U),U}var B}_joinGateway(){if(!this._joinInfo||!this._key)throw new be(Y.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!Z("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){k.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(ls()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(n){const i=o_.indexOf(n);i!==-1&&o_.splice(i,1)}(this),this._statsCollector.stopUpdateStats();const e=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return k.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void e();await this._gateway.leave(this.connectionState!=="CONNECTED",Vn.LEAVE),k.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),e()}async publish(e){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(e)){if(!(e instanceof iv))return this._publishDataChannel(e);e=[e]}if(e.length===0)throw new be(Y.INVALID_PARAMS,"param list is empty");const i=e;if(this._gateway.role==="audience")throw new be(Y.INVALID_OPERATION,"audience can not publish stream");for(const c of i){if(!(c instanceof iv))throw new be(Y.INVALID_PARAMS,"parameter is not local track");if(!c._enabled&&n)throw new be(Y.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(c.getTrackId()))}k.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(i.map(c=>"".concat(c.getTrackId()," "))));const o=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),n&&i.forEach(c=>{const u=this._configDistribute.getBitrateLimit();c instanceof hr&&u&&c.setBitrateLimit(u.uplink)});try{await this._publishHighStream(i),k.info("[".concat(this._clientId,"] Publish success, id ").concat(i.map(c=>"".concat(c.getTrackId()," "))))}catch(c){throw k.error("[".concat(this._clientId,"] publish error"),c.toString()),c}finally{o()}}async _publishDataChannel(e){Jn(e.id,"id",0,65535,!0),wf(e.ordered,"ordered"),qi(e.metadata,"metadata",0,512),k.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(e.id));const n=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(c=>c.id===e.id)!==-1)throw new be(Y.INVALID_PARAMS,"Invalid id: ".concat(e.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new be(Y.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new be(Y.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&Z("FORCE_TURN")&&!Z("TURN_ENABLE_TCP")&&!Z("TURN_ENABLE_UDP"))throw new be(Y.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const i=function(c){return pH(c,!1)}(e),o=await this._p2pChannel.publishDataChannel([i]);if(o.length>0){if(typeof i._originDataChannelId!="number")throw k.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new be(Y.CREATE_DATACHANNEL_ERROR);try{await tt.all(o.map(c=>this._uid&&this._gateway.publishDataChannel(this._uid,c,!0))),await i._waitTillOpen()}catch(c){if(c.code!==Y.DISCONNECT_P2P)throw c}}return k.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(i.id)),i}catch(i){throw k.error("[".concat(this._clientId,"] publish datachannels error"),i.toString()),i}finally{n()}}async unpublish(e){if(!this._joinInfo||this._uid===void 0)throw new be(Y.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let n=[];if(e)if(Array.isArray(e))n=e;else{if(!(e instanceof iv))return this._unpublishDataChannel([e]);n=[e]}else this.store.useP2P||await this._unpublishDataChannel(),n=this._p2pChannel.getAllTracks(!0);k.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(n.map(o=>"".concat(o.getTrackId()," "))," "));const i=await this._publishMutex.lock();try{if(this.store.useP2P){const o=await this._p2pChannel.unpublish(n);o&&await this._gateway.sendExtensionMessage(Yr.UNPUBLISH,{unpubMsg:o},!0)}else{const o=await this._p2pChannel.unpublish(n);o&&await this._gateway.unpublish(o,this._uid),k.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(n.map(c=>"".concat(c.getTrackId()))))}}catch(o){throw k.error("[".concat(this._clientId,"] unpublish error"),o.toString()),o}finally{i&&i()}}async _unpublishDataChannel(e){e!==void 0&&e.length!==0||(e=this._p2pChannel.getAllDataChannels()),k.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(e.map(i=>"".concat(i.id," "))," "));const n=await this._publishMutex.lock();try{const i=await this._p2pChannel.unpublishDataChannel(e);i&&await this._gateway.unpublishDataChannel(i),k.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(e.map(o=>"".concat(o.id))))}catch(i){throw k.error("[".concat(this._clientId,"] unpublish dataChannel error"),i.toString()),i}finally{n&&n()}}async subscribe(e,n,i){if(!(e instanceof om)){const o=this.remoteUsers.find(c=>c.uid===e);if(!o)throw new be(Y.INVALID_REMOTE_USER,"user is not in the channel");e=o}return n==="datachannel"?this._subscribeDataChannel(e,i):this._subscribe(e,n)}async presubscribe(e,n){if(Ti(n,"mediaType",["audio","video"]),this.store.useP2P)throw new be(Y.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new be(Y.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new be(Y.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const i=n===at.AUDIO,o=n===at.VIDEO,c=await this._subscribeMutex.lock();try{const{ssrcId:u,ortc:h,rtxSsrcId:m,cname:_,uint_id:y}=await this._gateway.presubscribe(e,n,!0);if(u==null)throw new be(Y.UNEXPECTED_RESPONSE,"no ssrc id");let S=this._users.find(I=>I.uid===e);S||(S=new om(e,y||e),S._is_pre_created=!0,this._users.push(S)),_&&(S._cname=_),S._uintid||(S._uintid=y||e),i&&(S._audioSSRC=u,S._audio_pre_subscribed=!0,h&&(S._audioOrtc=h)),o&&(S._videoSSRC=u,S._video_pre_subscribed=!0,h&&(S._videoOrtc=h),m!=null&&(S._rtxSsrcId=m)),k.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(u)),await this._p2pChannel.subscribe(S,n,u,m,h);const w=i?S._audioTrack:S._videoTrack;if(!w)throw new be(Y.UNEXPECTED_ERROR,"can not find remote track in user");return i&&(S._trust_audio_stream_added_state_=!0,S._audio_added_=!0),o&&(S._trust_video_stream_added_state_=!0,S._video_added_=!0),w}catch(u){throw k.error("[".concat(this._clientId,"] presub user ").concat(e," error"),u),u}finally{c()}}async _subscribeDataChannel(e,n){var i;if(Jn(n,"channelId",0,65535,!0),!this._joinInfo)throw new be(Y.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new be(Y.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(m=>m===e))throw k.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),new be(Y.INVALID_REMOTE_USER,"user is not in the channel");if(!e.hasAudio&&!e.hasVideo&&e._dataChannels.length===0)throw k.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),new be(Y.INVALID_REMOTE_USER,"user is not published");const c=(i=e._dataChannels)===null||i===void 0?void 0:i.find(m=>m.id===n);if(!c)throw k.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, remote datachannel is not published")),new be(Y.REMOTE_USER_IS_NOT_PUBLISHED);const u=await this._subscribeMutex.lock();k.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: datachannel"));try{const m=await this._p2pChannel.subscribeDataChannel(e,[c]);if(m&&Xe(m).call(m,c.id))try{var h;if(typeof c._originDataChannelId!="number")throw k.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, cannot get RTCDatachannel")),new be(Y.CREATE_DATACHANNEL_ERROR);const _={id:c.id,datachannelId:c._originDataChannelId,ordered:c.ordered,maxRetransmits:c.maxRetransmits,metadata:(h=c.metadata)!==null&&h!==void 0?h:""};await this._gateway.subscribeDataChannel(e.uid,_,!0),await c._waitTillOpen()}catch(_){if((_==null?void 0:_.code)!==Y.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(e,[c]),_;await this._p2pChannel.unsubscribeDataChannel(e,[c]),this._p2pChannel.setPendingRemoteDataChannel(e,c.id)}return k.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: datachannel")),c}finally{u()}}async _p2pSubscribe(e,n,i){if(Ti(n,"mediaType",["audio","video"]),!this._joinInfo)throw new be(Y.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new be(Y.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(u=>u===e)){const u=new be(Y.INVALID_REMOTE_USER,"user is not in the channel");throw k.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),u}if(!e.hasAudio&&!e.hasVideo){const u=new be(Y.INVALID_REMOTE_USER,"user is not published");throw k.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),u}if(!i&&(n==="audio"&&!e.hasAudio||n==="video"&&!e.hasVideo)){const u=new be(Y.REMOTE_USER_IS_NOT_PUBLISHED);throw k.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(n,", remote track is not published")),u}const c=await this._subscribeMutex.lock();k.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(n));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,n))await this._p2pChannel.unmuteRemote(e,n);else try{const h=n==="audio"?e._audioSSRC:e._videoSSRC,m=n==="audio"?e._audioMid:e._videoMid;this.store.subscribe(e.uid,n,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(e,n,h,m)}catch(h){throw h}k.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(n)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(h=>{k.warning("[".concat(this._clientId,"] auto set fallback failed"),h)});const u=n==="audio"?e._audioTrack:e._videoTrack;if(!u)throw new be(Y.UNEXPECTED_ERROR,"can not find remote track in user object");return u}catch(u){throw k.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),u),u}finally{c()}}async _subscribe(e,n,i){if(this.store.useP2P)return this._p2pSubscribe(e,n);if(Ti(n,"mediaType",["audio","video"]),!this._joinInfo)throw new be(Y.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new be(Y.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(y=>y===e)){const y=new be(Y.INVALID_REMOTE_USER,"user is not in the channel");throw k.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),y}if(!e.hasAudio&&!e.hasVideo){const y=new be(Y.INVALID_REMOTE_USER,"user is not published");throw k.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),y}if(!(i||(n!=="audio"||e.hasAudio&&e._audioSSRC!==void 0)&&(n!=="video"||e.hasVideo&&e._videoSSRC!==void 0))){const y=new be(Y.REMOTE_USER_IS_NOT_PUBLISHED);throw k.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(n,", remote track is not published")),y}let c=n==="audio"?e._audioSSRC:e._videoSSRC,u=n==="audio"?e._audioOrtc:e._videoOrtc,h=n==="video"?e._rtxSsrcId:void 0,m={stream_type:n==="audio"?at.AUDIO:at.VIDEO,ssrcId:c};const _=await this._subscribeMutex.lock();k.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(n));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,n))await this._p2pChannel.unmuteRemote(e,n);else try{const S=n==="audio"?e._audioSSRC:e._videoSSRC;S!==void 0&&S!==c&&(c=S,u=n==="audio"?e._audioOrtc:e._videoOrtc,h=n==="video"?e._rtxSsrcId:void 0,m={stream_type:n==="audio"?at.AUDIO:at.VIDEO,ssrcId:c}),Ss.markSubscribeStart(this.store.clientId,c),this.store.subscribe(e.uid,n,Date.now()),await this._p2pChannel.subscribe(e,n,c,h,u);try{this._p2pChannel.isPreSubScribe(c)||await this._gateway.subscribe(e.uid,m,!0)}catch(w){if((w==null?void 0:w.code)!==Y.WS_ABORT)throw await this._p2pChannel.unsubscribe(e,n),w;await this._p2pChannel.unsubscribe(e,n,!0),this._p2pChannel.setPendingRemoteMedia(e,n)}this.store.subscribe(e.uid,n,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,e,n)}catch(S){throw this._p2pChannel.reportSubscribeEvent(!1,S==null?void 0:S.code,e,n),S}k.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(n)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(S=>{k.warning("[".concat(this._clientId,"] auto set fallback failed"),S)});const y=n==="audio"?e._audioTrack:e._videoTrack;if(!y)throw new be(Y.UNEXPECTED_ERROR,"can not find remote track in user object");return y}catch(y){throw k.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),y),y}finally{_()}}async massSubscribe(e){if(Rf(e,"subscribeList"),!this._joinInfo)throw new be(Y.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new be(Y.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const n=Date.now(),i=new Map,o=await this._subscribeMutex.lock();k.info("[".concat(this._clientId,"]start massSubscribe user ").concat(e.map(m=>{let{user:_,mediaType:y}=m;return"user: ".concat(_==null?void 0:_.uid,", mediaType: ").concat(y)}).join("; ")));const c=(e=[...e]).map(m=>{let{user:_,mediaType:y}=m;return{user:_,mediaType:y}}),u=await this._p2pChannel.globalLock();try{var h;for(let _=e.length-1;_>=0;_--){const y=e[_],{user:S,mediaType:w}=y;if(Ti(w,"mediaType",["audio","video"]),!S){const M=new be(Y.INVALID_PARAMS,"user property does not exist in subscribeList item");throw k.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),M}if(!this._users.find(M=>M===S)){const M=new be(Y.INVALID_REMOTE_USER,"user is not in the channel");k.error("[".concat(this._clientId,"] can not massSubscribe ").concat(S.uid,", this user is not in the channel")),c[_].error=M,e.splice(_,1);continue}if(w==="audio"&&(!S.hasAudio||S._audioSSRC===void 0)||w==="video"&&(!S.hasVideo||S._videoSSRC===void 0)){const M=new be(Y.REMOTE_USER_IS_NOT_PUBLISHED);k.error("[".concat(this._clientId,"] can not subscribe ").concat(S.uid," with mediaType ").concat(w,", remote user is not published")),c[_].error=M,e.splice(_,1);continue}const P=Pi.Video|Pi.LwoVideo,B=i.get(S);if(B){if(w==="video"?B&P:B&Pi.Audio){e.splice(_,1),k.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(S.uid,", mediaType:").concat(w," twice"));continue}i.set(S,B|(w==="video"?P:Pi.Audio))}else i.set(S,w==="video"?P:Pi.Audio)}for(let _=e.length-1;_>=0;_--){const y=e[_],{user:S,mediaType:w}=y,I=Pi.Video|Pi.LwoVideo;if(this._p2pChannel.hasRemoteMedia(S,w)){await this._p2pChannel.unmuteRemoteNoLock(S,w);const P=i.get(S);i.set(S,w==="video"?P^I:P^Pi.Audio),e.splice(_,1)}}this.store.massSubscribe(e.map(_=>({userId:_.user.uid,type:_.mediaType})),n);let m=Da(h=Array.from(i.entries())).call(h,(_,y)=>{let[S,w]=y;if(w===0)return _;const I={stream_id:S.uid,stream_type:w};return w&Pi.Audio&&(I.audio_ssrc=S._audioSSRC),w&Pi.Video&&(I.video_ssrc=S._videoSSRC),_.push(I),_},[]);try{e.length>0&&await this._p2pChannel.massSubscribeNoLock(e.map(y=>{let{user:S,mediaType:w}=y;return{user:S,mediaType:w,ssrcId:w===at.VIDEO?S._videoSSRC:S._audioSSRC,rtxSsrcId:w===at.VIDEO?S._rtxSsrcId:void 0}}));const _=new Map;if(m=m.filter(y=>y.video_ssrc&&!this._p2pChannel.isPreSubScribe(y.video_ssrc)||y.audio_ssrc&&!this._p2pChannel.isPreSubScribe(y.audio_ssrc)||!y.video_ssrc&&!y.audio_ssrc),m.length>0){const y=await this._gateway.subscribeAll(m,!0);((y==null?void 0:y.users)||[]).forEach(S=>{let{stream_id:w,video_error_code:I,audio_error_code:P,error_code:B}=S;(I||P||B)&&_.set(w,{video_error_code:I,audio_error_code:P,error_code:B})})}if(Array.from(_.entries()).length>0){const y=[];Array.from(_.entries()).forEach(S=>{let[w,I]=S;const P=this.remoteUsers.find(B=>B.uid===w);if(P){let B;I.error_code||I.video_error_code&&I.audio_error_code?B=void 0:I.video_error_code?B=at.VIDEO:I.audio_error_code&&(B=at.AUDIO),y.push({user:P,mediaType:B})}}),y.length>0&&await this._p2pChannel.massUnsubscribeNoLock(y)}for(const y of c){const S=_.get(y.user.uid);if(S){const w=S.error_code||y.mediaType==="audio"&&S.audio_error_code||y.mediaType==="video"&&S.video_error_code;if(w){const I=G0(w);k.error("user:".concat(y.user.uid," mediaType:").concat(y.mediaType," has massSubscribe error ").concat(I.desc)),y.error=new be(Y.SUBSCRIBE_FAILED,"code ".concat(w,": ").concat(I.desc))}}y.error||(y.mediaType==="video"?y.track=y.user.videoTrack:y.track=y.user.audioTrack)}return this.store.massSubscribe(c.filter(y=>!y.error).map(y=>({userId:y.user.uid,type:y.mediaType})),void 0,Date.now()),c.forEach(y=>{var S;yt.subscribe(this.store.sessionId,{succ:!!y.error,ec:((S=y.error)===null||S===void 0?void 0:S.code)||null,video:y.mediaType===at.VIDEO,audio:y.mediaType===at.AUDIO,peerid:y.user.uid,subscribeRequestid:y.mediaType===at.VIDEO?y.user._videoSSRC:y.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-n),preSsrc:this._p2pChannel.isPreSubScribe(y.user._videoSSRC)},!0)}),k.info("[".concat(this._clientId,"] massSubscribe success ").concat(e.map(y=>{let{user:S,mediaType:w}=y;return"user: ".concat(S==null?void 0:S.uid,", mediaType: ").concat(w)}).join("; "))),c}catch(_){throw await this._p2pChannel.massUnsubscribeNoLock(e),_}}finally{u(),o()}}async unsubscribe(e,n,i){if(!(e instanceof om)){const u=this.remoteUsers.find(h=>h.uid===e);if(!u)throw new be(Y.INVALID_REMOTE_USER,"user is not in the channel");e=u}if(n||this.store.useP2P){if(n==="datachannel")return this._unsubscribeDataChannel(e,i)}else await this._unsubscribeDataChannel(e,i);if(n&&Ti(n,"mediaType",["audio","video"]),!this._joinInfo)throw new be(Y.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(u=>u===e)){const u=new be(Y.INVALID_REMOTE_USER,"user is not in the channel");throw k.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),u}k.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: ").concat(n));const c=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(e,n);else{const u=await this._p2pChannel.unsubscribe(e,n);u&&await this._gateway.unsubscribe(u,e.uid),n&&n!=="audio"||(e._audio_pre_subscribed=!1),n&&n!=="video"||(e._video_pre_subscribed=!1),e._is_pre_created&&eA(this._users,e),k.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(e.uid,", mediaType: ").concat(n))}}catch(u){if(u.code===Y.DISCONNECT_P2P)return void k.warning("disconnecting p2p, abort unsubscribe request.");throw k.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),u.toString()),u}finally{c()}}async _unsubscribeDataChannel(e,n){if(n&&Jn(n,"id",0,65535,!0),!this._joinInfo)throw new be(Y.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(c=>c===e)){const c=new be(Y.INVALID_REMOTE_USER,"user is not in the channel");throw k.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),c}let o;if(typeof n=="number"){const c=e._dataChannels.find(u=>u.id===n);c&&(o=[c])}else o=e._dataChannels;if(o===void 0){const c=new be(Y.REMOTE_USER_IS_NOT_PUBLISHED);throw k.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid," with channelId ").concat(n,", remote datachannel is not published")),c}k.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(o.map(c=>c.id)));try{const c=await this._p2pChannel.unsubscribeDataChannel(e,o);c&&await this._gateway.unsubscribeDataChannel(c,e.uid),k.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(c))}catch(c){if(c.code===Y.DISCONNECT_P2P)return void k.warning("disconnecting p2p, abort unsubscribe request.");throw k.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),c.toString()),c}}async massUnsubscribe(e){if(Rf(e,"unsubscribeList"),!this._joinInfo)throw new be(Y.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");k.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(e.map(i=>{let{user:o,mediaType:c}=i;return"user: ".concat(o==null?void 0:o.uid,", mediaType: ").concat(c,";")}).join())),e=[...e];const n=new Map;for(let i=e.length-1;i>=0;i--){const{user:o,mediaType:c}=e[i];if(!o){const m=new be(Y.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw k.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),m}if(Ti(c,"mediaType",["video","audio",void 0]),!this._users.find(m=>m===o)){k.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(o.uid,", user is not in the channel")),e.splice(i,1);continue}const h=Pi.Video|Pi.LwoVideo;if(n.has(o)){const m=n.get(o);let _;switch(c){case"video":_=m&h;break;case"audio":_=m&Pi.Audio;break;default:_=m&(Pi.Audio|h)}if(_){k.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(o.uid,",mediaType:").concat(c," twice.")),e.splice(i,1);continue}c?c==="audio"?n.set(o,m|Pi.Audio):c==="video"&&n.set(o,m|h):n.set(o,m|Pi.Audio|h)}else c?c==="audio"?n.set(o,Pi.Audio):c==="video"&&n.set(o,h):n.set(o,Pi.Audio|h)}try{const i=await this._p2pChannel.massUnsubscribe(e);i&&await this._gateway.massUnsubscribe(i),k.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(e.map(o=>{let{user:c,mediaType:u}=o;return"user: ".concat(c==null?void 0:c.uid,", mediaType: ").concat(u,";")}).join()))}catch(i){if(i.code===Y.DISCONNECT_P2P)return void k.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw k.error("[".concat(this._clientId,"] massUnsubscribe error"),i.toString()),i}}async setLowStreamParameter(e){(function(i){if(!i)throw new Ce(Y.INVALID_PARAMS);Nr(i.width)||Q1(i.width,"streamParameter.width"),Nr(i.height)||Q1(i.height,"streamParameter.height"),Nr(i.framerate)||Q1(i.framerate,"streamParameter.framerate"),Nr(i.bitrate)||Jn(i.bitrate,"streamParameter.bitrate")})(e),(!e.width&&e.height||e.width&&!e.height)&&k.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),k.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(e));const n=this._configDistribute.getLowStreamConfigDistribute();if(n&&n.bitrate&&e.bitrate&&n.bitrate<e.bitrate&&(e.bitrate=n.bitrate),this._lowStreamParameter=e,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(e,Ve.LocalVideoLowTrack)}async enableDualStream(){if(!On().supportDualStream)throw yt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new be(Y.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new be(Y.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(e){throw yt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),e}this._isDualStreamEnabled=!0,yt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),k.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new be(Y.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(Ve.LocalVideoLowTrack))try{const e=await this._p2pChannel.unpublishLowStream();e&&await this._gateway.unpublish(e,this._joinInfo.stringUid||this._joinInfo.uid)}catch(e){throw yt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),e}this._isDualStreamEnabled=!1,yt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),k.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(e,n){if(function(o){Ti(o,"role",["audience","host"])}(e),n&&nL(n),this.mode==="rtc"||this.mode==="p2p")throw k.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new be(Y.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(n&&n.level&&e==="host")throw new be(Y.INVALID_OPERATION,"host mode can not set audience latency level");if(e==="audience"&&this._p2pChannel.hasLocalMedia())throw new be(Y.INVALID_OPERATION,"can not set client role to audience when publishing stream");const i=this._config.role;this._joinInfo&&(this._joinInfo.role=e),e!==i&&Z("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(e,n),this._config.role=e,this._gateway.reconnect("recover",us.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(e,n),this._config.role=e),k.info("[".concat(this._clientId,"] set client role to ").concat(e,", level: ").concat(n&&n.level))}async _setClientRoleOptions(e){if(this.mode==="rtc"||this.mode==="p2p"||this._config.role!=="audience"||this._p2pChannel.hasLocalMedia())return;let n=!1;try{e&&nL(e),await this._gateway.setClientRole(this._config.role,e),n=!0}catch{}finally{k.info("[".concat(this._clientId,"] set client role options ").concat(n?"succeed":"failed",", options is ").concat(e))}}getRemoteInboundOffset(){var e;const n=(e=this._p2pChannel.getStats())===null||e===void 0?void 0:e.audioSend[0];if(!n||!n.timestamp)return 0;const i=n.timestamp-Date.now();return Math.abs(i)>1e3+n.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?i:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(e,n){if(qi(e,"proxyServer"),!n){if(this.connectionState!=="DISCONNECTED")throw new be(Y.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new be(Y.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,yt.setProxyServer(this._proxyServer),k.setProxyServer(this._proxyServer),k.info("[".concat(this._clientId,"] Set proxy server ").concat(n?"by initialize call":""," success."))}setTurnServer(e,n){if(Array.isArray(e)||(e=[e]),!n){if(this.connectionState!=="DISCONNECTED")throw new be(Y.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new be(Y.INVALID_OPERATION,"You have already set the proxy")}if(D0(e))return this._turnServer={servers:e,mode:"original-manual"},void k.info("[".concat(this._clientId,"] Set original turnserver ").concat(n?"by initialize call":""," success: ").concat(e.map(i=>i.urls).join(","),"."));e.forEach(i=>q6(i)),this._turnServer={servers:e,mode:"manual"},k.info("[".concat(this._clientId,"] Set turnserver ").concat(n?"by initialize call":""," success."))}setLicense(e){if(this.connectionState!=="DISCONNECTED")throw new be(Y.INVALID_OPERATION,"you should set license before join channel");if(qi(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new be(Y.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,k.info("[".concat(this._clientId,"] set license success"),e)}startProxyServer(e){if(this.connectionState!=="DISCONNECTED")throw new be(Y.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new be(Y.INVALID_OPERATION,"You have already set the proxy");const n=[3,4,5];let i;switch(e===void 0&&(e=3),e){case 1:case 2:throw new be(Y.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:i="proxy3";break;case 4:i="proxy4";break;case 5:i="proxy5";break;default:throw new be(Y.INVALID_PARAMS,"proxy server mode must be ".concat(n.join("|")))}this._cloudProxyServerMode=i,this.store.cloudProxyServerMode=i,k.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new be(Y.INVALID_OPERATION,"Stop proxy server after leave channel");yt.setProxyServer(),k.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",k.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(e){if(!e.accessPoints)throw new be(Y.INVALID_PARAMS,"accessPoints is required.");Rf(e.accessPoints.serverList,"accessPoints.serverList"),qi(e.accessPoints.domain,"accessPoints.domain");const n=(I,P)=>{Jn(I,P,0,65535,!0)};let i=443;if(e.accessPoints.port&&(n(e.accessPoints.port,"accessPoints.port"),i=e.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new be(Y.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");Z("CLOSE_AFB_FOR_LOCAL_AP")&&(qn("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),qn("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const o=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,c=e.accessPoints.domain,u=e.accessPoints.serverList.map(I=>o.test(I)?"".concat(I.replace(/\./g,"-"),".").concat(c):I),h=u.map(I=>"".concat(I,":").concat(i));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,qn("WEBCS_DOMAIN",h),qn("WEBCS_DOMAIN_BACKUP_LIST",h),qn("GATEWAY_DOMAINS",[c]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?(Rf(e.report.hostname,"report.hostname"),qn("EVENT_REPORT_DOMAIN",e.report.hostname[0]),qn("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):(qn("EVENT_REPORT_DOMAIN",u[0]),qn("EVENT_REPORT_BACKUP_DOMAIN",u[1]||u[0]));let m=6443;e.report&&e.report.port&&(n(e.report.port,"report.port"),m=e.report.port),qn("STATS_COLLECTOR_PORT",m),e.report?qn("ENABLE_EVENT_REPORT",!0):qn("ENABLE_EVENT_REPORT",!1);let _="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?(Rf(e.log.hostname,"log.hostname"),_=e.log.hostname[0]):_=u[0];let y=6444;e.log&&e.log.port&&(n(e.log.port,"log.port"),y=e.log.port),qn("LOG_UPLOAD_SERVER","".concat(_,":").concat(y));let S=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?(Rf(e.cds.hostname,"cds.hostname"),S=e.cds.hostname):S=u;let w=443;e.cds&&e.cds.port&&(n(e.cds.port,"cds.port"),w=e.cds.port),qn("CDS_AP",S.map(I=>"".concat(I,":").concat(w))),e.cds?qn("ENABLE_CONFIG_DISTRIBUTE",!0):qn("ENABLE_CONFIG_DISTRIBUTE",!1),k.info("set local access point v2 success")}setLocalAccessPoints(e,n){if(Rf(e,"serverList"),qi(n,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new be(Y.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const i=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map(o=>i.test(o)?"".concat(o.replace(/\./g,"-"),".").concat(n):o),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,qn("WEBCS_DOMAIN",e),qn("WEBCS_DOMAIN_BACKUP_LIST",e),qn("GATEWAY_DOMAINS",[n]),qn("EVENT_REPORT_DOMAIN",e[0]),qn("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),qn("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),k.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(e){if(Ti(e,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=e,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(e),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(n){throw k.error("[".concat(this._clientId,"] set default remote video stream type error"),n.toString()),n}else k.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(e))}async setRemoteVideoStreamType(e,n){Ti(n,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(e,n),setTimeout(()=>{const i=this._users.find(o=>o.uid===e);i&&i.videoTrack&&i.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(i){throw k.error("[".concat(this._clientId,"] set remote video stream type error"),i.toString()),i}k.info("[".concat(this._clientId,"] set remote ").concat(e," video stream type to ").concat(n)),this._remoteStreamTypeCacheMap.set(e,n)}async setStreamFallbackOption(e,n){Ti(n,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(e,n)}catch(i){throw k.error("[".concat(this._clientId,"] set stream fallback option"),i.toString()),i}k.info("[".concat(this._clientId,"] set remote ").concat(e," stream fallback type to ").concat(n)),this._streamFallbackTypeCacheMap.set(e,n)}setEncryptionConfig(e,n,i,o){(function(u){Ti(u,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(e),qi(n,"secret");const c=["aes-128-gcm2","aes-256-gcm2"];if(Xe(c).call(c,e)){if(!i||!(i instanceof Uint8Array&&i.length===32))throw new be(Y.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(i)throw new be(Y.INVALID_PARAMS,"current encrypt mode does not need salt");if(o){if(wf(o,"encryptDataStream"),!Xe(c).call(c,e))throw new be(Y.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(n)||k.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=e,this._encryptionSecret=n,i&&(this._encryptionSalt=Qp(i))}async renewToken(e){if(qi(e,"token",1,2047),!this._key||!this._joinInfo)throw new be(Y.INVALID_OPERATION,"renewToken should not be called before user join");const n=this._key;this._key=e,this._joinInfo&&(this._joinInfo.token=e);const i=await this._renewTokenMutex.lock();try{if(Z("USE_NEW_TOKEN")){k.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const o=await ape(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||pi);k.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:e,ticket:o})}else k.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:e});k.debug("[".concat(this._clientId,"] renewToken success"))}catch(o){throw this._key=n,this._joinInfo.token=n,k.error("[".concat(this._clientId,"] renewToken failed"),o.toString()),o}finally{i()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?k.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const e=this._p2pChannel.getAudioLevels();this.safeEmit(an.VOLUME_INDICATOR,e)},Z("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const e=this._statsCollector.getRTCStats(),n=this._gateway.getInChannelInfo();return e.Duration=Math.round(n.duration/1e3),e}async startLiveStreaming(e,n){if(!n){if(this.codec!=="h264")throw new be(Y.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new be(Y.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e))throw new be(Y.LIVE_STREAMING_TASK_CONFLICT);const i=n?Af.TRANSCODE:Af.RAW;return this._createLiveStreamingClient(i).startLiveStreamingTask(e,i)}setLiveTranscoding(e){return this._createLiveStreamingClient(Af.TRANSCODE).setTranscodingConfig(e)}async stopLiveStreaming(e){const n=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(i=>i&&i.hasUrl(e));if(!n.length)throw new be(Y.INVALID_PARAMS,"can not find live streaming url to stop");await tt.all(n.map(i=>i&&i.stopLiveStreamingTask(e)))}async startChannelMediaRelay(e){NH(e),await this._createChannelMediaRelayClient().startChannelMediaRelay(e)}async updateChannelMediaRelay(e){NH(e),await this._createChannelMediaRelayClient().updateChannelMediaRelay(e)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(e){this._p2pChannel instanceof Z0&&this._p2pChannel.addAudioMetadata(e)}async sendStreamMessage(e){var n;let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new be(Y.INVALID_OPERATION,"can not send data stream, not joined");if((typeof e=="string"||e instanceof Uint8Array)&&(e={payload:e}),typeof e.payload=="string"){const c=new TextEncoder;e.payload=c.encode(e.payload)}let o=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&Xe(n=["aes-128-gcm2","aes-256-gcm2"]).call(n,this._encryptionMode)&&(o=!0,e.payload=await async function(c,u,h){var m;const _=Da(m=Array.from(h)).call(m,(M,U)=>M+U,0),y={serverTs:0,seq:Ohe++,length:h.length,checkSum:_},S=new Uint8Array(tW(_,2)),w=new ArrayBuffer(Jy),I=new DataView(w);I.setUint32(0,y.serverTs),I.setUint16(4,y.seq),I.setUint16(6,y.length),I.setUint16(8,y.checkSum);const P=16-h.length%16;h=X6(h,new Uint8Array(P));const B=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:c,tagLength:pW,additionalData:S},u,h);return X6(new Uint8Array(w),new Uint8Array(B))}(this._encryptDataStreamIv,this._encryptDataStreamKey,e.payload)),new Blob([e.payload]).size>1024)throw new be(Y.INVALID_PARAMS,o?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(Dt.DATA_STREAM,{payload:Qp(e.payload),syncWithAudio:e.syncWithAudio,sendTs:Date.now()-gpe},!i)}sendMetadata(e){if(!this._joinInfo)throw new be(Y.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new be(Y.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(Dt.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:Qp(e)})}async sendCustomReportMessage(e){if(Array.isArray(e)||(e=[e]),e.forEach(Vhe),!this._joinInfo)throw new be(Y.INVALID_OPERATION,"can not send custom report, not joined");await yt.sendCustomReportMessage(this._joinInfo.sid,e)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(e,n){Ti(n.spatialLayer,"spatialLayer",[0,1,2,3]),Ti(n.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(e,n)}catch(i){throw k.error("[".concat(this._clientId,"] pick SVC layer failed"),i.toString()),i}}async setRTMConfig(e){const{apRTM:n=!1,rtmFlag:i}=e;if(wf(n,"apRTM"),Jn(i,"rtmFlag",0),this._rtmConfig.apRTM=n,this._rtmConfig.rtmFlag=i,k.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(e)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=n,this._joinInfo.rtmFlag=i,this._gateway.setRTM2Flag(i)}_reset(){if(k.debug("[".concat(this._clientId,"] reset client")),function(e){const n=uv.indexOf(e);n!==-1&&uv.splice(n,1)}(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this._axiosCancelSource.cancel(),this._axiosCancelSource=Mo.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&o8(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&yt.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(e=>{e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy(),e._dataChannels&&(e._dataChannels.forEach(n=>n._close()),e._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new Es("client-publish",this._clientId),this._subscribeMutex=new Es("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(e,n){var i;const o=e||Zg();e?k.debug("[".concat(this._clientId,"] new Session ").concat(o)):k.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(o));const c=e?"":this._sessionId||"";this._sessionId=o,this.store.sessionId=o,yt.addSid(o);const u={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:(n==null?void 0:n.stringUid)||((i=this._joinInfo)===null||i===void 0?void 0:i.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:c,clientRole:this.role==="audience"?2:1};yt.sessionInit(this._sessionId,Jl({cname:n.channel,appid:n.appId},u)),this._joinInfo&&(this._joinInfo.sid=o),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=o)}async _publishHighStream(e){if(!this._joinInfo||this._uid===void 0)throw new be(Y.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new be(Y.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&Z("FORCE_TURN")&&!Z("TURN_ENABLE_TCP")&&!Z("TURN_ENABLE_UDP"))throw new be(Y.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");k.debug("[".concat(this._clientId,"] publish high stream"));try{const i=await this._p2pChannel.publish(e,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){const o=(await i.next()).value;if(o){try{await this._gateway.sendExtensionMessage(Yr.PUBLISH,o,!0)}catch(c){throw i.throw(c),c}await i.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const o=(await i.next()).value;if(o){var n;let c;try{c=await this._gateway.publish(this._uid,o,!0)}catch(u){if(u.code!==Y.DISCONNECT_P2P)throw i.throw(u),u}await i.next(((n=c)===null||n===void 0?void 0:n.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const c of e)c instanceof hr&&c._encoderConfig&&this._gateway.setVideoProfile(c._encoderConfig).catch(u=>{k.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))}),!c.muted&&c.enabled||await this._p2pChannel.muteLocalTrack(c)}}catch(i){if(this._p2pChannel.reportPublishEvent(!1,i==null?void 0:i.code,e),(i==null?void 0:i.code)===Y.WS_ABORT)return;throw i}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new be(Y.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new be(Y.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));k.debug("[".concat(this._clientId,"] publish low stream"));const e=this._configDistribute.getLowStreamConfigDistribute();e&&e.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&e.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=e.bitrate));try{const i=await this._p2pChannel.publishLowStream(this._lowStreamParameter),o=(await i.next()).value;if(o){var n;let c;try{c=await this._gateway.publish(this._uid,o,!0)}catch(u){if(u.code!==Y.DISCONNECT_P2P)throw i.throw(u),u}i.next(((n=c)===null||n===void 0?void 0:n.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(i){if(this._p2pChannel.reportPublishEvent(!1,i==null?void 0:i.code,void 0,!0),(i==null?void 0:i.code)===Y.WS_ABORT)return;throw i}}_createLiveStreamingClient(e){const n=()=>{if(!this._joinInfo||!this._appId)return new be(Y.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const i=(o={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},Nf("LiveStreaming").create(o));var o;return i.onLiveStreamError=(c,u)=>{yt.reportApiInvoke(this._sessionId,{name:fi.ON_LIVE_STREAM_ERROR,options:[c,u],tag:kr.TRACER}).onSuccess(),this.safeEmit(an.LIVE_STREAMING_ERROR,c,u)},i.onLiveStreamWarning=(c,u)=>{yt.reportApiInvoke(this._sessionId,{name:fi.ON_LIVE_STREAM_WARNING,options:[c,u],tag:kr.TRACER}).onSuccess(),this.safeEmit(an.LIVE_STREAMING_WARNING,c,u)},i.on(KL.REQUEST_WORKER_MANAGER_LIST,(c,u,h)=>{if(!this._joinInfo)return h(new be(Y.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(m,_,y,S){const w=Z("UAP_AP").slice(0,Z("AJAX_REQUEST_CONCURRENT")).map(I=>_.proxyServer?"https://".concat(_.proxyServer,"/ap/?url=").concat(I+"/api/v1?action=uap"):"https://".concat(I,"/api/v1?action=uap"));return await tpe(w,m,_,y,S)})(c,this._joinInfo,this._axiosCancelSource.token,pi).then(u).catch(h)}),i};return e===Af.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||n(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||n(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new be(Y.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:n,sendResolutionHeight:i}=this.getLocalVideoStats(),o=(e={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:n,height:i}},Nf("ChannelMediaRelay").create(e));o.on("state",c=>{c===ha.RELAY_STATE_FAILURE&&o&&o.dispose(),this.safeEmit(an.CHANNEL_MEDIA_RELAY_STATE,c)}),o.on("event",c=>{this.safeEmit(an.CHANNEL_MEDIA_RELAY_EVENT,c)}),this._channelMediaRelayClient=o,this._statsCollector.onStatsChanged=(c,u)=>{var h;c==="resolution"&&((h=this._channelMediaRelayClient)===null||h===void 0||h.setVideoProfile(u))}}var e;return this._channelMediaRelayClient}_handleUpdateDataChannel(e,n){const{added:i,deleted:o}=e,c=[];if(n){const u=[];this._users.forEach(h=>{h._dataChannels.forEach(m=>{i.every(_=>_.uid!==h._uintid||_.stream_id!==m.id)&&u.push({uid:h._uintid,stream_id:m.id,ordered:m.ordered,max_retrans_times:m.maxRetransmits,metadata:m.metadata})})}),u.length>0&&this._handleUpdateDataChannel({added:[],deleted:u})}Array.isArray(i)&&i.length>0&&i.forEach(u=>{const{uid:h,stream_id:m,ordered:_,max_retrans_times:y,metadata:S}=u,w=this._users.find(I=>I._uintid===h);if(!w)return void k.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(k.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(h)),Xe(c).call(c,w)||c.push(w),w._uintid||(w._uintid=h),w._dataChannels.findIndex(I=>I.id===u.stream_id)===-1){const I={id:m,ordered:!!_,maxRetransmits:y,metadata:S},P=function(B){return pH(B,!0)}(I);w._dataChannels.push(P),k.info("[".concat(this._clientId,"] remote user ").concat(w.uid," published datachannel")),n||this.safeEmit(an.USER_PUBLISHED,w,"datachannel",I)}this._p2pChannel.hasPendingRemoteDataChannel(w,u.stream_id)&&(k.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(w.uid," after reconnect.")),this._subscribeDataChannel(w,u.stream_id).catch(I=>{k.error("[".concat(this._clientId,"] resubscribe datachannel error"),I.toString())}))}),n&&(this.safeEmit(an.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(o)&&o.length>0&&o.forEach(u=>{const{uid:h,stream_id:m}=u,_=this._users.find(S=>S._uintid===h);if(!_)return void k.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const y=_._dataChannels.find(S=>S.id===u.stream_id);y&&(k.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(h)),this._p2pChannel.unsubscribeDataChannel(_,[y]).then(S=>{if(_._dataChannels=_._dataChannels.filter(w=>w!==y),S)return this._gateway.unsubscribeDataChannel(S,_.uid)}),k.info("[".concat(this._clientId,"] remote user ").concat(h," unpublished datachannel ,id:").concat(y.id)),this.safeEmit(an.USER_UNPUBLISHED,_,"datachannel",y._config))})}_handleRemoveDataChannels(e){const n=this._users.find(i=>i.uid===e.uid);if(n){if(n._dataChannels!==void 0&&n._dataChannels.length>0){k.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(e.uid));const i=()=>{k.info("[".concat(this._clientId,"] remote user ").concat(n.uid," unpublished datachannel")),n._dataChannels.forEach(o=>{this.safeEmit(an.USER_UNPUBLISHED,n,"datachannel",o._config)})};this._p2pChannel.unsubscribeDataChannel(n,n._dataChannels).then(o=>{if(o)return this._gateway.unsubscribeDataChannel(o,n.uid)}),i()}}else k.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(ji.UPDATE_GATEWAY_CONFIG,()=>{(function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(n){return void k.error("Error loading sdk config",n.message)}if(e)try{const n=JSON.parse(window.atob(e)),i=Date.now();Object.keys(n).forEach(o=>{const{value:c,type:u,expires:h}=n[o];h&&h<=i||u||FL()||!Object.prototype.hasOwnProperty.call(oA,o)||($u[o]=c,dr[o]=c,k.debug("Update gateway parameters from config distribute",o,c))})}catch(n){k.error("Error update config from local cache",n.message)}})()}),this._gateway.on(ji.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(ji.CONNECTION_STATE_CHANGE,(e,n,i)=>{var o;if(i===Vn.FALLBACK)return;const c=()=>{this.safeEmit(an.CONNECTION_STATE_CHANGE,e,n,i)};if(yt.reportApiInvoke(this._sessionId||((o=this._gateway.joinInfo)===null||o===void 0?void 0:o.sid)||null,{name:fi.CONNECTION_STATE_CHANGE,options:[e,n,i],tag:kr.TRACER}).onSuccess(JSON.stringify({cur:e,prev:n,reason:i})),k.info("[".concat(this._clientId,"] signal connection state change: ").concat(n," -> ").concat(e)),e==="DISCONNECTED")return this._reset(),void c();if(e==="RECONNECTING")this._users.forEach(h=>{h._trust_in_room_=!1,h._trust_audio_enabled_state_=!1,h._trust_video_enabled_state_=!1,h._trust_audio_mute_state_=!1,h._trust_video_mute_state_=!1,h._trust_audio_stream_added_state_=!1,h._trust_video_stream_added_state_=!1,h._is_pre_created||(h._audio_pre_subscribed||(h._audioSSRC=void 0,h._audioOrtc=void 0),h._video_pre_subscribed||(h._videoSSRC=void 0,h._videoOrtc=void 0,h._rtxSsrcId=void 0),h._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(e==="CONNECTED"){var u;this._streamFallbackTypeCacheMap.forEach((h,m)=>{this._gateway.setStreamFallbackOption(m,h).catch(_=>{k.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),_)})}),this._remoteStreamTypeCacheMap.forEach((h,m)=>{this._gateway.setRemoteVideoStreamType(m,h).catch(_=>{k.warning("[".concat(this._clientId,"] auto set remote stream type failed"),_)})}),this._remoteDefaultVideoStreamType!==void 0&&((u=this._joinInfo)===null||u===void 0?void 0:u.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{k.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(h=>{k.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(h))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(h=>!h._trust_in_room_).forEach(h=>{k.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(h.uid)),this._handleUserOffline({uid:h.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(h=>{h._trust_audio_mute_state_||(k.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(h.uid)),this._handleMuteStream(h.uid,at.AUDIO,!1)),h._trust_video_mute_state_||(k.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(h.uid)),this._handleMuteStream(h.uid,at.VIDEO,!1)),h._trust_audio_enabled_state_||(k.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(h.uid)),this._handleSetStreamLocalEnable("audio",h.uid,!0)),h._trust_video_enabled_state_||(k.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(h.uid)),this._handleSetStreamLocalEnable("video",h.uid,!0)),h._trust_video_stream_added_state_||(k.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(h.uid)),this._handleResetAddStream(h,"video")),h._trust_audio_stream_added_state_||(k.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(h.uid)),this._handleResetAddStream(h,"audio")),h._video_added_||h._audio_added_||(k.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(h.uid)),this._handleRemoveStream({uid:h.uid,uint_id:h._uintid}))}))},1e3))}c()}),this._gateway.on(ji.REQUEST_NEW_GATEWAY_LIST,async(e,n)=>{if(!this._joinInfo)return n(new be(Y.UNEXPECTED_ERROR,"can not recover, no join info"));try{let i;const o=await i8(Jl(Jl({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));o?(i=o.ap,a8(o),this._joinInfo.preload=!0):(i=await cx(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||pi,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=i.gatewayInfo.res,this._joinInfo.gatewayAddrs=i.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=i.gatewayInfo.uni_lbs_ip);const c=[];i.gatewayInfo.gatewayAddrs.forEach(u=>{let{address:h}=u;const[m,_]=h.split(":");this._joinInfo&&this._joinInfo.proxyServer?c.push({proxy:this._joinInfo.proxyServer,host:m,port:_}):c.push({host:m,port:_})}),e(c)}catch(i){n(i)}}),this._gateway.on(ji.NETWORK_QUALITY,e=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(an.NETWORK_QUALITY,e)}),this._gateway.on(ji.STREAM_TYPE_CHANGE,(e,n)=>{this.safeEmit(an.STREAM_TYPE_CHANGED,e,n),yt.reportApiInvoke(this._sessionId,{name:fi.STREAM_TYPE_CHANGE,options:[e,n],tag:kr.TRACER}).onSuccess(JSON.stringify({uid:e,streamType:n}))}),this._gateway.on(ji.IS_P2P_DISCONNECTED,e=>{this._p2pChannel.isP2PDisconnected()?e(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?e(!1):e(!0)}),this._gateway.on(ji.REQUEST_P2P_CONNECTION_PARAMS,async(e,n,i)=>{try{let o=await this._p2pChannel.getEstablishParams();Z("ENABLE_PREALLOC_PC")&&o||(o=await this._p2pChannel.startP2PConnection(e)),n(o)}catch(o){i(o)}}),this._gateway.on(ji.JOIN_RESPONSE,(e,n)=>{if(this.store.useP2P)return;let i;e.attributes?i=e.attributes.userAttributes.preSubSsrcs:k.debug("no attributes in joinResponse");const o=nH(e.ortc,n,i);this._p2pChannel.connect(o)}),this._gateway.on(ji.PRE_CONNECT_PC,async e=>{const{candidates:n,fingerprint:i}=e;if(this._joinInfo&&n.length>0&&!this._p2pChannel.isPlanB){var o;await this._p2pChannel.startP2PConnection({turnServer:this._joinInfo.turnServer});const{cert:c,cid:u}=this._joinInfo.apResponse;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(u,"_").concat(c),icePwd:"".concat(u,"_").concat(c)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(o=Z("FINGERPRINT"))!==null&&o!==void 0?o:i}]},candidates:n,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}})}_handleGatewaySignalEvents(){this._gateway.signal.on(ln.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(ln.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(ln.ON_ADD_AUDIO_STREAM,e=>this._handleAddAudioOrVideoStream("audio",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc)),this._gateway.signal.on(ln.ON_ADD_VIDEO_STREAM,e=>this._handleAddAudioOrVideoStream("video",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc,e.rtxSsrcId)),this._gateway.signal.on(ln.ON_REMOTE_DATASTREAM_UPDATE,e=>{this._handleUpdateDataChannel(e)}),this._gateway.signal.on(ln.ON_REMOTE_FULL_DATASTREAM_INFO,e=>{this._handleUpdateDataChannel({added:e.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(ln.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(ln.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(ln.MUTE_AUDIO,e=>this._handleMuteStream(e.uid,at.AUDIO,!0)),this._gateway.signal.on(ln.UNMUTE_AUDIO,e=>this._handleMuteStream(e.uid,at.AUDIO,!1)),this._gateway.signal.on(ln.MUTE_VIDEO,e=>this._handleMuteStream(e.uid,at.VIDEO,!0)),this._gateway.signal.on(ln.UNMUTE_VIDEO,e=>this._handleMuteStream(e.uid,at.VIDEO,!1)),this._gateway.signal.on(ln.RECEIVE_METADATA,e=>{const n=Qg(e.metadata);this.safeEmit(an.RECEIVE_METADATA,e.uid,n)}),this._gateway.signal.on(ln.ON_DATA_STREAM,async e=>{var n;if(!e)return;let i=Qg(e.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&Xe(n=["aes-128-gcm2","aes-256-gcm2"]).call(n,this._encryptionMode)){if(e.payload.length<Jy)throw new be(Y.UNEXPECTED_RESPONSE,"payload length ".concat(e.payload.length," is less than header length ").concat(Jy));i=await async function(u,h,m){const _=m.subarray(0,Jy),y=_.slice(8,Jy),S=(y[0]<<8)+y[1],w=(_[6]<<8)+_[7],I=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:u,tagLength:pW,additionalData:new Uint8Array(tW(S,2))},h,m.subarray(Jy));return new Uint8Array(I).subarray(0,w)}(this._encryptDataStreamIv,this._encryptDataStreamKey,i)}let o=0;if(e.ordered||e.syncWithAudio){const c=this._p2pChannel.getStats(),u=this.remoteUsers.find(m=>m.uid===e.uid),h=c==null?void 0:c.audioRecv.find(m=>m.ssrc===(u==null?void 0:u._audioSSRC));o=h==null?void 0:h.jitterBufferMs}(o==null||Number.isNaN(o))&&(o=0),Epe(Jl(Jl({},e),{},{payload:i}),o,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(ln.ON_CRYPT_ERROR,()=>{Jp(()=>{k.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(an.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(ln.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(ln.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{k.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,Vn.TOKEN_EXPIRE),this.safeEmit(an.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(ln.ON_STREAM_FALLBACK_UPDATE,e=>{k.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(e.stream_id,", attr: ").concat(e.stream_type)),this.safeEmit(an.STREAM_FALLBACK,e.stream_id,e.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(ln.ON_PUBLISH_STREAM,e=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:e.proxy})),k.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(e))))}),this._gateway.signal.on(ln.ENABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!0)}),this._gateway.signal.on(ln.DISABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!1)}),this._gateway.signal.on(Lt.REQUEST_TIMEOUT,(e,n)=>{if(this._joinInfo)switch(e){case Dt.PUBLISH:{if(!n)return;const c=n.ortc;if(c){var i,o;const u=c.some(_=>{let{stream_type:y}=_;return y===jn.Audio}),h=c.some(_=>{let{stream_type:y}=_;return y!==jn.Audio}),m=c.some(_=>{let{stream_type:y}=_;return y===jn.Screen||y===jn.ScreenLow});n.state==="offer"&&yt.publish(this._joinInfo.sid,{eventElapse:Ss.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:Y.TIMEOUT,audio:u,video:h,p2pid:n.p2p_id,publishRequestid:this.store.pubId,screenshare:m,audioName:u?(i=c.find(_=>{let{stream_type:y}=_;return y===jn.Audio}))===null||i===void 0||(i=i.ssrcs[0])===null||i===void 0?void 0:i.ssrcId.toString():void 0,videoName:h?(o=c.find(_=>{let{stream_type:y}=_;return y!==jn.Audio}))===null||o===void 0||(o=o.ssrcs[0])===null||o===void 0?void 0:o.ssrcId.toString():void 0})}break}case Dt.SUBSCRIBE:n&&yt.subscribe(this._joinInfo.sid,{succ:!1,ec:Y.TIMEOUT,audio:n.stream_type===at.AUDIO,video:n.stream_type===at.VIDEO,peerid:n.stream_id,subscribeRequestid:n.ssrcId,p2pid:this.store.p2pId,eventElapse:Ss.measureFromSubscribeStart(this.store.clientId,n.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(n.ssrcId)})}}),this._gateway.signal.on(ln.ON_P2P_OK,e=>{this.uid,this._uid}),this._gateway.signal.on(ln.ON_PUBLISHED_USER_LIST,e=>{if(e==null||!e.users)return;Z("BLOCK_LOCAL_CLIENT")&&(e.users=e.users.filter(o=>!a_(o.string_id||o.stream_id,this.channelName)));const n=[],i=[];for(const o of e.users){let c=this._users.find(S=>S._uintid===o.stream_id);c?c._trust_in_room_=!0:(c=new om(o.string_id||o.stream_id,o.stream_id),this._users.push(c),this.getListeners(an.PUBLISHED_USER_LIST).length===0&&(k.debug("[".concat(this._clientId,"] user online"),o.stream_id),this.safeEmit(an.USER_JOINED,c)));const u=Pi.Audio&o.stream_type,h=(Pi.Video|Pi.LwoVideo)&o.stream_type,m=(65280&o.stream_type)!=0,_=u&&c.hasAudio,y=h&&c.hasVideo;h&&(c._trust_video_stream_added_state_=!0,c._video_added_=!0,c._videoSSRC=o.video_ssrc,c._rtxSsrcId=o.video_rtx),u&&(c._trust_audio_stream_added_state_=!0,c._audio_added_=!0,c._audioSSRC=o.audio_ssrc),u&&!_&&this.getListeners(an.PUBLISHED_USER_LIST).length===0&&(k.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published audio")),this.safeEmit(an.USER_PUBLISHED,c,"audio")),h&&!y&&this.getListeners(an.PUBLISHED_USER_LIST).length===0&&(k.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published video")),this.safeEmit(an.USER_PUBLISHED,c,"video")),(u&&!_||h&&!y||m)&&n.push(c),h&&this._p2pChannel.hasPendingRemoteMedia(c,"video")&&i.push({user:c,mediaType:"video"}),u&&this._p2pChannel.hasPendingRemoteMedia(c,"audio")&&i.push({user:c,mediaType:"audio"})}i.length>0&&(k.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(i.map(o=>"user: ".concat(o.user.uid,", mediaType: ").concat(o.mediaType)).join("; ")," ")),this.massSubscribe(i).catch(o=>{k.error("[".concat(this._clientId,"] mass resubscribe error"),o.toString())})),this.getListeners(an.PUBLISHED_USER_LIST).length>0?Z("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=n:(k.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(n.map(o=>o.uid).join(", "))),this.safeEmit(an.PUBLISHED_USER_LIST,n)):k.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(n.map(o=>o.uid).join(", ")))}),this._gateway.signal.on(ln.ON_RTP_CAPABILITY_CHANGE,e=>{const{video_codec:n}=e;this._p2pChannel instanceof Z0&&this._p2pChannel.updateRemoteRTPCapabilities(n.map(i=>i.toLowerCase()).filter(i=>{var o;return Xe(o=Object.keys(aA)).call(o,i)}))})}_handleP2PEvents(){this._gateway.signal.on(ln.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(Yr.PUBLISH,(e,n,i)=>{const{uid:o}=e;e.forEach(c=>{const{kind:u,ssrcs:h,mid:m,isMuted:_}=c;this._handleP2PAddAudioOrVideoStream(u,o,h[0].ssrcId,m);const y=this._users.find(S=>S.uid===o);return y&&this.store.useP2P?this._p2pChannel.mockSubscribe(y,u,h[0].ssrcId,m).then(()=>{n()}).catch(i):n(),this._handleMuteStream(o,u,!!_)})}),this._gateway.signal.on(Yr.CALL,async(e,n,i)=>{if(this.store.useP2P)try{var o;n(await this._p2pChannel.startP2P({turnServer:(o=this._joinInfo)===null||o===void 0?void 0:o.turnServer},e))}catch(c){i(c)}}),this._gateway.signal.on(Lt.P2P_CONNECTION,async e=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(e)}),this._gateway.signal.on(Yr.UNPUBLISH,async(e,n,i)=>{if(this.store.useP2P){const{unpubMsg:o,uid:c}=e,u=this._users.find(h=>h.uid===c);if(!u)return k.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(c)),void n();try{o.forEach(async h=>{let{stream_type:m}=h;const _=m===jn.Audio?at.AUDIO:at.VIDEO;await this._p2pChannel.unsubscribe(u,_),this._handleMuteStream(c,_,!0)}),n()}catch(h){i(h)}}}),this._gateway.signal.on(Yr.CONTROL,async(e,n)=>{const{action:i}=e;switch(i){case tm.MUTE_LOCAL_VIDEO:this._handleMuteStream(n,at.VIDEO,!0);break;case tm.MUTE_LOCAL_AUDIO:this._handleMuteStream(n,at.AUDIO,!0);break;case tm.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",n),this._handleMuteStream(n,at.VIDEO,!1);break;case tm.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",n),this._handleMuteStream(n,at.AUDIO,!1)}}),this._gateway.signal.on(Yr.RESTART_ICE,async(e,n,i)=>{if(this.store.useP2P)try{const{direction:o,iceParameter:c}=e;o!==ho.SEND_ONLY||c?n(await this._p2pChannel.restartICE(o,c)):(this._p2pChannel.handleDisconnect(o),n())}catch(o){i(o)}}),this._gateway.signal.on(Yr.CANDIDATE,e=>{if(this.store.useP2P){const{candidate:n,direction:i}=e;this._p2pChannel.addRemoteCandidate(n,i)}}),this._p2pChannel.on(bt.RequestP2PRestartICE,async(e,n,i)=>{try{const{direction:o}=e;n(await this._gateway.sendExtensionMessage(Yr.RESTART_ICE,e,o===ho.SEND_ONLY))}catch(o){i(o)}}),this._p2pChannel.on(bt.LocalCandidate,e=>{this._gateway.sendExtensionMessage(Yr.CANDIDATE,JSON.stringify(e),!0)}),this._p2pChannel.on(bt.RequestP2PMuteLocal,async(e,n,i)=>{try{await this._gateway.sendExtensionMessage(Yr.CONTROL,e,!0),n()}catch(o){i(o)}}),this._p2pChannel.on(bt.RequestP2PUnmuteRemote,async(e,n,i)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),n()}catch(o){o.code===Y.DISCONNECT_P2P?n():i(o)}else n()}),this._p2pChannel.on(bt.RequestP2PMuteRemote,async(e,n,i)=>{if(this._joinInfo)try{await this._gateway.muteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),n()}catch(o){o.code===Y.DISCONNECT_P2P?n():i(o)}else n()}),this._p2pChannel.on(bt.StateChange,(e,n)=>{n===Fn.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(bt.PeerConnectionStateChange,e=>{const n=this._peerConnectionState;e!==n&&(this.safeEmit(an.PEERCONNECTION_STATE_CHANGE,e,n),this._peerConnectionState=e)}),this._p2pChannel.on(bt.RequestMuteLocal,async(e,n,i)=>{if(this._joinInfo)try{await this._gateway.muteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),n()}catch(o){o.code===Y.DISCONNECT_P2P?n():i(o)}else n()}),this._p2pChannel.on(bt.RequestUnmuteLocal,async(e,n,i)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),n()}catch(o){o.code===Y.DISCONNECT_P2P?n():i(o)}else n()}),this._p2pChannel.on(bt.RequestRePublish,(e,n,i)=>{this.publish(e,!1).then(n).catch(i)}),this._p2pChannel.on(bt.RequestRePublishDataChannel,(e,n,i)=>{tt.all(e.map(async o=>{const c=await this._p2pChannel.publishDataChannel([o]);try{c.forEach(u=>{this._uid&&this._gateway.publishDataChannel(this._uid,u,!0)})}catch(u){if(u.code!==Y.DISCONNECT_P2P)throw u}})).then(n).catch(i)}),this._p2pChannel.on(bt.RequestReSubscribe,async(e,n,i)=>{try{for(const{user:o,kind:c}of e)c===at.VIDEO?await this.subscribe(o,"video"):await this.subscribe(o,"audio");n()}catch(o){i(o)}}),this._p2pChannel.on(bt.RequestUpload,(e,n)=>{this._gateway.upload(e,n)}),this._p2pChannel.on(bt.RequestUploadStats,e=>{this._gateway.uploadWRTCStats(e)}),this._p2pChannel.on(bt.MediaReconnectStart,e=>{this.safeEmit(an.MEDIA_RECONNECT_START,e)}),this._p2pChannel.on(bt.MediaReconnectEnd,e=>{this.safeEmit(an.MEDIA_RECONNECT_END,e)}),this._p2pChannel.on(bt.NeedSignalRTT,e=>{e(this._gateway.getSignalRTT())}),this._p2pChannel.on(bt.RequestRestartICE,async e=>{if(this.store.useP2P)return;const n=await this._p2pChannel.restartICE(e),i=await n.next();if(i.done)return;const o=i.value;let c;try{c=await this._gateway.restartICE({iceParameters:o})}catch(h){return void n.throw(h)}const{iceParameters:u}=function(h){const m=h.iceParameters;return{iceParameters:{iceUfrag:m.iceUfrag,icePwd:m.icePwd}}}(c);await n.next({remoteIceParameters:u})}),this._p2pChannel.on(bt.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(bt.RequestReconnectPC,async()=>{var e;const{iceParameters:n,dtlsParameters:i,rtpCapabilities:o}=await this._p2pChannel.startP2PConnection({turnServer:(e=this._joinInfo)===null||e===void 0?void 0:e.turnServer}),{gatewayEstablishParams:c,gatewayAddress:u}=await this._gateway.reconnectPC({iceParameters:n,dtlsParameters:i,rtpCapabilities:o}),h=nH(c,u);await this._p2pChannel.connect(h),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(bt.RequestUnpublishForReconnectPC,async(e,n,i)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(e,this._uid),n()):i()}),this._p2pChannel.on(bt.P2PLost,()=>{this.safeEmit(an.P2P_LOST,this.store.uid)}),this._p2pChannel.on(bt.UpdateVideoEncoder,e=>{e._encoderConfig&&this._gateway.setVideoProfile(e._encoderConfig)}),this._p2pChannel.on(bt.ConnectionTypeChange,e=>{this.safeEmit(an.IS_USING_CLOUD_PROXY,e)}),this._p2pChannel.on(bt.RequestLowStreamParameter,e=>{e(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(bt.QueryClientConnectionState,e=>{e(this.connectionState)}),this._p2pChannel.on(bt.AudioMetadata,e=>{this.safeEmit(an.AUDIO_METADATA,e)})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(e){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new be(Y.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new be(Y.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{const i=(n={config:e},Nf("ContentInspect").create(n));this._inspect=i,this.handleVideoInspectEvents(i);const{appId:o,cname:c,sid:u,token:h,uid:m,cid:_,vid:y}=this._joinInfo;await i.init({appId:o,areaCode:"",cname:c,sid:u,token:h,uid:m,cid:_,vid:y?Number(y):0},pi)}catch(i){throw Array.isArray(i)?i[0]:i}var n}handleVideoInspectEvents(e){e.on(Bi.CONNECTION_STATE_CHANGE,(n,i)=>{if(this.safeEmit(an.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,n,i),i===ql.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(an.CONTENT_INSPECT_ERROR,new be(Y.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}}),e.on(Bi.INSPECT_RESULT,(n,i)=>{var o;if((i==null?void 0:i.code)===Y.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return k.debug("Stop inspect content because that has left channel"),this==null||(o=this._inspect)===null||o===void 0||o.close(),void(this._inspect=void 0);this.safeEmit(an.CONTENT_INSPECT_RESULT,n,i)}),e.on(Bi.CLIENT_LOCAL_VIDEO_TRACK,n=>{n(this.localTracks.filter(i=>i.trackMediaType==="video")[0])})}async disableContentInspect(){if(!this._inspect)throw new be(Y.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}async setImageModeration(e,n){if(wf(e,"enabled"),e){if(!n)throw new be(Y.INVALID_PARAMS,"config is required");if(v8(n),!this._joinInfo)throw new be(Y.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(n);else{const o=(i={config:n},Nf("ImageModeration").create(i));this._moderation=o,this.handleImageModerationEvents(o);const{appId:c,cname:u,sid:h,token:m,uid:_,cid:y,vid:S}=this._joinInfo;await o.init({appId:c,areaCode:"",cname:u,sid:h,token:m,uid:_,cid:y,vid:S?Number(S):0},pi)}}catch(o){throw Array.isArray(o)?o[0]:o}}else{var i;if(!this._moderation)throw new be(Y.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(o){throw Array.isArray(o)?o[0]:o}}}handleImageModerationEvents(e){e.on(Ju.CONNECTION_STATE_CHANGE,(n,i)=>{if(this.safeEmit(an.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,n,i),n===il.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new be(Y.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");e.inspectImage()}}),e.on(Ju.CLIENT_LOCAL_VIDEO_TRACK,n=>{n(this.localTracks.filter(i=>i.trackMediaType==="video")[0])})}setP2PTransport(e){if(function(n){Ti(n,"transport",["default","auto","relay","sd-rtn"])}(e),this.mode!=="p2p")throw new be(Y.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=e,k.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(e))}getJoinChannelServiceRecords(){return k.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(e){wf(e,"enabled"),qn("ENABLE_PUBLISH_AUDIO_FILTER",e),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(e)}_handleResetAddStream(e,n){switch(n){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}}},ht(rt.prototype,"leave",[S8],Object.getOwnPropertyDescriptor(rt.prototype,"leave"),rt.prototype),ht(rt.prototype,"publish",[T8],Object.getOwnPropertyDescriptor(rt.prototype,"publish"),rt.prototype),ht(rt.prototype,"unpublish",[b8],Object.getOwnPropertyDescriptor(rt.prototype,"unpublish"),rt.prototype),ht(rt.prototype,"subscribe",[w8],Object.getOwnPropertyDescriptor(rt.prototype,"subscribe"),rt.prototype),ht(rt.prototype,"presubscribe",[R8],Object.getOwnPropertyDescriptor(rt.prototype,"presubscribe"),rt.prototype),ht(rt.prototype,"massSubscribe",[C8],Object.getOwnPropertyDescriptor(rt.prototype,"massSubscribe"),rt.prototype),ht(rt.prototype,"unsubscribe",[I8],Object.getOwnPropertyDescriptor(rt.prototype,"unsubscribe"),rt.prototype),ht(rt.prototype,"massUnsubscribe",[A8],Object.getOwnPropertyDescriptor(rt.prototype,"massUnsubscribe"),rt.prototype),ht(rt.prototype,"setLowStreamParameter",[O8],Object.getOwnPropertyDescriptor(rt.prototype,"setLowStreamParameter"),rt.prototype),ht(rt.prototype,"enableDualStream",[P8],Object.getOwnPropertyDescriptor(rt.prototype,"enableDualStream"),rt.prototype),ht(rt.prototype,"disableDualStream",[N8],Object.getOwnPropertyDescriptor(rt.prototype,"disableDualStream"),rt.prototype),ht(rt.prototype,"setClientRole",[k8],Object.getOwnPropertyDescriptor(rt.prototype,"setClientRole"),rt.prototype),ht(rt.prototype,"_setClientRoleOptions",[D8],Object.getOwnPropertyDescriptor(rt.prototype,"_setClientRoleOptions"),rt.prototype),ht(rt.prototype,"setProxyServer",[L8],Object.getOwnPropertyDescriptor(rt.prototype,"setProxyServer"),rt.prototype),ht(rt.prototype,"setTurnServer",[x8],Object.getOwnPropertyDescriptor(rt.prototype,"setTurnServer"),rt.prototype),ht(rt.prototype,"setLicense",[M8],Object.getOwnPropertyDescriptor(rt.prototype,"setLicense"),rt.prototype),ht(rt.prototype,"startProxyServer",[U8],Object.getOwnPropertyDescriptor(rt.prototype,"startProxyServer"),rt.prototype),ht(rt.prototype,"stopProxyServer",[V8],Object.getOwnPropertyDescriptor(rt.prototype,"stopProxyServer"),rt.prototype),ht(rt.prototype,"setLocalAccessPointsV2",[F8],Object.getOwnPropertyDescriptor(rt.prototype,"setLocalAccessPointsV2"),rt.prototype),ht(rt.prototype,"setLocalAccessPoints",[j8],Object.getOwnPropertyDescriptor(rt.prototype,"setLocalAccessPoints"),rt.prototype),ht(rt.prototype,"setRemoteDefaultVideoStreamType",[B8],Object.getOwnPropertyDescriptor(rt.prototype,"setRemoteDefaultVideoStreamType"),rt.prototype),ht(rt.prototype,"setRemoteVideoStreamType",[W8],Object.getOwnPropertyDescriptor(rt.prototype,"setRemoteVideoStreamType"),rt.prototype),ht(rt.prototype,"setStreamFallbackOption",[G8],Object.getOwnPropertyDescriptor(rt.prototype,"setStreamFallbackOption"),rt.prototype),ht(rt.prototype,"setEncryptionConfig",[z8],Object.getOwnPropertyDescriptor(rt.prototype,"setEncryptionConfig"),rt.prototype),ht(rt.prototype,"renewToken",[H8],Object.getOwnPropertyDescriptor(rt.prototype,"renewToken"),rt.prototype),ht(rt.prototype,"enableAudioVolumeIndicator",[K8],Object.getOwnPropertyDescriptor(rt.prototype,"enableAudioVolumeIndicator"),rt.prototype),ht(rt.prototype,"startLiveStreaming",[q8],Object.getOwnPropertyDescriptor(rt.prototype,"startLiveStreaming"),rt.prototype),ht(rt.prototype,"setLiveTranscoding",[$8],Object.getOwnPropertyDescriptor(rt.prototype,"setLiveTranscoding"),rt.prototype),ht(rt.prototype,"stopLiveStreaming",[Y8],Object.getOwnPropertyDescriptor(rt.prototype,"stopLiveStreaming"),rt.prototype),ht(rt.prototype,"startChannelMediaRelay",[X8],Object.getOwnPropertyDescriptor(rt.prototype,"startChannelMediaRelay"),rt.prototype),ht(rt.prototype,"updateChannelMediaRelay",[J8],Object.getOwnPropertyDescriptor(rt.prototype,"updateChannelMediaRelay"),rt.prototype),ht(rt.prototype,"stopChannelMediaRelay",[Q8],Object.getOwnPropertyDescriptor(rt.prototype,"stopChannelMediaRelay"),rt.prototype),ht(rt.prototype,"sendCustomReportMessage",[Z8],Object.getOwnPropertyDescriptor(rt.prototype,"sendCustomReportMessage"),rt.prototype),ht(rt.prototype,"pickSVCLayer",[e9],Object.getOwnPropertyDescriptor(rt.prototype,"pickSVCLayer"),rt.prototype),ht(rt.prototype,"setRTMConfig",[t9],Object.getOwnPropertyDescriptor(rt.prototype,"setRTMConfig"),rt.prototype),ht(rt.prototype,"enableContentInspect",[n9],Object.getOwnPropertyDescriptor(rt.prototype,"enableContentInspect"),rt.prototype),ht(rt.prototype,"disableContentInspect",[r9],Object.getOwnPropertyDescriptor(rt.prototype,"disableContentInspect"),rt.prototype),ht(rt.prototype,"setImageModeration",[i9],Object.getOwnPropertyDescriptor(rt.prototype,"setImageModeration"),rt.prototype),ht(rt.prototype,"setP2PTransport",[s9],Object.getOwnPropertyDescriptor(rt.prototype,"setP2PTransport"),rt.prototype),ht(rt.prototype,"getJoinChannelServiceRecords",[o9],Object.getOwnPropertyDescriptor(rt.prototype,"getJoinChannelServiceRecords"),rt.prototype),ht(rt.prototype,"setPublishAudioFilterEnabled",[a9],Object.getOwnPropertyDescriptor(rt.prototype,"setPublishAudioFilterEnabled"),rt.prototype),rt);class nb{constructor(n,i){K(this,"id",0),K(this,"element",void 0),K(this,"peerPair",void 0),K(this,"context",void 0),K(this,"audioPlayerElement",void 0),K(this,"audioTrack",void 0),nb.count+=1,this.id=nb.count,this.element=n,this.context=i}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=n=>{const i=document.createElement("audio");i.srcObject=new MediaStream([n.track]),i.play(),this.audioPlayerElement=i}}async switchSdp(){if(!this.peerPair)return;const n=async(o,c)=>{const u=c==="offer"?await o.createOffer():await o.createAnswer();return await o.setLocalDescription(u),o.iceGatheringState==="complete"?o.localDescription:new tt(h=>{o.onicegatheringstatechange=()=>{o.iceGatheringState==="complete"&&h(o.localDescription)}})},i=async(o,c)=>await o.setRemoteDescription(c);try{const o=await n(this.peerPair[0],"offer");await i(this.peerPair[1],o);const c=await n(this.peerPair[1],"answer");await i(this.peerPair[0],c)}catch(o){throw new be(Y.LOCAL_AEC_ERROR,o.toString()).print()}}async getTracksFromMediaElement(n){if(this.audioTrack)return this.audioTrack;let i;try{n instanceof HTMLVideoElement&&(n.captureStream?n.captureStream():n.mozCaptureStream()),i=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(n).connect(i)}catch(c){throw new be(Y.LOCAL_AEC_ERROR,c.toString()).print()}if(!i)throw new be(Y.LOCAL_AEC_ERROR,"no dest node when local aec").print();const o=i.stream.getAudioTracks()[0];return this.audioTrack=o,o}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const n=this.element,i=await this.getTracksFromMediaElement(n);this.peerPair&&this.peerPair[0].addTrack(i),await this.switchSdp()}close(){k.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(n=>{n.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var l9,ZA;K(nb,"count",0);const xpe=window.AudioContext||window.webkitAudioContext,Mpe=new(l9=At({report:yt}),ht((ZA=class{constructor(){K(this,"units",[]),K(this,"context",void 0)}processExternalMediaAEC(e){if(!this._doesEnvironmentNeedAEC())return k.debug("the system does not need to process local aec"),-1;this.context||(this.context=new xpe);let n=this.units.find(i=>i&&i.getElement()===e);return n||(n=new nb(e,this.context),this.units.push(n)),n.startEchoCancellation(),k.debug("start processing local audio echo cancellation, id is",n.id),n.id}_doesEnvironmentNeedAEC(){return Tn().name!==Ln.SAFARI}}).prototype,"processExternalMediaAEC",[l9],Object.getOwnPropertyDescriptor(ZA.prototype,"processExternalMediaAEC"),ZA.prototype),ZA);function u9(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function d9(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?u9(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):u9(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}const wx=window||document;function h9(e){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!wx)return;const i=mi._cspEventHandlerPointer;if(i&&n)return void console.error(i,n);const o=c=>{if(!(c&&c.blockedURI&&(mi.onSecurityPolicyViolation||mi.getListeners($d.SECURITY_POLICY_VIOLATION).length>0)))return;const u=c.blockedURI;Z("CSP_DETECTED_HOSTNAME_LIST").some(h=>Xe(u).call(u,h))&&(mi.onSecurityPolicyViolation&&typeof mi.onSecurityPolicyViolation=="function"&&mi.onSecurityPolicyViolation(c),mi.getListeners($d.SECURITY_POLICY_VIOLATION).length>0&&mi.safeEmit($d.SECURITY_POLICY_VIOLATION,c))};i&&wx.removeEventListener("securitypolicyviolation",i),(n||e&&typeof e=="function"||mi.getListeners($d.SECURITY_POLICY_VIOLATION).length>0)&&wx.addEventListener("securitypolicyviolation",o),mi._cspEventHandlerPointer=o}var Upe=N,Vpe=Y5,f9=RegExp.prototype,Fpe=function(e){return e===f9||Upe(f9,e)?Vpe(e):e.flags},qs=l(Fpe);function wv(e){let n=e.length;for(;--n>=0;)e[n]=0}const Rx=256,p9=286,rb=30,ib=15,Cx=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),eO=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),jpe=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),m9=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Lf=new Array(576);wv(Lf);const sb=new Array(60);wv(sb);const ob=new Array(512);wv(ob);const ab=new Array(256);wv(ab);const Ix=new Array(29);wv(Ix);const tO=new Array(rb);function Ax(e,n,i,o,c){this.static_tree=e,this.extra_bits=n,this.extra_base=i,this.elems=o,this.max_length=c,this.has_stree=e&&e.length}let g9,_9,E9;function Ox(e,n){this.dyn_tree=e,this.max_code=0,this.stat_desc=n}wv(tO);const y9=e=>e<256?ob[e]:ob[256+(e>>>7)],cb=(e,n)=>{e.pending_buf[e.pending++]=255&n,e.pending_buf[e.pending++]=n>>>8&255},Ic=(e,n,i)=>{e.bi_valid>16-i?(e.bi_buf|=n<<e.bi_valid&65535,cb(e,e.bi_buf),e.bi_buf=n>>16-e.bi_valid,e.bi_valid+=i-16):(e.bi_buf|=n<<e.bi_valid&65535,e.bi_valid+=i)},Zd=(e,n,i)=>{Ic(e,i[2*n],i[2*n+1])},v9=(e,n)=>{let i=0;do i|=1&e,e>>>=1,i<<=1;while(--n>0);return i>>>1},S9=(e,n,i)=>{const o=new Array(16);let c,u,h=0;for(c=1;c<=ib;c++)h=h+i[c-1]<<1,o[c]=h;for(u=0;u<=n;u++){let m=e[2*u+1];m!==0&&(e[2*u]=v9(o[m]++,m))}},T9=e=>{let n;for(n=0;n<p9;n++)e.dyn_ltree[2*n]=0;for(n=0;n<rb;n++)e.dyn_dtree[2*n]=0;for(n=0;n<19;n++)e.bl_tree[2*n]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},b9=e=>{e.bi_valid>8?cb(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},w9=(e,n,i,o)=>{const c=2*n,u=2*i;return e[c]<e[u]||e[c]===e[u]&&o[n]<=o[i]},Px=(e,n,i)=>{const o=e.heap[i];let c=i<<1;for(;c<=e.heap_len&&(c<e.heap_len&&w9(n,e.heap[c+1],e.heap[c],e.depth)&&c++,!w9(n,o,e.heap[c],e.depth));)e.heap[i]=e.heap[c],i=c,c<<=1;e.heap[i]=o},R9=(e,n,i)=>{let o,c,u,h,m=0;if(e.sym_next!==0)do o=255&e.pending_buf[e.sym_buf+m++],o+=(255&e.pending_buf[e.sym_buf+m++])<<8,c=e.pending_buf[e.sym_buf+m++],o===0?Zd(e,c,n):(u=ab[c],Zd(e,u+Rx+1,n),h=Cx[u],h!==0&&(c-=Ix[u],Ic(e,c,h)),o--,u=y9(o),Zd(e,u,i),h=eO[u],h!==0&&(o-=tO[u],Ic(e,o,h)));while(m<e.sym_next);Zd(e,256,n)},Nx=(e,n)=>{const i=n.dyn_tree,o=n.stat_desc.static_tree,c=n.stat_desc.has_stree,u=n.stat_desc.elems;let h,m,_,y=-1;for(e.heap_len=0,e.heap_max=573,h=0;h<u;h++)i[2*h]!==0?(e.heap[++e.heap_len]=y=h,e.depth[h]=0):i[2*h+1]=0;for(;e.heap_len<2;)_=e.heap[++e.heap_len]=y<2?++y:0,i[2*_]=1,e.depth[_]=0,e.opt_len--,c&&(e.static_len-=o[2*_+1]);for(n.max_code=y,h=e.heap_len>>1;h>=1;h--)Px(e,i,h);_=u;do h=e.heap[1],e.heap[1]=e.heap[e.heap_len--],Px(e,i,1),m=e.heap[1],e.heap[--e.heap_max]=h,e.heap[--e.heap_max]=m,i[2*_]=i[2*h]+i[2*m],e.depth[_]=(e.depth[h]>=e.depth[m]?e.depth[h]:e.depth[m])+1,i[2*h+1]=i[2*m+1]=_,e.heap[1]=_++,Px(e,i,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((S,w)=>{const I=w.dyn_tree,P=w.max_code,B=w.stat_desc.static_tree,M=w.stat_desc.has_stree,U=w.stat_desc.extra_bits,q=w.stat_desc.extra_base,$=w.stat_desc.max_length;let ae,me,ge,pe,we,Be,nt=0;for(pe=0;pe<=ib;pe++)S.bl_count[pe]=0;for(I[2*S.heap[S.heap_max]+1]=0,ae=S.heap_max+1;ae<573;ae++)me=S.heap[ae],pe=I[2*I[2*me+1]+1]+1,pe>$&&(pe=$,nt++),I[2*me+1]=pe,me>P||(S.bl_count[pe]++,we=0,me>=q&&(we=U[me-q]),Be=I[2*me],S.opt_len+=Be*(pe+we),M&&(S.static_len+=Be*(B[2*me+1]+we)));if(nt!==0){do{for(pe=$-1;S.bl_count[pe]===0;)pe--;S.bl_count[pe]--,S.bl_count[pe+1]+=2,S.bl_count[$]--,nt-=2}while(nt>0);for(pe=$;pe!==0;pe--)for(me=S.bl_count[pe];me!==0;)ge=S.heap[--ae],ge>P||(I[2*ge+1]!==pe&&(S.opt_len+=(pe-I[2*ge+1])*I[2*ge],I[2*ge+1]=pe),me--)}})(e,n),S9(i,y,e.bl_count)},C9=(e,n,i)=>{let o,c,u=-1,h=n[1],m=0,_=7,y=4;for(h===0&&(_=138,y=3),n[2*(i+1)+1]=65535,o=0;o<=i;o++)c=h,h=n[2*(o+1)+1],++m<_&&c===h||(m<y?e.bl_tree[2*c]+=m:c!==0?(c!==u&&e.bl_tree[2*c]++,e.bl_tree[32]++):m<=10?e.bl_tree[34]++:e.bl_tree[36]++,m=0,u=c,h===0?(_=138,y=3):c===h?(_=6,y=3):(_=7,y=4))},I9=(e,n,i)=>{let o,c,u=-1,h=n[1],m=0,_=7,y=4;for(h===0&&(_=138,y=3),o=0;o<=i;o++)if(c=h,h=n[2*(o+1)+1],!(++m<_&&c===h)){if(m<y)do Zd(e,c,e.bl_tree);while(--m!=0);else c!==0?(c!==u&&(Zd(e,c,e.bl_tree),m--),Zd(e,16,e.bl_tree),Ic(e,m-3,2)):m<=10?(Zd(e,17,e.bl_tree),Ic(e,m-3,3)):(Zd(e,18,e.bl_tree),Ic(e,m-11,7));m=0,u=c,h===0?(_=138,y=3):c===h?(_=6,y=3):(_=7,y=4)}};let A9=!1;const O9=(e,n,i,o)=>{Ic(e,0+(o?1:0),3),b9(e),cb(e,i),cb(e,~i),i&&e.pending_buf.set(e.window.subarray(n,n+i),e.pending),e.pending+=i};var Bpe=e=>{A9||((()=>{let n,i,o,c,u;const h=new Array(16);for(o=0,c=0;c<28;c++)for(Ix[c]=o,n=0;n<1<<Cx[c];n++)ab[o++]=c;for(ab[o-1]=c,u=0,c=0;c<16;c++)for(tO[c]=u,n=0;n<1<<eO[c];n++)ob[u++]=c;for(u>>=7;c<rb;c++)for(tO[c]=u<<7,n=0;n<1<<eO[c]-7;n++)ob[256+u++]=c;for(i=0;i<=ib;i++)h[i]=0;for(n=0;n<=143;)Lf[2*n+1]=8,n++,h[8]++;for(;n<=255;)Lf[2*n+1]=9,n++,h[9]++;for(;n<=279;)Lf[2*n+1]=7,n++,h[7]++;for(;n<=287;)Lf[2*n+1]=8,n++,h[8]++;for(S9(Lf,287,h),n=0;n<rb;n++)sb[2*n+1]=5,sb[2*n]=v9(n,5);g9=new Ax(Lf,Cx,257,p9,ib),_9=new Ax(sb,eO,0,rb,ib),E9=new Ax(new Array(0),jpe,0,19,7)})(),A9=!0),e.l_desc=new Ox(e.dyn_ltree,g9),e.d_desc=new Ox(e.dyn_dtree,_9),e.bl_desc=new Ox(e.bl_tree,E9),e.bi_buf=0,e.bi_valid=0,T9(e)},Wpe=(e,n,i,o)=>{let c,u,h=0;e.level>0?(e.strm.data_type===2&&(e.strm.data_type=(m=>{let _,y=4093624447;for(_=0;_<=31;_++,y>>>=1)if(1&y&&m.dyn_ltree[2*_]!==0)return 0;if(m.dyn_ltree[18]!==0||m.dyn_ltree[20]!==0||m.dyn_ltree[26]!==0)return 1;for(_=32;_<Rx;_++)if(m.dyn_ltree[2*_]!==0)return 1;return 0})(e)),Nx(e,e.l_desc),Nx(e,e.d_desc),h=(m=>{let _;for(C9(m,m.dyn_ltree,m.l_desc.max_code),C9(m,m.dyn_dtree,m.d_desc.max_code),Nx(m,m.bl_desc),_=18;_>=3&&m.bl_tree[2*m9[_]+1]===0;_--);return m.opt_len+=3*(_+1)+5+5+4,_})(e),c=e.opt_len+3+7>>>3,u=e.static_len+3+7>>>3,u<=c&&(c=u)):c=u=i+5,i+4<=c&&n!==-1?O9(e,n,i,o):e.strategy===4||u===c?(Ic(e,2+(o?1:0),3),R9(e,Lf,sb)):(Ic(e,4+(o?1:0),3),((m,_,y,S)=>{let w;for(Ic(m,_-257,5),Ic(m,y-1,5),Ic(m,S-4,4),w=0;w<S;w++)Ic(m,m.bl_tree[2*m9[w]+1],3);I9(m,m.dyn_ltree,_-1),I9(m,m.dyn_dtree,y-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,h+1),R9(e,e.dyn_ltree,e.dyn_dtree)),T9(e),o&&b9(e)},Gpe=(e,n,i)=>(e.pending_buf[e.sym_buf+e.sym_next++]=n,e.pending_buf[e.sym_buf+e.sym_next++]=n>>8,e.pending_buf[e.sym_buf+e.sym_next++]=i,n===0?e.dyn_ltree[2*i]++:(e.matches++,n--,e.dyn_ltree[2*(ab[i]+Rx+1)]++,e.dyn_dtree[2*y9(n)]++),e.sym_next===e.sym_end),zpe=e=>{Ic(e,2,3),Zd(e,256,Lf),(n=>{n.bi_valid===16?(cb(n,n.bi_buf),n.bi_buf=0,n.bi_valid=0):n.bi_valid>=8&&(n.pending_buf[n.pending++]=255&n.bi_buf,n.bi_buf>>=8,n.bi_valid-=8)})(e)},Hpe={_tr_init:Bpe,_tr_stored_block:O9,_tr_flush_block:Wpe,_tr_tally:Gpe,_tr_align:zpe},lb=(e,n,i,o)=>{let c=65535&e|0,u=e>>>16&65535|0,h=0;for(;i!==0;){h=i>2e3?2e3:i,i-=h;do c=c+n[o++]|0,u=u+c|0;while(--h);c%=65521,u%=65521}return c|u<<16|0};const Kpe=new Uint32Array((()=>{let e,n=[];for(var i=0;i<256;i++){e=i;for(var o=0;o<8;o++)e=1&e?3988292384^e>>>1:e>>>1;n[i]=e}return n})());var po=(e,n,i,o)=>{const c=Kpe,u=o+i;e^=-1;for(let h=o;h<u;h++)e=e>>>8^c[255&(e^n[h])];return-1^e},g_={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},nO={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:qpe,_tr_stored_block:kx,_tr_flush_block:$pe,_tr_tally:um,_tr_align:Ype}=Hpe,{Z_NO_FLUSH:dm,Z_PARTIAL_FLUSH:Xpe,Z_FULL_FLUSH:Jpe,Z_FINISH:Ql,Z_BLOCK:P9,Z_OK:Bo,Z_STREAM_END:N9,Z_STREAM_ERROR:eh,Z_DATA_ERROR:Qpe,Z_BUF_ERROR:Dx,Z_DEFAULT_COMPRESSION:Zpe,Z_FILTERED:eme,Z_HUFFMAN_ONLY:rO,Z_RLE:tme,Z_FIXED:nme,Z_DEFAULT_STRATEGY:rme,Z_UNKNOWN:ime,Z_DEFLATED:iO}=nO,Lx=286,sme=30,ome=19,ame=2*Lx+1,cme=15,__=258,th=262,Rv=42,E_=113,ub=666,y_=(e,n)=>(e.msg=g_[n],n),k9=e=>2*e-(e>4?9:0),hm=e=>{let n=e.length;for(;--n>=0;)e[n]=0},lme=e=>{let n,i,o,c=e.w_size;n=e.hash_size,o=n;do i=e.head[--o],e.head[o]=i>=c?i-c:0;while(--n);n=c,o=n;do i=e.prev[--o],e.prev[o]=i>=c?i-c:0;while(--n)};let fm=(e,n,i)=>(n<<e.hash_shift^i)&e.hash_mask;const ol=e=>{const n=e.state;let i=n.pending;i>e.avail_out&&(i=e.avail_out),i!==0&&(e.output.set(n.pending_buf.subarray(n.pending_out,n.pending_out+i),e.next_out),e.next_out+=i,n.pending_out+=i,e.total_out+=i,e.avail_out-=i,n.pending-=i,n.pending===0&&(n.pending_out=0))},al=(e,n)=>{$pe(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,n),e.block_start=e.strstart,ol(e.strm)},Wr=(e,n)=>{e.pending_buf[e.pending++]=n},db=(e,n)=>{e.pending_buf[e.pending++]=n>>>8&255,e.pending_buf[e.pending++]=255&n},xx=(e,n,i,o)=>{let c=e.avail_in;return c>o&&(c=o),c===0?0:(e.avail_in-=c,n.set(e.input.subarray(e.next_in,e.next_in+c),i),e.state.wrap===1?e.adler=lb(e.adler,n,c,i):e.state.wrap===2&&(e.adler=po(e.adler,n,c,i)),e.next_in+=c,e.total_in+=c,c)},D9=(e,n)=>{let i,o,c=e.max_chain_length,u=e.strstart,h=e.prev_length,m=e.nice_match;const _=e.strstart>e.w_size-th?e.strstart-(e.w_size-th):0,y=e.window,S=e.w_mask,w=e.prev,I=e.strstart+__;let P=y[u+h-1],B=y[u+h];e.prev_length>=e.good_match&&(c>>=2),m>e.lookahead&&(m=e.lookahead);do if(i=n,y[i+h]===B&&y[i+h-1]===P&&y[i]===y[u]&&y[++i]===y[u+1]){u+=2,i++;do;while(y[++u]===y[++i]&&y[++u]===y[++i]&&y[++u]===y[++i]&&y[++u]===y[++i]&&y[++u]===y[++i]&&y[++u]===y[++i]&&y[++u]===y[++i]&&y[++u]===y[++i]&&u<I);if(o=__-(I-u),u=I-__,o>h){if(e.match_start=n,h=o,o>=m)break;P=y[u+h-1],B=y[u+h]}}while((n=w[n&S])>_&&--c!=0);return h<=e.lookahead?h:e.lookahead},Cv=e=>{const n=e.w_size;let i,o,c;do{if(o=e.window_size-e.lookahead-e.strstart,e.strstart>=n+(n-th)&&(e.window.set(e.window.subarray(n,n+n-o),0),e.match_start-=n,e.strstart-=n,e.block_start-=n,e.insert>e.strstart&&(e.insert=e.strstart),lme(e),o+=n),e.strm.avail_in===0)break;if(i=xx(e.strm,e.window,e.strstart+e.lookahead,o),e.lookahead+=i,e.lookahead+e.insert>=3)for(c=e.strstart-e.insert,e.ins_h=e.window[c],e.ins_h=fm(e,e.ins_h,e.window[c+1]);e.insert&&(e.ins_h=fm(e,e.ins_h,e.window[c+3-1]),e.prev[c&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=c,c++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<th&&e.strm.avail_in!==0)},L9=(e,n)=>{let i,o,c,u=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,h=0,m=e.strm.avail_in;do{if(i=65535,c=e.bi_valid+42>>3,e.strm.avail_out<c||(c=e.strm.avail_out-c,o=e.strstart-e.block_start,i>o+e.strm.avail_in&&(i=o+e.strm.avail_in),i>c&&(i=c),i<u&&(i===0&&n!==Ql||n===dm||i!==o+e.strm.avail_in)))break;h=n===Ql&&i===o+e.strm.avail_in?1:0,kx(e,0,0,h),e.pending_buf[e.pending-4]=i,e.pending_buf[e.pending-3]=i>>8,e.pending_buf[e.pending-2]=~i,e.pending_buf[e.pending-1]=~i>>8,ol(e.strm),o&&(o>i&&(o=i),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+o),e.strm.next_out),e.strm.next_out+=o,e.strm.avail_out-=o,e.strm.total_out+=o,e.block_start+=o,i-=o),i&&(xx(e.strm,e.strm.output,e.strm.next_out,i),e.strm.next_out+=i,e.strm.avail_out-=i,e.strm.total_out+=i)}while(h===0);return m-=e.strm.avail_in,m&&(m>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=m&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-m,e.strm.next_in),e.strstart),e.strstart+=m,e.insert+=m>e.w_size-e.insert?e.w_size-e.insert:m),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),h?4:n!==dm&&n!==Ql&&e.strm.avail_in===0&&e.strstart===e.block_start?2:(c=e.window_size-e.strstart,e.strm.avail_in>c&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,c+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),c>e.strm.avail_in&&(c=e.strm.avail_in),c&&(xx(e.strm,e.window,e.strstart,c),e.strstart+=c,e.insert+=c>e.w_size-e.insert?e.w_size-e.insert:c),e.high_water<e.strstart&&(e.high_water=e.strstart),c=e.bi_valid+42>>3,c=e.pending_buf_size-c>65535?65535:e.pending_buf_size-c,u=c>e.w_size?e.w_size:c,o=e.strstart-e.block_start,(o>=u||(o||n===Ql)&&n!==dm&&e.strm.avail_in===0&&o<=c)&&(i=o>c?c:o,h=n===Ql&&e.strm.avail_in===0&&i===o?1:0,kx(e,e.block_start,i,h),e.block_start+=i,ol(e.strm)),h?3:1)},Mx=(e,n)=>{let i,o;for(;;){if(e.lookahead<th){if(Cv(e),e.lookahead<th&&n===dm)return 1;if(e.lookahead===0)break}if(i=0,e.lookahead>=3&&(e.ins_h=fm(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),i!==0&&e.strstart-i<=e.w_size-th&&(e.match_length=D9(e,i)),e.match_length>=3)if(o=um(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do e.strstart++,e.ins_h=fm(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!=0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=fm(e,e.ins_h,e.window[e.strstart+1]);else o=um(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(o&&(al(e,!1),e.strm.avail_out===0))return 1}return e.insert=e.strstart<2?e.strstart:2,n===Ql?(al(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(al(e,!1),e.strm.avail_out===0)?1:2},Iv=(e,n)=>{let i,o,c;for(;;){if(e.lookahead<th){if(Cv(e),e.lookahead<th&&n===dm)return 1;if(e.lookahead===0)break}if(i=0,e.lookahead>=3&&(e.ins_h=fm(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,i!==0&&e.prev_length<e.max_lazy_match&&e.strstart-i<=e.w_size-th&&(e.match_length=D9(e,i),e.match_length<=5&&(e.strategy===eme||e.match_length===3&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){c=e.strstart+e.lookahead-3,o=um(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=c&&(e.ins_h=fm(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!=0);if(e.match_available=0,e.match_length=2,e.strstart++,o&&(al(e,!1),e.strm.avail_out===0))return 1}else if(e.match_available){if(o=um(e,0,e.window[e.strstart-1]),o&&al(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(o=um(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,n===Ql?(al(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(al(e,!1),e.strm.avail_out===0)?1:2};function nh(e,n,i,o,c){this.good_length=e,this.max_lazy=n,this.nice_length=i,this.max_chain=o,this.func=c}const hb=[new nh(0,0,0,0,L9),new nh(4,4,8,4,Mx),new nh(4,5,16,8,Mx),new nh(4,6,32,32,Mx),new nh(4,4,16,16,Iv),new nh(8,16,32,32,Iv),new nh(8,16,128,128,Iv),new nh(8,32,128,256,Iv),new nh(32,128,258,1024,Iv),new nh(32,258,258,4096,Iv)];function ume(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=iO,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*ame),this.dyn_dtree=new Uint16Array(2*(2*sme+1)),this.bl_tree=new Uint16Array(2*(2*ome+1)),hm(this.dyn_ltree),hm(this.dyn_dtree),hm(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(cme+1),this.heap=new Uint16Array(2*Lx+1),hm(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*Lx+1),hm(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const fb=e=>{if(!e)return 1;const n=e.state;return!n||n.strm!==e||n.status!==Rv&&n.status!==57&&n.status!==69&&n.status!==73&&n.status!==91&&n.status!==103&&n.status!==E_&&n.status!==ub?1:0},x9=e=>{if(fb(e))return y_(e,eh);e.total_in=e.total_out=0,e.data_type=ime;const n=e.state;return n.pending=0,n.pending_out=0,n.wrap<0&&(n.wrap=-n.wrap),n.status=n.wrap===2?57:n.wrap?Rv:E_,e.adler=n.wrap===2?0:1,n.last_flush=-2,qpe(n),Bo},M9=e=>{const n=x9(e);return n===Bo&&(i=>{i.window_size=2*i.w_size,hm(i.head),i.max_lazy_match=hb[i.level].max_lazy,i.good_match=hb[i.level].good_length,i.nice_match=hb[i.level].nice_length,i.max_chain_length=hb[i.level].max_chain,i.strstart=0,i.block_start=0,i.lookahead=0,i.insert=0,i.match_length=i.prev_length=2,i.match_available=0,i.ins_h=0})(e.state),n},U9=(e,n,i,o,c,u)=>{if(!e)return eh;let h=1;if(n===Zpe&&(n=6),o<0?(h=0,o=-o):o>15&&(h=2,o-=16),c<1||c>9||i!==iO||o<8||o>15||n<0||n>9||u<0||u>nme||o===8&&h!==1)return y_(e,eh);o===8&&(o=9);const m=new ume;return e.state=m,m.strm=e,m.status=Rv,m.wrap=h,m.gzhead=null,m.w_bits=o,m.w_size=1<<m.w_bits,m.w_mask=m.w_size-1,m.hash_bits=c+7,m.hash_size=1<<m.hash_bits,m.hash_mask=m.hash_size-1,m.hash_shift=~~((m.hash_bits+3-1)/3),m.window=new Uint8Array(2*m.w_size),m.head=new Uint16Array(m.hash_size),m.prev=new Uint16Array(m.w_size),m.lit_bufsize=1<<c+6,m.pending_buf_size=4*m.lit_bufsize,m.pending_buf=new Uint8Array(m.pending_buf_size),m.sym_buf=m.lit_bufsize,m.sym_end=3*(m.lit_bufsize-1),m.level=n,m.strategy=u,m.method=i,M9(e)};var dme=(e,n)=>{if(fb(e)||n>P9||n<0)return e?y_(e,eh):eh;const i=e.state;if(!e.output||e.avail_in!==0&&!e.input||i.status===ub&&n!==Ql)return y_(e,e.avail_out===0?Dx:eh);const o=i.last_flush;if(i.last_flush=n,i.pending!==0){if(ol(e),e.avail_out===0)return i.last_flush=-1,Bo}else if(e.avail_in===0&&k9(n)<=k9(o)&&n!==Ql)return y_(e,Dx);if(i.status===ub&&e.avail_in!==0)return y_(e,Dx);if(i.status===Rv&&i.wrap===0&&(i.status=E_),i.status===Rv){let c=iO+(i.w_bits-8<<4)<<8,u=-1;if(u=i.strategy>=rO||i.level<2?0:i.level<6?1:i.level===6?2:3,c|=u<<6,i.strstart!==0&&(c|=32),c+=31-c%31,db(i,c),i.strstart!==0&&(db(i,e.adler>>>16),db(i,65535&e.adler)),e.adler=1,i.status=E_,ol(e),i.pending!==0)return i.last_flush=-1,Bo}if(i.status===57){if(e.adler=0,Wr(i,31),Wr(i,139),Wr(i,8),i.gzhead)Wr(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),Wr(i,255&i.gzhead.time),Wr(i,i.gzhead.time>>8&255),Wr(i,i.gzhead.time>>16&255),Wr(i,i.gzhead.time>>24&255),Wr(i,i.level===9?2:i.strategy>=rO||i.level<2?4:0),Wr(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(Wr(i,255&i.gzhead.extra.length),Wr(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(e.adler=po(e.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=69;else if(Wr(i,0),Wr(i,0),Wr(i,0),Wr(i,0),Wr(i,0),Wr(i,i.level===9?2:i.strategy>=rO||i.level<2?4:0),Wr(i,3),i.status=E_,ol(e),i.pending!==0)return i.last_flush=-1,Bo}if(i.status===69){if(i.gzhead.extra){let c=i.pending,u=(65535&i.gzhead.extra.length)-i.gzindex;for(;i.pending+u>i.pending_buf_size;){let m=i.pending_buf_size-i.pending;if(i.pending_buf.set(i.gzhead.extra.subarray(i.gzindex,i.gzindex+m),i.pending),i.pending=i.pending_buf_size,i.gzhead.hcrc&&i.pending>c&&(e.adler=po(e.adler,i.pending_buf,i.pending-c,c)),i.gzindex+=m,ol(e),i.pending!==0)return i.last_flush=-1,Bo;c=0,u-=m}let h=new Uint8Array(i.gzhead.extra);i.pending_buf.set(h.subarray(i.gzindex,i.gzindex+u),i.pending),i.pending+=u,i.gzhead.hcrc&&i.pending>c&&(e.adler=po(e.adler,i.pending_buf,i.pending-c,c)),i.gzindex=0}i.status=73}if(i.status===73){if(i.gzhead.name){let c,u=i.pending;do{if(i.pending===i.pending_buf_size){if(i.gzhead.hcrc&&i.pending>u&&(e.adler=po(e.adler,i.pending_buf,i.pending-u,u)),ol(e),i.pending!==0)return i.last_flush=-1,Bo;u=0}c=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,Wr(i,c)}while(c!==0);i.gzhead.hcrc&&i.pending>u&&(e.adler=po(e.adler,i.pending_buf,i.pending-u,u)),i.gzindex=0}i.status=91}if(i.status===91){if(i.gzhead.comment){let c,u=i.pending;do{if(i.pending===i.pending_buf_size){if(i.gzhead.hcrc&&i.pending>u&&(e.adler=po(e.adler,i.pending_buf,i.pending-u,u)),ol(e),i.pending!==0)return i.last_flush=-1,Bo;u=0}c=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,Wr(i,c)}while(c!==0);i.gzhead.hcrc&&i.pending>u&&(e.adler=po(e.adler,i.pending_buf,i.pending-u,u))}i.status=103}if(i.status===103){if(i.gzhead.hcrc){if(i.pending+2>i.pending_buf_size&&(ol(e),i.pending!==0))return i.last_flush=-1,Bo;Wr(i,255&e.adler),Wr(i,e.adler>>8&255),e.adler=0}if(i.status=E_,ol(e),i.pending!==0)return i.last_flush=-1,Bo}if(e.avail_in!==0||i.lookahead!==0||n!==dm&&i.status!==ub){let c=i.level===0?L9(i,n):i.strategy===rO?((u,h)=>{let m;for(;;){if(u.lookahead===0&&(Cv(u),u.lookahead===0)){if(h===dm)return 1;break}if(u.match_length=0,m=um(u,0,u.window[u.strstart]),u.lookahead--,u.strstart++,m&&(al(u,!1),u.strm.avail_out===0))return 1}return u.insert=0,h===Ql?(al(u,!0),u.strm.avail_out===0?3:4):u.sym_next&&(al(u,!1),u.strm.avail_out===0)?1:2})(i,n):i.strategy===tme?((u,h)=>{let m,_,y,S;const w=u.window;for(;;){if(u.lookahead<=__){if(Cv(u),u.lookahead<=__&&h===dm)return 1;if(u.lookahead===0)break}if(u.match_length=0,u.lookahead>=3&&u.strstart>0&&(y=u.strstart-1,_=w[y],_===w[++y]&&_===w[++y]&&_===w[++y])){S=u.strstart+__;do;while(_===w[++y]&&_===w[++y]&&_===w[++y]&&_===w[++y]&&_===w[++y]&&_===w[++y]&&_===w[++y]&&_===w[++y]&&y<S);u.match_length=__-(S-y),u.match_length>u.lookahead&&(u.match_length=u.lookahead)}if(u.match_length>=3?(m=um(u,1,u.match_length-3),u.lookahead-=u.match_length,u.strstart+=u.match_length,u.match_length=0):(m=um(u,0,u.window[u.strstart]),u.lookahead--,u.strstart++),m&&(al(u,!1),u.strm.avail_out===0))return 1}return u.insert=0,h===Ql?(al(u,!0),u.strm.avail_out===0?3:4):u.sym_next&&(al(u,!1),u.strm.avail_out===0)?1:2})(i,n):hb[i.level].func(i,n);if(c!==3&&c!==4||(i.status=ub),c===1||c===3)return e.avail_out===0&&(i.last_flush=-1),Bo;if(c===2&&(n===Xpe?Ype(i):n!==P9&&(kx(i,0,0,!1),n===Jpe&&(hm(i.head),i.lookahead===0&&(i.strstart=0,i.block_start=0,i.insert=0))),ol(e),e.avail_out===0))return i.last_flush=-1,Bo}return n!==Ql?Bo:i.wrap<=0?N9:(i.wrap===2?(Wr(i,255&e.adler),Wr(i,e.adler>>8&255),Wr(i,e.adler>>16&255),Wr(i,e.adler>>24&255),Wr(i,255&e.total_in),Wr(i,e.total_in>>8&255),Wr(i,e.total_in>>16&255),Wr(i,e.total_in>>24&255)):(db(i,e.adler>>>16),db(i,65535&e.adler)),ol(e),i.wrap>0&&(i.wrap=-i.wrap),i.pending!==0?Bo:N9)},hme=(e,n)=>{let i=n.length;if(fb(e))return eh;const o=e.state,c=o.wrap;if(c===2||c===1&&o.status!==Rv||o.lookahead)return eh;if(c===1&&(e.adler=lb(e.adler,n,i,0)),o.wrap=0,i>=o.w_size){c===0&&(hm(o.head),o.strstart=0,o.block_start=0,o.insert=0);let _=new Uint8Array(o.w_size);_.set(n.subarray(i-o.w_size,i),0),n=_,i=o.w_size}const u=e.avail_in,h=e.next_in,m=e.input;for(e.avail_in=i,e.next_in=0,e.input=n,Cv(o);o.lookahead>=3;){let _=o.strstart,y=o.lookahead-2;do o.ins_h=fm(o,o.ins_h,o.window[_+3-1]),o.prev[_&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=_,_++;while(--y);o.strstart=_,o.lookahead=2,Cv(o)}return o.strstart+=o.lookahead,o.block_start=o.strstart,o.insert=o.lookahead,o.lookahead=0,o.match_length=o.prev_length=2,o.match_available=0,e.next_in=h,e.input=m,e.avail_in=u,o.wrap=c,Bo},pb={deflateInit:(e,n)=>U9(e,n,iO,15,8,rme),deflateInit2:U9,deflateReset:M9,deflateResetKeep:x9,deflateSetHeader:(e,n)=>fb(e)||e.state.wrap!==2?eh:(e.state.gzhead=n,Bo),deflate:dme,deflateEnd:e=>{if(fb(e))return eh;const n=e.state.status;return e.state=null,n===E_?y_(e,Qpe):Bo},deflateSetDictionary:hme,deflateInfo:"pako deflate (from Nodeca project)"};const fme=(e,n)=>Object.prototype.hasOwnProperty.call(e,n);var sO={assign:function(e){const n=Array.prototype.slice.call(arguments,1);for(;n.length;){const i=n.shift();if(i){if(typeof i!="object")throw new TypeError(i+"must be non-object");for(const o in i)fme(i,o)&&(e[o]=i[o])}}return e},flattenChunks:e=>{let n=0;for(let o=0,c=e.length;o<c;o++)n+=e[o].length;const i=new Uint8Array(n);for(let o=0,c=0,u=e.length;o<u;o++){let h=e[o];i.set(h,c),c+=h.length}return i}};let V9=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{V9=!1}const mb=new Uint8Array(256);for(let e=0;e<256;e++)mb[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;mb[254]=mb[254]=1;var gb={string2buf:e=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(e);let n,i,o,c,u,h=e.length,m=0;for(c=0;c<h;c++)i=e.charCodeAt(c),(64512&i)==55296&&c+1<h&&(o=e.charCodeAt(c+1),(64512&o)==56320&&(i=65536+(i-55296<<10)+(o-56320),c++)),m+=i<128?1:i<2048?2:i<65536?3:4;for(n=new Uint8Array(m),u=0,c=0;u<m;c++)i=e.charCodeAt(c),(64512&i)==55296&&c+1<h&&(o=e.charCodeAt(c+1),(64512&o)==56320&&(i=65536+(i-55296<<10)+(o-56320),c++)),i<128?n[u++]=i:i<2048?(n[u++]=192|i>>>6,n[u++]=128|63&i):i<65536?(n[u++]=224|i>>>12,n[u++]=128|i>>>6&63,n[u++]=128|63&i):(n[u++]=240|i>>>18,n[u++]=128|i>>>12&63,n[u++]=128|i>>>6&63,n[u++]=128|63&i);return n},buf2string:(e,n)=>{const i=n||e.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(e.subarray(0,n));let o,c;const u=new Array(2*i);for(c=0,o=0;o<i;){let h=e[o++];if(h<128){u[c++]=h;continue}let m=mb[h];if(m>4)u[c++]=65533,o+=m-1;else{for(h&=m===2?31:m===3?15:7;m>1&&o<i;)h=h<<6|63&e[o++],m--;m>1?u[c++]=65533:h<65536?u[c++]=h:(h-=65536,u[c++]=55296|h>>10&1023,u[c++]=56320|1023&h)}}return((h,m)=>{if(m<65534&&h.subarray&&V9)return String.fromCharCode.apply(null,h.length===m?h:h.subarray(0,m));let _="";for(let y=0;y<m;y++)_+=String.fromCharCode(h[y]);return _})(u,c)},utf8border:(e,n)=>{(n=n||e.length)>e.length&&(n=e.length);let i=n-1;for(;i>=0&&(192&e[i])==128;)i--;return i<0||i===0?n:i+mb[e[i]]>n?i:n}},F9=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const j9=Object.prototype.toString,{Z_NO_FLUSH:pme,Z_SYNC_FLUSH:mme,Z_FULL_FLUSH:gme,Z_FINISH:_me,Z_OK:oO,Z_STREAM_END:Eme,Z_DEFAULT_COMPRESSION:yme,Z_DEFAULT_STRATEGY:vme,Z_DEFLATED:Sme}=nO;function aO(e){this.options=sO.assign({level:yme,method:Sme,chunkSize:16384,windowBits:15,memLevel:8,strategy:vme},e||{});let n=this.options;n.raw&&n.windowBits>0?n.windowBits=-n.windowBits:n.gzip&&n.windowBits>0&&n.windowBits<16&&(n.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new F9,this.strm.avail_out=0;let i=pb.deflateInit2(this.strm,n.level,n.method,n.windowBits,n.memLevel,n.strategy);if(i!==oO)throw new Error(g_[i]);if(n.header&&pb.deflateSetHeader(this.strm,n.header),n.dictionary){let o;if(o=typeof n.dictionary=="string"?gb.string2buf(n.dictionary):j9.call(n.dictionary)==="[object ArrayBuffer]"?new Uint8Array(n.dictionary):n.dictionary,i=pb.deflateSetDictionary(this.strm,o),i!==oO)throw new Error(g_[i]);this._dict_set=!0}}function Tme(e,n){const i=new aO(n);if(i.push(e,!0),i.err)throw i.msg||g_[i.err];return i.result}aO.prototype.push=function(e,n){const i=this.strm,o=this.options.chunkSize;let c,u;if(this.ended)return!1;for(u=n===~~n?n:n===!0?_me:pme,typeof e=="string"?i.input=gb.string2buf(e):j9.call(e)==="[object ArrayBuffer]"?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;;)if(i.avail_out===0&&(i.output=new Uint8Array(o),i.next_out=0,i.avail_out=o),(u===mme||u===gme)&&i.avail_out<=6)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else{if(c=pb.deflate(i,u),c===Eme)return i.next_out>0&&this.onData(i.output.subarray(0,i.next_out)),c=pb.deflateEnd(this.strm),this.onEnd(c),this.ended=!0,c===oO;if(i.avail_out!==0){if(u>0&&i.next_out>0)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else if(i.avail_in===0)break}else this.onData(i.output)}return!0},aO.prototype.onData=function(e){this.chunks.push(e)},aO.prototype.onEnd=function(e){e===oO&&(this.result=sO.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var bme={deflate:Tme};const cO=16209;var wme=function(e,n){let i,o,c,u,h,m,_,y,S,w,I,P,B,M,U,q,$,ae,me,ge,pe,we,Be,nt;const st=e.state;i=e.next_in,Be=e.input,o=i+(e.avail_in-5),c=e.next_out,nt=e.output,u=c-(n-e.avail_out),h=c+(e.avail_out-257),m=st.dmax,_=st.wsize,y=st.whave,S=st.wnext,w=st.window,I=st.hold,P=st.bits,B=st.lencode,M=st.distcode,U=(1<<st.lenbits)-1,q=(1<<st.distbits)-1;e:do{P<15&&(I+=Be[i++]<<P,P+=8,I+=Be[i++]<<P,P+=8),$=B[I&U];t:for(;;){if(ae=$>>>24,I>>>=ae,P-=ae,ae=$>>>16&255,ae===0)nt[c++]=65535&$;else{if(!(16&ae)){if((64&ae)==0){$=B[(65535&$)+(I&(1<<ae)-1)];continue t}if(32&ae){st.mode=16191;break e}e.msg="invalid literal/length code",st.mode=cO;break e}me=65535&$,ae&=15,ae&&(P<ae&&(I+=Be[i++]<<P,P+=8),me+=I&(1<<ae)-1,I>>>=ae,P-=ae),P<15&&(I+=Be[i++]<<P,P+=8,I+=Be[i++]<<P,P+=8),$=M[I&q];n:for(;;){if(ae=$>>>24,I>>>=ae,P-=ae,ae=$>>>16&255,!(16&ae)){if((64&ae)==0){$=M[(65535&$)+(I&(1<<ae)-1)];continue n}e.msg="invalid distance code",st.mode=cO;break e}if(ge=65535&$,ae&=15,P<ae&&(I+=Be[i++]<<P,P+=8,P<ae&&(I+=Be[i++]<<P,P+=8)),ge+=I&(1<<ae)-1,ge>m){e.msg="invalid distance too far back",st.mode=cO;break e}if(I>>>=ae,P-=ae,ae=c-u,ge>ae){if(ae=ge-ae,ae>y&&st.sane){e.msg="invalid distance too far back",st.mode=cO;break e}if(pe=0,we=w,S===0){if(pe+=_-ae,ae<me){me-=ae;do nt[c++]=w[pe++];while(--ae);pe=c-ge,we=nt}}else if(S<ae){if(pe+=_+S-ae,ae-=S,ae<me){me-=ae;do nt[c++]=w[pe++];while(--ae);if(pe=0,S<me){ae=S,me-=ae;do nt[c++]=w[pe++];while(--ae);pe=c-ge,we=nt}}}else if(pe+=S-ae,ae<me){me-=ae;do nt[c++]=w[pe++];while(--ae);pe=c-ge,we=nt}for(;me>2;)nt[c++]=we[pe++],nt[c++]=we[pe++],nt[c++]=we[pe++],me-=3;me&&(nt[c++]=we[pe++],me>1&&(nt[c++]=we[pe++]))}else{pe=c-ge;do nt[c++]=nt[pe++],nt[c++]=nt[pe++],nt[c++]=nt[pe++],me-=3;while(me>2);me&&(nt[c++]=nt[pe++],me>1&&(nt[c++]=nt[pe++]))}break}}break}}while(i<o&&c<h);me=P>>3,i-=me,P-=me<<3,I&=(1<<P)-1,e.next_in=i,e.next_out=c,e.avail_in=i<o?o-i+5:5-(i-o),e.avail_out=c<h?h-c+257:257-(c-h),st.hold=I,st.bits=P};const lO=15,Rme=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Cme=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Ime=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Ame=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var _b=(e,n,i,o,c,u,h,m)=>{const _=m.bits;let y,S,w,I,P,B,M=0,U=0,q=0,$=0,ae=0,me=0,ge=0,pe=0,we=0,Be=0,nt=null;const st=new Uint16Array(16),pn=new Uint16Array(16);let mn,sr,Xr,Fr=null;for(M=0;M<=lO;M++)st[M]=0;for(U=0;U<o;U++)st[n[i+U]]++;for(ae=_,$=lO;$>=1&&st[$]===0;$--);if(ae>$&&(ae=$),$===0)return c[u++]=20971520,c[u++]=20971520,m.bits=1,0;for(q=1;q<$&&st[q]===0;q++);for(ae<q&&(ae=q),pe=1,M=1;M<=lO;M++)if(pe<<=1,pe-=st[M],pe<0)return-1;if(pe>0&&(e===0||$!==1))return-1;for(pn[1]=0,M=1;M<lO;M++)pn[M+1]=pn[M]+st[M];for(U=0;U<o;U++)n[i+U]!==0&&(h[pn[n[i+U]]++]=U);if(e===0?(nt=Fr=h,B=20):e===1?(nt=Rme,Fr=Cme,B=257):(nt=Ime,Fr=Ame,B=0),Be=0,U=0,M=q,P=u,me=ae,ge=0,w=-1,we=1<<ae,I=we-1,e===1&&we>852||e===2&&we>592)return 1;for(;;){mn=M-ge,h[U]+1<B?(sr=0,Xr=h[U]):h[U]>=B?(sr=Fr[h[U]-B],Xr=nt[h[U]-B]):(sr=96,Xr=0),y=1<<M-ge,S=1<<me,q=S;do S-=y,c[P+(Be>>ge)+S]=mn<<24|sr<<16|Xr|0;while(S!==0);for(y=1<<M-1;Be&y;)y>>=1;if(y!==0?(Be&=y-1,Be+=y):Be=0,U++,--st[M]==0){if(M===$)break;M=n[i+h[U]]}if(M>ae&&(Be&I)!==w){for(ge===0&&(ge=ae),P+=q,me=M-ge,pe=1<<me;me+ge<$&&(pe-=st[me+ge],!(pe<=0));)me++,pe<<=1;if(we+=1<<me,e===1&&we>852||e===2&&we>592)return 1;w=Be&I,c[w]=ae<<24|me<<16|P-u|0}}return Be!==0&&(c[P+Be]=M-ge<<24|64<<16|0),m.bits=ae,0};const{Z_FINISH:B9,Z_BLOCK:Ome,Z_TREES:uO,Z_OK:v_,Z_STREAM_END:Pme,Z_NEED_DICT:Nme,Z_STREAM_ERROR:Zl,Z_DATA_ERROR:W9,Z_MEM_ERROR:G9,Z_BUF_ERROR:kme,Z_DEFLATED:z9}=nO,dO=16180,hO=16190,xf=16191,Ux=16192,Vx=16194,fO=16199,pO=16200,Fx=16206,Wi=16209,H9=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function Dme(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const S_=e=>{if(!e)return 1;const n=e.state;return!n||n.strm!==e||n.mode<dO||n.mode>16211?1:0},K9=e=>{if(S_(e))return Zl;const n=e.state;return e.total_in=e.total_out=n.total=0,e.msg="",n.wrap&&(e.adler=1&n.wrap),n.mode=dO,n.last=0,n.havedict=0,n.flags=-1,n.dmax=32768,n.head=null,n.hold=0,n.bits=0,n.lencode=n.lendyn=new Int32Array(852),n.distcode=n.distdyn=new Int32Array(592),n.sane=1,n.back=-1,v_},q9=e=>{if(S_(e))return Zl;const n=e.state;return n.wsize=0,n.whave=0,n.wnext=0,K9(e)},$9=(e,n)=>{let i;if(S_(e))return Zl;const o=e.state;return n<0?(i=0,n=-n):(i=5+(n>>4),n<48&&(n&=15)),n&&(n<8||n>15)?Zl:(o.window!==null&&o.wbits!==n&&(o.window=null),o.wrap=i,o.wbits=n,q9(e))},Y9=(e,n)=>{if(!e)return Zl;const i=new Dme;e.state=i,i.strm=e,i.window=null,i.mode=dO;const o=$9(e,n);return o!==v_&&(e.state=null),o};let jx,Bx,X9=!0;const Lme=e=>{if(X9){jx=new Int32Array(512),Bx=new Int32Array(32);let n=0;for(;n<144;)e.lens[n++]=8;for(;n<256;)e.lens[n++]=9;for(;n<280;)e.lens[n++]=7;for(;n<288;)e.lens[n++]=8;for(_b(1,e.lens,0,288,jx,0,e.work,{bits:9}),n=0;n<32;)e.lens[n++]=5;_b(2,e.lens,0,32,Bx,0,e.work,{bits:5}),X9=!1}e.lencode=jx,e.lenbits=9,e.distcode=Bx,e.distbits=5},J9=(e,n,i,o)=>{let c;const u=e.state;return u.window===null&&(u.wsize=1<<u.wbits,u.wnext=0,u.whave=0,u.window=new Uint8Array(u.wsize)),o>=u.wsize?(u.window.set(n.subarray(i-u.wsize,i),0),u.wnext=0,u.whave=u.wsize):(c=u.wsize-u.wnext,c>o&&(c=o),u.window.set(n.subarray(i-o,i-o+c),u.wnext),(o-=c)?(u.window.set(n.subarray(i-o,i),0),u.wnext=o,u.whave=u.wsize):(u.wnext+=c,u.wnext===u.wsize&&(u.wnext=0),u.whave<u.wsize&&(u.whave+=c))),0};var xme=(e,n)=>{let i,o,c,u,h,m,_,y,S,w,I,P,B,M,U,q,$,ae,me,ge,pe,we,Be=0;const nt=new Uint8Array(4);let st,pn;const mn=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(S_(e)||!e.output||!e.input&&e.avail_in!==0)return Zl;i=e.state,i.mode===xf&&(i.mode=Ux),h=e.next_out,c=e.output,_=e.avail_out,u=e.next_in,o=e.input,m=e.avail_in,y=i.hold,S=i.bits,w=m,I=_,we=v_;e:for(;;)switch(i.mode){case dO:if(i.wrap===0){i.mode=Ux;break}for(;S<16;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}if(2&i.wrap&&y===35615){i.wbits===0&&(i.wbits=15),i.check=0,nt[0]=255&y,nt[1]=y>>>8&255,i.check=po(i.check,nt,2,0),y=0,S=0,i.mode=16181;break}if(i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&y)<<8)+(y>>8))%31){e.msg="incorrect header check",i.mode=Wi;break}if((15&y)!==z9){e.msg="unknown compression method",i.mode=Wi;break}if(y>>>=4,S-=4,pe=8+(15&y),i.wbits===0&&(i.wbits=pe),pe>15||pe>i.wbits){e.msg="invalid window size",i.mode=Wi;break}i.dmax=1<<i.wbits,i.flags=0,e.adler=i.check=1,i.mode=512&y?16189:xf,y=0,S=0;break;case 16181:for(;S<16;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}if(i.flags=y,(255&qs(i))!==z9){e.msg="unknown compression method",i.mode=Wi;break}if(57344&qs(i)){e.msg="unknown header flags set",i.mode=Wi;break}i.head&&(i.head.text=y>>8&1),512&qs(i)&&4&i.wrap&&(nt[0]=255&y,nt[1]=y>>>8&255,i.check=po(i.check,nt,2,0)),y=0,S=0,i.mode=16182;case 16182:for(;S<32;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}i.head&&(i.head.time=y),512&qs(i)&&4&i.wrap&&(nt[0]=255&y,nt[1]=y>>>8&255,nt[2]=y>>>16&255,nt[3]=y>>>24&255,i.check=po(i.check,nt,4,0)),y=0,S=0,i.mode=16183;case 16183:for(;S<16;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}i.head&&(i.head.xflags=255&y,i.head.os=y>>8),512&qs(i)&&4&i.wrap&&(nt[0]=255&y,nt[1]=y>>>8&255,i.check=po(i.check,nt,2,0)),y=0,S=0,i.mode=16184;case 16184:if(1024&qs(i)){for(;S<16;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}i.length=y,i.head&&(i.head.extra_len=y),512&qs(i)&&4&i.wrap&&(nt[0]=255&y,nt[1]=y>>>8&255,i.check=po(i.check,nt,2,0)),y=0,S=0}else i.head&&(i.head.extra=null);i.mode=16185;case 16185:if(1024&qs(i)&&(P=i.length,P>m&&(P=m),P&&(i.head&&(pe=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Uint8Array(i.head.extra_len)),i.head.extra.set(o.subarray(u,u+P),pe)),512&qs(i)&&4&i.wrap&&(i.check=po(i.check,o,P,u)),m-=P,u+=P,i.length-=P),i.length))break e;i.length=0,i.mode=16186;case 16186:if(2048&qs(i)){if(m===0)break e;P=0;do pe=o[u+P++],i.head&&pe&&i.length<65536&&(i.head.name+=String.fromCharCode(pe));while(pe&&P<m);if(512&qs(i)&&4&i.wrap&&(i.check=po(i.check,o,P,u)),m-=P,u+=P,pe)break e}else i.head&&(i.head.name=null);i.length=0,i.mode=16187;case 16187:if(4096&qs(i)){if(m===0)break e;P=0;do pe=o[u+P++],i.head&&pe&&i.length<65536&&(i.head.comment+=String.fromCharCode(pe));while(pe&&P<m);if(512&qs(i)&&4&i.wrap&&(i.check=po(i.check,o,P,u)),m-=P,u+=P,pe)break e}else i.head&&(i.head.comment=null);i.mode=16188;case 16188:if(512&qs(i)){for(;S<16;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}if(4&i.wrap&&y!==(65535&i.check)){e.msg="header crc mismatch",i.mode=Wi;break}y=0,S=0}i.head&&(i.head.hcrc=qs(i)>>9&1,i.head.done=!0),e.adler=i.check=0,i.mode=xf;break;case 16189:for(;S<32;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}e.adler=i.check=H9(y),y=0,S=0,i.mode=hO;case hO:if(i.havedict===0)return e.next_out=h,e.avail_out=_,e.next_in=u,e.avail_in=m,i.hold=y,i.bits=S,Nme;e.adler=i.check=1,i.mode=xf;case xf:if(n===Ome||n===uO)break e;case Ux:if(i.last){y>>>=7&S,S-=7&S,i.mode=Fx;break}for(;S<3;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}switch(i.last=1&y,y>>>=1,S-=1,3&y){case 0:i.mode=16193;break;case 1:if(Lme(i),i.mode=fO,n===uO){y>>>=2,S-=2;break e}break;case 2:i.mode=16196;break;case 3:e.msg="invalid block type",i.mode=Wi}y>>>=2,S-=2;break;case 16193:for(y>>>=7&S,S-=7&S;S<32;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}if((65535&y)!=(y>>>16^65535)){e.msg="invalid stored block lengths",i.mode=Wi;break}if(i.length=65535&y,y=0,S=0,i.mode=Vx,n===uO)break e;case Vx:i.mode=16195;case 16195:if(P=i.length,P){if(P>m&&(P=m),P>_&&(P=_),P===0)break e;c.set(o.subarray(u,u+P),h),m-=P,u+=P,_-=P,h+=P,i.length-=P;break}i.mode=xf;break;case 16196:for(;S<14;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}if(i.nlen=257+(31&y),y>>>=5,S-=5,i.ndist=1+(31&y),y>>>=5,S-=5,i.ncode=4+(15&y),y>>>=4,S-=4,i.nlen>286||i.ndist>30){e.msg="too many length or distance symbols",i.mode=Wi;break}i.have=0,i.mode=16197;case 16197:for(;i.have<i.ncode;){for(;S<3;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}i.lens[mn[i.have++]]=7&y,y>>>=3,S-=3}for(;i.have<19;)i.lens[mn[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,st={bits:i.lenbits},we=_b(0,i.lens,0,19,i.lencode,0,i.work,st),i.lenbits=st.bits,we){e.msg="invalid code lengths set",i.mode=Wi;break}i.have=0,i.mode=16198;case 16198:for(;i.have<i.nlen+i.ndist;){for(;Be=i.lencode[y&(1<<i.lenbits)-1],U=Be>>>24,q=Be>>>16&255,$=65535&Be,!(U<=S);){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}if($<16)y>>>=U,S-=U,i.lens[i.have++]=$;else{if($===16){for(pn=U+2;S<pn;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}if(y>>>=U,S-=U,i.have===0){e.msg="invalid bit length repeat",i.mode=Wi;break}pe=i.lens[i.have-1],P=3+(3&y),y>>>=2,S-=2}else if($===17){for(pn=U+3;S<pn;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}y>>>=U,S-=U,pe=0,P=3+(7&y),y>>>=3,S-=3}else{for(pn=U+7;S<pn;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}y>>>=U,S-=U,pe=0,P=11+(127&y),y>>>=7,S-=7}if(i.have+P>i.nlen+i.ndist){e.msg="invalid bit length repeat",i.mode=Wi;break}for(;P--;)i.lens[i.have++]=pe}}if(i.mode===Wi)break;if(i.lens[256]===0){e.msg="invalid code -- missing end-of-block",i.mode=Wi;break}if(i.lenbits=9,st={bits:i.lenbits},we=_b(1,i.lens,0,i.nlen,i.lencode,0,i.work,st),i.lenbits=st.bits,we){e.msg="invalid literal/lengths set",i.mode=Wi;break}if(i.distbits=6,i.distcode=i.distdyn,st={bits:i.distbits},we=_b(2,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,st),i.distbits=st.bits,we){e.msg="invalid distances set",i.mode=Wi;break}if(i.mode=fO,n===uO)break e;case fO:i.mode=pO;case pO:if(m>=6&&_>=258){e.next_out=h,e.avail_out=_,e.next_in=u,e.avail_in=m,i.hold=y,i.bits=S,wme(e,I),h=e.next_out,c=e.output,_=e.avail_out,u=e.next_in,o=e.input,m=e.avail_in,y=i.hold,S=i.bits,i.mode===xf&&(i.back=-1);break}for(i.back=0;Be=i.lencode[y&(1<<i.lenbits)-1],U=Be>>>24,q=Be>>>16&255,$=65535&Be,!(U<=S);){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}if(q&&(240&q)==0){for(ae=U,me=q,ge=$;Be=i.lencode[ge+((y&(1<<ae+me)-1)>>ae)],U=Be>>>24,q=Be>>>16&255,$=65535&Be,!(ae+U<=S);){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}y>>>=ae,S-=ae,i.back+=ae}if(y>>>=U,S-=U,i.back+=U,i.length=$,q===0){i.mode=16205;break}if(32&q){i.back=-1,i.mode=xf;break}if(64&q){e.msg="invalid literal/length code",i.mode=Wi;break}i.extra=15&q,i.mode=16201;case 16201:if(i.extra){for(pn=i.extra;S<pn;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}i.length+=y&(1<<i.extra)-1,y>>>=i.extra,S-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=16202;case 16202:for(;Be=i.distcode[y&(1<<i.distbits)-1],U=Be>>>24,q=Be>>>16&255,$=65535&Be,!(U<=S);){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}if((240&q)==0){for(ae=U,me=q,ge=$;Be=i.distcode[ge+((y&(1<<ae+me)-1)>>ae)],U=Be>>>24,q=Be>>>16&255,$=65535&Be,!(ae+U<=S);){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}y>>>=ae,S-=ae,i.back+=ae}if(y>>>=U,S-=U,i.back+=U,64&q){e.msg="invalid distance code",i.mode=Wi;break}i.offset=$,i.extra=15&q,i.mode=16203;case 16203:if(i.extra){for(pn=i.extra;S<pn;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}i.offset+=y&(1<<i.extra)-1,y>>>=i.extra,S-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){e.msg="invalid distance too far back",i.mode=Wi;break}i.mode=16204;case 16204:if(_===0)break e;if(P=I-_,i.offset>P){if(P=i.offset-P,P>i.whave&&i.sane){e.msg="invalid distance too far back",i.mode=Wi;break}P>i.wnext?(P-=i.wnext,B=i.wsize-P):B=i.wnext-P,P>i.length&&(P=i.length),M=i.window}else M=c,B=h-i.offset,P=i.length;P>_&&(P=_),_-=P,i.length-=P;do c[h++]=M[B++];while(--P);i.length===0&&(i.mode=pO);break;case 16205:if(_===0)break e;c[h++]=i.length,_--,i.mode=pO;break;case Fx:if(i.wrap){for(;S<32;){if(m===0)break e;m--,y|=o[u++]<<S,S+=8}if(I-=_,e.total_out+=I,i.total+=I,4&i.wrap&&I&&(e.adler=i.check=qs(i)?po(i.check,c,I,h-I):lb(i.check,c,I,h-I)),I=_,4&i.wrap&&(qs(i)?y:H9(y))!==i.check){e.msg="incorrect data check",i.mode=Wi;break}y=0,S=0}i.mode=16207;case 16207:if(i.wrap&&qs(i)){for(;S<32;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}if(4&i.wrap&&y!==(4294967295&i.total)){e.msg="incorrect length check",i.mode=Wi;break}y=0,S=0}i.mode=16208;case 16208:we=Pme;break e;case Wi:we=W9;break e;case 16210:return G9;default:return Zl}return e.next_out=h,e.avail_out=_,e.next_in=u,e.avail_in=m,i.hold=y,i.bits=S,(i.wsize||I!==e.avail_out&&i.mode<Wi&&(i.mode<Fx||n!==B9))&&J9(e,e.output,e.next_out,I-e.avail_out),w-=e.avail_in,I-=e.avail_out,e.total_in+=w,e.total_out+=I,i.total+=I,4&i.wrap&&I&&(e.adler=i.check=qs(i)?po(i.check,c,I,e.next_out-I):lb(i.check,c,I,e.next_out-I)),e.data_type=i.bits+(i.last?64:0)+(i.mode===xf?128:0)+(i.mode===fO||i.mode===Vx?256:0),(w===0&&I===0||n===B9)&&we===v_&&(we=kme),we},Mf={inflateReset:q9,inflateReset2:$9,inflateResetKeep:K9,inflateInit:e=>Y9(e,15),inflateInit2:Y9,inflate:xme,inflateEnd:e=>{if(S_(e))return Zl;let n=e.state;return n.window&&(n.window=null),e.state=null,v_},inflateGetHeader:(e,n)=>{if(S_(e))return Zl;const i=e.state;return(2&i.wrap)==0?Zl:(i.head=n,n.done=!1,v_)},inflateSetDictionary:(e,n)=>{const i=n.length;let o,c,u;return S_(e)?Zl:(o=e.state,o.wrap!==0&&o.mode!==hO?Zl:o.mode===hO&&(c=1,c=lb(c,n,i,0),c!==o.check)?W9:(u=J9(e,n,i,i),u?(o.mode=16210,G9):(o.havedict=1,v_)))},inflateInfo:"pako inflate (from Nodeca project)"},Mme=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const Q9=Object.prototype.toString,{Z_NO_FLUSH:Ume,Z_FINISH:Vme,Z_OK:Eb,Z_STREAM_END:Wx,Z_NEED_DICT:Gx,Z_STREAM_ERROR:Fme,Z_DATA_ERROR:Z9,Z_MEM_ERROR:jme}=nO;function mO(e){this.options=sO.assign({chunkSize:65536,windowBits:15,to:""},e||{});const n=this.options;n.raw&&n.windowBits>=0&&n.windowBits<16&&(n.windowBits=-n.windowBits,n.windowBits===0&&(n.windowBits=-15)),!(n.windowBits>=0&&n.windowBits<16)||e&&e.windowBits||(n.windowBits+=32),n.windowBits>15&&n.windowBits<48&&(15&n.windowBits)==0&&(n.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new F9,this.strm.avail_out=0;let i=Mf.inflateInit2(this.strm,n.windowBits);if(i!==Eb)throw new Error(g_[i]);if(this.header=new Mme,Mf.inflateGetHeader(this.strm,this.header),n.dictionary&&(typeof n.dictionary=="string"?n.dictionary=gb.string2buf(n.dictionary):Q9.call(n.dictionary)==="[object ArrayBuffer]"&&(n.dictionary=new Uint8Array(n.dictionary)),n.raw&&(i=Mf.inflateSetDictionary(this.strm,n.dictionary),i!==Eb)))throw new Error(g_[i])}function Bme(e,n){const i=new mO(n);if(i.push(e),i.err)throw i.msg||g_[i.err];return i.result}mO.prototype.push=function(e,n){const i=this.strm,o=this.options.chunkSize,c=this.options.dictionary;let u,h,m;if(this.ended)return!1;for(h=n===~~n?n:n===!0?Vme:Ume,Q9.call(e)==="[object ArrayBuffer]"?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;;){for(i.avail_out===0&&(i.output=new Uint8Array(o),i.next_out=0,i.avail_out=o),u=Mf.inflate(i,h),u===Gx&&c&&(u=Mf.inflateSetDictionary(i,c),u===Eb?u=Mf.inflate(i,h):u===Z9&&(u=Gx));i.avail_in>0&&u===Wx&&i.state.wrap>0&&e[i.next_in]!==0;)Mf.inflateReset(i),u=Mf.inflate(i,h);switch(u){case Fme:case Z9:case Gx:case jme:return this.onEnd(u),this.ended=!0,!1}if(m=i.avail_out,i.next_out&&(i.avail_out===0||u===Wx))if(this.options.to==="string"){let _=gb.utf8border(i.output,i.next_out),y=i.next_out-_,S=gb.buf2string(i.output,_);i.next_out=y,i.avail_out=o-y,y&&i.output.set(i.output.subarray(_,_+y),0),this.onData(S)}else this.onData(i.output.length===i.next_out?i.output:i.output.subarray(0,i.next_out));if(u!==Eb||m!==0){if(u===Wx)return u=Mf.inflateEnd(this.strm),this.onEnd(u),this.ended=!0,!0;if(i.avail_in===0)break}}return!0},mO.prototype.onData=function(e){this.chunks.push(e)},mO.prototype.onEnd=function(e){e===Eb&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=sO.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Wme={inflate:Bme};const{deflate:Gme}=bme,{inflate:zme}=Wme;var Hme=Gme,Kme=zme,eK=function(e){return e[e.ONE_BYTE=0]="ONE_BYTE",e[e.TWO_BYTE=1]="TWO_BYTE",e}(eK||{});class qme{constructor(){K(this,"_sequence",0),K(this,"_startTime",Date.now()),K(this,"isUseOneByte",!0)}get startTime(){const n=Date.now()-this._startTime;return n<Math.pow(2,16)?n:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(n){const i={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:n};if(n.byteLength>128){const m=new Uint8Array(4);m.set([1,0,0,0]);const _={id:0,length:4,data:m.buffer},y={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[_]};i.commonPacketHeader.extension=1,i.extension=y,i.payload=this.compress(n),i.commonPacketHeader.length=8+(i.extension.length+2)+i.payload.byteLength}else i.commonPacketHeader.length=8+i.payload.byteLength;Z("SHOW_DATASTREAM2_LOG")&&k.debug("send data header: ".concat(JSON.stringify(i.commonPacketHeader)));const o=new ArrayBuffer(i.commonPacketHeader.length),c=new Uint8Array(o),u=new DataView(o);let h=0;if(u.setUint16(h,i.commonPacketHeader.extension<<15|i.commonPacketHeader.reserved<<14|i.commonPacketHeader.length,!0),h+=2,u.setUint32(h,i.commonPacketHeader.sequence,!0),h+=4,u.setUint16(h,i.commonStreamHeader,!0),h+=2,i.extension){const m=this.serializeExtension(i.extension);c.set(new Uint8Array(m),h),h+=m.byteLength}if(c.set(new Uint8Array(i.payload),h),h+=i.payload.byteLength,h!==i.commonPacketHeader.length)throw Error("serialize error!");return o}deserialize(n){if(n.byteLength<4)return new ArrayBuffer(0);const i=new DataView(n);let o=0;const c=i.getUint16(o,!0);o+=2;const u={length:16383&c,reserved:(16384&c)>>14,extension:(32768&c)>>15,sequence:i.getUint16(o+2,!0)<<16|i.getUint16(o,!0)};let h,m;if(o+=4,Z("SHOW_DATASTREAM2_LOG")&&k.debug("receive data header: ".concat(JSON.stringify(u))),i.getUint16(o,!0),o+=2,u.extension){m=this.deserializeExtension(n.slice(o)),o+=2+m.length,h=n.slice(o);let _=!1;if(m.datas.length>0){const y=m.datas.find(S=>S.id===0);y&&(_=(1&new DataView(y.data).getUint32(0,!0))==1)}h=_?this.decompress(h):h}else h=n.slice(8);return h}serializeExtension(n){const{profile:i,length:o,datas:c}=n,u=new ArrayBuffer(o+2),h=new Uint8Array(u),m=new DataView(u);let _=0;if(m.setUint8(_++,i),m.setUint8(_++,o),c.forEach(y=>{i?(m.setUint8(_++,y.id),m.setUint8(_++,y.length),h.set(new Uint8Array(y.data),_),_+=y.data.byteLength):(m.setUint8(_++,y.id|y.length<<4),h.set(new Uint8Array(y.data),_),_+=y.data.byteLength)}),_!==o+2)throw Error("serialize extension error, is ".concat(_,"!==").concat(o+2));return u}deserializeExtension(n){const i=new DataView(n);let o=0;const c=i.getUint8(o);o++;const u=i.getUint8(o);o++;const h=c===eK.TWO_BYTE,m=[],_=new DataView(n,2);let y=0;for(;y<u;){let S=0,w=0,I=new ArrayBuffer(0);h?(S=_.getUint8(y),y++,w=_.getUint8(y),y++):(S=15&_.getUint8(y),w=_.getUint8(y)>>4,y++),w>0&&(I=_.buffer.slice(y+2,y+2+w),y+=I.byteLength),m.push({id:S,length:w,data:I})}if(y!==u)throw Error("parse error");return{profile:c,length:u,datas:m}}decompress(n){return Kme(new Uint8Array(n))}compress(n){return Hme(new Uint8Array(n))}}const $me={name:"DataStream",create:(e,n)=>{const i=n?new tfe(e):new nfe(e);return i.useDataStream(new qme),i}};class Yme extends Rr{constructor(n,i,o){super(),K(this,"ws",void 0),K(this,"requestId",1),K(this,"heartBeatTimer",void 0),K(this,"joinInfo",void 0),K(this,"clientId",void 0),K(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),K(this,"onClose",c=>{this.emit("close"),this.dispose()}),K(this,"onMessage",c=>{const u=JSON.parse(c.data);if(!u||u.command!=="serverResponse"||!u.requestId)return u&&u.command==="serverStatus"&&u.serverStatus&&u.serverStatus.command?(this.emit("status",u.serverStatus),void this.emit(u.serverStatus.command,u.serverStatus)):void 0;this.emit("req_".concat(u.requestId),u)}),this.joinInfo=n,this.clientId=i,this.ws=new z0("cross-channel-".concat(this.clientId),o),this.ws.on(Wt.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(Wt.CONNECTED,this.onOpen),this.ws.on(Wt.ON_MESSAGE,this.onMessage),this.ws.on(Wt.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(n){const i=this.requestId++;return n.requestId=i,n.seq=i,this.ws.sendMessage(n),i}waitStatus(n){return new tt((i,o)=>{const c=window.setTimeout(()=>{o(new be(Y.TIMEOUT,"wait status timeout, status: ".concat(n)))},5e3);this.once(n,u=>{window.clearTimeout(c),u.state&&u.state!==0?o(new be(Y.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(n))):i(void 0)}),this.once("dispose",()=>{window.clearTimeout(c),o(new be(Y.WS_ABORT))})})}async request(n){if(this.ws.state==="closed")throw new be(Y.WS_DISCONNECT);const i=()=>new tt((h,m)=>{this.ws.once(Wt.CLOSED,()=>m(new be(Y.WS_ABORT))),this.ws.once(Wt.CONNECTED,h)});this.ws.state!=="connected"&&await i();const o=this.sendMessage(n),c=new tt((h,m)=>{const _=()=>{m(new be(Y.WS_ABORT))};this.ws.once(Wt.RECONNECTING,_),this.ws.once(Wt.CLOSED,_),this.once("req_".concat(o),h),$i(3e3).then(()=>{this.removeAllListeners("req_".concat(o)),this.ws.off(Wt.RECONNECTING,_),this.ws.off(Wt.CLOSED,_),m(new be(Y.TIMEOUT,"cross channel ws request timeout"))})}),u=await c;if(!u||u.code!==200)throw new be(Y.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(u)));return u}async connect(n){this.ws.removeAllListeners(Wt.REQUEST_NEW_URLS),this.ws.on(Wt.REQUEST_NEW_URLS,i=>{i(n)}),await this.ws.init(n)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(n){const i=this.requestId++;return n.requestId=i,this.ws.sendMessage(n),i}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class Xme extends Rr{set state(n){n!==this._state&&(n!==ha.RELAY_STATE_FAILURE&&(this.errorCode=dv.RELAY_OK),this.emit("state",n,this.errorCode),this._state=n)}get state(){return this._state}constructor(n,i,o,c,u){super(),K(this,"joinInfo",void 0),K(this,"sid",void 0),K(this,"clientId",void 0),K(this,"cancelToken",Mo.CancelToken.source()),K(this,"workerToken",void 0),K(this,"requestId",0),K(this,"signal",void 0),K(this,"prevChannelMediaConfig",void 0),K(this,"httpRetryConfig",void 0),K(this,"_resolution",void 0),K(this,"_state",ha.RELAY_STATE_IDLE),K(this,"errorCode",dv.RELAY_OK),K(this,"onStatus",h=>{k.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(h))),h&&h.command&&(h.command==="onAudioPacketReceived"&&this.emit("event",Of.PACKET_RECEIVED_AUDIO_FROM_SRC),h.command==="onVideoPacketReceived"&&this.emit("event",Of.PACKET_RECEIVED_VIDEO_FROM_SRC),h.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=dv.SRC_TOKEN_EXPIRED,this.state=ha.RELAY_STATE_FAILURE),h.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=dv.DEST_TOKEN_EXPIRED,this.state=ha.RELAY_STATE_FAILURE))}),K(this,"onReconnect",async()=>{k.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",Of.NETWORK_DISCONNECTED),this.state=ha.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(h=>{this.state!==ha.RELAY_STATE_IDLE&&(k.error("auto restart channel media relay failed",h.toString()),this.errorCode=dv.SERVER_CONNECTION_LOST,this.state=ha.RELAY_STATE_FAILURE)})}),this.joinInfo=n,this.clientId=i,this.sid=Zg(),this.signal=new Yme(this.joinInfo,this.clientId,o),this.httpRetryConfig=c,this._resolution=u}async startChannelMediaRelay(n){if(this.state!==ha.RELAY_STATE_IDLE)throw new be(Y.INVALID_OPERATION);this.state=ha.RELAY_STATE_CONNECTING,await this.connect(),k.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(n)}catch(i){throw i.data&&i.data.serverResponse&&i.data.serverResponse.command==="SetSourceChannel"?new be(Y.CROSS_CHANNEL_FAILED_JOIN_SRC):i.data&&i.data.serverResponse&&i.serverResponse.command==="SetDestChannelStatus"?new be(Y.CROSS_CHANNEL_FAILED_JOIN_DEST):i.data&&i.data.serverResponse&&i.serverResponse.command==="StartPacketTransfer"?new be(Y.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):i}this.prevChannelMediaConfig=n}async updateChannelMediaRelay(n){if(this.state!==ha.RELAY_STATE_RUNNING)throw new be(Y.INVALID_OPERATION);await this.sendUpdateMessage(n),this.prevChannelMediaConfig=n}async setVideoProfile(n){if(this._resolution=n,this.state!==ha.RELAY_STATE_RUNNING)throw new be(Y.INVALID_OPERATION);const i=this.genMessage(fo.SetVideoProfile);await this.signal.request(i),k.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),k.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=ha.RELAY_STATE_IDLE,this.dispose()}dispose(){k.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=Mo.CancelToken.source(),this.state=ha.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const n=await ope(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=n.workerToken,await this.signal.connect(n.addressList),this.emit("event",Of.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(n){const i=this.genMessage(fo.StopPacketTransfer);await this.signal.request(i),await this.signal.waitStatus("Normal Quit"),k.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const o=this.genMessage(fo.SetSdkProfile,n);await this.signal.request(o),k.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const c=this.genMessage(fo.SetSourceChannel,n);await this.signal.request(c),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",Of.PACKET_JOINED_SRC_CHANNEL),k.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const u=this.genMessage(fo.SetSourceUserId,n);await this.signal.request(u),k.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const h=this.genMessage(fo.SetDestChannel,n);await this.signal.request(h),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",Of.PACKET_JOINED_DEST_CHANNEL),k.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const m=this.genMessage(fo.StartPacketTransfer,n);await this.signal.request(m),this.emit("event",Of.PACKET_SENT_TO_DEST_CHANNEL),this.state=ha.RELAY_STATE_RUNNING,k.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(n){const i=this.genMessage(fo.UpdateDestChannel,n);await this.signal.request(i),this.emit("event",Of.PACKET_UPDATE_DEST_CHANNEL),k.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const n=this.genMessage(fo.StopPacketTransfer);await this.signal.request(n),k.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(n,i){const o=[],c=[],u=[];this.requestId+=1;const h={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:tl,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};h.sdkVersion==="4.23.2"&&(h.sdkVersion="0.0.1");let m=null,_=null;switch(n){case fo.SetSdkProfile:return h.clientRequest={command:"SetSdkProfile",type:"multi_channel"},h;case fo.SetSourceChannel:if(_=i&&i.getSrcChannelMediaInfo(),!_)throw new be(Y.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceChannel",uid:"0",channelName:_.channelName,token:_.token||this.joinInfo.appId},h;case fo.SetSourceUserId:if(_=i&&i.getSrcChannelMediaInfo(),!_)throw new be(Y.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceUserId",uid:_.uid+""},h;case fo.SetDestChannel:if(m=i&&i.getDestChannelMediaInfo(),!m)throw new be(Y.UNEXPECTED_ERROR,"can not find dest config");return m.forEach(y=>{o.push(y.channelName),c.push(y.uid+""),u.push(y.token||this.joinInfo.appId)}),h.clientRequest={command:"SetDestChannel",channelName:o,uid:c,token:u},h;case fo.StartPacketTransfer:return h.clientRequest={command:"StartPacketTransfer"},h;case fo.Reconnect:return h.clientRequest={command:"Reconnect"},h;case fo.StopPacketTransfer:return h.clientRequest={command:"StopPacketTransfer"},h;case fo.UpdateDestChannel:if(m=i&&i.getDestChannelMediaInfo(),!m)throw new be(Y.UNEXPECTED_ERROR,"can not find dest config");return m.forEach(y=>{o.push(y.channelName),c.push(y.uid+""),u.push(y.token||this.joinInfo.appId)}),h.clientRequest={command:"UpdateDestChannel",channelName:o,uid:c,token:u},h;case fo.SetVideoProfile:h.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return h}}const Jme={name:"ChannelMediaRelay",create:function(e){return new Xme(e.joinInfo,e.clientId,e.websocketRetryConfig||pi,e.httpRetryConfig||pi,e.resolution)}};function tK(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function yb(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?tK(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):tK(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}class Qme extends Rr{constructor(n,i,o,c){super(),K(this,"spec",void 0),K(this,"token",void 0),K(this,"websocket",void 0),K(this,"pingpongTimer",void 0),K(this,"reconnectMode","retry"),K(this,"serviceMode",void 0),K(this,"reqId",0),K(this,"commandReqId",0),K(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),K(this,"handleWebSocketMessage",u=>{if(!u.data)return;const h=JSON.parse(u.data);h.requestId?this.emit("@".concat(h.requestId,"-").concat(h.sid),h):(yt.workerEvent(this.spec.sid,{actionType:"status",serverCode:h.code,workerType:this.serviceMode===Af.TRANSCODE?1:2}),this.emit(em.PUBLISH_STREAM_STATUS,h))}),this.spec=i,this.token=n,this.serviceMode=c,this.websocket=new z0("live-streaming",o),this.websocket.on(Wt.CONNECTED,this.handleWebSocketOpen),this.websocket.on(Wt.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(Wt.REQUEST_NEW_URLS,(u,h)=>{ds(this,em.REQUEST_NEW_ADDRESS).then(u).catch(h)}),this.websocket.on(Wt.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(n){return this.websocket.init(n)}async request(n,i,o,c){this.reqId+=1,n==="request"&&(this.commandReqId+=1);const u=this.commandReqId,h=this.reqId;if(!h||!this.websocket)throw new be(Y.UNEXPECTED_ERROR);const m=yb({command:n,sdkVersion:tl==="4.23.2"?"0.0.1":tl,seq:h,requestId:h,allocate:o,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},i);if(this.websocket.state==="closed")throw new be(Y.WS_DISCONNECT);const _=()=>new tt((I,P)=>{this.websocket.once(Wt.CLOSED,()=>P(new be(Y.WS_ABORT))),this.websocket.once(Wt.CONNECTED,I)});this.websocket.state!=="connected"&&await _(),m.clientRequest&&(m.clientRequest.workerToken=this.token);const y=new tt((I,P)=>{const B=()=>{P(new be(Y.WS_ABORT))};this.websocket.once(Wt.RECONNECTING,B),this.websocket.once(Wt.CLOSED,B),this.once("@".concat(h,"-").concat(this.spec.sid),M=>{I(M)})});c&&yt.workerEvent(this.spec.sid,yb(yb({},c),{},{requestId:u,actionType:"request",payload:JSON.stringify(i.clientRequest),serverCode:0,code:0}));const S=Date.now();this.websocket.sendMessage(m);let w=null;try{w=await y}catch(I){if(this.websocket.state==="closed")throw I;return await _(),await this.request(n,i,o)}return c&&yt.workerEvent(this.spec.sid,yb(yb({},c),{},{requestId:u,actionType:"response",payload:JSON.stringify(w.serverResponse),serverCode:w.code,success:w.code===200,responseTime:Date.now()-S})),w.code!==200&&this.handleResponseError(w),w}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const n=tl==="4.23.2"?"0.0.1":tl;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:n,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(n){switch(n.code){case vi.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void k.warning("live stream response already exists stream");case vi.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case vi.LIVE_STREAM_RESPONSE_BAD_STREAM:case vi.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new be(Y.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:n.code}).throw();case vi.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(n.serverResponse.command==="UnpublishStream")return;throw new be(Y.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case vi.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new be(Y.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:n.code}).throw();case vi.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const i=new be(Y.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(em.WARNING,i,n.serverResponse.url)}case vi.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const i=new be(Y.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(em.WARNING,i,n.serverResponse.url)}case vi.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new be(Y.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case vi.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new be(Y.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:n.code}).throw();case vi.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const i=new be(Y.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(em.WARNING,i,n.serverResponse.url)}case vi.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new be(Y.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:n.code}).throw();case vi.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new be(Y.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case vi.LIVE_STREAM_RESPONSE_WORKER_LOST:case vi.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(n.serverResponse.command==="UnpublishStream")return;throw new be(Y.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case vi.ERROR_FAIL_SEND_MESSAGE:if(n.serverResponse.command==="UnpublishStream")return;if(n.serverResponse.command==="UpdateTranscoding"||n.serverResponse.command==="ControlStream")return new be(Y.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:n.code}).throw();throw new be(Y.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case vi.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case vi.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case vi.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case vi.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new be(Y.LIVE_STREAMING_CDN_ERROR,"",{code:n.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(nA)},6e3)}}function nK(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function fa(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?nK(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):nK(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}class Zme extends Rr{constructor(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:pi,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:pi;super(),K(this,"onLiveStreamWarning",void 0),K(this,"onLiveStreamError",void 0),K(this,"spec",void 0),K(this,"retryTimeout",1e4),K(this,"connection",void 0),K(this,"httpRetryConfig",void 0),K(this,"wsRetryConfig",void 0),K(this,"streamingTasks",new Map),K(this,"isStartingStreamingTask",!1),K(this,"taskMutex",new Es("live-streaming")),K(this,"cancelToken",Mo.CancelToken.source()),K(this,"transcodingConfig",void 0),K(this,"uapResponse",void 0),K(this,"lastTaskId",1),K(this,"statusError",new Map),this.spec=n,this.httpRetryConfig=o,this.wsRetryConfig=i}async setTranscodingConfig(n){const i=fa(fa({},Ffe),n);i.videoCodecProfile!==66&&i.videoCodecProfile!==77&&i.videoCodecProfile!==100&&(k.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(i.videoCodecProfile," -> 100")),i.videoCodecProfile=100),i.transcodingUsers||(i.transcodingUsers=i.userConfigs),i.transcodingUsers&&(i.transcodingUsers=i.transcodingUsers.map(h=>fa(fa(fa({},Vfe),h),{},{zOrder:h.zOrder?h.zOrder+1:1}))),function(h){Nr(h.width)||Jn(h.width,"config.width",0,1e4),Nr(h.height)||Jn(h.height,"config.height",0,1e4),Nr(h.videoBitrate)||Jn(h.videoBitrate,"config.videoBitrate",1,1e6),Nr(h.videoFrameRate)||Jn(h.videoFrameRate,"config.videoFrameRate"),Nr(h.lowLatency)||wf(h.lowLatency,"config.lowLatency"),Nr(h.audioSampleRate)||Ti(h.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),Nr(h.audioBitrate)||Jn(h.audioBitrate,"config.audioBitrate",1,128),Nr(h.audioChannels)||Ti(h.audioChannels,"config.audioChannels",[1,2,3,4,5]),Nr(h.videoGop)||Jn(h.videoGop,"config.videoGop"),Nr(h.videoCodecProfile)||Ti(h.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),Nr(h.userCount)||Jn(h.userCount,"config.userCount",0,17),Nr(h.backgroundColor)||Jn(h.backgroundColor,"config.backgroundColor",0,16777215),Nr(h.userConfigExtraInfo)||qi(h.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),h.transcodingUsers&&!Nr(h.transcodingUsers)&&(Rf(h.transcodingUsers,"config.transcodingUsers"),h.transcodingUsers.forEach((m,_)=>{CA(m.uid),Nr(m.x)||Jn(m.x,"transcodingUser[".concat(_,"].x"),0,1e4),Nr(m.y)||Jn(m.y,"transcodingUser[".concat(_,"].y"),0,1e4),Nr(m.width)||Jn(m.width,"transcodingUser[".concat(_,"].width"),0,1e4),Nr(m.height)||Jn(m.height,"transcodingUser[".concat(_,"].height"),0,1e4),Nr(m.zOrder)||Jn(m.zOrder-1,"transcodingUser[".concat(_,"].zOrder"),0,100),Nr(m.alpha)||Jn(m.alpha,"transcodingUser[".concat(_,"].alpha"),0,1,!1)})),Nr(h.watermark)||HL(h.watermark,"watermark"),Nr(h.backgroundImage)||HL(h.backgroundImage,"backgroundImage"),h.images&&!Nr(h.images)&&(Rf(h.images,"config.images"),h.images.forEach((m,_)=>{HL(m,"images[".concat(_,"]"))}))}(i);const o=[];i.images&&o.push(...i.images.map(h=>fa(fa(fa({},zL),h),{},{zOrder:255}))),i.backgroundImage&&(o.push(fa(fa(fa({},zL),i.backgroundImage),{},{zOrder:0})),delete i.backgroundImage),i.watermark&&(o.push(fa(fa(fa({},zL),i.watermark),{},{zOrder:255})),delete i.watermark),i.images=o,i.transcodingUsers&&(i.userConfigs=i.transcodingUsers.map(h=>fa({},h)),i.userCount=i.transcodingUsers.length,delete i.transcodingUsers);const c=(i.userConfigs||[]).map(h=>typeof h.uid=="number"?tt.resolve(h.uid):wH(h.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await tt.all(c)).forEach((h,m)=>{i.userConfigs&&i.userConfigs[m]&&(i.userConfigs[m].uid=h)}),this.transcodingConfig=i,this.connection)try{var u;const h=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(mc(u=this.streamingTasks).call(u)).map(m=>m.taskId).join("#")});k.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(h.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(h){if(!h.data||!h.data.retry)throw h;h.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(m=>{k.warning("[".concat(this.spec.clientId,"] live streaming receive error"),h.toString(),"try to republish",m.url),this.startLiveStreamingTask(m.url,m.mode,h).then(()=>{k.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(m.url," success"))}).catch(_=>{k.error("[".concat(this.spec.clientId,"] live streaming republish failed"),m.url,_.toString()),this.onLiveStreamError&&this.onLiveStreamError(m.url,_)})})}}async startLiveStreamingTask(n,i,o){if(!this.transcodingConfig&&i===Af.TRANSCODE)throw new be(Y.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const c={command:"PublishStream",ts:Date.now(),url:n,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};k.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(n,", mode: ").concat(i));const u=await this.taskMutex.lock();if(!this.connection&&o)return void u();if(this.streamingTasks.get(n)&&!o)return u(),new be(Y.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(i))}catch(m){throw u(),m}switch(i){case Af.TRANSCODE:c.transcodingConfig=fa({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(c.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const h=this.lastTaskId++;try{const m=new tt((y,S)=>{$i(this.retryTimeout).then(()=>{if(o)return S(o);const w=this.statusError.get(n);return w?(this.statusError.delete(n),S(w)):void 0})}),_=await tt.race([this.connection.request("request",{clientRequest:c},!0,{url:n,command:"PublishStream",workerType:i===Af.TRANSCODE?1:2,requestByUser:!o,tid:h.toString()}),m]);this.isStartingStreamingTask=!1,k.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(_.code)),this.streamingTasks.set(n,{clientRequest:c,mode:i,url:n,taskId:h}),u()}catch(m){if(u(),this.isStartingStreamingTask=!1,!m.data||!m.data.retry||o)throw m;return m.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(n,i,m)):await this.startLiveStreamingTask(n,i,m)}}stopLiveStreamingTask(n){return new tt((i,o)=>{const c=this.streamingTasks.get(n);if(!c||!this.connection)return new be(Y.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const u=c.mode;c.abortTask=()=>{k.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(n),i()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:c.url}},!1,{url:n,command:"UnPublishStream",workerType:u===Af.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(h=>{k.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(h.code)),this.streamingTasks.delete(n),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),i()}).catch(o)})}resetAllTask(){var n;const i=Array.from(mc(n=this.streamingTasks).call(n));this.terminate();for(const o of i)this.startLiveStreamingTask(o.url,o.mode).catch(c=>{this.onLiveStreamError&&this.onLiveStreamError(o.url,c)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=Mo.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(n){if(this.connection)throw new be(Y.UNEXPECTED_ERROR,"live streaming connection has already connected");const i=await ds(this,KL.REQUEST_WORKER_MANAGER_LIST,n);return this.uapResponse=i,this.connection=new Qme(i.workerToken,this.spec,this.wsRetryConfig,n),this.connection.on(em.WARNING,(o,c)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(c,o)),this.connection.on(em.PUBLISH_STREAM_STATUS,o=>this.handlePublishStreamServer(o)),this.connection.on(em.REQUEST_NEW_ADDRESS,(o,c)=>{if(!this.connection)return c(new be(Y.UNEXPECTED_ERROR,"can not get new live streaming address list"));ds(this,KL.REQUEST_WORKER_MANAGER_LIST,n).then(u=>{this.uapResponse=u,o(u.addressList)}).catch(c)}),await this.connection.init(i.addressList),this.connection}handlePublishStreamServer(n){const i=n.serverStatus&&n.serverStatus.url||"empty_url",o=this.streamingTasks.get(i),c=n.reason;switch(n.code){case vi.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case vi.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case vi.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case vi.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const h=new be(Y.LIVE_STREAMING_CDN_ERROR,"",{code:n.code});if(o)return k.error(h.toString()),this.onLiveStreamError&&this.onLiveStreamError(i,h);if(!this.isStartingStreamingTask)return;this.statusError.set(i,h)}case vi.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const h=new be(Y.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,c);return this.onLiveStreamWarning&&this.onLiveStreamWarning(i,h)}case vi.LIVE_STREAM_RESPONSE_WORKER_LOST:case vi.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var u;if(!this.connection)return;this.connection.tryNextAddress();const h=Array.from(mc(u=this.streamingTasks).call(u));for(const m of h)m.abortTask?m.abortTask():(k.warning("[".concat(this.spec.clientId,"] publish stream status code"),n.code,"try to republish",m.url),this.startLiveStreamingTask(m.url,m.mode,new be(Y.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:n.code})).then(()=>{k.debug("[".concat(this.spec.clientId,"] republish live stream success"),m.url)}).catch(_=>{k.error(_.toString()),this.onLiveStreamError&&this.onLiveStreamError(m.url,_)}));return}}}hasUrl(n){return this.streamingTasks.has(n)}}const ege={name:"LiveStreaming",create:function(e){return new Zme(e.joinInfo,e.websocketRetryConfig||pi,e.httpRetryConfig||pi)}};function tge(e){let n=sK();return function(i,o){let c=i.appId;c!==void 0&&(Gn(o,10),rh(o,c));let u=i.cid;u!==void 0&&(Gn(o,16),Gn(o,u));let h=i.cname;h!==void 0&&(Gn(o,26),rh(o,h));let m=i.deviceId;m!==void 0&&(Gn(o,34),rh(o,m));let _=i.elapse;_!==void 0&&(Gn(o,40),pm(o,_));let y=i.fileSize;y!==void 0&&(Gn(o,48),pm(o,Av(y)));let S=i.height;S!==void 0&&(Gn(o,56),pm(o,Av(S)));let w=i.jpg;w!==void 0&&(Gn(o,66),Gn(o,w.length),function(Wo,ke){let Ye=Ov(Wo,ke.length);Wo.bytes.set(ke,Ye)}(o,w));let I=i.networkType;I!==void 0&&(Gn(o,72),pm(o,Av(I)));let P=i.osType;P!==void 0&&(Gn(o,80),pm(o,Av(P)));let B=i.requestId;B!==void 0&&(Gn(o,90),rh(o,B));let M=i.sdkVersion;M!==void 0&&(Gn(o,98),rh(o,M));let U=i.sequence;U!==void 0&&(Gn(o,104),pm(o,Av(U)));let q=i.sid;q!==void 0&&(Gn(o,114),rh(o,q));let $=i.timestamp;$!==void 0&&(Gn(o,120),pm(o,$));let ae=i.uid;ae!==void 0&&(Gn(o,128),Gn(o,ae));let me=i.vid;me!==void 0&&(Gn(o,136),Gn(o,me));let ge=i.width;ge!==void 0&&(Gn(o,144),pm(o,Av(ge)));let pe=i.service;pe!==void 0&&(Gn(o,152),Gn(o,pe));let we=i.callbackData;we!==void 0&&(Gn(o,162),rh(o,we));let Be=i.jpgEncryption;Be!==void 0&&(Gn(o,168),Gn(o,Be));let nt=i.requestType;nt!==void 0&&(Gn(o,176),Gn(o,nt));let st=i.scorePorn;st!==void 0&&(Gn(o,185),$x(o,st));let pn=i.scoreSexy;pn!==void 0&&(Gn(o,193),$x(o,pn));let mn=i.scoreNeutral;mn!==void 0&&(Gn(o,201),$x(o,mn));let sr=i.scene;sr!==void 0&&(Gn(o,208),Gn(o,sr));let Xr=i.ossFilePrefix;Xr!==void 0&&(Gn(o,218),rh(o,Xr));let Fr=i.serviceVendor;if(Fr!==void 0)for(let Wo of Fr){Gn(o,226);let ke=sK();ige(Wo,ke),Gn(o,ke.limit),cge(o,ke),age(ke)}}(e,n),function(i){let o=i.bytes,c=i.limit;return o.length===c?o:o.subarray(0,c)}(n)}function nge(e){return function(i){let o={};e:for(;!oK(i);){let c=ih(i);switch(c>>>3){case 0:break e;case 1:o.code=ih(i);break;case 2:o.msg=aK(i,ih(i));break;case 3:{let u=sge(i);o.data=rge(i),i.limit=u;break}default:rK(i,7&c)}}return o}({bytes:n=e,offset:0,limit:n.length});var n}function rge(e){let n={};e:for(;!oK(e);){let i=ih(e);switch(i>>>3){case 0:break e;case 1:n.requestId=aK(e,ih(e));break;case 2:n.requestType=ih(e)>>>0;break;case 3:n.scorePorn=qx(e);break;case 4:n.scoreSexy=qx(e);break;case 5:n.scoreNeutral=qx(e);break;case 6:n.requestScene=ih(e)>>>0;break;case 7:n.scene=ih(e)>>>0;break;default:rK(e,7&i)}}return n}function ige(e,n){let i=e.service;i!==void 0&&(Gn(n,8),Gn(n,i));let o=e.vendor;o!==void 0&&(Gn(n,16),Gn(n,o));let c=e.token;c!==void 0&&(Gn(n,26),rh(n,c));let u=e.callbackUrl;u!==void 0&&(Gn(n,34),rh(n,u))}function sge(e){let n=ih(e),i=e.limit;return e.limit=e.offset+n,i}function rK(e,n){switch(n){case 0:for(;128&cK(e););break;case 2:Hx(e,ih(e));break;case 5:Hx(e,4);break;case 1:Hx(e,8);break;default:throw new Error("Unimplemented type: "+n)}}let oge=new Float32Array(1);new Uint8Array(oge.buffer);let zx=new Float64Array(1),pa=new Uint8Array(zx.buffer);function Av(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let iK=[];function sK(){const e=iK.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function age(e){iK.push(e)}function Hx(e,n){if(e.offset+n>e.limit)throw new Error("Skip past limit");e.offset+=n}function oK(e){return e.offset>=e.limit}function Ov(e,n){let i=e.bytes,o=e.offset,c=e.limit,u=o+n;if(u>i.length){let h=new Uint8Array(2*u);h.set(i),e.bytes=h}return e.offset=u,u>c&&(e.limit=u),o}function Kx(e,n){let i=e.offset;if(i+n>e.limit)throw new Error("Read past limit");return e.offset+=n,i}function aK(e,n){let i=Kx(e,n),o=String.fromCharCode,c=e.bytes,u="",h="";for(let m=0;m<n;m++){let _,y,S,w,I=c[m+i];(128&I)==0?h+=o(I):(224&I)==192?m+1>=n?h+=u:(_=c[m+i+1],(192&_)!=128?h+=u:(w=(31&I)<<6|63&_,w<128?h+=u:(h+=o(w),m++))):(240&I)==224?m+2>=n?h+=u:(_=c[m+i+1],y=c[m+i+2],(49344&(_|y<<8))!=32896?h+=u:(w=(15&I)<<12|(63&_)<<6|63&y,w<2048||w>=55296&&w<=57343?h+=u:(h+=o(w),m+=2))):(248&I)==240?m+3>=n?h+=u:(_=c[m+i+1],y=c[m+i+2],S=c[m+i+3],(12632256&(_|y<<8|S<<16))!=8421504?h+=u:(w=(7&I)<<18|(63&_)<<12|(63&y)<<6|63&S,w<65536||w>1114111?h+=u:(w-=65536,h+=o(55296+(w>>10),56320+(1023&w)),m+=3))):h+=u}return h}function rh(e,n){let i=n.length,o=0;for(let h=0;h<i;h++){let m=n.charCodeAt(h);m>=55296&&m<=56319&&h+1<i&&(m=(m<<10)+n.charCodeAt(++h)-56613888),o+=m<128?1:m<2048?2:m<65536?3:4}Gn(e,o);let c=Ov(e,o),u=e.bytes;for(let h=0;h<i;h++){let m=n.charCodeAt(h);m>=55296&&m<=56319&&h+1<i&&(m=(m<<10)+n.charCodeAt(++h)-56613888),m<128?u[c++]=m:(m<2048?u[c++]=m>>6&31|192:(m<65536?u[c++]=m>>12&15|224:(u[c++]=m>>18&7|240,u[c++]=m>>12&63|128),u[c++]=m>>6&63|128),u[c++]=63&m|128)}}function cge(e,n){let i=Ov(e,n.limit),o=e.bytes,c=n.bytes;for(let u=0,h=n.limit;u<h;u++)o[u+i]=c[u]}function cK(e){return e.bytes[Kx(e,1)]}function lK(e,n){let i=Ov(e,1);e.bytes[i]=n}function qx(e){let n=Kx(e,8),i=e.bytes;return pa[0]=i[n++],pa[1]=i[n++],pa[2]=i[n++],pa[3]=i[n++],pa[4]=i[n++],pa[5]=i[n++],pa[6]=i[n++],pa[7]=i[n++],zx[0]}function $x(e,n){let i=Ov(e,8),o=e.bytes;zx[0]=n,o[i++]=pa[0],o[i++]=pa[1],o[i++]=pa[2],o[i++]=pa[3],o[i++]=pa[4],o[i++]=pa[5],o[i++]=pa[6],o[i++]=pa[7]}function ih(e){let n,i=0,o=0;do n=cK(e),i<32&&(o|=(127&n)<<i),i+=7;while(128&n);return o}function Gn(e,n){for(n>>>=0;n>=128;)lK(e,127&n|128),n>>>=7;lK(e,n)}function pm(e,n){let i=n.low>>>0,o=(n.low>>>28|n.high<<4)>>>0,c=n.high>>>24,u=c===0?o===0?i<16384?i<128?1:2:i<1<<21?3:4:o<16384?o<128?5:6:o<1<<21?7:8:c<128?9:10,h=Ov(e,u),m=e.bytes;switch(u){case 10:m[h+9]=c>>>7&1;case 9:m[h+8]=u!==9?128|c:127&c;case 8:m[h+7]=u!==8?o>>>21|128:o>>>21&127;case 7:m[h+6]=u!==7?o>>>14|128:o>>>14&127;case 6:m[h+5]=u!==6?o>>>7|128:o>>>7&127;case 5:m[h+4]=u!==5?128|o:127&o;case 4:m[h+3]=u!==4?i>>>21|128:i>>>21&127;case 3:m[h+2]=u!==3?i>>>14|128:i>>>14&127;case 2:m[h+1]=u!==2?i>>>7|128:i>>>7&127;case 1:m[h]=u!==1?128|i:127&i}}function uK(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}const lge=new Map([["moderation",1],["supervise",2]]);class uge extends Rr{get connectionState(){return this._connectionState}set connectionState(n){if(this._connectionState===n)return;const i=this._connectionState;this._connectionState=n,this.emit(Bi.CONNECTION_STATE_CHANGE,i,n)}get inspectType(){return this._inspectType}set inspectType(n){var i;this._inspectMode=Da(i=n.map(o=>lge.get(o)||0)).call(i,(o,c)=>o+c),this._inspectType=n}get quality(){return this._quality}set quality(n){this._quality=n>1?1:n<.1?.1:n,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(n){super(),K(this,"name","AgoraRTCVideoContentInspect"),K(this,"_connectionState",ql.CONNECTING),K(this,"_innerConnectionState",void 0),K(this,"sequence",0),K(this,"inspectStartTime",void 0),K(this,"workerManagerConnection",void 0),K(this,"workerConnection",void 0),K(this,"workerMessageLengthLimit",void 0),K(this,"inspectIntervalMinimum",void 0),K(this,"qualityRatio",void 0),K(this,"_connectInfo",void 0),K(this,"_cancelTokenSource",Mo.CancelToken.source()),K(this,"_retryConfig",void 0),K(this,"wmSequence",0),K(this,"inspectInterval",void 0),K(this,"inspectTimer",null),K(this,"ossFilePrefix",void 0),K(this,"extraInfo",void 0),K(this,"_inspectType",void 0),K(this,"_inspectMode",void 0),K(this,"_quality",1),K(this,"qualityTimer",null),K(this,"_inspectId",void 0),K(this,"_needWorkUrlOnly",!1),K(this,"inspectImage",()=>{if(this.connectionState!==ql.CONNECTED)throw new be(Y.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===ql.CONNECTED?this.requestToInspectImage():k.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=rr(5,"inspect-"),this.workerMessageLengthLimit=Z("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=Z("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=Z("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=n.interval,this.ossFilePrefix=n.ossFilePrefix,this.extraInfo=n.extraInfo,this.inspectType=n.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new z0("worker-manager-"+this._inspectId,pi),this.on(Bi.STATE_CHANGE,(i,o)=>{this._innerConnectionState=i,k.debug("[".concat(this._inspectId,"] Inspect operation :").concat($l[i]," ").concat(o||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new z0("worker-"+this._inspectId,pi),this.handleWorkerEvents()}async init(n,i){this.emit(Bi.STATE_CHANGE,$l.CONNECT_AP),this._connectInfo=n;const o=this._cancelTokenSource.token;return this._retryConfig=i,new tt((c,u)=>{this.on(Bi.CONNECTION_STATE_CHANGE,(h,m)=>{m===ql.CONNECTED&&c()}),this.requestAP(n,o,i).then(h=>{this.connectWorkerManager(h)}).catch(h=>{u(h)})})}async requestAP(n,i,o){const c=Z("WEBCS_DOMAIN").map(m=>"https://".concat(m,"/api/v1")),u=await function(m,_,y,S){let{appId:w,areaCode:I,cname:P,sid:B,token:M,uid:U}=_;Ev++;const q="image_moderation_api",$={service_name:q,json_body:JSON.stringify({appId:w,areaCode:I,cname:P,command:"allocateEdge",requestId:Ev,seq:Ev,sid:B,token:M,ts:Date.now(),uid:U+""})};let ae,me,ge=m[0];return qu(async()=>{ae=Date.now();const pe=await Qu(ge,{data:$,cancelToken:y,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(me=Date.now()-ae,pe.code!==0){const st=new be(Y.UNEXPECTED_RESPONSE,"image inspect ap error, code"+pe.code,{retry:!0,responseTime:me});throw k.error(st.toString()),st}const we=JSON.parse(pe.json_body);if(we.code!==200){const st=new be(Y.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(we.code,", reason: ").concat(we.reason),{code:we.code,responseTime:me});throw k.error(st.toString()),st}if(!we.servers||!Array.isArray(we.servers)||we.servers.length===0){const st=new be(Y.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:we.code,responseTime:me});throw k.error(st.toString()),st}const Be=Z("VIDEO_INSPECT_WORKER_MANAGER_HOST"),nt=Z("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:we.servers.map(st=>{let{address:pn,wss:mn}=st;if(pn&&mn)return"wss://".concat(pn.replace(/\./g,"-"),".").concat(Be,":").concat(nt||mn)}).filter(st=>!!st),workerToken:we.workerToken,vid:we.vid,responseTime:me}},(pe,we)=>(yt.apworkerEvent(B,{success:!0,sc:200,serviceName:q,responseDetail:JSON.stringify(pe.addressList),firstSuccess:we===0,responseTime:me,serverIp:m[we%m.length]}),!1),(pe,we)=>(yt.apworkerEvent(B,{success:!1,sc:pe.data&&pe.data.code||200,serviceName:q,responseTime:me,serverIp:m[we%m.length]}),!!(pe.code!==Y.OPERATION_ABORTED&&pe.code!==Y.UNEXPECTED_RESPONSE||pe.data&&pe.data.retry)&&(ge=m[(we+1)%m.length],!0)),S)}(c,n,i,o);this.emit(Bi.STATE_CHANGE,$l.AP_CONNECTED);const{addressList:h}=u;return this.wmSequence++,h}async connectWorkerManager(n){let i=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=i,this.emit(Bi.STATE_CHANGE,$l.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(n,1e4)}async connectWorker(n){await this.workerConnection.init([n])}handleWorkerManagerEvents(){this.workerManagerConnection.on(Wt.CONNECTED,async()=>{this.emit(Bi.STATE_CHANGE,$l.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.23.2",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(Wt.CLOSED,()=>{this._innerConnectionState<$l.GET_WORKER_MANAGER_RESPONSE&&k.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(Wt.FAILED,()=>{this._innerConnectionState<$l.GET_WORKER_MANAGER_RESPONSE&&k.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(Wt.RECONNECTING,()=>{this._innerConnectionState<$l.GET_WORKER_MANAGER_RESPONSE&&k.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(Wt.ON_MESSAGE,async n=>{this.emit(Bi.STATE_CHANGE,$l.GET_WORKER_MANAGER_RESPONSE);const i=this.workerManagerConnection.url;this.workerManagerConnection.close();const o=JSON.parse(n.data);if(o.code!==200)throw k.error("[".concat(this._inspectId,"] Unexpected code ").concat(o.code," from worker manager")),new be(Y.UNEXPECTED_RESPONSE,"response code of worker is unexpected",o);if(!(o.serverResponse&&o.serverResponse.portWss&&i))throw k.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(o))),new be(Y.UNEXPECTED_RESPONSE,"response content of worker is unexpected",o);{const c=Z("VIDEO_INSPECT_WORKER_PORT")||o.serverResponse.portWss,u=i.replace(/:\d+\/?$/,":".concat(c));this.emit(Bi.STATE_CHANGE,$l.CONNECT_WORKER,u),this._needWorkUrlOnly?this.emit(Bi.REQUEST_NEW_WORKER_URL,u):await this.connectWorker(u)}}),this.workerManagerConnection.on(Wt.WILL_RECONNECT,(n,i,o)=>{o(n)}),this.workerManagerConnection.on(Wt.REQUEST_NEW_URLS,(n,i)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(n).catch(i)})}handleWorkerEvents(){this.workerConnection.on(Wt.CONNECTED,async()=>{this.emit(Bi.STATE_CHANGE,$l.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=ql.CONNECTED}),this.workerConnection.on(Wt.ON_MESSAGE,async n=>{if(n.data instanceof ArrayBuffer){const o=nge(new Uint8Array(n.data));if(Z("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&k.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(o)),o.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(Bi.INSPECT_RESULT,void 0,void 0);if(o.data&&o.data.scorePorn&&o.data.scoreSexy&&o.data.scoreNeutral){var i;const c={porn:o.data.scorePorn,sexy:o.data.scoreSexy,neutral:o.data.scoreNeutral},u=Da(i=Object.keys(c)).call(i,(m,_)=>c[m]>c[_]?m:_,"porn"),h=Object.keys(c).find(m=>m===u);this.emit(Bi.INSPECT_RESULT,h)}else this.emit(Bi.INSPECT_RESULT,void 0,new be(Y.UNEXPECTED_RESPONSE,o.code+"","There is an unexpected data on message"))}else this.emit(Bi.INSPECT_RESULT,void 0,new be(Y.UNEXPECTED_RESPONSE,o.code+"",o.msg))}else k.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(Bi.INSPECT_RESULT,void 0,new be(Y.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(Wt.CLOSED,()=>{this.connectionState=ql.CLOSED}),this.workerConnection.on(Wt.FAILED,()=>{this.connectionState=ql.CLOSED}),this.workerConnection.on(Wt.RECONNECTING,()=>{this.connectionState=this.connectionState===ql.CONNECTED?ql.RECONNECTING:ql.CONNECTING}),this.workerConnection.on(Wt.WILL_RECONNECT,(n,i,o)=>{n==="recover"&&o(n),o("tryNext")}),this.workerConnection.on(Wt.REQUEST_NEW_URLS,(n,i)=>{this.workerManagerConnection.close(),this.once(Bi.REQUEST_NEW_WORKER_URL,o=>{n([o])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(o=>{this.connectWorkerManager(o,!0)}).catch(o=>{i(o)})})}async requestToInspectImage(){this.sequence++;const n=_c(this,Bi.CLIENT_LOCAL_VIDEO_TRACK),i={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(n){if(!n.isPlaying)return void this.emit(Bi.INSPECT_RESULT,void 0,new be(Y.INVALID_OPERATION,"Only the track being played can be inspected"));const o=await this.generateRequestData(n,i);this.workerConnection.sendMessage(o,!0,!0)}else this.emit(Bi.INSPECT_RESULT,void 0,new be(Y.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(n,i){let{appId:o,cname:c,cid:u,vid:h,sid:m,uid:_}=i;const y=Date.now(),S=await n.getCurrentFrameImage("image/jpeg",this.quality),w=await HW(S,o,c),I=this.sequence+"-"+u+"-"+_+"-"+y+"-"+rr(12,""),P={appId:o,cid:u,cname:c,deviceId:"",elapse:(B=Number(y-this.inspectStartTime),{low:B|=0,high:B>>31,unsigned:B>=0}),fileSize:w.byteLength,jpgEncryption:2,height:S.height,width:S.width,jpg:w,networkType:6,osType:7,requestId:I,sdkVersion:"4.23.2",sequence:this.sequence,sid:m,timestamp:E8(y),uid:_,vid:h,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var B;this.extraInfo===void 0&&delete P.callbackData,this.ossFilePrefix===void 0&&delete P.ossFilePrefix;const M=tge(P);if(M.byteLength<this.workerMessageLengthLimit){if(Z("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const U=function(q){for(var $=1;$<arguments.length;$++){var ae=arguments[$]!=null?arguments[$]:{};$%2?uK(Object(ae),!0).forEach(function(me){K(q,me,ae[me])}):Object.getOwnPropertyDescriptors?Object.defineProperties(q,Object.getOwnPropertyDescriptors(ae)):uK(Object(ae)).forEach(function(me){Object.defineProperty(q,me,Object.getOwnPropertyDescriptor(ae,me))})}return q}({},P);delete U.jpg,k.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(U))}return M}{const U=this.quality*this.qualityRatio;return this.quality=U,await this.generateRequestData(n,{appId:o,cname:c,cid:u,vid:h,sid:m,uid:_})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Mo.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=ql.CLOSED,this.emit(Bi.STATE_CHANGE,$l.CLOSED)}}const dge={name:"ContentInspect",create:function(e){let{config:n}=e;return function(i){if(!i)throw new be(Y.INVALID_PARAMS,"inspectConfig is necessary.");if(!i.inspectType||!Array.isArray(i.inspectType))throw new be(Y.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const o=[...new Set(i.inspectType)];o.forEach(c=>{var u;if(!Xe(u=["supervise","moderation"]).call(u,c))throw new be(Y.INVALID_PARAMS,"".concat(c," is not a valid inspect type."))}),i.inspectType=o}if(i&&i.extraInfo&&i.extraInfo.length>1024)throw new be(Y.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(n),new uge(n)}};var dK=l(mt.Object.getOwnPropertySymbols),hge=Dn,fge=Po.indexOf,pge=Xh,Yx=ue([].indexOf),hK=!!Yx&&1/Yx([1],1,-0)<0;hge({target:"Array",proto:!0,forced:hK||!pge("indexOf")},{indexOf:function(e){var n=arguments.length>1?arguments[1]:void 0;return hK?Yx(this,e,n)||0:fge(this,e,n)}});var mge=ka("Array").indexOf,gge=N,_ge=mge,Xx=Array.prototype,Ege=function(e){var n=e.indexOf;return e===Xx||gge(Xx,e)&&n===Xx.indexOf?_ge:n},fK=l(Ege);function yge(e,n){if(e==null)return{};var i,o,c=function(h,m){if(h==null)return{};var _,y,S={},w=Dz(h);for(y=0;y<w.length;y++)_=w[y],fK(m).call(m,_)>=0||(S[_]=h[_]);return S}(e,n);if(dK){var u=dK(e);for(o=0;o<u.length;o++)i=u[o],fK(n).call(n,i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(c[i]=e[i])}return c}let pK=class{get localCapabilities(){return Dr(this._localCapabilities)}get rtpCapabilities(){return Dr(this._rtpCapabilities)}get candidates(){return Dr(this._candidates)}get iceParameters(){return Dr(this._iceParameters)}get dtlsParameters(){return Dr(this._dtlsParameters)}constructor(e){K(this,"sessionDesc",void 0),K(this,"_localCapabilities",void 0),K(this,"_rtpCapabilities",void 0),K(this,"_candidates",void 0),K(this,"_iceParameters",void 0),K(this,"_dtlsParameters",void 0),K(this,"setup",void 0),K(this,"currentMidIndex",void 0),K(this,"cname","o/i14u9pJrxRKAsu"),K(this,"firefoxSsrcMidMap",new Map),e=Dr(e);const{remoteIceParameters:n,remoteDtlsParameters:i,candidates:o,remoteRTPCapabilities:c,localCapabilities:u,direction:h,setup:m,videoCodec:_,audioCodec:y}=e;let S;this.setup=m,S=h===ho.RECEIVE_ONLY?da(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):da(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=c,this._candidates=o,this._iceParameters=n,this._dtlsParameters=i,this._localCapabilities=u;const w=h===ho.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,I=h===ho.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,P=h===ho.RECEIVE_ONLY?c.send.videoCodecs:q0(at.VIDEO,w,I,_),B=h===ho.RECEIVE_ONLY?c.send.audioCodecs:q0(at.AUDIO,w,I,y);for(const M of S.mediaDescriptions)M.attributes.iceUfrag=n.iceUfrag,M.attributes.icePwd=n.icePwd,M.attributes.fingerprints=i.fingerprints,M.attributes.candidates=o,M.attributes.setup=this.setup,M.media.mediaType==="application"&&(M.attributes.sctpPort="5000"),M.media.mediaType==="video"&&(M.media.fmts=P.map(U=>U.payloadType.toString(10)),M.attributes.payloads=P,M.attributes.extmaps=w.videoExtensions),M.media.mediaType==="audio"&&(M.media.fmts=B.map(U=>U.payloadType.toString(10)),M.attributes.payloads=B,M.attributes.extmaps=w.audioExtensions,_v(M));this.sessionDesc=S,this.currentMidIndex=S.mediaDescriptions.length-1}toString(){return Zp(this.sessionDesc)}hasMid(e){return Array.isArray(e)?e.every(n=>this.hasMid(n)):this.sessionDesc.mediaDescriptions.some(n=>n.attributes.mid===e)}send(e,n,i,o,c){i=i.replace(/ /g,"-");const{ssrcs:u,ssrcGroups:h}=c_(n,this.cname,Z("SYNC_GROUP")?i:void 0),m=this.findPreloadMediaDesc(u);if(m){if(Pr()&&this.firefoxSsrcMidMap.set(u[0].ssrcId,m.attributes.mid),c&&(c.twcc||c.remb)){const _=this.sessionDesc.mediaDescriptions.indexOf(m);return this.sessionDesc.mediaDescriptions[_]=this.mungSendMediaDesc(m,c),{mid:m.attributes.mid,needExchangeSDP:!0}}return{mid:m.attributes.mid,needExchangeSDP:!1}}{const _=this.findAvailableMediaIndex(e,u,o);let y;return _===-1?(y=this.createOrRecycleSendMedia(e,u,h,"sendonly",o,c),this.updateBundleMids()):(y=Dr(this.sessionDesc.mediaDescriptions[_]),y.attributes.direction="sendonly",y.attributes.ssrcs=u,y.attributes.ssrcGroups=h,this.sessionDesc.mediaDescriptions[_]=this.mungSendMediaDesc(y,c)),Pr()&&this.firefoxSsrcMidMap.set(u[0].ssrcId,y.attributes.mid),{needExchangeSDP:!0,mid:y.attributes.mid}}}stopSending(e){const n=this.sessionDesc.mediaDescriptions.filter(i=>i.attributes.mid&&e.indexOf(i.attributes.mid)!==-1);if(n.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");n.forEach(i=>{i.attributes.ssrcs=[]}),this.updateBundleMids()}receive(e,n,i){const o=[];return e.forEach(c=>{const u=c._mediaStreamTrack.kind,h=this.findAvailableRecvMediaIndex(u);let m,_=!1;h===-1?(_=!0,m=this.createOrRecycleRecvMedia(c,[],"recvonly",n,i),this.updateBundleMids()):(m=Dr(this.sessionDesc.mediaDescriptions[h]),m.attributes.direction="recvonly"),o.push({mid:m.attributes.mid,needCreateTransceiver:_})}),o}stopReceiving(e){const n=this.sessionDesc.mediaDescriptions.filter(i=>e.indexOf(i.attributes.mid)!==-1);if(n.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");n.forEach(i=>{i.media.port="0",i.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(e){const{foundation:n,protocol:i,address:o,port:c,type:u,relatedAddress:h,relatedPort:m,priority:_}=new RTCIceCandidate(e),y={foundation:n??"",componentId:"1",transport:i??"",priority:_?_+"":"",connectionAddress:o??"",port:c?c+"":"",type:u?u+"":"",relAddr:h??"",relPort:m?m+"":"",extension:{}};this.candidates.some(S=>S.priority===y.priority&&S.connectionAddress===y.connectionAddress&&S.port===y.port)||(this._candidates.push(y),this.sessionDesc.mediaDescriptions.forEach(S=>{S.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(e,n,i,o,c){const u=e._mediaStreamTrack.kind,h=this.rtpCapabilities.recv,m=q0(u,h,this.localCapabilities.send,u===at.AUDIO?c:o),_=u===at.VIDEO?h.videoExtensions:h.audioExtensions,y="".concat(++this.currentMidIndex);let S={media:{mediaType:u,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:m.map(I=>I.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:_,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:n,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:m,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(y)}};S=this.mungRecvMediaDsec(S,e);const w=this.findFirstClosedMedia(u);if(w){const I=this.sessionDesc.mediaDescriptions.indexOf(w);this.sessionDesc.mediaDescriptions[I]=S}else this.sessionDesc.mediaDescriptions.push(S);return S}muteRemote(e){const n=this.sessionDesc.mediaDescriptions.filter(i=>Xe(e).call(e,i.attributes.mid||""));if(n.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");n.forEach(i=>{i.attributes.direction="inactive"})}unmuteRemote(e){const n=this.sessionDesc.mediaDescriptions.filter(i=>Xe(e).call(e,i.attributes.mid||""));if(n.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");n.forEach(i=>{i.attributes.direction="recvonly"})}findAvailableMediaIndex(e,n,i){return this.sessionDesc.mediaDescriptions.findIndex(o=>{const c=o.media.mediaType===e&&o.media.port!=="0"&&(o.attributes.direction==="sendonly"||o.attributes.direction==="sendrecv")&&o.attributes.ssrcs.length===0;if(Pr()){if(c){const u=this.firefoxSsrcMidMap.get(n[0].ssrcId);return!(u||o.attributes.mid!=="0"&&o.attributes.mid!=="1")||!(!u||u!==o.attributes.mid)}return!1}return c&&o.attributes.mid===i})}findAvailableRecvMediaIndex(e){return this.sessionDesc.mediaDescriptions.findIndex(n=>{const i=n.media.mediaType===e&&n.media.port!=="0"&&(n.attributes.direction==="recvonly"||n.attributes.direction==="sendrecv");return n.attributes.mid!=="0"&&n.attributes.mid!=="1"&&i})}predictReceivingMids(e){const n=[];for(let i=0;i<e;i++)n.push((this.currentMidIndex+i+1).toString(10));return n}restartICE(e){e=Dr(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(n=>{n.attributes.iceUfrag=e.iceUfrag,n.attributes.icePwd=e.icePwd})}createOrRecycleSendMedia(e,n,i,o,c,u){const h=this.rtpCapabilities.send,m=e===at.VIDEO?h.videoCodecs:h.audioCodecs,_=e===at.VIDEO?h.videoExtensions:h.audioExtensions;Pr()&&(c="".concat(++this.currentMidIndex));let y={media:{mediaType:e,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:m.map(w=>w.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:_,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:n,ssrcGroups:i,rtcpFeedbackWildcards:[],payloads:m,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:o,rtcpMux:!0,rtcpRsize:!0,mid:c}};y=this.mungSendMediaDesc(y,u);const S=this.findFirstClosedMedia(e);if(S){const w=this.sessionDesc.mediaDescriptions.indexOf(S);this.sessionDesc.mediaDescriptions[w]=y}else this.sessionDesc.mediaDescriptions.push(y);return y}mungRecvMediaDsec(e,n,i){const o=Dr(e);return JL(o),gv(o,n),QL(o,n),iH(o),DA(o,i,this.localCapabilities.send),o}mungSendMediaDesc(e,n){const i=Dr(e);return DA(i,n,this.localCapabilities.recv),_v(i),i}updateRecvMedia(e,n){const i=this.sessionDesc.mediaDescriptions.findIndex(o=>o.attributes.mid===e);if(i!==-1){const o=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[i],n);this.sessionDesc.mediaDescriptions[i]=o}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>e.media.port!=="0").map(e=>e.attributes.mid)}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(n=>{var i;return((i=n.attributes)===null||i===void 0||(i=i.ssrcs[0])===null||i===void 0?void 0:i.ssrcId)===e[0].ssrcId})}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(n=>Pr()?n.media.port==="0"&&n.media.mediaType===e:n.media.port==="0")}};const vge=["sdp"];var cr;function mK(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function mm(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?mK(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):mK(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}let gK=(cr=class Gv extends Fz{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var n,i;return(n=(i=this.peerConnection.getReceivers()[0])===null||i===void 0||(i=i.transport)===null||i===void 0?void 0:i.state)!==null&&n!==void 0?n:null}get localCodecs(){return[]}set isInRestartIce(n){this._isInRestartIce=n}get isInRestartIce(){return this._isInRestartIce}constructor(n,i,o){super(n,i),K(this,"direction",void 0),K(this,"name",void 0),K(this,"store",void 0),K(this,"spec",void 0),K(this,"peerConnection",void 0),K(this,"initialOffer",void 0),K(this,"transport",void 0),K(this,"statsFilter",void 0),K(this,"localCandidateCount",0),K(this,"_isInRestartIce",!1),K(this,"mutex",void 0),K(this,"onLocalCandidate",void 0),K(this,"remoteSDP",void 0),K(this,"pendingCandidates",[]),K(this,"localCapabilities",void 0),K(this,"isReady",!1),K(this,"restartCnt",0),K(this,"curTurnServerIndex",0),this.store=i,this.spec=n,this.mutex=new Es("P2PConnection-mutex",i.clientId),this.peerConnection=new RTCPeerConnection(Gv.resolvePCConfiguration(n,i.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=o??ho.SEND_ONLY,this.name=this.direction===ho.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=dL(this.peerConnection,Z("STATS_UPDATE_INTERVAL"),void 0,Pr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(n){try{const i=await oH();if(this.localCapabilities=LA(i),n){const{sdp:o}=n,c=yge(n,vge),u=function(){const S={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},w=K0(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),I={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},P={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},B={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Yl(w,S,"videoExtensions",I,P,B),Yl(w,S,"videoCodecs",I,P,B),Yl(w,S,"audioExtensions",I,P,B),Yl(w,S,"audioCodecs",I,P,B),Z("RAISE_H264_BASELINE_PRIORITY")){const M=B.videoCodecs.findIndex(U=>U.rtpMap&&U.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&U.fmtp&&U.fmtp.parameters["profile-level-id"]==="42001f");if(M!==-1){const U=B.videoCodecs.findIndex(q=>q.rtpMap&&q.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(U<M){k.debug("raising H264 baseline profile priority");const q=B.videoCodecs[M];B.videoCodecs.splice(M,1),B.videoCodecs.splice(U,0,q)}U!==-1&&Z("FILTER_SEND_H264_BASELINE")&&(I.videoCodecs=I.videoCodecs.filter(q=>!(q.rtpMap&&q.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&q.fmtp&&q.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:I,recv:P,sendrecv:B}}({},{},o);this.remoteSDP=new pK({remoteIceParameters:c.iceParameters,remoteDtlsParameters:c.dtlsParameters,candidates:[],remoteRTPCapabilities:u,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const h=await this.peerConnection.createAnswer();if(!h.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const m=im(h.sdp);await this.peerConnection.setLocalDescription(h);const _=await aH({},{},h.sdp);this.localCapabilities=LA(_);const y=this.peerConnection.getTransceivers()[0];return y!=null&&y.receiver&&y.receiver.transport&&this.tryBindTransportEvents(y.receiver.transport),mm(mm({},m),{},{sdp:h.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const o=await this.peerConnection.createOffer();if(!o.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const c=im(o.sdp);return this.initialOffer=o,mm(mm({},c),{},{sdp:o.sdp})}}catch(i){throw new Ce(Y.GET_LOCAL_CONNECTION_PARAMS_FAILED,i.toString())}}async connect(n){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:i,iceParameters:o,dtlsParameters:c}=n,u=await aH({},{},i);this.remoteSDP=new pK({remoteIceParameters:o,remoteDtlsParameters:c,candidates:[],remoteRTPCapabilities:u,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const h=this.peerConnection.getTransceivers()[0];h!=null&&h.sender&&h.sender.transport&&this.tryBindTransportEvents(h.sender.transport)}catch(i){throw new Ce(Y.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(i.toString()))}}async addRemoteCandidate(n){try{n&&this.pendingCandidates.push(n),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(i=>{this.peerConnection.addIceCandidate(i)}),this.pendingCandidates=[])}catch(i){throw new Ce(Y.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(i.toString()))}}send(n,i,o){var c=this;return el(function*(){const u=yield Sn(c.mutex.lock("From P2PConnection.send"));try{if(!c.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const h=[],m=c.remoteSDP.receive(n,i,o);n.forEach((U,q)=>{if(m[q].needCreateTransceiver){const $=c.peerConnection.addTransceiver(U._mediaStreamTrack,{direction:"sendonly"});h.push($),U._updateRtpTransceiver($)}else{const $=c.peerConnection.getTransceivers().find(ae=>ae.mid===m[q].mid);if(!$)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(m[q].mid));h.push($),U._updateRtpTransceiver($)}}),Pr()&&Z("SIMULCAST")===!0&&(yield Sn(c.applySimulcastForFirefox(h,n)));const _=m.map(U=>U.mid),y=yield Sn(c.peerConnection.createOffer()),S=c.mungSendOfferSDP(y.sdp,n,_),w=da(S),I=_.map(U=>{const q=w.mediaDescriptions.find($=>$.attributes.mid===U);if(!q)throw new Error("Cannot extract ssrc from mediaDescription.");return tH(q,Z("USE_PUB_RTX"))}),P=h.map((U,q)=>{const $=_[q];return{localSSRC:I[q],id:$}});yield Sn(c.peerConnection.setLocalDescription({type:"offer",sdp:S}));try{yield P}catch(U){const q=c.remoteSDP.toString();throw yield Sn(c.peerConnection.setLocalDescription({type:"offer",sdp:S})),yield Sn(c.peerConnection.setRemoteDescription({type:"answer",sdp:q})),yield Sn(c.stopSending(_,!0)),U}yield Sn(c.applySimulcastEncodings(h,n)),yield Sn(c.applySendEncodings(h,n));const B=c.remoteSDP.toString(),M=c.logSDPExchange(S,"offer","local","send");return M==null||M(B),yield Sn(c.setRemoteDescription({type:"answer",sdp:B})),h.map((U,q)=>{const $=_[q];return{localSSRC:I[q],id:$}})}catch(h){throw h instanceof Ce?h:new Ce(Y.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{u()}})()}async stopSending(n,i){const o=i?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const c=this.peerConnection.getTransceivers().filter(_=>n.indexOf(_.mid)!==-1);if(c.length!==n.length)throw new Error("Transceivers' length (".concat(c.length,") doesn't match mids' length (").concat(n.length,") when trying to call P2PConnection.stopSending."));c.map(_=>{var y;_.direction="inactive",(y=_.stop)===null||y===void 0||y.call(_)});const u=await this.peerConnection.createOffer(),h=this.logSDPExchange(u.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(u),this.remoteSDP.stopReceiving(n);const m=this.remoteSDP.toString();h==null||h(m),await this.setRemoteDescription({type:"answer",sdp:m})}catch(c){throw new Ce(Y.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(c.toString()))}finally{o&&o()}}async receive(n,i,o,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(n," before remoteSDP created."));const{mid:u,needExchangeSDP:h}=this.remoteSDP.send(n,i,o,c);if(h){const _=this.remoteSDP.toString(),y=this.logSDPExchange(_,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:_});const S=await this.peerConnection.createAnswer(),w=this.mungReceiveAnswerSDP(S.sdp,u,n);y==null||y(w||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:w}),k.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(n," by exchanging SDP."))}else k.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(n," no need to exchange SDP."));const m=this.peerConnection.getTransceivers().find(_=>_.mid===u);if(!m||m.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:m.receiver.track,mid:m.mid,transceiver:m}}catch(u){throw new Ce(Y.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async mockReceive(n,i,o,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(n," before remoteSDP created."));const{mid:u,needExchangeSDP:h}=this.remoteSDP.send(n,i,o,c);if(h){const m=this.remoteSDP.toString(),_=this.logSDPExchange(m,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:m});const y=await this.peerConnection.createAnswer(),S=this.mungReceiveAnswerSDP(y.sdp,u,n);_==null||_(S||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:S}),k.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(n," by exchanging SDP."))}else k.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(n," no need to exchange SDP."))}catch(u){throw new Ce(Y.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async stopReceiving(n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(n);const i=this.remoteSDP.toString(),o=this.logSDPExchange(i,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:i});const c=await this.peerConnection.createAnswer();o==null||o(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(i){throw new Ce(Y.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}async restartICE(n){try{if(this.store.p2pTransport===e_.Auto&&(this.store.p2pTransport=e_.SdRtn,On().supportPCSetConfiguration&&this.peerConnection.setConfiguration(Gv.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,On().supportPCSetConfiguration&&this.peerConnection.setConfiguration(Gv.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!n){this.restartCnt++,this.isReady=!1;const i=await this.peerConnection.createOffer({iceRestart:!0});if(!i.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:o}=im(i.sdp);return this.store.descriptionStart(),this.direction===ho.SEND_ONLY&&await this.peerConnection.setLocalDescription(i),o}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(n),this.store.descriptionStart(),this.direction===ho.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const i=await this.peerConnection.createAnswer();if(!i.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:o}=im(i.sdp);return await this.peerConnection.setLocalDescription(i),o}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(i){throw new Ce(Y.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}close(){var n;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(n=this.onConnectionStateChange)===null||n===void 0||n.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(n){return this.statsFilter.getVideoIsReady(n)}async updateEncoderConfig(n,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const o=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(o.sdp,[i],[n]);this.remoteSDP.updateRecvMedia(n,i);const u=this.remoteSDP.toString(),h=this.logSDPExchange(c,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),h==null||h(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(o){throw new Ce(Y.EXCHANGE_SDP_FAILED,o.toString())}}async updateSendParameters(n,i){const o=this.peerConnection.getTransceivers().filter(c=>c.mid===n);o.length===1&&(this.isVP8Simulcast(i)?Pr()||await this.applySimulcastEncodings(o,[i]):await this.applySendEncodings(o,[i]))}setStatsRemoteVideoIsReady(n,i){this.statsFilter.setVideoIsReady2(n,i)}async replaceTrack(n,i){const o=this.peerConnection.getTransceivers().find(c=>c.mid===i);o&&await o.sender.replaceTrack(n._mediaStreamTrack)}async getSelectedCandidatePair(){const n=this.peerConnection.getReceivers();if(n.length>0&&n[0].transport&&n[0].transport.iceTransport&&n[0].transport.iceTransport.getSelectedCandidatePair&&n[0].transport.iceTransport.getSelectedCandidatePair()){const i=n[0].transport.iceTransport,{local:o,remote:c}=i.getSelectedCandidatePair();return{local:mm(mm({},zd),{},{candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port}),remote:mm(mm({},zd),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var n,i;Xe(n=["connected","completed"]).call(n,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(i=this.onICEConnectionStateChange)===null||i===void 0||i.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var n;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(n=this.onConnectionStateChange)===null||n===void 0||n.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=n=>{if(n.candidate){var i;n.candidate.candidate&&((i=this.onLocalCandidate)===null||i===void 0||i.call(this,n.candidate.toJSON())),this.localCandidateCount+=1}else k.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(n,i){let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const c={iceServers:[]};var u;return n.iceServers?c.iceServers=n.iceServers:n.turnServer&&n.turnServer.mode!=="off"&&(D0(n.turnServer.servers)?c.iceServers=n.turnServer.servers:(c.iceServers&&c.iceServers.push(...Gv.turnServerConfigToIceServers(n.turnServer.servers,i,o)),Z("USE_TURN_SERVER_OF_GATEWAY")&&c.iceServers&&n.turnServer.serversFromGateway&&c.iceServers.push(...Gv.turnServerConfigToIceServers(n.turnServer.serversFromGateway,i,o)),Xe(u=[e_.Relay,e_.SdRtn]).call(u,i)&&(c.iceTransportPolicy="relay"),Z("FORCE_TURN_TCP")?c.iceTransportPolicy="relay":n.turnServer.servers.concat(n.turnServer.serversFromGateway||[]).forEach(h=>{h.forceturn&&(c.iceTransportPolicy="relay")}))),Z("ENABLE_ENCODED_TRANSFORM")&&On().supportWebRTCEncodedTransform&&(c.encodedInsertableStreams=!0),k.debug("P2PConnection p2pTransport is ".concat(i)),c}static turnServerConfigToIceServers(n,i){let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const c=[],u=n.filter(m=>m.tcpport);k.debug("P2PConnection turnServers is ".concat(u,", current index is ").concat(o));const h=u.length>o?u[o]:u[0];switch(i){case e_.SdRtn:const m=n.filter(y=>{var S;return Xe(S=y.username).call(S,"glb:")&&y.turnServerURL==y.turnServerURL}),_=m.length>o?m[o]:m[0];_&&(c.push({username:_.username,credential:_.password,credentialType:"password",urls:"turn:".concat(nm(_.turnServerURL),":").concat(_.tcpport,"?transport=udp")}),c.push({username:_.username,credential:_.password,credentialType:"password",urls:"turns:".concat(nm(_.turnServerURL),":").concat(_.tcpport,"?transport=tcp")}));break;case e_.Relay:h&&(c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(h.turnServerURL,":").concat(h.tcpport,"?transport=udp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat(nm(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}));break;default:h&&(c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(h.turnServerURL,":").concat(h.tcpport,"?transport=udp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat(nm(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"stun:".concat(h.turnServerURL,":").concat(h.tcpport)}))}return c}tryBindTransportEvents(n){if(n){this.transport=n,n.onstatechange=()=>{var o;n!=null&&n.state&&((o=this.onDTLSTransportStateChange)===null||o===void 0||o.call(this,n.state))},n.onerror=o=>{var c;(c=this.onDTLSTransportError)===null||c===void 0||c.call(this,"error"in o?o.error:o)};const i=n.iceTransport;i&&(i.onstatechange=()=>{const o=n==null?void 0:n.iceTransport.state;var c;o&&((c=this.onICETransportStateChange)===null||c===void 0||c.call(this,o))},i.getSelectedCandidatePair&&(i.onselectedcandidatepairchange=()=>{if(i.getSelectedCandidatePair()){const{local:o,remote:c}=i.getSelectedCandidatePair();k.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:o.type,protocol:o.protocol}),", remote ").concat(JSON.stringify({candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})," )"))}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(n,i){var o;if(i||(i=this.peerConnection.getSenders().find(S=>S.track===n._mediaStreamTrack)),!i)return k.warn("[".concat(n.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(n))return k.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!On().supportSetRtpSenderParameters)return k.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const c={},u={};switch(n._optimizationMode){case"motion":c.degradationPreference="maintain-framerate";break;case"detail":c.degradationPreference="maintain-resolution";break;default:c.degradationPreference="balanced"}if(n._encoderConfig){var h;const{bitrateMax:S,frameRate:w,scaleResolutionDownBy:I}=n._encoderConfig;S&&(u.maxBitrate=1e3*S),Xe(h=n._hints).call(h,ir.LOW_STREAM)&&(w&&(u.maxFramerate=Ba(w)),I&&I>=1&&(u.scaleResolutionDownBy=I))}if(Z("DSCP_TYPE")&&bf()){var m;const S=Z("DSCP_TYPE");Xe(m=["very-low","low","medium","high"]).call(m,S)&&(u.networkPriority=S)}const _=i.getParameters(),y=(o=_.encodings)===null||o===void 0?void 0:o[0];Pr()&&!y&&(c.encodings=[u]),y&&Object.assign(y,u),Object.assign(_,c),k.debug("[".concat(n.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(_.encodings))),await i.setParameters(_)}async applySendEncodings(n,i){try{if(!On().supportSetRtpSenderParameters||n.length!==i.length)return;for(let o=0;o<n.length;o++){const c=n[o],u=i[o];u instanceof hr&&!this.isVP8Simulcast(u)&&await this.updateRtpSenderEncodings(u,c.sender)}}catch{k.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(n,i,o){const c=da(n);return i.forEach((u,h)=>{const m=o[h],_=c.mediaDescriptions.find(y=>y.attributes.mid===m);_&&(gv(_,u),sH(_,u,this.store.codec))}),Zp(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=n=>{var i;(i=this.onFirstAudioReceived)===null||i===void 0||i.call(this,n)},this.statsFilter.onFirstVideoReceived=n=>{var i;(i=this.onFirstVideoReceived)===null||i===void 0||i.call(this,n)},this.statsFilter.onFirstAudioDecoded=n=>{var i;(i=this.onFirstAudioDecoded)===null||i===void 0||i.call(this,n)},this.statsFilter.onFirstVideoDecoded=(n,i,o)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,n,i,o)},this.statsFilter.onSelectedLocalCandidateChanged=(n,i)=>{var o;(o=this.onSelectedLocalCandidateChanged)===null||o===void 0||o.call(this,n,i)},this.statsFilter.onSelectedRemoteCandidateChanged=(n,i)=>{var o;(o=this.onSelectedRemoteCandidateChanged)===null||o===void 0||o.call(this,n,i)},this.statsFilter.onFirstVideoDecodedTimeout=n=>{var i;(i=this.onFirstVideoDecodedTimeout)===null||i===void 0||i.call(this,n)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(n,i){if(n.length===i.length)for(let _=0;_<n.length;_++){var o,c,u,h,m;const y=n[_],S=i[_];if(S instanceof hr&&!Xe(o=S._hints).call(o,ir.LOW_STREAM)&&(c=S._encoderConfig)!==null&&c!==void 0&&c.bitrateMax&&((u=S._encoderConfig)===null||u===void 0?void 0:u.bitrateMax)>200&&(h=S._scalabilityMode)!==null&&h!==void 0&&h.numSpatialLayers&&((m=S._scalabilityMode)===null||m===void 0?void 0:m.numSpatialLayers)>1&&this.store.codec==="vp8"){const w={},I={high:1e3*(S._encoderConfig.bitrateMax-50),medium:5e4};w.encodings=[{rid:"m",active:!0,maxBitrate:I.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:I.high}];const P=y.sender.getParameters();await y.sender.setParameters(Object.assign(P,w))}}}async applySimulcastEncodings(n,i){if(!Pr()&&n.length===i.length)for(let o=0;o<n.length;o++){const c=i[o];if(c instanceof hr&&this.isVP8Simulcast(c)){const u=n[o],h={},m={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};h.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];const _=u.sender.getParameters();await u.sender.setParameters(Object.assign(_,h))}}}isVP8Simulcast(n){var i,o,c,u,h;return!!(n instanceof hr&&Z("SIMULCAST")&&this.store.codec==="vp8"&&!Xe(i=n._hints).call(i,ir.LOW_STREAM)&&(o=n._encoderConfig)!==null&&o!==void 0&&o.bitrateMax&&((c=n._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(u=n._scalabilityMode)!==null&&u!==void 0&&u.numSpatialLayers&&((h=n._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1)}logSDPExchange(n,i,o,c){if(Z("SDP_LOGGING"))return k.upload("[".concat(this.store.clientId,"] exchanging ").concat(o," ").concat(i," SDP during P2PConnection.").concat(c,`
`),n),i==="offer"?u=>{this.logSDPExchange(u,"answer",o==="local"?"remote":"local",c)}:void 0}async muteLocal(n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const i=this.peerConnection.getTransceivers().filter(h=>h.mid&&n.indexOf(h.mid)!==-1);if(i.length!==n.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(h=>{h.direction="inactive"});const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.muteRemote(n);const u=this.remoteSDP.toString();c==null||c(u),await this.setRemoteDescription({type:"answer",sdp:u})}catch(i){throw new Ce(Y.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(i.toString()))}}async unmuteLocal(n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const i=this.peerConnection.getTransceivers().filter(h=>h.mid&&n.indexOf(h.mid)!==-1);if(i.length!==n.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(async h=>{h.direction="sendonly"});const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.unmuteRemote(n);const u=this.remoteSDP.toString();c==null||c(u),await this.setRemoteDescription({type:"answer",sdp:u})}catch(i){throw new Ce(Y.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(i.toString()))}}async getRemoteSSRC(n,i){var o,c;if(i=(o=i)!==null&&o!==void 0?o:(c=this.currentRemoteDescription)===null||c===void 0?void 0:c.sdp){var u;const h=(u=da(i).mediaDescriptions.find(m=>m.attributes.mid===n))===null||u===void 0?void 0:u.attributes.ssrcs;return h==null?void 0:h[0].ssrcId}}async setRemoteDescription(n){var i;await this.peerConnection.setRemoteDescription(n),Xe(i=["connected","completed"]).call(i,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(n,i,o){const c=da(n),u=c.mediaDescriptions.find(h=>h.attributes.mid===i);return u&&o===at.AUDIO&&u.media.mediaType==="audio"&&_v(u),Zp(c)}},ht(cr.prototype,"establish",[eu],Object.getOwnPropertyDescriptor(cr.prototype,"establish"),cr.prototype),ht(cr.prototype,"connect",[eu],Object.getOwnPropertyDescriptor(cr.prototype,"connect"),cr.prototype),ht(cr.prototype,"receive",[eu],Object.getOwnPropertyDescriptor(cr.prototype,"receive"),cr.prototype),ht(cr.prototype,"mockReceive",[eu],Object.getOwnPropertyDescriptor(cr.prototype,"mockReceive"),cr.prototype),ht(cr.prototype,"stopReceiving",[eu],Object.getOwnPropertyDescriptor(cr.prototype,"stopReceiving"),cr.prototype),ht(cr.prototype,"restartICE",[eu],Object.getOwnPropertyDescriptor(cr.prototype,"restartICE"),cr.prototype),ht(cr.prototype,"close",[eu],Object.getOwnPropertyDescriptor(cr.prototype,"close"),cr.prototype),ht(cr.prototype,"updateEncoderConfig",[eu],Object.getOwnPropertyDescriptor(cr.prototype,"updateEncoderConfig"),cr.prototype),ht(cr.prototype,"updateSendParameters",[eu],Object.getOwnPropertyDescriptor(cr.prototype,"updateSendParameters"),cr.prototype),ht(cr.prototype,"replaceTrack",[eu],Object.getOwnPropertyDescriptor(cr.prototype,"replaceTrack"),cr.prototype),ht(cr.prototype,"muteLocal",[eu],Object.getOwnPropertyDescriptor(cr.prototype,"muteLocal"),cr.prototype),ht(cr.prototype,"unmuteLocal",[eu],Object.getOwnPropertyDescriptor(cr.prototype,"unmuteLocal"),cr.prototype),cr);function eu(e,n,i){const o=e[n];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const c=this.mutex,u=await c.lock("From P2PConnection.".concat(n));try{for(var h=arguments.length,m=new Array(h),_=0;_<h;_++)m[_]=arguments[_];return await o.apply(this,m)}finally{u()}},i}let ed=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({});var _K,EK,yK,vK,SK,TK,bK,wK,RK,CK,IK,Tr;function AK(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function gO(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?AK(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):AK(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}let Sge=(_K=td(ed.SEND_ONLY),EK=td(ed.SEND_ONLY),yK=td(),vK=td(ed.RECEIVE_ONLY),SK=td(ed.RECEIVE_ONLY),TK=td(ed.RECEIVE_ONLY),bK=td(ed.RECEIVE_ONLY),wK=td(ed.RECEIVE_ONLY),RK=td(ed.RECEIVE_ONLY),CK=td(),IK=td(ed.RECEIVE_ONLY),Tr=class extends Rr{get state(){return this._state}set state(e){const n=this._state;this._state=e,this.emit(bt.StateChange,n,this._state)}constructor(e,n){super(),K(this,"isPlanB",!1),K(this,"store",void 0),K(this,"statsUploader",void 0),K(this,"sendConnection",void 0),K(this,"recvConnection",void 0),K(this,"localTrackMap",new Map),K(this,"remoteUserMap",new Map),K(this,"localDataChannels",[]),K(this,"pendingLocalTracks",[]),K(this,"pendingRemoteTracks",[]),K(this,"statsCollector",void 0),K(this,"dtlsFailedCount",0),K(this,"sendMutex",void 0),K(this,"recvMutex",void 0),K(this,"_state",Fn.Disconnected),K(this,"_restartStates",["disconnected","failed"]),K(this,"reconnectInterval",void 0),K(this,"uploadUnplinkStarted",!1),K(this,"uploadDownlinkStarted",!1),K(this,"uplinkStateUploadInterval",void 0),K(this,"downlinkStatsUploadInterval",void 0),K(this,"handleMuteLocalTrack",async(i,o,c)=>{const u=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==Fn.Connected)return void c(new Ce(Y.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const _=this.filterTobeMutedTracks(i);if(_.length===0)return void o();const y=_.find(P=>P[0]==="videoLowTrack");y&&y[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(_.map(P=>{let[,{id:B}]=P;return B}));let S=!1;var h,m;i.trackMediaType==="video"?S=!((h=this.localTrackMap.get(Ve.LocalAudioTrack))===null||h===void 0||!h.track._muted):S=((m=this.localTrackMap.get(Ve.LocalVideoTrack))===null||m===void 0?void 0:m.id)===void 0;const w=this.createMuteMessage(_);await nr(this,bt.RequestMuteLocal,w);const I=i.trackMediaType==="video"?tm.MUTE_LOCAL_VIDEO:tm.MUTE_LOCAL_AUDIO;await nr(this,bt.RequestP2PMuteLocal,{action:I,message:w,isMuteAll:S}),o()}catch(_){c(_)}finally{u()}}),K(this,"handleUnmuteLocalTrack",async(i,o,c)=>{const u=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==Fn.Connected)return void c(new Ce(Y.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const h=this.filterTobeUnmutedTracks(i);if(h.length===0)return void o();await this.sendConnection.unmuteLocal(h.map(y=>{let[,{id:S}]=y;return S}));const m=this.createUnmuteMessage(h),_=i.trackMediaType==="video"?tm.UNMUTE_LOCAL_VIDEO:tm.UNMUTE_LOCAL_AUDIO;await nr(this,bt.RequestP2PMuteLocal,{action:_,message:m}),o()}catch(h){c(h)}finally{u()}}),K(this,"handleUpdateVideoEncoder",async(i,o,c,u)=>{let h;typeof u=="boolean"&&u||(h=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{const _=this.localTrackMap.get(Ve.LocalVideoTrack);if(!this.sendConnection||!_||_.track!==i||this.state!==Fn.Connected)return void o();const{id:y,track:S}=_;y&&(await this.sendConnection.updateSendParameters(y,S),await this.sendConnection.updateEncoderConfig(y,S),this.emit(bt.UpdateVideoEncoder,S)),o()}catch(_){c(_)}finally{var m;(m=h)===null||m===void 0||m()}}),K(this,"handleUpdateVideoSendParameters",async(i,o,c)=>{const u=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const h=this.localTrackMap.get(Ve.LocalVideoTrack);if(!this.sendConnection||!h||h.track!==i||this.state!==Fn.Connected)return void o();const{id:m,track:_}=h;m&&await this.sendConnection.updateSendParameters(m,_),o()}catch(h){c(h)}finally{u()}}),K(this,"handleReplaceTrack",async(i,o,c,u)=>{let h;k.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(i.getTrackId(),"]")),typeof u=="boolean"&&u||(h=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var m;const y=Array.from(this.localTrackMap.entries()).find(S=>{let[,{track:w}]=S;return i===w});if(!this.sendConnection||!y||y[1].id===void 0||this.state!==Fn.Connected)return void o();if(await((m=this.sendConnection)===null||m===void 0?void 0:m.replaceTrack(i,y[1].id)),y[0]===Ve.LocalVideoTrack&&On().supportDualStreamEncoding){const S=this.localTrackMap.get(Ve.LocalVideoLowTrack);if(S){const w=i._mediaStreamTrack.clone();S.track._originMediaStreamTrack.stop(),S.track._mediaStreamTrack=w,S.track._originMediaStreamTrack=w,await new tt((I,P)=>{this.handleReplaceTrack(S.track,I,P,!0)})}}o()}catch(y){c(y)}finally{var _;(_=h)===null||_===void 0||_()}}),K(this,"handleGetLocalVideoStats",i=>{i(this.statsCollector.getLocalVideoTrackStats())}),K(this,"handleGetLocalAudioStats",i=>{i(this.statsCollector.getLocalAudioTrackStats())}),K(this,"handleGetRemoteVideoStats",i=>this.statsCollector.getRemoteVideoTrackStats(i.uid)[i.uid]),K(this,"handleGetRemoteAudioStats",i=>this.statsCollector.getRemoteAudioTrackStats(i.uid)[i.uid]),this.store=e,this.statsCollector=n,this.statsCollector.addP2PChannel(this),this.statsUploader=new KH(e),this.bindStatsUploaderEvents(),this.sendMutex=new Es("P2PChannel2-send-mutex",e.clientId),this.recvMutex=new Es("P2PChannel2-recv-mutex",e.clientId),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(i=>{i&&(i.iceConnectionState!=="disconnected"&&i.iceConnectionState!=="failed"||this.handleDisconnect(i.direction))})},Z("ICE_RESTART_INTERVAL"))}async startP2PConnection(e,n){throw new Ce(Y.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(e){throw new Ce(Y.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(e,n){let i;try{if(n){this.recvConnection&&(k.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),i=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new gK(e,this.store,ho.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const o=await this.recvConnection.establish(n);return{iceParameters:o.iceParameters,dtlsParameters:o.dtlsParameters,sdp:o.sdp}}{this.state=Fn.New,this.sendConnection&&(k.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),i=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new gK(e,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const o=await this.sendConnection.establish();return{iceParameters:o.iceParameters,dtlsParameters:o.dtlsParameters,sdp:o.sdp}}}finally{i&&i()}}async p2pConnect(e){if(!this.sendConnection)throw new Ce(Y.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Fn.Connected}async addRemoteCandidate(e,n){if(n===ho.RECEIVE_ONLY){if(!this.sendConnection)throw new Ce(Y.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(e)}else{if(!this.recvConnection)throw new Ce(Y.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(e)}}publish(e,n,i){var o=this;return el(function*(){const c=yield Sn(o.sendMutex.lock("From P2PChannel.publish"));try{if(!o.sendConnection||o.state!==Fn.Connected){o.throwIfTrackTypeNotMatch(e);const y=e.filter(S=>o.pendingLocalTracks.indexOf(S)===-1);return void(o.pendingLocalTracks=o.pendingLocalTracks.concat(y))}o.store.pubId=o.store.pubId+1,Ss.markPublishStart(o.store.clientId,o.store.pubId);const u=o.filterTobePublishedTracks(e,n,i);if(u.length===0)return void(yield Sn(o.tryToUnmuteAudio(e)));u.forEach(y=>{let{track:S,type:w}=y;const I=Date.now();o.store.publish(S.getTrackId(),w===Ve.LocalAudioTrack?"audio":"video",I)}),o.bindLocalTrackEvents(u);const h=yield Sn(o.sendConnection.send(u.map(y=>{let{track:S}=y;return S}),o.store.codec,o.store.audioCodec)),m=(yield Sn(h.next())).value,_=o.createGatewayPublishMessage(u,m);try{yield _}catch(y){throw h.throw(y),(y==null?void 0:y.code)===Y.WS_ABORT&&u.forEach(S=>{let{track:w}=S;o.pendingLocalTracks.indexOf(w)===-1&&o.pendingLocalTracks.push(w)}),o.unbindLocalTrackEvents(u),y}yield Sn(h.next()),u.forEach(y=>{let{type:S}=y;o.statsCollector.addLocalStats(S)}),o.statsUploader.startUploadOutboundStats(),o.assignLocalTracks(u,m),u.forEach(y=>{let{track:S,type:w}=y;const I=Date.now();o.store.publish(S.getTrackId(),w===Ve.LocalAudioTrack?"audio":"video",void 0,I)}),o.startUploadUplinkState()}finally{c()}})()}async unpublish(e){if(!this.sendConnection||this.state!==Fn.Connected)return void(e.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(c=>!Xe(e).call(e,c)));const n=this.filterTobeUnpublishedTracks(e);if(n.length===0)return;const i=n.find(c=>c[0]==="videoLowTrack");i&&i[1].track.close();const o=this.createGatewayUnpublishMessage(n);if(await this.sendConnection.stopSending(n.map(c=>{let[,{id:u}]=c;return u})),this.withdrawLocalTracks(n),this.unbindLocalTrackEvents(n.map(c=>{let[u,{track:h}]=c;return{type:u,track:h}})),n.forEach(c=>{let[u]=c;this.statsCollector.removeLocalStats(u)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===Fn.Connected)return i&&i[1].track.close(),o;e.forEach(c=>{const u=this.pendingLocalTracks.indexOf(c);u!==-1&&this.pendingLocalTracks.splice(u,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const e=()=>{const n=[],i=[];Array.from(this.localTrackMap.entries()).forEach(o=>{let[c,{track:u,ssrcs:h}]=o;const m={stream_type:hpe(u,c),ssrcs:h};u._muted||!u._enabled?n.push(m):i.push(m)}),n.length>0&&n.forEach(o=>{nr(this,bt.RequestMuteLocal,[o])}),i.length>0&&i.forEach(o=>{nr(this,bt.RequestUnmuteLocal,[o])})};e(),this.uplinkStateUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(e){return el(function*(){throw new Ce(Y.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(k.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await ds(this,bt.RequestRePublish,this.pendingLocalTracks),this.emit(bt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new Ce(Y.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(e,n,i,o){var c;if(!this.recvConnection)throw new Ce(Y.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((c=this.remoteUserMap.get(e))!==null&&c!==void 0&&c.has(n))return;const{track:u,mid:h,transceiver:m}=await this.recvConnection.receive(n,[{ssrcId:i}],String(e.uid),o);n===at.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(u):(e._audioTrack=new cv(u,e.uid,e._uintid,this.store),k.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),m&&e._audioTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoSSRC=i,e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(u):(e._videoTrack=new av(u,e.uid,e._uintid,this.store),k.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),m&&e._videoTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(e,e._videoTrack));const _=this.remoteUserMap.get(e);_?_.set(n,h):this.remoteUserMap.set(e,new Map([[n,h]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const y=this.pendingRemoteTracks.findIndex(S=>{let{user:w,kind:I}=S;return w.uid===e.uid&&n===I});y!==-1&&(this.pendingRemoteTracks.splice(y,1),this.emit(bt.MediaReconnectEnd,e.uid))}async mockSubscribe(e,n,i,o){if(!this.recvConnection)throw new Ce(Y.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(n,[{ssrcId:i}],String(e.uid),o)}async unsubscribe(e,n,i){const o=this.pendingRemoteTracks.filter(u=>{let{user:h,kind:m}=u;return n!==void 0?h.uid===e.uid&&n===m:h.uid===e.uid});if(o.forEach(u=>{const h=this.pendingRemoteTracks.indexOf(u);this.pendingRemoteTracks.splice(h,1)}),this.recvConnection||i||o.forEach(u=>{let{kind:h}=u;var m;if(h===at.AUDIO)(m=e._audioTrack)===null||m===void 0||m._destroy(),e._audioTrack=void 0;else if(h===at.VIDEO){var _;(_=e._videoTrack)===null||_===void 0||_._destroy(),e._videoTrack=void 0}}),!this.recvConnection)return;const c=this.filterTobeUnSubscribedTracks(e,n);c.length!==0&&(await this.recvConnection.stopReceiving(c.map(u=>{let[,{id:h}]=u;return h})),this.withdrawRemoteTracks(c),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),c.forEach(u=>{let[h,{kind:m}]=u;var _,y;if(m===at.VIDEO&&h._videoSSRC&&((_=this.recvConnection)===null||_===void 0||_.setStatsRemoteVideoIsReady(h._videoSSRC,!1)),m===at.VIDEO)this.unbindRemoteTrackEvents(h._videoTrack),i||((y=h._videoTrack)===null||y===void 0||y._destroy(),h._videoTrack=void 0);else if(m===at.AUDIO){var S;this.unbindRemoteTrackEvents(h._audioTrack),!i&&((S=h._audioTrack)===null||S===void 0||S._destroy(),h._audioTrack=void 0)}}),c.forEach(u=>{let[,{kind:h}]=u;nr(this,bt.RequestP2PMuteRemote,h)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const e=()=>Array.from(this.remoteUserMap.entries()).forEach(n=>{let[,i]=n;[at.VIDEO,at.AUDIO].forEach(o=>{i.has(o)?nr(this,bt.RequestP2PUnmuteRemote,o):nr(this,bt.RequestP2PMuteRemote,o)})});e(),this.downlinkStatsUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(e){throw new Ce(Y.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(e){throw new Ce(Y.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(e){throw new Ce(Y.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(e){throw new Ce(Y.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(e,n){if(!this.recvConnection)return;const i=this.remoteUserMap.get(e);if(!i)return void k.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid,"."));if(!i.get(n))return void k.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid," media type ").concat(n,"."));const o=n===at.VIDEO?e._videoSSRC:e._audioSSRC;o!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(o,!1)}async unmuteRemote(e,n){return this.unmuteRemoteNoLock(e,n)}async unmuteRemoteNoLock(e,n){if(!this.recvConnection)return;const i=this.remoteUserMap.get(e);if(!i)return void k.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid,"."));i.get(n)||k.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(n,"."))}getAllTracks(e){const n=this.localTrackMap.get(Ve.LocalAudioTrack);if((n==null?void 0:n.track)instanceof yi){const i=n.track;return Array.from(this.localTrackMap.entries()).filter(o=>{let[c]=o;return c!==Ve.LocalAudioTrack}).filter(o=>{let[c]=o;return!(e&&c===Ve.LocalVideoLowTrack)}).map(o=>{let[,{track:c}]=o;return c}).concat(i.trackList)}return Array.from(this.localTrackMap.entries()).filter(i=>{let[o]=i;return!(e&&o===Ve.LocalVideoLowTrack)}).map(i=>{let[,{track:o}]=i;return o})}reportPublishEvent(e,n,i,o,c){if(e){const h=this.localTrackMap.get(Ve.LocalAudioTrack),m=o?this.localTrackMap.get(Ve.LocalVideoLowTrack):this.localTrackMap.get(Ve.LocalVideoTrack);yt.publish(this.store.sessionId,{eventElapse:Ss.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:n,audioName:h==null?void 0:h.track.getTrackLabel(),videoName:m==null?void 0:m.track.getTrackLabel(),screenshare:(m==null?void 0:m.track._hints.indexOf(ir.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}else{var u;i||(i=[]);const h=i.find(_=>_ instanceof Vr),m=o?(u=this.localTrackMap.get(Ve.LocalVideoTrack))===null||u===void 0?void 0:u.track:i.find(_=>_ instanceof hr);yt.publish(this.store.sessionId,{eventElapse:Ss.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:n,audioName:h==null?void 0:h.getTrackLabel(),videoName:m==null?void 0:m.getTrackLabel(),screenshare:(m==null?void 0:m._hints.indexOf(ir.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}}reportSubscribeEvent(e,n,i,o){const c=o===at.VIDEO?i._videoSSRC:i._audioSSRC;c&&yt.subscribe(this.store.sessionId,{succ:e,ec:n,video:o===at.VIDEO,audio:o===at.AUDIO,peerid:i.uid,subscribeRequestid:o===at.VIDEO?i._videoSSRC:i._audioSSRC,p2pid:this.store.p2pId,eventElapse:Ss.measureFromSubscribeStart(this.store.clientId,c)})}reset(){k.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new Es("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new Es("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(Ve.LocalAudioTrack);if((e==null?void 0:e.track)instanceof yi){if(e.track.trackList.length>0){const n=e.track;e.track.trackList.forEach(i=>{n.removeAudioTrack(i)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=Fn.Disconnected}getStats(e){var n,i;return e?(i=this.recvConnection)===null||i===void 0?void 0:i.getStats():(n=this.sendConnection)===null||n===void 0?void 0:n.getStats()}getRemoteVideoIsReady(e){var n;return((n=this.recvConnection)===null||n===void 0?void 0:n.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(Ve.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(Ve.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const n=this.localTrackMap.get(e);return n&&n.track instanceof hr||n&&n.track instanceof Vr?n.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,n){if(!e)return this.remoteUserMap.size>0;const i=this.remoteUserMap.get(e);return!!i&&(!n||i.has(n))}async hasRemoteMediaWithLock(e,n){if(!e)return this.remoteUserMap.size>0;const i=this.remoteUserMap.get(e);return!!i&&(!n||i.has(n))}getRemoteMedia(e){var n;const i=Array.from(yc(n=this.remoteUserMap).call(n)).find(o=>o.uid===e);return i?{audioTrack:i.audioTrack,audioSSRC:i._audioSSRC,videoTrack:i.videoTrack,videoSSRC:i._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(i=>{let[o]=i;return{uid:o.uid,level:o.audioTrack?100*o.audioTrack._source.getAccurateVolumeLevel():0}});const n=this.localTrackMap.get(Ve.LocalAudioTrack);return n&&e.push({level:100*n.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=_0(e).call(e,(i,o)=>i.level-o.level),e}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(k.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=Fn.Reconnecting,Z("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[n]=e;var i;n._videoTrack&&n._videoTrack._player&&((i=n._videoTrack._player.getVideoElement())===null||i===void 0||i.pause(),n._videoTrack._player.isKeepLastFrame=!0,n._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var n;let[i,{track:o}]=e;switch(i){case Ve.LocalVideoTrack:Xe(n=o._hints).call(n,ir.LOW_STREAM)?o.close():this.pendingLocalTracks.push(o);break;case Ve.LocalAudioTrack:o instanceof yi?this.pendingLocalTracks=this.pendingLocalTracks.concat(o.trackList):this.pendingLocalTracks.push(o);case Ve.LocalVideoLowTrack:}}),this.emit(bt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[n,i]=e;Array.from(yc(i).call(i)).forEach(o=>{this.setPendingRemoteMedia(n,o)}),this.emit(bt.MediaReconnectStart,n.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),k.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(e,n){for(const i of this.pendingRemoteTracks){const{user:o,kind:c}=i;if((e instanceof om?e.uid:e)===o.uid&&n===c)return!0}return!1}setPendingRemoteMedia(e,n){this.hasPendingRemoteMedia(e,n)||this.pendingRemoteTracks.push({user:e,kind:n})}async restartICE(e,n){let i,o;if(e===ho.SEND_ONLY){if(!this.sendConnection)throw new Ce(Y.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");i=await this.sendMutex.lock("From P2PChannel.restartICE"),o=this.sendConnection}else{if(!this.recvConnection)throw new Ce(Y.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");i=await this.recvMutex.lock("From P2PChannel.restartICE"),o=this.recvConnection}try{if(n){const c=await o.restartICE(n);return o.isInRestartIce=!1,c}{const c=await o.restartICE();if(c){const u=await ds(this,bt.RequestP2PRestartICE,{direction:ho.RECEIVE_ONLY,iceParameter:c});await o.restartICE(u),o.isInRestartIce=!1}}}finally{i()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const e=this.sendConnection.getStats(),n=this.localTrackMap.get(Ve.LocalVideoTrack),i=this.localTrackMap.get(Ve.LocalAudioTrack),o=e.videoSend.find(P=>{var B;return P.ssrc===(n==null||(B=n.ssrcs)===null||B===void 0?void 0:B[0].ssrcId)}),c=e.audioSend.find(P=>{var B;return P.ssrc===(i==null||(B=i.ssrcs)===null||B===void 0?void 0:B[0].ssrcId)});if(!o||!c)return 1;const u=_c(this,bt.NeedSignalRTT),h=o?o.rttMs:void 0,m=c?c.rttMs:void 0,_=h&&m?(h+m)/2:h||m,y=(_&&u?(_+u)/2:_||u)||0,S=100*e.sendPacketLossRate*.7/50+.3*y/1500,w=S<.17?1:S<.36?2:S<.59?3:S<.1?4:5,I=n==null?void 0:n.track;if(I&&I._encoderConfig&&I._hints.indexOf(ir.SCREEN_TRACK)===-1){const P=I._encoderConfig.bitrateMax,B=e.bitrate.actualEncoded;if(P&&B){const M=(1e3*P-B)/(1e3*P);return Pz[M<.15?0:M<.3?1:M<.45?2:M<.6?3:4][w]}}return w}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const e=this.recvConnection.getStats();let n=0;return Array.from(this.remoteUserMap.entries()).forEach(i=>{let[o]=i;const c=o._audioSSRC,u=o._videoSSRC,h=e.audioRecv.find(B=>B.ssrc===c),m=e.videoRecv.find(B=>B.ssrc===u);if(!h&&!m)return void(n+=1);const _=_c(this,bt.NeedSignalRTT),y=e.rtt,S=(y&&_?(y+_)/2:y||_)||0,w=h?h.jitterMs:void 0,I=e.recvPacketLossRate;let P=.7*I*100/50+.3*S/1500;w&&(P=.6*I*100/50+.2*S/1500+.2*w/400),n+=P<.1?1:P<.17?2:P<.36?3:P<.59?4:5}),this.remoteUserMap.size>0?Math.round(n/this.remoteUserMap.size):n}async muteLocalTrack(e){return new tt((n,i)=>{this.handleMuteLocalTrack(e,n,i)})}filterTobePublishedTracks(e,n,i){const o=[],c=On(),u=this.getAllTracks();e=$y(e=e.filter(_=>u.indexOf(_)===-1));let h=!1,m=!1;for(const _ of e){if(_ instanceof hr&&(this.localTrackMap.has(Ve.LocalVideoTrack)||h?new Ce(Y.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(o.push({track:_,type:Ve.LocalVideoTrack}),h=!0),n)){const y=this.getLowVideoTrack(_,i);o.push({track:y,type:Ve.LocalVideoLowTrack})}if(_ instanceof Vr){const y=this.localTrackMap.get(Ve.LocalAudioTrack);if(y){if(!(y.track instanceof yi))throw new Ce(Y.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(_._bypassWebAudio)throw new Ce(Y.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");y.track.addAudioTrack(_),this.bindLocalAudioTrackEvents(_,!0)}else if(m){const S=o.find(w=>{let{type:I}=w;return I===Ve.LocalAudioTrack});if(!(S.track instanceof yi))throw new Ce(Y.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(_._bypassWebAudio)throw new Ce(Y.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");S.track.addAudioTrack(_)}else{if(!c.webAudioMediaStreamDest||_ instanceof yi||_._bypassWebAudio)o.push({track:_,type:Ve.LocalAudioTrack});else{const S=new yi;S.addAudioTrack(_),o.push({track:S,type:Ve.LocalAudioTrack})}m=!0}}}return o}filterTobeUnpublishedTracks(e){const n=[],i=this.getAllTracks();e=$y(e=e.filter(o=>i.indexOf(o)!==-1));for(const o of e){if(o instanceof Vr){const c=this.localTrackMap.get(Ve.LocalAudioTrack);if(!c)continue;c.track instanceof yi?(c.track.removeAudioTrack(o),this.unbindLocalAudioTrackEvents(o),c.track.trackList.length===0&&(n.push([Ve.LocalAudioTrack,c]),c.track.close())):n.push([Ve.LocalAudioTrack,c])}if(o instanceof hr){const c=this.localTrackMap.get(Ve.LocalVideoTrack);if(!c)continue;n.push([Ve.LocalVideoTrack,c]);const u=this.localTrackMap.get(Ve.LocalVideoLowTrack);u&&n.push([Ve.LocalVideoLowTrack,u])}}return n}bindLocalTrackEvents(e){e.forEach(n=>{let{track:i,type:o}=n;switch(o){case Ve.LocalVideoTrack:i.addListener(ut.GET_STATS,this.handleGetLocalVideoStats),i.addListener(ut.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(ut.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(ut.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.addListener(ut.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.addListener(ut.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.addListener(ut.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(ut.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Ve.LocalAudioTrack:this.bindLocalAudioTrackEvents(i);case Ve.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,n){e instanceof yi?e.trackList.forEach(i=>{i.addListener(ut.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(ut.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(ut.GET_STATS,this.handleGetLocalAudioStats),i.addListener(ut.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(ut.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(ut.GET_STATS,this.handleGetLocalAudioStats),e.addListener(ut.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(ut.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(ut.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(ut.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),n||e.addListener(ut.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(n=>{let[i,{track:o}]=n;return{track:o,type:i}})),e.forEach(n=>{let{track:i,type:o}=n;switch(o){case Ve.LocalVideoTrack:i.off(ut.GET_STATS,this.handleGetLocalVideoStats),i.off(ut.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.off(ut.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.off(ut.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.off(ut.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.off(ut.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.off(ut.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.off(ut.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Ve.LocalAudioTrack:this.unbindLocalAudioTrackEvents(i);case Ve.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof yi?e.trackList.forEach(n=>{n.off(ut.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(ut.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(ut.GET_STATS,this.handleGetLocalAudioStats),n.off(ut.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(ut.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(ut.GET_STATS,this.handleGetLocalAudioStats),e.off(ut.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(ut.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(ut.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(ut.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(ut.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,n){n instanceof av&&n.addListener(ut.GET_STATS,i=>{i(this.handleGetRemoteVideoStats(e))}),n instanceof cv&&n.addListener(ut.GET_STATS,i=>{i(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(ut.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[n,i]=e;i.has(at.AUDIO)&&this.unbindRemoteTrackEvents(n._audioTrack),i.has(at.VIDEO)&&this.unbindRemoteTrackEvents(n._videoTrack)})}createGatewayPublishMessage(e,n){return e.map((i,o)=>{var c;let u,{track:h,type:m}=i;switch(m){case Ve.LocalAudioTrack:u=jn.Audio;break;case Ve.LocalVideoTrack:u=Xe(c=h._hints).call(c,ir.SCREEN_TRACK)?jn.Screen:jn.High;break;case Ve.LocalVideoLowTrack:u=jn.Low}return{kind:m===Ve.LocalAudioTrack?at.AUDIO:at.VIDEO,stream_type:u,mid:n[o].id,ssrcs:n[o].localSSRC,isMuted:h.muted||!h.enabled}})}createGatewayUnpublishMessage(e){return e.map(n=>{var i;let o,[c,{track:u,ssrcs:h,id:m}]=n;switch(c){case Ve.LocalVideoTrack:o=Xe(i=u._hints).call(i,ir.SCREEN_TRACK)?jn.Screen:jn.High;break;case Ve.LocalAudioTrack:o=jn.Audio;break;case Ve.LocalVideoLowTrack:o=jn.Low}return{stream_type:o,ssrcs:h,mid:m}})}assignLocalTracks(e,n){e.forEach((i,o)=>{let{track:c,type:u}=i;this.localTrackMap.set(u,{track:c,id:n[o].id,ssrcs:n[o].localSSRC})})}withdrawLocalTracks(e){e.forEach(n=>{let[i]=n;this.localTrackMap.delete(i)})}bindConnectionEvents(e){e.onConnectionStateChange=async n=>{var i;k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(e.name,".onConnectionStateChange(").concat(n,")")),this.emit(bt.PeerConnectionStateChange,n),n!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),n==="connected"&&(e.isInRestartIce=!1),Xe(i=this._restartStates).call(i,n)&&!e.isInRestartIce&&(n==="disconnected"&&await $i(800),e.iceConnectionState!=="disconnected"&&e.iceConnectionState!=="failed"||this.handleDisconnect(e.direction))},e.onICEConnectionStateChange=n=>{n!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(n,")")),yt.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:n,tag:kr.TRACER}).onSuccess(),this.emit(bt.IceConnectionStateChange,n)},e.onICETransportStateChange=n=>{k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(n,")"))},e.onDTLSTransportStateChange=n=>{k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(n,")"))},e.onDTLSTransportError=n=>{k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(n,")"))},e.onFirstAudioDecoded=n=>{var i;const o=Array.from(yc(i=this.remoteUserMap).call(i)).find(u=>u._audioSSRC===n);var c;o&&(this.store.subscribe(o.uid,"audio",void 0,void 0,void 0,Date.now()),(c=o.audioTrack)===null||c===void 0||c.emit(nv.FIRST_FRAME_DECODED),yt.firstRemoteFrame(this.store.sessionId,Oi.FIRST_AUDIO_DECODE,vr.FIRST_AUDIO_DECODE,{peer:o._uintid,subscribeElapse:Ss.measureFromSubscribeStart(this.store.clientId,n),subscribeRequestid:n,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=n=>{var i;const o=Array.from(yc(i=this.remoteUserMap).call(i)).find(c=>c._audioSSRC===n);o&&yt.firstRemoteFrame(this.store.sessionId,Oi.FIRST_AUDIO_RECEIVED,vr.FIRST_AUDIO_RECEIVED,{peer:o._uintid,subscribeElapse:Ss.measureFromSubscribeStart(this.store.clientId,n),subscribeRequestid:n,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(n,i,o)=>{this.reportVideoFirstFrameDecoded(n,i,o)},e.onFirstVideoReceived=n=>{var i;const o=Array.from(yc(i=this.remoteUserMap).call(i)).find(c=>c._videoSSRC===n);o&&yt.firstRemoteFrame(this.store.sessionId,Oi.FIRST_VIDEO_RECEIVED,vr.FIRST_VIDEO_RECEIVED,{peer:o._uintid,subscribeElapse:Ss.measureFromSubscribeStart(this.store.clientId,n),subscribeRequestid:n,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(n,i)=>{const o=n.candidateType==="relay",c=i.candidateType==="relay";i.candidateType!=="unknown"&&o===c||this.emit(bt.ConnectionTypeChange,o),k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(rm(i))," -> ").concat(JSON.stringify(rm(n)),")"))},e.onSelectedRemoteCandidateChanged=(n,i)=>{k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(rm(i))," -> ").concat(JSON.stringify(rm(n)),")"))},e.onFirstVideoDecodedTimeout=n=>{this.reportVideoFirstFrameDecoded(n,void 0,void 0,!0)},e.onLocalCandidate=n=>{this.emit(bt.LocalCandidate,{candidate:n,direction:e.direction})}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.onLocalCandidate=void 0}async handleDisconnect(e){const n=e===ho.SEND_ONLY?this.sendConnection:this.recvConnection;n&&!n.isInRestartIce&&(n.isInRestartIce=!0,k.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(n.name,"] start use restartICE")),e===ho.SEND_ONLY?this.restartICE(e):ds(this,bt.RequestP2PRestartICE,{direction:ho.SEND_ONLY}))}filterTobeMutedTracks(e){const n=[];if(this.getAllTracks().indexOf(e)===-1)return n;const i=this.localTrackMap.get(Ve.LocalAudioTrack);if(e instanceof Vr&&(i==null?void 0:i.track)instanceof yi)return i.track.isActive||n.push([Ve.LocalAudioTrack,i]),n;const o=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return e===u});if(o&&(n.push(o),o[0]===Ve.LocalVideoTrack)){const c=this.localTrackMap.get(Ve.LocalVideoLowTrack);c&&n.push([Ve.LocalVideoLowTrack,c])}return n}filterTobeUnmutedTracks(e){const n=[],i=this.localTrackMap.get(Ve.LocalAudioTrack);if(e instanceof Vr&&(i==null?void 0:i.track)instanceof yi)return i.track.isActive&&n.push([Ve.LocalAudioTrack,i]),n;const o=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return e===u});if(o)if(o[0]===Ve.LocalVideoTrack){n.push(o);const c=this.localTrackMap.get(Ve.LocalVideoLowTrack);c&&n.push([Ve.LocalVideoLowTrack,c])}else n.push(o);return n}createMuteMessage(e){return e.map(n=>{var i;let o,[c,{track:u,ssrcs:h,id:m}]=n;switch(c){case Ve.LocalAudioTrack:o=jn.Audio;break;case Ve.LocalVideoTrack:o=Xe(i=u._hints).call(i,ir.SCREEN_TRACK)?jn.Screen:jn.High;break;case Ve.LocalVideoLowTrack:o=jn.Low}return{stream_type:o,ssrcs:h,mid:m}})}createUnmuteMessage(e){return e.map(n=>{var i;let o,[c,{track:u,ssrcs:h,id:m}]=n;switch(c){case Ve.LocalAudioTrack:o=jn.Audio;break;case Ve.LocalVideoTrack:o=Xe(i=u._hints).call(i,ir.SCREEN_TRACK)?jn.Screen:jn.High;break;case Ve.LocalVideoLowTrack:o=jn.Low}return{stream_type:o,ssrcs:h,mid:m}})}filterTobeUnSubscribedTracks(e,n){const i=[],o=this.remoteUserMap.get(e);if(!o)return i;if(n){const c=o.get(n);if(!c)return i;i.push([e,{kind:n,id:c}])}else Array.from(o.entries()).forEach(c=>{let[u,h]=c;i.push([e,{kind:u,id:h}])});return i}createUnsubscribeMessage(e){const n=[];return e.forEach(i=>{let[o,{kind:c,id:u}]=i;switch(c){case at.VIDEO:return void(o._videoSSRC&&n.push({stream_type:at.VIDEO,ssrcId:o._videoSSRC}));case at.AUDIO:return void(o._audioSSRC&&n.push({stream_type:at.AUDIO,ssrcId:o._audioSSRC}))}}),n}withdrawRemoteTracks(e){e.forEach(n=>{let[i,{kind:o}]=n;const c=this.remoteUserMap.get(i);c&&(c.delete(o),Array.from(c.entries()).length===0&&this.remoteUserMap.delete(i))})}async updateBitrateLimit(e){const n=this.localTrackMap.get(Ve.LocalVideoTrack),i=this.localTrackMap.get(Ve.LocalVideoLowTrack);n&&(await n.track.setBitrateLimit(e.uplink),await new tt((o,c)=>{this.handleUpdateVideoEncoder(n.track,o,c,!0)})),i&&e.low_stream_uplink&&(await i.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new tt((o,c)=>{this.handleUpdateVideoEncoder(i.track,o,c,!0)}))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const e=this.sendConnection.peerConnectionState,n=this.recvConnection.peerConnectionState;return e!=="connected"&&n!=="connected"}return!0}async tryToUnmuteAudio(e){for(let n=0;n<e.length;n++)if(e[n]instanceof Vr){const i=this.filterTobeUnmutedTracks(e[n]);if(i.length===0)continue;const o=this.createUnmuteMessage(i);return void await nr(this,bt.RequestUnmuteLocal,o)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=e=>this.getStats(e),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(e=>{let[,{ssrcs:n}]=e;return!!n}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var n;return!((n=this.recvConnection)===null||n===void 0||!n.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,n)=>this.emit(bt.RequestUpload,e,n),this.statsUploader.requestUploadStats=e=>this.emit(bt.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await $i(sL(this.dtlsFailedCount,pi)),this.emit(bt.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(Ve.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof hr)}throwIfTrackTypeNotMatch(e){if(e.filter(n=>n instanceof hr).length>1)throw new Ce(Y.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(n=>n instanceof Vr).length>1&&(e.some(n=>n instanceof Vr&&n._bypassWebAudio)||!On().webAudioMediaStreamDest))throw new Ce(Y.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const n of e){if(n instanceof hr&&this.pendingLocalTracks.some(i=>i instanceof hr))throw new Ce(Y.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(n instanceof Vr&&this.pendingLocalTracks.some(i=>i instanceof Vr)&&(!On().webAudioMediaStreamDest||n._bypassWebAudio||this.pendingLocalTracks.some(i=>i instanceof Vr&&i._bypassWebAudio)))throw new Ce(Y.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,n){const i=!Z("DISABLE_DUAL_STREAM_USE_ENCODING")&&On().supportDualStreamEncoding,o=gO(gO({},{width:160,height:120,framerate:15,bitrate:50}),n);let c;c=i?e._mediaStreamTrack.clone():px(e,o);const u=rr(8,"track-low-"),h=new hr(c,gO(gO({},i&&{scaleResolutionDownBy:XL(o,e)}),{},{frameRate:o.framerate,bitrateMax:o.bitrate,bitrateMin:o.bitrate}),void 0,void 0,u);return h.on(t_.TRANSCEIVER_UPDATED,m=>{e._updateRtpTransceiver(m,ev.LOW_STREAM)}),h._hints.push(ir.LOW_STREAM),e.addListener(ut.NEED_CLOSE,()=>{h.close()}),h}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(e,n,i,o){var c;const u=Array.from(yc(c=this.remoteUserMap).call(c)).find(h=>h._videoSSRC===e);if(u){o||this.store.subscribe(u.uid,"video",void 0,void 0,void 0,void 0,Date.now());const h=this.store.keyMetrics,m=h.subscribe.find(_=>_.userId===u.uid&&_.type==="video");yt.firstRemoteVideoDecode(this.store.sessionId,Oi.FIRST_VIDEO_DECODE,vr.FIRST_VIDEO_DECODE,{peer:u._uintid,videowidth:n,videoheight:i,subscribeElapse:Ss.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:h.requestAPEnd||0,apStart:h.requestAPStart||0,joinGwEnd:h.joinGatewayEnd||0,joinGwStart:h.joinGatewayStart||0,pcEnd:h.peerConnectionEnd||0,pcStart:h.peerConnectionStart||0,subscriberEnd:(m==null?void 0:m.subscribeEnd)||0,subscriberStart:(m==null?void 0:m.subscribeStart)||0,videoAddNotify:(m==null?void 0:m.streamAdded)||0,state:o?1:0})}}async remoteMediaSsrcChanged(e,n,i){if(!this.recvConnection)return!1;const o=this.remoteUserMap.get(e);if(!o)return!1;const c=o.get(n);if(!c)return!1;const u=await this.recvConnection.getRemoteSSRC(c);return u!==void 0&&u!==i}isPreSubScribe(e){return!1}async publishDataChannel(e){throw new Ce(Y.NOT_SUPPORTED)}async unpublishDataChannel(e){throw new Ce(Y.NOT_SUPPORTED)}async subscribeDataChannel(e,n){throw new Ce(Y.NOT_SUPPORTED)}async unsubscribeDataChannel(e,n){throw new Ce(Y.NOT_SUPPORTED)}hasPendingRemoteDataChannel(e,n){throw new Ce(Y.NOT_SUPPORTED)}setPendingRemoteDataChannel(e,n){throw new Ce(Y.NOT_SUPPORTED)}async preConnect(e){throw new Ce(Y.NOT_SUPPORTED)}getEstablishParams(){throw new Ce(Y.NOT_SUPPORTED)}async reSubscribe(e){throw new Ce(Y.NOT_SUPPORTED)}async updateVideoStreamParameter(e,n){throw new Ce(Y.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[n,{track:i}]=e;n===Ve.LocalVideoLowTrack?i._updateRtpTransceiver(void 0,ev.LOW_STREAM):i._updateRtpTransceiver(void 0)})}},ht(Tr.prototype,"p2pConnect",[_K],Object.getOwnPropertyDescriptor(Tr.prototype,"p2pConnect"),Tr.prototype),ht(Tr.prototype,"unpublish",[EK],Object.getOwnPropertyDescriptor(Tr.prototype,"unpublish"),Tr.prototype),ht(Tr.prototype,"unpublishLowStream",[yK],Object.getOwnPropertyDescriptor(Tr.prototype,"unpublishLowStream"),Tr.prototype),ht(Tr.prototype,"subscribe",[vK],Object.getOwnPropertyDescriptor(Tr.prototype,"subscribe"),Tr.prototype),ht(Tr.prototype,"mockSubscribe",[SK],Object.getOwnPropertyDescriptor(Tr.prototype,"mockSubscribe"),Tr.prototype),ht(Tr.prototype,"unsubscribe",[TK],Object.getOwnPropertyDescriptor(Tr.prototype,"unsubscribe"),Tr.prototype),ht(Tr.prototype,"muteRemote",[bK],Object.getOwnPropertyDescriptor(Tr.prototype,"muteRemote"),Tr.prototype),ht(Tr.prototype,"unmuteRemote",[wK],Object.getOwnPropertyDescriptor(Tr.prototype,"unmuteRemote"),Tr.prototype),ht(Tr.prototype,"hasRemoteMediaWithLock",[RK],Object.getOwnPropertyDescriptor(Tr.prototype,"hasRemoteMediaWithLock"),Tr.prototype),ht(Tr.prototype,"disconnectForReconnect",[CK],Object.getOwnPropertyDescriptor(Tr.prototype,"disconnectForReconnect"),Tr.prototype),ht(Tr.prototype,"remoteMediaSsrcChanged",[IK],Object.getOwnPropertyDescriptor(Tr.prototype,"remoteMediaSsrcChanged"),Tr.prototype),Tr);function td(e){return function(n,i,o){const c=n[i];if(typeof c!="function")throw new Error("Cannot use mutex on object property.");return o.value=async function(){for(var u=arguments.length,h=new Array(u),m=0;m<u;m++)h[m]=arguments[m];switch(e){case ed.SEND_ONLY:{const _=await this.sendMutex.lock("From P2PChannel2.".concat(i));try{return await c.apply(this,h)}finally{_()}}case ed.RECEIVE_ONLY:{const _=await this.recvMutex.lock("From P2PChannel2.".concat(i));try{return await c.apply(this,h)}finally{_()}}default:{const _=await this.sendMutex.lock("From P2PChannel2.".concat(i)),y=await this.recvMutex.lock("From P2PChannel2.".concat(i));try{return await c.apply(this,h)}finally{_(),y()}}}},o}}class T_ extends Rr{constructor(n,i){super(),K(this,"signal",void 0),K(this,"token",void 0),K(this,"tokenTimeout",void 0),K(this,"tokenInterval",void 0),K(this,"_sequence",0),K(this,"userMap",new Map),K(this,"encoder",new TextEncoder),this.signal=n,this.token=i;const o=()=>{this.signal.connectionState===or.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(o,1e3):this.tokenInterval=window.setTimeout(o,3*Z("P2P_TOKEN_INTERVAL"))};o()}async send(n,i,o,c,u){var h,m,_;if(this.userMap.size===0)return;const y=Array.from(mc(h=this.userMap).call(h))[0].token;typeof i!="string"&&(i=JSON.stringify(i)),c=(m=c)!==null&&m!==void 0?m:rr(6,""),u=(_=u)!==null&&_!==void 0?_:this._sequence++;const S={_id:c,_type:n,_seq:u,_message:i,token:"".concat(this.token,"_").concat(y)};Z("SHOW_P2P_LOG")&&k.debug("send message",S,"noNeedResponse : ".concat(o)),this.splitMessage(JSON.stringify(S)).forEach(I=>{this.signal.request(Dt.DATA_STREAM,{payload:Qp(this.encoder.encode(I))})});const w=new tt((I,P)=>{const B=window.setTimeout(()=>{this.off("res-@".concat(c,"_ack"),M),this.off("res-@".concat(c),q),this.off(fv.ABORT,U),k.debug("[external-signal] request timeout, type: ".concat(n,", requestId: ").concat(c)),this.userMap.size===0?P(new Ce(Y.INVALID_REMOTE_USER)):P(new Ce(Y.TIMEOUT))},Z("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),M=()=>{B&&window.clearTimeout(B),this.off(fv.ABORT,U),o&&I()},U=()=>{B&&window.clearTimeout(B),this.off("res-@".concat(c,"_ack"),M),this.off("res-@".concat(c),q),P(new Ce(Y.EXTERNAL_SIGNAL_ABORT,"type: ".concat(n,", requestId: ").concat(c)))};this.once(fv.ABORT,U),this.once("res-@".concat(c,"_ack"),M);const q=(ae,me)=>{$=!0,B&&window.clearTimeout(B),this.off("res-@".concat(c,"_ack"),M),this.off(fv.ABORT,U),ae==="success"?I(me):P(new Ce(Y.P2P_MESSAGE_FAILED,"request ".concat(n," failed, requestId: ").concat(c)))};let $=!1;o||(this.once("res-@".concat(c),q),$i(Z("SIGNAL_REQUEST_TIMEOUT")).then(()=>{$||k.warning("external_signal request timeout, type: ".concat(n,", requestId: ").concat(c,", ").concat(S))}))});try{return await w}catch(I){if(I.code===Y.TIMEOUT)return await this.send(n,i,o,c,u);throw I}}onMessage(n){var i;const{_uid:o}=n;let c,u=this.userMap.get(o);if(u)c=u.splitMessageMap;else{if(this.userMap.size>0||!("_type"in n)||n._type!==Yr.CHECK)return;const{token:y}=n;c=new Map,u={uid:o,isStart:!0,token:y,splitMessageMap:c,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(o,u),this.signal.emit(ln.ON_USER_ONLINE,{uid:o}),this.handleUserOnline()}if("id"in n&&"total"in n){var h;const{id:y,total:S}=n,w=(h=c.get(y))!==null&&h!==void 0?h:[];if(w.push(n),c.has(y)||c.set(y,w),w.length!==S)return;{const I=_0(w).call(w,(P,B)=>P.index-B.index).map(P=>P.payload).join("");c.delete(y),(n=JSON.parse(I))._uid=o}}const{_type:m,token:_}=n;if(Xe(i=[Yr.ACK,Yr.CHECK]).call(i,m))return m===Yr.CHECK&&this.handleCheckToken(u,_),void this.receiveMessage(n);_==="".concat(u.token,"_").concat(this.token)?this.handleReceivedMessage(n):k.debug('Receive unexpected message", '.concat(_,", cur_token: ").concat(u.token,"_").concat(this.token),n)}check(){const n={_id:rr(6,""),token:this.token,_type:Yr.CHECK};Z("SHOW_P2P_LOG")&&k.debug("send message",n),this.signal.request(Dt.DATA_STREAM,{payload:Qp(this.encoder.encode(JSON.stringify(n)))})}ack(n){const i={_id:n,_type:Yr.ACK,token:this.token};Z("SHOW_P2P_LOG")&&k.debug("send message",i),this.signal.request(Dt.DATA_STREAM,{payload:Qp(this.encoder.encode(JSON.stringify(i)))})}response(n,i,o){this.send(Yr.RESPONSE,JSON.stringify({success:!o,message:i}),!0,n)}handleReceivedMessage(n){const i=()=>{this.userMap.forEach(y=>{const{receivedMessagesMap:S,nextExpectedSequenceNumber:w}=y;for(;S.has(w);){const I=S.get(w);S.delete(w),this.receiveMessage(I),y.nextExpectedSequenceNumber++}})};if(!n)return void i();const{_uid:o,_seq:c}=n,u=this.userMap.get(o),{receivedMessagesMap:h,isStart:m,nextExpectedSequenceNumber:_}=u;if(c<_)return this.ack(n._id),void k.debug("[external-signal] receive old message, seq: ".concat(c,", ").concat(n._message));h.set(c,n),m&&c===_&&(this.receiveMessage(n),h.delete(_),u.nextExpectedSequenceNumber++,i())}receiveMessage(n){const{_id:i,_type:o,_message:c,_uid:u}=n;if(Z("SHOW_P2P_LOG")&&k.debug("receive message",n),i){let h;switch(n._type!==Yr.ACK&&(c&&(h=JSON.parse(c)),this.ack(n._id)),n._type){case Yr.CANDIDATE:case Yr.CONTROL:this.signal.emit(o,h,u);break;case Yr.PUBLISH:case Yr.UNPUBLISH:case Yr.RESTART_ICE:case Yr.CALL:h.uid=u,ds(this.signal,o,h).then(m=>{this.response(n._id,m)}).catch(()=>{this.response(n._id,void 0,!0)});break;case Yr.ACK:this.getListeners("res-@".concat(i,"_ack")).length>0&&this.emit("res-@".concat(i,"_ack"));break;case Yr.RESPONSE:{const{success:m,message:_}=h;this.emit("res-@".concat(i),m?"success":"failed",_);break}}}}splitMessage(n){if(n.length<T_.MAX_MESSAGE_SIZE)return[n];const i=[],{remoteToken:o}=JSON.parse(n),c=rr(6,"");let u=0,h=800;const m=Math.ceil(n.length/h);for(;n.length>0;){u++;const _={id:c,index:u,total:m,payload:n.slice(0,h),token:"".concat(this.token,"_").concat(o)};JSON.stringify(_).length>T_.MAX_MESSAGE_SIZE?h-=50:(i.push(_),n=n.slice(h))}return i.map(_=>JSON.stringify(_))}handleCheckToken(n,i){return n.token!==i?(k.debug("token changed, from ".concat(n.token," to ").concat(i)),this.reset(n.uid,i),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{k.debug("token timeout, ".concat(i)),this.reset(n.uid)},Z("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const n=await ds(this.signal,Yr.CALL,void 0),i=await this.send(Yr.CALL,n);this.signal.emit(Lt.P2P_CONNECTION,i,!0)}async reset(n,i){const o=this.userMap.get(n);o&&(this.emit(fv.ABORT),this.signal.emit(ln.ON_USER_OFFLINE,{uid:o.uid,reason:jfe.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),i||(k.debug("change local token from ".concat(i," to ").concat(i)),this.token=rr(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(fv.ABORT)}}K(T_,"MAX_SIZE",1),K(T_,"MAX_MESSAGE_SIZE",1024);class Tge extends Rr{get connectionState(){return this._connectionState}set connectionState(n){n!==this._connectionState&&(this._connectionState=n,n===or.CONNECTED?this.emit(Lt.WS_CONNECTED):n===or.RECONNECTING?this.emit(Lt.WS_RECONNECTING,this._websocketReconnectReason):n===or.CLOSED&&this.emit(Lt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(n,i){super(),K(this,"_disconnectedReason",void 0),K(this,"_websocketReconnectReason",void 0),K(this,"_connectionState",or.CLOSED),K(this,"reconnectToken",void 0),K(this,"p2pToken",void 0),K(this,"websocket",void 0),K(this,"openConnectionTime",void 0),K(this,"clientId",void 0),K(this,"lastMsgTime",Date.now()),K(this,"uploadCache",[]),K(this,"uploadCacheInterval",void 0),K(this,"rttRolling",new iW(5)),K(this,"pingpongTimer",void 0),K(this,"pingpongTimeoutCount",0),K(this,"joinResponse",void 0),K(this,"multiIpOption",void 0),K(this,"initError",void 0),K(this,"spec",void 0),K(this,"store",void 0),K(this,"_external_signal",void 0),K(this,"onWebsocketMessage",o=>{if(o.data instanceof ArrayBuffer)return void this.emit(Lt.ON_BINARY_DATA,o.data);const c=JSON.parse(o.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){const u="res-@".concat(c._id);this.emit(u,c._result,c._message)}else if(Object.prototype.hasOwnProperty.call(c,"_type")){switch(c._type){case ln.ON_DATA_STREAM:return void this.handleDataStream(c._message);case ln.MUTE_AUDIO:case ln.MUTE_VIDEO:case ln.ON_P2P_LOST:case ln.ON_USER_ONLINE:return;case ln.ON_USER_OFFLINE:const{uid:u}=c._message;return k.debug("[".concat(this.clientId,"] user-offline uid: ").concat(u)),void this._external_signal.reset(u)}if(this.emit(c._type,c._message),c._type===ln.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===ln.ON_USER_BANNED)switch(c._message.error_code){case 14:this.close(Vn.UID_BANNED);break;case 15:this.close(Vn.IP_BANNED);break;case 16:this.close(Vn.CHANNEL_BANNED)}if(c._type===ln.ON_USER_LICENSE_BANNED)switch(c._message.error_code){case Ct.ERR_LICENSE_MISSING:this.close(Vn.LICENSE_MISSING);break;case Ct.ERR_LICENSE_EXPIRED:this.close(Vn.LICENSE_EXPIRED);break;case Ct.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Vn.LICENSE_MINUTES_EXCEEDED);break;case Ct.ERR_LICENSE_PERIOD_INVALID:this.close(Vn.LICENSE_PERIOD_INVALID);break;case Ct.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Vn.LICENSE_MULTIPLE_SDK_SERVICE);break;case Ct.ERR_LICENSE_ILLEGAL:this.close(Vn.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=n.clientId,this.spec=n,this.store=i,this.websocket=new $L("gateway-".concat(this.clientId),this.spec.retryConfig,!0,Z("JOIN_GATEWAY_USE_DUAL_DOMAIN"),Z("JOIN_GATEWAY_USE_443PORT_ONLY"),i),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===or.CONNECTED&&this.reconnect("retry",us.OFFLINE)}),this.p2pToken=rr(6,""),this._external_signal=new T_(this,this.p2pToken)}async request(n,i,o,c){const u=rr(6,""),h={_id:u,_type:n,_message:i},m=this.websocket.connectionID,_=()=>new tt((B,M)=>{if(this.connectionState===or.CONNECTED)return B();const U=()=>{this.off(Lt.WS_CLOSED,q),B()},q=()=>{this.off(Lt.WS_CONNECTED,U),M(new Ce(Y.WS_ABORT))};this.once(Lt.WS_CONNECTED,U),this.once(Lt.WS_CLOSED,q)});if(this.connectionState!==or.CONNECTING&&this.connectionState!==or.RECONNECTING||n===Dt.JOIN||n===Dt.REJOIN||await _(),this.websocket.sendMessage(h,!0),c)return;const y=new tt((B,M)=>{let U=!1;const q=(ae,me)=>{U=!0,B({isSuccess:ae==="success",message:me||{}}),this.off(Lt.WS_CLOSED,$),this.off(Lt.WS_RECONNECTING,$),this.emit(Lt.REQUEST_SUCCESS,n,i)};this.once("res-@".concat(u),q);const $=()=>{M(new Ce(Y.WS_ABORT,"type: ".concat(n))),this.off(Lt.WS_CLOSED,$),this.off(Lt.WS_RECONNECTING,$),this.off("res-@".concat(u),q)};this.once(Lt.WS_CLOSED,$),this.once(Lt.WS_RECONNECTING,$),$i(Z("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==m||U||(k.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(n)),this.emit(Lt.REQUEST_TIMEOUT,n,i))})});let S=null;try{S=await y}catch(B){if(this.connectionState===or.CLOSED||n===Dt.LEAVE)throw new Ce(Y.WS_ABORT);return!this.spec.forceWaitGatewayResponse||o?B.throw():n===Dt.JOIN||n===Dt.REJOIN?null:(await _(),await this.request(n,i))}if(S.isSuccess)return S.message;const w=Number(S.message.error_code||S.message.code),I=G0(w),P=new Ce(Y.UNEXPECTED_RESPONSE,"".concat(I.desc,": ").concat(S.message.error_str),{code:w,data:S.message,desc:I.desc});return I.action==="success"?S.message:(k.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(n,", error_code: ").concat(w,", message: ").concat(I.desc,", action: ").concat(I.action)),w===Ct.ERR_TOO_MANY_BROADCASTERS?((n===Dt.JOIN||n===Dt.REJOIN)&&(this.initError=P,this.close()),P.throw()):I.action==="failed"?P.throw():I.action==="quit"?(this.initError=P,this.close(),P.throw()):(w===Ct.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=S.message.option,k.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",us.MULTI_IP)):this.reconnect(I.action,us.SERVER_ERROR),n===Dt.JOIN||n===Dt.REJOIN?null:await this.request(n,i)))}waitMessage(n,i){return new tt(o=>{const c=u=>{(!i||i(u))&&(this.off(n,c),o(u))};this.on(n,c)})}uploadWRTCStats(n){if(!this.store.sessionId)return void k.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const i={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:n};this.upload(B0.WRTC_STATS,i)}upload(n,i){const o={_type:n,_message:i};try{this.websocket.sendMessage(o)}catch{const u=Z("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(o),this.uploadCache.length>u&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==or.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},Z("UPLOAD_CACHE_INTERVAL")||2e3))}}send(n,i){const o={_type:n,_message:i};this.websocket.sendMessage(o)}async sendExtensionMessage(n,i,o){return await this._external_signal.send(n,i,o)}init(n){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new tt((i,o)=>{this.once(Lt.WS_CONNECTED,()=>i(this.joinResponse)),this.once(Lt.WS_CLOSED,()=>o(this.initError||new Ce(Y.WS_ABORT))),this.connectionState=or.CONNECTING,this.websocket.init(n).catch(o)})}close(n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=n||Vn.LEAVE,this.connectionState=or.CLOSED,k.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=rr(6,""),this._external_signal.clear(),this._external_signal=new T_(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(Lt.ABORT_P2P_EXECUTION);const n=await ds(this,Lt.REQUEST_JOIN_INFO),i=await this.request(Dt.JOIN,n);if(!i)return this.emit(Lt.REPORT_JOIN_GATEWAY,Y.TIMEOUT,this.url||""),!1;this.joinResponse=i,this.emit(Lt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=or.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(n,i){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(n,i)}handleDataStream(n){try{var i;const o=Qg(n.payload),c=new TextDecoder().decode(o),u=JSON.parse(c);"total"in u&&"id"in u||Xe(i=Object.values(Yr)).call(i,u._type)?(u._uid=n.uid,this._external_signal.onMessage(u)):this.emit(ln.ON_DATA_STREAM,n)}catch{this.emit(ln.ON_DATA_STREAM,n)}}handleNotification(n){k.debug("[".concat(this.clientId,"] receive notification: "),n);const i=G0(n.code);if(i.action!=="success"){if(i.action!=="failed")return i.action==="quit"?(i.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Vn.UID_BANNED),void this.close()):void this.reconnect(i.action,us.SERVER_ERROR);k.error("[".concat(this.clientId,"] ignore error: "),i.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const n=Z("PING_PONG_TIME_OUT"),i=Date.now();this.pingpongTimeoutCount>=n&&(k.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(i-this.lastMsgTime,"ms")),i-this.lastMsgTime>Z("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",us.TIMEOUT):this.request(Dt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const o=Date.now()-i;this.rttRolling.add(o),Z("REPORT_STATS")&&this.send(Dt.PING_BACK,{pingpongElapse:o})}).catch(o=>{})}handleWebsocketEvents(){this.websocket.on(Wt.RECONNECT_CREATE_CONNECTION,n=>{this.emit(Lt.WS_RECONNECT_CREATE_CONNECTION,n)}),this.websocket.on(Wt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Wt.CLOSED,()=>{this.connectionState=or.CLOSED}),this.websocket.on(Wt.FAILED,()=>{this._disconnectedReason=Vn.NETWORK_ERROR,this.connectionState=or.CLOSED}),this.websocket.on(Wt.RECONNECTING,n=>{this._websocketReconnectReason=n,this.joinResponse=void 0,this.connectionState===or.CONNECTED?this.connectionState=or.RECONNECTING:this.connectionState=or.CONNECTING}),this.websocket.on(Wt.WILL_RECONNECT,(n,i,o)=>{n!=="retry"?(k.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(n)),this.reconnectToken=void 0):k.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),o(n)}),this.websocket.on(Wt.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(n=>{if(this.emit(Lt.REPORT_JOIN_GATEWAY,n,this.url||""),n instanceof Ce&&n.code===Y.UNEXPECTED_RESPONSE&&n.data.code===Ct.ERR_NO_AUTHORIZED)return k.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",us.SERVER_ERROR);k.error("[".concat(this.clientId,"] join gateway request failed"),n.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",us.SERVER_ERROR):(this.initError=n,this.close())})}),this.websocket.on(Wt.REQUEST_NEW_URLS,(n,i)=>{ds(this,Lt.REQUEST_RECOVER,this.multiIpOption).then(n).catch(i)}),this.websocket.on(Wt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(ln.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}const bge={name:"P2PChannel",create:function(e){let{store:n,statsCollector:i}=e;return new Sge(n,i)},createSubmodule:function(e){let{store:n,spec:i}=e;return new Tge(i,n)}};function OK(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function PK(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?OK(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):OK(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}class wge{constructor(n){K(this,"sessionDesc",void 0),K(this,"localCapabilities",void 0),K(this,"rtpCapabilities",void 0),K(this,"candidates",void 0),K(this,"_originCandidates",void 0),K(this,"iceParameters",void 0),K(this,"dtlsParameters",void 0),K(this,"setup",void 0),K(this,"currentMidIndex",void 0),K(this,"cname",void 0),n=Dr(n);const{iceParameters:i,dtlsParameters:o,candidates:c,rtpCapabilities:u,setup:h,localCapabilities:m,sdkCodec:_,cname:y}=n,S=da(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=u,this.candidates=c,this._originCandidates=Dr(c),this.iceParameters=i,this.dtlsParameters=o,this.setup=h,this.localCapabilities=m,this.cname=y;for(let w=0;w<S.mediaDescriptions.length;w++){const I=S.mediaDescriptions[w];if(I.attributes.iceUfrag=i.iceUfrag,I.attributes.icePwd=i.icePwd,I.attributes.fingerprints=o.fingerprints,I.attributes.candidates=c,I.attributes.setup=h,I.media.mediaType==="video"){I.media.fmts=u.videoCodecs.map(B=>B.payloadType.toString(10));let P=u.videoCodecs.filter(B=>{var M,U;return(M=B.rtpMap)===null||M===void 0?void 0:Xe(U=M.encodingName.toLowerCase()).call(U,_)});P.length===0&&(P=u.videoCodecs),I.attributes.payloads=P,I.attributes.extmaps=u.videoExtensions}I.media.mediaType==="audio"&&(I.media.fmts=u.audioCodecs.map(P=>P.payloadType.toString(10)),I.attributes.payloads=u.audioCodecs,I.attributes.extmaps=u.audioExtensions),S.mediaDescriptions[w]=this.mungMediaDesc(I)}this.sessionDesc=S,this.currentMidIndex=S.mediaDescriptions.length-1}toString(){return Zp(this.sessionDesc)}send(n,i,o){const{ssrcs:c,ssrcGroups:u}=c_(i,this.cname),h=this.sessionDesc.mediaDescriptions.find(y=>n===at.VIDEO?y.media.mediaType==="video":y.media.mediaType==="audio"),m=c[0].attributes.label,_=c[0].attributes.mslabel;return h.attributes.ssrcs=h.attributes.ssrcs.concat(c),h.attributes.ssrcGroups=h.attributes.ssrcGroups.concat(u),{id:m,mslabel:_}}batchSend(n){return n.map(i=>{let{kind:o,ssrcMsg:c}=i;return this.send(o,c,void 0)})}stopSending(n){this.sessionDesc.mediaDescriptions.forEach(i=>{const o=[],c=[],u=[];i.attributes.ssrcs.forEach(h=>{Xe(n).call(n,h.attributes.label||"")?u.push(h):o.push(h)}),i.attributes.ssrcGroups.forEach(h=>{var m;Xe(m=u.map(_=>_.ssrcId)).call(m,h.ssrcIds[0])||c.push(h)}),i.attributes.ssrcs=o,i.attributes.ssrcGroups=c})}mute(n){const i=this.sessionDesc.mediaDescriptions.find(o=>o.attributes.mid===n);if(!i)throw new Error("mediaDescription not found with ".concat(n," in remote SDP when calling RemoteSDP.mute."));i.attributes.direction="inactive"}unmute(n){const i=this.sessionDesc.mediaDescriptions.find(o=>o.attributes.mid===n);if(!i)throw new Error("mediaDescription not found with ".concat(n," in remote SDP when calling RemoteSDP.unmute."));i.attributes.direction="sendonly"}receive(n,i,o){n.forEach((c,u)=>{const h=c._mediaStreamTrack,m=this.sessionDesc.mediaDescriptions.findIndex(y=>y.attributes.mid===h.kind),_=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[m],c);this.sessionDesc.mediaDescriptions[m]=_})}stopReceiving(n){}updateCandidates(n){const i=this._originCandidates.filter(c=>c.transport==="udp"),o=[];if(i.forEach(c=>{o.push(PK(PK({},c),{},{foundation:"tcpcandidate",priority:Number(c.priority)-1+"",transport:"tcp",port:Number(c.port)+90+""}))}),i.length!==0){switch(n){case vs.TCP_RELAY:this.candidates=o;break;case vs.UDP_TCP_RELAY:case vs.RELAY:this.candidates=[...i,...o];break;default:this.candidates=i}for(const c of this.sessionDesc.mediaDescriptions)c.attributes.candidates=this.candidates}}restartICE(n){n=Dr(n),this.iceParameters=n,this.sessionDesc.mediaDescriptions.forEach(i=>{i.attributes.iceUfrag=n.iceUfrag,i.attributes.icePwd=n.icePwd})}predictReceivingMids(n){const i=[];for(let o=0;o<n;o++)i.push((this.currentMidIndex+o+1).toString(10));return i}mungRecvMediaDsec(n,i){const o=Dr(n);return gv(o,i),QL(o,i),o}updateRecvMedia(n,i){const o=this.sessionDesc.mediaDescriptions.findIndex(c=>c.attributes.mid===n);if(o!==-1){const c=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[o],i);this.sessionDesc.mediaDescriptions[o]=c}}bumpMid(n){this.currentMidIndex+=n}updateTrackLabel(n,i,o){const c=this.sessionDesc.mediaDescriptions.find(h=>n===at.VIDEO?h.attributes.mid==="video":h.attributes.mid==="audio");if(c){const h=c.attributes.ssrcs.find(m=>m.attributes.label===i);var u;h&&(h.attributes.label=o,(u=h.attributes.msid)===null||u===void 0||u.replace(i,o))}}mungMediaDesc(n){const i=Dr(n);return JL(i),function(o){const c=o.attributes.extmaps.find(u=>kA(u.extensionName));c&&o.attributes.extmaps.splice(o.attributes.extmaps.indexOf(c),1),o.attributes.payloads.forEach(u=>{const h=u.rtcpFeedbacks.findIndex(m=>m.type==="transport-cc");h!==-1&&u.rtcpFeedbacks.splice(h,1)})}(i),i}getSSRC(n){for(const i of this.sessionDesc.mediaDescriptions)for(const o of i.attributes.ssrcs)if(o.attributes.label===n)return[o]}}var tr;function NK(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function _O(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?NK(Object(i),!0).forEach(function(o){K(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):NK(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}let Rge=(tr=class lw extends jz{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(n=>n.rtpMap&&n.rtpMap.encodingName.toLowerCase()||"").filter(n=>{var i;return Xe(i=Object.keys(aA)).call(i,n)}))]}constructor(n,i){super(n,i),K(this,"store",void 0),K(this,"peerConnection",void 0),K(this,"remoteSDP",void 0),K(this,"initialOffer",void 0),K(this,"statsFilter",void 0),K(this,"useRTX",!1),K(this,"localCapabilities",void 0),K(this,"localCandidateCount",0),K(this,"allCandidatesReceived",!1),K(this,"establishPromise",void 0),K(this,"mutex",void 0),this.store=i,this.mutex=new Es("P2PConnection-mutex",i.clientId),this.peerConnection=new RTCPeerConnection(lw.resolvePCConfiguration(n),{optional:[{googDscp:!0}]}),this.statsFilter=dL(this.peerConnection,Z("STATS_UPDATE_INTERVAL"),void 0,Pr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const n=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!n.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const i=im(n.sdp),o=K0(n.sdp,{filterRTX:!this.useRTX,filterVideoFec:Z("FILTER_VIDEO_FEC"),filterAudioFec:Z("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=o,this.initialOffer=n,_O(_O({},i),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:o},offerSDP:n.sdp})}catch(n){throw new Ce(Y.GET_LOCAL_CONNECTION_PARAMS_FAILED,n.toString())}}async updateRemoteConnect(){}async connect(n){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new wge(_O(_O({},n),{},{rtpCapabilities:n.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));const i=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(i){throw new Ce(Y.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(i.toString()))}}async updateRemoteRTPCapabilities(n,i){throw new Ce(Y.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(n){}send(n,i){var o=this;return el(function*(){const c=yield Sn(o.mutex.lock());try{if(!o.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const u=n.map(I=>o.peerConnection.addTrack(I._mediaStreamTrack)),h=yield Sn(o.peerConnection.createOffer()),m=da(h.sdp),_=n.map(I=>{const P=I._mediaStreamTrack,B=m.mediaDescriptions.find(M=>M.attributes.mid===P.kind);if(!B)throw new Error("Cannot extract ssrc from mediaDescription.");return function(M,U,q){const $=M.attributes.ssrcs.filter(me=>me.attributes.label===U),ae=M.attributes.ssrcGroups;if($.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(ae&&$.length>1){const me=ae.find(ge=>ge.ssrcIds.indexOf($[0].ssrcId)!==-1);return me?[{ssrcId:me.ssrcIds[0],rtx:q?me.ssrcIds[1]:void 0}]:[{ssrcId:$[0].ssrcId}]}return[{ssrcId:$[0].ssrcId}]}(B,P.id,o.useRTX)});let y;try{y=yield _}catch(I){throw u.forEach(P=>{ls()&&P.replaceTrack(null),o.peerConnection.removeTrack(P)}),I}const S=o.mungSendOfferSDP(h.sdp,n);o.remoteSDP.receive(n,i,y);const w=o.remoteSDP.toString();return yield Sn(o.peerConnection.setLocalDescription({type:"offer",sdp:S})),yield Sn(o.applySendEncodings(u,n)),yield Sn(o.peerConnection.setRemoteDescription({type:"answer",sdp:w})),n.map((I,P)=>{const B=I._mediaStreamTrack.id;return{localSSRC:_[P],id:B}})}catch(u){throw new Ce(Y.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(u.toString()))}finally{c()}})()}async stopSending(n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const i=this.peerConnection.getSenders().filter(u=>{var h;return n.indexOf(((h=u.track)===null||h===void 0?void 0:h.id)||"")!==-1});if(i.length!==n.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");i.map(u=>{ls()&&u.replaceTrack(null),this.peerConnection.removeTrack(u)});const o=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(o),this.remoteSDP.stopReceiving(n);const c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(i){throw new Ce(Y.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(i.toString()))}}async receive(n,i,o,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(n," before remoteSDP created."));const{id:u,mslabel:h}=this.remoteSDP.send(n,i,c),m=new tt((S,w)=>{const I=setTimeout(()=>{w(new Error("Cannot receive track, id: ".concat(u)))},1e4),P=B=>{const M=Tn();if((M.name==="Safari"&&Number(M.version)===11||co())&&B.track.id!==u&&B.streams[0].id===h){var U;const q=B.streams[0].getTracks()[0];return(U=this.remoteSDP)===null||U===void 0||U.updateTrackLabel(n,u,B.track.id),this.peerConnection.removeEventListener("track",P),clearTimeout(I),void S(q)}if(B.track.id===u)return this.peerConnection.removeEventListener("track",P),clearTimeout(I),void S(B.track)};this.peerConnection.addEventListener("track",P)}),_=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:_});const y=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(y),{track:await m,id:u}}catch(u){throw new Ce(Y.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async stopReceiving(n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(n);const i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const o=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(o)}catch(i){throw new Ce(Y.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}async muteRemote(n){}async unmuteRemote(n){}async muteLocal(n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const i=this.peerConnection.getSenders().filter(o=>{var c;return n.indexOf(((c=o.track)===null||c===void 0?void 0:c.id)||"")!==-1});if(i.length!==n.length)throw new Error("sender' length doesn't match mids' length.");i.map(o=>{if(ls()&&o.track)o.track.enabled=!1;else{const c=o.getParameters();c.encodings.forEach(u=>u.active=!1),o.setParameters(c)}})}catch(i){throw new Ce(Y.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(i.toString()))}}async unmuteLocal(n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const i=this.peerConnection.getSenders().filter(u=>{var h;return n.indexOf(((h=u.track)===null||h===void 0?void 0:h.id)||"")!==-1});if(i.length!==n.length)throw new Error("Senders' length doesn't match mids' length.");i.map(async u=>{if(ls()&&u.track)u.track.enabled=!0;else{const h=u.getParameters();h.encodings.forEach(m=>m.active=!0),await u.setParameters(h)}});const o=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(o);const c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(i){throw new Ce(Y.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(i.toString()))}}restartICE(n){var i=this;return el(function*(){const o=yield Sn(i.mutex.lock("From P2PConnection.restartICE"));try{if(!i.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const c=On().supportPCSetConfiguration;if(n===vs.RELAY&&!c)return;if(c){const y=i.peerConnection.getConfiguration(),S=n===vs.RELAY?"relay":"all";y.iceTransportPolicy!==S&&(k.debug("[".concat(i.store.clientId,"] restartICE change iceTransportPolicy from [").concat(y.iceTransportPolicy,"] to [").concat(S,"]")),y.iceTransportPolicy=S,i.peerConnection.setConfiguration(y))}n!==vs.RELAY&&i.remoteSDP.updateCandidates(n);const u=yield Sn(i.peerConnection.createOffer({iceRestart:!0}));if(!u.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const h=im(u.sdp),{remoteIceParameters:m}=yield h.iceParameters;i.remoteSDP.restartICE(m);const _=i.remoteSDP.toString();yield Sn(i.peerConnection.setLocalDescription(u)),yield Sn(i.peerConnection.setRemoteDescription({type:"answer",sdp:_}))}catch(c){k.warning("[".concat(i.store.clientId,"] restart ICE failed, abort operation"),c)}finally{o()}})()}close(){var n;this.peerConnection.close(),(n=this.onConnectionStateChange)===null||n===void 0||n.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(n){return this.statsFilter.getVideoIsReady(n)}async updateEncoderConfig(n,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const o=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(o.sdp,[i]);this.remoteSDP.updateRecvMedia(i._mediaStreamTrack.kind,i);const u=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(o){throw new Ce(Y.EXCHANGE_SDP_FAILED,o.toString())}}async updateSendParameters(n,i){const o=this.peerConnection.getSenders().filter(c=>{var u;return((u=c.track)===null||u===void 0?void 0:u.id)===n});o.length===1&&await this.applySendEncodings(o,[i])}setStatsRemoteVideoIsReady(n,i){this.statsFilter.setVideoIsReady2(n,i)}async replaceTrack(n,i){const o=this.peerConnection.getSenders().find(c=>{var u;return((u=c.track)===null||u===void 0?void 0:u.id)===i});o&&await o.replaceTrack(n._mediaStreamTrack)}createDataChannels(n,i){throw new Ce(Y.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(n){throw new Ce(Y.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var n;(n=this.onICEConnectionStateChange)===null||n===void 0||n.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var n;(n=this.onConnectionStateChange)===null||n===void 0||n.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=n=>{n.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,k.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,k.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},Z("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(n){const i={iceServers:[],sdpSemantics:"plan-b"};return n.iceServers?i.iceServers=n.iceServers:n.turnServer&&n.turnServer.mode!=="off"&&(D0(n.turnServer.servers)?i.iceServers=n.turnServer.servers:(i.iceServers&&i.iceServers.push(...lw.turnServerConfigToIceServers(n.turnServer.servers)),Z("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&n.turnServer.serversFromGateway&&i.iceServers.push(...lw.turnServerConfigToIceServers(n.turnServer.serversFromGateway)),n.turnServer.servers.concat(n.turnServer.serversFromGateway||[]).forEach(o=>{o.forceturn&&(i.iceTransportPolicy="relay")}))),i}static turnServerConfigToIceServers(n){const i=[];return n.forEach(o=>{o.security?o.tcpport&&i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=tcp")}):(o.udpport&&i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.udpport,"?transport=udp")}),o.tcpport&&i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=tcp")}))}),i}async updateRtpSenderEncodings(n,i){var o;if(i||(i=this.peerConnection.getSenders().find(y=>{var S;return((S=y.track)===null||S===void 0?void 0:S.id)===n._mediaStreamTrack.id})),!i)return k.warn("[".concat(n.getTrackId(),"] no rtpSender found}"));if(!On().supportSetRtpSenderParameters)return k.warn("Browser not support set rtp-sender parameters");const c={},u={};if(n instanceof hr)switch(n._optimizationMode){case"motion":c.degradationPreference="maintain-framerate";break;case"detail":c.degradationPreference="maintain-resolution";break;default:c.degradationPreference="balanced"}if(Z("DSCP_TYPE")&&bf()){var h;const y=Z("DSCP_TYPE");Xe(h=["very-low","low","medium","high"]).call(h,y)&&(u.networkPriority=y)}const m=i.getParameters(),_=(o=m.encodings)===null||o===void 0?void 0:o[0];_&&Object.assign(_,u),Object.assign(m,c),k.debug("[".concat(n.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(m.encodings))),await i.setParameters(m)}async applySendEncodings(n,i){try{if(!On().supportSetRtpSenderParameters||n.length!==i.length)return;for(let o=0;o<n.length;o++){const c=n[o],u=i[o];c&&u&&await this.updateRtpSenderEncodings(u,c)}}catch{k.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(n,i){const o=da(n);return i.forEach((c,u)=>{const h=c._mediaStreamTrack,m=o.mediaDescriptions.find(_=>_.attributes.mid===h.kind);m&&gv(m,c)}),Zp(o)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=n=>{var i;(i=this.onFirstAudioReceived)===null||i===void 0||i.call(this,n)},this.statsFilter.onFirstVideoReceived=n=>{var i;(i=this.onFirstVideoReceived)===null||i===void 0||i.call(this,n)},this.statsFilter.onFirstAudioDecoded=n=>{var i;(i=this.onFirstAudioDecoded)===null||i===void 0||i.call(this,n)},this.statsFilter.onFirstVideoDecoded=(n,i,o)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,n,i,o)},this.statsFilter.onSelectedLocalCandidateChanged=(n,i)=>{var o;(o=this.onSelectedLocalCandidateChanged)===null||o===void 0||o.call(this,n,i)},this.statsFilter.onSelectedRemoteCandidateChanged=(n,i)=>{var o;(o=this.onSelectedRemoteCandidateChanged)===null||o===void 0||o.call(this,n,i)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const i=this.remoteSDP.batchSend(n).map((u,h)=>{let{id:m,mslabel:_}=u;const{kind:y}=n[h];return new tt((S,w)=>{const I=setTimeout(()=>{w(new Error("Cannot receive track, id: ".concat(m)))},1e4),P=B=>{const M=Tn();if(M.name==="Safari"&&Number(M.version)===11&&B.track.id!==m&&B.streams[0].id===_){var U;const q=B.streams[0].getTracks()[0];return(U=this.remoteSDP)===null||U===void 0||U.updateTrackLabel(y,m,B.track.id),this.peerConnection.removeEventListener("track",P),clearTimeout(I),void S({track:q,id:m})}if(B.track.id===m)return this.peerConnection.removeEventListener("track",P),clearTimeout(I),void S({track:B.track,id:m})};this.peerConnection.addEventListener("track",P)})}),o=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:o});const c=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(c),await tt.all(i)}catch(i){throw new Ce(Y.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(i.toString()))}}async getRemoteSSRC(n){if(!this.remoteSDP)return;const i=this.remoteSDP.getSSRC(n);return i==null?void 0:i[0].ssrcId}setConfiguration(n){if(On().supportPCSetConfiguration){const i=lw.resolvePCConfiguration(n);this.peerConnection.setConfiguration(i)}}},ht(tr.prototype,"connect",[cl],Object.getOwnPropertyDescriptor(tr.prototype,"connect"),tr.prototype),ht(tr.prototype,"stopSending",[cl],Object.getOwnPropertyDescriptor(tr.prototype,"stopSending"),tr.prototype),ht(tr.prototype,"receive",[cl],Object.getOwnPropertyDescriptor(tr.prototype,"receive"),tr.prototype),ht(tr.prototype,"stopReceiving",[cl],Object.getOwnPropertyDescriptor(tr.prototype,"stopReceiving"),tr.prototype),ht(tr.prototype,"muteRemote",[cl],Object.getOwnPropertyDescriptor(tr.prototype,"muteRemote"),tr.prototype),ht(tr.prototype,"unmuteRemote",[cl],Object.getOwnPropertyDescriptor(tr.prototype,"unmuteRemote"),tr.prototype),ht(tr.prototype,"muteLocal",[cl],Object.getOwnPropertyDescriptor(tr.prototype,"muteLocal"),tr.prototype),ht(tr.prototype,"unmuteLocal",[cl],Object.getOwnPropertyDescriptor(tr.prototype,"unmuteLocal"),tr.prototype),ht(tr.prototype,"close",[cl],Object.getOwnPropertyDescriptor(tr.prototype,"close"),tr.prototype),ht(tr.prototype,"updateEncoderConfig",[cl],Object.getOwnPropertyDescriptor(tr.prototype,"updateEncoderConfig"),tr.prototype),ht(tr.prototype,"updateSendParameters",[cl],Object.getOwnPropertyDescriptor(tr.prototype,"updateSendParameters"),tr.prototype),ht(tr.prototype,"replaceTrack",[cl],Object.getOwnPropertyDescriptor(tr.prototype,"replaceTrack"),tr.prototype),ht(tr.prototype,"getRemoteSSRC",[cl],Object.getOwnPropertyDescriptor(tr.prototype,"getRemoteSSRC"),tr.prototype),tr);function cl(e,n,i){const o=e[n];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const c=this.mutex,u=await c.lock("Locking from P2PConnection.".concat(n));try{for(var h=arguments.length,m=new Array(h),_=0;_<h;_++)m[_]=arguments[_];return await o.apply(this,m)}finally{u()}},i}const Cge={name:"PlanBConnection",create:function(e){let{store:n,spec:i}=e;return new Rge(i,n)}},Ige={interceptLocalAudioFrame:async function(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!On().supportWebRTCEncodedTransform)return void k.warning("browser not support audio encoded transform");if(gA.has(e)||!e.track)return;const i={track:e.track};if(Tf()){if(!e.createEncodedStreams)return void k.warning("browser not support createEncodedStreams() API");let c=null;try{c=e.createEncodedStreams()}catch(h){return void k.error("create audio-encoded-streams error",h&&h.message)}const u=new TransformStream({transform(h,m){i.controller||(i.controller=m),e.track&&e.track.id!==i.track.id&&(k.debug("audio track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",o),i.track=e.track,i.track.addEventListener("ended",o));const _=n.metadata&&n.metadata();_?function(y,S){const{chunk:w,controller:I}=S,P=Z("ENABLE_AUDIO_PTS_METADATA")?If.AUDIO_64_BIT_PTS:If.METADATA;w.data=function(B,M,U){const q=U.byteLength,$=q+xL+wz,ae=DL+LL+$,me=new ArrayBuffer(B.byteLength+ae),ge=new DataView(me);ge.setUint8(0,bz),ge.setUint16(1,$),ge.setUint8(3,M),ge.setUint16(4,q);for(let we=0;we<q;we++)ge.setUint8(6+we,U[we]);const pe=new Uint8Array(ge.buffer);return pe.set(new Uint8Array(B),ae),pe.buffer}(w.data,P,y),I.enqueue(w)}(_,{chunk:h,controller:m}):m.enqueue(h)}});c.readable.pipeThrough(u).pipeTo(c.writable)}else if(ls()){if(typeof RTCRtpScriptTransform>"u")return void k.warning("browser not support RTCRtpScriptTransform");const c=mA(),u=new MessageChannel;await new tt(m=>c.onmessage=_=>{_.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"audio-metadata-tx",port:u.port2},[u.port2]);e.transform=h,await new tt(m=>c.onmessage=_=>{_.data==="started"&&m(void 0)}),u.port1.onmessage=m=>{var _;if(m.data.transformed&&e.track&&((_=e.track)===null||_===void 0?void 0:_.id)!==i.track.id)k.debug("audio track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",o),i.track=e.track,i.track.addEventListener("ended",o);else if(m.data.getMetadata){const y=n.metadata&&n.metadata();y&&u.port1.postMessage({metadata:y})}},i.worker=c}function o(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",o)}const c=gA.get(e);if(c){gA.delete(e);try{var u,h;(u=c.controller)===null||u===void 0||u.terminate(),(h=c.worker)===null||h===void 0||h.terminate()}catch(m){k.warning(m&&m.message)}}}gA.set(e,i),e.track.addEventListener("ended",o)},interceptRemoteAudioFrame:async function(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!On().supportWebRTCEncodedTransform)return void k.warning("browser not support audio encoded transform");if(TA.has(e))return;const i={track:e.track,onMetadata:n.onMetadata};if(Tf()){if(!e.createEncodedStreams)return void k.warning("browser not support createEncodedStreams() API");q1(Ln.CHROME,87,116)||(n.enableTopn=!1);let c=null;try{c=e.createEncodedStreams()}catch(h){return void k.error("create audio-encoded-streams error",h&&h.message)}const u=new TransformStream({transform(h,m){i.controller||(i.controller=m),e.track&&e.track.id!==i.track.id&&(k.debug("audio track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",o),i.track=e.track,i.track.addEventListener("ended",o)),n.enableTopn?function(_,y,S){var w;const I=Rz(new DataView(y.data));if(!I)return S.enqueue(y);const P=_.track.id;afe.set(P,_.track);const B=(w=I.tlv.find(me=>me.tag===If.AUDIO_LEVEL))===null||w===void 0?void 0:w.value;let M=0;typeof B=="number"&&(M=127-B);const U=Math.round(Math.pow(10,M/60)-1),{selected:q,speaker:$}=function(me,ge){let pe=lv.get(me);if(pe||(pe=function(we){const Be=new Iz;return lv.set(we,Be),Yu||(Yu=new sfe(Z("TOPN_SILENCE_THRESHOLD")||500),Yu.on("ActiveSpeakerChanged",nt=>{nt!=null&&(yA=nt)})),Yu.addSpeakers([Be]),Be}(me)),lv.size<=Az)return{selected:!0,speaker:pe};if(!Yu)throw new Error("no active speaker detector");return Yu.levelChanged(pe.id,ge),s_=Yu.loudest.map(we=>we.id),yA&&!Xe(s_).call(s_,yA)&&s_.length>=Az&&s_.pop(),{selected:Xe(s_).call(s_,pe.id)||pe.id===yA,speaker:pe}}(_,U),ae=function(me,ge,pe){const we=Xu.get(me)||new ofe(me,ge);return we.score=pe,Xu.set(me,we),function(Be){if(vA.set(Be,!0),!SA)return void(SA=Date.now());const nt=Date.now();nt-SA>1e3&&(vA.get(Be)?vA.set(Be,!1):(Oz(Be),vA.delete(Be)),SA=nt)}(me),we}(P,_.track,$.energyScore);ae.addSample(q),ae.active&&(y.data=I.frame.buffer,S.enqueue(y))}(e,h,m):n.enableMetadata?function(_,y,S){const w=Rz(new DataView(_.data));if(!w)return y.enqueue(_);const I=w.tlv.find(P=>P.tag===If.METADATA||P.tag===If.AUDIO_64_BIT_PTS);I&&S&&I.value instanceof Uint8Array&&S(I.value),_.data=w.frame.buffer,y.enqueue(_)}(h,m,n.onMetadata):m.enqueue(h)}});c.readable.pipeThrough(u).pipeTo(c.writable)}else if(ls()){if(typeof RTCRtpScriptTransform>"u")return void k.warning("browser not support RTCRtpScriptTransform");const c=mA(),u=new MessageChannel;await new tt(m=>c.onmessage=_=>{_.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"audio-metadata-rx",port:u.port2},[u.port2]);e.transform=h,await new tt(m=>c.onmessage=_=>{_.data==="started"&&m(void 0)}),u.port1.onmessage=m=>{var _;m.data.transformed&&e.track&&((_=e.track)===null||_===void 0?void 0:_.id)!==i.track.id?(k.debug("audio track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",o),i.track=e.track,i.track.addEventListener("ended",o)):m.data.metadata&&i.onMetadata&&i.onMetadata(m.data.metadata)},i.worker=c}function o(){e.track.removeEventListener("ended",o),function(c){const u=TA.get(c);if(u){(function(_){const y=lv.get(_);y&&(lv.delete(_),Yu&&(Yu.removeSpeakers([y]),lv.size===0&&(Yu.destroy(),Yu=null)))})(c),Oz(c.track.id),TA.delete(c);try{var h,m;(h=u.controller)===null||h===void 0||h.terminate(),(m=u.worker)===null||m===void 0||m.terminate()}catch(_){k.warning(_&&_.message)}}}(e)}TA.set(e,i),e.track.addEventListener("ended",o)},interceptLocalVideoFrame:async function(e,n){if(!On().supportWebRTCEncodedTransform)return void k.warning("browser not support video encoded transform");if(bA.has(e)||!e.track)return;const i={track:e.track};if(Tf()){if(!e.createEncodedStreams)return void k.warning("browser not support createEncodedStreams() API");let c=null;try{c=e.createEncodedStreams()}catch(m){return void k.error("create video-encoded-streams error",m&&m.message)}const u=[];n.on("sei-to-send",m=>{u.push(m)});const h=new TransformStream({transform(m,_){i.controller||(i.controller=_),e.track&&e.track.id!==i.track.id&&(k.debug("video track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",o),i.track=e.track,i.track.addEventListener("ended",o));const y=u.shift();y&&(m.data=function(S,w){const I=function($){const ae=$.length;let me=[],ge=0;for(;ge<ae;)ge+2<ae&&$[ge]===0&&$[ge+1]===0&&($[ge+2]===0||$[ge+2]===1||$[ge+2]===2||$[ge+2]===3)?(me.push($[ge],$[ge+1],3,$[ge+2]),ge+=3):(me.push($[ge]),ge++);return new Uint8Array(me)}(w),P=I.length,B=Math.floor(P/255),M=P%255,U=new Uint8Array(6+B+1+P+S.byteLength);U[0]=0,U[1]=0,U[2]=0,U[3]=1,U[4]=6,U[5]=101;let q=0;for(;q<B;)U[6+q]=255,q++;return U[6+q]=M,q++,U.set(I,6+q),U.set(new Uint8Array(S),6+q+P),U.buffer}(m.data,y)),_.enqueue(m)}});c.readable.pipeThrough(h).pipeTo(c.writable)}else{if(!ls())return;{if(typeof RTCRtpScriptTransform>"u")return void k.warning("browser not support RTCRtpScriptTransform");const c=mA(),u=new MessageChannel;await new tt(m=>c.onmessage=_=>{_.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"sei-tx",port:u.port2},[u.port2]);e.transform=h,await new tt(m=>c.onmessage=_=>{_.data==="started"&&m(void 0)}),n.on("sei-to-send",m=>{u.port1.postMessage({sei:m})}),u.port1.onmessage=m=>{var _;m.data.transformed&&e.track&&((_=e.track)===null||_===void 0?void 0:_.id)!==i.track.id&&(k.debug("video track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",o),i.track=e.track,i.track.addEventListener("ended",o))},i.worker=c}}function o(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",o)}const c=bA.get(e);if(c){bA.delete(e);try{var u,h;(u=c.controller)===null||u===void 0||u.terminate(),(h=c.worker)===null||h===void 0||h.terminate()}catch(m){k.warning(m&&m.message)}}}bA.set(e,i),e.track.addEventListener("ended",o)},interceptRemoteVideoFrame:async function(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!On().supportWebRTCEncodedTransform)return void k.warning("browser not support video encoded transform");if(!e.track)return;if(j0.has(e)){const c=j0.get(e);return void(c&&(c.onSei=n.onSei))}const i={track:e.track,onSei:n.onSei};if(Tf()){if(!e.createEncodedStreams)return void k.warning("browser not support createEncodedStreams() API");let c=null;try{c=e.createEncodedStreams()}catch(h){return void k.error("create video-encoded-streams error",h&&h.message)}const u=new TransformStream({transform(h,m){i.controller||(i.controller=m),e.track&&e.track.id!==i.track.id&&(k.debug("video track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",o),i.track=e.track,i.track.addEventListener("ended",o));const _=function(y){const S=new DataView(y.data);let w=0;for(;w+4<y.data.byteLength;){if(S.getUint8(w+0)===0&&S.getUint8(w+1)===0&&S.getUint8(w+2)===0&&S.getUint8(w+3)===1&&S.getUint8(w+4)===6){let I=w+6,P=0,B=0;for(;(B=S.getUint8(I++))===255;)P+=255;P+=B;const M=cfe(y.data,I,P);return new Uint8Array(M)}w++}return null}(h);_&&i.onSei&&i.onSei(_),m.enqueue(h)}});c.readable.pipeThrough(u).pipeTo(c.writable)}else if(ls()){if(typeof RTCRtpScriptTransform>"u")return void k.warning("browser not support RTCRtpScriptTransform");const c=mA(),u=new MessageChannel;await new tt(m=>c.onmessage=_=>{_.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"sei-rx",port:u.port2},[u.port2]);e.transform=h,await new tt(m=>c.onmessage=_=>{_.data==="started"&&m(void 0)}),u.port1.onmessage=m=>{var _;m.data.transformed&&e.track&&((_=e.track)===null||_===void 0?void 0:_.id)!==i.track.id?(k.debug("video track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",o),i.track=e.track,i.track.addEventListener("ended",o)):m.data.sei&&i.onSei&&i.onSei(m.data.sei)},i.worker=c}function o(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",o)}(function(c){const u=j0.get(c);if(u){j0.delete(c);try{var h,m;(h=u.controller)===null||h===void 0||h.terminate(),(m=u.worker)===null||m===void 0||m.terminate()}catch(_){k.warning(_&&_.message)}}})(e)}j0.set(e,i),e.track.addEventListener("ended",o)}},Age={name:"InterceptFrame",create:()=>Ige};hL(),qn("PROCESS_ID","process-".concat(rr(8,""),"-").concat(rr(4,""),"-").concat(rr(4,""),"-").concat(rr(4,""),"-").concat(rr(12,""))),function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(n){return void k.error("Error loading sdk config",n.message)}if(e)try{const n=JSON.parse(window.atob(e)),i=Date.now();k.debug("Loading global parameters from cache",n),Object.keys(n).forEach(o=>{if(Object.prototype.hasOwnProperty.call(dr,o)){const{value:c,expires:u}=n[o];if(u&&u<=i)return;$u[o]=c,dr[o]=c}})}catch(n){k.error("Error loading mutableParamsCache: ".concat(e),n.message)}}(),Array.isArray($u.AREAS)&&$u.AREAS.length>0&&rx($u.AREAS,!0);const kK=(e,n,i)=>{k.debug("setParameter key:".concat(e,", value:").concat(JSON.stringify(n))),qn(e,n,i)};sm(Jme,!1),sm(ege,!1),sm(Dpe,!1),sm(dge,!1),sm($me,!1),sm(bge,!1),sm(Cge,!1),sm(Age,!1);const mi=function(e){const n=new Rr,i=e,o={getListeners:n.getListeners.bind(n),on:(c,u)=>(function(h,m){h===$d.SECURITY_POLICY_VIOLATION&&h9(m,!0)}(c,u),n.on.bind(n)(c,u)),addListener:n.addListener.bind(n),once:n.once.bind(n),off:n.off.bind(n),removeAllListeners:n.removeAllListeners.bind(n),emit:n.emit.bind(n),safeEmit:n.safeEmit.bind(n)};return d9(d9({},i),o)}({__TRACK_LIST__:Zy,VERSION:tl,BUILD:mL,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:kK,getParameter:Z,getSupportedCodec:async function(){let e={audio:[],video:[]};try{let n=new RTCPeerConnection;const i=await async function(o){let c;return On().supportUnifiedPlan?(o.addTransceiver("video",{direction:"recvonly"}),o.addTransceiver("audio",{direction:"recvonly"}),c=(await o.createOffer()).sdp):c=(await o.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,c}(n);if(!i)return e;n.close(),n=null,e=function(o){const c={video:[],audio:[]};return o.match(/ VP8/i)&&c.video.push("VP8"),o.match(/ VP9/i)&&c.video.push("VP9"),o.match(/ AV1/i)&&c.video.push("AV1"),o.match(/ H264/i)&&c.video.push("H264"),o.match(/ H265/i)&&c.video.push("H265"),o.match(/ opus/i)&&c.audio.push("OPUS"),o.match(/ PCMU/i)&&c.audio.push("PCMU"),o.match(/ PCMA/i)&&c.audio.push("PCMA"),o.match(/ G722/i)&&c.audio.push("G722"),c}(i)}catch(n){throw new be(Y.CREATE_OFFER_FAILED,n.toString&&n.toString()).print()}return e},checkSystemRequirements:function(){const e=yt.reportApiInvoke(null,{name:fi.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:kr.TRACER});let n=!1;try{const u=window.RTCPeerConnection,h=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,m=window.WebSocket;n=!!(u&&h&&m),n&&J1()&&D6(75)&&new u().close()}catch(u){return k.error("check system requirement failed: ",u),!1}let i=!1;const o=Tn();o.name===Ln.CHROME&&Number(o.version)>=58&&(Ku.engine.name!=="WebKit"||function(){const u=Tn();if(QI()){if(u.os===Ai.MAC_OS)return!0;if(u.os===Ai.IOS){const h=Ku.os.version&&Ku.os.version.split(".");if(h&&Number(h[0])===14&&h[1]&&Number(h[1])>=3||h&&Number(h[0])>14)return!0}}return!1}())&&(i=!0),(o.name===Ln.FIREFOX&&Number(o.version)>=56||o.name===Ln.OPERA&&Number(o.version)>=45||o.name===Ln.SAFARI&&Number(o.version)>=11||o.name==="WebKit"&&(co()||Gl())&&o.osVersion&&Number(o.osVersion.split(".")[0])>=11||F6()||Tn().name===Ln.QQ)&&(i=!0),k.debug("checkSystemRequirements, api:",n,"browser",i);const c=n&&i;return e.onSuccess(c),c},getDevices:function(e){return wc.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return wc.getRecordingDevices(e)},getCameras:function(e){return wc.getCamerasDevices(e)},getElectronScreenSources:DW,getPlaybackDevices:function(e){return wc.getSpeakers(e)},createClient:function(){var e;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const i=rr(5,"client-"),o=yt.reportApiInvoke(null,{id:i,name:fi.CREATE_CLIENT,options:[n],tag:kr.TRACER});try{(function(c){Ti(c.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),Ti(c.mode,"config.mode",["rtc","live","p2p"]),c.audioCodec!==void 0&&Ti(c.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),c.proxyServer!==void 0&&qi(c.proxyServer,"config.proxyServer",1,1e4),c.turnServer!==void 0&&q6(c.turnServer),c.httpRetryConfig!==void 0&&K6(c.httpRetryConfig),c.websocketRetryConfig!==void 0&&K6(c.websocketRetryConfig)})(n)}catch(c){throw o.onError(c),c}return(x6(16,0)||M6(16,0,!0))&&(n.codec==="vp9"&&(n.codec="vp8",k.debug("browser not support vp9, force use vp8")),qn("UNSUPPORTED_VIDEO_CODEC",["vp9"])),n.audioCodec===void 0&&(n.audioCodec="opus"),o.onSuccess(),new Lpe(Jl(Jl({forceWaitGatewayResponse:!0},n),{},{role:Xe(e=["rtc","p2p"]).call(e,n.mode)?"host":n.role||"audience"}),i)},createCameraVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=Z("CAMERA_CAPTURE_CONFIG"),i=rr(8,"track-cam-"),o=yt.reportApiInvoke(null,{id:i,tag:kr.TRACER,name:fi.CREATE_CAM_VIDEO_TRACK,options:[Sr({},e),n]});n&&(e.encoderConfig=n);const c=fA(e);let u=null;k.info("start create camera video track with config",JSON.stringify(e),"trackId",i);try{u=(await bc({video:c},i)).getVideoTracks()[0]||null}catch(m){throw o.onError(m),m}if(!u){const m=new Ce(Y.UNEXPECTED_ERROR,"can not find track in media stream");return o.onError(m),m.throw(k)}e.optimizationMode&&kL(i,u,e,Hd(e.encoderConfig));const h=new NL(u,e,c,e.scalabiltyMode?lA(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,i);return o.onSuccess(h.getTrackId()),k.info("create camera video success, trackId:",i),h},createCustomVideoTrack:function(e){const n=rr(8,"track-cus-"),i=yt.reportApiInvoke(null,{id:n,tag:kr.TRACER,name:fi.CREATE_CUSTOM_VIDEO_TRACK,options:[e]}),o=new hr(e.mediaStreamTrack,{width:e.width,height:e.height,frameRate:e.frameRate,bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?lA(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,n,[ir.CUSTOM_TRACK]);return i.onSuccess(o.getTrackId()),k.info("create custom video track success with config",e,"trackId",o.getTrackId()),o},createScreenVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const i=typeof n=="object"?function(I){return GW(I)}(n):void 0;i&&(n="auto");const o=rr(8,"track-scr-v-"),c=yt.reportApiInvoke(null,{id:o,tag:kr.TRACER,name:fi.CREATE_SCREEN_VIDEO_TRACK,options:[Sr({},e),n]});e.encoderConfig?typeof e.encoderConfig=="string"||e.encoderConfig.width&&e.encoderConfig.height||(e.encoderConfig.width={max:1920},e.encoderConfig.height={max:1080}):e.encoderConfig="1080p_2";const u=function(I){const P={};I.screenSourceType&&(P.mediaSource=I.screenSourceType),I.extensionId&&Tf()&&(P.extensionId=I.extensionId);const{displaySurface:B,selfBrowserSurface:M,surfaceSwitching:U,systemAudio:q,preferCurrentTab:$}=I;(O0(107)||$1(107)||Y1(93))&&(B&&(Ti(B,"displaySurface",["browser","window","monitor"]),P.displaySurface=B),M?(Ti(M,"selfBrowserSurface",["exclude","include"]),P.selfBrowserSurface=M):P.selfBrowserSurface="include",U&&(Ti(U,"surfaceSwitching",["exclude","include"]),P.surfaceSwitching=U)),(O0(105)||$1(105)||Y1(91))&&q&&(Ti(q,"systemAudio",["exclude","include"]),P.systemAudio=q),(O0(94)||$1(94)||Y1(80))&&$&&(P.preferCurrentTab=!0),I.electronScreenSourceId&&(P.sourceId=I.electronScreenSourceId);const ae=I.encoderConfig?vL(I.encoderConfig):null;return P.mandatory={chromeMediaSource:"desktop",maxWidth:ae?ae.width:void 0,maxHeight:ae?ae.height:void 0},ae&&(ae.frameRate&&(typeof ae.frameRate=="number"?(P.mandatory.maxFrameRate=ae.frameRate,P.mandatory.minFrameRate=ae.frameRate):(P.mandatory.maxFrameRate=ae.frameRate.max||ae.frameRate.ideal||ae.frameRate.exact||void 0,P.mandatory.minFrameRate=ae.frameRate.min||ae.frameRate.ideal||ae.frameRate.exact||void 0),P.frameRate=ae.frameRate),ae.width&&(P.width=ae.width),ae.height&&(P.height=ae.height)),P}(e);let h=null,m=null;const _=On();if(!_.supportShareAudio&&n==="enable"){const I=new Ce(Y.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return c.onError(I),I.throw(k)}k.info("start create screen video track with config",e,"withAudio",n,"trackId",o);const y=_.supportShareAudio&&n!=="disable";try{const I=await bc({screen:u,screenAudio:y?i||!0:void 0},o);h=I.getVideoTracks()[0]||null,m=I.getAudioTracks()[0]||null}catch(I){throw c.onError(I),I}if(!h){const I=new Ce(Y.UNEXPECTED_ERROR,"can not find track in media stream");return c.onError(I),I.throw(k)}if(!m&&n==="enable"){h&&h.stop();const I=new Ce(Y.SHARE_AUDIO_NOT_ALLOWED);return c.onError(I),I.throw(k)}e.optimizationMode||(e.optimizationMode="detail"),e.optimizationMode&&(kL(o,h,e,e.encoderConfig&&vL(e.encoderConfig)||void 0),e.encoderConfig&&typeof e.encoderConfig!="string"&&(e.encoderConfig.bitrateMin=e.encoderConfig.bitrateMax));const S=new hr(h,e.encoderConfig?vL(e.encoderConfig):{},e.scalabiltyMode?lA(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,o,[ir.SCREEN_TRACK]);if(!m)return c.onSuccess(S.getTrackId()),k.info("create screen video track success","video:",S.getTrackId()),S;const w=new Vr(m,void 0,rr(8,"track-scr-a-"),!1);return c.onSuccess([S.getTrackId(),w.getTrackId()]),k.info("create screen video track success","video:",S.getTrackId(),"audio:",w.getTrackId()),[S,w]},createMicrophoneAndCameraTracks:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=Z("CAMERA_CAPTURE_CONFIG"),o=rr(8,"track-mic-"),c=rr(8,"track-cam-"),u=yt.reportApiInvoke(null,{id:"".concat(o,"-").concat(c),tag:kr.TRACER,name:fi.CREATE_MIC_AND_CAM_TRACKS,options:[e,n,i]});i&&(n.encoderConfig=i);const h=fA(n),m=zW(e);let _=null,y=null;k.info("start create camera video track(".concat(c,") and microphone audio track(").concat(o,") with config, audio: ").concat(JSON.stringify(e),", video: ").concat(JSON.stringify(n)));try{const I=await bc({audio:m,video:h},"".concat(o,"-").concat(c));_=I.getAudioTracks()[0],y=I.getVideoTracks()[0]}catch(I){throw u.onError(I),I}if(!_||!y){const I=new Ce(Y.UNEXPECTED_ERROR,"can not find tracks in media stream");return u.onError(I),I.throw(k)}n.optimizationMode&&kL(c,y,n,Hd(n.encoderConfig));const S=new pA(_,e,m,o),w=new NL(y,n,h,n.scalabiltyMode?lA(n.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},n.optimizationMode,c);return u.onSuccess([S.getTrackId(),w.getTrackId()]),k.info("create camera video track(".concat(c,") and microphone audio track(").concat(o,") success")),[S,w]},createMicrophoneAudioTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=rr(8,"track-mic-"),i=yt.reportApiInvoke(null,{id:n,tag:kr.TRACER,name:fi.CREATE_MIC_AUDIO_TRACK,options:[e]}),o=zW(e);let c=null;k.info("start create microphone audio track with config",JSON.stringify(e),"trackId",n);try{c=(await bc({audio:o},n)).getAudioTracks()[0]||null}catch(h){throw i.onError(h),h}if(!c){const h=new Ce(Y.UNEXPECTED_ERROR,"can not find track in media stream");return i.onError(h),h.throw(k)}const u=new pA(c,e,o,n);return i.onSuccess(u.getTrackId()),k.info("create microphone audio track success, trackId:",n),u},createCustomAudioTrack:function(e){const n=rr(8,"track-cus-"),i=yt.reportApiInvoke(null,{id:n,tag:kr.TRACER,name:fi.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),o=new Vr(e.mediaStreamTrack,e.encoderConfig?uA(e.encoderConfig):{},n,!1);return k.info("create custom audio track success with config",e,"trackId",o.getTrackId()),i.onSuccess(o.getTrackId()),o},createBufferSourceAudioTrack:async function(e){var n;const{cacheOnlineFile:i,encoderConfig:o}=e;let{source:c}=e;const u={source:c instanceof AudioBuffer?"AudioBuffer":c instanceof File?(n=File.name)!==null&&n!==void 0?n:"File":c,cacheOnlineFile:i,encoderConfig:o},h=rr(8,"track-buf-"),m=yt.reportApiInvoke(null,{id:h,tag:kr.TRACER,name:fi.CREATE_BUFFER_AUDIO_TRACK,options:[u]});if(Z("DISABLE_WEBAUDIO"))throw new Ce(Y.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");k.info("start create buffer source audio track with config",JSON.stringify(u),"trackId",h);const _=c;if(!(c instanceof AudioBuffer))try{c=await async function(w,I){let P=null;if(typeof w=="string"){const M=PG.get(w);if(M)return k.debug("use cached audio resource: ",w),M;try{P=(await qu(()=>Mo.get(w,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(U){throw new Ce(Y.FETCH_AUDIO_FILE_FAILED,U.toString())}}else P=await new tt((U,q)=>{const $=new FileReader;$.onload=ae=>{ae.target?U(ae.target.result):q(new Ce(Y.READ_LOCAL_AUDIO_FILE_ERROR))},$.onerror=()=>{q(new Ce(Y.READ_LOCAL_AUDIO_FILE_ERROR))},$.readAsArrayBuffer(w)});const B=await function(M){const U=sv();return new tt((q,$)=>{U.decodeAudioData(M,ae=>{q(ae)},ae=>{$(new Ce(Y.DECODE_AUDIO_FILE_FAILED,ae.toString()))})})}(P);return typeof w=="string"&&I&&PG.set(w,B),B}(c,i)}catch(w){return m.onError(w),w.throw(k)}const y=new efe(c),S=new Zhe(_,y,o?uA(o):{},h);return k.info("create buffer source audio track success, trackId:",h),m.onSuccess(S.getTrackId()),S},setAppType:function(e){if(k.debug("setAppType: ".concat(e)),!(Number.isInteger(e)&&e>=0))throw k.debug("Invalid appType"),new be(Y.INVALID_PARAMS,"invalid app type",e);qn("APP_TYPE",Math.floor(e))},setLogLevel:function(e){k.setLogLevel(e)},enableLogUpload:function(){Z("USE_NEW_LOG")?qn("UPLOAD_LOG",!0):k.enableLogUpload()},disableLogUpload:function(){Z("USE_NEW_LOG")?qn("UPLOAD_LOG",!1):k.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new PH},checkAudioTrackIsActive:async function(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const i=yt.reportApiInvoke(null,{tag:kr.TRACER,name:fi.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[n]});if(!(e instanceof Vr||e instanceof cv)){const _=new be(Y.INVALID_TRACK,"the parameter is not a audio track");return i.onError(_),_.throw()}n&&n<1e3&&(n=1e3);const o=e instanceof Vr?e.getTrackLabel():"remote_track",c=e.getVolumeLevel();let u=c,h=c;const m=Date.now();return new tt(_=>{const y=setInterval(()=>{const S=e.getVolumeLevel();u=S>u?S:u,h=S<h?S:h;const w=u-h>1e-4,I=Date.now()-m;if(w||I>n){clearInterval(y);const P=w,B={duration:I,deviceLabel:o,maxVolumeLevel:u,result:P};k.info("[track-".concat(e.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(B))),i.onSuccess(B),_(P)}},200)})},checkVideoTrackIsActive:async function(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const i=yt.reportApiInvoke(null,{tag:kr.TRACER,name:fi.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[n]});if(!(e instanceof hr||e instanceof av)){const w=new be(Y.INVALID_TRACK,"the parameter is not a video track");return i.onError(w),w.throw()}n&&n<1e3&&(n=1e3);const o=e instanceof hr?e.getTrackLabel():"remote_track",c=e.getMediaStreamTrack(!0),u=document.createElement("video");u.style.width="1px",u.style.height="1px",u.setAttribute("muted",""),u.muted=!0,u.setAttribute("playsinline",""),u.controls=!1,(ls()||QI())&&(u.style.opacity="0.01",u.style.position="fixed",u.style.left="0",u.style.top="0",document.body.appendChild(u)),u.srcObject=new MediaStream([c]),u.play();const h=document.createElement("canvas");h.width=160,h.height=120;let m=0,_=0;try{const w=Date.now();m=await function(I,P,B,M){let U,q=0,$=null;return new tt((ae,me)=>{function ge(){q>M&&U&&(U(),ae(q));const pe=B.getContext("2d");if(!pe){const nt=new be(Y.UNEXPECTED_ERROR,"can not get canvas 2d context.");return k.error(nt.toString()),void me(nt)}pe.drawImage(I,0,0,160,120);const we=pe.getImageData(0,0,B.width,B.height),Be=Math.floor(we.data.length/3);if($){for(let nt=0;nt<Be;nt+=3)if(we.data[nt]!==$[nt])return q+=1,void($=we.data);$=we.data}else $=we.data}setTimeout(()=>{U&&(U(),ae(q))},P),U=RL(()=>{ge()},30)})}(u,n,h,4),_=Date.now()-w}catch(w){throw i.onError(w),w}ype===Ln.SAFARI&&(u.pause(),u.remove()),u.srcObject=null;const y=m>4,S={duration:_,changedPicNum:m,deviceLabel:o,result:y};return k.info("[track-".concat(e.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(S))),i.onSuccess(S),y},setArea:rx,audioElementPlayCenter:Uo,resumeAudioContext:function(){Uo.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(e){Mpe.processExternalMediaAEC(e)},registerExtensions:function(e){const n=Z("PLUGIN_INFO")||[];e.forEach(i=>{"name"in i&&!Xe(n).call(n,i.name)&&n.push(i.name);const o=i;o.__registered__=!0,o.logger.hookLog=k.extLog,o.reporter.hookApiInvoke=yt.extApiInvoke,o.parameters&&Object.keys(o.parameters).forEach(c=>{o.parameters[c]=Z(c)})}),kK("PLUGIN_INFO",n)},ChannelMediaRelayError:dv,ChannelMediaRelayEvent:Of,ChannelMediaRelayState:ha,RemoteStreamFallbackType:Khe,RemoteStreamType:Hhe,ConnectionDisconnectedReason:Vn,AudienceLatencyLevelType:The,AREAS:xn,preload:async function(e,n,i,o){return r8(e,n,i,o)}});return Object.defineProperties(mi,{onAudioAutoplayFailed:{get:()=>Rc.onAudioAutoplayFailed,set:e=>{Rc.onAudioAutoplayFailed=e}},onAutoplayFailed:{get:()=>Rc.onAutoplayFailed,set:e=>{Rc.onAutoplayFailed=e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>mi._onSecurityPolicyViolation,set(e){mi._onSecurityPolicyViolation=e,h9(e)}},__CLIENT_LIST__:{get:()=>Z("SHOW_GLOBAL_CLIENT_LIST")?o_:[]}}),wc.on(n_.CAMERA_DEVICE_CHANGED,e=>{k.info("camera device changed",JSON.stringify(e)),mi.onCameraChanged&&mi.onCameraChanged(e),mi.safeEmit($d.CAMERA_CHANGED,e)}),wc.on(n_.RECORDING_DEVICE_CHANGED,e=>{k.info("microphone device changed",JSON.stringify(e)),mi.onMicrophoneChanged&&mi.onMicrophoneChanged(e),mi.safeEmit($d.MICROPHONE_CHANGED,e)}),wc.on(n_.PLAYOUT_DEVICE_CHANGED,e=>{k.debug("playout device changed",JSON.stringify(e)),mi.onPlaybackDeviceChanged&&mi.onPlaybackDeviceChanged(e),mi.safeEmit($d.PLAYBACK_DEVICE_CHANGED,e)}),Uo.onAutoplayFailed=()=>{k.info("detect audio element autoplay failed"),Rc.onAudioAutoplayFailed&&Rc.onAudioAutoplayFailed()},$n.on("autoplay-failed",()=>{k.info("detect webaudio autoplay failed"),Rc.onAudioAutoplayFailed&&Rc.onAudioAutoplayFailed(),mi.safeEmit($d.AUTOPLAY_FAILED)}),$n.on(Xi.STATE_CHANGE,(e,n)=>{k.info("audio context state changed: ".concat(n," => ").concat(e)),mi.onAudioContextStateChanged&&mi.onAudioContextStateChanged(e,n),mi.safeEmit($d.AUDIO_CONTEXT_STATE_CHANGED,e,n)}),ri.on(qy.NETWORK_STATE_CHANGE,(e,n)=>{k.info("[network-indicator] network state changed, ".concat(n," => ").concat(e))}),window&&(window.__ARTC__=mi),mi})}(DP)),DP.exports}var Q3e=J3e();const rR=BS(Q3e),Z3e={BASE_URL:"./",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_AGORA_APP_ID:"a2a7f4eb05284449b1063eb71d8301dc"},Bie="a2a7f4eb05284449b1063eb71d8301dc";console.log("AgoraProvider: DEFAULT_AGORA_APP_ID:",Bie);console.log("AgoraProvider: import.meta.env:",Z3e);const e5e=rR.createClient({mode:"rtc",codec:"vp8"});let jb=null;const Wie=V.createContext(null),Gie=({children:r,appId:t=Bie,channel:s=null,token:a=null,uid:l=null,enabled:d=!0,startMuted:p=!0,onClientReady:E=()=>{}})=>{console.log("AgoraProvider: appId prop:",t);const[v,b]=V.useState(!1),[R,O]=V.useState(!1),[N,F]=V.useState([]),[H,z]=V.useState(null),[G,ee]=V.useState(null),[J,re]=V.useState(null),[de,se]=V.useState(!1),[ye,Q]=V.useState(!1),[ne,oe]=V.useState(!1),[ue,Ee]=V.useState(null),fe=V.useRef(e5e),le=V.useRef({appId:t,channel:s,uid:l,enabled:d}),Le=V.useRef(!1),pt=V.useRef(null);V.useRef(null),V.useEffect(()=>{le.current={appId:t,channel:s,uid:l,enabled:d},console.log("AgoraProvider: Updated props ref:",{appId:t,channel:s,uid:l,enabled:d})},[t,s,l,d]),V.useEffect(()=>{console.log("AgoraProvider: Props changed:",{appId:t,channel:s,uid:l,enabled:d}),typeof window<"u"&&!window.agoraClient&&(window.agoraClient={isVoiceEnabled:!1,isJoined:!1,client:fe.current},console.log("AgoraProvider: Initialized window.agoraClient"))},[t,s,l,d]),V.useEffect(()=>{console.log("AgoraProvider: Setting current channel:",s),ee(s)},[s]),V.useEffect(()=>{if(!fe.current)return;const Fe=lt=>{console.log(`Connection state changed to: ${lt}`),lt==="DISCONNECTED"?(b(!1),console.log("Disconnected from Agora")):lt==="CONNECTED"&&(b(!0),z(null))};return fe.current.on("connection-state-change",Fe),()=>{fe.current.off("connection-state-change",Fe)}},[]),V.useEffect(()=>{if(!s||!d){console.log("AgoraProvider: Skipping initialization - channel or enabled is falsy",{channel:s,enabled:d});return}console.log("AgoraProvider: Initial setup for channel",s,"with UID",l);const Fe=async(xt,En)=>{console.log("AgoraProvider: User published:",xt.uid,En);try{await fe.current.subscribe(xt,En),console.log("AgoraProvider: Subscribed to user:",xt.uid,"mediaType:",En),En==="audio"&&(xt.audioTrack.play(),console.log("AgoraProvider: Playing audio track for user:",xt.uid)),F(In=>In.some(hn=>hn.uid===xt.uid)?In:[...In,xt])}catch(In){console.error("AgoraProvider: Error subscribing to user:",In)}},lt=(xt,En)=>{console.log("AgoraProvider: User unpublished:",xt.uid,En),En==="audio"&&xt.audioTrack&&(xt.audioTrack.stop(),console.log("AgoraProvider: Stopped audio track for user:",xt.uid))},Et=xt=>{console.log("AgoraProvider: User joined:",xt.uid),F(En=>En.some(In=>In.uid===xt.uid)?En:[...En,xt])},Nt=xt=>{console.log("AgoraProvider: User left:",xt.uid),F(En=>En.filter(In=>In.uid!==xt.uid))};fe.current.on("user-published",Fe),fe.current.on("user-unpublished",lt),fe.current.on("user-joined",Et),fe.current.on("user-left",Nt);const $t=async()=>{if(Le.current){console.log("AgoraProvider: Already initializing, skipping duplicate initialization");return}Le.current=!0;try{if(v&&pt.current===s){console.log("AgoraProvider: Already joined to channel",s),se(!0),E(fe.current);return}if(fe.current.connectionState==="CONNECTING"||fe.current.connectionState==="CONNECTED")if(console.log("AgoraProvider: Client already in connecting/connected state:",fe.current.connectionState),pt.current&&pt.current!==s){console.log("AgoraProvider: Connected to different channel, leaving first");try{await Ue()}catch(xt){console.error("AgoraProvider: Error leaving channel:",xt)}}else{console.log("AgoraProvider: Client already connected or connecting, setting joined state to true"),b(!0),se(!0),pt.current=s,jb=s,E(fe.current);return}console.log("AgoraProvider: Joining channel",s,"current joined channel:",pt.current),await Oe(),console.log("AgoraProvider: Join channel completed")}catch(xt){console.error("AgoraProvider: Error during initialization:",xt)}finally{Le.current=!1}};return console.log("AgoraProvider: Running initialization"),$t(),()=>{console.log("AgoraProvider: Cleaning up event listeners"),fe.current.off("user-published",Fe),fe.current.off("user-unpublished",lt),fe.current.off("user-joined",Et),fe.current.off("user-left",Nt)}},[s,d,l,E,v]);const et=async()=>{if(!d||J)return J;console.log("Initializing microphone");try{const Fe=await rR.createMicrophoneAudioTrack();return await Fe.setMuted(p),re(Fe),console.log("Microphone initialized successfully"),Fe}catch(Fe){return console.error("Error initializing microphone:",Fe),z("Failed to initialize microphone. Please check your permissions."),null}},Oe=async()=>{if(!d)return console.log("AgoraProvider: Agora is disabled, not joining channel"),!1;if(!s)return console.error("AgoraProvider: No channel specified"),z("No channel specified"),!1;if(console.log("AgoraProvider: joinChannel called for channel",s,"with UID",l),console.log("AgoraProvider: Current state:",{isJoined:v,isJoining:ye,connectionState:fe.current.connectionState,joinedChannel:pt.current}),v&&pt.current===s)return console.log("AgoraProvider: Already joined to channel:",s),!0;if(ye)return console.log("AgoraProvider: Already in the process of joining"),!1;if(fe.current.connectionState==="CONNECTED")if(pt.current&&pt.current!==s){console.log("AgoraProvider: Connected to different channel, leaving first");try{await Ue()}catch(Fe){console.error("AgoraProvider: Error leaving channel:",Fe)}}else return console.log("AgoraProvider: Client already connected, setting joined state to true"),b(!0),se(!0),pt.current=s,jb=s,E(fe.current),!0;if(fe.current.connectionState==="CONNECTING")return console.log("AgoraProvider: Client already connecting, waiting for connection"),Q(!0),new Promise(Fe=>{const lt=setInterval(()=>{fe.current.connectionState==="CONNECTED"&&(clearInterval(lt),b(!0),Q(!1),se(!0),pt.current=s,jb=s,E(fe.current),Fe(!0))},500);setTimeout(()=>{clearInterval(lt),console.log("AgoraProvider: Connection timeout, considering join failed"),Q(!1),Fe(!1)},1e4)});try{if(console.log("AgoraProvider: Joining channel:",s,"with UID:",l||"random"),console.log("AgoraProvider: Using appId:",t,"Type:",typeof t,"Length:",t.length),!t||t.trim()===""){const lt="AgoraProvider: App ID is empty or invalid";return console.error(lt),z(lt),Q(!1),!1}Q(!0);const Fe=l||Math.floor(Math.random()*1e6);return await fe.current.join(t,s,a,Fe),console.log("AgoraProvider: Joined channel successfully with UID:",fe.current.uid),b(!0),Q(!1),se(!0),pt.current=s,jb=s,E(fe.current),!0}catch(Fe){return console.error("AgoraProvider: Error joining channel:",Fe),z(`Error joining channel: ${Fe.toString()}`),Q(!1),!1}},Ue=async()=>{if(v)try{J&&await fe.current.unpublish(J),await fe.current.leave(),jb=null,pt.current=null,console.log("Left channel successfully"),b(!1),F([])}catch(Fe){console.error("Error leaving channel:",Fe),z(Fe.message||"Failed to leave channel")}};V.useEffect(()=>()=>{J&&J.close()},[]),V.useEffect(()=>{d&&s&&(!v||pt.current!==s)&&Oe()},[d,s,v]);const Me=()=>{if(!J)return!1;try{return J.isActive&&!J.muted}catch(Fe){return console.error("Error checking microphone status:",Fe),!1}};V.useEffect(()=>{const Fe=()=>{const Et=Me();Et!==R&&(console.log("Syncing microphone state:",{actualStatus:Et,currentState:R}),O(Et),window.dispatchEvent(new CustomEvent("VoiceToggled",{detail:{enabled:Et}})),window.agoraClient&&(window.agoraClient.isVoiceEnabled=Et,window.agoraClient.microphoneTrack=J))};J&&Fe();const lt=setInterval(Fe,1e3);return()=>{clearInterval(lt)}},[J,R]);const it=async()=>{var Fe;try{const lt=R!==void 0?R:J?!J.muted:!1;if(console.log("AgoraProvider: Toggling voice, current state:",{isVoiceEnabled:R,currentState:lt,hasMicTrack:!!J,trackMuted:J==null?void 0:J.muted}),!J&&(console.log("AgoraProvider: No microphone track, initializing..."),!await et()))return console.error("AgoraProvider: Failed to initialize microphone"),lt;const Et=!lt;if(console.log("AgoraProvider: New voice state will be:",Et),lt){if(J)try{console.log("AgoraProvider: Muting microphone track"),await J.setMuted(!0),J.muted||(console.warn("AgoraProvider: Track not muted after setMuted(true), trying again"),await J.setEnabled(!1)),console.log("AgoraProvider: Microphone track muted successfully, muted state:",J.muted)}catch(Nt){return console.error("Error muting track:",Nt),lt}}else if(J)try{fe.current&&v&&!((Fe=fe.current.localTracks)!=null&&Fe.includes(J))&&(console.log("AgoraProvider: Publishing microphone track"),await fe.current.publish(J),console.log("AgoraProvider: Microphone track published successfully")),console.log("AgoraProvider: Unmuting microphone track"),await J.setMuted(!1),J.muted&&(console.warn("AgoraProvider: Track still muted after setMuted(false), trying again"),await J.setEnabled(!0)),console.log("AgoraProvider: Microphone track unmuted successfully, muted state:",J.muted)}catch(Nt){return console.error("Error unmuting track:",Nt),lt}return O(Et),Et}catch(lt){return console.error("AgoraProvider: Error toggling voice:",lt),R}},Ae=async Fe=>{try{re(Fe),console.log("Microphone track updated successfully")}catch(lt){throw console.error("Error updating microphone track:",lt),lt}},qe=async()=>{if(!fe.current||!s)return console.error("AgoraProvider: Voice chat not connected"),!1;try{if(ne)return console.log("AgoraProvider: Stopping screen share"),ue&&(Array.isArray(ue)?(await fe.current.unpublish(ue),ue.forEach(Fe=>Fe.close())):(await fe.current.unpublish(ue),ue.close()),Ee(null)),oe(!1),console.log("AgoraProvider: Screen sharing stopped"),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isScreenSharing=!1,window.agoraClient.screenTrack=null,window.dispatchEvent(new CustomEvent("ScreenShareToggled",{detail:{enabled:!1}}))),!1;console.log("AgoraProvider: Starting screen share");try{const Fe=await rR.createScreenVideoTrack({encoderConfig:"1080p_1",optimizationMode:"detail"});return console.log("AgoraProvider: Screen track created:",Fe),Fe.on("track-ended",()=>{console.log("AgoraProvider: Screen sharing ended by browser UI"),fe.current.unpublish(Fe),Fe.close(),Ee(null),oe(!1),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isScreenSharing=!1,window.agoraClient.screenTrack=null,window.dispatchEvent(new CustomEvent("ScreenShareToggled",{detail:{enabled:!1}})))}),await fe.current.publish(Fe),Ee(Fe),oe(!0),console.log("AgoraProvider: Screen sharing started"),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isScreenSharing=!0,window.agoraClient.screenTrack=Fe,window.dispatchEvent(new CustomEvent("ScreenShareToggled",{detail:{enabled:!0}}))),!0}catch(Fe){return console.error("AgoraProvider: Error creating screen track:",Fe),oe(!1),Ee(null),!1}}catch(Fe){return console.error("AgoraProvider: Error toggling screen share:",Fe),oe(!1),Ee(null),!1}};V.useEffect(()=>{if(console.log("AgoraProvider: Initializing window.agoraClient"),typeof window<"u"){window.agoraClient={isVoiceEnabled:!1,isJoined:!1,client:fe.current,isScreenSharing:!1,screenTrack:null};const Fe=Et=>{console.log("AgoraProvider: Received ToggleScreenShare event"),qe().then(Nt=>{Et.detail&&Et.detail.callback&&Et.detail.callback(!0,Nt)}).catch(Nt=>{console.error("AgoraProvider: Error handling ToggleScreenShare event:",Nt),Et.detail&&Et.detail.callback&&Et.detail.callback(!1,ne)})},lt=Et=>{console.log("AgoraProvider: Received JoinVoiceChat event"),Oe().then(Nt=>{Et.detail&&Et.detail.callback&&Et.detail.callback(Nt)}).catch(Nt=>{console.error("AgoraProvider: Error handling JoinVoiceChat event:",Nt),Et.detail&&Et.detail.callback&&Et.detail.callback(!1)})};return window.addEventListener("ToggleScreenShare",Fe),window.addEventListener("JoinVoiceChat",lt),()=>{window.removeEventListener("ToggleScreenShare",Fe),window.removeEventListener("JoinVoiceChat",lt),typeof window<"u"&&window.agoraClient&&(console.log("AgoraProvider: Cleaning up window.agoraClient"),window.agoraClient=null)}}return()=>{typeof window<"u"&&window.agoraClient&&(console.log("AgoraProvider: Cleaning up window.agoraClient"),window.agoraClient=null)}},[]),V.useEffect(()=>{console.log("AgoraProvider: Voice enabled state changed:",R),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isVoiceEnabled=R,window.agoraClient.microphoneTrack=J,window.agoraClient.client=fe.current,window.dispatchEvent(new CustomEvent("VoiceToggled",{detail:{enabled:R}})),console.log("AgoraProvider: Updated window.agoraClient and dispatched event:",{isVoiceEnabled:R}))},[R,J]);const Ze={client:fe.current,isJoined:v,isVoiceEnabled:R,users:N,error:H,channel:G,appId:t,toggleVoice:it,leaveChannel:Ue,joinChannel:Oe,microphoneTrack:J,isReady:de,createMicrophoneTrack:Ae,isScreenSharing:ne,screenTrack:ue,toggleScreenShare:qe};return D.jsx(Wie.Provider,{value:Ze,children:r})},zie=()=>{const r=V.useContext(Wie);if(!r)throw new Error("useAgoraContext must be used within an AgoraProvider");return r};Gie.propTypes={children:xr.node.isRequired,appId:xr.string.isRequired,channel:xr.string.isRequired,token:xr.string,uid:xr.oneOfType([xr.string,xr.number])};const t5e=()=>{var Le,pt;const{client:r,isVoiceEnabled:t,isJoined:s,users:a,error:l,microphoneTrack:d,isReady:p,channel:E,appId:v,toggleVoice:b,joinChannel:R,leaveChannel:O,createMicrophoneTrack:N,isScreenSharing:F,screenTrack:H,toggleScreenShare:z}=zie(),[G,ee]=V.useState(t!==void 0?t:((Le=window.agoraClient)==null?void 0:Le.isVoiceEnabled)||!1),[J,re]=V.useState(F!==void 0?F:((pt=window.agoraClient)==null?void 0:pt.isScreenSharing)||!1),[de,se]=V.useState(!0);V.useEffect(()=>{var et;t!==void 0?ee(t):((et=window.agoraClient)==null?void 0:et.isVoiceEnabled)!==void 0?ee(window.agoraClient.isVoiceEnabled):d&&ee(!d.muted)},[t,d]),V.useEffect(()=>{var et;F!==void 0?re(F):((et=window.agoraClient)==null?void 0:et.isScreenSharing)!==void 0&&re(window.agoraClient.isScreenSharing)},[F]);const ye=V.useRef({isVoiceEnabled:G,isScreenSharing:J,isJoined:s,users:a,error:l,isReady:p,channel:E,appId:v});V.useEffect(()=>{ye.current={isVoiceEnabled:G,isScreenSharing:J,isJoined:s,users:a,error:l,isReady:p,channel:E,appId:v}},[G,J,s,a,l,p,E,v]),V.useEffect(()=>{const et=setTimeout(()=>{se(!1)},5e3);return()=>clearTimeout(et)},[]),V.useEffect(()=>{p&&se(!1)},[p]),V.useEffect(()=>{console.log("useVoiceChat context:",{contextIsVoiceEnabled:t,localVoiceEnabled:G,contextIsScreenSharing:F,localScreenSharing:J,isJoined:s,users:a.length,error:l,isReady:p,channel:E,appId:v,hasMicrophoneTrack:!!d,trackMuted:d==null?void 0:d.muted,hasScreenTrack:!!H})},[t,G,F,J,s,a,l,p,E,v,d,H]);const Q=async()=>{try{console.log("useVoiceChat: Toggling voice from:",G);const et=await b();if(console.log("useVoiceChat: Toggle result:",et),et!==void 0)ee(et);else{const Oe=!G;ee(Oe),window.agoraClient&&(window.agoraClient.isVoiceEnabled=Oe)}return et!==void 0?et:!G}catch(et){return console.error("useVoiceChat: Error toggling voice:",et),G}},ne=async()=>{try{console.log("useVoiceChat: Toggling screen share from:",J);const et=await z();if(console.log("useVoiceChat: Screen share toggle result:",et),et!==void 0)re(et);else{const Oe=!J;re(Oe),window.agoraClient&&(window.agoraClient.isScreenSharing=Oe)}return et!==void 0?et:!J}catch(et){return console.error("useVoiceChat: Error toggling screen share:",et),J}},oe=async()=>{G&&d&&await Q()},ue=async()=>{!G&&d&&await Q()},Ee=et=>a.some(Oe=>{var Ue;return Oe.uid===et&&((Ue=Oe.audioTrack)==null?void 0:Ue.isPlaying)}),fe=V.useCallback(()=>{if(!d||!G)return 0;try{return d.getVolumeLevel()}catch(et){return console.error("Error getting volume level:",et),0}},[d,G]);return{isVoiceEnabled:G,isScreenSharing:J,isJoined:s,users:a,error:l,toggleVoice:Q,toggleScreenShare:ne,mute:oe,unmute:ue,isUserSpeaking:Ee,getVolumeLevel:fe,microphoneTrack:d,screenTrack:H,isLoading:de,channel:E,appId:v,joinChannel:R,leaveChannel:O,client:r,setMicrophoneDevice:async et=>{try{if(!et){console.error("No device ID provided");return}if(!r||!s){console.error("Client not initialized or not joined to a channel");return}d&&(G&&await r.unpublish(d),await d.close());const Oe=await rR.createMicrophoneAudioTrack({microphoneId:et,encoderConfig:"music_standard"});N&&await N(Oe),G&&await r.publish(Oe),console.log("Microphone device changed successfully")}catch(Oe){throw console.error("Error changing microphone device:",Oe),Oe}}}},n5e=({size:r="md",tooltipPlacement:t="top",defaultMuted:s=!0,joinOnClick:a=!0,className:l="voice-button"})=>{const{isVoiceEnabled:d,toggleVoice:p,isJoined:E,joinChannel:v,channel:b,client:R}=t5e(),[O,N]=V.useState(!1),[F,H]=V.useState(!1);V.useEffect(()=>{const ee=()=>{Rt.log("VoiceButton: Player instantiated, showing button"),H(!0)};return window.addEventListener("PlayerInstantiated",ee),window.isPlayerInstantiated&&(Rt.log("VoiceButton: Player was already instantiated"),H(!0)),()=>{window.removeEventListener("PlayerInstantiated",ee)}},[]),V.useEffect(()=>{console.log("VoiceButton: State:",{isVoiceEnabled:d,isJoined:E,channel:b,hasClient:!!R,clientState:R==null?void 0:R.connectionState,windowAgoraClient:window.agoraClient,isPlayerReady:F})},[d,E,b,R,F]);const z=async()=>{if(!O){N(!0),console.log("VoiceButton: Handling click, current state:",{isVoiceEnabled:d,isJoined:E});try{if(!E&&a)try{console.log("VoiceButton: Not joined, attempting to join channel"),await v(),console.log("VoiceButton: Joined channel successfully")}catch(J){J.message&&J.message.includes("already in connecting/connected state")?console.log("VoiceButton: Already connected to channel"):console.error("VoiceButton: Error joining channel:",J)}console.log("VoiceButton: Toggling voice state from:",d);const ee=await p();console.log("VoiceButton: Voice toggled, new state:",ee)}catch(ee){console.error("VoiceButton: Error toggling voice:",ee)}finally{N(!1)}}},G=()=>F?O?"Processing...":E?d?"Turn microphone off":"Turn microphone on":"Connecting to voice chat...":"Waiting for player to be ready...";return F?D.jsx(SR,{label:G(),placement:t,hasArrow:!0,children:D.jsxs(Gt,{position:"relative",cursor:"pointer",onClick:z,children:[D.jsx(Oh,{size:r,borderRadius:"full",bg:d?"green.500":"red.500",icon:d?D.jsx(QU,{color:"white"}):D.jsx(JU,{color:"white"}),borderWidth:"1px",borderColor:"whiteAlpha.300",className:l,"data-testid":"voice-button"}),O&&D.jsx(Gt,{position:"absolute",top:"0",left:"0",right:"0",bottom:"0",display:"flex",alignItems:"center",justifyContent:"center",bg:"rgba(0, 0, 0, 0.6)",borderRadius:"full",children:D.jsx($S,{size:"sm",color:"white"})})]})}):null},r5e=Zr.createContext({user:null}),i5e=({userNickname:r})=>{const{client:t,channel:s,screenTrack:a,isScreenSharing:l,toggleScreenShare:d}=zie(),[p,E]=V.useState([]),[v,b]=V.useState(!1),[R,O]=V.useState(!0);V.useRef({});const N=V.useRef(null);V.useRef(null);const{user:F}=V.useContext(r5e)||{user:null},[H,z]=V.useState({}),G=V.useRef(a),[ee,J]=V.useState(null),{isOpen:re,onOpen:de,onClose:se}=WS(),[ye,Q]=V.useState(!1),ne=V.useRef(null),oe=V.useRef(null);V.useEffect(()=>{G.current=a},[a]),V.useEffect(()=>{if(!t||!s){b(!1);return}const Le=setTimeout(()=>{O(!1)},5e3);console.log("Setting up screen share display with existing client:",t),console.log("Current channel:",s);const pt=t.connectionState;if(console.log("Current connection state:",pt),pt==="CONNECTED")b(!0),O(!1);else{b(!1);const et=Oe=>{console.log("Connection state changed:",Oe),Oe==="CONNECTED"?(b(!0),O(!1)):b(!1)};return t.on("connection-state-change",et),()=>{t.off("connection-state-change",et),clearTimeout(Le)}}return()=>{clearTimeout(Le)}},[t,s]),V.useEffect(()=>{const Le=async()=>{const pt={...H};let et=!1;for(const Oe of p){if(H[Oe.uid])continue;let Ue=null,Me=Oe.uid;if(typeof Me=="string"&&(Me.includes("-")?(Ue=Me.split("-")[0],Me=Me.split("-")[1]):Me.includes("_")&&(Ue=Me.split("_")[0],Me=Me.split("_")[1])),Me)try{console.log("Trying to fetch nickname for user ID:",Me);const it=await $m(Me);it&&it.Nickname?(console.log("Found nickname in Firebase for user ID:",Me,"Nickname:",it.Nickname),pt[Oe.uid]=it.Nickname,et=!0):Ue?(console.log("Using extracted name for user ID:",Me,"Name:",Ue),pt[Oe.uid]=Ue,et=!0):(pt[Oe.uid]="User",et=!0)}catch(it){console.error("Error fetching user profile:",it),Ue?(pt[Oe.uid]=Ue,et=!0):(pt[Oe.uid]="User",et=!0)}else Ue?(pt[Oe.uid]=Ue,et=!0):(pt[Oe.uid]="User",et=!0)}et&&z(pt)};p.length>0&&Le()},[p,H]),V.useEffect(()=>{if(!t||!s||!v)return;console.log("Setting up screen share event handlers");const Le=async(Oe,Ue)=>{if(console.log("User published:",Oe.uid,Ue,Oe),Ue==="video"){console.log("Remote video track detected:",Oe.uid);try{await t.subscribe(Oe,Ue),console.log("Subscribed to remote video track:",Oe.uid),E(Me=>Me.some(it=>it.uid===Oe.uid)?Me:[...Me,Oe])}catch(Me){console.error("Error subscribing to remote video track:",Me)}}},pt=(Oe,Ue)=>{if(console.log("User unpublished:",Oe.uid,Ue),Ue==="video"){if(console.log("Remote video track unpublished:",Oe.uid),Oe.videoTrack)try{Oe.videoTrack.stop()}catch(Me){console.error("Error stopping video track:",Me)}if(E(Me=>Me.filter(it=>it.uid!==Oe.uid)),l&&G.current&&N.current)try{console.log("Ensuring local screen track is still playing after remote user unpublished"),G.current.play(N.current)}catch(Me){console.error("Error replaying local screen track:",Me)}}},et=Oe=>{console.log("User left:",Oe.uid);const Ue=p.find(Me=>Me.uid===Oe.uid);if(Ue&&Ue.videoTrack)try{Ue.videoTrack.stop()}catch(Me){console.error("Error stopping video track:",Me)}if(E(Me=>Me.filter(it=>it.uid!==Oe.uid)),l&&G.current&&N.current)try{console.log("Ensuring local screen track is still playing after remote user left"),G.current.play(N.current)}catch(Me){console.error("Error replaying local screen track:",Me)}};return t.on("user-published",Le),t.on("user-unpublished",pt),t.on("user-left",et),()=>{t.off("user-published",Le),t.off("user-unpublished",pt),t.off("user-left",et)}},[t,s,v,p,l]),V.useEffect(()=>{if(console.log("Remote screens changed:",p.length,p),p.forEach(Le=>{if(Le.videoTrack)try{console.log("Playing video track for:",Le.uid),Le.videoTrack.play(`video-container-${Le.uid}`)}catch(pt){console.error("Error playing video track:",pt)}}),l&&G.current&&N.current)try{console.log("Ensuring local screen track is still playing after remote screens changed"),G.current.play(N.current)}catch(Le){console.error("Error replaying local screen track:",Le)}},[p,l]),V.useEffect(()=>{if(console.log("Local screen sharing state changed:",l,a),l&&a&&N.current)try{console.log("Playing local screen track"),a.play(N.current)}catch(Le){console.error("Error playing local screen track:",Le)}},[l,a]),V.useEffect(()=>()=>{if(p.forEach(Le=>{if(Le.videoTrack)try{Le.videoTrack.stop()}catch(pt){console.error("Error stopping video track on unmount:",pt)}}),a)try{a.stop()}catch(Le){console.error("Error stopping local screen track on unmount:",Le)}},[p,a]);const ue=()=>{console.log("Stopping local screen share"),d()},Ee=Le=>(console.log("Getting display name for UID:",Le,"type:",typeof Le),l&&F&&(Le===F.uid||Le===(t==null?void 0:t.uid))?r||"You":H[Le]?H[Le]:typeof Le=="string"?Le.includes("-")?Le.split("-")[0]:Le.includes("_")?Le.split("_")[0]:Le:"User"),fe=Le=>{console.log("Opening modal for remote screen",Le),J(Le),de()},le=()=>{console.log("Opening modal for local screen"),J({isLocal:!0}),de()};return V.useEffect(()=>{re&&ee?(console.log("Modal opened, activeScreen:",ee),setTimeout(()=>{if(ee.isLocal&&G.current)try{console.log("Playing local screen in modal"),G.current.play("modal-screen-container"),Q(!0)}catch(Le){console.error("Error playing local screen in modal:",Le)}else if(ee.videoTrack)try{console.log("Playing remote screen in modal"),ee.videoTrack.play("modal-screen-container"),Q(!0)}catch(Le){console.error("Error playing remote screen in modal:",Le)}},500)):re||(Q(!1),J(null),setTimeout(()=>{if(l&&G.current)try{G.current.play("local-screen-container")}catch(Le){console.error("Error playing local screen in small container:",Le)}p.forEach(Le=>{if(Le.videoTrack)try{Le.videoTrack.play(`video-container-${Le.uid}`)}catch(pt){console.error(`Error playing remote screen ${Le.uid} in small container:`,pt)}})},500))},[re,ee,l,p]),!v||R&&p.length===0&&!l||p.length===0&&!l?null:D.jsxs(D.Fragment,{children:[!re&&D.jsxs(Gt,{position:"fixed",top:"20px",left:"20px",zIndex:1e4,overflow:"visible",ref:ne,children:[l&&a&&D.jsxs(Gt,{position:"relative",mb:4,borderRadius:"md",overflow:"hidden",boxShadow:"xl",bg:"black",width:"200px",height:"120px",cursor:"pointer",transition:"all 0.2s",_hover:{filter:"brightness(0.8)",transform:"scale(1.05)"},onClick:le,children:[D.jsx(Gt,{id:"local-screen-container",width:"100%",height:"100%",position:"relative"}),D.jsx(Gt,{position:"absolute",bottom:2,left:2,color:"white",fontSize:"xs",bg:"rgba(0,0,0,0.5)",px:2,py:1,borderRadius:"md",zIndex:5,children:r?`${r}'s Screen`:"Your Screen"})]}),p.map(Le=>{const pt=H[Le.uid]||Ee(Le.uid);return D.jsxs(Gt,{position:"relative",mb:4,borderRadius:"md",overflow:"hidden",boxShadow:"xl",bg:"black",width:"200px",height:"120px",cursor:"pointer",transition:"all 0.2s",_hover:{filter:"brightness(0.8)",transform:"scale(1.05)"},onClick:()=>fe(Le),children:[D.jsx(Gt,{id:`video-container-${Le.uid}`,width:"100%",height:"100%",position:"relative"}),D.jsx(Gt,{position:"absolute",bottom:2,left:2,color:"white",fontSize:"xs",bg:"rgba(0,0,0,0.5)",px:2,py:1,borderRadius:"md",zIndex:5,children:`${pt}'s Screen`})]},Le.uid)})]}),re&&D.jsx(Gt,{position:"fixed",top:"0",left:"0",width:"100vw",height:"100vh",bg:"rgba(0,0,0,0.8)",zIndex:1e4,display:"flex",justifyContent:"center",alignItems:"center",onClick:se,children:D.jsxs(Gt,{width:"80vw",height:"80vh",bg:"black",borderRadius:"md",overflow:"hidden",position:"relative",onClick:Le=>Le.stopPropagation(),children:[!ye&&D.jsxs(Gt,{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:"white",textAlign:"center",children:[D.jsx($S,{size:"xl"}),D.jsx(gn,{mt:4,children:"Loading screen share..."})]}),D.jsx(Gt,{id:"modal-screen-container",width:"100%",height:"100%",position:"relative",ref:oe}),D.jsx(Gt,{position:"absolute",top:2,right:2,color:"white",bg:"rgba(0,0,0,0.5)",borderRadius:"full",width:"30px",height:"30px",display:"flex",justifyContent:"center",alignItems:"center",cursor:"pointer",onClick:se,children:""}),D.jsx(Gt,{position:"absolute",bottom:4,left:4,color:"white",fontSize:"sm",bg:"rgba(0,0,0,0.5)",px:3,py:2,borderRadius:"md",children:ee!=null&&ee.isLocal?r?`${r}'s Screen`:"Your Screen":`${H[ee==null?void 0:ee.uid]||Ee(ee==null?void 0:ee.uid)}'s Screen`}),(ee==null?void 0:ee.isLocal)&&D.jsx(Gt,{position:"absolute",bottom:4,right:4,children:D.jsx(qa,{colorScheme:"red",size:"sm",onClick:ue,children:"Stop Sharing"})})]})})]})},s5e=({onClose:r})=>{const t=QS(),[s,a]=V.useState(!1),[l,d]=V.useState(!1);V.useEffect(()=>{const v=()=>{window.agoraClient&&d(!!window.agoraClient.isScreenSharing)};v();const b=setInterval(v,1e3),R=()=>{v()};return window.addEventListener("ScreenShareToggled",R),()=>{clearInterval(b),window.removeEventListener("ScreenShareToggled",R)}},[]);const p=async v=>{if(v.preventDefault(),v.stopPropagation(),r&&r(),!window.agoraClient||!window.agoraClient.client){t({title:"Screen sharing not available",description:"Voice chat must be connected to use screen sharing",status:"warning",duration:3e3,isClosable:!0});return}try{if(a(!0),window.agoraClient.isJoined)E();else{console.log("ScreenShareMenuOption: Not joined to voice chat, joining automatically");const b=new CustomEvent("JoinVoiceChat",{detail:{callback:R=>{if(!R){console.error("ScreenShareMenuOption: Failed to join voice chat"),t({title:"Connection failed",description:"Could not connect to voice chat",status:"error",duration:3e3,isClosable:!0}),a(!1);return}E()}}});window.dispatchEvent(b)}}catch(b){console.error("Error in screen share handler:",b),a(!1),t({title:"Screen sharing error",description:b.message||"Failed to toggle screen sharing",status:"error",duration:5e3,isClosable:!0})}},E=async()=>{try{const v=new CustomEvent("ToggleScreenShare",{detail:{callback:(b,R)=>{a(!1),b?(d(R),t(R?{title:"Screen sharing started",status:"success",duration:3e3,isClosable:!0}:{title:"Screen sharing stopped",status:"info",duration:3e3,isClosable:!0})):t({title:"Screen sharing error",description:"Failed to toggle screen sharing",status:"error",duration:5e3,isClosable:!0})}}});window.dispatchEvent(v)}catch(v){console.error("Error toggling screen share:",v),a(!1),t({title:"Screen sharing error",description:v.message||"Failed to toggle screen sharing",status:"error",duration:5e3,isClosable:!0})}};return D.jsx(gn,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:p,color:l?"red.300":"white",children:s?"Connecting...":l?"Stop Screen Sharing":"Share Screen"})};function o5e({open:r,onClose:t}){return D.jsxs(xh,{isOpen:r,onClose:t,size:"lg",isCentered:!0,children:[D.jsx(Fh,{}),D.jsxs(Mh,{bg:"gray.900",color:"white",borderRadius:"lg",children:[D.jsx(cp,{children:"Controls"}),D.jsx(Vh,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",_hover:{bg:"gray.600"},_focus:{boxShadow:"none"}}),D.jsx(Uh,{children:D.jsxs(Us,{spacing:4,children:[D.jsxs(Gt,{bg:"gray.800",p:4,borderRadius:"md",textAlign:"center",children:[D.jsx(gn,{fontSize:"xl",fontWeight:"bold",children:"Getting Started"}),D.jsxs(Gt,{mt:2,children:[D.jsx(gn,{children:"WASD to move"}),D.jsx(gn,{children:"Shift to run"}),D.jsx(gn,{children:"Spacebar to jump/double jump"}),D.jsx(gn,{children:"Click to move around"})]})]}),D.jsxs(Gt,{bg:"gray.800",p:4,borderRadius:"md",textAlign:"center",children:[D.jsx(gn,{fontSize:"xl",fontWeight:"bold",children:"Camera Movements"}),D.jsx(Gt,{mt:2,children:D.jsx(gn,{children:"Click & drag to rotate camera"})})]}),D.jsxs(Gt,{bg:"gray.800",p:4,borderRadius:"md",textAlign:"center",children:[D.jsx(gn,{fontSize:"xl",fontWeight:"bold",children:"##########"}),D.jsx(Gt,{mt:2,children:D.jsx(gn,{children:"Type something here"})})]})]})})]})]})}const a5e=()=>{const[r,t]=V.useState([]),[s,a]=V.useState(""),[l,d]=V.useState(0),[p,E]=V.useState(100),[v,b]=V.useState(100),[R,O]=V.useState(!0),[N,F]=V.useState(!0),[H,z]=V.useState(!1);V.useEffect(()=>{(async()=>{try{await navigator.mediaDevices.getUserMedia({audio:!0});const se=await rR.getMicrophones();t(se),se.length>0&&a(se[0].deviceId)}catch(se){console.error("Error getting audio devices:",se)}})()},[]),V.useEffect(()=>{const de=setInterval(()=>{d(H?Math.random()*50:0)},100);return()=>clearInterval(de)},[H]);const G=de=>{const se=de.target.value;a(se),console.log("Microphone changed to:",se)},ee=de=>{E(de),console.log("Microphone volume set to:",de)},J=de=>{b(de),console.log("Speaker volume set to:",de)},re=()=>{z(!H)};return D.jsxs(Us,{spacing:6,align:"stretch",children:[D.jsxs(gs,{children:[D.jsxs(ou,{children:["Microphone",D.jsx(tee,{ml:2,colorScheme:H?"green":"red",children:H?"Enabled":"Muted"})]}),D.jsxs(vte,{value:s,onChange:G,bg:"gray.700",borderColor:"gray.600",_hover:{borderColor:"gray.500"},children:[r.map(de=>D.jsx("option",{value:de.deviceId,children:de.label||`Microphone ${de.deviceId.slice(0,5)}...`},de.deviceId)),r.length===0&&D.jsx("option",{value:"",children:"No microphones found"})]})]}),D.jsxs(Gt,{children:[D.jsx(gn,{mb:2,children:"Microphone Level"}),D.jsx(PF,{value:l,colorScheme:"green",size:"sm",borderRadius:"md",hasStripe:l>20,isAnimated:l>20})]}),D.jsxs(gs,{children:[D.jsxs(ou,{children:["Microphone Volume: ",p,"%"]}),D.jsxs(mU,{value:p,onChange:ee,min:0,max:100,step:1,colorScheme:"blue",children:[D.jsx(_U,{bg:"gray.700",children:D.jsx(EU,{})}),D.jsx(gU,{boxSize:6})]})]}),D.jsxs(gs,{children:[D.jsxs(ou,{children:["Speaker Volume: ",v,"%"]}),D.jsxs(mU,{value:v,onChange:J,min:0,max:100,step:1,colorScheme:"blue",children:[D.jsx(_U,{bg:"gray.700",children:D.jsx(EU,{})}),D.jsx(gU,{boxSize:6})]})]}),D.jsxs(gs,{display:"flex",alignItems:"center",children:[D.jsx(ou,{mb:"0",children:"Microphone Enabled"}),D.jsx(yP,{isChecked:H,onChange:re,colorScheme:"green",size:"lg"})]}),D.jsxs(gs,{display:"flex",alignItems:"center",children:[D.jsx(ou,{mb:"0",children:"Echo Cancellation"}),D.jsx(yP,{isChecked:R,onChange:()=>O(!R),colorScheme:"green",size:"lg"})]}),D.jsxs(gs,{display:"flex",alignItems:"center",children:[D.jsx(ou,{mb:"0",children:"Noise Suppression"}),D.jsx(yP,{isChecked:N,onChange:()=>F(!N),colorScheme:"green",size:"lg"})]}),D.jsxs(UN,{status:"info",borderRadius:"md",children:[D.jsx(VN,{}),"Note: These settings will be applied when you join a voice chat."]})]})};function c5e({open:r,onClose:t,containerRef:s}){return D.jsx(pu,{containerRef:s,children:D.jsxs(xh,{isOpen:r,onClose:t,size:"lg",isCentered:!0,children:[D.jsx(Fh,{}),D.jsxs(Mh,{bg:"gray.900",color:"white",borderRadius:"lg",children:[D.jsx(cp,{children:"Settings"}),D.jsx(Vh,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",_hover:{bg:"gray.600"},_focus:{boxShadow:"none"}}),D.jsx(Uh,{children:D.jsxs(Cte,{variant:"enclosed",children:[D.jsxs(Ite,{mb:4,children:[D.jsx(yU,{_selected:{color:"white",borderBottom:"2px solid white"},children:"Audio"}),D.jsx(yU,{_selected:{color:"white",borderBottom:"2px solid white"},children:"Graphics"})]}),D.jsxs(Ate,{children:[D.jsx(vU,{children:D.jsx(Gt,{p:4,bg:"gray.800",borderRadius:"md",children:D.jsx(a5e,{})})}),D.jsx(vU,{children:D.jsx(Gt,{p:4,bg:"gray.800",borderRadius:"md",children:"Graphics settings content goes here."})})]})]})})]})]})})}const l5e=({onTogglePlayerList:r,spaceID:t})=>{const{fullscreenRef:s}=up(),[a,l]=V.useState(!0),[d,p]=V.useState(!1),[E,v]=V.useState(!1),[b,R]=V.useState(!1),[O,N]=V.useState(!1),[F,H]=V.useState(null),{user:z}=V.useContext(Ra),G=(z==null?void 0:z.Nickname)||"Unknown",ee=async()=>{if(z!=null&&z.uid)try{const Q=await $m(z.uid);H({rpmURL:Q.rpmURL?Q.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null})}catch(Q){console.error("Error fetching profile data:",Q)}};V.useEffect(()=>{ee()},[z==null?void 0:z.uid]),V.useEffect(()=>{const Q=()=>{l(!0)};return window.addEventListener("PlayerInstantiated",Q),()=>{window.removeEventListener("PlayerInstantiated",Q)}},[]);const J=()=>v(!E),re=()=>R(!b),de=()=>{N(!1),ee()},se=Q=>{Q.stopPropagation(),typeof r=="function"&&(Rt.log("CanvasMainMenu: Toggling player list"),r())},ye=()=>{p(!1)};return D.jsxs(D.Fragment,{children:[D.jsxs(IF,{isOpen:d,onClose:()=>p(!1),children:[D.jsx(AF,{as:dl,icon:D.jsx(GBe,{}),"aria-label":"Main menu",variant:"ghost",color:"white",bg:d?"whiteAlpha.400":"whiteAlpha.200",_hover:{bg:d?"whiteAlpha.500":"whiteAlpha.300"},size:"md",onClick:()=>p(!d)}),D.jsx(pu,{containerRef:s,children:D.jsx(OF,{bg:"rgba(0,0,0,0.4)",backdropFilter:"blur(10px)",border:"none",boxShadow:"lg",color:"white",width:"300px",p:4,borderRadius:"xl",zIndex:9999,transform:"none !important",children:D.jsxs(Us,{align:"stretch",spacing:4,children:[D.jsxs(NS,{children:[D.jsx(Oh,{size:"md",src:F==null?void 0:F.rpmURL,bg:"white",name:" ",borderWidth:"1px",borderColor:"whiteAlpha.300"}),D.jsxs(Us,{align:"start",spacing:0,children:[D.jsx(gn,{fontWeight:"bold",children:G}),D.jsx(gn,{fontSize:"sm",color:"whiteAlpha.800",children:"Spaces Metaverse"})]})]}),D.jsxs(NS,{spacing:4,justify:"center",children:[D.jsx(dl,{icon:D.jsx(j3e,{}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"People",_hover:{bg:"whiteAlpha.200"},onClick:se}),D.jsx(dl,{icon:D.jsx(Gt,{w:"4",h:"4"}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"Action 3",_hover:{bg:"whiteAlpha.200"}}),D.jsx(dl,{icon:D.jsx(Gt,{w:"4",h:"4"}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"Action 4",_hover:{bg:"whiteAlpha.200"}})]}),D.jsx(Fw,{borderColor:"whiteAlpha.300"}),D.jsxs(Us,{align:"stretch",spacing:2,children:[z&&t&&D.jsx(s5e,{onClose:ye}),D.jsx(gn,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:J,children:"Settings"}),D.jsx(gn,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:re,children:"Controls"}),D.jsx(gn,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",children:"Help"}),D.jsx(gn,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",color:"red.300",children:"Leave"})]})]})})})]}),b&&D.jsx(o5e,{open:b,onClose:re}),E&&D.jsx(c5e,{open:E,onClose:J}),O&&D.jsx(Vie,{open:O,onClose:de})]})},u5e="a2a7f4eb05284449b1063eb71d8301dc",Fj=V.forwardRef(({settings:r},t)=>{const{unityProvider:s,isLoaded:a}=iT(),l=A3e();P3e();const d=wk(),p=D3e(l),{user:E}=V.useContext(Ra),[v,b]=V.useState(!1),[R,O]=V.useState(window.devicePixelRatio),[N,F]=k3e();Die().find(le=>le.isLocalPlayer);const[z,G]=V.useState(!0),[ee,J]=V.useState(!0),[re,de]=V.useState(!1),se=r.spaceID||"default",ye=V.useMemo(()=>{const pt=new URLSearchParams(window.location.search).get("sessionId")||se;return console.log("WebGLRenderer: Using session ID:",pt),pt},[se]),[Q,ne]=V.useState(null);V.useEffect(()=>{E!=null&&E.uid&&$m(E.uid).then(le=>{ne(le),console.log("WebGLRenderer: User profile loaded:",(le==null?void 0:le.Nickname)||"Unknown")}).catch(le=>{console.error("Error fetching user profile:",le)})},[E==null?void 0:E.uid]),V.useEffect(()=>{console.log("WebGLRenderer: Setting up player instantiation listener");const le=()=>{console.log("WebGLRenderer: Player instantiated event received"),J(!0),window.dispatchEvent(new CustomEvent("PlayerInstantiated")),window.isPlayerInstantiated=!0};window.isPlayerInstantiated&&(console.log("WebGLRenderer: Player was already instantiated from previous mount"),J(!0)),cw.subscribe(aw.playerInstantiated,le);const Le=setTimeout(()=>{ee||(console.log("WebGLRenderer: Forcing player instantiation after timeout"),J(!0),window.isPlayerInstantiated=!0,window.dispatchEvent(new CustomEvent("PlayerInstantiated")))},5e3);return()=>{cw.unsubscribe(aw.playerInstantiated,le),clearTimeout(Le)}},[ee]),V.useEffect(()=>{a||l?setTimeout(()=>{b(!0),Rt.log("WebGLRenderer: Unity is ready to receive messages.")},5e3):Rt.warn("WebGLRenderer: Unity is NOT ready yet.")},[a,l]),V.useEffect(()=>{const le=Le=>{Rt.log("WebGLRenderer: Received 'sendUserToUnity' event"),d("FirebaseUserFromReact",Le)};return cw.subscribe(aw.sendUserToUnity,le),()=>cw.unsubscribe(aw.sendUserToUnity,le)},[d]);const{setFullscreenRef:oe,fullscreenRef:ue}=up();V.useEffect(()=>{oe(t.current)},[t,oe]);const Ee=()=>{G(!z)},fe=E&&r.enableVoiceChat;return console.log("WebGLRenderer: Render with state:",{user:!!E,userId:E==null?void 0:E.uid,isPlayerInstantiated:ee,showVoiceChat:fe,sessionId:ye}),D.jsx(Gt,{className:"webgl-renderer",children:D.jsx(EV,{containerRef:ue.current?ue:document.body,children:D.jsxs("div",{ref:t,style:{width:"100%",height:"100%",aspectRatio:"16/9",position:"relative"},children:[D.jsxs(Gt,{position:"absolute",zIndex:"10",top:4,right:4,display:"flex",alignItems:"center",gap:2,children:[r.showAuthButton&&D.jsx(x3e,{}),fe&&D.jsxs(Gie,{appId:u5e,channel:ye,uid:E==null?void 0:E.uid,enabled:!0,children:[D.jsx(n5e,{size:"md",defaultMuted:!0,joinOnClick:!0}),D.jsx(i5e,{userNickname:Q==null?void 0:Q.Nickname})]}),D.jsx(W3e,{}),D.jsx(Gt,{position:"relative",zIndex:"9999",children:D.jsx(l5e,{onTogglePlayerList:Ee,spaceID:se})})]}),D.jsxs(Gt,{position:"relative",overflow:"hidden",width:"100%",height:"100%",bgRepeat:"no-repeat",bgSize:"cover",bgPosition:"center",bgColor:"#666666",bgImage:r.urlLoadingBackground?`url('${r.urlLoadingBackground}')`:"",children:[D.jsx(L3e,{}),D.jsx(Gt,{...p,width:"100%",height:"100%",position:"absolute",zIndex:"1",children:D.jsx(Eie.Unity,{unityProvider:s,style:{width:"100%",height:"100%"},devicePixelRatio:R})}),D.jsx(K3e,{})]}),D.jsx(Gt,{...p,position:"absolute",zIndex:"2",top:4,left:4,display:"flex",alignItems:"flex-start",gap:3,height:"50px",children:r.showDisruptiveLogo&&D.jsx(EF,{src:r.urlDisruptiveLogo,width:"100px",alt:"Disruptive Logo"})}),D.jsx(Gt,{...p,position:"absolute",zIndex:"2",bottom:4,left:4,display:"flex",alignItems:"flex-start",gap:3}),D.jsxs(Gt,{...p,position:"absolute",zIndex:"2",bottom:4,right:4,display:"flex",alignItems:"flex-start",gap:3,children:[r.showHelpButton&&D.jsx(M3e,{}),D.jsx(H3e,{})]}),D.jsx(q3e,{}),D.jsx($3e,{isOpen:N!==null,onClose:()=>{console.log(" Closing nameplate modal"),F()},playerName:(N==null?void 0:N.playerName)||"Unknown Player",playerId:(N==null?void 0:N.playerId)||"Unknown ID"}),D.jsx(Y3e,{isVisible:z,onToggleVisibility:G})]})})})});Fj.displayName="WebGLRenderer";Fj.propTypes={settings:xr.shape({urlLoadingBackground:xr.string,showAuthButton:xr.bool,showDisruptiveLogo:xr.bool,urlDisruptiveLogo:xr.string,showHelpButton:xr.bool,enableVoiceChat:xr.bool,spaceID:xr.string})};const jj=({spaceID:r,overrideSettings:t})=>{const s=V.useRef(null),[a,l]=V.useState(!0),[d,p]=V.useState({spaceID:r,loaderUrl:"",dataUrl:"",frameworkUrl:"",codeUrl:""}),[E,v]=V.useState({urlDisruptiveLogo:"gs://disruptive-metaverse.appspot.com/common/images/Disruptive-logo-white-p-500.png",urlLoadingBackground:"",showDisruptiveLogo:null,showAuthButton:null,showHelpButton:null,enableVoiceChat:!0,spaceID:r});return V.useEffect(()=>{(async()=>{try{const R=await R3e(r);if(R){p(N=>({...N,spaceID:r,loaderUrl:R.loaderUrl,dataUrl:R.dataUrl,frameworkUrl:R.frameworkUrl,codeUrl:R.codeUrl}));const O=await Nie(E.urlDisruptiveLogo);v(N=>({...N,urlLoadingBackground:R.gsUrlLoadingBackground||"",showAuthButton:R.showAuthButton!==void 0?R.showAuthButton:!0,showDisruptiveLogo:R.showDisruptiveLogo!==void 0?R.showDisruptiveLogo:!0,showHelpButton:R.showHelpButton!==void 0?R.showHelpButton:!0,enableVoiceChat:R.enableVoiceChat!==void 0?R.enableVoiceChat:!0,urlDisruptiveLogo:O,spaceID:r,...t||{}})),l(!1)}else Rt.error(`WebGLLoader: No configuration found for spaceID: ${r}`)}catch(R){Rt.error("WebGLLoader: Error fetching space data:",R)}finally{l(!1)}})()},[r,E.urlDisruptiveLogo,t]),V.useEffect(()=>{a||(Rt.log("WebGLLoader: Unity config from Firebase",d),Rt.log("WebGLLoader: Space settings from Firebase",E))},[a]),D.jsx(D.Fragment,{children:a?D.jsx("div",{className:"flex justify-center items-center h-full mt-12",children:"Getting space data..."}):D.jsx(S4e,{...d,children:D.jsx(Fj,{ref:s,settings:E})})})};jj.propTypes={spaceID:xr.string.isRequired,overrideSettings:xr.object};const XO=document.getElementById("webgl-root");if(XO){const r=XO.getAttribute("data-space-id"),t=XO.getAttribute("data-theme")||"default",s=()=>{const[a,l]=V.useState(null);return V.useEffect(()=>{Kw(t).then(l)},[]),a?D.jsx(FN,{theme:a,children:D.jsx(yk,{children:D.jsx(kj,{children:D.jsx(jj,{spaceID:r})})})}):D.jsx("div",{children:"Loading theme..."})};EN.createRoot(XO).render(D.jsx(s,{}))}else console.error("Root element 'webgl-root' not found.");const d5e=(r,t)=>{try{const s=Bre(qm,`spaces/${r}/chatMessages`),a=new Date,l=TBe(s,bBe("timestamp","asc"),wBe(a));return Zre(l,d=>{const p=[];d.docChanges().forEach(E=>{if(E.type==="added"){const v=E.doc.data();console.log("Firestore document data:",v),p.push({id:E.doc.id,...v})}}),p.length>0&&t(p)})}catch(s){throw Rt.error("Error subscribing to space chat messages:",s),s}};function dd(r){const t=Object.prototype.toString.call(r);return r instanceof Date||typeof r=="object"&&t==="[object Date]"?new r.constructor(+r):typeof r=="number"||t==="[object Number]"||typeof r=="string"||t==="[object String]"?new Date(r):new Date(NaN)}function aE(r,t){return r instanceof Date?new r.constructor(t):new Date(t)}const Hie=6048e5,h5e=864e5;let f5e={};function Rk(){return f5e}function iR(r,t){var E,v,b,R;const s=Rk(),a=(t==null?void 0:t.weekStartsOn)??((v=(E=t==null?void 0:t.locale)==null?void 0:E.options)==null?void 0:v.weekStartsOn)??s.weekStartsOn??((R=(b=s.locale)==null?void 0:b.options)==null?void 0:R.weekStartsOn)??0,l=dd(r),d=l.getDay(),p=(d<a?7:0)+d-a;return l.setDate(l.getDate()-p),l.setHours(0,0,0,0),l}function _N(r){return iR(r,{weekStartsOn:1})}function Kie(r){const t=dd(r),s=t.getFullYear(),a=aE(r,0);a.setFullYear(s+1,0,4),a.setHours(0,0,0,0);const l=_N(a),d=aE(r,0);d.setFullYear(s,0,4),d.setHours(0,0,0,0);const p=_N(d);return t.getTime()>=l.getTime()?s+1:t.getTime()>=p.getTime()?s:s-1}function VX(r){const t=dd(r);return t.setHours(0,0,0,0),t}function FX(r){const t=dd(r),s=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()));return s.setUTCFullYear(t.getFullYear()),+r-+s}function p5e(r,t){const s=VX(r),a=VX(t),l=+s-FX(s),d=+a-FX(a);return Math.round((l-d)/h5e)}function m5e(r){const t=Kie(r),s=aE(r,0);return s.setFullYear(t,0,4),s.setHours(0,0,0,0),_N(s)}function g5e(r){return r instanceof Date||typeof r=="object"&&Object.prototype.toString.call(r)==="[object Date]"}function _5e(r){if(!g5e(r)&&typeof r!="number")return!1;const t=dd(r);return!isNaN(Number(t))}function E5e(r){const t=dd(r),s=aE(r,0);return s.setFullYear(t.getFullYear(),0,1),s.setHours(0,0,0,0),s}const y5e={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},v5e=(r,t,s)=>{let a;const l=y5e[r];return typeof l=="string"?a=l:t===1?a=l.one:a=l.other.replace("{{count}}",t.toString()),s!=null&&s.addSuffix?s.comparison&&s.comparison>0?"in "+a:a+" ago":a};function v2(r){return(t={})=>{const s=t.width?String(t.width):r.defaultWidth;return r.formats[s]||r.formats[r.defaultWidth]}}const S5e={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},T5e={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},b5e={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},w5e={date:v2({formats:S5e,defaultWidth:"full"}),time:v2({formats:T5e,defaultWidth:"full"}),dateTime:v2({formats:b5e,defaultWidth:"full"})},R5e={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},C5e=(r,t,s,a)=>R5e[r];function Bb(r){return(t,s)=>{const a=s!=null&&s.context?String(s.context):"standalone";let l;if(a==="formatting"&&r.formattingValues){const p=r.defaultFormattingWidth||r.defaultWidth,E=s!=null&&s.width?String(s.width):p;l=r.formattingValues[E]||r.formattingValues[p]}else{const p=r.defaultWidth,E=s!=null&&s.width?String(s.width):r.defaultWidth;l=r.values[E]||r.values[p]}const d=r.argumentCallback?r.argumentCallback(t):t;return l[d]}}const I5e={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},A5e={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},O5e={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},P5e={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},N5e={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},k5e={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},D5e=(r,t)=>{const s=Number(r),a=s%100;if(a>20||a<10)switch(a%10){case 1:return s+"st";case 2:return s+"nd";case 3:return s+"rd"}return s+"th"},L5e={ordinalNumber:D5e,era:Bb({values:I5e,defaultWidth:"wide"}),quarter:Bb({values:A5e,defaultWidth:"wide",argumentCallback:r=>r-1}),month:Bb({values:O5e,defaultWidth:"wide"}),day:Bb({values:P5e,defaultWidth:"wide"}),dayPeriod:Bb({values:N5e,defaultWidth:"wide",formattingValues:k5e,defaultFormattingWidth:"wide"})};function Wb(r){return(t,s={})=>{const a=s.width,l=a&&r.matchPatterns[a]||r.matchPatterns[r.defaultMatchWidth],d=t.match(l);if(!d)return null;const p=d[0],E=a&&r.parsePatterns[a]||r.parsePatterns[r.defaultParseWidth],v=Array.isArray(E)?M5e(E,O=>O.test(p)):x5e(E,O=>O.test(p));let b;b=r.valueCallback?r.valueCallback(v):v,b=s.valueCallback?s.valueCallback(b):b;const R=t.slice(p.length);return{value:b,rest:R}}}function x5e(r,t){for(const s in r)if(Object.prototype.hasOwnProperty.call(r,s)&&t(r[s]))return s}function M5e(r,t){for(let s=0;s<r.length;s++)if(t(r[s]))return s}function U5e(r){return(t,s={})=>{const a=t.match(r.matchPattern);if(!a)return null;const l=a[0],d=t.match(r.parsePattern);if(!d)return null;let p=r.valueCallback?r.valueCallback(d[0]):d[0];p=s.valueCallback?s.valueCallback(p):p;const E=t.slice(l.length);return{value:p,rest:E}}}const V5e=/^(\d+)(th|st|nd|rd)?/i,F5e=/\d+/i,j5e={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},B5e={any:[/^b/i,/^(a|c)/i]},W5e={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},G5e={any:[/1/i,/2/i,/3/i,/4/i]},z5e={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},H5e={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},K5e={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},q5e={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},$5e={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},Y5e={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},X5e={ordinalNumber:U5e({matchPattern:V5e,parsePattern:F5e,valueCallback:r=>parseInt(r,10)}),era:Wb({matchPatterns:j5e,defaultMatchWidth:"wide",parsePatterns:B5e,defaultParseWidth:"any"}),quarter:Wb({matchPatterns:W5e,defaultMatchWidth:"wide",parsePatterns:G5e,defaultParseWidth:"any",valueCallback:r=>r+1}),month:Wb({matchPatterns:z5e,defaultMatchWidth:"wide",parsePatterns:H5e,defaultParseWidth:"any"}),day:Wb({matchPatterns:K5e,defaultMatchWidth:"wide",parsePatterns:q5e,defaultParseWidth:"any"}),dayPeriod:Wb({matchPatterns:$5e,defaultMatchWidth:"any",parsePatterns:Y5e,defaultParseWidth:"any"})},J5e={code:"en-US",formatDistance:v5e,formatLong:w5e,formatRelative:C5e,localize:L5e,match:X5e,options:{weekStartsOn:0,firstWeekContainsDate:1}};function Q5e(r){const t=dd(r);return p5e(t,E5e(t))+1}function Z5e(r){const t=dd(r),s=+_N(t)-+m5e(t);return Math.round(s/Hie)+1}function qie(r,t){var R,O,N,F;const s=dd(r),a=s.getFullYear(),l=Rk(),d=(t==null?void 0:t.firstWeekContainsDate)??((O=(R=t==null?void 0:t.locale)==null?void 0:R.options)==null?void 0:O.firstWeekContainsDate)??l.firstWeekContainsDate??((F=(N=l.locale)==null?void 0:N.options)==null?void 0:F.firstWeekContainsDate)??1,p=aE(r,0);p.setFullYear(a+1,0,d),p.setHours(0,0,0,0);const E=iR(p,t),v=aE(r,0);v.setFullYear(a,0,d),v.setHours(0,0,0,0);const b=iR(v,t);return s.getTime()>=E.getTime()?a+1:s.getTime()>=b.getTime()?a:a-1}function e6e(r,t){var E,v,b,R;const s=Rk(),a=(t==null?void 0:t.firstWeekContainsDate)??((v=(E=t==null?void 0:t.locale)==null?void 0:E.options)==null?void 0:v.firstWeekContainsDate)??s.firstWeekContainsDate??((R=(b=s.locale)==null?void 0:b.options)==null?void 0:R.firstWeekContainsDate)??1,l=qie(r,t),d=aE(r,0);return d.setFullYear(l,0,a),d.setHours(0,0,0,0),iR(d,t)}function t6e(r,t){const s=dd(r),a=+iR(s,t)-+e6e(s,t);return Math.round(a/Hie)+1}function ci(r,t){const s=r<0?"-":"",a=Math.abs(r).toString().padStart(t,"0");return s+a}const Sm={y(r,t){const s=r.getFullYear(),a=s>0?s:1-s;return ci(t==="yy"?a%100:a,t.length)},M(r,t){const s=r.getMonth();return t==="M"?String(s+1):ci(s+1,2)},d(r,t){return ci(r.getDate(),t.length)},a(r,t){const s=r.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return s.toUpperCase();case"aaa":return s;case"aaaaa":return s[0];case"aaaa":default:return s==="am"?"a.m.":"p.m."}},h(r,t){return ci(r.getHours()%12||12,t.length)},H(r,t){return ci(r.getHours(),t.length)},m(r,t){return ci(r.getMinutes(),t.length)},s(r,t){return ci(r.getSeconds(),t.length)},S(r,t){const s=t.length,a=r.getMilliseconds(),l=Math.trunc(a*Math.pow(10,s-3));return ci(l,t.length)}},Vv={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},jX={G:function(r,t,s){const a=r.getFullYear()>0?1:0;switch(t){case"G":case"GG":case"GGG":return s.era(a,{width:"abbreviated"});case"GGGGG":return s.era(a,{width:"narrow"});case"GGGG":default:return s.era(a,{width:"wide"})}},y:function(r,t,s){if(t==="yo"){const a=r.getFullYear(),l=a>0?a:1-a;return s.ordinalNumber(l,{unit:"year"})}return Sm.y(r,t)},Y:function(r,t,s,a){const l=qie(r,a),d=l>0?l:1-l;if(t==="YY"){const p=d%100;return ci(p,2)}return t==="Yo"?s.ordinalNumber(d,{unit:"year"}):ci(d,t.length)},R:function(r,t){const s=Kie(r);return ci(s,t.length)},u:function(r,t){const s=r.getFullYear();return ci(s,t.length)},Q:function(r,t,s){const a=Math.ceil((r.getMonth()+1)/3);switch(t){case"Q":return String(a);case"QQ":return ci(a,2);case"Qo":return s.ordinalNumber(a,{unit:"quarter"});case"QQQ":return s.quarter(a,{width:"abbreviated",context:"formatting"});case"QQQQQ":return s.quarter(a,{width:"narrow",context:"formatting"});case"QQQQ":default:return s.quarter(a,{width:"wide",context:"formatting"})}},q:function(r,t,s){const a=Math.ceil((r.getMonth()+1)/3);switch(t){case"q":return String(a);case"qq":return ci(a,2);case"qo":return s.ordinalNumber(a,{unit:"quarter"});case"qqq":return s.quarter(a,{width:"abbreviated",context:"standalone"});case"qqqqq":return s.quarter(a,{width:"narrow",context:"standalone"});case"qqqq":default:return s.quarter(a,{width:"wide",context:"standalone"})}},M:function(r,t,s){const a=r.getMonth();switch(t){case"M":case"MM":return Sm.M(r,t);case"Mo":return s.ordinalNumber(a+1,{unit:"month"});case"MMM":return s.month(a,{width:"abbreviated",context:"formatting"});case"MMMMM":return s.month(a,{width:"narrow",context:"formatting"});case"MMMM":default:return s.month(a,{width:"wide",context:"formatting"})}},L:function(r,t,s){const a=r.getMonth();switch(t){case"L":return String(a+1);case"LL":return ci(a+1,2);case"Lo":return s.ordinalNumber(a+1,{unit:"month"});case"LLL":return s.month(a,{width:"abbreviated",context:"standalone"});case"LLLLL":return s.month(a,{width:"narrow",context:"standalone"});case"LLLL":default:return s.month(a,{width:"wide",context:"standalone"})}},w:function(r,t,s,a){const l=t6e(r,a);return t==="wo"?s.ordinalNumber(l,{unit:"week"}):ci(l,t.length)},I:function(r,t,s){const a=Z5e(r);return t==="Io"?s.ordinalNumber(a,{unit:"week"}):ci(a,t.length)},d:function(r,t,s){return t==="do"?s.ordinalNumber(r.getDate(),{unit:"date"}):Sm.d(r,t)},D:function(r,t,s){const a=Q5e(r);return t==="Do"?s.ordinalNumber(a,{unit:"dayOfYear"}):ci(a,t.length)},E:function(r,t,s){const a=r.getDay();switch(t){case"E":case"EE":case"EEE":return s.day(a,{width:"abbreviated",context:"formatting"});case"EEEEE":return s.day(a,{width:"narrow",context:"formatting"});case"EEEEEE":return s.day(a,{width:"short",context:"formatting"});case"EEEE":default:return s.day(a,{width:"wide",context:"formatting"})}},e:function(r,t,s,a){const l=r.getDay(),d=(l-a.weekStartsOn+8)%7||7;switch(t){case"e":return String(d);case"ee":return ci(d,2);case"eo":return s.ordinalNumber(d,{unit:"day"});case"eee":return s.day(l,{width:"abbreviated",context:"formatting"});case"eeeee":return s.day(l,{width:"narrow",context:"formatting"});case"eeeeee":return s.day(l,{width:"short",context:"formatting"});case"eeee":default:return s.day(l,{width:"wide",context:"formatting"})}},c:function(r,t,s,a){const l=r.getDay(),d=(l-a.weekStartsOn+8)%7||7;switch(t){case"c":return String(d);case"cc":return ci(d,t.length);case"co":return s.ordinalNumber(d,{unit:"day"});case"ccc":return s.day(l,{width:"abbreviated",context:"standalone"});case"ccccc":return s.day(l,{width:"narrow",context:"standalone"});case"cccccc":return s.day(l,{width:"short",context:"standalone"});case"cccc":default:return s.day(l,{width:"wide",context:"standalone"})}},i:function(r,t,s){const a=r.getDay(),l=a===0?7:a;switch(t){case"i":return String(l);case"ii":return ci(l,t.length);case"io":return s.ordinalNumber(l,{unit:"day"});case"iii":return s.day(a,{width:"abbreviated",context:"formatting"});case"iiiii":return s.day(a,{width:"narrow",context:"formatting"});case"iiiiii":return s.day(a,{width:"short",context:"formatting"});case"iiii":default:return s.day(a,{width:"wide",context:"formatting"})}},a:function(r,t,s){const l=r.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return s.dayPeriod(l,{width:"abbreviated",context:"formatting"});case"aaa":return s.dayPeriod(l,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return s.dayPeriod(l,{width:"narrow",context:"formatting"});case"aaaa":default:return s.dayPeriod(l,{width:"wide",context:"formatting"})}},b:function(r,t,s){const a=r.getHours();let l;switch(a===12?l=Vv.noon:a===0?l=Vv.midnight:l=a/12>=1?"pm":"am",t){case"b":case"bb":return s.dayPeriod(l,{width:"abbreviated",context:"formatting"});case"bbb":return s.dayPeriod(l,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return s.dayPeriod(l,{width:"narrow",context:"formatting"});case"bbbb":default:return s.dayPeriod(l,{width:"wide",context:"formatting"})}},B:function(r,t,s){const a=r.getHours();let l;switch(a>=17?l=Vv.evening:a>=12?l=Vv.afternoon:a>=4?l=Vv.morning:l=Vv.night,t){case"B":case"BB":case"BBB":return s.dayPeriod(l,{width:"abbreviated",context:"formatting"});case"BBBBB":return s.dayPeriod(l,{width:"narrow",context:"formatting"});case"BBBB":default:return s.dayPeriod(l,{width:"wide",context:"formatting"})}},h:function(r,t,s){if(t==="ho"){let a=r.getHours()%12;return a===0&&(a=12),s.ordinalNumber(a,{unit:"hour"})}return Sm.h(r,t)},H:function(r,t,s){return t==="Ho"?s.ordinalNumber(r.getHours(),{unit:"hour"}):Sm.H(r,t)},K:function(r,t,s){const a=r.getHours()%12;return t==="Ko"?s.ordinalNumber(a,{unit:"hour"}):ci(a,t.length)},k:function(r,t,s){let a=r.getHours();return a===0&&(a=24),t==="ko"?s.ordinalNumber(a,{unit:"hour"}):ci(a,t.length)},m:function(r,t,s){return t==="mo"?s.ordinalNumber(r.getMinutes(),{unit:"minute"}):Sm.m(r,t)},s:function(r,t,s){return t==="so"?s.ordinalNumber(r.getSeconds(),{unit:"second"}):Sm.s(r,t)},S:function(r,t){return Sm.S(r,t)},X:function(r,t,s){const a=r.getTimezoneOffset();if(a===0)return"Z";switch(t){case"X":return WX(a);case"XXXX":case"XX":return N_(a);case"XXXXX":case"XXX":default:return N_(a,":")}},x:function(r,t,s){const a=r.getTimezoneOffset();switch(t){case"x":return WX(a);case"xxxx":case"xx":return N_(a);case"xxxxx":case"xxx":default:return N_(a,":")}},O:function(r,t,s){const a=r.getTimezoneOffset();switch(t){case"O":case"OO":case"OOO":return"GMT"+BX(a,":");case"OOOO":default:return"GMT"+N_(a,":")}},z:function(r,t,s){const a=r.getTimezoneOffset();switch(t){case"z":case"zz":case"zzz":return"GMT"+BX(a,":");case"zzzz":default:return"GMT"+N_(a,":")}},t:function(r,t,s){const a=Math.trunc(r.getTime()/1e3);return ci(a,t.length)},T:function(r,t,s){const a=r.getTime();return ci(a,t.length)}};function BX(r,t=""){const s=r>0?"-":"+",a=Math.abs(r),l=Math.trunc(a/60),d=a%60;return d===0?s+String(l):s+String(l)+t+ci(d,2)}function WX(r,t){return r%60===0?(r>0?"-":"+")+ci(Math.abs(r)/60,2):N_(r,t)}function N_(r,t=""){const s=r>0?"-":"+",a=Math.abs(r),l=ci(Math.trunc(a/60),2),d=ci(a%60,2);return s+l+t+d}const GX=(r,t)=>{switch(r){case"P":return t.date({width:"short"});case"PP":return t.date({width:"medium"});case"PPP":return t.date({width:"long"});case"PPPP":default:return t.date({width:"full"})}},$ie=(r,t)=>{switch(r){case"p":return t.time({width:"short"});case"pp":return t.time({width:"medium"});case"ppp":return t.time({width:"long"});case"pppp":default:return t.time({width:"full"})}},n6e=(r,t)=>{const s=r.match(/(P+)(p+)?/)||[],a=s[1],l=s[2];if(!l)return GX(r,t);let d;switch(a){case"P":d=t.dateTime({width:"short"});break;case"PP":d=t.dateTime({width:"medium"});break;case"PPP":d=t.dateTime({width:"long"});break;case"PPPP":default:d=t.dateTime({width:"full"});break}return d.replace("{{date}}",GX(a,t)).replace("{{time}}",$ie(l,t))},r6e={p:$ie,P:n6e},i6e=/^D+$/,s6e=/^Y+$/,o6e=["D","DD","YY","YYYY"];function a6e(r){return i6e.test(r)}function c6e(r){return s6e.test(r)}function l6e(r,t,s){const a=u6e(r,t,s);if(console.warn(a),o6e.includes(r))throw new RangeError(a)}function u6e(r,t,s){const a=r[0]==="Y"?"years":"days of the month";return`Use \`${r.toLowerCase()}\` instead of \`${r}\` (in \`${t}\`) for formatting ${a} to the input \`${s}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const d6e=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,h6e=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,f6e=/^'([^]*?)'?$/,p6e=/''/g,m6e=/[a-zA-Z]/;function g6e(r,t,s){var R,O,N,F;const a=Rk(),l=a.locale??J5e,d=a.firstWeekContainsDate??((O=(R=a.locale)==null?void 0:R.options)==null?void 0:O.firstWeekContainsDate)??1,p=a.weekStartsOn??((F=(N=a.locale)==null?void 0:N.options)==null?void 0:F.weekStartsOn)??0,E=dd(r);if(!_5e(E))throw new RangeError("Invalid time value");let v=t.match(h6e).map(H=>{const z=H[0];if(z==="p"||z==="P"){const G=r6e[z];return G(H,l.formatLong)}return H}).join("").match(d6e).map(H=>{if(H==="''")return{isToken:!1,value:"'"};const z=H[0];if(z==="'")return{isToken:!1,value:_6e(H)};if(jX[z])return{isToken:!0,value:H};if(z.match(m6e))throw new RangeError("Format string contains an unescaped latin alphabet character `"+z+"`");return{isToken:!1,value:H}});l.localize.preprocessor&&(v=l.localize.preprocessor(E,v));const b={firstWeekContainsDate:d,weekStartsOn:p,locale:l};return v.map(H=>{if(!H.isToken)return H.value;const z=H.value;(c6e(z)||a6e(z))&&l6e(z,t,String(r));const G=jX[z[0]];return G(E,z,l.localize,b)}).join("")}function _6e(r){const t=r.match(f6e);return t?t[1].replace(p6e,"'"):r}const E6e=Dh(Gt),Yie=({name:r,timestamp:t,text:s,isCurrentUser:a})=>{console.log("Message props:",{name:r,timestamp:t,text:s,isCurrentUser:a});const l=t&&t.toDate?g6e(t.toDate(),"HH:mm"):"Invalid date";return D.jsxs(E6e,{display:"flex",flexDirection:"column",alignItems:a?"flex-end":"flex-start",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},children:[D.jsxs(Gt,{w:"auto",maxW:"80%",bg:a?"secondary.500":"primary.200",color:a?"white":"black",p:"10px",borderRadius:"10px",alignSelf:a?"flex-end":"flex-start",wordBreak:"break-word",children:[D.jsx(gn,{fontWeight:"bold",children:r}),D.jsx(gn,{children:s})]}),D.jsx(gn,{color:"copy.light",fontSize:"xs",mt:"4px",mx:"6px",mb:"10px",textAlign:a?"right":"left",children:l})]})};Yie.propTypes={name:xr.string.isRequired,timestamp:xr.object,text:xr.string.isRequired,isCurrentUser:xr.bool.isRequired};const y6e=({spaceID:r})=>{const[t,s]=V.useState([]),{user:a}=V.useContext(Ra),l=V.useRef(null);return V.useEffect(()=>{const d=d5e(r,p=>{console.log("New messages received:",p),s(E=>[...E,...p]),Rt.log("Messages updated:",p)});return()=>d()},[r]),V.useEffect(()=>{l.current&&l.current.scrollIntoView({behavior:"smooth"})},[t]),D.jsxs(Gt,{className:"messages-container",display:"flex",flexDirection:"column",my:"10px",overflowY:"auto",maxHeight:"80vh",children:[t.map(d=>{const p=d.uid===(a==null?void 0:a.uid);return D.jsx(Yie,{name:d.user,timestamp:d.timestamp,text:d.text,isCurrentUser:p},d.id)}),D.jsx("div",{ref:l})]})},v6e=({spaceID:r})=>{},Xie=({spaceID:r})=>{const{user:t}=V.useContext(Ra);return t?D.jsxs(Gt,{children:[D.jsx(Gt,{height:"400px",overflowY:"auto",border:"1px solid #ccc",backgroundColor:"tertiaryAlpha.600",padding:"10px",children:D.jsx(y6e,{spaceID:r})}),D.jsx(Gt,{mt:"8px",children:D.jsx(v6e,{spaceID:r})})]}):(console.log("No user found, returning login message"),D.jsx(Gt,{children:D.jsx(gn,{children:"Please log in to view the chat."})}))},JO=document.getElementById("chat-root");if(JO){const r=JO.getAttribute("data-space-id"),t=JO.getAttribute("data-theme")||"default",s=()=>{const[a,l]=V.useState(null);return V.useEffect(()=>{Kw(t).then(l)},[]),a?D.jsx(FN,{theme:a,children:D.jsx(yk,{children:D.jsx(Xie,{spaceID:r})})}):D.jsx("div",{children:"Loading theme..."})};EN.createRoot(JO).render(D.jsx(s,{}))}else console.error("Root element 'chat-root' not found.");class S6e extends Component{constructor(t){super(t),this.state={hasError:!1}}static getDerivedStateFromError(t){return{hasError:!0}}componentDidCatch(t,s){console.error("WebGL Error:",t,s)}render(){return this.state.hasError?D.jsx(Gt,{p:4,bg:"red.100",color:"red.900",borderRadius:"md",children:D.jsx(gn,{children:"WebGL component error. Please refresh the page."})}):this.props.children}}const QO=document.getElementById("root");if(QO){const r=QO.getAttribute("data-space-id"),t=QO.getAttribute("data-theme")||"default",s=()=>{const[a,l]=V.useState(null),[d,p]=V.useState(!1);return V.useEffect(()=>{Kw(t).then(l);const E=()=>{document.hidden||Kw(t).then(l)};return document.addEventListener("visibilitychange",E),()=>{document.removeEventListener("visibilitychange",E)}},[]),a?D.jsx(FN,{theme:a,children:D.jsx(yk,{children:D.jsx(kj,{children:D.jsxs(Us,{spacing:4,align:"stretch",children:[D.jsxs(kc,{justify:"space-between",align:"center",p:4,bg:"gray.700",m:0,position:"relative",zIndex:"100",children:[D.jsx(gn,{fontSize:"xl",fontWeight:"bold",color:"white",children:"LOGO"}),D.jsx(Gt,{zIndex:"100",position:"relative",children:D.jsx(mie,{})})]}),D.jsx(mP,{maxW:"container.xl",p:0,zIndex:"1",children:D.jsx(XZ,{ratio:16/9,bg:"blue.100",m:0,children:D.jsx(Gt,{id:"webgl-root","data-space-id":r,w:"100%",m:0,children:D.jsx(S6e,{children:D.jsx(jj,{spaceID:r})})})})}),D.jsxs(mP,{maxW:"container.xl",p:2,children:[D.jsx(qa,{size:"sm",colorScheme:"blue",onClick:()=>p(!d),children:d?"Hide Voice Chat Debug":"Show Voice Chat Debug"}),d&&D.jsx(Gt,{mt:2,p:3,borderWidth:"1px",borderRadius:"md",bg:"gray.50",children:D.jsx(AgoraProvider,{appId:"a2a7f4eb05284449b1063eb71d8301dc",channel:r||"default-channel",children:D.jsx(VoiceChatDebugPanel,{})})})]}),D.jsx(mP,{maxW:"container.xl",p:0,children:D.jsx(Xie,{spaceID:r})})]})})})}):D.jsx("div",{children:"Loading theme..."})};EN.createRoot(QO).render(D.jsx(s,{}))}else console.error("Root element 'root' not found.");export{Qge as a,Sye as b,wi as c,Eye as d,b6e as e,T6e as f,uye as g,au as i,gh as m,ywe as t};
