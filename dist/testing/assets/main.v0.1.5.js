function V_e(n,t){for(var i=0;i<t.length;i++){const a=t[i];if(typeof a!="string"&&!Array.isArray(a)){for(const l in a)if(l!=="default"&&!(l in n)){const d=Object.getOwnPropertyDescriptor(a,l);d&&Object.defineProperty(n,l,d.get?d:{enumerable:!0,get:()=>a[l]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}var lE=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function b0(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var jM={exports:{}},ew={},BM={exports:{}},fr={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var x$;function F_e(){if(x$)return fr;x$=1;var n=Symbol.for("react.element"),t=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),l=Symbol.for("react.profiler"),d=Symbol.for("react.provider"),p=Symbol.for("react.context"),E=Symbol.for("react.forward_ref"),v=Symbol.for("react.suspense"),b=Symbol.for("react.memo"),w=Symbol.for("react.lazy"),A=Symbol.iterator;function N(be){return be===null||typeof be!="object"?null:(be=A&&be[A]||be["@@iterator"],typeof be=="function"?be:null)}var F={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},j=Object.assign,B={};function H(be,Se,Ae){this.props=be,this.context=Se,this.refs=B,this.updater=Ae||F}H.prototype.isReactComponent={},H.prototype.setState=function(be,Se){if(typeof be!="object"&&typeof be!="function"&&be!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,be,Se,"setState")},H.prototype.forceUpdate=function(be){this.updater.enqueueForceUpdate(this,be,"forceUpdate")};function ee(){}ee.prototype=H.prototype;function K(be,Se,Ae){this.props=be,this.context=Se,this.refs=B,this.updater=Ae||F}var te=K.prototype=new ee;te.constructor=K,j(te,H.prototype),te.isPureReactComponent=!0;var le=Array.isArray,oe=Object.prototype.hasOwnProperty,ge={current:null},Z={key:!0,ref:!0,__self:!0,__source:!0};function Q(be,Se,Ae){var Ue,ze={},et=null,nt=null;if(Se!=null)for(Ue in Se.ref!==void 0&&(nt=Se.ref),Se.key!==void 0&&(et=""+Se.key),Se)oe.call(Se,Ue)&&!Z.hasOwnProperty(Ue)&&(ze[Ue]=Se[Ue]);var dt=arguments.length-2;if(dt===1)ze.children=Ae;else if(1<dt){for(var Xe=Array(dt),It=0;It<dt;It++)Xe[It]=arguments[It+2];ze.children=Xe}if(be&&be.defaultProps)for(Ue in dt=be.defaultProps,dt)ze[Ue]===void 0&&(ze[Ue]=dt[Ue]);return{$$typeof:n,type:be,key:et,ref:nt,props:ze,_owner:ge.current}}function ne(be,Se){return{$$typeof:n,type:be.type,key:Se,ref:be.ref,props:be.props,_owner:be._owner}}function se(be){return typeof be=="object"&&be!==null&&be.$$typeof===n}function fe(be){var Se={"=":"=0",":":"=2"};return"$"+be.replace(/[=:]/g,function(Ae){return Se[Ae]})}var he=/\/+/g;function ue(be,Se){return typeof be=="object"&&be!==null&&be.key!=null?fe(""+be.key):Se.toString(36)}function Me(be,Se,Ae,Ue,ze){var et=typeof be;(et==="undefined"||et==="boolean")&&(be=null);var nt=!1;if(be===null)nt=!0;else switch(et){case"string":case"number":nt=!0;break;case"object":switch(be.$$typeof){case n:case t:nt=!0}}if(nt)return nt=be,ze=ze(nt),be=Ue===""?"."+ue(nt,0):Ue,le(ze)?(Ae="",be!=null&&(Ae=be.replace(he,"$&/")+"/"),Me(ze,Se,Ae,"",function(It){return It})):ze!=null&&(se(ze)&&(ze=ne(ze,Ae+(!ze.key||nt&&nt.key===ze.key?"":(""+ze.key).replace(he,"$&/")+"/")+be)),Se.push(ze)),1;if(nt=0,Ue=Ue===""?".":Ue+":",le(be))for(var dt=0;dt<be.length;dt++){et=be[dt];var Xe=Ue+ue(et,dt);nt+=Me(et,Se,Ae,Xe,ze)}else if(Xe=N(be),typeof Xe=="function")for(be=Xe.call(be),dt=0;!(et=be.next()).done;)et=et.value,Xe=Ue+ue(et,dt++),nt+=Me(et,Se,Ae,Xe,ze);else if(et==="object")throw Se=String(be),Error("Objects are not valid as a React child (found: "+(Se==="[object Object]"?"object with keys {"+Object.keys(be).join(", ")+"}":Se)+"). If you meant to render a collection of children, use an array instead.");return nt}function He(be,Se,Ae){if(be==null)return be;var Ue=[],ze=0;return Me(be,Ue,"","",function(et){return Se.call(Ae,et,ze++)}),Ue}function rt(be){if(be._status===-1){var Se=be._result;Se=Se(),Se.then(function(Ae){(be._status===0||be._status===-1)&&(be._status=1,be._result=Ae)},function(Ae){(be._status===0||be._status===-1)&&(be._status=2,be._result=Ae)}),be._status===-1&&(be._status=0,be._result=Se)}if(be._status===1)return be._result.default;throw be._result}var we={current:null},Ce={transition:null},ye={ReactCurrentDispatcher:we,ReactCurrentBatchConfig:Ce,ReactCurrentOwner:ge};function Ne(){throw Error("act(...) is not supported in production builds of React.")}return fr.Children={map:He,forEach:function(be,Se,Ae){He(be,function(){Se.apply(this,arguments)},Ae)},count:function(be){var Se=0;return He(be,function(){Se++}),Se},toArray:function(be){return He(be,function(Se){return Se})||[]},only:function(be){if(!se(be))throw Error("React.Children.only expected to receive a single React element child.");return be}},fr.Component=H,fr.Fragment=i,fr.Profiler=l,fr.PureComponent=K,fr.StrictMode=a,fr.Suspense=v,fr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ye,fr.act=Ne,fr.cloneElement=function(be,Se,Ae){if(be==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+be+".");var Ue=j({},be.props),ze=be.key,et=be.ref,nt=be._owner;if(Se!=null){if(Se.ref!==void 0&&(et=Se.ref,nt=ge.current),Se.key!==void 0&&(ze=""+Se.key),be.type&&be.type.defaultProps)var dt=be.type.defaultProps;for(Xe in Se)oe.call(Se,Xe)&&!Z.hasOwnProperty(Xe)&&(Ue[Xe]=Se[Xe]===void 0&&dt!==void 0?dt[Xe]:Se[Xe])}var Xe=arguments.length-2;if(Xe===1)Ue.children=Ae;else if(1<Xe){dt=Array(Xe);for(var It=0;It<Xe;It++)dt[It]=arguments[It+2];Ue.children=dt}return{$$typeof:n,type:be.type,key:ze,ref:et,props:Ue,_owner:nt}},fr.createContext=function(be){return be={$$typeof:p,_currentValue:be,_currentValue2:be,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},be.Provider={$$typeof:d,_context:be},be.Consumer=be},fr.createElement=Q,fr.createFactory=function(be){var Se=Q.bind(null,be);return Se.type=be,Se},fr.createRef=function(){return{current:null}},fr.forwardRef=function(be){return{$$typeof:E,render:be}},fr.isValidElement=se,fr.lazy=function(be){return{$$typeof:w,_payload:{_status:-1,_result:be},_init:rt}},fr.memo=function(be,Se){return{$$typeof:b,type:be,compare:Se===void 0?null:Se}},fr.startTransition=function(be){var Se=Ce.transition;Ce.transition={};try{be()}finally{Ce.transition=Se}},fr.unstable_act=Ne,fr.useCallback=function(be,Se){return we.current.useCallback(be,Se)},fr.useContext=function(be){return we.current.useContext(be)},fr.useDebugValue=function(){},fr.useDeferredValue=function(be){return we.current.useDeferredValue(be)},fr.useEffect=function(be,Se){return we.current.useEffect(be,Se)},fr.useId=function(){return we.current.useId()},fr.useImperativeHandle=function(be,Se,Ae){return we.current.useImperativeHandle(be,Se,Ae)},fr.useInsertionEffect=function(be,Se){return we.current.useInsertionEffect(be,Se)},fr.useLayoutEffect=function(be,Se){return we.current.useLayoutEffect(be,Se)},fr.useMemo=function(be,Se){return we.current.useMemo(be,Se)},fr.useReducer=function(be,Se,Ae){return we.current.useReducer(be,Se,Ae)},fr.useRef=function(be){return we.current.useRef(be)},fr.useState=function(be){return we.current.useState(be)},fr.useSyncExternalStore=function(be,Se,Ae){return we.current.useSyncExternalStore(be,Se,Ae)},fr.useTransition=function(){return we.current.useTransition()},fr.version="18.3.1",fr}var M$;function Pu(){return M$||(M$=1,BM.exports=F_e()),BM.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var U$;function j_e(){if(U$)return ew;U$=1;var n=Pu(),t=Symbol.for("react.element"),i=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,l=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,d={key:!0,ref:!0,__self:!0,__source:!0};function p(E,v,b){var w,A={},N=null,F=null;b!==void 0&&(N=""+b),v.key!==void 0&&(N=""+v.key),v.ref!==void 0&&(F=v.ref);for(w in v)a.call(v,w)&&!d.hasOwnProperty(w)&&(A[w]=v[w]);if(E&&E.defaultProps)for(w in v=E.defaultProps,v)A[w]===void 0&&(A[w]=v[w]);return{$$typeof:t,type:E,key:N,ref:F,props:A,_owner:l.current}}return ew.Fragment=i,ew.jsx=p,ew.jsxs=p,ew}var V$;function B_e(){return V$||(V$=1,jM.exports=j_e()),jM.exports}var C=B_e(),L=Pu();const ni=b0(L),F$=V_e({__proto__:null,default:ni},[L]);var QP={},WM={exports:{}},Wc={},zM={exports:{}},GM={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var j$;function W_e(){return j$||(j$=1,function(n){function t(Ce,ye){var Ne=Ce.length;Ce.push(ye);e:for(;0<Ne;){var be=Ne-1>>>1,Se=Ce[be];if(0<l(Se,ye))Ce[be]=ye,Ce[Ne]=Se,Ne=be;else break e}}function i(Ce){return Ce.length===0?null:Ce[0]}function a(Ce){if(Ce.length===0)return null;var ye=Ce[0],Ne=Ce.pop();if(Ne!==ye){Ce[0]=Ne;e:for(var be=0,Se=Ce.length,Ae=Se>>>1;be<Ae;){var Ue=2*(be+1)-1,ze=Ce[Ue],et=Ue+1,nt=Ce[et];if(0>l(ze,Ne))et<Se&&0>l(nt,ze)?(Ce[be]=nt,Ce[et]=Ne,be=et):(Ce[be]=ze,Ce[Ue]=Ne,be=Ue);else if(et<Se&&0>l(nt,Ne))Ce[be]=nt,Ce[et]=Ne,be=et;else break e}}return ye}function l(Ce,ye){var Ne=Ce.sortIndex-ye.sortIndex;return Ne!==0?Ne:Ce.id-ye.id}if(typeof performance=="object"&&typeof performance.now=="function"){var d=performance;n.unstable_now=function(){return d.now()}}else{var p=Date,E=p.now();n.unstable_now=function(){return p.now()-E}}var v=[],b=[],w=1,A=null,N=3,F=!1,j=!1,B=!1,H=typeof setTimeout=="function"?setTimeout:null,ee=typeof clearTimeout=="function"?clearTimeout:null,K=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function te(Ce){for(var ye=i(b);ye!==null;){if(ye.callback===null)a(b);else if(ye.startTime<=Ce)a(b),ye.sortIndex=ye.expirationTime,t(v,ye);else break;ye=i(b)}}function le(Ce){if(B=!1,te(Ce),!j)if(i(v)!==null)j=!0,rt(oe);else{var ye=i(b);ye!==null&&we(le,ye.startTime-Ce)}}function oe(Ce,ye){j=!1,B&&(B=!1,ee(Q),Q=-1),F=!0;var Ne=N;try{for(te(ye),A=i(v);A!==null&&(!(A.expirationTime>ye)||Ce&&!fe());){var be=A.callback;if(typeof be=="function"){A.callback=null,N=A.priorityLevel;var Se=be(A.expirationTime<=ye);ye=n.unstable_now(),typeof Se=="function"?A.callback=Se:A===i(v)&&a(v),te(ye)}else a(v);A=i(v)}if(A!==null)var Ae=!0;else{var Ue=i(b);Ue!==null&&we(le,Ue.startTime-ye),Ae=!1}return Ae}finally{A=null,N=Ne,F=!1}}var ge=!1,Z=null,Q=-1,ne=5,se=-1;function fe(){return!(n.unstable_now()-se<ne)}function he(){if(Z!==null){var Ce=n.unstable_now();se=Ce;var ye=!0;try{ye=Z(!0,Ce)}finally{ye?ue():(ge=!1,Z=null)}}else ge=!1}var ue;if(typeof K=="function")ue=function(){K(he)};else if(typeof MessageChannel<"u"){var Me=new MessageChannel,He=Me.port2;Me.port1.onmessage=he,ue=function(){He.postMessage(null)}}else ue=function(){H(he,0)};function rt(Ce){Z=Ce,ge||(ge=!0,ue())}function we(Ce,ye){Q=H(function(){Ce(n.unstable_now())},ye)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(Ce){Ce.callback=null},n.unstable_continueExecution=function(){j||F||(j=!0,rt(oe))},n.unstable_forceFrameRate=function(Ce){0>Ce||125<Ce?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ne=0<Ce?Math.floor(1e3/Ce):5},n.unstable_getCurrentPriorityLevel=function(){return N},n.unstable_getFirstCallbackNode=function(){return i(v)},n.unstable_next=function(Ce){switch(N){case 1:case 2:case 3:var ye=3;break;default:ye=N}var Ne=N;N=ye;try{return Ce()}finally{N=Ne}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(Ce,ye){switch(Ce){case 1:case 2:case 3:case 4:case 5:break;default:Ce=3}var Ne=N;N=Ce;try{return ye()}finally{N=Ne}},n.unstable_scheduleCallback=function(Ce,ye,Ne){var be=n.unstable_now();switch(typeof Ne=="object"&&Ne!==null?(Ne=Ne.delay,Ne=typeof Ne=="number"&&0<Ne?be+Ne:be):Ne=be,Ce){case 1:var Se=-1;break;case 2:Se=250;break;case 5:Se=1073741823;break;case 4:Se=1e4;break;default:Se=5e3}return Se=Ne+Se,Ce={id:w++,callback:ye,priorityLevel:Ce,startTime:Ne,expirationTime:Se,sortIndex:-1},Ne>be?(Ce.sortIndex=Ne,t(b,Ce),i(v)===null&&Ce===i(b)&&(B?(ee(Q),Q=-1):B=!0,we(le,Ne-be))):(Ce.sortIndex=Se,t(v,Ce),j||F||(j=!0,rt(oe))),Ce},n.unstable_shouldYield=fe,n.unstable_wrapCallback=function(Ce){var ye=N;return function(){var Ne=N;N=ye;try{return Ce.apply(this,arguments)}finally{N=Ne}}}}(GM)),GM}var B$;function z_e(){return B$||(B$=1,zM.exports=W_e()),zM.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var W$;function G_e(){if(W$)return Wc;W$=1;var n=Pu(),t=z_e();function i(f){for(var g="https://reactjs.org/docs/error-decoder.html?invariant="+f,T=1;T<arguments.length;T++)g+="&args[]="+encodeURIComponent(arguments[T]);return"Minified React error #"+f+"; visit "+g+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var a=new Set,l={};function d(f,g){p(f,g),p(f+"Capture",g)}function p(f,g){for(l[f]=g,f=0;f<g.length;f++)a.add(g[f])}var E=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),v=Object.prototype.hasOwnProperty,b=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,w={},A={};function N(f){return v.call(A,f)?!0:v.call(w,f)?!1:b.test(f)?A[f]=!0:(w[f]=!0,!1)}function F(f,g,T,O){if(T!==null&&T.type===0)return!1;switch(typeof g){case"function":case"symbol":return!0;case"boolean":return O?!1:T!==null?!T.acceptsBooleans:(f=f.toLowerCase().slice(0,5),f!=="data-"&&f!=="aria-");default:return!1}}function j(f,g,T,O){if(g===null||typeof g>"u"||F(f,g,T,O))return!0;if(O)return!1;if(T!==null)switch(T.type){case 3:return!g;case 4:return g===!1;case 5:return isNaN(g);case 6:return isNaN(g)||1>g}return!1}function B(f,g,T,O,M,G,ae){this.acceptsBooleans=g===2||g===3||g===4,this.attributeName=O,this.attributeNamespace=M,this.mustUseProperty=T,this.propertyName=f,this.type=g,this.sanitizeURL=G,this.removeEmptyString=ae}var H={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(f){H[f]=new B(f,0,!1,f,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(f){var g=f[0];H[g]=new B(g,1,!1,f[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(f){H[f]=new B(f,2,!1,f.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(f){H[f]=new B(f,2,!1,f,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(f){H[f]=new B(f,3,!1,f.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(f){H[f]=new B(f,3,!0,f,null,!1,!1)}),["capture","download"].forEach(function(f){H[f]=new B(f,4,!1,f,null,!1,!1)}),["cols","rows","size","span"].forEach(function(f){H[f]=new B(f,6,!1,f,null,!1,!1)}),["rowSpan","start"].forEach(function(f){H[f]=new B(f,5,!1,f.toLowerCase(),null,!1,!1)});var ee=/[\-:]([a-z])/g;function K(f){return f[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(f){var g=f.replace(ee,K);H[g]=new B(g,1,!1,f,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(f){var g=f.replace(ee,K);H[g]=new B(g,1,!1,f,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(f){var g=f.replace(ee,K);H[g]=new B(g,1,!1,f,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(f){H[f]=new B(f,1,!1,f.toLowerCase(),null,!1,!1)}),H.xlinkHref=new B("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(f){H[f]=new B(f,1,!1,f.toLowerCase(),null,!0,!0)});function te(f,g,T,O){var M=H.hasOwnProperty(g)?H[g]:null;(M!==null?M.type!==0:O||!(2<g.length)||g[0]!=="o"&&g[0]!=="O"||g[1]!=="n"&&g[1]!=="N")&&(j(g,T,M,O)&&(T=null),O||M===null?N(g)&&(T===null?f.removeAttribute(g):f.setAttribute(g,""+T)):M.mustUseProperty?f[M.propertyName]=T===null?M.type===3?!1:"":T:(g=M.attributeName,O=M.attributeNamespace,T===null?f.removeAttribute(g):(M=M.type,T=M===3||M===4&&T===!0?"":""+T,O?f.setAttributeNS(O,g,T):f.setAttribute(g,T))))}var le=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,oe=Symbol.for("react.element"),ge=Symbol.for("react.portal"),Z=Symbol.for("react.fragment"),Q=Symbol.for("react.strict_mode"),ne=Symbol.for("react.profiler"),se=Symbol.for("react.provider"),fe=Symbol.for("react.context"),he=Symbol.for("react.forward_ref"),ue=Symbol.for("react.suspense"),Me=Symbol.for("react.suspense_list"),He=Symbol.for("react.memo"),rt=Symbol.for("react.lazy"),we=Symbol.for("react.offscreen"),Ce=Symbol.iterator;function ye(f){return f===null||typeof f!="object"?null:(f=Ce&&f[Ce]||f["@@iterator"],typeof f=="function"?f:null)}var Ne=Object.assign,be;function Se(f){if(be===void 0)try{throw Error()}catch(T){var g=T.stack.trim().match(/\n( *(at )?)/);be=g&&g[1]||""}return`
`+be+f}var Ae=!1;function Ue(f,g){if(!f||Ae)return"";Ae=!0;var T=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(g)if(g=function(){throw Error()},Object.defineProperty(g.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(g,[])}catch(it){var O=it}Reflect.construct(f,[],g)}else{try{g.call()}catch(it){O=it}f.call(g.prototype)}else{try{throw Error()}catch(it){O=it}f()}}catch(it){if(it&&O&&typeof it.stack=="string"){for(var M=it.stack.split(`
`),G=O.stack.split(`
`),ae=M.length-1,Ie=G.length-1;1<=ae&&0<=Ie&&M[ae]!==G[Ie];)Ie--;for(;1<=ae&&0<=Ie;ae--,Ie--)if(M[ae]!==G[Ie]){if(ae!==1||Ie!==1)do if(ae--,Ie--,0>Ie||M[ae]!==G[Ie]){var xe=`
`+M[ae].replace(" at new "," at ");return f.displayName&&xe.includes("<anonymous>")&&(xe=xe.replace("<anonymous>",f.displayName)),xe}while(1<=ae&&0<=Ie);break}}}finally{Ae=!1,Error.prepareStackTrace=T}return(f=f?f.displayName||f.name:"")?Se(f):""}function ze(f){switch(f.tag){case 5:return Se(f.type);case 16:return Se("Lazy");case 13:return Se("Suspense");case 19:return Se("SuspenseList");case 0:case 2:case 15:return f=Ue(f.type,!1),f;case 11:return f=Ue(f.type.render,!1),f;case 1:return f=Ue(f.type,!0),f;default:return""}}function et(f){if(f==null)return null;if(typeof f=="function")return f.displayName||f.name||null;if(typeof f=="string")return f;switch(f){case Z:return"Fragment";case ge:return"Portal";case ne:return"Profiler";case Q:return"StrictMode";case ue:return"Suspense";case Me:return"SuspenseList"}if(typeof f=="object")switch(f.$$typeof){case fe:return(f.displayName||"Context")+".Consumer";case se:return(f._context.displayName||"Context")+".Provider";case he:var g=f.render;return f=f.displayName,f||(f=g.displayName||g.name||"",f=f!==""?"ForwardRef("+f+")":"ForwardRef"),f;case He:return g=f.displayName||null,g!==null?g:et(f.type)||"Memo";case rt:g=f._payload,f=f._init;try{return et(f(g))}catch{}}return null}function nt(f){var g=f.type;switch(f.tag){case 24:return"Cache";case 9:return(g.displayName||"Context")+".Consumer";case 10:return(g._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return f=g.render,f=f.displayName||f.name||"",g.displayName||(f!==""?"ForwardRef("+f+")":"ForwardRef");case 7:return"Fragment";case 5:return g;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return et(g);case 8:return g===Q?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof g=="function")return g.displayName||g.name||null;if(typeof g=="string")return g}return null}function dt(f){switch(typeof f){case"boolean":case"number":case"string":case"undefined":return f;case"object":return f;default:return""}}function Xe(f){var g=f.type;return(f=f.nodeName)&&f.toLowerCase()==="input"&&(g==="checkbox"||g==="radio")}function It(f){var g=Xe(f)?"checked":"value",T=Object.getOwnPropertyDescriptor(f.constructor.prototype,g),O=""+f[g];if(!f.hasOwnProperty(g)&&typeof T<"u"&&typeof T.get=="function"&&typeof T.set=="function"){var M=T.get,G=T.set;return Object.defineProperty(f,g,{configurable:!0,get:function(){return M.call(this)},set:function(ae){O=""+ae,G.call(this,ae)}}),Object.defineProperty(f,g,{enumerable:T.enumerable}),{getValue:function(){return O},setValue:function(ae){O=""+ae},stopTracking:function(){f._valueTracker=null,delete f[g]}}}}function hn(f){f._valueTracker||(f._valueTracker=It(f))}function Ut(f){if(!f)return!1;var g=f._valueTracker;if(!g)return!0;var T=g.getValue(),O="";return f&&(O=Xe(f)?f.checked?"true":"false":f.value),f=O,f!==T?(g.setValue(f),!0):!1}function ln(f){if(f=f||(typeof document<"u"?document:void 0),typeof f>"u")return null;try{return f.activeElement||f.body}catch{return f.body}}function Ln(f,g){var T=g.checked;return Ne({},g,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:T??f._wrapperState.initialChecked})}function Xt(f,g){var T=g.defaultValue==null?"":g.defaultValue,O=g.checked!=null?g.checked:g.defaultChecked;T=dt(g.value!=null?g.value:T),f._wrapperState={initialChecked:O,initialValue:T,controlled:g.type==="checkbox"||g.type==="radio"?g.checked!=null:g.value!=null}}function Yn(f,g){g=g.checked,g!=null&&te(f,"checked",g,!1)}function Kt(f,g){Yn(f,g);var T=dt(g.value),O=g.type;if(T!=null)O==="number"?(T===0&&f.value===""||f.value!=T)&&(f.value=""+T):f.value!==""+T&&(f.value=""+T);else if(O==="submit"||O==="reset"){f.removeAttribute("value");return}g.hasOwnProperty("value")?Fe(f,g.type,T):g.hasOwnProperty("defaultValue")&&Fe(f,g.type,dt(g.defaultValue)),g.checked==null&&g.defaultChecked!=null&&(f.defaultChecked=!!g.defaultChecked)}function Re(f,g,T){if(g.hasOwnProperty("value")||g.hasOwnProperty("defaultValue")){var O=g.type;if(!(O!=="submit"&&O!=="reset"||g.value!==void 0&&g.value!==null))return;g=""+f._wrapperState.initialValue,T||g===f.value||(f.value=g),f.defaultValue=g}T=f.name,T!==""&&(f.name=""),f.defaultChecked=!!f._wrapperState.initialChecked,T!==""&&(f.name=T)}function Fe(f,g,T){(g!=="number"||ln(f.ownerDocument)!==f)&&(T==null?f.defaultValue=""+f._wrapperState.initialValue:f.defaultValue!==""+T&&(f.defaultValue=""+T))}var Ke=Array.isArray;function yt(f,g,T,O){if(f=f.options,g){g={};for(var M=0;M<T.length;M++)g["$"+T[M]]=!0;for(T=0;T<f.length;T++)M=g.hasOwnProperty("$"+f[T].value),f[T].selected!==M&&(f[T].selected=M),M&&O&&(f[T].defaultSelected=!0)}else{for(T=""+dt(T),g=null,M=0;M<f.length;M++){if(f[M].value===T){f[M].selected=!0,O&&(f[M].defaultSelected=!0);return}g!==null||f[M].disabled||(g=f[M])}g!==null&&(g.selected=!0)}}function St(f,g){if(g.dangerouslySetInnerHTML!=null)throw Error(i(91));return Ne({},g,{value:void 0,defaultValue:void 0,children:""+f._wrapperState.initialValue})}function Ge(f,g){var T=g.value;if(T==null){if(T=g.children,g=g.defaultValue,T!=null){if(g!=null)throw Error(i(92));if(Ke(T)){if(1<T.length)throw Error(i(93));T=T[0]}g=T}g==null&&(g=""),T=g}f._wrapperState={initialValue:dt(T)}}function Ot(f,g){var T=dt(g.value),O=dt(g.defaultValue);T!=null&&(T=""+T,T!==f.value&&(f.value=T),g.defaultValue==null&&f.defaultValue!==T&&(f.defaultValue=T)),O!=null&&(f.defaultValue=""+O)}function Jt(f){var g=f.textContent;g===f._wrapperState.initialValue&&g!==""&&g!==null&&(f.value=g)}function fn(f){switch(f){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function an(f,g){return f==null||f==="http://www.w3.org/1999/xhtml"?fn(g):f==="http://www.w3.org/2000/svg"&&g==="foreignObject"?"http://www.w3.org/1999/xhtml":f}var ir,ia=function(f){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(g,T,O,M){MSApp.execUnsafeLocalFunction(function(){return f(g,T,O,M)})}:f}(function(f,g){if(f.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in f)f.innerHTML=g;else{for(ir=ir||document.createElement("div"),ir.innerHTML="<svg>"+g.valueOf().toString()+"</svg>",g=ir.firstChild;f.firstChild;)f.removeChild(f.firstChild);for(;g.firstChild;)f.appendChild(g.firstChild)}});function Vt(f,g){if(g){var T=f.firstChild;if(T&&T===f.lastChild&&T.nodeType===3){T.nodeValue=g;return}}f.textContent=g}var on={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Pi=["Webkit","ms","Moz","O"];Object.keys(on).forEach(function(f){Pi.forEach(function(g){g=g+f.charAt(0).toUpperCase()+f.substring(1),on[g]=on[f]})});function fi(f,g,T){return g==null||typeof g=="boolean"||g===""?"":T||typeof g!="number"||g===0||on.hasOwnProperty(f)&&on[f]?(""+g).trim():g+"px"}function Ti(f,g){f=f.style;for(var T in g)if(g.hasOwnProperty(T)){var O=T.indexOf("--")===0,M=fi(T,g[T],O);T==="float"&&(T="cssFloat"),O?f.setProperty(T,M):f[T]=M}}var ur=Ne({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Ba(f,g){if(g){if(ur[f]&&(g.children!=null||g.dangerouslySetInnerHTML!=null))throw Error(i(137,f));if(g.dangerouslySetInnerHTML!=null){if(g.children!=null)throw Error(i(60));if(typeof g.dangerouslySetInnerHTML!="object"||!("__html"in g.dangerouslySetInnerHTML))throw Error(i(61))}if(g.style!=null&&typeof g.style!="object")throw Error(i(62))}}function nl(f,g){if(f.indexOf("-")===-1)return typeof g.is=="string";switch(f){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var us=null;function ds(f){return f=f.target||f.srcElement||window,f.correspondingUseElement&&(f=f.correspondingUseElement),f.nodeType===3?f.parentNode:f}var Ul=null,Fo=null,lc=null;function oa(f){if(f=em(f)){if(typeof Ul!="function")throw Error(i(280));var g=f.stateNode;g&&(g=tm(g),Ul(f.stateNode,f.type,g))}}function uc(f){Fo?lc?lc.push(f):lc=[f]:Fo=f}function rl(){if(Fo){var f=Fo,g=lc;if(lc=Fo=null,oa(f),g)for(f=0;f<g.length;f++)oa(g[f])}}function Lu(f,g){return f(g)}function dc(){}var il=!1;function Is(f,g,T){if(il)return f(g,T);il=!0;try{return Lu(f,g,T)}finally{il=!1,(Fo!==null||lc!==null)&&(dc(),rl())}}function Mi(f,g){var T=f.stateNode;if(T===null)return null;var O=tm(T);if(O===null)return null;T=O[g];e:switch(g){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(O=!O.disabled)||(f=f.type,O=!(f==="button"||f==="input"||f==="select"||f==="textarea")),f=!O;break e;default:f=!1}if(f)return null;if(T&&typeof T!="function")throw Error(i(231,g,typeof T));return T}var uo=!1;if(E)try{var Wa={};Object.defineProperty(Wa,"passive",{get:function(){uo=!0}}),window.addEventListener("test",Wa,Wa),window.removeEventListener("test",Wa,Wa)}catch{uo=!1}function xu(f,g,T,O,M,G,ae,Ie,xe){var it=Array.prototype.slice.call(arguments,3);try{g.apply(T,it)}catch(At){this.onError(At)}}var hc=!1,sa=null,aa=!1,Md=null,Ng={onError:function(f){hc=!0,sa=f}};function Mu(f,g,T,O,M,G,ae,Ie,xe){hc=!1,sa=null,xu.apply(Ng,arguments)}function cf(f,g,T,O,M,G,ae,Ie,xe){if(Mu.apply(this,arguments),hc){if(hc){var it=sa;hc=!1,sa=null}else throw Error(i(198));aa||(aa=!0,Md=it)}}function jo(f){var g=f,T=f;if(f.alternate)for(;g.return;)g=g.return;else{f=g;do g=f,(g.flags&4098)!==0&&(T=g.return),f=g.return;while(f)}return g.tag===3?T:null}function Uu(f){if(f.tag===13){var g=f.memoizedState;if(g===null&&(f=f.alternate,f!==null&&(g=f.memoizedState)),g!==null)return g.dehydrated}return null}function ca(f){if(jo(f)!==f)throw Error(i(188))}function Ud(f){var g=f.alternate;if(!g){if(g=jo(f),g===null)throw Error(i(188));return g!==f?null:f}for(var T=f,O=g;;){var M=T.return;if(M===null)break;var G=M.alternate;if(G===null){if(O=M.return,O!==null){T=O;continue}break}if(M.child===G.child){for(G=M.child;G;){if(G===T)return ca(M),f;if(G===O)return ca(M),g;G=G.sibling}throw Error(i(188))}if(T.return!==O.return)T=M,O=G;else{for(var ae=!1,Ie=M.child;Ie;){if(Ie===T){ae=!0,T=M,O=G;break}if(Ie===O){ae=!0,O=M,T=G;break}Ie=Ie.sibling}if(!ae){for(Ie=G.child;Ie;){if(Ie===T){ae=!0,T=G,O=M;break}if(Ie===O){ae=!0,O=G,T=M;break}Ie=Ie.sibling}if(!ae)throw Error(i(189))}}if(T.alternate!==O)throw Error(i(190))}if(T.tag!==3)throw Error(i(188));return T.stateNode.current===T?f:g}function Vd(f){return f=Ud(f),f!==null?za(f):null}function za(f){if(f.tag===5||f.tag===6)return f;for(f=f.child;f!==null;){var g=za(f);if(g!==null)return g;f=f.sibling}return null}var Fd=t.unstable_scheduleCallback,Vu=t.unstable_cancelCallback,As=t.unstable_shouldYield,jd=t.unstable_requestPaint,Fr=t.unstable_now,pi=t.unstable_getCurrentPriorityLevel,fc=t.unstable_ImmediatePriority,ol=t.unstable_UserBlockingPriority,la=t.unstable_NormalPriority,lf=t.unstable_LowPriority,Bd=t.unstable_IdlePriority,Vl=null,hs=null;function Fp(f){if(hs&&typeof hs.onCommitFiberRoot=="function")try{hs.onCommitFiberRoot(Vl,f,void 0,(f.current.flags&128)===128)}catch{}}var Xo=Math.clz32?Math.clz32:Wd,uf=Math.log,sl=Math.LN2;function Wd(f){return f>>>=0,f===0?32:31-(uf(f)/sl|0)|0}var zd=64,dr=4194304;function Fl(f){switch(f&-f){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return f&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return f&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return f}}function jl(f,g){var T=f.pendingLanes;if(T===0)return 0;var O=0,M=f.suspendedLanes,G=f.pingedLanes,ae=T&268435455;if(ae!==0){var Ie=ae&~M;Ie!==0?O=Fl(Ie):(G&=ae,G!==0&&(O=Fl(G)))}else ae=T&~M,ae!==0?O=Fl(ae):G!==0&&(O=Fl(G));if(O===0)return 0;if(g!==0&&g!==O&&(g&M)===0&&(M=O&-O,G=g&-g,M>=G||M===16&&(G&4194240)!==0))return g;if((O&4)!==0&&(O|=T&16),g=f.entangledLanes,g!==0)for(f=f.entanglements,g&=O;0<g;)T=31-Xo(g),M=1<<T,O|=f[T],g&=~M;return O}function Fu(f,g){switch(f){case 1:case 2:case 4:return g+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return g+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Ga(f,g){for(var T=f.suspendedLanes,O=f.pingedLanes,M=f.expirationTimes,G=f.pendingLanes;0<G;){var ae=31-Xo(G),Ie=1<<ae,xe=M[ae];xe===-1?((Ie&T)===0||(Ie&O)!==0)&&(M[ae]=Fu(Ie,g)):xe<=g&&(f.expiredLanes|=Ie),G&=~Ie}}function Ps(f){return f=f.pendingLanes&-1073741825,f!==0?f:f&1073741824?1073741824:0}function ju(){var f=zd;return zd<<=1,(zd&4194240)===0&&(zd=64),f}function al(f){for(var g=[],T=0;31>T;T++)g.push(f);return g}function Bl(f,g,T){f.pendingLanes|=g,g!==536870912&&(f.suspendedLanes=0,f.pingedLanes=0),f=f.eventTimes,g=31-Xo(g),f[g]=T}function zr(f,g){var T=f.pendingLanes&~g;f.pendingLanes=g,f.suspendedLanes=0,f.pingedLanes=0,f.expiredLanes&=g,f.mutableReadLanes&=g,f.entangledLanes&=g,g=f.entanglements;var O=f.eventTimes;for(f=f.expirationTimes;0<T;){var M=31-Xo(T),G=1<<M;g[M]=0,O[M]=-1,f[M]=-1,T&=~G}}function Ha(f,g){var T=f.entangledLanes|=g;for(f=f.entanglements;T;){var O=31-Xo(T),M=1<<O;M&g|f[O]&g&&(f[O]|=g),T&=~M}}var nr=0;function pc(f){return f&=-f,1<f?4<f?(f&268435455)!==0?16:536870912:4:1}var jp,Wl,Gd,df,Bp,hf=!1,Os=[],no=null,ks=null,Ns=null,zl=new Map,Ds=new Map,Ls=[],Wp="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function mc(f,g){switch(f){case"focusin":case"focusout":no=null;break;case"dragenter":case"dragleave":ks=null;break;case"mouseover":case"mouseout":Ns=null;break;case"pointerover":case"pointerout":zl.delete(g.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ds.delete(g.pointerId)}}function ho(f,g,T,O,M,G){return f===null||f.nativeEvent!==G?(f={blockedOn:g,domEventName:T,eventSystemFlags:O,nativeEvent:G,targetContainers:[M]},g!==null&&(g=em(g),g!==null&&Wl(g)),f):(f.eventSystemFlags|=O,g=f.targetContainers,M!==null&&g.indexOf(M)===-1&&g.push(M),f)}function Bu(f,g,T,O,M){switch(g){case"focusin":return no=ho(no,f,g,T,O,M),!0;case"dragenter":return ks=ho(ks,f,g,T,O,M),!0;case"mouseover":return Ns=ho(Ns,f,g,T,O,M),!0;case"pointerover":var G=M.pointerId;return zl.set(G,ho(zl.get(G)||null,f,g,T,O,M)),!0;case"gotpointercapture":return G=M.pointerId,Ds.set(G,ho(Ds.get(G)||null,f,g,T,O,M)),!0}return!1}function ff(f){var g=Sf(f.target);if(g!==null){var T=jo(g);if(T!==null){if(g=T.tag,g===13){if(g=Uu(T),g!==null){f.blockedOn=g,Bp(f.priority,function(){Gd(T)});return}}else if(g===3&&T.stateNode.current.memoizedState.isDehydrated){f.blockedOn=T.tag===3?T.stateNode.containerInfo:null;return}}}f.blockedOn=null}function cl(f){if(f.blockedOn!==null)return!1;for(var g=f.targetContainers;0<g.length;){var T=_r(f.domEventName,f.eventSystemFlags,g[0],f.nativeEvent);if(T===null){T=f.nativeEvent;var O=new T.constructor(T.type,T);us=O,T.target.dispatchEvent(O),us=null}else return g=em(T),g!==null&&Wl(g),f.blockedOn=T,!1;g.shift()}return!0}function Gl(f,g,T){cl(f)&&T.delete(g)}function zp(){hf=!1,no!==null&&cl(no)&&(no=null),ks!==null&&cl(ks)&&(ks=null),Ns!==null&&cl(Ns)&&(Ns=null),zl.forEach(Gl),Ds.forEach(Gl)}function ua(f,g){f.blockedOn===g&&(f.blockedOn=null,hf||(hf=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,zp)))}function da(f){function g(M){return ua(M,f)}if(0<Os.length){ua(Os[0],f);for(var T=1;T<Os.length;T++){var O=Os[T];O.blockedOn===f&&(O.blockedOn=null)}}for(no!==null&&ua(no,f),ks!==null&&ua(ks,f),Ns!==null&&ua(Ns,f),zl.forEach(g),Ds.forEach(g),T=0;T<Ls.length;T++)O=Ls[T],O.blockedOn===f&&(O.blockedOn=null);for(;0<Ls.length&&(T=Ls[0],T.blockedOn===null);)ff(T),T.blockedOn===null&&Ls.shift()}var ll=le.ReactCurrentBatchConfig,ve=!0;function De(f,g,T,O){var M=nr,G=ll.transition;ll.transition=null;try{nr=1,$t(f,g,T,O)}finally{nr=M,ll.transition=G}}function tt(f,g,T,O){var M=nr,G=ll.transition;ll.transition=null;try{nr=4,$t(f,g,T,O)}finally{nr=M,ll.transition=G}}function $t(f,g,T,O){if(ve){var M=_r(f,g,T,O);if(M===null)ey(f,g,O,Hn,T),mc(f,O);else if(Bu(M,f,g,T,O))O.stopPropagation();else if(mc(f,O),g&4&&-1<Wp.indexOf(f)){for(;M!==null;){var G=em(M);if(G!==null&&jp(G),G=_r(f,g,T,O),G===null&&ey(f,g,O,Hn,T),G===M)break;M=G}M!==null&&O.stopPropagation()}else ey(f,g,O,null,T)}}var Hn=null;function _r(f,g,T,O){if(Hn=null,f=ds(O),f=Sf(f),f!==null)if(g=jo(f),g===null)f=null;else if(T=g.tag,T===13){if(f=Uu(g),f!==null)return f;f=null}else if(T===3){if(g.stateNode.current.memoizedState.isDehydrated)return g.tag===3?g.stateNode.containerInfo:null;f=null}else g!==f&&(f=null);return Hn=f,null}function jr(f){switch(f){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(pi()){case fc:return 1;case ol:return 4;case la:case lf:return 16;case Bd:return 536870912;default:return 16}default:return 16}}var cn=null,Nr=null,mi=null;function Po(){if(mi)return mi;var f,g=Nr,T=g.length,O,M="value"in cn?cn.value:cn.textContent,G=M.length;for(f=0;f<T&&g[f]===M[f];f++);var ae=T-f;for(O=1;O<=ae&&g[T-O]===M[G-O];O++);return mi=M.slice(f,1<O?1-O:void 0)}function xs(f){var g=f.keyCode;return"charCode"in f?(f=f.charCode,f===0&&g===13&&(f=13)):f=g,f===10&&(f=13),32<=f||f===13?f:0}function Ms(){return!0}function Wu(){return!1}function Yi(f){function g(T,O,M,G,ae){this._reactName=T,this._targetInst=M,this.type=O,this.nativeEvent=G,this.target=ae,this.currentTarget=null;for(var Ie in f)f.hasOwnProperty(Ie)&&(T=f[Ie],this[Ie]=T?T(G):G[Ie]);return this.isDefaultPrevented=(G.defaultPrevented!=null?G.defaultPrevented:G.returnValue===!1)?Ms:Wu,this.isPropagationStopped=Wu,this}return Ne(g.prototype,{preventDefault:function(){this.defaultPrevented=!0;var T=this.nativeEvent;T&&(T.preventDefault?T.preventDefault():typeof T.returnValue!="unknown"&&(T.returnValue=!1),this.isDefaultPrevented=Ms)},stopPropagation:function(){var T=this.nativeEvent;T&&(T.stopPropagation?T.stopPropagation():typeof T.cancelBubble!="unknown"&&(T.cancelBubble=!0),this.isPropagationStopped=Ms)},persist:function(){},isPersistent:Ms}),g}var ul={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(f){return f.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Hd=Yi(ul),gc=Ne({},ul,{view:0,detail:0}),Dg=Yi(gc),Gp,zu,Us,Hl=Ne({},gc,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:_c,button:0,buttons:0,relatedTarget:function(f){return f.relatedTarget===void 0?f.fromElement===f.srcElement?f.toElement:f.fromElement:f.relatedTarget},movementX:function(f){return"movementX"in f?f.movementX:(f!==Us&&(Us&&f.type==="mousemove"?(Gp=f.screenX-Us.screenX,zu=f.screenY-Us.screenY):zu=Gp=0,Us=f),Gp)},movementY:function(f){return"movementY"in f?f.movementY:zu}}),Hp=Yi(Hl),Lg=Ne({},Hl,{dataTransfer:0}),$E=Yi(Lg),$p=Ne({},gc,{relatedTarget:0}),Kp=Yi($p),Gu=Ne({},ul,{animationName:0,elapsedTime:0,pseudoElement:0}),Hu=Yi(Gu),$u=Ne({},ul,{clipboardData:function(f){return"clipboardData"in f?f.clipboardData:window.clipboardData}}),xg=Yi($u),KE=Ne({},ul,{data:0}),xn=Yi(KE),qp={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Vs={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},qE={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function YE(f){var g=this.nativeEvent;return g.getModifierState?g.getModifierState(f):(f=qE[f])?!!g[f]:!1}function _c(){return YE}var I=Ne({},gc,{key:function(f){if(f.key){var g=qp[f.key]||f.key;if(g!=="Unidentified")return g}return f.type==="keypress"?(f=xs(f),f===13?"Enter":String.fromCharCode(f)):f.type==="keydown"||f.type==="keyup"?Vs[f.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:_c,charCode:function(f){return f.type==="keypress"?xs(f):0},keyCode:function(f){return f.type==="keydown"||f.type==="keyup"?f.keyCode:0},which:function(f){return f.type==="keypress"?xs(f):f.type==="keydown"||f.type==="keyup"?f.keyCode:0}}),W=Yi(I),J=Ne({},Hl,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),pe=Yi(J),qe=Ne({},gc,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:_c}),at=Yi(qe),xt=Ne({},ul,{propertyName:0,elapsedTime:0,pseudoElement:0}),Gr=Yi(xt),oi=Ne({},Hl,{deltaX:function(f){return"deltaX"in f?f.deltaX:"wheelDeltaX"in f?-f.wheelDeltaX:0},deltaY:function(f){return"deltaY"in f?f.deltaY:"wheelDeltaY"in f?-f.wheelDeltaY:"wheelDelta"in f?-f.wheelDelta:0},deltaZ:0,deltaMode:0}),Er=Yi(oi),Bo=[9,13,27,32],fo=E&&"CompositionEvent"in window,$a=null;E&&"documentMode"in document&&($a=document.documentMode);var Fs=E&&"TextEvent"in window&&!$a,pf=E&&(!fo||$a&&8<$a&&11>=$a),Yp=" ",Ka=!1;function fC(f,g){switch(f){case"keyup":return Bo.indexOf(g.keyCode)!==-1;case"keydown":return g.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function pC(f){return f=f.detail,typeof f=="object"&&"data"in f?f.data:null}var Xp=!1;function m1(f,g){switch(f){case"compositionend":return pC(g);case"keypress":return g.which!==32?null:(Ka=!0,Yp);case"textInput":return f=g.data,f===Yp&&Ka?null:f;default:return null}}function mC(f,g){if(Xp)return f==="compositionend"||!fo&&fC(f,g)?(f=Po(),mi=Nr=cn=null,Xp=!1,f):null;switch(f){case"paste":return null;case"keypress":if(!(g.ctrlKey||g.altKey||g.metaKey)||g.ctrlKey&&g.altKey){if(g.char&&1<g.char.length)return g.char;if(g.which)return String.fromCharCode(g.which)}return null;case"compositionend":return pf&&g.locale!=="ko"?null:g.data;default:return null}}var g1={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function gC(f){var g=f&&f.nodeName&&f.nodeName.toLowerCase();return g==="input"?!!g1[f.type]:g==="textarea"}function V0(f,g,T,O){uc(O),g=ty(g,"onChange"),0<g.length&&(T=new Hd("onChange","change",null,T,O),f.push({event:T,listeners:g}))}var mf=null,Mg=null;function _1(f){H0(f,0)}function gf(f){var g=bf(f);if(Ut(g))return f}function E1(f,g){if(f==="change")return g}var _C=!1;if(E){var F0;if(E){var Ec="oninput"in document;if(!Ec){var EC=document.createElement("div");EC.setAttribute("oninput","return;"),Ec=typeof EC.oninput=="function"}F0=Ec}else F0=!1;_C=F0&&(!document.documentMode||9<document.documentMode)}function yC(){mf&&(mf.detachEvent("onpropertychange",ha),Mg=mf=null)}function ha(f){if(f.propertyName==="value"&&gf(Mg)){var g=[];V0(g,Mg,f,ds(f)),Is(_1,g)}}function y1(f,g,T){f==="focusin"?(yC(),mf=g,Mg=T,mf.attachEvent("onpropertychange",ha)):f==="focusout"&&yC()}function v1(f){if(f==="selectionchange"||f==="keyup"||f==="keydown")return gf(Mg)}function S1(f,g){if(f==="click")return gf(g)}function b1(f,g){if(f==="input"||f==="change")return gf(g)}function vC(f,g){return f===g&&(f!==0||1/f===1/g)||f!==f&&g!==g}var dl=typeof Object.is=="function"?Object.is:vC;function Ug(f,g){if(dl(f,g))return!0;if(typeof f!="object"||f===null||typeof g!="object"||g===null)return!1;var T=Object.keys(f),O=Object.keys(g);if(T.length!==O.length)return!1;for(O=0;O<T.length;O++){var M=T[O];if(!v.call(g,M)||!dl(f[M],g[M]))return!1}return!0}function SC(f){for(;f&&f.firstChild;)f=f.firstChild;return f}function j0(f,g){var T=SC(f);f=0;for(var O;T;){if(T.nodeType===3){if(O=f+T.textContent.length,f<=g&&O>=g)return{node:T,offset:g-f};f=O}e:{for(;T;){if(T.nextSibling){T=T.nextSibling;break e}T=T.parentNode}T=void 0}T=SC(T)}}function bC(f,g){return f&&g?f===g?!0:f&&f.nodeType===3?!1:g&&g.nodeType===3?bC(f,g.parentNode):"contains"in f?f.contains(g):f.compareDocumentPosition?!!(f.compareDocumentPosition(g)&16):!1:!1}function TC(){for(var f=window,g=ln();g instanceof f.HTMLIFrameElement;){try{var T=typeof g.contentWindow.location.href=="string"}catch{T=!1}if(T)f=g.contentWindow;else break;g=ln(f.document)}return g}function Vg(f){var g=f&&f.nodeName&&f.nodeName.toLowerCase();return g&&(g==="input"&&(f.type==="text"||f.type==="search"||f.type==="tel"||f.type==="url"||f.type==="password")||g==="textarea"||f.contentEditable==="true")}function B0(f){var g=TC(),T=f.focusedElem,O=f.selectionRange;if(g!==T&&T&&T.ownerDocument&&bC(T.ownerDocument.documentElement,T)){if(O!==null&&Vg(T)){if(g=O.start,f=O.end,f===void 0&&(f=g),"selectionStart"in T)T.selectionStart=g,T.selectionEnd=Math.min(f,T.value.length);else if(f=(g=T.ownerDocument||document)&&g.defaultView||window,f.getSelection){f=f.getSelection();var M=T.textContent.length,G=Math.min(O.start,M);O=O.end===void 0?G:Math.min(O.end,M),!f.extend&&G>O&&(M=O,O=G,G=M),M=j0(T,G);var ae=j0(T,O);M&&ae&&(f.rangeCount!==1||f.anchorNode!==M.node||f.anchorOffset!==M.offset||f.focusNode!==ae.node||f.focusOffset!==ae.offset)&&(g=g.createRange(),g.setStart(M.node,M.offset),f.removeAllRanges(),G>O?(f.addRange(g),f.extend(ae.node,ae.offset)):(g.setEnd(ae.node,ae.offset),f.addRange(g)))}}for(g=[],f=T;f=f.parentNode;)f.nodeType===1&&g.push({element:f,left:f.scrollLeft,top:f.scrollTop});for(typeof T.focus=="function"&&T.focus(),T=0;T<g.length;T++)f=g[T],f.element.scrollLeft=f.left,f.element.scrollTop=f.top}}var T1=E&&"documentMode"in document&&11>=document.documentMode,st=null,W0=null,Fg=null,z0=!1;function wC(f,g,T){var O=T.window===T?T.document:T.nodeType===9?T:T.ownerDocument;z0||st==null||st!==ln(O)||(O=st,"selectionStart"in O&&Vg(O)?O={start:O.selectionStart,end:O.selectionEnd}:(O=(O.ownerDocument&&O.ownerDocument.defaultView||window).getSelection(),O={anchorNode:O.anchorNode,anchorOffset:O.anchorOffset,focusNode:O.focusNode,focusOffset:O.focusOffset}),Fg&&Ug(Fg,O)||(Fg=O,O=ty(W0,"onSelect"),0<O.length&&(g=new Hd("onSelect","select",null,g,T),f.push({event:g,listeners:O}),g.target=st)))}function XE(f,g){var T={};return T[f.toLowerCase()]=g.toLowerCase(),T["Webkit"+f]="webkit"+g,T["Moz"+f]="moz"+g,T}var Jp={animationend:XE("Animation","AnimationEnd"),animationiteration:XE("Animation","AnimationIteration"),animationstart:XE("Animation","AnimationStart"),transitionend:XE("Transition","TransitionEnd")},G0={},RC={};E&&(RC=document.createElement("div").style,"AnimationEvent"in window||(delete Jp.animationend.animation,delete Jp.animationiteration.animation,delete Jp.animationstart.animation),"TransitionEvent"in window||delete Jp.transitionend.transition);function _f(f){if(G0[f])return G0[f];if(!Jp[f])return f;var g=Jp[f],T;for(T in g)if(g.hasOwnProperty(T)&&T in RC)return G0[f]=g[T];return f}var Ef=_f("animationend"),CC=_f("animationiteration"),IC=_f("animationstart"),AC=_f("transitionend"),PC=new Map,JE="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function $d(f,g){PC.set(f,g),d(g,[f])}for(var QE=0;QE<JE.length;QE++){var qa=JE[QE],w1=qa.toLowerCase(),jg=qa[0].toUpperCase()+qa.slice(1);$d(w1,"on"+jg)}$d(Ef,"onAnimationEnd"),$d(CC,"onAnimationIteration"),$d(IC,"onAnimationStart"),$d("dblclick","onDoubleClick"),$d("focusin","onFocus"),$d("focusout","onBlur"),$d(AC,"onTransitionEnd"),p("onMouseEnter",["mouseout","mouseover"]),p("onMouseLeave",["mouseout","mouseover"]),p("onPointerEnter",["pointerout","pointerover"]),p("onPointerLeave",["pointerout","pointerover"]),d("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),d("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),d("onBeforeInput",["compositionend","keypress","textInput","paste"]),d("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),d("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),d("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Bg="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),R1=new Set("cancel close invalid load scroll toggle".split(" ").concat(Bg));function OC(f,g,T){var O=f.type||"unknown-event";f.currentTarget=T,cf(O,g,void 0,f),f.currentTarget=null}function H0(f,g){g=(g&4)!==0;for(var T=0;T<f.length;T++){var O=f[T],M=O.event;O=O.listeners;e:{var G=void 0;if(g)for(var ae=O.length-1;0<=ae;ae--){var Ie=O[ae],xe=Ie.instance,it=Ie.currentTarget;if(Ie=Ie.listener,xe!==G&&M.isPropagationStopped())break e;OC(M,Ie,it),G=xe}else for(ae=0;ae<O.length;ae++){if(Ie=O[ae],xe=Ie.instance,it=Ie.currentTarget,Ie=Ie.listener,xe!==G&&M.isPropagationStopped())break e;OC(M,Ie,it),G=xe}}}if(aa)throw f=Md,aa=!1,Md=null,f}function wi(f,g){var T=g[Hg];T===void 0&&(T=g[Hg]=new Set);var O=f+"__bubble";T.has(O)||(kC(g,f,2,!1),T.add(O))}function $0(f,g,T){var O=0;g&&(O|=4),kC(T,f,O,g)}var ZE="_reactListening"+Math.random().toString(36).slice(2);function yf(f){if(!f[ZE]){f[ZE]=!0,a.forEach(function(T){T!=="selectionchange"&&(R1.has(T)||$0(T,!1,f),$0(T,!0,f))});var g=f.nodeType===9?f:f.ownerDocument;g===null||g[ZE]||(g[ZE]=!0,$0("selectionchange",!1,g))}}function kC(f,g,T,O){switch(jr(g)){case 1:var M=De;break;case 4:M=tt;break;default:M=$t}T=M.bind(null,g,T,f),M=void 0,!uo||g!=="touchstart"&&g!=="touchmove"&&g!=="wheel"||(M=!0),O?M!==void 0?f.addEventListener(g,T,{capture:!0,passive:M}):f.addEventListener(g,T,!0):M!==void 0?f.addEventListener(g,T,{passive:M}):f.addEventListener(g,T,!1)}function ey(f,g,T,O,M){var G=O;if((g&1)===0&&(g&2)===0&&O!==null)e:for(;;){if(O===null)return;var ae=O.tag;if(ae===3||ae===4){var Ie=O.stateNode.containerInfo;if(Ie===M||Ie.nodeType===8&&Ie.parentNode===M)break;if(ae===4)for(ae=O.return;ae!==null;){var xe=ae.tag;if((xe===3||xe===4)&&(xe=ae.stateNode.containerInfo,xe===M||xe.nodeType===8&&xe.parentNode===M))return;ae=ae.return}for(;Ie!==null;){if(ae=Sf(Ie),ae===null)return;if(xe=ae.tag,xe===5||xe===6){O=G=ae;continue e}Ie=Ie.parentNode}}O=O.return}Is(function(){var it=G,At=ds(T),Pt=[];e:{var Ct=PC.get(f);if(Ct!==void 0){var Gt=Hd,en=f;switch(f){case"keypress":if(xs(T)===0)break e;case"keydown":case"keyup":Gt=W;break;case"focusin":en="focus",Gt=Kp;break;case"focusout":en="blur",Gt=Kp;break;case"beforeblur":case"afterblur":Gt=Kp;break;case"click":if(T.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Gt=Hp;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Gt=$E;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Gt=at;break;case Ef:case CC:case IC:Gt=Hu;break;case AC:Gt=Gr;break;case"scroll":Gt=Dg;break;case"wheel":Gt=Er;break;case"copy":case"cut":case"paste":Gt=xg;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Gt=pe}var tn=(g&4)!==0,Ji=!tn&&f==="scroll",Je=tn?Ct!==null?Ct+"Capture":null:Ct;tn=[];for(var Ve=it,Ze;Ve!==null;){Ze=Ve;var Nt=Ze.stateNode;if(Ze.tag===5&&Nt!==null&&(Ze=Nt,Je!==null&&(Nt=Mi(Ve,Je),Nt!=null&&tn.push(Qp(Ve,Nt,Ze)))),Ji)break;Ve=Ve.return}0<tn.length&&(Ct=new Gt(Ct,en,null,T,At),Pt.push({event:Ct,listeners:tn}))}}if((g&7)===0){e:{if(Ct=f==="mouseover"||f==="pointerover",Gt=f==="mouseout"||f==="pointerout",Ct&&T!==us&&(en=T.relatedTarget||T.fromElement)&&(Sf(en)||en[yc]))break e;if((Gt||Ct)&&(Ct=At.window===At?At:(Ct=At.ownerDocument)?Ct.defaultView||Ct.parentWindow:window,Gt?(en=T.relatedTarget||T.toElement,Gt=it,en=en?Sf(en):null,en!==null&&(Ji=jo(en),en!==Ji||en.tag!==5&&en.tag!==6)&&(en=null)):(Gt=null,en=it),Gt!==en)){if(tn=Hp,Nt="onMouseLeave",Je="onMouseEnter",Ve="mouse",(f==="pointerout"||f==="pointerover")&&(tn=pe,Nt="onPointerLeave",Je="onPointerEnter",Ve="pointer"),Ji=Gt==null?Ct:bf(Gt),Ze=en==null?Ct:bf(en),Ct=new tn(Nt,Ve+"leave",Gt,T,At),Ct.target=Ji,Ct.relatedTarget=Ze,Nt=null,Sf(At)===it&&(tn=new tn(Je,Ve+"enter",en,T,At),tn.target=Ze,tn.relatedTarget=Ji,Nt=tn),Ji=Nt,Gt&&en)t:{for(tn=Gt,Je=en,Ve=0,Ze=tn;Ze;Ze=vf(Ze))Ve++;for(Ze=0,Nt=Je;Nt;Nt=vf(Nt))Ze++;for(;0<Ve-Ze;)tn=vf(tn),Ve--;for(;0<Ze-Ve;)Je=vf(Je),Ze--;for(;Ve--;){if(tn===Je||Je!==null&&tn===Je.alternate)break t;tn=vf(tn),Je=vf(Je)}tn=null}else tn=null;Gt!==null&&Wg(Pt,Ct,Gt,tn,!1),en!==null&&Ji!==null&&Wg(Pt,Ji,en,tn,!0)}}e:{if(Ct=it?bf(it):window,Gt=Ct.nodeName&&Ct.nodeName.toLowerCase(),Gt==="select"||Gt==="input"&&Ct.type==="file")var nn=E1;else if(gC(Ct))if(_C)nn=b1;else{nn=v1;var pn=y1}else(Gt=Ct.nodeName)&&Gt.toLowerCase()==="input"&&(Ct.type==="checkbox"||Ct.type==="radio")&&(nn=S1);if(nn&&(nn=nn(f,it))){V0(Pt,nn,T,At);break e}pn&&pn(f,Ct,it),f==="focusout"&&(pn=Ct._wrapperState)&&pn.controlled&&Ct.type==="number"&&Fe(Ct,"number",Ct.value)}switch(pn=it?bf(it):window,f){case"focusin":(gC(pn)||pn.contentEditable==="true")&&(st=pn,W0=it,Fg=null);break;case"focusout":Fg=W0=st=null;break;case"mousedown":z0=!0;break;case"contextmenu":case"mouseup":case"dragend":z0=!1,wC(Pt,T,At);break;case"selectionchange":if(T1)break;case"keydown":case"keyup":wC(Pt,T,At)}var yn;if(fo)e:{switch(f){case"compositionstart":var On="onCompositionStart";break e;case"compositionend":On="onCompositionEnd";break e;case"compositionupdate":On="onCompositionUpdate";break e}On=void 0}else Xp?fC(f,T)&&(On="onCompositionEnd"):f==="keydown"&&T.keyCode===229&&(On="onCompositionStart");On&&(pf&&T.locale!=="ko"&&(Xp||On!=="onCompositionStart"?On==="onCompositionEnd"&&Xp&&(yn=Po()):(cn=At,Nr="value"in cn?cn.value:cn.textContent,Xp=!0)),pn=ty(it,On),0<pn.length&&(On=new xn(On,f,null,T,At),Pt.push({event:On,listeners:pn}),yn?On.data=yn:(yn=pC(T),yn!==null&&(On.data=yn)))),(yn=Fs?m1(f,T):mC(f,T))&&(it=ty(it,"onBeforeInput"),0<it.length&&(At=new xn("onBeforeInput","beforeinput",null,T,At),Pt.push({event:At,listeners:it}),At.data=yn))}H0(Pt,g)})}function Qp(f,g,T){return{instance:f,listener:g,currentTarget:T}}function ty(f,g){for(var T=g+"Capture",O=[];f!==null;){var M=f,G=M.stateNode;M.tag===5&&G!==null&&(M=G,G=Mi(f,T),G!=null&&O.unshift(Qp(f,G,M)),G=Mi(f,g),G!=null&&O.push(Qp(f,G,M))),f=f.return}return O}function vf(f){if(f===null)return null;do f=f.return;while(f&&f.tag!==5);return f||null}function Wg(f,g,T,O,M){for(var G=g._reactName,ae=[];T!==null&&T!==O;){var Ie=T,xe=Ie.alternate,it=Ie.stateNode;if(xe!==null&&xe===O)break;Ie.tag===5&&it!==null&&(Ie=it,M?(xe=Mi(T,G),xe!=null&&ae.unshift(Qp(T,xe,Ie))):M||(xe=Mi(T,G),xe!=null&&ae.push(Qp(T,xe,Ie)))),T=T.return}ae.length!==0&&f.push({event:g,listeners:ae})}var C1=/\r\n?/g,I1=/\u0000|\uFFFD/g;function NC(f){return(typeof f=="string"?f:""+f).replace(C1,`
`).replace(I1,"")}function ny(f,g,T){if(g=NC(g),NC(f)!==g&&T)throw Error(i(425))}function ry(){}var iy=null,zg=null;function K0(f,g){return f==="textarea"||f==="noscript"||typeof g.children=="string"||typeof g.children=="number"||typeof g.dangerouslySetInnerHTML=="object"&&g.dangerouslySetInnerHTML!==null&&g.dangerouslySetInnerHTML.__html!=null}var Gg=typeof setTimeout=="function"?setTimeout:void 0,A1=typeof clearTimeout=="function"?clearTimeout:void 0,DC=typeof Promise=="function"?Promise:void 0,P1=typeof queueMicrotask=="function"?queueMicrotask:typeof DC<"u"?function(f){return DC.resolve(null).then(f).catch(O1)}:Gg;function O1(f){setTimeout(function(){throw f})}function q0(f,g){var T=g,O=0;do{var M=T.nextSibling;if(f.removeChild(T),M&&M.nodeType===8)if(T=M.data,T==="/$"){if(O===0){f.removeChild(M),da(g);return}O--}else T!=="$"&&T!=="$?"&&T!=="$!"||O++;T=M}while(T);da(g)}function Kd(f){for(;f!=null;f=f.nextSibling){var g=f.nodeType;if(g===1||g===3)break;if(g===8){if(g=f.data,g==="$"||g==="$!"||g==="$?")break;if(g==="/$")return null}}return f}function LC(f){f=f.previousSibling;for(var g=0;f;){if(f.nodeType===8){var T=f.data;if(T==="$"||T==="$!"||T==="$?"){if(g===0)return f;g--}else T==="/$"&&g++}f=f.previousSibling}return null}var Zp=Math.random().toString(36).slice(2),$l="__reactFiber$"+Zp,qd="__reactProps$"+Zp,yc="__reactContainer$"+Zp,Hg="__reactEvents$"+Zp,k1="__reactListeners$"+Zp,N1="__reactHandles$"+Zp;function Sf(f){var g=f[$l];if(g)return g;for(var T=f.parentNode;T;){if(g=T[yc]||T[$l]){if(T=g.alternate,g.child!==null||T!==null&&T.child!==null)for(f=LC(f);f!==null;){if(T=f[$l])return T;f=LC(f)}return g}f=T,T=f.parentNode}return null}function em(f){return f=f[$l]||f[yc],!f||f.tag!==5&&f.tag!==6&&f.tag!==13&&f.tag!==3?null:f}function bf(f){if(f.tag===5||f.tag===6)return f.stateNode;throw Error(i(33))}function tm(f){return f[qd]||null}var Y0=[],nm=-1;function vc(f){return{current:f}}function Ri(f){0>nm||(f.current=Y0[nm],Y0[nm]=null,nm--)}function gi(f,g){nm++,Y0[nm]=f.current,f.current=g}var Yd={},fs=vc(Yd),fa=vc(!1),Tf=Yd;function wf(f,g){var T=f.type.contextTypes;if(!T)return Yd;var O=f.stateNode;if(O&&O.__reactInternalMemoizedUnmaskedChildContext===g)return O.__reactInternalMemoizedMaskedChildContext;var M={},G;for(G in T)M[G]=g[G];return O&&(f=f.stateNode,f.__reactInternalMemoizedUnmaskedChildContext=g,f.__reactInternalMemoizedMaskedChildContext=M),M}function pa(f){return f=f.childContextTypes,f!=null}function oy(){Ri(fa),Ri(fs)}function xC(f,g,T){if(fs.current!==Yd)throw Error(i(168));gi(fs,g),gi(fa,T)}function sy(f,g,T){var O=f.stateNode;if(g=g.childContextTypes,typeof O.getChildContext!="function")return T;O=O.getChildContext();for(var M in O)if(!(M in g))throw Error(i(108,nt(f)||"Unknown",M));return Ne({},T,O)}function ay(f){return f=(f=f.stateNode)&&f.__reactInternalMemoizedMergedChildContext||Yd,Tf=fs.current,gi(fs,f),gi(fa,fa.current),!0}function MC(f,g,T){var O=f.stateNode;if(!O)throw Error(i(169));T?(f=sy(f,g,Tf),O.__reactInternalMemoizedMergedChildContext=f,Ri(fa),Ri(fs),gi(fs,f)):Ri(fa),gi(fa,T)}var Sc=null,cy=!1,X0=!1;function UC(f){Sc===null?Sc=[f]:Sc.push(f)}function D1(f){cy=!0,UC(f)}function Xd(){if(!X0&&Sc!==null){X0=!0;var f=0,g=nr;try{var T=Sc;for(nr=1;f<T.length;f++){var O=T[f];do O=O(!0);while(O!==null)}Sc=null,cy=!1}catch(M){throw Sc!==null&&(Sc=Sc.slice(f+1)),Fd(fc,Xd),M}finally{nr=g,X0=!1}}return null}var rm=[],Ku=0,$g=null,ly=0,bc=[],Ya=0,Rf=null,qu=1,Yu="";function Xu(f,g){rm[Ku++]=ly,rm[Ku++]=$g,$g=f,ly=g}function uy(f,g,T){bc[Ya++]=qu,bc[Ya++]=Yu,bc[Ya++]=Rf,Rf=f;var O=qu;f=Yu;var M=32-Xo(O)-1;O&=~(1<<M),T+=1;var G=32-Xo(g)+M;if(30<G){var ae=M-M%5;G=(O&(1<<ae)-1).toString(32),O>>=ae,M-=ae,qu=1<<32-Xo(g)+M|T<<M|O,Yu=G+f}else qu=1<<G|T<<M|O,Yu=f}function dy(f){f.return!==null&&(Xu(f,1),uy(f,1,0))}function Kg(f){for(;f===$g;)$g=rm[--Ku],rm[Ku]=null,ly=rm[--Ku],rm[Ku]=null;for(;f===Rf;)Rf=bc[--Ya],bc[Ya]=null,Yu=bc[--Ya],bc[Ya]=null,qu=bc[--Ya],bc[Ya]=null}var ma=null,ga=null,si=!1,js=null;function VC(f,g){var T=Qa(5,null,null,0);T.elementType="DELETED",T.stateNode=g,T.return=f,g=f.deletions,g===null?(f.deletions=[T],f.flags|=16):g.push(T)}function FC(f,g){switch(f.tag){case 5:var T=f.type;return g=g.nodeType!==1||T.toLowerCase()!==g.nodeName.toLowerCase()?null:g,g!==null?(f.stateNode=g,ma=f,ga=Kd(g.firstChild),!0):!1;case 6:return g=f.pendingProps===""||g.nodeType!==3?null:g,g!==null?(f.stateNode=g,ma=f,ga=null,!0):!1;case 13:return g=g.nodeType!==8?null:g,g!==null?(T=Rf!==null?{id:qu,overflow:Yu}:null,f.memoizedState={dehydrated:g,treeContext:T,retryLane:1073741824},T=Qa(18,null,null,0),T.stateNode=g,T.return=f,f.child=T,ma=f,ga=null,!0):!1;default:return!1}}function hy(f){return(f.mode&1)!==0&&(f.flags&128)===0}function J0(f){if(si){var g=ga;if(g){var T=g;if(!FC(f,g)){if(hy(f))throw Error(i(418));g=Kd(T.nextSibling);var O=ma;g&&FC(f,g)?VC(O,T):(f.flags=f.flags&-4097|2,si=!1,ma=f)}}else{if(hy(f))throw Error(i(418));f.flags=f.flags&-4097|2,si=!1,ma=f}}}function jC(f){for(f=f.return;f!==null&&f.tag!==5&&f.tag!==3&&f.tag!==13;)f=f.return;ma=f}function qg(f){if(f!==ma)return!1;if(!si)return jC(f),si=!0,!1;var g;if((g=f.tag!==3)&&!(g=f.tag!==5)&&(g=f.type,g=g!=="head"&&g!=="body"&&!K0(f.type,f.memoizedProps)),g&&(g=ga)){if(hy(f))throw BC(),Error(i(418));for(;g;)VC(f,g),g=Kd(g.nextSibling)}if(jC(f),f.tag===13){if(f=f.memoizedState,f=f!==null?f.dehydrated:null,!f)throw Error(i(317));e:{for(f=f.nextSibling,g=0;f;){if(f.nodeType===8){var T=f.data;if(T==="/$"){if(g===0){ga=Kd(f.nextSibling);break e}g--}else T!=="$"&&T!=="$!"&&T!=="$?"||g++}f=f.nextSibling}ga=null}}else ga=ma?Kd(f.stateNode.nextSibling):null;return!0}function BC(){for(var f=ga;f;)f=Kd(f.nextSibling)}function im(){ga=ma=null,si=!1}function Q0(f){js===null?js=[f]:js.push(f)}var L1=le.ReactCurrentBatchConfig;function Yg(f,g,T){if(f=T.ref,f!==null&&typeof f!="function"&&typeof f!="object"){if(T._owner){if(T=T._owner,T){if(T.tag!==1)throw Error(i(309));var O=T.stateNode}if(!O)throw Error(i(147,f));var M=O,G=""+f;return g!==null&&g.ref!==null&&typeof g.ref=="function"&&g.ref._stringRef===G?g.ref:(g=function(ae){var Ie=M.refs;ae===null?delete Ie[G]:Ie[G]=ae},g._stringRef=G,g)}if(typeof f!="string")throw Error(i(284));if(!T._owner)throw Error(i(290,f))}return f}function fy(f,g){throw f=Object.prototype.toString.call(g),Error(i(31,f==="[object Object]"?"object with keys {"+Object.keys(g).join(", ")+"}":f))}function Z0(f){var g=f._init;return g(f._payload)}function Jd(f){function g(Je,Ve){if(f){var Ze=Je.deletions;Ze===null?(Je.deletions=[Ve],Je.flags|=16):Ze.push(Ve)}}function T(Je,Ve){if(!f)return null;for(;Ve!==null;)g(Je,Ve),Ve=Ve.sibling;return null}function O(Je,Ve){for(Je=new Map;Ve!==null;)Ve.key!==null?Je.set(Ve.key,Ve):Je.set(Ve.index,Ve),Ve=Ve.sibling;return Je}function M(Je,Ve){return Je=id(Je,Ve),Je.index=0,Je.sibling=null,Je}function G(Je,Ve,Ze){return Je.index=Ze,f?(Ze=Je.alternate,Ze!==null?(Ze=Ze.index,Ze<Ve?(Je.flags|=2,Ve):Ze):(Je.flags|=2,Ve)):(Je.flags|=1048576,Ve)}function ae(Je){return f&&Je.alternate===null&&(Je.flags|=2),Je}function Ie(Je,Ve,Ze,Nt){return Ve===null||Ve.tag!==6?(Ve=Mb(Ze,Je.mode,Nt),Ve.return=Je,Ve):(Ve=M(Ve,Ze),Ve.return=Je,Ve)}function xe(Je,Ve,Ze,Nt){var nn=Ze.type;return nn===Z?At(Je,Ve,Ze.props.children,Nt,Ze.key):Ve!==null&&(Ve.elementType===nn||typeof nn=="object"&&nn!==null&&nn.$$typeof===rt&&Z0(nn)===Ve.type)?(Nt=M(Ve,Ze.props),Nt.ref=Yg(Je,Ve,Ze),Nt.return=Je,Nt):(Nt=Zy(Ze.type,Ze.key,Ze.props,null,Je.mode,Nt),Nt.ref=Yg(Je,Ve,Ze),Nt.return=Je,Nt)}function it(Je,Ve,Ze,Nt){return Ve===null||Ve.tag!==4||Ve.stateNode.containerInfo!==Ze.containerInfo||Ve.stateNode.implementation!==Ze.implementation?(Ve=Ub(Ze,Je.mode,Nt),Ve.return=Je,Ve):(Ve=M(Ve,Ze.children||[]),Ve.return=Je,Ve)}function At(Je,Ve,Ze,Nt,nn){return Ve===null||Ve.tag!==7?(Ve=Uf(Ze,Je.mode,Nt,nn),Ve.return=Je,Ve):(Ve=M(Ve,Ze),Ve.return=Je,Ve)}function Pt(Je,Ve,Ze){if(typeof Ve=="string"&&Ve!==""||typeof Ve=="number")return Ve=Mb(""+Ve,Je.mode,Ze),Ve.return=Je,Ve;if(typeof Ve=="object"&&Ve!==null){switch(Ve.$$typeof){case oe:return Ze=Zy(Ve.type,Ve.key,Ve.props,null,Je.mode,Ze),Ze.ref=Yg(Je,null,Ve),Ze.return=Je,Ze;case ge:return Ve=Ub(Ve,Je.mode,Ze),Ve.return=Je,Ve;case rt:var Nt=Ve._init;return Pt(Je,Nt(Ve._payload),Ze)}if(Ke(Ve)||ye(Ve))return Ve=Uf(Ve,Je.mode,Ze,null),Ve.return=Je,Ve;fy(Je,Ve)}return null}function Ct(Je,Ve,Ze,Nt){var nn=Ve!==null?Ve.key:null;if(typeof Ze=="string"&&Ze!==""||typeof Ze=="number")return nn!==null?null:Ie(Je,Ve,""+Ze,Nt);if(typeof Ze=="object"&&Ze!==null){switch(Ze.$$typeof){case oe:return Ze.key===nn?xe(Je,Ve,Ze,Nt):null;case ge:return Ze.key===nn?it(Je,Ve,Ze,Nt):null;case rt:return nn=Ze._init,Ct(Je,Ve,nn(Ze._payload),Nt)}if(Ke(Ze)||ye(Ze))return nn!==null?null:At(Je,Ve,Ze,Nt,null);fy(Je,Ze)}return null}function Gt(Je,Ve,Ze,Nt,nn){if(typeof Nt=="string"&&Nt!==""||typeof Nt=="number")return Je=Je.get(Ze)||null,Ie(Ve,Je,""+Nt,nn);if(typeof Nt=="object"&&Nt!==null){switch(Nt.$$typeof){case oe:return Je=Je.get(Nt.key===null?Ze:Nt.key)||null,xe(Ve,Je,Nt,nn);case ge:return Je=Je.get(Nt.key===null?Ze:Nt.key)||null,it(Ve,Je,Nt,nn);case rt:var pn=Nt._init;return Gt(Je,Ve,Ze,pn(Nt._payload),nn)}if(Ke(Nt)||ye(Nt))return Je=Je.get(Ze)||null,At(Ve,Je,Nt,nn,null);fy(Ve,Nt)}return null}function en(Je,Ve,Ze,Nt){for(var nn=null,pn=null,yn=Ve,On=Ve=0,Eo=null;yn!==null&&On<Ze.length;On++){yn.index>On?(Eo=yn,yn=null):Eo=yn.sibling;var yr=Ct(Je,yn,Ze[On],Nt);if(yr===null){yn===null&&(yn=Eo);break}f&&yn&&yr.alternate===null&&g(Je,yn),Ve=G(yr,Ve,On),pn===null?nn=yr:pn.sibling=yr,pn=yr,yn=Eo}if(On===Ze.length)return T(Je,yn),si&&Xu(Je,On),nn;if(yn===null){for(;On<Ze.length;On++)yn=Pt(Je,Ze[On],Nt),yn!==null&&(Ve=G(yn,Ve,On),pn===null?nn=yn:pn.sibling=yn,pn=yn);return si&&Xu(Je,On),nn}for(yn=O(Je,yn);On<Ze.length;On++)Eo=Gt(yn,Je,On,Ze[On],Nt),Eo!==null&&(f&&Eo.alternate!==null&&yn.delete(Eo.key===null?On:Eo.key),Ve=G(Eo,Ve,On),pn===null?nn=Eo:pn.sibling=Eo,pn=Eo);return f&&yn.forEach(function(ch){return g(Je,ch)}),si&&Xu(Je,On),nn}function tn(Je,Ve,Ze,Nt){var nn=ye(Ze);if(typeof nn!="function")throw Error(i(150));if(Ze=nn.call(Ze),Ze==null)throw Error(i(151));for(var pn=nn=null,yn=Ve,On=Ve=0,Eo=null,yr=Ze.next();yn!==null&&!yr.done;On++,yr=Ze.next()){yn.index>On?(Eo=yn,yn=null):Eo=yn.sibling;var ch=Ct(Je,yn,yr.value,Nt);if(ch===null){yn===null&&(yn=Eo);break}f&&yn&&ch.alternate===null&&g(Je,yn),Ve=G(ch,Ve,On),pn===null?nn=ch:pn.sibling=ch,pn=ch,yn=Eo}if(yr.done)return T(Je,yn),si&&Xu(Je,On),nn;if(yn===null){for(;!yr.done;On++,yr=Ze.next())yr=Pt(Je,yr.value,Nt),yr!==null&&(Ve=G(yr,Ve,On),pn===null?nn=yr:pn.sibling=yr,pn=yr);return si&&Xu(Je,On),nn}for(yn=O(Je,yn);!yr.done;On++,yr=Ze.next())yr=Gt(yn,Je,On,yr.value,Nt),yr!==null&&(f&&yr.alternate!==null&&yn.delete(yr.key===null?On:yr.key),Ve=G(yr,Ve,On),pn===null?nn=yr:pn.sibling=yr,pn=yr);return f&&yn.forEach(function(X1){return g(Je,X1)}),si&&Xu(Je,On),nn}function Ji(Je,Ve,Ze,Nt){if(typeof Ze=="object"&&Ze!==null&&Ze.type===Z&&Ze.key===null&&(Ze=Ze.props.children),typeof Ze=="object"&&Ze!==null){switch(Ze.$$typeof){case oe:e:{for(var nn=Ze.key,pn=Ve;pn!==null;){if(pn.key===nn){if(nn=Ze.type,nn===Z){if(pn.tag===7){T(Je,pn.sibling),Ve=M(pn,Ze.props.children),Ve.return=Je,Je=Ve;break e}}else if(pn.elementType===nn||typeof nn=="object"&&nn!==null&&nn.$$typeof===rt&&Z0(nn)===pn.type){T(Je,pn.sibling),Ve=M(pn,Ze.props),Ve.ref=Yg(Je,pn,Ze),Ve.return=Je,Je=Ve;break e}T(Je,pn);break}else g(Je,pn);pn=pn.sibling}Ze.type===Z?(Ve=Uf(Ze.props.children,Je.mode,Nt,Ze.key),Ve.return=Je,Je=Ve):(Nt=Zy(Ze.type,Ze.key,Ze.props,null,Je.mode,Nt),Nt.ref=Yg(Je,Ve,Ze),Nt.return=Je,Je=Nt)}return ae(Je);case ge:e:{for(pn=Ze.key;Ve!==null;){if(Ve.key===pn)if(Ve.tag===4&&Ve.stateNode.containerInfo===Ze.containerInfo&&Ve.stateNode.implementation===Ze.implementation){T(Je,Ve.sibling),Ve=M(Ve,Ze.children||[]),Ve.return=Je,Je=Ve;break e}else{T(Je,Ve);break}else g(Je,Ve);Ve=Ve.sibling}Ve=Ub(Ze,Je.mode,Nt),Ve.return=Je,Je=Ve}return ae(Je);case rt:return pn=Ze._init,Ji(Je,Ve,pn(Ze._payload),Nt)}if(Ke(Ze))return en(Je,Ve,Ze,Nt);if(ye(Ze))return tn(Je,Ve,Ze,Nt);fy(Je,Ze)}return typeof Ze=="string"&&Ze!==""||typeof Ze=="number"?(Ze=""+Ze,Ve!==null&&Ve.tag===6?(T(Je,Ve.sibling),Ve=M(Ve,Ze),Ve.return=Je,Je=Ve):(T(Je,Ve),Ve=Mb(Ze,Je.mode,Nt),Ve.return=Je,Je=Ve),ae(Je)):T(Je,Ve)}return Ji}var om=Jd(!0),WC=Jd(!1),py=vc(null),Xg=null,sm=null,my=null;function eb(){my=sm=Xg=null}function tb(f){var g=py.current;Ri(py),f._currentValue=g}function nb(f,g,T){for(;f!==null;){var O=f.alternate;if((f.childLanes&g)!==g?(f.childLanes|=g,O!==null&&(O.childLanes|=g)):O!==null&&(O.childLanes&g)!==g&&(O.childLanes|=g),f===T)break;f=f.return}}function Ju(f,g){Xg=f,my=sm=null,f=f.dependencies,f!==null&&f.firstContext!==null&&((f.lanes&g)!==0&&(Ea=!0),f.firstContext=null)}function Tc(f){var g=f._currentValue;if(my!==f)if(f={context:f,memoizedValue:g,next:null},sm===null){if(Xg===null)throw Error(i(308));sm=f,Xg.dependencies={lanes:0,firstContext:f}}else sm=sm.next=f;return g}var Cf=null;function rb(f){Cf===null?Cf=[f]:Cf.push(f)}function zC(f,g,T,O){var M=g.interleaved;return M===null?(T.next=T,rb(g)):(T.next=M.next,M.next=T),g.interleaved=T,Qu(f,O)}function Qu(f,g){f.lanes|=g;var T=f.alternate;for(T!==null&&(T.lanes|=g),T=f,f=f.return;f!==null;)f.childLanes|=g,T=f.alternate,T!==null&&(T.childLanes|=g),T=f,f=f.return;return T.tag===3?T.stateNode:null}var Qd=!1;function Jg(f){f.updateQueue={baseState:f.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function GC(f,g){f=f.updateQueue,g.updateQueue===f&&(g.updateQueue={baseState:f.baseState,firstBaseUpdate:f.firstBaseUpdate,lastBaseUpdate:f.lastBaseUpdate,shared:f.shared,effects:f.effects})}function Kl(f,g){return{eventTime:f,lane:g,tag:0,payload:null,callback:null,next:null}}function Zd(f,g,T){var O=f.updateQueue;if(O===null)return null;if(O=O.shared,(Tr&2)!==0){var M=O.pending;return M===null?g.next=g:(g.next=M.next,M.next=g),O.pending=g,Qu(f,T)}return M=O.interleaved,M===null?(g.next=g,rb(O)):(g.next=M.next,M.next=g),O.interleaved=g,Qu(f,T)}function Qg(f,g,T){if(g=g.updateQueue,g!==null&&(g=g.shared,(T&4194240)!==0)){var O=g.lanes;O&=f.pendingLanes,T|=O,g.lanes=T,Ha(f,T)}}function HC(f,g){var T=f.updateQueue,O=f.alternate;if(O!==null&&(O=O.updateQueue,T===O)){var M=null,G=null;if(T=T.firstBaseUpdate,T!==null){do{var ae={eventTime:T.eventTime,lane:T.lane,tag:T.tag,payload:T.payload,callback:T.callback,next:null};G===null?M=G=ae:G=G.next=ae,T=T.next}while(T!==null);G===null?M=G=g:G=G.next=g}else M=G=g;T={baseState:O.baseState,firstBaseUpdate:M,lastBaseUpdate:G,shared:O.shared,effects:O.effects},f.updateQueue=T;return}f=T.lastBaseUpdate,f===null?T.firstBaseUpdate=g:f.next=g,T.lastBaseUpdate=g}function gy(f,g,T,O){var M=f.updateQueue;Qd=!1;var G=M.firstBaseUpdate,ae=M.lastBaseUpdate,Ie=M.shared.pending;if(Ie!==null){M.shared.pending=null;var xe=Ie,it=xe.next;xe.next=null,ae===null?G=it:ae.next=it,ae=xe;var At=f.alternate;At!==null&&(At=At.updateQueue,Ie=At.lastBaseUpdate,Ie!==ae&&(Ie===null?At.firstBaseUpdate=it:Ie.next=it,At.lastBaseUpdate=xe))}if(G!==null){var Pt=M.baseState;ae=0,At=it=xe=null,Ie=G;do{var Ct=Ie.lane,Gt=Ie.eventTime;if((O&Ct)===Ct){At!==null&&(At=At.next={eventTime:Gt,lane:0,tag:Ie.tag,payload:Ie.payload,callback:Ie.callback,next:null});e:{var en=f,tn=Ie;switch(Ct=g,Gt=T,tn.tag){case 1:if(en=tn.payload,typeof en=="function"){Pt=en.call(Gt,Pt,Ct);break e}Pt=en;break e;case 3:en.flags=en.flags&-65537|128;case 0:if(en=tn.payload,Ct=typeof en=="function"?en.call(Gt,Pt,Ct):en,Ct==null)break e;Pt=Ne({},Pt,Ct);break e;case 2:Qd=!0}}Ie.callback!==null&&Ie.lane!==0&&(f.flags|=64,Ct=M.effects,Ct===null?M.effects=[Ie]:Ct.push(Ie))}else Gt={eventTime:Gt,lane:Ct,tag:Ie.tag,payload:Ie.payload,callback:Ie.callback,next:null},At===null?(it=At=Gt,xe=Pt):At=At.next=Gt,ae|=Ct;if(Ie=Ie.next,Ie===null){if(Ie=M.shared.pending,Ie===null)break;Ct=Ie,Ie=Ct.next,Ct.next=null,M.lastBaseUpdate=Ct,M.shared.pending=null}}while(!0);if(At===null&&(xe=Pt),M.baseState=xe,M.firstBaseUpdate=it,M.lastBaseUpdate=At,g=M.shared.interleaved,g!==null){M=g;do ae|=M.lane,M=M.next;while(M!==g)}else G===null&&(M.shared.lanes=0);Nf|=ae,f.lanes=ae,f.memoizedState=Pt}}function $C(f,g,T){if(f=g.effects,g.effects=null,f!==null)for(g=0;g<f.length;g++){var O=f[g],M=O.callback;if(M!==null){if(O.callback=null,O=T,typeof M!="function")throw Error(i(191,M));M.call(O)}}}var Zg={},ql=vc(Zg),e_=vc(Zg),am=vc(Zg);function If(f){if(f===Zg)throw Error(i(174));return f}function ib(f,g){switch(gi(am,g),gi(e_,f),gi(ql,Zg),f=g.nodeType,f){case 9:case 11:g=(g=g.documentElement)?g.namespaceURI:an(null,"");break;default:f=f===8?g.parentNode:g,g=f.namespaceURI||null,f=f.tagName,g=an(g,f)}Ri(ql),gi(ql,g)}function Af(){Ri(ql),Ri(e_),Ri(am)}function KC(f){If(am.current);var g=If(ql.current),T=an(g,f.type);g!==T&&(gi(e_,f),gi(ql,T))}function cm(f){e_.current===f&&(Ri(ql),Ri(e_))}var Oi=vc(0);function eh(f){for(var g=f;g!==null;){if(g.tag===13){var T=g.memoizedState;if(T!==null&&(T=T.dehydrated,T===null||T.data==="$?"||T.data==="$!"))return g}else if(g.tag===19&&g.memoizedProps.revealOrder!==void 0){if((g.flags&128)!==0)return g}else if(g.child!==null){g.child.return=g,g=g.child;continue}if(g===f)break;for(;g.sibling===null;){if(g.return===null||g.return===f)return null;g=g.return}g.sibling.return=g.return,g=g.sibling}return null}var ob=[];function sb(){for(var f=0;f<ob.length;f++)ob[f]._workInProgressVersionPrimary=null;ob.length=0}var _y=le.ReactCurrentDispatcher,ab=le.ReactCurrentBatchConfig,Yl=0,Ui=null,po=null,mo=null,lm=!1,t_=!1,n_=0,x1=0;function ps(){throw Error(i(321))}function cb(f,g){if(g===null)return!1;for(var T=0;T<g.length&&T<f.length;T++)if(!dl(f[T],g[T]))return!1;return!0}function um(f,g,T,O,M,G){if(Yl=G,Ui=g,g.memoizedState=null,g.updateQueue=null,g.lanes=0,_y.current=f===null||f.memoizedState===null?V1:iI,f=T(O,M),t_){G=0;do{if(t_=!1,n_=0,25<=G)throw Error(i(301));G+=1,mo=po=null,g.updateQueue=null,_y.current=F1,f=T(O,M)}while(t_)}if(_y.current=Sy,g=po!==null&&po.next!==null,Yl=0,mo=po=Ui=null,lm=!1,g)throw Error(i(300));return f}function lb(){var f=n_!==0;return n_=0,f}function Bs(){var f={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return mo===null?Ui.memoizedState=mo=f:mo=mo.next=f,mo}function _a(){if(po===null){var f=Ui.alternate;f=f!==null?f.memoizedState:null}else f=po.next;var g=mo===null?Ui.memoizedState:mo.next;if(g!==null)mo=g,po=f;else{if(f===null)throw Error(i(310));po=f,f={memoizedState:po.memoizedState,baseState:po.baseState,baseQueue:po.baseQueue,queue:po.queue,next:null},mo===null?Ui.memoizedState=mo=f:mo=mo.next=f}return mo}function th(f,g){return typeof g=="function"?g(f):g}function Pf(f){var g=_a(),T=g.queue;if(T===null)throw Error(i(311));T.lastRenderedReducer=f;var O=po,M=O.baseQueue,G=T.pending;if(G!==null){if(M!==null){var ae=M.next;M.next=G.next,G.next=ae}O.baseQueue=M=G,T.pending=null}if(M!==null){G=M.next,O=O.baseState;var Ie=ae=null,xe=null,it=G;do{var At=it.lane;if((Yl&At)===At)xe!==null&&(xe=xe.next={lane:0,action:it.action,hasEagerState:it.hasEagerState,eagerState:it.eagerState,next:null}),O=it.hasEagerState?it.eagerState:f(O,it.action);else{var Pt={lane:At,action:it.action,hasEagerState:it.hasEagerState,eagerState:it.eagerState,next:null};xe===null?(Ie=xe=Pt,ae=O):xe=xe.next=Pt,Ui.lanes|=At,Nf|=At}it=it.next}while(it!==null&&it!==G);xe===null?ae=O:xe.next=Ie,dl(O,g.memoizedState)||(Ea=!0),g.memoizedState=O,g.baseState=ae,g.baseQueue=xe,T.lastRenderedState=O}if(f=T.interleaved,f!==null){M=f;do G=M.lane,Ui.lanes|=G,Nf|=G,M=M.next;while(M!==f)}else M===null&&(T.lanes=0);return[g.memoizedState,T.dispatch]}function dm(f){var g=_a(),T=g.queue;if(T===null)throw Error(i(311));T.lastRenderedReducer=f;var O=T.dispatch,M=T.pending,G=g.memoizedState;if(M!==null){T.pending=null;var ae=M=M.next;do G=f(G,ae.action),ae=ae.next;while(ae!==M);dl(G,g.memoizedState)||(Ea=!0),g.memoizedState=G,g.baseQueue===null&&(g.baseState=G),T.lastRenderedState=G}return[G,O]}function qC(){}function ub(f,g){var T=Ui,O=_a(),M=g(),G=!dl(O.memoizedState,M);if(G&&(O.memoizedState=M,Ea=!0),O=O.queue,wc(XC.bind(null,T,O,f),[f]),O.getSnapshot!==g||G||mo!==null&&mo.memoizedState.tag&1){if(T.flags|=2048,r_(9,db.bind(null,T,O,M,g),void 0,null),Wo===null)throw Error(i(349));(Yl&30)!==0||YC(T,g,M)}return M}function YC(f,g,T){f.flags|=16384,f={getSnapshot:g,value:T},g=Ui.updateQueue,g===null?(g={lastEffect:null,stores:null},Ui.updateQueue=g,g.stores=[f]):(T=g.stores,T===null?g.stores=[f]:T.push(f))}function db(f,g,T,O){g.value=T,g.getSnapshot=O,JC(g)&&Ey(f)}function XC(f,g,T){return T(function(){JC(g)&&Ey(f)})}function JC(f){var g=f.getSnapshot;f=f.value;try{var T=g();return!dl(f,T)}catch{return!0}}function Ey(f){var g=Qu(f,1);g!==null&&Ac(g,f,1,-1)}function yy(f){var g=Bs();return typeof f=="function"&&(f=f()),g.memoizedState=g.baseState=f,f={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:th,lastRenderedState:f},g.queue=f,f=f.dispatch=U1.bind(null,Ui,f),[g.memoizedState,f]}function r_(f,g,T,O){return f={tag:f,create:g,destroy:T,deps:O,next:null},g=Ui.updateQueue,g===null?(g={lastEffect:null,stores:null},Ui.updateQueue=g,g.lastEffect=f.next=f):(T=g.lastEffect,T===null?g.lastEffect=f.next=f:(O=T.next,T.next=f,f.next=O,g.lastEffect=f)),f}function QC(){return _a().memoizedState}function i_(f,g,T,O){var M=Bs();Ui.flags|=f,M.memoizedState=r_(1|g,T,void 0,O===void 0?null:O)}function hm(f,g,T,O){var M=_a();O=O===void 0?null:O;var G=void 0;if(po!==null){var ae=po.memoizedState;if(G=ae.destroy,O!==null&&cb(O,ae.deps)){M.memoizedState=r_(g,T,G,O);return}}Ui.flags|=f,M.memoizedState=r_(1|g,T,G,O)}function ZC(f,g){return i_(8390656,8,f,g)}function wc(f,g){return hm(2048,8,f,g)}function Of(f,g){return hm(4,2,f,g)}function nh(f,g){return hm(4,4,f,g)}function hb(f,g){if(typeof g=="function")return f=f(),g(f),function(){g(null)};if(g!=null)return f=f(),g.current=f,function(){g.current=null}}function fb(f,g,T){return T=T!=null?T.concat([f]):null,hm(4,4,hb.bind(null,g,f),T)}function Zu(){}function vy(f,g){var T=_a();g=g===void 0?null:g;var O=T.memoizedState;return O!==null&&g!==null&&cb(g,O[1])?O[0]:(T.memoizedState=[f,g],f)}function eI(f,g){var T=_a();g=g===void 0?null:g;var O=T.memoizedState;return O!==null&&g!==null&&cb(g,O[1])?O[0]:(f=f(),T.memoizedState=[f,g],f)}function pb(f,g,T){return(Yl&21)===0?(f.baseState&&(f.baseState=!1,Ea=!0),f.memoizedState=T):(dl(T,g)||(T=ju(),Ui.lanes|=T,Nf|=T,f.baseState=!0),g)}function M1(f,g){var T=nr;nr=T!==0&&4>T?T:4,f(!0);var O=ab.transition;ab.transition={};try{f(!1),g()}finally{nr=T,ab.transition=O}}function mb(){return _a().memoizedState}function tI(f,g,T){var O=Ic(f);if(T={lane:O,action:T,hasEagerState:!1,eagerState:null,next:null},ed(f))nI(g,T);else if(T=zC(f,g,T,O),T!==null){var M=Zo();Ac(T,f,O,M),rI(T,g,O)}}function U1(f,g,T){var O=Ic(f),M={lane:O,action:T,hasEagerState:!1,eagerState:null,next:null};if(ed(f))nI(g,M);else{var G=f.alternate;if(f.lanes===0&&(G===null||G.lanes===0)&&(G=g.lastRenderedReducer,G!==null))try{var ae=g.lastRenderedState,Ie=G(ae,T);if(M.hasEagerState=!0,M.eagerState=Ie,dl(Ie,ae)){var xe=g.interleaved;xe===null?(M.next=M,rb(g)):(M.next=xe.next,xe.next=M),g.interleaved=M;return}}catch{}finally{}T=zC(f,g,M,O),T!==null&&(M=Zo(),Ac(T,f,O,M),rI(T,g,O))}}function ed(f){var g=f.alternate;return f===Ui||g!==null&&g===Ui}function nI(f,g){t_=lm=!0;var T=f.pending;T===null?g.next=g:(g.next=T.next,T.next=g),f.pending=g}function rI(f,g,T){if((T&4194240)!==0){var O=g.lanes;O&=f.pendingLanes,T|=O,g.lanes=T,Ha(f,T)}}var Sy={readContext:Tc,useCallback:ps,useContext:ps,useEffect:ps,useImperativeHandle:ps,useInsertionEffect:ps,useLayoutEffect:ps,useMemo:ps,useReducer:ps,useRef:ps,useState:ps,useDebugValue:ps,useDeferredValue:ps,useTransition:ps,useMutableSource:ps,useSyncExternalStore:ps,useId:ps,unstable_isNewReconciler:!1},V1={readContext:Tc,useCallback:function(f,g){return Bs().memoizedState=[f,g===void 0?null:g],f},useContext:Tc,useEffect:ZC,useImperativeHandle:function(f,g,T){return T=T!=null?T.concat([f]):null,i_(4194308,4,hb.bind(null,g,f),T)},useLayoutEffect:function(f,g){return i_(4194308,4,f,g)},useInsertionEffect:function(f,g){return i_(4,2,f,g)},useMemo:function(f,g){var T=Bs();return g=g===void 0?null:g,f=f(),T.memoizedState=[f,g],f},useReducer:function(f,g,T){var O=Bs();return g=T!==void 0?T(g):g,O.memoizedState=O.baseState=g,f={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:f,lastRenderedState:g},O.queue=f,f=f.dispatch=tI.bind(null,Ui,f),[O.memoizedState,f]},useRef:function(f){var g=Bs();return f={current:f},g.memoizedState=f},useState:yy,useDebugValue:Zu,useDeferredValue:function(f){return Bs().memoizedState=f},useTransition:function(){var f=yy(!1),g=f[0];return f=M1.bind(null,f[1]),Bs().memoizedState=f,[g,f]},useMutableSource:function(){},useSyncExternalStore:function(f,g,T){var O=Ui,M=Bs();if(si){if(T===void 0)throw Error(i(407));T=T()}else{if(T=g(),Wo===null)throw Error(i(349));(Yl&30)!==0||YC(O,g,T)}M.memoizedState=T;var G={value:T,getSnapshot:g};return M.queue=G,ZC(XC.bind(null,O,G,f),[f]),O.flags|=2048,r_(9,db.bind(null,O,G,T,g),void 0,null),T},useId:function(){var f=Bs(),g=Wo.identifierPrefix;if(si){var T=Yu,O=qu;T=(O&~(1<<32-Xo(O)-1)).toString(32)+T,g=":"+g+"R"+T,T=n_++,0<T&&(g+="H"+T.toString(32)),g+=":"}else T=x1++,g=":"+g+"r"+T.toString(32)+":";return f.memoizedState=g},unstable_isNewReconciler:!1},iI={readContext:Tc,useCallback:vy,useContext:Tc,useEffect:wc,useImperativeHandle:fb,useInsertionEffect:Of,useLayoutEffect:nh,useMemo:eI,useReducer:Pf,useRef:QC,useState:function(){return Pf(th)},useDebugValue:Zu,useDeferredValue:function(f){var g=_a();return pb(g,po.memoizedState,f)},useTransition:function(){var f=Pf(th)[0],g=_a().memoizedState;return[f,g]},useMutableSource:qC,useSyncExternalStore:ub,useId:mb,unstable_isNewReconciler:!1},F1={readContext:Tc,useCallback:vy,useContext:Tc,useEffect:wc,useImperativeHandle:fb,useInsertionEffect:Of,useLayoutEffect:nh,useMemo:eI,useReducer:dm,useRef:QC,useState:function(){return dm(th)},useDebugValue:Zu,useDeferredValue:function(f){var g=_a();return po===null?g.memoizedState=f:pb(g,po.memoizedState,f)},useTransition:function(){var f=dm(th)[0],g=_a().memoizedState;return[f,g]},useMutableSource:qC,useSyncExternalStore:ub,useId:mb,unstable_isNewReconciler:!1};function Xa(f,g){if(f&&f.defaultProps){g=Ne({},g),f=f.defaultProps;for(var T in f)g[T]===void 0&&(g[T]=f[T]);return g}return g}function by(f,g,T,O){g=f.memoizedState,T=T(O,g),T=T==null?g:Ne({},g,T),f.memoizedState=T,f.lanes===0&&(f.updateQueue.baseState=T)}var Ty={isMounted:function(f){return(f=f._reactInternals)?jo(f)===f:!1},enqueueSetState:function(f,g,T){f=f._reactInternals;var O=Zo(),M=Ic(f),G=Kl(O,M);G.payload=g,T!=null&&(G.callback=T),g=Zd(f,G,M),g!==null&&(Ac(g,f,M,O),Qg(g,f,M))},enqueueReplaceState:function(f,g,T){f=f._reactInternals;var O=Zo(),M=Ic(f),G=Kl(O,M);G.tag=1,G.payload=g,T!=null&&(G.callback=T),g=Zd(f,G,M),g!==null&&(Ac(g,f,M,O),Qg(g,f,M))},enqueueForceUpdate:function(f,g){f=f._reactInternals;var T=Zo(),O=Ic(f),M=Kl(T,O);M.tag=2,g!=null&&(M.callback=g),g=Zd(f,M,O),g!==null&&(Ac(g,f,O,T),Qg(g,f,O))}};function gb(f,g,T,O,M,G,ae){return f=f.stateNode,typeof f.shouldComponentUpdate=="function"?f.shouldComponentUpdate(O,G,ae):g.prototype&&g.prototype.isPureReactComponent?!Ug(T,O)||!Ug(M,G):!0}function oI(f,g,T){var O=!1,M=Yd,G=g.contextType;return typeof G=="object"&&G!==null?G=Tc(G):(M=pa(g)?Tf:fs.current,O=g.contextTypes,G=(O=O!=null)?wf(f,M):Yd),g=new g(T,G),f.memoizedState=g.state!==null&&g.state!==void 0?g.state:null,g.updater=Ty,f.stateNode=g,g._reactInternals=f,O&&(f=f.stateNode,f.__reactInternalMemoizedUnmaskedChildContext=M,f.__reactInternalMemoizedMaskedChildContext=G),g}function sI(f,g,T,O){f=g.state,typeof g.componentWillReceiveProps=="function"&&g.componentWillReceiveProps(T,O),typeof g.UNSAFE_componentWillReceiveProps=="function"&&g.UNSAFE_componentWillReceiveProps(T,O),g.state!==f&&Ty.enqueueReplaceState(g,g.state,null)}function _b(f,g,T,O){var M=f.stateNode;M.props=T,M.state=f.memoizedState,M.refs={},Jg(f);var G=g.contextType;typeof G=="object"&&G!==null?M.context=Tc(G):(G=pa(g)?Tf:fs.current,M.context=wf(f,G)),M.state=f.memoizedState,G=g.getDerivedStateFromProps,typeof G=="function"&&(by(f,g,G,T),M.state=f.memoizedState),typeof g.getDerivedStateFromProps=="function"||typeof M.getSnapshotBeforeUpdate=="function"||typeof M.UNSAFE_componentWillMount!="function"&&typeof M.componentWillMount!="function"||(g=M.state,typeof M.componentWillMount=="function"&&M.componentWillMount(),typeof M.UNSAFE_componentWillMount=="function"&&M.UNSAFE_componentWillMount(),g!==M.state&&Ty.enqueueReplaceState(M,M.state,null),gy(f,T,M,O),M.state=f.memoizedState),typeof M.componentDidMount=="function"&&(f.flags|=4194308)}function fm(f,g){try{var T="",O=g;do T+=ze(O),O=O.return;while(O);var M=T}catch(G){M=`
Error generating stack: `+G.message+`
`+G.stack}return{value:f,source:g,stack:M,digest:null}}function Eb(f,g,T){return{value:f,source:null,stack:T??null,digest:g??null}}function yb(f,g){try{console.error(g.value)}catch(T){setTimeout(function(){throw T})}}var j1=typeof WeakMap=="function"?WeakMap:Map;function vb(f,g,T){T=Kl(-1,T),T.tag=3,T.payload={element:null};var O=g.value;return T.callback=function(){By||(By=!0,kb=O),yb(f,g)},T}function td(f,g,T){T=Kl(-1,T),T.tag=3;var O=f.type.getDerivedStateFromError;if(typeof O=="function"){var M=g.value;T.payload=function(){return O(M)},T.callback=function(){yb(f,g)}}var G=f.stateNode;return G!==null&&typeof G.componentDidCatch=="function"&&(T.callback=function(){yb(f,g),typeof O!="function"&&(rh===null?rh=new Set([this]):rh.add(this));var ae=g.stack;this.componentDidCatch(g.value,{componentStack:ae!==null?ae:""})}),T}function aI(f,g,T){var O=f.pingCache;if(O===null){O=f.pingCache=new j1;var M=new Set;O.set(g,M)}else M=O.get(g),M===void 0&&(M=new Set,O.set(g,M));M.has(T)||(M.add(T),f=kI.bind(null,f,g,T),g.then(f,f))}function cI(f){do{var g;if((g=f.tag===13)&&(g=f.memoizedState,g=g!==null?g.dehydrated!==null:!0),g)return f;f=f.return}while(f!==null);return null}function lI(f,g,T,O,M){return(f.mode&1)===0?(f===g?f.flags|=65536:(f.flags|=128,T.flags|=131072,T.flags&=-52805,T.tag===1&&(T.alternate===null?T.tag=17:(g=Kl(-1,1),g.tag=2,Zd(T,g,1))),T.lanes|=1),f):(f.flags|=65536,f.lanes=M,f)}var B1=le.ReactCurrentOwner,Ea=!1;function Ws(f,g,T,O){g.child=f===null?WC(g,null,T,O):om(g,f.child,T,O)}function wy(f,g,T,O,M){T=T.render;var G=g.ref;return Ju(g,M),O=um(f,g,T,O,G,M),T=lb(),f!==null&&!Ea?(g.updateQueue=f.updateQueue,g.flags&=-2053,f.lanes&=~M,Xl(f,g,M)):(si&&T&&dy(g),g.flags|=1,Ws(f,g,O,M),g.child)}function uI(f,g,T,O,M){if(f===null){var G=T.type;return typeof G=="function"&&!oh(G)&&G.defaultProps===void 0&&T.compare===null&&T.defaultProps===void 0?(g.tag=15,g.type=G,dI(f,g,G,O,M)):(f=Zy(T.type,null,O,g,g.mode,M),f.ref=g.ref,f.return=g,g.child=f)}if(G=f.child,(f.lanes&M)===0){var ae=G.memoizedProps;if(T=T.compare,T=T!==null?T:Ug,T(ae,O)&&f.ref===g.ref)return Xl(f,g,M)}return g.flags|=1,f=id(G,O),f.ref=g.ref,f.return=g,g.child=f}function dI(f,g,T,O,M){if(f!==null){var G=f.memoizedProps;if(Ug(G,O)&&f.ref===g.ref)if(Ea=!1,g.pendingProps=O=G,(f.lanes&M)!==0)(f.flags&131072)!==0&&(Ea=!0);else return g.lanes=f.lanes,Xl(f,g,M)}return Sb(f,g,T,O,M)}function hI(f,g,T){var O=g.pendingProps,M=O.children,G=f!==null?f.memoizedState:null;if(O.mode==="hidden")if((g.mode&1)===0)g.memoizedState={baseLanes:0,cachePool:null,transitions:null},gi(hl,Ja),Ja|=T;else{if((T&1073741824)===0)return f=G!==null?G.baseLanes|T:T,g.lanes=g.childLanes=1073741824,g.memoizedState={baseLanes:f,cachePool:null,transitions:null},g.updateQueue=null,gi(hl,Ja),Ja|=f,null;g.memoizedState={baseLanes:0,cachePool:null,transitions:null},O=G!==null?G.baseLanes:T,gi(hl,Ja),Ja|=O}else G!==null?(O=G.baseLanes|T,g.memoizedState=null):O=T,gi(hl,Ja),Ja|=O;return Ws(f,g,M,T),g.child}function fI(f,g){var T=g.ref;(f===null&&T!==null||f!==null&&f.ref!==T)&&(g.flags|=512,g.flags|=2097152)}function Sb(f,g,T,O,M){var G=pa(T)?Tf:fs.current;return G=wf(g,G),Ju(g,M),T=um(f,g,T,O,G,M),O=lb(),f!==null&&!Ea?(g.updateQueue=f.updateQueue,g.flags&=-2053,f.lanes&=~M,Xl(f,g,M)):(si&&O&&dy(g),g.flags|=1,Ws(f,g,T,M),g.child)}function pI(f,g,T,O,M){if(pa(T)){var G=!0;ay(g)}else G=!1;if(Ju(g,M),g.stateNode===null)Oy(f,g),oI(g,T,O),_b(g,T,O,M),O=!0;else if(f===null){var ae=g.stateNode,Ie=g.memoizedProps;ae.props=Ie;var xe=ae.context,it=T.contextType;typeof it=="object"&&it!==null?it=Tc(it):(it=pa(T)?Tf:fs.current,it=wf(g,it));var At=T.getDerivedStateFromProps,Pt=typeof At=="function"||typeof ae.getSnapshotBeforeUpdate=="function";Pt||typeof ae.UNSAFE_componentWillReceiveProps!="function"&&typeof ae.componentWillReceiveProps!="function"||(Ie!==O||xe!==it)&&sI(g,ae,O,it),Qd=!1;var Ct=g.memoizedState;ae.state=Ct,gy(g,O,ae,M),xe=g.memoizedState,Ie!==O||Ct!==xe||fa.current||Qd?(typeof At=="function"&&(by(g,T,At,O),xe=g.memoizedState),(Ie=Qd||gb(g,T,Ie,O,Ct,xe,it))?(Pt||typeof ae.UNSAFE_componentWillMount!="function"&&typeof ae.componentWillMount!="function"||(typeof ae.componentWillMount=="function"&&ae.componentWillMount(),typeof ae.UNSAFE_componentWillMount=="function"&&ae.UNSAFE_componentWillMount()),typeof ae.componentDidMount=="function"&&(g.flags|=4194308)):(typeof ae.componentDidMount=="function"&&(g.flags|=4194308),g.memoizedProps=O,g.memoizedState=xe),ae.props=O,ae.state=xe,ae.context=it,O=Ie):(typeof ae.componentDidMount=="function"&&(g.flags|=4194308),O=!1)}else{ae=g.stateNode,GC(f,g),Ie=g.memoizedProps,it=g.type===g.elementType?Ie:Xa(g.type,Ie),ae.props=it,Pt=g.pendingProps,Ct=ae.context,xe=T.contextType,typeof xe=="object"&&xe!==null?xe=Tc(xe):(xe=pa(T)?Tf:fs.current,xe=wf(g,xe));var Gt=T.getDerivedStateFromProps;(At=typeof Gt=="function"||typeof ae.getSnapshotBeforeUpdate=="function")||typeof ae.UNSAFE_componentWillReceiveProps!="function"&&typeof ae.componentWillReceiveProps!="function"||(Ie!==Pt||Ct!==xe)&&sI(g,ae,O,xe),Qd=!1,Ct=g.memoizedState,ae.state=Ct,gy(g,O,ae,M);var en=g.memoizedState;Ie!==Pt||Ct!==en||fa.current||Qd?(typeof Gt=="function"&&(by(g,T,Gt,O),en=g.memoizedState),(it=Qd||gb(g,T,it,O,Ct,en,xe)||!1)?(At||typeof ae.UNSAFE_componentWillUpdate!="function"&&typeof ae.componentWillUpdate!="function"||(typeof ae.componentWillUpdate=="function"&&ae.componentWillUpdate(O,en,xe),typeof ae.UNSAFE_componentWillUpdate=="function"&&ae.UNSAFE_componentWillUpdate(O,en,xe)),typeof ae.componentDidUpdate=="function"&&(g.flags|=4),typeof ae.getSnapshotBeforeUpdate=="function"&&(g.flags|=1024)):(typeof ae.componentDidUpdate!="function"||Ie===f.memoizedProps&&Ct===f.memoizedState||(g.flags|=4),typeof ae.getSnapshotBeforeUpdate!="function"||Ie===f.memoizedProps&&Ct===f.memoizedState||(g.flags|=1024),g.memoizedProps=O,g.memoizedState=en),ae.props=O,ae.state=en,ae.context=xe,O=it):(typeof ae.componentDidUpdate!="function"||Ie===f.memoizedProps&&Ct===f.memoizedState||(g.flags|=4),typeof ae.getSnapshotBeforeUpdate!="function"||Ie===f.memoizedProps&&Ct===f.memoizedState||(g.flags|=1024),O=!1)}return Ry(f,g,T,O,G,M)}function Ry(f,g,T,O,M,G){fI(f,g);var ae=(g.flags&128)!==0;if(!O&&!ae)return M&&MC(g,T,!1),Xl(f,g,G);O=g.stateNode,B1.current=g;var Ie=ae&&typeof T.getDerivedStateFromError!="function"?null:O.render();return g.flags|=1,f!==null&&ae?(g.child=om(g,f.child,null,G),g.child=om(g,null,Ie,G)):Ws(f,g,Ie,G),g.memoizedState=O.state,M&&MC(g,T,!0),g.child}function bb(f){var g=f.stateNode;g.pendingContext?xC(f,g.pendingContext,g.pendingContext!==g.context):g.context&&xC(f,g.context,!1),ib(f,g.containerInfo)}function mI(f,g,T,O,M){return im(),Q0(M),g.flags|=256,Ws(f,g,T,O),g.child}var Tb={dehydrated:null,treeContext:null,retryLane:0};function pm(f){return{baseLanes:f,cachePool:null,transitions:null}}function Cy(f,g,T){var O=g.pendingProps,M=Oi.current,G=!1,ae=(g.flags&128)!==0,Ie;if((Ie=ae)||(Ie=f!==null&&f.memoizedState===null?!1:(M&2)!==0),Ie?(G=!0,g.flags&=-129):(f===null||f.memoizedState!==null)&&(M|=1),gi(Oi,M&1),f===null)return J0(g),f=g.memoizedState,f!==null&&(f=f.dehydrated,f!==null)?((g.mode&1)===0?g.lanes=1:f.data==="$!"?g.lanes=8:g.lanes=1073741824,null):(ae=O.children,f=O.fallback,G?(O=g.mode,G=g.child,ae={mode:"hidden",children:ae},(O&1)===0&&G!==null?(G.childLanes=0,G.pendingProps=ae):G=sh(ae,O,0,null),f=Uf(f,O,T,null),G.return=g,f.return=g,G.sibling=f,g.child=G,g.child.memoizedState=pm(T),g.memoizedState=Tb,f):Iy(g,ae));if(M=f.memoizedState,M!==null&&(Ie=M.dehydrated,Ie!==null))return gI(f,g,ae,O,Ie,M,T);if(G){G=O.fallback,ae=g.mode,M=f.child,Ie=M.sibling;var xe={mode:"hidden",children:O.children};return(ae&1)===0&&g.child!==M?(O=g.child,O.childLanes=0,O.pendingProps=xe,g.deletions=null):(O=id(M,xe),O.subtreeFlags=M.subtreeFlags&14680064),Ie!==null?G=id(Ie,G):(G=Uf(G,ae,T,null),G.flags|=2),G.return=g,O.return=g,O.sibling=G,g.child=O,O=G,G=g.child,ae=f.child.memoizedState,ae=ae===null?pm(T):{baseLanes:ae.baseLanes|T,cachePool:null,transitions:ae.transitions},G.memoizedState=ae,G.childLanes=f.childLanes&~T,g.memoizedState=Tb,O}return G=f.child,f=G.sibling,O=id(G,{mode:"visible",children:O.children}),(g.mode&1)===0&&(O.lanes=T),O.return=g,O.sibling=null,f!==null&&(T=g.deletions,T===null?(g.deletions=[f],g.flags|=16):T.push(f)),g.child=O,g.memoizedState=null,O}function Iy(f,g){return g=sh({mode:"visible",children:g},f.mode,0,null),g.return=f,f.child=g}function kf(f,g,T,O){return O!==null&&Q0(O),om(g,f.child,null,T),f=Iy(g,g.pendingProps.children),f.flags|=2,g.memoizedState=null,f}function gI(f,g,T,O,M,G,ae){if(T)return g.flags&256?(g.flags&=-257,O=Eb(Error(i(422))),kf(f,g,ae,O)):g.memoizedState!==null?(g.child=f.child,g.flags|=128,null):(G=O.fallback,M=g.mode,O=sh({mode:"visible",children:O.children},M,0,null),G=Uf(G,M,ae,null),G.flags|=2,O.return=g,G.return=g,O.sibling=G,g.child=O,(g.mode&1)!==0&&om(g,f.child,null,ae),g.child.memoizedState=pm(ae),g.memoizedState=Tb,G);if((g.mode&1)===0)return kf(f,g,ae,null);if(M.data==="$!"){if(O=M.nextSibling&&M.nextSibling.dataset,O)var Ie=O.dgst;return O=Ie,G=Error(i(419)),O=Eb(G,O,void 0),kf(f,g,ae,O)}if(Ie=(ae&f.childLanes)!==0,Ea||Ie){if(O=Wo,O!==null){switch(ae&-ae){case 4:M=2;break;case 16:M=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:M=32;break;case 536870912:M=268435456;break;default:M=0}M=(M&(O.suspendedLanes|ae))!==0?0:M,M!==0&&M!==G.retryLane&&(G.retryLane=M,Qu(f,M),Ac(O,f,M,-1))}return Lb(),O=Eb(Error(i(421))),kf(f,g,ae,O)}return M.data==="$?"?(g.flags|=128,g.child=f.child,g=Xy.bind(null,f),M._reactRetry=g,null):(f=G.treeContext,ga=Kd(M.nextSibling),ma=g,si=!0,js=null,f!==null&&(bc[Ya++]=qu,bc[Ya++]=Yu,bc[Ya++]=Rf,qu=f.id,Yu=f.overflow,Rf=g),g=Iy(g,O.children),g.flags|=4096,g)}function _I(f,g,T){f.lanes|=g;var O=f.alternate;O!==null&&(O.lanes|=g),nb(f.return,g,T)}function Ay(f,g,T,O,M){var G=f.memoizedState;G===null?f.memoizedState={isBackwards:g,rendering:null,renderingStartTime:0,last:O,tail:T,tailMode:M}:(G.isBackwards=g,G.rendering=null,G.renderingStartTime=0,G.last=O,G.tail=T,G.tailMode=M)}function Py(f,g,T){var O=g.pendingProps,M=O.revealOrder,G=O.tail;if(Ws(f,g,O.children,T),O=Oi.current,(O&2)!==0)O=O&1|2,g.flags|=128;else{if(f!==null&&(f.flags&128)!==0)e:for(f=g.child;f!==null;){if(f.tag===13)f.memoizedState!==null&&_I(f,T,g);else if(f.tag===19)_I(f,T,g);else if(f.child!==null){f.child.return=f,f=f.child;continue}if(f===g)break e;for(;f.sibling===null;){if(f.return===null||f.return===g)break e;f=f.return}f.sibling.return=f.return,f=f.sibling}O&=1}if(gi(Oi,O),(g.mode&1)===0)g.memoizedState=null;else switch(M){case"forwards":for(T=g.child,M=null;T!==null;)f=T.alternate,f!==null&&eh(f)===null&&(M=T),T=T.sibling;T=M,T===null?(M=g.child,g.child=null):(M=T.sibling,T.sibling=null),Ay(g,!1,M,T,G);break;case"backwards":for(T=null,M=g.child,g.child=null;M!==null;){if(f=M.alternate,f!==null&&eh(f)===null){g.child=M;break}f=M.sibling,M.sibling=T,T=M,M=f}Ay(g,!0,T,null,G);break;case"together":Ay(g,!1,null,null,void 0);break;default:g.memoizedState=null}return g.child}function Oy(f,g){(g.mode&1)===0&&f!==null&&(f.alternate=null,g.alternate=null,g.flags|=2)}function Xl(f,g,T){if(f!==null&&(g.dependencies=f.dependencies),Nf|=g.lanes,(T&g.childLanes)===0)return null;if(f!==null&&g.child!==f.child)throw Error(i(153));if(g.child!==null){for(f=g.child,T=id(f,f.pendingProps),g.child=T,T.return=g;f.sibling!==null;)f=f.sibling,T=T.sibling=id(f,f.pendingProps),T.return=g;T.sibling=null}return g.child}function EI(f,g,T){switch(g.tag){case 3:bb(g),im();break;case 5:KC(g);break;case 1:pa(g.type)&&ay(g);break;case 4:ib(g,g.stateNode.containerInfo);break;case 10:var O=g.type._context,M=g.memoizedProps.value;gi(py,O._currentValue),O._currentValue=M;break;case 13:if(O=g.memoizedState,O!==null)return O.dehydrated!==null?(gi(Oi,Oi.current&1),g.flags|=128,null):(T&g.child.childLanes)!==0?Cy(f,g,T):(gi(Oi,Oi.current&1),f=Xl(f,g,T),f!==null?f.sibling:null);gi(Oi,Oi.current&1);break;case 19:if(O=(T&g.childLanes)!==0,(f.flags&128)!==0){if(O)return Py(f,g,T);g.flags|=128}if(M=g.memoizedState,M!==null&&(M.rendering=null,M.tail=null,M.lastEffect=null),gi(Oi,Oi.current),O)break;return null;case 22:case 23:return g.lanes=0,hI(f,g,T)}return Xl(f,g,T)}var yI,ky,wb,vI;yI=function(f,g){for(var T=g.child;T!==null;){if(T.tag===5||T.tag===6)f.appendChild(T.stateNode);else if(T.tag!==4&&T.child!==null){T.child.return=T,T=T.child;continue}if(T===g)break;for(;T.sibling===null;){if(T.return===null||T.return===g)return;T=T.return}T.sibling.return=T.return,T=T.sibling}},ky=function(){},wb=function(f,g,T,O){var M=f.memoizedProps;if(M!==O){f=g.stateNode,If(ql.current);var G=null;switch(T){case"input":M=Ln(f,M),O=Ln(f,O),G=[];break;case"select":M=Ne({},M,{value:void 0}),O=Ne({},O,{value:void 0}),G=[];break;case"textarea":M=St(f,M),O=St(f,O),G=[];break;default:typeof M.onClick!="function"&&typeof O.onClick=="function"&&(f.onclick=ry)}Ba(T,O);var ae;T=null;for(it in M)if(!O.hasOwnProperty(it)&&M.hasOwnProperty(it)&&M[it]!=null)if(it==="style"){var Ie=M[it];for(ae in Ie)Ie.hasOwnProperty(ae)&&(T||(T={}),T[ae]="")}else it!=="dangerouslySetInnerHTML"&&it!=="children"&&it!=="suppressContentEditableWarning"&&it!=="suppressHydrationWarning"&&it!=="autoFocus"&&(l.hasOwnProperty(it)?G||(G=[]):(G=G||[]).push(it,null));for(it in O){var xe=O[it];if(Ie=M!=null?M[it]:void 0,O.hasOwnProperty(it)&&xe!==Ie&&(xe!=null||Ie!=null))if(it==="style")if(Ie){for(ae in Ie)!Ie.hasOwnProperty(ae)||xe&&xe.hasOwnProperty(ae)||(T||(T={}),T[ae]="");for(ae in xe)xe.hasOwnProperty(ae)&&Ie[ae]!==xe[ae]&&(T||(T={}),T[ae]=xe[ae])}else T||(G||(G=[]),G.push(it,T)),T=xe;else it==="dangerouslySetInnerHTML"?(xe=xe?xe.__html:void 0,Ie=Ie?Ie.__html:void 0,xe!=null&&Ie!==xe&&(G=G||[]).push(it,xe)):it==="children"?typeof xe!="string"&&typeof xe!="number"||(G=G||[]).push(it,""+xe):it!=="suppressContentEditableWarning"&&it!=="suppressHydrationWarning"&&(l.hasOwnProperty(it)?(xe!=null&&it==="onScroll"&&wi("scroll",f),G||Ie===xe||(G=[])):(G=G||[]).push(it,xe))}T&&(G=G||[]).push("style",T);var it=G;(g.updateQueue=it)&&(g.flags|=4)}},vI=function(f,g,T,O){T!==O&&(g.flags|=4)};function o_(f,g){if(!si)switch(f.tailMode){case"hidden":g=f.tail;for(var T=null;g!==null;)g.alternate!==null&&(T=g),g=g.sibling;T===null?f.tail=null:T.sibling=null;break;case"collapsed":T=f.tail;for(var O=null;T!==null;)T.alternate!==null&&(O=T),T=T.sibling;O===null?g||f.tail===null?f.tail=null:f.tail.sibling=null:O.sibling=null}}function ms(f){var g=f.alternate!==null&&f.alternate.child===f.child,T=0,O=0;if(g)for(var M=f.child;M!==null;)T|=M.lanes|M.childLanes,O|=M.subtreeFlags&14680064,O|=M.flags&14680064,M.return=f,M=M.sibling;else for(M=f.child;M!==null;)T|=M.lanes|M.childLanes,O|=M.subtreeFlags,O|=M.flags,M.return=f,M=M.sibling;return f.subtreeFlags|=O,f.childLanes=T,g}function Ny(f,g,T){var O=g.pendingProps;switch(Kg(g),g.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ms(g),null;case 1:return pa(g.type)&&oy(),ms(g),null;case 3:return O=g.stateNode,Af(),Ri(fa),Ri(fs),sb(),O.pendingContext&&(O.context=O.pendingContext,O.pendingContext=null),(f===null||f.child===null)&&(qg(g)?g.flags|=4:f===null||f.memoizedState.isDehydrated&&(g.flags&256)===0||(g.flags|=1024,js!==null&&($y(js),js=null))),ky(f,g),ms(g),null;case 5:cm(g);var M=If(am.current);if(T=g.type,f!==null&&g.stateNode!=null)wb(f,g,T,O,M),f.ref!==g.ref&&(g.flags|=512,g.flags|=2097152);else{if(!O){if(g.stateNode===null)throw Error(i(166));return ms(g),null}if(f=If(ql.current),qg(g)){O=g.stateNode,T=g.type;var G=g.memoizedProps;switch(O[$l]=g,O[qd]=G,f=(g.mode&1)!==0,T){case"dialog":wi("cancel",O),wi("close",O);break;case"iframe":case"object":case"embed":wi("load",O);break;case"video":case"audio":for(M=0;M<Bg.length;M++)wi(Bg[M],O);break;case"source":wi("error",O);break;case"img":case"image":case"link":wi("error",O),wi("load",O);break;case"details":wi("toggle",O);break;case"input":Xt(O,G),wi("invalid",O);break;case"select":O._wrapperState={wasMultiple:!!G.multiple},wi("invalid",O);break;case"textarea":Ge(O,G),wi("invalid",O)}Ba(T,G),M=null;for(var ae in G)if(G.hasOwnProperty(ae)){var Ie=G[ae];ae==="children"?typeof Ie=="string"?O.textContent!==Ie&&(G.suppressHydrationWarning!==!0&&ny(O.textContent,Ie,f),M=["children",Ie]):typeof Ie=="number"&&O.textContent!==""+Ie&&(G.suppressHydrationWarning!==!0&&ny(O.textContent,Ie,f),M=["children",""+Ie]):l.hasOwnProperty(ae)&&Ie!=null&&ae==="onScroll"&&wi("scroll",O)}switch(T){case"input":hn(O),Re(O,G,!0);break;case"textarea":hn(O),Jt(O);break;case"select":case"option":break;default:typeof G.onClick=="function"&&(O.onclick=ry)}O=M,g.updateQueue=O,O!==null&&(g.flags|=4)}else{ae=M.nodeType===9?M:M.ownerDocument,f==="http://www.w3.org/1999/xhtml"&&(f=fn(T)),f==="http://www.w3.org/1999/xhtml"?T==="script"?(f=ae.createElement("div"),f.innerHTML="<script><\/script>",f=f.removeChild(f.firstChild)):typeof O.is=="string"?f=ae.createElement(T,{is:O.is}):(f=ae.createElement(T),T==="select"&&(ae=f,O.multiple?ae.multiple=!0:O.size&&(ae.size=O.size))):f=ae.createElementNS(f,T),f[$l]=g,f[qd]=O,yI(f,g,!1,!1),g.stateNode=f;e:{switch(ae=nl(T,O),T){case"dialog":wi("cancel",f),wi("close",f),M=O;break;case"iframe":case"object":case"embed":wi("load",f),M=O;break;case"video":case"audio":for(M=0;M<Bg.length;M++)wi(Bg[M],f);M=O;break;case"source":wi("error",f),M=O;break;case"img":case"image":case"link":wi("error",f),wi("load",f),M=O;break;case"details":wi("toggle",f),M=O;break;case"input":Xt(f,O),M=Ln(f,O),wi("invalid",f);break;case"option":M=O;break;case"select":f._wrapperState={wasMultiple:!!O.multiple},M=Ne({},O,{value:void 0}),wi("invalid",f);break;case"textarea":Ge(f,O),M=St(f,O),wi("invalid",f);break;default:M=O}Ba(T,M),Ie=M;for(G in Ie)if(Ie.hasOwnProperty(G)){var xe=Ie[G];G==="style"?Ti(f,xe):G==="dangerouslySetInnerHTML"?(xe=xe?xe.__html:void 0,xe!=null&&ia(f,xe)):G==="children"?typeof xe=="string"?(T!=="textarea"||xe!=="")&&Vt(f,xe):typeof xe=="number"&&Vt(f,""+xe):G!=="suppressContentEditableWarning"&&G!=="suppressHydrationWarning"&&G!=="autoFocus"&&(l.hasOwnProperty(G)?xe!=null&&G==="onScroll"&&wi("scroll",f):xe!=null&&te(f,G,xe,ae))}switch(T){case"input":hn(f),Re(f,O,!1);break;case"textarea":hn(f),Jt(f);break;case"option":O.value!=null&&f.setAttribute("value",""+dt(O.value));break;case"select":f.multiple=!!O.multiple,G=O.value,G!=null?yt(f,!!O.multiple,G,!1):O.defaultValue!=null&&yt(f,!!O.multiple,O.defaultValue,!0);break;default:typeof M.onClick=="function"&&(f.onclick=ry)}switch(T){case"button":case"input":case"select":case"textarea":O=!!O.autoFocus;break e;case"img":O=!0;break e;default:O=!1}}O&&(g.flags|=4)}g.ref!==null&&(g.flags|=512,g.flags|=2097152)}return ms(g),null;case 6:if(f&&g.stateNode!=null)vI(f,g,f.memoizedProps,O);else{if(typeof O!="string"&&g.stateNode===null)throw Error(i(166));if(T=If(am.current),If(ql.current),qg(g)){if(O=g.stateNode,T=g.memoizedProps,O[$l]=g,(G=O.nodeValue!==T)&&(f=ma,f!==null))switch(f.tag){case 3:ny(O.nodeValue,T,(f.mode&1)!==0);break;case 5:f.memoizedProps.suppressHydrationWarning!==!0&&ny(O.nodeValue,T,(f.mode&1)!==0)}G&&(g.flags|=4)}else O=(T.nodeType===9?T:T.ownerDocument).createTextNode(O),O[$l]=g,g.stateNode=O}return ms(g),null;case 13:if(Ri(Oi),O=g.memoizedState,f===null||f.memoizedState!==null&&f.memoizedState.dehydrated!==null){if(si&&ga!==null&&(g.mode&1)!==0&&(g.flags&128)===0)BC(),im(),g.flags|=98560,G=!1;else if(G=qg(g),O!==null&&O.dehydrated!==null){if(f===null){if(!G)throw Error(i(318));if(G=g.memoizedState,G=G!==null?G.dehydrated:null,!G)throw Error(i(317));G[$l]=g}else im(),(g.flags&128)===0&&(g.memoizedState=null),g.flags|=4;ms(g),G=!1}else js!==null&&($y(js),js=null),G=!0;if(!G)return g.flags&65536?g:null}return(g.flags&128)!==0?(g.lanes=T,g):(O=O!==null,O!==(f!==null&&f.memoizedState!==null)&&O&&(g.child.flags|=8192,(g.mode&1)!==0&&(f===null||(Oi.current&1)!==0?_o===0&&(_o=3):Lb())),g.updateQueue!==null&&(g.flags|=4),ms(g),null);case 4:return Af(),ky(f,g),f===null&&yf(g.stateNode.containerInfo),ms(g),null;case 10:return tb(g.type._context),ms(g),null;case 17:return pa(g.type)&&oy(),ms(g),null;case 19:if(Ri(Oi),G=g.memoizedState,G===null)return ms(g),null;if(O=(g.flags&128)!==0,ae=G.rendering,ae===null)if(O)o_(G,!1);else{if(_o!==0||f!==null&&(f.flags&128)!==0)for(f=g.child;f!==null;){if(ae=eh(f),ae!==null){for(g.flags|=128,o_(G,!1),O=ae.updateQueue,O!==null&&(g.updateQueue=O,g.flags|=4),g.subtreeFlags=0,O=T,T=g.child;T!==null;)G=T,f=O,G.flags&=14680066,ae=G.alternate,ae===null?(G.childLanes=0,G.lanes=f,G.child=null,G.subtreeFlags=0,G.memoizedProps=null,G.memoizedState=null,G.updateQueue=null,G.dependencies=null,G.stateNode=null):(G.childLanes=ae.childLanes,G.lanes=ae.lanes,G.child=ae.child,G.subtreeFlags=0,G.deletions=null,G.memoizedProps=ae.memoizedProps,G.memoizedState=ae.memoizedState,G.updateQueue=ae.updateQueue,G.type=ae.type,f=ae.dependencies,G.dependencies=f===null?null:{lanes:f.lanes,firstContext:f.firstContext}),T=T.sibling;return gi(Oi,Oi.current&1|2),g.child}f=f.sibling}G.tail!==null&&Fr()>_m&&(g.flags|=128,O=!0,o_(G,!1),g.lanes=4194304)}else{if(!O)if(f=eh(ae),f!==null){if(g.flags|=128,O=!0,T=f.updateQueue,T!==null&&(g.updateQueue=T,g.flags|=4),o_(G,!0),G.tail===null&&G.tailMode==="hidden"&&!ae.alternate&&!si)return ms(g),null}else 2*Fr()-G.renderingStartTime>_m&&T!==1073741824&&(g.flags|=128,O=!0,o_(G,!1),g.lanes=4194304);G.isBackwards?(ae.sibling=g.child,g.child=ae):(T=G.last,T!==null?T.sibling=ae:g.child=ae,G.last=ae)}return G.tail!==null?(g=G.tail,G.rendering=g,G.tail=g.sibling,G.renderingStartTime=Fr(),g.sibling=null,T=Oi.current,gi(Oi,O?T&1|2:T&1),g):(ms(g),null);case 22:case 23:return f_(),O=g.memoizedState!==null,f!==null&&f.memoizedState!==null!==O&&(g.flags|=8192),O&&(g.mode&1)!==0?(Ja&1073741824)!==0&&(ms(g),g.subtreeFlags&6&&(g.flags|=8192)):ms(g),null;case 24:return null;case 25:return null}throw Error(i(156,g.tag))}function W1(f,g){switch(Kg(g),g.tag){case 1:return pa(g.type)&&oy(),f=g.flags,f&65536?(g.flags=f&-65537|128,g):null;case 3:return Af(),Ri(fa),Ri(fs),sb(),f=g.flags,(f&65536)!==0&&(f&128)===0?(g.flags=f&-65537|128,g):null;case 5:return cm(g),null;case 13:if(Ri(Oi),f=g.memoizedState,f!==null&&f.dehydrated!==null){if(g.alternate===null)throw Error(i(340));im()}return f=g.flags,f&65536?(g.flags=f&-65537|128,g):null;case 19:return Ri(Oi),null;case 4:return Af(),null;case 10:return tb(g.type._context),null;case 22:case 23:return f_(),null;case 24:return null;default:return null}}var Dy=!1,gs=!1,SI=typeof WeakSet=="function"?WeakSet:Set,Qt=null;function mm(f,g){var T=f.ref;if(T!==null)if(typeof T=="function")try{T(null)}catch(O){Vi(f,g,O)}else T.current=null}function s_(f,g,T){try{T()}catch(O){Vi(f,g,O)}}var bI=!1;function Rb(f,g){if(iy=ve,f=TC(),Vg(f)){if("selectionStart"in f)var T={start:f.selectionStart,end:f.selectionEnd};else e:{T=(T=f.ownerDocument)&&T.defaultView||window;var O=T.getSelection&&T.getSelection();if(O&&O.rangeCount!==0){T=O.anchorNode;var M=O.anchorOffset,G=O.focusNode;O=O.focusOffset;try{T.nodeType,G.nodeType}catch{T=null;break e}var ae=0,Ie=-1,xe=-1,it=0,At=0,Pt=f,Ct=null;t:for(;;){for(var Gt;Pt!==T||M!==0&&Pt.nodeType!==3||(Ie=ae+M),Pt!==G||O!==0&&Pt.nodeType!==3||(xe=ae+O),Pt.nodeType===3&&(ae+=Pt.nodeValue.length),(Gt=Pt.firstChild)!==null;)Ct=Pt,Pt=Gt;for(;;){if(Pt===f)break t;if(Ct===T&&++it===M&&(Ie=ae),Ct===G&&++At===O&&(xe=ae),(Gt=Pt.nextSibling)!==null)break;Pt=Ct,Ct=Pt.parentNode}Pt=Gt}T=Ie===-1||xe===-1?null:{start:Ie,end:xe}}else T=null}T=T||{start:0,end:0}}else T=null;for(zg={focusedElem:f,selectionRange:T},ve=!1,Qt=g;Qt!==null;)if(g=Qt,f=g.child,(g.subtreeFlags&1028)!==0&&f!==null)f.return=g,Qt=f;else for(;Qt!==null;){g=Qt;try{var en=g.alternate;if((g.flags&1024)!==0)switch(g.tag){case 0:case 11:case 15:break;case 1:if(en!==null){var tn=en.memoizedProps,Ji=en.memoizedState,Je=g.stateNode,Ve=Je.getSnapshotBeforeUpdate(g.elementType===g.type?tn:Xa(g.type,tn),Ji);Je.__reactInternalSnapshotBeforeUpdate=Ve}break;case 3:var Ze=g.stateNode.containerInfo;Ze.nodeType===1?Ze.textContent="":Ze.nodeType===9&&Ze.documentElement&&Ze.removeChild(Ze.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(i(163))}}catch(Nt){Vi(g,g.return,Nt)}if(f=g.sibling,f!==null){f.return=g.return,Qt=f;break}Qt=g.return}return en=bI,bI=!1,en}function a_(f,g,T){var O=g.updateQueue;if(O=O!==null?O.lastEffect:null,O!==null){var M=O=O.next;do{if((M.tag&f)===f){var G=M.destroy;M.destroy=void 0,G!==void 0&&s_(g,T,G)}M=M.next}while(M!==O)}}function c_(f,g){if(g=g.updateQueue,g=g!==null?g.lastEffect:null,g!==null){var T=g=g.next;do{if((T.tag&f)===f){var O=T.create;T.destroy=O()}T=T.next}while(T!==g)}}function Cb(f){var g=f.ref;if(g!==null){var T=f.stateNode;switch(f.tag){case 5:f=T;break;default:f=T}typeof g=="function"?g(f):g.current=f}}function TI(f){var g=f.alternate;g!==null&&(f.alternate=null,TI(g)),f.child=null,f.deletions=null,f.sibling=null,f.tag===5&&(g=f.stateNode,g!==null&&(delete g[$l],delete g[qd],delete g[Hg],delete g[k1],delete g[N1])),f.stateNode=null,f.return=null,f.dependencies=null,f.memoizedProps=null,f.memoizedState=null,f.pendingProps=null,f.stateNode=null,f.updateQueue=null}function Ib(f){return f.tag===5||f.tag===3||f.tag===4}function wI(f){e:for(;;){for(;f.sibling===null;){if(f.return===null||Ib(f.return))return null;f=f.return}for(f.sibling.return=f.return,f=f.sibling;f.tag!==5&&f.tag!==6&&f.tag!==18;){if(f.flags&2||f.child===null||f.tag===4)continue e;f.child.return=f,f=f.child}if(!(f.flags&2))return f.stateNode}}function Ab(f,g,T){var O=f.tag;if(O===5||O===6)f=f.stateNode,g?T.nodeType===8?T.parentNode.insertBefore(f,g):T.insertBefore(f,g):(T.nodeType===8?(g=T.parentNode,g.insertBefore(f,T)):(g=T,g.appendChild(f)),T=T._reactRootContainer,T!=null||g.onclick!==null||(g.onclick=ry));else if(O!==4&&(f=f.child,f!==null))for(Ab(f,g,T),f=f.sibling;f!==null;)Ab(f,g,T),f=f.sibling}function Ly(f,g,T){var O=f.tag;if(O===5||O===6)f=f.stateNode,g?T.insertBefore(f,g):T.appendChild(f);else if(O!==4&&(f=f.child,f!==null))for(Ly(f,g,T),f=f.sibling;f!==null;)Ly(f,g,T),f=f.sibling}var Jo=null,Rc=!1;function Jl(f,g,T){for(T=T.child;T!==null;)RI(f,g,T),T=T.sibling}function RI(f,g,T){if(hs&&typeof hs.onCommitFiberUnmount=="function")try{hs.onCommitFiberUnmount(Vl,T)}catch{}switch(T.tag){case 5:gs||mm(T,g);case 6:var O=Jo,M=Rc;Jo=null,Jl(f,g,T),Jo=O,Rc=M,Jo!==null&&(Rc?(f=Jo,T=T.stateNode,f.nodeType===8?f.parentNode.removeChild(T):f.removeChild(T)):Jo.removeChild(T.stateNode));break;case 18:Jo!==null&&(Rc?(f=Jo,T=T.stateNode,f.nodeType===8?q0(f.parentNode,T):f.nodeType===1&&q0(f,T),da(f)):q0(Jo,T.stateNode));break;case 4:O=Jo,M=Rc,Jo=T.stateNode.containerInfo,Rc=!0,Jl(f,g,T),Jo=O,Rc=M;break;case 0:case 11:case 14:case 15:if(!gs&&(O=T.updateQueue,O!==null&&(O=O.lastEffect,O!==null))){M=O=O.next;do{var G=M,ae=G.destroy;G=G.tag,ae!==void 0&&((G&2)!==0||(G&4)!==0)&&s_(T,g,ae),M=M.next}while(M!==O)}Jl(f,g,T);break;case 1:if(!gs&&(mm(T,g),O=T.stateNode,typeof O.componentWillUnmount=="function"))try{O.props=T.memoizedProps,O.state=T.memoizedState,O.componentWillUnmount()}catch(Ie){Vi(T,g,Ie)}Jl(f,g,T);break;case 21:Jl(f,g,T);break;case 22:T.mode&1?(gs=(O=gs)||T.memoizedState!==null,Jl(f,g,T),gs=O):Jl(f,g,T);break;default:Jl(f,g,T)}}function CI(f){var g=f.updateQueue;if(g!==null){f.updateQueue=null;var T=f.stateNode;T===null&&(T=f.stateNode=new SI),g.forEach(function(O){var M=NI.bind(null,f,O);T.has(O)||(T.add(O),O.then(M,M))})}}function zs(f,g){var T=g.deletions;if(T!==null)for(var O=0;O<T.length;O++){var M=T[O];try{var G=f,ae=g,Ie=ae;e:for(;Ie!==null;){switch(Ie.tag){case 5:Jo=Ie.stateNode,Rc=!1;break e;case 3:Jo=Ie.stateNode.containerInfo,Rc=!0;break e;case 4:Jo=Ie.stateNode.containerInfo,Rc=!0;break e}Ie=Ie.return}if(Jo===null)throw Error(i(160));RI(G,ae,M),Jo=null,Rc=!1;var xe=M.alternate;xe!==null&&(xe.return=null),M.return=null}catch(it){Vi(M,g,it)}}if(g.subtreeFlags&12854)for(g=g.child;g!==null;)Pb(g,f),g=g.sibling}function Pb(f,g){var T=f.alternate,O=f.flags;switch(f.tag){case 0:case 11:case 14:case 15:if(zs(g,f),ya(f),O&4){try{a_(3,f,f.return),c_(3,f)}catch(tn){Vi(f,f.return,tn)}try{a_(5,f,f.return)}catch(tn){Vi(f,f.return,tn)}}break;case 1:zs(g,f),ya(f),O&512&&T!==null&&mm(T,T.return);break;case 5:if(zs(g,f),ya(f),O&512&&T!==null&&mm(T,T.return),f.flags&32){var M=f.stateNode;try{Vt(M,"")}catch(tn){Vi(f,f.return,tn)}}if(O&4&&(M=f.stateNode,M!=null)){var G=f.memoizedProps,ae=T!==null?T.memoizedProps:G,Ie=f.type,xe=f.updateQueue;if(f.updateQueue=null,xe!==null)try{Ie==="input"&&G.type==="radio"&&G.name!=null&&Yn(M,G),nl(Ie,ae);var it=nl(Ie,G);for(ae=0;ae<xe.length;ae+=2){var At=xe[ae],Pt=xe[ae+1];At==="style"?Ti(M,Pt):At==="dangerouslySetInnerHTML"?ia(M,Pt):At==="children"?Vt(M,Pt):te(M,At,Pt,it)}switch(Ie){case"input":Kt(M,G);break;case"textarea":Ot(M,G);break;case"select":var Ct=M._wrapperState.wasMultiple;M._wrapperState.wasMultiple=!!G.multiple;var Gt=G.value;Gt!=null?yt(M,!!G.multiple,Gt,!1):Ct!==!!G.multiple&&(G.defaultValue!=null?yt(M,!!G.multiple,G.defaultValue,!0):yt(M,!!G.multiple,G.multiple?[]:"",!1))}M[qd]=G}catch(tn){Vi(f,f.return,tn)}}break;case 6:if(zs(g,f),ya(f),O&4){if(f.stateNode===null)throw Error(i(162));M=f.stateNode,G=f.memoizedProps;try{M.nodeValue=G}catch(tn){Vi(f,f.return,tn)}}break;case 3:if(zs(g,f),ya(f),O&4&&T!==null&&T.memoizedState.isDehydrated)try{da(g.containerInfo)}catch(tn){Vi(f,f.return,tn)}break;case 4:zs(g,f),ya(f);break;case 13:zs(g,f),ya(f),M=f.child,M.flags&8192&&(G=M.memoizedState!==null,M.stateNode.isHidden=G,!G||M.alternate!==null&&M.alternate.memoizedState!==null||(jy=Fr())),O&4&&CI(f);break;case 22:if(At=T!==null&&T.memoizedState!==null,f.mode&1?(gs=(it=gs)||At,zs(g,f),gs=it):zs(g,f),ya(f),O&8192){if(it=f.memoizedState!==null,(f.stateNode.isHidden=it)&&!At&&(f.mode&1)!==0)for(Qt=f,At=f.child;At!==null;){for(Pt=Qt=At;Qt!==null;){switch(Ct=Qt,Gt=Ct.child,Ct.tag){case 0:case 11:case 14:case 15:a_(4,Ct,Ct.return);break;case 1:mm(Ct,Ct.return);var en=Ct.stateNode;if(typeof en.componentWillUnmount=="function"){O=Ct,T=Ct.return;try{g=O,en.props=g.memoizedProps,en.state=g.memoizedState,en.componentWillUnmount()}catch(tn){Vi(O,T,tn)}}break;case 5:mm(Ct,Ct.return);break;case 22:if(Ct.memoizedState!==null){l_(Pt);continue}}Gt!==null?(Gt.return=Ct,Qt=Gt):l_(Pt)}At=At.sibling}e:for(At=null,Pt=f;;){if(Pt.tag===5){if(At===null){At=Pt;try{M=Pt.stateNode,it?(G=M.style,typeof G.setProperty=="function"?G.setProperty("display","none","important"):G.display="none"):(Ie=Pt.stateNode,xe=Pt.memoizedProps.style,ae=xe!=null&&xe.hasOwnProperty("display")?xe.display:null,Ie.style.display=fi("display",ae))}catch(tn){Vi(f,f.return,tn)}}}else if(Pt.tag===6){if(At===null)try{Pt.stateNode.nodeValue=it?"":Pt.memoizedProps}catch(tn){Vi(f,f.return,tn)}}else if((Pt.tag!==22&&Pt.tag!==23||Pt.memoizedState===null||Pt===f)&&Pt.child!==null){Pt.child.return=Pt,Pt=Pt.child;continue}if(Pt===f)break e;for(;Pt.sibling===null;){if(Pt.return===null||Pt.return===f)break e;At===Pt&&(At=null),Pt=Pt.return}At===Pt&&(At=null),Pt.sibling.return=Pt.return,Pt=Pt.sibling}}break;case 19:zs(g,f),ya(f),O&4&&CI(f);break;case 21:break;default:zs(g,f),ya(f)}}function ya(f){var g=f.flags;if(g&2){try{e:{for(var T=f.return;T!==null;){if(Ib(T)){var O=T;break e}T=T.return}throw Error(i(160))}switch(O.tag){case 5:var M=O.stateNode;O.flags&32&&(Vt(M,""),O.flags&=-33);var G=wI(f);Ly(f,G,M);break;case 3:case 4:var ae=O.stateNode.containerInfo,Ie=wI(f);Ab(f,Ie,ae);break;default:throw Error(i(161))}}catch(xe){Vi(f,f.return,xe)}f.flags&=-3}g&4096&&(f.flags&=-4097)}function gm(f,g,T){Qt=f,Ob(f)}function Ob(f,g,T){for(var O=(f.mode&1)!==0;Qt!==null;){var M=Qt,G=M.child;if(M.tag===22&&O){var ae=M.memoizedState!==null||Dy;if(!ae){var Ie=M.alternate,xe=Ie!==null&&Ie.memoizedState!==null||gs;Ie=Dy;var it=gs;if(Dy=ae,(gs=xe)&&!it)for(Qt=M;Qt!==null;)ae=Qt,xe=ae.child,ae.tag===22&&ae.memoizedState!==null?II(M):xe!==null?(xe.return=ae,Qt=xe):II(M);for(;G!==null;)Qt=G,Ob(G),G=G.sibling;Qt=M,Dy=Ie,gs=it}xy(f)}else(M.subtreeFlags&8772)!==0&&G!==null?(G.return=M,Qt=G):xy(f)}}function xy(f){for(;Qt!==null;){var g=Qt;if((g.flags&8772)!==0){var T=g.alternate;try{if((g.flags&8772)!==0)switch(g.tag){case 0:case 11:case 15:gs||c_(5,g);break;case 1:var O=g.stateNode;if(g.flags&4&&!gs)if(T===null)O.componentDidMount();else{var M=g.elementType===g.type?T.memoizedProps:Xa(g.type,T.memoizedProps);O.componentDidUpdate(M,T.memoizedState,O.__reactInternalSnapshotBeforeUpdate)}var G=g.updateQueue;G!==null&&$C(g,G,O);break;case 3:var ae=g.updateQueue;if(ae!==null){if(T=null,g.child!==null)switch(g.child.tag){case 5:T=g.child.stateNode;break;case 1:T=g.child.stateNode}$C(g,ae,T)}break;case 5:var Ie=g.stateNode;if(T===null&&g.flags&4){T=Ie;var xe=g.memoizedProps;switch(g.type){case"button":case"input":case"select":case"textarea":xe.autoFocus&&T.focus();break;case"img":xe.src&&(T.src=xe.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(g.memoizedState===null){var it=g.alternate;if(it!==null){var At=it.memoizedState;if(At!==null){var Pt=At.dehydrated;Pt!==null&&da(Pt)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(i(163))}gs||g.flags&512&&Cb(g)}catch(Ct){Vi(g,g.return,Ct)}}if(g===f){Qt=null;break}if(T=g.sibling,T!==null){T.return=g.return,Qt=T;break}Qt=g.return}}function l_(f){for(;Qt!==null;){var g=Qt;if(g===f){Qt=null;break}var T=g.sibling;if(T!==null){T.return=g.return,Qt=T;break}Qt=g.return}}function II(f){for(;Qt!==null;){var g=Qt;try{switch(g.tag){case 0:case 11:case 15:var T=g.return;try{c_(4,g)}catch(xe){Vi(g,T,xe)}break;case 1:var O=g.stateNode;if(typeof O.componentDidMount=="function"){var M=g.return;try{O.componentDidMount()}catch(xe){Vi(g,M,xe)}}var G=g.return;try{Cb(g)}catch(xe){Vi(g,G,xe)}break;case 5:var ae=g.return;try{Cb(g)}catch(xe){Vi(g,ae,xe)}}}catch(xe){Vi(g,g.return,xe)}if(g===f){Qt=null;break}var Ie=g.sibling;if(Ie!==null){Ie.return=g.return,Qt=Ie;break}Qt=g.return}}var z1=Math.ceil,My=le.ReactCurrentDispatcher,Uy=le.ReactCurrentOwner,Cc=le.ReactCurrentBatchConfig,Tr=0,Wo=null,Xi=null,go=0,Ja=0,hl=vc(0),_o=0,Qo=null,Nf=0,Vy=0,Fy=0,u_=null,Gs=null,jy=0,_m=1/0,Ql=null,By=!1,kb=null,rh=null,Em=!1,Zl=null,Wy=0,Df=0,Nb=null,d_=-1,zy=0;function Zo(){return(Tr&6)!==0?Fr():d_!==-1?d_:d_=Fr()}function Ic(f){return(f.mode&1)===0?1:(Tr&2)!==0&&go!==0?go&-go:L1.transition!==null?(zy===0&&(zy=ju()),zy):(f=nr,f!==0||(f=window.event,f=f===void 0?16:jr(f.type)),f)}function Ac(f,g,T,O){if(50<Df)throw Df=0,Nb=null,Error(i(185));Bl(f,T,O),((Tr&2)===0||f!==Wo)&&(f===Wo&&((Tr&2)===0&&(Vy|=T),_o===4&&nd(f,go)),_s(f,O),T===1&&Tr===0&&(g.mode&1)===0&&(_m=Fr()+500,cy&&Xd()))}function _s(f,g){var T=f.callbackNode;Ga(f,g);var O=jl(f,f===Wo?go:0);if(O===0)T!==null&&Vu(T),f.callbackNode=null,f.callbackPriority=0;else if(g=O&-O,f.callbackPriority!==g){if(T!=null&&Vu(T),g===1)f.tag===0?D1(Lf.bind(null,f)):UC(Lf.bind(null,f)),P1(function(){(Tr&6)===0&&Xd()}),T=null;else{switch(pc(O)){case 1:T=fc;break;case 4:T=ol;break;case 16:T=la;break;case 536870912:T=Bd;break;default:T=la}T=p_(T,Gy.bind(null,f))}f.callbackPriority=g,f.callbackNode=T}}function Gy(f,g){if(d_=-1,zy=0,(Tr&6)!==0)throw Error(i(327));var T=f.callbackNode;if(ym()&&f.callbackNode!==T)return null;var O=jl(f,f===Wo?go:0);if(O===0)return null;if((O&30)!==0||(O&f.expiredLanes)!==0||g)g=eu(f,O);else{g=O;var M=Tr;Tr|=2;var G=AI();(Wo!==f||go!==g)&&(Ql=null,_m=Fr()+500,ih(f,g));do try{G1();break}catch(Ie){Db(f,Ie)}while(!0);eb(),My.current=G,Tr=M,Xi!==null?g=0:(Wo=null,go=0,g=_o)}if(g!==0){if(g===2&&(M=Ps(f),M!==0&&(O=M,g=Hy(f,M))),g===1)throw T=Qo,ih(f,0),nd(f,O),_s(f,Fr()),T;if(g===6)nd(f,O);else{if(M=f.current.alternate,(O&30)===0&&!Ky(M)&&(g=eu(f,O),g===2&&(G=Ps(f),G!==0&&(O=G,g=Hy(f,G))),g===1))throw T=Qo,ih(f,0),nd(f,O),_s(f,Fr()),T;switch(f.finishedWork=M,f.finishedLanes=O,g){case 0:case 1:throw Error(i(345));case 2:xf(f,Gs,Ql);break;case 3:if(nd(f,O),(O&130023424)===O&&(g=jy+500-Fr(),10<g)){if(jl(f,0)!==0)break;if(M=f.suspendedLanes,(M&O)!==O){Zo(),f.pingedLanes|=f.suspendedLanes&M;break}f.timeoutHandle=Gg(xf.bind(null,f,Gs,Ql),g);break}xf(f,Gs,Ql);break;case 4:if(nd(f,O),(O&4194240)===O)break;for(g=f.eventTimes,M=-1;0<O;){var ae=31-Xo(O);G=1<<ae,ae=g[ae],ae>M&&(M=ae),O&=~G}if(O=M,O=Fr()-O,O=(120>O?120:480>O?480:1080>O?1080:1920>O?1920:3e3>O?3e3:4320>O?4320:1960*z1(O/1960))-O,10<O){f.timeoutHandle=Gg(xf.bind(null,f,Gs,Ql),O);break}xf(f,Gs,Ql);break;case 5:xf(f,Gs,Ql);break;default:throw Error(i(329))}}}return _s(f,Fr()),f.callbackNode===T?Gy.bind(null,f):null}function Hy(f,g){var T=u_;return f.current.memoizedState.isDehydrated&&(ih(f,g).flags|=256),f=eu(f,g),f!==2&&(g=Gs,Gs=T,g!==null&&$y(g)),f}function $y(f){Gs===null?Gs=f:Gs.push.apply(Gs,f)}function Ky(f){for(var g=f;;){if(g.flags&16384){var T=g.updateQueue;if(T!==null&&(T=T.stores,T!==null))for(var O=0;O<T.length;O++){var M=T[O],G=M.getSnapshot;M=M.value;try{if(!dl(G(),M))return!1}catch{return!1}}}if(T=g.child,g.subtreeFlags&16384&&T!==null)T.return=g,g=T;else{if(g===f)break;for(;g.sibling===null;){if(g.return===null||g.return===f)return!0;g=g.return}g.sibling.return=g.return,g=g.sibling}}return!0}function nd(f,g){for(g&=~Fy,g&=~Vy,f.suspendedLanes|=g,f.pingedLanes&=~g,f=f.expirationTimes;0<g;){var T=31-Xo(g),O=1<<T;f[T]=-1,g&=~O}}function Lf(f){if((Tr&6)!==0)throw Error(i(327));ym();var g=jl(f,0);if((g&1)===0)return _s(f,Fr()),null;var T=eu(f,g);if(f.tag!==0&&T===2){var O=Ps(f);O!==0&&(g=O,T=Hy(f,O))}if(T===1)throw T=Qo,ih(f,0),nd(f,g),_s(f,Fr()),T;if(T===6)throw Error(i(345));return f.finishedWork=f.current.alternate,f.finishedLanes=g,xf(f,Gs,Ql),_s(f,Fr()),null}function h_(f,g){var T=Tr;Tr|=1;try{return f(g)}finally{Tr=T,Tr===0&&(_m=Fr()+500,cy&&Xd())}}function rd(f){Zl!==null&&Zl.tag===0&&(Tr&6)===0&&ym();var g=Tr;Tr|=1;var T=Cc.transition,O=nr;try{if(Cc.transition=null,nr=1,f)return f()}finally{nr=O,Cc.transition=T,Tr=g,(Tr&6)===0&&Xd()}}function f_(){Ja=hl.current,Ri(hl)}function ih(f,g){f.finishedWork=null,f.finishedLanes=0;var T=f.timeoutHandle;if(T!==-1&&(f.timeoutHandle=-1,A1(T)),Xi!==null)for(T=Xi.return;T!==null;){var O=T;switch(Kg(O),O.tag){case 1:O=O.type.childContextTypes,O!=null&&oy();break;case 3:Af(),Ri(fa),Ri(fs),sb();break;case 5:cm(O);break;case 4:Af();break;case 13:Ri(Oi);break;case 19:Ri(Oi);break;case 10:tb(O.type._context);break;case 22:case 23:f_()}T=T.return}if(Wo=f,Xi=f=id(f.current,null),go=Ja=g,_o=0,Qo=null,Fy=Vy=Nf=0,Gs=u_=null,Cf!==null){for(g=0;g<Cf.length;g++)if(T=Cf[g],O=T.interleaved,O!==null){T.interleaved=null;var M=O.next,G=T.pending;if(G!==null){var ae=G.next;G.next=M,O.next=ae}T.pending=O}Cf=null}return f}function Db(f,g){do{var T=Xi;try{if(eb(),_y.current=Sy,lm){for(var O=Ui.memoizedState;O!==null;){var M=O.queue;M!==null&&(M.pending=null),O=O.next}lm=!1}if(Yl=0,mo=po=Ui=null,t_=!1,n_=0,Uy.current=null,T===null||T.return===null){_o=1,Qo=g,Xi=null;break}e:{var G=f,ae=T.return,Ie=T,xe=g;if(g=go,Ie.flags|=32768,xe!==null&&typeof xe=="object"&&typeof xe.then=="function"){var it=xe,At=Ie,Pt=At.tag;if((At.mode&1)===0&&(Pt===0||Pt===11||Pt===15)){var Ct=At.alternate;Ct?(At.updateQueue=Ct.updateQueue,At.memoizedState=Ct.memoizedState,At.lanes=Ct.lanes):(At.updateQueue=null,At.memoizedState=null)}var Gt=cI(ae);if(Gt!==null){Gt.flags&=-257,lI(Gt,ae,Ie,G,g),Gt.mode&1&&aI(G,it,g),g=Gt,xe=it;var en=g.updateQueue;if(en===null){var tn=new Set;tn.add(xe),g.updateQueue=tn}else en.add(xe);break e}else{if((g&1)===0){aI(G,it,g),Lb();break e}xe=Error(i(426))}}else if(si&&Ie.mode&1){var Ji=cI(ae);if(Ji!==null){(Ji.flags&65536)===0&&(Ji.flags|=256),lI(Ji,ae,Ie,G,g),Q0(fm(xe,Ie));break e}}G=xe=fm(xe,Ie),_o!==4&&(_o=2),u_===null?u_=[G]:u_.push(G),G=ae;do{switch(G.tag){case 3:G.flags|=65536,g&=-g,G.lanes|=g;var Je=vb(G,xe,g);HC(G,Je);break e;case 1:Ie=xe;var Ve=G.type,Ze=G.stateNode;if((G.flags&128)===0&&(typeof Ve.getDerivedStateFromError=="function"||Ze!==null&&typeof Ze.componentDidCatch=="function"&&(rh===null||!rh.has(Ze)))){G.flags|=65536,g&=-g,G.lanes|=g;var Nt=td(G,Ie,g);HC(G,Nt);break e}}G=G.return}while(G!==null)}OI(T)}catch(nn){g=nn,Xi===T&&T!==null&&(Xi=T=T.return);continue}break}while(!0)}function AI(){var f=My.current;return My.current=Sy,f===null?Sy:f}function Lb(){(_o===0||_o===3||_o===2)&&(_o=4),Wo===null||(Nf&268435455)===0&&(Vy&268435455)===0||nd(Wo,go)}function eu(f,g){var T=Tr;Tr|=2;var O=AI();(Wo!==f||go!==g)&&(Ql=null,ih(f,g));do try{PI();break}catch(M){Db(f,M)}while(!0);if(eb(),Tr=T,My.current=O,Xi!==null)throw Error(i(261));return Wo=null,go=0,_o}function PI(){for(;Xi!==null;)qy(Xi)}function G1(){for(;Xi!==null&&!As();)qy(Xi)}function qy(f){var g=Jy(f.alternate,f,Ja);f.memoizedProps=f.pendingProps,g===null?OI(f):Xi=g,Uy.current=null}function OI(f){var g=f;do{var T=g.alternate;if(f=g.return,(g.flags&32768)===0){if(T=Ny(T,g,Ja),T!==null){Xi=T;return}}else{if(T=W1(T,g),T!==null){T.flags&=32767,Xi=T;return}if(f!==null)f.flags|=32768,f.subtreeFlags=0,f.deletions=null;else{_o=6,Xi=null;return}}if(g=g.sibling,g!==null){Xi=g;return}Xi=g=f}while(g!==null);_o===0&&(_o=5)}function xf(f,g,T){var O=nr,M=Cc.transition;try{Cc.transition=null,nr=1,H1(f,g,T,O)}finally{Cc.transition=M,nr=O}return null}function H1(f,g,T,O){do ym();while(Zl!==null);if((Tr&6)!==0)throw Error(i(327));T=f.finishedWork;var M=f.finishedLanes;if(T===null)return null;if(f.finishedWork=null,f.finishedLanes=0,T===f.current)throw Error(i(177));f.callbackNode=null,f.callbackPriority=0;var G=T.lanes|T.childLanes;if(zr(f,G),f===Wo&&(Xi=Wo=null,go=0),(T.subtreeFlags&2064)===0&&(T.flags&2064)===0||Em||(Em=!0,p_(la,function(){return ym(),null})),G=(T.flags&15990)!==0,(T.subtreeFlags&15990)!==0||G){G=Cc.transition,Cc.transition=null;var ae=nr;nr=1;var Ie=Tr;Tr|=4,Uy.current=null,Rb(f,T),Pb(T,f),B0(zg),ve=!!iy,zg=iy=null,f.current=T,gm(T),jd(),Tr=Ie,nr=ae,Cc.transition=G}else f.current=T;if(Em&&(Em=!1,Zl=f,Wy=M),G=f.pendingLanes,G===0&&(rh=null),Fp(T.stateNode),_s(f,Fr()),g!==null)for(O=f.onRecoverableError,T=0;T<g.length;T++)M=g[T],O(M.value,{componentStack:M.stack,digest:M.digest});if(By)throw By=!1,f=kb,kb=null,f;return(Wy&1)!==0&&f.tag!==0&&ym(),G=f.pendingLanes,(G&1)!==0?f===Nb?Df++:(Df=0,Nb=f):Df=0,Xd(),null}function ym(){if(Zl!==null){var f=pc(Wy),g=Cc.transition,T=nr;try{if(Cc.transition=null,nr=16>f?16:f,Zl===null)var O=!1;else{if(f=Zl,Zl=null,Wy=0,(Tr&6)!==0)throw Error(i(331));var M=Tr;for(Tr|=4,Qt=f.current;Qt!==null;){var G=Qt,ae=G.child;if((Qt.flags&16)!==0){var Ie=G.deletions;if(Ie!==null){for(var xe=0;xe<Ie.length;xe++){var it=Ie[xe];for(Qt=it;Qt!==null;){var At=Qt;switch(At.tag){case 0:case 11:case 15:a_(8,At,G)}var Pt=At.child;if(Pt!==null)Pt.return=At,Qt=Pt;else for(;Qt!==null;){At=Qt;var Ct=At.sibling,Gt=At.return;if(TI(At),At===it){Qt=null;break}if(Ct!==null){Ct.return=Gt,Qt=Ct;break}Qt=Gt}}}var en=G.alternate;if(en!==null){var tn=en.child;if(tn!==null){en.child=null;do{var Ji=tn.sibling;tn.sibling=null,tn=Ji}while(tn!==null)}}Qt=G}}if((G.subtreeFlags&2064)!==0&&ae!==null)ae.return=G,Qt=ae;else e:for(;Qt!==null;){if(G=Qt,(G.flags&2048)!==0)switch(G.tag){case 0:case 11:case 15:a_(9,G,G.return)}var Je=G.sibling;if(Je!==null){Je.return=G.return,Qt=Je;break e}Qt=G.return}}var Ve=f.current;for(Qt=Ve;Qt!==null;){ae=Qt;var Ze=ae.child;if((ae.subtreeFlags&2064)!==0&&Ze!==null)Ze.return=ae,Qt=Ze;else e:for(ae=Ve;Qt!==null;){if(Ie=Qt,(Ie.flags&2048)!==0)try{switch(Ie.tag){case 0:case 11:case 15:c_(9,Ie)}}catch(nn){Vi(Ie,Ie.return,nn)}if(Ie===ae){Qt=null;break e}var Nt=Ie.sibling;if(Nt!==null){Nt.return=Ie.return,Qt=Nt;break e}Qt=Ie.return}}if(Tr=M,Xd(),hs&&typeof hs.onPostCommitFiberRoot=="function")try{hs.onPostCommitFiberRoot(Vl,f)}catch{}O=!0}return O}finally{nr=T,Cc.transition=g}}return!1}function Yy(f,g,T){g=fm(T,g),g=vb(f,g,1),f=Zd(f,g,1),g=Zo(),f!==null&&(Bl(f,1,g),_s(f,g))}function Vi(f,g,T){if(f.tag===3)Yy(f,f,T);else for(;g!==null;){if(g.tag===3){Yy(g,f,T);break}else if(g.tag===1){var O=g.stateNode;if(typeof g.type.getDerivedStateFromError=="function"||typeof O.componentDidCatch=="function"&&(rh===null||!rh.has(O))){f=fm(T,f),f=td(g,f,1),g=Zd(g,f,1),f=Zo(),g!==null&&(Bl(g,1,f),_s(g,f));break}}g=g.return}}function kI(f,g,T){var O=f.pingCache;O!==null&&O.delete(g),g=Zo(),f.pingedLanes|=f.suspendedLanes&T,Wo===f&&(go&T)===T&&(_o===4||_o===3&&(go&130023424)===go&&500>Fr()-jy?ih(f,0):Fy|=T),_s(f,g)}function xb(f,g){g===0&&((f.mode&1)===0?g=1:(g=dr,dr<<=1,(dr&130023424)===0&&(dr=4194304)));var T=Zo();f=Qu(f,g),f!==null&&(Bl(f,g,T),_s(f,T))}function Xy(f){var g=f.memoizedState,T=0;g!==null&&(T=g.retryLane),xb(f,T)}function NI(f,g){var T=0;switch(f.tag){case 13:var O=f.stateNode,M=f.memoizedState;M!==null&&(T=M.retryLane);break;case 19:O=f.stateNode;break;default:throw Error(i(314))}O!==null&&O.delete(g),xb(f,T)}var Jy;Jy=function(f,g,T){if(f!==null)if(f.memoizedProps!==g.pendingProps||fa.current)Ea=!0;else{if((f.lanes&T)===0&&(g.flags&128)===0)return Ea=!1,EI(f,g,T);Ea=(f.flags&131072)!==0}else Ea=!1,si&&(g.flags&1048576)!==0&&uy(g,ly,g.index);switch(g.lanes=0,g.tag){case 2:var O=g.type;Oy(f,g),f=g.pendingProps;var M=wf(g,fs.current);Ju(g,T),M=um(null,g,O,f,M,T);var G=lb();return g.flags|=1,typeof M=="object"&&M!==null&&typeof M.render=="function"&&M.$$typeof===void 0?(g.tag=1,g.memoizedState=null,g.updateQueue=null,pa(O)?(G=!0,ay(g)):G=!1,g.memoizedState=M.state!==null&&M.state!==void 0?M.state:null,Jg(g),M.updater=Ty,g.stateNode=M,M._reactInternals=g,_b(g,O,f,T),g=Ry(null,g,O,!0,G,T)):(g.tag=0,si&&G&&dy(g),Ws(null,g,M,T),g=g.child),g;case 16:O=g.elementType;e:{switch(Oy(f,g),f=g.pendingProps,M=O._init,O=M(O._payload),g.type=O,M=g.tag=Mf(O),f=Xa(O,f),M){case 0:g=Sb(null,g,O,f,T);break e;case 1:g=pI(null,g,O,f,T);break e;case 11:g=wy(null,g,O,f,T);break e;case 14:g=uI(null,g,O,Xa(O.type,f),T);break e}throw Error(i(306,O,""))}return g;case 0:return O=g.type,M=g.pendingProps,M=g.elementType===O?M:Xa(O,M),Sb(f,g,O,M,T);case 1:return O=g.type,M=g.pendingProps,M=g.elementType===O?M:Xa(O,M),pI(f,g,O,M,T);case 3:e:{if(bb(g),f===null)throw Error(i(387));O=g.pendingProps,G=g.memoizedState,M=G.element,GC(f,g),gy(g,O,null,T);var ae=g.memoizedState;if(O=ae.element,G.isDehydrated)if(G={element:O,isDehydrated:!1,cache:ae.cache,pendingSuspenseBoundaries:ae.pendingSuspenseBoundaries,transitions:ae.transitions},g.updateQueue.baseState=G,g.memoizedState=G,g.flags&256){M=fm(Error(i(423)),g),g=mI(f,g,O,T,M);break e}else if(O!==M){M=fm(Error(i(424)),g),g=mI(f,g,O,T,M);break e}else for(ga=Kd(g.stateNode.containerInfo.firstChild),ma=g,si=!0,js=null,T=WC(g,null,O,T),g.child=T;T;)T.flags=T.flags&-3|4096,T=T.sibling;else{if(im(),O===M){g=Xl(f,g,T);break e}Ws(f,g,O,T)}g=g.child}return g;case 5:return KC(g),f===null&&J0(g),O=g.type,M=g.pendingProps,G=f!==null?f.memoizedProps:null,ae=M.children,K0(O,M)?ae=null:G!==null&&K0(O,G)&&(g.flags|=32),fI(f,g),Ws(f,g,ae,T),g.child;case 6:return f===null&&J0(g),null;case 13:return Cy(f,g,T);case 4:return ib(g,g.stateNode.containerInfo),O=g.pendingProps,f===null?g.child=om(g,null,O,T):Ws(f,g,O,T),g.child;case 11:return O=g.type,M=g.pendingProps,M=g.elementType===O?M:Xa(O,M),wy(f,g,O,M,T);case 7:return Ws(f,g,g.pendingProps,T),g.child;case 8:return Ws(f,g,g.pendingProps.children,T),g.child;case 12:return Ws(f,g,g.pendingProps.children,T),g.child;case 10:e:{if(O=g.type._context,M=g.pendingProps,G=g.memoizedProps,ae=M.value,gi(py,O._currentValue),O._currentValue=ae,G!==null)if(dl(G.value,ae)){if(G.children===M.children&&!fa.current){g=Xl(f,g,T);break e}}else for(G=g.child,G!==null&&(G.return=g);G!==null;){var Ie=G.dependencies;if(Ie!==null){ae=G.child;for(var xe=Ie.firstContext;xe!==null;){if(xe.context===O){if(G.tag===1){xe=Kl(-1,T&-T),xe.tag=2;var it=G.updateQueue;if(it!==null){it=it.shared;var At=it.pending;At===null?xe.next=xe:(xe.next=At.next,At.next=xe),it.pending=xe}}G.lanes|=T,xe=G.alternate,xe!==null&&(xe.lanes|=T),nb(G.return,T,g),Ie.lanes|=T;break}xe=xe.next}}else if(G.tag===10)ae=G.type===g.type?null:G.child;else if(G.tag===18){if(ae=G.return,ae===null)throw Error(i(341));ae.lanes|=T,Ie=ae.alternate,Ie!==null&&(Ie.lanes|=T),nb(ae,T,g),ae=G.sibling}else ae=G.child;if(ae!==null)ae.return=G;else for(ae=G;ae!==null;){if(ae===g){ae=null;break}if(G=ae.sibling,G!==null){G.return=ae.return,ae=G;break}ae=ae.return}G=ae}Ws(f,g,M.children,T),g=g.child}return g;case 9:return M=g.type,O=g.pendingProps.children,Ju(g,T),M=Tc(M),O=O(M),g.flags|=1,Ws(f,g,O,T),g.child;case 14:return O=g.type,M=Xa(O,g.pendingProps),M=Xa(O.type,M),uI(f,g,O,M,T);case 15:return dI(f,g,g.type,g.pendingProps,T);case 17:return O=g.type,M=g.pendingProps,M=g.elementType===O?M:Xa(O,M),Oy(f,g),g.tag=1,pa(O)?(f=!0,ay(g)):f=!1,Ju(g,T),oI(g,O,M),_b(g,O,M,T),Ry(null,g,O,!0,f,T);case 19:return Py(f,g,T);case 22:return hI(f,g,T)}throw Error(i(156,g.tag))};function p_(f,g){return Fd(f,g)}function Qy(f,g,T,O){this.tag=f,this.key=T,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=g,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=O,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Qa(f,g,T,O){return new Qy(f,g,T,O)}function oh(f){return f=f.prototype,!(!f||!f.isReactComponent)}function Mf(f){if(typeof f=="function")return oh(f)?1:0;if(f!=null){if(f=f.$$typeof,f===he)return 11;if(f===He)return 14}return 2}function id(f,g){var T=f.alternate;return T===null?(T=Qa(f.tag,g,f.key,f.mode),T.elementType=f.elementType,T.type=f.type,T.stateNode=f.stateNode,T.alternate=f,f.alternate=T):(T.pendingProps=g,T.type=f.type,T.flags=0,T.subtreeFlags=0,T.deletions=null),T.flags=f.flags&14680064,T.childLanes=f.childLanes,T.lanes=f.lanes,T.child=f.child,T.memoizedProps=f.memoizedProps,T.memoizedState=f.memoizedState,T.updateQueue=f.updateQueue,g=f.dependencies,T.dependencies=g===null?null:{lanes:g.lanes,firstContext:g.firstContext},T.sibling=f.sibling,T.index=f.index,T.ref=f.ref,T}function Zy(f,g,T,O,M,G){var ae=2;if(O=f,typeof f=="function")oh(f)&&(ae=1);else if(typeof f=="string")ae=5;else e:switch(f){case Z:return Uf(T.children,M,G,g);case Q:ae=8,M|=8;break;case ne:return f=Qa(12,T,g,M|2),f.elementType=ne,f.lanes=G,f;case ue:return f=Qa(13,T,g,M),f.elementType=ue,f.lanes=G,f;case Me:return f=Qa(19,T,g,M),f.elementType=Me,f.lanes=G,f;case we:return sh(T,M,G,g);default:if(typeof f=="object"&&f!==null)switch(f.$$typeof){case se:ae=10;break e;case fe:ae=9;break e;case he:ae=11;break e;case He:ae=14;break e;case rt:ae=16,O=null;break e}throw Error(i(130,f==null?f:typeof f,""))}return g=Qa(ae,T,g,M),g.elementType=f,g.type=O,g.lanes=G,g}function Uf(f,g,T,O){return f=Qa(7,f,O,g),f.lanes=T,f}function sh(f,g,T,O){return f=Qa(22,f,O,g),f.elementType=we,f.lanes=T,f.stateNode={isHidden:!1},f}function Mb(f,g,T){return f=Qa(6,f,null,g),f.lanes=T,f}function Ub(f,g,T){return g=Qa(4,f.children!==null?f.children:[],f.key,g),g.lanes=T,g.stateNode={containerInfo:f.containerInfo,pendingChildren:null,implementation:f.implementation},g}function $1(f,g,T,O,M){this.tag=g,this.containerInfo=f,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=al(0),this.expirationTimes=al(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=al(0),this.identifierPrefix=O,this.onRecoverableError=M,this.mutableSourceEagerHydrationData=null}function Vb(f,g,T,O,M,G,ae,Ie,xe){return f=new $1(f,g,T,Ie,xe),g===1?(g=1,G===!0&&(g|=8)):g=0,G=Qa(3,null,null,g),f.current=G,G.stateNode=f,G.memoizedState={element:O,isDehydrated:T,cache:null,transitions:null,pendingSuspenseBoundaries:null},Jg(G),f}function K1(f,g,T){var O=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:ge,key:O==null?null:""+O,children:f,containerInfo:g,implementation:T}}function DI(f){if(!f)return Yd;f=f._reactInternals;e:{if(jo(f)!==f||f.tag!==1)throw Error(i(170));var g=f;do{switch(g.tag){case 3:g=g.stateNode.context;break e;case 1:if(pa(g.type)){g=g.stateNode.__reactInternalMemoizedMergedChildContext;break e}}g=g.return}while(g!==null);throw Error(i(171))}if(f.tag===1){var T=f.type;if(pa(T))return sy(f,T,g)}return g}function ev(f,g,T,O,M,G,ae,Ie,xe){return f=Vb(T,O,!0,f,M,G,ae,Ie,xe),f.context=DI(null),T=f.current,O=Zo(),M=Ic(T),G=Kl(O,M),G.callback=g??null,Zd(T,G,M),f.current.lanes=M,Bl(f,M,O),_s(f,O),f}function m_(f,g,T,O){var M=g.current,G=Zo(),ae=Ic(M);return T=DI(T),g.context===null?g.context=T:g.pendingContext=T,g=Kl(G,ae),g.payload={element:f},O=O===void 0?null:O,O!==null&&(g.callback=O),f=Zd(M,g,ae),f!==null&&(Ac(f,M,ae,G),Qg(f,M,ae)),ae}function tv(f){if(f=f.current,!f.child)return null;switch(f.child.tag){case 5:return f.child.stateNode;default:return f.child.stateNode}}function Fb(f,g){if(f=f.memoizedState,f!==null&&f.dehydrated!==null){var T=f.retryLane;f.retryLane=T!==0&&T<g?T:g}}function jb(f,g){Fb(f,g),(f=f.alternate)&&Fb(f,g)}function g_(){return null}var fl=typeof reportError=="function"?reportError:function(f){console.error(f)};function nv(f){this._internalRoot=f}rv.prototype.render=nv.prototype.render=function(f){var g=this._internalRoot;if(g===null)throw Error(i(409));m_(f,g,null,null)},rv.prototype.unmount=nv.prototype.unmount=function(){var f=this._internalRoot;if(f!==null){this._internalRoot=null;var g=f.containerInfo;rd(function(){m_(null,f,null,null)}),g[yc]=null}};function rv(f){this._internalRoot=f}rv.prototype.unstable_scheduleHydration=function(f){if(f){var g=df();f={blockedOn:null,target:f,priority:g};for(var T=0;T<Ls.length&&g!==0&&g<Ls[T].priority;T++);Ls.splice(T,0,f),T===0&&ff(f)}};function Bb(f){return!(!f||f.nodeType!==1&&f.nodeType!==9&&f.nodeType!==11)}function vm(f){return!(!f||f.nodeType!==1&&f.nodeType!==9&&f.nodeType!==11&&(f.nodeType!==8||f.nodeValue!==" react-mount-point-unstable "))}function Wb(){}function q1(f,g,T,O,M){if(M){if(typeof O=="function"){var G=O;O=function(){var it=tv(ae);G.call(it)}}var ae=ev(g,O,f,0,null,!1,!1,"",Wb);return f._reactRootContainer=ae,f[yc]=ae.current,yf(f.nodeType===8?f.parentNode:f),rd(),ae}for(;M=f.lastChild;)f.removeChild(M);if(typeof O=="function"){var Ie=O;O=function(){var it=tv(xe);Ie.call(it)}}var xe=Vb(f,0,!1,null,null,!1,!1,"",Wb);return f._reactRootContainer=xe,f[yc]=xe.current,yf(f.nodeType===8?f.parentNode:f),rd(function(){m_(g,xe,T,O)}),xe}function Vf(f,g,T,O,M){var G=T._reactRootContainer;if(G){var ae=G;if(typeof M=="function"){var Ie=M;M=function(){var xe=tv(ae);Ie.call(xe)}}m_(g,ae,f,M)}else ae=q1(T,g,f,M,O);return tv(ae)}jp=function(f){switch(f.tag){case 3:var g=f.stateNode;if(g.current.memoizedState.isDehydrated){var T=Fl(g.pendingLanes);T!==0&&(Ha(g,T|1),_s(g,Fr()),(Tr&6)===0&&(_m=Fr()+500,Xd()))}break;case 13:rd(function(){var O=Qu(f,1);if(O!==null){var M=Zo();Ac(O,f,1,M)}}),jb(f,1)}},Wl=function(f){if(f.tag===13){var g=Qu(f,134217728);if(g!==null){var T=Zo();Ac(g,f,134217728,T)}jb(f,134217728)}},Gd=function(f){if(f.tag===13){var g=Ic(f),T=Qu(f,g);if(T!==null){var O=Zo();Ac(T,f,g,O)}jb(f,g)}},df=function(){return nr},Bp=function(f,g){var T=nr;try{return nr=f,g()}finally{nr=T}},Ul=function(f,g,T){switch(g){case"input":if(Kt(f,T),g=T.name,T.type==="radio"&&g!=null){for(T=f;T.parentNode;)T=T.parentNode;for(T=T.querySelectorAll("input[name="+JSON.stringify(""+g)+'][type="radio"]'),g=0;g<T.length;g++){var O=T[g];if(O!==f&&O.form===f.form){var M=tm(O);if(!M)throw Error(i(90));Ut(O),Kt(O,M)}}}break;case"textarea":Ot(f,T);break;case"select":g=T.value,g!=null&&yt(f,!!T.multiple,g,!1)}},Lu=h_,dc=rd;var ah={usingClientEntryPoint:!1,Events:[em,bf,tm,uc,rl,h_]},od={findFiberByHostInstance:Sf,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Y1={bundleType:od.bundleType,version:od.version,rendererPackageName:od.rendererPackageName,rendererConfig:od.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:le.ReactCurrentDispatcher,findHostInstanceByFiber:function(f){return f=Vd(f),f===null?null:f.stateNode},findFiberByHostInstance:od.findFiberByHostInstance||g_,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var iv=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!iv.isDisabled&&iv.supportsFiber)try{Vl=iv.inject(Y1),hs=iv}catch{}}return Wc.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ah,Wc.createPortal=function(f,g){var T=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Bb(g))throw Error(i(200));return K1(f,g,null,T)},Wc.createRoot=function(f,g){if(!Bb(f))throw Error(i(299));var T=!1,O="",M=fl;return g!=null&&(g.unstable_strictMode===!0&&(T=!0),g.identifierPrefix!==void 0&&(O=g.identifierPrefix),g.onRecoverableError!==void 0&&(M=g.onRecoverableError)),g=Vb(f,1,!1,null,null,T,!1,O,M),f[yc]=g.current,yf(f.nodeType===8?f.parentNode:f),new nv(g)},Wc.findDOMNode=function(f){if(f==null)return null;if(f.nodeType===1)return f;var g=f._reactInternals;if(g===void 0)throw typeof f.render=="function"?Error(i(188)):(f=Object.keys(f).join(","),Error(i(268,f)));return f=Vd(g),f=f===null?null:f.stateNode,f},Wc.flushSync=function(f){return rd(f)},Wc.hydrate=function(f,g,T){if(!vm(g))throw Error(i(200));return Vf(null,f,g,!0,T)},Wc.hydrateRoot=function(f,g,T){if(!Bb(f))throw Error(i(405));var O=T!=null&&T.hydratedSources||null,M=!1,G="",ae=fl;if(T!=null&&(T.unstable_strictMode===!0&&(M=!0),T.identifierPrefix!==void 0&&(G=T.identifierPrefix),T.onRecoverableError!==void 0&&(ae=T.onRecoverableError)),g=ev(g,null,f,1,T??null,M,!1,G,ae),f[yc]=g.current,yf(f),O)for(f=0;f<O.length;f++)T=O[f],M=T._getVersion,M=M(T._source),g.mutableSourceEagerHydrationData==null?g.mutableSourceEagerHydrationData=[T,M]:g.mutableSourceEagerHydrationData.push(T,M);return new rv(g)},Wc.render=function(f,g,T){if(!vm(g))throw Error(i(200));return Vf(null,f,g,!1,T)},Wc.unmountComponentAtNode=function(f){if(!vm(f))throw Error(i(40));return f._reactRootContainer?(rd(function(){Vf(null,null,f,!1,function(){f._reactRootContainer=null,f[yc]=null})}),!0):!1},Wc.unstable_batchedUpdates=h_,Wc.unstable_renderSubtreeIntoContainer=function(f,g,T,O){if(!vm(T))throw Error(i(200));if(f==null||f._reactInternals===void 0)throw Error(i(38));return Vf(f,g,T,!1,O)},Wc.version="18.3.1-next-f1338f8080-20240426",Wc}var z$;function mQ(){if(z$)return WM.exports;z$=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(t){console.error(t)}}return n(),WM.exports=G_e(),WM.exports}var G$;function H_e(){if(G$)return QP;G$=1;var n=mQ();return QP.createRoot=n.createRoot,QP.hydrateRoot=n.hydrateRoot,QP}var $_e=H_e();const rN=b0($_e);function K_e(n,t,i,a){return n.addEventListener(t,i,a),()=>{n.removeEventListener(t,i,a)}}function iN(n){return n!=null&&typeof n=="object"&&"nodeType"in n&&n.nodeType===Node.ELEMENT_NODE}function q_e(){return!!(globalThis!=null&&globalThis.document)}function gQ(n){return n.parentElement&&gQ(n.parentElement)?!0:n.hidden}function Y_e(n){const t=n.getAttribute("contenteditable");return t!=="false"&&t!=null}function X_e(n){return!!n.getAttribute("disabled")||!!n.getAttribute("aria-disabled")}function J_e(n){var t;return((t=_Q(n))==null?void 0:t.defaultView)??window}function _Q(n){return iN(n)?n.ownerDocument:document}function Q_e(n){return n.view??window}function Z_e(n){return _Q(n).activeElement}function eEe(n){const t=Q_e(n);return typeof t.PointerEvent<"u"&&n instanceof t.PointerEvent?n.pointerType==="mouse":n instanceof t.MouseEvent}function EQ(n){return!!n.touches}function tEe(n){return EQ(n)&&n.touches.length>1}function nEe(n,t="page"){const i=n.touches[0]||n.changedTouches[0];return{x:i[`${t}X`],y:i[`${t}Y`]}}function rEe(n,t="page"){return{x:n[`${t}X`],y:n[`${t}Y`]}}function yQ(n,t="page"){return EQ(n)?nEe(n,t):rEe(n,t)}function iEe(n){return t=>{const i=eEe(t);(!i||i&&t.button===0)&&n(t)}}function oEe(n,t=!1){function i(l){n(l,{point:yQ(l)})}return t?iEe(i):i}function kO(n,t,i,a){return K_e(n,t,oEe(i,t==="pointerdown"),a)}function sEe(n,...t){if(n==null)throw new TypeError("Cannot convert undefined or null to object");const i={...n};for(const a of t)if(a!=null)for(const l in a)Object.prototype.hasOwnProperty.call(a,l)&&(l in i&&delete i[l],i[l]=a[l]);return i}const Kn=n=>n?"":void 0,LS=n=>n?!0:void 0;function aEe(n){return Array.isArray(n)}function Cu(n){const t=typeof n;return n!=null&&(t==="object"||t==="function")&&!aEe(n)}function cEe(n){const t=n==null?0:n.length;return t?n[t-1]:void 0}function lEe(n){const t=parseFloat(n.toString()),i=n.toString().replace(String(t),"");return{unitless:!i,value:t,unit:i}}function fU(n){if(n==null)return n;const{unitless:t}=lEe(n);return t||typeof n=="number"?`${n}px`:n}const vQ=(n,t)=>parseInt(n[1],10)>parseInt(t[1],10)?1:-1,XV=n=>Object.fromEntries(Object.entries(n).sort(vQ));function H$(n){const t=XV(n);return Object.assign(Object.values(t),t)}function uEe(n){const t=Object.keys(XV(n));return new Set(t)}function $$(n){if(!n)return n;n=fU(n)??n;const t=-.02;return typeof n=="number"?`${n+t}`:n.replace(/(\d+\.?\d*)/u,i=>`${parseFloat(i)+t}`)}function bw(n,t){const i=["@media screen"];return n&&i.push("and",`(min-width: ${fU(n)})`),t&&i.push("and",`(max-width: ${fU(t)})`),i.join(" ")}function dEe(n){if(!n)return null;n.base=n.base??"0px";const t=H$(n),i=Object.entries(n).sort(vQ).map(([d,p],E,v)=>{let[,b]=v[E+1]??[];return b=parseFloat(b)>0?$$(b):void 0,{_minW:$$(p),breakpoint:d,minW:p,maxW:b,maxWQuery:bw(null,b),minWQuery:bw(p),minMaxQuery:bw(p,b)}}),a=uEe(n),l=Array.from(a.values());return{keys:a,normalized:t,isResponsive(d){const p=Object.keys(d);return p.length>0&&p.every(E=>a.has(E))},asObject:XV(n),asArray:H$(n),details:i,get(d){return i.find(p=>p.breakpoint===d)},media:[null,...t.map(d=>bw(d)).slice(1)],toArrayValue(d){if(!Cu(d))throw new Error("toArrayValue: value must be an object");const p=l.map(E=>d[E]??null);for(;cEe(p)===null;)p.pop();return p},toObjectValue(d){if(!Array.isArray(d))throw new Error("toObjectValue: value must be an array");return d.reduce((p,E,v)=>{const b=l[v];return b!=null&&E!=null&&(p[b]=E),p},{})}}}function SQ(...n){return function(...i){n.forEach(a=>a==null?void 0:a(...i))}}function Qn(...n){return function(i){n.some(a=>(a==null||a(i),i==null?void 0:i.defaultPrevented))}}function JV(n){return L.Children.toArray(n).filter(t=>L.isValidElement(t))}function oN(n){const t=Object.assign({},n);for(let i in t)t[i]===void 0&&delete t[i];return t}function hEe(n,t){return`${n} returned \`undefined\`. Seems you forgot to wrap component within ${t}`}function Ki(n={}){const{name:t,strict:i=!0,hookName:a="useContext",providerName:l="Provider",errorMessage:d,defaultValue:p}=n,E=L.createContext(p);E.displayName=t;function v(){var w;const b=L.useContext(E);if(!b&&i){const A=new Error(d??hEe(a,l));throw A.name="ContextError",(w=Error.captureStackTrace)==null||w.call(Error,A,v),A}return b}return[E.Provider,v,E]}const dn=(...n)=>n.filter(Boolean).join(" "),bQ=n=>n.hasAttribute("tabindex"),fEe=n=>bQ(n)&&n.tabIndex===-1;function fk(n){if(!iN(n)||gQ(n)||X_e(n))return!1;const{localName:t}=n;if(["input","select","textarea","button"].indexOf(t)>=0)return!0;const a={a:()=>n.hasAttribute("href"),audio:()=>n.hasAttribute("controls"),video:()=>n.hasAttribute("controls")};return t in a?a[t]():Y_e(n)?!0:bQ(n)}function pEe(n){return n?iN(n)&&fk(n)&&!fEe(n):!1}const mEe=["input:not(:disabled):not([disabled])","select:not(:disabled):not([disabled])","textarea:not(:disabled):not([disabled])","embed","iframe","object","a[href]","area[href]","button:not(:disabled):not([disabled])","[tabindex]","audio[controls]","video[controls]","*[tabindex]:not([aria-disabled])","*[contenteditable]"],gEe=mEe.join(),_Ee=n=>n.offsetWidth>0&&n.offsetHeight>0;function TQ(n){const t=Array.from(n.querySelectorAll(gEe));return t.unshift(n),t.filter(i=>fk(i)&&_Ee(i))}function EEe(n,t,i,a){const l=typeof t=="string"?t.split("."):[t];for(a=0;a<l.length&&n;a+=1)n=n[l[a]];return n===void 0?i:n}const yEe=n=>{const t=new WeakMap;return(a,l,d,p)=>{if(typeof a>"u")return n(a,l,d);t.has(a)||t.set(a,new Map);const E=t.get(a);if(E.has(l))return E.get(l);const v=n(a,l,d,p);return E.set(l,v),v}},wQ=yEe(EEe),vEe=n=>n.default||n;function QV(n){const{wasSelected:t,enabled:i,isSelected:a,mode:l="unmount"}=n;return!!(!i||a||l==="keepMounted"&&t)}function SEe(n){const t=parseFloat(n);return typeof t!="number"||Number.isNaN(t)?0:t}function bEe(n,t){let i=SEe(n);const a=10**(t??10);return i=Math.round(i*a)/a,t?i.toFixed(t):i.toString()}function TEe(n){if(!Number.isFinite(n))return 0;let t=1,i=0;for(;Math.round(n*t)/t!==n;)t*=10,i+=1;return i}function K$(n,t,i){return(n-t)*100/(i-t)}function wEe(n,t,i){return(i-t)*n+t}function q$(n,t,i){const a=Math.round((n-t)/i)*i+t,l=TEe(i);return bEe(a,l)}function HM(n,t,i){return n==null?n:(i<t&&console.warn("clamp: max cannot be less than min"),Math.min(Math.max(n,t),i))}function T0(n,t=[]){const i=Object.assign({},n);for(const a of t)a in i&&delete i[a];return i}function RQ(n,t){const i={};for(const a of t)a in n&&(i[a]=n[a]);return i}function sN(n,t){return Array.isArray(n)?n.map(i=>i===null?null:t(i)):Cu(n)?Object.keys(n).reduce((i,a)=>(i[a]=t(n[a]),i),{}):n!=null?t(n):null}const REe=n=>typeof n=="function";function Yc(n,...t){return REe(n)?n(...t):n}function CEe(n){const t=n.ownerDocument.defaultView||window,{overflow:i,overflowX:a,overflowY:l}=t.getComputedStyle(n);return/auto|scroll|overlay|hidden/.test(i+l+a)}function IEe(n){return n.localName==="html"?n:n.assignedSlot||n.parentElement||n.ownerDocument.documentElement}function CQ(n){return["html","body","#document"].includes(n.localName)?n.ownerDocument.body:iN(n)&&CEe(n)?n:CQ(IEe(n))}function AEe(n,t){const i={},a={};for(const[l,d]of Object.entries(n))t.includes(l)?i[l]=d:a[l]=d;return[i,a]}function PEe(n,...t){const i=Object.getOwnPropertyDescriptors(n),a=Object.keys(i),l=p=>{const E={};for(let v=0;v<p.length;v++){const b=p[v];i[b]&&(Object.defineProperty(E,b,i[b]),delete i[b])}return E},d=p=>l(Array.isArray(p)?p:a.filter(p));return t.map(d).concat(l(a))}function Y$(n,t,i={}){const{stop:a,getKey:l}=i;function d(p,E=[]){if(Cu(p)||Array.isArray(p)){const v={};for(const[b,w]of Object.entries(p)){const A=(l==null?void 0:l(b))??b,N=[...E,A];if(a!=null&&a(p,N))return t(p,E);v[A]=d(w,N)}return v}return t(p,E)}return d(n)}var Tw={exports:{}};Tw.exports;var X$;function OEe(){return X$||(X$=1,function(n,t){var i=200,a="__lodash_hash_undefined__",l=800,d=16,p=9007199254740991,E="[object Arguments]",v="[object Array]",b="[object AsyncFunction]",w="[object Boolean]",A="[object Date]",N="[object Error]",F="[object Function]",j="[object GeneratorFunction]",B="[object Map]",H="[object Number]",ee="[object Null]",K="[object Object]",te="[object Proxy]",le="[object RegExp]",oe="[object Set]",ge="[object String]",Z="[object Undefined]",Q="[object WeakMap]",ne="[object ArrayBuffer]",se="[object DataView]",fe="[object Float32Array]",he="[object Float64Array]",ue="[object Int8Array]",Me="[object Int16Array]",He="[object Int32Array]",rt="[object Uint8Array]",we="[object Uint8ClampedArray]",Ce="[object Uint16Array]",ye="[object Uint32Array]",Ne=/[\\^$.*+?()[\]{}|]/g,be=/^\[object .+?Constructor\]$/,Se=/^(?:0|[1-9]\d*)$/,Ae={};Ae[fe]=Ae[he]=Ae[ue]=Ae[Me]=Ae[He]=Ae[rt]=Ae[we]=Ae[Ce]=Ae[ye]=!0,Ae[E]=Ae[v]=Ae[ne]=Ae[w]=Ae[se]=Ae[A]=Ae[N]=Ae[F]=Ae[B]=Ae[H]=Ae[K]=Ae[le]=Ae[oe]=Ae[ge]=Ae[Q]=!1;var Ue=typeof lE=="object"&&lE&&lE.Object===Object&&lE,ze=typeof self=="object"&&self&&self.Object===Object&&self,et=Ue||ze||Function("return this")(),nt=t&&!t.nodeType&&t,dt=nt&&!0&&n&&!n.nodeType&&n,Xe=dt&&dt.exports===nt,It=Xe&&Ue.process,hn=function(){try{var ve=dt&&dt.require&&dt.require("util").types;return ve||It&&It.binding&&It.binding("util")}catch{}}(),Ut=hn&&hn.isTypedArray;function ln(ve,De,tt){switch(tt.length){case 0:return ve.call(De);case 1:return ve.call(De,tt[0]);case 2:return ve.call(De,tt[0],tt[1]);case 3:return ve.call(De,tt[0],tt[1],tt[2])}return ve.apply(De,tt)}function Ln(ve,De){for(var tt=-1,$t=Array(ve);++tt<ve;)$t[tt]=De(tt);return $t}function Xt(ve){return function(De){return ve(De)}}function Yn(ve,De){return ve==null?void 0:ve[De]}function Kt(ve,De){return function(tt){return ve(De(tt))}}var Re=Array.prototype,Fe=Function.prototype,Ke=Object.prototype,yt=et["__core-js_shared__"],St=Fe.toString,Ge=Ke.hasOwnProperty,Ot=function(){var ve=/[^.]+$/.exec(yt&&yt.keys&&yt.keys.IE_PROTO||"");return ve?"Symbol(src)_1."+ve:""}(),Jt=Ke.toString,fn=St.call(Object),an=RegExp("^"+St.call(Ge).replace(Ne,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),ir=Xe?et.Buffer:void 0,ia=et.Symbol,Vt=et.Uint8Array;ir&&ir.allocUnsafe;var on=Kt(Object.getPrototypeOf,Object),Pi=Object.create,fi=Ke.propertyIsEnumerable,Ti=Re.splice,ur=ia?ia.toStringTag:void 0,Ba=function(){try{var ve=Ga(Object,"defineProperty");return ve({},"",{}),ve}catch{}}(),nl=ir?ir.isBuffer:void 0,us=Math.max,ds=Date.now,Ul=Ga(et,"Map"),Fo=Ga(Object,"create"),lc=function(){function ve(){}return function(De){if(!mc(De))return{};if(Pi)return Pi(De);ve.prototype=De;var tt=new ve;return ve.prototype=void 0,tt}}();function oa(ve){var De=-1,tt=ve==null?0:ve.length;for(this.clear();++De<tt;){var $t=ve[De];this.set($t[0],$t[1])}}function uc(){this.__data__=Fo?Fo(null):{},this.size=0}function rl(ve){var De=this.has(ve)&&delete this.__data__[ve];return this.size-=De?1:0,De}function Lu(ve){var De=this.__data__;if(Fo){var tt=De[ve];return tt===a?void 0:tt}return Ge.call(De,ve)?De[ve]:void 0}function dc(ve){var De=this.__data__;return Fo?De[ve]!==void 0:Ge.call(De,ve)}function il(ve,De){var tt=this.__data__;return this.size+=this.has(ve)?0:1,tt[ve]=Fo&&De===void 0?a:De,this}oa.prototype.clear=uc,oa.prototype.delete=rl,oa.prototype.get=Lu,oa.prototype.has=dc,oa.prototype.set=il;function Is(ve){var De=-1,tt=ve==null?0:ve.length;for(this.clear();++De<tt;){var $t=ve[De];this.set($t[0],$t[1])}}function Mi(){this.__data__=[],this.size=0}function uo(ve){var De=this.__data__,tt=jd(De,ve);if(tt<0)return!1;var $t=De.length-1;return tt==$t?De.pop():Ti.call(De,tt,1),--this.size,!0}function Wa(ve){var De=this.__data__,tt=jd(De,ve);return tt<0?void 0:De[tt][1]}function xu(ve){return jd(this.__data__,ve)>-1}function hc(ve,De){var tt=this.__data__,$t=jd(tt,ve);return $t<0?(++this.size,tt.push([ve,De])):tt[$t][1]=De,this}Is.prototype.clear=Mi,Is.prototype.delete=uo,Is.prototype.get=Wa,Is.prototype.has=xu,Is.prototype.set=hc;function sa(ve){var De=-1,tt=ve==null?0:ve.length;for(this.clear();++De<tt;){var $t=ve[De];this.set($t[0],$t[1])}}function aa(){this.size=0,this.__data__={hash:new oa,map:new(Ul||Is),string:new oa}}function Md(ve){var De=Fu(this,ve).delete(ve);return this.size-=De?1:0,De}function Ng(ve){return Fu(this,ve).get(ve)}function Mu(ve){return Fu(this,ve).has(ve)}function cf(ve,De){var tt=Fu(this,ve),$t=tt.size;return tt.set(ve,De),this.size+=tt.size==$t?0:1,this}sa.prototype.clear=aa,sa.prototype.delete=Md,sa.prototype.get=Ng,sa.prototype.has=Mu,sa.prototype.set=cf;function jo(ve){var De=this.__data__=new Is(ve);this.size=De.size}function Uu(){this.__data__=new Is,this.size=0}function ca(ve){var De=this.__data__,tt=De.delete(ve);return this.size=De.size,tt}function Ud(ve){return this.__data__.get(ve)}function Vd(ve){return this.__data__.has(ve)}function za(ve,De){var tt=this.__data__;if(tt instanceof Is){var $t=tt.__data__;if(!Ul||$t.length<i-1)return $t.push([ve,De]),this.size=++tt.size,this;tt=this.__data__=new sa($t)}return tt.set(ve,De),this.size=tt.size,this}jo.prototype.clear=Uu,jo.prototype.delete=ca,jo.prototype.get=Ud,jo.prototype.has=Vd,jo.prototype.set=za;function Fd(ve,De){var tt=ks(ve),$t=!tt&&no(ve),Hn=!tt&&!$t&&Ds(ve),_r=!tt&&!$t&&!Hn&&ff(ve),jr=tt||$t||Hn||_r,cn=jr?Ln(ve.length,String):[],Nr=cn.length;for(var mi in ve)jr&&(mi=="length"||Hn&&(mi=="offset"||mi=="parent")||_r&&(mi=="buffer"||mi=="byteLength"||mi=="byteOffset")||al(mi,Nr))||cn.push(mi);return cn}function Vu(ve,De,tt){(tt!==void 0&&!Os(ve[De],tt)||tt===void 0&&!(De in ve))&&Fr(ve,De,tt)}function As(ve,De,tt){var $t=ve[De];(!(Ge.call(ve,De)&&Os($t,tt))||tt===void 0&&!(De in ve))&&Fr(ve,De,tt)}function jd(ve,De){for(var tt=ve.length;tt--;)if(Os(ve[tt][0],De))return tt;return-1}function Fr(ve,De,tt){De=="__proto__"&&Ba?Ba(ve,De,{configurable:!0,enumerable:!0,value:tt,writable:!0}):ve[De]=tt}var pi=jl();function fc(ve){return ve==null?ve===void 0?Z:ee:ur&&ur in Object(ve)?Ps(ve):jp(ve)}function ol(ve){return ho(ve)&&fc(ve)==E}function la(ve){if(!mc(ve)||Ha(ve))return!1;var De=Ls(ve)?an:be;return De.test(hf(ve))}function lf(ve){return ho(ve)&&Wp(ve.length)&&!!Ae[fc(ve)]}function Bd(ve){if(!mc(ve))return pc(ve);var De=nr(ve),tt=[];for(var $t in ve)$t=="constructor"&&(De||!Ge.call(ve,$t))||tt.push($t);return tt}function Vl(ve,De,tt,$t,Hn){ve!==De&&pi(De,function(_r,jr){if(Hn||(Hn=new jo),mc(_r))hs(ve,De,jr,tt,Vl,$t,Hn);else{var cn=$t?$t(Gd(ve,jr),_r,jr+"",ve,De,Hn):void 0;cn===void 0&&(cn=_r),Vu(ve,jr,cn)}},Gl)}function hs(ve,De,tt,$t,Hn,_r,jr){var cn=Gd(ve,tt),Nr=Gd(De,tt),mi=jr.get(Nr);if(mi){Vu(ve,tt,mi);return}var Po=_r?_r(cn,Nr,tt+"",ve,De,jr):void 0,xs=Po===void 0;if(xs){var Ms=ks(Nr),Wu=!Ms&&Ds(Nr),Yi=!Ms&&!Wu&&ff(Nr);Po=Nr,Ms||Wu||Yi?ks(cn)?Po=cn:zl(cn)?Po=zd(cn):Wu?(xs=!1,Po=uf(Nr)):Yi?(xs=!1,Po=Wd(Nr)):Po=[]:Bu(Nr)||no(Nr)?(Po=cn,no(cn)?Po=cl(cn):(!mc(cn)||Ls(cn))&&(Po=ju(Nr))):xs=!1}xs&&(jr.set(Nr,Po),Hn(Po,Nr,$t,_r,jr),jr.delete(Nr)),Vu(ve,tt,Po)}function Fp(ve,De){return df(Wl(ve,De,da),ve+"")}var Xo=Ba?function(ve,De){return Ba(ve,"toString",{configurable:!0,enumerable:!1,value:ua(De),writable:!0})}:da;function uf(ve,De){return ve.slice()}function sl(ve){var De=new ve.constructor(ve.byteLength);return new Vt(De).set(new Vt(ve)),De}function Wd(ve,De){var tt=sl(ve.buffer);return new ve.constructor(tt,ve.byteOffset,ve.length)}function zd(ve,De){var tt=-1,$t=ve.length;for(De||(De=Array($t));++tt<$t;)De[tt]=ve[tt];return De}function dr(ve,De,tt,$t){var Hn=!tt;tt||(tt={});for(var _r=-1,jr=De.length;++_r<jr;){var cn=De[_r],Nr=void 0;Nr===void 0&&(Nr=ve[cn]),Hn?Fr(tt,cn,Nr):As(tt,cn,Nr)}return tt}function Fl(ve){return Fp(function(De,tt){var $t=-1,Hn=tt.length,_r=Hn>1?tt[Hn-1]:void 0,jr=Hn>2?tt[2]:void 0;for(_r=ve.length>3&&typeof _r=="function"?(Hn--,_r):void 0,jr&&Bl(tt[0],tt[1],jr)&&(_r=Hn<3?void 0:_r,Hn=1),De=Object(De);++$t<Hn;){var cn=tt[$t];cn&&ve(De,cn,$t,_r)}return De})}function jl(ve){return function(De,tt,$t){for(var Hn=-1,_r=Object(De),jr=$t(De),cn=jr.length;cn--;){var Nr=jr[++Hn];if(tt(_r[Nr],Nr,_r)===!1)break}return De}}function Fu(ve,De){var tt=ve.__data__;return zr(De)?tt[typeof De=="string"?"string":"hash"]:tt.map}function Ga(ve,De){var tt=Yn(ve,De);return la(tt)?tt:void 0}function Ps(ve){var De=Ge.call(ve,ur),tt=ve[ur];try{ve[ur]=void 0;var $t=!0}catch{}var Hn=Jt.call(ve);return $t&&(De?ve[ur]=tt:delete ve[ur]),Hn}function ju(ve){return typeof ve.constructor=="function"&&!nr(ve)?lc(on(ve)):{}}function al(ve,De){var tt=typeof ve;return De=De??p,!!De&&(tt=="number"||tt!="symbol"&&Se.test(ve))&&ve>-1&&ve%1==0&&ve<De}function Bl(ve,De,tt){if(!mc(tt))return!1;var $t=typeof De;return($t=="number"?Ns(tt)&&al(De,tt.length):$t=="string"&&De in tt)?Os(tt[De],ve):!1}function zr(ve){var De=typeof ve;return De=="string"||De=="number"||De=="symbol"||De=="boolean"?ve!=="__proto__":ve===null}function Ha(ve){return!!Ot&&Ot in ve}function nr(ve){var De=ve&&ve.constructor,tt=typeof De=="function"&&De.prototype||Ke;return ve===tt}function pc(ve){var De=[];if(ve!=null)for(var tt in Object(ve))De.push(tt);return De}function jp(ve){return Jt.call(ve)}function Wl(ve,De,tt){return De=us(De===void 0?ve.length-1:De,0),function(){for(var $t=arguments,Hn=-1,_r=us($t.length-De,0),jr=Array(_r);++Hn<_r;)jr[Hn]=$t[De+Hn];Hn=-1;for(var cn=Array(De+1);++Hn<De;)cn[Hn]=$t[Hn];return cn[De]=tt(jr),ln(ve,this,cn)}}function Gd(ve,De){if(!(De==="constructor"&&typeof ve[De]=="function")&&De!="__proto__")return ve[De]}var df=Bp(Xo);function Bp(ve){var De=0,tt=0;return function(){var $t=ds(),Hn=d-($t-tt);if(tt=$t,Hn>0){if(++De>=l)return arguments[0]}else De=0;return ve.apply(void 0,arguments)}}function hf(ve){if(ve!=null){try{return St.call(ve)}catch{}try{return ve+""}catch{}}return""}function Os(ve,De){return ve===De||ve!==ve&&De!==De}var no=ol(function(){return arguments}())?ol:function(ve){return ho(ve)&&Ge.call(ve,"callee")&&!fi.call(ve,"callee")},ks=Array.isArray;function Ns(ve){return ve!=null&&Wp(ve.length)&&!Ls(ve)}function zl(ve){return ho(ve)&&Ns(ve)}var Ds=nl||ll;function Ls(ve){if(!mc(ve))return!1;var De=fc(ve);return De==F||De==j||De==b||De==te}function Wp(ve){return typeof ve=="number"&&ve>-1&&ve%1==0&&ve<=p}function mc(ve){var De=typeof ve;return ve!=null&&(De=="object"||De=="function")}function ho(ve){return ve!=null&&typeof ve=="object"}function Bu(ve){if(!ho(ve)||fc(ve)!=K)return!1;var De=on(ve);if(De===null)return!0;var tt=Ge.call(De,"constructor")&&De.constructor;return typeof tt=="function"&&tt instanceof tt&&St.call(tt)==fn}var ff=Ut?Xt(Ut):lf;function cl(ve){return dr(ve,Gl(ve))}function Gl(ve){return Ns(ve)?Fd(ve):Bd(ve)}var zp=Fl(function(ve,De,tt,$t){Vl(ve,De,tt,$t)});function ua(ve){return function(){return ve}}function da(ve){return ve}function ll(){return!1}n.exports=zp}(Tw,Tw.exports)),Tw.exports}var kEe=OEe();const jh=b0(kEe);function Xc(n,t=[]){const i=L.useRef(n);return L.useEffect(()=>{i.current=n}),L.useCallback((...a)=>{var l;return(l=i.current)==null?void 0:l.call(i,...a)},t)}function xS(n,t,i,a){const l=Xc(i);return L.useEffect(()=>{const d=typeof n=="function"?n():n??document;if(!(!i||!d))return d.addEventListener(t,l,a),()=>{d.removeEventListener(t,l,a)}},[t,n,a,l,i]),()=>{const d=typeof n=="function"?n():n??document;d==null||d.removeEventListener(t,l,a)}}function IQ(n){const{isOpen:t,ref:i}=n,[a,l]=L.useState(t),[d,p]=L.useState(!1);return L.useEffect(()=>{d||(l(t),p(!0))},[t,d,a]),xS(()=>i.current,"animationend",()=>{l(t)}),{present:!(t?!1:!a),onComplete(){var w;const v=J_e(i.current),b=new v.CustomEvent("animationend",{bubbles:!0});(w=i.current)==null||w.dispatchEvent(b)}}}function AQ(n){const{value:t,defaultValue:i,onChange:a,shouldUpdate:l=(N,F)=>N!==F}=n,d=Xc(a),p=Xc(l),[E,v]=L.useState(i),b=t!==void 0,w=b?t:E,A=Xc(N=>{const j=typeof N=="function"?N(w):N;p(w,j)&&(b||v(j),d(j))},[b,d,w,p]);return[w,A]}function Cp(n={}){const{onClose:t,onOpen:i,isOpen:a,id:l}=n,d=Xc(i),p=Xc(t),[E,v]=L.useState(n.defaultIsOpen||!1),b=a!==void 0?a:E,w=a!==void 0,A=L.useId(),N=l??`disclosure-${A}`,F=L.useCallback(()=>{w||v(!1),p==null||p()},[w,p]),j=L.useCallback(()=>{w||v(!0),d==null||d()},[w,d]),B=L.useCallback(()=>{b?F():j()},[b,j,F]);function H(K={}){return{...K,"aria-expanded":b,"aria-controls":N,onClick(te){var le;(le=K.onClick)==null||le.call(K,te),B()}}}function ee(K={}){return{...K,hidden:!b,id:N}}return{isOpen:b,onOpen:j,onClose:F,onToggle:B,isControlled:w,getButtonProps:H,getDisclosureProps:ee}}const yp=globalThis!=null&&globalThis.document?L.useLayoutEffect:L.useEffect,mg=(n,t)=>{const i=L.useRef(!1),a=L.useRef(!1);L.useEffect(()=>{if(i.current&&a.current)return n();a.current=!0},t),L.useEffect(()=>(i.current=!0,()=>{i.current=!1}),[])};function NEe(n){const t=n.current;if(!t)return!1;const i=Z_e(t);return!i||t.contains(i)?!1:!!pEe(i)}function PQ(n,t){const{shouldFocus:i,visible:a,focusRef:l}=t,d=i&&!a;mg(()=>{if(!d||NEe(n))return;const p=(l==null?void 0:l.current)||n.current;let E;if(p)return E=requestAnimationFrame(()=>{p.focus({preventScroll:!0})}),()=>{cancelAnimationFrame(E)}},[d,n,l])}const DEe={preventScroll:!0,shouldFocus:!1};function LEe(n,t=DEe){const{focusRef:i,preventScroll:a,shouldFocus:l,visible:d}=t,p=xEe(n)?n.current:n,E=l&&d,v=L.useRef(E),b=L.useRef(d);yp(()=>{!b.current&&d&&(v.current=E),b.current=d},[d,E]);const w=L.useCallback(()=>{if(!(!d||!p||!v.current)&&(v.current=!1,!p.contains(document.activeElement)))if(i!=null&&i.current)requestAnimationFrame(()=>{var A;(A=i.current)==null||A.focus({preventScroll:a})});else{const A=TQ(p);A.length>0&&requestAnimationFrame(()=>{A[0].focus({preventScroll:a})})}},[d,a,p,i]);mg(()=>{w()},[w]),xS(p,"transitionend",w)}function xEe(n){return"current"in n}function MEe(n){return"current"in n}const OQ=()=>typeof window<"u";function UEe(){const n=navigator.userAgentData;return(n==null?void 0:n.platform)??navigator.platform}const VEe=n=>OQ()&&n.test(navigator.vendor),FEe=n=>OQ()&&n.test(UEe()),jEe=()=>FEe(/mac|iphone|ipad|ipod/i),BEe=()=>jEe()&&VEe(/apple/i);function WEe(n){const{ref:t,elements:i,enabled:a}=n,l=()=>{var d;return((d=t.current)==null?void 0:d.ownerDocument)??document};xS(l,"pointerdown",d=>{var b,w;if(!BEe()||!a)return;const p=((w=(b=d.composedPath)==null?void 0:b.call(d))==null?void 0:w[0])??d.target,v=(i??[t]).some(A=>{const N=MEe(A)?A.current:A;return(N==null?void 0:N.contains(p))||N===p});l().activeElement!==p&&v&&(d.preventDefault(),p.focus())})}function zEe(n,t){const i=L.useId();return L.useMemo(()=>n||[t,i].filter(Boolean).join("-"),[n,t,i])}function GEe(n,...t){const i=zEe(n);return L.useMemo(()=>t.map(a=>`${a}-${i}`),[i,t])}function kQ(n){const t=L.useRef(null);return t.current=n,t}function HEe(n,t){if(n!=null){if(typeof n=="function"){n(t);return}try{n.current=t}catch{throw new Error(`Cannot assign value '${t}' to ref '${n}'`)}}}function to(...n){return t=>{n.forEach(i=>{HEe(i,t)})}}function $Ee(...n){return L.useMemo(()=>to(...n),n)}function NQ(n){const{ref:t,handler:i,enabled:a=!0}=n,l=Xc(i),p=L.useRef({isPointerDown:!1,ignoreEmulatedMouseEvents:!1}).current;L.useEffect(()=>{if(!a)return;const E=A=>{$M(A,t)&&(p.isPointerDown=!0)},v=A=>{if(p.ignoreEmulatedMouseEvents){p.ignoreEmulatedMouseEvents=!1;return}p.isPointerDown&&i&&$M(A,t)&&(p.isPointerDown=!1,l(A))},b=A=>{p.ignoreEmulatedMouseEvents=!0,i&&p.isPointerDown&&$M(A,t)&&(p.isPointerDown=!1,l(A))},w=DQ(t.current);return w.addEventListener("mousedown",E,!0),w.addEventListener("mouseup",v,!0),w.addEventListener("touchstart",E,!0),w.addEventListener("touchend",b,!0),()=>{w.removeEventListener("mousedown",E,!0),w.removeEventListener("mouseup",v,!0),w.removeEventListener("touchstart",E,!0),w.removeEventListener("touchend",b,!0)}},[i,t,l,p,a])}function $M(n,t){var a,l;const i=((a=n.composedPath)==null?void 0:a.call(n)[0])??n.target;return i&&!DQ(i).contains(i)?!1:!((l=t.current)!=null&&l.contains(i))}function DQ(n){return(n==null?void 0:n.ownerDocument)??document}function KEe(n,t){const i=Xc(n);L.useEffect(()=>{if(t==null)return;let a=null;return a=window.setTimeout(()=>{i()},t),()=>{a&&window.clearTimeout(a)}},[t,i])}const LQ=1/60*1e3,qEe=typeof performance<"u"?()=>performance.now():()=>Date.now(),xQ=typeof window<"u"?n=>window.requestAnimationFrame(n):n=>setTimeout(()=>n(qEe()),LQ);function YEe(n){let t=[],i=[],a=0,l=!1,d=!1;const p=new WeakSet,E={schedule:(v,b=!1,w=!1)=>{const A=w&&l,N=A?t:i;return b&&p.add(v),N.indexOf(v)===-1&&(N.push(v),A&&l&&(a=t.length)),v},cancel:v=>{const b=i.indexOf(v);b!==-1&&i.splice(b,1),p.delete(v)},process:v=>{if(l){d=!0;return}if(l=!0,[t,i]=[i,t],i.length=0,a=t.length,a)for(let b=0;b<a;b++){const w=t[b];w(v),p.has(w)&&(E.schedule(w),n())}l=!1,d&&(d=!1,E.process(v))}};return E}const XEe=40;let pU=!0,sR=!1,mU=!1;const MS={delta:0,timestamp:0},FR=["read","update","preRender","render","postRender"],aN=FR.reduce((n,t)=>(n[t]=YEe(()=>sR=!0),n),{}),JEe=FR.reduce((n,t)=>{const i=aN[t];return n[t]=(a,l=!1,d=!1)=>(sR||eye(),i.schedule(a,l,d)),n},{}),QEe=FR.reduce((n,t)=>(n[t]=aN[t].cancel,n),{});FR.reduce((n,t)=>(n[t]=()=>aN[t].process(MS),n),{});const ZEe=n=>aN[n].process(MS),MQ=n=>{sR=!1,MS.delta=pU?LQ:Math.max(Math.min(n-MS.timestamp,XEe),1),MS.timestamp=n,mU=!0,FR.forEach(ZEe),mU=!1,sR&&(pU=!1,xQ(MQ))},eye=()=>{sR=!0,pU=!0,mU||xQ(MQ)},J$=()=>MS;var tye=Object.defineProperty,nye=(n,t,i)=>t in n?tye(n,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[t]=i,bd=(n,t,i)=>(nye(n,typeof t!="symbol"?t+"":t,i),i);class rye{constructor(t,i,a){if(bd(this,"history",[]),bd(this,"startEvent",null),bd(this,"lastEvent",null),bd(this,"lastEventInfo",null),bd(this,"handlers",{}),bd(this,"removeListeners",()=>{}),bd(this,"threshold",3),bd(this,"win"),bd(this,"updatePoint",()=>{if(!(this.lastEvent&&this.lastEventInfo))return;const E=KM(this.lastEventInfo,this.history),v=this.startEvent!==null,b=aye(E.offset,{x:0,y:0})>=this.threshold;if(!v&&!b)return;const{timestamp:w}=J$();this.history.push({...E.point,timestamp:w});const{onStart:A,onMove:N}=this.handlers;v||(A==null||A(this.lastEvent,E),this.startEvent=this.lastEvent),N==null||N(this.lastEvent,E)}),bd(this,"onPointerMove",(E,v)=>{this.lastEvent=E,this.lastEventInfo=v,JEe.update(this.updatePoint,!0)}),bd(this,"onPointerUp",(E,v)=>{const b=KM(v,this.history),{onEnd:w,onSessionEnd:A}=this.handlers;A==null||A(E,b),this.end(),!(!w||!this.startEvent)&&(w==null||w(E,b))}),this.win=t.view??window,tEe(t))return;this.handlers=i,a&&(this.threshold=a),t.stopPropagation(),t.preventDefault();const l={point:yQ(t)},{timestamp:d}=J$();this.history=[{...l.point,timestamp:d}];const{onSessionStart:p}=i;p==null||p(t,KM(l,this.history)),this.removeListeners=sye(kO(this.win,"pointermove",this.onPointerMove),kO(this.win,"pointerup",this.onPointerUp),kO(this.win,"pointercancel",this.onPointerUp))}updateHandlers(t){this.handlers=t}end(){var t;(t=this.removeListeners)==null||t.call(this),QEe.update(this.updatePoint)}}function Q$(n,t){return{x:n.x-t.x,y:n.y-t.y}}function KM(n,t){return{point:n.point,delta:Q$(n.point,t[t.length-1]),offset:Q$(n.point,t[0]),velocity:oye(t,.1)}}const iye=n=>n*1e3;function oye(n,t){if(n.length<2)return{x:0,y:0};let i=n.length-1,a=null;const l=n[n.length-1];for(;i>=0&&(a=n[i],!(l.timestamp-a.timestamp>iye(t)));)i--;if(!a)return{x:0,y:0};const d=(l.timestamp-a.timestamp)/1e3;if(d===0)return{x:0,y:0};const p={x:(l.x-a.x)/d,y:(l.y-a.y)/d};return p.x===1/0&&(p.x=0),p.y===1/0&&(p.y=0),p}function sye(...n){return t=>n.reduce((i,a)=>a(i),t)}function qM(n,t){return Math.abs(n-t)}function Z$(n){return"x"in n&&"y"in n}function aye(n,t){if(typeof n=="number"&&typeof t=="number")return qM(n,t);if(Z$(n)&&Z$(t)){const i=qM(n.x,t.x),a=qM(n.y,t.y);return Math.sqrt(i**2+a**2)}return 0}function cye(n,t){const{onPan:i,onPanStart:a,onPanEnd:l,onPanSessionStart:d,onPanSessionEnd:p,threshold:E}=t,v=!!(i||a||l||d||p),b=L.useRef(null),w=kQ({onSessionStart:d,onSessionEnd:p,onStart:a,onMove:i,onEnd(A,N){b.current=null,l==null||l(A,N)}});L.useEffect(()=>{var A;(A=b.current)==null||A.updateHandlers(w.current)}),L.useEffect(()=>{const A=n.current;if(!A||!v)return;function N(F){b.current=new rye(F,w.current,E)}return kO(A,"pointerdown",N)},[n,v,w,E]),L.useEffect(()=>()=>{var A;(A=b.current)==null||A.end(),b.current=null},[])}const os={open:(n,t)=>`${n}[data-open], ${n}[open], ${n}[data-state=open] ${t}`,closed:(n,t)=>`${n}[data-closed], ${n}[data-state=closed] ${t}`,hover:(n,t)=>`${n}:hover ${t}, ${n}[data-hover] ${t}`,focus:(n,t)=>`${n}:focus ${t}, ${n}[data-focus] ${t}`,focusVisible:(n,t)=>`${n}:focus-visible ${t}`,focusWithin:(n,t)=>`${n}:focus-within ${t}`,active:(n,t)=>`${n}:active ${t}, ${n}[data-active] ${t}`,disabled:(n,t)=>`${n}:disabled ${t}, ${n}[data-disabled] ${t}`,invalid:(n,t)=>`${n}:invalid ${t}, ${n}[data-invalid] ${t}`,checked:(n,t)=>`${n}:checked ${t}, ${n}[data-checked] ${t}`,placeholderShown:(n,t)=>`${n}:placeholder-shown ${t}`},Oh=n=>UQ(t=>n(t,"&"),"[role=group]","[data-group]",".group"),ip=n=>UQ(t=>n(t,"~ &"),"[data-peer]",".peer"),UQ=(n,...t)=>t.map(n).join(", "),US={_hover:"&:hover, &[data-hover]",_active:"&:active, &[data-active]",_focus:"&:focus, &[data-focus]",_highlighted:"&[data-highlighted]",_focusWithin:"&:focus-within, &[data-focus-within]",_focusVisible:"&:focus-visible, &[data-focus-visible]",_disabled:"&:disabled, &[disabled], &[aria-disabled=true], &[data-disabled]",_readOnly:"&[aria-readonly=true], &[readonly], &[data-readonly]",_before:"&::before",_after:"&::after",_empty:"&:empty, &[data-empty]",_expanded:"&[aria-expanded=true], &[data-expanded], &[data-state=expanded]",_checked:"&[aria-checked=true], &[data-checked], &[data-state=checked]",_grabbed:"&[aria-grabbed=true], &[data-grabbed]",_pressed:"&[aria-pressed=true], &[data-pressed]",_invalid:"&[aria-invalid=true], &[data-invalid]",_valid:"&[data-valid], &[data-state=valid]",_loading:"&[data-loading], &[aria-busy=true]",_selected:"&[aria-selected=true], &[data-selected]",_hidden:"&[hidden], &[data-hidden]",_autofill:"&:-webkit-autofill",_even:"&:nth-of-type(even)",_odd:"&:nth-of-type(odd)",_first:"&:first-of-type",_firstLetter:"&::first-letter",_last:"&:last-of-type",_notFirst:"&:not(:first-of-type)",_notLast:"&:not(:last-of-type)",_visited:"&:visited",_activeLink:"&[aria-current=page]",_activeStep:"&[aria-current=step]",_indeterminate:"&:indeterminate, &[aria-checked=mixed], &[data-indeterminate], &[data-state=indeterminate]",_groupOpen:Oh(os.open),_groupClosed:Oh(os.closed),_groupHover:Oh(os.hover),_peerHover:ip(os.hover),_groupFocus:Oh(os.focus),_peerFocus:ip(os.focus),_groupFocusVisible:Oh(os.focusVisible),_peerFocusVisible:ip(os.focusVisible),_groupActive:Oh(os.active),_peerActive:ip(os.active),_groupDisabled:Oh(os.disabled),_peerDisabled:ip(os.disabled),_groupInvalid:Oh(os.invalid),_peerInvalid:ip(os.invalid),_groupChecked:Oh(os.checked),_peerChecked:ip(os.checked),_groupFocusWithin:Oh(os.focusWithin),_peerFocusWithin:ip(os.focusWithin),_peerPlaceholderShown:ip(os.placeholderShown),_placeholder:"&::placeholder, &[data-placeholder]",_placeholderShown:"&:placeholder-shown, &[data-placeholder-shown]",_fullScreen:"&:fullscreen, &[data-fullscreen]",_selection:"&::selection",_rtl:"[dir=rtl] &, &[dir=rtl]",_ltr:"[dir=ltr] &, &[dir=ltr]",_mediaDark:"@media (prefers-color-scheme: dark)",_mediaReduceMotion:"@media (prefers-reduced-motion: reduce)",_dark:".chakra-ui-dark &:not([data-theme]),[data-theme=dark] &:not([data-theme]),&[data-theme=dark]",_light:".chakra-ui-light &:not([data-theme]),[data-theme=light] &:not([data-theme]),&[data-theme=light]",_horizontal:"&[data-orientation=horizontal]",_vertical:"&[data-orientation=vertical]",_open:"&[data-open], &[open], &[data-state=open]",_closed:"&[data-closed], &[data-state=closed]",_complete:"&[data-complete]",_incomplete:"&[data-incomplete]",_current:"&[data-current]"},VQ=Object.keys(US),lye=n=>/!(important)?$/.test(n),eK=n=>typeof n=="string"?n.replace(/!(important)?$/,"").trim():n,uye=(n,t)=>i=>{const a=String(t),l=lye(a),d=eK(a),p=n?`${n}.${d}`:d;let E=Cu(i.__cssMap)&&p in i.__cssMap?i.__cssMap[p].varRef:t;return E=eK(E),l?`${E} !important`:E};function ZV(n){const{scale:t,transform:i,compose:a}=n;return(d,p)=>{const E=uye(t,d)(p);let v=(i==null?void 0:i(E,p))??E;return a&&(v=a(v,p)),v}}const ZP=(...n)=>t=>n.reduce((i,a)=>a(i),t);function yu(n,t){return i=>{const a={property:i,scale:n};return a.transform=ZV({scale:n,transform:t}),a}}const dye=({rtl:n,ltr:t})=>i=>i.direction==="rtl"?n:t;function hye(n){const{property:t,scale:i,transform:a}=n;return{scale:i,property:dye(t),transform:i?ZV({scale:i,compose:a}):a}}const FQ=["rotate(var(--chakra-rotate, 0))","scaleX(var(--chakra-scale-x, 1))","scaleY(var(--chakra-scale-y, 1))","skewX(var(--chakra-skew-x, 0))","skewY(var(--chakra-skew-y, 0))"];function fye(){return["translateX(var(--chakra-translate-x, 0))","translateY(var(--chakra-translate-y, 0))",...FQ].join(" ")}function pye(){return["translate3d(var(--chakra-translate-x, 0), var(--chakra-translate-y, 0), 0)",...FQ].join(" ")}const mye={"--chakra-blur":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-brightness":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-contrast":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-grayscale":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-hue-rotate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-invert":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-saturate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-sepia":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-drop-shadow":"var(--chakra-empty,/*!*/ /*!*/)",filter:["var(--chakra-blur)","var(--chakra-brightness)","var(--chakra-contrast)","var(--chakra-grayscale)","var(--chakra-hue-rotate)","var(--chakra-invert)","var(--chakra-saturate)","var(--chakra-sepia)","var(--chakra-drop-shadow)"].join(" ")},gye={backdropFilter:["var(--chakra-backdrop-blur)","var(--chakra-backdrop-brightness)","var(--chakra-backdrop-contrast)","var(--chakra-backdrop-grayscale)","var(--chakra-backdrop-hue-rotate)","var(--chakra-backdrop-invert)","var(--chakra-backdrop-opacity)","var(--chakra-backdrop-saturate)","var(--chakra-backdrop-sepia)"].join(" "),"--chakra-backdrop-blur":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-brightness":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-contrast":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-grayscale":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-hue-rotate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-invert":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-opacity":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-saturate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-sepia":"var(--chakra-empty,/*!*/ /*!*/)"};function _ye(n){return{"--chakra-ring-offset-shadow":"var(--chakra-ring-inset) 0 0 0 var(--chakra-ring-offset-width) var(--chakra-ring-offset-color)","--chakra-ring-shadow":"var(--chakra-ring-inset) 0 0 0 calc(var(--chakra-ring-width) + var(--chakra-ring-offset-width)) var(--chakra-ring-color)","--chakra-ring-width":n,boxShadow:["var(--chakra-ring-offset-shadow)","var(--chakra-ring-shadow)","var(--chakra-shadow, 0 0 #0000)"].join(", ")}}const Eye={"row-reverse":{space:"--chakra-space-x-reverse",divide:"--chakra-divide-x-reverse"},"column-reverse":{space:"--chakra-space-y-reverse",divide:"--chakra-divide-y-reverse"}},gU={"to-t":"to top","to-tr":"to top right","to-r":"to right","to-br":"to bottom right","to-b":"to bottom","to-bl":"to bottom left","to-l":"to left","to-tl":"to top left"},yye=new Set(Object.values(gU)),_U=new Set(["none","-moz-initial","inherit","initial","revert","unset"]),vye=n=>n.trim();function Sye(n,t){if(n==null||_U.has(n))return n;if(!(EU(n)||_U.has(n)))return`url('${n}')`;const l=/(^[a-z-A-Z]+)\((.*)\)/g.exec(n),d=l==null?void 0:l[1],p=l==null?void 0:l[2];if(!d||!p)return n;const E=d.includes("-gradient")?d:`${d}-gradient`,[v,...b]=p.split(",").map(vye).filter(Boolean);if((b==null?void 0:b.length)===0)return n;const w=v in gU?gU[v]:v;b.unshift(w);const A=b.map(N=>{if(yye.has(N))return N;const F=N.indexOf(" "),[j,B]=F!==-1?[N.substr(0,F),N.substr(F+1)]:[N],H=EU(B)?B:B&&B.split(" "),ee=`colors.${j}`,K=ee in t.__cssMap?t.__cssMap[ee].varRef:j;return H?[K,...Array.isArray(H)?H:[H]].join(" "):K});return`${E}(${A.join(", ")})`}const EU=n=>typeof n=="string"&&n.includes("(")&&n.includes(")"),bye=(n,t)=>Sye(n,t??{});function Tye(n){return/^var\(--.+\)$/.test(n)}const wye=n=>{const t=parseFloat(n.toString()),i=n.toString().replace(String(t),"");return{unitless:!i,value:t,unit:i}},kh=n=>t=>`${n}(${t})`,Ir={filter(n){return n!=="auto"?n:mye},backdropFilter(n){return n!=="auto"?n:gye},ring(n){return _ye(Ir.px(n))},bgClip(n){return n==="text"?{color:"transparent",backgroundClip:"text"}:{backgroundClip:n}},transform(n){return n==="auto"?fye():n==="auto-gpu"?pye():n},vh(n){return n==="$100vh"?"var(--chakra-vh)":n},px(n){if(n==null)return n;const{unitless:t}=wye(n);return t||typeof n=="number"?`${n}px`:n},fraction(n){return typeof n!="number"||n>1?n:`${n*100}%`},float(n,t){const i={left:"right",right:"left"};return t.direction==="rtl"?i[n]:n},degree(n){if(Tye(n)||n==null)return n;const t=typeof n=="string"&&!n.endsWith("deg");return typeof n=="number"||t?`${n}deg`:n},gradient:bye,blur:kh("blur"),opacity:kh("opacity"),brightness:kh("brightness"),contrast:kh("contrast"),dropShadow:kh("drop-shadow"),grayscale:kh("grayscale"),hueRotate:n=>kh("hue-rotate")(Ir.degree(n)),invert:kh("invert"),saturate:kh("saturate"),sepia:kh("sepia"),bgImage(n){return n==null||EU(n)||_U.has(n)?n:`url(${n})`},outline(n){const t=String(n)==="0"||String(n)==="none";return n!==null&&t?{outline:"2px solid transparent",outlineOffset:"2px"}:{outline:n}},flexDirection(n){const{space:t,divide:i}=Eye[n]??{},a={flexDirection:n};return t&&(a[t]=1),i&&(a[i]=1),a}},Be={borderWidths:yu("borderWidths"),borderStyles:yu("borderStyles"),colors:yu("colors"),borders:yu("borders"),gradients:yu("gradients",Ir.gradient),radii:yu("radii",Ir.px),space:yu("space",ZP(Ir.vh,Ir.px)),spaceT:yu("space",ZP(Ir.vh,Ir.px)),degreeT(n){return{property:n,transform:Ir.degree}},prop(n,t,i){return{property:n,scale:t,...t&&{transform:ZV({scale:t,transform:i})}}},propT(n,t){return{property:n,transform:t}},sizes:yu("sizes",ZP(Ir.vh,Ir.px)),sizesT:yu("sizes",ZP(Ir.vh,Ir.fraction)),shadows:yu("shadows"),logical:hye,blur:yu("blur",Ir.blur)},NO={background:Be.colors("background"),backgroundColor:Be.colors("backgroundColor"),backgroundImage:Be.gradients("backgroundImage"),backgroundSize:!0,backgroundPosition:!0,backgroundRepeat:!0,backgroundAttachment:!0,backgroundClip:{transform:Ir.bgClip},bgSize:Be.prop("backgroundSize"),bgPosition:Be.prop("backgroundPosition"),bg:Be.colors("background"),bgColor:Be.colors("backgroundColor"),bgPos:Be.prop("backgroundPosition"),bgRepeat:Be.prop("backgroundRepeat"),bgAttachment:Be.prop("backgroundAttachment"),bgGradient:Be.gradients("backgroundImage"),bgClip:{transform:Ir.bgClip}};Object.assign(NO,{bgImage:NO.backgroundImage,bgImg:NO.backgroundImage});const $r={border:Be.borders("border"),borderWidth:Be.borderWidths("borderWidth"),borderStyle:Be.borderStyles("borderStyle"),borderColor:Be.colors("borderColor"),borderRadius:Be.radii("borderRadius"),borderTop:Be.borders("borderTop"),borderBlockStart:Be.borders("borderBlockStart"),borderTopLeftRadius:Be.radii("borderTopLeftRadius"),borderStartStartRadius:Be.logical({scale:"radii",property:{ltr:"borderTopLeftRadius",rtl:"borderTopRightRadius"}}),borderEndStartRadius:Be.logical({scale:"radii",property:{ltr:"borderBottomLeftRadius",rtl:"borderBottomRightRadius"}}),borderTopRightRadius:Be.radii("borderTopRightRadius"),borderStartEndRadius:Be.logical({scale:"radii",property:{ltr:"borderTopRightRadius",rtl:"borderTopLeftRadius"}}),borderEndEndRadius:Be.logical({scale:"radii",property:{ltr:"borderBottomRightRadius",rtl:"borderBottomLeftRadius"}}),borderRight:Be.borders("borderRight"),borderInlineEnd:Be.borders("borderInlineEnd"),borderBottom:Be.borders("borderBottom"),borderBlockEnd:Be.borders("borderBlockEnd"),borderBottomLeftRadius:Be.radii("borderBottomLeftRadius"),borderBottomRightRadius:Be.radii("borderBottomRightRadius"),borderLeft:Be.borders("borderLeft"),borderInlineStart:{property:"borderInlineStart",scale:"borders"},borderInlineStartRadius:Be.logical({scale:"radii",property:{ltr:["borderTopLeftRadius","borderBottomLeftRadius"],rtl:["borderTopRightRadius","borderBottomRightRadius"]}}),borderInlineEndRadius:Be.logical({scale:"radii",property:{ltr:["borderTopRightRadius","borderBottomRightRadius"],rtl:["borderTopLeftRadius","borderBottomLeftRadius"]}}),borderX:Be.borders(["borderLeft","borderRight"]),borderInline:Be.borders("borderInline"),borderY:Be.borders(["borderTop","borderBottom"]),borderBlock:Be.borders("borderBlock"),borderTopWidth:Be.borderWidths("borderTopWidth"),borderBlockStartWidth:Be.borderWidths("borderBlockStartWidth"),borderTopColor:Be.colors("borderTopColor"),borderBlockStartColor:Be.colors("borderBlockStartColor"),borderTopStyle:Be.borderStyles("borderTopStyle"),borderBlockStartStyle:Be.borderStyles("borderBlockStartStyle"),borderBottomWidth:Be.borderWidths("borderBottomWidth"),borderBlockEndWidth:Be.borderWidths("borderBlockEndWidth"),borderBottomColor:Be.colors("borderBottomColor"),borderBlockEndColor:Be.colors("borderBlockEndColor"),borderBottomStyle:Be.borderStyles("borderBottomStyle"),borderBlockEndStyle:Be.borderStyles("borderBlockEndStyle"),borderLeftWidth:Be.borderWidths("borderLeftWidth"),borderInlineStartWidth:Be.borderWidths("borderInlineStartWidth"),borderLeftColor:Be.colors("borderLeftColor"),borderInlineStartColor:Be.colors("borderInlineStartColor"),borderLeftStyle:Be.borderStyles("borderLeftStyle"),borderInlineStartStyle:Be.borderStyles("borderInlineStartStyle"),borderRightWidth:Be.borderWidths("borderRightWidth"),borderInlineEndWidth:Be.borderWidths("borderInlineEndWidth"),borderRightColor:Be.colors("borderRightColor"),borderInlineEndColor:Be.colors("borderInlineEndColor"),borderRightStyle:Be.borderStyles("borderRightStyle"),borderInlineEndStyle:Be.borderStyles("borderInlineEndStyle"),borderTopRadius:Be.radii(["borderTopLeftRadius","borderTopRightRadius"]),borderBottomRadius:Be.radii(["borderBottomLeftRadius","borderBottomRightRadius"]),borderLeftRadius:Be.radii(["borderTopLeftRadius","borderBottomLeftRadius"]),borderRightRadius:Be.radii(["borderTopRightRadius","borderBottomRightRadius"])};Object.assign($r,{rounded:$r.borderRadius,roundedTop:$r.borderTopRadius,roundedTopLeft:$r.borderTopLeftRadius,roundedTopRight:$r.borderTopRightRadius,roundedTopStart:$r.borderStartStartRadius,roundedTopEnd:$r.borderStartEndRadius,roundedBottom:$r.borderBottomRadius,roundedBottomLeft:$r.borderBottomLeftRadius,roundedBottomRight:$r.borderBottomRightRadius,roundedBottomStart:$r.borderEndStartRadius,roundedBottomEnd:$r.borderEndEndRadius,roundedLeft:$r.borderLeftRadius,roundedRight:$r.borderRightRadius,roundedStart:$r.borderInlineStartRadius,roundedEnd:$r.borderInlineEndRadius,borderStart:$r.borderInlineStart,borderEnd:$r.borderInlineEnd,borderTopStartRadius:$r.borderStartStartRadius,borderTopEndRadius:$r.borderStartEndRadius,borderBottomStartRadius:$r.borderEndStartRadius,borderBottomEndRadius:$r.borderEndEndRadius,borderStartRadius:$r.borderInlineStartRadius,borderEndRadius:$r.borderInlineEndRadius,borderStartWidth:$r.borderInlineStartWidth,borderEndWidth:$r.borderInlineEndWidth,borderStartColor:$r.borderInlineStartColor,borderEndColor:$r.borderInlineEndColor,borderStartStyle:$r.borderInlineStartStyle,borderEndStyle:$r.borderInlineEndStyle});const Rye={color:Be.colors("color"),textColor:Be.colors("color"),fill:Be.colors("fill"),stroke:Be.colors("stroke"),accentColor:Be.colors("accentColor"),textFillColor:Be.colors("textFillColor")},pk={alignItems:!0,alignContent:!0,justifyItems:!0,justifyContent:!0,flexWrap:!0,flexDirection:{transform:Ir.flexDirection},flex:!0,flexFlow:!0,flexGrow:!0,flexShrink:!0,flexBasis:Be.sizes("flexBasis"),justifySelf:!0,alignSelf:!0,order:!0,placeItems:!0,placeContent:!0,placeSelf:!0,gap:Be.space("gap"),rowGap:Be.space("rowGap"),columnGap:Be.space("columnGap")};Object.assign(pk,{flexDir:pk.flexDirection});const bu={width:Be.sizesT("width"),inlineSize:Be.sizesT("inlineSize"),height:Be.sizes("height"),blockSize:Be.sizes("blockSize"),boxSize:Be.sizes(["width","height"]),minWidth:Be.sizes("minWidth"),minInlineSize:Be.sizes("minInlineSize"),minHeight:Be.sizes("minHeight"),minBlockSize:Be.sizes("minBlockSize"),maxWidth:Be.sizes("maxWidth"),maxInlineSize:Be.sizes("maxInlineSize"),maxHeight:Be.sizes("maxHeight"),maxBlockSize:Be.sizes("maxBlockSize"),overflow:!0,overflowX:!0,overflowY:!0,overscrollBehavior:!0,overscrollBehaviorX:!0,overscrollBehaviorY:!0,display:!0,aspectRatio:!0,hideFrom:{scale:"breakpoints",transform:(n,t)=>{var l,d;return{[`@media screen and (min-width: ${((d=(l=t.__breakpoints)==null?void 0:l.get(n))==null?void 0:d.minW)??n})`]:{display:"none"}}}},hideBelow:{scale:"breakpoints",transform:(n,t)=>{var l,d;return{[`@media screen and (max-width: ${((d=(l=t.__breakpoints)==null?void 0:l.get(n))==null?void 0:d._minW)??n})`]:{display:"none"}}}},verticalAlign:!0,boxSizing:!0,boxDecorationBreak:!0,float:Be.propT("float",Ir.float),objectFit:!0,objectPosition:!0,visibility:!0,isolation:!0};Object.assign(bu,{w:bu.width,h:bu.height,minW:bu.minWidth,maxW:bu.maxWidth,minH:bu.minHeight,maxH:bu.maxHeight,overscroll:bu.overscrollBehavior,overscrollX:bu.overscrollBehaviorX,overscrollY:bu.overscrollBehaviorY});const Cye={filter:{transform:Ir.filter},blur:Be.blur("--chakra-blur"),brightness:Be.propT("--chakra-brightness",Ir.brightness),contrast:Be.propT("--chakra-contrast",Ir.contrast),hueRotate:Be.propT("--chakra-hue-rotate",Ir.hueRotate),invert:Be.propT("--chakra-invert",Ir.invert),saturate:Be.propT("--chakra-saturate",Ir.saturate),dropShadow:Be.propT("--chakra-drop-shadow",Ir.dropShadow),backdropFilter:{transform:Ir.backdropFilter},backdropBlur:Be.blur("--chakra-backdrop-blur"),backdropBrightness:Be.propT("--chakra-backdrop-brightness",Ir.brightness),backdropContrast:Be.propT("--chakra-backdrop-contrast",Ir.contrast),backdropHueRotate:Be.propT("--chakra-backdrop-hue-rotate",Ir.hueRotate),backdropInvert:Be.propT("--chakra-backdrop-invert",Ir.invert),backdropSaturate:Be.propT("--chakra-backdrop-saturate",Ir.saturate)},Iye={ring:{transform:Ir.ring},ringColor:Be.colors("--chakra-ring-color"),ringOffset:Be.prop("--chakra-ring-offset-width"),ringOffsetColor:Be.colors("--chakra-ring-offset-color"),ringInset:Be.prop("--chakra-ring-inset")},Aye={appearance:!0,cursor:!0,resize:!0,userSelect:!0,pointerEvents:!0,outline:{transform:Ir.outline},outlineOffset:!0,outlineColor:Be.colors("outlineColor")},jQ={gridGap:Be.space("gridGap"),gridColumnGap:Be.space("gridColumnGap"),gridRowGap:Be.space("gridRowGap"),gridColumn:!0,gridRow:!0,gridAutoFlow:!0,gridAutoColumns:!0,gridColumnStart:!0,gridColumnEnd:!0,gridRowStart:!0,gridRowEnd:!0,gridAutoRows:!0,gridTemplate:!0,gridTemplateColumns:!0,gridTemplateRows:!0,gridTemplateAreas:!0,gridArea:!0};function Pye(n,t,i,a){const l=typeof t=="string"?t.split("."):[t];for(a=0;a<l.length&&n;a+=1)n=n[l[a]];return n===void 0?i:n}const Oye=n=>{const t=new WeakMap;return(a,l,d,p)=>{if(typeof a>"u")return n(a,l,d);t.has(a)||t.set(a,new Map);const E=t.get(a);if(E.has(l))return E.get(l);const v=n(a,l,d,p);return E.set(l,v),v}},kye=Oye(Pye),Nye={border:"0px",clip:"rect(0, 0, 0, 0)",width:"1px",height:"1px",margin:"-1px",padding:"0px",overflow:"hidden",whiteSpace:"nowrap",position:"absolute"},Dye={position:"static",width:"auto",height:"auto",clip:"auto",padding:"0",margin:"0",overflow:"visible",whiteSpace:"normal"},YM=(n,t,i)=>{const a={},l=kye(n,t,{});for(const d in l)d in i&&i[d]!=null||(a[d]=l[d]);return a},Lye={srOnly:{transform(n){return n===!0?Nye:n==="focusable"?Dye:{}}},layerStyle:{processResult:!0,transform:(n,t,i)=>YM(t,`layerStyles.${n}`,i)},textStyle:{processResult:!0,transform:(n,t,i)=>YM(t,`textStyles.${n}`,i)},apply:{processResult:!0,transform:(n,t,i)=>YM(t,n,i)}},jw={position:!0,pos:Be.prop("position"),zIndex:Be.prop("zIndex","zIndices"),inset:Be.spaceT("inset"),insetX:Be.spaceT(["left","right"]),insetInline:Be.spaceT("insetInline"),insetY:Be.spaceT(["top","bottom"]),insetBlock:Be.spaceT("insetBlock"),top:Be.spaceT("top"),insetBlockStart:Be.spaceT("insetBlockStart"),bottom:Be.spaceT("bottom"),insetBlockEnd:Be.spaceT("insetBlockEnd"),left:Be.spaceT("left"),insetInlineStart:Be.logical({scale:"space",property:{ltr:"left",rtl:"right"}}),right:Be.spaceT("right"),insetInlineEnd:Be.logical({scale:"space",property:{ltr:"right",rtl:"left"}})};Object.assign(jw,{insetStart:jw.insetInlineStart,insetEnd:jw.insetInlineEnd});const yU={boxShadow:Be.shadows("boxShadow"),mixBlendMode:!0,blendMode:Be.prop("mixBlendMode"),backgroundBlendMode:!0,bgBlendMode:Be.prop("backgroundBlendMode"),opacity:!0};Object.assign(yU,{shadow:yU.boxShadow});const Gi={margin:Be.spaceT("margin"),marginTop:Be.spaceT("marginTop"),marginBlockStart:Be.spaceT("marginBlockStart"),marginRight:Be.spaceT("marginRight"),marginInlineEnd:Be.spaceT("marginInlineEnd"),marginBottom:Be.spaceT("marginBottom"),marginBlockEnd:Be.spaceT("marginBlockEnd"),marginLeft:Be.spaceT("marginLeft"),marginInlineStart:Be.spaceT("marginInlineStart"),marginX:Be.spaceT(["marginInlineStart","marginInlineEnd"]),marginInline:Be.spaceT("marginInline"),marginY:Be.spaceT(["marginTop","marginBottom"]),marginBlock:Be.spaceT("marginBlock"),padding:Be.space("padding"),paddingTop:Be.space("paddingTop"),paddingBlockStart:Be.space("paddingBlockStart"),paddingRight:Be.space("paddingRight"),paddingBottom:Be.space("paddingBottom"),paddingBlockEnd:Be.space("paddingBlockEnd"),paddingLeft:Be.space("paddingLeft"),paddingInlineStart:Be.space("paddingInlineStart"),paddingInlineEnd:Be.space("paddingInlineEnd"),paddingX:Be.space(["paddingInlineStart","paddingInlineEnd"]),paddingInline:Be.space("paddingInline"),paddingY:Be.space(["paddingTop","paddingBottom"]),paddingBlock:Be.space("paddingBlock")};Object.assign(Gi,{m:Gi.margin,mt:Gi.marginTop,mr:Gi.marginRight,me:Gi.marginInlineEnd,marginEnd:Gi.marginInlineEnd,mb:Gi.marginBottom,ml:Gi.marginLeft,ms:Gi.marginInlineStart,marginStart:Gi.marginInlineStart,mx:Gi.marginX,my:Gi.marginY,p:Gi.padding,pt:Gi.paddingTop,py:Gi.paddingY,px:Gi.paddingX,pb:Gi.paddingBottom,pl:Gi.paddingLeft,ps:Gi.paddingInlineStart,paddingStart:Gi.paddingInlineStart,pr:Gi.paddingRight,pe:Gi.paddingInlineEnd,paddingEnd:Gi.paddingInlineEnd});const xye={scrollBehavior:!0,scrollSnapAlign:!0,scrollSnapStop:!0,scrollSnapType:!0,scrollMargin:Be.spaceT("scrollMargin"),scrollMarginTop:Be.spaceT("scrollMarginTop"),scrollMarginBottom:Be.spaceT("scrollMarginBottom"),scrollMarginLeft:Be.spaceT("scrollMarginLeft"),scrollMarginRight:Be.spaceT("scrollMarginRight"),scrollMarginX:Be.spaceT(["scrollMarginLeft","scrollMarginRight"]),scrollMarginY:Be.spaceT(["scrollMarginTop","scrollMarginBottom"]),scrollPadding:Be.spaceT("scrollPadding"),scrollPaddingTop:Be.spaceT("scrollPaddingTop"),scrollPaddingBottom:Be.spaceT("scrollPaddingBottom"),scrollPaddingLeft:Be.spaceT("scrollPaddingLeft"),scrollPaddingRight:Be.spaceT("scrollPaddingRight"),scrollPaddingX:Be.spaceT(["scrollPaddingLeft","scrollPaddingRight"]),scrollPaddingY:Be.spaceT(["scrollPaddingTop","scrollPaddingBottom"])},Mye={fontFamily:Be.prop("fontFamily","fonts"),fontSize:Be.prop("fontSize","fontSizes",Ir.px),fontWeight:Be.prop("fontWeight","fontWeights"),lineHeight:Be.prop("lineHeight","lineHeights"),letterSpacing:Be.prop("letterSpacing","letterSpacings"),textAlign:!0,fontStyle:!0,textIndent:!0,wordBreak:!0,overflowWrap:!0,textOverflow:!0,textTransform:!0,whiteSpace:!0,isTruncated:{transform(n){if(n===!0)return{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}},noOfLines:{static:{overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitBoxOrient:"vertical",WebkitLineClamp:"var(--chakra-line-clamp)"},property:"--chakra-line-clamp"}},Uye={textDecorationColor:Be.colors("textDecorationColor"),textDecoration:!0,textDecor:{property:"textDecoration"},textDecorationLine:!0,textDecorationStyle:!0,textDecorationThickness:!0,textUnderlineOffset:!0,textShadow:Be.shadows("textShadow")},Vye={clipPath:!0,transform:Be.propT("transform",Ir.transform),transformOrigin:!0,translateX:Be.spaceT("--chakra-translate-x"),translateY:Be.spaceT("--chakra-translate-y"),skewX:Be.degreeT("--chakra-skew-x"),skewY:Be.degreeT("--chakra-skew-y"),scaleX:Be.prop("--chakra-scale-x"),scaleY:Be.prop("--chakra-scale-y"),scale:Be.prop(["--chakra-scale-x","--chakra-scale-y"]),rotate:Be.degreeT("--chakra-rotate")},Fye={listStyleType:!0,listStylePosition:!0,listStylePos:Be.prop("listStylePosition"),listStyleImage:!0,listStyleImg:Be.prop("listStyleImage")},jye={transition:!0,transitionDelay:!0,animation:!0,willChange:!0,transitionDuration:Be.prop("transitionDuration","transition.duration"),transitionProperty:Be.prop("transitionProperty","transition.property"),transitionTimingFunction:Be.prop("transitionTimingFunction","transition.easing")},eF=jh({},NO,$r,Rye,pk,bu,Cye,Iye,Aye,jQ,Lye,jw,yU,Gi,xye,Mye,Uye,Vye,Fye,jye),Bye=Object.assign({},Gi,bu,pk,jQ,jw),Wye=Object.keys(Bye),zye=[...Object.keys(eF),...VQ],Gye={...eF,...US},Hye=n=>n in Gye,$ye=n=>t=>{if(!t.__breakpoints)return n;const{isResponsive:i,toArrayValue:a,media:l}=t.__breakpoints,d={};for(const p in n){let E=Yc(n[p],t);if(E==null)continue;if(E=Cu(E)&&i(E)?a(E):E,!Array.isArray(E)){d[p]=E;continue}const v=E.slice(0,l.length).length;for(let b=0;b<v;b+=1){const w=l==null?void 0:l[b];if(!w){d[p]=E[b];continue}d[w]=d[w]||{},E[b]!=null&&(d[w][p]=E[b])}}return d};function Kye(n){const t=[];let i="",a=!1;for(let l=0;l<n.length;l++){const d=n[l];d==="("?(a=!0,i+=d):d===")"?(a=!1,i+=d):d===","&&!a?(t.push(i),i=""):i+=d}return i=i.trim(),i&&t.push(i),t}function qye(n){return/^var\(--.+\)$/.test(n)}const Yye=(n,t)=>n.startsWith("--")&&typeof t=="string"&&!qye(t),Xye=(n,t)=>{if(t==null)return t;const i=p=>{var E,v;return(v=(E=n.__cssMap)==null?void 0:E[p])==null?void 0:v.varRef},a=p=>i(p)??p,[l,d]=Kye(t);return t=i(l)??a(d)??a(t),t};function Jye(n){const{configs:t={},pseudos:i={},theme:a}=n,l=(d,p=!1)=>{var w;const E=Yc(d,a),v=$ye(E)(a);let b={};for(let A in v){const N=v[A];let F=Yc(N,a);A in i&&(A=i[A]),Yye(A,F)&&(F=Xye(a,F));let j=t[A];if(j===!0&&(j={property:A}),Cu(F)){b[A]=b[A]??{},b[A]=jh({},b[A],l(F,!0));continue}let B=((w=j==null?void 0:j.transform)==null?void 0:w.call(j,F,a,E))??F;B=j!=null&&j.processResult?l(B,!0):B;const H=Yc(j==null?void 0:j.property,a);if(!p&&(j!=null&&j.static)){const ee=Yc(j.static,a);b=jh({},b,ee)}if(H&&Array.isArray(H)){for(const ee of H)b[ee]=B;continue}if(H){H==="&"&&Cu(B)?b=jh({},b,B):b[H]=B;continue}if(Cu(B)){b=jh({},b,B);continue}b[A]=B}return b};return l}const BQ=n=>t=>Jye({theme:t,pseudos:US,configs:eF})(n);function b8e(n){return n}function T8e(n){return n}function xi(n){return{definePartsStyle(t){return t},defineMultiStyleConfig(t){return{parts:n,...t}}}}function Qye(n,t,i){var a,l;return((l=(a=n.__cssMap)==null?void 0:a[`${t}.${i}`])==null?void 0:l.varRef)??i}function Zye(n,t){if(Array.isArray(n))return n;if(Cu(n))return t(n);if(n!=null)return[n]}function eve(n,t){for(let i=t+1;i<n.length;i++)if(n[i]!=null)return i;return-1}function tve(n){const t=n.__breakpoints;return function(a,l,d,p){var N,F;if(!t)return;const E={},v=Zye(d,t.toArrayValue);if(!v)return E;const b=v.length,w=b===1,A=!!a.parts;for(let j=0;j<b;j++){const B=t.details[j],H=t.details[eve(v,j)],ee=bw(B.minW,H==null?void 0:H._minW),K=Yc((N=a[l])==null?void 0:N[v[j]],p);if(K){if(A){(F=a.parts)==null||F.forEach(te=>{jh(E,{[te]:w?K[te]:{[ee]:K[te]}})});continue}if(!A){w?jh(E,K):E[ee]=K;continue}E[ee]=K}}return E}}function nve(n){return t=>{const{variant:i,size:a,theme:l}=t,d=tve(l);return jh({},Yc(n.baseStyle??{},t),d(n,"sizes",a,t),d(n,"variants",i,t))}}function qi(n){return T0(n,["styleConfig","size","variant","colorScheme"])}function WQ(n){return Cu(n)&&n.reference?n.reference:String(n)}const cN=(n,...t)=>t.map(WQ).join(` ${n} `).replace(/calc/g,""),tK=(...n)=>`calc(${cN("+",...n)})`,nK=(...n)=>`calc(${cN("-",...n)})`,vU=(...n)=>`calc(${cN("*",...n)})`,rK=(...n)=>`calc(${cN("/",...n)})`,iK=n=>{const t=WQ(n);return t!=null&&!Number.isNaN(parseFloat(t))?String(t).startsWith("-")?String(t).slice(1):`-${t}`:vU(t,-1)},lp=Object.assign(n=>({add:(...t)=>lp(tK(n,...t)),subtract:(...t)=>lp(nK(n,...t)),multiply:(...t)=>lp(vU(n,...t)),divide:(...t)=>lp(rK(n,...t)),negate:()=>lp(iK(n)),toString:()=>n.toString()}),{add:tK,subtract:nK,multiply:vU,divide:rK,negate:iK});function rve(n,t="-"){return n.replace(/\s+/g,t)}function ive(n){const t=rve(n.toString());return sve(ove(t))}function ove(n){return n.includes("\\.")?n:!Number.isInteger(parseFloat(n.toString()))?n.replace(".","\\."):n}function sve(n){return n.replace(/[!-,/:-@[-^`{-~]/g,"\\$&")}function ave(n,t=""){return[t,n].filter(Boolean).join("-")}function cve(n,t){return`var(${n}${t?`, ${t}`:""})`}function lve(n,t=""){return ive(`--${ave(n,t)}`)}function Pn(n,t,i){const a=lve(n,i);return{variable:a,reference:cve(a,t)}}function uve(n,t){const i={};for(const a of t){if(Array.isArray(a)){const[l,d]=a;i[l]=Pn(`${n}-${l}`,d);continue}i[a]=Pn(`${n}-${a}`)}return i}const dve=["colors","borders","borderWidths","borderStyles","fonts","fontSizes","fontWeights","gradients","letterSpacings","lineHeights","radii","space","shadows","sizes","zIndices","transition","blur","breakpoints"];function hve(n){return RQ(n,dve)}function fve(n){return n.semanticTokens}function pve(n){const{__cssMap:t,__cssVars:i,__breakpoints:a,...l}=n;return l}function mve(n){const t=hve(n),i=fve(n),a=d=>VQ.includes(d)||d==="default",l={};return Y$(t,(d,p)=>{d!=null&&(l[p.join(".")]={isSemantic:!1,value:d})}),Y$(i,(d,p)=>{d!=null&&(l[p.join(".")]={isSemantic:!0,value:d})},{stop:d=>Object.keys(d).every(a)}),l}function oK(n,t){return Pn(String(n).replace(/\./g,"-"),void 0,t)}function gve(n){var p;const t=mve(n),i=(p=n.config)==null?void 0:p.cssVarPrefix;let a={};const l={};function d(E,v){const w=[String(E).split(".")[0],v].join(".");if(!t[w])return v;const{reference:N}=oK(w,i);return N}for(const[E,v]of Object.entries(t)){const{isSemantic:b,value:w}=v,{variable:A,reference:N}=oK(E,i);if(!b){if(E.startsWith("space")){const j=E.split("."),[B,...H]=j,ee=`${B}.-${H.join(".")}`,K=lp.negate(w),te=lp.negate(N);l[ee]={value:K,var:A,varRef:te}}a[A]=w,l[E]={value:w,var:A,varRef:N};continue}const F=Cu(w)?w:{default:w};a=jh(a,Object.entries(F).reduce((j,[B,H])=>{if(!H)return j;const ee=d(E,`${H}`);if(B==="default")return j[A]=ee,j;const K=(US==null?void 0:US[B])??B;return j[K]={[A]:ee},j},{})),l[E]={value:N,var:A,varRef:N}}return{cssVars:a,cssMap:l}}function _ve(n){const t=pve(n),{cssMap:i,cssVars:a}=gve(t);return Object.assign(t,{__cssVars:{...{"--chakra-ring-inset":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-ring-offset-width":"0px","--chakra-ring-offset-color":"#fff","--chakra-ring-color":"rgba(66, 153, 225, 0.6)","--chakra-ring-offset-shadow":"0 0 #0000","--chakra-ring-shadow":"0 0 #0000","--chakra-space-x-reverse":"0","--chakra-space-y-reverse":"0"},...a},__cssMap:i,__breakpoints:dEe(t.breakpoints)}),t}function Xr(n,t={}){let i=!1;function a(){if(!i){i=!0;return}throw new Error("[anatomy] .part(...) should only be called once. Did you mean to use .extend(...) ?")}function l(...w){a();for(const A of w)t[A]=v(A);return Xr(n,t)}function d(...w){for(const A of w)A in t||(t[A]=v(A));return Xr(n,t)}function p(){return Object.fromEntries(Object.entries(t).map(([A,N])=>[A,N.selector]))}function E(){return Object.fromEntries(Object.entries(t).map(([A,N])=>[A,N.className]))}function v(w){const F=`chakra-${(["container","root"].includes(w??"")?[n]:[n,w]).filter(Boolean).join("__")}`;return{className:F,selector:`.${F}`,toString:()=>w}}return{parts:l,toPart:v,extend:d,selectors:p,classnames:E,get keys(){return Object.keys(t)},__type:{}}}const Eve=Xr("accordion").parts("root","container","button","panel","icon"),yve=Xr("alert").parts("title","description","container","icon","spinner"),vve=Xr("avatar").parts("label","badge","container","excessLabel","group"),Sve=Xr("breadcrumb").parts("link","item","container","separator");Xr("button").parts();const bve=Xr("checkbox").parts("control","icon","container","label");Xr("progress").parts("track","filledTrack","label");const Tve=Xr("drawer").parts("overlay","dialogContainer","dialog","header","closeButton","body","footer"),wve=Xr("editable").parts("preview","input","textarea"),Rve=Xr("form").parts("container","requiredIndicator","helperText"),Cve=Xr("formError").parts("text","icon"),Ive=Xr("input").parts("addon","field","element","group"),Ave=Xr("list").parts("container","item","icon"),Pve=Xr("menu").parts("button","list","item","groupTitle","icon","command","divider"),Ove=Xr("modal").parts("overlay","dialogContainer","dialog","header","closeButton","body","footer"),kve=Xr("numberinput").parts("root","field","stepperGroup","stepper");Xr("pininput").parts("field");const Nve=Xr("popover").parts("content","header","body","footer","popper","arrow","closeButton"),Dve=Xr("progress").parts("label","filledTrack","track"),Lve=Xr("radio").parts("container","control","label"),xve=Xr("select").parts("field","icon"),Mve=Xr("slider").parts("container","track","thumb","filledTrack","mark"),Uve=Xr("stat").parts("container","label","helpText","number","icon"),Vve=Xr("switch").parts("container","track","thumb","label"),Fve=Xr("table").parts("table","thead","tbody","tr","th","td","tfoot","caption"),jve=Xr("tabs").parts("root","tab","tablist","tabpanel","tabpanels","indicator"),Bve=Xr("tag").parts("container","label","closeButton"),Wve=Xr("card").parts("container","header","body","footer");Xr("stepper").parts("stepper","step","title","description","indicator","separator","icon","number");const{definePartsStyle:zve,defineMultiStyleConfig:Gve}=xi(Eve.keys),Hve={borderTopWidth:"1px",borderColor:"inherit",_last:{borderBottomWidth:"1px"}},$ve={transitionProperty:"common",transitionDuration:"normal",fontSize:"md",_focusVisible:{boxShadow:"outline"},_hover:{bg:"blackAlpha.50"},_disabled:{opacity:.4,cursor:"not-allowed"},px:"4",py:"2"},Kve={pt:"2",px:"4",pb:"5"},qve={fontSize:"1.25em"},Yve=zve({container:Hve,button:$ve,panel:Kve,icon:qve}),Xve=Gve({baseStyle:Yve});function uE(n,t,i){return Math.min(Math.max(n,i),t)}class Jve extends Error{constructor(t){super(`Failed to parse color: "${t}"`)}}var ww=Jve;function tF(n){if(typeof n!="string")throw new ww(n);if(n.trim().toLowerCase()==="transparent")return[0,0,0,0];let t=n.trim();t=oSe.test(n)?eSe(n):n;const i=tSe.exec(t);if(i){const p=Array.from(i).slice(1);return[...p.slice(0,3).map(E=>parseInt(aR(E,2),16)),parseInt(aR(p[3]||"f",2),16)/255]}const a=nSe.exec(t);if(a){const p=Array.from(a).slice(1);return[...p.slice(0,3).map(E=>parseInt(E,16)),parseInt(p[3]||"ff",16)/255]}const l=rSe.exec(t);if(l){const p=Array.from(l).slice(1);return[...p.slice(0,3).map(E=>parseInt(E,10)),parseFloat(p[3]||"1")]}const d=iSe.exec(t);if(d){const[p,E,v,b]=Array.from(d).slice(1).map(parseFloat);if(uE(0,100,E)!==E)throw new ww(n);if(uE(0,100,v)!==v)throw new ww(n);return[...sSe(p,E,v),Number.isNaN(b)?1:b]}throw new ww(n)}function Qve(n){let t=5381,i=n.length;for(;i;)t=t*33^n.charCodeAt(--i);return(t>>>0)%2341}const sK=n=>parseInt(n.replace(/_/g,""),36),Zve="1q29ehhb 1n09sgk7 1kl1ekf_ _yl4zsno 16z9eiv3 1p29lhp8 _bd9zg04 17u0____ _iw9zhe5 _to73___ _r45e31e _7l6g016 _jh8ouiv _zn3qba8 1jy4zshs 11u87k0u 1ro9yvyo 1aj3xael 1gz9zjz0 _3w8l4xo 1bf1ekf_ _ke3v___ _4rrkb__ 13j776yz _646mbhl _nrjr4__ _le6mbhl 1n37ehkb _m75f91n _qj3bzfz 1939yygw 11i5z6x8 _1k5f8xs 1509441m 15t5lwgf _ae2th1n _tg1ugcv 1lp1ugcv 16e14up_ _h55rw7n _ny9yavn _7a11xb_ 1ih442g9 _pv442g9 1mv16xof 14e6y7tu 1oo9zkds 17d1cisi _4v9y70f _y98m8kc 1019pq0v 12o9zda8 _348j4f4 1et50i2o _8epa8__ _ts6senj 1o350i2o 1mi9eiuo 1259yrp0 1ln80gnw _632xcoy 1cn9zldc _f29edu4 1n490c8q _9f9ziet 1b94vk74 _m49zkct 1kz6s73a 1eu9dtog _q58s1rz 1dy9sjiq __u89jo3 _aj5nkwg _ld89jo3 13h9z6wx _qa9z2ii _l119xgq _bs5arju 1hj4nwk9 1qt4nwk9 1ge6wau6 14j9zlcw 11p1edc_ _ms1zcxe _439shk6 _jt9y70f _754zsow 1la40eju _oq5p___ _x279qkz 1fa5r3rv _yd2d9ip _424tcku _8y1di2_ _zi2uabw _yy7rn9h 12yz980_ __39ljp6 1b59zg0x _n39zfzp 1fy9zest _b33k___ _hp9wq92 1il50hz4 _io472ub _lj9z3eo 19z9ykg0 _8t8iu3a 12b9bl4a 1ak5yw0o _896v4ku _tb8k8lv _s59zi6t _c09ze0p 1lg80oqn 1id9z8wb _238nba5 1kq6wgdi _154zssg _tn3zk49 _da9y6tc 1sg7cv4f _r12jvtt 1gq5fmkz 1cs9rvci _lp9jn1c _xw1tdnb 13f9zje6 16f6973h _vo7ir40 _bt5arjf _rc45e4t _hr4e100 10v4e100 _hc9zke2 _w91egv_ _sj2r1kk 13c87yx8 _vqpds__ _ni8ggk8 _tj9yqfb 1ia2j4r4 _7x9b10u 1fc9ld4j 1eq9zldr _5j9lhpx _ez9zl6o _md61fzm".split(" ").reduce((n,t)=>{const i=sK(t.substring(0,3)),a=sK(t.substring(3)).toString(16);let l="";for(let d=0;d<6-a.length;d++)l+="0";return n[i]=`${l}${a}`,n},{});function eSe(n){const t=n.toLowerCase().trim(),i=Zve[Qve(t)];if(!i)throw new ww(n);return`#${i}`}const aR=(n,t)=>Array.from(Array(t)).map(()=>n).join(""),tSe=new RegExp(`^#${aR("([a-f0-9])",3)}([a-f0-9])?$`,"i"),nSe=new RegExp(`^#${aR("([a-f0-9]{2})",3)}([a-f0-9]{2})?$`,"i"),rSe=new RegExp(`^rgba?\\(\\s*(\\d+)\\s*${aR(",\\s*(\\d+)\\s*",2)}(?:,\\s*([\\d.]+))?\\s*\\)$`,"i"),iSe=/^hsla?\(\s*([\d.]+)\s*,\s*([\d.]+)%\s*,\s*([\d.]+)%(?:\s*,\s*([\d.]+))?\s*\)$/i,oSe=/^[a-z]+$/i,aK=n=>Math.round(n*255),sSe=(n,t,i)=>{let a=i/100;if(t===0)return[a,a,a].map(aK);const l=(n%360+360)%360/60,d=(1-Math.abs(2*a-1))*(t/100),p=d*(1-Math.abs(l%2-1));let E=0,v=0,b=0;l>=0&&l<1?(E=d,v=p):l>=1&&l<2?(E=p,v=d):l>=2&&l<3?(v=d,b=p):l>=3&&l<4?(v=p,b=d):l>=4&&l<5?(E=p,b=d):l>=5&&l<6&&(E=d,b=p);const w=a-d/2,A=E+w,N=v+w,F=b+w;return[A,N,F].map(aK)};function aSe(n,t,i,a){return`rgba(${uE(0,255,n).toFixed()}, ${uE(0,255,t).toFixed()}, ${uE(0,255,i).toFixed()}, ${parseFloat(uE(0,1,a).toFixed(3))})`}function cSe(n,t){const[i,a,l,d]=tF(n);return aSe(i,a,l,d-t)}function lSe(n){const[t,i,a,l]=tF(n);let d=p=>{const E=uE(0,255,p).toString(16);return E.length===1?`0${E}`:E};return`#${d(t)}${d(i)}${d(a)}${l<1?d(Math.round(l*255)):""}`}const uSe=n=>Object.keys(n).length===0;function dSe(n,t,i,a,l){for(t=t.split?t.split("."):t,a=0;a<t.length;a++)n=n?n[t[a]]:l;return n===l?i:n}const sc=(n,t,i)=>{const a=dSe(n,`colors.${t}`,t);try{return lSe(a),a}catch{return i??"#000000"}},hSe=n=>{const[t,i,a]=tF(n);return(t*299+i*587+a*114)/1e3},fSe=n=>t=>{const i=sc(t,n);return hSe(i)<128?"dark":"light"},pSe=n=>t=>fSe(n)(t)==="dark",QS=(n,t)=>i=>{const a=sc(i,n);return cSe(a,1-t)};function cK(n="1rem",t="rgba(255, 255, 255, 0.15)"){return{backgroundImage:`linear-gradient(
    45deg,
    ${t} 25%,
    transparent 25%,
    transparent 50%,
    ${t} 50%,
    ${t} 75%,
    transparent 75%,
    transparent
  )`,backgroundSize:`${n} ${n}`}}const mSe=()=>`#${Math.floor(Math.random()*16777215).toString(16).padEnd(6,"0")}`;function gSe(n){const t=mSe();return!n||uSe(n)?t:n.string&&n.colors?ESe(n.string,n.colors):n.string&&!n.colors?_Se(n.string):n.colors&&!n.string?ySe(n.colors):t}function _Se(n){let t=0;if(n.length===0)return t.toString();for(let a=0;a<n.length;a+=1)t=n.charCodeAt(a)+((t<<5)-t),t=t&t;let i="#";for(let a=0;a<3;a+=1){const l=t>>a*8&255;i+=`00${l.toString(16)}`.substr(-2)}return i}function ESe(n,t){let i=0;if(n.length===0)return t[0];for(let a=0;a<n.length;a+=1)i=n.charCodeAt(a)+((i<<5)-i),i=i&i;return i=(i%t.length+t.length)%t.length,t[i]}function ySe(n){return n[Math.floor(Math.random()*n.length)]}function An(n,t){return i=>i.colorMode==="dark"?t:n}function nF(n){const{orientation:t,vertical:i,horizontal:a}=n;return t?t==="vertical"?i:a:{}}function zQ(n){return Cu(n)&&n.reference?n.reference:String(n)}const lN=(n,...t)=>t.map(zQ).join(` ${n} `).replace(/calc/g,""),lK=(...n)=>`calc(${lN("+",...n)})`,uK=(...n)=>`calc(${lN("-",...n)})`,SU=(...n)=>`calc(${lN("*",...n)})`,dK=(...n)=>`calc(${lN("/",...n)})`,hK=n=>{const t=zQ(n);return t!=null&&!Number.isNaN(parseFloat(t))?String(t).startsWith("-")?String(t).slice(1):`-${t}`:SU(t,-1)},up=Object.assign(n=>({add:(...t)=>up(lK(n,...t)),subtract:(...t)=>up(uK(n,...t)),multiply:(...t)=>up(SU(n,...t)),divide:(...t)=>up(dK(n,...t)),negate:()=>up(hK(n)),toString:()=>n.toString()}),{add:lK,subtract:uK,multiply:SU,divide:dK,negate:hK});function vSe(n){return!Number.isInteger(parseFloat(n.toString()))}function SSe(n,t="-"){return n.replace(/\s+/g,t)}function GQ(n){const t=SSe(n.toString());return t.includes("\\.")?n:vSe(n)?t.replace(".","\\."):n}function bSe(n,t=""){return[t,GQ(n)].filter(Boolean).join("-")}function TSe(n,t){return`var(${GQ(n)}${t?`, ${t}`:""})`}function wSe(n,t=""){return`--${bSe(n,t)}`}function ls(n,t){const i=wSe(n,t==null?void 0:t.prefix);return{variable:i,reference:TSe(i,RSe(t==null?void 0:t.fallback))}}function RSe(n){return n==null?void 0:n.reference}const{definePartsStyle:jR,defineMultiStyleConfig:CSe}=xi(yve.keys),Pl=Pn("alert-fg"),Ip=Pn("alert-bg"),ISe=jR({container:{bg:Ip.reference,px:"4",py:"3"},title:{fontWeight:"bold",lineHeight:"6",marginEnd:"2"},description:{lineHeight:"6"},icon:{color:Pl.reference,flexShrink:0,marginEnd:"3",w:"5",h:"6"},spinner:{color:Pl.reference,flexShrink:0,marginEnd:"3",w:"5",h:"5"}});function rF(n){const{theme:t,colorScheme:i}=n,a=QS(`${i}.200`,.16)(t);return{light:`colors.${i}.100`,dark:a}}const ASe=jR(n=>{const{colorScheme:t}=n,i=rF(n);return{container:{[Pl.variable]:`colors.${t}.600`,[Ip.variable]:i.light,_dark:{[Pl.variable]:`colors.${t}.200`,[Ip.variable]:i.dark}}}}),PSe=jR(n=>{const{colorScheme:t}=n,i=rF(n);return{container:{[Pl.variable]:`colors.${t}.600`,[Ip.variable]:i.light,_dark:{[Pl.variable]:`colors.${t}.200`,[Ip.variable]:i.dark},paddingStart:"3",borderStartWidth:"4px",borderStartColor:Pl.reference}}}),OSe=jR(n=>{const{colorScheme:t}=n,i=rF(n);return{container:{[Pl.variable]:`colors.${t}.600`,[Ip.variable]:i.light,_dark:{[Pl.variable]:`colors.${t}.200`,[Ip.variable]:i.dark},pt:"2",borderTopWidth:"4px",borderTopColor:Pl.reference}}}),kSe=jR(n=>{const{colorScheme:t}=n;return{container:{[Pl.variable]:"colors.white",[Ip.variable]:`colors.${t}.600`,_dark:{[Pl.variable]:"colors.gray.900",[Ip.variable]:`colors.${t}.200`},color:Pl.reference}}}),NSe={subtle:ASe,"left-accent":PSe,"top-accent":OSe,solid:kSe},DSe=CSe({baseStyle:ISe,variants:NSe,defaultProps:{variant:"subtle",colorScheme:"blue"}}),HQ={px:"1px",.5:"0.125rem",1:"0.25rem",1.5:"0.375rem",2:"0.5rem",2.5:"0.625rem",3:"0.75rem",3.5:"0.875rem",4:"1rem",5:"1.25rem",6:"1.5rem",7:"1.75rem",8:"2rem",9:"2.25rem",10:"2.5rem",12:"3rem",14:"3.5rem",16:"4rem",20:"5rem",24:"6rem",28:"7rem",32:"8rem",36:"9rem",40:"10rem",44:"11rem",48:"12rem",52:"13rem",56:"14rem",60:"15rem",64:"16rem",72:"18rem",80:"20rem",96:"24rem"},LSe={max:"max-content",min:"min-content",full:"100%","3xs":"14rem","2xs":"16rem",xs:"20rem",sm:"24rem",md:"28rem",lg:"32rem",xl:"36rem","2xl":"42rem","3xl":"48rem","4xl":"56rem","5xl":"64rem","6xl":"72rem","7xl":"80rem","8xl":"90rem",prose:"60ch"},xSe={sm:"640px",md:"768px",lg:"1024px",xl:"1280px"},$Q={...HQ,...LSe,container:xSe},MSe=n=>typeof n=="function";function ac(n,...t){return MSe(n)?n(...t):n}const{definePartsStyle:KQ,defineMultiStyleConfig:USe}=xi(vve.keys),VS=Pn("avatar-border-color"),Bw=Pn("avatar-bg"),cR=Pn("avatar-font-size"),ZS=Pn("avatar-size"),VSe={borderRadius:"full",border:"0.2em solid",borderColor:VS.reference,[VS.variable]:"white",_dark:{[VS.variable]:"colors.gray.800"}},FSe={bg:Bw.reference,fontSize:cR.reference,width:ZS.reference,height:ZS.reference,lineHeight:"1",[Bw.variable]:"colors.gray.200",_dark:{[Bw.variable]:"colors.whiteAlpha.400"}},jSe=n=>{const{name:t,theme:i}=n,a=t?gSe({string:t}):"colors.gray.400",l=pSe(a)(i);let d="white";return l||(d="gray.800"),{bg:Bw.reference,fontSize:cR.reference,color:d,borderColor:VS.reference,verticalAlign:"top",width:ZS.reference,height:ZS.reference,"&:not([data-loaded])":{[Bw.variable]:a},[VS.variable]:"colors.white",_dark:{[VS.variable]:"colors.gray.800"}}},BSe={fontSize:cR.reference,lineHeight:"1"},WSe=KQ(n=>({badge:ac(VSe,n),excessLabel:ac(FSe,n),container:ac(jSe,n),label:BSe}));function $m(n){const t=n!=="100%"?$Q[n]:void 0;return KQ({container:{[ZS.variable]:t??n,[cR.variable]:`calc(${t??n} / 2.5)`},excessLabel:{[ZS.variable]:t??n,[cR.variable]:`calc(${t??n} / 2.5)`}})}const zSe={"2xs":$m(4),xs:$m(6),sm:$m(8),md:$m(12),lg:$m(16),xl:$m(24),"2xl":$m(32),full:$m("100%")},GSe=USe({baseStyle:WSe,sizes:zSe,defaultProps:{size:"md"}}),Uo=uve("badge",["bg","color","shadow"]),HSe={px:1,textTransform:"uppercase",fontSize:"xs",borderRadius:"sm",fontWeight:"bold",bg:Uo.bg.reference,color:Uo.color.reference,boxShadow:Uo.shadow.reference},$Se=n=>{const{colorScheme:t,theme:i}=n,a=QS(`${t}.500`,.6)(i);return{[Uo.bg.variable]:`colors.${t}.500`,[Uo.color.variable]:"colors.white",_dark:{[Uo.bg.variable]:a,[Uo.color.variable]:"colors.whiteAlpha.800"}}},KSe=n=>{const{colorScheme:t,theme:i}=n,a=QS(`${t}.200`,.16)(i);return{[Uo.bg.variable]:`colors.${t}.100`,[Uo.color.variable]:`colors.${t}.800`,_dark:{[Uo.bg.variable]:a,[Uo.color.variable]:`colors.${t}.200`}}},qSe=n=>{const{colorScheme:t,theme:i}=n,a=QS(`${t}.200`,.8)(i);return{[Uo.color.variable]:`colors.${t}.500`,_dark:{[Uo.color.variable]:a},[Uo.shadow.variable]:`inset 0 0 0px 1px ${Uo.color.reference}`}},YSe={solid:$Se,subtle:KSe,outline:qSe},Ww={baseStyle:HSe,variants:YSe,defaultProps:{variant:"subtle",colorScheme:"gray"}},{defineMultiStyleConfig:XSe,definePartsStyle:JSe}=xi(Sve.keys),XM=Pn("breadcrumb-link-decor"),QSe={transitionProperty:"common",transitionDuration:"fast",transitionTimingFunction:"ease-out",outline:"none",color:"inherit",textDecoration:XM.reference,[XM.variable]:"none","&:not([aria-current=page])":{cursor:"pointer",_hover:{[XM.variable]:"underline"},_focusVisible:{boxShadow:"outline"}}},ZSe=JSe({link:QSe}),e0e=XSe({baseStyle:ZSe}),t0e={lineHeight:"1.2",borderRadius:"md",fontWeight:"semibold",transitionProperty:"common",transitionDuration:"normal",_focusVisible:{boxShadow:"outline"},_disabled:{opacity:.4,cursor:"not-allowed",boxShadow:"none"},_hover:{_disabled:{bg:"initial"}}},qQ=n=>{const{colorScheme:t,theme:i}=n;if(t==="gray")return{color:An("gray.800","whiteAlpha.900")(n),_hover:{bg:An("gray.100","whiteAlpha.200")(n)},_active:{bg:An("gray.200","whiteAlpha.300")(n)}};const a=QS(`${t}.200`,.12)(i),l=QS(`${t}.200`,.24)(i);return{color:An(`${t}.600`,`${t}.200`)(n),bg:"transparent",_hover:{bg:An(`${t}.50`,a)(n)},_active:{bg:An(`${t}.100`,l)(n)}}},n0e=n=>{const{colorScheme:t}=n,i=An("gray.200","whiteAlpha.300")(n);return{border:"1px solid",borderColor:t==="gray"?i:"currentColor",".chakra-button__group[data-attached][data-orientation=horizontal] > &:not(:last-of-type)":{marginEnd:"-1px"},".chakra-button__group[data-attached][data-orientation=vertical] > &:not(:last-of-type)":{marginBottom:"-1px"},...ac(qQ,n)}},r0e={yellow:{bg:"yellow.400",color:"black",hoverBg:"yellow.500",activeBg:"yellow.600"},cyan:{bg:"cyan.400",color:"black",hoverBg:"cyan.500",activeBg:"cyan.600"}},i0e=n=>{const{colorScheme:t}=n;if(t==="gray"){const E=An("gray.100","whiteAlpha.200")(n);return{bg:E,color:An("gray.800","whiteAlpha.900")(n),_hover:{bg:An("gray.200","whiteAlpha.300")(n),_disabled:{bg:E}},_active:{bg:An("gray.300","whiteAlpha.400")(n)}}}const{bg:i=`${t}.500`,color:a="white",hoverBg:l=`${t}.600`,activeBg:d=`${t}.700`}=r0e[t]??{},p=An(i,`${t}.200`)(n);return{bg:p,color:An(a,"gray.800")(n),_hover:{bg:An(l,`${t}.300`)(n),_disabled:{bg:p}},_active:{bg:An(d,`${t}.400`)(n)}}},o0e=n=>{const{colorScheme:t}=n;return{padding:0,height:"auto",lineHeight:"normal",verticalAlign:"baseline",color:An(`${t}.500`,`${t}.200`)(n),_hover:{textDecoration:"underline",_disabled:{textDecoration:"none"}},_active:{color:An(`${t}.700`,`${t}.500`)(n)}}},s0e={bg:"none",color:"inherit",display:"inline",lineHeight:"inherit",m:"0",p:"0"},a0e={ghost:qQ,outline:n0e,solid:i0e,link:o0e,unstyled:s0e},c0e={lg:{h:"12",minW:"12",fontSize:"lg",px:"6"},md:{h:"10",minW:"10",fontSize:"md",px:"4"},sm:{h:"8",minW:"8",fontSize:"sm",px:"3"},xs:{h:"6",minW:"6",fontSize:"xs",px:"2"}},l0e={baseStyle:t0e,variants:a0e,sizes:c0e,defaultProps:{variant:"solid",size:"md",colorScheme:"gray"}},{definePartsStyle:pE,defineMultiStyleConfig:u0e}=xi(Wve.keys),mk=Pn("card-bg"),vp=Pn("card-padding"),YQ=Pn("card-shadow"),DO=Pn("card-radius"),XQ=Pn("card-border-width","0"),JQ=Pn("card-border-color"),d0e=pE({container:{[mk.variable]:"colors.chakra-body-bg",backgroundColor:mk.reference,boxShadow:YQ.reference,borderRadius:DO.reference,color:"chakra-body-text",borderWidth:XQ.reference,borderColor:JQ.reference},body:{padding:vp.reference,flex:"1 1 0%"},header:{padding:vp.reference},footer:{padding:vp.reference}}),h0e={sm:pE({container:{[DO.variable]:"radii.base",[vp.variable]:"space.3"}}),md:pE({container:{[DO.variable]:"radii.md",[vp.variable]:"space.5"}}),lg:pE({container:{[DO.variable]:"radii.xl",[vp.variable]:"space.7"}})},f0e={elevated:pE({container:{[YQ.variable]:"shadows.base",_dark:{[mk.variable]:"colors.gray.700"}}}),outline:pE({container:{[XQ.variable]:"1px",[JQ.variable]:"colors.chakra-border-color"}}),filled:pE({container:{[mk.variable]:"colors.chakra-subtle-bg"}}),unstyled:{body:{[vp.variable]:0},header:{[vp.variable]:0},footer:{[vp.variable]:0}}},p0e=u0e({baseStyle:d0e,variants:f0e,sizes:h0e,defaultProps:{variant:"elevated",size:"md"}}),{definePartsStyle:LO,defineMultiStyleConfig:m0e}=xi(bve.keys),zw=Pn("checkbox-size"),g0e=n=>{const{colorScheme:t}=n;return{w:zw.reference,h:zw.reference,transitionProperty:"box-shadow",transitionDuration:"normal",border:"2px solid",borderRadius:"sm",borderColor:"inherit",color:"white",_checked:{bg:An(`${t}.500`,`${t}.200`)(n),borderColor:An(`${t}.500`,`${t}.200`)(n),color:An("white","gray.900")(n),_hover:{bg:An(`${t}.600`,`${t}.300`)(n),borderColor:An(`${t}.600`,`${t}.300`)(n)},_disabled:{borderColor:An("gray.200","transparent")(n),bg:An("gray.200","whiteAlpha.300")(n),color:An("gray.500","whiteAlpha.500")(n)}},_indeterminate:{bg:An(`${t}.500`,`${t}.200`)(n),borderColor:An(`${t}.500`,`${t}.200`)(n),color:An("white","gray.900")(n)},_disabled:{bg:An("gray.100","whiteAlpha.100")(n),borderColor:An("gray.100","transparent")(n)},_focusVisible:{boxShadow:"outline"},_invalid:{borderColor:An("red.500","red.300")(n)}}},_0e={_disabled:{cursor:"not-allowed"}},E0e={userSelect:"none",_disabled:{opacity:.4}},y0e={transitionProperty:"transform",transitionDuration:"normal"},v0e=LO(n=>({icon:y0e,container:_0e,control:ac(g0e,n),label:E0e})),S0e={sm:LO({control:{[zw.variable]:"sizes.3"},label:{fontSize:"sm"},icon:{fontSize:"3xs"}}),md:LO({control:{[zw.variable]:"sizes.4"},label:{fontSize:"md"},icon:{fontSize:"2xs"}}),lg:LO({control:{[zw.variable]:"sizes.5"},label:{fontSize:"lg"},icon:{fontSize:"2xs"}})},Qm=m0e({baseStyle:v0e,sizes:S0e,defaultProps:{size:"md",colorScheme:"blue"}}),Gw=ls("close-button-size"),tw=ls("close-button-bg"),b0e={w:[Gw.reference],h:[Gw.reference],borderRadius:"md",transitionProperty:"common",transitionDuration:"normal",_disabled:{opacity:.4,cursor:"not-allowed",boxShadow:"none"},_hover:{[tw.variable]:"colors.blackAlpha.100",_dark:{[tw.variable]:"colors.whiteAlpha.100"}},_active:{[tw.variable]:"colors.blackAlpha.200",_dark:{[tw.variable]:"colors.whiteAlpha.200"}},_focusVisible:{boxShadow:"outline"},bg:tw.reference},T0e={lg:{[Gw.variable]:"sizes.10",fontSize:"md"},md:{[Gw.variable]:"sizes.8",fontSize:"xs"},sm:{[Gw.variable]:"sizes.6",fontSize:"2xs"}},w0e={baseStyle:b0e,sizes:T0e,defaultProps:{size:"md"}},{variants:R0e,defaultProps:C0e}=Ww,I0e={fontFamily:"mono",fontSize:"sm",px:"0.2em",borderRadius:"sm",bg:Uo.bg.reference,color:Uo.color.reference,boxShadow:Uo.shadow.reference},A0e={baseStyle:I0e,variants:R0e,defaultProps:C0e},P0e={w:"100%",mx:"auto",maxW:"prose",px:"4"},O0e={baseStyle:P0e},k0e={opacity:.6,borderColor:"inherit"},N0e={borderStyle:"solid"},D0e={borderStyle:"dashed"},L0e={solid:N0e,dashed:D0e},x0e={baseStyle:k0e,variants:L0e,defaultProps:{variant:"solid"}},{definePartsStyle:bU,defineMultiStyleConfig:M0e}=xi(Tve.keys),JM=Pn("drawer-bg"),QM=Pn("drawer-box-shadow");function cS(n){return bU(n==="full"?{dialog:{maxW:"100vw",h:"100vh"}}:{dialog:{maxW:n}})}const U0e={bg:"blackAlpha.600",zIndex:"modal"},V0e={display:"flex",zIndex:"modal",justifyContent:"center"},F0e=n=>{const{isFullHeight:t}=n;return{...t&&{height:"100vh"},zIndex:"modal",maxH:"100vh",color:"inherit",[JM.variable]:"colors.white",[QM.variable]:"shadows.lg",_dark:{[JM.variable]:"colors.gray.700",[QM.variable]:"shadows.dark-lg"},bg:JM.reference,boxShadow:QM.reference}},j0e={px:"6",py:"4",fontSize:"xl",fontWeight:"semibold"},B0e={position:"absolute",top:"2",insetEnd:"3"},W0e={px:"6",py:"2",flex:"1",overflow:"auto"},z0e={px:"6",py:"4"},G0e=bU(n=>({overlay:U0e,dialogContainer:V0e,dialog:ac(F0e,n),header:j0e,closeButton:B0e,body:W0e,footer:z0e})),H0e={xs:cS("xs"),sm:cS("md"),md:cS("lg"),lg:cS("2xl"),xl:cS("4xl"),full:cS("full")},$0e=M0e({baseStyle:G0e,sizes:H0e,defaultProps:{size:"xs"}}),{definePartsStyle:K0e,defineMultiStyleConfig:q0e}=xi(wve.keys),Y0e={borderRadius:"md",py:"1",transitionProperty:"common",transitionDuration:"normal"},X0e={borderRadius:"md",py:"1",transitionProperty:"common",transitionDuration:"normal",width:"full",_focusVisible:{boxShadow:"outline"},_placeholder:{opacity:.6}},J0e={borderRadius:"md",py:"1",transitionProperty:"common",transitionDuration:"normal",width:"full",_focusVisible:{boxShadow:"outline"},_placeholder:{opacity:.6}},Q0e=K0e({preview:Y0e,input:X0e,textarea:J0e}),Z0e=q0e({baseStyle:Q0e}),{definePartsStyle:ebe,defineMultiStyleConfig:tbe}=xi(Rve.keys),FS=Pn("form-control-color"),nbe={marginStart:"1",[FS.variable]:"colors.red.500",_dark:{[FS.variable]:"colors.red.300"},color:FS.reference},rbe={mt:"2",[FS.variable]:"colors.gray.600",_dark:{[FS.variable]:"colors.whiteAlpha.600"},color:FS.reference,lineHeight:"normal",fontSize:"sm"},ibe=ebe({container:{width:"100%",position:"relative"},requiredIndicator:nbe,helperText:rbe}),obe=tbe({baseStyle:ibe}),{definePartsStyle:sbe,defineMultiStyleConfig:abe}=xi(Cve.keys),jS=Pn("form-error-color"),cbe={[jS.variable]:"colors.red.500",_dark:{[jS.variable]:"colors.red.300"},color:jS.reference,mt:"2",fontSize:"sm",lineHeight:"normal"},lbe={marginEnd:"0.5em",[jS.variable]:"colors.red.500",_dark:{[jS.variable]:"colors.red.300"},color:jS.reference},ube=sbe({text:cbe,icon:lbe}),dbe=abe({baseStyle:ube}),hbe={fontSize:"md",marginEnd:"3",mb:"2",fontWeight:"medium",transitionProperty:"common",transitionDuration:"normal",opacity:1,_disabled:{opacity:.4}},fbe={baseStyle:hbe},pbe={fontFamily:"heading",fontWeight:"bold"},mbe={"4xl":{fontSize:["6xl",null,"7xl"],lineHeight:1},"3xl":{fontSize:["5xl",null,"6xl"],lineHeight:1},"2xl":{fontSize:["4xl",null,"5xl"],lineHeight:[1.2,null,1]},xl:{fontSize:["3xl",null,"4xl"],lineHeight:[1.33,null,1.2]},lg:{fontSize:["2xl",null,"3xl"],lineHeight:[1.33,null,1.2]},md:{fontSize:"xl",lineHeight:1.2},sm:{fontSize:"md",lineHeight:1.2},xs:{fontSize:"sm",lineHeight:1.2}},gbe={baseStyle:pbe,sizes:mbe,defaultProps:{size:"xl"}},{definePartsStyle:fp,defineMultiStyleConfig:_be}=xi(Ive.keys),bS=Pn("input-height"),TS=Pn("input-font-size"),wS=Pn("input-padding"),RS=Pn("input-border-radius"),Ebe=fp({addon:{height:bS.reference,fontSize:TS.reference,px:wS.reference,borderRadius:RS.reference},field:{width:"100%",height:bS.reference,fontSize:TS.reference,px:wS.reference,borderRadius:RS.reference,minWidth:0,outline:0,position:"relative",appearance:"none",transitionProperty:"common",transitionDuration:"normal",_disabled:{opacity:.4,cursor:"not-allowed"}}}),Km={lg:{[TS.variable]:"fontSizes.lg",[wS.variable]:"space.4",[RS.variable]:"radii.md",[bS.variable]:"sizes.12"},md:{[TS.variable]:"fontSizes.md",[wS.variable]:"space.4",[RS.variable]:"radii.md",[bS.variable]:"sizes.10"},sm:{[TS.variable]:"fontSizes.sm",[wS.variable]:"space.3",[RS.variable]:"radii.sm",[bS.variable]:"sizes.8"},xs:{[TS.variable]:"fontSizes.xs",[wS.variable]:"space.2",[RS.variable]:"radii.sm",[bS.variable]:"sizes.6"}},ybe={lg:fp({field:Km.lg,group:Km.lg}),md:fp({field:Km.md,group:Km.md}),sm:fp({field:Km.sm,group:Km.sm}),xs:fp({field:Km.xs,group:Km.xs})};function iF(n){const{focusBorderColor:t,errorBorderColor:i}=n;return{focusBorderColor:t||An("blue.500","blue.300")(n),errorBorderColor:i||An("red.500","red.300")(n)}}const vbe=fp(n=>{const{theme:t}=n,{focusBorderColor:i,errorBorderColor:a}=iF(n);return{field:{border:"1px solid",borderColor:"inherit",bg:"inherit",_hover:{borderColor:An("gray.300","whiteAlpha.400")(n)},_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:sc(t,a),boxShadow:`0 0 0 1px ${sc(t,a)}`},_focusVisible:{zIndex:1,borderColor:sc(t,i),boxShadow:`0 0 0 1px ${sc(t,i)}`}},addon:{border:"1px solid",borderColor:An("inherit","whiteAlpha.50")(n),bg:An("gray.100","whiteAlpha.300")(n)}}}),Sbe=fp(n=>{const{theme:t}=n,{focusBorderColor:i,errorBorderColor:a}=iF(n);return{field:{border:"2px solid",borderColor:"transparent",bg:An("gray.100","whiteAlpha.50")(n),_hover:{bg:An("gray.200","whiteAlpha.100")(n)},_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:sc(t,a)},_focusVisible:{bg:"transparent",borderColor:sc(t,i)}},addon:{border:"2px solid",borderColor:"transparent",bg:An("gray.100","whiteAlpha.50")(n)}}}),bbe=fp(n=>{const{theme:t}=n,{focusBorderColor:i,errorBorderColor:a}=iF(n);return{field:{borderBottom:"1px solid",borderColor:"inherit",borderRadius:"0",px:"0",bg:"transparent",_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:sc(t,a),boxShadow:`0px 1px 0px 0px ${sc(t,a)}`},_focusVisible:{borderColor:sc(t,i),boxShadow:`0px 1px 0px 0px ${sc(t,i)}`}},addon:{borderBottom:"2px solid",borderColor:"inherit",borderRadius:"0",px:"0",bg:"transparent"}}}),Tbe=fp({field:{bg:"transparent",px:"0",height:"auto"},addon:{bg:"transparent",px:"0",height:"auto"}}),wbe={outline:vbe,filled:Sbe,flushed:bbe,unstyled:Tbe},Yr=_be({baseStyle:Ebe,sizes:ybe,variants:wbe,defaultProps:{size:"md",variant:"outline"}}),ZM=Pn("kbd-bg"),Rbe={[ZM.variable]:"colors.gray.100",_dark:{[ZM.variable]:"colors.whiteAlpha.100"},bg:ZM.reference,borderRadius:"md",borderWidth:"1px",borderBottomWidth:"3px",fontSize:"0.8em",fontWeight:"bold",lineHeight:"normal",px:"0.4em",whiteSpace:"nowrap"},Cbe={baseStyle:Rbe},Ibe={transitionProperty:"common",transitionDuration:"fast",transitionTimingFunction:"ease-out",cursor:"pointer",textDecoration:"none",outline:"none",color:"inherit",_hover:{textDecoration:"underline"},_focusVisible:{boxShadow:"outline"}},Abe={baseStyle:Ibe},{defineMultiStyleConfig:Pbe,definePartsStyle:Obe}=xi(Ave.keys),kbe={marginEnd:"2",display:"inline",verticalAlign:"text-bottom"},Nbe=Obe({icon:kbe}),Dbe=Pbe({baseStyle:Nbe}),{defineMultiStyleConfig:Lbe,definePartsStyle:xbe}=xi(Pve.keys),Nh=Pn("menu-bg"),e2=Pn("menu-shadow"),Mbe={[Nh.variable]:"#fff",[e2.variable]:"shadows.sm",_dark:{[Nh.variable]:"colors.gray.700",[e2.variable]:"shadows.dark-lg"},color:"inherit",minW:"3xs",py:"2",zIndex:"dropdown",borderRadius:"md",borderWidth:"1px",bg:Nh.reference,boxShadow:e2.reference},Ube={py:"1.5",px:"3",transitionProperty:"background",transitionDuration:"ultra-fast",transitionTimingFunction:"ease-in",_focus:{[Nh.variable]:"colors.gray.100",_dark:{[Nh.variable]:"colors.whiteAlpha.100"}},_active:{[Nh.variable]:"colors.gray.200",_dark:{[Nh.variable]:"colors.whiteAlpha.200"}},_expanded:{[Nh.variable]:"colors.gray.100",_dark:{[Nh.variable]:"colors.whiteAlpha.100"}},_disabled:{opacity:.4,cursor:"not-allowed"},bg:Nh.reference},Vbe={mx:4,my:2,fontWeight:"semibold",fontSize:"sm"},Fbe={display:"inline-flex",alignItems:"center",justifyContent:"center",flexShrink:0},jbe={opacity:.6},Bbe={border:0,borderBottom:"1px solid",borderColor:"inherit",my:"2",opacity:.6},Wbe={transitionProperty:"common",transitionDuration:"normal"},zbe=xbe({button:Wbe,list:Mbe,item:Ube,groupTitle:Vbe,icon:Fbe,command:jbe,divider:Bbe}),Gbe=Lbe({baseStyle:zbe}),{defineMultiStyleConfig:Hbe,definePartsStyle:TU}=xi(Ove.keys),t2=Pn("modal-bg"),n2=Pn("modal-shadow"),$be={bg:"blackAlpha.600",zIndex:"modal"},Kbe=n=>{const{isCentered:t,scrollBehavior:i}=n;return{display:"flex",zIndex:"modal",justifyContent:"center",alignItems:t?"center":"flex-start",overflow:i==="inside"?"hidden":"auto",overscrollBehaviorY:"none"}},qbe=n=>{const{isCentered:t,scrollBehavior:i}=n;return{borderRadius:"md",color:"inherit",my:t?"auto":"16",mx:t?"auto":void 0,zIndex:"modal",maxH:i==="inside"?"calc(100% - 7.5rem)":void 0,[t2.variable]:"colors.white",[n2.variable]:"shadows.lg",_dark:{[t2.variable]:"colors.gray.700",[n2.variable]:"shadows.dark-lg"},bg:t2.reference,boxShadow:n2.reference}},Ybe={px:"6",py:"4",fontSize:"xl",fontWeight:"semibold"},Xbe={position:"absolute",top:"2",insetEnd:"3"},Jbe=n=>{const{scrollBehavior:t}=n;return{px:"6",py:"2",flex:"1",overflow:t==="inside"?"auto":void 0}},Qbe={px:"6",py:"4"},Zbe=TU(n=>({overlay:$be,dialogContainer:ac(Kbe,n),dialog:ac(qbe,n),header:Ybe,closeButton:Xbe,body:ac(Jbe,n),footer:Qbe}));function Td(n){return TU(n==="full"?{dialog:{maxW:"100vw",minH:"$100vh",my:"0",borderRadius:"0"}}:{dialog:{maxW:n}})}const eTe={xs:Td("xs"),sm:Td("sm"),md:Td("md"),lg:Td("lg"),xl:Td("xl"),"2xl":Td("2xl"),"3xl":Td("3xl"),"4xl":Td("4xl"),"5xl":Td("5xl"),"6xl":Td("6xl"),full:Td("full")},tTe=Hbe({baseStyle:Zbe,sizes:eTe,defaultProps:{size:"md"}}),QQ={letterSpacings:{tighter:"-0.05em",tight:"-0.025em",normal:"0",wide:"0.025em",wider:"0.05em",widest:"0.1em"},lineHeights:{normal:"normal",none:1,shorter:1.25,short:1.375,base:1.5,tall:1.625,taller:"2",3:".75rem",4:"1rem",5:"1.25rem",6:"1.5rem",7:"1.75rem",8:"2rem",9:"2.25rem",10:"2.5rem"},fontWeights:{hairline:100,thin:200,light:300,normal:400,medium:500,semibold:600,bold:700,extrabold:800,black:900},fonts:{heading:'-apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',body:'-apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',mono:'SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace'},fontSizes:{"3xs":"0.45rem","2xs":"0.625rem",xs:"0.75rem",sm:"0.875rem",md:"1rem",lg:"1.125rem",xl:"1.25rem","2xl":"1.5rem","3xl":"1.875rem","4xl":"2.25rem","5xl":"3rem","6xl":"3.75rem","7xl":"4.5rem","8xl":"6rem","9xl":"8rem"}},{defineMultiStyleConfig:nTe,definePartsStyle:ZQ}=xi(kve.keys),oF=ls("number-input-stepper-width"),eZ=ls("number-input-input-padding"),rTe=up(oF).add("0.5rem").toString(),r2=ls("number-input-bg"),i2=ls("number-input-color"),o2=ls("number-input-border-color"),iTe={[oF.variable]:"sizes.6",[eZ.variable]:rTe},oTe=n=>{var t;return((t=ac(Yr.baseStyle,n))==null?void 0:t.field)??{}},sTe={width:oF.reference},aTe={borderStart:"1px solid",borderStartColor:o2.reference,color:i2.reference,bg:r2.reference,[i2.variable]:"colors.chakra-body-text",[o2.variable]:"colors.chakra-border-color",_dark:{[i2.variable]:"colors.whiteAlpha.800",[o2.variable]:"colors.whiteAlpha.300"},_active:{[r2.variable]:"colors.gray.200",_dark:{[r2.variable]:"colors.whiteAlpha.300"}},_disabled:{opacity:.4,cursor:"not-allowed"}},cTe=ZQ(n=>({root:iTe,field:ac(oTe,n)??{},stepperGroup:sTe,stepper:aTe}));function eO(n){var d,p;const t=(d=Yr.sizes)==null?void 0:d[n],i={lg:"md",md:"md",sm:"sm",xs:"sm"},a=((p=t.field)==null?void 0:p.fontSize)??"md",l=QQ.fontSizes[a];return ZQ({field:{...t.field,paddingInlineEnd:eZ.reference,verticalAlign:"top"},stepper:{fontSize:up(l).multiply(.75).toString(),_first:{borderTopEndRadius:i[n]},_last:{borderBottomEndRadius:i[n],mt:"-1px",borderTopWidth:1}}})}const lTe={xs:eO("xs"),sm:eO("sm"),md:eO("md"),lg:eO("lg")},uTe=nTe({baseStyle:cTe,sizes:lTe,variants:Yr.variants,defaultProps:Yr.defaultProps});var QJ;const dTe={...(QJ=Yr.baseStyle)==null?void 0:QJ.field,textAlign:"center"},hTe={lg:{fontSize:"lg",w:12,h:12,borderRadius:"md"},md:{fontSize:"md",w:10,h:10,borderRadius:"md"},sm:{fontSize:"sm",w:8,h:8,borderRadius:"sm"},xs:{fontSize:"xs",w:6,h:6,borderRadius:"sm"}};var ZJ;const fTe={outline:n=>{var t,i;return((i=ac((t=Yr.variants)==null?void 0:t.outline,n))==null?void 0:i.field)??{}},flushed:n=>{var t,i;return((i=ac((t=Yr.variants)==null?void 0:t.flushed,n))==null?void 0:i.field)??{}},filled:n=>{var t,i;return((i=ac((t=Yr.variants)==null?void 0:t.filled,n))==null?void 0:i.field)??{}},unstyled:((ZJ=Yr.variants)==null?void 0:ZJ.unstyled.field)??{}},pTe={baseStyle:dTe,sizes:hTe,variants:fTe,defaultProps:Yr.defaultProps},{defineMultiStyleConfig:mTe,definePartsStyle:gTe}=xi(Nve.keys),tO=ls("popper-bg"),_Te=ls("popper-arrow-bg"),fK=ls("popper-arrow-shadow-color"),ETe={zIndex:"popover"},yTe={[tO.variable]:"colors.white",bg:tO.reference,[_Te.variable]:tO.reference,[fK.variable]:"colors.gray.200",_dark:{[tO.variable]:"colors.gray.700",[fK.variable]:"colors.whiteAlpha.300"},width:"xs",border:"1px solid",borderColor:"inherit",borderRadius:"md",boxShadow:"sm",zIndex:"inherit",_focusVisible:{outline:0,boxShadow:"outline"}},vTe={px:3,py:2,borderBottomWidth:"1px"},STe={px:3,py:2},bTe={px:3,py:2,borderTopWidth:"1px"},TTe={position:"absolute",borderRadius:"md",top:1,insetEnd:2,padding:2},wTe=gTe({popper:ETe,content:yTe,header:vTe,body:STe,footer:bTe,closeButton:TTe}),RTe=mTe({baseStyle:wTe}),{defineMultiStyleConfig:CTe,definePartsStyle:Rw}=xi(Dve.keys),ITe=n=>{const{colorScheme:t,theme:i,isIndeterminate:a,hasStripe:l}=n,d=An(cK(),cK("1rem","rgba(0,0,0,0.1)"))(n),p=An(`${t}.500`,`${t}.200`)(n),E=`linear-gradient(
    to right,
    transparent 0%,
    ${sc(i,p)} 50%,
    transparent 100%
  )`;return{...!a&&l&&d,...a?{bgImage:E}:{bgColor:p}}},ATe={lineHeight:"1",fontSize:"0.25em",fontWeight:"bold",color:"white"},PTe=n=>({bg:An("gray.100","whiteAlpha.300")(n)}),OTe=n=>({transitionProperty:"common",transitionDuration:"slow",...ITe(n)}),kTe=Rw(n=>({label:ATe,filledTrack:OTe(n),track:PTe(n)})),NTe={xs:Rw({track:{h:"1"}}),sm:Rw({track:{h:"2"}}),md:Rw({track:{h:"3"}}),lg:Rw({track:{h:"4"}})},DTe=CTe({sizes:NTe,baseStyle:kTe,defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:LTe,definePartsStyle:xO}=xi(Lve.keys),xTe=n=>{var i;const t=(i=ac(Qm.baseStyle,n))==null?void 0:i.control;return{...t,borderRadius:"full",_checked:{...t==null?void 0:t._checked,_before:{content:'""',display:"inline-block",pos:"relative",w:"50%",h:"50%",borderRadius:"50%",bg:"currentColor"}}}},MTe=xO(n=>{var t,i;return{label:(t=Qm.baseStyle)==null?void 0:t.call(Qm,n).label,container:(i=Qm.baseStyle)==null?void 0:i.call(Qm,n).container,control:xTe(n)}}),UTe={md:xO({control:{w:"4",h:"4"},label:{fontSize:"md"}}),lg:xO({control:{w:"5",h:"5"},label:{fontSize:"lg"}}),sm:xO({control:{width:"3",height:"3"},label:{fontSize:"sm"}})},VTe=LTe({baseStyle:MTe,sizes:UTe,defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:FTe,definePartsStyle:jTe}=xi(xve.keys),nO=Pn("select-bg");var eQ;const BTe={...(eQ=Yr.baseStyle)==null?void 0:eQ.field,appearance:"none",paddingBottom:"1px",lineHeight:"normal",bg:nO.reference,[nO.variable]:"colors.white",_dark:{[nO.variable]:"colors.gray.700"},"> option, > optgroup":{bg:nO.reference}},WTe={width:"6",height:"100%",insetEnd:"2",position:"relative",color:"currentColor",fontSize:"xl",_disabled:{opacity:.5}},zTe=jTe({field:BTe,icon:WTe}),rO={paddingInlineEnd:"8"};var tQ,nQ,rQ,iQ,oQ,sQ,aQ,cQ;const GTe={lg:{...(tQ=Yr.sizes)==null?void 0:tQ.lg,field:{...(nQ=Yr.sizes)==null?void 0:nQ.lg.field,...rO}},md:{...(rQ=Yr.sizes)==null?void 0:rQ.md,field:{...(iQ=Yr.sizes)==null?void 0:iQ.md.field,...rO}},sm:{...(oQ=Yr.sizes)==null?void 0:oQ.sm,field:{...(sQ=Yr.sizes)==null?void 0:sQ.sm.field,...rO}},xs:{...(aQ=Yr.sizes)==null?void 0:aQ.xs,field:{...(cQ=Yr.sizes)==null?void 0:cQ.xs.field,...rO},icon:{insetEnd:"1"}}},HTe=FTe({baseStyle:zTe,sizes:GTe,variants:Yr.variants,defaultProps:Yr.defaultProps}),s2=Pn("skeleton-start-color"),a2=Pn("skeleton-end-color"),$Te={[s2.variable]:"colors.gray.100",[a2.variable]:"colors.gray.400",_dark:{[s2.variable]:"colors.gray.800",[a2.variable]:"colors.gray.600"},background:s2.reference,borderColor:a2.reference,opacity:.7,borderRadius:"sm"},KTe={baseStyle:$Te},c2=Pn("skip-link-bg"),qTe={borderRadius:"md",fontWeight:"semibold",_focusVisible:{boxShadow:"outline",padding:"4",position:"fixed",top:"6",insetStart:"6",[c2.variable]:"colors.white",_dark:{[c2.variable]:"colors.gray.700"},bg:c2.reference}},YTe={baseStyle:qTe},{defineMultiStyleConfig:XTe,definePartsStyle:uN}=xi(Mve.keys),TE=Pn("slider-thumb-size"),lR=Pn("slider-track-size"),Zm=Pn("slider-bg"),JTe=n=>{const{orientation:t}=n;return{display:"inline-block",position:"relative",cursor:"pointer",_disabled:{opacity:.6,cursor:"default",pointerEvents:"none"},...nF({orientation:t,vertical:{h:"100%",px:lp(TE.reference).divide(2).toString()},horizontal:{w:"100%",py:lp(TE.reference).divide(2).toString()}})}},QTe=n=>({...nF({orientation:n.orientation,horizontal:{h:lR.reference},vertical:{w:lR.reference}}),overflow:"hidden",borderRadius:"sm",[Zm.variable]:"colors.gray.200",_dark:{[Zm.variable]:"colors.whiteAlpha.200"},_disabled:{[Zm.variable]:"colors.gray.300",_dark:{[Zm.variable]:"colors.whiteAlpha.300"}},bg:Zm.reference}),ZTe=n=>{const{orientation:t}=n;return{...nF({orientation:t,vertical:{left:"50%",transform:"translateX(-50%)",_active:{transform:"translateX(-50%) scale(1.15)"}},horizontal:{top:"50%",transform:"translateY(-50%)",_active:{transform:"translateY(-50%) scale(1.15)"}}}),w:TE.reference,h:TE.reference,display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",outline:0,zIndex:1,borderRadius:"full",bg:"white",boxShadow:"base",border:"1px solid",borderColor:"transparent",transitionProperty:"transform",transitionDuration:"normal",_focusVisible:{boxShadow:"outline"},_disabled:{bg:"gray.300"}}},ewe=n=>{const{colorScheme:t}=n;return{width:"inherit",height:"inherit",[Zm.variable]:`colors.${t}.500`,_dark:{[Zm.variable]:`colors.${t}.200`},bg:Zm.reference}},twe=uN(n=>({container:JTe(n),track:QTe(n),thumb:ZTe(n),filledTrack:ewe(n)})),nwe=uN({container:{[TE.variable]:"sizes.4",[lR.variable]:"sizes.1"}}),rwe=uN({container:{[TE.variable]:"sizes.3.5",[lR.variable]:"sizes.1"}}),iwe=uN({container:{[TE.variable]:"sizes.2.5",[lR.variable]:"sizes.0.5"}}),owe={lg:nwe,md:rwe,sm:iwe},swe=XTe({baseStyle:twe,sizes:owe,defaultProps:{size:"md",colorScheme:"blue"}}),aE=ls("spinner-size"),awe={width:[aE.reference],height:[aE.reference]},cwe={xs:{[aE.variable]:"sizes.3"},sm:{[aE.variable]:"sizes.4"},md:{[aE.variable]:"sizes.6"},lg:{[aE.variable]:"sizes.8"},xl:{[aE.variable]:"sizes.12"}},lwe={baseStyle:awe,sizes:cwe,defaultProps:{size:"md"}},{defineMultiStyleConfig:uwe,definePartsStyle:tZ}=xi(Uve.keys),dwe={fontWeight:"medium"},hwe={opacity:.8,marginBottom:"2"},fwe={verticalAlign:"baseline",fontWeight:"semibold"},pwe={marginEnd:1,w:"3.5",h:"3.5",verticalAlign:"middle"},mwe=tZ({container:{},label:dwe,helpText:hwe,number:fwe,icon:pwe}),gwe={md:tZ({label:{fontSize:"sm"},helpText:{fontSize:"sm"},number:{fontSize:"2xl"}})},_we=uwe({baseStyle:mwe,sizes:gwe,defaultProps:{size:"md"}}),{defineMultiStyleConfig:Ewe,definePartsStyle:Cw}=xi(["stepper","step","title","description","indicator","separator","icon","number"]),dp=Pn("stepper-indicator-size"),CS=Pn("stepper-icon-size"),IS=Pn("stepper-title-font-size"),Iw=Pn("stepper-description-font-size"),nw=Pn("stepper-accent-color"),ywe=Cw(({colorScheme:n})=>({stepper:{display:"flex",justifyContent:"space-between",gap:"4","&[data-orientation=vertical]":{flexDirection:"column",alignItems:"flex-start"},"&[data-orientation=horizontal]":{flexDirection:"row",alignItems:"center"},[nw.variable]:`colors.${n}.500`,_dark:{[nw.variable]:`colors.${n}.200`}},title:{fontSize:IS.reference,fontWeight:"medium"},description:{fontSize:Iw.reference,color:"chakra-subtle-text"},number:{fontSize:IS.reference},step:{flexShrink:0,position:"relative",display:"flex",gap:"2","&[data-orientation=horizontal]":{alignItems:"center"},flex:"1","&:last-of-type:not([data-stretch])":{flex:"initial"}},icon:{flexShrink:0,width:CS.reference,height:CS.reference},indicator:{flexShrink:0,borderRadius:"full",width:dp.reference,height:dp.reference,display:"flex",justifyContent:"center",alignItems:"center","&[data-status=active]":{borderWidth:"2px",borderColor:nw.reference},"&[data-status=complete]":{bg:nw.reference,color:"chakra-inverse-text"},"&[data-status=incomplete]":{borderWidth:"2px"}},separator:{bg:"chakra-border-color",flex:"1","&[data-status=complete]":{bg:nw.reference},"&[data-orientation=horizontal]":{width:"100%",height:"2px",marginStart:"2"},"&[data-orientation=vertical]":{width:"2px",position:"absolute",height:"100%",maxHeight:`calc(100% - ${dp.reference} - 8px)`,top:`calc(${dp.reference} + 4px)`,insetStart:`calc(${dp.reference} / 2 - 1px)`}}})),vwe=Ewe({baseStyle:ywe,sizes:{xs:Cw({stepper:{[dp.variable]:"sizes.4",[CS.variable]:"sizes.3",[IS.variable]:"fontSizes.xs",[Iw.variable]:"fontSizes.xs"}}),sm:Cw({stepper:{[dp.variable]:"sizes.6",[CS.variable]:"sizes.4",[IS.variable]:"fontSizes.sm",[Iw.variable]:"fontSizes.xs"}}),md:Cw({stepper:{[dp.variable]:"sizes.8",[CS.variable]:"sizes.5",[IS.variable]:"fontSizes.md",[Iw.variable]:"fontSizes.sm"}}),lg:Cw({stepper:{[dp.variable]:"sizes.10",[CS.variable]:"sizes.6",[IS.variable]:"fontSizes.lg",[Iw.variable]:"fontSizes.md"}})},defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:Swe,definePartsStyle:MO}=xi(Vve.keys),Hw=ls("switch-track-width"),mE=ls("switch-track-height"),l2=ls("switch-track-diff"),bwe=up.subtract(Hw,mE),wU=ls("switch-thumb-x"),rw=ls("switch-bg"),Twe=n=>{const{colorScheme:t}=n;return{borderRadius:"full",p:"0.5",width:[Hw.reference],height:[mE.reference],transitionProperty:"common",transitionDuration:"fast",[rw.variable]:"colors.gray.300",_dark:{[rw.variable]:"colors.whiteAlpha.400"},_focusVisible:{boxShadow:"outline"},_disabled:{opacity:.4,cursor:"not-allowed"},_checked:{[rw.variable]:`colors.${t}.500`,_dark:{[rw.variable]:`colors.${t}.200`}},bg:rw.reference}},wwe={bg:"white",transitionProperty:"transform",transitionDuration:"normal",borderRadius:"inherit",width:[mE.reference],height:[mE.reference],_checked:{transform:`translateX(${wU.reference})`}},Rwe=MO(n=>({container:{[l2.variable]:bwe,[wU.variable]:l2.reference,_rtl:{[wU.variable]:up(l2).negate().toString()}},track:Twe(n),thumb:wwe})),Cwe={sm:MO({container:{[Hw.variable]:"1.375rem",[mE.variable]:"sizes.3"}}),md:MO({container:{[Hw.variable]:"1.875rem",[mE.variable]:"sizes.4"}}),lg:MO({container:{[Hw.variable]:"2.875rem",[mE.variable]:"sizes.6"}})},Iwe=Swe({baseStyle:Rwe,sizes:Cwe,defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:Awe,definePartsStyle:BS}=xi(Fve.keys),Pwe=BS({table:{fontVariantNumeric:"lining-nums tabular-nums",borderCollapse:"collapse",width:"full"},th:{fontFamily:"heading",fontWeight:"bold",textTransform:"uppercase",letterSpacing:"wider",textAlign:"start"},td:{textAlign:"start"},caption:{mt:4,fontFamily:"heading",textAlign:"center",fontWeight:"medium"}}),gk={"&[data-is-numeric=true]":{textAlign:"end"}},Owe=BS(n=>{const{colorScheme:t}=n;return{th:{color:An("gray.600","gray.400")(n),borderBottom:"1px",borderColor:An(`${t}.100`,`${t}.700`)(n),...gk},td:{borderBottom:"1px",borderColor:An(`${t}.100`,`${t}.700`)(n),...gk},caption:{color:An("gray.600","gray.100")(n)},tfoot:{tr:{"&:last-of-type":{th:{borderBottomWidth:0}}}}}}),kwe=BS(n=>{const{colorScheme:t}=n;return{th:{color:An("gray.600","gray.400")(n),borderBottom:"1px",borderColor:An(`${t}.100`,`${t}.700`)(n),...gk},td:{borderBottom:"1px",borderColor:An(`${t}.100`,`${t}.700`)(n),...gk},caption:{color:An("gray.600","gray.100")(n)},tbody:{tr:{"&:nth-of-type(odd)":{"th, td":{borderBottomWidth:"1px",borderColor:An(`${t}.100`,`${t}.700`)(n)},td:{background:An(`${t}.100`,`${t}.700`)(n)}}}},tfoot:{tr:{"&:last-of-type":{th:{borderBottomWidth:0}}}}}}),Nwe={simple:Owe,striped:kwe,unstyled:{}},Dwe={sm:BS({th:{px:"4",py:"1",lineHeight:"4",fontSize:"xs"},td:{px:"4",py:"2",fontSize:"sm",lineHeight:"4"},caption:{px:"4",py:"2",fontSize:"xs"}}),md:BS({th:{px:"6",py:"3",lineHeight:"4",fontSize:"xs"},td:{px:"6",py:"4",lineHeight:"5"},caption:{px:"6",py:"2",fontSize:"sm"}}),lg:BS({th:{px:"8",py:"4",lineHeight:"5",fontSize:"sm"},td:{px:"8",py:"5",lineHeight:"6"},caption:{px:"6",py:"2",fontSize:"md"}})},Lwe=Awe({baseStyle:Pwe,variants:Nwe,sizes:Dwe,defaultProps:{variant:"simple",size:"md",colorScheme:"gray"}}),$c=Pn("tabs-color"),Cd=Pn("tabs-bg"),iO=Pn("tabs-border-color"),{defineMultiStyleConfig:xwe,definePartsStyle:Gh}=xi(jve.keys),Mwe=n=>{const{orientation:t}=n;return{display:t==="vertical"?"flex":"block"}},Uwe=n=>{const{isFitted:t}=n;return{flex:t?1:void 0,transitionProperty:"common",transitionDuration:"normal",_focusVisible:{zIndex:1,boxShadow:"outline"},_disabled:{cursor:"not-allowed",opacity:.4}}},Vwe=n=>{const{align:t="start",orientation:i}=n;return{justifyContent:{end:"flex-end",center:"center",start:"flex-start"}[t],flexDirection:i==="vertical"?"column":"row"}},Fwe={p:4},jwe=Gh(n=>({root:Mwe(n),tab:Uwe(n),tablist:Vwe(n),tabpanel:Fwe})),Bwe={sm:Gh({tab:{py:1,px:4,fontSize:"sm"}}),md:Gh({tab:{fontSize:"md",py:2,px:4}}),lg:Gh({tab:{fontSize:"lg",py:3,px:4}})},Wwe=Gh(n=>{const{colorScheme:t,orientation:i}=n,a=i==="vertical",l=a?"borderStart":"borderBottom",d=a?"marginStart":"marginBottom";return{tablist:{[l]:"2px solid",borderColor:"inherit"},tab:{[l]:"2px solid",borderColor:"transparent",[d]:"-2px",_selected:{[$c.variable]:`colors.${t}.600`,_dark:{[$c.variable]:`colors.${t}.300`},borderColor:"currentColor"},_active:{[Cd.variable]:"colors.gray.200",_dark:{[Cd.variable]:"colors.whiteAlpha.300"}},_disabled:{_active:{bg:"none"}},color:$c.reference,bg:Cd.reference}}}),zwe=Gh(n=>{const{colorScheme:t}=n;return{tab:{borderTopRadius:"md",border:"1px solid",borderColor:"transparent",mb:"-1px",[iO.variable]:"transparent",_selected:{[$c.variable]:`colors.${t}.600`,[iO.variable]:"colors.white",_dark:{[$c.variable]:`colors.${t}.300`,[iO.variable]:"colors.gray.800"},borderColor:"inherit",borderBottomColor:iO.reference},color:$c.reference},tablist:{mb:"-1px",borderBottom:"1px solid",borderColor:"inherit"}}}),Gwe=Gh(n=>{const{colorScheme:t}=n;return{tab:{border:"1px solid",borderColor:"inherit",[Cd.variable]:"colors.gray.50",_dark:{[Cd.variable]:"colors.whiteAlpha.50"},mb:"-1px",_notLast:{marginEnd:"-1px"},_selected:{[Cd.variable]:"colors.white",[$c.variable]:`colors.${t}.600`,_dark:{[Cd.variable]:"colors.gray.800",[$c.variable]:`colors.${t}.300`},borderColor:"inherit",borderTopColor:"currentColor",borderBottomColor:"transparent"},color:$c.reference,bg:Cd.reference},tablist:{mb:"-1px",borderBottom:"1px solid",borderColor:"inherit"}}}),Hwe=Gh(n=>{const{colorScheme:t,theme:i}=n;return{tab:{borderRadius:"full",fontWeight:"semibold",color:"gray.600",_selected:{color:sc(i,`${t}.700`),bg:sc(i,`${t}.100`)}}}}),$we=Gh(n=>{const{colorScheme:t}=n;return{tab:{borderRadius:"full",fontWeight:"semibold",[$c.variable]:"colors.gray.600",_dark:{[$c.variable]:"inherit"},_selected:{[$c.variable]:"colors.white",[Cd.variable]:`colors.${t}.600`,_dark:{[$c.variable]:"colors.gray.800",[Cd.variable]:`colors.${t}.300`}},color:$c.reference,bg:Cd.reference}}}),Kwe=Gh({}),qwe={line:Wwe,enclosed:zwe,"enclosed-colored":Gwe,"soft-rounded":Hwe,"solid-rounded":$we,unstyled:Kwe},Ywe=xwe({baseStyle:jwe,sizes:Bwe,variants:qwe,defaultProps:{size:"md",variant:"line",colorScheme:"blue"}}),{defineMultiStyleConfig:Xwe,definePartsStyle:gE}=xi(Bve.keys),pK=Pn("tag-bg"),mK=Pn("tag-color"),u2=Pn("tag-shadow"),UO=Pn("tag-min-height"),VO=Pn("tag-min-width"),FO=Pn("tag-font-size"),jO=Pn("tag-padding-inline"),Jwe={fontWeight:"medium",lineHeight:1.2,outline:0,[mK.variable]:Uo.color.reference,[pK.variable]:Uo.bg.reference,[u2.variable]:Uo.shadow.reference,color:mK.reference,bg:pK.reference,boxShadow:u2.reference,borderRadius:"md",minH:UO.reference,minW:VO.reference,fontSize:FO.reference,px:jO.reference,_focusVisible:{[u2.variable]:"shadows.outline"}},Qwe={lineHeight:1.2,overflow:"visible"},Zwe={fontSize:"lg",w:"5",h:"5",transitionProperty:"common",transitionDuration:"normal",borderRadius:"full",marginStart:"1.5",marginEnd:"-1",opacity:.5,_disabled:{opacity:.4},_focusVisible:{boxShadow:"outline",bg:"rgba(0, 0, 0, 0.14)"},_hover:{opacity:.8},_active:{opacity:1}},eRe=gE({container:Jwe,label:Qwe,closeButton:Zwe}),tRe={sm:gE({container:{[UO.variable]:"sizes.5",[VO.variable]:"sizes.5",[FO.variable]:"fontSizes.xs",[jO.variable]:"space.2"},closeButton:{marginEnd:"-2px",marginStart:"0.35rem"}}),md:gE({container:{[UO.variable]:"sizes.6",[VO.variable]:"sizes.6",[FO.variable]:"fontSizes.sm",[jO.variable]:"space.2"}}),lg:gE({container:{[UO.variable]:"sizes.8",[VO.variable]:"sizes.8",[FO.variable]:"fontSizes.md",[jO.variable]:"space.3"}})},nRe={subtle:gE(n=>{var t;return{container:(t=Ww.variants)==null?void 0:t.subtle(n)}}),solid:gE(n=>{var t;return{container:(t=Ww.variants)==null?void 0:t.solid(n)}}),outline:gE(n=>{var t;return{container:(t=Ww.variants)==null?void 0:t.outline(n)}})},rRe=Xwe({variants:nRe,baseStyle:eRe,sizes:tRe,defaultProps:{size:"md",variant:"subtle",colorScheme:"gray"}});var lQ;const iRe={...(lQ=Yr.baseStyle)==null?void 0:lQ.field,paddingY:"2",minHeight:"20",lineHeight:"short",verticalAlign:"top"};var uQ;const oRe={outline:n=>{var t;return((t=Yr.variants)==null?void 0:t.outline(n).field)??{}},flushed:n=>{var t;return((t=Yr.variants)==null?void 0:t.flushed(n).field)??{}},filled:n=>{var t;return((t=Yr.variants)==null?void 0:t.filled(n).field)??{}},unstyled:((uQ=Yr.variants)==null?void 0:uQ.unstyled.field)??{}};var dQ,hQ,fQ,pQ;const sRe={xs:((dQ=Yr.sizes)==null?void 0:dQ.xs.field)??{},sm:((hQ=Yr.sizes)==null?void 0:hQ.sm.field)??{},md:((fQ=Yr.sizes)==null?void 0:fQ.md.field)??{},lg:((pQ=Yr.sizes)==null?void 0:pQ.lg.field)??{}},aRe={baseStyle:iRe,sizes:sRe,variants:oRe,defaultProps:{size:"md",variant:"outline"}},oO=ls("tooltip-bg"),d2=ls("tooltip-fg"),cRe=ls("popper-arrow-bg"),lRe={bg:oO.reference,color:d2.reference,[oO.variable]:"colors.gray.700",[d2.variable]:"colors.whiteAlpha.900",_dark:{[oO.variable]:"colors.gray.300",[d2.variable]:"colors.gray.900"},[cRe.variable]:oO.reference,px:"2",py:"0.5",borderRadius:"sm",fontWeight:"medium",fontSize:"sm",boxShadow:"md",maxW:"xs",zIndex:"tooltip"},uRe={baseStyle:lRe},dRe={Accordion:Xve,Alert:DSe,Avatar:GSe,Badge:Ww,Breadcrumb:e0e,Button:l0e,Checkbox:Qm,CloseButton:w0e,Code:A0e,Container:O0e,Divider:x0e,Drawer:$0e,Editable:Z0e,Form:obe,FormError:dbe,FormLabel:fbe,Heading:gbe,Input:Yr,Kbd:Cbe,Link:Abe,List:Dbe,Menu:Gbe,Modal:tTe,NumberInput:uTe,PinInput:pTe,Popover:RTe,Progress:DTe,Radio:VTe,Select:HTe,Skeleton:KTe,SkipLink:YTe,Slider:swe,Spinner:lwe,Stat:_we,Switch:Iwe,Table:Lwe,Tabs:Ywe,Tag:rRe,Textarea:aRe,Tooltip:uRe,Card:p0e,Stepper:vwe},hRe={none:0,"1px":"1px solid","2px":"2px solid","4px":"4px solid","8px":"8px solid"},fRe={base:"0em",sm:"30em",md:"48em",lg:"62em",xl:"80em","2xl":"96em"},pRe={transparent:"transparent",current:"currentColor",black:"#000000",white:"#FFFFFF",whiteAlpha:{50:"rgba(255, 255, 255, 0.04)",100:"rgba(255, 255, 255, 0.06)",200:"rgba(255, 255, 255, 0.08)",300:"rgba(255, 255, 255, 0.16)",400:"rgba(255, 255, 255, 0.24)",500:"rgba(255, 255, 255, 0.36)",600:"rgba(255, 255, 255, 0.48)",700:"rgba(255, 255, 255, 0.64)",800:"rgba(255, 255, 255, 0.80)",900:"rgba(255, 255, 255, 0.92)"},blackAlpha:{50:"rgba(0, 0, 0, 0.04)",100:"rgba(0, 0, 0, 0.06)",200:"rgba(0, 0, 0, 0.08)",300:"rgba(0, 0, 0, 0.16)",400:"rgba(0, 0, 0, 0.24)",500:"rgba(0, 0, 0, 0.36)",600:"rgba(0, 0, 0, 0.48)",700:"rgba(0, 0, 0, 0.64)",800:"rgba(0, 0, 0, 0.80)",900:"rgba(0, 0, 0, 0.92)"},gray:{50:"#F7FAFC",100:"#EDF2F7",200:"#E2E8F0",300:"#CBD5E0",400:"#A0AEC0",500:"#718096",600:"#4A5568",700:"#2D3748",800:"#1A202C",900:"#171923"},red:{50:"#FFF5F5",100:"#FED7D7",200:"#FEB2B2",300:"#FC8181",400:"#F56565",500:"#E53E3E",600:"#C53030",700:"#9B2C2C",800:"#822727",900:"#63171B"},orange:{50:"#FFFAF0",100:"#FEEBC8",200:"#FBD38D",300:"#F6AD55",400:"#ED8936",500:"#DD6B20",600:"#C05621",700:"#9C4221",800:"#7B341E",900:"#652B19"},yellow:{50:"#FFFFF0",100:"#FEFCBF",200:"#FAF089",300:"#F6E05E",400:"#ECC94B",500:"#D69E2E",600:"#B7791F",700:"#975A16",800:"#744210",900:"#5F370E"},green:{50:"#F0FFF4",100:"#C6F6D5",200:"#9AE6B4",300:"#68D391",400:"#48BB78",500:"#38A169",600:"#2F855A",700:"#276749",800:"#22543D",900:"#1C4532"},teal:{50:"#E6FFFA",100:"#B2F5EA",200:"#81E6D9",300:"#4FD1C5",400:"#38B2AC",500:"#319795",600:"#2C7A7B",700:"#285E61",800:"#234E52",900:"#1D4044"},blue:{50:"#ebf8ff",100:"#bee3f8",200:"#90cdf4",300:"#63b3ed",400:"#4299e1",500:"#3182ce",600:"#2b6cb0",700:"#2c5282",800:"#2a4365",900:"#1A365D"},cyan:{50:"#EDFDFD",100:"#C4F1F9",200:"#9DECF9",300:"#76E4F7",400:"#0BC5EA",500:"#00B5D8",600:"#00A3C4",700:"#0987A0",800:"#086F83",900:"#065666"},purple:{50:"#FAF5FF",100:"#E9D8FD",200:"#D6BCFA",300:"#B794F4",400:"#9F7AEA",500:"#805AD5",600:"#6B46C1",700:"#553C9A",800:"#44337A",900:"#322659"},pink:{50:"#FFF5F7",100:"#FED7E2",200:"#FBB6CE",300:"#F687B3",400:"#ED64A6",500:"#D53F8C",600:"#B83280",700:"#97266D",800:"#702459",900:"#521B41"}},mRe={none:"0",sm:"0.125rem",base:"0.25rem",md:"0.375rem",lg:"0.5rem",xl:"0.75rem","2xl":"1rem","3xl":"1.5rem",full:"9999px"},gRe={xs:"0 0 0 1px rgba(0, 0, 0, 0.05)",sm:"0 1px 2px 0 rgba(0, 0, 0, 0.05)",base:"0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06)",md:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)",lg:"0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)",xl:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)","2xl":"0 25px 50px -12px rgba(0, 0, 0, 0.25)",outline:"0 0 0 3px rgba(66, 153, 225, 0.6)",inner:"inset 0 2px 4px 0 rgba(0,0,0,0.06)",none:"none","dark-lg":"rgba(0, 0, 0, 0.1) 0px 0px 0px 1px, rgba(0, 0, 0, 0.2) 0px 5px 10px, rgba(0, 0, 0, 0.4) 0px 15px 40px"},_Re={common:"background-color, border-color, color, fill, stroke, opacity, box-shadow, transform",colors:"background-color, border-color, color, fill, stroke",dimensions:"width, height",position:"left, right, top, bottom",background:"background-color, background-image, background-position"},ERe={"ease-in":"cubic-bezier(0.4, 0, 1, 1)","ease-out":"cubic-bezier(0, 0, 0.2, 1)","ease-in-out":"cubic-bezier(0.4, 0, 0.2, 1)"},yRe={"ultra-fast":"50ms",faster:"100ms",fast:"150ms",normal:"200ms",slow:"300ms",slower:"400ms","ultra-slow":"500ms"},vRe={property:_Re,easing:ERe,duration:yRe},SRe={hide:-1,auto:"auto",base:0,docked:10,dropdown:1e3,sticky:1100,banner:1200,overlay:1300,modal:1400,popover:1500,skipLink:1600,toast:1700,tooltip:1800},bRe={none:0,sm:"4px",base:"8px",md:"12px",lg:"16px",xl:"24px","2xl":"40px","3xl":"64px"},TRe={breakpoints:fRe,zIndices:SRe,radii:mRe,blur:bRe,colors:pRe,...QQ,sizes:$Q,shadows:gRe,space:HQ,borders:hRe,transition:vRe},wRe={colors:{"chakra-body-text":{_light:"gray.800",_dark:"whiteAlpha.900"},"chakra-body-bg":{_light:"white",_dark:"gray.800"},"chakra-border-color":{_light:"gray.200",_dark:"whiteAlpha.300"},"chakra-inverse-text":{_light:"white",_dark:"gray.800"},"chakra-subtle-bg":{_light:"gray.100",_dark:"gray.700"},"chakra-subtle-text":{_light:"gray.600",_dark:"gray.400"},"chakra-placeholder-color":{_light:"gray.500",_dark:"whiteAlpha.400"}}},RRe={global:{body:{fontFamily:"body",color:"chakra-body-text",bg:"chakra-body-bg",transitionProperty:"background-color",transitionDuration:"normal",lineHeight:"base"},"*::placeholder":{color:"chakra-placeholder-color"},"*, *::before, &::after":{borderColor:"chakra-border-color"}}},CRe="ltr",IRe={useSystemColorMode:!1,initialColorMode:"light",cssVarPrefix:"chakra"},ARe={semanticTokens:wRe,direction:CRe,...TRe,components:dRe,styles:RRe,config:IRe};function PRe(n){if(n.sheet)return n.sheet;for(var t=0;t<document.styleSheets.length;t++)if(document.styleSheets[t].ownerNode===n)return document.styleSheets[t]}function ORe(n){var t=document.createElement("style");return t.setAttribute("data-emotion",n.key),n.nonce!==void 0&&t.setAttribute("nonce",n.nonce),t.appendChild(document.createTextNode("")),t.setAttribute("data-s",""),t}var kRe=function(){function n(i){var a=this;this._insertTag=function(l){var d;a.tags.length===0?a.insertionPoint?d=a.insertionPoint.nextSibling:a.prepend?d=a.container.firstChild:d=a.before:d=a.tags[a.tags.length-1].nextSibling,a.container.insertBefore(l,d),a.tags.push(l)},this.isSpeedy=i.speedy===void 0?!0:i.speedy,this.tags=[],this.ctr=0,this.nonce=i.nonce,this.key=i.key,this.container=i.container,this.prepend=i.prepend,this.insertionPoint=i.insertionPoint,this.before=null}var t=n.prototype;return t.hydrate=function(a){a.forEach(this._insertTag)},t.insert=function(a){this.ctr%(this.isSpeedy?65e3:1)===0&&this._insertTag(ORe(this));var l=this.tags[this.tags.length-1];if(this.isSpeedy){var d=PRe(l);try{d.insertRule(a,d.cssRules.length)}catch{}}else l.appendChild(document.createTextNode(a));this.ctr++},t.flush=function(){this.tags.forEach(function(a){var l;return(l=a.parentNode)==null?void 0:l.removeChild(a)}),this.tags=[],this.ctr=0},n}(),Aa="-ms-",_k="-moz-",Kr="-webkit-",nZ="comm",sF="rule",aF="decl",NRe="@import",rZ="@keyframes",DRe="@layer",LRe=Math.abs,dN=String.fromCharCode,xRe=Object.assign;function MRe(n,t){return ea(n,0)^45?(((t<<2^ea(n,0))<<2^ea(n,1))<<2^ea(n,2))<<2^ea(n,3):0}function iZ(n){return n.trim()}function URe(n,t){return(n=t.exec(n))?n[0]:n}function qr(n,t,i){return n.replace(t,i)}function RU(n,t){return n.indexOf(t)}function ea(n,t){return n.charCodeAt(t)|0}function uR(n,t,i){return n.slice(t,i)}function xh(n){return n.length}function cF(n){return n.length}function sO(n,t){return t.push(n),n}function VRe(n,t){return n.map(t).join("")}var hN=1,e0=1,oZ=0,Zc=0,$o=0,w0="";function fN(n,t,i,a,l,d,p){return{value:n,root:t,parent:i,type:a,props:l,children:d,line:hN,column:e0,length:p,return:""}}function iw(n,t){return xRe(fN("",null,null,"",null,null,0),n,{length:-n.length},t)}function FRe(){return $o}function jRe(){return $o=Zc>0?ea(w0,--Zc):0,e0--,$o===10&&(e0=1,hN--),$o}function Ol(){return $o=Zc<oZ?ea(w0,Zc++):0,e0++,$o===10&&(e0=1,hN++),$o}function Hh(){return ea(w0,Zc)}function BO(){return Zc}function BR(n,t){return uR(w0,n,t)}function dR(n){switch(n){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function sZ(n){return hN=e0=1,oZ=xh(w0=n),Zc=0,[]}function aZ(n){return w0="",n}function WO(n){return iZ(BR(Zc-1,CU(n===91?n+2:n===40?n+1:n)))}function BRe(n){for(;($o=Hh())&&$o<33;)Ol();return dR(n)>2||dR($o)>3?"":" "}function WRe(n,t){for(;--t&&Ol()&&!($o<48||$o>102||$o>57&&$o<65||$o>70&&$o<97););return BR(n,BO()+(t<6&&Hh()==32&&Ol()==32))}function CU(n){for(;Ol();)switch($o){case n:return Zc;case 34:case 39:n!==34&&n!==39&&CU($o);break;case 40:n===41&&CU(n);break;case 92:Ol();break}return Zc}function zRe(n,t){for(;Ol()&&n+$o!==57;)if(n+$o===84&&Hh()===47)break;return"/*"+BR(t,Zc-1)+"*"+dN(n===47?n:Ol())}function GRe(n){for(;!dR(Hh());)Ol();return BR(n,Zc)}function HRe(n){return aZ(zO("",null,null,null,[""],n=sZ(n),0,[0],n))}function zO(n,t,i,a,l,d,p,E,v){for(var b=0,w=0,A=p,N=0,F=0,j=0,B=1,H=1,ee=1,K=0,te="",le=l,oe=d,ge=a,Z=te;H;)switch(j=K,K=Ol()){case 40:if(j!=108&&ea(Z,A-1)==58){RU(Z+=qr(WO(K),"&","&\f"),"&\f")!=-1&&(ee=-1);break}case 34:case 39:case 91:Z+=WO(K);break;case 9:case 10:case 13:case 32:Z+=BRe(j);break;case 92:Z+=WRe(BO()-1,7);continue;case 47:switch(Hh()){case 42:case 47:sO($Re(zRe(Ol(),BO()),t,i),v);break;default:Z+="/"}break;case 123*B:E[b++]=xh(Z)*ee;case 125*B:case 59:case 0:switch(K){case 0:case 125:H=0;case 59+w:ee==-1&&(Z=qr(Z,/\f/g,"")),F>0&&xh(Z)-A&&sO(F>32?_K(Z+";",a,i,A-1):_K(qr(Z," ","")+";",a,i,A-2),v);break;case 59:Z+=";";default:if(sO(ge=gK(Z,t,i,b,w,l,E,te,le=[],oe=[],A),d),K===123)if(w===0)zO(Z,t,ge,ge,le,d,A,E,oe);else switch(N===99&&ea(Z,3)===110?100:N){case 100:case 108:case 109:case 115:zO(n,ge,ge,a&&sO(gK(n,ge,ge,0,0,l,E,te,l,le=[],A),oe),l,oe,A,E,a?le:oe);break;default:zO(Z,ge,ge,ge,[""],oe,0,E,oe)}}b=w=F=0,B=ee=1,te=Z="",A=p;break;case 58:A=1+xh(Z),F=j;default:if(B<1){if(K==123)--B;else if(K==125&&B++==0&&jRe()==125)continue}switch(Z+=dN(K),K*B){case 38:ee=w>0?1:(Z+="\f",-1);break;case 44:E[b++]=(xh(Z)-1)*ee,ee=1;break;case 64:Hh()===45&&(Z+=WO(Ol())),N=Hh(),w=A=xh(te=Z+=GRe(BO())),K++;break;case 45:j===45&&xh(Z)==2&&(B=0)}}return d}function gK(n,t,i,a,l,d,p,E,v,b,w){for(var A=l-1,N=l===0?d:[""],F=cF(N),j=0,B=0,H=0;j<a;++j)for(var ee=0,K=uR(n,A+1,A=LRe(B=p[j])),te=n;ee<F;++ee)(te=iZ(B>0?N[ee]+" "+K:qr(K,/&\f/g,N[ee])))&&(v[H++]=te);return fN(n,t,i,l===0?sF:E,v,b,w)}function $Re(n,t,i){return fN(n,t,i,nZ,dN(FRe()),uR(n,2,-2),0)}function _K(n,t,i,a){return fN(n,t,i,aF,uR(n,0,a),uR(n,a+1,-1),a)}function WS(n,t){for(var i="",a=cF(n),l=0;l<a;l++)i+=t(n[l],l,n,t)||"";return i}function KRe(n,t,i,a){switch(n.type){case DRe:if(n.children.length)break;case NRe:case aF:return n.return=n.return||n.value;case nZ:return"";case rZ:return n.return=n.value+"{"+WS(n.children,a)+"}";case sF:n.value=n.props.join(",")}return xh(i=WS(n.children,a))?n.return=n.value+"{"+i+"}":""}function qRe(n){var t=cF(n);return function(i,a,l,d){for(var p="",E=0;E<t;E++)p+=n[E](i,a,l,d)||"";return p}}function YRe(n){return function(t){t.root||(t=t.return)&&n(t)}}var EK=function(t){var i=new WeakMap;return function(a){if(i.has(a))return i.get(a);var l=t(a);return i.set(a,l),l}};function cZ(n){var t=Object.create(null);return function(i){return t[i]===void 0&&(t[i]=n(i)),t[i]}}var XRe=function(t,i,a){for(var l=0,d=0;l=d,d=Hh(),l===38&&d===12&&(i[a]=1),!dR(d);)Ol();return BR(t,Zc)},JRe=function(t,i){var a=-1,l=44;do switch(dR(l)){case 0:l===38&&Hh()===12&&(i[a]=1),t[a]+=XRe(Zc-1,i,a);break;case 2:t[a]+=WO(l);break;case 4:if(l===44){t[++a]=Hh()===58?"&\f":"",i[a]=t[a].length;break}default:t[a]+=dN(l)}while(l=Ol());return t},QRe=function(t,i){return aZ(JRe(sZ(t),i))},yK=new WeakMap,ZRe=function(t){if(!(t.type!=="rule"||!t.parent||t.length<1)){for(var i=t.value,a=t.parent,l=t.column===a.column&&t.line===a.line;a.type!=="rule";)if(a=a.parent,!a)return;if(!(t.props.length===1&&i.charCodeAt(0)!==58&&!yK.get(a))&&!l){yK.set(t,!0);for(var d=[],p=QRe(i,d),E=a.props,v=0,b=0;v<p.length;v++)for(var w=0;w<E.length;w++,b++)t.props[b]=d[v]?p[v].replace(/&\f/g,E[w]):E[w]+" "+p[v]}}},eCe=function(t){if(t.type==="decl"){var i=t.value;i.charCodeAt(0)===108&&i.charCodeAt(2)===98&&(t.return="",t.value="")}};function lZ(n,t){switch(MRe(n,t)){case 5103:return Kr+"print-"+n+n;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return Kr+n+n;case 5349:case 4246:case 4810:case 6968:case 2756:return Kr+n+_k+n+Aa+n+n;case 6828:case 4268:return Kr+n+Aa+n+n;case 6165:return Kr+n+Aa+"flex-"+n+n;case 5187:return Kr+n+qr(n,/(\w+).+(:[^]+)/,Kr+"box-$1$2"+Aa+"flex-$1$2")+n;case 5443:return Kr+n+Aa+"flex-item-"+qr(n,/flex-|-self/,"")+n;case 4675:return Kr+n+Aa+"flex-line-pack"+qr(n,/align-content|flex-|-self/,"")+n;case 5548:return Kr+n+Aa+qr(n,"shrink","negative")+n;case 5292:return Kr+n+Aa+qr(n,"basis","preferred-size")+n;case 6060:return Kr+"box-"+qr(n,"-grow","")+Kr+n+Aa+qr(n,"grow","positive")+n;case 4554:return Kr+qr(n,/([^-])(transform)/g,"$1"+Kr+"$2")+n;case 6187:return qr(qr(qr(n,/(zoom-|grab)/,Kr+"$1"),/(image-set)/,Kr+"$1"),n,"")+n;case 5495:case 3959:return qr(n,/(image-set\([^]*)/,Kr+"$1$`$1");case 4968:return qr(qr(n,/(.+:)(flex-)?(.*)/,Kr+"box-pack:$3"+Aa+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+Kr+n+n;case 4095:case 3583:case 4068:case 2532:return qr(n,/(.+)-inline(.+)/,Kr+"$1$2")+n;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(xh(n)-1-t>6)switch(ea(n,t+1)){case 109:if(ea(n,t+4)!==45)break;case 102:return qr(n,/(.+:)(.+)-([^]+)/,"$1"+Kr+"$2-$3$1"+_k+(ea(n,t+3)==108?"$3":"$2-$3"))+n;case 115:return~RU(n,"stretch")?lZ(qr(n,"stretch","fill-available"),t)+n:n}break;case 4949:if(ea(n,t+1)!==115)break;case 6444:switch(ea(n,xh(n)-3-(~RU(n,"!important")&&10))){case 107:return qr(n,":",":"+Kr)+n;case 101:return qr(n,/(.+:)([^;!]+)(;|!.+)?/,"$1"+Kr+(ea(n,14)===45?"inline-":"")+"box$3$1"+Kr+"$2$3$1"+Aa+"$2box$3")+n}break;case 5936:switch(ea(n,t+11)){case 114:return Kr+n+Aa+qr(n,/[svh]\w+-[tblr]{2}/,"tb")+n;case 108:return Kr+n+Aa+qr(n,/[svh]\w+-[tblr]{2}/,"tb-rl")+n;case 45:return Kr+n+Aa+qr(n,/[svh]\w+-[tblr]{2}/,"lr")+n}return Kr+n+Aa+n+n}return n}var tCe=function(t,i,a,l){if(t.length>-1&&!t.return)switch(t.type){case aF:t.return=lZ(t.value,t.length);break;case rZ:return WS([iw(t,{value:qr(t.value,"@","@"+Kr)})],l);case sF:if(t.length)return VRe(t.props,function(d){switch(URe(d,/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":return WS([iw(t,{props:[qr(d,/:(read-\w+)/,":"+_k+"$1")]})],l);case"::placeholder":return WS([iw(t,{props:[qr(d,/:(plac\w+)/,":"+Kr+"input-$1")]}),iw(t,{props:[qr(d,/:(plac\w+)/,":"+_k+"$1")]}),iw(t,{props:[qr(d,/:(plac\w+)/,Aa+"input-$1")]})],l)}return""})}},nCe=[tCe],rCe=function(t){var i=t.key;if(i==="css"){var a=document.querySelectorAll("style[data-emotion]:not([data-s])");Array.prototype.forEach.call(a,function(B){var H=B.getAttribute("data-emotion");H.indexOf(" ")!==-1&&(document.head.appendChild(B),B.setAttribute("data-s",""))})}var l=t.stylisPlugins||nCe,d={},p,E=[];p=t.container||document.head,Array.prototype.forEach.call(document.querySelectorAll('style[data-emotion^="'+i+' "]'),function(B){for(var H=B.getAttribute("data-emotion").split(" "),ee=1;ee<H.length;ee++)d[H[ee]]=!0;E.push(B)});var v,b=[ZRe,eCe];{var w,A=[KRe,YRe(function(B){w.insert(B)})],N=qRe(b.concat(l,A)),F=function(H){return WS(HRe(H),N)};v=function(H,ee,K,te){w=K,F(H?H+"{"+ee.styles+"}":ee.styles),te&&(j.inserted[ee.name]=!0)}}var j={key:i,sheet:new kRe({key:i,container:p,nonce:t.nonce,speedy:t.speedy,prepend:t.prepend,insertionPoint:t.insertionPoint}),nonce:t.nonce,inserted:d,registered:{},insert:v};return j.sheet.hydrate(E),j};function wE(){return wE=Object.assign?Object.assign.bind():function(n){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)({}).hasOwnProperty.call(i,a)&&(n[a]=i[a])}return n},wE.apply(null,arguments)}var h2={exports:{}},ti={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var vK;function iCe(){if(vK)return ti;vK=1;var n=typeof Symbol=="function"&&Symbol.for,t=n?Symbol.for("react.element"):60103,i=n?Symbol.for("react.portal"):60106,a=n?Symbol.for("react.fragment"):60107,l=n?Symbol.for("react.strict_mode"):60108,d=n?Symbol.for("react.profiler"):60114,p=n?Symbol.for("react.provider"):60109,E=n?Symbol.for("react.context"):60110,v=n?Symbol.for("react.async_mode"):60111,b=n?Symbol.for("react.concurrent_mode"):60111,w=n?Symbol.for("react.forward_ref"):60112,A=n?Symbol.for("react.suspense"):60113,N=n?Symbol.for("react.suspense_list"):60120,F=n?Symbol.for("react.memo"):60115,j=n?Symbol.for("react.lazy"):60116,B=n?Symbol.for("react.block"):60121,H=n?Symbol.for("react.fundamental"):60117,ee=n?Symbol.for("react.responder"):60118,K=n?Symbol.for("react.scope"):60119;function te(oe){if(typeof oe=="object"&&oe!==null){var ge=oe.$$typeof;switch(ge){case t:switch(oe=oe.type,oe){case v:case b:case a:case d:case l:case A:return oe;default:switch(oe=oe&&oe.$$typeof,oe){case E:case w:case j:case F:case p:return oe;default:return ge}}case i:return ge}}}function le(oe){return te(oe)===b}return ti.AsyncMode=v,ti.ConcurrentMode=b,ti.ContextConsumer=E,ti.ContextProvider=p,ti.Element=t,ti.ForwardRef=w,ti.Fragment=a,ti.Lazy=j,ti.Memo=F,ti.Portal=i,ti.Profiler=d,ti.StrictMode=l,ti.Suspense=A,ti.isAsyncMode=function(oe){return le(oe)||te(oe)===v},ti.isConcurrentMode=le,ti.isContextConsumer=function(oe){return te(oe)===E},ti.isContextProvider=function(oe){return te(oe)===p},ti.isElement=function(oe){return typeof oe=="object"&&oe!==null&&oe.$$typeof===t},ti.isForwardRef=function(oe){return te(oe)===w},ti.isFragment=function(oe){return te(oe)===a},ti.isLazy=function(oe){return te(oe)===j},ti.isMemo=function(oe){return te(oe)===F},ti.isPortal=function(oe){return te(oe)===i},ti.isProfiler=function(oe){return te(oe)===d},ti.isStrictMode=function(oe){return te(oe)===l},ti.isSuspense=function(oe){return te(oe)===A},ti.isValidElementType=function(oe){return typeof oe=="string"||typeof oe=="function"||oe===a||oe===b||oe===d||oe===l||oe===A||oe===N||typeof oe=="object"&&oe!==null&&(oe.$$typeof===j||oe.$$typeof===F||oe.$$typeof===p||oe.$$typeof===E||oe.$$typeof===w||oe.$$typeof===H||oe.$$typeof===ee||oe.$$typeof===K||oe.$$typeof===B)},ti.typeOf=te,ti}var SK;function oCe(){return SK||(SK=1,h2.exports=iCe()),h2.exports}var f2,bK;function sCe(){if(bK)return f2;bK=1;var n=oCe(),t={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},i={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},a={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},l={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},d={};d[n.ForwardRef]=a,d[n.Memo]=l;function p(j){return n.isMemo(j)?l:d[j.$$typeof]||t}var E=Object.defineProperty,v=Object.getOwnPropertyNames,b=Object.getOwnPropertySymbols,w=Object.getOwnPropertyDescriptor,A=Object.getPrototypeOf,N=Object.prototype;function F(j,B,H){if(typeof B!="string"){if(N){var ee=A(B);ee&&ee!==N&&F(j,ee,H)}var K=v(B);b&&(K=K.concat(b(B)));for(var te=p(j),le=p(B),oe=0;oe<K.length;++oe){var ge=K[oe];if(!i[ge]&&!(H&&H[ge])&&!(le&&le[ge])&&!(te&&te[ge])){var Z=w(B,ge);try{E(j,ge,Z)}catch{}}}}return j}return f2=F,f2}sCe();var aCe=!0;function uZ(n,t,i){var a="";return i.split(" ").forEach(function(l){n[l]!==void 0?t.push(n[l]+";"):l&&(a+=l+" ")}),a}var lF=function(t,i,a){var l=t.key+"-"+i.name;(a===!1||aCe===!1)&&t.registered[l]===void 0&&(t.registered[l]=i.styles)},uF=function(t,i,a){lF(t,i,a);var l=t.key+"-"+i.name;if(t.inserted[i.name]===void 0){var d=i;do t.insert(i===d?"."+l:"",d,t.sheet,!0),d=d.next;while(d!==void 0)}};function cCe(n){for(var t=0,i,a=0,l=n.length;l>=4;++a,l-=4)i=n.charCodeAt(a)&255|(n.charCodeAt(++a)&255)<<8|(n.charCodeAt(++a)&255)<<16|(n.charCodeAt(++a)&255)<<24,i=(i&65535)*1540483477+((i>>>16)*59797<<16),i^=i>>>24,t=(i&65535)*1540483477+((i>>>16)*59797<<16)^(t&65535)*1540483477+((t>>>16)*59797<<16);switch(l){case 3:t^=(n.charCodeAt(a+2)&255)<<16;case 2:t^=(n.charCodeAt(a+1)&255)<<8;case 1:t^=n.charCodeAt(a)&255,t=(t&65535)*1540483477+((t>>>16)*59797<<16)}return t^=t>>>13,t=(t&65535)*1540483477+((t>>>16)*59797<<16),((t^t>>>15)>>>0).toString(36)}var lCe={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,scale:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},uCe=/[A-Z]|^ms/g,dCe=/_EMO_([^_]+?)_([^]*?)_EMO_/g,dZ=function(t){return t.charCodeAt(1)===45},TK=function(t){return t!=null&&typeof t!="boolean"},p2=cZ(function(n){return dZ(n)?n:n.replace(uCe,"-$&").toLowerCase()}),wK=function(t,i){switch(t){case"animation":case"animationName":if(typeof i=="string")return i.replace(dCe,function(a,l,d){return Mh={name:l,styles:d,next:Mh},l})}return lCe[t]!==1&&!dZ(t)&&typeof i=="number"&&i!==0?i+"px":i};function hR(n,t,i){if(i==null)return"";var a=i;if(a.__emotion_styles!==void 0)return a;switch(typeof i){case"boolean":return"";case"object":{var l=i;if(l.anim===1)return Mh={name:l.name,styles:l.styles,next:Mh},l.name;var d=i;if(d.styles!==void 0){var p=d.next;if(p!==void 0)for(;p!==void 0;)Mh={name:p.name,styles:p.styles,next:Mh},p=p.next;var E=d.styles+";";return E}return hCe(n,t,i)}case"function":{if(n!==void 0){var v=Mh,b=i(n);return Mh=v,hR(n,t,b)}break}}var w=i;if(t==null)return w;var A=t[w];return A!==void 0?A:w}function hCe(n,t,i){var a="";if(Array.isArray(i))for(var l=0;l<i.length;l++)a+=hR(n,t,i[l])+";";else for(var d in i){var p=i[d];if(typeof p!="object"){var E=p;t!=null&&t[E]!==void 0?a+=d+"{"+t[E]+"}":TK(E)&&(a+=p2(d)+":"+wK(d,E)+";")}else if(Array.isArray(p)&&typeof p[0]=="string"&&(t==null||t[p[0]]===void 0))for(var v=0;v<p.length;v++)TK(p[v])&&(a+=p2(d)+":"+wK(d,p[v])+";");else{var b=hR(n,t,p);switch(d){case"animation":case"animationName":{a+=p2(d)+":"+b+";";break}default:a+=d+"{"+b+"}"}}}return a}var RK=/label:\s*([^\s;{]+)\s*(;|$)/g,Mh;function pN(n,t,i){if(n.length===1&&typeof n[0]=="object"&&n[0]!==null&&n[0].styles!==void 0)return n[0];var a=!0,l="";Mh=void 0;var d=n[0];if(d==null||d.raw===void 0)a=!1,l+=hR(i,t,d);else{var p=d;l+=p[0]}for(var E=1;E<n.length;E++)if(l+=hR(i,t,n[E]),a){var v=d;l+=v[E]}RK.lastIndex=0;for(var b="",w;(w=RK.exec(l))!==null;)b+="-"+w[1];var A=cCe(l)+b;return{name:A,styles:l,next:Mh}}var fCe=function(t){return t()},hZ=F$.useInsertionEffect?F$.useInsertionEffect:!1,fZ=hZ||fCe,CK=hZ||L.useLayoutEffect,dF=L.createContext(typeof HTMLElement<"u"?rCe({key:"css"}):null);dF.Provider;var pCe=function(){return L.useContext(dF)},hF=function(t){return L.forwardRef(function(i,a){var l=L.useContext(dF);return t(i,l,a)})},t0=L.createContext({}),mCe=function(t,i){if(typeof i=="function"){var a=i(t);return a}return wE({},t,i)},gCe=EK(function(n){return EK(function(t){return mCe(n,t)})}),_Ce=function(t){var i=L.useContext(t0);return t.theme!==i&&(i=gCe(i)(t.theme)),L.createElement(t0.Provider,{value:i},t.children)},fF={}.hasOwnProperty,IU="__EMOTION_TYPE_PLEASE_DO_NOT_USE__",ECe=function(t,i){var a={};for(var l in i)fF.call(i,l)&&(a[l]=i[l]);return a[IU]=t,a},yCe=function(t){var i=t.cache,a=t.serialized,l=t.isStringTag;return lF(i,a,l),fZ(function(){return uF(i,a,l)}),null},vCe=hF(function(n,t,i){var a=n.css;typeof a=="string"&&t.registered[a]!==void 0&&(a=t.registered[a]);var l=n[IU],d=[a],p="";typeof n.className=="string"?p=uZ(t.registered,d,n.className):n.className!=null&&(p=n.className+" ");var E=pN(d,void 0,L.useContext(t0));p+=t.key+"-"+E.name;var v={};for(var b in n)fF.call(n,b)&&b!=="css"&&b!==IU&&(v[b]=n[b]);return v.className=p,i&&(v.ref=i),L.createElement(L.Fragment,null,L.createElement(yCe,{cache:t,serialized:E,isStringTag:typeof l=="string"}),L.createElement(l,v))}),SCe=vCe,IK=function(t,i){var a=arguments;if(i==null||!fF.call(i,"css"))return L.createElement.apply(void 0,a);var l=a.length,d=new Array(l);d[0]=SCe,d[1]=ECe(t,i);for(var p=2;p<l;p++)d[p]=a[p];return L.createElement.apply(null,d)};(function(n){var t;t||(t=n.JSX||(n.JSX={}))})(IK||(IK={}));var mN=hF(function(n,t){var i=n.styles,a=pN([i],void 0,L.useContext(t0)),l=L.useRef();return CK(function(){var d=t.key+"-global",p=new t.sheet.constructor({key:d,nonce:t.sheet.nonce,container:t.sheet.container,speedy:t.sheet.isSpeedy}),E=!1,v=document.querySelector('style[data-emotion="'+d+" "+a.name+'"]');return t.sheet.tags.length&&(p.before=t.sheet.tags[0]),v!==null&&(E=!0,v.setAttribute("data-emotion",d),p.hydrate([v])),l.current=[p,E],function(){p.flush()}},[t]),CK(function(){var d=l.current,p=d[0],E=d[1];if(E){d[1]=!1;return}if(a.next!==void 0&&uF(t,a.next,!0),p.tags.length){var v=p.tags[p.tags.length-1].nextElementSibling;p.before=v,p.flush()}t.insert("",a,p,!1)},[t,a.name]),null});function bCe(){for(var n=arguments.length,t=new Array(n),i=0;i<n;i++)t[i]=arguments[i];return pN(t)}function WR(){var n=bCe.apply(void 0,arguments),t="animation-"+n.name;return{name:t,styles:"@keyframes "+t+"{"+n.styles+"}",anim:1,toString:function(){return"_EMO_"+this.name+"_"+this.styles+"_EMO_"}}}const pF=L.createContext({});pF.displayName="ColorModeContext";function gN(){const n=L.useContext(pF);if(n===void 0)throw new Error("useColorMode must be used within a ColorModeProvider");return n}function TCe(n,t){const{colorMode:i}=gN();return i==="dark"?t:n}const aO={light:"chakra-ui-light",dark:"chakra-ui-dark"};function wCe(n={}){const{preventTransition:t=!0,nonce:i}=n,a={setDataset:l=>{const d=t?a.preventTransition():void 0;document.documentElement.dataset.theme=l,document.documentElement.style.colorScheme=l,d==null||d()},setClassName(l){document.body.classList.add(l?aO.dark:aO.light),document.body.classList.remove(l?aO.light:aO.dark)},query(){return window.matchMedia("(prefers-color-scheme: dark)")},getSystemTheme(l){return a.query().matches??l==="dark"?"dark":"light"},addListener(l){const d=a.query(),p=E=>{l(E.matches?"dark":"light")};return typeof d.addListener=="function"?d.addListener(p):d.addEventListener("change",p),()=>{typeof d.removeListener=="function"?d.removeListener(p):d.removeEventListener("change",p)}},preventTransition(){const l=document.createElement("style");return l.appendChild(document.createTextNode("*{-webkit-transition:none!important;-moz-transition:none!important;-o-transition:none!important;-ms-transition:none!important;transition:none!important}")),i!==void 0&&(l.nonce=i),document.head.appendChild(l),()=>{window.getComputedStyle(document.body),requestAnimationFrame(()=>{requestAnimationFrame(()=>{document.head.removeChild(l)})})}}};return a}const RCe="chakra-ui-color-mode";function CCe(n){return{ssr:!1,type:"localStorage",get(t){if(!(globalThis!=null&&globalThis.document))return t;let i;try{i=localStorage.getItem(n)||t}catch{}return i||t},set(t){try{localStorage.setItem(n,t)}catch{}}}}const ICe=CCe(RCe),AK=()=>{},ACe=q_e()?L.useLayoutEffect:L.useEffect;function PK(n,t){return n.type==="cookie"&&n.ssr?n.get(t):t}const pZ=function(t){const{value:i,children:a,options:{useSystemColorMode:l,initialColorMode:d,disableTransitionOnChange:p}={},colorModeManager:E=ICe}=t,v=pCe(),b=d==="dark"?"dark":"light",[w,A]=L.useState(()=>PK(E,b)),[N,F]=L.useState(()=>PK(E)),{getSystemTheme:j,setClassName:B,setDataset:H,addListener:ee}=L.useMemo(()=>wCe({preventTransition:p,nonce:v==null?void 0:v.nonce}),[p,v==null?void 0:v.nonce]),K=d==="system"&&!w?N:w,te=L.useCallback(ge=>{const Z=ge==="system"?j():ge;A(Z),B(Z==="dark"),H(Z),E.set(Z)},[E,j,B,H]);ACe(()=>{d==="system"&&F(j())},[]),L.useEffect(()=>{const ge=E.get();if(ge){te(ge);return}if(d==="system"){te("system");return}te(b)},[E,b,d,te]);const le=L.useCallback(()=>{te(K==="dark"?"light":"dark")},[K,te]);L.useEffect(()=>{if(l)return ee(te)},[l,ee,te]);const oe=L.useMemo(()=>({colorMode:i??K,toggleColorMode:i?AK:le,setColorMode:i?AK:te,forced:i!==void 0}),[K,le,te,i]);return C.jsx(pF.Provider,{value:oe,children:a})};pZ.displayName="ColorModeProvider";const mZ=String.raw,gZ=mZ`
  :root,
  :host {
    --chakra-vh: 100vh;
  }

  @supports (height: -webkit-fill-available) {
    :root,
    :host {
      --chakra-vh: -webkit-fill-available;
    }
  }

  @supports (height: -moz-fill-available) {
    :root,
    :host {
      --chakra-vh: -moz-fill-available;
    }
  }

  @supports (height: 100dvh) {
    :root,
    :host {
      --chakra-vh: 100dvh;
    }
  }
`,PCe=()=>C.jsx(mN,{styles:gZ}),OCe=({scope:n=""})=>C.jsx(mN,{styles:mZ`
      html {
        line-height: 1.5;
        -webkit-text-size-adjust: 100%;
        font-family: system-ui, sans-serif;
        -webkit-font-smoothing: antialiased;
        text-rendering: optimizeLegibility;
        -moz-osx-font-smoothing: grayscale;
        touch-action: manipulation;
      }

      body {
        position: relative;
        min-height: 100%;
        margin: 0;
        font-feature-settings: "kern";
      }

      ${n} :where(*, *::before, *::after) {
        border-width: 0;
        border-style: solid;
        box-sizing: border-box;
        word-wrap: break-word;
      }

      main {
        display: block;
      }

      ${n} hr {
        border-top-width: 1px;
        box-sizing: content-box;
        height: 0;
        overflow: visible;
      }

      ${n} :where(pre, code, kbd,samp) {
        font-family: SFMono-Regular, Menlo, Monaco, Consolas, monospace;
        font-size: 1em;
      }

      ${n} a {
        background-color: transparent;
        color: inherit;
        text-decoration: inherit;
      }

      ${n} abbr[title] {
        border-bottom: none;
        text-decoration: underline;
        -webkit-text-decoration: underline dotted;
        text-decoration: underline dotted;
      }

      ${n} :where(b, strong) {
        font-weight: bold;
      }

      ${n} small {
        font-size: 80%;
      }

      ${n} :where(sub,sup) {
        font-size: 75%;
        line-height: 0;
        position: relative;
        vertical-align: baseline;
      }

      ${n} sub {
        bottom: -0.25em;
      }

      ${n} sup {
        top: -0.5em;
      }

      ${n} img {
        border-style: none;
      }

      ${n} :where(button, input, optgroup, select, textarea) {
        font-family: inherit;
        font-size: 100%;
        line-height: 1.15;
        margin: 0;
      }

      ${n} :where(button, input) {
        overflow: visible;
      }

      ${n} :where(button, select) {
        text-transform: none;
      }

      ${n} :where(
          button::-moz-focus-inner,
          [type="button"]::-moz-focus-inner,
          [type="reset"]::-moz-focus-inner,
          [type="submit"]::-moz-focus-inner
        ) {
        border-style: none;
        padding: 0;
      }

      ${n} fieldset {
        padding: 0.35em 0.75em 0.625em;
      }

      ${n} legend {
        box-sizing: border-box;
        color: inherit;
        display: table;
        max-width: 100%;
        padding: 0;
        white-space: normal;
      }

      ${n} progress {
        vertical-align: baseline;
      }

      ${n} textarea {
        overflow: auto;
      }

      ${n} :where([type="checkbox"], [type="radio"]) {
        box-sizing: border-box;
        padding: 0;
      }

      ${n} input[type="number"]::-webkit-inner-spin-button,
      ${n} input[type="number"]::-webkit-outer-spin-button {
        -webkit-appearance: none !important;
      }

      ${n} input[type="number"] {
        -moz-appearance: textfield;
      }

      ${n} input[type="search"] {
        -webkit-appearance: textfield;
        outline-offset: -2px;
      }

      ${n} input[type="search"]::-webkit-search-decoration {
        -webkit-appearance: none !important;
      }

      ${n} ::-webkit-file-upload-button {
        -webkit-appearance: button;
        font: inherit;
      }

      ${n} details {
        display: block;
      }

      ${n} summary {
        display: list-item;
      }

      template {
        display: none;
      }

      [hidden] {
        display: none !important;
      }

      ${n} :where(
          blockquote,
          dl,
          dd,
          h1,
          h2,
          h3,
          h4,
          h5,
          h6,
          hr,
          figure,
          p,
          pre
        ) {
        margin: 0;
      }

      ${n} button {
        background: transparent;
        padding: 0;
      }

      ${n} fieldset {
        margin: 0;
        padding: 0;
      }

      ${n} :where(ol, ul) {
        margin: 0;
        padding: 0;
      }

      ${n} textarea {
        resize: vertical;
      }

      ${n} :where(button, [role="button"]) {
        cursor: pointer;
      }

      ${n} button::-moz-focus-inner {
        border: 0 !important;
      }

      ${n} table {
        border-collapse: collapse;
      }

      ${n} :where(h1, h2, h3, h4, h5, h6) {
        font-size: inherit;
        font-weight: inherit;
      }

      ${n} :where(button, input, optgroup, select, textarea) {
        padding: 0;
        line-height: inherit;
        color: inherit;
      }

      ${n} :where(img, svg, video, canvas, audio, iframe, embed, object) {
        display: block;
      }

      ${n} :where(img, video) {
        max-width: 100%;
        height: auto;
      }

      [data-js-focus-visible]
        :focus:not([data-focus-visible-added]):not(
          [data-focus-visible-disabled]
        ) {
        outline: none;
        box-shadow: none;
      }

      ${n} select::-ms-expand {
        display: none;
      }

      ${gZ}
    `});function kCe(n){const{cssVarsRoot:t,theme:i,children:a}=n,l=L.useMemo(()=>_ve(i),[i]);return C.jsxs(_Ce,{theme:l,children:[C.jsx(NCe,{root:t}),a]})}function NCe({root:n=":host, :root"}){const t=[n,"[data-theme]"].join(",");return C.jsx(mN,{styles:i=>({[t]:i.__cssVars})})}Ki({name:"StylesContext",errorMessage:"useStyles: `styles` is undefined. Seems you forgot to wrap the components in `<StylesProvider />` "});function DCe(){const{colorMode:n}=gN();return C.jsx(mN,{styles:t=>{const i=wQ(t,"styles.global"),a=Yc(i,{theme:t,colorMode:n});return a?BQ(a)(t):void 0}})}const[LCe,xCe]=Ki({strict:!1,name:"PortalManagerContext"});function mF(n){const{children:t,zIndex:i}=n;return C.jsx(LCe,{value:{zIndex:i},children:t})}mF.displayName="PortalManager";const gF=L.createContext({getDocument(){return document},getWindow(){return window}});gF.displayName="EnvironmentContext";function MCe({defer:n}={}){const[,t]=L.useReducer(i=>i+1,0);return yp(()=>{n&&t()},[n]),L.useContext(gF)}function _Z(n){const{children:t,environment:i,disabled:a}=n,l=L.useRef(null),d=L.useMemo(()=>i||{getDocument:()=>{var E;return((E=l.current)==null?void 0:E.ownerDocument)??document},getWindow:()=>{var E;return((E=l.current)==null?void 0:E.ownerDocument.defaultView)??window}},[i]),p=!a||!i;return C.jsxs(gF.Provider,{value:d,children:[t,p&&C.jsx("span",{id:"__chakra_env",hidden:!0,ref:l})]})}_Z.displayName="EnvironmentProvider";const UCe=n=>{const{children:t,colorModeManager:i,portalZIndex:a,resetScope:l,resetCSS:d=!0,theme:p={},environment:E,cssVarsRoot:v,disableEnvironment:b,disableGlobalStyle:w}=n,A=C.jsx(_Z,{environment:E,disabled:b,children:t});return C.jsx(kCe,{theme:p,cssVarsRoot:v,children:C.jsxs(pZ,{colorModeManager:i,options:p.config,children:[d?C.jsx(OCe,{scope:l}):C.jsx(PCe,{}),!w&&C.jsx(DCe,{}),a?C.jsx(mF,{zIndex:a,children:A}):A]})})},_F=L.createContext({});function EF(n){const t=L.useRef(null);return t.current===null&&(t.current=n()),t.current}const zR=L.createContext(null),yF=L.createContext({transformPagePoint:n=>n,isStatic:!1,reducedMotion:"never"});class VCe extends L.Component{getSnapshotBeforeUpdate(t){const i=this.props.childRef.current;if(i&&t.isPresent&&!this.props.isPresent){const a=this.props.sizeRef.current;a.height=i.offsetHeight||0,a.width=i.offsetWidth||0,a.top=i.offsetTop,a.left=i.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function FCe({children:n,isPresent:t}){const i=L.useId(),a=L.useRef(null),l=L.useRef({width:0,height:0,top:0,left:0}),{nonce:d}=L.useContext(yF);return L.useInsertionEffect(()=>{const{width:p,height:E,top:v,left:b}=l.current;if(t||!a.current||!p||!E)return;a.current.dataset.motionPopId=i;const w=document.createElement("style");return d&&(w.nonce=d),document.head.appendChild(w),w.sheet&&w.sheet.insertRule(`
          [data-motion-pop-id="${i}"] {
            position: absolute !important;
            width: ${p}px !important;
            height: ${E}px !important;
            top: ${v}px !important;
            left: ${b}px !important;
          }
        `),()=>{document.head.removeChild(w)}},[t]),C.jsx(VCe,{isPresent:t,childRef:a,sizeRef:l,children:L.cloneElement(n,{ref:a})})}const jCe=({children:n,initial:t,isPresent:i,onExitComplete:a,custom:l,presenceAffectsLayout:d,mode:p})=>{const E=EF(BCe),v=L.useId(),b=L.useCallback(A=>{E.set(A,!0);for(const N of E.values())if(!N)return;a&&a()},[E,a]),w=L.useMemo(()=>({id:v,initial:t,isPresent:i,custom:l,onExitComplete:b,register:A=>(E.set(A,!1),()=>E.delete(A))}),d?[Math.random(),b]:[i,b]);return L.useMemo(()=>{E.forEach((A,N)=>E.set(N,!1))},[i]),L.useEffect(()=>{!i&&!E.size&&a&&a()},[i]),p==="popLayout"&&(n=C.jsx(FCe,{isPresent:i,children:n})),C.jsx(zR.Provider,{value:w,children:n})};function BCe(){return new Map}function vF(n=!0){const t=L.useContext(zR);if(t===null)return[!0,null];const{isPresent:i,onExitComplete:a,register:l}=t,d=L.useId();L.useEffect(()=>{n&&l(d)},[n]);const p=L.useCallback(()=>n&&a&&a(d),[d,a,n]);return!i&&a?[!1,p]:[!0]}function WCe(){return zCe(L.useContext(zR))}function zCe(n){return n===null?!0:n.isPresent}const cO=n=>n.key||"";function OK(n){const t=[];return L.Children.forEach(n,i=>{L.isValidElement(i)&&t.push(i)}),t}const SF=typeof window<"u",EZ=SF?L.useLayoutEffect:L.useEffect,R0=({children:n,custom:t,initial:i=!0,onExitComplete:a,presenceAffectsLayout:l=!0,mode:d="sync",propagate:p=!1})=>{const[E,v]=vF(p),b=L.useMemo(()=>OK(n),[n]),w=p&&!E?[]:b.map(cO),A=L.useRef(!0),N=L.useRef(b),F=EF(()=>new Map),[j,B]=L.useState(b),[H,ee]=L.useState(b);EZ(()=>{A.current=!1,N.current=b;for(let le=0;le<H.length;le++){const oe=cO(H[le]);w.includes(oe)?F.delete(oe):F.get(oe)!==!0&&F.set(oe,!1)}},[H,w.length,w.join("-")]);const K=[];if(b!==j){let le=[...b];for(let oe=0;oe<H.length;oe++){const ge=H[oe],Z=cO(ge);w.includes(Z)||(le.splice(oe,0,ge),K.push(ge))}d==="wait"&&K.length&&(le=K),ee(OK(le)),B(b);return}const{forceRender:te}=L.useContext(_F);return C.jsx(C.Fragment,{children:H.map(le=>{const oe=cO(le),ge=p&&!E?!1:b===H||w.includes(oe),Z=()=>{if(F.has(oe))F.set(oe,!0);else return;let Q=!0;F.forEach(ne=>{ne||(Q=!1)}),Q&&(te==null||te(),ee(N.current),p&&(v==null||v()),a&&a())};return C.jsx(jCe,{isPresent:ge,initial:!A.current||i?void 0:!1,custom:ge?void 0:t,presenceAffectsLayout:l,mode:d,onExitComplete:ge?void 0:Z,children:le},oe)})})},kl=n=>n;let yZ=kl;function bF(n){let t;return()=>(t===void 0&&(t=n()),t)}const n0=(n,t,i)=>{const a=t-n;return a===0?1:(i-n)/a},Sp=n=>n*1e3,bp=n=>n/1e3,GCe={useManualTiming:!1};function HCe(n){let t=new Set,i=new Set,a=!1,l=!1;const d=new WeakSet;let p={delta:0,timestamp:0,isProcessing:!1};function E(b){d.has(b)&&(v.schedule(b),n()),b(p)}const v={schedule:(b,w=!1,A=!1)=>{const F=A&&a?t:i;return w&&d.add(b),F.has(b)||F.add(b),b},cancel:b=>{i.delete(b),d.delete(b)},process:b=>{if(p=b,a){l=!0;return}a=!0,[t,i]=[i,t],t.forEach(E),t.clear(),a=!1,l&&(l=!1,v.process(b))}};return v}const lO=["read","resolveKeyframes","update","preRender","render","postRender"],$Ce=40;function vZ(n,t){let i=!1,a=!0;const l={delta:0,timestamp:0,isProcessing:!1},d=()=>i=!0,p=lO.reduce((ee,K)=>(ee[K]=HCe(d),ee),{}),{read:E,resolveKeyframes:v,update:b,preRender:w,render:A,postRender:N}=p,F=()=>{const ee=performance.now();i=!1,l.delta=a?1e3/60:Math.max(Math.min(ee-l.timestamp,$Ce),1),l.timestamp=ee,l.isProcessing=!0,E.process(l),v.process(l),b.process(l),w.process(l),A.process(l),N.process(l),l.isProcessing=!1,i&&t&&(a=!1,n(F))},j=()=>{i=!0,a=!0,l.isProcessing||n(F)};return{schedule:lO.reduce((ee,K)=>{const te=p[K];return ee[K]=(le,oe=!1,ge=!1)=>(i||j(),te.schedule(le,oe,ge)),ee},{}),cancel:ee=>{for(let K=0;K<lO.length;K++)p[lO[K]].cancel(ee)},state:l,steps:p}}const{schedule:$i,cancel:gg,state:Qs,steps:m2}=vZ(typeof requestAnimationFrame<"u"?requestAnimationFrame:kl,!0),SZ=L.createContext({strict:!1}),kK={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},r0={};for(const n in kK)r0[n]={isEnabled:t=>kK[n].some(i=>!!t[i])};function KCe(n){for(const t in n)r0[t]={...r0[t],...n[t]}}const qCe=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function Ek(n){return n.startsWith("while")||n.startsWith("drag")&&n!=="draggable"||n.startsWith("layout")||n.startsWith("onTap")||n.startsWith("onPan")||n.startsWith("onLayout")||qCe.has(n)}let bZ=n=>!Ek(n);function YCe(n){n&&(bZ=t=>t.startsWith("on")?!Ek(t):n(t))}try{YCe(require("@emotion/is-prop-valid").default)}catch{}function XCe(n,t,i){const a={};for(const l in n)l==="values"&&typeof n.values=="object"||(bZ(l)||i===!0&&Ek(l)||!t&&!Ek(l)||n.draggable&&l.startsWith("onDrag"))&&(a[l]=n[l]);return a}function JCe(n){if(typeof Proxy>"u")return n;const t=new Map,i=(...a)=>n(...a);return new Proxy(i,{get:(a,l)=>l==="create"?n:(t.has(l)||t.set(l,n(l)),t.get(l))})}const _N=L.createContext({});function fR(n){return typeof n=="string"||Array.isArray(n)}function EN(n){return n!==null&&typeof n=="object"&&typeof n.start=="function"}const TF=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],wF=["initial",...TF];function yN(n){return EN(n.animate)||wF.some(t=>fR(n[t]))}function TZ(n){return!!(yN(n)||n.variants)}function QCe(n,t){if(yN(n)){const{initial:i,animate:a}=n;return{initial:i===!1||fR(i)?i:void 0,animate:fR(a)?a:void 0}}return n.inherit!==!1?t:{}}function ZCe(n){const{initial:t,animate:i}=QCe(n,L.useContext(_N));return L.useMemo(()=>({initial:t,animate:i}),[NK(t),NK(i)])}function NK(n){return Array.isArray(n)?n.join(" "):n}const eIe=Symbol.for("motionComponentSymbol");function AS(n){return n&&typeof n=="object"&&Object.prototype.hasOwnProperty.call(n,"current")}function tIe(n,t,i){return L.useCallback(a=>{a&&n.onMount&&n.onMount(a),t&&(a?t.mount(a):t.unmount()),i&&(typeof i=="function"?i(a):AS(i)&&(i.current=a))},[t])}const RF=n=>n.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),nIe="framerAppearId",wZ="data-"+RF(nIe),{schedule:CF}=vZ(queueMicrotask,!1),RZ=L.createContext({});function rIe(n,t,i,a,l){var d,p;const{visualElement:E}=L.useContext(_N),v=L.useContext(SZ),b=L.useContext(zR),w=L.useContext(yF).reducedMotion,A=L.useRef(null);a=a||v.renderer,!A.current&&a&&(A.current=a(n,{visualState:t,parent:E,props:i,presenceContext:b,blockInitialAnimation:b?b.initial===!1:!1,reducedMotionConfig:w}));const N=A.current,F=L.useContext(RZ);N&&!N.projection&&l&&(N.type==="html"||N.type==="svg")&&iIe(A.current,i,l,F);const j=L.useRef(!1);L.useInsertionEffect(()=>{N&&j.current&&N.update(i,b)});const B=i[wZ],H=L.useRef(!!B&&!(!((d=window.MotionHandoffIsComplete)===null||d===void 0)&&d.call(window,B))&&((p=window.MotionHasOptimisedAnimation)===null||p===void 0?void 0:p.call(window,B)));return EZ(()=>{N&&(j.current=!0,window.MotionIsMounted=!0,N.updateFeatures(),CF.render(N.render),H.current&&N.animationState&&N.animationState.animateChanges())}),L.useEffect(()=>{N&&(!H.current&&N.animationState&&N.animationState.animateChanges(),H.current&&(queueMicrotask(()=>{var ee;(ee=window.MotionHandoffMarkAsComplete)===null||ee===void 0||ee.call(window,B)}),H.current=!1))}),N}function iIe(n,t,i,a){const{layoutId:l,layout:d,drag:p,dragConstraints:E,layoutScroll:v,layoutRoot:b}=t;n.projection=new i(n.latestValues,t["data-framer-portal-id"]?void 0:CZ(n.parent)),n.projection.setOptions({layoutId:l,layout:d,alwaysMeasureLayout:!!p||E&&AS(E),visualElement:n,animationType:typeof d=="string"?d:"both",initialPromotionConfig:a,layoutScroll:v,layoutRoot:b})}function CZ(n){if(n)return n.options.allowProjection!==!1?n.projection:CZ(n.parent)}function oIe({preloadedFeatures:n,createVisualElement:t,useRender:i,useVisualState:a,Component:l}){var d,p;n&&KCe(n);function E(b,w){let A;const N={...L.useContext(yF),...b,layoutId:sIe(b)},{isStatic:F}=N,j=ZCe(b),B=a(b,F);if(!F&&SF){aIe();const H=cIe(N);A=H.MeasureLayout,j.visualElement=rIe(l,B,N,t,H.ProjectionNode)}return C.jsxs(_N.Provider,{value:j,children:[A&&j.visualElement?C.jsx(A,{visualElement:j.visualElement,...N}):null,i(l,b,tIe(B,j.visualElement,w),B,F,j.visualElement)]})}E.displayName=`motion.${typeof l=="string"?l:`create(${(p=(d=l.displayName)!==null&&d!==void 0?d:l.name)!==null&&p!==void 0?p:""})`}`;const v=L.forwardRef(E);return v[eIe]=l,v}function sIe({layoutId:n}){const t=L.useContext(_F).id;return t&&n!==void 0?t+"-"+n:n}function aIe(n,t){L.useContext(SZ).strict}function cIe(n){const{drag:t,layout:i}=r0;if(!t&&!i)return{};const a={...t,...i};return{MeasureLayout:t!=null&&t.isEnabled(n)||i!=null&&i.isEnabled(n)?a.MeasureLayout:void 0,ProjectionNode:a.ProjectionNode}}const lIe=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function IF(n){return typeof n!="string"||n.includes("-")?!1:!!(lIe.indexOf(n)>-1||/[A-Z]/u.test(n))}function DK(n){const t=[{},{}];return n==null||n.values.forEach((i,a)=>{t[0][a]=i.get(),t[1][a]=i.getVelocity()}),t}function AF(n,t,i,a){if(typeof t=="function"){const[l,d]=DK(a);t=t(i!==void 0?i:n.custom,l,d)}if(typeof t=="string"&&(t=n.variants&&n.variants[t]),typeof t=="function"){const[l,d]=DK(a);t=t(i!==void 0?i:n.custom,l,d)}return t}const AU=n=>Array.isArray(n),uIe=n=>!!(n&&typeof n=="object"&&n.mix&&n.toValue),dIe=n=>AU(n)?n[n.length-1]||0:n,Da=n=>!!(n&&n.getVelocity);function GO(n){const t=Da(n)?n.get():n;return uIe(t)?t.toValue():t}function hIe({scrapeMotionValuesFromProps:n,createRenderState:t,onUpdate:i},a,l,d){const p={latestValues:fIe(a,l,d,n),renderState:t()};return i&&(p.onMount=E=>i({props:a,current:E,...p}),p.onUpdate=E=>i(E)),p}const IZ=n=>(t,i)=>{const a=L.useContext(_N),l=L.useContext(zR),d=()=>hIe(n,t,a,l);return i?d():EF(d)};function fIe(n,t,i,a){const l={},d=a(n,{});for(const N in d)l[N]=GO(d[N]);let{initial:p,animate:E}=n;const v=yN(n),b=TZ(n);t&&b&&!v&&n.inherit!==!1&&(p===void 0&&(p=t.initial),E===void 0&&(E=t.animate));let w=i?i.initial===!1:!1;w=w||p===!1;const A=w?E:p;if(A&&typeof A!="boolean"&&!EN(A)){const N=Array.isArray(A)?A:[A];for(let F=0;F<N.length;F++){const j=AF(n,N[F]);if(j){const{transitionEnd:B,transition:H,...ee}=j;for(const K in ee){let te=ee[K];if(Array.isArray(te)){const le=w?te.length-1:0;te=te[le]}te!==null&&(l[K]=te)}for(const K in B)l[K]=B[K]}}}return l}const C0=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],FE=new Set(C0),AZ=n=>t=>typeof t=="string"&&t.startsWith(n),PZ=AZ("--"),pIe=AZ("var(--"),PF=n=>pIe(n)?mIe.test(n.split("/*")[0].trim()):!1,mIe=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,OZ=(n,t)=>t&&typeof n=="number"?t.transform(n):n,Ap=(n,t,i)=>i>t?t:i<n?n:i,I0={test:n=>typeof n=="number",parse:parseFloat,transform:n=>n},pR={...I0,transform:n=>Ap(0,1,n)},uO={...I0,default:1},GR=n=>({test:t=>typeof t=="string"&&t.endsWith(n)&&t.split(" ").length===1,parse:parseFloat,transform:t=>`${t}${n}`}),Xm=GR("deg"),$h=GR("%"),Nn=GR("px"),gIe=GR("vh"),_Ie=GR("vw"),LK={...$h,parse:n=>$h.parse(n)/100,transform:n=>$h.transform(n*100)},EIe={borderWidth:Nn,borderTopWidth:Nn,borderRightWidth:Nn,borderBottomWidth:Nn,borderLeftWidth:Nn,borderRadius:Nn,radius:Nn,borderTopLeftRadius:Nn,borderTopRightRadius:Nn,borderBottomRightRadius:Nn,borderBottomLeftRadius:Nn,width:Nn,maxWidth:Nn,height:Nn,maxHeight:Nn,top:Nn,right:Nn,bottom:Nn,left:Nn,padding:Nn,paddingTop:Nn,paddingRight:Nn,paddingBottom:Nn,paddingLeft:Nn,margin:Nn,marginTop:Nn,marginRight:Nn,marginBottom:Nn,marginLeft:Nn,backgroundPositionX:Nn,backgroundPositionY:Nn},yIe={rotate:Xm,rotateX:Xm,rotateY:Xm,rotateZ:Xm,scale:uO,scaleX:uO,scaleY:uO,scaleZ:uO,skew:Xm,skewX:Xm,skewY:Xm,distance:Nn,translateX:Nn,translateY:Nn,translateZ:Nn,x:Nn,y:Nn,z:Nn,perspective:Nn,transformPerspective:Nn,opacity:pR,originX:LK,originY:LK,originZ:Nn},xK={...I0,transform:Math.round},OF={...EIe,...yIe,zIndex:xK,size:Nn,fillOpacity:pR,strokeOpacity:pR,numOctaves:xK},vIe={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},SIe=C0.length;function bIe(n,t,i){let a="",l=!0;for(let d=0;d<SIe;d++){const p=C0[d],E=n[p];if(E===void 0)continue;let v=!0;if(typeof E=="number"?v=E===(p.startsWith("scale")?1:0):v=parseFloat(E)===0,!v||i){const b=OZ(E,OF[p]);if(!v){l=!1;const w=vIe[p]||p;a+=`${w}(${b}) `}i&&(t[p]=b)}}return a=a.trim(),i?a=i(t,l?"":a):l&&(a="none"),a}function kF(n,t,i){const{style:a,vars:l,transformOrigin:d}=n;let p=!1,E=!1;for(const v in t){const b=t[v];if(FE.has(v)){p=!0;continue}else if(PZ(v)){l[v]=b;continue}else{const w=OZ(b,OF[v]);v.startsWith("origin")?(E=!0,d[v]=w):a[v]=w}}if(t.transform||(p||i?a.transform=bIe(t,n.transform,i):a.transform&&(a.transform="none")),E){const{originX:v="50%",originY:b="50%",originZ:w=0}=d;a.transformOrigin=`${v} ${b} ${w}`}}const TIe={offset:"stroke-dashoffset",array:"stroke-dasharray"},wIe={offset:"strokeDashoffset",array:"strokeDasharray"};function RIe(n,t,i=1,a=0,l=!0){n.pathLength=1;const d=l?TIe:wIe;n[d.offset]=Nn.transform(-a);const p=Nn.transform(t),E=Nn.transform(i);n[d.array]=`${p} ${E}`}function MK(n,t,i){return typeof n=="string"?n:Nn.transform(t+i*n)}function CIe(n,t,i){const a=MK(t,n.x,n.width),l=MK(i,n.y,n.height);return`${a} ${l}`}function NF(n,{attrX:t,attrY:i,attrScale:a,originX:l,originY:d,pathLength:p,pathSpacing:E=1,pathOffset:v=0,...b},w,A){if(kF(n,b,A),w){n.style.viewBox&&(n.attrs.viewBox=n.style.viewBox);return}n.attrs=n.style,n.style={};const{attrs:N,style:F,dimensions:j}=n;N.transform&&(j&&(F.transform=N.transform),delete N.transform),j&&(l!==void 0||d!==void 0||F.transform)&&(F.transformOrigin=CIe(j,l!==void 0?l:.5,d!==void 0?d:.5)),t!==void 0&&(N.x=t),i!==void 0&&(N.y=i),a!==void 0&&(N.scale=a),p!==void 0&&RIe(N,p,E,v,!1)}const DF=()=>({style:{},transform:{},transformOrigin:{},vars:{}}),kZ=()=>({...DF(),attrs:{}}),LF=n=>typeof n=="string"&&n.toLowerCase()==="svg";function NZ(n,{style:t,vars:i},a,l){Object.assign(n.style,t,l&&l.getProjectionStyles(a));for(const d in i)n.style.setProperty(d,i[d])}const DZ=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function LZ(n,t,i,a){NZ(n,t,void 0,a);for(const l in t.attrs)n.setAttribute(DZ.has(l)?l:RF(l),t.attrs[l])}const yk={};function IIe(n){Object.assign(yk,n)}function xZ(n,{layout:t,layoutId:i}){return FE.has(n)||n.startsWith("origin")||(t||i!==void 0)&&(!!yk[n]||n==="opacity")}function xF(n,t,i){var a;const{style:l}=n,d={};for(const p in l)(Da(l[p])||t.style&&Da(t.style[p])||xZ(p,n)||((a=i==null?void 0:i.getValue(p))===null||a===void 0?void 0:a.liveStyle)!==void 0)&&(d[p]=l[p]);return d}function MZ(n,t,i){const a=xF(n,t,i);for(const l in n)if(Da(n[l])||Da(t[l])){const d=C0.indexOf(l)!==-1?"attr"+l.charAt(0).toUpperCase()+l.substring(1):l;a[d]=n[l]}return a}function AIe(n,t){try{t.dimensions=typeof n.getBBox=="function"?n.getBBox():n.getBoundingClientRect()}catch{t.dimensions={x:0,y:0,width:0,height:0}}}const UK=["x","y","width","height","cx","cy","r"],PIe={useVisualState:IZ({scrapeMotionValuesFromProps:MZ,createRenderState:kZ,onUpdate:({props:n,prevProps:t,current:i,renderState:a,latestValues:l})=>{if(!i)return;let d=!!n.drag;if(!d){for(const E in l)if(FE.has(E)){d=!0;break}}if(!d)return;let p=!t;if(t)for(let E=0;E<UK.length;E++){const v=UK[E];n[v]!==t[v]&&(p=!0)}p&&$i.read(()=>{AIe(i,a),$i.render(()=>{NF(a,l,LF(i.tagName),n.transformTemplate),LZ(i,a)})})}})},OIe={useVisualState:IZ({scrapeMotionValuesFromProps:xF,createRenderState:DF})};function UZ(n,t,i){for(const a in t)!Da(t[a])&&!xZ(a,i)&&(n[a]=t[a])}function kIe({transformTemplate:n},t){return L.useMemo(()=>{const i=DF();return kF(i,t,n),Object.assign({},i.vars,i.style)},[t])}function NIe(n,t){const i=n.style||{},a={};return UZ(a,i,n),Object.assign(a,kIe(n,t)),a}function DIe(n,t){const i={},a=NIe(n,t);return n.drag&&n.dragListener!==!1&&(i.draggable=!1,a.userSelect=a.WebkitUserSelect=a.WebkitTouchCallout="none",a.touchAction=n.drag===!0?"none":`pan-${n.drag==="x"?"y":"x"}`),n.tabIndex===void 0&&(n.onTap||n.onTapStart||n.whileTap)&&(i.tabIndex=0),i.style=a,i}function LIe(n,t,i,a){const l=L.useMemo(()=>{const d=kZ();return NF(d,t,LF(a),n.transformTemplate),{...d.attrs,style:{...d.style}}},[t]);if(n.style){const d={};UZ(d,n.style,n),l.style={...d,...l.style}}return l}function xIe(n=!1){return(i,a,l,{latestValues:d},p)=>{const v=(IF(i)?LIe:DIe)(a,d,p,i),b=XCe(a,typeof i=="string",n),w=i!==L.Fragment?{...b,...v,ref:l}:{},{children:A}=a,N=L.useMemo(()=>Da(A)?A.get():A,[A]);return L.createElement(i,{...w,children:N})}}function MIe(n,t){return function(a,{forwardMotionProps:l}={forwardMotionProps:!1}){const p={...IF(a)?PIe:OIe,preloadedFeatures:n,useRender:xIe(l),createVisualElement:t,Component:a};return oIe(p)}}function VZ(n,t){if(!Array.isArray(t))return!1;const i=t.length;if(i!==n.length)return!1;for(let a=0;a<i;a++)if(t[a]!==n[a])return!1;return!0}function vN(n,t,i){const a=n.getProps();return AF(a,t,i!==void 0?i:a.custom,n)}const UIe=bF(()=>window.ScrollTimeline!==void 0);class VIe{constructor(t){this.stop=()=>this.runAll("stop"),this.animations=t.filter(Boolean)}get finished(){return Promise.all(this.animations.map(t=>"finished"in t?t.finished:t))}getAll(t){return this.animations[0][t]}setAll(t,i){for(let a=0;a<this.animations.length;a++)this.animations[a][t]=i}attachTimeline(t,i){const a=this.animations.map(l=>{if(UIe()&&l.attachTimeline)return l.attachTimeline(t);if(typeof i=="function")return i(l)});return()=>{a.forEach((l,d)=>{l&&l(),this.animations[d].stop()})}}get time(){return this.getAll("time")}set time(t){this.setAll("time",t)}get speed(){return this.getAll("speed")}set speed(t){this.setAll("speed",t)}get startTime(){return this.getAll("startTime")}get duration(){let t=0;for(let i=0;i<this.animations.length;i++)t=Math.max(t,this.animations[i].duration);return t}runAll(t){this.animations.forEach(i=>i[t]())}flatten(){this.runAll("flatten")}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}class FIe extends VIe{then(t,i){return Promise.all(this.animations).then(t).catch(i)}}function MF(n,t){return n?n[t]||n.default||n:void 0}const PU=2e4;function FZ(n){let t=0;const i=50;let a=n.next(t);for(;!a.done&&t<PU;)t+=i,a=n.next(t);return t>=PU?1/0:t}function UF(n){return typeof n=="function"}function VK(n,t){n.timeline=t,n.onfinish=null}const VF=n=>Array.isArray(n)&&typeof n[0]=="number",jIe={linearEasing:void 0};function BIe(n,t){const i=bF(n);return()=>{var a;return(a=jIe[t])!==null&&a!==void 0?a:i()}}const vk=BIe(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),jZ=(n,t,i=10)=>{let a="";const l=Math.max(Math.round(t/i),2);for(let d=0;d<l;d++)a+=n(n0(0,l-1,d))+", ";return`linear(${a.substring(0,a.length-2)})`};function BZ(n){return!!(typeof n=="function"&&vk()||!n||typeof n=="string"&&(n in OU||vk())||VF(n)||Array.isArray(n)&&n.every(BZ))}const Aw=([n,t,i,a])=>`cubic-bezier(${n}, ${t}, ${i}, ${a})`,OU={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:Aw([0,.65,.55,1]),circOut:Aw([.55,0,1,.45]),backIn:Aw([.31,.01,.66,-.59]),backOut:Aw([.33,1.53,.69,.99])};function WZ(n,t){if(n)return typeof n=="function"&&vk()?jZ(n,t):VF(n)?Aw(n):Array.isArray(n)?n.map(i=>WZ(i,t)||OU.easeOut):OU[n]}const Rd={x:!1,y:!1};function zZ(){return Rd.x||Rd.y}function WIe(n,t,i){var a;if(n instanceof Element)return[n];if(typeof n=="string"){let l=document;const d=(a=void 0)!==null&&a!==void 0?a:l.querySelectorAll(n);return d?Array.from(d):[]}return Array.from(n)}function GZ(n,t){const i=WIe(n),a=new AbortController,l={passive:!0,...t,signal:a.signal};return[i,l,()=>a.abort()]}function FK(n){return t=>{t.pointerType==="touch"||zZ()||n(t)}}function zIe(n,t,i={}){const[a,l,d]=GZ(n,i),p=FK(E=>{const{target:v}=E,b=t(E);if(typeof b!="function"||!v)return;const w=FK(A=>{b(A),v.removeEventListener("pointerleave",w)});v.addEventListener("pointerleave",w,l)});return a.forEach(E=>{E.addEventListener("pointerenter",p,l)}),d}const HZ=(n,t)=>t?n===t?!0:HZ(n,t.parentElement):!1,FF=n=>n.pointerType==="mouse"?typeof n.button!="number"||n.button<=0:n.isPrimary!==!1,GIe=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function HIe(n){return GIe.has(n.tagName)||n.tabIndex!==-1}const Pw=new WeakSet;function jK(n){return t=>{t.key==="Enter"&&n(t)}}function g2(n,t){n.dispatchEvent(new PointerEvent("pointer"+t,{isPrimary:!0,bubbles:!0}))}const $Ie=(n,t)=>{const i=n.currentTarget;if(!i)return;const a=jK(()=>{if(Pw.has(i))return;g2(i,"down");const l=jK(()=>{g2(i,"up")}),d=()=>g2(i,"cancel");i.addEventListener("keyup",l,t),i.addEventListener("blur",d,t)});i.addEventListener("keydown",a,t),i.addEventListener("blur",()=>i.removeEventListener("keydown",a),t)};function BK(n){return FF(n)&&!zZ()}function KIe(n,t,i={}){const[a,l,d]=GZ(n,i),p=E=>{const v=E.currentTarget;if(!BK(E)||Pw.has(v))return;Pw.add(v);const b=t(E),w=(F,j)=>{window.removeEventListener("pointerup",A),window.removeEventListener("pointercancel",N),!(!BK(F)||!Pw.has(v))&&(Pw.delete(v),typeof b=="function"&&b(F,{success:j}))},A=F=>{w(F,i.useGlobalTarget||HZ(v,F.target))},N=F=>{w(F,!1)};window.addEventListener("pointerup",A,l),window.addEventListener("pointercancel",N,l)};return a.forEach(E=>{!HIe(E)&&E.getAttribute("tabindex")===null&&(E.tabIndex=0),(i.useGlobalTarget?window:E).addEventListener("pointerdown",p,l),E.addEventListener("focus",b=>$Ie(b,l),l)}),d}function qIe(n){return n==="x"||n==="y"?Rd[n]?null:(Rd[n]=!0,()=>{Rd[n]=!1}):Rd.x||Rd.y?null:(Rd.x=Rd.y=!0,()=>{Rd.x=Rd.y=!1})}const $Z=new Set(["width","height","top","left","right","bottom",...C0]);let HO;function YIe(){HO=void 0}const Kh={now:()=>(HO===void 0&&Kh.set(Qs.isProcessing||GCe.useManualTiming?Qs.timestamp:performance.now()),HO),set:n=>{HO=n,queueMicrotask(YIe)}};function jF(n,t){n.indexOf(t)===-1&&n.push(t)}function BF(n,t){const i=n.indexOf(t);i>-1&&n.splice(i,1)}class WF{constructor(){this.subscriptions=[]}add(t){return jF(this.subscriptions,t),()=>BF(this.subscriptions,t)}notify(t,i,a){const l=this.subscriptions.length;if(l)if(l===1)this.subscriptions[0](t,i,a);else for(let d=0;d<l;d++){const p=this.subscriptions[d];p&&p(t,i,a)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}function KZ(n,t){return t?n*(1e3/t):0}const WK=30,XIe=n=>!isNaN(parseFloat(n));class JIe{constructor(t,i={}){this.version="11.18.2",this.canTrackVelocity=null,this.events={},this.updateAndNotify=(a,l=!0)=>{const d=Kh.now();this.updatedAt!==d&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(a),this.current!==this.prev&&this.events.change&&this.events.change.notify(this.current),l&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.hasAnimated=!1,this.setCurrent(t),this.owner=i.owner}setCurrent(t){this.current=t,this.updatedAt=Kh.now(),this.canTrackVelocity===null&&t!==void 0&&(this.canTrackVelocity=XIe(this.current))}setPrevFrameValue(t=this.current){this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt}onChange(t){return this.on("change",t)}on(t,i){this.events[t]||(this.events[t]=new WF);const a=this.events[t].add(i);return t==="change"?()=>{a(),$i.read(()=>{this.events.change.getSize()||this.stop()})}:a}clearListeners(){for(const t in this.events)this.events[t].clear()}attach(t,i){this.passiveEffect=t,this.stopPassiveEffect=i}set(t,i=!0){!i||!this.passiveEffect?this.updateAndNotify(t,i):this.passiveEffect(t,this.updateAndNotify)}setWithVelocity(t,i,a){this.set(i),this.prev=void 0,this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt-a}jump(t,i=!0){this.updateAndNotify(t),this.prev=t,this.prevUpdatedAt=this.prevFrameValue=void 0,i&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const t=Kh.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||t-this.updatedAt>WK)return 0;const i=Math.min(this.updatedAt-this.prevUpdatedAt,WK);return KZ(parseFloat(this.current)-parseFloat(this.prevFrameValue),i)}start(t){return this.stop(),new Promise(i=>{this.hasAnimated=!0,this.animation=t(i),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function mR(n,t){return new JIe(n,t)}function QIe(n,t,i){n.hasValue(t)?n.getValue(t).set(i):n.addValue(t,mR(i))}function ZIe(n,t){const i=vN(n,t);let{transitionEnd:a={},transition:l={},...d}=i||{};d={...d,...a};for(const p in d){const E=dIe(d[p]);QIe(n,p,E)}}function eAe(n){return!!(Da(n)&&n.add)}function kU(n,t){const i=n.getValue("willChange");if(eAe(i))return i.add(t)}function qZ(n){return n.props[wZ]}const YZ=(n,t,i)=>(((1-3*i+3*t)*n+(3*i-6*t))*n+3*t)*n,tAe=1e-7,nAe=12;function rAe(n,t,i,a,l){let d,p,E=0;do p=t+(i-t)/2,d=YZ(p,a,l)-n,d>0?i=p:t=p;while(Math.abs(d)>tAe&&++E<nAe);return p}function HR(n,t,i,a){if(n===t&&i===a)return kl;const l=d=>rAe(d,0,1,n,i);return d=>d===0||d===1?d:YZ(l(d),t,a)}const XZ=n=>t=>t<=.5?n(2*t)/2:(2-n(2*(1-t)))/2,JZ=n=>t=>1-n(1-t),QZ=HR(.33,1.53,.69,.99),zF=JZ(QZ),ZZ=XZ(zF),eee=n=>(n*=2)<1?.5*zF(n):.5*(2-Math.pow(2,-10*(n-1))),GF=n=>1-Math.sin(Math.acos(n)),tee=JZ(GF),nee=XZ(GF),ree=n=>/^0[^.\s]+$/u.test(n);function iAe(n){return typeof n=="number"?n===0:n!==null?n==="none"||n==="0"||ree(n):!0}const $w=n=>Math.round(n*1e5)/1e5,HF=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function oAe(n){return n==null}const sAe=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,$F=(n,t)=>i=>!!(typeof i=="string"&&sAe.test(i)&&i.startsWith(n)||t&&!oAe(i)&&Object.prototype.hasOwnProperty.call(i,t)),iee=(n,t,i)=>a=>{if(typeof a!="string")return a;const[l,d,p,E]=a.match(HF);return{[n]:parseFloat(l),[t]:parseFloat(d),[i]:parseFloat(p),alpha:E!==void 0?parseFloat(E):1}},aAe=n=>Ap(0,255,n),_2={...I0,transform:n=>Math.round(aAe(n))},dE={test:$F("rgb","red"),parse:iee("red","green","blue"),transform:({red:n,green:t,blue:i,alpha:a=1})=>"rgba("+_2.transform(n)+", "+_2.transform(t)+", "+_2.transform(i)+", "+$w(pR.transform(a))+")"};function cAe(n){let t="",i="",a="",l="";return n.length>5?(t=n.substring(1,3),i=n.substring(3,5),a=n.substring(5,7),l=n.substring(7,9)):(t=n.substring(1,2),i=n.substring(2,3),a=n.substring(3,4),l=n.substring(4,5),t+=t,i+=i,a+=a,l+=l),{red:parseInt(t,16),green:parseInt(i,16),blue:parseInt(a,16),alpha:l?parseInt(l,16)/255:1}}const NU={test:$F("#"),parse:cAe,transform:dE.transform},PS={test:$F("hsl","hue"),parse:iee("hue","saturation","lightness"),transform:({hue:n,saturation:t,lightness:i,alpha:a=1})=>"hsla("+Math.round(n)+", "+$h.transform($w(t))+", "+$h.transform($w(i))+", "+$w(pR.transform(a))+")"},Pa={test:n=>dE.test(n)||NU.test(n)||PS.test(n),parse:n=>dE.test(n)?dE.parse(n):PS.test(n)?PS.parse(n):NU.parse(n),transform:n=>typeof n=="string"?n:n.hasOwnProperty("red")?dE.transform(n):PS.transform(n)},lAe=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function uAe(n){var t,i;return isNaN(n)&&typeof n=="string"&&(((t=n.match(HF))===null||t===void 0?void 0:t.length)||0)+(((i=n.match(lAe))===null||i===void 0?void 0:i.length)||0)>0}const oee="number",see="color",dAe="var",hAe="var(",zK="${}",fAe=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function gR(n){const t=n.toString(),i=[],a={color:[],number:[],var:[]},l=[];let d=0;const E=t.replace(fAe,v=>(Pa.test(v)?(a.color.push(d),l.push(see),i.push(Pa.parse(v))):v.startsWith(hAe)?(a.var.push(d),l.push(dAe),i.push(v)):(a.number.push(d),l.push(oee),i.push(parseFloat(v))),++d,zK)).split(zK);return{values:i,split:E,indexes:a,types:l}}function aee(n){return gR(n).values}function cee(n){const{split:t,types:i}=gR(n),a=t.length;return l=>{let d="";for(let p=0;p<a;p++)if(d+=t[p],l[p]!==void 0){const E=i[p];E===oee?d+=$w(l[p]):E===see?d+=Pa.transform(l[p]):d+=l[p]}return d}}const pAe=n=>typeof n=="number"?0:n;function mAe(n){const t=aee(n);return cee(n)(t.map(pAe))}const _g={test:uAe,parse:aee,createTransformer:cee,getAnimatableNone:mAe},gAe=new Set(["brightness","contrast","saturate","opacity"]);function _Ae(n){const[t,i]=n.slice(0,-1).split("(");if(t==="drop-shadow")return n;const[a]=i.match(HF)||[];if(!a)return n;const l=i.replace(a,"");let d=gAe.has(t)?1:0;return a!==i&&(d*=100),t+"("+d+l+")"}const EAe=/\b([a-z-]*)\(.*?\)/gu,DU={..._g,getAnimatableNone:n=>{const t=n.match(EAe);return t?t.map(_Ae).join(" "):n}},yAe={...OF,color:Pa,backgroundColor:Pa,outlineColor:Pa,fill:Pa,stroke:Pa,borderColor:Pa,borderTopColor:Pa,borderRightColor:Pa,borderBottomColor:Pa,borderLeftColor:Pa,filter:DU,WebkitFilter:DU},KF=n=>yAe[n];function lee(n,t){let i=KF(n);return i!==DU&&(i=_g),i.getAnimatableNone?i.getAnimatableNone(t):void 0}const vAe=new Set(["auto","none","0"]);function SAe(n,t,i){let a=0,l;for(;a<n.length&&!l;){const d=n[a];typeof d=="string"&&!vAe.has(d)&&gR(d).values.length&&(l=n[a]),a++}if(l&&i)for(const d of t)n[d]=lee(i,l)}const GK=n=>n===I0||n===Nn,HK=(n,t)=>parseFloat(n.split(", ")[t]),$K=(n,t)=>(i,{transform:a})=>{if(a==="none"||!a)return 0;const l=a.match(/^matrix3d\((.+)\)$/u);if(l)return HK(l[1],t);{const d=a.match(/^matrix\((.+)\)$/u);return d?HK(d[1],n):0}},bAe=new Set(["x","y","z"]),TAe=C0.filter(n=>!bAe.has(n));function wAe(n){const t=[];return TAe.forEach(i=>{const a=n.getValue(i);a!==void 0&&(t.push([i,a.get()]),a.set(i.startsWith("scale")?1:0))}),t}const i0={width:({x:n},{paddingLeft:t="0",paddingRight:i="0"})=>n.max-n.min-parseFloat(t)-parseFloat(i),height:({y:n},{paddingTop:t="0",paddingBottom:i="0"})=>n.max-n.min-parseFloat(t)-parseFloat(i),top:(n,{top:t})=>parseFloat(t),left:(n,{left:t})=>parseFloat(t),bottom:({y:n},{top:t})=>parseFloat(t)+(n.max-n.min),right:({x:n},{left:t})=>parseFloat(t)+(n.max-n.min),x:$K(4,13),y:$K(5,14)};i0.translateX=i0.x;i0.translateY=i0.y;const _E=new Set;let LU=!1,xU=!1;function uee(){if(xU){const n=Array.from(_E).filter(a=>a.needsMeasurement),t=new Set(n.map(a=>a.element)),i=new Map;t.forEach(a=>{const l=wAe(a);l.length&&(i.set(a,l),a.render())}),n.forEach(a=>a.measureInitialState()),t.forEach(a=>{a.render();const l=i.get(a);l&&l.forEach(([d,p])=>{var E;(E=a.getValue(d))===null||E===void 0||E.set(p)})}),n.forEach(a=>a.measureEndState()),n.forEach(a=>{a.suspendedScrollY!==void 0&&window.scrollTo(0,a.suspendedScrollY)})}xU=!1,LU=!1,_E.forEach(n=>n.complete()),_E.clear()}function dee(){_E.forEach(n=>{n.readKeyframes(),n.needsMeasurement&&(xU=!0)})}function RAe(){dee(),uee()}class qF{constructor(t,i,a,l,d,p=!1){this.isComplete=!1,this.isAsync=!1,this.needsMeasurement=!1,this.isScheduled=!1,this.unresolvedKeyframes=[...t],this.onComplete=i,this.name=a,this.motionValue=l,this.element=d,this.isAsync=p}scheduleResolve(){this.isScheduled=!0,this.isAsync?(_E.add(this),LU||(LU=!0,$i.read(dee),$i.resolveKeyframes(uee))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:t,name:i,element:a,motionValue:l}=this;for(let d=0;d<t.length;d++)if(t[d]===null)if(d===0){const p=l==null?void 0:l.get(),E=t[t.length-1];if(p!==void 0)t[0]=p;else if(a&&i){const v=a.readValue(i,E);v!=null&&(t[0]=v)}t[0]===void 0&&(t[0]=E),l&&p===void 0&&l.set(t[0])}else t[d]=t[d-1]}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(){this.isComplete=!0,this.onComplete(this.unresolvedKeyframes,this.finalKeyframe),_E.delete(this)}cancel(){this.isComplete||(this.isScheduled=!1,_E.delete(this))}resume(){this.isComplete||this.scheduleResolve()}}const hee=n=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(n),CAe=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function IAe(n){const t=CAe.exec(n);if(!t)return[,];const[,i,a,l]=t;return[`--${i??a}`,l]}function fee(n,t,i=1){const[a,l]=IAe(n);if(!a)return;const d=window.getComputedStyle(t).getPropertyValue(a);if(d){const p=d.trim();return hee(p)?parseFloat(p):p}return PF(l)?fee(l,t,i+1):l}const pee=n=>t=>t.test(n),AAe={test:n=>n==="auto",parse:n=>n},mee=[I0,Nn,$h,Xm,_Ie,gIe,AAe],KK=n=>mee.find(pee(n));class gee extends qF{constructor(t,i,a,l,d){super(t,i,a,l,d,!0)}readKeyframes(){const{unresolvedKeyframes:t,element:i,name:a}=this;if(!i||!i.current)return;super.readKeyframes();for(let v=0;v<t.length;v++){let b=t[v];if(typeof b=="string"&&(b=b.trim(),PF(b))){const w=fee(b,i.current);w!==void 0&&(t[v]=w),v===t.length-1&&(this.finalKeyframe=b)}}if(this.resolveNoneKeyframes(),!$Z.has(a)||t.length!==2)return;const[l,d]=t,p=KK(l),E=KK(d);if(p!==E)if(GK(p)&&GK(E))for(let v=0;v<t.length;v++){const b=t[v];typeof b=="string"&&(t[v]=parseFloat(b))}else this.needsMeasurement=!0}resolveNoneKeyframes(){const{unresolvedKeyframes:t,name:i}=this,a=[];for(let l=0;l<t.length;l++)iAe(t[l])&&a.push(l);a.length&&SAe(t,a,i)}measureInitialState(){const{element:t,unresolvedKeyframes:i,name:a}=this;if(!t||!t.current)return;a==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=i0[a](t.measureViewportBox(),window.getComputedStyle(t.current)),i[0]=this.measuredOrigin;const l=i[i.length-1];l!==void 0&&t.getValue(a,l).jump(l,!1)}measureEndState(){var t;const{element:i,name:a,unresolvedKeyframes:l}=this;if(!i||!i.current)return;const d=i.getValue(a);d&&d.jump(this.measuredOrigin,!1);const p=l.length-1,E=l[p];l[p]=i0[a](i.measureViewportBox(),window.getComputedStyle(i.current)),E!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=E),!((t=this.removedTransforms)===null||t===void 0)&&t.length&&this.removedTransforms.forEach(([v,b])=>{i.getValue(v).set(b)}),this.resolveNoneKeyframes()}}const qK=(n,t)=>t==="zIndex"?!1:!!(typeof n=="number"||Array.isArray(n)||typeof n=="string"&&(_g.test(n)||n==="0")&&!n.startsWith("url("));function PAe(n){const t=n[0];if(n.length===1)return!0;for(let i=0;i<n.length;i++)if(n[i]!==t)return!0}function OAe(n,t,i,a){const l=n[0];if(l===null)return!1;if(t==="display"||t==="visibility")return!0;const d=n[n.length-1],p=qK(l,t),E=qK(d,t);return!p||!E?!1:PAe(n)||(i==="spring"||UF(i))&&a}const kAe=n=>n!==null;function SN(n,{repeat:t,repeatType:i="loop"},a){const l=n.filter(kAe),d=t&&i!=="loop"&&t%2===1?0:l.length-1;return!d||a===void 0?l[d]:a}const NAe=40;class _ee{constructor({autoplay:t=!0,delay:i=0,type:a="keyframes",repeat:l=0,repeatDelay:d=0,repeatType:p="loop",...E}){this.isStopped=!1,this.hasAttemptedResolve=!1,this.createdAt=Kh.now(),this.options={autoplay:t,delay:i,type:a,repeat:l,repeatDelay:d,repeatType:p,...E},this.updateFinishedPromise()}calcStartTime(){return this.resolvedAt?this.resolvedAt-this.createdAt>NAe?this.resolvedAt:this.createdAt:this.createdAt}get resolved(){return!this._resolved&&!this.hasAttemptedResolve&&RAe(),this._resolved}onKeyframesResolved(t,i){this.resolvedAt=Kh.now(),this.hasAttemptedResolve=!0;const{name:a,type:l,velocity:d,delay:p,onComplete:E,onUpdate:v,isGenerator:b}=this.options;if(!b&&!OAe(t,a,l,d))if(p)this.options.duration=0;else{v&&v(SN(t,this.options,i)),E&&E(),this.resolveFinishedPromise();return}const w=this.initPlayback(t,i);w!==!1&&(this._resolved={keyframes:t,finalKeyframe:i,...w},this.onPostResolved())}onPostResolved(){}then(t,i){return this.currentFinishedPromise.then(t,i)}flatten(){this.options.type="keyframes",this.options.ease="linear"}updateFinishedPromise(){this.currentFinishedPromise=new Promise(t=>{this.resolveFinishedPromise=t})}}const co=(n,t,i)=>n+(t-n)*i;function E2(n,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?n+(t-n)*6*i:i<1/2?t:i<2/3?n+(t-n)*(2/3-i)*6:n}function DAe({hue:n,saturation:t,lightness:i,alpha:a}){n/=360,t/=100,i/=100;let l=0,d=0,p=0;if(!t)l=d=p=i;else{const E=i<.5?i*(1+t):i+t-i*t,v=2*i-E;l=E2(v,E,n+1/3),d=E2(v,E,n),p=E2(v,E,n-1/3)}return{red:Math.round(l*255),green:Math.round(d*255),blue:Math.round(p*255),alpha:a}}function Sk(n,t){return i=>i>0?t:n}const y2=(n,t,i)=>{const a=n*n,l=i*(t*t-a)+a;return l<0?0:Math.sqrt(l)},LAe=[NU,dE,PS],xAe=n=>LAe.find(t=>t.test(n));function YK(n){const t=xAe(n);if(!t)return!1;let i=t.parse(n);return t===PS&&(i=DAe(i)),i}const XK=(n,t)=>{const i=YK(n),a=YK(t);if(!i||!a)return Sk(n,t);const l={...i};return d=>(l.red=y2(i.red,a.red,d),l.green=y2(i.green,a.green,d),l.blue=y2(i.blue,a.blue,d),l.alpha=co(i.alpha,a.alpha,d),dE.transform(l))},MAe=(n,t)=>i=>t(n(i)),$R=(...n)=>n.reduce(MAe),MU=new Set(["none","hidden"]);function UAe(n,t){return MU.has(n)?i=>i<=0?n:t:i=>i>=1?t:n}function VAe(n,t){return i=>co(n,t,i)}function YF(n){return typeof n=="number"?VAe:typeof n=="string"?PF(n)?Sk:Pa.test(n)?XK:BAe:Array.isArray(n)?Eee:typeof n=="object"?Pa.test(n)?XK:FAe:Sk}function Eee(n,t){const i=[...n],a=i.length,l=n.map((d,p)=>YF(d)(d,t[p]));return d=>{for(let p=0;p<a;p++)i[p]=l[p](d);return i}}function FAe(n,t){const i={...n,...t},a={};for(const l in i)n[l]!==void 0&&t[l]!==void 0&&(a[l]=YF(n[l])(n[l],t[l]));return l=>{for(const d in a)i[d]=a[d](l);return i}}function jAe(n,t){var i;const a=[],l={color:0,var:0,number:0};for(let d=0;d<t.values.length;d++){const p=t.types[d],E=n.indexes[p][l[p]],v=(i=n.values[E])!==null&&i!==void 0?i:0;a[d]=v,l[p]++}return a}const BAe=(n,t)=>{const i=_g.createTransformer(t),a=gR(n),l=gR(t);return a.indexes.var.length===l.indexes.var.length&&a.indexes.color.length===l.indexes.color.length&&a.indexes.number.length>=l.indexes.number.length?MU.has(n)&&!l.values.length||MU.has(t)&&!a.values.length?UAe(n,t):$R(Eee(jAe(a,l),l.values),i):Sk(n,t)};function yee(n,t,i){return typeof n=="number"&&typeof t=="number"&&typeof i=="number"?co(n,t,i):YF(n)(n,t)}const WAe=5;function vee(n,t,i){const a=Math.max(t-WAe,0);return KZ(i-n(a),t-a)}const Co={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},JK=.001;function zAe({duration:n=Co.duration,bounce:t=Co.bounce,velocity:i=Co.velocity,mass:a=Co.mass}){let l,d,p=1-t;p=Ap(Co.minDamping,Co.maxDamping,p),n=Ap(Co.minDuration,Co.maxDuration,bp(n)),p<1?(l=b=>{const w=b*p,A=w*n,N=w-i,F=UU(b,p),j=Math.exp(-A);return JK-N/F*j},d=b=>{const A=b*p*n,N=A*i+i,F=Math.pow(p,2)*Math.pow(b,2)*n,j=Math.exp(-A),B=UU(Math.pow(b,2),p);return(-l(b)+JK>0?-1:1)*((N-F)*j)/B}):(l=b=>{const w=Math.exp(-b*n),A=(b-i)*n+1;return-.001+w*A},d=b=>{const w=Math.exp(-b*n),A=(i-b)*(n*n);return w*A});const E=5/n,v=HAe(l,d,E);if(n=Sp(n),isNaN(v))return{stiffness:Co.stiffness,damping:Co.damping,duration:n};{const b=Math.pow(v,2)*a;return{stiffness:b,damping:p*2*Math.sqrt(a*b),duration:n}}}const GAe=12;function HAe(n,t,i){let a=i;for(let l=1;l<GAe;l++)a=a-n(a)/t(a);return a}function UU(n,t){return n*Math.sqrt(1-t*t)}const $Ae=["duration","bounce"],KAe=["stiffness","damping","mass"];function QK(n,t){return t.some(i=>n[i]!==void 0)}function qAe(n){let t={velocity:Co.velocity,stiffness:Co.stiffness,damping:Co.damping,mass:Co.mass,isResolvedFromDuration:!1,...n};if(!QK(n,KAe)&&QK(n,$Ae))if(n.visualDuration){const i=n.visualDuration,a=2*Math.PI/(i*1.2),l=a*a,d=2*Ap(.05,1,1-(n.bounce||0))*Math.sqrt(l);t={...t,mass:Co.mass,stiffness:l,damping:d}}else{const i=zAe(n);t={...t,...i,mass:Co.mass},t.isResolvedFromDuration=!0}return t}function See(n=Co.visualDuration,t=Co.bounce){const i=typeof n!="object"?{visualDuration:n,keyframes:[0,1],bounce:t}:n;let{restSpeed:a,restDelta:l}=i;const d=i.keyframes[0],p=i.keyframes[i.keyframes.length-1],E={done:!1,value:d},{stiffness:v,damping:b,mass:w,duration:A,velocity:N,isResolvedFromDuration:F}=qAe({...i,velocity:-bp(i.velocity||0)}),j=N||0,B=b/(2*Math.sqrt(v*w)),H=p-d,ee=bp(Math.sqrt(v/w)),K=Math.abs(H)<5;a||(a=K?Co.restSpeed.granular:Co.restSpeed.default),l||(l=K?Co.restDelta.granular:Co.restDelta.default);let te;if(B<1){const oe=UU(ee,B);te=ge=>{const Z=Math.exp(-B*ee*ge);return p-Z*((j+B*ee*H)/oe*Math.sin(oe*ge)+H*Math.cos(oe*ge))}}else if(B===1)te=oe=>p-Math.exp(-ee*oe)*(H+(j+ee*H)*oe);else{const oe=ee*Math.sqrt(B*B-1);te=ge=>{const Z=Math.exp(-B*ee*ge),Q=Math.min(oe*ge,300);return p-Z*((j+B*ee*H)*Math.sinh(Q)+oe*H*Math.cosh(Q))/oe}}const le={calculatedDuration:F&&A||null,next:oe=>{const ge=te(oe);if(F)E.done=oe>=A;else{let Z=0;B<1&&(Z=oe===0?Sp(j):vee(te,oe,ge));const Q=Math.abs(Z)<=a,ne=Math.abs(p-ge)<=l;E.done=Q&&ne}return E.value=E.done?p:ge,E},toString:()=>{const oe=Math.min(FZ(le),PU),ge=jZ(Z=>le.next(oe*Z).value,oe,30);return oe+"ms "+ge}};return le}function ZK({keyframes:n,velocity:t=0,power:i=.8,timeConstant:a=325,bounceDamping:l=10,bounceStiffness:d=500,modifyTarget:p,min:E,max:v,restDelta:b=.5,restSpeed:w}){const A=n[0],N={done:!1,value:A},F=Q=>E!==void 0&&Q<E||v!==void 0&&Q>v,j=Q=>E===void 0?v:v===void 0||Math.abs(E-Q)<Math.abs(v-Q)?E:v;let B=i*t;const H=A+B,ee=p===void 0?H:p(H);ee!==H&&(B=ee-A);const K=Q=>-B*Math.exp(-Q/a),te=Q=>ee+K(Q),le=Q=>{const ne=K(Q),se=te(Q);N.done=Math.abs(ne)<=b,N.value=N.done?ee:se};let oe,ge;const Z=Q=>{F(N.value)&&(oe=Q,ge=See({keyframes:[N.value,j(N.value)],velocity:vee(te,Q,N.value),damping:l,stiffness:d,restDelta:b,restSpeed:w}))};return Z(0),{calculatedDuration:null,next:Q=>{let ne=!1;return!ge&&oe===void 0&&(ne=!0,le(Q),Z(Q)),oe!==void 0&&Q>=oe?ge.next(Q-oe):(!ne&&le(Q),N)}}}const YAe=HR(.42,0,1,1),XAe=HR(0,0,.58,1),bee=HR(.42,0,.58,1),JAe=n=>Array.isArray(n)&&typeof n[0]!="number",QAe={linear:kl,easeIn:YAe,easeInOut:bee,easeOut:XAe,circIn:GF,circInOut:nee,circOut:tee,backIn:zF,backInOut:ZZ,backOut:QZ,anticipate:eee},eq=n=>{if(VF(n)){yZ(n.length===4);const[t,i,a,l]=n;return HR(t,i,a,l)}else if(typeof n=="string")return QAe[n];return n};function ZAe(n,t,i){const a=[],l=i||yee,d=n.length-1;for(let p=0;p<d;p++){let E=l(n[p],n[p+1]);if(t){const v=Array.isArray(t)?t[p]||kl:t;E=$R(v,E)}a.push(E)}return a}function ePe(n,t,{clamp:i=!0,ease:a,mixer:l}={}){const d=n.length;if(yZ(d===t.length),d===1)return()=>t[0];if(d===2&&t[0]===t[1])return()=>t[1];const p=n[0]===n[1];n[0]>n[d-1]&&(n=[...n].reverse(),t=[...t].reverse());const E=ZAe(t,a,l),v=E.length,b=w=>{if(p&&w<n[0])return t[0];let A=0;if(v>1)for(;A<n.length-2&&!(w<n[A+1]);A++);const N=n0(n[A],n[A+1],w);return E[A](N)};return i?w=>b(Ap(n[0],n[d-1],w)):b}function tPe(n,t){const i=n[n.length-1];for(let a=1;a<=t;a++){const l=n0(0,t,a);n.push(co(i,1,l))}}function nPe(n){const t=[0];return tPe(t,n.length-1),t}function rPe(n,t){return n.map(i=>i*t)}function iPe(n,t){return n.map(()=>t||bee).splice(0,n.length-1)}function bk({duration:n=300,keyframes:t,times:i,ease:a="easeInOut"}){const l=JAe(a)?a.map(eq):eq(a),d={done:!1,value:t[0]},p=rPe(i&&i.length===t.length?i:nPe(t),n),E=ePe(p,t,{ease:Array.isArray(l)?l:iPe(t,l)});return{calculatedDuration:n,next:v=>(d.value=E(v),d.done=v>=n,d)}}const oPe=n=>{const t=({timestamp:i})=>n(i);return{start:()=>$i.update(t,!0),stop:()=>gg(t),now:()=>Qs.isProcessing?Qs.timestamp:Kh.now()}},sPe={decay:ZK,inertia:ZK,tween:bk,keyframes:bk,spring:See},aPe=n=>n/100;class XF extends _ee{constructor(t){super(t),this.holdTime=null,this.cancelTime=null,this.currentTime=0,this.playbackSpeed=1,this.pendingPlayState="running",this.startTime=null,this.state="idle",this.stop=()=>{if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.teardown();const{onStop:v}=this.options;v&&v()};const{name:i,motionValue:a,element:l,keyframes:d}=this.options,p=(l==null?void 0:l.KeyframeResolver)||qF,E=(v,b)=>this.onKeyframesResolved(v,b);this.resolver=new p(d,E,i,a,l),this.resolver.scheduleResolve()}flatten(){super.flatten(),this._resolved&&Object.assign(this._resolved,this.initPlayback(this._resolved.keyframes))}initPlayback(t){const{type:i="keyframes",repeat:a=0,repeatDelay:l=0,repeatType:d,velocity:p=0}=this.options,E=UF(i)?i:sPe[i]||bk;let v,b;E!==bk&&typeof t[0]!="number"&&(v=$R(aPe,yee(t[0],t[1])),t=[0,100]);const w=E({...this.options,keyframes:t});d==="mirror"&&(b=E({...this.options,keyframes:[...t].reverse(),velocity:-p})),w.calculatedDuration===null&&(w.calculatedDuration=FZ(w));const{calculatedDuration:A}=w,N=A+l,F=N*(a+1)-l;return{generator:w,mirroredGenerator:b,mapPercentToKeyframes:v,calculatedDuration:A,resolvedDuration:N,totalDuration:F}}onPostResolved(){const{autoplay:t=!0}=this.options;this.play(),this.pendingPlayState==="paused"||!t?this.pause():this.state=this.pendingPlayState}tick(t,i=!1){const{resolved:a}=this;if(!a){const{keyframes:Q}=this.options;return{done:!0,value:Q[Q.length-1]}}const{finalKeyframe:l,generator:d,mirroredGenerator:p,mapPercentToKeyframes:E,keyframes:v,calculatedDuration:b,totalDuration:w,resolvedDuration:A}=a;if(this.startTime===null)return d.next(0);const{delay:N,repeat:F,repeatType:j,repeatDelay:B,onUpdate:H}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,t):this.speed<0&&(this.startTime=Math.min(t-w/this.speed,this.startTime)),i?this.currentTime=t:this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=Math.round(t-this.startTime)*this.speed;const ee=this.currentTime-N*(this.speed>=0?1:-1),K=this.speed>=0?ee<0:ee>w;this.currentTime=Math.max(ee,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=w);let te=this.currentTime,le=d;if(F){const Q=Math.min(this.currentTime,w)/A;let ne=Math.floor(Q),se=Q%1;!se&&Q>=1&&(se=1),se===1&&ne--,ne=Math.min(ne,F+1),!!(ne%2)&&(j==="reverse"?(se=1-se,B&&(se-=B/A)):j==="mirror"&&(le=p)),te=Ap(0,1,se)*A}const oe=K?{done:!1,value:v[0]}:le.next(te);E&&(oe.value=E(oe.value));let{done:ge}=oe;!K&&b!==null&&(ge=this.speed>=0?this.currentTime>=w:this.currentTime<=0);const Z=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&ge);return Z&&l!==void 0&&(oe.value=SN(v,this.options,l)),H&&H(oe.value),Z&&this.finish(),oe}get duration(){const{resolved:t}=this;return t?bp(t.calculatedDuration):0}get time(){return bp(this.currentTime)}set time(t){t=Sp(t),this.currentTime=t,this.holdTime!==null||this.speed===0?this.holdTime=t:this.driver&&(this.startTime=this.driver.now()-t/this.speed)}get speed(){return this.playbackSpeed}set speed(t){const i=this.playbackSpeed!==t;this.playbackSpeed=t,i&&(this.time=bp(this.currentTime))}play(){if(this.resolver.isScheduled||this.resolver.resume(),!this._resolved){this.pendingPlayState="running";return}if(this.isStopped)return;const{driver:t=oPe,onPlay:i,startTime:a}=this.options;this.driver||(this.driver=t(d=>this.tick(d))),i&&i();const l=this.driver.now();this.holdTime!==null?this.startTime=l-this.holdTime:this.startTime?this.state==="finished"&&(this.startTime=l):this.startTime=a??this.calcStartTime(),this.state==="finished"&&this.updateFinishedPromise(),this.cancelTime=this.startTime,this.holdTime=null,this.state="running",this.driver.start()}pause(){var t;if(!this._resolved){this.pendingPlayState="paused";return}this.state="paused",this.holdTime=(t=this.currentTime)!==null&&t!==void 0?t:0}complete(){this.state!=="running"&&this.play(),this.pendingPlayState=this.state="finished",this.holdTime=null}finish(){this.teardown(),this.state="finished";const{onComplete:t}=this.options;t&&t()}cancel(){this.cancelTime!==null&&this.tick(this.cancelTime),this.teardown(),this.updateFinishedPromise()}teardown(){this.state="idle",this.stopDriver(),this.resolveFinishedPromise(),this.updateFinishedPromise(),this.startTime=this.cancelTime=null,this.resolver.cancel()}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(t){return this.startTime=0,this.tick(t,!0)}}const cPe=new Set(["opacity","clipPath","filter","transform"]);function lPe(n,t,i,{delay:a=0,duration:l=300,repeat:d=0,repeatType:p="loop",ease:E="easeInOut",times:v}={}){const b={[t]:i};v&&(b.offset=v);const w=WZ(E,l);return Array.isArray(w)&&(b.easing=w),n.animate(b,{delay:a,duration:l,easing:Array.isArray(w)?"linear":w,fill:"both",iterations:d+1,direction:p==="reverse"?"alternate":"normal"})}const uPe=bF(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),Tk=10,dPe=2e4;function hPe(n){return UF(n.type)||n.type==="spring"||!BZ(n.ease)}function fPe(n,t){const i=new XF({...t,keyframes:n,repeat:0,delay:0,isGenerator:!0});let a={done:!1,value:n[0]};const l=[];let d=0;for(;!a.done&&d<dPe;)a=i.sample(d),l.push(a.value),d+=Tk;return{times:void 0,keyframes:l,duration:d-Tk,ease:"linear"}}const Tee={anticipate:eee,backInOut:ZZ,circInOut:nee};function pPe(n){return n in Tee}class tq extends _ee{constructor(t){super(t);const{name:i,motionValue:a,element:l,keyframes:d}=this.options;this.resolver=new gee(d,(p,E)=>this.onKeyframesResolved(p,E),i,a,l),this.resolver.scheduleResolve()}initPlayback(t,i){let{duration:a=300,times:l,ease:d,type:p,motionValue:E,name:v,startTime:b}=this.options;if(!E.owner||!E.owner.current)return!1;if(typeof d=="string"&&vk()&&pPe(d)&&(d=Tee[d]),hPe(this.options)){const{onComplete:A,onUpdate:N,motionValue:F,element:j,...B}=this.options,H=fPe(t,B);t=H.keyframes,t.length===1&&(t[1]=t[0]),a=H.duration,l=H.times,d=H.ease,p="keyframes"}const w=lPe(E.owner.current,v,t,{...this.options,duration:a,times:l,ease:d});return w.startTime=b??this.calcStartTime(),this.pendingTimeline?(VK(w,this.pendingTimeline),this.pendingTimeline=void 0):w.onfinish=()=>{const{onComplete:A}=this.options;E.set(SN(t,this.options,i)),A&&A(),this.cancel(),this.resolveFinishedPromise()},{animation:w,duration:a,times:l,type:p,ease:d,keyframes:t}}get duration(){const{resolved:t}=this;if(!t)return 0;const{duration:i}=t;return bp(i)}get time(){const{resolved:t}=this;if(!t)return 0;const{animation:i}=t;return bp(i.currentTime||0)}set time(t){const{resolved:i}=this;if(!i)return;const{animation:a}=i;a.currentTime=Sp(t)}get speed(){const{resolved:t}=this;if(!t)return 1;const{animation:i}=t;return i.playbackRate}set speed(t){const{resolved:i}=this;if(!i)return;const{animation:a}=i;a.playbackRate=t}get state(){const{resolved:t}=this;if(!t)return"idle";const{animation:i}=t;return i.playState}get startTime(){const{resolved:t}=this;if(!t)return null;const{animation:i}=t;return i.startTime}attachTimeline(t){if(!this._resolved)this.pendingTimeline=t;else{const{resolved:i}=this;if(!i)return kl;const{animation:a}=i;VK(a,t)}return kl}play(){if(this.isStopped)return;const{resolved:t}=this;if(!t)return;const{animation:i}=t;i.playState==="finished"&&this.updateFinishedPromise(),i.play()}pause(){const{resolved:t}=this;if(!t)return;const{animation:i}=t;i.pause()}stop(){if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.resolveFinishedPromise(),this.updateFinishedPromise();const{resolved:t}=this;if(!t)return;const{animation:i,keyframes:a,duration:l,type:d,ease:p,times:E}=t;if(i.playState==="idle"||i.playState==="finished")return;if(this.time){const{motionValue:b,onUpdate:w,onComplete:A,element:N,...F}=this.options,j=new XF({...F,keyframes:a,duration:l,type:d,ease:p,times:E,isGenerator:!0}),B=Sp(this.time);b.setWithVelocity(j.sample(B-Tk).value,j.sample(B).value,Tk)}const{onStop:v}=this.options;v&&v(),this.cancel()}complete(){const{resolved:t}=this;t&&t.animation.finish()}cancel(){const{resolved:t}=this;t&&t.animation.cancel()}static supports(t){const{motionValue:i,name:a,repeatDelay:l,repeatType:d,damping:p,type:E}=t;if(!i||!i.owner||!(i.owner.current instanceof HTMLElement))return!1;const{onUpdate:v,transformTemplate:b}=i.owner.getProps();return uPe()&&a&&cPe.has(a)&&!v&&!b&&!l&&d!=="mirror"&&p!==0&&E!=="inertia"}}const mPe={type:"spring",stiffness:500,damping:25,restSpeed:10},gPe=n=>({type:"spring",stiffness:550,damping:n===0?2*Math.sqrt(550):30,restSpeed:10}),_Pe={type:"keyframes",duration:.8},EPe={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},yPe=(n,{keyframes:t})=>t.length>2?_Pe:FE.has(n)?n.startsWith("scale")?gPe(t[1]):mPe:EPe;function vPe({when:n,delay:t,delayChildren:i,staggerChildren:a,staggerDirection:l,repeat:d,repeatType:p,repeatDelay:E,from:v,elapsed:b,...w}){return!!Object.keys(w).length}const JF=(n,t,i,a={},l,d)=>p=>{const E=MF(a,n)||{},v=E.delay||a.delay||0;let{elapsed:b=0}=a;b=b-Sp(v);let w={keyframes:Array.isArray(i)?i:[null,i],ease:"easeOut",velocity:t.getVelocity(),...E,delay:-b,onUpdate:N=>{t.set(N),E.onUpdate&&E.onUpdate(N)},onComplete:()=>{p(),E.onComplete&&E.onComplete()},name:n,motionValue:t,element:d?void 0:l};vPe(E)||(w={...w,...yPe(n,w)}),w.duration&&(w.duration=Sp(w.duration)),w.repeatDelay&&(w.repeatDelay=Sp(w.repeatDelay)),w.from!==void 0&&(w.keyframes[0]=w.from);let A=!1;if((w.type===!1||w.duration===0&&!w.repeatDelay)&&(w.duration=0,w.delay===0&&(A=!0)),A&&!d&&t.get()!==void 0){const N=SN(w.keyframes,E);if(N!==void 0)return $i.update(()=>{w.onUpdate(N),w.onComplete()}),new FIe([])}return!d&&tq.supports(w)?new tq(w):new XF(w)};function SPe({protectedKeys:n,needsAnimating:t},i){const a=n.hasOwnProperty(i)&&t[i]!==!0;return t[i]=!1,a}function wee(n,t,{delay:i=0,transitionOverride:a,type:l}={}){var d;let{transition:p=n.getDefaultTransition(),transitionEnd:E,...v}=t;a&&(p=a);const b=[],w=l&&n.animationState&&n.animationState.getState()[l];for(const A in v){const N=n.getValue(A,(d=n.latestValues[A])!==null&&d!==void 0?d:null),F=v[A];if(F===void 0||w&&SPe(w,A))continue;const j={delay:i,...MF(p||{},A)};let B=!1;if(window.MotionHandoffAnimation){const ee=qZ(n);if(ee){const K=window.MotionHandoffAnimation(ee,A,$i);K!==null&&(j.startTime=K,B=!0)}}kU(n,A),N.start(JF(A,N,F,n.shouldReduceMotion&&$Z.has(A)?{type:!1}:j,n,B));const H=N.animation;H&&b.push(H)}return E&&Promise.all(b).then(()=>{$i.update(()=>{E&&ZIe(n,E)})}),b}function VU(n,t,i={}){var a;const l=vN(n,t,i.type==="exit"?(a=n.presenceContext)===null||a===void 0?void 0:a.custom:void 0);let{transition:d=n.getDefaultTransition()||{}}=l||{};i.transitionOverride&&(d=i.transitionOverride);const p=l?()=>Promise.all(wee(n,l,i)):()=>Promise.resolve(),E=n.variantChildren&&n.variantChildren.size?(b=0)=>{const{delayChildren:w=0,staggerChildren:A,staggerDirection:N}=d;return bPe(n,t,w+b,A,N,i)}:()=>Promise.resolve(),{when:v}=d;if(v){const[b,w]=v==="beforeChildren"?[p,E]:[E,p];return b().then(()=>w())}else return Promise.all([p(),E(i.delay)])}function bPe(n,t,i=0,a=0,l=1,d){const p=[],E=(n.variantChildren.size-1)*a,v=l===1?(b=0)=>b*a:(b=0)=>E-b*a;return Array.from(n.variantChildren).sort(TPe).forEach((b,w)=>{b.notify("AnimationStart",t),p.push(VU(b,t,{...d,delay:i+v(w)}).then(()=>b.notify("AnimationComplete",t)))}),Promise.all(p)}function TPe(n,t){return n.sortNodePosition(t)}function wPe(n,t,i={}){n.notify("AnimationStart",t);let a;if(Array.isArray(t)){const l=t.map(d=>VU(n,d,i));a=Promise.all(l)}else if(typeof t=="string")a=VU(n,t,i);else{const l=typeof t=="function"?vN(n,t,i.custom):t;a=Promise.all(wee(n,l,i))}return a.then(()=>{n.notify("AnimationComplete",t)})}const RPe=wF.length;function Ree(n){if(!n)return;if(!n.isControllingVariants){const i=n.parent?Ree(n.parent)||{}:{};return n.props.initial!==void 0&&(i.initial=n.props.initial),i}const t={};for(let i=0;i<RPe;i++){const a=wF[i],l=n.props[a];(fR(l)||l===!1)&&(t[a]=l)}return t}const CPe=[...TF].reverse(),IPe=TF.length;function APe(n){return t=>Promise.all(t.map(({animation:i,options:a})=>wPe(n,i,a)))}function PPe(n){let t=APe(n),i=nq(),a=!0;const l=v=>(b,w)=>{var A;const N=vN(n,w,v==="exit"?(A=n.presenceContext)===null||A===void 0?void 0:A.custom:void 0);if(N){const{transition:F,transitionEnd:j,...B}=N;b={...b,...B,...j}}return b};function d(v){t=v(n)}function p(v){const{props:b}=n,w=Ree(n.parent)||{},A=[],N=new Set;let F={},j=1/0;for(let H=0;H<IPe;H++){const ee=CPe[H],K=i[ee],te=b[ee]!==void 0?b[ee]:w[ee],le=fR(te),oe=ee===v?K.isActive:null;oe===!1&&(j=H);let ge=te===w[ee]&&te!==b[ee]&&le;if(ge&&a&&n.manuallyAnimateOnMount&&(ge=!1),K.protectedKeys={...F},!K.isActive&&oe===null||!te&&!K.prevProp||EN(te)||typeof te=="boolean")continue;const Z=OPe(K.prevProp,te);let Q=Z||ee===v&&K.isActive&&!ge&&le||H>j&&le,ne=!1;const se=Array.isArray(te)?te:[te];let fe=se.reduce(l(ee),{});oe===!1&&(fe={});const{prevResolvedValues:he={}}=K,ue={...he,...fe},Me=we=>{Q=!0,N.has(we)&&(ne=!0,N.delete(we)),K.needsAnimating[we]=!0;const Ce=n.getValue(we);Ce&&(Ce.liveStyle=!1)};for(const we in ue){const Ce=fe[we],ye=he[we];if(F.hasOwnProperty(we))continue;let Ne=!1;AU(Ce)&&AU(ye)?Ne=!VZ(Ce,ye):Ne=Ce!==ye,Ne?Ce!=null?Me(we):N.add(we):Ce!==void 0&&N.has(we)?Me(we):K.protectedKeys[we]=!0}K.prevProp=te,K.prevResolvedValues=fe,K.isActive&&(F={...F,...fe}),a&&n.blockInitialAnimation&&(Q=!1),Q&&(!(ge&&Z)||ne)&&A.push(...se.map(we=>({animation:we,options:{type:ee}})))}if(N.size){const H={};N.forEach(ee=>{const K=n.getBaseTarget(ee),te=n.getValue(ee);te&&(te.liveStyle=!0),H[ee]=K??null}),A.push({animation:H})}let B=!!A.length;return a&&(b.initial===!1||b.initial===b.animate)&&!n.manuallyAnimateOnMount&&(B=!1),a=!1,B?t(A):Promise.resolve()}function E(v,b){var w;if(i[v].isActive===b)return Promise.resolve();(w=n.variantChildren)===null||w===void 0||w.forEach(N=>{var F;return(F=N.animationState)===null||F===void 0?void 0:F.setActive(v,b)}),i[v].isActive=b;const A=p(v);for(const N in i)i[N].protectedKeys={};return A}return{animateChanges:p,setActive:E,setAnimateFunction:d,getState:()=>i,reset:()=>{i=nq(),a=!0}}}function OPe(n,t){return typeof t=="string"?t!==n:Array.isArray(t)?!VZ(t,n):!1}function eE(n=!1){return{isActive:n,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function nq(){return{animate:eE(!0),whileInView:eE(),whileHover:eE(),whileTap:eE(),whileDrag:eE(),whileFocus:eE(),exit:eE()}}class Cg{constructor(t){this.isMounted=!1,this.node=t}update(){}}class kPe extends Cg{constructor(t){super(t),t.animationState||(t.animationState=PPe(t))}updateAnimationControlsSubscription(){const{animate:t}=this.node.getProps();EN(t)&&(this.unmountControls=t.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:t}=this.node.getProps(),{animate:i}=this.node.prevProps||{};t!==i&&this.updateAnimationControlsSubscription()}unmount(){var t;this.node.animationState.reset(),(t=this.unmountControls)===null||t===void 0||t.call(this)}}let NPe=0;class DPe extends Cg{constructor(){super(...arguments),this.id=NPe++}update(){if(!this.node.presenceContext)return;const{isPresent:t,onExitComplete:i}=this.node.presenceContext,{isPresent:a}=this.node.prevPresenceContext||{};if(!this.node.animationState||t===a)return;const l=this.node.animationState.setActive("exit",!t);i&&!t&&l.then(()=>i(this.id))}mount(){const{register:t}=this.node.presenceContext||{};t&&(this.unmount=t(this.id))}unmount(){}}const LPe={animation:{Feature:kPe},exit:{Feature:DPe}};function _R(n,t,i,a={passive:!0}){return n.addEventListener(t,i,a),()=>n.removeEventListener(t,i)}function KR(n){return{point:{x:n.pageX,y:n.pageY}}}const xPe=n=>t=>FF(t)&&n(t,KR(t));function Kw(n,t,i,a){return _R(n,t,xPe(i),a)}const rq=(n,t)=>Math.abs(n-t);function MPe(n,t){const i=rq(n.x,t.x),a=rq(n.y,t.y);return Math.sqrt(i**2+a**2)}class Cee{constructor(t,i,{transformPagePoint:a,contextWindow:l,dragSnapToOrigin:d=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const A=S2(this.lastMoveEventInfo,this.history),N=this.startEvent!==null,F=MPe(A.offset,{x:0,y:0})>=3;if(!N&&!F)return;const{point:j}=A,{timestamp:B}=Qs;this.history.push({...j,timestamp:B});const{onStart:H,onMove:ee}=this.handlers;N||(H&&H(this.lastMoveEvent,A),this.startEvent=this.lastMoveEvent),ee&&ee(this.lastMoveEvent,A)},this.handlePointerMove=(A,N)=>{this.lastMoveEvent=A,this.lastMoveEventInfo=v2(N,this.transformPagePoint),$i.update(this.updatePoint,!0)},this.handlePointerUp=(A,N)=>{this.end();const{onEnd:F,onSessionEnd:j,resumeAnimation:B}=this.handlers;if(this.dragSnapToOrigin&&B&&B(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const H=S2(A.type==="pointercancel"?this.lastMoveEventInfo:v2(N,this.transformPagePoint),this.history);this.startEvent&&F&&F(A,H),j&&j(A,H)},!FF(t))return;this.dragSnapToOrigin=d,this.handlers=i,this.transformPagePoint=a,this.contextWindow=l||window;const p=KR(t),E=v2(p,this.transformPagePoint),{point:v}=E,{timestamp:b}=Qs;this.history=[{...v,timestamp:b}];const{onSessionStart:w}=i;w&&w(t,S2(E,this.history)),this.removeListeners=$R(Kw(this.contextWindow,"pointermove",this.handlePointerMove),Kw(this.contextWindow,"pointerup",this.handlePointerUp),Kw(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(t){this.handlers=t}end(){this.removeListeners&&this.removeListeners(),gg(this.updatePoint)}}function v2(n,t){return t?{point:t(n.point)}:n}function iq(n,t){return{x:n.x-t.x,y:n.y-t.y}}function S2({point:n},t){return{point:n,delta:iq(n,Iee(t)),offset:iq(n,UPe(t)),velocity:VPe(t,.1)}}function UPe(n){return n[0]}function Iee(n){return n[n.length-1]}function VPe(n,t){if(n.length<2)return{x:0,y:0};let i=n.length-1,a=null;const l=Iee(n);for(;i>=0&&(a=n[i],!(l.timestamp-a.timestamp>Sp(t)));)i--;if(!a)return{x:0,y:0};const d=bp(l.timestamp-a.timestamp);if(d===0)return{x:0,y:0};const p={x:(l.x-a.x)/d,y:(l.y-a.y)/d};return p.x===1/0&&(p.x=0),p.y===1/0&&(p.y=0),p}const Aee=1e-4,FPe=1-Aee,jPe=1+Aee,Pee=.01,BPe=0-Pee,WPe=0+Pee;function Nl(n){return n.max-n.min}function zPe(n,t,i){return Math.abs(n-t)<=i}function oq(n,t,i,a=.5){n.origin=a,n.originPoint=co(t.min,t.max,n.origin),n.scale=Nl(i)/Nl(t),n.translate=co(i.min,i.max,n.origin)-n.originPoint,(n.scale>=FPe&&n.scale<=jPe||isNaN(n.scale))&&(n.scale=1),(n.translate>=BPe&&n.translate<=WPe||isNaN(n.translate))&&(n.translate=0)}function qw(n,t,i,a){oq(n.x,t.x,i.x,a?a.originX:void 0),oq(n.y,t.y,i.y,a?a.originY:void 0)}function sq(n,t,i){n.min=i.min+t.min,n.max=n.min+Nl(t)}function GPe(n,t,i){sq(n.x,t.x,i.x),sq(n.y,t.y,i.y)}function aq(n,t,i){n.min=t.min-i.min,n.max=n.min+Nl(t)}function Yw(n,t,i){aq(n.x,t.x,i.x),aq(n.y,t.y,i.y)}function HPe(n,{min:t,max:i},a){return t!==void 0&&n<t?n=a?co(t,n,a.min):Math.max(n,t):i!==void 0&&n>i&&(n=a?co(i,n,a.max):Math.min(n,i)),n}function cq(n,t,i){return{min:t!==void 0?n.min+t:void 0,max:i!==void 0?n.max+i-(n.max-n.min):void 0}}function $Pe(n,{top:t,left:i,bottom:a,right:l}){return{x:cq(n.x,i,l),y:cq(n.y,t,a)}}function lq(n,t){let i=t.min-n.min,a=t.max-n.max;return t.max-t.min<n.max-n.min&&([i,a]=[a,i]),{min:i,max:a}}function KPe(n,t){return{x:lq(n.x,t.x),y:lq(n.y,t.y)}}function qPe(n,t){let i=.5;const a=Nl(n),l=Nl(t);return l>a?i=n0(t.min,t.max-a,n.min):a>l&&(i=n0(n.min,n.max-l,t.min)),Ap(0,1,i)}function YPe(n,t){const i={};return t.min!==void 0&&(i.min=t.min-n.min),t.max!==void 0&&(i.max=t.max-n.min),i}const FU=.35;function XPe(n=FU){return n===!1?n=0:n===!0&&(n=FU),{x:uq(n,"left","right"),y:uq(n,"top","bottom")}}function uq(n,t,i){return{min:dq(n,t),max:dq(n,i)}}function dq(n,t){return typeof n=="number"?n:n[t]||0}const hq=()=>({translate:0,scale:1,origin:0,originPoint:0}),OS=()=>({x:hq(),y:hq()}),fq=()=>({min:0,max:0}),xo=()=>({x:fq(),y:fq()});function Tu(n){return[n("x"),n("y")]}function Oee({top:n,left:t,right:i,bottom:a}){return{x:{min:t,max:i},y:{min:n,max:a}}}function JPe({x:n,y:t}){return{top:t.min,right:n.max,bottom:t.max,left:n.min}}function QPe(n,t){if(!t)return n;const i=t({x:n.left,y:n.top}),a=t({x:n.right,y:n.bottom});return{top:i.y,left:i.x,bottom:a.y,right:a.x}}function b2(n){return n===void 0||n===1}function jU({scale:n,scaleX:t,scaleY:i}){return!b2(n)||!b2(t)||!b2(i)}function nE(n){return jU(n)||kee(n)||n.z||n.rotate||n.rotateX||n.rotateY||n.skewX||n.skewY}function kee(n){return pq(n.x)||pq(n.y)}function pq(n){return n&&n!=="0%"}function wk(n,t,i){const a=n-i,l=t*a;return i+l}function mq(n,t,i,a,l){return l!==void 0&&(n=wk(n,l,a)),wk(n,i,a)+t}function BU(n,t=0,i=1,a,l){n.min=mq(n.min,t,i,a,l),n.max=mq(n.max,t,i,a,l)}function Nee(n,{x:t,y:i}){BU(n.x,t.translate,t.scale,t.originPoint),BU(n.y,i.translate,i.scale,i.originPoint)}const gq=.999999999999,_q=1.0000000000001;function ZPe(n,t,i,a=!1){const l=i.length;if(!l)return;t.x=t.y=1;let d,p;for(let E=0;E<l;E++){d=i[E],p=d.projectionDelta;const{visualElement:v}=d.options;v&&v.props.style&&v.props.style.display==="contents"||(a&&d.options.layoutScroll&&d.scroll&&d!==d.root&&NS(n,{x:-d.scroll.offset.x,y:-d.scroll.offset.y}),p&&(t.x*=p.x.scale,t.y*=p.y.scale,Nee(n,p)),a&&nE(d.latestValues)&&NS(n,d.latestValues))}t.x<_q&&t.x>gq&&(t.x=1),t.y<_q&&t.y>gq&&(t.y=1)}function kS(n,t){n.min=n.min+t,n.max=n.max+t}function Eq(n,t,i,a,l=.5){const d=co(n.min,n.max,l);BU(n,t,i,d,a)}function NS(n,t){Eq(n.x,t.x,t.scaleX,t.scale,t.originX),Eq(n.y,t.y,t.scaleY,t.scale,t.originY)}function Dee(n,t){return Oee(QPe(n.getBoundingClientRect(),t))}function eOe(n,t,i){const a=Dee(n,i),{scroll:l}=t;return l&&(kS(a.x,l.offset.x),kS(a.y,l.offset.y)),a}const Lee=({current:n})=>n?n.ownerDocument.defaultView:null,tOe=new WeakMap;class nOe{constructor(t){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=xo(),this.visualElement=t}start(t,{snapToCursor:i=!1}={}){const{presenceContext:a}=this.visualElement;if(a&&a.isPresent===!1)return;const l=w=>{const{dragSnapToOrigin:A}=this.getProps();A?this.pauseAnimation():this.stopAnimation(),i&&this.snapToCursor(KR(w).point)},d=(w,A)=>{const{drag:N,dragPropagation:F,onDragStart:j}=this.getProps();if(N&&!F&&(this.openDragLock&&this.openDragLock(),this.openDragLock=qIe(N),!this.openDragLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Tu(H=>{let ee=this.getAxisMotionValue(H).get()||0;if($h.test(ee)){const{projection:K}=this.visualElement;if(K&&K.layout){const te=K.layout.layoutBox[H];te&&(ee=Nl(te)*(parseFloat(ee)/100))}}this.originPoint[H]=ee}),j&&$i.postRender(()=>j(w,A)),kU(this.visualElement,"transform");const{animationState:B}=this.visualElement;B&&B.setActive("whileDrag",!0)},p=(w,A)=>{const{dragPropagation:N,dragDirectionLock:F,onDirectionLock:j,onDrag:B}=this.getProps();if(!N&&!this.openDragLock)return;const{offset:H}=A;if(F&&this.currentDirection===null){this.currentDirection=rOe(H),this.currentDirection!==null&&j&&j(this.currentDirection);return}this.updateAxis("x",A.point,H),this.updateAxis("y",A.point,H),this.visualElement.render(),B&&B(w,A)},E=(w,A)=>this.stop(w,A),v=()=>Tu(w=>{var A;return this.getAnimationState(w)==="paused"&&((A=this.getAxisMotionValue(w).animation)===null||A===void 0?void 0:A.play())}),{dragSnapToOrigin:b}=this.getProps();this.panSession=new Cee(t,{onSessionStart:l,onStart:d,onMove:p,onSessionEnd:E,resumeAnimation:v},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:b,contextWindow:Lee(this.visualElement)})}stop(t,i){const a=this.isDragging;if(this.cancel(),!a)return;const{velocity:l}=i;this.startAnimation(l);const{onDragEnd:d}=this.getProps();d&&$i.postRender(()=>d(t,i))}cancel(){this.isDragging=!1;const{projection:t,animationState:i}=this.visualElement;t&&(t.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:a}=this.getProps();!a&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),i&&i.setActive("whileDrag",!1)}updateAxis(t,i,a){const{drag:l}=this.getProps();if(!a||!dO(t,l,this.currentDirection))return;const d=this.getAxisMotionValue(t);let p=this.originPoint[t]+a[t];this.constraints&&this.constraints[t]&&(p=HPe(p,this.constraints[t],this.elastic[t])),d.set(p)}resolveConstraints(){var t;const{dragConstraints:i,dragElastic:a}=this.getProps(),l=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(t=this.visualElement.projection)===null||t===void 0?void 0:t.layout,d=this.constraints;i&&AS(i)?this.constraints||(this.constraints=this.resolveRefConstraints()):i&&l?this.constraints=$Pe(l.layoutBox,i):this.constraints=!1,this.elastic=XPe(a),d!==this.constraints&&l&&this.constraints&&!this.hasMutatedConstraints&&Tu(p=>{this.constraints!==!1&&this.getAxisMotionValue(p)&&(this.constraints[p]=YPe(l.layoutBox[p],this.constraints[p]))})}resolveRefConstraints(){const{dragConstraints:t,onMeasureDragConstraints:i}=this.getProps();if(!t||!AS(t))return!1;const a=t.current,{projection:l}=this.visualElement;if(!l||!l.layout)return!1;const d=eOe(a,l.root,this.visualElement.getTransformPagePoint());let p=KPe(l.layout.layoutBox,d);if(i){const E=i(JPe(p));this.hasMutatedConstraints=!!E,E&&(p=Oee(E))}return p}startAnimation(t){const{drag:i,dragMomentum:a,dragElastic:l,dragTransition:d,dragSnapToOrigin:p,onDragTransitionEnd:E}=this.getProps(),v=this.constraints||{},b=Tu(w=>{if(!dO(w,i,this.currentDirection))return;let A=v&&v[w]||{};p&&(A={min:0,max:0});const N=l?200:1e6,F=l?40:1e7,j={type:"inertia",velocity:a?t[w]:0,bounceStiffness:N,bounceDamping:F,timeConstant:750,restDelta:1,restSpeed:10,...d,...A};return this.startAxisValueAnimation(w,j)});return Promise.all(b).then(E)}startAxisValueAnimation(t,i){const a=this.getAxisMotionValue(t);return kU(this.visualElement,t),a.start(JF(t,a,0,i,this.visualElement,!1))}stopAnimation(){Tu(t=>this.getAxisMotionValue(t).stop())}pauseAnimation(){Tu(t=>{var i;return(i=this.getAxisMotionValue(t).animation)===null||i===void 0?void 0:i.pause()})}getAnimationState(t){var i;return(i=this.getAxisMotionValue(t).animation)===null||i===void 0?void 0:i.state}getAxisMotionValue(t){const i=`_drag${t.toUpperCase()}`,a=this.visualElement.getProps(),l=a[i];return l||this.visualElement.getValue(t,(a.initial?a.initial[t]:void 0)||0)}snapToCursor(t){Tu(i=>{const{drag:a}=this.getProps();if(!dO(i,a,this.currentDirection))return;const{projection:l}=this.visualElement,d=this.getAxisMotionValue(i);if(l&&l.layout){const{min:p,max:E}=l.layout.layoutBox[i];d.set(t[i]-co(p,E,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:t,dragConstraints:i}=this.getProps(),{projection:a}=this.visualElement;if(!AS(i)||!a||!this.constraints)return;this.stopAnimation();const l={x:0,y:0};Tu(p=>{const E=this.getAxisMotionValue(p);if(E&&this.constraints!==!1){const v=E.get();l[p]=qPe({min:v,max:v},this.constraints[p])}});const{transformTemplate:d}=this.visualElement.getProps();this.visualElement.current.style.transform=d?d({},""):"none",a.root&&a.root.updateScroll(),a.updateLayout(),this.resolveConstraints(),Tu(p=>{if(!dO(p,t,null))return;const E=this.getAxisMotionValue(p),{min:v,max:b}=this.constraints[p];E.set(co(v,b,l[p]))})}addListeners(){if(!this.visualElement.current)return;tOe.set(this.visualElement,this);const t=this.visualElement.current,i=Kw(t,"pointerdown",v=>{const{drag:b,dragListener:w=!0}=this.getProps();b&&w&&this.start(v)}),a=()=>{const{dragConstraints:v}=this.getProps();AS(v)&&v.current&&(this.constraints=this.resolveRefConstraints())},{projection:l}=this.visualElement,d=l.addEventListener("measure",a);l&&!l.layout&&(l.root&&l.root.updateScroll(),l.updateLayout()),$i.read(a);const p=_R(window,"resize",()=>this.scalePositionWithinConstraints()),E=l.addEventListener("didUpdate",({delta:v,hasLayoutChanged:b})=>{this.isDragging&&b&&(Tu(w=>{const A=this.getAxisMotionValue(w);A&&(this.originPoint[w]+=v[w].translate,A.set(A.get()+v[w].translate))}),this.visualElement.render())});return()=>{p(),i(),d(),E&&E()}}getProps(){const t=this.visualElement.getProps(),{drag:i=!1,dragDirectionLock:a=!1,dragPropagation:l=!1,dragConstraints:d=!1,dragElastic:p=FU,dragMomentum:E=!0}=t;return{...t,drag:i,dragDirectionLock:a,dragPropagation:l,dragConstraints:d,dragElastic:p,dragMomentum:E}}}function dO(n,t,i){return(t===!0||t===n)&&(i===null||i===n)}function rOe(n,t=10){let i=null;return Math.abs(n.y)>t?i="y":Math.abs(n.x)>t&&(i="x"),i}class iOe extends Cg{constructor(t){super(t),this.removeGroupControls=kl,this.removeListeners=kl,this.controls=new nOe(t)}mount(){const{dragControls:t}=this.node.getProps();t&&(this.removeGroupControls=t.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||kl}unmount(){this.removeGroupControls(),this.removeListeners()}}const yq=n=>(t,i)=>{n&&$i.postRender(()=>n(t,i))};class oOe extends Cg{constructor(){super(...arguments),this.removePointerDownListener=kl}onPointerDown(t){this.session=new Cee(t,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:Lee(this.node)})}createPanHandlers(){const{onPanSessionStart:t,onPanStart:i,onPan:a,onPanEnd:l}=this.node.getProps();return{onSessionStart:yq(t),onStart:yq(i),onMove:a,onEnd:(d,p)=>{delete this.session,l&&$i.postRender(()=>l(d,p))}}}mount(){this.removePointerDownListener=Kw(this.node.current,"pointerdown",t=>this.onPointerDown(t))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const $O={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function vq(n,t){return t.max===t.min?0:n/(t.max-t.min)*100}const ow={correct:(n,t)=>{if(!t.target)return n;if(typeof n=="string")if(Nn.test(n))n=parseFloat(n);else return n;const i=vq(n,t.target.x),a=vq(n,t.target.y);return`${i}% ${a}%`}},sOe={correct:(n,{treeScale:t,projectionDelta:i})=>{const a=n,l=_g.parse(n);if(l.length>5)return a;const d=_g.createTransformer(n),p=typeof l[0]!="number"?1:0,E=i.x.scale*t.x,v=i.y.scale*t.y;l[0+p]/=E,l[1+p]/=v;const b=co(E,v,.5);return typeof l[2+p]=="number"&&(l[2+p]/=b),typeof l[3+p]=="number"&&(l[3+p]/=b),d(l)}};class aOe extends L.Component{componentDidMount(){const{visualElement:t,layoutGroup:i,switchLayoutGroup:a,layoutId:l}=this.props,{projection:d}=t;IIe(cOe),d&&(i.group&&i.group.add(d),a&&a.register&&l&&a.register(d),d.root.didUpdate(),d.addEventListener("animationComplete",()=>{this.safeToRemove()}),d.setOptions({...d.options,onExitComplete:()=>this.safeToRemove()})),$O.hasEverUpdated=!0}getSnapshotBeforeUpdate(t){const{layoutDependency:i,visualElement:a,drag:l,isPresent:d}=this.props,p=a.projection;return p&&(p.isPresent=d,l||t.layoutDependency!==i||i===void 0?p.willUpdate():this.safeToRemove(),t.isPresent!==d&&(d?p.promote():p.relegate()||$i.postRender(()=>{const E=p.getStack();(!E||!E.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:t}=this.props.visualElement;t&&(t.root.didUpdate(),CF.postRender(()=>{!t.currentAnimation&&t.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:t,layoutGroup:i,switchLayoutGroup:a}=this.props,{projection:l}=t;l&&(l.scheduleCheckAfterUnmount(),i&&i.group&&i.group.remove(l),a&&a.deregister&&a.deregister(l))}safeToRemove(){const{safeToRemove:t}=this.props;t&&t()}render(){return null}}function xee(n){const[t,i]=vF(),a=L.useContext(_F);return C.jsx(aOe,{...n,layoutGroup:a,switchLayoutGroup:L.useContext(RZ),isPresent:t,safeToRemove:i})}const cOe={borderRadius:{...ow,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:ow,borderTopRightRadius:ow,borderBottomLeftRadius:ow,borderBottomRightRadius:ow,boxShadow:sOe};function lOe(n,t,i){const a=Da(n)?n:mR(n);return a.start(JF("",a,t,i)),a.animation}function uOe(n){return n instanceof SVGElement&&n.tagName!=="svg"}const dOe=(n,t)=>n.depth-t.depth;class hOe{constructor(){this.children=[],this.isDirty=!1}add(t){jF(this.children,t),this.isDirty=!0}remove(t){BF(this.children,t),this.isDirty=!0}forEach(t){this.isDirty&&this.children.sort(dOe),this.isDirty=!1,this.children.forEach(t)}}function fOe(n,t){const i=Kh.now(),a=({timestamp:l})=>{const d=l-i;d>=t&&(gg(a),n(d-t))};return $i.read(a,!0),()=>gg(a)}const Mee=["TopLeft","TopRight","BottomLeft","BottomRight"],pOe=Mee.length,Sq=n=>typeof n=="string"?parseFloat(n):n,bq=n=>typeof n=="number"||Nn.test(n);function mOe(n,t,i,a,l,d){l?(n.opacity=co(0,i.opacity!==void 0?i.opacity:1,gOe(a)),n.opacityExit=co(t.opacity!==void 0?t.opacity:1,0,_Oe(a))):d&&(n.opacity=co(t.opacity!==void 0?t.opacity:1,i.opacity!==void 0?i.opacity:1,a));for(let p=0;p<pOe;p++){const E=`border${Mee[p]}Radius`;let v=Tq(t,E),b=Tq(i,E);if(v===void 0&&b===void 0)continue;v||(v=0),b||(b=0),v===0||b===0||bq(v)===bq(b)?(n[E]=Math.max(co(Sq(v),Sq(b),a),0),($h.test(b)||$h.test(v))&&(n[E]+="%")):n[E]=b}(t.rotate||i.rotate)&&(n.rotate=co(t.rotate||0,i.rotate||0,a))}function Tq(n,t){return n[t]!==void 0?n[t]:n.borderRadius}const gOe=Uee(0,.5,tee),_Oe=Uee(.5,.95,kl);function Uee(n,t,i){return a=>a<n?0:a>t?1:i(n0(n,t,a))}function wq(n,t){n.min=t.min,n.max=t.max}function vu(n,t){wq(n.x,t.x),wq(n.y,t.y)}function Rq(n,t){n.translate=t.translate,n.scale=t.scale,n.originPoint=t.originPoint,n.origin=t.origin}function Cq(n,t,i,a,l){return n-=t,n=wk(n,1/i,a),l!==void 0&&(n=wk(n,1/l,a)),n}function EOe(n,t=0,i=1,a=.5,l,d=n,p=n){if($h.test(t)&&(t=parseFloat(t),t=co(p.min,p.max,t/100)-p.min),typeof t!="number")return;let E=co(d.min,d.max,a);n===d&&(E-=t),n.min=Cq(n.min,t,i,E,l),n.max=Cq(n.max,t,i,E,l)}function Iq(n,t,[i,a,l],d,p){EOe(n,t[i],t[a],t[l],t.scale,d,p)}const yOe=["x","scaleX","originX"],vOe=["y","scaleY","originY"];function Aq(n,t,i,a){Iq(n.x,t,yOe,i?i.x:void 0,a?a.x:void 0),Iq(n.y,t,vOe,i?i.y:void 0,a?a.y:void 0)}function Pq(n){return n.translate===0&&n.scale===1}function Vee(n){return Pq(n.x)&&Pq(n.y)}function Oq(n,t){return n.min===t.min&&n.max===t.max}function SOe(n,t){return Oq(n.x,t.x)&&Oq(n.y,t.y)}function kq(n,t){return Math.round(n.min)===Math.round(t.min)&&Math.round(n.max)===Math.round(t.max)}function Fee(n,t){return kq(n.x,t.x)&&kq(n.y,t.y)}function Nq(n){return Nl(n.x)/Nl(n.y)}function Dq(n,t){return n.translate===t.translate&&n.scale===t.scale&&n.originPoint===t.originPoint}class bOe{constructor(){this.members=[]}add(t){jF(this.members,t),t.scheduleRender()}remove(t){if(BF(this.members,t),t===this.prevLead&&(this.prevLead=void 0),t===this.lead){const i=this.members[this.members.length-1];i&&this.promote(i)}}relegate(t){const i=this.members.findIndex(l=>t===l);if(i===0)return!1;let a;for(let l=i;l>=0;l--){const d=this.members[l];if(d.isPresent!==!1){a=d;break}}return a?(this.promote(a),!0):!1}promote(t,i){const a=this.lead;if(t!==a&&(this.prevLead=a,this.lead=t,t.show(),a)){a.instance&&a.scheduleRender(),t.scheduleRender(),t.resumeFrom=a,i&&(t.resumeFrom.preserveOpacity=!0),a.snapshot&&(t.snapshot=a.snapshot,t.snapshot.latestValues=a.animationValues||a.latestValues),t.root&&t.root.isUpdating&&(t.isLayoutDirty=!0);const{crossfade:l}=t.options;l===!1&&a.hide()}}exitAnimationComplete(){this.members.forEach(t=>{const{options:i,resumingFrom:a}=t;i.onExitComplete&&i.onExitComplete(),a&&a.options.onExitComplete&&a.options.onExitComplete()})}scheduleRender(){this.members.forEach(t=>{t.instance&&t.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function TOe(n,t,i){let a="";const l=n.x.translate/t.x,d=n.y.translate/t.y,p=(i==null?void 0:i.z)||0;if((l||d||p)&&(a=`translate3d(${l}px, ${d}px, ${p}px) `),(t.x!==1||t.y!==1)&&(a+=`scale(${1/t.x}, ${1/t.y}) `),i){const{transformPerspective:b,rotate:w,rotateX:A,rotateY:N,skewX:F,skewY:j}=i;b&&(a=`perspective(${b}px) ${a}`),w&&(a+=`rotate(${w}deg) `),A&&(a+=`rotateX(${A}deg) `),N&&(a+=`rotateY(${N}deg) `),F&&(a+=`skewX(${F}deg) `),j&&(a+=`skewY(${j}deg) `)}const E=n.x.scale*t.x,v=n.y.scale*t.y;return(E!==1||v!==1)&&(a+=`scale(${E}, ${v})`),a||"none"}const rE={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0},Ow=typeof window<"u"&&window.MotionDebug!==void 0,T2=["","X","Y","Z"],wOe={visibility:"hidden"},Lq=1e3;let ROe=0;function w2(n,t,i,a){const{latestValues:l}=t;l[n]&&(i[n]=l[n],t.setStaticValue(n,0),a&&(a[n]=0))}function jee(n){if(n.hasCheckedOptimisedAppear=!0,n.root===n)return;const{visualElement:t}=n.options;if(!t)return;const i=qZ(t);if(window.MotionHasOptimisedAnimation(i,"transform")){const{layout:l,layoutId:d}=n.options;window.MotionCancelOptimisedAnimation(i,"transform",$i,!(l||d))}const{parent:a}=n;a&&!a.hasCheckedOptimisedAppear&&jee(a)}function Bee({attachResizeListener:n,defaultParent:t,measureScroll:i,checkIsScrollRoot:a,resetTransform:l}){return class{constructor(p={},E=t==null?void 0:t()){this.id=ROe++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,Ow&&(rE.totalNodes=rE.resolvedTargetDeltas=rE.recalculatedProjection=0),this.nodes.forEach(AOe),this.nodes.forEach(DOe),this.nodes.forEach(LOe),this.nodes.forEach(POe),Ow&&window.MotionDebug.record(rE)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=p,this.root=E?E.root||E:this,this.path=E?[...E.path,E]:[],this.parent=E,this.depth=E?E.depth+1:0;for(let v=0;v<this.path.length;v++)this.path[v].shouldResetTransform=!0;this.root===this&&(this.nodes=new hOe)}addEventListener(p,E){return this.eventHandlers.has(p)||this.eventHandlers.set(p,new WF),this.eventHandlers.get(p).add(E)}notifyListeners(p,...E){const v=this.eventHandlers.get(p);v&&v.notify(...E)}hasListeners(p){return this.eventHandlers.has(p)}mount(p,E=this.root.hasTreeAnimated){if(this.instance)return;this.isSVG=uOe(p),this.instance=p;const{layoutId:v,layout:b,visualElement:w}=this.options;if(w&&!w.current&&w.mount(p),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),E&&(b||v)&&(this.isLayoutDirty=!0),n){let A;const N=()=>this.root.updateBlockedByResize=!1;n(p,()=>{this.root.updateBlockedByResize=!0,A&&A(),A=fOe(N,250),$O.hasAnimatedSinceResize&&($O.hasAnimatedSinceResize=!1,this.nodes.forEach(Mq))})}v&&this.root.registerSharedNode(v,this),this.options.animate!==!1&&w&&(v||b)&&this.addEventListener("didUpdate",({delta:A,hasLayoutChanged:N,hasRelativeTargetChanged:F,layout:j})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const B=this.options.transition||w.getDefaultTransition()||FOe,{onLayoutAnimationStart:H,onLayoutAnimationComplete:ee}=w.getProps(),K=!this.targetLayout||!Fee(this.targetLayout,j)||F,te=!N&&F;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||te||N&&(K||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(A,te);const le={...MF(B,"layout"),onPlay:H,onComplete:ee};(w.shouldReduceMotion||this.options.layoutRoot)&&(le.delay=0,le.type=!1),this.startAnimation(le)}else N||Mq(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=j})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const p=this.getStack();p&&p.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,gg(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(xOe),this.animationId++)}getTransformTemplate(){const{visualElement:p}=this.options;return p&&p.getProps().transformTemplate}willUpdate(p=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&jee(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let w=0;w<this.path.length;w++){const A=this.path[w];A.shouldResetTransform=!0,A.updateScroll("snapshot"),A.options.layoutRoot&&A.willUpdate(!1)}const{layoutId:E,layout:v}=this.options;if(E===void 0&&!v)return;const b=this.getTransformTemplate();this.prevTransformTemplateValue=b?b(this.latestValues,""):void 0,this.updateSnapshot(),p&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(xq);return}this.isUpdating||this.nodes.forEach(kOe),this.isUpdating=!1,this.nodes.forEach(NOe),this.nodes.forEach(COe),this.nodes.forEach(IOe),this.clearAllSnapshots();const E=Kh.now();Qs.delta=Ap(0,1e3/60,E-Qs.timestamp),Qs.timestamp=E,Qs.isProcessing=!0,m2.update.process(Qs),m2.preRender.process(Qs),m2.render.process(Qs),Qs.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,CF.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(OOe),this.sharedNodes.forEach(MOe)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,$i.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){$i.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure())}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let v=0;v<this.path.length;v++)this.path[v].updateScroll();const p=this.layout;this.layout=this.measure(!1),this.layoutCorrected=xo(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:E}=this.options;E&&E.notify("LayoutMeasure",this.layout.layoutBox,p?p.layoutBox:void 0)}updateScroll(p="measure"){let E=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===p&&(E=!1),E){const v=a(this.instance);this.scroll={animationId:this.root.animationId,phase:p,isRoot:v,offset:i(this.instance),wasRoot:this.scroll?this.scroll.isRoot:v}}}resetTransform(){if(!l)return;const p=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,E=this.projectionDelta&&!Vee(this.projectionDelta),v=this.getTransformTemplate(),b=v?v(this.latestValues,""):void 0,w=b!==this.prevTransformTemplateValue;p&&(E||nE(this.latestValues)||w)&&(l(this.instance,b),this.shouldResetTransform=!1,this.scheduleRender())}measure(p=!0){const E=this.measurePageBox();let v=this.removeElementScroll(E);return p&&(v=this.removeTransform(v)),jOe(v),{animationId:this.root.animationId,measuredBox:E,layoutBox:v,latestValues:{},source:this.id}}measurePageBox(){var p;const{visualElement:E}=this.options;if(!E)return xo();const v=E.measureViewportBox();if(!(((p=this.scroll)===null||p===void 0?void 0:p.wasRoot)||this.path.some(BOe))){const{scroll:w}=this.root;w&&(kS(v.x,w.offset.x),kS(v.y,w.offset.y))}return v}removeElementScroll(p){var E;const v=xo();if(vu(v,p),!((E=this.scroll)===null||E===void 0)&&E.wasRoot)return v;for(let b=0;b<this.path.length;b++){const w=this.path[b],{scroll:A,options:N}=w;w!==this.root&&A&&N.layoutScroll&&(A.wasRoot&&vu(v,p),kS(v.x,A.offset.x),kS(v.y,A.offset.y))}return v}applyTransform(p,E=!1){const v=xo();vu(v,p);for(let b=0;b<this.path.length;b++){const w=this.path[b];!E&&w.options.layoutScroll&&w.scroll&&w!==w.root&&NS(v,{x:-w.scroll.offset.x,y:-w.scroll.offset.y}),nE(w.latestValues)&&NS(v,w.latestValues)}return nE(this.latestValues)&&NS(v,this.latestValues),v}removeTransform(p){const E=xo();vu(E,p);for(let v=0;v<this.path.length;v++){const b=this.path[v];if(!b.instance||!nE(b.latestValues))continue;jU(b.latestValues)&&b.updateSnapshot();const w=xo(),A=b.measurePageBox();vu(w,A),Aq(E,b.latestValues,b.snapshot?b.snapshot.layoutBox:void 0,w)}return nE(this.latestValues)&&Aq(E,this.latestValues),E}setTargetDelta(p){this.targetDelta=p,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(p){this.options={...this.options,...p,crossfade:p.crossfade!==void 0?p.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Qs.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(p=!1){var E;const v=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=v.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=v.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=v.isSharedProjectionDirty);const b=!!this.resumingFrom||this!==v;if(!(p||b&&this.isSharedProjectionDirty||this.isProjectionDirty||!((E=this.parent)===null||E===void 0)&&E.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:A,layoutId:N}=this.options;if(!(!this.layout||!(A||N))){if(this.resolvedRelativeTargetAt=Qs.timestamp,!this.targetDelta&&!this.relativeTarget){const F=this.getClosestProjectingParent();F&&F.layout&&this.animationProgress!==1?(this.relativeParent=F,this.forceRelativeParentToResolveTarget(),this.relativeTarget=xo(),this.relativeTargetOrigin=xo(),Yw(this.relativeTargetOrigin,this.layout.layoutBox,F.layout.layoutBox),vu(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)){if(this.target||(this.target=xo(),this.targetWithTransforms=xo()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),GPe(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):vu(this.target,this.layout.layoutBox),Nee(this.target,this.targetDelta)):vu(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const F=this.getClosestProjectingParent();F&&!!F.resumingFrom==!!this.resumingFrom&&!F.options.layoutScroll&&F.target&&this.animationProgress!==1?(this.relativeParent=F,this.forceRelativeParentToResolveTarget(),this.relativeTarget=xo(),this.relativeTargetOrigin=xo(),Yw(this.relativeTargetOrigin,this.target,F.target),vu(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}Ow&&rE.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(!(!this.parent||jU(this.parent.latestValues)||kee(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var p;const E=this.getLead(),v=!!this.resumingFrom||this!==E;let b=!0;if((this.isProjectionDirty||!((p=this.parent)===null||p===void 0)&&p.isProjectionDirty)&&(b=!1),v&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(b=!1),this.resolvedRelativeTargetAt===Qs.timestamp&&(b=!1),b)return;const{layout:w,layoutId:A}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(w||A))return;vu(this.layoutCorrected,this.layout.layoutBox);const N=this.treeScale.x,F=this.treeScale.y;ZPe(this.layoutCorrected,this.treeScale,this.path,v),E.layout&&!E.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(E.target=E.layout.layoutBox,E.targetWithTransforms=xo());const{target:j}=E;if(!j){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(Rq(this.prevProjectionDelta.x,this.projectionDelta.x),Rq(this.prevProjectionDelta.y,this.projectionDelta.y)),qw(this.projectionDelta,this.layoutCorrected,j,this.latestValues),(this.treeScale.x!==N||this.treeScale.y!==F||!Dq(this.projectionDelta.x,this.prevProjectionDelta.x)||!Dq(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",j)),Ow&&rE.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(p=!0){var E;if((E=this.options.visualElement)===null||E===void 0||E.scheduleRender(),p){const v=this.getStack();v&&v.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=OS(),this.projectionDelta=OS(),this.projectionDeltaWithTransform=OS()}setAnimationOrigin(p,E=!1){const v=this.snapshot,b=v?v.latestValues:{},w={...this.latestValues},A=OS();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!E;const N=xo(),F=v?v.source:void 0,j=this.layout?this.layout.source:void 0,B=F!==j,H=this.getStack(),ee=!H||H.members.length<=1,K=!!(B&&!ee&&this.options.crossfade===!0&&!this.path.some(VOe));this.animationProgress=0;let te;this.mixTargetDelta=le=>{const oe=le/1e3;Uq(A.x,p.x,oe),Uq(A.y,p.y,oe),this.setTargetDelta(A),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(Yw(N,this.layout.layoutBox,this.relativeParent.layout.layoutBox),UOe(this.relativeTarget,this.relativeTargetOrigin,N,oe),te&&SOe(this.relativeTarget,te)&&(this.isProjectionDirty=!1),te||(te=xo()),vu(te,this.relativeTarget)),B&&(this.animationValues=w,mOe(w,b,this.latestValues,oe,K,ee)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=oe},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(p){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(gg(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=$i.update(()=>{$O.hasAnimatedSinceResize=!0,this.currentAnimation=lOe(0,Lq,{...p,onUpdate:E=>{this.mixTargetDelta(E),p.onUpdate&&p.onUpdate(E)},onComplete:()=>{p.onComplete&&p.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const p=this.getStack();p&&p.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(Lq),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const p=this.getLead();let{targetWithTransforms:E,target:v,layout:b,latestValues:w}=p;if(!(!E||!v||!b)){if(this!==p&&this.layout&&b&&Wee(this.options.animationType,this.layout.layoutBox,b.layoutBox)){v=this.target||xo();const A=Nl(this.layout.layoutBox.x);v.x.min=p.target.x.min,v.x.max=v.x.min+A;const N=Nl(this.layout.layoutBox.y);v.y.min=p.target.y.min,v.y.max=v.y.min+N}vu(E,v),NS(E,w),qw(this.projectionDeltaWithTransform,this.layoutCorrected,E,w)}}registerSharedNode(p,E){this.sharedNodes.has(p)||this.sharedNodes.set(p,new bOe),this.sharedNodes.get(p).add(E);const b=E.options.initialPromotionConfig;E.promote({transition:b?b.transition:void 0,preserveFollowOpacity:b&&b.shouldPreserveFollowOpacity?b.shouldPreserveFollowOpacity(E):void 0})}isLead(){const p=this.getStack();return p?p.lead===this:!0}getLead(){var p;const{layoutId:E}=this.options;return E?((p=this.getStack())===null||p===void 0?void 0:p.lead)||this:this}getPrevLead(){var p;const{layoutId:E}=this.options;return E?(p=this.getStack())===null||p===void 0?void 0:p.prevLead:void 0}getStack(){const{layoutId:p}=this.options;if(p)return this.root.sharedNodes.get(p)}promote({needsReset:p,transition:E,preserveFollowOpacity:v}={}){const b=this.getStack();b&&b.promote(this,v),p&&(this.projectionDelta=void 0,this.needsReset=!0),E&&this.setOptions({transition:E})}relegate(){const p=this.getStack();return p?p.relegate(this):!1}resetSkewAndRotation(){const{visualElement:p}=this.options;if(!p)return;let E=!1;const{latestValues:v}=p;if((v.z||v.rotate||v.rotateX||v.rotateY||v.rotateZ||v.skewX||v.skewY)&&(E=!0),!E)return;const b={};v.z&&w2("z",p,b,this.animationValues);for(let w=0;w<T2.length;w++)w2(`rotate${T2[w]}`,p,b,this.animationValues),w2(`skew${T2[w]}`,p,b,this.animationValues);p.render();for(const w in b)p.setStaticValue(w,b[w]),this.animationValues&&(this.animationValues[w]=b[w]);p.scheduleRender()}getProjectionStyles(p){var E,v;if(!this.instance||this.isSVG)return;if(!this.isVisible)return wOe;const b={visibility:""},w=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,b.opacity="",b.pointerEvents=GO(p==null?void 0:p.pointerEvents)||"",b.transform=w?w(this.latestValues,""):"none",b;const A=this.getLead();if(!this.projectionDelta||!this.layout||!A.target){const B={};return this.options.layoutId&&(B.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,B.pointerEvents=GO(p==null?void 0:p.pointerEvents)||""),this.hasProjected&&!nE(this.latestValues)&&(B.transform=w?w({},""):"none",this.hasProjected=!1),B}const N=A.animationValues||A.latestValues;this.applyTransformsToTarget(),b.transform=TOe(this.projectionDeltaWithTransform,this.treeScale,N),w&&(b.transform=w(N,b.transform));const{x:F,y:j}=this.projectionDelta;b.transformOrigin=`${F.origin*100}% ${j.origin*100}% 0`,A.animationValues?b.opacity=A===this?(v=(E=N.opacity)!==null&&E!==void 0?E:this.latestValues.opacity)!==null&&v!==void 0?v:1:this.preserveOpacity?this.latestValues.opacity:N.opacityExit:b.opacity=A===this?N.opacity!==void 0?N.opacity:"":N.opacityExit!==void 0?N.opacityExit:0;for(const B in yk){if(N[B]===void 0)continue;const{correct:H,applyTo:ee}=yk[B],K=b.transform==="none"?N[B]:H(N[B],A);if(ee){const te=ee.length;for(let le=0;le<te;le++)b[ee[le]]=K}else b[B]=K}return this.options.layoutId&&(b.pointerEvents=A===this?GO(p==null?void 0:p.pointerEvents)||"":"none"),b}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(p=>{var E;return(E=p.currentAnimation)===null||E===void 0?void 0:E.stop()}),this.root.nodes.forEach(xq),this.root.sharedNodes.clear()}}}function COe(n){n.updateLayout()}function IOe(n){var t;const i=((t=n.resumeFrom)===null||t===void 0?void 0:t.snapshot)||n.snapshot;if(n.isLead()&&n.layout&&i&&n.hasListeners("didUpdate")){const{layoutBox:a,measuredBox:l}=n.layout,{animationType:d}=n.options,p=i.source!==n.layout.source;d==="size"?Tu(A=>{const N=p?i.measuredBox[A]:i.layoutBox[A],F=Nl(N);N.min=a[A].min,N.max=N.min+F}):Wee(d,i.layoutBox,a)&&Tu(A=>{const N=p?i.measuredBox[A]:i.layoutBox[A],F=Nl(a[A]);N.max=N.min+F,n.relativeTarget&&!n.currentAnimation&&(n.isProjectionDirty=!0,n.relativeTarget[A].max=n.relativeTarget[A].min+F)});const E=OS();qw(E,a,i.layoutBox);const v=OS();p?qw(v,n.applyTransform(l,!0),i.measuredBox):qw(v,a,i.layoutBox);const b=!Vee(E);let w=!1;if(!n.resumeFrom){const A=n.getClosestProjectingParent();if(A&&!A.resumeFrom){const{snapshot:N,layout:F}=A;if(N&&F){const j=xo();Yw(j,i.layoutBox,N.layoutBox);const B=xo();Yw(B,a,F.layoutBox),Fee(j,B)||(w=!0),A.options.layoutRoot&&(n.relativeTarget=B,n.relativeTargetOrigin=j,n.relativeParent=A)}}}n.notifyListeners("didUpdate",{layout:a,snapshot:i,delta:v,layoutDelta:E,hasLayoutChanged:b,hasRelativeTargetChanged:w})}else if(n.isLead()){const{onExitComplete:a}=n.options;a&&a()}n.options.transition=void 0}function AOe(n){Ow&&rE.totalNodes++,n.parent&&(n.isProjecting()||(n.isProjectionDirty=n.parent.isProjectionDirty),n.isSharedProjectionDirty||(n.isSharedProjectionDirty=!!(n.isProjectionDirty||n.parent.isProjectionDirty||n.parent.isSharedProjectionDirty)),n.isTransformDirty||(n.isTransformDirty=n.parent.isTransformDirty))}function POe(n){n.isProjectionDirty=n.isSharedProjectionDirty=n.isTransformDirty=!1}function OOe(n){n.clearSnapshot()}function xq(n){n.clearMeasurements()}function kOe(n){n.isLayoutDirty=!1}function NOe(n){const{visualElement:t}=n.options;t&&t.getProps().onBeforeLayoutMeasure&&t.notify("BeforeLayoutMeasure"),n.resetTransform()}function Mq(n){n.finishAnimation(),n.targetDelta=n.relativeTarget=n.target=void 0,n.isProjectionDirty=!0}function DOe(n){n.resolveTargetDelta()}function LOe(n){n.calcProjection()}function xOe(n){n.resetSkewAndRotation()}function MOe(n){n.removeLeadSnapshot()}function Uq(n,t,i){n.translate=co(t.translate,0,i),n.scale=co(t.scale,1,i),n.origin=t.origin,n.originPoint=t.originPoint}function Vq(n,t,i,a){n.min=co(t.min,i.min,a),n.max=co(t.max,i.max,a)}function UOe(n,t,i,a){Vq(n.x,t.x,i.x,a),Vq(n.y,t.y,i.y,a)}function VOe(n){return n.animationValues&&n.animationValues.opacityExit!==void 0}const FOe={duration:.45,ease:[.4,0,.1,1]},Fq=n=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(n),jq=Fq("applewebkit/")&&!Fq("chrome/")?Math.round:kl;function Bq(n){n.min=jq(n.min),n.max=jq(n.max)}function jOe(n){Bq(n.x),Bq(n.y)}function Wee(n,t,i){return n==="position"||n==="preserve-aspect"&&!zPe(Nq(t),Nq(i),.2)}function BOe(n){var t;return n!==n.root&&((t=n.scroll)===null||t===void 0?void 0:t.wasRoot)}const WOe=Bee({attachResizeListener:(n,t)=>_R(n,"resize",t),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),R2={current:void 0},zee=Bee({measureScroll:n=>({x:n.scrollLeft,y:n.scrollTop}),defaultParent:()=>{if(!R2.current){const n=new WOe({});n.mount(window),n.setOptions({layoutScroll:!0}),R2.current=n}return R2.current},resetTransform:(n,t)=>{n.style.transform=t!==void 0?t:"none"},checkIsScrollRoot:n=>window.getComputedStyle(n).position==="fixed"}),zOe={pan:{Feature:oOe},drag:{Feature:iOe,ProjectionNode:zee,MeasureLayout:xee}};function Wq(n,t,i){const{props:a}=n;n.animationState&&a.whileHover&&n.animationState.setActive("whileHover",i==="Start");const l="onHover"+i,d=a[l];d&&$i.postRender(()=>d(t,KR(t)))}class GOe extends Cg{mount(){const{current:t}=this.node;t&&(this.unmount=zIe(t,i=>(Wq(this.node,i,"Start"),a=>Wq(this.node,a,"End"))))}unmount(){}}class HOe extends Cg{constructor(){super(...arguments),this.isActive=!1}onFocus(){let t=!1;try{t=this.node.current.matches(":focus-visible")}catch{t=!0}!t||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=$R(_R(this.node.current,"focus",()=>this.onFocus()),_R(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function zq(n,t,i){const{props:a}=n;n.animationState&&a.whileTap&&n.animationState.setActive("whileTap",i==="Start");const l="onTap"+(i==="End"?"":i),d=a[l];d&&$i.postRender(()=>d(t,KR(t)))}class $Oe extends Cg{mount(){const{current:t}=this.node;t&&(this.unmount=KIe(t,i=>(zq(this.node,i,"Start"),(a,{success:l})=>zq(this.node,a,l?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const WU=new WeakMap,C2=new WeakMap,KOe=n=>{const t=WU.get(n.target);t&&t(n)},qOe=n=>{n.forEach(KOe)};function YOe({root:n,...t}){const i=n||document;C2.has(i)||C2.set(i,{});const a=C2.get(i),l=JSON.stringify(t);return a[l]||(a[l]=new IntersectionObserver(qOe,{root:n,...t})),a[l]}function XOe(n,t,i){const a=YOe(t);return WU.set(n,i),a.observe(n),()=>{WU.delete(n),a.unobserve(n)}}const JOe={some:0,all:1};class QOe extends Cg{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:t={}}=this.node.getProps(),{root:i,margin:a,amount:l="some",once:d}=t,p={root:i?i.current:void 0,rootMargin:a,threshold:typeof l=="number"?l:JOe[l]},E=v=>{const{isIntersecting:b}=v;if(this.isInView===b||(this.isInView=b,d&&!b&&this.hasEnteredView))return;b&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",b);const{onViewportEnter:w,onViewportLeave:A}=this.node.getProps(),N=b?w:A;N&&N(v)};return XOe(this.node.current,p,E)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:t,prevProps:i}=this.node;["amount","margin","root"].some(ZOe(t,i))&&this.startObserver()}unmount(){}}function ZOe({viewport:n={}},{viewport:t={}}={}){return i=>n[i]!==t[i]}const eke={inView:{Feature:QOe},tap:{Feature:$Oe},focus:{Feature:HOe},hover:{Feature:GOe}},tke={layout:{ProjectionNode:zee,MeasureLayout:xee}},zU={current:null},Gee={current:!1};function nke(){if(Gee.current=!0,!!SF)if(window.matchMedia){const n=window.matchMedia("(prefers-reduced-motion)"),t=()=>zU.current=n.matches;n.addListener(t),t()}else zU.current=!1}const rke=[...mee,Pa,_g],ike=n=>rke.find(pee(n)),Gq=new WeakMap;function oke(n,t,i){for(const a in t){const l=t[a],d=i[a];if(Da(l))n.addValue(a,l);else if(Da(d))n.addValue(a,mR(l,{owner:n}));else if(d!==l)if(n.hasValue(a)){const p=n.getValue(a);p.liveStyle===!0?p.jump(l):p.hasAnimated||p.set(l)}else{const p=n.getStaticValue(a);n.addValue(a,mR(p!==void 0?p:l,{owner:n}))}}for(const a in i)t[a]===void 0&&n.removeValue(a);return t}const Hq=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class ske{scrapeMotionValuesFromProps(t,i,a){return{}}constructor({parent:t,props:i,presenceContext:a,reducedMotionConfig:l,blockInitialAnimation:d,visualState:p},E={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=qF,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const F=Kh.now();this.renderScheduledAt<F&&(this.renderScheduledAt=F,$i.render(this.render,!1,!0))};const{latestValues:v,renderState:b,onUpdate:w}=p;this.onUpdate=w,this.latestValues=v,this.baseTarget={...v},this.initialValues=i.initial?{...v}:{},this.renderState=b,this.parent=t,this.props=i,this.presenceContext=a,this.depth=t?t.depth+1:0,this.reducedMotionConfig=l,this.options=E,this.blockInitialAnimation=!!d,this.isControllingVariants=yN(i),this.isVariantNode=TZ(i),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(t&&t.current);const{willChange:A,...N}=this.scrapeMotionValuesFromProps(i,{},this);for(const F in N){const j=N[F];v[F]!==void 0&&Da(j)&&j.set(v[F],!1)}}mount(t){this.current=t,Gq.set(t,this),this.projection&&!this.projection.instance&&this.projection.mount(t),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((i,a)=>this.bindToMotionValue(a,i)),Gee.current||nke(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:zU.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){Gq.delete(this.current),this.projection&&this.projection.unmount(),gg(this.notifyUpdate),gg(this.render),this.valueSubscriptions.forEach(t=>t()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const t in this.events)this.events[t].clear();for(const t in this.features){const i=this.features[t];i&&(i.unmount(),i.isMounted=!1)}this.current=null}bindToMotionValue(t,i){this.valueSubscriptions.has(t)&&this.valueSubscriptions.get(t)();const a=FE.has(t),l=i.on("change",E=>{this.latestValues[t]=E,this.props.onUpdate&&$i.preRender(this.notifyUpdate),a&&this.projection&&(this.projection.isTransformDirty=!0)}),d=i.on("renderRequest",this.scheduleRender);let p;window.MotionCheckAppearSync&&(p=window.MotionCheckAppearSync(this,t,i)),this.valueSubscriptions.set(t,()=>{l(),d(),p&&p(),i.owner&&i.stop()})}sortNodePosition(t){return!this.current||!this.sortInstanceNodePosition||this.type!==t.type?0:this.sortInstanceNodePosition(this.current,t.current)}updateFeatures(){let t="animation";for(t in r0){const i=r0[t];if(!i)continue;const{isEnabled:a,Feature:l}=i;if(!this.features[t]&&l&&a(this.props)&&(this.features[t]=new l(this)),this.features[t]){const d=this.features[t];d.isMounted?d.update():(d.mount(),d.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):xo()}getStaticValue(t){return this.latestValues[t]}setStaticValue(t,i){this.latestValues[t]=i}update(t,i){(t.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=t,this.prevPresenceContext=this.presenceContext,this.presenceContext=i;for(let a=0;a<Hq.length;a++){const l=Hq[a];this.propEventSubscriptions[l]&&(this.propEventSubscriptions[l](),delete this.propEventSubscriptions[l]);const d="on"+l,p=t[d];p&&(this.propEventSubscriptions[l]=this.on(l,p))}this.prevMotionValues=oke(this,this.scrapeMotionValuesFromProps(t,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue(),this.onUpdate&&this.onUpdate(this)}getProps(){return this.props}getVariant(t){return this.props.variants?this.props.variants[t]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(t){const i=this.getClosestVariantNode();if(i)return i.variantChildren&&i.variantChildren.add(t),()=>i.variantChildren.delete(t)}addValue(t,i){const a=this.values.get(t);i!==a&&(a&&this.removeValue(t),this.bindToMotionValue(t,i),this.values.set(t,i),this.latestValues[t]=i.get())}removeValue(t){this.values.delete(t);const i=this.valueSubscriptions.get(t);i&&(i(),this.valueSubscriptions.delete(t)),delete this.latestValues[t],this.removeValueFromRenderState(t,this.renderState)}hasValue(t){return this.values.has(t)}getValue(t,i){if(this.props.values&&this.props.values[t])return this.props.values[t];let a=this.values.get(t);return a===void 0&&i!==void 0&&(a=mR(i===null?void 0:i,{owner:this}),this.addValue(t,a)),a}readValue(t,i){var a;let l=this.latestValues[t]!==void 0||!this.current?this.latestValues[t]:(a=this.getBaseTargetFromProps(this.props,t))!==null&&a!==void 0?a:this.readValueFromInstance(this.current,t,this.options);return l!=null&&(typeof l=="string"&&(hee(l)||ree(l))?l=parseFloat(l):!ike(l)&&_g.test(i)&&(l=lee(t,i)),this.setBaseTarget(t,Da(l)?l.get():l)),Da(l)?l.get():l}setBaseTarget(t,i){this.baseTarget[t]=i}getBaseTarget(t){var i;const{initial:a}=this.props;let l;if(typeof a=="string"||typeof a=="object"){const p=AF(this.props,a,(i=this.presenceContext)===null||i===void 0?void 0:i.custom);p&&(l=p[t])}if(a&&l!==void 0)return l;const d=this.getBaseTargetFromProps(this.props,t);return d!==void 0&&!Da(d)?d:this.initialValues[t]!==void 0&&l===void 0?void 0:this.baseTarget[t]}on(t,i){return this.events[t]||(this.events[t]=new WF),this.events[t].add(i)}notify(t,...i){this.events[t]&&this.events[t].notify(...i)}}class Hee extends ske{constructor(){super(...arguments),this.KeyframeResolver=gee}sortInstanceNodePosition(t,i){return t.compareDocumentPosition(i)&2?1:-1}getBaseTargetFromProps(t,i){return t.style?t.style[i]:void 0}removeValueFromRenderState(t,{vars:i,style:a}){delete i[t],delete a[t]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:t}=this.props;Da(t)&&(this.childSubscription=t.on("change",i=>{this.current&&(this.current.textContent=`${i}`)}))}}function ake(n){return window.getComputedStyle(n)}class cke extends Hee{constructor(){super(...arguments),this.type="html",this.renderInstance=NZ}readValueFromInstance(t,i){if(FE.has(i)){const a=KF(i);return a&&a.default||0}else{const a=ake(t),l=(PZ(i)?a.getPropertyValue(i):a[i])||0;return typeof l=="string"?l.trim():l}}measureInstanceViewportBox(t,{transformPagePoint:i}){return Dee(t,i)}build(t,i,a){kF(t,i,a.transformTemplate)}scrapeMotionValuesFromProps(t,i,a){return xF(t,i,a)}}class lke extends Hee{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=xo}getBaseTargetFromProps(t,i){return t[i]}readValueFromInstance(t,i){if(FE.has(i)){const a=KF(i);return a&&a.default||0}return i=DZ.has(i)?i:RF(i),t.getAttribute(i)}scrapeMotionValuesFromProps(t,i,a){return MZ(t,i,a)}build(t,i,a){NF(t,i,this.isSVGTag,a.transformTemplate)}renderInstance(t,i,a,l){LZ(t,i,a,l)}mount(t){this.isSVGTag=LF(t.tagName),super.mount(t)}}const uke=(n,t)=>IF(n)?new lke(t):new cke(t,{allowProjection:n!==L.Fragment}),dke=MIe({...LPe,...eke,...zOe,...tke},uke),of=JCe(dke),hke=(n,t)=>n.find(i=>i.id===t);function $q(n,t){const i=$ee(n,t),a=i?n[i].findIndex(l=>l.id===t):-1;return{position:i,index:a}}function $ee(n,t){for(const[i,a]of Object.entries(n))if(hke(a,t))return i}function fke(n){const t=n.includes("right"),i=n.includes("left");let a="center";return t&&(a="flex-end"),i&&(a="flex-start"),{display:"flex",flexDirection:"column",alignItems:a}}function pke(n){const i=n==="top"||n==="bottom"?"0 auto":void 0,a=n.includes("top")?"env(safe-area-inset-top, 0px)":void 0,l=n.includes("bottom")?"env(safe-area-inset-bottom, 0px)":void 0,d=n.includes("left")?void 0:"env(safe-area-inset-right, 0px)",p=n.includes("right")?void 0:"env(safe-area-inset-left, 0px)";return{position:"fixed",zIndex:"var(--toast-z-index, 5500)",pointerEvents:"none",display:"flex",flexDirection:"column",margin:i,top:a,bottom:l,right:d,left:p}}var mke=/^((children|dangerouslySetInnerHTML|key|ref|autoFocus|defaultValue|defaultChecked|innerHTML|suppressContentEditableWarning|suppressHydrationWarning|valueLink|abbr|accept|acceptCharset|accessKey|action|allow|allowUserMedia|allowPaymentRequest|allowFullScreen|allowTransparency|alt|async|autoComplete|autoPlay|capture|cellPadding|cellSpacing|challenge|charSet|checked|cite|classID|className|cols|colSpan|content|contentEditable|contextMenu|controls|controlsList|coords|crossOrigin|data|dateTime|decoding|default|defer|dir|disabled|disablePictureInPicture|disableRemotePlayback|download|draggable|encType|enterKeyHint|fetchpriority|fetchPriority|form|formAction|formEncType|formMethod|formNoValidate|formTarget|frameBorder|headers|height|hidden|high|href|hrefLang|htmlFor|httpEquiv|id|inputMode|integrity|is|keyParams|keyType|kind|label|lang|list|loading|loop|low|marginHeight|marginWidth|max|maxLength|media|mediaGroup|method|min|minLength|multiple|muted|name|nonce|noValidate|open|optimum|pattern|placeholder|playsInline|poster|preload|profile|radioGroup|readOnly|referrerPolicy|rel|required|reversed|role|rows|rowSpan|sandbox|scope|scoped|scrolling|seamless|selected|shape|size|sizes|slot|span|spellCheck|src|srcDoc|srcLang|srcSet|start|step|style|summary|tabIndex|target|title|translate|type|useMap|value|width|wmode|wrap|about|datatype|inlist|prefix|property|resource|typeof|vocab|autoCapitalize|autoCorrect|autoSave|color|incremental|fallback|inert|itemProp|itemScope|itemType|itemID|itemRef|on|option|results|security|unselectable|accentHeight|accumulate|additive|alignmentBaseline|allowReorder|alphabetic|amplitude|arabicForm|ascent|attributeName|attributeType|autoReverse|azimuth|baseFrequency|baselineShift|baseProfile|bbox|begin|bias|by|calcMode|capHeight|clip|clipPathUnits|clipPath|clipRule|colorInterpolation|colorInterpolationFilters|colorProfile|colorRendering|contentScriptType|contentStyleType|cursor|cx|cy|d|decelerate|descent|diffuseConstant|direction|display|divisor|dominantBaseline|dur|dx|dy|edgeMode|elevation|enableBackground|end|exponent|externalResourcesRequired|fill|fillOpacity|fillRule|filter|filterRes|filterUnits|floodColor|floodOpacity|focusable|fontFamily|fontSize|fontSizeAdjust|fontStretch|fontStyle|fontVariant|fontWeight|format|from|fr|fx|fy|g1|g2|glyphName|glyphOrientationHorizontal|glyphOrientationVertical|glyphRef|gradientTransform|gradientUnits|hanging|horizAdvX|horizOriginX|ideographic|imageRendering|in|in2|intercept|k|k1|k2|k3|k4|kernelMatrix|kernelUnitLength|kerning|keyPoints|keySplines|keyTimes|lengthAdjust|letterSpacing|lightingColor|limitingConeAngle|local|markerEnd|markerMid|markerStart|markerHeight|markerUnits|markerWidth|mask|maskContentUnits|maskUnits|mathematical|mode|numOctaves|offset|opacity|operator|order|orient|orientation|origin|overflow|overlinePosition|overlineThickness|panose1|paintOrder|pathLength|patternContentUnits|patternTransform|patternUnits|pointerEvents|points|pointsAtX|pointsAtY|pointsAtZ|preserveAlpha|preserveAspectRatio|primitiveUnits|r|radius|refX|refY|renderingIntent|repeatCount|repeatDur|requiredExtensions|requiredFeatures|restart|result|rotate|rx|ry|scale|seed|shapeRendering|slope|spacing|specularConstant|specularExponent|speed|spreadMethod|startOffset|stdDeviation|stemh|stemv|stitchTiles|stopColor|stopOpacity|strikethroughPosition|strikethroughThickness|string|stroke|strokeDasharray|strokeDashoffset|strokeLinecap|strokeLinejoin|strokeMiterlimit|strokeOpacity|strokeWidth|surfaceScale|systemLanguage|tableValues|targetX|targetY|textAnchor|textDecoration|textRendering|textLength|to|transform|u1|u2|underlinePosition|underlineThickness|unicode|unicodeBidi|unicodeRange|unitsPerEm|vAlphabetic|vHanging|vIdeographic|vMathematical|values|vectorEffect|version|vertAdvY|vertOriginX|vertOriginY|viewBox|viewTarget|visibility|widths|wordSpacing|writingMode|x|xHeight|x1|x2|xChannelSelector|xlinkActuate|xlinkArcrole|xlinkHref|xlinkRole|xlinkShow|xlinkTitle|xlinkType|xmlBase|xmlns|xmlnsXlink|xmlLang|xmlSpace|y|y1|y2|yChannelSelector|z|zoomAndPan|for|class|autofocus)|(([Dd][Aa][Tt][Aa]|[Aa][Rr][Ii][Aa]|x)-.*))$/,gke=cZ(function(n){return mke.test(n)||n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&n.charCodeAt(2)<91}),_ke=gke,Eke=function(t){return t!=="theme"},Kq=function(t){return typeof t=="string"&&t.charCodeAt(0)>96?_ke:Eke},qq=function(t,i,a){var l;if(i){var d=i.shouldForwardProp;l=t.__emotion_forwardProp&&d?function(p){return t.__emotion_forwardProp(p)&&d(p)}:d}return typeof l!="function"&&a&&(l=t.__emotion_forwardProp),l},yke=function(t){var i=t.cache,a=t.serialized,l=t.isStringTag;return lF(i,a,l),fZ(function(){return uF(i,a,l)}),null},vke=function n(t,i){var a=t.__emotion_real===t,l=a&&t.__emotion_base||t,d,p;i!==void 0&&(d=i.label,p=i.target);var E=qq(t,i,a),v=E||Kq(l),b=!v("as");return function(){var w=arguments,A=a&&t.__emotion_styles!==void 0?t.__emotion_styles.slice(0):[];if(d!==void 0&&A.push("label:"+d+";"),w[0]==null||w[0].raw===void 0)A.push.apply(A,w);else{var N=w[0];A.push(N[0]);for(var F=w.length,j=1;j<F;j++)A.push(w[j],N[j])}var B=hF(function(H,ee,K){var te=b&&H.as||l,le="",oe=[],ge=H;if(H.theme==null){ge={};for(var Z in H)ge[Z]=H[Z];ge.theme=L.useContext(t0)}typeof H.className=="string"?le=uZ(ee.registered,oe,H.className):H.className!=null&&(le=H.className+" ");var Q=pN(A.concat(oe),ee.registered,ge);le+=ee.key+"-"+Q.name,p!==void 0&&(le+=" "+p);var ne=b&&E===void 0?Kq(te):v,se={};for(var fe in H)b&&fe==="as"||ne(fe)&&(se[fe]=H[fe]);return se.className=le,K&&(se.ref=K),L.createElement(L.Fragment,null,L.createElement(yke,{cache:ee,serialized:Q,isStringTag:typeof te=="string"}),L.createElement(te,se))});return B.displayName=d!==void 0?d:"Styled("+(typeof l=="string"?l:l.displayName||l.name||"Component")+")",B.defaultProps=t.defaultProps,B.__emotion_real=B,B.__emotion_base=l,B.__emotion_styles=A,B.__emotion_forwardProp=E,Object.defineProperty(B,"toString",{value:function(){return"."+p}}),B.withComponent=function(H,ee){var K=n(H,wE({},i,ee,{shouldForwardProp:qq(B,ee,!0)}));return K.apply(void 0,A)},B}},Ske=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","marquee","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"],GU=vke.bind(null);Ske.forEach(function(n){GU[n]=GU(n)});const bke=new Set([...zye,"textStyle","layerStyle","apply","noOfLines","focusBorderColor","errorBorderColor","as","__css","css","sx"]),Tke=new Set(["htmlWidth","htmlHeight","htmlSize","htmlTranslate"]);function wke(n){return(Tke.has(n)||!bke.has(n))&&n[0]!=="_"}const Rke=vEe(GU),Cke=({baseStyle:n})=>t=>{const{theme:i,css:a,__css:l,sx:d,...p}=t,[E]=PEe(p,Hye),v=Yc(n,t),b=sEe({},l,v,oN(E),d),w=BQ(b)(t.theme);return a?[w,a]:w};function I2(n,t){const{baseStyle:i,...a}=t??{};a.shouldForwardProp||(a.shouldForwardProp=wke);const l=Cke({baseStyle:i}),d=Rke(n,a)(l);return L.forwardRef(function(v,b){const{children:w,...A}=v,{colorMode:N,forced:F}=gN(),j=F?N:void 0;return L.createElement(d,{ref:b,"data-theme":j,...A},w)})}function Ike(){const n=new Map;return new Proxy(I2,{apply(t,i,a){return I2(...a)},get(t,i){return n.has(i)||n.set(i,I2(i)),n.get(i)}})}const Lt=Ike(),Ake={initial:n=>{const{position:t}=n,i=["top","bottom"].includes(t)?"y":"x";let a=["top-right","bottom-right"].includes(t)?1:-1;return t==="bottom"&&(a=1),{opacity:0,[i]:a*24}},animate:{opacity:1,y:0,x:0,scale:1,transition:{duration:.4,ease:[.4,0,.2,1]}},exit:{opacity:0,scale:.85,transition:{duration:.2,ease:[.4,0,1,1]}}},Kee=L.memo(n=>{const{id:t,message:i,onCloseComplete:a,onRequestRemove:l,requestClose:d=!1,position:p="bottom",duration:E=5e3,containerStyle:v,motionVariants:b=Ake,toastSpacing:w="0.5rem"}=n,[A,N]=L.useState(E),F=WCe();mg(()=>{F||a==null||a()},[F]),mg(()=>{N(E)},[E]);const j=()=>N(null),B=()=>N(E),H=()=>{F&&l()};L.useEffect(()=>{F&&d&&l()},[F,d,l]),KEe(H,A);const ee=L.useMemo(()=>({pointerEvents:"auto",maxWidth:560,minWidth:300,margin:w,...v}),[v,w]),K=L.useMemo(()=>fke(p),[p]);return C.jsx(of.div,{layout:!0,className:"chakra-toast",variants:b,initial:"initial",animate:"animate",exit:"exit",onHoverStart:j,onHoverEnd:B,custom:{position:p},style:K,children:C.jsx(Lt.div,{role:"status","aria-atomic":"true",className:"chakra-toast__inner",__css:ee,children:Yc(i,{id:t,onClose:H})})})});Kee.displayName="ToastComponent";function Yt(n){return L.forwardRef(n)}var A2,Yq;function Pke(){if(Yq)return A2;Yq=1;var n=typeof Element<"u",t=typeof Map=="function",i=typeof Set=="function",a=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function l(d,p){if(d===p)return!0;if(d&&p&&typeof d=="object"&&typeof p=="object"){if(d.constructor!==p.constructor)return!1;var E,v,b;if(Array.isArray(d)){if(E=d.length,E!=p.length)return!1;for(v=E;v--!==0;)if(!l(d[v],p[v]))return!1;return!0}var w;if(t&&d instanceof Map&&p instanceof Map){if(d.size!==p.size)return!1;for(w=d.entries();!(v=w.next()).done;)if(!p.has(v.value[0]))return!1;for(w=d.entries();!(v=w.next()).done;)if(!l(v.value[1],p.get(v.value[0])))return!1;return!0}if(i&&d instanceof Set&&p instanceof Set){if(d.size!==p.size)return!1;for(w=d.entries();!(v=w.next()).done;)if(!p.has(v.value[0]))return!1;return!0}if(a&&ArrayBuffer.isView(d)&&ArrayBuffer.isView(p)){if(E=d.length,E!=p.length)return!1;for(v=E;v--!==0;)if(d[v]!==p[v])return!1;return!0}if(d.constructor===RegExp)return d.source===p.source&&d.flags===p.flags;if(d.valueOf!==Object.prototype.valueOf&&typeof d.valueOf=="function"&&typeof p.valueOf=="function")return d.valueOf()===p.valueOf();if(d.toString!==Object.prototype.toString&&typeof d.toString=="function"&&typeof p.toString=="function")return d.toString()===p.toString();if(b=Object.keys(d),E=b.length,E!==Object.keys(p).length)return!1;for(v=E;v--!==0;)if(!Object.prototype.hasOwnProperty.call(p,b[v]))return!1;if(n&&d instanceof Element)return!1;for(v=E;v--!==0;)if(!((b[v]==="_owner"||b[v]==="__v"||b[v]==="__o")&&d.$$typeof)&&!l(d[b[v]],p[b[v]]))return!1;return!0}return d!==d&&p!==p}return A2=function(p,E){try{return l(p,E)}catch(v){if((v.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw v}},A2}var Oke=Pke();const kke=b0(Oke);function A0(){const n=L.useContext(t0);if(!n)throw Error("useTheme: `theme` is undefined. Seems you forgot to wrap your app in `<ChakraProvider />` or `<ThemeProvider />`");return n}function qee(){const n=gN(),t=A0();return{...n,theme:t}}function Nke(n,t,i){if(t==null)return t;const a=l=>{var d,p;return(p=(d=n.__cssMap)==null?void 0:d[l])==null?void 0:p.value};return a(t)??a(i)??i}function Dke(n,t,i){const a=Array.isArray(t)?t:[t],l=Array.isArray(i)?i:[i];return d=>{const p=l.filter(Boolean),E=a.map((v,b)=>{const w=`${n}.${v}`;return Nke(d,w,p[b]??v)});return Array.isArray(t)?E:E[0]}}function Yee(n,t={}){const{styleConfig:i,...a}=t,{theme:l,colorMode:d}=qee(),p=n?wQ(l,`components.${n}`):void 0,E=i||p,v=jh({theme:l,colorMode:d},(E==null?void 0:E.defaultProps)??{},oN(T0(a,["children"])),(w,A)=>w?void 0:A),b=L.useRef({});if(E){const A=nve(E)(v);kke(b.current,A)||(b.current=A)}return b.current}function xl(n,t={}){return Yee(n,t)}function tl(n,t={}){return Yee(n,t)}const Xq={path:C.jsxs("g",{stroke:"currentColor",strokeWidth:"1.5",children:[C.jsx("path",{strokeLinecap:"round",fill:"none",d:"M9,9a3,3,0,1,1,4,2.829,1.5,1.5,0,0,0-1,1.415V14.25"}),C.jsx("path",{fill:"currentColor",strokeLinecap:"round",d:"M12,17.25a.375.375,0,1,0,.375.375A.375.375,0,0,0,12,17.25h0"}),C.jsx("circle",{fill:"none",strokeMiterlimit:"10",cx:"12",cy:"12",r:"11.25"})]}),viewBox:"0 0 24 24"},Wn=Yt((n,t)=>{const{as:i,viewBox:a,color:l="currentColor",focusable:d=!1,children:p,className:E,__css:v,...b}=n,w=dn("chakra-icon",E),A=xl("Icon",n),N={w:"1em",h:"1em",display:"inline-block",lineHeight:"1em",flexShrink:0,color:l,...v,...A},F={ref:t,focusable:d,className:w,__css:N},j=a??Xq.viewBox;if(i&&typeof i!="string")return C.jsx(Lt.svg,{as:i,...F,...b});const B=p??Xq.path;return C.jsx(Lt.svg,{verticalAlign:"middle",viewBox:j,...F,...b,children:B})});Wn.displayName="Icon";function Lke(n){return C.jsx(Wn,{viewBox:"0 0 24 24",...n,children:C.jsx("path",{fill:"currentColor",d:"M12,0A12,12,0,1,0,24,12,12.014,12.014,0,0,0,12,0Zm6.927,8.2-6.845,9.289a1.011,1.011,0,0,1-1.43.188L5.764,13.769a1,1,0,1,1,1.25-1.562l4.076,3.261,6.227-8.451A1,1,0,1,1,18.927,8.2Z"})})}function xke(n){return C.jsx(Wn,{viewBox:"0 0 24 24",...n,children:C.jsx("path",{fill:"currentColor",d:"M12,0A12,12,0,1,0,24,12,12.013,12.013,0,0,0,12,0Zm.25,5a1.5,1.5,0,1,1-1.5,1.5A1.5,1.5,0,0,1,12.25,5ZM14.5,18.5h-4a1,1,0,0,1,0-2h.75a.25.25,0,0,0,.25-.25v-4.5a.25.25,0,0,0-.25-.25H10.5a1,1,0,0,1,0-2h1a2,2,0,0,1,2,2v4.75a.25.25,0,0,0,.25.25h.75a1,1,0,1,1,0,2Z"})})}function Jq(n){return C.jsx(Wn,{viewBox:"0 0 24 24",...n,children:C.jsx("path",{fill:"currentColor",d:"M11.983,0a12.206,12.206,0,0,0-8.51,3.653A11.8,11.8,0,0,0,0,12.207,11.779,11.779,0,0,0,11.8,24h.214A12.111,12.111,0,0,0,24,11.791h0A11.766,11.766,0,0,0,11.983,0ZM10.5,16.542a1.476,1.476,0,0,1,1.449-1.53h.027a1.527,1.527,0,0,1,1.523,1.47,1.475,1.475,0,0,1-1.449,1.53h-.027A1.529,1.529,0,0,1,10.5,16.542ZM11,12.5v-6a1,1,0,0,1,2,0v6a1,1,0,1,1-2,0Z"})})}const Mke=WR({"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}}),Lp=Yt((n,t)=>{const i=xl("Spinner",n),{label:a="Loading...",thickness:l="2px",speed:d="0.45s",emptyColor:p="transparent",className:E,...v}=qi(n),b=dn("chakra-spinner",E),w={display:"inline-block",borderColor:"currentColor",borderStyle:"solid",borderRadius:"99999px",borderWidth:l,borderBottomColor:p,borderLeftColor:p,animation:`${Mke} ${d} linear infinite`,...i};return C.jsx(Lt.div,{ref:t,__css:w,className:b,...v,children:a&&C.jsx(Lt.span,{srOnly:!0,children:a})})});Lp.displayName="Spinner";const[Uke,QF]=Ki({name:"AlertContext",hookName:"useAlertContext",providerName:"<Alert />"}),[Vke,ZF]=Ki({name:"AlertStylesContext",hookName:"useAlertStyles",providerName:"<Alert />"}),Xee={info:{icon:xke,colorScheme:"blue"},warning:{icon:Jq,colorScheme:"orange"},success:{icon:Lke,colorScheme:"green"},error:{icon:Jq,colorScheme:"red"},loading:{icon:Lp,colorScheme:"blue"}};function Fke(n){return Xee[n].colorScheme}function jke(n){return Xee[n].icon}const o0=Yt(function(t,i){const{status:a="info",addRole:l=!0,...d}=qi(t),p=t.colorScheme??Fke(a),E=tl("Alert",{...t,colorScheme:p}),v={width:"100%",display:"flex",alignItems:"center",position:"relative",overflow:"hidden",...E.container};return C.jsx(Uke,{value:{status:a},children:C.jsx(Vke,{value:E,children:C.jsx(Lt.div,{"data-status":a,role:l?"alert":void 0,ref:i,...d,className:dn("chakra-alert",t.className),__css:v})})})});o0.displayName="Alert";function s0(n){const{status:t}=QF(),i=jke(t),a=ZF(),l=t==="loading"?a.spinner:a.icon;return C.jsx(Lt.span,{display:"inherit","data-status":t,...n,className:dn("chakra-alert__icon",n.className),__css:l,children:n.children||C.jsx(i,{h:"100%",w:"100%"})})}s0.displayName="AlertIcon";const Rk=Yt(function(t,i){const a=ZF(),{status:l}=QF();return C.jsx(Lt.div,{ref:i,"data-status":l,...t,className:dn("chakra-alert__title",t.className),__css:a.title})});Rk.displayName="AlertTitle";const Ck=Yt(function(t,i){const{status:a}=QF(),l=ZF(),d={display:"inline",...l.description};return C.jsx(Lt.div,{ref:i,"data-status":a,...t,className:dn("chakra-alert__desc",t.className),__css:d})});Ck.displayName="AlertDescription";function Bke(n){return C.jsx(Wn,{focusable:"false","aria-hidden":!0,...n,children:C.jsx("path",{fill:"currentColor",d:"M.439,21.44a1.5,1.5,0,0,0,2.122,2.121L11.823,14.3a.25.25,0,0,1,.354,0l9.262,9.263a1.5,1.5,0,1,0,2.122-2.121L14.3,12.177a.25.25,0,0,1,0-.354l9.263-9.262A1.5,1.5,0,0,0,21.439.44L12.177,9.7a.25.25,0,0,1-.354,0L2.561.44A1.5,1.5,0,0,0,.439,2.561L9.7,11.823a.25.25,0,0,1,0,.354Z"})})}const ej=Yt(function(t,i){const a=xl("CloseButton",t),{children:l,isDisabled:d,__css:p,...E}=qi(t),v={outline:0,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0};return C.jsx(Lt.button,{type:"button","aria-label":"Close",ref:i,disabled:d,__css:{...v,...a,...p},...E,children:l||C.jsx(Bke,{width:"1em",height:"1em"})})});ej.displayName="CloseButton";const Wke=n=>{const{status:t,variant:i="solid",id:a,title:l,isClosable:d,onClose:p,description:E,colorScheme:v,icon:b}=n,w=a?{root:`toast-${a}`,title:`toast-${a}-title`,description:`toast-${a}-description`}:void 0;return C.jsxs(o0,{addRole:!1,status:t,variant:i,id:w==null?void 0:w.root,alignItems:"start",borderRadius:"md",boxShadow:"lg",paddingEnd:8,textAlign:"start",width:"auto",colorScheme:v,children:[C.jsx(s0,{children:b}),C.jsxs(Lt.div,{flex:"1",maxWidth:"100%",children:[l&&C.jsx(Rk,{id:w==null?void 0:w.title,children:l}),E&&C.jsx(Ck,{id:w==null?void 0:w.description,display:"block",children:E})]}),d&&C.jsx(ej,{size:"sm",onClick:p,position:"absolute",insetEnd:1,top:1})]})};function Jee(n={}){const{render:t,toastComponent:i=Wke}=n;return l=>typeof t=="function"?t({...l,...n}):C.jsx(i,{...l,...n})}const zke={top:[],"top-left":[],"top-right":[],"bottom-left":[],bottom:[],"bottom-right":[]},Uh=Gke(zke);function Gke(n){let t=n;const i=new Set,a=l=>{t=l(t),i.forEach(d=>d())};return{getState:()=>t,subscribe:l=>(i.add(l),()=>{a(()=>n),i.delete(l)}),removeToast:(l,d)=>{a(p=>({...p,[d]:p[d].filter(E=>E.id!=l)}))},notify:(l,d)=>{const p=Hke(l,d),{position:E,id:v}=p;return a(b=>{const A=E.includes("top")?[p,...b[E]??[]]:[...b[E]??[],p];return{...b,[E]:A}}),v},update:(l,d)=>{l&&a(p=>{const E={...p},{position:v,index:b}=$q(E,l);return v&&b!==-1&&(E[v][b]={...E[v][b],...d,message:Jee(d)}),E})},closeAll:({positions:l}={})=>{a(d=>(l??["bottom","bottom-right","bottom-left","top","top-left","top-right"]).reduce((v,b)=>(v[b]=d[b].map(w=>({...w,requestClose:!0})),v),{...d}))},close:l=>{a(d=>{const p=$ee(d,l);return p?{...d,[p]:d[p].map(E=>E.id==l?{...E,requestClose:!0}:E)}:d})},isActive:l=>!!$q(Uh.getState(),l).position}}let Qq=0;function Hke(n,t={}){Qq+=1;const i=t.id??Qq,a=t.position??"bottom";return{id:i,message:n,position:a,duration:t.duration,onCloseComplete:t.onCloseComplete,onRequestRemove:()=>Uh.removeToast(String(i),a),status:t.status,requestClose:!1,containerStyle:t.containerStyle}}var Qee=mQ();const[Zee,$ke]=Ki({strict:!1,name:"PortalContext"}),tj="chakra-portal",Kke=".chakra-portal",qke=n=>C.jsx("div",{className:"chakra-portal-zIndex",style:{position:"absolute",zIndex:n.zIndex,top:0,left:0,right:0},children:n.children}),Yke=n=>{const{appendToParentPortal:t,children:i}=n,[a,l]=L.useState(null),d=L.useRef(null),[,p]=L.useState({});L.useEffect(()=>p({}),[]);const E=$ke(),v=xCe();yp(()=>{if(!a)return;const w=a.ownerDocument,A=t?E??w.body:w.body;if(!A)return;d.current=w.createElement("div"),d.current.className=tj,A.appendChild(d.current),p({});const N=d.current;return()=>{A.contains(N)&&A.removeChild(N)}},[a]);const b=v!=null&&v.zIndex?C.jsx(qke,{zIndex:v==null?void 0:v.zIndex,children:i}):i;return d.current?Qee.createPortal(C.jsx(Zee,{value:d.current,children:b}),d.current):C.jsx("span",{ref:w=>{w&&l(w)}})},Xke=n=>{const{children:t,containerRef:i,appendToParentPortal:a}=n,l=i.current,d=l??(typeof window<"u"?document.body:void 0),p=L.useMemo(()=>{const v=l==null?void 0:l.ownerDocument.createElement("div");return v&&(v.className=tj),v},[l]),[,E]=L.useState({});return yp(()=>E({}),[]),yp(()=>{if(!(!p||!d))return d.appendChild(p),()=>{d.removeChild(p)}},[p,d]),d&&p?Qee.createPortal(C.jsx(Zee,{value:a?p:null,children:t}),p):null};function Ml(n){const t={appendToParentPortal:!0,...n},{containerRef:i,...a}=t;return i?C.jsx(Xke,{containerRef:i,...a}):C.jsx(Yke,{...a})}Ml.className=tj;Ml.selector=Kke;Ml.displayName="Portal";const[Jke,Qke]=Ki({name:"ToastOptionsContext",strict:!1}),Zke=n=>{const t=L.useSyncExternalStore(Uh.subscribe,Uh.getState,Uh.getState),{motionVariants:i,component:a=Kee,portalProps:l,animatePresenceProps:d}=n,E=Object.keys(t).map(v=>{const b=t[v];return C.jsx("div",{role:"region","aria-live":"polite","aria-label":`Notifications-${v}`,id:`chakra-toast-manager-${v}`,style:pke(v),children:C.jsx(R0,{...d,initial:!1,children:b.map(w=>C.jsx(a,{motionVariants:i,...w},w.id))})},v)});return C.jsx(Ml,{...l,children:E})},eNe=n=>function({children:i,theme:a=n,toastOptions:l,...d}){return C.jsxs(UCe,{theme:a,...d,children:[C.jsx(Jke,{value:l==null?void 0:l.defaultOptions,children:i}),C.jsx(Zke,{...l})]})},bN=eNe(ARe);function Zq(n){return n.sort((t,i)=>{const a=t.compareDocumentPosition(i);if(a&Node.DOCUMENT_POSITION_FOLLOWING||a&Node.DOCUMENT_POSITION_CONTAINED_BY)return-1;if(a&Node.DOCUMENT_POSITION_PRECEDING||a&Node.DOCUMENT_POSITION_CONTAINS)return 1;if(a&Node.DOCUMENT_POSITION_DISCONNECTED||a&Node.DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC)throw Error("Cannot sort the given nodes.");return 0})}const tNe=n=>typeof n=="object"&&"nodeType"in n&&n.nodeType===Node.ELEMENT_NODE;function eY(n,t,i){let a=n+1;return i&&a>=t&&(a=0),a}function tY(n,t,i){let a=n-1;return i&&a<0&&(a=t),a}const P2=typeof window<"u"?L.useLayoutEffect:L.useEffect,nY=n=>n;var nNe=Object.defineProperty,rNe=(n,t,i)=>t in n?nNe(n,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[t]=i,Ro=(n,t,i)=>(rNe(n,typeof t!="symbol"?t+"":t,i),i);class iNe{constructor(){Ro(this,"descendants",new Map),Ro(this,"register",t=>{if(t!=null)return tNe(t)?this.registerNode(t):i=>{this.registerNode(i,t)}}),Ro(this,"unregister",t=>{this.descendants.delete(t);const i=Zq(Array.from(this.descendants.keys()));this.assignIndex(i)}),Ro(this,"destroy",()=>{this.descendants.clear()}),Ro(this,"assignIndex",t=>{this.descendants.forEach(i=>{const a=t.indexOf(i.node);i.index=a,i.node.dataset.index=i.index.toString()})}),Ro(this,"count",()=>this.descendants.size),Ro(this,"enabledCount",()=>this.enabledValues().length),Ro(this,"values",()=>Array.from(this.descendants.values()).sort((i,a)=>i.index-a.index)),Ro(this,"enabledValues",()=>this.values().filter(t=>!t.disabled)),Ro(this,"item",t=>{if(this.count()!==0)return this.values()[t]}),Ro(this,"enabledItem",t=>{if(this.enabledCount()!==0)return this.enabledValues()[t]}),Ro(this,"first",()=>this.item(0)),Ro(this,"firstEnabled",()=>this.enabledItem(0)),Ro(this,"last",()=>this.item(this.descendants.size-1)),Ro(this,"lastEnabled",()=>{const t=this.enabledValues().length-1;return this.enabledItem(t)}),Ro(this,"indexOf",t=>{var i;return t?((i=this.descendants.get(t))==null?void 0:i.index)??-1:-1}),Ro(this,"enabledIndexOf",t=>t==null?-1:this.enabledValues().findIndex(i=>i.node.isSameNode(t))),Ro(this,"next",(t,i=!0)=>{const a=eY(t,this.count(),i);return this.item(a)}),Ro(this,"nextEnabled",(t,i=!0)=>{const a=this.item(t);if(!a)return;const l=this.enabledIndexOf(a.node),d=eY(l,this.enabledCount(),i);return this.enabledItem(d)}),Ro(this,"prev",(t,i=!0)=>{const a=tY(t,this.count()-1,i);return this.item(a)}),Ro(this,"prevEnabled",(t,i=!0)=>{const a=this.item(t);if(!a)return;const l=this.enabledIndexOf(a.node),d=tY(l,this.enabledCount()-1,i);return this.enabledItem(d)}),Ro(this,"registerNode",(t,i)=>{if(!t||this.descendants.has(t))return;const a=Array.from(this.descendants.keys()).concat(t),l=Zq(a);i!=null&&i.disabled&&(i.disabled=!!i.disabled);const d={node:t,index:-1,...i};this.descendants.set(t,d),this.assignIndex(l)})}}function ete(){const[n,t]=Ki({name:"DescendantsProvider",errorMessage:"useDescendantsContext must be used within DescendantsProvider"});return[n,t,()=>{const l=L.useRef(new iNe);return P2(()=>()=>l.current.destroy()),l.current},l=>{const d=t(),[p,E]=L.useState(-1),v=L.useRef(null);P2(()=>()=>{v.current&&d.unregister(v.current)},[]),P2(()=>{if(!v.current)return;const w=Number(v.current.dataset.index);p!=w&&!Number.isNaN(w)&&E(w)});const b=nY(l?d.register(l):d.register);return{descendants:d,index:p,enabledIndex:d.enabledIndexOf(v.current),register:to(b,v)}}]}const rY={easeIn:[.4,0,1,1],easeOut:[0,0,.2,1]},EE={enter:{duration:.2,ease:rY.easeOut},exit:{duration:.1,ease:rY.easeIn}},yE={enter:(n,t)=>({...n,delay:typeof t=="number"?t:t==null?void 0:t.enter}),exit:(n,t)=>({...n,delay:typeof t=="number"?t:t==null?void 0:t.exit})},tte=Yt(function(n,t){const{ratio:i=4/3,children:a,className:l,...d}=n,p=L.Children.only(a),E=dn("chakra-aspect-ratio",l);return C.jsx(Lt.div,{ref:t,position:"relative",className:E,_before:{height:0,content:'""',display:"block",paddingBottom:sN(i,v=>`${1/v*100}%`)},__css:{"& > *:not(style)":{overflow:"hidden",position:"absolute",top:"0",right:"0",bottom:"0",left:"0",display:"flex",justifyContent:"center",alignItems:"center",width:"100%",height:"100%"},"& > img, & > video":{objectFit:"cover"}},...d,children:p})});tte.displayName="AspectRatio";const[oNe,sNe]=Ki({name:"AvatarStylesContext",hookName:"useAvatarStyles",providerName:"<Avatar/>"});function aNe(n){const t=n.trim().split(" "),i=t[0]??"",a=t.length>1?t[t.length-1]:"";return i&&a?`${i.charAt(0)}${a.charAt(0)}`:i.charAt(0)}function nte(n){const{name:t,getInitials:i,...a}=n,l=sNe();return C.jsx(Lt.div,{role:"img","aria-label":t,...a,__css:l.label,children:t?i==null?void 0:i(t):null})}nte.displayName="AvatarName";const rte=n=>C.jsxs(Lt.svg,{viewBox:"0 0 128 128",color:"#fff",width:"100%",height:"100%",className:"chakra-avatar__svg",...n,children:[C.jsx("path",{fill:"currentColor",d:"M103,102.1388 C93.094,111.92 79.3504,118 64.1638,118 C48.8056,118 34.9294,111.768 25,101.7892 L25,95.2 C25,86.8096 31.981,80 40.6,80 L87.4,80 C96.019,80 103,86.8096 103,95.2 L103,102.1388 Z"}),C.jsx("path",{fill:"currentColor",d:"M63.9961647,24 C51.2938136,24 41,34.2938136 41,46.9961647 C41,59.7061864 51.2938136,70 63.9961647,70 C76.6985159,70 87,59.7061864 87,46.9961647 C87,34.2938136 76.6985159,24 63.9961647,24"})]});function ite(n){const{loading:t,src:i,srcSet:a,onLoad:l,onError:d,crossOrigin:p,sizes:E,ignoreFallback:v}=n,[b,w]=L.useState("pending");L.useEffect(()=>{w(i?"loading":"pending")},[i]);const A=L.useRef(null),N=L.useCallback(()=>{if(!i)return;F();const j=new Image;j.src=i,p&&(j.crossOrigin=p),a&&(j.srcset=a),E&&(j.sizes=E),t&&(j.loading=t),j.onload=B=>{F(),w("loaded"),l==null||l(B)},j.onerror=B=>{F(),w("failed"),d==null||d(B)},A.current=j},[i,p,a,E,l,d,t]),F=()=>{A.current&&(A.current.onload=null,A.current.onerror=null,A.current=null)};return yp(()=>{if(!v)return b==="loading"&&N(),()=>{F()}},[b,N,v]),v?"loaded":b}const cNe=(n,t)=>n!=="loaded"&&t==="beforeLoadOrError"||n==="failed"&&t==="onError";function ote(n){const{src:t,srcSet:i,onError:a,onLoad:l,getInitials:d,name:p,borderRadius:E,loading:v,iconLabel:b,icon:w=C.jsx(rte,{}),ignoreFallback:A,referrerPolicy:N,crossOrigin:F}=n,B=ite({src:t,onError:a,crossOrigin:F,ignoreFallback:A})==="loaded";return!t||!B?p?C.jsx(nte,{className:"chakra-avatar__initials",getInitials:d,name:p}):L.cloneElement(w,{role:"img","aria-label":b}):C.jsx(Lt.img,{src:t,srcSet:i,alt:p??b,onLoad:l,referrerPolicy:N,crossOrigin:F??void 0,className:"chakra-avatar__img",loading:v,__css:{width:"100%",height:"100%",objectFit:"cover",borderRadius:E}})}ote.displayName="AvatarImage";const lNe={display:"inline-flex",alignItems:"center",justifyContent:"center",textAlign:"center",textTransform:"uppercase",fontWeight:"medium",position:"relative",flexShrink:0},Ou=Yt((n,t)=>{const i=tl("Avatar",n),[a,l]=L.useState(!1),{src:d,srcSet:p,name:E,showBorder:v,borderRadius:b="full",onError:w,onLoad:A,getInitials:N=aNe,icon:F=C.jsx(rte,{}),iconLabel:j=" avatar",loading:B,children:H,borderColor:ee,ignoreFallback:K,crossOrigin:te,referrerPolicy:le,...oe}=qi(n),ge={borderRadius:b,borderWidth:v?"2px":void 0,...lNe,...i.container};return ee&&(ge.borderColor=ee),C.jsx(Lt.span,{ref:t,...oe,className:dn("chakra-avatar",n.className),"data-loaded":Kn(a),__css:ge,children:C.jsxs(oNe,{value:i,children:[C.jsx(ote,{src:d,srcSet:p,loading:B,onLoad:Qn(A,()=>{l(!0)}),onError:w,getInitials:N,name:E,borderRadius:b,icon:F,iconLabel:j,ignoreFallback:K,crossOrigin:te,referrerPolicy:le}),H]})})});Ou.displayName="Avatar";const pp=Yt(function(t,i){const a=xl("Badge",t),{className:l,...d}=qi(t);return C.jsx(Lt.span,{ref:i,className:dn("chakra-badge",t.className),...d,__css:{display:"inline-block",whiteSpace:"nowrap",verticalAlign:"middle",...a}})});pp.displayName="Badge";const Rt=Lt("div");Rt.displayName="Box";const[R8e,uNe]=Ki({strict:!1,name:"ButtonGroupContext"});function kw(n){const{children:t,className:i,...a}=n,l=L.isValidElement(t)?L.cloneElement(t,{"aria-hidden":!0,focusable:!1}):t,d=dn("chakra-button__icon",i);return C.jsx(Lt.span,{display:"inline-flex",alignSelf:"center",flexShrink:0,...a,className:d,children:l})}kw.displayName="ButtonIcon";function HU(n){const{label:t,placement:i,spacing:a="0.5rem",children:l=C.jsx(Lp,{color:"currentColor",width:"1em",height:"1em"}),className:d,__css:p,...E}=n,v=dn("chakra-button__spinner",d),b=i==="start"?"marginEnd":"marginStart",w=L.useMemo(()=>({display:"flex",alignItems:"center",position:t?"relative":"absolute",[b]:t?a:0,fontSize:"1em",lineHeight:"normal",...p}),[p,t,b,a]);return C.jsx(Lt.div,{className:v,...E,__css:w,children:l})}HU.displayName="ButtonSpinner";function dNe(n){const[t,i]=L.useState(!n);return{ref:L.useCallback(d=>{d&&i(d.tagName==="BUTTON")},[]),type:t?"button":void 0}}const bi=Yt((n,t)=>{const i=uNe(),a=xl("Button",{...i,...n}),{isDisabled:l=i==null?void 0:i.isDisabled,isLoading:d,isActive:p,children:E,leftIcon:v,rightIcon:b,loadingText:w,iconSpacing:A="0.5rem",type:N,spinner:F,spinnerPlacement:j="start",className:B,as:H,shouldWrapChildren:ee,...K}=qi(n),te=L.useMemo(()=>{const Z={...a==null?void 0:a._focus,zIndex:1};return{display:"inline-flex",appearance:"none",alignItems:"center",justifyContent:"center",userSelect:"none",position:"relative",whiteSpace:"nowrap",verticalAlign:"middle",outline:"none",...a,...!!i&&{_focus:Z}}},[a,i]),{ref:le,type:oe}=dNe(H),ge={rightIcon:b,leftIcon:v,iconSpacing:A,children:E,shouldWrapChildren:ee};return C.jsxs(Lt.button,{disabled:l||d,ref:$Ee(t,le),as:H,type:N??oe,"data-active":Kn(p),"data-loading":Kn(d),__css:te,className:dn("chakra-button",B),...K,children:[d&&j==="start"&&C.jsx(HU,{className:"chakra-button__spinner--start",label:w,placement:"start",spacing:A,children:F}),d?w||C.jsx(Lt.span,{opacity:0,children:C.jsx(iY,{...ge})}):C.jsx(iY,{...ge}),d&&j==="end"&&C.jsx(HU,{className:"chakra-button__spinner--end",label:w,placement:"end",spacing:A,children:F})]})});bi.displayName="Button";function iY(n){const{leftIcon:t,rightIcon:i,children:a,iconSpacing:l,shouldWrapChildren:d}=n;return d?C.jsxs("span",{style:{display:"contents"},children:[t&&C.jsx(kw,{marginEnd:l,children:t}),a,i&&C.jsx(kw,{marginStart:l,children:i})]}):C.jsxs(C.Fragment,{children:[t&&C.jsx(kw,{marginEnd:l,children:t}),a,i&&C.jsx(kw,{marginStart:l,children:i})]})}const ka=Yt((n,t)=>{const{icon:i,children:a,isRound:l,"aria-label":d,...p}=n,E=i||a,v=L.isValidElement(E)?L.cloneElement(E,{"aria-hidden":!0,focusable:!1}):null;return C.jsx(bi,{px:"0",py:"0",borderRadius:l?"full":void 0,ref:t,"aria-label":d,...p,children:v})});ka.displayName="IconButton";const ste=Lt("div",{baseStyle:{display:"flex",alignItems:"center",justifyContent:"center"}});ste.displayName="Center";const hNe={horizontal:{insetStart:"50%",transform:"translateX(-50%)"},vertical:{top:"50%",transform:"translateY(-50%)"},both:{insetStart:"50%",top:"50%",transform:"translate(-50%, -50%)"}};Yt(function(t,i){const{axis:a="both",...l}=t;return C.jsx(Lt.div,{ref:i,__css:hNe[a],...l,position:"absolute"})});var fNe=()=>typeof document<"u",oY=!1,qR=null,RE=!1,$U=!1,KU=new Set;function nj(n,t){KU.forEach(i=>i(n,t))}var pNe=typeof window<"u"&&window.navigator!=null?/^Mac/.test(window.navigator.platform):!1;function mNe(n){return!(n.metaKey||!pNe&&n.altKey||n.ctrlKey||n.key==="Control"||n.key==="Shift"||n.key==="Meta")}function sY(n){RE=!0,mNe(n)&&(qR="keyboard",nj("keyboard",n))}function lS(n){if(qR="pointer",n.type==="mousedown"||n.type==="pointerdown"){RE=!0;const t=n.composedPath?n.composedPath()[0]:n.target;let i=!1;try{i=t.matches(":focus-visible")}catch{}if(i)return;nj("pointer",n)}}function gNe(n){return n.mozInputSource===0&&n.isTrusted?!0:n.detail===0&&!n.pointerType}function _Ne(n){gNe(n)&&(RE=!0,qR="virtual")}function ENe(n){n.target===window||n.target===document||n.target instanceof Element&&n.target.hasAttribute("tabindex")||(!RE&&!$U&&(qR="virtual",nj("virtual",n)),RE=!1,$U=!1)}function yNe(){RE=!1,$U=!0}function aY(){return qR!=="pointer"}function vNe(){if(!fNe()||oY)return;const{focus:n}=HTMLElement.prototype;HTMLElement.prototype.focus=function(...i){RE=!0,n.apply(this,i)},document.addEventListener("keydown",sY,!0),document.addEventListener("keyup",sY,!0),document.addEventListener("click",_Ne,!0),window.addEventListener("focus",ENe,!0),window.addEventListener("blur",yNe,!1),typeof PointerEvent<"u"?(document.addEventListener("pointerdown",lS,!0),document.addEventListener("pointermove",lS,!0),document.addEventListener("pointerup",lS,!0)):(document.addEventListener("mousedown",lS,!0),document.addEventListener("mousemove",lS,!0),document.addEventListener("mouseup",lS,!0)),oY=!0}function SNe(n){vNe(),n(aY());const t=()=>n(aY());return KU.add(t),()=>{KU.delete(t)}}const[bNe,ate]=Ki({name:"FormControlStylesContext",errorMessage:`useFormControlStyles returned is 'undefined'. Seems you forgot to wrap the components in "<FormControl />" `}),[TNe,P0]=Ki({strict:!1,name:"FormControlContext"});function wNe(n){const{id:t,isRequired:i,isInvalid:a,isDisabled:l,isReadOnly:d,...p}=n,E=L.useId(),v=t||`field-${E}`,b=`${v}-label`,w=`${v}-feedback`,A=`${v}-helptext`,[N,F]=L.useState(!1),[j,B]=L.useState(!1),[H,ee]=L.useState(!1),K=L.useCallback((Z={},Q=null)=>({id:A,...Z,ref:to(Q,ne=>{ne&&B(!0)})}),[A]),te=L.useCallback((Z={},Q=null)=>({...Z,ref:Q,"data-focus":Kn(H),"data-disabled":Kn(l),"data-invalid":Kn(a),"data-readonly":Kn(d),id:Z.id!==void 0?Z.id:b,htmlFor:Z.htmlFor!==void 0?Z.htmlFor:v}),[v,l,H,a,d,b]),le=L.useCallback((Z={},Q=null)=>({id:w,...Z,ref:to(Q,ne=>{ne&&F(!0)}),"aria-live":"polite"}),[w]),oe=L.useCallback((Z={},Q=null)=>({...Z,...p,ref:Q,role:"group","data-focus":Kn(H),"data-disabled":Kn(l),"data-invalid":Kn(a),"data-readonly":Kn(d)}),[p,l,H,a,d]),ge=L.useCallback((Z={},Q=null)=>({...Z,ref:Q,role:"presentation","aria-hidden":!0,children:Z.children||"*"}),[]);return{isRequired:!!i,isInvalid:!!a,isReadOnly:!!d,isDisabled:!!l,isFocused:!!H,onFocus:()=>ee(!0),onBlur:()=>ee(!1),hasFeedbackText:N,setHasFeedbackText:F,hasHelpText:j,setHasHelpText:B,id:v,labelId:b,feedbackId:w,helpTextId:A,htmlProps:p,getHelpTextProps:K,getErrorMessageProps:le,getRootProps:oe,getLabelProps:te,getRequiredIndicatorProps:ge}}const Si=Yt(function(t,i){const a=tl("Form",t),l=qi(t),{getRootProps:d,htmlProps:p,...E}=wNe(l),v=dn("chakra-form-control",t.className);return C.jsx(TNe,{value:E,children:C.jsx(bNe,{value:a,children:C.jsx(Lt.div,{...d({},i),className:v,__css:a.container})})})});Si.displayName="FormControl";const KO=Yt(function(t,i){const a=P0(),l=ate(),d=dn("chakra-form__helper-text",t.className);return C.jsx(Lt.div,{...a==null?void 0:a.getHelpTextProps(t,i),__css:l.helperText,className:d})});KO.displayName="FormHelperText";function rj(n){const{isDisabled:t,isInvalid:i,isReadOnly:a,isRequired:l,...d}=cte(n);return{...d,disabled:t,readOnly:a,required:l,"aria-invalid":LS(i),"aria-required":LS(l),"aria-readonly":LS(a)}}function cte(n){const t=P0(),{id:i,disabled:a,readOnly:l,required:d,isRequired:p,isInvalid:E,isReadOnly:v,isDisabled:b,onFocus:w,onBlur:A,...N}=n,F=n["aria-describedby"]?[n["aria-describedby"]]:[];return t!=null&&t.hasFeedbackText&&(t!=null&&t.isInvalid)&&F.push(t.feedbackId),t!=null&&t.hasHelpText&&F.push(t.helpTextId),{...N,"aria-describedby":F.join(" ")||void 0,id:i??(t==null?void 0:t.id),isDisabled:a??b??(t==null?void 0:t.isDisabled),isReadOnly:l??v??(t==null?void 0:t.isReadOnly),isRequired:d??p??(t==null?void 0:t.isRequired),isInvalid:E??(t==null?void 0:t.isInvalid),onFocus:Qn(t==null?void 0:t.onFocus,w),onBlur:Qn(t==null?void 0:t.onBlur,A)}}const RNe={border:"0",clip:"rect(0, 0, 0, 0)",height:"1px",width:"1px",margin:"-1px",padding:"0",overflow:"hidden",whiteSpace:"nowrap",position:"absolute"};function CNe(n={}){const t=cte(n),{isDisabled:i,isReadOnly:a,isRequired:l,isInvalid:d,id:p,onBlur:E,onFocus:v,"aria-describedby":b}=t,{defaultChecked:w,isChecked:A,isFocusable:N,onChange:F,isIndeterminate:j,name:B,value:H,tabIndex:ee=void 0,"aria-label":K,"aria-labelledby":te,"aria-invalid":le,...oe}=n,ge=T0(oe,["isDisabled","isReadOnly","isRequired","isInvalid","id","onBlur","onFocus","aria-describedby"]),Z=Xc(F),Q=Xc(E),ne=Xc(v),[se,fe]=L.useState(!1),[he,ue]=L.useState(!1),[Me,He]=L.useState(!1),[rt,we]=L.useState(!1);L.useEffect(()=>SNe(fe),[]);const Ce=L.useRef(null),[ye,Ne]=L.useState(!0),[be,Se]=L.useState(!!w),Ae=A!==void 0,Ue=Ae?A:be,ze=L.useCallback(Xt=>{if(a||i){Xt.preventDefault();return}Ae||Se(Ue?Xt.currentTarget.checked:j?!0:Xt.currentTarget.checked),Z==null||Z(Xt)},[a,i,Ue,Ae,j,Z]);yp(()=>{Ce.current&&(Ce.current.indeterminate=!!j)},[j]),mg(()=>{i&&ue(!1)},[i,ue]),yp(()=>{const Xt=Ce.current;if(!(Xt!=null&&Xt.form))return;const Yn=()=>{Se(!!w)};return Xt.form.addEventListener("reset",Yn),()=>{var Kt;return(Kt=Xt.form)==null?void 0:Kt.removeEventListener("reset",Yn)}},[]);const et=i&&!N,nt=L.useCallback(Xt=>{Xt.key===" "&&we(!0)},[we]),dt=L.useCallback(Xt=>{Xt.key===" "&&we(!1)},[we]);yp(()=>{if(!Ce.current)return;Ce.current.checked!==Ue&&Se(Ce.current.checked)},[Ce.current]);const Xe=L.useCallback((Xt={},Yn=null)=>{const Kt=Re=>{he&&Re.preventDefault(),we(!0)};return{...Xt,ref:Yn,"data-active":Kn(rt),"data-hover":Kn(Me),"data-checked":Kn(Ue),"data-focus":Kn(he),"data-focus-visible":Kn(he&&se),"data-indeterminate":Kn(j),"data-disabled":Kn(i),"data-invalid":Kn(d),"data-readonly":Kn(a),"aria-hidden":!0,onMouseDown:Qn(Xt.onMouseDown,Kt),onMouseUp:Qn(Xt.onMouseUp,()=>we(!1)),onMouseEnter:Qn(Xt.onMouseEnter,()=>He(!0)),onMouseLeave:Qn(Xt.onMouseLeave,()=>He(!1))}},[rt,Ue,i,he,se,Me,j,d,a]),It=L.useCallback((Xt={},Yn=null)=>({...Xt,ref:Yn,"data-active":Kn(rt),"data-hover":Kn(Me),"data-checked":Kn(Ue),"data-focus":Kn(he),"data-focus-visible":Kn(he&&se),"data-indeterminate":Kn(j),"data-disabled":Kn(i),"data-invalid":Kn(d),"data-readonly":Kn(a)}),[rt,Ue,i,he,se,Me,j,d,a]),hn=L.useCallback((Xt={},Yn=null)=>({...ge,htmlFor:ye?p:void 0,...Xt,ref:to(Yn,Kt=>{Kt&&Ne(Kt.tagName==="LABEL")}),onClick:Qn(Xt.onClick,()=>{var Kt;ye||((Kt=Ce.current)==null||Kt.click(),requestAnimationFrame(()=>{var Re;(Re=Ce.current)==null||Re.focus({preventScroll:!0})}))}),"data-disabled":Kn(i),"data-checked":Kn(Ue),"data-invalid":Kn(d)}),[ge,i,Ue,d,ye,p]),Ut=L.useCallback((Xt={},Yn=null)=>({...Xt,ref:to(Ce,Yn),type:"checkbox",name:B,value:H,id:p,tabIndex:ee,onChange:Qn(Xt.onChange,ze),onBlur:Qn(Xt.onBlur,Q,()=>ue(!1)),onFocus:Qn(Xt.onFocus,ne,()=>ue(!0)),onKeyDown:Qn(Xt.onKeyDown,nt),onKeyUp:Qn(Xt.onKeyUp,dt),required:l,checked:Ue,disabled:et,readOnly:a,"aria-label":K,"aria-labelledby":te,"aria-invalid":le?!!le:d,"aria-describedby":b,"aria-disabled":i,"aria-checked":j?"mixed":Ue,style:RNe}),[B,H,p,ee,ze,Q,ne,nt,dt,l,Ue,et,a,K,te,le,d,b,i,j]),ln=L.useCallback((Xt={},Yn=null)=>({...Xt,ref:Yn,onMouseDown:Qn(Xt.onMouseDown,INe),"data-disabled":Kn(i),"data-checked":Kn(Ue),"data-invalid":Kn(d)}),[Ue,i,d]);return{state:{isInvalid:d,isFocused:he,isChecked:Ue,isActive:rt,isHovered:Me,isIndeterminate:j,isDisabled:i,isReadOnly:a,isRequired:l},getRootProps:hn,getCheckboxProps:Xe,getIndicatorProps:It,getInputProps:Ut,getLabelProps:ln,htmlProps:ge}}function INe(n){n.preventDefault(),n.stopPropagation()}const qU=Yt(function(t,i){const{className:a,centerContent:l,...d}=qi(t),p=xl("Container",t);return C.jsx(Lt.div,{ref:i,className:dn("chakra-container",a),...d,__css:{...p,...l&&{display:"flex",flexDirection:"column",alignItems:"center"}}})});qU.displayName="Container";const Tp=Yt(function(t,i){const{borderLeftWidth:a,borderBottomWidth:l,borderTopWidth:d,borderRightWidth:p,borderWidth:E,borderStyle:v,borderColor:b,...w}=xl("Divider",t),{className:A,orientation:N="horizontal",__css:F,...j}=qi(t),B={vertical:{borderLeftWidth:a||p||E||"1px",height:"100%"},horizontal:{borderBottomWidth:l||d||E||"1px",width:"100%"}};return C.jsx(Lt.hr,{ref:i,"aria-orientation":N,...j,__css:{...w,border:"0",borderColor:b,borderStyle:v,...B[N],...F},className:dn("chakra-divider",A)})});Tp.displayName="Divider";const Ai=Yt(function(t,i){const{direction:a,align:l,justify:d,wrap:p,basis:E,grow:v,shrink:b,...w}=t,A={display:"flex",flexDirection:a,alignItems:l,justifyContent:d,flexWrap:p,flexBasis:E,flexGrow:v,flexShrink:b};return C.jsx(Lt.div,{ref:i,__css:A,...w})});Ai.displayName="Flex";function ANe(n,t){if(n==null)return{};var i={};for(var a in n)if({}.hasOwnProperty.call(n,a)){if(t.indexOf(a)!==-1)continue;i[a]=n[a]}return i}var O2={exports:{}},k2,cY;function PNe(){if(cY)return k2;cY=1;var n="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return k2=n,k2}var N2,lY;function ONe(){if(lY)return N2;lY=1;var n=PNe();function t(){}function i(){}return i.resetWarningCache=t,N2=function(){function a(p,E,v,b,w,A){if(A!==n){var N=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw N.name="Invariant Violation",N}}a.isRequired=a;function l(){return a}var d={array:a,bigint:a,bool:a,func:a,number:a,object:a,string:a,symbol:a,any:a,arrayOf:l,element:a,elementType:a,instanceOf:l,node:a,objectOf:l,oneOf:l,oneOfType:l,shape:l,exact:l,checkPropTypes:i,resetWarningCache:t};return d.PropTypes=d,d},N2}var uY;function kNe(){return uY||(uY=1,O2.exports=ONe()()),O2.exports}var NNe=kNe();const gr=b0(NNe);var YU="data-focus-lock",lte="data-focus-lock-disabled",DNe="data-no-focus-lock",LNe="data-autofocus-inside",xNe="data-no-autofocus";function D2(n,t){return typeof n=="function"?n(t):n&&(n.current=t),n}function MNe(n,t){var i=L.useState(function(){return{value:n,callback:t,facade:{get current(){return i.value},set current(a){var l=i.value;l!==a&&(i.value=a,i.callback(a,l))}}}})[0];return i.callback=t,i.facade}var UNe=typeof window<"u"?L.useLayoutEffect:L.useEffect,dY=new WeakMap;function ute(n,t){var i=MNe(null,function(a){return n.forEach(function(l){return D2(l,a)})});return UNe(function(){var a=dY.get(i);if(a){var l=new Set(a),d=new Set(n),p=i.current;l.forEach(function(E){d.has(E)||D2(E,null)}),d.forEach(function(E){l.has(E)||D2(E,p)})}dY.set(i,n)},[n]),i}var L2={width:"1px",height:"0px",padding:0,overflow:"hidden",position:"fixed",top:"1px",left:"1px"},Vh=function(){return Vh=Object.assign||function(t){for(var i,a=1,l=arguments.length;a<l;a++){i=arguments[a];for(var d in i)Object.prototype.hasOwnProperty.call(i,d)&&(t[d]=i[d])}return t},Vh.apply(this,arguments)};function YR(n,t){var i={};for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&t.indexOf(a)<0&&(i[a]=n[a]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,a=Object.getOwnPropertySymbols(n);l<a.length;l++)t.indexOf(a[l])<0&&Object.prototype.propertyIsEnumerable.call(n,a[l])&&(i[a[l]]=n[a[l]]);return i}function VNe(n,t,i){if(i||arguments.length===2)for(var a=0,l=t.length,d;a<l;a++)(d||!(a in t))&&(d||(d=Array.prototype.slice.call(t,0,a)),d[a]=t[a]);return n.concat(d||Array.prototype.slice.call(t))}function dte(n){return n}function hte(n,t){t===void 0&&(t=dte);var i=[],a=!1,l={read:function(){if(a)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return i.length?i[i.length-1]:n},useMedium:function(d){var p=t(d,a);return i.push(p),function(){i=i.filter(function(E){return E!==p})}},assignSyncMedium:function(d){for(a=!0;i.length;){var p=i;i=[],p.forEach(d)}i={push:function(E){return d(E)},filter:function(){return i}}},assignMedium:function(d){a=!0;var p=[];if(i.length){var E=i;i=[],E.forEach(d),p=i}var v=function(){var w=p;p=[],w.forEach(d)},b=function(){return Promise.resolve().then(v)};b(),i={push:function(w){p.push(w),b()},filter:function(w){return p=p.filter(w),i}}}};return l}function ij(n,t){return t===void 0&&(t=dte),hte(n,t)}function fte(n){n===void 0&&(n={});var t=hte(null);return t.options=Vh({async:!0,ssr:!1},n),t}var pte=function(n){var t=n.sideCar,i=YR(n,["sideCar"]);if(!t)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var a=t.read();if(!a)throw new Error("Sidecar medium not found");return L.createElement(a,Vh({},i))};pte.isSideCarExport=!0;function FNe(n,t){return n.useMedium(t),pte}var mte=ij({},function(n){var t=n.target,i=n.currentTarget;return{target:t,currentTarget:i}}),gte=ij(),jNe=ij(),BNe=fte({async:!0,ssr:typeof document<"u"}),WNe=L.createContext(void 0),zNe=[],oj=L.forwardRef(function(t,i){var a,l=L.useState(),d=l[0],p=l[1],E=L.useRef(),v=L.useRef(!1),b=L.useRef(null),w=L.useState({}),A=w[1],N=t.children,F=t.disabled,j=F===void 0?!1:F,B=t.noFocusGuards,H=B===void 0?!1:B,ee=t.persistentFocus,K=ee===void 0?!1:ee,te=t.crossFrame,le=te===void 0?!0:te,oe=t.autoFocus,ge=oe===void 0?!0:oe;t.allowTextSelection;var Z=t.group,Q=t.className,ne=t.whiteList,se=t.hasPositiveIndices,fe=t.shards,he=fe===void 0?zNe:fe,ue=t.as,Me=ue===void 0?"div":ue,He=t.lockProps,rt=He===void 0?{}:He,we=t.sideCar,Ce=t.returnFocus,ye=Ce===void 0?!1:Ce,Ne=t.focusOptions,be=t.onActivation,Se=t.onDeactivation,Ae=L.useState({}),Ue=Ae[0],ze=L.useCallback(function(Yn){var Kt=Yn.captureFocusRestore;if(!b.current){var Re,Fe=(Re=document)==null?void 0:Re.activeElement;b.current=Fe,Fe!==document.body&&(b.current=Kt(Fe))}E.current&&be&&be(E.current),v.current=!0,A()},[be]),et=L.useCallback(function(){v.current=!1,Se&&Se(E.current),A()},[Se]),nt=L.useCallback(function(Yn){var Kt=b.current;if(Kt){var Re=(typeof Kt=="function"?Kt():Kt)||document.body,Fe=typeof ye=="function"?ye(Re):ye;if(Fe){var Ke=typeof Fe=="object"?Fe:void 0;b.current=null,Yn?Promise.resolve().then(function(){return Re.focus(Ke)}):Re.focus(Ke)}}},[ye]),dt=L.useCallback(function(Yn){v.current&&mte.useMedium(Yn)},[]),Xe=gte.useMedium,It=L.useCallback(function(Yn){E.current!==Yn&&(E.current=Yn,p(Yn))},[]),hn=wE((a={},a[lte]=j&&"disabled",a[YU]=Z,a),rt),Ut=H!==!0,ln=Ut&&H!=="tail",Ln=ute([i,It]),Xt=L.useMemo(function(){return{observed:E,shards:he,enabled:!j,active:v.current}},[j,v.current,he,d]);return ni.createElement(L.Fragment,null,Ut&&[ni.createElement("div",{key:"guard-first","data-focus-guard":!0,tabIndex:j?-1:0,style:L2}),se?ni.createElement("div",{key:"guard-nearest","data-focus-guard":!0,tabIndex:j?-1:1,style:L2}):null],!j&&ni.createElement(we,{id:Ue,sideCar:BNe,observed:d,disabled:j,persistentFocus:K,crossFrame:le,autoFocus:ge,whiteList:ne,shards:he,onActivation:ze,onDeactivation:et,returnFocus:nt,focusOptions:Ne,noFocusGuards:H}),ni.createElement(Me,wE({ref:Ln},hn,{className:Q,onBlur:Xe,onFocus:dt}),ni.createElement(WNe.Provider,{value:Xt},N)),ln&&ni.createElement("div",{"data-focus-guard":!0,tabIndex:j?-1:0,style:L2}))});oj.propTypes={};function XU(n,t){return XU=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,a){return i.__proto__=a,i},XU(n,t)}function GNe(n,t){n.prototype=Object.create(t.prototype),n.prototype.constructor=n,XU(n,t)}function ER(n){"@babel/helpers - typeof";return ER=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ER(n)}function HNe(n,t){if(ER(n)!="object"||!n)return n;var i=n[Symbol.toPrimitive];if(i!==void 0){var a=i.call(n,t);if(ER(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(n)}function $Ne(n){var t=HNe(n,"string");return ER(t)=="symbol"?t:t+""}function KNe(n,t,i){return(t=$Ne(t))in n?Object.defineProperty(n,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[t]=i,n}function qNe(n,t){function i(a){return a.displayName||a.name||"Component"}return function(l){var d=[],p;function E(){p=n(d.map(function(b){return b.props})),t(p)}var v=function(b){GNe(w,b);function w(){return b.apply(this,arguments)||this}w.peek=function(){return p};var A=w.prototype;return A.componentDidMount=function(){d.push(this),E()},A.componentDidUpdate=function(){E()},A.componentWillUnmount=function(){var F=d.indexOf(this);d.splice(F,1),E()},A.render=function(){return ni.createElement(l,this.props)},w}(L.PureComponent);return KNe(v,"displayName","SideEffect("+i(l)+")"),v}}var sf=function(n){for(var t=Array(n.length),i=0;i<n.length;++i)t[i]=n[i];return t},CE=function(n){return Array.isArray(n)?n:[n]},_te=function(n){return Array.isArray(n)?n[0]:n},YNe=function(n){if(n.nodeType!==Node.ELEMENT_NODE)return!1;var t=window.getComputedStyle(n,null);return!t||!t.getPropertyValue?!1:t.getPropertyValue("display")==="none"||t.getPropertyValue("visibility")==="hidden"},Ete=function(n){return n.parentNode&&n.parentNode.nodeType===Node.DOCUMENT_FRAGMENT_NODE?n.parentNode.host:n.parentNode},yte=function(n){return n===document||n&&n.nodeType===Node.DOCUMENT_NODE},XNe=function(n){return n.hasAttribute("inert")},JNe=function(n,t){return!n||yte(n)||!YNe(n)&&!XNe(n)&&t(Ete(n))},vte=function(n,t){var i=n.get(t);if(i!==void 0)return i;var a=JNe(t,vte.bind(void 0,n));return n.set(t,a),a},QNe=function(n,t){return n&&!yte(n)?t1e(n)?t(Ete(n)):!1:!0},Ste=function(n,t){var i=n.get(t);if(i!==void 0)return i;var a=QNe(t,Ste.bind(void 0,n));return n.set(t,a),a},bte=function(n){return n.dataset},ZNe=function(n){return n.tagName==="BUTTON"},Tte=function(n){return n.tagName==="INPUT"},wte=function(n){return Tte(n)&&n.type==="radio"},e1e=function(n){return!((Tte(n)||ZNe(n))&&(n.type==="hidden"||n.disabled))},t1e=function(n){var t=n.getAttribute(xNe);return![!0,"true",""].includes(t)},sj=function(n){var t;return!!(n&&(!((t=bte(n))===null||t===void 0)&&t.focusGuard))},JU=function(n){return!sj(n)},n1e=function(n){return!!n},r1e=function(n,t){var i=Math.max(0,n.tabIndex),a=Math.max(0,t.tabIndex),l=i-a,d=n.index-t.index;if(l){if(!i)return 1;if(!a)return-1}return l||d},i1e=function(n){return n.tabIndex<0&&!n.hasAttribute("tabindex")?0:n.tabIndex},aj=function(n,t,i){return sf(n).map(function(a,l){var d=i1e(a);return{node:a,index:l,tabIndex:i&&d===-1?(a.dataset||{}).focusGuard?0:-1:d}}).filter(function(a){return!t||a.tabIndex>=0}).sort(r1e)},o1e=["button:enabled","select:enabled","textarea:enabled","input:enabled","a[href]","area[href]","summary","iframe","object","embed","audio[controls]","video[controls]","[tabindex]","[contenteditable]","[autofocus]"],cj=o1e.join(","),s1e="".concat(cj,", [data-focus-guard]"),Rte=function(n,t){return sf((n.shadowRoot||n).children).reduce(function(i,a){return i.concat(a.matches(t?s1e:cj)?[a]:[],Rte(a))},[])},a1e=function(n,t){var i;return n instanceof HTMLIFrameElement&&(!((i=n.contentDocument)===null||i===void 0)&&i.body)?a0([n.contentDocument.body],t):[n]},a0=function(n,t){return n.reduce(function(i,a){var l,d=Rte(a,t),p=(l=[]).concat.apply(l,d.map(function(E){return a1e(E,t)}));return i.concat(p,a.parentNode?sf(a.parentNode.querySelectorAll(cj)).filter(function(E){return E===a}):[])},[])},c1e=function(n){var t=n.querySelectorAll("[".concat(LNe,"]"));return sf(t).map(function(i){return a0([i])}).reduce(function(i,a){return i.concat(a)},[])},lj=function(n,t){return sf(n).filter(function(i){return vte(t,i)}).filter(function(i){return e1e(i)})},hY=function(n,t){return t===void 0&&(t=new Map),sf(n).filter(function(i){return Ste(t,i)})},uj=function(n,t,i){return aj(lj(a0(n,i),t),!0,i)},yR=function(n,t){return aj(lj(a0(n),t),!1)},l1e=function(n,t){return lj(c1e(n),t)},vE=function(n,t){return n.shadowRoot?vE(n.shadowRoot,t):Object.getPrototypeOf(n).contains!==void 0&&Object.getPrototypeOf(n).contains.call(n,t)?!0:sf(n.children).some(function(i){var a;if(i instanceof HTMLIFrameElement){var l=(a=i.contentDocument)===null||a===void 0?void 0:a.body;return l?vE(l,t):!1}return vE(i,t)})},u1e=function(n){for(var t=new Set,i=n.length,a=0;a<i;a+=1)for(var l=a+1;l<i;l+=1){var d=n[a].compareDocumentPosition(n[l]);(d&Node.DOCUMENT_POSITION_CONTAINED_BY)>0&&t.add(l),(d&Node.DOCUMENT_POSITION_CONTAINS)>0&&t.add(a)}return n.filter(function(p,E){return!t.has(E)})},Cte=function(n){return n.parentNode?Cte(n.parentNode):n},dj=function(n){var t=CE(n);return t.filter(Boolean).reduce(function(i,a){var l=a.getAttribute(YU);return i.push.apply(i,l?u1e(sf(Cte(a).querySelectorAll("[".concat(YU,'="').concat(l,'"]:not([').concat(lte,'="disabled"])')))):[a]),i},[])},d1e=function(n){try{return n()}catch{return}},vR=function(n){if(n===void 0&&(n=document),!(!n||!n.activeElement)){var t=n.activeElement;return t.shadowRoot?vR(t.shadowRoot):t instanceof HTMLIFrameElement&&d1e(function(){return t.contentWindow.document})?vR(t.contentWindow.document):t}},h1e=function(n,t){return n===t},f1e=function(n,t){return!!sf(n.querySelectorAll("iframe")).some(function(i){return h1e(i,t)})},Ite=function(n,t){return t===void 0&&(t=vR(_te(n).ownerDocument)),!t||t.dataset&&t.dataset.focusGuard?!1:dj(n).some(function(i){return vE(i,t)||f1e(i,t)})},p1e=function(n){n===void 0&&(n=document);var t=vR(n);return t?sf(n.querySelectorAll("[".concat(DNe,"]"))).some(function(i){return vE(i,t)}):!1},m1e=function(n,t){return t.filter(wte).filter(function(i){return i.name===n.name}).filter(function(i){return i.checked})[0]||n},hj=function(n,t){return wte(n)&&n.name?m1e(n,t):n},g1e=function(n){var t=new Set;return n.forEach(function(i){return t.add(hj(i,n))}),n.filter(function(i){return t.has(i)})},fY=function(n){return n[0]&&n.length>1?hj(n[0],n):n[0]},pY=function(n,t){return n.indexOf(hj(t,n))},QU="NEW_FOCUS",_1e=function(n,t,i,a,l){var d=n.length,p=n[0],E=n[d-1],v=sj(a);if(!(a&&n.indexOf(a)>=0)){var b=a!==void 0?i.indexOf(a):-1,w=l?i.indexOf(l):b,A=l?n.indexOf(l):-1;if(b===-1)return A!==-1?A:QU;if(A===-1)return QU;var N=b-w,F=i.indexOf(p),j=i.indexOf(E),B=g1e(i),H=a!==void 0?B.indexOf(a):-1,ee=l?B.indexOf(l):H,K=B.filter(function(Q){return Q.tabIndex>=0}),te=a!==void 0?K.indexOf(a):-1,le=l?K.indexOf(l):te,oe=te>=0&&le>=0?le-te:ee-H;if(!N&&A>=0||t.length===0)return A;var ge=pY(n,t[0]),Z=pY(n,t[t.length-1]);if(b<=F&&v&&Math.abs(N)>1)return Z;if(b>=j&&v&&Math.abs(N)>1)return ge;if(N&&Math.abs(oe)>1)return A;if(b<=F)return Z;if(b>j)return ge;if(N)return Math.abs(N)>1?A:(d+A+N)%d}},E1e=function(n){return function(t){var i,a=(i=bte(t))===null||i===void 0?void 0:i.autofocus;return t.autofocus||a!==void 0&&a!=="false"||n.indexOf(t)>=0}},mY=function(n,t,i){var a=n.map(function(d){var p=d.node;return p}),l=hY(a.filter(E1e(i)));return l&&l.length?fY(l):fY(hY(t))},ZU=function(n,t){return t===void 0&&(t=[]),t.push(n),n.parentNode&&ZU(n.parentNode.host||n.parentNode,t),t},x2=function(n,t){for(var i=ZU(n),a=ZU(t),l=0;l<i.length;l+=1){var d=i[l];if(a.indexOf(d)>=0)return d}return!1},Ate=function(n,t,i){var a=CE(n),l=CE(t),d=a[0],p=!1;return l.filter(Boolean).forEach(function(E){p=x2(p||E,E)||p,i.filter(Boolean).forEach(function(v){var b=x2(d,v);b&&(!p||vE(b,p)?p=b:p=x2(b,p))})}),p},gY=function(n,t){return n.reduce(function(i,a){return i.concat(l1e(a,t))},[])},y1e=function(n,t){var i=new Map;return t.forEach(function(a){return i.set(a.node,a)}),n.map(function(a){return i.get(a)}).filter(n1e)},v1e=function(n,t){var i=vR(CE(n).length>0?document:_te(n).ownerDocument),a=dj(n).filter(JU),l=Ate(i||n,n,a),d=new Map,p=yR(a,d),E=p.filter(function(j){var B=j.node;return JU(B)});if(E[0]){var v=yR([l],d).map(function(j){var B=j.node;return B}),b=y1e(v,E),w=b.map(function(j){var B=j.node;return B}),A=b.filter(function(j){var B=j.tabIndex;return B>=0}).map(function(j){var B=j.node;return B}),N=_1e(w,A,v,i,t);if(N===QU){var F=mY(p,A,gY(a,d))||mY(p,w,gY(a,d));if(F)return{node:F};console.warn("focus-lock: cannot find any node to move focus into");return}return N===void 0?N:b[N]}},S1e=function(n){var t=dj(n).filter(JU),i=Ate(n,n,t),a=aj(a0([i],!0),!0,!0),l=a0(t,!1);return a.map(function(d){var p=d.node,E=d.index;return{node:p,index:E,lockItem:l.indexOf(p)>=0,guard:sj(p)}})},fj=function(n,t){n&&("focus"in n&&n.focus(t),"contentWindow"in n&&n.contentWindow&&n.contentWindow.focus())},M2=0,U2=!1,Pte=function(n,t,i){i===void 0&&(i={});var a=v1e(n,t);if(!U2&&a){if(M2>2){console.error("FocusLock: focus-fighting detected. Only one focus management system could be active. See https://github.com/theKashey/focus-lock/#focus-fighting"),U2=!0,setTimeout(function(){U2=!1},1);return}M2++,fj(a.node,i.focusOptions),M2--}};function sw(n){if(!n)return null;if(typeof WeakRef>"u")return function(){return n||null};var t=n?new WeakRef(n):null;return function(){return(t==null?void 0:t.deref())||null}}var b1e=function(n){if(!n)return null;for(var t=[],i=n;i&&i!==document.body;)t.push({current:sw(i),parent:sw(i.parentElement),left:sw(i.previousElementSibling),right:sw(i.nextElementSibling)}),i=i.parentElement;return{element:sw(n),stack:t,ownerDocument:n.ownerDocument}},T1e=function(n){var t,i,a,l,d;if(n)for(var p=n.stack,E=n.ownerDocument,v=new Map,b=0,w=p;b<w.length;b++){var A=w[b],N=(t=A.parent)===null||t===void 0?void 0:t.call(A);if(N&&E.contains(N)){for(var F=(i=A.left)===null||i===void 0?void 0:i.call(A),j=A.current(),B=N.contains(j)?j:void 0,H=(a=A.right)===null||a===void 0?void 0:a.call(A),ee=uj([N],v),K=(d=(l=B??(F==null?void 0:F.nextElementSibling))!==null&&l!==void 0?l:H)!==null&&d!==void 0?d:F;K;){for(var te=0,le=ee;te<le.length;te++){var oe=le[te];if(K!=null&&K.contains(oe.node))return oe.node}K=K.nextElementSibling}if(ee.length)return ee[0].node}}},Ote=function(n){var t=b1e(n);return function(){return T1e(t)}},w1e=function(n,t,i){if(!n||!t)return console.error("no element or scope given"),{};var a=CE(t);if(a.every(function(p){return!vE(p,n)}))return console.error("Active element is not contained in the scope"),{};var l=i?uj(a,new Map):yR(a,new Map),d=l.findIndex(function(p){var E=p.node;return E===n});if(d!==-1)return{prev:l[d-1],next:l[d+1],first:l[0],last:l[l.length-1]}},R1e=function(n,t){var i=t?uj(CE(n),new Map):yR(CE(n),new Map);return{first:i[0],last:i[i.length-1]}},C1e=function(n){return Object.assign({scope:document.body,cycle:!0,onlyTabbable:!0},n)},kte=function(n,t,i){t===void 0&&(t={});var a=C1e(t),l=w1e(n,a.scope,a.onlyTabbable);if(l){var d=i(l,a.cycle);d&&fj(d.node,a.focusOptions)}},I1e=function(n,t){t===void 0&&(t={}),kte(n,t,function(i,a){var l=i.next,d=i.first;return l||a&&d})},A1e=function(n,t){t===void 0&&(t={}),kte(n,t,function(i,a){var l=i.prev,d=i.last;return l||a&&d})},Nte=function(n,t,i){var a,l=R1e(n,(a=t.onlyTabbable)!==null&&a!==void 0?a:!0),d=l[i];d&&fj(d.node,t.focusOptions)},P1e=function(n,t){t===void 0&&(t={}),Nte(n,t,"first")},O1e=function(n,t){t===void 0&&(t={}),Nte(n,t,"last")};function pj(n){setTimeout(n,1)}var k1e=function(t){return t&&"current"in t?t.current:t},Dte=function(){return document&&document.activeElement===document.body},N1e=function(){return Dte()||p1e()},zS=null,zc=null,_Y=function(){return null},GS=null,SR=!1,mj=!1,D1e=function(){return!0},L1e=function(t){return(zS.whiteList||D1e)(t)},x1e=function(t,i){GS={observerNode:t,portaledElement:i}},M1e=function(t){return GS&&GS.portaledElement===t};function EY(n,t,i,a){var l=null,d=n;do{var p=a[d];if(p.guard)p.node.dataset.focusAutoGuard&&(l=p);else if(p.lockItem){if(d!==n)return;l=null}else break}while((d+=i)!==t);l&&(l.node.tabIndex=0)}var U1e=function(t){return t?!!SR:SR==="meanwhile"},V1e=function n(t,i,a){return i&&(i.host===t&&(!i.activeElement||a.contains(i.activeElement))||i.parentNode&&n(t,i.parentNode,a))},F1e=function(t,i){return i.some(function(a){return V1e(t,a,a)})},Lte=function(t){return yR(t,new Map)},j1e=function(t){return!Lte([t.parentNode]).some(function(i){return i.node===t})},Ik=function(){var t=!1;if(zS){var i=zS,a=i.observed,l=i.persistentFocus,d=i.autoFocus,p=i.shards,E=i.crossFrame,v=i.focusOptions,b=i.noFocusGuards,w=a||GS&&GS.portaledElement;if(Dte()&&zc&&zc!==document.body&&(!document.body.contains(zc)||j1e(zc))){var A=_Y();A&&A.focus()}var N=document&&document.activeElement;if(w){var F=[w].concat(p.map(k1e).filter(Boolean)),j=function(){if(!U1e(E)||!b||!zc||mj)return!1;var te=Lte(F),le=te.findIndex(function(oe){var ge=oe.node;return ge===zc});return le===0||le===te.length-1};if((!N||L1e(N))&&(l||j()||!N1e()||!zc&&d)&&(w&&!(Ite(F)||N&&F1e(N,F)||M1e(N))&&(document&&!zc&&N&&!d?(N.blur&&N.blur(),document.body.focus()):(t=Pte(F,zc,{focusOptions:v}),GS={})),zc=document&&document.activeElement,zc!==document.body&&(_Y=Ote(zc)),SR=!1),document&&N!==document.activeElement&&document.querySelector("[data-focus-auto-guard]")){var B=document&&document.activeElement,H=S1e(F),ee=H.map(function(K){var te=K.node;return te}).indexOf(B);ee>-1&&(H.filter(function(K){var te=K.guard,le=K.node;return te&&le.dataset.focusAutoGuard}).forEach(function(K){var te=K.node;return te.removeAttribute("tabIndex")}),EY(ee,H.length,1,H),EY(ee,-1,-1,H))}}}return t},xte=function(t){Ik()&&t&&(t.stopPropagation(),t.preventDefault())},gj=function(){return pj(Ik)},B1e=function(t){var i=t.target,a=t.currentTarget;a.contains(i)||x1e(a,i)},W1e=function(){return null},Mte=function(){mj=!0},Ute=function(){mj=!1,SR="just",pj(function(){SR="meanwhile"})},z1e=function(){document.addEventListener("focusin",xte),document.addEventListener("focusout",gj),window.addEventListener("focus",Mte),window.addEventListener("blur",Ute)},G1e=function(){document.removeEventListener("focusin",xte),document.removeEventListener("focusout",gj),window.removeEventListener("focus",Mte),window.removeEventListener("blur",Ute)};function H1e(n){return n.filter(function(t){var i=t.disabled;return!i})}var Vte={moveFocusInside:Pte,focusInside:Ite,focusNextElement:I1e,focusPrevElement:A1e,focusFirstElement:P1e,focusLastElement:O1e,captureFocusRestore:Ote};function $1e(n){var t=n.slice(-1)[0];t&&!zS&&z1e();var i=zS,a=i&&t&&t.id===i.id;zS=t,i&&!a&&(i.onDeactivation(),n.filter(function(l){var d=l.id;return d===i.id}).length||i.returnFocus(!t)),t?(zc=null,(!a||i.observed!==t.observed)&&t.onActivation(Vte),Ik(),pj(Ik)):(G1e(),zc=null)}mte.assignSyncMedium(B1e);gte.assignMedium(gj);jNe.assignMedium(function(n){return n(Vte)});const K1e=qNe(H1e,$1e)(W1e);var eV=L.forwardRef(function(t,i){return ni.createElement(oj,wE({sideCar:K1e,ref:i},t))}),Fte=oj.propTypes||{};Fte.sideCar;ANe(Fte,["sideCar"]);eV.propTypes={};const q1e=eV.default??eV,jte=n=>{const{initialFocusRef:t,finalFocusRef:i,contentRef:a,restoreFocus:l,children:d,isDisabled:p,autoFocus:E,persistentFocus:v,lockFocusAcrossFrames:b}=n,w=L.useCallback(()=>{t!=null&&t.current?t.current.focus():a!=null&&a.current&&TQ(a.current).length===0&&requestAnimationFrame(()=>{var j;(j=a.current)==null||j.focus()})},[t,a]),A=L.useCallback(()=>{var F;(F=i==null?void 0:i.current)==null||F.focus()},[i]),N=l&&!i;return C.jsx(q1e,{crossFrame:b,persistentFocus:v,autoFocus:E,disabled:p,onActivation:w,onDeactivation:A,returnFocus:N,children:d})};jte.displayName="FocusLock";const[Y1e,X1e]=Ki({name:"FormErrorStylesContext",errorMessage:`useFormErrorStyles returned is 'undefined'. Seems you forgot to wrap the components in "<FormError />" `}),cp=Yt((n,t)=>{const i=tl("FormError",n),a=qi(n),l=P0();return l!=null&&l.isInvalid?C.jsx(Y1e,{value:i,children:C.jsx(Lt.div,{...l==null?void 0:l.getErrorMessageProps(a,t),className:dn("chakra-form__error-message",n.className),__css:{display:"flex",alignItems:"center",...i.text}})}):null});cp.displayName="FormErrorMessage";const J1e=Yt((n,t)=>{const i=X1e(),a=P0();if(!(a!=null&&a.isInvalid))return null;const l=dn("chakra-form__error-icon",n.className);return C.jsx(Wn,{ref:t,"aria-hidden":!0,...n,__css:i.icon,className:l,children:C.jsx("path",{fill:"currentColor",d:"M11.983,0a12.206,12.206,0,0,0-8.51,3.653A11.8,11.8,0,0,0,0,12.207,11.779,11.779,0,0,0,11.8,24h.214A12.111,12.111,0,0,0,24,11.791h0A11.766,11.766,0,0,0,11.983,0ZM10.5,16.542a1.476,1.476,0,0,1,1.449-1.53h.027a1.527,1.527,0,0,1,1.523,1.47,1.475,1.475,0,0,1-1.449,1.53h-.027A1.529,1.529,0,0,1,10.5,16.542ZM11,12.5v-6a1,1,0,0,1,2,0v6a1,1,0,1,1-2,0Z"})})});J1e.displayName="FormErrorIcon";const ta=Yt(function(t,i){const a=xl("FormLabel",t),l=qi(t),{className:d,children:p,requiredIndicator:E=C.jsx(Bte,{}),optionalIndicator:v=null,...b}=l,w=P0(),A=(w==null?void 0:w.getLabelProps(b,i))??{ref:i,...b};return C.jsxs(Lt.label,{...A,className:dn("chakra-form__label",l.className),__css:{display:"block",textAlign:"start",...a},children:[p,w!=null&&w.isRequired?E:v]})});ta.displayName="FormLabel";const Bte=Yt(function(t,i){const a=P0(),l=ate();if(!(a!=null&&a.isRequired))return null;const d=dn("chakra-form__required-indicator",t.className);return C.jsx(Lt.span,{...a==null?void 0:a.getRequiredIndicatorProps(t,i),__css:l.requiredIndicator,className:d})});Bte.displayName="RequiredIndicator";const Wte=Yt(function(t,i){const{templateAreas:a,gap:l,rowGap:d,columnGap:p,column:E,row:v,autoFlow:b,autoRows:w,templateRows:A,autoColumns:N,templateColumns:F,...j}=t,B={display:"grid",gridTemplateAreas:a,gridGap:l,gridRowGap:d,gridColumnGap:p,gridAutoColumns:N,gridColumn:E,gridRow:v,gridAutoFlow:b,gridAutoRows:w,gridTemplateRows:A,gridTemplateColumns:F};return C.jsx(Lt.div,{ref:i,__css:B,...j})});Wte.displayName="Grid";const zte=Yt(function(t,i){const{columns:a,spacingX:l,spacingY:d,spacing:p,minChildWidth:E,...v}=t,b=A0(),w=E?Z1e(E,b):eDe(a);return C.jsx(Wte,{ref:i,gap:p,columnGap:l,rowGap:d,templateColumns:w,...v})});zte.displayName="SimpleGrid";function Q1e(n){return typeof n=="number"?`${n}px`:n}function Z1e(n,t){return sN(n,i=>{const a=Dke("sizes",i,Q1e(i))(t);return i===null?null:`repeat(auto-fit, minmax(${a}, 1fr))`})}function eDe(n){return sN(n,t=>t===null?null:`repeat(${t}, minmax(0, 1fr))`)}function O0(n){const{viewBox:t="0 0 24 24",d:i,displayName:a,defaultProps:l={}}=n,d=L.Children.toArray(n.path),p=Yt((E,v)=>C.jsx(Wn,{ref:v,viewBox:t,...l,...E,children:d.length?d:C.jsx("path",{fill:"currentColor",d:i})}));return p.displayName=a,p}const tV=Yt(function(t,i){const{htmlWidth:a,htmlHeight:l,alt:d,...p}=t;return C.jsx("img",{width:a,height:l,ref:i,alt:d,...p})});tV.displayName="NativeImage";const Bh=Yt(function(t,i){const{fallbackSrc:a,fallback:l,src:d,srcSet:p,align:E,fit:v,loading:b,ignoreFallback:w,crossOrigin:A,fallbackStrategy:N="beforeLoadOrError",referrerPolicy:F,...j}=t,B=a!==void 0||l!==void 0,H=b!=null||w||!B,ee=ite({...t,crossOrigin:A,ignoreFallback:H}),K=cNe(ee,N),te={ref:i,objectFit:v,objectPosition:E,...H?j:T0(j,["onError","onLoad"])};return K?l||C.jsx(Lt.img,{as:tV,className:"chakra-image__placeholder",src:a,...te}):C.jsx(Lt.img,{as:tV,src:d,srcSet:p,crossOrigin:A,loading:b,referrerPolicy:F,className:"chakra-image",...te})});Bh.displayName="Image";const ao=Yt(function(t,i){const{htmlSize:a,...l}=t,d=tl("Input",l),p=qi(l),E=rj(p),v=dn("chakra-input",t.className);return C.jsx(Lt.input,{size:a,...E,__css:d.field,ref:i,className:v})});ao.displayName="Input";ao.id="Input";const[tDe,nDe]=Ki({name:"InputGroupStylesContext",errorMessage:`useInputGroupStyles returned is 'undefined'. Seems you forgot to wrap the components in "<InputGroup />" `}),qO=Yt(function(t,i){const a=tl("Input",t),{children:l,className:d,...p}=qi(t),E=dn("chakra-input__group",d),v={},b=JV(l),w=a.field;b.forEach(N=>{a&&(w&&N.type.id==="InputLeftElement"&&(v.paddingStart=w.height??w.h),w&&N.type.id==="InputRightElement"&&(v.paddingEnd=w.height??w.h),N.type.id==="InputRightAddon"&&(v.borderEndRadius=0),N.type.id==="InputLeftAddon"&&(v.borderStartRadius=0))});const A=b.map(N=>{var j,B;const F=oN({size:((j=N.props)==null?void 0:j.size)||t.size,variant:((B=N.props)==null?void 0:B.variant)||t.variant});return N.type.id!=="Input"?L.cloneElement(N,F):L.cloneElement(N,Object.assign(F,v,N.props))});return C.jsx(Lt.div,{className:E,ref:i,__css:{width:"100%",display:"flex",position:"relative",isolation:"isolate",...a.group},"data-group":!0,...p,children:C.jsx(tDe,{value:a,children:A})})});qO.displayName="InputGroup";const rDe=Lt("div",{baseStyle:{display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",top:"0",zIndex:2}}),TN=Yt(function(t,i){const{placement:a="left",...l}=t,d=nDe(),p=d.field,v={[a==="left"?"insetStart":"insetEnd"]:"0",width:(p==null?void 0:p.height)??(p==null?void 0:p.h),height:(p==null?void 0:p.height)??(p==null?void 0:p.h),fontSize:p==null?void 0:p.fontSize,...d.element};return C.jsx(rDe,{ref:i,__css:v,...l})});TN.id="InputElement";TN.displayName="InputElement";const Xw=Yt(function(t,i){const{className:a,...l}=t,d=dn("chakra-input__left-element",a);return C.jsx(TN,{ref:i,placement:"left",className:d,...l})});Xw.id="InputLeftElement";Xw.displayName="InputLeftElement";const Gte=Yt(function(t,i){const{className:a,...l}=t,d=dn("chakra-input__right-element",a);return C.jsx(TN,{ref:i,placement:"right",className:d,...l})});Gte.id="InputRightElement";Gte.displayName="InputRightElement";const Ru=Yt(function(t,i){const a=xl("Link",t),{className:l,isExternal:d,...p}=qi(t);return C.jsx(Lt.a,{target:d?"_blank":void 0,rel:d?"noopener":void 0,ref:i,className:dn("chakra-link",l),...p,__css:a})});Ru.displayName="Link";function iDe(n,t={}){const{ssr:i=!0,fallback:a}=t,{getWindow:l}=MCe(),d=Array.isArray(n)?n:[n];let p=Array.isArray(a)?a:[a];p=p.filter(b=>b!=null);const[E,v]=L.useState(()=>d.map((b,w)=>({media:b,matches:i?!!p[w]:l().matchMedia(b).matches})));return L.useEffect(()=>{const b=l();v(d.map(N=>({media:N,matches:b.matchMedia(N).matches})));const w=d.map(N=>b.matchMedia(N)),A=N=>{v(F=>F.slice().map(j=>j.media===N.media?{...j,matches:N.matches}:j))};return w.forEach(N=>{typeof N.addListener=="function"?N.addListener(A):N.addEventListener("change",A)}),()=>{w.forEach(N=>{typeof N.removeListener=="function"?N.removeListener(A):N.removeEventListener("change",A)})}},[l]),E.map(b=>b.matches)}function oDe(n,t,i,a){if(t==null)return a;if(!a)return n.find(p=>i(p).toLowerCase().startsWith(t.toLowerCase()));const l=n.filter(d=>i(d).toLowerCase().startsWith(t.toLowerCase()));if(l.length>0){let d;return l.includes(a)?(d=l.indexOf(a)+1,d===l.length&&(d=0),l[d]):(d=n.indexOf(l[0]),n[d])}return a}function sDe(n){const{key:t}=n;return t.length===1||t.length>1&&/[^a-zA-Z0-9]/.test(t)}function aDe(n={}){const{timeout:t=300,preventDefault:i=()=>!0}=n,[a,l]=L.useState([]),d=L.useRef(void 0),p=()=>{d.current&&(clearTimeout(d.current),d.current=null)},E=()=>{p(),d.current=setTimeout(()=>{l([]),d.current=null},t)};L.useEffect(()=>p,[]);function v(b){return w=>{if(w.key==="Backspace"){const A=[...a];A.pop(),l(A);return}if(sDe(w)){const A=a.concat(w.key);i(w)&&(w.preventDefault(),w.stopPropagation()),l(A),b(A.join("")),E()}}}return v}var Jc="top",ku="bottom",Nu="right",Qc="left",_j="auto",XR=[Jc,ku,Nu,Qc],c0="start",bR="end",cDe="clippingParents",Hte="viewport",aw="popper",lDe="reference",yY=XR.reduce(function(n,t){return n.concat([t+"-"+c0,t+"-"+bR])},[]),$te=[].concat(XR,[_j]).reduce(function(n,t){return n.concat([t,t+"-"+c0,t+"-"+bR])},[]),uDe="beforeRead",dDe="read",hDe="afterRead",fDe="beforeMain",pDe="main",mDe="afterMain",gDe="beforeWrite",_De="write",EDe="afterWrite",yDe=[uDe,dDe,hDe,fDe,pDe,mDe,gDe,_De,EDe];function tf(n){return n?(n.nodeName||"").toLowerCase():null}function Dl(n){if(n==null)return window;if(n.toString()!=="[object Window]"){var t=n.ownerDocument;return t&&t.defaultView||window}return n}function IE(n){var t=Dl(n).Element;return n instanceof t||n instanceof Element}function Iu(n){var t=Dl(n).HTMLElement;return n instanceof t||n instanceof HTMLElement}function Ej(n){if(typeof ShadowRoot>"u")return!1;var t=Dl(n).ShadowRoot;return n instanceof t||n instanceof ShadowRoot}function vDe(n){var t=n.state;Object.keys(t.elements).forEach(function(i){var a=t.styles[i]||{},l=t.attributes[i]||{},d=t.elements[i];!Iu(d)||!tf(d)||(Object.assign(d.style,a),Object.keys(l).forEach(function(p){var E=l[p];E===!1?d.removeAttribute(p):d.setAttribute(p,E===!0?"":E)}))})}function SDe(n){var t=n.state,i={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(t.elements.popper.style,i.popper),t.styles=i,t.elements.arrow&&Object.assign(t.elements.arrow.style,i.arrow),function(){Object.keys(t.elements).forEach(function(a){var l=t.elements[a],d=t.attributes[a]||{},p=Object.keys(t.styles.hasOwnProperty(a)?t.styles[a]:i[a]),E=p.reduce(function(v,b){return v[b]="",v},{});!Iu(l)||!tf(l)||(Object.assign(l.style,E),Object.keys(d).forEach(function(v){l.removeAttribute(v)}))})}}const bDe={name:"applyStyles",enabled:!0,phase:"write",fn:vDe,effect:SDe,requires:["computeStyles"]};function qh(n){return n.split("-")[0]}var SE=Math.max,Ak=Math.min,l0=Math.round;function nV(){var n=navigator.userAgentData;return n!=null&&n.brands&&Array.isArray(n.brands)?n.brands.map(function(t){return t.brand+"/"+t.version}).join(" "):navigator.userAgent}function Kte(){return!/^((?!chrome|android).)*safari/i.test(nV())}function u0(n,t,i){t===void 0&&(t=!1),i===void 0&&(i=!1);var a=n.getBoundingClientRect(),l=1,d=1;t&&Iu(n)&&(l=n.offsetWidth>0&&l0(a.width)/n.offsetWidth||1,d=n.offsetHeight>0&&l0(a.height)/n.offsetHeight||1);var p=IE(n)?Dl(n):window,E=p.visualViewport,v=!Kte()&&i,b=(a.left+(v&&E?E.offsetLeft:0))/l,w=(a.top+(v&&E?E.offsetTop:0))/d,A=a.width/l,N=a.height/d;return{width:A,height:N,top:w,right:b+A,bottom:w+N,left:b,x:b,y:w}}function yj(n){var t=u0(n),i=n.offsetWidth,a=n.offsetHeight;return Math.abs(t.width-i)<=1&&(i=t.width),Math.abs(t.height-a)<=1&&(a=t.height),{x:n.offsetLeft,y:n.offsetTop,width:i,height:a}}function qte(n,t){var i=t.getRootNode&&t.getRootNode();if(n.contains(t))return!0;if(i&&Ej(i)){var a=t;do{if(a&&n.isSameNode(a))return!0;a=a.parentNode||a.host}while(a)}return!1}function Pp(n){return Dl(n).getComputedStyle(n)}function TDe(n){return["table","td","th"].indexOf(tf(n))>=0}function Ig(n){return((IE(n)?n.ownerDocument:n.document)||window.document).documentElement}function wN(n){return tf(n)==="html"?n:n.assignedSlot||n.parentNode||(Ej(n)?n.host:null)||Ig(n)}function vY(n){return!Iu(n)||Pp(n).position==="fixed"?null:n.offsetParent}function wDe(n){var t=/firefox/i.test(nV()),i=/Trident/i.test(nV());if(i&&Iu(n)){var a=Pp(n);if(a.position==="fixed")return null}var l=wN(n);for(Ej(l)&&(l=l.host);Iu(l)&&["html","body"].indexOf(tf(l))<0;){var d=Pp(l);if(d.transform!=="none"||d.perspective!=="none"||d.contain==="paint"||["transform","perspective"].indexOf(d.willChange)!==-1||t&&d.willChange==="filter"||t&&d.filter&&d.filter!=="none")return l;l=l.parentNode}return null}function JR(n){for(var t=Dl(n),i=vY(n);i&&TDe(i)&&Pp(i).position==="static";)i=vY(i);return i&&(tf(i)==="html"||tf(i)==="body"&&Pp(i).position==="static")?t:i||wDe(n)||t}function vj(n){return["top","bottom"].indexOf(n)>=0?"x":"y"}function Jw(n,t,i){return SE(n,Ak(t,i))}function RDe(n,t,i){var a=Jw(n,t,i);return a>i?i:a}function Yte(){return{top:0,right:0,bottom:0,left:0}}function Xte(n){return Object.assign({},Yte(),n)}function Jte(n,t){return t.reduce(function(i,a){return i[a]=n,i},{})}var CDe=function(t,i){return t=typeof t=="function"?t(Object.assign({},i.rects,{placement:i.placement})):t,Xte(typeof t!="number"?t:Jte(t,XR))};function IDe(n){var t,i=n.state,a=n.name,l=n.options,d=i.elements.arrow,p=i.modifiersData.popperOffsets,E=qh(i.placement),v=vj(E),b=[Qc,Nu].indexOf(E)>=0,w=b?"height":"width";if(!(!d||!p)){var A=CDe(l.padding,i),N=yj(d),F=v==="y"?Jc:Qc,j=v==="y"?ku:Nu,B=i.rects.reference[w]+i.rects.reference[v]-p[v]-i.rects.popper[w],H=p[v]-i.rects.reference[v],ee=JR(d),K=ee?v==="y"?ee.clientHeight||0:ee.clientWidth||0:0,te=B/2-H/2,le=A[F],oe=K-N[w]-A[j],ge=K/2-N[w]/2+te,Z=Jw(le,ge,oe),Q=v;i.modifiersData[a]=(t={},t[Q]=Z,t.centerOffset=Z-ge,t)}}function ADe(n){var t=n.state,i=n.options,a=i.element,l=a===void 0?"[data-popper-arrow]":a;l!=null&&(typeof l=="string"&&(l=t.elements.popper.querySelector(l),!l)||qte(t.elements.popper,l)&&(t.elements.arrow=l))}const PDe={name:"arrow",enabled:!0,phase:"main",fn:IDe,effect:ADe,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function d0(n){return n.split("-")[1]}var ODe={top:"auto",right:"auto",bottom:"auto",left:"auto"};function kDe(n,t){var i=n.x,a=n.y,l=t.devicePixelRatio||1;return{x:l0(i*l)/l||0,y:l0(a*l)/l||0}}function SY(n){var t,i=n.popper,a=n.popperRect,l=n.placement,d=n.variation,p=n.offsets,E=n.position,v=n.gpuAcceleration,b=n.adaptive,w=n.roundOffsets,A=n.isFixed,N=p.x,F=N===void 0?0:N,j=p.y,B=j===void 0?0:j,H=typeof w=="function"?w({x:F,y:B}):{x:F,y:B};F=H.x,B=H.y;var ee=p.hasOwnProperty("x"),K=p.hasOwnProperty("y"),te=Qc,le=Jc,oe=window;if(b){var ge=JR(i),Z="clientHeight",Q="clientWidth";if(ge===Dl(i)&&(ge=Ig(i),Pp(ge).position!=="static"&&E==="absolute"&&(Z="scrollHeight",Q="scrollWidth")),ge=ge,l===Jc||(l===Qc||l===Nu)&&d===bR){le=ku;var ne=A&&ge===oe&&oe.visualViewport?oe.visualViewport.height:ge[Z];B-=ne-a.height,B*=v?1:-1}if(l===Qc||(l===Jc||l===ku)&&d===bR){te=Nu;var se=A&&ge===oe&&oe.visualViewport?oe.visualViewport.width:ge[Q];F-=se-a.width,F*=v?1:-1}}var fe=Object.assign({position:E},b&&ODe),he=w===!0?kDe({x:F,y:B},Dl(i)):{x:F,y:B};if(F=he.x,B=he.y,v){var ue;return Object.assign({},fe,(ue={},ue[le]=K?"0":"",ue[te]=ee?"0":"",ue.transform=(oe.devicePixelRatio||1)<=1?"translate("+F+"px, "+B+"px)":"translate3d("+F+"px, "+B+"px, 0)",ue))}return Object.assign({},fe,(t={},t[le]=K?B+"px":"",t[te]=ee?F+"px":"",t.transform="",t))}function NDe(n){var t=n.state,i=n.options,a=i.gpuAcceleration,l=a===void 0?!0:a,d=i.adaptive,p=d===void 0?!0:d,E=i.roundOffsets,v=E===void 0?!0:E,b={placement:qh(t.placement),variation:d0(t.placement),popper:t.elements.popper,popperRect:t.rects.popper,gpuAcceleration:l,isFixed:t.options.strategy==="fixed"};t.modifiersData.popperOffsets!=null&&(t.styles.popper=Object.assign({},t.styles.popper,SY(Object.assign({},b,{offsets:t.modifiersData.popperOffsets,position:t.options.strategy,adaptive:p,roundOffsets:v})))),t.modifiersData.arrow!=null&&(t.styles.arrow=Object.assign({},t.styles.arrow,SY(Object.assign({},b,{offsets:t.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:v})))),t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-placement":t.placement})}const DDe={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:NDe,data:{}};var hO={passive:!0};function LDe(n){var t=n.state,i=n.instance,a=n.options,l=a.scroll,d=l===void 0?!0:l,p=a.resize,E=p===void 0?!0:p,v=Dl(t.elements.popper),b=[].concat(t.scrollParents.reference,t.scrollParents.popper);return d&&b.forEach(function(w){w.addEventListener("scroll",i.update,hO)}),E&&v.addEventListener("resize",i.update,hO),function(){d&&b.forEach(function(w){w.removeEventListener("scroll",i.update,hO)}),E&&v.removeEventListener("resize",i.update,hO)}}const xDe={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:LDe,data:{}};var MDe={left:"right",right:"left",bottom:"top",top:"bottom"};function YO(n){return n.replace(/left|right|bottom|top/g,function(t){return MDe[t]})}var UDe={start:"end",end:"start"};function bY(n){return n.replace(/start|end/g,function(t){return UDe[t]})}function Sj(n){var t=Dl(n),i=t.pageXOffset,a=t.pageYOffset;return{scrollLeft:i,scrollTop:a}}function bj(n){return u0(Ig(n)).left+Sj(n).scrollLeft}function VDe(n,t){var i=Dl(n),a=Ig(n),l=i.visualViewport,d=a.clientWidth,p=a.clientHeight,E=0,v=0;if(l){d=l.width,p=l.height;var b=Kte();(b||!b&&t==="fixed")&&(E=l.offsetLeft,v=l.offsetTop)}return{width:d,height:p,x:E+bj(n),y:v}}function FDe(n){var t,i=Ig(n),a=Sj(n),l=(t=n.ownerDocument)==null?void 0:t.body,d=SE(i.scrollWidth,i.clientWidth,l?l.scrollWidth:0,l?l.clientWidth:0),p=SE(i.scrollHeight,i.clientHeight,l?l.scrollHeight:0,l?l.clientHeight:0),E=-a.scrollLeft+bj(n),v=-a.scrollTop;return Pp(l||i).direction==="rtl"&&(E+=SE(i.clientWidth,l?l.clientWidth:0)-d),{width:d,height:p,x:E,y:v}}function Tj(n){var t=Pp(n),i=t.overflow,a=t.overflowX,l=t.overflowY;return/auto|scroll|overlay|hidden/.test(i+l+a)}function Qte(n){return["html","body","#document"].indexOf(tf(n))>=0?n.ownerDocument.body:Iu(n)&&Tj(n)?n:Qte(wN(n))}function Qw(n,t){var i;t===void 0&&(t=[]);var a=Qte(n),l=a===((i=n.ownerDocument)==null?void 0:i.body),d=Dl(a),p=l?[d].concat(d.visualViewport||[],Tj(a)?a:[]):a,E=t.concat(p);return l?E:E.concat(Qw(wN(p)))}function rV(n){return Object.assign({},n,{left:n.x,top:n.y,right:n.x+n.width,bottom:n.y+n.height})}function jDe(n,t){var i=u0(n,!1,t==="fixed");return i.top=i.top+n.clientTop,i.left=i.left+n.clientLeft,i.bottom=i.top+n.clientHeight,i.right=i.left+n.clientWidth,i.width=n.clientWidth,i.height=n.clientHeight,i.x=i.left,i.y=i.top,i}function TY(n,t,i){return t===Hte?rV(VDe(n,i)):IE(t)?jDe(t,i):rV(FDe(Ig(n)))}function BDe(n){var t=Qw(wN(n)),i=["absolute","fixed"].indexOf(Pp(n).position)>=0,a=i&&Iu(n)?JR(n):n;return IE(a)?t.filter(function(l){return IE(l)&&qte(l,a)&&tf(l)!=="body"}):[]}function WDe(n,t,i,a){var l=t==="clippingParents"?BDe(n):[].concat(t),d=[].concat(l,[i]),p=d[0],E=d.reduce(function(v,b){var w=TY(n,b,a);return v.top=SE(w.top,v.top),v.right=Ak(w.right,v.right),v.bottom=Ak(w.bottom,v.bottom),v.left=SE(w.left,v.left),v},TY(n,p,a));return E.width=E.right-E.left,E.height=E.bottom-E.top,E.x=E.left,E.y=E.top,E}function Zte(n){var t=n.reference,i=n.element,a=n.placement,l=a?qh(a):null,d=a?d0(a):null,p=t.x+t.width/2-i.width/2,E=t.y+t.height/2-i.height/2,v;switch(l){case Jc:v={x:p,y:t.y-i.height};break;case ku:v={x:p,y:t.y+t.height};break;case Nu:v={x:t.x+t.width,y:E};break;case Qc:v={x:t.x-i.width,y:E};break;default:v={x:t.x,y:t.y}}var b=l?vj(l):null;if(b!=null){var w=b==="y"?"height":"width";switch(d){case c0:v[b]=v[b]-(t[w]/2-i[w]/2);break;case bR:v[b]=v[b]+(t[w]/2-i[w]/2);break}}return v}function TR(n,t){t===void 0&&(t={});var i=t,a=i.placement,l=a===void 0?n.placement:a,d=i.strategy,p=d===void 0?n.strategy:d,E=i.boundary,v=E===void 0?cDe:E,b=i.rootBoundary,w=b===void 0?Hte:b,A=i.elementContext,N=A===void 0?aw:A,F=i.altBoundary,j=F===void 0?!1:F,B=i.padding,H=B===void 0?0:B,ee=Xte(typeof H!="number"?H:Jte(H,XR)),K=N===aw?lDe:aw,te=n.rects.popper,le=n.elements[j?K:N],oe=WDe(IE(le)?le:le.contextElement||Ig(n.elements.popper),v,w,p),ge=u0(n.elements.reference),Z=Zte({reference:ge,element:te,placement:l}),Q=rV(Object.assign({},te,Z)),ne=N===aw?Q:ge,se={top:oe.top-ne.top+ee.top,bottom:ne.bottom-oe.bottom+ee.bottom,left:oe.left-ne.left+ee.left,right:ne.right-oe.right+ee.right},fe=n.modifiersData.offset;if(N===aw&&fe){var he=fe[l];Object.keys(se).forEach(function(ue){var Me=[Nu,ku].indexOf(ue)>=0?1:-1,He=[Jc,ku].indexOf(ue)>=0?"y":"x";se[ue]+=he[He]*Me})}return se}function zDe(n,t){t===void 0&&(t={});var i=t,a=i.placement,l=i.boundary,d=i.rootBoundary,p=i.padding,E=i.flipVariations,v=i.allowedAutoPlacements,b=v===void 0?$te:v,w=d0(a),A=w?E?yY:yY.filter(function(j){return d0(j)===w}):XR,N=A.filter(function(j){return b.indexOf(j)>=0});N.length===0&&(N=A);var F=N.reduce(function(j,B){return j[B]=TR(n,{placement:B,boundary:l,rootBoundary:d,padding:p})[qh(B)],j},{});return Object.keys(F).sort(function(j,B){return F[j]-F[B]})}function GDe(n){if(qh(n)===_j)return[];var t=YO(n);return[bY(n),t,bY(t)]}function HDe(n){var t=n.state,i=n.options,a=n.name;if(!t.modifiersData[a]._skip){for(var l=i.mainAxis,d=l===void 0?!0:l,p=i.altAxis,E=p===void 0?!0:p,v=i.fallbackPlacements,b=i.padding,w=i.boundary,A=i.rootBoundary,N=i.altBoundary,F=i.flipVariations,j=F===void 0?!0:F,B=i.allowedAutoPlacements,H=t.options.placement,ee=qh(H),K=ee===H,te=v||(K||!j?[YO(H)]:GDe(H)),le=[H].concat(te).reduce(function(Ue,ze){return Ue.concat(qh(ze)===_j?zDe(t,{placement:ze,boundary:w,rootBoundary:A,padding:b,flipVariations:j,allowedAutoPlacements:B}):ze)},[]),oe=t.rects.reference,ge=t.rects.popper,Z=new Map,Q=!0,ne=le[0],se=0;se<le.length;se++){var fe=le[se],he=qh(fe),ue=d0(fe)===c0,Me=[Jc,ku].indexOf(he)>=0,He=Me?"width":"height",rt=TR(t,{placement:fe,boundary:w,rootBoundary:A,altBoundary:N,padding:b}),we=Me?ue?Nu:Qc:ue?ku:Jc;oe[He]>ge[He]&&(we=YO(we));var Ce=YO(we),ye=[];if(d&&ye.push(rt[he]<=0),E&&ye.push(rt[we]<=0,rt[Ce]<=0),ye.every(function(Ue){return Ue})){ne=fe,Q=!1;break}Z.set(fe,ye)}if(Q)for(var Ne=j?3:1,be=function(ze){var et=le.find(function(nt){var dt=Z.get(nt);if(dt)return dt.slice(0,ze).every(function(Xe){return Xe})});if(et)return ne=et,"break"},Se=Ne;Se>0;Se--){var Ae=be(Se);if(Ae==="break")break}t.placement!==ne&&(t.modifiersData[a]._skip=!0,t.placement=ne,t.reset=!0)}}const $De={name:"flip",enabled:!0,phase:"main",fn:HDe,requiresIfExists:["offset"],data:{_skip:!1}};function wY(n,t,i){return i===void 0&&(i={x:0,y:0}),{top:n.top-t.height-i.y,right:n.right-t.width+i.x,bottom:n.bottom-t.height+i.y,left:n.left-t.width-i.x}}function RY(n){return[Jc,Nu,ku,Qc].some(function(t){return n[t]>=0})}function KDe(n){var t=n.state,i=n.name,a=t.rects.reference,l=t.rects.popper,d=t.modifiersData.preventOverflow,p=TR(t,{elementContext:"reference"}),E=TR(t,{altBoundary:!0}),v=wY(p,a),b=wY(E,l,d),w=RY(v),A=RY(b);t.modifiersData[i]={referenceClippingOffsets:v,popperEscapeOffsets:b,isReferenceHidden:w,hasPopperEscaped:A},t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-reference-hidden":w,"data-popper-escaped":A})}const qDe={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:KDe};function YDe(n,t,i){var a=qh(n),l=[Qc,Jc].indexOf(a)>=0?-1:1,d=typeof i=="function"?i(Object.assign({},t,{placement:n})):i,p=d[0],E=d[1];return p=p||0,E=(E||0)*l,[Qc,Nu].indexOf(a)>=0?{x:E,y:p}:{x:p,y:E}}function XDe(n){var t=n.state,i=n.options,a=n.name,l=i.offset,d=l===void 0?[0,0]:l,p=$te.reduce(function(w,A){return w[A]=YDe(A,t.rects,d),w},{}),E=p[t.placement],v=E.x,b=E.y;t.modifiersData.popperOffsets!=null&&(t.modifiersData.popperOffsets.x+=v,t.modifiersData.popperOffsets.y+=b),t.modifiersData[a]=p}const JDe={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:XDe};function QDe(n){var t=n.state,i=n.name;t.modifiersData[i]=Zte({reference:t.rects.reference,element:t.rects.popper,placement:t.placement})}const ZDe={name:"popperOffsets",enabled:!0,phase:"read",fn:QDe,data:{}};function eLe(n){return n==="x"?"y":"x"}function tLe(n){var t=n.state,i=n.options,a=n.name,l=i.mainAxis,d=l===void 0?!0:l,p=i.altAxis,E=p===void 0?!1:p,v=i.boundary,b=i.rootBoundary,w=i.altBoundary,A=i.padding,N=i.tether,F=N===void 0?!0:N,j=i.tetherOffset,B=j===void 0?0:j,H=TR(t,{boundary:v,rootBoundary:b,padding:A,altBoundary:w}),ee=qh(t.placement),K=d0(t.placement),te=!K,le=vj(ee),oe=eLe(le),ge=t.modifiersData.popperOffsets,Z=t.rects.reference,Q=t.rects.popper,ne=typeof B=="function"?B(Object.assign({},t.rects,{placement:t.placement})):B,se=typeof ne=="number"?{mainAxis:ne,altAxis:ne}:Object.assign({mainAxis:0,altAxis:0},ne),fe=t.modifiersData.offset?t.modifiersData.offset[t.placement]:null,he={x:0,y:0};if(ge){if(d){var ue,Me=le==="y"?Jc:Qc,He=le==="y"?ku:Nu,rt=le==="y"?"height":"width",we=ge[le],Ce=we+H[Me],ye=we-H[He],Ne=F?-Q[rt]/2:0,be=K===c0?Z[rt]:Q[rt],Se=K===c0?-Q[rt]:-Z[rt],Ae=t.elements.arrow,Ue=F&&Ae?yj(Ae):{width:0,height:0},ze=t.modifiersData["arrow#persistent"]?t.modifiersData["arrow#persistent"].padding:Yte(),et=ze[Me],nt=ze[He],dt=Jw(0,Z[rt],Ue[rt]),Xe=te?Z[rt]/2-Ne-dt-et-se.mainAxis:be-dt-et-se.mainAxis,It=te?-Z[rt]/2+Ne+dt+nt+se.mainAxis:Se+dt+nt+se.mainAxis,hn=t.elements.arrow&&JR(t.elements.arrow),Ut=hn?le==="y"?hn.clientTop||0:hn.clientLeft||0:0,ln=(ue=fe==null?void 0:fe[le])!=null?ue:0,Ln=we+Xe-ln-Ut,Xt=we+It-ln,Yn=Jw(F?Ak(Ce,Ln):Ce,we,F?SE(ye,Xt):ye);ge[le]=Yn,he[le]=Yn-we}if(E){var Kt,Re=le==="x"?Jc:Qc,Fe=le==="x"?ku:Nu,Ke=ge[oe],yt=oe==="y"?"height":"width",St=Ke+H[Re],Ge=Ke-H[Fe],Ot=[Jc,Qc].indexOf(ee)!==-1,Jt=(Kt=fe==null?void 0:fe[oe])!=null?Kt:0,fn=Ot?St:Ke-Z[yt]-Q[yt]-Jt+se.altAxis,an=Ot?Ke+Z[yt]+Q[yt]-Jt-se.altAxis:Ge,ir=F&&Ot?RDe(fn,Ke,an):Jw(F?fn:St,Ke,F?an:Ge);ge[oe]=ir,he[oe]=ir-Ke}t.modifiersData[a]=he}}const nLe={name:"preventOverflow",enabled:!0,phase:"main",fn:tLe,requiresIfExists:["offset"]};function rLe(n){return{scrollLeft:n.scrollLeft,scrollTop:n.scrollTop}}function iLe(n){return n===Dl(n)||!Iu(n)?Sj(n):rLe(n)}function oLe(n){var t=n.getBoundingClientRect(),i=l0(t.width)/n.offsetWidth||1,a=l0(t.height)/n.offsetHeight||1;return i!==1||a!==1}function sLe(n,t,i){i===void 0&&(i=!1);var a=Iu(t),l=Iu(t)&&oLe(t),d=Ig(t),p=u0(n,l,i),E={scrollLeft:0,scrollTop:0},v={x:0,y:0};return(a||!a&&!i)&&((tf(t)!=="body"||Tj(d))&&(E=iLe(t)),Iu(t)?(v=u0(t,!0),v.x+=t.clientLeft,v.y+=t.clientTop):d&&(v.x=bj(d))),{x:p.left+E.scrollLeft-v.x,y:p.top+E.scrollTop-v.y,width:p.width,height:p.height}}function aLe(n){var t=new Map,i=new Set,a=[];n.forEach(function(d){t.set(d.name,d)});function l(d){i.add(d.name);var p=[].concat(d.requires||[],d.requiresIfExists||[]);p.forEach(function(E){if(!i.has(E)){var v=t.get(E);v&&l(v)}}),a.push(d)}return n.forEach(function(d){i.has(d.name)||l(d)}),a}function cLe(n){var t=aLe(n);return yDe.reduce(function(i,a){return i.concat(t.filter(function(l){return l.phase===a}))},[])}function lLe(n){var t;return function(){return t||(t=new Promise(function(i){Promise.resolve().then(function(){t=void 0,i(n())})})),t}}function uLe(n){var t=n.reduce(function(i,a){var l=i[a.name];return i[a.name]=l?Object.assign({},l,a,{options:Object.assign({},l.options,a.options),data:Object.assign({},l.data,a.data)}):a,i},{});return Object.keys(t).map(function(i){return t[i]})}var CY={placement:"bottom",modifiers:[],strategy:"absolute"};function IY(){for(var n=arguments.length,t=new Array(n),i=0;i<n;i++)t[i]=arguments[i];return!t.some(function(a){return!(a&&typeof a.getBoundingClientRect=="function")})}function dLe(n){n===void 0&&(n={});var t=n,i=t.defaultModifiers,a=i===void 0?[]:i,l=t.defaultOptions,d=l===void 0?CY:l;return function(E,v,b){b===void 0&&(b=d);var w={placement:"bottom",orderedModifiers:[],options:Object.assign({},CY,d),modifiersData:{},elements:{reference:E,popper:v},attributes:{},styles:{}},A=[],N=!1,F={state:w,setOptions:function(ee){var K=typeof ee=="function"?ee(w.options):ee;B(),w.options=Object.assign({},d,w.options,K),w.scrollParents={reference:IE(E)?Qw(E):E.contextElement?Qw(E.contextElement):[],popper:Qw(v)};var te=cLe(uLe([].concat(a,w.options.modifiers)));return w.orderedModifiers=te.filter(function(le){return le.enabled}),j(),F.update()},forceUpdate:function(){if(!N){var ee=w.elements,K=ee.reference,te=ee.popper;if(IY(K,te)){w.rects={reference:sLe(K,JR(te),w.options.strategy==="fixed"),popper:yj(te)},w.reset=!1,w.placement=w.options.placement,w.orderedModifiers.forEach(function(se){return w.modifiersData[se.name]=Object.assign({},se.data)});for(var le=0;le<w.orderedModifiers.length;le++){if(w.reset===!0){w.reset=!1,le=-1;continue}var oe=w.orderedModifiers[le],ge=oe.fn,Z=oe.options,Q=Z===void 0?{}:Z,ne=oe.name;typeof ge=="function"&&(w=ge({state:w,options:Q,name:ne,instance:F})||w)}}}},update:lLe(function(){return new Promise(function(H){F.forceUpdate(),H(w)})}),destroy:function(){B(),N=!0}};if(!IY(E,v))return F;F.setOptions(b).then(function(H){!N&&b.onFirstUpdate&&b.onFirstUpdate(H)});function j(){w.orderedModifiers.forEach(function(H){var ee=H.name,K=H.options,te=K===void 0?{}:K,le=H.effect;if(typeof le=="function"){var oe=le({state:w,name:ee,instance:F,options:te}),ge=function(){};A.push(oe||ge)}})}function B(){A.forEach(function(H){return H()}),A=[]}return F}}var hLe=[xDe,ZDe,DDe,bDe,JDe,$De,nLe,PDe,qDe],fLe=dLe({defaultModifiers:hLe});const uS=(n,t)=>({var:n,varRef:t?`var(${n}, ${t})`:`var(${n})`}),Ko={arrowShadowColor:uS("--popper-arrow-shadow-color"),arrowSize:uS("--popper-arrow-size","8px"),arrowSizeHalf:uS("--popper-arrow-size-half"),arrowBg:uS("--popper-arrow-bg"),transformOrigin:uS("--popper-transform-origin"),arrowOffset:uS("--popper-arrow-offset")};function pLe(n){if(n.includes("top"))return"1px 1px 0px 0 var(--popper-arrow-shadow-color)";if(n.includes("bottom"))return"-1px -1px 0px 0 var(--popper-arrow-shadow-color)";if(n.includes("right"))return"-1px 1px 0px 0 var(--popper-arrow-shadow-color)";if(n.includes("left"))return"1px -1px 0px 0 var(--popper-arrow-shadow-color)"}const mLe={top:"bottom center","top-start":"bottom left","top-end":"bottom right",bottom:"top center","bottom-start":"top left","bottom-end":"top right",left:"right center","left-start":"right top","left-end":"right bottom",right:"left center","right-start":"left top","right-end":"left bottom"},gLe=n=>mLe[n],AY={scroll:!0,resize:!0};function _Le(n){let t;return typeof n=="object"?t={enabled:!0,options:{...AY,...n}}:t={enabled:n,options:AY},t}const ELe={name:"matchWidth",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:({state:n})=>{n.styles.popper.width=`${n.rects.reference.width}px`},effect:({state:n})=>()=>{const t=n.elements.reference;n.elements.popper.style.width=`${t.offsetWidth}px`}},yLe={name:"transformOrigin",enabled:!0,phase:"write",fn:({state:n})=>{PY(n)},effect:({state:n})=>()=>{PY(n)}},PY=n=>{n.elements.popper.style.setProperty(Ko.transformOrigin.var,gLe(n.placement))},vLe={name:"positionArrow",enabled:!0,phase:"afterWrite",fn:({state:n})=>{SLe(n)}},SLe=n=>{var i;if(!n.placement)return;const t=bLe(n.placement);if((i=n.elements)!=null&&i.arrow&&t){Object.assign(n.elements.arrow.style,{[t.property]:t.value,width:Ko.arrowSize.varRef,height:Ko.arrowSize.varRef,zIndex:-1});const a={[Ko.arrowSizeHalf.var]:`calc(${Ko.arrowSize.varRef} / 2 - 1px)`,[Ko.arrowOffset.var]:`calc(${Ko.arrowSizeHalf.varRef} * -1)`};for(const l in a)n.elements.arrow.style.setProperty(l,a[l])}},bLe=n=>{if(n.startsWith("top"))return{property:"bottom",value:Ko.arrowOffset.varRef};if(n.startsWith("bottom"))return{property:"top",value:Ko.arrowOffset.varRef};if(n.startsWith("left"))return{property:"right",value:Ko.arrowOffset.varRef};if(n.startsWith("right"))return{property:"left",value:Ko.arrowOffset.varRef}},TLe={name:"innerArrow",enabled:!0,phase:"main",requires:["arrow"],fn:({state:n})=>{OY(n)},effect:({state:n})=>()=>{OY(n)}},OY=n=>{if(!n.elements.arrow)return;const t=n.elements.arrow.querySelector("[data-popper-arrow-inner]");if(!t)return;const i=pLe(n.placement);i&&t.style.setProperty("--popper-arrow-default-shadow",i),Object.assign(t.style,{transform:"rotate(45deg)",background:Ko.arrowBg.varRef,top:0,left:0,width:"100%",height:"100%",position:"absolute",zIndex:"inherit",boxShadow:"var(--popper-arrow-shadow, var(--popper-arrow-default-shadow))"})},wLe={"start-start":{ltr:"left-start",rtl:"right-start"},"start-end":{ltr:"left-end",rtl:"right-end"},"end-start":{ltr:"right-start",rtl:"left-start"},"end-end":{ltr:"right-end",rtl:"left-end"},start:{ltr:"left",rtl:"right"},end:{ltr:"right",rtl:"left"}},RLe={"auto-start":"auto-end","auto-end":"auto-start","top-start":"top-end","top-end":"top-start","bottom-start":"bottom-end","bottom-end":"bottom-start"};function CLe(n,t="ltr"){var a;const i=((a=wLe[n])==null?void 0:a[t])||n;return t==="ltr"?i:RLe[n]??i}function wj(n={}){const{enabled:t=!0,modifiers:i,placement:a="bottom",strategy:l="absolute",arrowPadding:d=8,eventListeners:p=!0,offset:E,gutter:v=8,flip:b=!0,boundary:w="clippingParents",preventOverflow:A=!0,matchWidth:N,direction:F="ltr"}=n,j=L.useRef(null),B=L.useRef(null),H=L.useRef(null),ee=CLe(a,F),K=L.useRef(()=>{}),te=L.useCallback(()=>{var se;!t||!j.current||!B.current||((se=K.current)==null||se.call(K),H.current=fLe(j.current,B.current,{placement:ee,modifiers:[TLe,vLe,yLe,{...ELe,enabled:!!N},{name:"eventListeners",..._Le(p)},{name:"arrow",options:{padding:d}},{name:"offset",options:{offset:E??[0,v]}},{name:"flip",enabled:!!b,options:{padding:8}},{name:"preventOverflow",enabled:!!A,options:{boundary:w}},...i??[]],strategy:l}),H.current.forceUpdate(),K.current=H.current.destroy)},[ee,t,i,N,p,d,E,v,b,A,w,l]);L.useEffect(()=>()=>{var se;!j.current&&!B.current&&((se=H.current)==null||se.destroy(),H.current=null)},[]);const le=L.useCallback(se=>{j.current=se,te()},[te]),oe=L.useCallback((se={},fe=null)=>({...se,ref:to(le,fe)}),[le]),ge=L.useCallback(se=>{B.current=se,te()},[te]),Z=L.useCallback((se={},fe=null)=>({...se,ref:to(ge,fe),style:{...se.style,position:l,minWidth:N?void 0:"max-content",inset:"0 auto auto 0"}}),[l,ge,N]),Q=L.useCallback((se={},fe=null)=>{const{size:he,shadowColor:ue,bg:Me,style:He,...rt}=se;return{...rt,ref:fe,"data-popper-arrow":"",style:ILe(se)}},[]),ne=L.useCallback((se={},fe=null)=>({...se,ref:fe,"data-popper-arrow-inner":""}),[]);return{update(){var se;(se=H.current)==null||se.update()},forceUpdate(){var se;(se=H.current)==null||se.forceUpdate()},transformOrigin:Ko.transformOrigin.varRef,referenceRef:le,popperRef:ge,getPopperProps:Z,getArrowProps:Q,getArrowInnerProps:ne,getReferenceProps:oe}}function ILe(n){const{size:t,shadowColor:i,bg:a,style:l}=n,d={...l,position:"absolute"};return t&&(d["--popper-arrow-size"]=t),i&&(d["--popper-arrow-shadow-color"]=i),a&&(d["--popper-arrow-bg"]=a),d}function ALe(){const n=L.useRef(new Map),t=n.current,i=L.useCallback((l,d,p,E)=>{n.current.set(p,{type:d,el:l,options:E}),l.addEventListener(d,p,E)},[]),a=L.useCallback((l,d,p,E)=>{l.removeEventListener(d,p,E),n.current.delete(p)},[]);return L.useEffect(()=>()=>{t.forEach((l,d)=>{a(l.el,l.type,d,l.options)})},[a,t]),{add:i,remove:a}}function V2(n){var l,d;const t=((d=(l=n.composedPath)==null?void 0:l.call(n))==null?void 0:d[0])??n.target,{tagName:i,isContentEditable:a}=t;return i!=="INPUT"&&i!=="TEXTAREA"&&a!==!0}function ene(n={}){const{ref:t,isDisabled:i,isFocusable:a,clickOnEnter:l=!0,clickOnSpace:d=!0,onMouseDown:p,onMouseUp:E,onClick:v,onKeyDown:b,onKeyUp:w,tabIndex:A,onMouseOver:N,onMouseLeave:F,...j}=n,[B,H]=L.useState(!0),[ee,K]=L.useState(!1),te=ALe(),le=we=>{we&&we.tagName!=="BUTTON"&&H(!1)},oe=B?A:A||0,ge=i&&!a,Z=L.useCallback(we=>{if(i){we.stopPropagation(),we.preventDefault();return}we.currentTarget.focus(),v==null||v(we)},[i,v]),Q=L.useCallback(we=>{ee&&V2(we)&&(we.preventDefault(),we.stopPropagation(),K(!1),te.remove(document,"keyup",Q,!1))},[ee,te]),ne=L.useCallback(we=>{if(b==null||b(we),i||we.defaultPrevented||we.metaKey||!V2(we.nativeEvent)||B)return;const Ce=l&&we.key==="Enter";d&&we.key===" "&&(we.preventDefault(),K(!0)),Ce&&(we.preventDefault(),we.currentTarget.click()),te.add(document,"keyup",Q,!1)},[i,B,b,l,d,te,Q]),se=L.useCallback(we=>{if(w==null||w(we),i||we.defaultPrevented||we.metaKey||!V2(we.nativeEvent)||B)return;d&&we.key===" "&&(we.preventDefault(),K(!1),we.currentTarget.click())},[d,B,i,w]),fe=L.useCallback(we=>{we.button===0&&(K(!1),te.remove(document,"mouseup",fe,!1))},[te]),he=L.useCallback(we=>{if(we.button!==0)return;if(i){we.stopPropagation(),we.preventDefault();return}B||K(!0),we.currentTarget.focus({preventScroll:!0}),te.add(document,"mouseup",fe,!1),p==null||p(we)},[i,B,p,te,fe]),ue=L.useCallback(we=>{we.button===0&&(B||K(!1),E==null||E(we))},[E,B]),Me=L.useCallback(we=>{if(i){we.preventDefault();return}N==null||N(we)},[i,N]),He=L.useCallback(we=>{ee&&(we.preventDefault(),K(!1)),F==null||F(we)},[ee,F]),rt=to(t,le);return B?{...j,ref:rt,type:"button","aria-disabled":ge?void 0:i,disabled:ge,onClick:Z,onMouseDown:p,onMouseUp:E,onKeyUp:w,onKeyDown:b,onMouseOver:N,onMouseLeave:F}:{...j,ref:rt,role:"button","data-active":Kn(ee),"aria-disabled":i?"true":void 0,tabIndex:ge?void 0:oe,onClick:Z,onMouseDown:he,onMouseUp:ue,onKeyUp:se,onKeyDown:ne,onMouseOver:Me,onMouseLeave:He}}const[PLe,OLe,kLe,NLe]=ete(),[DLe,QR]=Ki({strict:!1,name:"MenuContext"});function tne(n){return(n==null?void 0:n.ownerDocument)??document}function LLe(n){return tne(n).activeElement===n}function xLe(n={}){const{id:t,closeOnSelect:i=!0,closeOnBlur:a=!0,initialFocusRef:l,autoSelect:d=!0,isLazy:p,isOpen:E,defaultIsOpen:v,onClose:b,onOpen:w,placement:A="bottom-start",lazyBehavior:N="unmount",direction:F,computePositionOnMount:j=!1,...B}=n,H=L.useRef(null),ee=L.useRef(null),K=L.useRef(!0),te=kLe(),le=L.useCallback(()=>{requestAnimationFrame(()=>{var Ae;(Ae=H.current)==null||Ae.focus({preventScroll:!1})})},[]),oe=L.useCallback(()=>{const Ae=setTimeout(()=>{var Ue,ze;if(l)(Ue=l.current)==null||Ue.focus();else if(!te.count())(ze=H.current)==null||ze.focus({preventScroll:!1});else{const et=te.firstEnabled();et&&Me(et.index)}});ye.current.add(Ae)},[te,l]),ge=L.useCallback(()=>{const Ae=setTimeout(()=>{var Ue;if(!te.count())(Ue=H.current)==null||Ue.focus({preventScroll:!1});else{const ze=te.lastEnabled();ze&&Me(ze.index)}});ye.current.add(Ae)},[te]),Z=L.useCallback(()=>{w==null||w(),d?oe():le()},[d,oe,le,w]),{isOpen:Q,onOpen:ne,onClose:se,onToggle:fe}=Cp({isOpen:E,defaultIsOpen:v,onClose:b,onOpen:Z});NQ({enabled:Q&&a,ref:H,handler:Ae=>{var ze,et,nt;const Ue=((et=(ze=Ae.composedPath)==null?void 0:ze.call(Ae))==null?void 0:et[0])??Ae.target;(nt=ee.current)!=null&&nt.contains(Ue)||se()}});const he=wj({...B,enabled:Q||j,placement:A,direction:F}),[ue,Me]=L.useState(-1);PQ(H,{focusRef:ee,visible:Q,shouldFocus:!0});const He=IQ({isOpen:Q,ref:H}),[rt,we]=GEe(t,"menu-button","menu-list"),Ce=L.useCallback(()=>{ne(),le()},[ne,le]),ye=L.useRef(new Set([]));L.useEffect(()=>{const Ae=ye.current;return()=>{Ae.forEach(Ue=>clearTimeout(Ue)),Ae.clear()}},[]),mg(()=>{var Ae;Q||(Me(-1),(Ae=H.current)==null||Ae.scrollTo(0,0))},[Q]),mg(()=>{Q&&ue===-1&&le()},[ue,Q]),L.useEffect(()=>{var Ue;if(!Q)return;const Ae=te.item(ue);(Ue=Ae==null?void 0:Ae.node)==null||Ue.focus({preventScroll:!K.current})},[te,ue,Q]);const Ne=L.useCallback(()=>{ne(),oe()},[oe,ne]),be=L.useCallback(()=>{K.current=!0,ne(),ge()},[ne,ge]),Se=L.useCallback(()=>{var nt,dt;const Ae=tne(H.current),Ue=(nt=H.current)==null?void 0:nt.contains(Ae.activeElement);if(!(Q&&!Ue))return;const et=(dt=te.item(ue))==null?void 0:dt.node;et==null||et.focus({preventScroll:!K.current})},[Q,ue,te]);return{openAndFocusMenu:Ce,openAndFocusFirstItem:Ne,openAndFocusLastItem:be,onTransitionEnd:Se,unstable__animationState:He,descendants:te,popper:he,buttonId:rt,menuId:we,forceUpdate:he.forceUpdate,orientation:"vertical",isOpen:Q,onToggle:fe,onOpen:ne,onClose:se,menuRef:H,buttonRef:ee,focusedIndex:ue,closeOnSelect:i,closeOnBlur:a,autoSelect:d,setFocusedIndex:Me,isLazy:p,lazyBehavior:N,initialFocusRef:l,scrollIntoViewRef:K}}function MLe(n={},t=null){const i=QR(),{onToggle:a,popper:l,openAndFocusFirstItem:d,openAndFocusLastItem:p,scrollIntoViewRef:E}=i,v=L.useCallback(b=>{const w=b.key,N={Enter:d,ArrowDown:d,ArrowUp:p}[w];N&&(E.current=!0,b.preventDefault(),b.stopPropagation(),N(b))},[d,p,E]);return{...n,ref:to(i.buttonRef,t,l.referenceRef),id:i.buttonId,"data-active":Kn(i.isOpen),"aria-expanded":i.isOpen,"aria-haspopup":"menu","aria-controls":i.menuId,onClick:Qn(n.onClick,a),onKeyDown:Qn(n.onKeyDown,v)}}function iV(n){var t;return jLe(n)&&!!((t=n==null?void 0:n.getAttribute("role"))!=null&&t.startsWith("menuitem"))}function ULe(n={},t=null){const i=QR();if(!i)throw new Error("useMenuContext: context is undefined. Seems you forgot to wrap component within <Menu>");const{focusedIndex:a,setFocusedIndex:l,menuRef:d,isOpen:p,onClose:E,menuId:v,isLazy:b,lazyBehavior:w,scrollIntoViewRef:A,unstable__animationState:N}=i,F=OLe(),j=aDe({preventDefault:K=>K.key!==" "&&iV(K.target)}),B=L.useCallback(K=>{if(!K.currentTarget.contains(K.target))return;const te=K.key,oe={Tab:Z=>Z.preventDefault(),Escape:Z=>{Z.stopPropagation(),E()},ArrowDown:()=>{A.current=!0;const Z=F.nextEnabled(a)??F.firstEnabled();Z&&l(Z.index)},ArrowUp:()=>{A.current=!0;const Z=F.prevEnabled(a)??F.firstEnabled();Z&&l(Z.index)}}[te];if(oe){K.preventDefault(),oe(K);return}const ge=j(Z=>{const Q=oDe(F.values(),Z,ne=>{var se;return((se=ne==null?void 0:ne.node)==null?void 0:se.textContent)??""},F.item(a));if(Q){const ne=F.indexOf(Q.node);l(ne)}});iV(K.target)&&ge(K)},[F,a,j,E,l,A]),H=L.useRef(!1);p&&(H.current=!0);const ee=QV({wasSelected:H.current,enabled:b,mode:w,isSelected:N.present});return{...n,ref:to(d,t),children:ee?n.children:null,tabIndex:-1,role:"menu",id:v,style:{...n.style,transformOrigin:"var(--popper-transform-origin)"},"aria-orientation":"vertical",onKeyDown:Qn(n.onKeyDown,B)}}function VLe(n={}){const{popper:t,isOpen:i}=QR();return t.getPopperProps({...n,style:{visibility:i?"visible":"hidden",...n.style}})}function FLe(n={},t=null){const{onMouseEnter:i,onMouseMove:a,onMouseLeave:l,onClick:d,onFocus:p,isDisabled:E,isFocusable:v,closeOnSelect:b,type:w,...A}=n,N=QR(),{setFocusedIndex:F,focusedIndex:j,closeOnSelect:B,onClose:H,menuId:ee,scrollIntoViewRef:K}=N,te=L.useRef(null),le=`${ee}-menuitem-${L.useId()}`,{index:oe,register:ge}=NLe({disabled:E&&!v}),Z=L.useCallback(Me=>{i==null||i(Me),!E&&(K.current=!1,F(oe))},[F,oe,E,i,K]),Q=L.useCallback(Me=>{a==null||a(Me),te.current&&!LLe(te.current)&&Z(Me)},[Z,a]),ne=L.useCallback(Me=>{l==null||l(Me),!E&&F(-1)},[F,E,l]),se=L.useCallback(Me=>{d==null||d(Me),iV(Me.currentTarget)&&(b??B)&&H()},[H,d,B,b]),fe=L.useCallback(Me=>{p==null||p(Me),F(oe)},[F,p,oe]),he=oe===j,ue=ene({onClick:se,onFocus:fe,onMouseEnter:Z,onMouseMove:Q,onMouseLeave:ne,ref:to(ge,te,t),isDisabled:E,isFocusable:v});return{...A,...ue,type:w??ue.type,id:le,role:"menuitem",tabIndex:he?0:-1}}function jLe(n){if(!BLe(n))return!1;const t=n.ownerDocument.defaultView??window;return n instanceof t.HTMLElement}function BLe(n){return n!=null&&typeof n=="object"&&"nodeType"in n&&n.nodeType===Node.ELEMENT_NODE}const[WLe,k0]=Ki({name:"MenuStylesContext",errorMessage:`useMenuStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Menu />" `}),RN=n=>{const{children:t}=n,i=tl("Menu",n),a=qi(n),{direction:l}=A0(),{descendants:d,...p}=xLe({...a,direction:l}),E=L.useMemo(()=>p,[p]),{isOpen:v,onClose:b,forceUpdate:w}=E;return C.jsx(PLe,{value:d,children:C.jsx(DLe,{value:E,children:C.jsx(WLe,{value:i,children:Yc(t,{isOpen:v,onClose:b,forceUpdate:w})})})})};RN.displayName="Menu";const zLe=Yt((n,t)=>{const i=k0();return C.jsx(Lt.button,{ref:t,...n,__css:{display:"inline-flex",appearance:"none",alignItems:"center",outline:0,...i.button}})}),CN=Yt((n,t)=>{const{children:i,as:a,...l}=n,d=MLe(l,t),p=a||zLe;return C.jsx(p,{...d,className:dn("chakra-menu__menu-button",n.className),children:C.jsx(Lt.span,{__css:{pointerEvents:"none",flex:"1 1 auto",minW:0},children:n.children})})});CN.displayName="MenuButton";const nne=Yt((n,t)=>{const i=k0();return C.jsx(Lt.span,{ref:t,...n,__css:i.command,className:"chakra-menu__command"})});nne.displayName="MenuCommand";const rne=n=>{const{className:t,...i}=n,a=k0();return C.jsx(Lt.hr,{"aria-orientation":"horizontal",className:dn("chakra-menu__divider",t),...i,__css:a.divider})};rne.displayName="MenuDivider";const ine=n=>{const{className:t,children:i,...a}=n,l=k0(),d=L.Children.only(i),p=L.isValidElement(d)?L.cloneElement(d,{focusable:"false","aria-hidden":!0,className:dn("chakra-menu__icon",d.props.className)}):null,E=dn("chakra-menu__icon-wrapper",t);return C.jsx(Lt.span,{className:E,...a,__css:l.icon,children:p})};ine.displayName="MenuIcon";const GLe=Yt((n,t)=>{const{type:i,...a}=n,l=k0(),d=a.as||i?i??void 0:"button",p=L.useMemo(()=>({textDecoration:"none",color:"inherit",userSelect:"none",display:"flex",width:"100%",alignItems:"center",textAlign:"start",flex:"0 0 auto",outline:0,...l.item}),[l.item]);return C.jsx(Lt.button,{ref:t,type:d,...a,__css:p})}),hp=Yt((n,t)=>{const{icon:i,iconSpacing:a="0.75rem",command:l,commandSpacing:d="0.75rem",children:p,...E}=n,v=FLe(E,t),w=i||l?C.jsx("span",{style:{pointerEvents:"none",flex:1},children:p}):p;return C.jsxs(GLe,{...v,className:dn("chakra-menu__menuitem",v.className),children:[i&&C.jsx(ine,{fontSize:"0.8em",marginEnd:a,children:i}),w,l&&C.jsx(nne,{marginStart:d,children:l})]})});hp.displayName="MenuItem";const HLe={enter:{visibility:"visible",opacity:1,scale:1,transition:{duration:.2,ease:[.4,0,.2,1]}},exit:{transitionEnd:{visibility:"hidden"},opacity:0,scale:.8,transition:{duration:.1,easings:"easeOut"}}},$Le=Lt(of.div),IN=Yt(function(t,i){var N;const{rootProps:a,motionProps:l,...d}=t,{isOpen:p,onTransitionEnd:E,unstable__animationState:v}=QR(),b=ULe(d,i),w=VLe(a),A=k0();return C.jsx(Lt.div,{...w,__css:{zIndex:t.zIndex??((N=A.list)==null?void 0:N.zIndex)},children:C.jsx($Le,{variants:HLe,initial:!1,animate:p?"enter":"exit",__css:{outline:0,...A.list},...l,...b,className:dn("chakra-menu__menu-list",b.className),onUpdate:E,onAnimationComplete:SQ(v.onComplete,b.onAnimationComplete)})})});IN.displayName="MenuList";var KLe=function(n){if(typeof document>"u")return null;var t=Array.isArray(n)?n[0]:n;return t.ownerDocument.body},dS=new WeakMap,fO=new WeakMap,pO={},F2=0,one=function(n){return n&&(n.host||one(n.parentNode))},qLe=function(n,t){return t.map(function(i){if(n.contains(i))return i;var a=one(i);return a&&n.contains(a)?a:(console.error("aria-hidden",i,"in not contained inside",n,". Doing nothing"),null)}).filter(function(i){return!!i})},YLe=function(n,t,i,a){var l=qLe(t,Array.isArray(n)?n:[n]);pO[i]||(pO[i]=new WeakMap);var d=pO[i],p=[],E=new Set,v=new Set(l),b=function(A){!A||E.has(A)||(E.add(A),b(A.parentNode))};l.forEach(b);var w=function(A){!A||v.has(A)||Array.prototype.forEach.call(A.children,function(N){if(E.has(N))w(N);else try{var F=N.getAttribute(a),j=F!==null&&F!=="false",B=(dS.get(N)||0)+1,H=(d.get(N)||0)+1;dS.set(N,B),d.set(N,H),p.push(N),B===1&&j&&fO.set(N,!0),H===1&&N.setAttribute(i,"true"),j||N.setAttribute(a,"true")}catch(ee){console.error("aria-hidden: cannot operate on ",N,ee)}})};return w(t),E.clear(),F2++,function(){p.forEach(function(A){var N=dS.get(A)-1,F=d.get(A)-1;dS.set(A,N),d.set(A,F),N||(fO.has(A)||A.removeAttribute(a),fO.delete(A)),F||A.removeAttribute(i)}),F2--,F2||(dS=new WeakMap,dS=new WeakMap,fO=new WeakMap,pO={})}},XLe=function(n,t,i){i===void 0&&(i="data-aria-hidden");var a=Array.from(Array.isArray(n)?n:[n]),l=KLe(n);return l?(a.push.apply(a,Array.from(l.querySelectorAll("[aria-live]"))),YLe(a,l,i,"aria-hidden")):function(){return null}},JLe=Object.defineProperty,QLe=(n,t,i)=>t in n?JLe(n,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[t]=i,ZLe=(n,t,i)=>(QLe(n,t+"",i),i);class exe{constructor(){ZLe(this,"modals"),this.modals=new Set}add(t){return this.modals.add(t),this.modals.size}remove(t){this.modals.delete(t)}isTopModal(t){if(!t)return!1;const i=Array.from(this.modals)[this.modals.size-1];return t===i}}const oV=new exe;function sne(n,t){const[i,a]=L.useState(0);return L.useEffect(()=>{const l=n.current;if(l){if(t){const d=oV.add(l);a(d)}return()=>{oV.remove(l),a(0)}}},[t,n]),i}function txe(n){const{isOpen:t,onClose:i,id:a,closeOnOverlayClick:l=!0,closeOnEsc:d=!0,useInert:p=!0,onOverlayClick:E,onEsc:v}=n,b=L.useRef(null),w=L.useRef(null),[A,N,F]=rxe(a,"chakra-modal","chakra-modal--header","chakra-modal--body");nxe(b,t&&p);const j=sne(b,t),B=L.useRef(null),H=L.useCallback(ne=>{B.current=ne.target},[]),ee=L.useCallback(ne=>{ne.key==="Escape"&&(ne.stopPropagation(),d&&(i==null||i()),v==null||v())},[d,i,v]),[K,te]=L.useState(!1),[le,oe]=L.useState(!1),ge=L.useCallback((ne={},se=null)=>({role:"dialog",...ne,ref:to(se,b),id:A,tabIndex:-1,"aria-modal":!0,"aria-labelledby":K?N:void 0,"aria-describedby":le?F:void 0,onClick:Qn(ne.onClick,fe=>fe.stopPropagation())}),[F,le,A,N,K]),Z=L.useCallback(ne=>{ne.stopPropagation(),B.current===ne.target&&oV.isTopModal(b.current)&&(l&&(i==null||i()),E==null||E())},[i,l,E]),Q=L.useCallback((ne={},se=null)=>({...ne,ref:to(se,w),onClick:Qn(ne.onClick,Z),onKeyDown:Qn(ne.onKeyDown,ee),onMouseDown:Qn(ne.onMouseDown,H)}),[ee,H,Z]);return{isOpen:t,onClose:i,headerId:N,bodyId:F,setBodyMounted:oe,setHeaderMounted:te,dialogRef:b,overlayRef:w,getDialogProps:ge,getDialogContainerProps:Q,index:j}}function nxe(n,t){const i=n.current;L.useEffect(()=>{if(!(!n.current||!t))return XLe(n.current)},[t,n,i])}function rxe(n,...t){const i=L.useId(),a=n||i;return L.useMemo(()=>t.map(l=>`${l}-${a}`),[a,t])}const[ixe,N0]=Ki({name:"ModalStylesContext",errorMessage:`useModalStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Modal />" `}),[oxe,AE]=Ki({strict:!0,name:"ModalContext",errorMessage:"useModalContext: `context` is undefined. Seems you forgot to wrap modal components in `<Modal />`"}),xa=n=>{const t={scrollBehavior:"outside",autoFocus:!0,trapFocus:!0,returnFocusOnClose:!0,blockScrollOnMount:!0,allowPinchZoom:!1,preserveScrollBarGap:!0,motionPreset:"scale",...n,lockFocusAcrossFrames:n.lockFocusAcrossFrames||!0},{portalProps:i,children:a,autoFocus:l,trapFocus:d,initialFocusRef:p,finalFocusRef:E,returnFocusOnClose:v,blockScrollOnMount:b,allowPinchZoom:w,preserveScrollBarGap:A,motionPreset:N,lockFocusAcrossFrames:F,animatePresenceProps:j,onCloseComplete:B}=t,H=tl("Modal",t),K={...txe(t),autoFocus:l,trapFocus:d,initialFocusRef:p,finalFocusRef:E,returnFocusOnClose:v,blockScrollOnMount:b,allowPinchZoom:w,preserveScrollBarGap:A,motionPreset:N,lockFocusAcrossFrames:F};return C.jsx(oxe,{value:K,children:C.jsx(ixe,{value:H,children:C.jsx(R0,{...j,onExitComplete:B,children:K.isOpen&&C.jsx(Ml,{...i,children:a})})})})};xa.displayName="Modal";var XO="right-scroll-bar-position",JO="width-before-scroll-bar",sxe="with-scroll-bars-hidden",axe="--removed-body-scroll-bar-size",ane=fte(),j2=function(){},AN=L.forwardRef(function(n,t){var i=L.useRef(null),a=L.useState({onScrollCapture:j2,onWheelCapture:j2,onTouchMoveCapture:j2}),l=a[0],d=a[1],p=n.forwardProps,E=n.children,v=n.className,b=n.removeScrollBar,w=n.enabled,A=n.shards,N=n.sideCar,F=n.noIsolation,j=n.inert,B=n.allowPinchZoom,H=n.as,ee=H===void 0?"div":H,K=n.gapMode,te=YR(n,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),le=N,oe=ute([i,t]),ge=Vh(Vh({},te),l);return L.createElement(L.Fragment,null,w&&L.createElement(le,{sideCar:ane,removeScrollBar:b,shards:A,noIsolation:F,inert:j,setCallbacks:d,allowPinchZoom:!!B,lockRef:i,gapMode:K}),p?L.cloneElement(L.Children.only(E),Vh(Vh({},ge),{ref:oe})):L.createElement(ee,Vh({},ge,{className:v,ref:oe}),E))});AN.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};AN.classNames={fullWidth:JO,zeroRight:XO};var cxe=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function lxe(){if(!document)return null;var n=document.createElement("style");n.type="text/css";var t=cxe();return t&&n.setAttribute("nonce",t),n}function uxe(n,t){n.styleSheet?n.styleSheet.cssText=t:n.appendChild(document.createTextNode(t))}function dxe(n){var t=document.head||document.getElementsByTagName("head")[0];t.appendChild(n)}var hxe=function(){var n=0,t=null;return{add:function(i){n==0&&(t=lxe())&&(uxe(t,i),dxe(t)),n++},remove:function(){n--,!n&&t&&(t.parentNode&&t.parentNode.removeChild(t),t=null)}}},fxe=function(){var n=hxe();return function(t,i){L.useEffect(function(){return n.add(t),function(){n.remove()}},[t&&i])}},cne=function(){var n=fxe(),t=function(i){var a=i.styles,l=i.dynamic;return n(a,l),null};return t},pxe={left:0,top:0,right:0,gap:0},B2=function(n){return parseInt(n||"",10)||0},mxe=function(n){var t=window.getComputedStyle(document.body),i=t[n==="padding"?"paddingLeft":"marginLeft"],a=t[n==="padding"?"paddingTop":"marginTop"],l=t[n==="padding"?"paddingRight":"marginRight"];return[B2(i),B2(a),B2(l)]},gxe=function(n){if(n===void 0&&(n="margin"),typeof window>"u")return pxe;var t=mxe(n),i=document.documentElement.clientWidth,a=window.innerWidth;return{left:t[0],top:t[1],right:t[2],gap:Math.max(0,a-i+t[2]-t[0])}},_xe=cne(),HS="data-scroll-locked",Exe=function(n,t,i,a){var l=n.left,d=n.top,p=n.right,E=n.gap;return i===void 0&&(i="margin"),`
  .`.concat(sxe,` {
   overflow: hidden `).concat(a,`;
   padding-right: `).concat(E,"px ").concat(a,`;
  }
  body[`).concat(HS,`] {
    overflow: hidden `).concat(a,`;
    overscroll-behavior: contain;
    `).concat([t&&"position: relative ".concat(a,";"),i==="margin"&&`
    padding-left: `.concat(l,`px;
    padding-top: `).concat(d,`px;
    padding-right: `).concat(p,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(E,"px ").concat(a,`;
    `),i==="padding"&&"padding-right: ".concat(E,"px ").concat(a,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(XO,` {
    right: `).concat(E,"px ").concat(a,`;
  }
  
  .`).concat(JO,` {
    margin-right: `).concat(E,"px ").concat(a,`;
  }
  
  .`).concat(XO," .").concat(XO,` {
    right: 0 `).concat(a,`;
  }
  
  .`).concat(JO," .").concat(JO,` {
    margin-right: 0 `).concat(a,`;
  }
  
  body[`).concat(HS,`] {
    `).concat(axe,": ").concat(E,`px;
  }
`)},kY=function(){var n=parseInt(document.body.getAttribute(HS)||"0",10);return isFinite(n)?n:0},yxe=function(){L.useEffect(function(){return document.body.setAttribute(HS,(kY()+1).toString()),function(){var n=kY()-1;n<=0?document.body.removeAttribute(HS):document.body.setAttribute(HS,n.toString())}},[])},vxe=function(n){var t=n.noRelative,i=n.noImportant,a=n.gapMode,l=a===void 0?"margin":a;yxe();var d=L.useMemo(function(){return gxe(l)},[l]);return L.createElement(_xe,{styles:Exe(d,!t,l,i?"":"!important")})},sV=!1;if(typeof window<"u")try{var mO=Object.defineProperty({},"passive",{get:function(){return sV=!0,!0}});window.addEventListener("test",mO,mO),window.removeEventListener("test",mO,mO)}catch{sV=!1}var hS=sV?{passive:!1}:!1,Sxe=function(n){return n.tagName==="TEXTAREA"},lne=function(n,t){if(!(n instanceof Element))return!1;var i=window.getComputedStyle(n);return i[t]!=="hidden"&&!(i.overflowY===i.overflowX&&!Sxe(n)&&i[t]==="visible")},bxe=function(n){return lne(n,"overflowY")},Txe=function(n){return lne(n,"overflowX")},NY=function(n,t){var i=t.ownerDocument,a=t;do{typeof ShadowRoot<"u"&&a instanceof ShadowRoot&&(a=a.host);var l=une(n,a);if(l){var d=dne(n,a),p=d[1],E=d[2];if(p>E)return!0}a=a.parentNode}while(a&&a!==i.body);return!1},wxe=function(n){var t=n.scrollTop,i=n.scrollHeight,a=n.clientHeight;return[t,i,a]},Rxe=function(n){var t=n.scrollLeft,i=n.scrollWidth,a=n.clientWidth;return[t,i,a]},une=function(n,t){return n==="v"?bxe(t):Txe(t)},dne=function(n,t){return n==="v"?wxe(t):Rxe(t)},Cxe=function(n,t){return n==="h"&&t==="rtl"?-1:1},Ixe=function(n,t,i,a,l){var d=Cxe(n,window.getComputedStyle(t).direction),p=d*a,E=i.target,v=t.contains(E),b=!1,w=p>0,A=0,N=0;do{var F=dne(n,E),j=F[0],B=F[1],H=F[2],ee=B-H-d*j;(j||ee)&&une(n,E)&&(A+=ee,N+=j),E instanceof ShadowRoot?E=E.host:E=E.parentNode}while(!v&&E!==document.body||v&&(t.contains(E)||t===E));return(w&&Math.abs(A)<1||!w&&Math.abs(N)<1)&&(b=!0),b},gO=function(n){return"changedTouches"in n?[n.changedTouches[0].clientX,n.changedTouches[0].clientY]:[0,0]},DY=function(n){return[n.deltaX,n.deltaY]},LY=function(n){return n&&"current"in n?n.current:n},Axe=function(n,t){return n[0]===t[0]&&n[1]===t[1]},Pxe=function(n){return`
  .block-interactivity-`.concat(n,` {pointer-events: none;}
  .allow-interactivity-`).concat(n,` {pointer-events: all;}
`)},Oxe=0,fS=[];function kxe(n){var t=L.useRef([]),i=L.useRef([0,0]),a=L.useRef(),l=L.useState(Oxe++)[0],d=L.useState(cne)[0],p=L.useRef(n);L.useEffect(function(){p.current=n},[n]),L.useEffect(function(){if(n.inert){document.body.classList.add("block-interactivity-".concat(l));var B=VNe([n.lockRef.current],(n.shards||[]).map(LY),!0).filter(Boolean);return B.forEach(function(H){return H.classList.add("allow-interactivity-".concat(l))}),function(){document.body.classList.remove("block-interactivity-".concat(l)),B.forEach(function(H){return H.classList.remove("allow-interactivity-".concat(l))})}}},[n.inert,n.lockRef.current,n.shards]);var E=L.useCallback(function(B,H){if("touches"in B&&B.touches.length===2||B.type==="wheel"&&B.ctrlKey)return!p.current.allowPinchZoom;var ee=gO(B),K=i.current,te="deltaX"in B?B.deltaX:K[0]-ee[0],le="deltaY"in B?B.deltaY:K[1]-ee[1],oe,ge=B.target,Z=Math.abs(te)>Math.abs(le)?"h":"v";if("touches"in B&&Z==="h"&&ge.type==="range")return!1;var Q=NY(Z,ge);if(!Q)return!0;if(Q?oe=Z:(oe=Z==="v"?"h":"v",Q=NY(Z,ge)),!Q)return!1;if(!a.current&&"changedTouches"in B&&(te||le)&&(a.current=oe),!oe)return!0;var ne=a.current||oe;return Ixe(ne,H,B,ne==="h"?te:le)},[]),v=L.useCallback(function(B){var H=B;if(!(!fS.length||fS[fS.length-1]!==d)){var ee="deltaY"in H?DY(H):gO(H),K=t.current.filter(function(oe){return oe.name===H.type&&(oe.target===H.target||H.target===oe.shadowParent)&&Axe(oe.delta,ee)})[0];if(K&&K.should){H.cancelable&&H.preventDefault();return}if(!K){var te=(p.current.shards||[]).map(LY).filter(Boolean).filter(function(oe){return oe.contains(H.target)}),le=te.length>0?E(H,te[0]):!p.current.noIsolation;le&&H.cancelable&&H.preventDefault()}}},[]),b=L.useCallback(function(B,H,ee,K){var te={name:B,delta:H,target:ee,should:K,shadowParent:Nxe(ee)};t.current.push(te),setTimeout(function(){t.current=t.current.filter(function(le){return le!==te})},1)},[]),w=L.useCallback(function(B){i.current=gO(B),a.current=void 0},[]),A=L.useCallback(function(B){b(B.type,DY(B),B.target,E(B,n.lockRef.current))},[]),N=L.useCallback(function(B){b(B.type,gO(B),B.target,E(B,n.lockRef.current))},[]);L.useEffect(function(){return fS.push(d),n.setCallbacks({onScrollCapture:A,onWheelCapture:A,onTouchMoveCapture:N}),document.addEventListener("wheel",v,hS),document.addEventListener("touchmove",v,hS),document.addEventListener("touchstart",w,hS),function(){fS=fS.filter(function(B){return B!==d}),document.removeEventListener("wheel",v,hS),document.removeEventListener("touchmove",v,hS),document.removeEventListener("touchstart",w,hS)}},[]);var F=n.removeScrollBar,j=n.inert;return L.createElement(L.Fragment,null,j?L.createElement(d,{styles:Pxe(l)}):null,F?L.createElement(vxe,{gapMode:n.gapMode}):null)}function Nxe(n){for(var t=null;n!==null;)n instanceof ShadowRoot&&(t=n.host,n=n.host),n=n.parentNode;return t}const Dxe=FNe(ane,kxe);var hne=L.forwardRef(function(n,t){return L.createElement(AN,Vh({},n,{ref:t,sideCar:Dxe}))});hne.classNames=AN.classNames;function Lxe(n){const{autoFocus:t,trapFocus:i,dialogRef:a,initialFocusRef:l,blockScrollOnMount:d,allowPinchZoom:p,finalFocusRef:E,returnFocusOnClose:v,preserveScrollBarGap:b,lockFocusAcrossFrames:w,isOpen:A}=AE(),[N,F]=vF();L.useEffect(()=>{!N&&F&&setTimeout(F)},[N,F]);const j=sne(a,A);return C.jsx(jte,{autoFocus:t,isDisabled:!i,initialFocusRef:l,finalFocusRef:E,restoreFocus:v,contentRef:a,lockFocusAcrossFrames:w,children:C.jsx(hne,{removeScrollBar:!b,allowPinchZoom:p,enabled:j===1&&d,forwardProps:!0,children:n.children})})}const xxe={initial:({offsetX:n,offsetY:t,transition:i,transitionEnd:a,delay:l})=>({opacity:0,x:n,y:t,transition:(i==null?void 0:i.exit)??yE.exit(EE.exit,l),transitionEnd:a==null?void 0:a.exit}),enter:({transition:n,transitionEnd:t,delay:i})=>({opacity:1,x:0,y:0,transition:(n==null?void 0:n.enter)??yE.enter(EE.enter,i),transitionEnd:t==null?void 0:t.enter}),exit:({offsetY:n,offsetX:t,transition:i,transitionEnd:a,reverse:l,delay:d})=>{const p={x:t,y:n};return{opacity:0,transition:(i==null?void 0:i.exit)??yE.exit(EE.exit,d),...l?{...p,transitionEnd:a==null?void 0:a.exit}:{transitionEnd:{...p,...a==null?void 0:a.exit}}}}},Nw={initial:"initial",animate:"enter",exit:"exit",variants:xxe},Mxe=L.forwardRef(function(t,i){const{unmountOnExit:a,in:l,reverse:d=!0,className:p,offsetX:E=0,offsetY:v=8,transition:b,transitionEnd:w,delay:A,animatePresenceProps:N,...F}=t,j=a?l&&a:!0,B=l||a?"enter":"exit",H={offsetX:E,offsetY:v,reverse:d,transition:b,transitionEnd:w,delay:A};return C.jsx(R0,{...N,custom:H,children:j&&C.jsx(of.div,{ref:i,className:dn("chakra-offset-slide",p),custom:H,...Nw,animate:B,...F})})});Mxe.displayName="SlideFade";const Uxe={exit:({reverse:n,initialScale:t,transition:i,transitionEnd:a,delay:l})=>({opacity:0,...n?{scale:t,transitionEnd:a==null?void 0:a.exit}:{transitionEnd:{scale:t,...a==null?void 0:a.exit}},transition:(i==null?void 0:i.exit)??yE.exit(EE.exit,l)}),enter:({transitionEnd:n,transition:t,delay:i})=>({opacity:1,scale:1,transition:(t==null?void 0:t.enter)??yE.enter(EE.enter,i),transitionEnd:n==null?void 0:n.enter})},fne={initial:"exit",animate:"enter",exit:"exit",variants:Uxe},Vxe=L.forwardRef(function(t,i){const{unmountOnExit:a,in:l,reverse:d=!0,initialScale:p=.95,className:E,transition:v,transitionEnd:b,delay:w,animatePresenceProps:A,...N}=t,F=a?l&&a:!0,j=l||a?"enter":"exit",B={initialScale:p,reverse:d,transition:v,transitionEnd:b,delay:w};return C.jsx(R0,{...A,custom:B,children:F&&C.jsx(of.div,{ref:i,className:dn("chakra-offset-slide",E),...fne,animate:j,custom:B,...N})})});Vxe.displayName="ScaleFade";const Fxe={slideInBottom:{...Nw,custom:{offsetY:16,reverse:!0}},slideInRight:{...Nw,custom:{offsetX:16,reverse:!0}},slideInTop:{...Nw,custom:{offsetY:-16,reverse:!0}},slideInLeft:{...Nw,custom:{offsetX:-16,reverse:!0}},scale:{...fne,custom:{initialScale:.95,reverse:!0}},none:{}},jxe=Lt(of.section),Bxe=n=>Fxe[n||"none"],pne=L.forwardRef((n,t)=>{const{preset:i,motionProps:a=Bxe(i),...l}=n;return C.jsx(jxe,{ref:t,...a,...l})});pne.displayName="ModalTransition";const Ma=Yt((n,t)=>{const{className:i,children:a,containerProps:l,motionProps:d,...p}=n,{getDialogProps:E,getDialogContainerProps:v}=AE(),b=E(p,t),w=v(l),A=dn("chakra-modal__content",i),N=N0(),F={display:"flex",flexDirection:"column",position:"relative",width:"100%",outline:0,...N.dialog},j={display:"flex",width:"100vw",height:"$100vh",position:"fixed",left:0,top:0,...N.dialogContainer},{motionPreset:B}=AE();return C.jsx(Lxe,{children:C.jsx(Lt.div,{...w,className:"chakra-modal__content-container",tabIndex:-1,__css:j,children:C.jsx(pne,{preset:B,motionProps:d,className:A,...b,__css:F,children:a})})})});Ma.displayName="ModalContent";const Ua=Yt((n,t)=>{const{className:i,...a}=n,{bodyId:l,setBodyMounted:d}=AE();L.useEffect(()=>(d(!0),()=>d(!1)),[d]);const p=dn("chakra-modal__body",i),E=N0();return C.jsx(Lt.div,{ref:t,className:p,id:l,...a,__css:E.body})});Ua.displayName="ModalBody";const cc=Yt((n,t)=>{const{onClick:i,className:a,...l}=n,{onClose:d}=AE(),p=dn("chakra-modal__close-btn",a),E=N0();return C.jsx(ej,{ref:t,__css:E.closeButton,className:p,onClick:Qn(i,v=>{v.stopPropagation(),d()}),...l})});cc.displayName="ModalCloseButton";const PE=Yt((n,t)=>{const{className:i,...a}=n,l=dn("chakra-modal__footer",i),d=N0(),p={display:"flex",alignItems:"center",justifyContent:"flex-end",...d.footer};return C.jsx(Lt.footer,{ref:t,...a,__css:p,className:l})});PE.displayName="ModalFooter";const Ll=Yt((n,t)=>{const{className:i,...a}=n,{headerId:l,setHeaderMounted:d}=AE();L.useEffect(()=>(d(!0),()=>d(!1)),[d]);const p=dn("chakra-modal__header",i),E=N0(),v={flex:0,...E.header};return C.jsx(Lt.header,{ref:t,className:p,id:l,...a,__css:v})});Ll.displayName="ModalHeader";const Wxe={enter:({transition:n,transitionEnd:t,delay:i}={})=>({opacity:1,transition:(n==null?void 0:n.enter)??yE.enter(EE.enter,i),transitionEnd:t==null?void 0:t.enter}),exit:({transition:n,transitionEnd:t,delay:i}={})=>({opacity:0,transition:(n==null?void 0:n.exit)??yE.exit(EE.exit,i),transitionEnd:t==null?void 0:t.exit})},mne={initial:"exit",animate:"enter",exit:"exit",variants:Wxe},zxe=L.forwardRef(function(t,i){const{unmountOnExit:a,in:l,className:d,transition:p,transitionEnd:E,delay:v,animatePresenceProps:b,...w}=t,A=l||a?"enter":"exit",N=a?l&&a:!0,F={transition:p,transitionEnd:E,delay:v};return C.jsx(R0,{...b,custom:F,children:N&&C.jsx(of.div,{ref:i,className:dn("chakra-fade",d),custom:F,...mne,animate:A,...w})})});zxe.displayName="Fade";const Gxe=Lt(of.div),Va=Yt((n,t)=>{const{className:i,transition:a,motionProps:l,...d}=n,p=dn("chakra-modal__overlay",i),v={pos:"fixed",left:"0",top:"0",w:"100vw",h:"100vh",...N0().overlay},{motionPreset:b}=AE(),A=l||(b==="none"?{}:mne);return C.jsx(Gxe,{...A,__css:v,ref:t,className:p,...d})});Va.displayName="ModalOverlay";function Hxe(n){const{leastDestructiveRef:t,...i}=n;return C.jsx(xa,{...i,initialFocusRef:t})}const $xe=Yt((n,t)=>C.jsx(Ma,{ref:t,role:"alertdialog",...n})),[Kxe,PN]=Ki({name:"PopoverContext",errorMessage:"usePopoverContext: `context` is undefined. Seems you forgot to wrap all popover components within `<Popover />`"}),[qxe,gne]=Ki({name:"PopoverStylesContext",errorMessage:`usePopoverStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Popover />" `}),pS={click:"click",hover:"hover"};function Yxe(n={}){const{closeOnBlur:t=!0,closeOnEsc:i=!0,initialFocusRef:a,id:l,returnFocusOnClose:d=!0,autoFocus:p=!0,arrowSize:E,arrowShadowColor:v,trigger:b=pS.click,openDelay:w=200,closeDelay:A=200,isLazy:N,lazyBehavior:F="unmount",computePositionOnMount:j,...B}=n,{isOpen:H,onClose:ee,onOpen:K,onToggle:te}=Cp(n),[le,oe]=L.useState(d);L.useEffect(()=>oe(d),[d]);const ge=L.useRef(null),Z=L.useRef(null),Q=L.useRef(null),ne=L.useRef(!1),se=L.useRef(!1);H&&(se.current=!0);const[fe,he]=L.useState(!1),[ue,Me]=L.useState(!1),He=L.useId(),rt=l??He,[we,Ce,ye,Ne]=["popover-trigger","popover-content","popover-header","popover-body"].map(Kt=>`${Kt}-${rt}`),{referenceRef:be,getArrowProps:Se,getPopperProps:Ae,getArrowInnerProps:Ue,forceUpdate:ze}=wj({...B,enabled:H||!!j}),et=IQ({isOpen:H,ref:Q});WEe({enabled:H,ref:Z}),PQ(Q,{focusRef:Z,visible:H,shouldFocus:le&&b===pS.click}),LEe(Q,{focusRef:a,visible:H,shouldFocus:p&&b===pS.click}),NQ({enabled:H&&t,ref:Q,handler(Kt){var Fe;const Re=((Fe=Kt.composedPath)==null?void 0:Fe.call(Kt)[0])??[Kt.target];_O(Z.current,Re)||(Re&&oe(!fk(Re)),ee())}});const nt=QV({wasSelected:se.current,enabled:N,mode:F,isSelected:et.present}),dt=L.useCallback((Kt={},Re=null)=>{const Fe={...Kt,style:{...Kt.style,transformOrigin:Ko.transformOrigin.varRef,[Ko.arrowSize.var]:E?`${E}px`:void 0,[Ko.arrowShadowColor.var]:v},ref:to(Q,Re),children:nt?Kt.children:null,id:Ce,tabIndex:-1,role:"dialog",onKeyDown:Qn(Kt.onKeyDown,Ke=>{Ke.nativeEvent.isComposing||i&&Ke.key==="Escape"&&(Ke.preventDefault(),Ke.stopPropagation(),ee())}),onBlur:Qn(Kt.onBlur,Ke=>{const yt=xY(Ke),St=_O(Q.current,yt),Ge=_O(Z.current,yt),Ot=!St&&!Ge;yt&&oe(!fk(yt)),H&&t&&Ot&&ee()}),"aria-labelledby":fe?ye:void 0,"aria-describedby":ue?Ne:void 0};return b===pS.hover&&(Fe.role="tooltip",Fe.onMouseEnter=Qn(Kt.onMouseEnter,()=>{ne.current=!0}),Fe.onMouseLeave=Qn(Kt.onMouseLeave,Ke=>{Ke.nativeEvent.relatedTarget!==null&&(ne.current=!1,setTimeout(()=>ee(),A))})),Fe},[nt,Ce,fe,ye,ue,Ne,b,i,ee,H,t,A,v,E]),Xe=L.useCallback((Kt={},Re=null)=>Ae({...Kt,style:{visibility:H?"visible":"hidden",...Kt.style}},Re),[H,Ae]),It=L.useCallback((Kt,Re=null)=>({...Kt,ref:to(Re,ge,be)}),[ge,be]),hn=L.useRef(void 0),Ut=L.useRef(void 0),ln=L.useCallback(Kt=>{ge.current==null&&be(Kt)},[be]),Ln=L.useCallback((Kt={},Re=null)=>{const Fe={...Kt,ref:to(Z,Re,ln),id:we,"aria-haspopup":"dialog","aria-expanded":H,"aria-controls":Ce};return b===pS.click&&(Fe.onClick=Qn(Kt.onClick,te)),b===pS.hover&&(Fe.onFocus=Qn(Kt.onFocus,()=>{hn.current===void 0&&K()}),Fe.onBlur=Qn(Kt.onBlur,Ke=>{const yt=xY(Ke),St=!_O(Q.current,yt);H&&t&&St&&ee()}),Fe.onKeyDown=Qn(Kt.onKeyDown,Ke=>{Ke.key==="Escape"&&ee()}),Fe.onMouseEnter=Qn(Kt.onMouseEnter,()=>{ne.current=!0,hn.current=window.setTimeout(()=>K(),w)}),Fe.onMouseLeave=Qn(Kt.onMouseLeave,()=>{ne.current=!1,hn.current&&(clearTimeout(hn.current),hn.current=void 0),Ut.current=window.setTimeout(()=>{ne.current===!1&&ee()},A)})),Fe},[we,H,Ce,b,ln,te,K,t,ee,w,A]);L.useEffect(()=>()=>{hn.current&&clearTimeout(hn.current),Ut.current&&clearTimeout(Ut.current)},[]);const Xt=L.useCallback((Kt={},Re=null)=>({...Kt,id:ye,ref:to(Re,Fe=>{he(!!Fe)})}),[ye]),Yn=L.useCallback((Kt={},Re=null)=>({...Kt,id:Ne,ref:to(Re,Fe=>{Me(!!Fe)})}),[Ne]);return{forceUpdate:ze,isOpen:H,onAnimationComplete:et.onComplete,onClose:ee,getAnchorProps:It,getArrowProps:Se,getArrowInnerProps:Ue,getPopoverPositionerProps:Xe,getPopoverProps:dt,getTriggerProps:Ln,getHeaderProps:Xt,getBodyProps:Yn}}function _O(n,t){return n===t||(n==null?void 0:n.contains(t))}function xY(n){const t=n.currentTarget.ownerDocument.activeElement;return n.relatedTarget??t}function _ne(n){const t=tl("Popover",n),{children:i,...a}=qi(n),l=A0(),d=Yxe({...a,direction:l.direction});return C.jsx(Kxe,{value:d,children:C.jsx(qxe,{value:t,children:Yc(i,{isOpen:d.isOpen,onClose:d.onClose,forceUpdate:d.forceUpdate})})})}_ne.displayName="Popover";function Ene(n){var i;const t=L.version;return typeof t!="string"||t.startsWith("18.")?n==null?void 0:n.ref:(i=n==null?void 0:n.props)==null?void 0:i.ref}const yne=Yt(function(t,i){const{getBodyProps:a}=PN(),l=gne();return C.jsx(Lt.div,{...a(t,i),className:dn("chakra-popover__body",t.className),__css:l.body})});yne.displayName="PopoverBody";function Xxe(n){if(n)return{enter:{...n.enter,visibility:"visible"},exit:{...n.exit,transitionEnd:{visibility:"hidden"}}}}const Jxe={exit:{opacity:0,scale:.95,transition:{duration:.1,ease:[.4,0,1,1]}},enter:{scale:1,opacity:1,transition:{duration:.15,ease:[0,0,.2,1]}}},Qxe=Lt(of.section),vne=Yt(function(t,i){const{variants:a=Jxe,...l}=t,{isOpen:d}=PN();return C.jsx(Qxe,{ref:i,variants:Xxe(a),initial:!1,animate:d?"enter":"exit",...l})});vne.displayName="PopoverTransition";const Sne=Yt(function(t,i){const{rootProps:a,motionProps:l,...d}=t,{getPopoverProps:p,getPopoverPositionerProps:E,onAnimationComplete:v}=PN(),b=gne(),w={position:"relative",display:"flex",flexDirection:"column",...b.content};return C.jsx(Lt.div,{...E(a),__css:b.popper,className:"chakra-popover__popper",children:C.jsx(vne,{...l,...p(d,i),onAnimationComplete:SQ(v,d.onAnimationComplete),className:dn("chakra-popover__content",t.className),__css:w})})});Sne.displayName="PopoverContent";function bne(n){const t=L.Children.only(n.children),{getTriggerProps:i}=PN();return C.jsx(C.Fragment,{children:L.cloneElement(t,i(t.props,Ene(t)))})}bne.displayName="PopoverTrigger";function Zxe(n,t,i){return(n-t)*100/(i-t)}WR({"0%":{strokeDasharray:"1, 400",strokeDashoffset:"0"},"50%":{strokeDasharray:"400, 400",strokeDashoffset:"-100"},"100%":{strokeDasharray:"400, 400",strokeDashoffset:"-260"}});WR({"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}});const eMe=WR({"0%":{left:"-40%"},"100%":{left:"100%"}}),tMe=WR({from:{backgroundPosition:"1rem 0"},to:{backgroundPosition:"0 0"}});function nMe(n){const{value:t=0,min:i,max:a,valueText:l,getValueText:d,isIndeterminate:p,role:E="progressbar"}=n,v=Zxe(t,i,a);return{bind:{"data-indeterminate":p?"":void 0,"aria-valuemax":a,"aria-valuemin":i,"aria-valuenow":p?void 0:t,"aria-valuetext":(()=>{if(t!=null)return typeof d=="function"?d(t,v):l})(),role:E},percent:v,value:t}}const[rMe,iMe]=Ki({name:"ProgressStylesContext",errorMessage:`useProgressStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Progress />" `}),oMe=Yt((n,t)=>{const{min:i,max:a,value:l,isIndeterminate:d,role:p,...E}=n,v=nMe({value:l,min:i,max:a,isIndeterminate:d,role:p}),w={height:"100%",...iMe().filledTrack};return C.jsx(Lt.div,{ref:t,style:{width:`${v.percent}%`,...E.style},...v.bind,...E,__css:w})}),h0=Yt((n,t)=>{var Z;const{value:i,min:a=0,max:l=100,hasStripe:d,isAnimated:p,children:E,borderRadius:v,isIndeterminate:b,"aria-label":w,"aria-labelledby":A,"aria-valuetext":N,title:F,role:j,...B}=qi(n),H=tl("Progress",n),ee=v??((Z=H.track)==null?void 0:Z.borderRadius),K={animation:`${tMe} 1s linear infinite`},oe={...!b&&d&&p&&K,...b&&{position:"absolute",willChange:"left",minWidth:"50%",animation:`${eMe} 1s ease infinite normal none running`}},ge={overflow:"hidden",position:"relative",...H.track};return C.jsx(Lt.div,{ref:t,borderRadius:ee,__css:ge,...B,children:C.jsxs(rMe,{value:H,children:[C.jsx(oMe,{"aria-label":w,"aria-labelledby":A,"aria-valuetext":N,min:a,max:l,value:i,isIndeterminate:b,css:oe,borderRadius:ee,title:F,role:j}),E]})})});h0.displayName="Progress";const Tne=Yt(function(t,i){const{children:a,placeholder:l,className:d,...p}=t;return C.jsxs(Lt.select,{...p,ref:i,className:dn("chakra-select",d),children:[l&&C.jsx("option",{value:"",children:l}),a]})});Tne.displayName="SelectField";const wne=Yt((n,t)=>{var te;const i=tl("Select",n),{rootProps:a,placeholder:l,icon:d,color:p,height:E,h:v,minH:b,minHeight:w,iconColor:A,iconSize:N,...F}=qi(n),[j,B]=AEe(F,Wye),H=rj(B),ee={width:"100%",height:"fit-content",position:"relative",color:p},K={paddingEnd:"2rem",...i.field,_focus:{zIndex:"unset",...(te=i.field)==null?void 0:te._focus}};return C.jsxs(Lt.div,{className:"chakra-select__wrapper",__css:ee,...j,...a,children:[C.jsx(Tne,{ref:t,height:v??E,minH:b??w,placeholder:l,...H,__css:K,children:n.children}),C.jsx(Rne,{"data-disabled":Kn(H.disabled),...(A||p)&&{color:A||p},__css:i.icon,...N&&{fontSize:N},children:d})]})});wne.displayName="Select";const sMe=n=>C.jsx("svg",{viewBox:"0 0 24 24",...n,children:C.jsx("path",{fill:"currentColor",d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"})}),aMe=Lt("div",{baseStyle:{position:"absolute",display:"inline-flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",top:"50%",transform:"translateY(-50%)"}}),Rne=n=>{const{children:t=C.jsx(sMe,{}),...i}=n,a=L.cloneElement(t,{role:"presentation",className:"chakra-select__icon",focusable:!1,"aria-hidden":!0,style:{width:"1em",height:"1em",color:"currentColor"}});return C.jsx(aMe,{...i,className:"chakra-select__icon-wrapper",children:L.isValidElement(t)?a:null})};Rne.displayName="SelectIcon";function W2(n){const{orientation:t,vertical:i,horizontal:a}=n;return t==="vertical"?i:a}function cMe(n){const{orientation:t,thumbPercents:i,isReversed:a}=n,l=F=>({position:"absolute",userSelect:"none",WebkitUserSelect:"none",MozUserSelect:"none",msUserSelect:"none",touchAction:"none",...W2({orientation:t,vertical:{bottom:`calc(${i[F]}% - var(--slider-thumb-size) / 2)`},horizontal:{left:`calc(${i[F]}% - var(--slider-thumb-size) / 2)`}})}),d={position:"relative",touchAction:"none",WebkitTapHighlightColor:"rgba(0,0,0,0)",userSelect:"none",outline:0},p={position:"absolute",...W2({orientation:t,vertical:{left:"50%",transform:"translateX(-50%)",height:"100%"},horizontal:{top:"50%",transform:"translateY(-50%)",width:"100%"}})},E=i.length===1,v=[0,a?100-i[0]:i[0]],b=E?v:i;let w=b[0];!E&&a&&(w=100-w);const A=Math.abs(b[b.length-1]-b[0]),N={...p,...W2({orientation:t,vertical:a?{height:`${A}%`,top:`${w}%`}:{height:`${A}%`,bottom:`${w}%`},horizontal:a?{width:`${A}%`,right:`${w}%`}:{width:`${A}%`,left:`${w}%`}})};return{trackStyle:p,innerTrackStyle:N,rootStyle:d,getThumbStyle:l}}function lMe(n){const{isReversed:t,direction:i,orientation:a}=n;return i==="ltr"||a==="vertical"?t:!t}function uMe(n){const{min:t=0,max:i=100,onChange:a,value:l,defaultValue:d,isReversed:p,direction:E="ltr",orientation:v="horizontal",id:b,isDisabled:w,isReadOnly:A,onChangeStart:N,onChangeEnd:F,step:j=1,getAriaValueText:B,"aria-valuetext":H,"aria-label":ee,"aria-labelledby":K,name:te,focusThumbOnChange:le=!0,...oe}=n,ge=Xc(N),Z=Xc(F),Q=Xc(B),ne=lMe({isReversed:p,direction:E,orientation:v}),[se,fe]=AQ({value:l,defaultValue:d??hMe(t,i),onChange:a}),[he,ue]=L.useState(!1),[Me,He]=L.useState(!1),rt=!(w||A),we=(i-t)/10,Ce=j||(i-t)/100,ye=HM(se,t,i),Ne=i-ye+t,Se=K$(ne?Ne:ye,t,i),Ae=v==="vertical",Ue=kQ({min:t,max:i,step:j,isDisabled:w,value:ye,isInteractive:rt,isReversed:ne,isVertical:Ae,eventSource:null,focusThumbOnChange:le,orientation:v}),ze=L.useRef(null),et=L.useRef(null),nt=L.useRef(null),dt=L.useId(),Xe=b??dt,[It,hn]=[`slider-thumb-${Xe}`,`slider-track-${Xe}`],Ut=L.useCallback(Vt=>{var ds;if(!ze.current)return;const on=Ue.current;on.eventSource="pointer";const Pi=ze.current.getBoundingClientRect(),{clientX:fi,clientY:Ti}=((ds=Vt.touches)==null?void 0:ds[0])??Vt,ur=Ae?Pi.bottom-Ti:fi-Pi.left,Ba=Ae?Pi.height:Pi.width;let nl=ur/Ba;ne&&(nl=1-nl);let us=wEe(nl,on.min,on.max);return on.step&&(us=parseFloat(q$(us,on.min,on.step))),us=HM(us,on.min,on.max),us},[Ae,ne,Ue]),ln=L.useCallback(Vt=>{const on=Ue.current;on.isInteractive&&(Vt=parseFloat(q$(Vt,on.min,Ce)),Vt=HM(Vt,on.min,on.max),fe(Vt))},[Ce,fe,Ue]),Ln=L.useMemo(()=>({stepUp(Vt=Ce){const on=ne?ye-Vt:ye+Vt;ln(on)},stepDown(Vt=Ce){const on=ne?ye+Vt:ye-Vt;ln(on)},reset(){ln(d||0)},stepTo(Vt){ln(Vt)}}),[ln,ne,ye,Ce,d]),Xt=L.useCallback(Vt=>{const on=Ue.current,fi={ArrowRight:()=>Ln.stepUp(),ArrowUp:()=>Ln.stepUp(),ArrowLeft:()=>Ln.stepDown(),ArrowDown:()=>Ln.stepDown(),PageUp:()=>Ln.stepUp(we),PageDown:()=>Ln.stepDown(we),Home:()=>ln(on.min),End:()=>ln(on.max)}[Vt.key];fi&&(Vt.preventDefault(),Vt.stopPropagation(),fi(Vt),on.eventSource="keyboard")},[Ln,ln,we,Ue]),Yn=(Q==null?void 0:Q(ye))??H,{getThumbStyle:Kt,rootStyle:Re,trackStyle:Fe,innerTrackStyle:Ke}=L.useMemo(()=>{const Vt=Ue.current;return cMe({isReversed:ne,orientation:Vt.orientation,thumbPercents:[Se]})},[ne,Se,Ue]),yt=L.useCallback(()=>{Ue.current.focusThumbOnChange&&setTimeout(()=>{var on;return(on=et.current)==null?void 0:on.focus()})},[Ue]);mg(()=>{const Vt=Ue.current;yt(),Vt.eventSource==="keyboard"&&(Z==null||Z(Vt.value))},[ye,Z]);function St(Vt){const on=Ut(Vt);on!=null&&on!==Ue.current.value&&fe(on)}cye(nt,{onPanSessionStart(Vt){const on=Ue.current;on.isInteractive&&(ue(!0),yt(),St(Vt),ge==null||ge(on.value))},onPanSessionEnd(){const Vt=Ue.current;Vt.isInteractive&&(ue(!1),Z==null||Z(Vt.value))},onPan(Vt){Ue.current.isInteractive&&St(Vt)}});const Ge=L.useCallback((Vt={},on=null)=>({...Vt,...oe,ref:to(on,nt),tabIndex:-1,"aria-disabled":LS(w),"data-focused":Kn(Me),style:{...Vt.style,...Re}}),[oe,w,Me,Re]),Ot=L.useCallback((Vt={},on=null)=>({...Vt,ref:to(on,ze),id:hn,"data-disabled":Kn(w),style:{...Vt.style,...Fe}}),[w,hn,Fe]),Jt=L.useCallback((Vt={},on=null)=>({...Vt,ref:on,style:{...Vt.style,...Ke}}),[Ke]),fn=L.useCallback((Vt={},on=null)=>({...Vt,ref:to(on,et),role:"slider",tabIndex:rt?0:void 0,id:It,"data-active":Kn(he),"aria-valuetext":Yn,"aria-valuemin":t,"aria-valuemax":i,"aria-valuenow":ye,"aria-orientation":v,"aria-disabled":LS(w),"aria-readonly":LS(A),"aria-label":ee,"aria-labelledby":ee?void 0:K,style:{...Vt.style,...Kt(0)},onKeyDown:Qn(Vt.onKeyDown,Xt),onFocus:Qn(Vt.onFocus,()=>He(!0)),onBlur:Qn(Vt.onBlur,()=>He(!1))}),[rt,It,he,Yn,t,i,ye,v,w,A,ee,K,Kt,Xt]),an=L.useCallback((Vt,on=null)=>{const Pi=!(Vt.value<t||Vt.value>i),fi=ye>=Vt.value,Ti=K$(Vt.value,t,i),ur={position:"absolute",pointerEvents:"none",...dMe({orientation:v,vertical:{bottom:ne?`${100-Ti}%`:`${Ti}%`},horizontal:{left:ne?`${100-Ti}%`:`${Ti}%`}})};return{...Vt,ref:on,role:"presentation","aria-hidden":!0,"data-disabled":Kn(w),"data-invalid":Kn(!Pi),"data-highlighted":Kn(fi),style:{...Vt.style,...ur}}},[w,ne,i,t,v,ye]),ir=L.useCallback((Vt={},on=null)=>({...Vt,ref:on,type:"hidden",value:ye,name:te}),[te,ye]);return{state:{value:ye,isFocused:Me,isDragging:he},actions:Ln,getRootProps:Ge,getTrackProps:Ot,getInnerTrackProps:Jt,getThumbProps:fn,getMarkerProps:an,getInputProps:ir}}function dMe(n){const{orientation:t,vertical:i,horizontal:a}=n;return t==="vertical"?i:a}function hMe(n,t){return t<n?n:n+(t-n)/2}const[fMe,ON]=Ki({name:"SliderContext",hookName:"useSliderContext",providerName:"<Slider />"}),[pMe,kN]=Ki({name:"SliderStylesContext",hookName:"useSliderStyles",providerName:"<Slider />"}),aV=Yt((n,t)=>{const i={...n,orientation:(n==null?void 0:n.orientation)??"horizontal"},a=tl("Slider",i),l=qi(i),{direction:d}=A0();l.direction=d;const{getInputProps:p,getRootProps:E,...v}=uMe(l),b=E(),w=p({},t);return C.jsx(fMe,{value:v,children:C.jsx(pMe,{value:a,children:C.jsxs(Lt.div,{...b,className:dn("chakra-slider",i.className),__css:a.container,children:[i.children,C.jsx("input",{...w})]})})})});aV.displayName="Slider";const cV=Yt((n,t)=>{const{getThumbProps:i}=ON(),a=kN(),l=i(n,t);return C.jsx(Lt.div,{...l,className:dn("chakra-slider__thumb",n.className),__css:a.thumb})});cV.displayName="SliderThumb";const lV=Yt((n,t)=>{const{getTrackProps:i}=ON(),a=kN(),l=i(n,t);return C.jsx(Lt.div,{...l,className:dn("chakra-slider__track",n.className),__css:a.track})});lV.displayName="SliderTrack";const uV=Yt((n,t)=>{const{getInnerTrackProps:i}=ON(),a=kN(),l=i(n,t);return C.jsx(Lt.div,{...l,className:dn("chakra-slider__filled-track",n.className),__css:a.filledTrack})});uV.displayName="SliderFilledTrack";const mMe=Yt((n,t)=>{const{getMarkerProps:i}=ON(),a=kN(),l=i(n,t);return C.jsx(Lt.div,{...l,className:dn("chakra-slider__marker",n.className),__css:a.mark})});mMe.displayName="SliderMark";const Pk=Lt("div",{baseStyle:{flex:1,justifySelf:"stretch",alignSelf:"stretch"}});Pk.displayName="Spacer";const Cne=n=>C.jsx(Lt.div,{className:"chakra-stack__item",...n,__css:{display:"inline-block",flex:"0 0 auto",minWidth:0,...n.__css}});Cne.displayName="StackItem";function gMe(n){const{spacing:t,direction:i}=n,a={column:{my:t,mx:0,borderLeftWidth:0,borderBottomWidth:"1px"},"column-reverse":{my:t,mx:0,borderLeftWidth:0,borderBottomWidth:"1px"},row:{mx:t,my:0,borderLeftWidth:"1px",borderBottomWidth:0},"row-reverse":{mx:t,my:0,borderLeftWidth:"1px",borderBottomWidth:0}};return{"&":sN(i,l=>a[l])}}const Rj=Yt((n,t)=>{const{isInline:i,direction:a,align:l,justify:d,spacing:p="0.5rem",wrap:E,children:v,divider:b,className:w,shouldWrapChildren:A,...N}=n,F=i?"row":a??"column",j=L.useMemo(()=>gMe({spacing:p,direction:F}),[p,F]),B=!!b,H=!A&&!B,ee=L.useMemo(()=>{const te=JV(v);return H?te:te.map((le,oe)=>{const ge=typeof le.key<"u"?le.key:oe,Z=oe+1===te.length,ne=A?C.jsx(Cne,{children:le},ge):le;if(!B)return ne;const se=L.cloneElement(b,{__css:j}),fe=Z?null:se;return C.jsxs(L.Fragment,{children:[ne,fe]},ge)})},[b,j,B,H,A,v]),K=dn("chakra-stack",w);return C.jsx(Lt.div,{ref:t,display:"flex",alignItems:l,justifyContent:d,flexDirection:F,flexWrap:E,gap:B?void 0:p,className:K,...N,children:ee})});Rj.displayName="Stack";const Ni=Yt((n,t)=>C.jsx(Rj,{align:"center",...n,direction:"row",ref:t}));Ni.displayName="HStack";const ri=Yt((n,t)=>C.jsx(Rj,{align:"center",...n,direction:"column",ref:t}));ri.displayName="VStack";const ag=Yt(function(t,i){const a=tl("Switch",t),{spacing:l="0.5rem",children:d,...p}=qi(t),{getIndicatorProps:E,getInputProps:v,getCheckboxProps:b,getRootProps:w,getLabelProps:A}=CNe(p),N=L.useMemo(()=>({display:"inline-block",position:"relative",verticalAlign:"middle",lineHeight:0,...a.container}),[a.container]),F=L.useMemo(()=>({display:"inline-flex",flexShrink:0,justifyContent:"flex-start",boxSizing:"content-box",cursor:"pointer",...a.track}),[a.track]),j=L.useMemo(()=>({userSelect:"none",marginStart:l,...a.label}),[l,a.label]);return C.jsxs(Lt.label,{...w(),className:dn("chakra-switch",t.className),__css:N,children:[C.jsx("input",{className:"chakra-switch__input",...v({},i)}),C.jsx(Lt.span,{...b(),className:"chakra-switch__track",__css:F,children:C.jsx(Lt.span,{__css:a.thumb,className:"chakra-switch__thumb",...E()})}),d&&C.jsx(Lt.span,{className:"chakra-switch__label",...A(),__css:j,children:d})]})});ag.displayName="Switch";const[_Me,EMe,yMe,vMe]=ete();function SMe(n){const{defaultIndex:t,onChange:i,index:a,isManual:l,isLazy:d,lazyBehavior:p="unmount",orientation:E="horizontal",direction:v="ltr",...b}=n,[w,A]=L.useState(t??0),[N,F]=AQ({defaultValue:t??0,value:a,onChange:i});L.useEffect(()=>{a!=null&&A(a)},[a]);const j=yMe(),B=L.useId();return{id:`tabs-${n.id??B}`,selectedIndex:N,focusedIndex:w,setSelectedIndex:F,setFocusedIndex:A,isManual:l,isLazy:d,lazyBehavior:p,orientation:E,descendants:j,direction:v,htmlProps:b}}const[bMe,NN]=Ki({name:"TabsContext",errorMessage:"useTabsContext: `context` is undefined. Seems you forgot to wrap all tabs components within <Tabs />"});function TMe(n){const{focusedIndex:t,orientation:i,direction:a}=NN(),l=EMe(),d=L.useCallback(p=>{const E=()=>{var te;const K=l.nextEnabled(t);K&&((te=K.node)==null||te.focus())},v=()=>{var te;const K=l.prevEnabled(t);K&&((te=K.node)==null||te.focus())},b=()=>{var te;const K=l.firstEnabled();K&&((te=K.node)==null||te.focus())},w=()=>{var te;const K=l.lastEnabled();K&&((te=K.node)==null||te.focus())},A=i==="horizontal",N=i==="vertical",F=p.key,j=a==="ltr"?"ArrowLeft":"ArrowRight",B=a==="ltr"?"ArrowRight":"ArrowLeft",ee={[j]:()=>A&&v(),[B]:()=>A&&E(),ArrowDown:()=>N&&E(),ArrowUp:()=>N&&v(),Home:b,End:w}[F];ee&&(p.preventDefault(),ee(p))},[l,t,i,a]);return{...n,role:"tablist","aria-orientation":i,onKeyDown:Qn(n.onKeyDown,d)}}function wMe(n){const{isDisabled:t=!1,isFocusable:i=!1,...a}=n,{setSelectedIndex:l,isManual:d,id:p,setFocusedIndex:E,selectedIndex:v}=NN(),{index:b,register:w}=vMe({disabled:t&&!i}),A=b===v,N=()=>{l(b)},F=()=>{E(b),!d&&!(t&&i)&&l(b)};return{...ene({...a,ref:to(w,n.ref),isDisabled:t,isFocusable:i,onClick:Qn(n.onClick,N)}),id:Ine(p,b),role:"tab",tabIndex:A?0:-1,type:"button","aria-selected":A,"aria-controls":Ane(p,b),onFocus:t?void 0:Qn(n.onFocus,F)}}const[RMe,CMe]=Ki({});function IMe(n){const t=NN(),{id:i,selectedIndex:a}=t,d=JV(n.children).map((p,E)=>L.createElement(RMe,{key:p.key??E,value:{isSelected:E===a,id:Ane(i,E),tabId:Ine(i,E),selectedIndex:a}},p));return{...n,children:d}}function AMe(n){const{children:t,...i}=n,{isLazy:a,lazyBehavior:l}=NN(),{isSelected:d,id:p,tabId:E}=CMe(),v=L.useRef(!1);d&&(v.current=!0);const b=QV({wasSelected:v.current,isSelected:d,enabled:a,mode:l});return{tabIndex:0,...i,children:b?t:null,role:"tabpanel","aria-labelledby":E,hidden:!d,id:p}}function Ine(n,t){return`${n}--tab-${t}`}function Ane(n,t){return`${n}--tabpanel-${t}`}const[PMe,DN]=Ki({name:"TabsStylesContext",errorMessage:`useTabsStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Tabs />" `}),ZR=Yt(function(t,i){const a=tl("Tabs",t),{children:l,className:d,...p}=qi(t),{htmlProps:E,descendants:v,...b}=SMe(p),w=L.useMemo(()=>b,[b]),{isFitted:A,...N}=E,F={position:"relative",...a.root};return C.jsx(_Me,{value:v,children:C.jsx(bMe,{value:w,children:C.jsx(PMe,{value:a,children:C.jsx(Lt.div,{className:dn("chakra-tabs",d),ref:i,...N,__css:F,children:l})})})})});ZR.displayName="Tabs";const Kc=Yt(function(t,i){const a=DN(),l=wMe({...t,ref:i}),d={outline:"0",display:"flex",alignItems:"center",justifyContent:"center",...a.tab};return C.jsx(Lt.button,{...l,className:dn("chakra-tabs__tab",t.className),__css:d})});Kc.displayName="Tab";const eC=Yt(function(t,i){const a=TMe({...t,ref:i}),l=DN(),d={display:"flex",...l.tablist};return C.jsx(Lt.div,{...a,className:dn("chakra-tabs__tablist",t.className),__css:d})});eC.displayName="TabList";const wu=Yt(function(t,i){const a=AMe({...t,ref:i}),l=DN();return C.jsx(Lt.div,{outline:"0",...a,className:dn("chakra-tabs__tab-panel",t.className),__css:l.tabpanel})});wu.displayName="TabPanel";const LN=Yt(function(t,i){const a=IMe(t),l=DN();return C.jsx(Lt.div,{...a,width:"100%",ref:i,className:dn("chakra-tabs__tab-panels",t.className),__css:l.tabpanels})});LN.displayName="TabPanels";const OMe=["h","minH","height","minHeight"],Pne=Yt((n,t)=>{const i=xl("Textarea",n),{className:a,rows:l,...d}=qi(n),p=rj(d),E=l?T0(i,OMe):i;return C.jsx(Lt.textarea,{ref:t,rows:l,...p,className:dn("chakra-textarea",a),__css:E})});Pne.displayName="Textarea";function kMe(n,t){const i=n??"bottom",l={"top-start":{ltr:"top-left",rtl:"top-right"},"top-end":{ltr:"top-right",rtl:"top-left"},"bottom-start":{ltr:"bottom-left",rtl:"bottom-right"},"bottom-end":{ltr:"bottom-right",rtl:"bottom-left"}}[i];return(l==null?void 0:l[t])??i}function NMe(n,t){const i=l=>({...t,...l,position:kMe((l==null?void 0:l.position)??(t==null?void 0:t.position),n)}),a=l=>{const d=i(l),p=Jee(d);return Uh.notify(p,d)};return a.update=(l,d)=>{Uh.update(l,i(d))},a.promise=(l,d)=>{const p=a({...d.loading,status:"loading",duration:null});l.then(E=>a.update(p,{status:"success",duration:5e3,...Yc(d.success,E)})).catch(E=>a.update(p,{status:"error",duration:5e3,...Yc(d.error,E)}))},a.closeAll=Uh.closeAll,a.close=Uh.close,a.isActive=Uh.isActive,a}function Dd(n){const{theme:t}=qee(),i=Qke();return L.useMemo(()=>NMe(t.direction,{...i,...n}),[n,t.direction,i])}const DMe={exit:{scale:.85,opacity:0,transition:{opacity:{duration:.15,easings:"easeInOut"},scale:{duration:.2,easings:"easeInOut"}}},enter:{scale:1,opacity:1,transition:{opacity:{easings:"easeOut",duration:.2},scale:{duration:.2,ease:[.175,.885,.4,1.1]}}}},dV=n=>{var t;return((t=n.current)==null?void 0:t.ownerDocument)||document},QO=n=>{var t,i;return((i=(t=n.current)==null?void 0:t.ownerDocument)==null?void 0:i.defaultView)||window};function LMe(n={}){const{openDelay:t=0,closeDelay:i=0,closeOnClick:a=!0,closeOnMouseDown:l,closeOnScroll:d,closeOnPointerDown:p=l,closeOnEsc:E=!0,onOpen:v,onClose:b,placement:w,id:A,isOpen:N,defaultIsOpen:F,arrowSize:j=10,arrowShadowColor:B,arrowPadding:H,modifiers:ee,isDisabled:K,gutter:te,offset:le,direction:oe,...ge}=n,{isOpen:Z,onOpen:Q,onClose:ne}=Cp({isOpen:N,defaultIsOpen:F,onOpen:v,onClose:b}),{referenceRef:se,getPopperProps:fe,getArrowInnerProps:he,getArrowProps:ue}=wj({enabled:Z,placement:w,arrowPadding:H,modifiers:ee,gutter:te,offset:le,direction:oe}),Me=L.useId(),rt=`tooltip-${A??Me}`,we=L.useRef(null),Ce=L.useRef(void 0),ye=L.useCallback(()=>{Ce.current&&(clearTimeout(Ce.current),Ce.current=void 0)},[]),Ne=L.useRef(void 0),be=L.useCallback(()=>{Ne.current&&(clearTimeout(Ne.current),Ne.current=void 0)},[]),Se=L.useCallback(()=>{be(),ne()},[ne,be]),Ae=xMe(we,Se),Ue=L.useCallback(()=>{if(!K&&!Ce.current){Z&&Ae();const Ut=QO(we);Ce.current=Ut.setTimeout(Q,t)}},[Ae,K,Z,Q,t]),ze=L.useCallback(()=>{ye();const Ut=QO(we);Ne.current=Ut.setTimeout(Se,i)},[i,Se,ye]),et=L.useCallback(()=>{Z&&a&&ze()},[a,ze,Z]),nt=L.useCallback(()=>{Z&&p&&ze()},[p,ze,Z]),dt=L.useCallback(Ut=>{Z&&Ut.key==="Escape"&&ze()},[Z,ze]);xS(()=>dV(we),"keydown",E?dt:void 0),xS(()=>{if(!d)return null;const Ut=we.current;if(!Ut)return null;const ln=CQ(Ut);return ln.localName==="body"?QO(we):ln},"scroll",()=>{Z&&d&&Se()},{passive:!0,capture:!0}),L.useEffect(()=>{K&&(ye(),Z&&ne())},[K,Z,ne,ye]),L.useEffect(()=>()=>{ye(),be()},[ye,be]),xS(()=>we.current,"pointerleave",ze);const Xe=L.useCallback((Ut={},ln=null)=>({...Ut,ref:to(we,ln,se),onPointerEnter:Qn(Ut.onPointerEnter,Xt=>{Xt.pointerType!=="touch"&&Ue()}),onClick:Qn(Ut.onClick,et),onPointerDown:Qn(Ut.onPointerDown,nt),onFocus:Qn(Ut.onFocus,Ue),onBlur:Qn(Ut.onBlur,ze),"aria-describedby":Z?rt:void 0}),[Ue,ze,nt,Z,rt,et,se]),It=L.useCallback((Ut={},ln=null)=>fe({...Ut,style:{...Ut.style,[Ko.arrowSize.var]:j?`${j}px`:void 0,[Ko.arrowShadowColor.var]:B}},ln),[fe,j,B]),hn=L.useCallback((Ut={},ln=null)=>{const Ln={...Ut.style,position:"relative",transformOrigin:Ko.transformOrigin.varRef};return{ref:ln,...ge,...Ut,id:rt,role:"tooltip",style:Ln}},[ge,rt]);return{isOpen:Z,show:Ue,hide:ze,getTriggerProps:Xe,getTooltipProps:hn,getTooltipPositionerProps:It,getArrowProps:ue,getArrowInnerProps:he}}const z2="chakra-ui:close-tooltip";function xMe(n,t){return L.useEffect(()=>{const i=dV(n);return i.addEventListener(z2,t),()=>i.removeEventListener(z2,t)},[t,n]),()=>{const i=dV(n),a=QO(n);i.dispatchEvent(new a.CustomEvent(z2))}}const MMe=Lt(of.div),cg=Yt((n,t)=>{const i=xl("Tooltip",n),a=qi(n),l=A0(),{children:d,label:p,shouldWrapChildren:E,"aria-label":v,hasArrow:b,bg:w,portalProps:A,background:N,backgroundColor:F,bgColor:j,motionProps:B,animatePresenceProps:H,...ee}=a,K=N??F??w??j;if(K){i.bg=K;const se=Qye(l,"colors",K);i[Ko.arrowBg.var]=se}const te=LMe({...ee,direction:l.direction}),le=!L.isValidElement(d)||E;let oe;if(le)oe=C.jsx(Lt.span,{display:"inline-block",tabIndex:0,...te.getTriggerProps(),children:d});else{const se=L.Children.only(d);oe=L.cloneElement(se,te.getTriggerProps(se.props,Ene(se)))}const ge=!!v,Z=te.getTooltipProps({},t),Q=ge?T0(Z,["role","id"]):Z,ne=RQ(Z,["role","id"]);return p?C.jsxs(C.Fragment,{children:[oe,C.jsx(R0,{...H,children:te.isOpen&&C.jsx(Ml,{...A,children:C.jsx(Lt.div,{...te.getTooltipPositionerProps(),__css:{zIndex:i.zIndex,pointerEvents:"none"},children:C.jsxs(MMe,{variants:DMe,initial:"exit",animate:"enter",exit:"exit",...B,...Q,__css:i,children:[p,ge&&C.jsx(Lt.span,{srOnly:!0,...ne,children:v}),b&&C.jsx(Lt.div,{"data-popper-arrow":!0,className:"chakra-tooltip__arrow-wrapper",children:C.jsx(Lt.div,{"data-popper-arrow-inner":!0,className:"chakra-tooltip__arrow",__css:{bg:i.bg}})})]})})})})]}):C.jsx(C.Fragment,{children:d})});cg.displayName="Tooltip";const Ok=Yt(function(t,i){const a=xl("Heading",t),{className:l,...d}=qi(t);return C.jsx(Lt.h2,{ref:i,className:dn("chakra-heading",t.className),...d,__css:a})});Ok.displayName="Heading";const ht=Yt(function(t,i){const a=xl("Text",t),{className:l,align:d,decoration:p,casing:E,...v}=qi(t),b=oN({textAlign:t.align,textDecoration:t.decoration,textTransform:t.casing});return C.jsx(Lt.p,{ref:i,className:dn("chakra-text",t.className),...b,...v,__css:a})});ht.displayName="Text";const UMe="modulepreload",VMe=function(n,t){return new URL(n,t).href},MY={},G2=function(t,i,a){let l=Promise.resolve();if(i&&i.length>0){const p=document.getElementsByTagName("link"),E=document.querySelector("meta[property=csp-nonce]"),v=(E==null?void 0:E.nonce)||(E==null?void 0:E.getAttribute("nonce"));l=Promise.allSettled(i.map(b=>{if(b=VMe(b,a),b in MY)return;MY[b]=!0;const w=b.endsWith(".css"),A=w?'[rel="stylesheet"]':"";if(!!a)for(let j=p.length-1;j>=0;j--){const B=p[j];if(B.href===b&&(!w||B.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${b}"]${A}`))return;const F=document.createElement("link");if(F.rel=w?"stylesheet":UMe,w||(F.as="script"),F.crossOrigin="",F.href=b,v&&F.setAttribute("nonce",v),document.head.appendChild(F),w)return new Promise((j,B)=>{F.addEventListener("load",j),F.addEventListener("error",()=>B(new Error(`Unable to preload CSS for ${b}`)))})}))}function d(p){const E=new Event("vite:preloadError",{cancelable:!0});if(E.payload=p,window.dispatchEvent(E),!E.defaultPrevented)throw p}return l.then(p=>{for(const E of p||[])E.status==="rejected"&&d(E.reason);return t().catch(d)})},EO=()=>{const n=new Date,t=n.getHours().toString().padStart(2,"0"),i=n.getMinutes().toString().padStart(2,"0"),a=n.getSeconds().toString().padStart(2,"0"),l=n.getMilliseconds().toString().padStart(3,"0");return`${t}:${i}:${a}.${l}`},Te={log:(...n)=>{{const t=n.map((i,a)=>a===0&&typeof i=="string"?`
${i}`:i);console.log(`[LOG] [${EO()}] `,...t)}},error:(...n)=>{{const t=n.map((i,a)=>a===0&&typeof i=="string"?`
${i}`:i);console.error(`[ERROR] [${EO()}] `,...t)}},warn:(...n)=>{{const t=n.map((i,a)=>a===0&&typeof i=="string"?`
${i}`:i);console.warn(`[WARN] [${EO()}]`,...t)}},trace:n=>{console.trace(`[TRACE] [${EO()}] ${n}`)}};async function wR(n){let t;try{switch(n){case"default":t=await G2(()=>import("./index.v0.1.5.js"),[],import.meta.url);break;default:t=await G2(()=>import("./index.v0.1.5.js"),[],import.meta.url)}return t.default}catch(i){return Te.error("Failed to load theme:",i),t=await G2(()=>import("./index.v0.1.5.js"),[],import.meta.url),t.default}}const FMe=()=>{};var UY={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const One=function(n){const t=[];let i=0;for(let a=0;a<n.length;a++){let l=n.charCodeAt(a);l<128?t[i++]=l:l<2048?(t[i++]=l>>6|192,t[i++]=l&63|128):(l&64512)===55296&&a+1<n.length&&(n.charCodeAt(a+1)&64512)===56320?(l=65536+((l&1023)<<10)+(n.charCodeAt(++a)&1023),t[i++]=l>>18|240,t[i++]=l>>12&63|128,t[i++]=l>>6&63|128,t[i++]=l&63|128):(t[i++]=l>>12|224,t[i++]=l>>6&63|128,t[i++]=l&63|128)}return t},jMe=function(n){const t=[];let i=0,a=0;for(;i<n.length;){const l=n[i++];if(l<128)t[a++]=String.fromCharCode(l);else if(l>191&&l<224){const d=n[i++];t[a++]=String.fromCharCode((l&31)<<6|d&63)}else if(l>239&&l<365){const d=n[i++],p=n[i++],E=n[i++],v=((l&7)<<18|(d&63)<<12|(p&63)<<6|E&63)-65536;t[a++]=String.fromCharCode(55296+(v>>10)),t[a++]=String.fromCharCode(56320+(v&1023))}else{const d=n[i++],p=n[i++];t[a++]=String.fromCharCode((l&15)<<12|(d&63)<<6|p&63)}}return t.join("")},kne={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,t){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const i=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,a=[];for(let l=0;l<n.length;l+=3){const d=n[l],p=l+1<n.length,E=p?n[l+1]:0,v=l+2<n.length,b=v?n[l+2]:0,w=d>>2,A=(d&3)<<4|E>>4;let N=(E&15)<<2|b>>6,F=b&63;v||(F=64,p||(N=64)),a.push(i[w],i[A],i[N],i[F])}return a.join("")},encodeString(n,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(n):this.encodeByteArray(One(n),t)},decodeString(n,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(n):jMe(this.decodeStringToByteArray(n,t))},decodeStringToByteArray(n,t){this.init_();const i=t?this.charToByteMapWebSafe_:this.charToByteMap_,a=[];for(let l=0;l<n.length;){const d=i[n.charAt(l++)],E=l<n.length?i[n.charAt(l)]:0;++l;const b=l<n.length?i[n.charAt(l)]:64;++l;const A=l<n.length?i[n.charAt(l)]:64;if(++l,d==null||E==null||b==null||A==null)throw new BMe;const N=d<<2|E>>4;if(a.push(N),b!==64){const F=E<<4&240|b>>2;if(a.push(F),A!==64){const j=b<<6&192|A;a.push(j)}}}return a},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class BMe extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const WMe=function(n){const t=One(n);return kne.encodeByteArray(t,!0)},kk=function(n){return WMe(n).replace(/\./g,"")},Nne=function(n){try{return kne.decodeString(n,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zMe(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GMe=()=>zMe().__FIREBASE_DEFAULTS__,HMe=()=>{if(typeof process>"u"||typeof UY>"u")return;const n=UY.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},$Me=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const t=n&&Nne(n[1]);return t&&JSON.parse(t)},xN=()=>{try{return FMe()||GMe()||HMe()||$Me()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},Dne=n=>{var t,i;return(i=(t=xN())===null||t===void 0?void 0:t.emulatorHosts)===null||i===void 0?void 0:i[n]},Lne=n=>{const t=Dne(n);if(!t)return;const i=t.lastIndexOf(":");if(i<=0||i+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const a=parseInt(t.substring(i+1),10);return t[0]==="["?[t.substring(1,i-1),a]:[t.substring(0,i),a]},xne=()=>{var n;return(n=xN())===null||n===void 0?void 0:n.config},Mne=n=>{var t;return(t=xN())===null||t===void 0?void 0:t[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KMe{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((t,i)=>{this.resolve=t,this.reject=i})}wrapCallback(t){return(i,a)=>{i?this.reject(i):this.resolve(a),typeof t=="function"&&(this.promise.catch(()=>{}),t.length===1?t(i):t(i,a))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Une(n,t){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const i={alg:"none",type:"JWT"},a=t||"demo-project",l=n.iat||0,d=n.sub||n.user_id;if(!d)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const p=Object.assign({iss:`https://securetoken.google.com/${a}`,aud:a,iat:l,exp:l+3600,auth_time:l,sub:d,user_id:d,firebase:{sign_in_provider:"custom",identities:{}}},n);return[kk(JSON.stringify(i)),kk(JSON.stringify(p)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fa(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function qMe(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Fa())}function YMe(){var n;const t=(n=xN())===null||n===void 0?void 0:n.forceEnvironment;if(t==="node")return!0;if(t==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function XMe(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function JMe(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function QMe(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function ZMe(){const n=Fa();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function e2e(){return!YMe()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function t2e(){try{return typeof indexedDB=="object"}catch{return!1}}function n2e(){return new Promise((n,t)=>{try{let i=!0;const a="validate-browser-context-for-indexeddb-analytics-module",l=self.indexedDB.open(a);l.onsuccess=()=>{l.result.close(),i||self.indexedDB.deleteDatabase(a),n(!0)},l.onupgradeneeded=()=>{i=!1},l.onerror=()=>{var d;t(((d=l.error)===null||d===void 0?void 0:d.message)||"")}}catch(i){t(i)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const r2e="FirebaseError";class af extends Error{constructor(t,i,a){super(i),this.code=t,this.customData=a,this.name=r2e,Object.setPrototypeOf(this,af.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,tC.prototype.create)}}class tC{constructor(t,i,a){this.service=t,this.serviceName=i,this.errors=a}create(t,...i){const a=i[0]||{},l=`${this.service}/${t}`,d=this.errors[t],p=d?i2e(d,a):"Error",E=`${this.serviceName}: ${p} (${l}).`;return new af(l,E,a)}}function i2e(n,t){return n.replace(o2e,(i,a)=>{const l=t[a];return l!=null?String(l):`<${a}?>`})}const o2e=/\{\$([^}]+)}/g;function s2e(n){for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t))return!1;return!0}function OE(n,t){if(n===t)return!0;const i=Object.keys(n),a=Object.keys(t);for(const l of i){if(!a.includes(l))return!1;const d=n[l],p=t[l];if(VY(d)&&VY(p)){if(!OE(d,p))return!1}else if(d!==p)return!1}for(const l of a)if(!i.includes(l))return!1;return!0}function VY(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nC(n){const t=[];for(const[i,a]of Object.entries(n))Array.isArray(a)?a.forEach(l=>{t.push(encodeURIComponent(i)+"="+encodeURIComponent(l))}):t.push(encodeURIComponent(i)+"="+encodeURIComponent(a));return t.length?"&"+t.join("&"):""}function Dw(n){const t={};return n.replace(/^\?/,"").split("&").forEach(a=>{if(a){const[l,d]=a.split("=");t[decodeURIComponent(l)]=decodeURIComponent(d)}}),t}function Lw(n){const t=n.indexOf("?");if(!t)return"";const i=n.indexOf("#",t);return n.substring(t,i>0?i:void 0)}function a2e(n,t){const i=new c2e(n,t);return i.subscribe.bind(i)}class c2e{constructor(t,i){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=i,this.task.then(()=>{t(this)}).catch(a=>{this.error(a)})}next(t){this.forEachObserver(i=>{i.next(t)})}error(t){this.forEachObserver(i=>{i.error(t)}),this.close(t)}complete(){this.forEachObserver(t=>{t.complete()}),this.close()}subscribe(t,i,a){let l;if(t===void 0&&i===void 0&&a===void 0)throw new Error("Missing Observer.");l2e(t,["next","error","complete"])?l=t:l={next:t,error:i,complete:a},l.next===void 0&&(l.next=H2),l.error===void 0&&(l.error=H2),l.complete===void 0&&(l.complete=H2);const d=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?l.error(this.finalError):l.complete()}catch{}}),this.observers.push(l),d}unsubscribeOne(t){this.observers===void 0||this.observers[t]===void 0||(delete this.observers[t],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(t){if(!this.finalized)for(let i=0;i<this.observers.length;i++)this.sendOne(i,t)}sendOne(t,i){this.task.then(()=>{if(this.observers!==void 0&&this.observers[t]!==void 0)try{i(this.observers[t])}catch(a){typeof console<"u"&&console.error&&console.error(a)}})}close(t){this.finalized||(this.finalized=!0,t!==void 0&&(this.finalError=t),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function l2e(n,t){if(typeof n!="object"||n===null)return!1;for(const i of t)if(i in n&&typeof n[i]=="function")return!0;return!1}function H2(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Li(n){return n&&n._delegate?n._delegate:n}class Eg{constructor(t,i,a){this.name=t,this.instanceFactory=i,this.type=a,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iE="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class u2e{constructor(t,i){this.name=t,this.container=i,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const i=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(i)){const a=new KMe;if(this.instancesDeferred.set(i,a),this.isInitialized(i)||this.shouldAutoInitialize())try{const l=this.getOrInitializeService({instanceIdentifier:i});l&&a.resolve(l)}catch{}}return this.instancesDeferred.get(i).promise}getImmediate(t){var i;const a=this.normalizeInstanceIdentifier(t==null?void 0:t.identifier),l=(i=t==null?void 0:t.optional)!==null&&i!==void 0?i:!1;if(this.isInitialized(a)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:a})}catch(d){if(l)return null;throw d}else{if(l)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,!!this.shouldAutoInitialize()){if(h2e(t))try{this.getOrInitializeService({instanceIdentifier:iE})}catch{}for(const[i,a]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(i);try{const d=this.getOrInitializeService({instanceIdentifier:l});a.resolve(d)}catch{}}}}clearInstance(t=iE){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter(i=>"INTERNAL"in i).map(i=>i.INTERNAL.delete()),...t.filter(i=>"_delete"in i).map(i=>i._delete())])}isComponentSet(){return this.component!=null}isInitialized(t=iE){return this.instances.has(t)}getOptions(t=iE){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:i={}}=t,a=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(a))throw Error(`${this.name}(${a}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const l=this.getOrInitializeService({instanceIdentifier:a,options:i});for(const[d,p]of this.instancesDeferred.entries()){const E=this.normalizeInstanceIdentifier(d);a===E&&p.resolve(l)}return l}onInit(t,i){var a;const l=this.normalizeInstanceIdentifier(i),d=(a=this.onInitCallbacks.get(l))!==null&&a!==void 0?a:new Set;d.add(t),this.onInitCallbacks.set(l,d);const p=this.instances.get(l);return p&&t(p,l),()=>{d.delete(t)}}invokeOnInitCallbacks(t,i){const a=this.onInitCallbacks.get(i);if(a)for(const l of a)try{l(t,i)}catch{}}getOrInitializeService({instanceIdentifier:t,options:i={}}){let a=this.instances.get(t);if(!a&&this.component&&(a=this.component.instanceFactory(this.container,{instanceIdentifier:d2e(t),options:i}),this.instances.set(t,a),this.instancesOptions.set(t,i),this.invokeOnInitCallbacks(a,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,a)}catch{}return a||null}normalizeInstanceIdentifier(t=iE){return this.component?this.component.multipleInstances?t:iE:t}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function d2e(n){return n===iE?void 0:n}function h2e(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class f2e{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const i=this.getProvider(t.name);if(i.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);i.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const i=new u2e(t,this);return this.providers.set(t,i),i}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Sr;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(Sr||(Sr={}));const p2e={debug:Sr.DEBUG,verbose:Sr.VERBOSE,info:Sr.INFO,warn:Sr.WARN,error:Sr.ERROR,silent:Sr.SILENT},m2e=Sr.INFO,g2e={[Sr.DEBUG]:"log",[Sr.VERBOSE]:"log",[Sr.INFO]:"info",[Sr.WARN]:"warn",[Sr.ERROR]:"error"},_2e=(n,t,...i)=>{if(t<n.logLevel)return;const a=new Date().toISOString(),l=g2e[t];if(l)console[l](`[${a}]  ${n.name}:`,...i);else throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class Cj{constructor(t){this.name=t,this._logLevel=m2e,this._logHandler=_2e,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in Sr))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel=typeof t=="string"?p2e[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if(typeof t!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,Sr.DEBUG,...t),this._logHandler(this,Sr.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,Sr.VERBOSE,...t),this._logHandler(this,Sr.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,Sr.INFO,...t),this._logHandler(this,Sr.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,Sr.WARN,...t),this._logHandler(this,Sr.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,Sr.ERROR,...t),this._logHandler(this,Sr.ERROR,...t)}}const E2e=(n,t)=>t.some(i=>n instanceof i);let FY,jY;function y2e(){return FY||(FY=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function v2e(){return jY||(jY=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Vne=new WeakMap,hV=new WeakMap,Fne=new WeakMap,$2=new WeakMap,Ij=new WeakMap;function S2e(n){const t=new Promise((i,a)=>{const l=()=>{n.removeEventListener("success",d),n.removeEventListener("error",p)},d=()=>{i(lg(n.result)),l()},p=()=>{a(n.error),l()};n.addEventListener("success",d),n.addEventListener("error",p)});return t.then(i=>{i instanceof IDBCursor&&Vne.set(i,n)}).catch(()=>{}),Ij.set(t,n),t}function b2e(n){if(hV.has(n))return;const t=new Promise((i,a)=>{const l=()=>{n.removeEventListener("complete",d),n.removeEventListener("error",p),n.removeEventListener("abort",p)},d=()=>{i(),l()},p=()=>{a(n.error||new DOMException("AbortError","AbortError")),l()};n.addEventListener("complete",d),n.addEventListener("error",p),n.addEventListener("abort",p)});hV.set(n,t)}let fV={get(n,t,i){if(n instanceof IDBTransaction){if(t==="done")return hV.get(n);if(t==="objectStoreNames")return n.objectStoreNames||Fne.get(n);if(t==="store")return i.objectStoreNames[1]?void 0:i.objectStore(i.objectStoreNames[0])}return lg(n[t])},set(n,t,i){return n[t]=i,!0},has(n,t){return n instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in n}};function T2e(n){fV=n(fV)}function w2e(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...i){const a=n.call(K2(this),t,...i);return Fne.set(a,t.sort?t.sort():[t]),lg(a)}:v2e().includes(n)?function(...t){return n.apply(K2(this),t),lg(Vne.get(this))}:function(...t){return lg(n.apply(K2(this),t))}}function R2e(n){return typeof n=="function"?w2e(n):(n instanceof IDBTransaction&&b2e(n),E2e(n,y2e())?new Proxy(n,fV):n)}function lg(n){if(n instanceof IDBRequest)return S2e(n);if($2.has(n))return $2.get(n);const t=R2e(n);return t!==n&&($2.set(n,t),Ij.set(t,n)),t}const K2=n=>Ij.get(n);function C2e(n,t,{blocked:i,upgrade:a,blocking:l,terminated:d}={}){const p=indexedDB.open(n,t),E=lg(p);return a&&p.addEventListener("upgradeneeded",v=>{a(lg(p.result),v.oldVersion,v.newVersion,lg(p.transaction),v)}),i&&p.addEventListener("blocked",v=>i(v.oldVersion,v.newVersion,v)),E.then(v=>{d&&v.addEventListener("close",()=>d()),l&&v.addEventListener("versionchange",b=>l(b.oldVersion,b.newVersion,b))}).catch(()=>{}),E}const I2e=["get","getKey","getAll","getAllKeys","count"],A2e=["put","add","delete","clear"],q2=new Map;function BY(n,t){if(!(n instanceof IDBDatabase&&!(t in n)&&typeof t=="string"))return;if(q2.get(t))return q2.get(t);const i=t.replace(/FromIndex$/,""),a=t!==i,l=A2e.includes(i);if(!(i in(a?IDBIndex:IDBObjectStore).prototype)||!(l||I2e.includes(i)))return;const d=async function(p,...E){const v=this.transaction(p,l?"readwrite":"readonly");let b=v.store;return a&&(b=b.index(E.shift())),(await Promise.all([b[i](...E),l&&v.done]))[0]};return q2.set(t,d),d}T2e(n=>({...n,get:(t,i,a)=>BY(t,i)||n.get(t,i,a),has:(t,i)=>!!BY(t,i)||n.has(t,i)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class P2e{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(i=>{if(O2e(i)){const a=i.getImmediate();return`${a.library}/${a.version}`}else return null}).filter(i=>i).join(" ")}}function O2e(n){const t=n.getComponent();return(t==null?void 0:t.type)==="VERSION"}const pV="@firebase/app",WY="0.11.2";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Op=new Cj("@firebase/app"),k2e="@firebase/app-compat",N2e="@firebase/analytics-compat",D2e="@firebase/analytics",L2e="@firebase/app-check-compat",x2e="@firebase/app-check",M2e="@firebase/auth",U2e="@firebase/auth-compat",V2e="@firebase/database",F2e="@firebase/data-connect",j2e="@firebase/database-compat",B2e="@firebase/functions",W2e="@firebase/functions-compat",z2e="@firebase/installations",G2e="@firebase/installations-compat",H2e="@firebase/messaging",$2e="@firebase/messaging-compat",K2e="@firebase/performance",q2e="@firebase/performance-compat",Y2e="@firebase/remote-config",X2e="@firebase/remote-config-compat",J2e="@firebase/storage",Q2e="@firebase/storage-compat",Z2e="@firebase/firestore",eUe="@firebase/vertexai",tUe="@firebase/firestore-compat",nUe="firebase",rUe="11.4.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mV="[DEFAULT]",iUe={[pV]:"fire-core",[k2e]:"fire-core-compat",[D2e]:"fire-analytics",[N2e]:"fire-analytics-compat",[x2e]:"fire-app-check",[L2e]:"fire-app-check-compat",[M2e]:"fire-auth",[U2e]:"fire-auth-compat",[V2e]:"fire-rtdb",[F2e]:"fire-data-connect",[j2e]:"fire-rtdb-compat",[B2e]:"fire-fn",[W2e]:"fire-fn-compat",[z2e]:"fire-iid",[G2e]:"fire-iid-compat",[H2e]:"fire-fcm",[$2e]:"fire-fcm-compat",[K2e]:"fire-perf",[q2e]:"fire-perf-compat",[Y2e]:"fire-rc",[X2e]:"fire-rc-compat",[J2e]:"fire-gcs",[Q2e]:"fire-gcs-compat",[Z2e]:"fire-fst",[tUe]:"fire-fst-compat",[eUe]:"fire-vertex","fire-js":"fire-js",[nUe]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nk=new Map,oUe=new Map,gV=new Map;function zY(n,t){try{n.container.addComponent(t)}catch(i){Op.debug(`Component ${t.name} failed to register with FirebaseApp ${n.name}`,i)}}function kE(n){const t=n.name;if(gV.has(t))return Op.debug(`There were multiple attempts to register component ${t}.`),!1;gV.set(t,n);for(const i of Nk.values())zY(i,n);for(const i of oUe.values())zY(i,n);return!0}function MN(n,t){const i=n.container.getProvider("heartbeat").getImmediate({optional:!0});return i&&i.triggerHeartbeat(),n.container.getProvider(t)}function Cl(n){return n==null?!1:n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sUe={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},ug=new tC("app","Firebase",sUe);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aUe{constructor(t,i,a){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},i),this._name=i.name,this._automaticDataCollectionEnabled=i.automaticDataCollectionEnabled,this._container=a,this.container.addComponent(new Eg("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw ug.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jE=rUe;function jne(n,t={}){let i=n;typeof t!="object"&&(t={name:t});const a=Object.assign({name:mV,automaticDataCollectionEnabled:!1},t),l=a.name;if(typeof l!="string"||!l)throw ug.create("bad-app-name",{appName:String(l)});if(i||(i=xne()),!i)throw ug.create("no-options");const d=Nk.get(l);if(d){if(OE(i,d.options)&&OE(a,d.config))return d;throw ug.create("duplicate-app",{appName:l})}const p=new f2e(l);for(const v of gV.values())p.addComponent(v);const E=new aUe(i,a,p);return Nk.set(l,E),E}function Aj(n=mV){const t=Nk.get(n);if(!t&&n===mV&&xne())return jne();if(!t)throw ug.create("no-app",{appName:n});return t}function Yh(n,t,i){var a;let l=(a=iUe[n])!==null&&a!==void 0?a:n;i&&(l+=`-${i}`);const d=l.match(/\s|\//),p=t.match(/\s|\//);if(d||p){const E=[`Unable to register library "${l}" with version "${t}":`];d&&E.push(`library name "${l}" contains illegal characters (whitespace or "/")`),d&&p&&E.push("and"),p&&E.push(`version name "${t}" contains illegal characters (whitespace or "/")`),Op.warn(E.join(" "));return}kE(new Eg(`${l}-version`,()=>({library:l,version:t}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cUe="firebase-heartbeat-database",lUe=1,RR="firebase-heartbeat-store";let Y2=null;function Bne(){return Y2||(Y2=C2e(cUe,lUe,{upgrade:(n,t)=>{switch(t){case 0:try{n.createObjectStore(RR)}catch(i){console.warn(i)}}}}).catch(n=>{throw ug.create("idb-open",{originalErrorMessage:n.message})})),Y2}async function uUe(n){try{const i=(await Bne()).transaction(RR),a=await i.objectStore(RR).get(Wne(n));return await i.done,a}catch(t){if(t instanceof af)Op.warn(t.message);else{const i=ug.create("idb-get",{originalErrorMessage:t==null?void 0:t.message});Op.warn(i.message)}}}async function GY(n,t){try{const a=(await Bne()).transaction(RR,"readwrite");await a.objectStore(RR).put(t,Wne(n)),await a.done}catch(i){if(i instanceof af)Op.warn(i.message);else{const a=ug.create("idb-set",{originalErrorMessage:i==null?void 0:i.message});Op.warn(a.message)}}}function Wne(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dUe=1024,hUe=30;class fUe{constructor(t){this.container=t,this._heartbeatsCache=null;const i=this.container.getProvider("app").getImmediate();this._storage=new mUe(i),this._heartbeatsCachePromise=this._storage.read().then(a=>(this._heartbeatsCache=a,a))}async triggerHeartbeat(){var t,i;try{const l=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),d=HY();if(((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((i=this._heartbeatsCache)===null||i===void 0?void 0:i.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===d||this._heartbeatsCache.heartbeats.some(p=>p.date===d))return;if(this._heartbeatsCache.heartbeats.push({date:d,agent:l}),this._heartbeatsCache.heartbeats.length>hUe){const p=gUe(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(p,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(a){Op.warn(a)}}async getHeartbeatsHeader(){var t;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const i=HY(),{heartbeatsToSend:a,unsentEntries:l}=pUe(this._heartbeatsCache.heartbeats),d=kk(JSON.stringify({version:2,heartbeats:a}));return this._heartbeatsCache.lastSentHeartbeatDate=i,l.length>0?(this._heartbeatsCache.heartbeats=l,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),d}catch(i){return Op.warn(i),""}}}function HY(){return new Date().toISOString().substring(0,10)}function pUe(n,t=dUe){const i=[];let a=n.slice();for(const l of n){const d=i.find(p=>p.agent===l.agent);if(d){if(d.dates.push(l.date),$Y(i)>t){d.dates.pop();break}}else if(i.push({agent:l.agent,dates:[l.date]}),$Y(i)>t){i.pop();break}a=a.slice(1)}return{heartbeatsToSend:i,unsentEntries:a}}class mUe{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return t2e()?n2e().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const i=await uUe(this.app);return i!=null&&i.heartbeats?i:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(t){var i;if(await this._canUseIndexedDBPromise){const l=await this.read();return GY(this.app,{lastSentHeartbeatDate:(i=t.lastSentHeartbeatDate)!==null&&i!==void 0?i:l.lastSentHeartbeatDate,heartbeats:t.heartbeats})}else return}async add(t){var i;if(await this._canUseIndexedDBPromise){const l=await this.read();return GY(this.app,{lastSentHeartbeatDate:(i=t.lastSentHeartbeatDate)!==null&&i!==void 0?i:l.lastSentHeartbeatDate,heartbeats:[...l.heartbeats,...t.heartbeats]})}else return}}function $Y(n){return kk(JSON.stringify({version:2,heartbeats:n})).length}function gUe(n){if(n.length===0)return-1;let t=0,i=n[0].date;for(let a=1;a<n.length;a++)n[a].date<i&&(i=n[a].date,t=a);return t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _Ue(n){kE(new Eg("platform-logger",t=>new P2e(t),"PRIVATE")),kE(new Eg("heartbeat",t=>new fUe(t),"PRIVATE")),Yh(pV,WY,n),Yh(pV,WY,"esm2017"),Yh("fire-js","")}_Ue("");function zne(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const EUe=zne,Gne=new tC("auth","Firebase",zne());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dk=new Cj("@firebase/auth");function yUe(n,...t){Dk.logLevel<=Sr.WARN&&Dk.warn(`Auth (${jE}): ${n}`,...t)}function ZO(n,...t){Dk.logLevel<=Sr.ERROR&&Dk.error(`Auth (${jE}): ${n}`,...t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kd(n,...t){throw Pj(n,...t)}function Xh(n,...t){return Pj(n,...t)}function Hne(n,t,i){const a=Object.assign(Object.assign({},EUe()),{[t]:i});return new tC("auth","Firebase",a).create(t,{appName:n.name})}function wp(n){return Hne(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Pj(n,...t){if(typeof n!="string"){const i=t[0],a=[...t.slice(1)];return a[0]&&(a[0].appName=n.name),n._errorFactory.create(i,...a)}return Gne.create(n,...t)}function Dn(n,t,...i){if(!n)throw Pj(t,...i)}function mp(n){const t="INTERNAL ASSERTION FAILED: "+n;throw ZO(t),new Error(t)}function kp(n,t){n||mp(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _V(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function vUe(){return KY()==="http:"||KY()==="https:"}function KY(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function SUe(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(vUe()||JMe()||"connection"in navigator)?navigator.onLine:!0}function bUe(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rC{constructor(t,i){this.shortDelay=t,this.longDelay=i,kp(i>t,"Short delay should be less than long delay!"),this.isMobile=qMe()||QMe()}get(){return SUe()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Oj(n,t){kp(n.emulator,"Emulator should always be set here");const{url:i}=n.emulator;return t?`${i}${t.startsWith("/")?t.slice(1):t}`:i}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $ne{static initialize(t,i,a){this.fetchImpl=t,i&&(this.headersImpl=i),a&&(this.responseImpl=a)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;mp("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;mp("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;mp("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TUe={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wUe=new rC(3e4,6e4);function xp(n,t){return n.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:n.tenantId}):t}async function Mp(n,t,i,a,l={}){return Kne(n,l,async()=>{let d={},p={};a&&(t==="GET"?p=a:d={body:JSON.stringify(a)});const E=nC(Object.assign({key:n.config.apiKey},p)).slice(1),v=await n._getAdditionalHeaders();v["Content-Type"]="application/json",n.languageCode&&(v["X-Firebase-Locale"]=n.languageCode);const b=Object.assign({method:t,headers:v},d);return XMe()||(b.referrerPolicy="no-referrer"),$ne.fetch()(qne(n,n.config.apiHost,i,E),b)})}async function Kne(n,t,i){n._canInitEmulator=!1;const a=Object.assign(Object.assign({},TUe),t);try{const l=new CUe(n),d=await Promise.race([i(),l.promise]);l.clearNetworkTimeout();const p=await d.json();if("needConfirmation"in p)throw yO(n,"account-exists-with-different-credential",p);if(d.ok&&!("errorMessage"in p))return p;{const E=d.ok?p.errorMessage:p.error.message,[v,b]=E.split(" : ");if(v==="FEDERATED_USER_ID_ALREADY_LINKED")throw yO(n,"credential-already-in-use",p);if(v==="EMAIL_EXISTS")throw yO(n,"email-already-in-use",p);if(v==="USER_DISABLED")throw yO(n,"user-disabled",p);const w=a[v]||v.toLowerCase().replace(/[_\s]+/g,"-");if(b)throw Hne(n,w,b);kd(n,w)}}catch(l){if(l instanceof af)throw l;kd(n,"network-request-failed",{message:String(l)})}}async function iC(n,t,i,a,l={}){const d=await Mp(n,t,i,a,l);return"mfaPendingCredential"in d&&kd(n,"multi-factor-auth-required",{_serverResponse:d}),d}function qne(n,t,i,a){const l=`${t}${i}?${a}`;return n.config.emulator?Oj(n.config,l):`${n.config.apiScheme}://${l}`}function RUe(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class CUe{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(t){this.auth=t,this.timer=null,this.promise=new Promise((i,a)=>{this.timer=setTimeout(()=>a(Xh(this.auth,"network-request-failed")),wUe.get())})}}function yO(n,t,i){const a={appName:n.name};i.email&&(a.email=i.email),i.phoneNumber&&(a.phoneNumber=i.phoneNumber);const l=Xh(n,t,a);return l.customData._tokenResponse=i,l}function qY(n){return n!==void 0&&n.enterprise!==void 0}class IUe{constructor(t){if(this.siteKey="",this.recaptchaEnforcementState=[],t.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=t.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=t.recaptchaEnforcementState}getProviderEnforcementState(t){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const i of this.recaptchaEnforcementState)if(i.provider&&i.provider===t)return RUe(i.enforcementState);return null}isProviderEnabled(t){return this.getProviderEnforcementState(t)==="ENFORCE"||this.getProviderEnforcementState(t)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function AUe(n,t){return Mp(n,"GET","/v2/recaptchaConfig",xp(n,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function PUe(n,t){return Mp(n,"POST","/v1/accounts:delete",t)}async function Yne(n,t){return Mp(n,"POST","/v1/accounts:lookup",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zw(n){if(n)try{const t=new Date(Number(n));if(!isNaN(t.getTime()))return t.toUTCString()}catch{}}async function OUe(n,t=!1){const i=Li(n),a=await i.getIdToken(t),l=kj(a);Dn(l&&l.exp&&l.auth_time&&l.iat,i.auth,"internal-error");const d=typeof l.firebase=="object"?l.firebase:void 0,p=d==null?void 0:d.sign_in_provider;return{claims:l,token:a,authTime:Zw(X2(l.auth_time)),issuedAtTime:Zw(X2(l.iat)),expirationTime:Zw(X2(l.exp)),signInProvider:p||null,signInSecondFactor:(d==null?void 0:d.sign_in_second_factor)||null}}function X2(n){return Number(n)*1e3}function kj(n){const[t,i,a]=n.split(".");if(t===void 0||i===void 0||a===void 0)return ZO("JWT malformed, contained fewer than 3 sections"),null;try{const l=Nne(i);return l?JSON.parse(l):(ZO("Failed to decode base64 JWT payload"),null)}catch(l){return ZO("Caught error parsing JWT payload as JSON",l==null?void 0:l.toString()),null}}function YY(n){const t=kj(n);return Dn(t,"internal-error"),Dn(typeof t.exp<"u","internal-error"),Dn(typeof t.iat<"u","internal-error"),Number(t.exp)-Number(t.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function CR(n,t,i=!1){if(i)return t;try{return await t}catch(a){throw a instanceof af&&kUe(a)&&n.auth.currentUser===n&&await n.auth.signOut(),a}}function kUe({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NUe{constructor(t){this.user=t,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(t){var i;if(t){const a=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),a}else{this.errorBackoff=3e4;const l=((i=this.user.stsTokenManager.expirationTime)!==null&&i!==void 0?i:0)-Date.now()-3e5;return Math.max(0,l)}}schedule(t=!1){if(!this.isRunning)return;const i=this.getInterval(t);this.timerId=setTimeout(async()=>{await this.iteration()},i)}async iteration(){try{await this.user.getIdToken(!0)}catch(t){(t==null?void 0:t.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EV{constructor(t,i){this.createdAt=t,this.lastLoginAt=i,this._initializeTime()}_initializeTime(){this.lastSignInTime=Zw(this.lastLoginAt),this.creationTime=Zw(this.createdAt)}_copy(t){this.createdAt=t.createdAt,this.lastLoginAt=t.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Lk(n){var t;const i=n.auth,a=await n.getIdToken(),l=await CR(n,Yne(i,{idToken:a}));Dn(l==null?void 0:l.users.length,i,"internal-error");const d=l.users[0];n._notifyReloadListener(d);const p=!((t=d.providerUserInfo)===null||t===void 0)&&t.length?Xne(d.providerUserInfo):[],E=LUe(n.providerData,p),v=n.isAnonymous,b=!(n.email&&d.passwordHash)&&!(E!=null&&E.length),w=v?b:!1,A={uid:d.localId,displayName:d.displayName||null,photoURL:d.photoUrl||null,email:d.email||null,emailVerified:d.emailVerified||!1,phoneNumber:d.phoneNumber||null,tenantId:d.tenantId||null,providerData:E,metadata:new EV(d.createdAt,d.lastLoginAt),isAnonymous:w};Object.assign(n,A)}async function DUe(n){const t=Li(n);await Lk(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}function LUe(n,t){return[...n.filter(a=>!t.some(l=>l.providerId===a.providerId)),...t]}function Xne(n){return n.map(t=>{var{providerId:i}=t,a=YR(t,["providerId"]);return{providerId:i,uid:a.rawId||"",displayName:a.displayName||null,email:a.email||null,phoneNumber:a.phoneNumber||null,photoURL:a.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function xUe(n,t){const i=await Kne(n,{},async()=>{const a=nC({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:l,apiKey:d}=n.config,p=qne(n,l,"/v1/token",`key=${d}`),E=await n._getAdditionalHeaders();return E["Content-Type"]="application/x-www-form-urlencoded",$ne.fetch()(p,{method:"POST",headers:E,body:a})});return{accessToken:i.access_token,expiresIn:i.expires_in,refreshToken:i.refresh_token}}async function MUe(n,t){return Mp(n,"POST","/v2/accounts:revokeToken",xp(n,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $S{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(t){Dn(t.idToken,"internal-error"),Dn(typeof t.idToken<"u","internal-error"),Dn(typeof t.refreshToken<"u","internal-error");const i="expiresIn"in t&&typeof t.expiresIn<"u"?Number(t.expiresIn):YY(t.idToken);this.updateTokensAndExpiration(t.idToken,t.refreshToken,i)}updateFromIdToken(t){Dn(t.length!==0,"internal-error");const i=YY(t);this.updateTokensAndExpiration(t,null,i)}async getToken(t,i=!1){return!i&&this.accessToken&&!this.isExpired?this.accessToken:(Dn(this.refreshToken,t,"user-token-expired"),this.refreshToken?(await this.refresh(t,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(t,i){const{accessToken:a,refreshToken:l,expiresIn:d}=await xUe(t,i);this.updateTokensAndExpiration(a,l,Number(d))}updateTokensAndExpiration(t,i,a){this.refreshToken=i||null,this.accessToken=t||null,this.expirationTime=Date.now()+a*1e3}static fromJSON(t,i){const{refreshToken:a,accessToken:l,expirationTime:d}=i,p=new $S;return a&&(Dn(typeof a=="string","internal-error",{appName:t}),p.refreshToken=a),l&&(Dn(typeof l=="string","internal-error",{appName:t}),p.accessToken=l),d&&(Dn(typeof d=="number","internal-error",{appName:t}),p.expirationTime=d),p}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(t){this.accessToken=t.accessToken,this.refreshToken=t.refreshToken,this.expirationTime=t.expirationTime}_clone(){return Object.assign(new $S,this.toJSON())}_performRefresh(){return mp("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qm(n,t){Dn(typeof n=="string"||typeof n>"u","internal-error",{appName:t})}class gp{constructor(t){var{uid:i,auth:a,stsTokenManager:l}=t,d=YR(t,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new NUe(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=i,this.auth=a,this.stsTokenManager=l,this.accessToken=l.accessToken,this.displayName=d.displayName||null,this.email=d.email||null,this.emailVerified=d.emailVerified||!1,this.phoneNumber=d.phoneNumber||null,this.photoURL=d.photoURL||null,this.isAnonymous=d.isAnonymous||!1,this.tenantId=d.tenantId||null,this.providerData=d.providerData?[...d.providerData]:[],this.metadata=new EV(d.createdAt||void 0,d.lastLoginAt||void 0)}async getIdToken(t){const i=await CR(this,this.stsTokenManager.getToken(this.auth,t));return Dn(i,this.auth,"internal-error"),this.accessToken!==i&&(this.accessToken=i,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),i}getIdTokenResult(t){return OUe(this,t)}reload(){return DUe(this)}_assign(t){this!==t&&(Dn(this.uid===t.uid,this.auth,"internal-error"),this.displayName=t.displayName,this.photoURL=t.photoURL,this.email=t.email,this.emailVerified=t.emailVerified,this.phoneNumber=t.phoneNumber,this.isAnonymous=t.isAnonymous,this.tenantId=t.tenantId,this.providerData=t.providerData.map(i=>Object.assign({},i)),this.metadata._copy(t.metadata),this.stsTokenManager._assign(t.stsTokenManager))}_clone(t){const i=new gp(Object.assign(Object.assign({},this),{auth:t,stsTokenManager:this.stsTokenManager._clone()}));return i.metadata._copy(this.metadata),i}_onReload(t){Dn(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=t,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(t){this.reloadListener?this.reloadListener(t):this.reloadUserInfo=t}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(t,i=!1){let a=!1;t.idToken&&t.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(t),a=!0),i&&await Lk(this),await this.auth._persistUserIfCurrent(this),a&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Cl(this.auth.app))return Promise.reject(wp(this.auth));const t=await this.getIdToken();return await CR(this,PUe(this.auth,{idToken:t})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(t=>Object.assign({},t)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(t,i){var a,l,d,p,E,v,b,w;const A=(a=i.displayName)!==null&&a!==void 0?a:void 0,N=(l=i.email)!==null&&l!==void 0?l:void 0,F=(d=i.phoneNumber)!==null&&d!==void 0?d:void 0,j=(p=i.photoURL)!==null&&p!==void 0?p:void 0,B=(E=i.tenantId)!==null&&E!==void 0?E:void 0,H=(v=i._redirectEventId)!==null&&v!==void 0?v:void 0,ee=(b=i.createdAt)!==null&&b!==void 0?b:void 0,K=(w=i.lastLoginAt)!==null&&w!==void 0?w:void 0,{uid:te,emailVerified:le,isAnonymous:oe,providerData:ge,stsTokenManager:Z}=i;Dn(te&&Z,t,"internal-error");const Q=$S.fromJSON(this.name,Z);Dn(typeof te=="string",t,"internal-error"),qm(A,t.name),qm(N,t.name),Dn(typeof le=="boolean",t,"internal-error"),Dn(typeof oe=="boolean",t,"internal-error"),qm(F,t.name),qm(j,t.name),qm(B,t.name),qm(H,t.name),qm(ee,t.name),qm(K,t.name);const ne=new gp({uid:te,auth:t,email:N,emailVerified:le,displayName:A,isAnonymous:oe,photoURL:j,phoneNumber:F,tenantId:B,stsTokenManager:Q,createdAt:ee,lastLoginAt:K});return ge&&Array.isArray(ge)&&(ne.providerData=ge.map(se=>Object.assign({},se))),H&&(ne._redirectEventId=H),ne}static async _fromIdTokenResponse(t,i,a=!1){const l=new $S;l.updateFromServerResponse(i);const d=new gp({uid:i.localId,auth:t,stsTokenManager:l,isAnonymous:a});return await Lk(d),d}static async _fromGetAccountInfoResponse(t,i,a){const l=i.users[0];Dn(l.localId!==void 0,"internal-error");const d=l.providerUserInfo!==void 0?Xne(l.providerUserInfo):[],p=!(l.email&&l.passwordHash)&&!(d!=null&&d.length),E=new $S;E.updateFromIdToken(a);const v=new gp({uid:l.localId,auth:t,stsTokenManager:E,isAnonymous:p}),b={uid:l.localId,displayName:l.displayName||null,photoURL:l.photoUrl||null,email:l.email||null,emailVerified:l.emailVerified||!1,phoneNumber:l.phoneNumber||null,tenantId:l.tenantId||null,providerData:d,metadata:new EV(l.createdAt,l.lastLoginAt),isAnonymous:!(l.email&&l.passwordHash)&&!(d!=null&&d.length)};return Object.assign(v,b),v}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XY=new Map;function _p(n){kp(n instanceof Function,"Expected a class definition");let t=XY.get(n);return t?(kp(t instanceof n,"Instance stored in cache mismatched with class"),t):(t=new n,XY.set(n,t),t)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jne{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(t,i){this.storage[t]=i}async _get(t){const i=this.storage[t];return i===void 0?null:i}async _remove(t){delete this.storage[t]}_addListener(t,i){}_removeListener(t,i){}}Jne.type="NONE";const JY=Jne;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ek(n,t,i){return`firebase:${n}:${t}:${i}`}class KS{constructor(t,i,a){this.persistence=t,this.auth=i,this.userKey=a;const{config:l,name:d}=this.auth;this.fullUserKey=ek(this.userKey,l.apiKey,d),this.fullPersistenceKey=ek("persistence",l.apiKey,d),this.boundEventHandler=i._onStorageEvent.bind(i),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(t){return this.persistence._set(this.fullUserKey,t.toJSON())}async getCurrentUser(){const t=await this.persistence._get(this.fullUserKey);return t?gp._fromJSON(this.auth,t):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(t){if(this.persistence===t)return;const i=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=t,i)return this.setCurrentUser(i)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(t,i,a="authUser"){if(!i.length)return new KS(_p(JY),t,a);const l=(await Promise.all(i.map(async b=>{if(await b._isAvailable())return b}))).filter(b=>b);let d=l[0]||_p(JY);const p=ek(a,t.config.apiKey,t.name);let E=null;for(const b of i)try{const w=await b._get(p);if(w){const A=gp._fromJSON(t,w);b!==d&&(E=A),d=b;break}}catch{}const v=l.filter(b=>b._shouldAllowMigration);return!d._shouldAllowMigration||!v.length?new KS(d,t,a):(d=v[0],E&&await d._set(p,E.toJSON()),await Promise.all(i.map(async b=>{if(b!==d)try{await b._remove(p)}catch{}})),new KS(d,t,a))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function QY(n){const t=n.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(tre(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(Qne(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(rre(t))return"Blackberry";if(ire(t))return"Webos";if(Zne(t))return"Safari";if((t.includes("chrome/")||ere(t))&&!t.includes("edge/"))return"Chrome";if(nre(t))return"Android";{const i=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,a=n.match(i);if((a==null?void 0:a.length)===2)return a[1]}return"Other"}function Qne(n=Fa()){return/firefox\//i.test(n)}function Zne(n=Fa()){const t=n.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function ere(n=Fa()){return/crios\//i.test(n)}function tre(n=Fa()){return/iemobile/i.test(n)}function nre(n=Fa()){return/android/i.test(n)}function rre(n=Fa()){return/blackberry/i.test(n)}function ire(n=Fa()){return/webos/i.test(n)}function Nj(n=Fa()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function UUe(n=Fa()){var t;return Nj(n)&&!!(!((t=window.navigator)===null||t===void 0)&&t.standalone)}function VUe(){return ZMe()&&document.documentMode===10}function ore(n=Fa()){return Nj(n)||nre(n)||ire(n)||rre(n)||/windows phone/i.test(n)||tre(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sre(n,t=[]){let i;switch(n){case"Browser":i=QY(Fa());break;case"Worker":i=`${QY(Fa())}-${n}`;break;default:i=n}const a=t.length?t.join(","):"FirebaseCore-web";return`${i}/JsCore/${jE}/${a}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FUe{constructor(t){this.auth=t,this.queue=[]}pushCallback(t,i){const a=d=>new Promise((p,E)=>{try{const v=t(d);p(v)}catch(v){E(v)}});a.onAbort=i,this.queue.push(a);const l=this.queue.length-1;return()=>{this.queue[l]=()=>Promise.resolve()}}async runMiddleware(t){if(this.auth.currentUser===t)return;const i=[];try{for(const a of this.queue)await a(t),a.onAbort&&i.push(a.onAbort)}catch(a){i.reverse();for(const l of i)try{l()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:a==null?void 0:a.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function jUe(n,t={}){return Mp(n,"GET","/v2/passwordPolicy",xp(n,t))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const BUe=6;class WUe{constructor(t){var i,a,l,d;const p=t.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(i=p.minPasswordLength)!==null&&i!==void 0?i:BUe,p.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=p.maxPasswordLength),p.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=p.containsLowercaseCharacter),p.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=p.containsUppercaseCharacter),p.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=p.containsNumericCharacter),p.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=p.containsNonAlphanumericCharacter),this.enforcementState=t.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(l=(a=t.allowedNonAlphanumericCharacters)===null||a===void 0?void 0:a.join(""))!==null&&l!==void 0?l:"",this.forceUpgradeOnSignin=(d=t.forceUpgradeOnSignin)!==null&&d!==void 0?d:!1,this.schemaVersion=t.schemaVersion}validatePassword(t){var i,a,l,d,p,E;const v={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(t,v),this.validatePasswordCharacterOptions(t,v),v.isValid&&(v.isValid=(i=v.meetsMinPasswordLength)!==null&&i!==void 0?i:!0),v.isValid&&(v.isValid=(a=v.meetsMaxPasswordLength)!==null&&a!==void 0?a:!0),v.isValid&&(v.isValid=(l=v.containsLowercaseLetter)!==null&&l!==void 0?l:!0),v.isValid&&(v.isValid=(d=v.containsUppercaseLetter)!==null&&d!==void 0?d:!0),v.isValid&&(v.isValid=(p=v.containsNumericCharacter)!==null&&p!==void 0?p:!0),v.isValid&&(v.isValid=(E=v.containsNonAlphanumericCharacter)!==null&&E!==void 0?E:!0),v}validatePasswordLengthOptions(t,i){const a=this.customStrengthOptions.minPasswordLength,l=this.customStrengthOptions.maxPasswordLength;a&&(i.meetsMinPasswordLength=t.length>=a),l&&(i.meetsMaxPasswordLength=t.length<=l)}validatePasswordCharacterOptions(t,i){this.updatePasswordCharacterOptionsStatuses(i,!1,!1,!1,!1);let a;for(let l=0;l<t.length;l++)a=t.charAt(l),this.updatePasswordCharacterOptionsStatuses(i,a>="a"&&a<="z",a>="A"&&a<="Z",a>="0"&&a<="9",this.allowedNonAlphanumericCharacters.includes(a))}updatePasswordCharacterOptionsStatuses(t,i,a,l,d){this.customStrengthOptions.containsLowercaseLetter&&(t.containsLowercaseLetter||(t.containsLowercaseLetter=i)),this.customStrengthOptions.containsUppercaseLetter&&(t.containsUppercaseLetter||(t.containsUppercaseLetter=a)),this.customStrengthOptions.containsNumericCharacter&&(t.containsNumericCharacter||(t.containsNumericCharacter=l)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(t.containsNonAlphanumericCharacter||(t.containsNonAlphanumericCharacter=d))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zUe{constructor(t,i,a,l){this.app=t,this.heartbeatServiceProvider=i,this.appCheckServiceProvider=a,this.config=l,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new ZY(this),this.idTokenSubscription=new ZY(this),this.beforeStateQueue=new FUe(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Gne,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=t.name,this.clientVersion=l.sdkClientVersion}_initializeWithPersistence(t,i){return i&&(this._popupRedirectResolver=_p(i)),this._initializationPromise=this.queue(async()=>{var a,l;if(!this._deleted&&(this.persistenceManager=await KS.create(this,t),!this._deleted)){if(!((a=this._popupRedirectResolver)===null||a===void 0)&&a._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(i),this.lastNotifiedUid=((l=this.currentUser)===null||l===void 0?void 0:l.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const t=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!t)){if(this.currentUser&&t&&this.currentUser.uid===t.uid){this._currentUser._assign(t),await this.currentUser.getIdToken();return}await this._updateCurrentUser(t,!0)}}async initializeCurrentUserFromIdToken(t){try{const i=await Yne(this,{idToken:t}),a=await gp._fromGetAccountInfoResponse(this,i,t);await this.directlySetCurrentUser(a)}catch(i){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",i),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(t){var i;if(Cl(this.app)){const p=this.app.settings.authIdToken;return p?new Promise(E=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(p).then(E,E))}):this.directlySetCurrentUser(null)}const a=await this.assertedPersistence.getCurrentUser();let l=a,d=!1;if(t&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const p=(i=this.redirectUser)===null||i===void 0?void 0:i._redirectEventId,E=l==null?void 0:l._redirectEventId,v=await this.tryRedirectSignIn(t);(!p||p===E)&&(v!=null&&v.user)&&(l=v.user,d=!0)}if(!l)return this.directlySetCurrentUser(null);if(!l._redirectEventId){if(d)try{await this.beforeStateQueue.runMiddleware(l)}catch(p){l=a,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(p))}return l?this.reloadAndSetCurrentUserOrClear(l):this.directlySetCurrentUser(null)}return Dn(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===l._redirectEventId?this.directlySetCurrentUser(l):this.reloadAndSetCurrentUserOrClear(l)}async tryRedirectSignIn(t){let i=null;try{i=await this._popupRedirectResolver._completeRedirectFn(this,t,!0)}catch{await this._setRedirectUser(null)}return i}async reloadAndSetCurrentUserOrClear(t){try{await Lk(t)}catch(i){if((i==null?void 0:i.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(t)}useDeviceLanguage(){this.languageCode=bUe()}async _delete(){this._deleted=!0}async updateCurrentUser(t){if(Cl(this.app))return Promise.reject(wp(this));const i=t?Li(t):null;return i&&Dn(i.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(i&&i._clone(this))}async _updateCurrentUser(t,i=!1){if(!this._deleted)return t&&Dn(this.tenantId===t.tenantId,this,"tenant-id-mismatch"),i||await this.beforeStateQueue.runMiddleware(t),this.queue(async()=>{await this.directlySetCurrentUser(t),this.notifyAuthListeners()})}async signOut(){return Cl(this.app)?Promise.reject(wp(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(t){return Cl(this.app)?Promise.reject(wp(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(_p(t))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(t){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const i=this._getPasswordPolicyInternal();return i.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):i.validatePassword(t)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const t=await jUe(this),i=new WUe(t);this.tenantId===null?this._projectPasswordPolicy=i:this._tenantPasswordPolicies[this.tenantId]=i}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(t){this._errorFactory=new tC("auth","Firebase",t())}onAuthStateChanged(t,i,a){return this.registerStateListener(this.authStateSubscription,t,i,a)}beforeAuthStateChanged(t,i){return this.beforeStateQueue.pushCallback(t,i)}onIdTokenChanged(t,i,a){return this.registerStateListener(this.idTokenSubscription,t,i,a)}authStateReady(){return new Promise((t,i)=>{if(this.currentUser)t();else{const a=this.onAuthStateChanged(()=>{a(),t()},i)}})}async revokeAccessToken(t){if(this.currentUser){const i=await this.currentUser.getIdToken(),a={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:t,idToken:i};this.tenantId!=null&&(a.tenantId=this.tenantId),await MUe(this,a)}}toJSON(){var t;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(t=this._currentUser)===null||t===void 0?void 0:t.toJSON()}}async _setRedirectUser(t,i){const a=await this.getOrInitRedirectPersistenceManager(i);return t===null?a.removeCurrentUser():a.setCurrentUser(t)}async getOrInitRedirectPersistenceManager(t){if(!this.redirectPersistenceManager){const i=t&&_p(t)||this._popupRedirectResolver;Dn(i,this,"argument-error"),this.redirectPersistenceManager=await KS.create(this,[_p(i._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(t){var i,a;return this._isInitialized&&await this.queue(async()=>{}),((i=this._currentUser)===null||i===void 0?void 0:i._redirectEventId)===t?this._currentUser:((a=this.redirectUser)===null||a===void 0?void 0:a._redirectEventId)===t?this.redirectUser:null}async _persistUserIfCurrent(t){if(t===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(t))}_notifyListenersIfCurrent(t){t===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var t,i;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const a=(i=(t=this.currentUser)===null||t===void 0?void 0:t.uid)!==null&&i!==void 0?i:null;this.lastNotifiedUid!==a&&(this.lastNotifiedUid=a,this.authStateSubscription.next(this.currentUser))}registerStateListener(t,i,a,l){if(this._deleted)return()=>{};const d=typeof i=="function"?i:i.next.bind(i);let p=!1;const E=this._isInitialized?Promise.resolve():this._initializationPromise;if(Dn(E,this,"internal-error"),E.then(()=>{p||d(this.currentUser)}),typeof i=="function"){const v=t.addObserver(i,a,l);return()=>{p=!0,v()}}else{const v=t.addObserver(i);return()=>{p=!0,v()}}}async directlySetCurrentUser(t){this.currentUser&&this.currentUser!==t&&this._currentUser._stopProactiveRefresh(),t&&this.isProactiveRefreshEnabled&&t._startProactiveRefresh(),this.currentUser=t,t?await this.assertedPersistence.setCurrentUser(t):await this.assertedPersistence.removeCurrentUser()}queue(t){return this.operations=this.operations.then(t,t),this.operations}get assertedPersistence(){return Dn(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(t){!t||this.frameworks.includes(t)||(this.frameworks.push(t),this.frameworks.sort(),this.clientVersion=sre(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var t;const i={"X-Client-Version":this.clientVersion};this.app.options.appId&&(i["X-Firebase-gmpid"]=this.app.options.appId);const a=await((t=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||t===void 0?void 0:t.getHeartbeatsHeader());a&&(i["X-Firebase-Client"]=a);const l=await this._getAppCheckToken();return l&&(i["X-Firebase-AppCheck"]=l),i}async _getAppCheckToken(){var t;if(Cl(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const i=await((t=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||t===void 0?void 0:t.getToken());return i!=null&&i.error&&yUe(`Error while retrieving App Check token: ${i.error}`),i==null?void 0:i.token}}function Ag(n){return Li(n)}class ZY{constructor(t){this.auth=t,this.observer=null,this.addObserver=a2e(i=>this.observer=i)}get next(){return Dn(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let UN={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function GUe(n){UN=n}function are(n){return UN.loadJS(n)}function HUe(){return UN.recaptchaEnterpriseScript}function $Ue(){return UN.gapiScript}function KUe(n){return`__${n}${Math.floor(Math.random()*1e6)}`}class qUe{constructor(){this.enterprise=new YUe}ready(t){t()}execute(t,i){return Promise.resolve("token")}render(t,i){return""}}class YUe{ready(t){t()}execute(t,i){return Promise.resolve("token")}render(t,i){return""}}const XUe="recaptcha-enterprise",cre="NO_RECAPTCHA";class JUe{constructor(t){this.type=XUe,this.auth=Ag(t)}async verify(t="verify",i=!1){async function a(d){if(!i){if(d.tenantId==null&&d._agentRecaptchaConfig!=null)return d._agentRecaptchaConfig.siteKey;if(d.tenantId!=null&&d._tenantRecaptchaConfigs[d.tenantId]!==void 0)return d._tenantRecaptchaConfigs[d.tenantId].siteKey}return new Promise(async(p,E)=>{AUe(d,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(v=>{if(v.recaptchaKey===void 0)E(new Error("recaptcha Enterprise site key undefined"));else{const b=new IUe(v);return d.tenantId==null?d._agentRecaptchaConfig=b:d._tenantRecaptchaConfigs[d.tenantId]=b,p(b.siteKey)}}).catch(v=>{E(v)})})}function l(d,p,E){const v=window.grecaptcha;qY(v)?v.enterprise.ready(()=>{v.enterprise.execute(d,{action:t}).then(b=>{p(b)}).catch(()=>{p(cre)})}):E(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new qUe().execute("siteKey",{action:"verify"}):new Promise((d,p)=>{a(this.auth).then(E=>{if(!i&&qY(window.grecaptcha))l(E,d,p);else{if(typeof window>"u"){p(new Error("RecaptchaVerifier is only supported in browser"));return}let v=HUe();v.length!==0&&(v+=E),are(v).then(()=>{l(E,d,p)}).catch(b=>{p(b)})}}).catch(E=>{p(E)})})}}async function eX(n,t,i,a=!1,l=!1){const d=new JUe(n);let p;if(l)p=cre;else try{p=await d.verify(i)}catch{p=await d.verify(i,!0)}const E=Object.assign({},t);if(i==="mfaSmsEnrollment"||i==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in E){const v=E.phoneEnrollmentInfo.phoneNumber,b=E.phoneEnrollmentInfo.recaptchaToken;Object.assign(E,{phoneEnrollmentInfo:{phoneNumber:v,recaptchaToken:b,captchaResponse:p,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in E){const v=E.phoneSignInInfo.recaptchaToken;Object.assign(E,{phoneSignInInfo:{recaptchaToken:v,captchaResponse:p,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return E}return a?Object.assign(E,{captchaResp:p}):Object.assign(E,{captchaResponse:p}),Object.assign(E,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(E,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),E}async function xk(n,t,i,a,l){var d;if(!((d=n._getRecaptchaConfig())===null||d===void 0)&&d.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const p=await eX(n,t,i,i==="getOobCode");return a(n,p)}else return a(n,t).catch(async p=>{if(p.code==="auth/missing-recaptcha-token"){console.log(`${i} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const E=await eX(n,t,i,i==="getOobCode");return a(n,E)}else return Promise.reject(p)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function QUe(n,t){const i=MN(n,"auth");if(i.isInitialized()){const l=i.getImmediate(),d=i.getOptions();if(OE(d,t??{}))return l;kd(l,"already-initialized")}return i.initialize({options:t})}function ZUe(n,t){const i=(t==null?void 0:t.persistence)||[],a=(Array.isArray(i)?i:[i]).map(_p);t!=null&&t.errorMap&&n._updateErrorMap(t.errorMap),n._initializeWithPersistence(a,t==null?void 0:t.popupRedirectResolver)}function eVe(n,t,i){const a=Ag(n);Dn(/^https?:\/\//.test(t),a,"invalid-emulator-scheme");const l=!1,d=lre(t),{host:p,port:E}=tVe(t),v=E===null?"":`:${E}`,b={url:`${d}//${p}${v}/`},w=Object.freeze({host:p,port:E,protocol:d.replace(":",""),options:Object.freeze({disableWarnings:l})});if(!a._canInitEmulator){Dn(a.config.emulator&&a.emulatorConfig,a,"emulator-config-failed"),Dn(OE(b,a.config.emulator)&&OE(w,a.emulatorConfig),a,"emulator-config-failed");return}a.config.emulator=b,a.emulatorConfig=w,a.settings.appVerificationDisabledForTesting=!0,nVe()}function lre(n){const t=n.indexOf(":");return t<0?"":n.substr(0,t+1)}function tVe(n){const t=lre(n),i=/(\/\/)?([^?#/]+)/.exec(n.substr(t.length));if(!i)return{host:"",port:null};const a=i[2].split("@").pop()||"",l=/^(\[[^\]]+\])(:|$)/.exec(a);if(l){const d=l[1];return{host:d,port:tX(a.substr(d.length+1))}}else{const[d,p]=a.split(":");return{host:d,port:tX(p)}}}function tX(n){if(!n)return null;const t=Number(n);return isNaN(t)?null:t}function nVe(){function n(){const t=document.createElement("p"),i=t.style;t.innerText="Running in emulator mode. Do not use with production credentials.",i.position="fixed",i.width="100%",i.backgroundColor="#ffffff",i.border=".1em solid #000000",i.color="#b50000",i.bottom="0px",i.left="0px",i.margin="0px",i.zIndex="10000",i.textAlign="center",t.classList.add("firebase-emulator-warning"),document.body.appendChild(t)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dj{constructor(t,i){this.providerId=t,this.signInMethod=i}toJSON(){return mp("not implemented")}_getIdTokenResponse(t){return mp("not implemented")}_linkToIdToken(t,i){return mp("not implemented")}_getReauthenticationResolver(t){return mp("not implemented")}}async function rVe(n,t){return Mp(n,"POST","/v1/accounts:signUp",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function iVe(n,t){return iC(n,"POST","/v1/accounts:signInWithPassword",xp(n,t))}async function ure(n,t){return Mp(n,"POST","/v1/accounts:sendOobCode",xp(n,t))}async function oVe(n,t){return ure(n,t)}async function sVe(n,t){return ure(n,t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function aVe(n,t){return iC(n,"POST","/v1/accounts:signInWithEmailLink",xp(n,t))}async function cVe(n,t){return iC(n,"POST","/v1/accounts:signInWithEmailLink",xp(n,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IR extends Dj{constructor(t,i,a,l=null){super("password",a),this._email=t,this._password=i,this._tenantId=l}static _fromEmailAndPassword(t,i){return new IR(t,i,"password")}static _fromEmailAndCode(t,i,a=null){return new IR(t,i,"emailLink",a)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(t){const i=typeof t=="string"?JSON.parse(t):t;if(i!=null&&i.email&&(i!=null&&i.password)){if(i.signInMethod==="password")return this._fromEmailAndPassword(i.email,i.password);if(i.signInMethod==="emailLink")return this._fromEmailAndCode(i.email,i.password,i.tenantId)}return null}async _getIdTokenResponse(t){switch(this.signInMethod){case"password":const i={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return xk(t,i,"signInWithPassword",iVe);case"emailLink":return aVe(t,{email:this._email,oobCode:this._password});default:kd(t,"internal-error")}}async _linkToIdToken(t,i){switch(this.signInMethod){case"password":const a={idToken:i,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return xk(t,a,"signUpPassword",rVe);case"emailLink":return cVe(t,{idToken:i,email:this._email,oobCode:this._password});default:kd(t,"internal-error")}}_getReauthenticationResolver(t){return this._getIdTokenResponse(t)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function qS(n,t){return iC(n,"POST","/v1/accounts:signInWithIdp",xp(n,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lVe="http://localhost";class NE extends Dj{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(t){const i=new NE(t.providerId,t.signInMethod);return t.idToken||t.accessToken?(t.idToken&&(i.idToken=t.idToken),t.accessToken&&(i.accessToken=t.accessToken),t.nonce&&!t.pendingToken&&(i.nonce=t.nonce),t.pendingToken&&(i.pendingToken=t.pendingToken)):t.oauthToken&&t.oauthTokenSecret?(i.accessToken=t.oauthToken,i.secret=t.oauthTokenSecret):kd("argument-error"),i}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(t){const i=typeof t=="string"?JSON.parse(t):t,{providerId:a,signInMethod:l}=i,d=YR(i,["providerId","signInMethod"]);if(!a||!l)return null;const p=new NE(a,l);return p.idToken=d.idToken||void 0,p.accessToken=d.accessToken||void 0,p.secret=d.secret,p.nonce=d.nonce,p.pendingToken=d.pendingToken||null,p}_getIdTokenResponse(t){const i=this.buildRequest();return qS(t,i)}_linkToIdToken(t,i){const a=this.buildRequest();return a.idToken=i,qS(t,a)}_getReauthenticationResolver(t){const i=this.buildRequest();return i.autoCreate=!1,qS(t,i)}buildRequest(){const t={requestUri:lVe,returnSecureToken:!0};if(this.pendingToken)t.pendingToken=this.pendingToken;else{const i={};this.idToken&&(i.id_token=this.idToken),this.accessToken&&(i.access_token=this.accessToken),this.secret&&(i.oauth_token_secret=this.secret),i.providerId=this.providerId,this.nonce&&!this.pendingToken&&(i.nonce=this.nonce),t.postBody=nC(i)}return t}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uVe(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function dVe(n){const t=Dw(Lw(n)).link,i=t?Dw(Lw(t)).deep_link_id:null,a=Dw(Lw(n)).deep_link_id;return(a?Dw(Lw(a)).link:null)||a||i||t||n}class Lj{constructor(t){var i,a,l,d,p,E;const v=Dw(Lw(t)),b=(i=v.apiKey)!==null&&i!==void 0?i:null,w=(a=v.oobCode)!==null&&a!==void 0?a:null,A=uVe((l=v.mode)!==null&&l!==void 0?l:null);Dn(b&&w&&A,"argument-error"),this.apiKey=b,this.operation=A,this.code=w,this.continueUrl=(d=v.continueUrl)!==null&&d!==void 0?d:null,this.languageCode=(p=v.languageCode)!==null&&p!==void 0?p:null,this.tenantId=(E=v.tenantId)!==null&&E!==void 0?E:null}static parseLink(t){const i=dVe(t);try{return new Lj(i)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D0{constructor(){this.providerId=D0.PROVIDER_ID}static credential(t,i){return IR._fromEmailAndPassword(t,i)}static credentialWithLink(t,i){const a=Lj.parseLink(i);return Dn(a,"argument-error"),IR._fromEmailAndCode(t,a.code,a.tenantId)}}D0.PROVIDER_ID="password";D0.EMAIL_PASSWORD_SIGN_IN_METHOD="password";D0.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dre{constructor(t){this.providerId=t,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(t){this.defaultLanguageCode=t}setCustomParameters(t){return this.customParameters=t,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oC extends dre{constructor(){super(...arguments),this.scopes=[]}addScope(t){return this.scopes.includes(t)||this.scopes.push(t),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eg extends oC{constructor(){super("facebook.com")}static credential(t){return NE._fromParams({providerId:eg.PROVIDER_ID,signInMethod:eg.FACEBOOK_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return eg.credentialFromTaggedObject(t)}static credentialFromError(t){return eg.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t)||!t.oauthAccessToken)return null;try{return eg.credential(t.oauthAccessToken)}catch{return null}}}eg.FACEBOOK_SIGN_IN_METHOD="facebook.com";eg.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tg extends oC{constructor(){super("google.com"),this.addScope("profile")}static credential(t,i){return NE._fromParams({providerId:tg.PROVIDER_ID,signInMethod:tg.GOOGLE_SIGN_IN_METHOD,idToken:t,accessToken:i})}static credentialFromResult(t){return tg.credentialFromTaggedObject(t)}static credentialFromError(t){return tg.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthIdToken:i,oauthAccessToken:a}=t;if(!i&&!a)return null;try{return tg.credential(i,a)}catch{return null}}}tg.GOOGLE_SIGN_IN_METHOD="google.com";tg.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ng extends oC{constructor(){super("github.com")}static credential(t){return NE._fromParams({providerId:ng.PROVIDER_ID,signInMethod:ng.GITHUB_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return ng.credentialFromTaggedObject(t)}static credentialFromError(t){return ng.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t)||!t.oauthAccessToken)return null;try{return ng.credential(t.oauthAccessToken)}catch{return null}}}ng.GITHUB_SIGN_IN_METHOD="github.com";ng.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rg extends oC{constructor(){super("twitter.com")}static credential(t,i){return NE._fromParams({providerId:rg.PROVIDER_ID,signInMethod:rg.TWITTER_SIGN_IN_METHOD,oauthToken:t,oauthTokenSecret:i})}static credentialFromResult(t){return rg.credentialFromTaggedObject(t)}static credentialFromError(t){return rg.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthAccessToken:i,oauthTokenSecret:a}=t;if(!i||!a)return null;try{return rg.credential(i,a)}catch{return null}}}rg.TWITTER_SIGN_IN_METHOD="twitter.com";rg.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function hVe(n,t){return iC(n,"POST","/v1/accounts:signUp",xp(n,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DE{constructor(t){this.user=t.user,this.providerId=t.providerId,this._tokenResponse=t._tokenResponse,this.operationType=t.operationType}static async _fromIdTokenResponse(t,i,a,l=!1){const d=await gp._fromIdTokenResponse(t,a,l),p=nX(a);return new DE({user:d,providerId:p,_tokenResponse:a,operationType:i})}static async _forOperation(t,i,a){await t._updateTokensIfNecessary(a,!0);const l=nX(a);return new DE({user:t,providerId:l,_tokenResponse:a,operationType:i})}}function nX(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mk extends af{constructor(t,i,a,l){var d;super(i.code,i.message),this.operationType=a,this.user=l,Object.setPrototypeOf(this,Mk.prototype),this.customData={appName:t.name,tenantId:(d=t.tenantId)!==null&&d!==void 0?d:void 0,_serverResponse:i.customData._serverResponse,operationType:a}}static _fromErrorAndOperation(t,i,a,l){return new Mk(t,i,a,l)}}function hre(n,t,i,a){return(t==="reauthenticate"?i._getReauthenticationResolver(n):i._getIdTokenResponse(n)).catch(d=>{throw d.code==="auth/multi-factor-auth-required"?Mk._fromErrorAndOperation(n,d,t,a):d})}async function fVe(n,t,i=!1){const a=await CR(n,t._linkToIdToken(n.auth,await n.getIdToken()),i);return DE._forOperation(n,"link",a)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function pVe(n,t,i=!1){const{auth:a}=n;if(Cl(a.app))return Promise.reject(wp(a));const l="reauthenticate";try{const d=await CR(n,hre(a,l,t,n),i);Dn(d.idToken,a,"internal-error");const p=kj(d.idToken);Dn(p,a,"internal-error");const{sub:E}=p;return Dn(n.uid===E,a,"user-mismatch"),DE._forOperation(n,l,d)}catch(d){throw(d==null?void 0:d.code)==="auth/user-not-found"&&kd(a,"user-mismatch"),d}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function fre(n,t,i=!1){if(Cl(n.app))return Promise.reject(wp(n));const a="signIn",l=await hre(n,a,t),d=await DE._fromIdTokenResponse(n,a,l);return i||await n._updateCurrentUser(d.user),d}async function mVe(n,t){return fre(Ag(n),t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function pre(n){const t=Ag(n);t._getPasswordPolicyInternal()&&await t._updatePasswordPolicy()}async function gVe(n,t,i){const a=Ag(n);await xk(a,{requestType:"PASSWORD_RESET",email:t,clientType:"CLIENT_TYPE_WEB"},"getOobCode",sVe)}async function _Ve(n,t,i){if(Cl(n.app))return Promise.reject(wp(n));const a=Ag(n),p=await xk(a,{returnSecureToken:!0,email:t,password:i,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",hVe).catch(v=>{throw v.code==="auth/password-does-not-meet-requirements"&&pre(n),v}),E=await DE._fromIdTokenResponse(a,"signIn",p);return await a._updateCurrentUser(E.user),E}function EVe(n,t,i){return Cl(n.app)?Promise.reject(wp(n)):mVe(Li(n),D0.credential(t,i)).catch(async a=>{throw a.code==="auth/password-does-not-meet-requirements"&&pre(n),a})}async function yV(n,t){const i=Li(n),l={requestType:"VERIFY_EMAIL",idToken:await n.getIdToken()},{email:d}=await oVe(i.auth,l);d!==n.email&&await n.reload()}function yVe(n,t,i,a){return Li(n).onIdTokenChanged(t,i,a)}function vVe(n,t,i){return Li(n).beforeAuthStateChanged(t,i)}function SVe(n,t,i,a){return Li(n).onAuthStateChanged(t,i,a)}function bVe(n){return Li(n).signOut()}const Uk="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mre{constructor(t,i){this.storageRetriever=t,this.type=i}_isAvailable(){try{return this.storage?(this.storage.setItem(Uk,"1"),this.storage.removeItem(Uk),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(t,i){return this.storage.setItem(t,JSON.stringify(i)),Promise.resolve()}_get(t){const i=this.storage.getItem(t);return Promise.resolve(i?JSON.parse(i):null)}_remove(t){return this.storage.removeItem(t),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TVe=1e3,wVe=10;class gre extends mre{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(t,i)=>this.onStorageEvent(t,i),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=ore(),this._shouldAllowMigration=!0}forAllChangedKeys(t){for(const i of Object.keys(this.listeners)){const a=this.storage.getItem(i),l=this.localCache[i];a!==l&&t(i,l,a)}}onStorageEvent(t,i=!1){if(!t.key){this.forAllChangedKeys((p,E,v)=>{this.notifyListeners(p,v)});return}const a=t.key;i?this.detachListener():this.stopPolling();const l=()=>{const p=this.storage.getItem(a);!i&&this.localCache[a]===p||this.notifyListeners(a,p)},d=this.storage.getItem(a);VUe()&&d!==t.newValue&&t.newValue!==t.oldValue?setTimeout(l,wVe):l()}notifyListeners(t,i){this.localCache[t]=i;const a=this.listeners[t];if(a)for(const l of Array.from(a))l(i&&JSON.parse(i))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((t,i,a)=>{this.onStorageEvent(new StorageEvent("storage",{key:t,oldValue:i,newValue:a}),!0)})},TVe)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(t,i){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[t]||(this.listeners[t]=new Set,this.localCache[t]=this.storage.getItem(t)),this.listeners[t].add(i)}_removeListener(t,i){this.listeners[t]&&(this.listeners[t].delete(i),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(t,i){await super._set(t,i),this.localCache[t]=JSON.stringify(i)}async _get(t){const i=await super._get(t);return this.localCache[t]=JSON.stringify(i),i}async _remove(t){await super._remove(t),delete this.localCache[t]}}gre.type="LOCAL";const RVe=gre;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _re extends mre{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(t,i){}_removeListener(t,i){}}_re.type="SESSION";const Ere=_re;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function CVe(n){return Promise.all(n.map(async t=>{try{return{fulfilled:!0,value:await t}}catch(i){return{fulfilled:!1,reason:i}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VN{constructor(t){this.eventTarget=t,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){const i=this.receivers.find(l=>l.isListeningto(t));if(i)return i;const a=new VN(t);return this.receivers.push(a),a}isListeningto(t){return this.eventTarget===t}async handleEvent(t){const i=t,{eventId:a,eventType:l,data:d}=i.data,p=this.handlersMap[l];if(!(p!=null&&p.size))return;i.ports[0].postMessage({status:"ack",eventId:a,eventType:l});const E=Array.from(p).map(async b=>b(i.origin,d)),v=await CVe(E);i.ports[0].postMessage({status:"done",eventId:a,eventType:l,response:v})}_subscribe(t,i){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[t]||(this.handlersMap[t]=new Set),this.handlersMap[t].add(i)}_unsubscribe(t,i){this.handlersMap[t]&&i&&this.handlersMap[t].delete(i),(!i||this.handlersMap[t].size===0)&&delete this.handlersMap[t],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}VN.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xj(n="",t=10){let i="";for(let a=0;a<t;a++)i+=Math.floor(Math.random()*10);return n+i}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IVe{constructor(t){this.target=t,this.handlers=new Set}removeMessageHandler(t){t.messageChannel&&(t.messageChannel.port1.removeEventListener("message",t.onMessage),t.messageChannel.port1.close()),this.handlers.delete(t)}async _send(t,i,a=50){const l=typeof MessageChannel<"u"?new MessageChannel:null;if(!l)throw new Error("connection_unavailable");let d,p;return new Promise((E,v)=>{const b=xj("",20);l.port1.start();const w=setTimeout(()=>{v(new Error("unsupported_event"))},a);p={messageChannel:l,onMessage(A){const N=A;if(N.data.eventId===b)switch(N.data.status){case"ack":clearTimeout(w),d=setTimeout(()=>{v(new Error("timeout"))},3e3);break;case"done":clearTimeout(d),E(N.data.response);break;default:clearTimeout(w),clearTimeout(d),v(new Error("invalid_response"));break}}},this.handlers.add(p),l.port1.addEventListener("message",p.onMessage),this.target.postMessage({eventType:t,eventId:b,data:i},[l.port2])}).finally(()=>{p&&this.removeMessageHandler(p)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jh(){return window}function AVe(n){Jh().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yre(){return typeof Jh().WorkerGlobalScope<"u"&&typeof Jh().importScripts=="function"}async function PVe(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function OVe(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function kVe(){return yre()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vre="firebaseLocalStorageDb",NVe=1,Vk="firebaseLocalStorage",Sre="fbase_key";class sC{constructor(t){this.request=t}toPromise(){return new Promise((t,i)=>{this.request.addEventListener("success",()=>{t(this.request.result)}),this.request.addEventListener("error",()=>{i(this.request.error)})})}}function FN(n,t){return n.transaction([Vk],t?"readwrite":"readonly").objectStore(Vk)}function DVe(){const n=indexedDB.deleteDatabase(vre);return new sC(n).toPromise()}function vV(){const n=indexedDB.open(vre,NVe);return new Promise((t,i)=>{n.addEventListener("error",()=>{i(n.error)}),n.addEventListener("upgradeneeded",()=>{const a=n.result;try{a.createObjectStore(Vk,{keyPath:Sre})}catch(l){i(l)}}),n.addEventListener("success",async()=>{const a=n.result;a.objectStoreNames.contains(Vk)?t(a):(a.close(),await DVe(),t(await vV()))})})}async function rX(n,t,i){const a=FN(n,!0).put({[Sre]:t,value:i});return new sC(a).toPromise()}async function LVe(n,t){const i=FN(n,!1).get(t),a=await new sC(i).toPromise();return a===void 0?null:a.value}function iX(n,t){const i=FN(n,!0).delete(t);return new sC(i).toPromise()}const xVe=800,MVe=3;class bre{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await vV(),this.db)}async _withRetries(t){let i=0;for(;;)try{const a=await this._openDb();return await t(a)}catch(a){if(i++>MVe)throw a;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return yre()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=VN._getInstance(kVe()),this.receiver._subscribe("keyChanged",async(t,i)=>({keyProcessed:(await this._poll()).includes(i.key)})),this.receiver._subscribe("ping",async(t,i)=>["keyChanged"])}async initializeSender(){var t,i;if(this.activeServiceWorker=await PVe(),!this.activeServiceWorker)return;this.sender=new IVe(this.activeServiceWorker);const a=await this.sender._send("ping",{},800);a&&!((t=a[0])===null||t===void 0)&&t.fulfilled&&!((i=a[0])===null||i===void 0)&&i.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(t){if(!(!this.sender||!this.activeServiceWorker||OVe()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:t},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const t=await vV();return await rX(t,Uk,"1"),await iX(t,Uk),!0}catch{}return!1}async _withPendingWrite(t){this.pendingWrites++;try{await t()}finally{this.pendingWrites--}}async _set(t,i){return this._withPendingWrite(async()=>(await this._withRetries(a=>rX(a,t,i)),this.localCache[t]=i,this.notifyServiceWorker(t)))}async _get(t){const i=await this._withRetries(a=>LVe(a,t));return this.localCache[t]=i,i}async _remove(t){return this._withPendingWrite(async()=>(await this._withRetries(i=>iX(i,t)),delete this.localCache[t],this.notifyServiceWorker(t)))}async _poll(){const t=await this._withRetries(l=>{const d=FN(l,!1).getAll();return new sC(d).toPromise()});if(!t)return[];if(this.pendingWrites!==0)return[];const i=[],a=new Set;if(t.length!==0)for(const{fbase_key:l,value:d}of t)a.add(l),JSON.stringify(this.localCache[l])!==JSON.stringify(d)&&(this.notifyListeners(l,d),i.push(l));for(const l of Object.keys(this.localCache))this.localCache[l]&&!a.has(l)&&(this.notifyListeners(l,null),i.push(l));return i}notifyListeners(t,i){this.localCache[t]=i;const a=this.listeners[t];if(a)for(const l of Array.from(a))l(i)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),xVe)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(t,i){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[t]||(this.listeners[t]=new Set,this._get(t)),this.listeners[t].add(i)}_removeListener(t,i){this.listeners[t]&&(this.listeners[t].delete(i),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&this.stopPolling()}}bre.type="LOCAL";const UVe=bre;new rC(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function VVe(n,t){return t?_p(t):(Dn(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mj extends Dj{constructor(t){super("custom","custom"),this.params=t}_getIdTokenResponse(t){return qS(t,this._buildIdpRequest())}_linkToIdToken(t,i){return qS(t,this._buildIdpRequest(i))}_getReauthenticationResolver(t){return qS(t,this._buildIdpRequest())}_buildIdpRequest(t){const i={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return t&&(i.idToken=t),i}}function FVe(n){return fre(n.auth,new Mj(n),n.bypassAuthState)}function jVe(n){const{auth:t,user:i}=n;return Dn(i,t,"internal-error"),pVe(i,new Mj(n),n.bypassAuthState)}async function BVe(n){const{auth:t,user:i}=n;return Dn(i,t,"internal-error"),fVe(i,new Mj(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tre{constructor(t,i,a,l,d=!1){this.auth=t,this.resolver=a,this.user=l,this.bypassAuthState=d,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(i)?i:[i]}execute(){return new Promise(async(t,i)=>{this.pendingPromise={resolve:t,reject:i};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(a){this.reject(a)}})}async onAuthEvent(t){const{urlResponse:i,sessionId:a,postBody:l,tenantId:d,error:p,type:E}=t;if(p){this.reject(p);return}const v={auth:this.auth,requestUri:i,sessionId:a,tenantId:d||void 0,postBody:l||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(E)(v))}catch(b){this.reject(b)}}onError(t){this.reject(t)}getIdpTask(t){switch(t){case"signInViaPopup":case"signInViaRedirect":return FVe;case"linkViaPopup":case"linkViaRedirect":return BVe;case"reauthViaPopup":case"reauthViaRedirect":return jVe;default:kd(this.auth,"internal-error")}}resolve(t){kp(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(t),this.unregisterAndCleanUp()}reject(t){kp(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(t),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WVe=new rC(2e3,1e4);class DS extends Tre{constructor(t,i,a,l,d){super(t,i,l,d),this.provider=a,this.authWindow=null,this.pollId=null,DS.currentPopupAction&&DS.currentPopupAction.cancel(),DS.currentPopupAction=this}async executeNotNull(){const t=await this.execute();return Dn(t,this.auth,"internal-error"),t}async onExecution(){kp(this.filter.length===1,"Popup operations only handle one event");const t=xj();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],t),this.authWindow.associatedEvent=t,this.resolver._originValidation(this.auth).catch(i=>{this.reject(i)}),this.resolver._isIframeWebStorageSupported(this.auth,i=>{i||this.reject(Xh(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var t;return((t=this.authWindow)===null||t===void 0?void 0:t.associatedEvent)||null}cancel(){this.reject(Xh(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,DS.currentPopupAction=null}pollUserCancellation(){const t=()=>{var i,a;if(!((a=(i=this.authWindow)===null||i===void 0?void 0:i.window)===null||a===void 0)&&a.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Xh(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(t,WVe.get())};t()}}DS.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zVe="pendingRedirect",tk=new Map;class GVe extends Tre{constructor(t,i,a=!1){super(t,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],i,void 0,a),this.eventId=null}async execute(){let t=tk.get(this.auth._key());if(!t){try{const a=await HVe(this.resolver,this.auth)?await super.execute():null;t=()=>Promise.resolve(a)}catch(i){t=()=>Promise.reject(i)}tk.set(this.auth._key(),t)}return this.bypassAuthState||tk.set(this.auth._key(),()=>Promise.resolve(null)),t()}async onAuthEvent(t){if(t.type==="signInViaRedirect")return super.onAuthEvent(t);if(t.type==="unknown"){this.resolve(null);return}if(t.eventId){const i=await this.auth._redirectUserForId(t.eventId);if(i)return this.user=i,super.onAuthEvent(t);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function HVe(n,t){const i=qVe(t),a=KVe(n);if(!await a._isAvailable())return!1;const l=await a._get(i)==="true";return await a._remove(i),l}function $Ve(n,t){tk.set(n._key(),t)}function KVe(n){return _p(n._redirectPersistence)}function qVe(n){return ek(zVe,n.config.apiKey,n.name)}async function YVe(n,t,i=!1){if(Cl(n.app))return Promise.reject(wp(n));const a=Ag(n),l=VVe(a,t),p=await new GVe(a,l,i).execute();return p&&!i&&(delete p.user._redirectEventId,await a._persistUserIfCurrent(p.user),await a._setRedirectUser(null,t)),p}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XVe=10*60*1e3;class JVe{constructor(t){this.auth=t,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(t){this.consumers.add(t),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,t)&&(this.sendToConsumer(this.queuedRedirectEvent,t),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(t){this.consumers.delete(t)}onEvent(t){if(this.hasEventBeenHandled(t))return!1;let i=!1;return this.consumers.forEach(a=>{this.isEventForConsumer(t,a)&&(i=!0,this.sendToConsumer(t,a),this.saveEventToCache(t))}),this.hasHandledPotentialRedirect||!QVe(t)||(this.hasHandledPotentialRedirect=!0,i||(this.queuedRedirectEvent=t,i=!0)),i}sendToConsumer(t,i){var a;if(t.error&&!wre(t)){const l=((a=t.error.code)===null||a===void 0?void 0:a.split("auth/")[1])||"internal-error";i.onError(Xh(this.auth,l))}else i.onAuthEvent(t)}isEventForConsumer(t,i){const a=i.eventId===null||!!t.eventId&&t.eventId===i.eventId;return i.filter.includes(t.type)&&a}hasEventBeenHandled(t){return Date.now()-this.lastProcessedEventTime>=XVe&&this.cachedEventUids.clear(),this.cachedEventUids.has(oX(t))}saveEventToCache(t){this.cachedEventUids.add(oX(t)),this.lastProcessedEventTime=Date.now()}}function oX(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(t=>t).join("-")}function wre({type:n,error:t}){return n==="unknown"&&(t==null?void 0:t.code)==="auth/no-auth-event"}function QVe(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return wre(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ZVe(n,t={}){return Mp(n,"GET","/v1/projects",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eFe=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,tFe=/^https?/;async function nFe(n){if(n.config.emulator)return;const{authorizedDomains:t}=await ZVe(n);for(const i of t)try{if(rFe(i))return}catch{}kd(n,"unauthorized-domain")}function rFe(n){const t=_V(),{protocol:i,hostname:a}=new URL(t);if(n.startsWith("chrome-extension://")){const p=new URL(n);return p.hostname===""&&a===""?i==="chrome-extension:"&&n.replace("chrome-extension://","")===t.replace("chrome-extension://",""):i==="chrome-extension:"&&p.hostname===a}if(!tFe.test(i))return!1;if(eFe.test(n))return a===n;const l=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+l+"|"+l+")$","i").test(a)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iFe=new rC(3e4,6e4);function sX(){const n=Jh().___jsl;if(n!=null&&n.H){for(const t of Object.keys(n.H))if(n.H[t].r=n.H[t].r||[],n.H[t].L=n.H[t].L||[],n.H[t].r=[...n.H[t].L],n.CP)for(let i=0;i<n.CP.length;i++)n.CP[i]=null}}function oFe(n){return new Promise((t,i)=>{var a,l,d;function p(){sX(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{sX(),i(Xh(n,"network-request-failed"))},timeout:iFe.get()})}if(!((l=(a=Jh().gapi)===null||a===void 0?void 0:a.iframes)===null||l===void 0)&&l.Iframe)t(gapi.iframes.getContext());else if(!((d=Jh().gapi)===null||d===void 0)&&d.load)p();else{const E=KUe("iframefcb");return Jh()[E]=()=>{gapi.load?p():i(Xh(n,"network-request-failed"))},are(`${$Ue()}?onload=${E}`).catch(v=>i(v))}}).catch(t=>{throw nk=null,t})}let nk=null;function sFe(n){return nk=nk||oFe(n),nk}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aFe=new rC(5e3,15e3),cFe="__/auth/iframe",lFe="emulator/auth/iframe",uFe={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},dFe=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function hFe(n){const t=n.config;Dn(t.authDomain,n,"auth-domain-config-required");const i=t.emulator?Oj(t,lFe):`https://${n.config.authDomain}/${cFe}`,a={apiKey:t.apiKey,appName:n.name,v:jE},l=dFe.get(n.config.apiHost);l&&(a.eid=l);const d=n._getFrameworks();return d.length&&(a.fw=d.join(",")),`${i}?${nC(a).slice(1)}`}async function fFe(n){const t=await sFe(n),i=Jh().gapi;return Dn(i,n,"internal-error"),t.open({where:document.body,url:hFe(n),messageHandlersFilter:i.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:uFe,dontclear:!0},a=>new Promise(async(l,d)=>{await a.restyle({setHideOnLeave:!1});const p=Xh(n,"network-request-failed"),E=Jh().setTimeout(()=>{d(p)},aFe.get());function v(){Jh().clearTimeout(E),l(a)}a.ping(v).then(v,()=>{d(p)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pFe={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},mFe=500,gFe=600,_Fe="_blank",EFe="http://localhost";class aX{constructor(t){this.window=t,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function yFe(n,t,i,a=mFe,l=gFe){const d=Math.max((window.screen.availHeight-l)/2,0).toString(),p=Math.max((window.screen.availWidth-a)/2,0).toString();let E="";const v=Object.assign(Object.assign({},pFe),{width:a.toString(),height:l.toString(),top:d,left:p}),b=Fa().toLowerCase();i&&(E=ere(b)?_Fe:i),Qne(b)&&(t=t||EFe,v.scrollbars="yes");const w=Object.entries(v).reduce((N,[F,j])=>`${N}${F}=${j},`,"");if(UUe(b)&&E!=="_self")return vFe(t||"",E),new aX(null);const A=window.open(t||"",E,w);Dn(A,n,"popup-blocked");try{A.focus()}catch{}return new aX(A)}function vFe(n,t){const i=document.createElement("a");i.href=n,i.target=t;const a=document.createEvent("MouseEvent");a.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),i.dispatchEvent(a)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SFe="__/auth/handler",bFe="emulator/auth/handler",TFe=encodeURIComponent("fac");async function cX(n,t,i,a,l,d){Dn(n.config.authDomain,n,"auth-domain-config-required"),Dn(n.config.apiKey,n,"invalid-api-key");const p={apiKey:n.config.apiKey,appName:n.name,authType:i,redirectUrl:a,v:jE,eventId:l};if(t instanceof dre){t.setDefaultLanguage(n.languageCode),p.providerId=t.providerId||"",s2e(t.getCustomParameters())||(p.customParameters=JSON.stringify(t.getCustomParameters()));for(const[w,A]of Object.entries({}))p[w]=A}if(t instanceof oC){const w=t.getScopes().filter(A=>A!=="");w.length>0&&(p.scopes=w.join(","))}n.tenantId&&(p.tid=n.tenantId);const E=p;for(const w of Object.keys(E))E[w]===void 0&&delete E[w];const v=await n._getAppCheckToken(),b=v?`#${TFe}=${encodeURIComponent(v)}`:"";return`${wFe(n)}?${nC(E).slice(1)}${b}`}function wFe({config:n}){return n.emulator?Oj(n,bFe):`https://${n.authDomain}/${SFe}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const J2="webStorageSupport";class RFe{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Ere,this._completeRedirectFn=YVe,this._overrideRedirectResult=$Ve}async _openPopup(t,i,a,l){var d;kp((d=this.eventManagers[t._key()])===null||d===void 0?void 0:d.manager,"_initialize() not called before _openPopup()");const p=await cX(t,i,a,_V(),l);return yFe(t,p,xj())}async _openRedirect(t,i,a,l){await this._originValidation(t);const d=await cX(t,i,a,_V(),l);return AVe(d),new Promise(()=>{})}_initialize(t){const i=t._key();if(this.eventManagers[i]){const{manager:l,promise:d}=this.eventManagers[i];return l?Promise.resolve(l):(kp(d,"If manager is not set, promise should be"),d)}const a=this.initAndGetManager(t);return this.eventManagers[i]={promise:a},a.catch(()=>{delete this.eventManagers[i]}),a}async initAndGetManager(t){const i=await fFe(t),a=new JVe(t);return i.register("authEvent",l=>(Dn(l==null?void 0:l.authEvent,t,"invalid-auth-event"),{status:a.onEvent(l.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[t._key()]={manager:a},this.iframes[t._key()]=i,a}_isIframeWebStorageSupported(t,i){this.iframes[t._key()].send(J2,{type:J2},l=>{var d;const p=(d=l==null?void 0:l[0])===null||d===void 0?void 0:d[J2];p!==void 0&&i(!!p),kd(t,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(t){const i=t._key();return this.originValidationPromises[i]||(this.originValidationPromises[i]=nFe(t)),this.originValidationPromises[i]}get _shouldInitProactively(){return ore()||Zne()||Nj()}}const CFe=RFe;var lX="@firebase/auth",uX="1.9.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IFe{constructor(t){this.auth=t,this.internalListeners=new Map}getUid(){var t;return this.assertAuthConfigured(),((t=this.auth.currentUser)===null||t===void 0?void 0:t.uid)||null}async getToken(t){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(t)}:null}addAuthTokenListener(t){if(this.assertAuthConfigured(),this.internalListeners.has(t))return;const i=this.auth.onIdTokenChanged(a=>{t((a==null?void 0:a.stsTokenManager.accessToken)||null)});this.internalListeners.set(t,i),this.updateProactiveRefresh()}removeAuthTokenListener(t){this.assertAuthConfigured();const i=this.internalListeners.get(t);i&&(this.internalListeners.delete(t),i(),this.updateProactiveRefresh())}assertAuthConfigured(){Dn(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function AFe(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function PFe(n){kE(new Eg("auth",(t,{options:i})=>{const a=t.getProvider("app").getImmediate(),l=t.getProvider("heartbeat"),d=t.getProvider("app-check-internal"),{apiKey:p,authDomain:E}=a.options;Dn(p&&!p.includes(":"),"invalid-api-key",{appName:a.name});const v={apiKey:p,authDomain:E,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:sre(n)},b=new zUe(a,l,d,v);return ZUe(b,i),b},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((t,i,a)=>{t.getProvider("auth-internal").initialize()})),kE(new Eg("auth-internal",t=>{const i=Ag(t.getProvider("auth").getImmediate());return(a=>new IFe(a))(i)},"PRIVATE").setInstantiationMode("EXPLICIT")),Yh(lX,uX,AFe(n)),Yh(lX,uX,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OFe=5*60,kFe=Mne("authIdTokenMaxAge")||OFe;let dX=null;const NFe=n=>async t=>{const i=t&&await t.getIdTokenResult(),a=i&&(new Date().getTime()-Date.parse(i.issuedAtTime))/1e3;if(a&&a>kFe)return;const l=i==null?void 0:i.token;dX!==l&&(dX=l,await fetch(n,{method:l?"POST":"DELETE",headers:l?{Authorization:`Bearer ${l}`}:{}}))};function Rre(n=Aj()){const t=MN(n,"auth");if(t.isInitialized())return t.getImmediate();const i=QUe(n,{popupRedirectResolver:CFe,persistence:[UVe,RVe,Ere]}),a=Mne("authTokenSyncURL");if(a&&typeof isSecureContext=="boolean"&&isSecureContext){const d=new URL(a,location.origin);if(location.origin===d.origin){const p=NFe(d.toString());vVe(i,p,()=>p(i.currentUser)),yVe(i,E=>p(E))}}const l=Dne("auth");return l&&eVe(i,`http://${l}`),i}function DFe(){var n,t;return(t=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&t!==void 0?t:document}GUe({loadJS(n){return new Promise((t,i)=>{const a=document.createElement("script");a.setAttribute("src",n),a.onload=t,a.onerror=l=>{const d=Xh("internal-error");d.customData=l,i(d)},a.type="text/javascript",a.charset="UTF-8",DFe().appendChild(a)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});PFe("Browser");var hX=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var dg,Cre;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function t(Z,Q){function ne(){}ne.prototype=Q.prototype,Z.D=Q.prototype,Z.prototype=new ne,Z.prototype.constructor=Z,Z.C=function(se,fe,he){for(var ue=Array(arguments.length-2),Me=2;Me<arguments.length;Me++)ue[Me-2]=arguments[Me];return Q.prototype[fe].apply(se,ue)}}function i(){this.blockSize=-1}function a(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}t(a,i),a.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function l(Z,Q,ne){ne||(ne=0);var se=Array(16);if(typeof Q=="string")for(var fe=0;16>fe;++fe)se[fe]=Q.charCodeAt(ne++)|Q.charCodeAt(ne++)<<8|Q.charCodeAt(ne++)<<16|Q.charCodeAt(ne++)<<24;else for(fe=0;16>fe;++fe)se[fe]=Q[ne++]|Q[ne++]<<8|Q[ne++]<<16|Q[ne++]<<24;Q=Z.g[0],ne=Z.g[1],fe=Z.g[2];var he=Z.g[3],ue=Q+(he^ne&(fe^he))+se[0]+3614090360&4294967295;Q=ne+(ue<<7&4294967295|ue>>>25),ue=he+(fe^Q&(ne^fe))+se[1]+3905402710&4294967295,he=Q+(ue<<12&4294967295|ue>>>20),ue=fe+(ne^he&(Q^ne))+se[2]+606105819&4294967295,fe=he+(ue<<17&4294967295|ue>>>15),ue=ne+(Q^fe&(he^Q))+se[3]+3250441966&4294967295,ne=fe+(ue<<22&4294967295|ue>>>10),ue=Q+(he^ne&(fe^he))+se[4]+4118548399&4294967295,Q=ne+(ue<<7&4294967295|ue>>>25),ue=he+(fe^Q&(ne^fe))+se[5]+1200080426&4294967295,he=Q+(ue<<12&4294967295|ue>>>20),ue=fe+(ne^he&(Q^ne))+se[6]+2821735955&4294967295,fe=he+(ue<<17&4294967295|ue>>>15),ue=ne+(Q^fe&(he^Q))+se[7]+4249261313&4294967295,ne=fe+(ue<<22&4294967295|ue>>>10),ue=Q+(he^ne&(fe^he))+se[8]+1770035416&4294967295,Q=ne+(ue<<7&4294967295|ue>>>25),ue=he+(fe^Q&(ne^fe))+se[9]+2336552879&4294967295,he=Q+(ue<<12&4294967295|ue>>>20),ue=fe+(ne^he&(Q^ne))+se[10]+4294925233&4294967295,fe=he+(ue<<17&4294967295|ue>>>15),ue=ne+(Q^fe&(he^Q))+se[11]+2304563134&4294967295,ne=fe+(ue<<22&4294967295|ue>>>10),ue=Q+(he^ne&(fe^he))+se[12]+1804603682&4294967295,Q=ne+(ue<<7&4294967295|ue>>>25),ue=he+(fe^Q&(ne^fe))+se[13]+4254626195&4294967295,he=Q+(ue<<12&4294967295|ue>>>20),ue=fe+(ne^he&(Q^ne))+se[14]+2792965006&4294967295,fe=he+(ue<<17&4294967295|ue>>>15),ue=ne+(Q^fe&(he^Q))+se[15]+1236535329&4294967295,ne=fe+(ue<<22&4294967295|ue>>>10),ue=Q+(fe^he&(ne^fe))+se[1]+4129170786&4294967295,Q=ne+(ue<<5&4294967295|ue>>>27),ue=he+(ne^fe&(Q^ne))+se[6]+3225465664&4294967295,he=Q+(ue<<9&4294967295|ue>>>23),ue=fe+(Q^ne&(he^Q))+se[11]+643717713&4294967295,fe=he+(ue<<14&4294967295|ue>>>18),ue=ne+(he^Q&(fe^he))+se[0]+3921069994&4294967295,ne=fe+(ue<<20&4294967295|ue>>>12),ue=Q+(fe^he&(ne^fe))+se[5]+3593408605&4294967295,Q=ne+(ue<<5&4294967295|ue>>>27),ue=he+(ne^fe&(Q^ne))+se[10]+38016083&4294967295,he=Q+(ue<<9&4294967295|ue>>>23),ue=fe+(Q^ne&(he^Q))+se[15]+3634488961&4294967295,fe=he+(ue<<14&4294967295|ue>>>18),ue=ne+(he^Q&(fe^he))+se[4]+3889429448&4294967295,ne=fe+(ue<<20&4294967295|ue>>>12),ue=Q+(fe^he&(ne^fe))+se[9]+568446438&4294967295,Q=ne+(ue<<5&4294967295|ue>>>27),ue=he+(ne^fe&(Q^ne))+se[14]+3275163606&4294967295,he=Q+(ue<<9&4294967295|ue>>>23),ue=fe+(Q^ne&(he^Q))+se[3]+4107603335&4294967295,fe=he+(ue<<14&4294967295|ue>>>18),ue=ne+(he^Q&(fe^he))+se[8]+1163531501&4294967295,ne=fe+(ue<<20&4294967295|ue>>>12),ue=Q+(fe^he&(ne^fe))+se[13]+2850285829&4294967295,Q=ne+(ue<<5&4294967295|ue>>>27),ue=he+(ne^fe&(Q^ne))+se[2]+4243563512&4294967295,he=Q+(ue<<9&4294967295|ue>>>23),ue=fe+(Q^ne&(he^Q))+se[7]+1735328473&4294967295,fe=he+(ue<<14&4294967295|ue>>>18),ue=ne+(he^Q&(fe^he))+se[12]+2368359562&4294967295,ne=fe+(ue<<20&4294967295|ue>>>12),ue=Q+(ne^fe^he)+se[5]+4294588738&4294967295,Q=ne+(ue<<4&4294967295|ue>>>28),ue=he+(Q^ne^fe)+se[8]+2272392833&4294967295,he=Q+(ue<<11&4294967295|ue>>>21),ue=fe+(he^Q^ne)+se[11]+1839030562&4294967295,fe=he+(ue<<16&4294967295|ue>>>16),ue=ne+(fe^he^Q)+se[14]+4259657740&4294967295,ne=fe+(ue<<23&4294967295|ue>>>9),ue=Q+(ne^fe^he)+se[1]+2763975236&4294967295,Q=ne+(ue<<4&4294967295|ue>>>28),ue=he+(Q^ne^fe)+se[4]+1272893353&4294967295,he=Q+(ue<<11&4294967295|ue>>>21),ue=fe+(he^Q^ne)+se[7]+4139469664&4294967295,fe=he+(ue<<16&4294967295|ue>>>16),ue=ne+(fe^he^Q)+se[10]+3200236656&4294967295,ne=fe+(ue<<23&4294967295|ue>>>9),ue=Q+(ne^fe^he)+se[13]+681279174&4294967295,Q=ne+(ue<<4&4294967295|ue>>>28),ue=he+(Q^ne^fe)+se[0]+3936430074&4294967295,he=Q+(ue<<11&4294967295|ue>>>21),ue=fe+(he^Q^ne)+se[3]+3572445317&4294967295,fe=he+(ue<<16&4294967295|ue>>>16),ue=ne+(fe^he^Q)+se[6]+76029189&4294967295,ne=fe+(ue<<23&4294967295|ue>>>9),ue=Q+(ne^fe^he)+se[9]+3654602809&4294967295,Q=ne+(ue<<4&4294967295|ue>>>28),ue=he+(Q^ne^fe)+se[12]+3873151461&4294967295,he=Q+(ue<<11&4294967295|ue>>>21),ue=fe+(he^Q^ne)+se[15]+530742520&4294967295,fe=he+(ue<<16&4294967295|ue>>>16),ue=ne+(fe^he^Q)+se[2]+3299628645&4294967295,ne=fe+(ue<<23&4294967295|ue>>>9),ue=Q+(fe^(ne|~he))+se[0]+4096336452&4294967295,Q=ne+(ue<<6&4294967295|ue>>>26),ue=he+(ne^(Q|~fe))+se[7]+1126891415&4294967295,he=Q+(ue<<10&4294967295|ue>>>22),ue=fe+(Q^(he|~ne))+se[14]+2878612391&4294967295,fe=he+(ue<<15&4294967295|ue>>>17),ue=ne+(he^(fe|~Q))+se[5]+4237533241&4294967295,ne=fe+(ue<<21&4294967295|ue>>>11),ue=Q+(fe^(ne|~he))+se[12]+1700485571&4294967295,Q=ne+(ue<<6&4294967295|ue>>>26),ue=he+(ne^(Q|~fe))+se[3]+2399980690&4294967295,he=Q+(ue<<10&4294967295|ue>>>22),ue=fe+(Q^(he|~ne))+se[10]+4293915773&4294967295,fe=he+(ue<<15&4294967295|ue>>>17),ue=ne+(he^(fe|~Q))+se[1]+2240044497&4294967295,ne=fe+(ue<<21&4294967295|ue>>>11),ue=Q+(fe^(ne|~he))+se[8]+1873313359&4294967295,Q=ne+(ue<<6&4294967295|ue>>>26),ue=he+(ne^(Q|~fe))+se[15]+4264355552&4294967295,he=Q+(ue<<10&4294967295|ue>>>22),ue=fe+(Q^(he|~ne))+se[6]+2734768916&4294967295,fe=he+(ue<<15&4294967295|ue>>>17),ue=ne+(he^(fe|~Q))+se[13]+1309151649&4294967295,ne=fe+(ue<<21&4294967295|ue>>>11),ue=Q+(fe^(ne|~he))+se[4]+4149444226&4294967295,Q=ne+(ue<<6&4294967295|ue>>>26),ue=he+(ne^(Q|~fe))+se[11]+3174756917&4294967295,he=Q+(ue<<10&4294967295|ue>>>22),ue=fe+(Q^(he|~ne))+se[2]+718787259&4294967295,fe=he+(ue<<15&4294967295|ue>>>17),ue=ne+(he^(fe|~Q))+se[9]+3951481745&4294967295,Z.g[0]=Z.g[0]+Q&4294967295,Z.g[1]=Z.g[1]+(fe+(ue<<21&4294967295|ue>>>11))&4294967295,Z.g[2]=Z.g[2]+fe&4294967295,Z.g[3]=Z.g[3]+he&4294967295}a.prototype.u=function(Z,Q){Q===void 0&&(Q=Z.length);for(var ne=Q-this.blockSize,se=this.B,fe=this.h,he=0;he<Q;){if(fe==0)for(;he<=ne;)l(this,Z,he),he+=this.blockSize;if(typeof Z=="string"){for(;he<Q;)if(se[fe++]=Z.charCodeAt(he++),fe==this.blockSize){l(this,se),fe=0;break}}else for(;he<Q;)if(se[fe++]=Z[he++],fe==this.blockSize){l(this,se),fe=0;break}}this.h=fe,this.o+=Q},a.prototype.v=function(){var Z=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);Z[0]=128;for(var Q=1;Q<Z.length-8;++Q)Z[Q]=0;var ne=8*this.o;for(Q=Z.length-8;Q<Z.length;++Q)Z[Q]=ne&255,ne/=256;for(this.u(Z),Z=Array(16),Q=ne=0;4>Q;++Q)for(var se=0;32>se;se+=8)Z[ne++]=this.g[Q]>>>se&255;return Z};function d(Z,Q){var ne=E;return Object.prototype.hasOwnProperty.call(ne,Z)?ne[Z]:ne[Z]=Q(Z)}function p(Z,Q){this.h=Q;for(var ne=[],se=!0,fe=Z.length-1;0<=fe;fe--){var he=Z[fe]|0;se&&he==Q||(ne[fe]=he,se=!1)}this.g=ne}var E={};function v(Z){return-128<=Z&&128>Z?d(Z,function(Q){return new p([Q|0],0>Q?-1:0)}):new p([Z|0],0>Z?-1:0)}function b(Z){if(isNaN(Z)||!isFinite(Z))return A;if(0>Z)return H(b(-Z));for(var Q=[],ne=1,se=0;Z>=ne;se++)Q[se]=Z/ne|0,ne*=4294967296;return new p(Q,0)}function w(Z,Q){if(Z.length==0)throw Error("number format error: empty string");if(Q=Q||10,2>Q||36<Q)throw Error("radix out of range: "+Q);if(Z.charAt(0)=="-")return H(w(Z.substring(1),Q));if(0<=Z.indexOf("-"))throw Error('number format error: interior "-" character');for(var ne=b(Math.pow(Q,8)),se=A,fe=0;fe<Z.length;fe+=8){var he=Math.min(8,Z.length-fe),ue=parseInt(Z.substring(fe,fe+he),Q);8>he?(he=b(Math.pow(Q,he)),se=se.j(he).add(b(ue))):(se=se.j(ne),se=se.add(b(ue)))}return se}var A=v(0),N=v(1),F=v(16777216);n=p.prototype,n.m=function(){if(B(this))return-H(this).m();for(var Z=0,Q=1,ne=0;ne<this.g.length;ne++){var se=this.i(ne);Z+=(0<=se?se:4294967296+se)*Q,Q*=4294967296}return Z},n.toString=function(Z){if(Z=Z||10,2>Z||36<Z)throw Error("radix out of range: "+Z);if(j(this))return"0";if(B(this))return"-"+H(this).toString(Z);for(var Q=b(Math.pow(Z,6)),ne=this,se="";;){var fe=le(ne,Q).g;ne=ee(ne,fe.j(Q));var he=((0<ne.g.length?ne.g[0]:ne.h)>>>0).toString(Z);if(ne=fe,j(ne))return he+se;for(;6>he.length;)he="0"+he;se=he+se}},n.i=function(Z){return 0>Z?0:Z<this.g.length?this.g[Z]:this.h};function j(Z){if(Z.h!=0)return!1;for(var Q=0;Q<Z.g.length;Q++)if(Z.g[Q]!=0)return!1;return!0}function B(Z){return Z.h==-1}n.l=function(Z){return Z=ee(this,Z),B(Z)?-1:j(Z)?0:1};function H(Z){for(var Q=Z.g.length,ne=[],se=0;se<Q;se++)ne[se]=~Z.g[se];return new p(ne,~Z.h).add(N)}n.abs=function(){return B(this)?H(this):this},n.add=function(Z){for(var Q=Math.max(this.g.length,Z.g.length),ne=[],se=0,fe=0;fe<=Q;fe++){var he=se+(this.i(fe)&65535)+(Z.i(fe)&65535),ue=(he>>>16)+(this.i(fe)>>>16)+(Z.i(fe)>>>16);se=ue>>>16,he&=65535,ue&=65535,ne[fe]=ue<<16|he}return new p(ne,ne[ne.length-1]&-2147483648?-1:0)};function ee(Z,Q){return Z.add(H(Q))}n.j=function(Z){if(j(this)||j(Z))return A;if(B(this))return B(Z)?H(this).j(H(Z)):H(H(this).j(Z));if(B(Z))return H(this.j(H(Z)));if(0>this.l(F)&&0>Z.l(F))return b(this.m()*Z.m());for(var Q=this.g.length+Z.g.length,ne=[],se=0;se<2*Q;se++)ne[se]=0;for(se=0;se<this.g.length;se++)for(var fe=0;fe<Z.g.length;fe++){var he=this.i(se)>>>16,ue=this.i(se)&65535,Me=Z.i(fe)>>>16,He=Z.i(fe)&65535;ne[2*se+2*fe]+=ue*He,K(ne,2*se+2*fe),ne[2*se+2*fe+1]+=he*He,K(ne,2*se+2*fe+1),ne[2*se+2*fe+1]+=ue*Me,K(ne,2*se+2*fe+1),ne[2*se+2*fe+2]+=he*Me,K(ne,2*se+2*fe+2)}for(se=0;se<Q;se++)ne[se]=ne[2*se+1]<<16|ne[2*se];for(se=Q;se<2*Q;se++)ne[se]=0;return new p(ne,0)};function K(Z,Q){for(;(Z[Q]&65535)!=Z[Q];)Z[Q+1]+=Z[Q]>>>16,Z[Q]&=65535,Q++}function te(Z,Q){this.g=Z,this.h=Q}function le(Z,Q){if(j(Q))throw Error("division by zero");if(j(Z))return new te(A,A);if(B(Z))return Q=le(H(Z),Q),new te(H(Q.g),H(Q.h));if(B(Q))return Q=le(Z,H(Q)),new te(H(Q.g),Q.h);if(30<Z.g.length){if(B(Z)||B(Q))throw Error("slowDivide_ only works with positive integers.");for(var ne=N,se=Q;0>=se.l(Z);)ne=oe(ne),se=oe(se);var fe=ge(ne,1),he=ge(se,1);for(se=ge(se,2),ne=ge(ne,2);!j(se);){var ue=he.add(se);0>=ue.l(Z)&&(fe=fe.add(ne),he=ue),se=ge(se,1),ne=ge(ne,1)}return Q=ee(Z,fe.j(Q)),new te(fe,Q)}for(fe=A;0<=Z.l(Q);){for(ne=Math.max(1,Math.floor(Z.m()/Q.m())),se=Math.ceil(Math.log(ne)/Math.LN2),se=48>=se?1:Math.pow(2,se-48),he=b(ne),ue=he.j(Q);B(ue)||0<ue.l(Z);)ne-=se,he=b(ne),ue=he.j(Q);j(he)&&(he=N),fe=fe.add(he),Z=ee(Z,ue)}return new te(fe,Z)}n.A=function(Z){return le(this,Z).h},n.and=function(Z){for(var Q=Math.max(this.g.length,Z.g.length),ne=[],se=0;se<Q;se++)ne[se]=this.i(se)&Z.i(se);return new p(ne,this.h&Z.h)},n.or=function(Z){for(var Q=Math.max(this.g.length,Z.g.length),ne=[],se=0;se<Q;se++)ne[se]=this.i(se)|Z.i(se);return new p(ne,this.h|Z.h)},n.xor=function(Z){for(var Q=Math.max(this.g.length,Z.g.length),ne=[],se=0;se<Q;se++)ne[se]=this.i(se)^Z.i(se);return new p(ne,this.h^Z.h)};function oe(Z){for(var Q=Z.g.length+1,ne=[],se=0;se<Q;se++)ne[se]=Z.i(se)<<1|Z.i(se-1)>>>31;return new p(ne,Z.h)}function ge(Z,Q){var ne=Q>>5;Q%=32;for(var se=Z.g.length-ne,fe=[],he=0;he<se;he++)fe[he]=0<Q?Z.i(he+ne)>>>Q|Z.i(he+ne+1)<<32-Q:Z.i(he+ne);return new p(fe,Z.h)}a.prototype.digest=a.prototype.v,a.prototype.reset=a.prototype.s,a.prototype.update=a.prototype.u,Cre=a,p.prototype.add=p.prototype.add,p.prototype.multiply=p.prototype.j,p.prototype.modulo=p.prototype.A,p.prototype.compare=p.prototype.l,p.prototype.toNumber=p.prototype.m,p.prototype.toString=p.prototype.toString,p.prototype.getBits=p.prototype.i,p.fromNumber=b,p.fromString=w,dg=p}).apply(typeof hX<"u"?hX:typeof self<"u"?self:typeof window<"u"?window:{});var vO=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Ire,xw,Are,rk,SV,Pre,Ore,kre;(function(){var n,t=typeof Object.defineProperties=="function"?Object.defineProperty:function(I,W,J){return I==Array.prototype||I==Object.prototype||(I[W]=J.value),I};function i(I){I=[typeof globalThis=="object"&&globalThis,I,typeof window=="object"&&window,typeof self=="object"&&self,typeof vO=="object"&&vO];for(var W=0;W<I.length;++W){var J=I[W];if(J&&J.Math==Math)return J}throw Error("Cannot find global object")}var a=i(this);function l(I,W){if(W)e:{var J=a;I=I.split(".");for(var pe=0;pe<I.length-1;pe++){var qe=I[pe];if(!(qe in J))break e;J=J[qe]}I=I[I.length-1],pe=J[I],W=W(pe),W!=pe&&W!=null&&t(J,I,{configurable:!0,writable:!0,value:W})}}function d(I,W){I instanceof String&&(I+="");var J=0,pe=!1,qe={next:function(){if(!pe&&J<I.length){var at=J++;return{value:W(at,I[at]),done:!1}}return pe=!0,{done:!0,value:void 0}}};return qe[Symbol.iterator]=function(){return qe},qe}l("Array.prototype.values",function(I){return I||function(){return d(this,function(W,J){return J})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var p=p||{},E=this||self;function v(I){var W=typeof I;return W=W!="object"?W:I?Array.isArray(I)?"array":W:"null",W=="array"||W=="object"&&typeof I.length=="number"}function b(I){var W=typeof I;return W=="object"&&I!=null||W=="function"}function w(I,W,J){return I.call.apply(I.bind,arguments)}function A(I,W,J){if(!I)throw Error();if(2<arguments.length){var pe=Array.prototype.slice.call(arguments,2);return function(){var qe=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(qe,pe),I.apply(W,qe)}}return function(){return I.apply(W,arguments)}}function N(I,W,J){return N=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?w:A,N.apply(null,arguments)}function F(I,W){var J=Array.prototype.slice.call(arguments,1);return function(){var pe=J.slice();return pe.push.apply(pe,arguments),I.apply(this,pe)}}function j(I,W){function J(){}J.prototype=W.prototype,I.aa=W.prototype,I.prototype=new J,I.prototype.constructor=I,I.Qb=function(pe,qe,at){for(var xt=Array(arguments.length-2),Gr=2;Gr<arguments.length;Gr++)xt[Gr-2]=arguments[Gr];return W.prototype[qe].apply(pe,xt)}}function B(I){const W=I.length;if(0<W){const J=Array(W);for(let pe=0;pe<W;pe++)J[pe]=I[pe];return J}return[]}function H(I,W){for(let J=1;J<arguments.length;J++){const pe=arguments[J];if(v(pe)){const qe=I.length||0,at=pe.length||0;I.length=qe+at;for(let xt=0;xt<at;xt++)I[qe+xt]=pe[xt]}else I.push(pe)}}class ee{constructor(W,J){this.i=W,this.j=J,this.h=0,this.g=null}get(){let W;return 0<this.h?(this.h--,W=this.g,this.g=W.next,W.next=null):W=this.i(),W}}function K(I){return/^[\s\xa0]*$/.test(I)}function te(){var I=E.navigator;return I&&(I=I.userAgent)?I:""}function le(I){return le[" "](I),I}le[" "]=function(){};var oe=te().indexOf("Gecko")!=-1&&!(te().toLowerCase().indexOf("webkit")!=-1&&te().indexOf("Edge")==-1)&&!(te().indexOf("Trident")!=-1||te().indexOf("MSIE")!=-1)&&te().indexOf("Edge")==-1;function ge(I,W,J){for(const pe in I)W.call(J,I[pe],pe,I)}function Z(I,W){for(const J in I)W.call(void 0,I[J],J,I)}function Q(I){const W={};for(const J in I)W[J]=I[J];return W}const ne="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function se(I,W){let J,pe;for(let qe=1;qe<arguments.length;qe++){pe=arguments[qe];for(J in pe)I[J]=pe[J];for(let at=0;at<ne.length;at++)J=ne[at],Object.prototype.hasOwnProperty.call(pe,J)&&(I[J]=pe[J])}}function fe(I){var W=1;I=I.split(":");const J=[];for(;0<W&&I.length;)J.push(I.shift()),W--;return I.length&&J.push(I.join(":")),J}function he(I){E.setTimeout(()=>{throw I},0)}function ue(){var I=ye;let W=null;return I.g&&(W=I.g,I.g=I.g.next,I.g||(I.h=null),W.next=null),W}class Me{constructor(){this.h=this.g=null}add(W,J){const pe=He.get();pe.set(W,J),this.h?this.h.next=pe:this.g=pe,this.h=pe}}var He=new ee(()=>new rt,I=>I.reset());class rt{constructor(){this.next=this.g=this.h=null}set(W,J){this.h=W,this.g=J,this.next=null}reset(){this.next=this.g=this.h=null}}let we,Ce=!1,ye=new Me,Ne=()=>{const I=E.Promise.resolve(void 0);we=()=>{I.then(be)}};var be=()=>{for(var I;I=ue();){try{I.h.call(I.g)}catch(J){he(J)}var W=He;W.j(I),100>W.h&&(W.h++,I.next=W.g,W.g=I)}Ce=!1};function Se(){this.s=this.s,this.C=this.C}Se.prototype.s=!1,Se.prototype.ma=function(){this.s||(this.s=!0,this.N())},Se.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Ae(I,W){this.type=I,this.g=this.target=W,this.defaultPrevented=!1}Ae.prototype.h=function(){this.defaultPrevented=!0};var Ue=function(){if(!E.addEventListener||!Object.defineProperty)return!1;var I=!1,W=Object.defineProperty({},"passive",{get:function(){I=!0}});try{const J=()=>{};E.addEventListener("test",J,W),E.removeEventListener("test",J,W)}catch{}return I}();function ze(I,W){if(Ae.call(this,I?I.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,I){var J=this.type=I.type,pe=I.changedTouches&&I.changedTouches.length?I.changedTouches[0]:null;if(this.target=I.target||I.srcElement,this.g=W,W=I.relatedTarget){if(oe){e:{try{le(W.nodeName);var qe=!0;break e}catch{}qe=!1}qe||(W=null)}}else J=="mouseover"?W=I.fromElement:J=="mouseout"&&(W=I.toElement);this.relatedTarget=W,pe?(this.clientX=pe.clientX!==void 0?pe.clientX:pe.pageX,this.clientY=pe.clientY!==void 0?pe.clientY:pe.pageY,this.screenX=pe.screenX||0,this.screenY=pe.screenY||0):(this.clientX=I.clientX!==void 0?I.clientX:I.pageX,this.clientY=I.clientY!==void 0?I.clientY:I.pageY,this.screenX=I.screenX||0,this.screenY=I.screenY||0),this.button=I.button,this.key=I.key||"",this.ctrlKey=I.ctrlKey,this.altKey=I.altKey,this.shiftKey=I.shiftKey,this.metaKey=I.metaKey,this.pointerId=I.pointerId||0,this.pointerType=typeof I.pointerType=="string"?I.pointerType:et[I.pointerType]||"",this.state=I.state,this.i=I,I.defaultPrevented&&ze.aa.h.call(this)}}j(ze,Ae);var et={2:"touch",3:"pen",4:"mouse"};ze.prototype.h=function(){ze.aa.h.call(this);var I=this.i;I.preventDefault?I.preventDefault():I.returnValue=!1};var nt="closure_listenable_"+(1e6*Math.random()|0),dt=0;function Xe(I,W,J,pe,qe){this.listener=I,this.proxy=null,this.src=W,this.type=J,this.capture=!!pe,this.ha=qe,this.key=++dt,this.da=this.fa=!1}function It(I){I.da=!0,I.listener=null,I.proxy=null,I.src=null,I.ha=null}function hn(I){this.src=I,this.g={},this.h=0}hn.prototype.add=function(I,W,J,pe,qe){var at=I.toString();I=this.g[at],I||(I=this.g[at]=[],this.h++);var xt=ln(I,W,pe,qe);return-1<xt?(W=I[xt],J||(W.fa=!1)):(W=new Xe(W,this.src,at,!!pe,qe),W.fa=J,I.push(W)),W};function Ut(I,W){var J=W.type;if(J in I.g){var pe=I.g[J],qe=Array.prototype.indexOf.call(pe,W,void 0),at;(at=0<=qe)&&Array.prototype.splice.call(pe,qe,1),at&&(It(W),I.g[J].length==0&&(delete I.g[J],I.h--))}}function ln(I,W,J,pe){for(var qe=0;qe<I.length;++qe){var at=I[qe];if(!at.da&&at.listener==W&&at.capture==!!J&&at.ha==pe)return qe}return-1}var Ln="closure_lm_"+(1e6*Math.random()|0),Xt={};function Yn(I,W,J,pe,qe){if(Array.isArray(W)){for(var at=0;at<W.length;at++)Yn(I,W[at],J,pe,qe);return null}return J=Jt(J),I&&I[nt]?I.K(W,J,b(pe)?!!pe.capture:!1,qe):Kt(I,W,J,!1,pe,qe)}function Kt(I,W,J,pe,qe,at){if(!W)throw Error("Invalid event type");var xt=b(qe)?!!qe.capture:!!qe,Gr=Ge(I);if(Gr||(I[Ln]=Gr=new hn(I)),J=Gr.add(W,J,pe,xt,at),J.proxy)return J;if(pe=Re(),J.proxy=pe,pe.src=I,pe.listener=J,I.addEventListener)Ue||(qe=xt),qe===void 0&&(qe=!1),I.addEventListener(W.toString(),pe,qe);else if(I.attachEvent)I.attachEvent(yt(W.toString()),pe);else if(I.addListener&&I.removeListener)I.addListener(pe);else throw Error("addEventListener and attachEvent are unavailable.");return J}function Re(){function I(J){return W.call(I.src,I.listener,J)}const W=St;return I}function Fe(I,W,J,pe,qe){if(Array.isArray(W))for(var at=0;at<W.length;at++)Fe(I,W[at],J,pe,qe);else pe=b(pe)?!!pe.capture:!!pe,J=Jt(J),I&&I[nt]?(I=I.i,W=String(W).toString(),W in I.g&&(at=I.g[W],J=ln(at,J,pe,qe),-1<J&&(It(at[J]),Array.prototype.splice.call(at,J,1),at.length==0&&(delete I.g[W],I.h--)))):I&&(I=Ge(I))&&(W=I.g[W.toString()],I=-1,W&&(I=ln(W,J,pe,qe)),(J=-1<I?W[I]:null)&&Ke(J))}function Ke(I){if(typeof I!="number"&&I&&!I.da){var W=I.src;if(W&&W[nt])Ut(W.i,I);else{var J=I.type,pe=I.proxy;W.removeEventListener?W.removeEventListener(J,pe,I.capture):W.detachEvent?W.detachEvent(yt(J),pe):W.addListener&&W.removeListener&&W.removeListener(pe),(J=Ge(W))?(Ut(J,I),J.h==0&&(J.src=null,W[Ln]=null)):It(I)}}}function yt(I){return I in Xt?Xt[I]:Xt[I]="on"+I}function St(I,W){if(I.da)I=!0;else{W=new ze(W,this);var J=I.listener,pe=I.ha||I.src;I.fa&&Ke(I),I=J.call(pe,W)}return I}function Ge(I){return I=I[Ln],I instanceof hn?I:null}var Ot="__closure_events_fn_"+(1e9*Math.random()>>>0);function Jt(I){return typeof I=="function"?I:(I[Ot]||(I[Ot]=function(W){return I.handleEvent(W)}),I[Ot])}function fn(){Se.call(this),this.i=new hn(this),this.M=this,this.F=null}j(fn,Se),fn.prototype[nt]=!0,fn.prototype.removeEventListener=function(I,W,J,pe){Fe(this,I,W,J,pe)};function an(I,W){var J,pe=I.F;if(pe)for(J=[];pe;pe=pe.F)J.push(pe);if(I=I.M,pe=W.type||W,typeof W=="string")W=new Ae(W,I);else if(W instanceof Ae)W.target=W.target||I;else{var qe=W;W=new Ae(pe,I),se(W,qe)}if(qe=!0,J)for(var at=J.length-1;0<=at;at--){var xt=W.g=J[at];qe=ir(xt,pe,!0,W)&&qe}if(xt=W.g=I,qe=ir(xt,pe,!0,W)&&qe,qe=ir(xt,pe,!1,W)&&qe,J)for(at=0;at<J.length;at++)xt=W.g=J[at],qe=ir(xt,pe,!1,W)&&qe}fn.prototype.N=function(){if(fn.aa.N.call(this),this.i){var I=this.i,W;for(W in I.g){for(var J=I.g[W],pe=0;pe<J.length;pe++)It(J[pe]);delete I.g[W],I.h--}}this.F=null},fn.prototype.K=function(I,W,J,pe){return this.i.add(String(I),W,!1,J,pe)},fn.prototype.L=function(I,W,J,pe){return this.i.add(String(I),W,!0,J,pe)};function ir(I,W,J,pe){if(W=I.i.g[String(W)],!W)return!0;W=W.concat();for(var qe=!0,at=0;at<W.length;++at){var xt=W[at];if(xt&&!xt.da&&xt.capture==J){var Gr=xt.listener,oi=xt.ha||xt.src;xt.fa&&Ut(I.i,xt),qe=Gr.call(oi,pe)!==!1&&qe}}return qe&&!pe.defaultPrevented}function ia(I,W,J){if(typeof I=="function")J&&(I=N(I,J));else if(I&&typeof I.handleEvent=="function")I=N(I.handleEvent,I);else throw Error("Invalid listener argument");return 2147483647<Number(W)?-1:E.setTimeout(I,W||0)}function Vt(I){I.g=ia(()=>{I.g=null,I.i&&(I.i=!1,Vt(I))},I.l);const W=I.h;I.h=null,I.m.apply(null,W)}class on extends Se{constructor(W,J){super(),this.m=W,this.l=J,this.h=null,this.i=!1,this.g=null}j(W){this.h=arguments,this.g?this.i=!0:Vt(this)}N(){super.N(),this.g&&(E.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Pi(I){Se.call(this),this.h=I,this.g={}}j(Pi,Se);var fi=[];function Ti(I){ge(I.g,function(W,J){this.g.hasOwnProperty(J)&&Ke(W)},I),I.g={}}Pi.prototype.N=function(){Pi.aa.N.call(this),Ti(this)},Pi.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var ur=E.JSON.stringify,Ba=E.JSON.parse,nl=class{stringify(I){return E.JSON.stringify(I,void 0)}parse(I){return E.JSON.parse(I,void 0)}};function us(){}us.prototype.h=null;function ds(I){return I.h||(I.h=I.i())}function Ul(){}var Fo={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function lc(){Ae.call(this,"d")}j(lc,Ae);function oa(){Ae.call(this,"c")}j(oa,Ae);var uc={},rl=null;function Lu(){return rl=rl||new fn}uc.La="serverreachability";function dc(I){Ae.call(this,uc.La,I)}j(dc,Ae);function il(I){const W=Lu();an(W,new dc(W))}uc.STAT_EVENT="statevent";function Is(I,W){Ae.call(this,uc.STAT_EVENT,I),this.stat=W}j(Is,Ae);function Mi(I){const W=Lu();an(W,new Is(W,I))}uc.Ma="timingevent";function uo(I,W){Ae.call(this,uc.Ma,I),this.size=W}j(uo,Ae);function Wa(I,W){if(typeof I!="function")throw Error("Fn must not be null and must be a function");return E.setTimeout(function(){I()},W)}function xu(){this.g=!0}xu.prototype.xa=function(){this.g=!1};function hc(I,W,J,pe,qe,at){I.info(function(){if(I.g)if(at)for(var xt="",Gr=at.split("&"),oi=0;oi<Gr.length;oi++){var Er=Gr[oi].split("=");if(1<Er.length){var Bo=Er[0];Er=Er[1];var fo=Bo.split("_");xt=2<=fo.length&&fo[1]=="type"?xt+(Bo+"="+Er+"&"):xt+(Bo+"=redacted&")}}else xt=null;else xt=at;return"XMLHTTP REQ ("+pe+") [attempt "+qe+"]: "+W+`
`+J+`
`+xt})}function sa(I,W,J,pe,qe,at,xt){I.info(function(){return"XMLHTTP RESP ("+pe+") [ attempt "+qe+"]: "+W+`
`+J+`
`+at+" "+xt})}function aa(I,W,J,pe){I.info(function(){return"XMLHTTP TEXT ("+W+"): "+Ng(I,J)+(pe?" "+pe:"")})}function Md(I,W){I.info(function(){return"TIMEOUT: "+W})}xu.prototype.info=function(){};function Ng(I,W){if(!I.g)return W;if(!W)return null;try{var J=JSON.parse(W);if(J){for(I=0;I<J.length;I++)if(Array.isArray(J[I])){var pe=J[I];if(!(2>pe.length)){var qe=pe[1];if(Array.isArray(qe)&&!(1>qe.length)){var at=qe[0];if(at!="noop"&&at!="stop"&&at!="close")for(var xt=1;xt<qe.length;xt++)qe[xt]=""}}}}return ur(J)}catch{return W}}var Mu={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},cf={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},jo;function Uu(){}j(Uu,us),Uu.prototype.g=function(){return new XMLHttpRequest},Uu.prototype.i=function(){return{}},jo=new Uu;function ca(I,W,J,pe){this.j=I,this.i=W,this.l=J,this.R=pe||1,this.U=new Pi(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Ud}function Ud(){this.i=null,this.g="",this.h=!1}var Vd={},za={};function Fd(I,W,J){I.L=1,I.v=Ha(Ps(W)),I.m=J,I.P=!0,Vu(I,null)}function Vu(I,W){I.F=Date.now(),Fr(I),I.A=Ps(I.v);var J=I.A,pe=I.R;Array.isArray(pe)||(pe=[String(pe)]),zl(J.i,"t",pe),I.C=0,J=I.j.J,I.h=new Ud,I.g=KE(I.j,J?W:null,!I.m),0<I.O&&(I.M=new on(N(I.Y,I,I.g),I.O)),W=I.U,J=I.g,pe=I.ca;var qe="readystatechange";Array.isArray(qe)||(qe&&(fi[0]=qe.toString()),qe=fi);for(var at=0;at<qe.length;at++){var xt=Yn(J,qe[at],pe||W.handleEvent,!1,W.h||W);if(!xt)break;W.g[xt.key]=xt}W=I.H?Q(I.H):{},I.m?(I.u||(I.u="POST"),W["Content-Type"]="application/x-www-form-urlencoded",I.g.ea(I.A,I.u,I.m,W)):(I.u="GET",I.g.ea(I.A,I.u,null,W)),il(),hc(I.i,I.u,I.A,I.l,I.R,I.m)}ca.prototype.ca=function(I){I=I.target;const W=this.M;W&&mi(I)==3?W.j():this.Y(I)},ca.prototype.Y=function(I){try{if(I==this.g)e:{const fo=mi(this.g);var W=this.g.Ba();const $a=this.g.Z();if(!(3>fo)&&(fo!=3||this.g&&(this.h.h||this.g.oa()||Po(this.g)))){this.J||fo!=4||W==7||(W==8||0>=$a?il(3):il(2)),fc(this);var J=this.g.Z();this.X=J;t:if(As(this)){var pe=Po(this.g);I="";var qe=pe.length,at=mi(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){la(this),ol(this);var xt="";break t}this.h.i=new E.TextDecoder}for(W=0;W<qe;W++)this.h.h=!0,I+=this.h.i.decode(pe[W],{stream:!(at&&W==qe-1)});pe.length=0,this.h.g+=I,this.C=0,xt=this.h.g}else xt=this.g.oa();if(this.o=J==200,sa(this.i,this.u,this.A,this.l,this.R,fo,J),this.o){if(this.T&&!this.K){t:{if(this.g){var Gr,oi=this.g;if((Gr=oi.g?oi.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!K(Gr)){var Er=Gr;break t}}Er=null}if(J=Er)aa(this.i,this.l,J,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,lf(this,J);else{this.o=!1,this.s=3,Mi(12),la(this),ol(this);break e}}if(this.P){J=!0;let Fs;for(;!this.J&&this.C<xt.length;)if(Fs=jd(this,xt),Fs==za){fo==4&&(this.s=4,Mi(14),J=!1),aa(this.i,this.l,null,"[Incomplete Response]");break}else if(Fs==Vd){this.s=4,Mi(15),aa(this.i,this.l,xt,"[Invalid Chunk]"),J=!1;break}else aa(this.i,this.l,Fs,null),lf(this,Fs);if(As(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),fo!=4||xt.length!=0||this.h.h||(this.s=1,Mi(16),J=!1),this.o=this.o&&J,!J)aa(this.i,this.l,xt,"[Invalid Chunked Response]"),la(this),ol(this);else if(0<xt.length&&!this.W){this.W=!0;var Bo=this.j;Bo.g==this&&Bo.ba&&!Bo.M&&(Bo.j.info("Great, no buffering proxy detected. Bytes received: "+xt.length),Lg(Bo),Bo.M=!0,Mi(11))}}else aa(this.i,this.l,xt,null),lf(this,xt);fo==4&&la(this),this.o&&!this.J&&(fo==4?Kp(this.j,this):(this.o=!1,Fr(this)))}else xs(this.g),J==400&&0<xt.indexOf("Unknown SID")?(this.s=3,Mi(12)):(this.s=0,Mi(13)),la(this),ol(this)}}}catch{}finally{}};function As(I){return I.g?I.u=="GET"&&I.L!=2&&I.j.Ca:!1}function jd(I,W){var J=I.C,pe=W.indexOf(`
`,J);return pe==-1?za:(J=Number(W.substring(J,pe)),isNaN(J)?Vd:(pe+=1,pe+J>W.length?za:(W=W.slice(pe,pe+J),I.C=pe+J,W)))}ca.prototype.cancel=function(){this.J=!0,la(this)};function Fr(I){I.S=Date.now()+I.I,pi(I,I.I)}function pi(I,W){if(I.B!=null)throw Error("WatchDog timer not null");I.B=Wa(N(I.ba,I),W)}function fc(I){I.B&&(E.clearTimeout(I.B),I.B=null)}ca.prototype.ba=function(){this.B=null;const I=Date.now();0<=I-this.S?(Md(this.i,this.A),this.L!=2&&(il(),Mi(17)),la(this),this.s=2,ol(this)):pi(this,this.S-I)};function ol(I){I.j.G==0||I.J||Kp(I.j,I)}function la(I){fc(I);var W=I.M;W&&typeof W.ma=="function"&&W.ma(),I.M=null,Ti(I.U),I.g&&(W=I.g,I.g=null,W.abort(),W.ma())}function lf(I,W){try{var J=I.j;if(J.G!=0&&(J.g==I||Xo(J.h,I))){if(!I.K&&Xo(J.h,I)&&J.G==3){try{var pe=J.Da.g.parse(W)}catch{pe=null}if(Array.isArray(pe)&&pe.length==3){var qe=pe;if(qe[0]==0){e:if(!J.u){if(J.g)if(J.g.F+3e3<I.F)$p(J),ul(J);else break e;Hp(J),Mi(18)}}else J.za=qe[1],0<J.za-J.T&&37500>qe[2]&&J.F&&J.v==0&&!J.C&&(J.C=Wa(N(J.Za,J),6e3));if(1>=Fp(J.h)&&J.ca){try{J.ca()}catch{}J.ca=void 0}}else Hu(J,11)}else if((I.K||J.g==I)&&$p(J),!K(W))for(qe=J.Da.g.parse(W),W=0;W<qe.length;W++){let Er=qe[W];if(J.T=Er[0],Er=Er[1],J.G==2)if(Er[0]=="c"){J.K=Er[1],J.ia=Er[2];const Bo=Er[3];Bo!=null&&(J.la=Bo,J.j.info("VER="+J.la));const fo=Er[4];fo!=null&&(J.Aa=fo,J.j.info("SVER="+J.Aa));const $a=Er[5];$a!=null&&typeof $a=="number"&&0<$a&&(pe=1.5*$a,J.L=pe,J.j.info("backChannelRequestTimeoutMs_="+pe)),pe=J;const Fs=I.g;if(Fs){const pf=Fs.g?Fs.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(pf){var at=pe.h;at.g||pf.indexOf("spdy")==-1&&pf.indexOf("quic")==-1&&pf.indexOf("h2")==-1||(at.j=at.l,at.g=new Set,at.h&&(uf(at,at.h),at.h=null))}if(pe.D){const Yp=Fs.g?Fs.g.getResponseHeader("X-HTTP-Session-Id"):null;Yp&&(pe.ya=Yp,zr(pe.I,pe.D,Yp))}}J.G=3,J.l&&J.l.ua(),J.ba&&(J.R=Date.now()-I.F,J.j.info("Handshake RTT: "+J.R+"ms")),pe=J;var xt=I;if(pe.qa=xg(pe,pe.J?pe.ia:null,pe.W),xt.K){sl(pe.h,xt);var Gr=xt,oi=pe.L;oi&&(Gr.I=oi),Gr.B&&(fc(Gr),Fr(Gr)),pe.g=xt}else Hl(pe);0<J.i.length&&gc(J)}else Er[0]!="stop"&&Er[0]!="close"||Hu(J,7);else J.G==3&&(Er[0]=="stop"||Er[0]=="close"?Er[0]=="stop"?Hu(J,7):Yi(J):Er[0]!="noop"&&J.l&&J.l.ta(Er),J.v=0)}}il(4)}catch{}}var Bd=class{constructor(I,W){this.g=I,this.map=W}};function Vl(I){this.l=I||10,E.PerformanceNavigationTiming?(I=E.performance.getEntriesByType("navigation"),I=0<I.length&&(I[0].nextHopProtocol=="hq"||I[0].nextHopProtocol=="h2")):I=!!(E.chrome&&E.chrome.loadTimes&&E.chrome.loadTimes()&&E.chrome.loadTimes().wasFetchedViaSpdy),this.j=I?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function hs(I){return I.h?!0:I.g?I.g.size>=I.j:!1}function Fp(I){return I.h?1:I.g?I.g.size:0}function Xo(I,W){return I.h?I.h==W:I.g?I.g.has(W):!1}function uf(I,W){I.g?I.g.add(W):I.h=W}function sl(I,W){I.h&&I.h==W?I.h=null:I.g&&I.g.has(W)&&I.g.delete(W)}Vl.prototype.cancel=function(){if(this.i=Wd(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const I of this.g.values())I.cancel();this.g.clear()}};function Wd(I){if(I.h!=null)return I.i.concat(I.h.D);if(I.g!=null&&I.g.size!==0){let W=I.i;for(const J of I.g.values())W=W.concat(J.D);return W}return B(I.i)}function zd(I){if(I.V&&typeof I.V=="function")return I.V();if(typeof Map<"u"&&I instanceof Map||typeof Set<"u"&&I instanceof Set)return Array.from(I.values());if(typeof I=="string")return I.split("");if(v(I)){for(var W=[],J=I.length,pe=0;pe<J;pe++)W.push(I[pe]);return W}W=[],J=0;for(pe in I)W[J++]=I[pe];return W}function dr(I){if(I.na&&typeof I.na=="function")return I.na();if(!I.V||typeof I.V!="function"){if(typeof Map<"u"&&I instanceof Map)return Array.from(I.keys());if(!(typeof Set<"u"&&I instanceof Set)){if(v(I)||typeof I=="string"){var W=[];I=I.length;for(var J=0;J<I;J++)W.push(J);return W}W=[],J=0;for(const pe in I)W[J++]=pe;return W}}}function Fl(I,W){if(I.forEach&&typeof I.forEach=="function")I.forEach(W,void 0);else if(v(I)||typeof I=="string")Array.prototype.forEach.call(I,W,void 0);else for(var J=dr(I),pe=zd(I),qe=pe.length,at=0;at<qe;at++)W.call(void 0,pe[at],J&&J[at],I)}var jl=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Fu(I,W){if(I){I=I.split("&");for(var J=0;J<I.length;J++){var pe=I[J].indexOf("="),qe=null;if(0<=pe){var at=I[J].substring(0,pe);qe=I[J].substring(pe+1)}else at=I[J];W(at,qe?decodeURIComponent(qe.replace(/\+/g," ")):"")}}}function Ga(I){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,I instanceof Ga){this.h=I.h,ju(this,I.j),this.o=I.o,this.g=I.g,al(this,I.s),this.l=I.l;var W=I.i,J=new Os;J.i=W.i,W.g&&(J.g=new Map(W.g),J.h=W.h),Bl(this,J),this.m=I.m}else I&&(W=String(I).match(jl))?(this.h=!1,ju(this,W[1]||"",!0),this.o=nr(W[2]||""),this.g=nr(W[3]||"",!0),al(this,W[4]),this.l=nr(W[5]||"",!0),Bl(this,W[6]||"",!0),this.m=nr(W[7]||"")):(this.h=!1,this.i=new Os(null,this.h))}Ga.prototype.toString=function(){var I=[],W=this.j;W&&I.push(pc(W,Wl,!0),":");var J=this.g;return(J||W=="file")&&(I.push("//"),(W=this.o)&&I.push(pc(W,Wl,!0),"@"),I.push(encodeURIComponent(String(J)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),J=this.s,J!=null&&I.push(":",String(J))),(J=this.l)&&(this.g&&J.charAt(0)!="/"&&I.push("/"),I.push(pc(J,J.charAt(0)=="/"?df:Gd,!0))),(J=this.i.toString())&&I.push("?",J),(J=this.m)&&I.push("#",pc(J,hf)),I.join("")};function Ps(I){return new Ga(I)}function ju(I,W,J){I.j=J?nr(W,!0):W,I.j&&(I.j=I.j.replace(/:$/,""))}function al(I,W){if(W){if(W=Number(W),isNaN(W)||0>W)throw Error("Bad port number "+W);I.s=W}else I.s=null}function Bl(I,W,J){W instanceof Os?(I.i=W,Ls(I.i,I.h)):(J||(W=pc(W,Bp)),I.i=new Os(W,I.h))}function zr(I,W,J){I.i.set(W,J)}function Ha(I){return zr(I,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),I}function nr(I,W){return I?W?decodeURI(I.replace(/%25/g,"%2525")):decodeURIComponent(I):""}function pc(I,W,J){return typeof I=="string"?(I=encodeURI(I).replace(W,jp),J&&(I=I.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),I):null}function jp(I){return I=I.charCodeAt(0),"%"+(I>>4&15).toString(16)+(I&15).toString(16)}var Wl=/[#\/\?@]/g,Gd=/[#\?:]/g,df=/[#\?]/g,Bp=/[#\?@]/g,hf=/#/g;function Os(I,W){this.h=this.g=null,this.i=I||null,this.j=!!W}function no(I){I.g||(I.g=new Map,I.h=0,I.i&&Fu(I.i,function(W,J){I.add(decodeURIComponent(W.replace(/\+/g," ")),J)}))}n=Os.prototype,n.add=function(I,W){no(this),this.i=null,I=Ds(this,I);var J=this.g.get(I);return J||this.g.set(I,J=[]),J.push(W),this.h+=1,this};function ks(I,W){no(I),W=Ds(I,W),I.g.has(W)&&(I.i=null,I.h-=I.g.get(W).length,I.g.delete(W))}function Ns(I,W){return no(I),W=Ds(I,W),I.g.has(W)}n.forEach=function(I,W){no(this),this.g.forEach(function(J,pe){J.forEach(function(qe){I.call(W,qe,pe,this)},this)},this)},n.na=function(){no(this);const I=Array.from(this.g.values()),W=Array.from(this.g.keys()),J=[];for(let pe=0;pe<W.length;pe++){const qe=I[pe];for(let at=0;at<qe.length;at++)J.push(W[pe])}return J},n.V=function(I){no(this);let W=[];if(typeof I=="string")Ns(this,I)&&(W=W.concat(this.g.get(Ds(this,I))));else{I=Array.from(this.g.values());for(let J=0;J<I.length;J++)W=W.concat(I[J])}return W},n.set=function(I,W){return no(this),this.i=null,I=Ds(this,I),Ns(this,I)&&(this.h-=this.g.get(I).length),this.g.set(I,[W]),this.h+=1,this},n.get=function(I,W){return I?(I=this.V(I),0<I.length?String(I[0]):W):W};function zl(I,W,J){ks(I,W),0<J.length&&(I.i=null,I.g.set(Ds(I,W),B(J)),I.h+=J.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const I=[],W=Array.from(this.g.keys());for(var J=0;J<W.length;J++){var pe=W[J];const at=encodeURIComponent(String(pe)),xt=this.V(pe);for(pe=0;pe<xt.length;pe++){var qe=at;xt[pe]!==""&&(qe+="="+encodeURIComponent(String(xt[pe]))),I.push(qe)}}return this.i=I.join("&")};function Ds(I,W){return W=String(W),I.j&&(W=W.toLowerCase()),W}function Ls(I,W){W&&!I.j&&(no(I),I.i=null,I.g.forEach(function(J,pe){var qe=pe.toLowerCase();pe!=qe&&(ks(this,pe),zl(this,qe,J))},I)),I.j=W}function Wp(I,W){const J=new xu;if(E.Image){const pe=new Image;pe.onload=F(ho,J,"TestLoadImage: loaded",!0,W,pe),pe.onerror=F(ho,J,"TestLoadImage: error",!1,W,pe),pe.onabort=F(ho,J,"TestLoadImage: abort",!1,W,pe),pe.ontimeout=F(ho,J,"TestLoadImage: timeout",!1,W,pe),E.setTimeout(function(){pe.ontimeout&&pe.ontimeout()},1e4),pe.src=I}else W(!1)}function mc(I,W){const J=new xu,pe=new AbortController,qe=setTimeout(()=>{pe.abort(),ho(J,"TestPingServer: timeout",!1,W)},1e4);fetch(I,{signal:pe.signal}).then(at=>{clearTimeout(qe),at.ok?ho(J,"TestPingServer: ok",!0,W):ho(J,"TestPingServer: server error",!1,W)}).catch(()=>{clearTimeout(qe),ho(J,"TestPingServer: error",!1,W)})}function ho(I,W,J,pe,qe){try{qe&&(qe.onload=null,qe.onerror=null,qe.onabort=null,qe.ontimeout=null),pe(J)}catch{}}function Bu(){this.g=new nl}function ff(I,W,J){const pe=J||"";try{Fl(I,function(qe,at){let xt=qe;b(qe)&&(xt=ur(qe)),W.push(pe+at+"="+encodeURIComponent(xt))})}catch(qe){throw W.push(pe+"type="+encodeURIComponent("_badmap")),qe}}function cl(I){this.l=I.Ub||null,this.j=I.eb||!1}j(cl,us),cl.prototype.g=function(){return new Gl(this.l,this.j)},cl.prototype.i=function(I){return function(){return I}}({});function Gl(I,W){fn.call(this),this.D=I,this.o=W,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}j(Gl,fn),n=Gl.prototype,n.open=function(I,W){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=I,this.A=W,this.readyState=1,da(this)},n.send=function(I){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const W={headers:this.u,method:this.B,credentials:this.m,cache:void 0};I&&(W.body=I),(this.D||E).fetch(new Request(this.A,W)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,ua(this)),this.readyState=0},n.Sa=function(I){if(this.g&&(this.l=I,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=I.headers,this.readyState=2,da(this)),this.g&&(this.readyState=3,da(this),this.g)))if(this.responseType==="arraybuffer")I.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof E.ReadableStream<"u"&&"body"in I){if(this.j=I.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;zp(this)}else I.text().then(this.Ra.bind(this),this.ga.bind(this))};function zp(I){I.j.read().then(I.Pa.bind(I)).catch(I.ga.bind(I))}n.Pa=function(I){if(this.g){if(this.o&&I.value)this.response.push(I.value);else if(!this.o){var W=I.value?I.value:new Uint8Array(0);(W=this.v.decode(W,{stream:!I.done}))&&(this.response=this.responseText+=W)}I.done?ua(this):da(this),this.readyState==3&&zp(this)}},n.Ra=function(I){this.g&&(this.response=this.responseText=I,ua(this))},n.Qa=function(I){this.g&&(this.response=I,ua(this))},n.ga=function(){this.g&&ua(this)};function ua(I){I.readyState=4,I.l=null,I.j=null,I.v=null,da(I)}n.setRequestHeader=function(I,W){this.u.append(I,W)},n.getResponseHeader=function(I){return this.h&&this.h.get(I.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const I=[],W=this.h.entries();for(var J=W.next();!J.done;)J=J.value,I.push(J[0]+": "+J[1]),J=W.next();return I.join(`\r
`)};function da(I){I.onreadystatechange&&I.onreadystatechange.call(I)}Object.defineProperty(Gl.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(I){this.m=I?"include":"same-origin"}});function ll(I){let W="";return ge(I,function(J,pe){W+=pe,W+=":",W+=J,W+=`\r
`}),W}function ve(I,W,J){e:{for(pe in J){var pe=!1;break e}pe=!0}pe||(J=ll(J),typeof I=="string"?J!=null&&encodeURIComponent(String(J)):zr(I,W,J))}function De(I){fn.call(this),this.headers=new Map,this.o=I||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}j(De,fn);var tt=/^https?$/i,$t=["POST","PUT"];n=De.prototype,n.Ha=function(I){this.J=I},n.ea=function(I,W,J,pe){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+I);W=W?W.toUpperCase():"GET",this.D=I,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():jo.g(),this.v=this.o?ds(this.o):ds(jo),this.g.onreadystatechange=N(this.Ea,this);try{this.B=!0,this.g.open(W,String(I),!0),this.B=!1}catch(at){Hn(this,at);return}if(I=J||"",J=new Map(this.headers),pe)if(Object.getPrototypeOf(pe)===Object.prototype)for(var qe in pe)J.set(qe,pe[qe]);else if(typeof pe.keys=="function"&&typeof pe.get=="function")for(const at of pe.keys())J.set(at,pe.get(at));else throw Error("Unknown input type for opt_headers: "+String(pe));pe=Array.from(J.keys()).find(at=>at.toLowerCase()=="content-type"),qe=E.FormData&&I instanceof E.FormData,!(0<=Array.prototype.indexOf.call($t,W,void 0))||pe||qe||J.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[at,xt]of J)this.g.setRequestHeader(at,xt);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Nr(this),this.u=!0,this.g.send(I),this.u=!1}catch(at){Hn(this,at)}};function Hn(I,W){I.h=!1,I.g&&(I.j=!0,I.g.abort(),I.j=!1),I.l=W,I.m=5,_r(I),cn(I)}function _r(I){I.A||(I.A=!0,an(I,"complete"),an(I,"error"))}n.abort=function(I){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=I||7,an(this,"complete"),an(this,"abort"),cn(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),cn(this,!0)),De.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?jr(this):this.bb())},n.bb=function(){jr(this)};function jr(I){if(I.h&&typeof p<"u"&&(!I.v[1]||mi(I)!=4||I.Z()!=2)){if(I.u&&mi(I)==4)ia(I.Ea,0,I);else if(an(I,"readystatechange"),mi(I)==4){I.h=!1;try{const xt=I.Z();e:switch(xt){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var W=!0;break e;default:W=!1}var J;if(!(J=W)){var pe;if(pe=xt===0){var qe=String(I.D).match(jl)[1]||null;!qe&&E.self&&E.self.location&&(qe=E.self.location.protocol.slice(0,-1)),pe=!tt.test(qe?qe.toLowerCase():"")}J=pe}if(J)an(I,"complete"),an(I,"success");else{I.m=6;try{var at=2<mi(I)?I.g.statusText:""}catch{at=""}I.l=at+" ["+I.Z()+"]",_r(I)}}finally{cn(I)}}}}function cn(I,W){if(I.g){Nr(I);const J=I.g,pe=I.v[0]?()=>{}:null;I.g=null,I.v=null,W||an(I,"ready");try{J.onreadystatechange=pe}catch{}}}function Nr(I){I.I&&(E.clearTimeout(I.I),I.I=null)}n.isActive=function(){return!!this.g};function mi(I){return I.g?I.g.readyState:0}n.Z=function(){try{return 2<mi(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(I){if(this.g){var W=this.g.responseText;return I&&W.indexOf(I)==0&&(W=W.substring(I.length)),Ba(W)}};function Po(I){try{if(!I.g)return null;if("response"in I.g)return I.g.response;switch(I.H){case"":case"text":return I.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in I.g)return I.g.mozResponseArrayBuffer}return null}catch{return null}}function xs(I){const W={};I=(I.g&&2<=mi(I)&&I.g.getAllResponseHeaders()||"").split(`\r
`);for(let pe=0;pe<I.length;pe++){if(K(I[pe]))continue;var J=fe(I[pe]);const qe=J[0];if(J=J[1],typeof J!="string")continue;J=J.trim();const at=W[qe]||[];W[qe]=at,at.push(J)}Z(W,function(pe){return pe.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Ms(I,W,J){return J&&J.internalChannelParams&&J.internalChannelParams[I]||W}function Wu(I){this.Aa=0,this.i=[],this.j=new xu,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Ms("failFast",!1,I),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Ms("baseRetryDelayMs",5e3,I),this.cb=Ms("retryDelaySeedMs",1e4,I),this.Wa=Ms("forwardChannelMaxRetries",2,I),this.wa=Ms("forwardChannelRequestTimeoutMs",2e4,I),this.pa=I&&I.xmlHttpFactory||void 0,this.Xa=I&&I.Tb||void 0,this.Ca=I&&I.useFetchStreams||!1,this.L=void 0,this.J=I&&I.supportsCrossDomainXhr||!1,this.K="",this.h=new Vl(I&&I.concurrentRequestLimit),this.Da=new Bu,this.P=I&&I.fastHandshake||!1,this.O=I&&I.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=I&&I.Rb||!1,I&&I.xa&&this.j.xa(),I&&I.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&I&&I.detectBufferingProxy||!1,this.ja=void 0,I&&I.longPollingTimeout&&0<I.longPollingTimeout&&(this.ja=I.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=Wu.prototype,n.la=8,n.G=1,n.connect=function(I,W,J,pe){Mi(0),this.W=I,this.H=W||{},J&&pe!==void 0&&(this.H.OSID=J,this.H.OAID=pe),this.F=this.X,this.I=xg(this,null,this.W),gc(this)};function Yi(I){if(Hd(I),I.G==3){var W=I.U++,J=Ps(I.I);if(zr(J,"SID",I.K),zr(J,"RID",W),zr(J,"TYPE","terminate"),zu(I,J),W=new ca(I,I.j,W),W.L=2,W.v=Ha(Ps(J)),J=!1,E.navigator&&E.navigator.sendBeacon)try{J=E.navigator.sendBeacon(W.v.toString(),"")}catch{}!J&&E.Image&&(new Image().src=W.v,J=!0),J||(W.g=KE(W.j,null),W.g.ea(W.v)),W.F=Date.now(),Fr(W)}$u(I)}function ul(I){I.g&&(Lg(I),I.g.cancel(),I.g=null)}function Hd(I){ul(I),I.u&&(E.clearTimeout(I.u),I.u=null),$p(I),I.h.cancel(),I.s&&(typeof I.s=="number"&&E.clearTimeout(I.s),I.s=null)}function gc(I){if(!hs(I.h)&&!I.s){I.s=!0;var W=I.Ga;we||Ne(),Ce||(we(),Ce=!0),ye.add(W,I),I.B=0}}function Dg(I,W){return Fp(I.h)>=I.h.j-(I.s?1:0)?!1:I.s?(I.i=W.D.concat(I.i),!0):I.G==1||I.G==2||I.B>=(I.Va?0:I.Wa)?!1:(I.s=Wa(N(I.Ga,I,W),Gu(I,I.B)),I.B++,!0)}n.Ga=function(I){if(this.s)if(this.s=null,this.G==1){if(!I){this.U=Math.floor(1e5*Math.random()),I=this.U++;const qe=new ca(this,this.j,I);let at=this.o;if(this.S&&(at?(at=Q(at),se(at,this.S)):at=this.S),this.m!==null||this.O||(qe.H=at,at=null),this.P)e:{for(var W=0,J=0;J<this.i.length;J++){t:{var pe=this.i[J];if("__data__"in pe.map&&(pe=pe.map.__data__,typeof pe=="string")){pe=pe.length;break t}pe=void 0}if(pe===void 0)break;if(W+=pe,4096<W){W=J;break e}if(W===4096||J===this.i.length-1){W=J+1;break e}}W=1e3}else W=1e3;W=Us(this,qe,W),J=Ps(this.I),zr(J,"RID",I),zr(J,"CVER",22),this.D&&zr(J,"X-HTTP-Session-Id",this.D),zu(this,J),at&&(this.O?W="headers="+encodeURIComponent(String(ll(at)))+"&"+W:this.m&&ve(J,this.m,at)),uf(this.h,qe),this.Ua&&zr(J,"TYPE","init"),this.P?(zr(J,"$req",W),zr(J,"SID","null"),qe.T=!0,Fd(qe,J,null)):Fd(qe,J,W),this.G=2}}else this.G==3&&(I?Gp(this,I):this.i.length==0||hs(this.h)||Gp(this))};function Gp(I,W){var J;W?J=W.l:J=I.U++;const pe=Ps(I.I);zr(pe,"SID",I.K),zr(pe,"RID",J),zr(pe,"AID",I.T),zu(I,pe),I.m&&I.o&&ve(pe,I.m,I.o),J=new ca(I,I.j,J,I.B+1),I.m===null&&(J.H=I.o),W&&(I.i=W.D.concat(I.i)),W=Us(I,J,1e3),J.I=Math.round(.5*I.wa)+Math.round(.5*I.wa*Math.random()),uf(I.h,J),Fd(J,pe,W)}function zu(I,W){I.H&&ge(I.H,function(J,pe){zr(W,pe,J)}),I.l&&Fl({},function(J,pe){zr(W,pe,J)})}function Us(I,W,J){J=Math.min(I.i.length,J);var pe=I.l?N(I.l.Na,I.l,I):null;e:{var qe=I.i;let at=-1;for(;;){const xt=["count="+J];at==-1?0<J?(at=qe[0].g,xt.push("ofs="+at)):at=0:xt.push("ofs="+at);let Gr=!0;for(let oi=0;oi<J;oi++){let Er=qe[oi].g;const Bo=qe[oi].map;if(Er-=at,0>Er)at=Math.max(0,qe[oi].g-100),Gr=!1;else try{ff(Bo,xt,"req"+Er+"_")}catch{pe&&pe(Bo)}}if(Gr){pe=xt.join("&");break e}}}return I=I.i.splice(0,J),W.D=I,pe}function Hl(I){if(!I.g&&!I.u){I.Y=1;var W=I.Fa;we||Ne(),Ce||(we(),Ce=!0),ye.add(W,I),I.v=0}}function Hp(I){return I.g||I.u||3<=I.v?!1:(I.Y++,I.u=Wa(N(I.Fa,I),Gu(I,I.v)),I.v++,!0)}n.Fa=function(){if(this.u=null,$E(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var I=2*this.R;this.j.info("BP detection timer enabled: "+I),this.A=Wa(N(this.ab,this),I)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Mi(10),ul(this),$E(this))};function Lg(I){I.A!=null&&(E.clearTimeout(I.A),I.A=null)}function $E(I){I.g=new ca(I,I.j,"rpc",I.Y),I.m===null&&(I.g.H=I.o),I.g.O=0;var W=Ps(I.qa);zr(W,"RID","rpc"),zr(W,"SID",I.K),zr(W,"AID",I.T),zr(W,"CI",I.F?"0":"1"),!I.F&&I.ja&&zr(W,"TO",I.ja),zr(W,"TYPE","xmlhttp"),zu(I,W),I.m&&I.o&&ve(W,I.m,I.o),I.L&&(I.g.I=I.L);var J=I.g;I=I.ia,J.L=1,J.v=Ha(Ps(W)),J.m=null,J.P=!0,Vu(J,I)}n.Za=function(){this.C!=null&&(this.C=null,ul(this),Hp(this),Mi(19))};function $p(I){I.C!=null&&(E.clearTimeout(I.C),I.C=null)}function Kp(I,W){var J=null;if(I.g==W){$p(I),Lg(I),I.g=null;var pe=2}else if(Xo(I.h,W))J=W.D,sl(I.h,W),pe=1;else return;if(I.G!=0){if(W.o)if(pe==1){J=W.m?W.m.length:0,W=Date.now()-W.F;var qe=I.B;pe=Lu(),an(pe,new uo(pe,J)),gc(I)}else Hl(I);else if(qe=W.s,qe==3||qe==0&&0<W.X||!(pe==1&&Dg(I,W)||pe==2&&Hp(I)))switch(J&&0<J.length&&(W=I.h,W.i=W.i.concat(J)),qe){case 1:Hu(I,5);break;case 4:Hu(I,10);break;case 3:Hu(I,6);break;default:Hu(I,2)}}}function Gu(I,W){let J=I.Ta+Math.floor(Math.random()*I.cb);return I.isActive()||(J*=2),J*W}function Hu(I,W){if(I.j.info("Error code "+W),W==2){var J=N(I.fb,I),pe=I.Xa;const qe=!pe;pe=new Ga(pe||"//www.google.com/images/cleardot.gif"),E.location&&E.location.protocol=="http"||ju(pe,"https"),Ha(pe),qe?Wp(pe.toString(),J):mc(pe.toString(),J)}else Mi(2);I.G=0,I.l&&I.l.sa(W),$u(I),Hd(I)}n.fb=function(I){I?(this.j.info("Successfully pinged google.com"),Mi(2)):(this.j.info("Failed to ping google.com"),Mi(1))};function $u(I){if(I.G=0,I.ka=[],I.l){const W=Wd(I.h);(W.length!=0||I.i.length!=0)&&(H(I.ka,W),H(I.ka,I.i),I.h.i.length=0,B(I.i),I.i.length=0),I.l.ra()}}function xg(I,W,J){var pe=J instanceof Ga?Ps(J):new Ga(J);if(pe.g!="")W&&(pe.g=W+"."+pe.g),al(pe,pe.s);else{var qe=E.location;pe=qe.protocol,W=W?W+"."+qe.hostname:qe.hostname,qe=+qe.port;var at=new Ga(null);pe&&ju(at,pe),W&&(at.g=W),qe&&al(at,qe),J&&(at.l=J),pe=at}return J=I.D,W=I.ya,J&&W&&zr(pe,J,W),zr(pe,"VER",I.la),zu(I,pe),pe}function KE(I,W,J){if(W&&!I.J)throw Error("Can't create secondary domain capable XhrIo object.");return W=I.Ca&&!I.pa?new De(new cl({eb:J})):new De(I.pa),W.Ha(I.J),W}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function xn(){}n=xn.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function qp(){}qp.prototype.g=function(I,W){return new Vs(I,W)};function Vs(I,W){fn.call(this),this.g=new Wu(W),this.l=I,this.h=W&&W.messageUrlParams||null,I=W&&W.messageHeaders||null,W&&W.clientProtocolHeaderRequired&&(I?I["X-Client-Protocol"]="webchannel":I={"X-Client-Protocol":"webchannel"}),this.g.o=I,I=W&&W.initMessageHeaders||null,W&&W.messageContentType&&(I?I["X-WebChannel-Content-Type"]=W.messageContentType:I={"X-WebChannel-Content-Type":W.messageContentType}),W&&W.va&&(I?I["X-WebChannel-Client-Profile"]=W.va:I={"X-WebChannel-Client-Profile":W.va}),this.g.S=I,(I=W&&W.Sb)&&!K(I)&&(this.g.m=I),this.v=W&&W.supportsCrossDomainXhr||!1,this.u=W&&W.sendRawJson||!1,(W=W&&W.httpSessionIdParam)&&!K(W)&&(this.g.D=W,I=this.h,I!==null&&W in I&&(I=this.h,W in I&&delete I[W])),this.j=new _c(this)}j(Vs,fn),Vs.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Vs.prototype.close=function(){Yi(this.g)},Vs.prototype.o=function(I){var W=this.g;if(typeof I=="string"){var J={};J.__data__=I,I=J}else this.u&&(J={},J.__data__=ur(I),I=J);W.i.push(new Bd(W.Ya++,I)),W.G==3&&gc(W)},Vs.prototype.N=function(){this.g.l=null,delete this.j,Yi(this.g),delete this.g,Vs.aa.N.call(this)};function qE(I){lc.call(this),I.__headers__&&(this.headers=I.__headers__,this.statusCode=I.__status__,delete I.__headers__,delete I.__status__);var W=I.__sm__;if(W){e:{for(const J in W){I=J;break e}I=void 0}(this.i=I)&&(I=this.i,W=W!==null&&I in W?W[I]:void 0),this.data=W}else this.data=I}j(qE,lc);function YE(){oa.call(this),this.status=1}j(YE,oa);function _c(I){this.g=I}j(_c,xn),_c.prototype.ua=function(){an(this.g,"a")},_c.prototype.ta=function(I){an(this.g,new qE(I))},_c.prototype.sa=function(I){an(this.g,new YE)},_c.prototype.ra=function(){an(this.g,"b")},qp.prototype.createWebChannel=qp.prototype.g,Vs.prototype.send=Vs.prototype.o,Vs.prototype.open=Vs.prototype.m,Vs.prototype.close=Vs.prototype.close,kre=function(){return new qp},Ore=function(){return Lu()},Pre=uc,SV={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Mu.NO_ERROR=0,Mu.TIMEOUT=8,Mu.HTTP_ERROR=6,rk=Mu,cf.COMPLETE="complete",Are=cf,Ul.EventType=Fo,Fo.OPEN="a",Fo.CLOSE="b",Fo.ERROR="c",Fo.MESSAGE="d",fn.prototype.listen=fn.prototype.K,xw=Ul,De.prototype.listenOnce=De.prototype.L,De.prototype.getLastError=De.prototype.Ka,De.prototype.getLastErrorCode=De.prototype.Ba,De.prototype.getStatus=De.prototype.Z,De.prototype.getResponseJson=De.prototype.Oa,De.prototype.getResponseText=De.prototype.oa,De.prototype.send=De.prototype.ea,De.prototype.setWithCredentials=De.prototype.Ha,Ire=De}).apply(typeof vO<"u"?vO:typeof self<"u"?self:typeof window<"u"?window:{});const fX="@firebase/firestore",pX="4.7.9";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oa{constructor(t){this.uid=t}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}Oa.UNAUTHENTICATED=new Oa(null),Oa.GOOGLE_CREDENTIALS=new Oa("google-credentials-uid"),Oa.FIRST_PARTY=new Oa("first-party-uid"),Oa.MOCK_USER=new Oa("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let L0="11.4.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LE=new Cj("@firebase/firestore");function _S(){return LE.logLevel}function Zt(n,...t){if(LE.logLevel<=Sr.DEBUG){const i=t.map(Uj);LE.debug(`Firestore (${L0}): ${n}`,...i)}}function Np(n,...t){if(LE.logLevel<=Sr.ERROR){const i=t.map(Uj);LE.error(`Firestore (${L0}): ${n}`,...i)}}function f0(n,...t){if(LE.logLevel<=Sr.WARN){const i=t.map(Uj);LE.warn(`Firestore (${L0}): ${n}`,...i)}}function Uj(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(i){return JSON.stringify(i)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fn(n="Unexpected state"){const t=`FIRESTORE (${L0}) INTERNAL ASSERTION FAILED: `+n;throw Np(t),new Error(t)}function ii(n,t){n||Fn()}function qn(n,t){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _t={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Wt extends af{constructor(t,i){super(t,i),this.code=t,this.message=i,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rp{constructor(){this.promise=new Promise((t,i)=>{this.resolve=t,this.reject=i})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nre{constructor(t,i){this.user=i,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class LFe{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,i){t.enqueueRetryable(()=>i(Oa.UNAUTHENTICATED))}shutdown(){}}class xFe{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,i){this.changeListener=i,t.enqueueRetryable(()=>i(this.token.user))}shutdown(){this.changeListener=null}}class MFe{constructor(t){this.t=t,this.currentUser=Oa.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,i){ii(this.o===void 0);let a=this.i;const l=v=>this.i!==a?(a=this.i,i(v)):Promise.resolve();let d=new Rp;this.o=()=>{this.i++,this.currentUser=this.u(),d.resolve(),d=new Rp,t.enqueueRetryable(()=>l(this.currentUser))};const p=()=>{const v=d;t.enqueueRetryable(async()=>{await v.promise,await l(this.currentUser)})},E=v=>{Zt("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=v,this.o&&(this.auth.addAuthTokenListener(this.o),p())};this.t.onInit(v=>E(v)),setTimeout(()=>{if(!this.auth){const v=this.t.getImmediate({optional:!0});v?E(v):(Zt("FirebaseAuthCredentialsProvider","Auth not yet detected"),d.resolve(),d=new Rp)}},0),p()}getToken(){const t=this.i,i=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(i).then(a=>this.i!==t?(Zt("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):a?(ii(typeof a.accessToken=="string"),new Nre(a.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const t=this.auth&&this.auth.getUid();return ii(t===null||typeof t=="string"),new Oa(t)}}class UFe{constructor(t,i,a){this.l=t,this.h=i,this.P=a,this.type="FirstParty",this.user=Oa.FIRST_PARTY,this.T=new Map}I(){return this.P?this.P():null}get headers(){this.T.set("X-Goog-AuthUser",this.l);const t=this.I();return t&&this.T.set("Authorization",t),this.h&&this.T.set("X-Goog-Iam-Authorization-Token",this.h),this.T}}class VFe{constructor(t,i,a){this.l=t,this.h=i,this.P=a}getToken(){return Promise.resolve(new UFe(this.l,this.h,this.P))}start(t,i){t.enqueueRetryable(()=>i(Oa.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class mX{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class FFe{constructor(t,i){this.A=i,this.forceRefresh=!1,this.appCheck=null,this.R=null,this.V=null,Cl(t)&&t.settings.appCheckToken&&(this.V=t.settings.appCheckToken)}start(t,i){ii(this.o===void 0);const a=d=>{d.error!=null&&Zt("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${d.error.message}`);const p=d.token!==this.R;return this.R=d.token,Zt("FirebaseAppCheckTokenProvider",`Received ${p?"new":"existing"} token.`),p?i(d.token):Promise.resolve()};this.o=d=>{t.enqueueRetryable(()=>a(d))};const l=d=>{Zt("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=d,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(d=>l(d)),setTimeout(()=>{if(!this.appCheck){const d=this.A.getImmediate({optional:!0});d?l(d):Zt("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.V)return Promise.resolve(new mX(this.V));const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then(i=>i?(ii(typeof i.token=="string"),this.R=i.token,new mX(i.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jFe(n){const t=typeof self<"u"&&(self.crypto||self.msCrypto),i=new Uint8Array(n);if(t&&typeof t.getRandomValues=="function")t.getRandomValues(i);else for(let a=0;a<n;a++)i[a]=Math.floor(256*Math.random());return i}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dre{static newId(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=62*Math.floor(4.129032258064516);let a="";for(;a.length<20;){const l=jFe(40);for(let d=0;d<l.length;++d)a.length<20&&l[d]<i&&(a+=t.charAt(l[d]%62))}return a}}function Ar(n,t){return n<t?-1:n>t?1:0}function p0(n,t,i){return n.length===t.length&&n.every((a,l)=>i(a,t[l]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gX=-62135596800,_X=1e6;class as{static now(){return as.fromMillis(Date.now())}static fromDate(t){return as.fromMillis(t.getTime())}static fromMillis(t){const i=Math.floor(t/1e3),a=Math.floor((t-1e3*i)*_X);return new as(i,a)}constructor(t,i){if(this.seconds=t,this.nanoseconds=i,i<0)throw new Wt(_t.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+i);if(i>=1e9)throw new Wt(_t.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+i);if(t<gX)throw new Wt(_t.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new Wt(_t.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/_X}_compareTo(t){return this.seconds===t.seconds?Ar(this.nanoseconds,t.nanoseconds):Ar(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const t=this.seconds-gX;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gn{static fromTimestamp(t){return new Gn(t)}static min(){return new Gn(new as(0,0))}static max(){return new Gn(new as(253402300799,999999999))}constructor(t){this.timestamp=t}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const EX="__name__";class Dh{constructor(t,i,a){i===void 0?i=0:i>t.length&&Fn(),a===void 0?a=t.length-i:a>t.length-i&&Fn(),this.segments=t,this.offset=i,this.len=a}get length(){return this.len}isEqual(t){return Dh.comparator(this,t)===0}child(t){const i=this.segments.slice(this.offset,this.limit());return t instanceof Dh?t.forEach(a=>{i.push(a)}):i.push(t),this.construct(i)}limit(){return this.offset+this.length}popFirst(t){return t=t===void 0?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return this.length===0}isPrefixOf(t){if(t.length<this.length)return!1;for(let i=0;i<this.length;i++)if(this.get(i)!==t.get(i))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let i=0;i<this.length;i++)if(this.get(i)!==t.get(i))return!1;return!0}forEach(t){for(let i=this.offset,a=this.limit();i<a;i++)t(this.segments[i])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,i){const a=Math.min(t.length,i.length);for(let l=0;l<a;l++){const d=Dh.compareSegments(t.get(l),i.get(l));if(d!==0)return d}return Math.sign(t.length-i.length)}static compareSegments(t,i){const a=Dh.isNumericId(t),l=Dh.isNumericId(i);return a&&!l?-1:!a&&l?1:a&&l?Dh.extractNumericId(t).compare(Dh.extractNumericId(i)):t<i?-1:t>i?1:0}static isNumericId(t){return t.startsWith("__id")&&t.endsWith("__")}static extractNumericId(t){return dg.fromString(t.substring(4,t.length-2))}}class Di extends Dh{construct(t,i,a){return new Di(t,i,a)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){const i=[];for(const a of t){if(a.indexOf("//")>=0)throw new Wt(_t.INVALID_ARGUMENT,`Invalid segment (${a}). Paths must not contain // in them.`);i.push(...a.split("/").filter(l=>l.length>0))}return new Di(i)}static emptyPath(){return new Di([])}}const BFe=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class na extends Dh{construct(t,i,a){return new na(t,i,a)}static isValidIdentifier(t){return BFe.test(t)}canonicalString(){return this.toArray().map(t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),na.isValidIdentifier(t)||(t="`"+t+"`"),t)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===EX}static keyField(){return new na([EX])}static fromServerFormat(t){const i=[];let a="",l=0;const d=()=>{if(a.length===0)throw new Wt(_t.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);i.push(a),a=""};let p=!1;for(;l<t.length;){const E=t[l];if(E==="\\"){if(l+1===t.length)throw new Wt(_t.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const v=t[l+1];if(v!=="\\"&&v!=="."&&v!=="`")throw new Wt(_t.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);a+=v,l+=2}else E==="`"?(p=!p,l++):E!=="."||p?(a+=E,l++):(d(),l++)}if(d(),p)throw new Wt(_t.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new na(i)}static emptyPath(){return new na([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class En{constructor(t){this.path=t}static fromPath(t){return new En(Di.fromString(t))}static fromName(t){return new En(Di.fromString(t).popFirst(5))}static empty(){return new En(Di.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return t!==null&&Di.comparator(this.path,t.path)===0}toString(){return this.path.toString()}static comparator(t,i){return Di.comparator(t.path,i.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new En(new Di(t.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AR=-1;function WFe(n,t){const i=n.toTimestamp().seconds,a=n.toTimestamp().nanoseconds+1,l=Gn.fromTimestamp(a===1e9?new as(i+1,0):new as(i,a));return new yg(l,En.empty(),t)}function zFe(n){return new yg(n.readTime,n.key,AR)}class yg{constructor(t,i,a){this.readTime=t,this.documentKey=i,this.largestBatchId=a}static min(){return new yg(Gn.min(),En.empty(),AR)}static max(){return new yg(Gn.max(),En.empty(),AR)}}function GFe(n,t){let i=n.readTime.compareTo(t.readTime);return i!==0?i:(i=En.comparator(n.documentKey,t.documentKey),i!==0?i:Ar(n.largestBatchId,t.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HFe="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class $Fe{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(t=>t())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function x0(n){if(n.code!==_t.FAILED_PRECONDITION||n.message!==HFe)throw n;Zt("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tt{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(i=>{this.isDone=!0,this.result=i,this.nextCallback&&this.nextCallback(i)},i=>{this.isDone=!0,this.error=i,this.catchCallback&&this.catchCallback(i)})}catch(t){return this.next(void 0,t)}next(t,i){return this.callbackAttached&&Fn(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(i,this.error):this.wrapSuccess(t,this.result):new Tt((a,l)=>{this.nextCallback=d=>{this.wrapSuccess(t,d).next(a,l)},this.catchCallback=d=>{this.wrapFailure(i,d).next(a,l)}})}toPromise(){return new Promise((t,i)=>{this.next(t,i)})}wrapUserFunction(t){try{const i=t();return i instanceof Tt?i:Tt.resolve(i)}catch(i){return Tt.reject(i)}}wrapSuccess(t,i){return t?this.wrapUserFunction(()=>t(i)):Tt.resolve(i)}wrapFailure(t,i){return t?this.wrapUserFunction(()=>t(i)):Tt.reject(i)}static resolve(t){return new Tt((i,a)=>{i(t)})}static reject(t){return new Tt((i,a)=>{a(t)})}static waitFor(t){return new Tt((i,a)=>{let l=0,d=0,p=!1;t.forEach(E=>{++l,E.next(()=>{++d,p&&d===l&&i()},v=>a(v))}),p=!0,d===l&&i()})}static or(t){let i=Tt.resolve(!1);for(const a of t)i=i.next(l=>l?Tt.resolve(l):a());return i}static forEach(t,i){const a=[];return t.forEach((l,d)=>{a.push(i.call(this,l,d))}),this.waitFor(a)}static mapArray(t,i){return new Tt((a,l)=>{const d=t.length,p=new Array(d);let E=0;for(let v=0;v<d;v++){const b=v;i(t[b]).next(w=>{p[b]=w,++E,E===d&&a(p)},w=>l(w))}})}static doWhile(t,i){return new Tt((a,l)=>{const d=()=>{t()===!0?i().next(()=>{d()},l):a()};d()})}}function KFe(n){const t=n.match(/Android ([\d.]+)/i),i=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(i)}function M0(n){return n.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jN{constructor(t,i){this.previousValue=t,i&&(i.sequenceNumberHandler=a=>this.oe(a),this._e=a=>i.writeSequenceNumber(a))}oe(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this._e&&this._e(t),t}}jN.ae=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vj=-1;function BN(n){return n==null}function Fk(n){return n===0&&1/n==-1/0}function qFe(n){return typeof n=="number"&&Number.isInteger(n)&&!Fk(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lre="";function YFe(n){let t="";for(let i=0;i<n.length;i++)t.length>0&&(t=yX(t)),t=XFe(n.get(i),t);return yX(t)}function XFe(n,t){let i=t;const a=n.length;for(let l=0;l<a;l++){const d=n.charAt(l);switch(d){case"\0":i+="";break;case Lre:i+="";break;default:i+=d}}return i}function yX(n){return n+Lre+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vX(n){let t=0;for(const i in n)Object.prototype.hasOwnProperty.call(n,i)&&t++;return t}function Pg(n,t){for(const i in n)Object.prototype.hasOwnProperty.call(n,i)&&t(i,n[i])}function xre(n){for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lo{constructor(t,i){this.comparator=t,this.root=i||Zs.EMPTY}insert(t,i){return new lo(this.comparator,this.root.insert(t,i,this.comparator).copy(null,null,Zs.BLACK,null,null))}remove(t){return new lo(this.comparator,this.root.remove(t,this.comparator).copy(null,null,Zs.BLACK,null,null))}get(t){let i=this.root;for(;!i.isEmpty();){const a=this.comparator(t,i.key);if(a===0)return i.value;a<0?i=i.left:a>0&&(i=i.right)}return null}indexOf(t){let i=0,a=this.root;for(;!a.isEmpty();){const l=this.comparator(t,a.key);if(l===0)return i+a.left.size;l<0?a=a.left:(i+=a.left.size+1,a=a.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal((i,a)=>(t(i,a),!1))}toString(){const t=[];return this.inorderTraversal((i,a)=>(t.push(`${i}:${a}`),!1)),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new SO(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new SO(this.root,t,this.comparator,!1)}getReverseIterator(){return new SO(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new SO(this.root,t,this.comparator,!0)}}class SO{constructor(t,i,a,l){this.isReverse=l,this.nodeStack=[];let d=1;for(;!t.isEmpty();)if(d=i?a(t.key,i):1,i&&l&&(d*=-1),d<0)t=this.isReverse?t.left:t.right;else{if(d===0){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const i={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return i}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class Zs{constructor(t,i,a,l,d){this.key=t,this.value=i,this.color=a??Zs.RED,this.left=l??Zs.EMPTY,this.right=d??Zs.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,i,a,l,d){return new Zs(t??this.key,i??this.value,a??this.color,l??this.left,d??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,i,a){let l=this;const d=a(t,l.key);return l=d<0?l.copy(null,null,null,l.left.insert(t,i,a),null):d===0?l.copy(null,i,null,null,null):l.copy(null,null,null,null,l.right.insert(t,i,a)),l.fixUp()}removeMin(){if(this.left.isEmpty())return Zs.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,i){let a,l=this;if(i(t,l.key)<0)l.left.isEmpty()||l.left.isRed()||l.left.left.isRed()||(l=l.moveRedLeft()),l=l.copy(null,null,null,l.left.remove(t,i),null);else{if(l.left.isRed()&&(l=l.rotateRight()),l.right.isEmpty()||l.right.isRed()||l.right.left.isRed()||(l=l.moveRedRight()),i(t,l.key)===0){if(l.right.isEmpty())return Zs.EMPTY;a=l.right.min(),l=l.copy(a.key,a.value,null,null,l.right.removeMin())}l=l.copy(null,null,null,null,l.right.remove(t,i))}return l.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,Zs.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,Zs.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),i=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,i)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw Fn();const t=this.left.check();if(t!==this.right.check())throw Fn();return t+(this.isRed()?0:1)}}Zs.EMPTY=null,Zs.RED=!0,Zs.BLACK=!1;Zs.EMPTY=new class{constructor(){this.size=0}get key(){throw Fn()}get value(){throw Fn()}get color(){throw Fn()}get left(){throw Fn()}get right(){throw Fn()}copy(t,i,a,l,d){return this}insert(t,i,a){return new Zs(t,i)}remove(t,i){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cs{constructor(t){this.comparator=t,this.data=new lo(this.comparator)}has(t){return this.data.get(t)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal((i,a)=>(t(i),!1))}forEachInRange(t,i){const a=this.data.getIteratorFrom(t[0]);for(;a.hasNext();){const l=a.getNext();if(this.comparator(l.key,t[1])>=0)return;i(l.key)}}forEachWhile(t,i){let a;for(a=i!==void 0?this.data.getIteratorFrom(i):this.data.getIterator();a.hasNext();)if(!t(a.getNext().key))return}firstAfterOrEqual(t){const i=this.data.getIteratorFrom(t);return i.hasNext()?i.getNext().key:null}getIterator(){return new SX(this.data.getIterator())}getIteratorFrom(t){return new SX(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let i=this;return i.size<t.size&&(i=t,t=this),t.forEach(a=>{i=i.add(a)}),i}isEqual(t){if(!(t instanceof cs)||this.size!==t.size)return!1;const i=this.data.getIterator(),a=t.data.getIterator();for(;i.hasNext();){const l=i.getNext().key,d=a.getNext().key;if(this.comparator(l,d)!==0)return!1}return!0}toArray(){const t=[];return this.forEach(i=>{t.push(i)}),t}toString(){const t=[];return this.forEach(i=>t.push(i)),"SortedSet("+t.toString()+")"}copy(t){const i=new cs(this.comparator);return i.data=t,i}}class SX{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Il{constructor(t){this.fields=t,t.sort(na.comparator)}static empty(){return new Il([])}unionWith(t){let i=new cs(na.comparator);for(const a of this.fields)i=i.add(a);for(const a of t)i=i.add(a);return new Il(i.toArray())}covers(t){for(const i of this.fields)if(i.isPrefixOf(t))return!0;return!1}isEqual(t){return p0(this.fields,t.fields,(i,a)=>i.isEqual(a))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mre extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ra{constructor(t){this.binaryString=t}static fromBase64String(t){const i=function(l){try{return atob(l)}catch(d){throw typeof DOMException<"u"&&d instanceof DOMException?new Mre("Invalid base64 string: "+d):d}}(t);return new ra(i)}static fromUint8Array(t){const i=function(l){let d="";for(let p=0;p<l.length;++p)d+=String.fromCharCode(l[p]);return d}(t);return new ra(i)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(i){return btoa(i)}(this.binaryString)}toUint8Array(){return function(i){const a=new Uint8Array(i.length);for(let l=0;l<i.length;l++)a[l]=i.charCodeAt(l);return a}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return Ar(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}ra.EMPTY_BYTE_STRING=new ra("");const JFe=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function vg(n){if(ii(!!n),typeof n=="string"){let t=0;const i=JFe.exec(n);if(ii(!!i),i[1]){let l=i[1];l=(l+"000000000").substr(0,9),t=Number(l)}const a=new Date(n);return{seconds:Math.floor(a.getTime()/1e3),nanos:t}}return{seconds:Mo(n.seconds),nanos:Mo(n.nanos)}}function Mo(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Sg(n){return typeof n=="string"?ra.fromBase64String(n):ra.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ure="server_timestamp",Vre="__type__",Fre="__previous_value__",jre="__local_write_time__";function WN(n){var t,i;return((i=(((t=n==null?void 0:n.mapValue)===null||t===void 0?void 0:t.fields)||{})[Vre])===null||i===void 0?void 0:i.stringValue)===Ure}function zN(n){const t=n.mapValue.fields[Fre];return WN(t)?zN(t):t}function PR(n){const t=vg(n.mapValue.fields[jre].timestampValue);return new as(t.seconds,t.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QFe{constructor(t,i,a,l,d,p,E,v,b){this.databaseId=t,this.appId=i,this.persistenceKey=a,this.host=l,this.ssl=d,this.forceLongPolling=p,this.autoDetectLongPolling=E,this.longPollingOptions=v,this.useFetchStreams=b}}const jk="(default)";class OR{constructor(t,i){this.projectId=t,this.database=i||jk}static empty(){return new OR("","")}get isDefaultDatabase(){return this.database===jk}isEqual(t){return t instanceof OR&&t.projectId===this.projectId&&t.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bre="__type__",ZFe="__max__",bO={mapValue:{}},Wre="__vector__",Bk="value";function bg(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?WN(n)?4:tje(n)?9007199254740991:eje(n)?10:11:Fn()}function nf(n,t){if(n===t)return!0;const i=bg(n);if(i!==bg(t))return!1;switch(i){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===t.booleanValue;case 4:return PR(n).isEqual(PR(t));case 3:return function(l,d){if(typeof l.timestampValue=="string"&&typeof d.timestampValue=="string"&&l.timestampValue.length===d.timestampValue.length)return l.timestampValue===d.timestampValue;const p=vg(l.timestampValue),E=vg(d.timestampValue);return p.seconds===E.seconds&&p.nanos===E.nanos}(n,t);case 5:return n.stringValue===t.stringValue;case 6:return function(l,d){return Sg(l.bytesValue).isEqual(Sg(d.bytesValue))}(n,t);case 7:return n.referenceValue===t.referenceValue;case 8:return function(l,d){return Mo(l.geoPointValue.latitude)===Mo(d.geoPointValue.latitude)&&Mo(l.geoPointValue.longitude)===Mo(d.geoPointValue.longitude)}(n,t);case 2:return function(l,d){if("integerValue"in l&&"integerValue"in d)return Mo(l.integerValue)===Mo(d.integerValue);if("doubleValue"in l&&"doubleValue"in d){const p=Mo(l.doubleValue),E=Mo(d.doubleValue);return p===E?Fk(p)===Fk(E):isNaN(p)&&isNaN(E)}return!1}(n,t);case 9:return p0(n.arrayValue.values||[],t.arrayValue.values||[],nf);case 10:case 11:return function(l,d){const p=l.mapValue.fields||{},E=d.mapValue.fields||{};if(vX(p)!==vX(E))return!1;for(const v in p)if(p.hasOwnProperty(v)&&(E[v]===void 0||!nf(p[v],E[v])))return!1;return!0}(n,t);default:return Fn()}}function kR(n,t){return(n.values||[]).find(i=>nf(i,t))!==void 0}function m0(n,t){if(n===t)return 0;const i=bg(n),a=bg(t);if(i!==a)return Ar(i,a);switch(i){case 0:case 9007199254740991:return 0;case 1:return Ar(n.booleanValue,t.booleanValue);case 2:return function(d,p){const E=Mo(d.integerValue||d.doubleValue),v=Mo(p.integerValue||p.doubleValue);return E<v?-1:E>v?1:E===v?0:isNaN(E)?isNaN(v)?0:-1:1}(n,t);case 3:return bX(n.timestampValue,t.timestampValue);case 4:return bX(PR(n),PR(t));case 5:return Ar(n.stringValue,t.stringValue);case 6:return function(d,p){const E=Sg(d),v=Sg(p);return E.compareTo(v)}(n.bytesValue,t.bytesValue);case 7:return function(d,p){const E=d.split("/"),v=p.split("/");for(let b=0;b<E.length&&b<v.length;b++){const w=Ar(E[b],v[b]);if(w!==0)return w}return Ar(E.length,v.length)}(n.referenceValue,t.referenceValue);case 8:return function(d,p){const E=Ar(Mo(d.latitude),Mo(p.latitude));return E!==0?E:Ar(Mo(d.longitude),Mo(p.longitude))}(n.geoPointValue,t.geoPointValue);case 9:return TX(n.arrayValue,t.arrayValue);case 10:return function(d,p){var E,v,b,w;const A=d.fields||{},N=p.fields||{},F=(E=A[Bk])===null||E===void 0?void 0:E.arrayValue,j=(v=N[Bk])===null||v===void 0?void 0:v.arrayValue,B=Ar(((b=F==null?void 0:F.values)===null||b===void 0?void 0:b.length)||0,((w=j==null?void 0:j.values)===null||w===void 0?void 0:w.length)||0);return B!==0?B:TX(F,j)}(n.mapValue,t.mapValue);case 11:return function(d,p){if(d===bO.mapValue&&p===bO.mapValue)return 0;if(d===bO.mapValue)return 1;if(p===bO.mapValue)return-1;const E=d.fields||{},v=Object.keys(E),b=p.fields||{},w=Object.keys(b);v.sort(),w.sort();for(let A=0;A<v.length&&A<w.length;++A){const N=Ar(v[A],w[A]);if(N!==0)return N;const F=m0(E[v[A]],b[w[A]]);if(F!==0)return F}return Ar(v.length,w.length)}(n.mapValue,t.mapValue);default:throw Fn()}}function bX(n,t){if(typeof n=="string"&&typeof t=="string"&&n.length===t.length)return Ar(n,t);const i=vg(n),a=vg(t),l=Ar(i.seconds,a.seconds);return l!==0?l:Ar(i.nanos,a.nanos)}function TX(n,t){const i=n.values||[],a=t.values||[];for(let l=0;l<i.length&&l<a.length;++l){const d=m0(i[l],a[l]);if(d)return d}return Ar(i.length,a.length)}function g0(n){return bV(n)}function bV(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(i){const a=vg(i);return`time(${a.seconds},${a.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(i){return Sg(i).toBase64()}(n.bytesValue):"referenceValue"in n?function(i){return En.fromName(i).toString()}(n.referenceValue):"geoPointValue"in n?function(i){return`geo(${i.latitude},${i.longitude})`}(n.geoPointValue):"arrayValue"in n?function(i){let a="[",l=!0;for(const d of i.values||[])l?l=!1:a+=",",a+=bV(d);return a+"]"}(n.arrayValue):"mapValue"in n?function(i){const a=Object.keys(i.fields||{}).sort();let l="{",d=!0;for(const p of a)d?d=!1:l+=",",l+=`${p}:${bV(i.fields[p])}`;return l+"}"}(n.mapValue):Fn()}function ik(n){switch(bg(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const t=zN(n);return t?16+ik(t):16;case 5:return 2*n.stringValue.length;case 6:return Sg(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(a){return(a.values||[]).reduce((l,d)=>l+ik(d),0)}(n.arrayValue);case 10:case 11:return function(a){let l=0;return Pg(a.fields,(d,p)=>{l+=d.length+ik(p)}),l}(n.mapValue);default:throw Fn()}}function Wk(n,t){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${t.path.canonicalString()}`}}function TV(n){return!!n&&"integerValue"in n}function Fj(n){return!!n&&"arrayValue"in n}function wX(n){return!!n&&"nullValue"in n}function RX(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function ok(n){return!!n&&"mapValue"in n}function eje(n){var t,i;return((i=(((t=n==null?void 0:n.mapValue)===null||t===void 0?void 0:t.fields)||{})[Bre])===null||i===void 0?void 0:i.stringValue)===Wre}function eR(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const t={mapValue:{fields:{}}};return Pg(n.mapValue.fields,(i,a)=>t.mapValue.fields[i]=eR(a)),t}if(n.arrayValue){const t={arrayValue:{values:[]}};for(let i=0;i<(n.arrayValue.values||[]).length;++i)t.arrayValue.values[i]=eR(n.arrayValue.values[i]);return t}return Object.assign({},n)}function tje(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===ZFe}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qc{constructor(t){this.value=t}static empty(){return new qc({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let i=this.value;for(let a=0;a<t.length-1;++a)if(i=(i.mapValue.fields||{})[t.get(a)],!ok(i))return null;return i=(i.mapValue.fields||{})[t.lastSegment()],i||null}}set(t,i){this.getFieldsMap(t.popLast())[t.lastSegment()]=eR(i)}setAll(t){let i=na.emptyPath(),a={},l=[];t.forEach((p,E)=>{if(!i.isImmediateParentOf(E)){const v=this.getFieldsMap(i);this.applyChanges(v,a,l),a={},l=[],i=E.popLast()}p?a[E.lastSegment()]=eR(p):l.push(E.lastSegment())});const d=this.getFieldsMap(i);this.applyChanges(d,a,l)}delete(t){const i=this.field(t.popLast());ok(i)&&i.mapValue.fields&&delete i.mapValue.fields[t.lastSegment()]}isEqual(t){return nf(this.value,t.value)}getFieldsMap(t){let i=this.value;i.mapValue.fields||(i.mapValue={fields:{}});for(let a=0;a<t.length;++a){let l=i.mapValue.fields[t.get(a)];ok(l)&&l.mapValue.fields||(l={mapValue:{fields:{}}},i.mapValue.fields[t.get(a)]=l),i=l}return i.mapValue.fields}applyChanges(t,i,a){Pg(i,(l,d)=>t[l]=d);for(const l of a)delete t[l]}clone(){return new qc(eR(this.value))}}function zre(n){const t=[];return Pg(n.fields,(i,a)=>{const l=new na([i]);if(ok(a)){const d=zre(a.mapValue).fields;if(d.length===0)t.push(l);else for(const p of d)t.push(l.child(p))}else t.push(l)}),new Il(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Na{constructor(t,i,a,l,d,p,E){this.key=t,this.documentType=i,this.version=a,this.readTime=l,this.createTime=d,this.data=p,this.documentState=E}static newInvalidDocument(t){return new Na(t,0,Gn.min(),Gn.min(),Gn.min(),qc.empty(),0)}static newFoundDocument(t,i,a,l){return new Na(t,1,i,Gn.min(),a,l,0)}static newNoDocument(t,i){return new Na(t,2,i,Gn.min(),Gn.min(),qc.empty(),0)}static newUnknownDocument(t,i){return new Na(t,3,i,Gn.min(),Gn.min(),qc.empty(),2)}convertToFoundDocument(t,i){return!this.createTime.isEqual(Gn.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=t),this.version=t,this.documentType=1,this.data=i,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=qc.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=qc.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Gn.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(t){return t instanceof Na&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new Na(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _0{constructor(t,i){this.position=t,this.inclusive=i}}function CX(n,t,i){let a=0;for(let l=0;l<n.position.length;l++){const d=t[l],p=n.position[l];if(d.field.isKeyField()?a=En.comparator(En.fromName(p.referenceValue),i.key):a=m0(p,i.data.field(d.field)),d.dir==="desc"&&(a*=-1),a!==0)break}return a}function IX(n,t){if(n===null)return t===null;if(t===null||n.inclusive!==t.inclusive||n.position.length!==t.position.length)return!1;for(let i=0;i<n.position.length;i++)if(!nf(n.position[i],t.position[i]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NR{constructor(t,i="asc"){this.field=t,this.dir=i}}function nje(n,t){return n.dir===t.dir&&n.field.isEqual(t.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gre{}class qo extends Gre{constructor(t,i,a){super(),this.field=t,this.op=i,this.value=a}static create(t,i,a){return t.isKeyField()?i==="in"||i==="not-in"?this.createKeyFieldInFilter(t,i,a):new ije(t,i,a):i==="array-contains"?new aje(t,a):i==="in"?new cje(t,a):i==="not-in"?new lje(t,a):i==="array-contains-any"?new uje(t,a):new qo(t,i,a)}static createKeyFieldInFilter(t,i,a){return i==="in"?new oje(t,a):new sje(t,a)}matches(t){const i=t.data.field(this.field);return this.op==="!="?i!==null&&this.matchesComparison(m0(i,this.value)):i!==null&&bg(this.value)===bg(i)&&this.matchesComparison(m0(i,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return t===0;case"!=":return t!==0;case">":return t>0;case">=":return t>=0;default:return Fn()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Nd extends Gre{constructor(t,i){super(),this.filters=t,this.op=i,this.ce=null}static create(t,i){return new Nd(t,i)}matches(t){return Hre(this)?this.filters.find(i=>!i.matches(t))===void 0:this.filters.find(i=>i.matches(t))!==void 0}getFlattenedFilters(){return this.ce!==null||(this.ce=this.filters.reduce((t,i)=>t.concat(i.getFlattenedFilters()),[])),this.ce}getFilters(){return Object.assign([],this.filters)}}function Hre(n){return n.op==="and"}function $re(n){return rje(n)&&Hre(n)}function rje(n){for(const t of n.filters)if(t instanceof Nd)return!1;return!0}function wV(n){if(n instanceof qo)return n.field.canonicalString()+n.op.toString()+g0(n.value);if($re(n))return n.filters.map(t=>wV(t)).join(",");{const t=n.filters.map(i=>wV(i)).join(",");return`${n.op}(${t})`}}function Kre(n,t){return n instanceof qo?function(a,l){return l instanceof qo&&a.op===l.op&&a.field.isEqual(l.field)&&nf(a.value,l.value)}(n,t):n instanceof Nd?function(a,l){return l instanceof Nd&&a.op===l.op&&a.filters.length===l.filters.length?a.filters.reduce((d,p,E)=>d&&Kre(p,l.filters[E]),!0):!1}(n,t):void Fn()}function qre(n){return n instanceof qo?function(i){return`${i.field.canonicalString()} ${i.op} ${g0(i.value)}`}(n):n instanceof Nd?function(i){return i.op.toString()+" {"+i.getFilters().map(qre).join(" ,")+"}"}(n):"Filter"}class ije extends qo{constructor(t,i,a){super(t,i,a),this.key=En.fromName(a.referenceValue)}matches(t){const i=En.comparator(t.key,this.key);return this.matchesComparison(i)}}class oje extends qo{constructor(t,i){super(t,"in",i),this.keys=Yre("in",i)}matches(t){return this.keys.some(i=>i.isEqual(t.key))}}class sje extends qo{constructor(t,i){super(t,"not-in",i),this.keys=Yre("not-in",i)}matches(t){return!this.keys.some(i=>i.isEqual(t.key))}}function Yre(n,t){var i;return(((i=t.arrayValue)===null||i===void 0?void 0:i.values)||[]).map(a=>En.fromName(a.referenceValue))}class aje extends qo{constructor(t,i){super(t,"array-contains",i)}matches(t){const i=t.data.field(this.field);return Fj(i)&&kR(i.arrayValue,this.value)}}class cje extends qo{constructor(t,i){super(t,"in",i)}matches(t){const i=t.data.field(this.field);return i!==null&&kR(this.value.arrayValue,i)}}class lje extends qo{constructor(t,i){super(t,"not-in",i)}matches(t){if(kR(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const i=t.data.field(this.field);return i!==null&&!kR(this.value.arrayValue,i)}}class uje extends qo{constructor(t,i){super(t,"array-contains-any",i)}matches(t){const i=t.data.field(this.field);return!(!Fj(i)||!i.arrayValue.values)&&i.arrayValue.values.some(a=>kR(this.value.arrayValue,a))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dje{constructor(t,i=null,a=[],l=[],d=null,p=null,E=null){this.path=t,this.collectionGroup=i,this.orderBy=a,this.filters=l,this.limit=d,this.startAt=p,this.endAt=E,this.le=null}}function AX(n,t=null,i=[],a=[],l=null,d=null,p=null){return new dje(n,t,i,a,l,d,p)}function jj(n){const t=qn(n);if(t.le===null){let i=t.path.canonicalString();t.collectionGroup!==null&&(i+="|cg:"+t.collectionGroup),i+="|f:",i+=t.filters.map(a=>wV(a)).join(","),i+="|ob:",i+=t.orderBy.map(a=>function(d){return d.field.canonicalString()+d.dir}(a)).join(","),BN(t.limit)||(i+="|l:",i+=t.limit),t.startAt&&(i+="|lb:",i+=t.startAt.inclusive?"b:":"a:",i+=t.startAt.position.map(a=>g0(a)).join(",")),t.endAt&&(i+="|ub:",i+=t.endAt.inclusive?"a:":"b:",i+=t.endAt.position.map(a=>g0(a)).join(",")),t.le=i}return t.le}function Bj(n,t){if(n.limit!==t.limit||n.orderBy.length!==t.orderBy.length)return!1;for(let i=0;i<n.orderBy.length;i++)if(!nje(n.orderBy[i],t.orderBy[i]))return!1;if(n.filters.length!==t.filters.length)return!1;for(let i=0;i<n.filters.length;i++)if(!Kre(n.filters[i],t.filters[i]))return!1;return n.collectionGroup===t.collectionGroup&&!!n.path.isEqual(t.path)&&!!IX(n.startAt,t.startAt)&&IX(n.endAt,t.endAt)}function RV(n){return En.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BE{constructor(t,i=null,a=[],l=[],d=null,p="F",E=null,v=null){this.path=t,this.collectionGroup=i,this.explicitOrderBy=a,this.filters=l,this.limit=d,this.limitType=p,this.startAt=E,this.endAt=v,this.he=null,this.Pe=null,this.Te=null,this.startAt,this.endAt}}function hje(n,t,i,a,l,d,p,E){return new BE(n,t,i,a,l,d,p,E)}function GN(n){return new BE(n)}function PX(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Wj(n){return n.collectionGroup!==null}function YS(n){const t=qn(n);if(t.he===null){t.he=[];const i=new Set;for(const d of t.explicitOrderBy)t.he.push(d),i.add(d.field.canonicalString());const a=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(p){let E=new cs(na.comparator);return p.filters.forEach(v=>{v.getFlattenedFilters().forEach(b=>{b.isInequality()&&(E=E.add(b.field))})}),E})(t).forEach(d=>{i.has(d.canonicalString())||d.isKeyField()||t.he.push(new NR(d,a))}),i.has(na.keyField().canonicalString())||t.he.push(new NR(na.keyField(),a))}return t.he}function Qh(n){const t=qn(n);return t.Pe||(t.Pe=fje(t,YS(n))),t.Pe}function fje(n,t){if(n.limitType==="F")return AX(n.path,n.collectionGroup,t,n.filters,n.limit,n.startAt,n.endAt);{t=t.map(l=>{const d=l.dir==="desc"?"asc":"desc";return new NR(l.field,d)});const i=n.endAt?new _0(n.endAt.position,n.endAt.inclusive):null,a=n.startAt?new _0(n.startAt.position,n.startAt.inclusive):null;return AX(n.path,n.collectionGroup,t,n.filters,n.limit,i,a)}}function CV(n,t){const i=n.filters.concat([t]);return new BE(n.path,n.collectionGroup,n.explicitOrderBy.slice(),i,n.limit,n.limitType,n.startAt,n.endAt)}function IV(n,t,i){return new BE(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),t,i,n.startAt,n.endAt)}function HN(n,t){return Bj(Qh(n),Qh(t))&&n.limitType===t.limitType}function Xre(n){return`${jj(Qh(n))}|lt:${n.limitType}`}function ES(n){return`Query(target=${function(i){let a=i.path.canonicalString();return i.collectionGroup!==null&&(a+=" collectionGroup="+i.collectionGroup),i.filters.length>0&&(a+=`, filters: [${i.filters.map(l=>qre(l)).join(", ")}]`),BN(i.limit)||(a+=", limit: "+i.limit),i.orderBy.length>0&&(a+=`, orderBy: [${i.orderBy.map(l=>function(p){return`${p.field.canonicalString()} (${p.dir})`}(l)).join(", ")}]`),i.startAt&&(a+=", startAt: ",a+=i.startAt.inclusive?"b:":"a:",a+=i.startAt.position.map(l=>g0(l)).join(",")),i.endAt&&(a+=", endAt: ",a+=i.endAt.inclusive?"a:":"b:",a+=i.endAt.position.map(l=>g0(l)).join(",")),`Target(${a})`}(Qh(n))}; limitType=${n.limitType})`}function $N(n,t){return t.isFoundDocument()&&function(a,l){const d=l.key.path;return a.collectionGroup!==null?l.key.hasCollectionId(a.collectionGroup)&&a.path.isPrefixOf(d):En.isDocumentKey(a.path)?a.path.isEqual(d):a.path.isImmediateParentOf(d)}(n,t)&&function(a,l){for(const d of YS(a))if(!d.field.isKeyField()&&l.data.field(d.field)===null)return!1;return!0}(n,t)&&function(a,l){for(const d of a.filters)if(!d.matches(l))return!1;return!0}(n,t)&&function(a,l){return!(a.startAt&&!function(p,E,v){const b=CX(p,E,v);return p.inclusive?b<=0:b<0}(a.startAt,YS(a),l)||a.endAt&&!function(p,E,v){const b=CX(p,E,v);return p.inclusive?b>=0:b>0}(a.endAt,YS(a),l))}(n,t)}function pje(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function Jre(n){return(t,i)=>{let a=!1;for(const l of YS(n)){const d=mje(l,t,i);if(d!==0)return d;a=a||l.field.isKeyField()}return 0}}function mje(n,t,i){const a=n.field.isKeyField()?En.comparator(t.key,i.key):function(d,p,E){const v=p.data.field(d),b=E.data.field(d);return v!==null&&b!==null?m0(v,b):Fn()}(n.field,t,i);switch(n.dir){case"asc":return a;case"desc":return-1*a;default:return Fn()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WE{constructor(t,i){this.mapKeyFn=t,this.equalsFn=i,this.inner={},this.innerSize=0}get(t){const i=this.mapKeyFn(t),a=this.inner[i];if(a!==void 0){for(const[l,d]of a)if(this.equalsFn(l,t))return d}}has(t){return this.get(t)!==void 0}set(t,i){const a=this.mapKeyFn(t),l=this.inner[a];if(l===void 0)return this.inner[a]=[[t,i]],void this.innerSize++;for(let d=0;d<l.length;d++)if(this.equalsFn(l[d][0],t))return void(l[d]=[t,i]);l.push([t,i]),this.innerSize++}delete(t){const i=this.mapKeyFn(t),a=this.inner[i];if(a===void 0)return!1;for(let l=0;l<a.length;l++)if(this.equalsFn(a[l][0],t))return a.length===1?delete this.inner[i]:a.splice(l,1),this.innerSize--,!0;return!1}forEach(t){Pg(this.inner,(i,a)=>{for(const[l,d]of a)t(l,d)})}isEmpty(){return xre(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gje=new lo(En.comparator);function Dp(){return gje}const Qre=new lo(En.comparator);function Mw(...n){let t=Qre;for(const i of n)t=t.insert(i.key,i);return t}function Zre(n){let t=Qre;return n.forEach((i,a)=>t=t.insert(i,a.overlayedDocument)),t}function hE(){return tR()}function eie(){return tR()}function tR(){return new WE(n=>n.toString(),(n,t)=>n.isEqual(t))}const _je=new lo(En.comparator),Eje=new cs(En.comparator);function br(...n){let t=Eje;for(const i of n)t=t.add(i);return t}const yje=new cs(Ar);function vje(){return yje}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zj(n,t){if(n.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Fk(t)?"-0":t}}function tie(n){return{integerValue:""+n}}function Sje(n,t){return qFe(t)?tie(t):zj(n,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KN{constructor(){this._=void 0}}function bje(n,t,i){return n instanceof zk?function(l,d){const p={fields:{[Vre]:{stringValue:Ure},[jre]:{timestampValue:{seconds:l.seconds,nanos:l.nanoseconds}}}};return d&&WN(d)&&(d=zN(d)),d&&(p.fields[Fre]=d),{mapValue:p}}(i,t):n instanceof DR?rie(n,t):n instanceof LR?iie(n,t):function(l,d){const p=nie(l,d),E=OX(p)+OX(l.Ie);return TV(p)&&TV(l.Ie)?tie(E):zj(l.serializer,E)}(n,t)}function Tje(n,t,i){return n instanceof DR?rie(n,t):n instanceof LR?iie(n,t):i}function nie(n,t){return n instanceof Gk?function(a){return TV(a)||function(d){return!!d&&"doubleValue"in d}(a)}(t)?t:{integerValue:0}:null}class zk extends KN{}class DR extends KN{constructor(t){super(),this.elements=t}}function rie(n,t){const i=oie(t);for(const a of n.elements)i.some(l=>nf(l,a))||i.push(a);return{arrayValue:{values:i}}}class LR extends KN{constructor(t){super(),this.elements=t}}function iie(n,t){let i=oie(t);for(const a of n.elements)i=i.filter(l=>!nf(l,a));return{arrayValue:{values:i}}}class Gk extends KN{constructor(t,i){super(),this.serializer=t,this.Ie=i}}function OX(n){return Mo(n.integerValue||n.doubleValue)}function oie(n){return Fj(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}function wje(n,t){return n.field.isEqual(t.field)&&function(a,l){return a instanceof DR&&l instanceof DR||a instanceof LR&&l instanceof LR?p0(a.elements,l.elements,nf):a instanceof Gk&&l instanceof Gk?nf(a.Ie,l.Ie):a instanceof zk&&l instanceof zk}(n.transform,t.transform)}class Rje{constructor(t,i){this.version=t,this.transformResults=i}}class Zh{constructor(t,i){this.updateTime=t,this.exists=i}static none(){return new Zh}static exists(t){return new Zh(void 0,t)}static updateTime(t){return new Zh(t)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function sk(n,t){return n.updateTime!==void 0?t.isFoundDocument()&&t.version.isEqual(n.updateTime):n.exists===void 0||n.exists===t.isFoundDocument()}class qN{}function sie(n,t){if(!n.hasLocalMutations||t&&t.fields.length===0)return null;if(t===null)return n.isNoDocument()?new cie(n.key,Zh.none()):new aC(n.key,n.data,Zh.none());{const i=n.data,a=qc.empty();let l=new cs(na.comparator);for(let d of t.fields)if(!l.has(d)){let p=i.field(d);p===null&&d.length>1&&(d=d.popLast(),p=i.field(d)),p===null?a.delete(d):a.set(d,p),l=l.add(d)}return new Og(n.key,a,new Il(l.toArray()),Zh.none())}}function Cje(n,t,i){n instanceof aC?function(l,d,p){const E=l.value.clone(),v=NX(l.fieldTransforms,d,p.transformResults);E.setAll(v),d.convertToFoundDocument(p.version,E).setHasCommittedMutations()}(n,t,i):n instanceof Og?function(l,d,p){if(!sk(l.precondition,d))return void d.convertToUnknownDocument(p.version);const E=NX(l.fieldTransforms,d,p.transformResults),v=d.data;v.setAll(aie(l)),v.setAll(E),d.convertToFoundDocument(p.version,v).setHasCommittedMutations()}(n,t,i):function(l,d,p){d.convertToNoDocument(p.version).setHasCommittedMutations()}(0,t,i)}function nR(n,t,i,a){return n instanceof aC?function(d,p,E,v){if(!sk(d.precondition,p))return E;const b=d.value.clone(),w=DX(d.fieldTransforms,v,p);return b.setAll(w),p.convertToFoundDocument(p.version,b).setHasLocalMutations(),null}(n,t,i,a):n instanceof Og?function(d,p,E,v){if(!sk(d.precondition,p))return E;const b=DX(d.fieldTransforms,v,p),w=p.data;return w.setAll(aie(d)),w.setAll(b),p.convertToFoundDocument(p.version,w).setHasLocalMutations(),E===null?null:E.unionWith(d.fieldMask.fields).unionWith(d.fieldTransforms.map(A=>A.field))}(n,t,i,a):function(d,p,E){return sk(d.precondition,p)?(p.convertToNoDocument(p.version).setHasLocalMutations(),null):E}(n,t,i)}function Ije(n,t){let i=null;for(const a of n.fieldTransforms){const l=t.data.field(a.field),d=nie(a.transform,l||null);d!=null&&(i===null&&(i=qc.empty()),i.set(a.field,d))}return i||null}function kX(n,t){return n.type===t.type&&!!n.key.isEqual(t.key)&&!!n.precondition.isEqual(t.precondition)&&!!function(a,l){return a===void 0&&l===void 0||!(!a||!l)&&p0(a,l,(d,p)=>wje(d,p))}(n.fieldTransforms,t.fieldTransforms)&&(n.type===0?n.value.isEqual(t.value):n.type!==1||n.data.isEqual(t.data)&&n.fieldMask.isEqual(t.fieldMask))}class aC extends qN{constructor(t,i,a,l=[]){super(),this.key=t,this.value=i,this.precondition=a,this.fieldTransforms=l,this.type=0}getFieldMask(){return null}}class Og extends qN{constructor(t,i,a,l,d=[]){super(),this.key=t,this.data=i,this.fieldMask=a,this.precondition=l,this.fieldTransforms=d,this.type=1}getFieldMask(){return this.fieldMask}}function aie(n){const t=new Map;return n.fieldMask.fields.forEach(i=>{if(!i.isEmpty()){const a=n.data.field(i);t.set(i,a)}}),t}function NX(n,t,i){const a=new Map;ii(n.length===i.length);for(let l=0;l<i.length;l++){const d=n[l],p=d.transform,E=t.data.field(d.field);a.set(d.field,Tje(p,E,i[l]))}return a}function DX(n,t,i){const a=new Map;for(const l of n){const d=l.transform,p=i.data.field(l.field);a.set(l.field,bje(d,p,t))}return a}class cie extends qN{constructor(t,i){super(),this.key=t,this.precondition=i,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Aje extends qN{constructor(t,i){super(),this.key=t,this.precondition=i,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pje{constructor(t,i,a,l){this.batchId=t,this.localWriteTime=i,this.baseMutations=a,this.mutations=l}applyToRemoteDocument(t,i){const a=i.mutationResults;for(let l=0;l<this.mutations.length;l++){const d=this.mutations[l];d.key.isEqual(t.key)&&Cje(d,t,a[l])}}applyToLocalView(t,i){for(const a of this.baseMutations)a.key.isEqual(t.key)&&(i=nR(a,t,i,this.localWriteTime));for(const a of this.mutations)a.key.isEqual(t.key)&&(i=nR(a,t,i,this.localWriteTime));return i}applyToLocalDocumentSet(t,i){const a=eie();return this.mutations.forEach(l=>{const d=t.get(l.key),p=d.overlayedDocument;let E=this.applyToLocalView(p,d.mutatedFields);E=i.has(l.key)?null:E;const v=sie(p,E);v!==null&&a.set(l.key,v),p.isValidDocument()||p.convertToNoDocument(Gn.min())}),a}keys(){return this.mutations.reduce((t,i)=>t.add(i.key),br())}isEqual(t){return this.batchId===t.batchId&&p0(this.mutations,t.mutations,(i,a)=>kX(i,a))&&p0(this.baseMutations,t.baseMutations,(i,a)=>kX(i,a))}}class Gj{constructor(t,i,a,l){this.batch=t,this.commitVersion=i,this.mutationResults=a,this.docVersions=l}static from(t,i,a){ii(t.mutations.length===a.length);let l=function(){return _je}();const d=t.mutations;for(let p=0;p<d.length;p++)l=l.insert(d[p].key,a[p].version);return new Gj(t,i,a,l)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oje{constructor(t,i){this.largestBatchId=t,this.mutation=i}getKey(){return this.mutation.key}isEqual(t){return t!==null&&this.mutation===t.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kje{constructor(t,i){this.count=t,this.unchangedNames=i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Go,kr;function Nje(n){switch(n){case _t.OK:return Fn();case _t.CANCELLED:case _t.UNKNOWN:case _t.DEADLINE_EXCEEDED:case _t.RESOURCE_EXHAUSTED:case _t.INTERNAL:case _t.UNAVAILABLE:case _t.UNAUTHENTICATED:return!1;case _t.INVALID_ARGUMENT:case _t.NOT_FOUND:case _t.ALREADY_EXISTS:case _t.PERMISSION_DENIED:case _t.FAILED_PRECONDITION:case _t.ABORTED:case _t.OUT_OF_RANGE:case _t.UNIMPLEMENTED:case _t.DATA_LOSS:return!0;default:return Fn()}}function lie(n){if(n===void 0)return Np("GRPC error has no .code"),_t.UNKNOWN;switch(n){case Go.OK:return _t.OK;case Go.CANCELLED:return _t.CANCELLED;case Go.UNKNOWN:return _t.UNKNOWN;case Go.DEADLINE_EXCEEDED:return _t.DEADLINE_EXCEEDED;case Go.RESOURCE_EXHAUSTED:return _t.RESOURCE_EXHAUSTED;case Go.INTERNAL:return _t.INTERNAL;case Go.UNAVAILABLE:return _t.UNAVAILABLE;case Go.UNAUTHENTICATED:return _t.UNAUTHENTICATED;case Go.INVALID_ARGUMENT:return _t.INVALID_ARGUMENT;case Go.NOT_FOUND:return _t.NOT_FOUND;case Go.ALREADY_EXISTS:return _t.ALREADY_EXISTS;case Go.PERMISSION_DENIED:return _t.PERMISSION_DENIED;case Go.FAILED_PRECONDITION:return _t.FAILED_PRECONDITION;case Go.ABORTED:return _t.ABORTED;case Go.OUT_OF_RANGE:return _t.OUT_OF_RANGE;case Go.UNIMPLEMENTED:return _t.UNIMPLEMENTED;case Go.DATA_LOSS:return _t.DATA_LOSS;default:return Fn()}}(kr=Go||(Go={}))[kr.OK=0]="OK",kr[kr.CANCELLED=1]="CANCELLED",kr[kr.UNKNOWN=2]="UNKNOWN",kr[kr.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",kr[kr.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",kr[kr.NOT_FOUND=5]="NOT_FOUND",kr[kr.ALREADY_EXISTS=6]="ALREADY_EXISTS",kr[kr.PERMISSION_DENIED=7]="PERMISSION_DENIED",kr[kr.UNAUTHENTICATED=16]="UNAUTHENTICATED",kr[kr.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",kr[kr.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",kr[kr.ABORTED=10]="ABORTED",kr[kr.OUT_OF_RANGE=11]="OUT_OF_RANGE",kr[kr.UNIMPLEMENTED=12]="UNIMPLEMENTED",kr[kr.INTERNAL=13]="INTERNAL",kr[kr.UNAVAILABLE=14]="UNAVAILABLE",kr[kr.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dje(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lje=new dg([4294967295,4294967295],0);function LX(n){const t=Dje().encode(n),i=new Cre;return i.update(t),new Uint8Array(i.digest())}function xX(n){const t=new DataView(n.buffer),i=t.getUint32(0,!0),a=t.getUint32(4,!0),l=t.getUint32(8,!0),d=t.getUint32(12,!0);return[new dg([i,a],0),new dg([l,d],0)]}class Hj{constructor(t,i,a){if(this.bitmap=t,this.padding=i,this.hashCount=a,i<0||i>=8)throw new Uw(`Invalid padding: ${i}`);if(a<0)throw new Uw(`Invalid hash count: ${a}`);if(t.length>0&&this.hashCount===0)throw new Uw(`Invalid hash count: ${a}`);if(t.length===0&&i!==0)throw new Uw(`Invalid padding when bitmap length is 0: ${i}`);this.Ee=8*t.length-i,this.de=dg.fromNumber(this.Ee)}Ae(t,i,a){let l=t.add(i.multiply(dg.fromNumber(a)));return l.compare(Lje)===1&&(l=new dg([l.getBits(0),l.getBits(1)],0)),l.modulo(this.de).toNumber()}Re(t){return!!(this.bitmap[Math.floor(t/8)]&1<<t%8)}mightContain(t){if(this.Ee===0)return!1;const i=LX(t),[a,l]=xX(i);for(let d=0;d<this.hashCount;d++){const p=this.Ae(a,l,d);if(!this.Re(p))return!1}return!0}static create(t,i,a){const l=t%8==0?0:8-t%8,d=new Uint8Array(Math.ceil(t/8)),p=new Hj(d,l,i);return a.forEach(E=>p.insert(E)),p}insert(t){if(this.Ee===0)return;const i=LX(t),[a,l]=xX(i);for(let d=0;d<this.hashCount;d++){const p=this.Ae(a,l,d);this.Ve(p)}}Ve(t){const i=Math.floor(t/8),a=t%8;this.bitmap[i]|=1<<a}}class Uw extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YN{constructor(t,i,a,l,d){this.snapshotVersion=t,this.targetChanges=i,this.targetMismatches=a,this.documentUpdates=l,this.resolvedLimboDocuments=d}static createSynthesizedRemoteEventForCurrentChange(t,i,a){const l=new Map;return l.set(t,cC.createSynthesizedTargetChangeForCurrentChange(t,i,a)),new YN(Gn.min(),l,new lo(Ar),Dp(),br())}}class cC{constructor(t,i,a,l,d){this.resumeToken=t,this.current=i,this.addedDocuments=a,this.modifiedDocuments=l,this.removedDocuments=d}static createSynthesizedTargetChangeForCurrentChange(t,i,a){return new cC(a,i,br(),br(),br())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ak{constructor(t,i,a,l){this.me=t,this.removedTargetIds=i,this.key=a,this.fe=l}}class uie{constructor(t,i){this.targetId=t,this.ge=i}}class die{constructor(t,i,a=ra.EMPTY_BYTE_STRING,l=null){this.state=t,this.targetIds=i,this.resumeToken=a,this.cause=l}}class MX{constructor(){this.pe=0,this.ye=UX(),this.we=ra.EMPTY_BYTE_STRING,this.be=!1,this.Se=!0}get current(){return this.be}get resumeToken(){return this.we}get De(){return this.pe!==0}get ve(){return this.Se}Ce(t){t.approximateByteSize()>0&&(this.Se=!0,this.we=t)}Fe(){let t=br(),i=br(),a=br();return this.ye.forEach((l,d)=>{switch(d){case 0:t=t.add(l);break;case 2:i=i.add(l);break;case 1:a=a.add(l);break;default:Fn()}}),new cC(this.we,this.be,t,i,a)}Me(){this.Se=!1,this.ye=UX()}xe(t,i){this.Se=!0,this.ye=this.ye.insert(t,i)}Oe(t){this.Se=!0,this.ye=this.ye.remove(t)}Ne(){this.pe+=1}Be(){this.pe-=1,ii(this.pe>=0)}Le(){this.Se=!0,this.be=!0}}class xje{constructor(t){this.ke=t,this.qe=new Map,this.Qe=Dp(),this.$e=TO(),this.Ke=TO(),this.Ue=new lo(Ar)}We(t){for(const i of t.me)t.fe&&t.fe.isFoundDocument()?this.Ge(i,t.fe):this.ze(i,t.key,t.fe);for(const i of t.removedTargetIds)this.ze(i,t.key,t.fe)}je(t){this.forEachTarget(t,i=>{const a=this.He(i);switch(t.state){case 0:this.Je(i)&&a.Ce(t.resumeToken);break;case 1:a.Be(),a.De||a.Me(),a.Ce(t.resumeToken);break;case 2:a.Be(),a.De||this.removeTarget(i);break;case 3:this.Je(i)&&(a.Le(),a.Ce(t.resumeToken));break;case 4:this.Je(i)&&(this.Ye(i),a.Ce(t.resumeToken));break;default:Fn()}})}forEachTarget(t,i){t.targetIds.length>0?t.targetIds.forEach(i):this.qe.forEach((a,l)=>{this.Je(l)&&i(l)})}Ze(t){const i=t.targetId,a=t.ge.count,l=this.Xe(i);if(l){const d=l.target;if(RV(d))if(a===0){const p=new En(d.path);this.ze(i,p,Na.newNoDocument(p,Gn.min()))}else ii(a===1);else{const p=this.et(i);if(p!==a){const E=this.tt(t),v=E?this.nt(E,t,p):1;if(v!==0){this.Ye(i);const b=v===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ue=this.Ue.insert(i,b)}}}}}tt(t){const i=t.ge.unchangedNames;if(!i||!i.bits)return null;const{bits:{bitmap:a="",padding:l=0},hashCount:d=0}=i;let p,E;try{p=Sg(a).toUint8Array()}catch(v){if(v instanceof Mre)return f0("Decoding the base64 bloom filter in existence filter failed ("+v.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw v}try{E=new Hj(p,l,d)}catch(v){return f0(v instanceof Uw?"BloomFilter error: ":"Applying bloom filter failed: ",v),null}return E.Ee===0?null:E}nt(t,i,a){return i.ge.count===a-this.st(t,i.targetId)?0:2}st(t,i){const a=this.ke.getRemoteKeysForTarget(i);let l=0;return a.forEach(d=>{const p=this.ke.it(),E=`projects/${p.projectId}/databases/${p.database}/documents/${d.path.canonicalString()}`;t.mightContain(E)||(this.ze(i,d,null),l++)}),l}ot(t){const i=new Map;this.qe.forEach((d,p)=>{const E=this.Xe(p);if(E){if(d.current&&RV(E.target)){const v=new En(E.target.path);this._t(v).has(p)||this.ut(p,v)||this.ze(p,v,Na.newNoDocument(v,t))}d.ve&&(i.set(p,d.Fe()),d.Me())}});let a=br();this.Ke.forEach((d,p)=>{let E=!0;p.forEachWhile(v=>{const b=this.Xe(v);return!b||b.purpose==="TargetPurposeLimboResolution"||(E=!1,!1)}),E&&(a=a.add(d))}),this.Qe.forEach((d,p)=>p.setReadTime(t));const l=new YN(t,i,this.Ue,this.Qe,a);return this.Qe=Dp(),this.$e=TO(),this.Ke=TO(),this.Ue=new lo(Ar),l}Ge(t,i){if(!this.Je(t))return;const a=this.ut(t,i.key)?2:0;this.He(t).xe(i.key,a),this.Qe=this.Qe.insert(i.key,i),this.$e=this.$e.insert(i.key,this._t(i.key).add(t)),this.Ke=this.Ke.insert(i.key,this.ct(i.key).add(t))}ze(t,i,a){if(!this.Je(t))return;const l=this.He(t);this.ut(t,i)?l.xe(i,1):l.Oe(i),this.Ke=this.Ke.insert(i,this.ct(i).delete(t)),this.Ke=this.Ke.insert(i,this.ct(i).add(t)),a&&(this.Qe=this.Qe.insert(i,a))}removeTarget(t){this.qe.delete(t)}et(t){const i=this.He(t).Fe();return this.ke.getRemoteKeysForTarget(t).size+i.addedDocuments.size-i.removedDocuments.size}Ne(t){this.He(t).Ne()}He(t){let i=this.qe.get(t);return i||(i=new MX,this.qe.set(t,i)),i}ct(t){let i=this.Ke.get(t);return i||(i=new cs(Ar),this.Ke=this.Ke.insert(t,i)),i}_t(t){let i=this.$e.get(t);return i||(i=new cs(Ar),this.$e=this.$e.insert(t,i)),i}Je(t){const i=this.Xe(t)!==null;return i||Zt("WatchChangeAggregator","Detected inactive target",t),i}Xe(t){const i=this.qe.get(t);return i&&i.De?null:this.ke.lt(t)}Ye(t){this.qe.set(t,new MX),this.ke.getRemoteKeysForTarget(t).forEach(i=>{this.ze(t,i,null)})}ut(t,i){return this.ke.getRemoteKeysForTarget(t).has(i)}}function TO(){return new lo(En.comparator)}function UX(){return new lo(En.comparator)}const Mje={asc:"ASCENDING",desc:"DESCENDING"},Uje={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Vje={and:"AND",or:"OR"};class Fje{constructor(t,i){this.databaseId=t,this.useProto3Json=i}}function AV(n,t){return n.useProto3Json||BN(t)?t:{value:t}}function Hk(n,t){return n.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function hie(n,t){return n.useProto3Json?t.toBase64():t.toUint8Array()}function jje(n,t){return Hk(n,t.toTimestamp())}function ef(n){return ii(!!n),Gn.fromTimestamp(function(i){const a=vg(i);return new as(a.seconds,a.nanos)}(n))}function $j(n,t){return PV(n,t).canonicalString()}function PV(n,t){const i=function(l){return new Di(["projects",l.projectId,"databases",l.database])}(n).child("documents");return t===void 0?i:i.child(t)}function fie(n){const t=Di.fromString(n);return ii(Eie(t)),t}function OV(n,t){return $j(n.databaseId,t.path)}function Q2(n,t){const i=fie(t);if(i.get(1)!==n.databaseId.projectId)throw new Wt(_t.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+i.get(1)+" vs "+n.databaseId.projectId);if(i.get(3)!==n.databaseId.database)throw new Wt(_t.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+i.get(3)+" vs "+n.databaseId.database);return new En(mie(i))}function pie(n,t){return $j(n.databaseId,t)}function Bje(n){const t=fie(n);return t.length===4?Di.emptyPath():mie(t)}function kV(n){return new Di(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function mie(n){return ii(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function VX(n,t,i){return{name:OV(n,t),fields:i.value.mapValue.fields}}function Wje(n,t){let i;if("targetChange"in t){t.targetChange;const a=function(b){return b==="NO_CHANGE"?0:b==="ADD"?1:b==="REMOVE"?2:b==="CURRENT"?3:b==="RESET"?4:Fn()}(t.targetChange.targetChangeType||"NO_CHANGE"),l=t.targetChange.targetIds||[],d=function(b,w){return b.useProto3Json?(ii(w===void 0||typeof w=="string"),ra.fromBase64String(w||"")):(ii(w===void 0||w instanceof Buffer||w instanceof Uint8Array),ra.fromUint8Array(w||new Uint8Array))}(n,t.targetChange.resumeToken),p=t.targetChange.cause,E=p&&function(b){const w=b.code===void 0?_t.UNKNOWN:lie(b.code);return new Wt(w,b.message||"")}(p);i=new die(a,l,d,E||null)}else if("documentChange"in t){t.documentChange;const a=t.documentChange;a.document,a.document.name,a.document.updateTime;const l=Q2(n,a.document.name),d=ef(a.document.updateTime),p=a.document.createTime?ef(a.document.createTime):Gn.min(),E=new qc({mapValue:{fields:a.document.fields}}),v=Na.newFoundDocument(l,d,p,E),b=a.targetIds||[],w=a.removedTargetIds||[];i=new ak(b,w,v.key,v)}else if("documentDelete"in t){t.documentDelete;const a=t.documentDelete;a.document;const l=Q2(n,a.document),d=a.readTime?ef(a.readTime):Gn.min(),p=Na.newNoDocument(l,d),E=a.removedTargetIds||[];i=new ak([],E,p.key,p)}else if("documentRemove"in t){t.documentRemove;const a=t.documentRemove;a.document;const l=Q2(n,a.document),d=a.removedTargetIds||[];i=new ak([],d,l,null)}else{if(!("filter"in t))return Fn();{t.filter;const a=t.filter;a.targetId;const{count:l=0,unchangedNames:d}=a,p=new kje(l,d),E=a.targetId;i=new uie(E,p)}}return i}function zje(n,t){let i;if(t instanceof aC)i={update:VX(n,t.key,t.value)};else if(t instanceof cie)i={delete:OV(n,t.key)};else if(t instanceof Og)i={update:VX(n,t.key,t.data),updateMask:Qje(t.fieldMask)};else{if(!(t instanceof Aje))return Fn();i={verify:OV(n,t.key)}}return t.fieldTransforms.length>0&&(i.updateTransforms=t.fieldTransforms.map(a=>function(d,p){const E=p.transform;if(E instanceof zk)return{fieldPath:p.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(E instanceof DR)return{fieldPath:p.field.canonicalString(),appendMissingElements:{values:E.elements}};if(E instanceof LR)return{fieldPath:p.field.canonicalString(),removeAllFromArray:{values:E.elements}};if(E instanceof Gk)return{fieldPath:p.field.canonicalString(),increment:E.Ie};throw Fn()}(0,a))),t.precondition.isNone||(i.currentDocument=function(l,d){return d.updateTime!==void 0?{updateTime:jje(l,d.updateTime)}:d.exists!==void 0?{exists:d.exists}:Fn()}(n,t.precondition)),i}function Gje(n,t){return n&&n.length>0?(ii(t!==void 0),n.map(i=>function(l,d){let p=l.updateTime?ef(l.updateTime):ef(d);return p.isEqual(Gn.min())&&(p=ef(d)),new Rje(p,l.transformResults||[])}(i,t))):[]}function Hje(n,t){return{documents:[pie(n,t.path)]}}function $je(n,t){const i={structuredQuery:{}},a=t.path;let l;t.collectionGroup!==null?(l=a,i.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(l=a.popLast(),i.structuredQuery.from=[{collectionId:a.lastSegment()}]),i.parent=pie(n,l);const d=function(b){if(b.length!==0)return _ie(Nd.create(b,"and"))}(t.filters);d&&(i.structuredQuery.where=d);const p=function(b){if(b.length!==0)return b.map(w=>function(N){return{field:yS(N.field),direction:Yje(N.dir)}}(w))}(t.orderBy);p&&(i.structuredQuery.orderBy=p);const E=AV(n,t.limit);return E!==null&&(i.structuredQuery.limit=E),t.startAt&&(i.structuredQuery.startAt=function(b){return{before:b.inclusive,values:b.position}}(t.startAt)),t.endAt&&(i.structuredQuery.endAt=function(b){return{before:!b.inclusive,values:b.position}}(t.endAt)),{ht:i,parent:l}}function Kje(n){let t=Bje(n.parent);const i=n.structuredQuery,a=i.from?i.from.length:0;let l=null;if(a>0){ii(a===1);const w=i.from[0];w.allDescendants?l=w.collectionId:t=t.child(w.collectionId)}let d=[];i.where&&(d=function(A){const N=gie(A);return N instanceof Nd&&$re(N)?N.getFilters():[N]}(i.where));let p=[];i.orderBy&&(p=function(A){return A.map(N=>function(j){return new NR(vS(j.field),function(H){switch(H){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(j.direction))}(N))}(i.orderBy));let E=null;i.limit&&(E=function(A){let N;return N=typeof A=="object"?A.value:A,BN(N)?null:N}(i.limit));let v=null;i.startAt&&(v=function(A){const N=!!A.before,F=A.values||[];return new _0(F,N)}(i.startAt));let b=null;return i.endAt&&(b=function(A){const N=!A.before,F=A.values||[];return new _0(F,N)}(i.endAt)),hje(t,l,p,d,E,"F",v,b)}function qje(n,t){const i=function(l){switch(l){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Fn()}}(t.purpose);return i==null?null:{"goog-listen-tags":i}}function gie(n){return n.unaryFilter!==void 0?function(i){switch(i.unaryFilter.op){case"IS_NAN":const a=vS(i.unaryFilter.field);return qo.create(a,"==",{doubleValue:NaN});case"IS_NULL":const l=vS(i.unaryFilter.field);return qo.create(l,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const d=vS(i.unaryFilter.field);return qo.create(d,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const p=vS(i.unaryFilter.field);return qo.create(p,"!=",{nullValue:"NULL_VALUE"});default:return Fn()}}(n):n.fieldFilter!==void 0?function(i){return qo.create(vS(i.fieldFilter.field),function(l){switch(l){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Fn()}}(i.fieldFilter.op),i.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(i){return Nd.create(i.compositeFilter.filters.map(a=>gie(a)),function(l){switch(l){case"AND":return"and";case"OR":return"or";default:return Fn()}}(i.compositeFilter.op))}(n):Fn()}function Yje(n){return Mje[n]}function Xje(n){return Uje[n]}function Jje(n){return Vje[n]}function yS(n){return{fieldPath:n.canonicalString()}}function vS(n){return na.fromServerFormat(n.fieldPath)}function _ie(n){return n instanceof qo?function(i){if(i.op==="=="){if(RX(i.value))return{unaryFilter:{field:yS(i.field),op:"IS_NAN"}};if(wX(i.value))return{unaryFilter:{field:yS(i.field),op:"IS_NULL"}}}else if(i.op==="!="){if(RX(i.value))return{unaryFilter:{field:yS(i.field),op:"IS_NOT_NAN"}};if(wX(i.value))return{unaryFilter:{field:yS(i.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:yS(i.field),op:Xje(i.op),value:i.value}}}(n):n instanceof Nd?function(i){const a=i.getFilters().map(l=>_ie(l));return a.length===1?a[0]:{compositeFilter:{op:Jje(i.op),filters:a}}}(n):Fn()}function Qje(n){const t=[];return n.fields.forEach(i=>t.push(i.canonicalString())),{fieldPaths:t}}function Eie(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sg{constructor(t,i,a,l,d=Gn.min(),p=Gn.min(),E=ra.EMPTY_BYTE_STRING,v=null){this.target=t,this.targetId=i,this.purpose=a,this.sequenceNumber=l,this.snapshotVersion=d,this.lastLimboFreeSnapshotVersion=p,this.resumeToken=E,this.expectedCount=v}withSequenceNumber(t){return new sg(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,i){return new sg(this.target,this.targetId,this.purpose,this.sequenceNumber,i,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new sg(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new sg(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zje{constructor(t){this.Tt=t}}function e4e(n){const t=Kje({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?IV(t,t.limit,"L"):t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class t4e{constructor(){this.Tn=new n4e}addToCollectionParentIndex(t,i){return this.Tn.add(i),Tt.resolve()}getCollectionParents(t,i){return Tt.resolve(this.Tn.getEntries(i))}addFieldIndex(t,i){return Tt.resolve()}deleteFieldIndex(t,i){return Tt.resolve()}deleteAllFieldIndexes(t){return Tt.resolve()}createTargetIndexes(t,i){return Tt.resolve()}getDocumentsMatchingTarget(t,i){return Tt.resolve(null)}getIndexType(t,i){return Tt.resolve(0)}getFieldIndexes(t,i){return Tt.resolve([])}getNextCollectionGroupToUpdate(t){return Tt.resolve(null)}getMinOffset(t,i){return Tt.resolve(yg.min())}getMinOffsetFromCollectionGroup(t,i){return Tt.resolve(yg.min())}updateCollectionGroup(t,i,a){return Tt.resolve()}updateIndexEntries(t,i){return Tt.resolve()}}class n4e{constructor(){this.index={}}add(t){const i=t.lastSegment(),a=t.popLast(),l=this.index[i]||new cs(Di.comparator),d=!l.has(a);return this.index[i]=l.add(a),d}has(t){const i=t.lastSegment(),a=t.popLast(),l=this.index[i];return l&&l.has(a)}getEntries(t){return(this.index[t]||new cs(Di.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FX={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},yie=41943040;class Hc{static withCacheSize(t){return new Hc(t,Hc.DEFAULT_COLLECTION_PERCENTILE,Hc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(t,i,a){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=i,this.maximumSequenceNumbersToCollect=a}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Hc.DEFAULT_COLLECTION_PERCENTILE=10,Hc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Hc.DEFAULT=new Hc(yie,Hc.DEFAULT_COLLECTION_PERCENTILE,Hc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Hc.DISABLED=new Hc(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class E0{constructor(t){this.$n=t}next(){return this.$n+=2,this.$n}static Kn(){return new E0(0)}static Un(){return new E0(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jX="LruGarbageCollector",r4e=1048576;function BX([n,t],[i,a]){const l=Ar(n,i);return l===0?Ar(t,a):l}class i4e{constructor(t){this.Hn=t,this.buffer=new cs(BX),this.Jn=0}Yn(){return++this.Jn}Zn(t){const i=[t,this.Yn()];if(this.buffer.size<this.Hn)this.buffer=this.buffer.add(i);else{const a=this.buffer.last();BX(i,a)<0&&(this.buffer=this.buffer.delete(a).add(i))}}get maxValue(){return this.buffer.last()[0]}}class o4e{constructor(t,i,a){this.garbageCollector=t,this.asyncQueue=i,this.localStore=a,this.Xn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.er(6e4)}stop(){this.Xn&&(this.Xn.cancel(),this.Xn=null)}get started(){return this.Xn!==null}er(t){Zt(jX,`Garbage collection scheduled in ${t}ms`),this.Xn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,async()=>{this.Xn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(i){M0(i)?Zt(jX,"Ignoring IndexedDB error during garbage collection: ",i):await x0(i)}await this.er(3e5)})}}class s4e{constructor(t,i){this.tr=t,this.params=i}calculateTargetCount(t,i){return this.tr.nr(t).next(a=>Math.floor(i/100*a))}nthSequenceNumber(t,i){if(i===0)return Tt.resolve(jN.ae);const a=new i4e(i);return this.tr.forEachTarget(t,l=>a.Zn(l.sequenceNumber)).next(()=>this.tr.rr(t,l=>a.Zn(l))).next(()=>a.maxValue)}removeTargets(t,i,a){return this.tr.removeTargets(t,i,a)}removeOrphanedDocuments(t,i){return this.tr.removeOrphanedDocuments(t,i)}collect(t,i){return this.params.cacheSizeCollectionThreshold===-1?(Zt("LruGarbageCollector","Garbage collection skipped; disabled"),Tt.resolve(FX)):this.getCacheSize(t).next(a=>a<this.params.cacheSizeCollectionThreshold?(Zt("LruGarbageCollector",`Garbage collection skipped; Cache size ${a} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),FX):this.ir(t,i))}getCacheSize(t){return this.tr.getCacheSize(t)}ir(t,i){let a,l,d,p,E,v,b;const w=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(A=>(A>this.params.maximumSequenceNumbersToCollect?(Zt("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${A}`),l=this.params.maximumSequenceNumbersToCollect):l=A,p=Date.now(),this.nthSequenceNumber(t,l))).next(A=>(a=A,E=Date.now(),this.removeTargets(t,a,i))).next(A=>(d=A,v=Date.now(),this.removeOrphanedDocuments(t,a))).next(A=>(b=Date.now(),_S()<=Sr.DEBUG&&Zt("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${p-w}ms
	Determined least recently used ${l} in `+(E-p)+`ms
	Removed ${d} targets in `+(v-E)+`ms
	Removed ${A} documents in `+(b-v)+`ms
Total Duration: ${b-w}ms`),Tt.resolve({didRun:!0,sequenceNumbersCollected:l,targetsRemoved:d,documentsRemoved:A})))}}function a4e(n,t){return new s4e(n,t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c4e{constructor(){this.changes=new WE(t=>t.toString(),(t,i)=>t.isEqual(i)),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,i){this.assertNotApplied(),this.changes.set(t,Na.newInvalidDocument(t).setReadTime(i))}getEntry(t,i){this.assertNotApplied();const a=this.changes.get(i);return a!==void 0?Tt.resolve(a):this.getFromCache(t,i)}getEntries(t,i){return this.getAllFromCache(t,i)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class l4e{constructor(t,i){this.overlayedDocument=t,this.mutatedFields=i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class u4e{constructor(t,i,a,l){this.remoteDocumentCache=t,this.mutationQueue=i,this.documentOverlayCache=a,this.indexManager=l}getDocument(t,i){let a=null;return this.documentOverlayCache.getOverlay(t,i).next(l=>(a=l,this.remoteDocumentCache.getEntry(t,i))).next(l=>(a!==null&&nR(a.mutation,l,Il.empty(),as.now()),l))}getDocuments(t,i){return this.remoteDocumentCache.getEntries(t,i).next(a=>this.getLocalViewOfDocuments(t,a,br()).next(()=>a))}getLocalViewOfDocuments(t,i,a=br()){const l=hE();return this.populateOverlays(t,l,i).next(()=>this.computeViews(t,i,l,a).next(d=>{let p=Mw();return d.forEach((E,v)=>{p=p.insert(E,v.overlayedDocument)}),p}))}getOverlayedDocuments(t,i){const a=hE();return this.populateOverlays(t,a,i).next(()=>this.computeViews(t,i,a,br()))}populateOverlays(t,i,a){const l=[];return a.forEach(d=>{i.has(d)||l.push(d)}),this.documentOverlayCache.getOverlays(t,l).next(d=>{d.forEach((p,E)=>{i.set(p,E)})})}computeViews(t,i,a,l){let d=Dp();const p=tR(),E=function(){return tR()}();return i.forEach((v,b)=>{const w=a.get(b.key);l.has(b.key)&&(w===void 0||w.mutation instanceof Og)?d=d.insert(b.key,b):w!==void 0?(p.set(b.key,w.mutation.getFieldMask()),nR(w.mutation,b,w.mutation.getFieldMask(),as.now())):p.set(b.key,Il.empty())}),this.recalculateAndSaveOverlays(t,d).next(v=>(v.forEach((b,w)=>p.set(b,w)),i.forEach((b,w)=>{var A;return E.set(b,new l4e(w,(A=p.get(b))!==null&&A!==void 0?A:null))}),E))}recalculateAndSaveOverlays(t,i){const a=tR();let l=new lo((p,E)=>p-E),d=br();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,i).next(p=>{for(const E of p)E.keys().forEach(v=>{const b=i.get(v);if(b===null)return;let w=a.get(v)||Il.empty();w=E.applyToLocalView(b,w),a.set(v,w);const A=(l.get(E.batchId)||br()).add(v);l=l.insert(E.batchId,A)})}).next(()=>{const p=[],E=l.getReverseIterator();for(;E.hasNext();){const v=E.getNext(),b=v.key,w=v.value,A=eie();w.forEach(N=>{if(!d.has(N)){const F=sie(i.get(N),a.get(N));F!==null&&A.set(N,F),d=d.add(N)}}),p.push(this.documentOverlayCache.saveOverlays(t,b,A))}return Tt.waitFor(p)}).next(()=>a)}recalculateAndSaveOverlaysForDocumentKeys(t,i){return this.remoteDocumentCache.getEntries(t,i).next(a=>this.recalculateAndSaveOverlays(t,a))}getDocumentsMatchingQuery(t,i,a,l){return function(p){return En.isDocumentKey(p.path)&&p.collectionGroup===null&&p.filters.length===0}(i)?this.getDocumentsMatchingDocumentQuery(t,i.path):Wj(i)?this.getDocumentsMatchingCollectionGroupQuery(t,i,a,l):this.getDocumentsMatchingCollectionQuery(t,i,a,l)}getNextDocuments(t,i,a,l){return this.remoteDocumentCache.getAllFromCollectionGroup(t,i,a,l).next(d=>{const p=l-d.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,i,a.largestBatchId,l-d.size):Tt.resolve(hE());let E=AR,v=d;return p.next(b=>Tt.forEach(b,(w,A)=>(E<A.largestBatchId&&(E=A.largestBatchId),d.get(w)?Tt.resolve():this.remoteDocumentCache.getEntry(t,w).next(N=>{v=v.insert(w,N)}))).next(()=>this.populateOverlays(t,b,d)).next(()=>this.computeViews(t,v,b,br())).next(w=>({batchId:E,changes:Zre(w)})))})}getDocumentsMatchingDocumentQuery(t,i){return this.getDocument(t,new En(i)).next(a=>{let l=Mw();return a.isFoundDocument()&&(l=l.insert(a.key,a)),l})}getDocumentsMatchingCollectionGroupQuery(t,i,a,l){const d=i.collectionGroup;let p=Mw();return this.indexManager.getCollectionParents(t,d).next(E=>Tt.forEach(E,v=>{const b=function(A,N){return new BE(N,null,A.explicitOrderBy.slice(),A.filters.slice(),A.limit,A.limitType,A.startAt,A.endAt)}(i,v.child(d));return this.getDocumentsMatchingCollectionQuery(t,b,a,l).next(w=>{w.forEach((A,N)=>{p=p.insert(A,N)})})}).next(()=>p))}getDocumentsMatchingCollectionQuery(t,i,a,l){let d;return this.documentOverlayCache.getOverlaysForCollection(t,i.path,a.largestBatchId).next(p=>(d=p,this.remoteDocumentCache.getDocumentsMatchingQuery(t,i,a,d,l))).next(p=>{d.forEach((v,b)=>{const w=b.getKey();p.get(w)===null&&(p=p.insert(w,Na.newInvalidDocument(w)))});let E=Mw();return p.forEach((v,b)=>{const w=d.get(v);w!==void 0&&nR(w.mutation,b,Il.empty(),as.now()),$N(i,b)&&(E=E.insert(v,b))}),E})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class d4e{constructor(t){this.serializer=t,this.dr=new Map,this.Ar=new Map}getBundleMetadata(t,i){return Tt.resolve(this.dr.get(i))}saveBundleMetadata(t,i){return this.dr.set(i.id,function(l){return{id:l.id,version:l.version,createTime:ef(l.createTime)}}(i)),Tt.resolve()}getNamedQuery(t,i){return Tt.resolve(this.Ar.get(i))}saveNamedQuery(t,i){return this.Ar.set(i.name,function(l){return{name:l.name,query:e4e(l.bundledQuery),readTime:ef(l.readTime)}}(i)),Tt.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h4e{constructor(){this.overlays=new lo(En.comparator),this.Rr=new Map}getOverlay(t,i){return Tt.resolve(this.overlays.get(i))}getOverlays(t,i){const a=hE();return Tt.forEach(i,l=>this.getOverlay(t,l).next(d=>{d!==null&&a.set(l,d)})).next(()=>a)}saveOverlays(t,i,a){return a.forEach((l,d)=>{this.Et(t,i,d)}),Tt.resolve()}removeOverlaysForBatchId(t,i,a){const l=this.Rr.get(a);return l!==void 0&&(l.forEach(d=>this.overlays=this.overlays.remove(d)),this.Rr.delete(a)),Tt.resolve()}getOverlaysForCollection(t,i,a){const l=hE(),d=i.length+1,p=new En(i.child("")),E=this.overlays.getIteratorFrom(p);for(;E.hasNext();){const v=E.getNext().value,b=v.getKey();if(!i.isPrefixOf(b.path))break;b.path.length===d&&v.largestBatchId>a&&l.set(v.getKey(),v)}return Tt.resolve(l)}getOverlaysForCollectionGroup(t,i,a,l){let d=new lo((b,w)=>b-w);const p=this.overlays.getIterator();for(;p.hasNext();){const b=p.getNext().value;if(b.getKey().getCollectionGroup()===i&&b.largestBatchId>a){let w=d.get(b.largestBatchId);w===null&&(w=hE(),d=d.insert(b.largestBatchId,w)),w.set(b.getKey(),b)}}const E=hE(),v=d.getIterator();for(;v.hasNext()&&(v.getNext().value.forEach((b,w)=>E.set(b,w)),!(E.size()>=l)););return Tt.resolve(E)}Et(t,i,a){const l=this.overlays.get(a.key);if(l!==null){const p=this.Rr.get(l.largestBatchId).delete(a.key);this.Rr.set(l.largestBatchId,p)}this.overlays=this.overlays.insert(a.key,new Oje(i,a));let d=this.Rr.get(i);d===void 0&&(d=br(),this.Rr.set(i,d)),this.Rr.set(i,d.add(a.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class f4e{constructor(){this.sessionToken=ra.EMPTY_BYTE_STRING}getSessionToken(t){return Tt.resolve(this.sessionToken)}setSessionToken(t,i){return this.sessionToken=i,Tt.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kj{constructor(){this.Vr=new cs(Rs.mr),this.gr=new cs(Rs.pr)}isEmpty(){return this.Vr.isEmpty()}addReference(t,i){const a=new Rs(t,i);this.Vr=this.Vr.add(a),this.gr=this.gr.add(a)}yr(t,i){t.forEach(a=>this.addReference(a,i))}removeReference(t,i){this.wr(new Rs(t,i))}br(t,i){t.forEach(a=>this.removeReference(a,i))}Sr(t){const i=new En(new Di([])),a=new Rs(i,t),l=new Rs(i,t+1),d=[];return this.gr.forEachInRange([a,l],p=>{this.wr(p),d.push(p.key)}),d}Dr(){this.Vr.forEach(t=>this.wr(t))}wr(t){this.Vr=this.Vr.delete(t),this.gr=this.gr.delete(t)}vr(t){const i=new En(new Di([])),a=new Rs(i,t),l=new Rs(i,t+1);let d=br();return this.gr.forEachInRange([a,l],p=>{d=d.add(p.key)}),d}containsKey(t){const i=new Rs(t,0),a=this.Vr.firstAfterOrEqual(i);return a!==null&&t.isEqual(a.key)}}class Rs{constructor(t,i){this.key=t,this.Cr=i}static mr(t,i){return En.comparator(t.key,i.key)||Ar(t.Cr,i.Cr)}static pr(t,i){return Ar(t.Cr,i.Cr)||En.comparator(t.key,i.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class p4e{constructor(t,i){this.indexManager=t,this.referenceDelegate=i,this.mutationQueue=[],this.Fr=1,this.Mr=new cs(Rs.mr)}checkEmpty(t){return Tt.resolve(this.mutationQueue.length===0)}addMutationBatch(t,i,a,l){const d=this.Fr;this.Fr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const p=new Pje(d,i,a,l);this.mutationQueue.push(p);for(const E of l)this.Mr=this.Mr.add(new Rs(E.key,d)),this.indexManager.addToCollectionParentIndex(t,E.key.path.popLast());return Tt.resolve(p)}lookupMutationBatch(t,i){return Tt.resolve(this.Or(i))}getNextMutationBatchAfterBatchId(t,i){const a=i+1,l=this.Nr(a),d=l<0?0:l;return Tt.resolve(this.mutationQueue.length>d?this.mutationQueue[d]:null)}getHighestUnacknowledgedBatchId(){return Tt.resolve(this.mutationQueue.length===0?Vj:this.Fr-1)}getAllMutationBatches(t){return Tt.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,i){const a=new Rs(i,0),l=new Rs(i,Number.POSITIVE_INFINITY),d=[];return this.Mr.forEachInRange([a,l],p=>{const E=this.Or(p.Cr);d.push(E)}),Tt.resolve(d)}getAllMutationBatchesAffectingDocumentKeys(t,i){let a=new cs(Ar);return i.forEach(l=>{const d=new Rs(l,0),p=new Rs(l,Number.POSITIVE_INFINITY);this.Mr.forEachInRange([d,p],E=>{a=a.add(E.Cr)})}),Tt.resolve(this.Br(a))}getAllMutationBatchesAffectingQuery(t,i){const a=i.path,l=a.length+1;let d=a;En.isDocumentKey(d)||(d=d.child(""));const p=new Rs(new En(d),0);let E=new cs(Ar);return this.Mr.forEachWhile(v=>{const b=v.key.path;return!!a.isPrefixOf(b)&&(b.length===l&&(E=E.add(v.Cr)),!0)},p),Tt.resolve(this.Br(E))}Br(t){const i=[];return t.forEach(a=>{const l=this.Or(a);l!==null&&i.push(l)}),i}removeMutationBatch(t,i){ii(this.Lr(i.batchId,"removed")===0),this.mutationQueue.shift();let a=this.Mr;return Tt.forEach(i.mutations,l=>{const d=new Rs(l.key,i.batchId);return a=a.delete(d),this.referenceDelegate.markPotentiallyOrphaned(t,l.key)}).next(()=>{this.Mr=a})}qn(t){}containsKey(t,i){const a=new Rs(i,0),l=this.Mr.firstAfterOrEqual(a);return Tt.resolve(i.isEqual(l&&l.key))}performConsistencyCheck(t){return this.mutationQueue.length,Tt.resolve()}Lr(t,i){return this.Nr(t)}Nr(t){return this.mutationQueue.length===0?0:t-this.mutationQueue[0].batchId}Or(t){const i=this.Nr(t);return i<0||i>=this.mutationQueue.length?null:this.mutationQueue[i]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class m4e{constructor(t){this.kr=t,this.docs=function(){return new lo(En.comparator)}(),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,i){const a=i.key,l=this.docs.get(a),d=l?l.size:0,p=this.kr(i);return this.docs=this.docs.insert(a,{document:i.mutableCopy(),size:p}),this.size+=p-d,this.indexManager.addToCollectionParentIndex(t,a.path.popLast())}removeEntry(t){const i=this.docs.get(t);i&&(this.docs=this.docs.remove(t),this.size-=i.size)}getEntry(t,i){const a=this.docs.get(i);return Tt.resolve(a?a.document.mutableCopy():Na.newInvalidDocument(i))}getEntries(t,i){let a=Dp();return i.forEach(l=>{const d=this.docs.get(l);a=a.insert(l,d?d.document.mutableCopy():Na.newInvalidDocument(l))}),Tt.resolve(a)}getDocumentsMatchingQuery(t,i,a,l){let d=Dp();const p=i.path,E=new En(p.child("__id-9223372036854775808__")),v=this.docs.getIteratorFrom(E);for(;v.hasNext();){const{key:b,value:{document:w}}=v.getNext();if(!p.isPrefixOf(b.path))break;b.path.length>p.length+1||GFe(zFe(w),a)<=0||(l.has(w.key)||$N(i,w))&&(d=d.insert(w.key,w.mutableCopy()))}return Tt.resolve(d)}getAllFromCollectionGroup(t,i,a,l){Fn()}qr(t,i){return Tt.forEach(this.docs,a=>i(a))}newChangeBuffer(t){return new g4e(this)}getSize(t){return Tt.resolve(this.size)}}class g4e extends c4e{constructor(t){super(),this.Ir=t}applyChanges(t){const i=[];return this.changes.forEach((a,l)=>{l.isValidDocument()?i.push(this.Ir.addEntry(t,l)):this.Ir.removeEntry(a)}),Tt.waitFor(i)}getFromCache(t,i){return this.Ir.getEntry(t,i)}getAllFromCache(t,i){return this.Ir.getEntries(t,i)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _4e{constructor(t){this.persistence=t,this.Qr=new WE(i=>jj(i),Bj),this.lastRemoteSnapshotVersion=Gn.min(),this.highestTargetId=0,this.$r=0,this.Kr=new Kj,this.targetCount=0,this.Ur=E0.Kn()}forEachTarget(t,i){return this.Qr.forEach((a,l)=>i(l)),Tt.resolve()}getLastRemoteSnapshotVersion(t){return Tt.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return Tt.resolve(this.$r)}allocateTargetId(t){return this.highestTargetId=this.Ur.next(),Tt.resolve(this.highestTargetId)}setTargetsMetadata(t,i,a){return a&&(this.lastRemoteSnapshotVersion=a),i>this.$r&&(this.$r=i),Tt.resolve()}zn(t){this.Qr.set(t.target,t);const i=t.targetId;i>this.highestTargetId&&(this.Ur=new E0(i),this.highestTargetId=i),t.sequenceNumber>this.$r&&(this.$r=t.sequenceNumber)}addTargetData(t,i){return this.zn(i),this.targetCount+=1,Tt.resolve()}updateTargetData(t,i){return this.zn(i),Tt.resolve()}removeTargetData(t,i){return this.Qr.delete(i.target),this.Kr.Sr(i.targetId),this.targetCount-=1,Tt.resolve()}removeTargets(t,i,a){let l=0;const d=[];return this.Qr.forEach((p,E)=>{E.sequenceNumber<=i&&a.get(E.targetId)===null&&(this.Qr.delete(p),d.push(this.removeMatchingKeysForTargetId(t,E.targetId)),l++)}),Tt.waitFor(d).next(()=>l)}getTargetCount(t){return Tt.resolve(this.targetCount)}getTargetData(t,i){const a=this.Qr.get(i)||null;return Tt.resolve(a)}addMatchingKeys(t,i,a){return this.Kr.yr(i,a),Tt.resolve()}removeMatchingKeys(t,i,a){this.Kr.br(i,a);const l=this.persistence.referenceDelegate,d=[];return l&&i.forEach(p=>{d.push(l.markPotentiallyOrphaned(t,p))}),Tt.waitFor(d)}removeMatchingKeysForTargetId(t,i){return this.Kr.Sr(i),Tt.resolve()}getMatchingKeysForTargetId(t,i){const a=this.Kr.vr(i);return Tt.resolve(a)}containsKey(t,i){return Tt.resolve(this.Kr.containsKey(i))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vie{constructor(t,i){this.Wr={},this.overlays={},this.Gr=new jN(0),this.zr=!1,this.zr=!0,this.jr=new f4e,this.referenceDelegate=t(this),this.Hr=new _4e(this),this.indexManager=new t4e,this.remoteDocumentCache=function(l){return new m4e(l)}(a=>this.referenceDelegate.Jr(a)),this.serializer=new Zje(i),this.Yr=new d4e(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.zr=!1,Promise.resolve()}get started(){return this.zr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let i=this.overlays[t.toKey()];return i||(i=new h4e,this.overlays[t.toKey()]=i),i}getMutationQueue(t,i){let a=this.Wr[t.toKey()];return a||(a=new p4e(i,this.referenceDelegate),this.Wr[t.toKey()]=a),a}getGlobalsCache(){return this.jr}getTargetCache(){return this.Hr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Yr}runTransaction(t,i,a){Zt("MemoryPersistence","Starting transaction:",t);const l=new E4e(this.Gr.next());return this.referenceDelegate.Zr(),a(l).next(d=>this.referenceDelegate.Xr(l).next(()=>d)).toPromise().then(d=>(l.raiseOnCommittedEvent(),d))}ei(t,i){return Tt.or(Object.values(this.Wr).map(a=>()=>a.containsKey(t,i)))}}class E4e extends $Fe{constructor(t){super(),this.currentSequenceNumber=t}}class qj{constructor(t){this.persistence=t,this.ti=new Kj,this.ni=null}static ri(t){return new qj(t)}get ii(){if(this.ni)return this.ni;throw Fn()}addReference(t,i,a){return this.ti.addReference(a,i),this.ii.delete(a.toString()),Tt.resolve()}removeReference(t,i,a){return this.ti.removeReference(a,i),this.ii.add(a.toString()),Tt.resolve()}markPotentiallyOrphaned(t,i){return this.ii.add(i.toString()),Tt.resolve()}removeTarget(t,i){this.ti.Sr(i.targetId).forEach(l=>this.ii.add(l.toString()));const a=this.persistence.getTargetCache();return a.getMatchingKeysForTargetId(t,i.targetId).next(l=>{l.forEach(d=>this.ii.add(d.toString()))}).next(()=>a.removeTargetData(t,i))}Zr(){this.ni=new Set}Xr(t){const i=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Tt.forEach(this.ii,a=>{const l=En.fromPath(a);return this.si(t,l).next(d=>{d||i.removeEntry(l,Gn.min())})}).next(()=>(this.ni=null,i.apply(t)))}updateLimboDocument(t,i){return this.si(t,i).next(a=>{a?this.ii.delete(i.toString()):this.ii.add(i.toString())})}Jr(t){return 0}si(t,i){return Tt.or([()=>Tt.resolve(this.ti.containsKey(i)),()=>this.persistence.getTargetCache().containsKey(t,i),()=>this.persistence.ei(t,i)])}}class $k{constructor(t,i){this.persistence=t,this.oi=new WE(a=>YFe(a.path),(a,l)=>a.isEqual(l)),this.garbageCollector=a4e(this,i)}static ri(t,i){return new $k(t,i)}Zr(){}Xr(t){return Tt.resolve()}forEachTarget(t,i){return this.persistence.getTargetCache().forEachTarget(t,i)}nr(t){const i=this.sr(t);return this.persistence.getTargetCache().getTargetCount(t).next(a=>i.next(l=>a+l))}sr(t){let i=0;return this.rr(t,a=>{i++}).next(()=>i)}rr(t,i){return Tt.forEach(this.oi,(a,l)=>this.ar(t,a,l).next(d=>d?Tt.resolve():i(l)))}removeTargets(t,i,a){return this.persistence.getTargetCache().removeTargets(t,i,a)}removeOrphanedDocuments(t,i){let a=0;const l=this.persistence.getRemoteDocumentCache(),d=l.newChangeBuffer();return l.qr(t,p=>this.ar(t,p,i).next(E=>{E||(a++,d.removeEntry(p,Gn.min()))})).next(()=>d.apply(t)).next(()=>a)}markPotentiallyOrphaned(t,i){return this.oi.set(i,t.currentSequenceNumber),Tt.resolve()}removeTarget(t,i){const a=i.withSequenceNumber(t.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(t,a)}addReference(t,i,a){return this.oi.set(a,t.currentSequenceNumber),Tt.resolve()}removeReference(t,i,a){return this.oi.set(a,t.currentSequenceNumber),Tt.resolve()}updateLimboDocument(t,i){return this.oi.set(i,t.currentSequenceNumber),Tt.resolve()}Jr(t){let i=t.key.toString().length;return t.isFoundDocument()&&(i+=ik(t.data.value)),i}ar(t,i,a){return Tt.or([()=>this.persistence.ei(t,i),()=>this.persistence.getTargetCache().containsKey(t,i),()=>{const l=this.oi.get(i);return Tt.resolve(l!==void 0&&l>a)}])}getCacheSize(t){return this.persistence.getRemoteDocumentCache().getSize(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yj{constructor(t,i,a,l){this.targetId=t,this.fromCache=i,this.Hi=a,this.Ji=l}static Yi(t,i){let a=br(),l=br();for(const d of i.docChanges)switch(d.type){case 0:a=a.add(d.doc.key);break;case 1:l=l.add(d.doc.key)}return new Yj(t,i.fromCache,a,l)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class y4e{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v4e{constructor(){this.Zi=!1,this.Xi=!1,this.es=100,this.ts=function(){return e2e()?8:KFe(Fa())>0?6:4}()}initialize(t,i){this.ns=t,this.indexManager=i,this.Zi=!0}getDocumentsMatchingQuery(t,i,a,l){const d={result:null};return this.rs(t,i).next(p=>{d.result=p}).next(()=>{if(!d.result)return this.ss(t,i,l,a).next(p=>{d.result=p})}).next(()=>{if(d.result)return;const p=new y4e;return this._s(t,i,p).next(E=>{if(d.result=E,this.Xi)return this.us(t,i,p,E.size)})}).next(()=>d.result)}us(t,i,a,l){return a.documentReadCount<this.es?(_S()<=Sr.DEBUG&&Zt("QueryEngine","SDK will not create cache indexes for query:",ES(i),"since it only creates cache indexes for collection contains","more than or equal to",this.es,"documents"),Tt.resolve()):(_S()<=Sr.DEBUG&&Zt("QueryEngine","Query:",ES(i),"scans",a.documentReadCount,"local documents and returns",l,"documents as results."),a.documentReadCount>this.ts*l?(_S()<=Sr.DEBUG&&Zt("QueryEngine","The SDK decides to create cache indexes for query:",ES(i),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,Qh(i))):Tt.resolve())}rs(t,i){if(PX(i))return Tt.resolve(null);let a=Qh(i);return this.indexManager.getIndexType(t,a).next(l=>l===0?null:(i.limit!==null&&l===1&&(i=IV(i,null,"F"),a=Qh(i)),this.indexManager.getDocumentsMatchingTarget(t,a).next(d=>{const p=br(...d);return this.ns.getDocuments(t,p).next(E=>this.indexManager.getMinOffset(t,a).next(v=>{const b=this.cs(i,E);return this.ls(i,b,p,v.readTime)?this.rs(t,IV(i,null,"F")):this.hs(t,b,i,v)}))})))}ss(t,i,a,l){return PX(i)||l.isEqual(Gn.min())?Tt.resolve(null):this.ns.getDocuments(t,a).next(d=>{const p=this.cs(i,d);return this.ls(i,p,a,l)?Tt.resolve(null):(_S()<=Sr.DEBUG&&Zt("QueryEngine","Re-using previous result from %s to execute query: %s",l.toString(),ES(i)),this.hs(t,p,i,WFe(l,AR)).next(E=>E))})}cs(t,i){let a=new cs(Jre(t));return i.forEach((l,d)=>{$N(t,d)&&(a=a.add(d))}),a}ls(t,i,a,l){if(t.limit===null)return!1;if(a.size!==i.size)return!0;const d=t.limitType==="F"?i.last():i.first();return!!d&&(d.hasPendingWrites||d.version.compareTo(l)>0)}_s(t,i,a){return _S()<=Sr.DEBUG&&Zt("QueryEngine","Using full collection scan to execute query:",ES(i)),this.ns.getDocumentsMatchingQuery(t,i,yg.min(),a)}hs(t,i,a,l){return this.ns.getDocumentsMatchingQuery(t,a,l).next(d=>(i.forEach(p=>{d=d.insert(p.key,p)}),d))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xj="LocalStore",S4e=3e8;class b4e{constructor(t,i,a,l){this.persistence=t,this.Ps=i,this.serializer=l,this.Ts=new lo(Ar),this.Is=new WE(d=>jj(d),Bj),this.Es=new Map,this.ds=t.getRemoteDocumentCache(),this.Hr=t.getTargetCache(),this.Yr=t.getBundleCache(),this.As(a)}As(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new u4e(this.ds,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.ds.setIndexManager(this.indexManager),this.Ps.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",i=>t.collect(i,this.Ts))}}function T4e(n,t,i,a){return new b4e(n,t,i,a)}async function Sie(n,t){const i=qn(n);return await i.persistence.runTransaction("Handle user change","readonly",a=>{let l;return i.mutationQueue.getAllMutationBatches(a).next(d=>(l=d,i.As(t),i.mutationQueue.getAllMutationBatches(a))).next(d=>{const p=[],E=[];let v=br();for(const b of l){p.push(b.batchId);for(const w of b.mutations)v=v.add(w.key)}for(const b of d){E.push(b.batchId);for(const w of b.mutations)v=v.add(w.key)}return i.localDocuments.getDocuments(a,v).next(b=>({Rs:b,removedBatchIds:p,addedBatchIds:E}))})})}function w4e(n,t){const i=qn(n);return i.persistence.runTransaction("Acknowledge batch","readwrite-primary",a=>{const l=t.batch.keys(),d=i.ds.newChangeBuffer({trackRemovals:!0});return function(E,v,b,w){const A=b.batch,N=A.keys();let F=Tt.resolve();return N.forEach(j=>{F=F.next(()=>w.getEntry(v,j)).next(B=>{const H=b.docVersions.get(j);ii(H!==null),B.version.compareTo(H)<0&&(A.applyToRemoteDocument(B,b),B.isValidDocument()&&(B.setReadTime(b.commitVersion),w.addEntry(B)))})}),F.next(()=>E.mutationQueue.removeMutationBatch(v,A))}(i,a,t,d).next(()=>d.apply(a)).next(()=>i.mutationQueue.performConsistencyCheck(a)).next(()=>i.documentOverlayCache.removeOverlaysForBatchId(a,l,t.batch.batchId)).next(()=>i.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(a,function(E){let v=br();for(let b=0;b<E.mutationResults.length;++b)E.mutationResults[b].transformResults.length>0&&(v=v.add(E.batch.mutations[b].key));return v}(t))).next(()=>i.localDocuments.getDocuments(a,l))})}function bie(n){const t=qn(n);return t.persistence.runTransaction("Get last remote snapshot version","readonly",i=>t.Hr.getLastRemoteSnapshotVersion(i))}function R4e(n,t){const i=qn(n),a=t.snapshotVersion;let l=i.Ts;return i.persistence.runTransaction("Apply remote event","readwrite-primary",d=>{const p=i.ds.newChangeBuffer({trackRemovals:!0});l=i.Ts;const E=[];t.targetChanges.forEach((w,A)=>{const N=l.get(A);if(!N)return;E.push(i.Hr.removeMatchingKeys(d,w.removedDocuments,A).next(()=>i.Hr.addMatchingKeys(d,w.addedDocuments,A)));let F=N.withSequenceNumber(d.currentSequenceNumber);t.targetMismatches.get(A)!==null?F=F.withResumeToken(ra.EMPTY_BYTE_STRING,Gn.min()).withLastLimboFreeSnapshotVersion(Gn.min()):w.resumeToken.approximateByteSize()>0&&(F=F.withResumeToken(w.resumeToken,a)),l=l.insert(A,F),function(B,H,ee){return B.resumeToken.approximateByteSize()===0||H.snapshotVersion.toMicroseconds()-B.snapshotVersion.toMicroseconds()>=S4e?!0:ee.addedDocuments.size+ee.modifiedDocuments.size+ee.removedDocuments.size>0}(N,F,w)&&E.push(i.Hr.updateTargetData(d,F))});let v=Dp(),b=br();if(t.documentUpdates.forEach(w=>{t.resolvedLimboDocuments.has(w)&&E.push(i.persistence.referenceDelegate.updateLimboDocument(d,w))}),E.push(C4e(d,p,t.documentUpdates).next(w=>{v=w.Vs,b=w.fs})),!a.isEqual(Gn.min())){const w=i.Hr.getLastRemoteSnapshotVersion(d).next(A=>i.Hr.setTargetsMetadata(d,d.currentSequenceNumber,a));E.push(w)}return Tt.waitFor(E).next(()=>p.apply(d)).next(()=>i.localDocuments.getLocalViewOfDocuments(d,v,b)).next(()=>v)}).then(d=>(i.Ts=l,d))}function C4e(n,t,i){let a=br(),l=br();return i.forEach(d=>a=a.add(d)),t.getEntries(n,a).next(d=>{let p=Dp();return i.forEach((E,v)=>{const b=d.get(E);v.isFoundDocument()!==b.isFoundDocument()&&(l=l.add(E)),v.isNoDocument()&&v.version.isEqual(Gn.min())?(t.removeEntry(E,v.readTime),p=p.insert(E,v)):!b.isValidDocument()||v.version.compareTo(b.version)>0||v.version.compareTo(b.version)===0&&b.hasPendingWrites?(t.addEntry(v),p=p.insert(E,v)):Zt(Xj,"Ignoring outdated watch update for ",E,". Current version:",b.version," Watch version:",v.version)}),{Vs:p,fs:l}})}function I4e(n,t){const i=qn(n);return i.persistence.runTransaction("Get next mutation batch","readonly",a=>(t===void 0&&(t=Vj),i.mutationQueue.getNextMutationBatchAfterBatchId(a,t)))}function A4e(n,t){const i=qn(n);return i.persistence.runTransaction("Allocate target","readwrite",a=>{let l;return i.Hr.getTargetData(a,t).next(d=>d?(l=d,Tt.resolve(l)):i.Hr.allocateTargetId(a).next(p=>(l=new sg(t,p,"TargetPurposeListen",a.currentSequenceNumber),i.Hr.addTargetData(a,l).next(()=>l))))}).then(a=>{const l=i.Ts.get(a.targetId);return(l===null||a.snapshotVersion.compareTo(l.snapshotVersion)>0)&&(i.Ts=i.Ts.insert(a.targetId,a),i.Is.set(t,a.targetId)),a})}async function NV(n,t,i){const a=qn(n),l=a.Ts.get(t),d=i?"readwrite":"readwrite-primary";try{i||await a.persistence.runTransaction("Release target",d,p=>a.persistence.referenceDelegate.removeTarget(p,l))}catch(p){if(!M0(p))throw p;Zt(Xj,`Failed to update sequence numbers for target ${t}: ${p}`)}a.Ts=a.Ts.remove(t),a.Is.delete(l.target)}function WX(n,t,i){const a=qn(n);let l=Gn.min(),d=br();return a.persistence.runTransaction("Execute query","readwrite",p=>function(v,b,w){const A=qn(v),N=A.Is.get(w);return N!==void 0?Tt.resolve(A.Ts.get(N)):A.Hr.getTargetData(b,w)}(a,p,Qh(t)).next(E=>{if(E)return l=E.lastLimboFreeSnapshotVersion,a.Hr.getMatchingKeysForTargetId(p,E.targetId).next(v=>{d=v})}).next(()=>a.Ps.getDocumentsMatchingQuery(p,t,i?l:Gn.min(),i?d:br())).next(E=>(P4e(a,pje(t),E),{documents:E,gs:d})))}function P4e(n,t,i){let a=n.Es.get(t)||Gn.min();i.forEach((l,d)=>{d.readTime.compareTo(a)>0&&(a=d.readTime)}),n.Es.set(t,a)}class zX{constructor(){this.activeTargetIds=vje()}Ds(t){this.activeTargetIds=this.activeTargetIds.add(t)}vs(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Ss(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class O4e{constructor(){this.ho=new zX,this.Po={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,i,a){}addLocalQueryTarget(t,i=!0){return i&&this.ho.Ds(t),this.Po[t]||"not-current"}updateQueryState(t,i,a){this.Po[t]=i}removeLocalQueryTarget(t){this.ho.vs(t)}isLocalQueryTarget(t){return this.ho.activeTargetIds.has(t)}clearQueryState(t){delete this.Po[t]}getAllActiveQueryTargets(){return this.ho.activeTargetIds}isActiveQueryTarget(t){return this.ho.activeTargetIds.has(t)}start(){return this.ho=new zX,Promise.resolve()}handleUserChange(t,i,a){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class k4e{To(t){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GX="ConnectivityMonitor";class HX{constructor(){this.Io=()=>this.Eo(),this.Ao=()=>this.Ro(),this.Vo=[],this.mo()}To(t){this.Vo.push(t)}shutdown(){window.removeEventListener("online",this.Io),window.removeEventListener("offline",this.Ao)}mo(){window.addEventListener("online",this.Io),window.addEventListener("offline",this.Ao)}Eo(){Zt(GX,"Network connectivity changed: AVAILABLE");for(const t of this.Vo)t(0)}Ro(){Zt(GX,"Network connectivity changed: UNAVAILABLE");for(const t of this.Vo)t(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let wO=null;function DV(){return wO===null?wO=function(){return 268435456+Math.round(2147483648*Math.random())}():wO++,"0x"+wO.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Z2="RestConnection",N4e={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class D4e{get fo(){return!1}constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const i=t.ssl?"https":"http",a=encodeURIComponent(this.databaseId.projectId),l=encodeURIComponent(this.databaseId.database);this.po=i+"://"+t.host,this.yo=`projects/${a}/databases/${l}`,this.wo=this.databaseId.database===jk?`project_id=${a}`:`project_id=${a}&database_id=${l}`}bo(t,i,a,l,d){const p=DV(),E=this.So(t,i.toUriEncodedString());Zt(Z2,`Sending RPC '${t}' ${p}:`,E,a);const v={"google-cloud-resource-prefix":this.yo,"x-goog-request-params":this.wo};return this.Do(v,l,d),this.vo(t,E,v,a).then(b=>(Zt(Z2,`Received RPC '${t}' ${p}: `,b),b),b=>{throw f0(Z2,`RPC '${t}' ${p} failed with error: `,b,"url: ",E,"request:",a),b})}Co(t,i,a,l,d,p){return this.bo(t,i,a,l,d)}Do(t,i,a){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+L0}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),i&&i.headers.forEach((l,d)=>t[d]=l),a&&a.headers.forEach((l,d)=>t[d]=l)}So(t,i){const a=N4e[t];return`${this.po}/v1/${i}:${a}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class L4e{constructor(t){this.Fo=t.Fo,this.Mo=t.Mo}xo(t){this.Oo=t}No(t){this.Bo=t}Lo(t){this.ko=t}onMessage(t){this.qo=t}close(){this.Mo()}send(t){this.Fo(t)}Qo(){this.Oo()}$o(){this.Bo()}Ko(t){this.ko(t)}Uo(t){this.qo(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ia="WebChannelConnection";class x4e extends D4e{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}vo(t,i,a,l){const d=DV();return new Promise((p,E)=>{const v=new Ire;v.setWithCredentials(!0),v.listenOnce(Are.COMPLETE,()=>{try{switch(v.getLastErrorCode()){case rk.NO_ERROR:const w=v.getResponseJson();Zt(Ia,`XHR for RPC '${t}' ${d} received:`,JSON.stringify(w)),p(w);break;case rk.TIMEOUT:Zt(Ia,`RPC '${t}' ${d} timed out`),E(new Wt(_t.DEADLINE_EXCEEDED,"Request time out"));break;case rk.HTTP_ERROR:const A=v.getStatus();if(Zt(Ia,`RPC '${t}' ${d} failed with status:`,A,"response text:",v.getResponseText()),A>0){let N=v.getResponseJson();Array.isArray(N)&&(N=N[0]);const F=N==null?void 0:N.error;if(F&&F.status&&F.message){const j=function(H){const ee=H.toLowerCase().replace(/_/g,"-");return Object.values(_t).indexOf(ee)>=0?ee:_t.UNKNOWN}(F.status);E(new Wt(j,F.message))}else E(new Wt(_t.UNKNOWN,"Server responded with status "+v.getStatus()))}else E(new Wt(_t.UNAVAILABLE,"Connection failed."));break;default:Fn()}}finally{Zt(Ia,`RPC '${t}' ${d} completed.`)}});const b=JSON.stringify(l);Zt(Ia,`RPC '${t}' ${d} sending request:`,l),v.send(i,"POST",b,a,15)})}Wo(t,i,a){const l=DV(),d=[this.po,"/","google.firestore.v1.Firestore","/",t,"/channel"],p=kre(),E=Ore(),v={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},b=this.longPollingOptions.timeoutSeconds;b!==void 0&&(v.longPollingTimeout=Math.round(1e3*b)),this.useFetchStreams&&(v.useFetchStreams=!0),this.Do(v.initMessageHeaders,i,a),v.encodeInitMessageHeaders=!0;const w=d.join("");Zt(Ia,`Creating RPC '${t}' stream ${l}: ${w}`,v);const A=p.createWebChannel(w,v);let N=!1,F=!1;const j=new L4e({Fo:H=>{F?Zt(Ia,`Not sending because RPC '${t}' stream ${l} is closed:`,H):(N||(Zt(Ia,`Opening RPC '${t}' stream ${l} transport.`),A.open(),N=!0),Zt(Ia,`RPC '${t}' stream ${l} sending:`,H),A.send(H))},Mo:()=>A.close()}),B=(H,ee,K)=>{H.listen(ee,te=>{try{K(te)}catch(le){setTimeout(()=>{throw le},0)}})};return B(A,xw.EventType.OPEN,()=>{F||(Zt(Ia,`RPC '${t}' stream ${l} transport opened.`),j.Qo())}),B(A,xw.EventType.CLOSE,()=>{F||(F=!0,Zt(Ia,`RPC '${t}' stream ${l} transport closed`),j.Ko())}),B(A,xw.EventType.ERROR,H=>{F||(F=!0,f0(Ia,`RPC '${t}' stream ${l} transport errored:`,H),j.Ko(new Wt(_t.UNAVAILABLE,"The operation could not be completed")))}),B(A,xw.EventType.MESSAGE,H=>{var ee;if(!F){const K=H.data[0];ii(!!K);const te=K,le=(te==null?void 0:te.error)||((ee=te[0])===null||ee===void 0?void 0:ee.error);if(le){Zt(Ia,`RPC '${t}' stream ${l} received error:`,le);const oe=le.status;let ge=function(ne){const se=Go[ne];if(se!==void 0)return lie(se)}(oe),Z=le.message;ge===void 0&&(ge=_t.INTERNAL,Z="Unknown error status: "+oe+" with message "+le.message),F=!0,j.Ko(new Wt(ge,Z)),A.close()}else Zt(Ia,`RPC '${t}' stream ${l} received:`,K),j.Uo(K)}}),B(E,Pre.STAT_EVENT,H=>{H.stat===SV.PROXY?Zt(Ia,`RPC '${t}' stream ${l} detected buffering proxy`):H.stat===SV.NOPROXY&&Zt(Ia,`RPC '${t}' stream ${l} detected no buffering proxy`)}),setTimeout(()=>{j.$o()},0),j}}function eU(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function XN(n){return new Fje(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tie{constructor(t,i,a=1e3,l=1.5,d=6e4){this.Ti=t,this.timerId=i,this.Go=a,this.zo=l,this.jo=d,this.Ho=0,this.Jo=null,this.Yo=Date.now(),this.reset()}reset(){this.Ho=0}Zo(){this.Ho=this.jo}Xo(t){this.cancel();const i=Math.floor(this.Ho+this.e_()),a=Math.max(0,Date.now()-this.Yo),l=Math.max(0,i-a);l>0&&Zt("ExponentialBackoff",`Backing off for ${l} ms (base delay: ${this.Ho} ms, delay with jitter: ${i} ms, last attempt: ${a} ms ago)`),this.Jo=this.Ti.enqueueAfterDelay(this.timerId,l,()=>(this.Yo=Date.now(),t())),this.Ho*=this.zo,this.Ho<this.Go&&(this.Ho=this.Go),this.Ho>this.jo&&(this.Ho=this.jo)}t_(){this.Jo!==null&&(this.Jo.skipDelay(),this.Jo=null)}cancel(){this.Jo!==null&&(this.Jo.cancel(),this.Jo=null)}e_(){return(Math.random()-.5)*this.Ho}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $X="PersistentStream";class wie{constructor(t,i,a,l,d,p,E,v){this.Ti=t,this.n_=a,this.r_=l,this.connection=d,this.authCredentialsProvider=p,this.appCheckCredentialsProvider=E,this.listener=v,this.state=0,this.i_=0,this.s_=null,this.o_=null,this.stream=null,this.__=0,this.a_=new Tie(t,i)}u_(){return this.state===1||this.state===5||this.c_()}c_(){return this.state===2||this.state===3}start(){this.__=0,this.state!==4?this.auth():this.l_()}async stop(){this.u_()&&await this.close(0)}h_(){this.state=0,this.a_.reset()}P_(){this.c_()&&this.s_===null&&(this.s_=this.Ti.enqueueAfterDelay(this.n_,6e4,()=>this.T_()))}I_(t){this.E_(),this.stream.send(t)}async T_(){if(this.c_())return this.close(0)}E_(){this.s_&&(this.s_.cancel(),this.s_=null)}d_(){this.o_&&(this.o_.cancel(),this.o_=null)}async close(t,i){this.E_(),this.d_(),this.a_.cancel(),this.i_++,t!==4?this.a_.reset():i&&i.code===_t.RESOURCE_EXHAUSTED?(Np(i.toString()),Np("Using maximum backoff delay to prevent overloading the backend."),this.a_.Zo()):i&&i.code===_t.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.A_(),this.stream.close(),this.stream=null),this.state=t,await this.listener.Lo(i)}A_(){}auth(){this.state=1;const t=this.R_(this.i_),i=this.i_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([a,l])=>{this.i_===i&&this.V_(a,l)},a=>{t(()=>{const l=new Wt(_t.UNKNOWN,"Fetching auth token failed: "+a.message);return this.m_(l)})})}V_(t,i){const a=this.R_(this.i_);this.stream=this.f_(t,i),this.stream.xo(()=>{a(()=>this.listener.xo())}),this.stream.No(()=>{a(()=>(this.state=2,this.o_=this.Ti.enqueueAfterDelay(this.r_,1e4,()=>(this.c_()&&(this.state=3),Promise.resolve())),this.listener.No()))}),this.stream.Lo(l=>{a(()=>this.m_(l))}),this.stream.onMessage(l=>{a(()=>++this.__==1?this.g_(l):this.onNext(l))})}l_(){this.state=5,this.a_.Xo(async()=>{this.state=0,this.start()})}m_(t){return Zt($X,`close with error: ${t}`),this.stream=null,this.close(4,t)}R_(t){return i=>{this.Ti.enqueueAndForget(()=>this.i_===t?i():(Zt($X,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class M4e extends wie{constructor(t,i,a,l,d,p){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",i,a,l,p),this.serializer=d}f_(t,i){return this.connection.Wo("Listen",t,i)}g_(t){return this.onNext(t)}onNext(t){this.a_.reset();const i=Wje(this.serializer,t),a=function(d){if(!("targetChange"in d))return Gn.min();const p=d.targetChange;return p.targetIds&&p.targetIds.length?Gn.min():p.readTime?ef(p.readTime):Gn.min()}(t);return this.listener.p_(i,a)}y_(t){const i={};i.database=kV(this.serializer),i.addTarget=function(d,p){let E;const v=p.target;if(E=RV(v)?{documents:Hje(d,v)}:{query:$je(d,v).ht},E.targetId=p.targetId,p.resumeToken.approximateByteSize()>0){E.resumeToken=hie(d,p.resumeToken);const b=AV(d,p.expectedCount);b!==null&&(E.expectedCount=b)}else if(p.snapshotVersion.compareTo(Gn.min())>0){E.readTime=Hk(d,p.snapshotVersion.toTimestamp());const b=AV(d,p.expectedCount);b!==null&&(E.expectedCount=b)}return E}(this.serializer,t);const a=qje(this.serializer,t);a&&(i.labels=a),this.I_(i)}w_(t){const i={};i.database=kV(this.serializer),i.removeTarget=t,this.I_(i)}}class U4e extends wie{constructor(t,i,a,l,d,p){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",i,a,l,p),this.serializer=d}get b_(){return this.__>0}start(){this.lastStreamToken=void 0,super.start()}A_(){this.b_&&this.S_([])}f_(t,i){return this.connection.Wo("Write",t,i)}g_(t){return ii(!!t.streamToken),this.lastStreamToken=t.streamToken,ii(!t.writeResults||t.writeResults.length===0),this.listener.D_()}onNext(t){ii(!!t.streamToken),this.lastStreamToken=t.streamToken,this.a_.reset();const i=Gje(t.writeResults,t.commitTime),a=ef(t.commitTime);return this.listener.v_(a,i)}C_(){const t={};t.database=kV(this.serializer),this.I_(t)}S_(t){const i={streamToken:this.lastStreamToken,writes:t.map(a=>zje(this.serializer,a))};this.I_(i)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class V4e{}class F4e extends V4e{constructor(t,i,a,l){super(),this.authCredentials=t,this.appCheckCredentials=i,this.connection=a,this.serializer=l,this.F_=!1}M_(){if(this.F_)throw new Wt(_t.FAILED_PRECONDITION,"The client has already been terminated.")}bo(t,i,a,l){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([d,p])=>this.connection.bo(t,PV(i,a),l,d,p)).catch(d=>{throw d.name==="FirebaseError"?(d.code===_t.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),d):new Wt(_t.UNKNOWN,d.toString())})}Co(t,i,a,l,d){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([p,E])=>this.connection.Co(t,PV(i,a),l,p,E,d)).catch(p=>{throw p.name==="FirebaseError"?(p.code===_t.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),p):new Wt(_t.UNKNOWN,p.toString())})}terminate(){this.F_=!0,this.connection.terminate()}}class j4e{constructor(t,i){this.asyncQueue=t,this.onlineStateHandler=i,this.state="Unknown",this.x_=0,this.O_=null,this.N_=!0}B_(){this.x_===0&&(this.L_("Unknown"),this.O_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.O_=null,this.k_("Backend didn't respond within 10 seconds."),this.L_("Offline"),Promise.resolve())))}q_(t){this.state==="Online"?this.L_("Unknown"):(this.x_++,this.x_>=1&&(this.Q_(),this.k_(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.L_("Offline")))}set(t){this.Q_(),this.x_=0,t==="Online"&&(this.N_=!1),this.L_(t)}L_(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}k_(t){const i=`Could not reach Cloud Firestore backend. ${t}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.N_?(Np(i),this.N_=!1):Zt("OnlineStateTracker",i)}Q_(){this.O_!==null&&(this.O_.cancel(),this.O_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xE="RemoteStore";class B4e{constructor(t,i,a,l,d){this.localStore=t,this.datastore=i,this.asyncQueue=a,this.remoteSyncer={},this.K_=[],this.U_=new Map,this.W_=new Set,this.G_=[],this.z_=d,this.z_.To(p=>{a.enqueueAndForget(async()=>{zE(this)&&(Zt(xE,"Restarting streams for network reachability change."),await async function(v){const b=qn(v);b.W_.add(4),await lC(b),b.j_.set("Unknown"),b.W_.delete(4),await JN(b)}(this))})}),this.j_=new j4e(a,l)}}async function JN(n){if(zE(n))for(const t of n.G_)await t(!0)}async function lC(n){for(const t of n.G_)await t(!1)}function Rie(n,t){const i=qn(n);i.U_.has(t.targetId)||(i.U_.set(t.targetId,t),e4(i)?Zj(i):U0(i).c_()&&Qj(i,t))}function Jj(n,t){const i=qn(n),a=U0(i);i.U_.delete(t),a.c_()&&Cie(i,t),i.U_.size===0&&(a.c_()?a.P_():zE(i)&&i.j_.set("Unknown"))}function Qj(n,t){if(n.H_.Ne(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(Gn.min())>0){const i=n.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(i)}U0(n).y_(t)}function Cie(n,t){n.H_.Ne(t),U0(n).w_(t)}function Zj(n){n.H_=new xje({getRemoteKeysForTarget:t=>n.remoteSyncer.getRemoteKeysForTarget(t),lt:t=>n.U_.get(t)||null,it:()=>n.datastore.serializer.databaseId}),U0(n).start(),n.j_.B_()}function e4(n){return zE(n)&&!U0(n).u_()&&n.U_.size>0}function zE(n){return qn(n).W_.size===0}function Iie(n){n.H_=void 0}async function W4e(n){n.j_.set("Online")}async function z4e(n){n.U_.forEach((t,i)=>{Qj(n,t)})}async function G4e(n,t){Iie(n),e4(n)?(n.j_.q_(t),Zj(n)):n.j_.set("Unknown")}async function H4e(n,t,i){if(n.j_.set("Online"),t instanceof die&&t.state===2&&t.cause)try{await async function(l,d){const p=d.cause;for(const E of d.targetIds)l.U_.has(E)&&(await l.remoteSyncer.rejectListen(E,p),l.U_.delete(E),l.H_.removeTarget(E))}(n,t)}catch(a){Zt(xE,"Failed to remove targets %s: %s ",t.targetIds.join(","),a),await Kk(n,a)}else if(t instanceof ak?n.H_.We(t):t instanceof uie?n.H_.Ze(t):n.H_.je(t),!i.isEqual(Gn.min()))try{const a=await bie(n.localStore);i.compareTo(a)>=0&&await function(d,p){const E=d.H_.ot(p);return E.targetChanges.forEach((v,b)=>{if(v.resumeToken.approximateByteSize()>0){const w=d.U_.get(b);w&&d.U_.set(b,w.withResumeToken(v.resumeToken,p))}}),E.targetMismatches.forEach((v,b)=>{const w=d.U_.get(v);if(!w)return;d.U_.set(v,w.withResumeToken(ra.EMPTY_BYTE_STRING,w.snapshotVersion)),Cie(d,v);const A=new sg(w.target,v,b,w.sequenceNumber);Qj(d,A)}),d.remoteSyncer.applyRemoteEvent(E)}(n,i)}catch(a){Zt(xE,"Failed to raise snapshot:",a),await Kk(n,a)}}async function Kk(n,t,i){if(!M0(t))throw t;n.W_.add(1),await lC(n),n.j_.set("Offline"),i||(i=()=>bie(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{Zt(xE,"Retrying IndexedDB access"),await i(),n.W_.delete(1),await JN(n)})}function Aie(n,t){return t().catch(i=>Kk(n,i,t))}async function QN(n){const t=qn(n),i=Tg(t);let a=t.K_.length>0?t.K_[t.K_.length-1].batchId:Vj;for(;$4e(t);)try{const l=await I4e(t.localStore,a);if(l===null){t.K_.length===0&&i.P_();break}a=l.batchId,K4e(t,l)}catch(l){await Kk(t,l)}Pie(t)&&Oie(t)}function $4e(n){return zE(n)&&n.K_.length<10}function K4e(n,t){n.K_.push(t);const i=Tg(n);i.c_()&&i.b_&&i.S_(t.mutations)}function Pie(n){return zE(n)&&!Tg(n).u_()&&n.K_.length>0}function Oie(n){Tg(n).start()}async function q4e(n){Tg(n).C_()}async function Y4e(n){const t=Tg(n);for(const i of n.K_)t.S_(i.mutations)}async function X4e(n,t,i){const a=n.K_.shift(),l=Gj.from(a,t,i);await Aie(n,()=>n.remoteSyncer.applySuccessfulWrite(l)),await QN(n)}async function J4e(n,t){t&&Tg(n).b_&&await async function(a,l){if(function(p){return Nje(p)&&p!==_t.ABORTED}(l.code)){const d=a.K_.shift();Tg(a).h_(),await Aie(a,()=>a.remoteSyncer.rejectFailedWrite(d.batchId,l)),await QN(a)}}(n,t),Pie(n)&&Oie(n)}async function KX(n,t){const i=qn(n);i.asyncQueue.verifyOperationInProgress(),Zt(xE,"RemoteStore received new credentials");const a=zE(i);i.W_.add(3),await lC(i),a&&i.j_.set("Unknown"),await i.remoteSyncer.handleCredentialChange(t),i.W_.delete(3),await JN(i)}async function Q4e(n,t){const i=qn(n);t?(i.W_.delete(2),await JN(i)):t||(i.W_.add(2),await lC(i),i.j_.set("Unknown"))}function U0(n){return n.J_||(n.J_=function(i,a,l){const d=qn(i);return d.M_(),new M4e(a,d.connection,d.authCredentials,d.appCheckCredentials,d.serializer,l)}(n.datastore,n.asyncQueue,{xo:W4e.bind(null,n),No:z4e.bind(null,n),Lo:G4e.bind(null,n),p_:H4e.bind(null,n)}),n.G_.push(async t=>{t?(n.J_.h_(),e4(n)?Zj(n):n.j_.set("Unknown")):(await n.J_.stop(),Iie(n))})),n.J_}function Tg(n){return n.Y_||(n.Y_=function(i,a,l){const d=qn(i);return d.M_(),new U4e(a,d.connection,d.authCredentials,d.appCheckCredentials,d.serializer,l)}(n.datastore,n.asyncQueue,{xo:()=>Promise.resolve(),No:q4e.bind(null,n),Lo:J4e.bind(null,n),D_:Y4e.bind(null,n),v_:X4e.bind(null,n)}),n.G_.push(async t=>{t?(n.Y_.h_(),await QN(n)):(await n.Y_.stop(),n.K_.length>0&&(Zt(xE,`Stopping write stream with ${n.K_.length} pending writes`),n.K_=[]))})),n.Y_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class t4{constructor(t,i,a,l,d){this.asyncQueue=t,this.timerId=i,this.targetTimeMs=a,this.op=l,this.removalCallback=d,this.deferred=new Rp,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(p=>{})}get promise(){return this.deferred.promise}static createAndSchedule(t,i,a,l,d){const p=Date.now()+a,E=new t4(t,i,p,l,d);return E.start(a),E}start(t){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Wt(_t.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(t=>this.deferred.resolve(t))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function n4(n,t){if(Np("AsyncQueue",`${t}: ${n}`),M0(n))return new Wt(_t.UNAVAILABLE,`${t}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XS{static emptySet(t){return new XS(t.comparator)}constructor(t){this.comparator=t?(i,a)=>t(i,a)||En.comparator(i.key,a.key):(i,a)=>En.comparator(i.key,a.key),this.keyedMap=Mw(),this.sortedSet=new lo(this.comparator)}has(t){return this.keyedMap.get(t)!=null}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const i=this.keyedMap.get(t);return i?this.sortedSet.indexOf(i):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal((i,a)=>(t(i),!1))}add(t){const i=this.delete(t.key);return i.copy(i.keyedMap.insert(t.key,t),i.sortedSet.insert(t,null))}delete(t){const i=this.get(t);return i?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(i)):this}isEqual(t){if(!(t instanceof XS)||this.size!==t.size)return!1;const i=this.sortedSet.getIterator(),a=t.sortedSet.getIterator();for(;i.hasNext();){const l=i.getNext().key,d=a.getNext().key;if(!l.isEqual(d))return!1}return!0}toString(){const t=[];return this.forEach(i=>{t.push(i.toString())}),t.length===0?"DocumentSet ()":`DocumentSet (
  `+t.join(`  
`)+`
)`}copy(t,i){const a=new XS;return a.comparator=this.comparator,a.keyedMap=t,a.sortedSet=i,a}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qX{constructor(){this.Z_=new lo(En.comparator)}track(t){const i=t.doc.key,a=this.Z_.get(i);a?t.type!==0&&a.type===3?this.Z_=this.Z_.insert(i,t):t.type===3&&a.type!==1?this.Z_=this.Z_.insert(i,{type:a.type,doc:t.doc}):t.type===2&&a.type===2?this.Z_=this.Z_.insert(i,{type:2,doc:t.doc}):t.type===2&&a.type===0?this.Z_=this.Z_.insert(i,{type:0,doc:t.doc}):t.type===1&&a.type===0?this.Z_=this.Z_.remove(i):t.type===1&&a.type===2?this.Z_=this.Z_.insert(i,{type:1,doc:a.doc}):t.type===0&&a.type===1?this.Z_=this.Z_.insert(i,{type:2,doc:t.doc}):Fn():this.Z_=this.Z_.insert(i,t)}X_(){const t=[];return this.Z_.inorderTraversal((i,a)=>{t.push(a)}),t}}class y0{constructor(t,i,a,l,d,p,E,v,b){this.query=t,this.docs=i,this.oldDocs=a,this.docChanges=l,this.mutatedKeys=d,this.fromCache=p,this.syncStateChanged=E,this.excludesMetadataChanges=v,this.hasCachedResults=b}static fromInitialDocuments(t,i,a,l,d){const p=[];return i.forEach(E=>{p.push({type:0,doc:E})}),new y0(t,i,XS.emptySet(i),p,a,l,!0,!1,d)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&HN(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const i=this.docChanges,a=t.docChanges;if(i.length!==a.length)return!1;for(let l=0;l<i.length;l++)if(i[l].type!==a[l].type||!i[l].doc.isEqual(a[l].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Z4e{constructor(){this.ea=void 0,this.ta=[]}na(){return this.ta.some(t=>t.ra())}}class e3e{constructor(){this.queries=YX(),this.onlineState="Unknown",this.ia=new Set}terminate(){(function(i,a){const l=qn(i),d=l.queries;l.queries=YX(),d.forEach((p,E)=>{for(const v of E.ta)v.onError(a)})})(this,new Wt(_t.ABORTED,"Firestore shutting down"))}}function YX(){return new WE(n=>Xre(n),HN)}async function r4(n,t){const i=qn(n);let a=3;const l=t.query;let d=i.queries.get(l);d?!d.na()&&t.ra()&&(a=2):(d=new Z4e,a=t.ra()?0:1);try{switch(a){case 0:d.ea=await i.onListen(l,!0);break;case 1:d.ea=await i.onListen(l,!1);break;case 2:await i.onFirstRemoteStoreListen(l)}}catch(p){const E=n4(p,`Initialization of query '${ES(t.query)}' failed`);return void t.onError(E)}i.queries.set(l,d),d.ta.push(t),t.sa(i.onlineState),d.ea&&t.oa(d.ea)&&o4(i)}async function i4(n,t){const i=qn(n),a=t.query;let l=3;const d=i.queries.get(a);if(d){const p=d.ta.indexOf(t);p>=0&&(d.ta.splice(p,1),d.ta.length===0?l=t.ra()?0:1:!d.na()&&t.ra()&&(l=2))}switch(l){case 0:return i.queries.delete(a),i.onUnlisten(a,!0);case 1:return i.queries.delete(a),i.onUnlisten(a,!1);case 2:return i.onLastRemoteStoreUnlisten(a);default:return}}function t3e(n,t){const i=qn(n);let a=!1;for(const l of t){const d=l.query,p=i.queries.get(d);if(p){for(const E of p.ta)E.oa(l)&&(a=!0);p.ea=l}}a&&o4(i)}function n3e(n,t,i){const a=qn(n),l=a.queries.get(t);if(l)for(const d of l.ta)d.onError(i);a.queries.delete(t)}function o4(n){n.ia.forEach(t=>{t.next()})}var LV,XX;(XX=LV||(LV={}))._a="default",XX.Cache="cache";class s4{constructor(t,i,a){this.query=t,this.aa=i,this.ua=!1,this.ca=null,this.onlineState="Unknown",this.options=a||{}}oa(t){if(!this.options.includeMetadataChanges){const a=[];for(const l of t.docChanges)l.type!==3&&a.push(l);t=new y0(t.query,t.docs,t.oldDocs,a,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let i=!1;return this.ua?this.la(t)&&(this.aa.next(t),i=!0):this.ha(t,this.onlineState)&&(this.Pa(t),i=!0),this.ca=t,i}onError(t){this.aa.error(t)}sa(t){this.onlineState=t;let i=!1;return this.ca&&!this.ua&&this.ha(this.ca,t)&&(this.Pa(this.ca),i=!0),i}ha(t,i){if(!t.fromCache||!this.ra())return!0;const a=i!=="Offline";return(!this.options.Ta||!a)&&(!t.docs.isEmpty()||t.hasCachedResults||i==="Offline")}la(t){if(t.docChanges.length>0)return!0;const i=this.ca&&this.ca.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!i)&&this.options.includeMetadataChanges===!0}Pa(t){t=y0.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.ua=!0,this.aa.next(t)}ra(){return this.options.source!==LV.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kie{constructor(t){this.key=t}}class Nie{constructor(t){this.key=t}}class r3e{constructor(t,i){this.query=t,this.fa=i,this.ga=null,this.hasCachedResults=!1,this.current=!1,this.pa=br(),this.mutatedKeys=br(),this.ya=Jre(t),this.wa=new XS(this.ya)}get ba(){return this.fa}Sa(t,i){const a=i?i.Da:new qX,l=i?i.wa:this.wa;let d=i?i.mutatedKeys:this.mutatedKeys,p=l,E=!1;const v=this.query.limitType==="F"&&l.size===this.query.limit?l.last():null,b=this.query.limitType==="L"&&l.size===this.query.limit?l.first():null;if(t.inorderTraversal((w,A)=>{const N=l.get(w),F=$N(this.query,A)?A:null,j=!!N&&this.mutatedKeys.has(N.key),B=!!F&&(F.hasLocalMutations||this.mutatedKeys.has(F.key)&&F.hasCommittedMutations);let H=!1;N&&F?N.data.isEqual(F.data)?j!==B&&(a.track({type:3,doc:F}),H=!0):this.va(N,F)||(a.track({type:2,doc:F}),H=!0,(v&&this.ya(F,v)>0||b&&this.ya(F,b)<0)&&(E=!0)):!N&&F?(a.track({type:0,doc:F}),H=!0):N&&!F&&(a.track({type:1,doc:N}),H=!0,(v||b)&&(E=!0)),H&&(F?(p=p.add(F),d=B?d.add(w):d.delete(w)):(p=p.delete(w),d=d.delete(w)))}),this.query.limit!==null)for(;p.size>this.query.limit;){const w=this.query.limitType==="F"?p.last():p.first();p=p.delete(w.key),d=d.delete(w.key),a.track({type:1,doc:w})}return{wa:p,Da:a,ls:E,mutatedKeys:d}}va(t,i){return t.hasLocalMutations&&i.hasCommittedMutations&&!i.hasLocalMutations}applyChanges(t,i,a,l){const d=this.wa;this.wa=t.wa,this.mutatedKeys=t.mutatedKeys;const p=t.Da.X_();p.sort((w,A)=>function(F,j){const B=H=>{switch(H){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Fn()}};return B(F)-B(j)}(w.type,A.type)||this.ya(w.doc,A.doc)),this.Ca(a),l=l!=null&&l;const E=i&&!l?this.Fa():[],v=this.pa.size===0&&this.current&&!l?1:0,b=v!==this.ga;return this.ga=v,p.length!==0||b?{snapshot:new y0(this.query,t.wa,d,p,t.mutatedKeys,v===0,b,!1,!!a&&a.resumeToken.approximateByteSize()>0),Ma:E}:{Ma:E}}sa(t){return this.current&&t==="Offline"?(this.current=!1,this.applyChanges({wa:this.wa,Da:new qX,mutatedKeys:this.mutatedKeys,ls:!1},!1)):{Ma:[]}}xa(t){return!this.fa.has(t)&&!!this.wa.has(t)&&!this.wa.get(t).hasLocalMutations}Ca(t){t&&(t.addedDocuments.forEach(i=>this.fa=this.fa.add(i)),t.modifiedDocuments.forEach(i=>{}),t.removedDocuments.forEach(i=>this.fa=this.fa.delete(i)),this.current=t.current)}Fa(){if(!this.current)return[];const t=this.pa;this.pa=br(),this.wa.forEach(a=>{this.xa(a.key)&&(this.pa=this.pa.add(a.key))});const i=[];return t.forEach(a=>{this.pa.has(a)||i.push(new Nie(a))}),this.pa.forEach(a=>{t.has(a)||i.push(new kie(a))}),i}Oa(t){this.fa=t.gs,this.pa=br();const i=this.Sa(t.documents);return this.applyChanges(i,!0)}Na(){return y0.fromInitialDocuments(this.query,this.wa,this.mutatedKeys,this.ga===0,this.hasCachedResults)}}const a4="SyncEngine";class i3e{constructor(t,i,a){this.query=t,this.targetId=i,this.view=a}}class o3e{constructor(t){this.key=t,this.Ba=!1}}class s3e{constructor(t,i,a,l,d,p){this.localStore=t,this.remoteStore=i,this.eventManager=a,this.sharedClientState=l,this.currentUser=d,this.maxConcurrentLimboResolutions=p,this.La={},this.ka=new WE(E=>Xre(E),HN),this.qa=new Map,this.Qa=new Set,this.$a=new lo(En.comparator),this.Ka=new Map,this.Ua=new Kj,this.Wa={},this.Ga=new Map,this.za=E0.Un(),this.onlineState="Unknown",this.ja=void 0}get isPrimaryClient(){return this.ja===!0}}async function a3e(n,t,i=!0){const a=Vie(n);let l;const d=a.ka.get(t);return d?(a.sharedClientState.addLocalQueryTarget(d.targetId),l=d.view.Na()):l=await Die(a,t,i,!0),l}async function c3e(n,t){const i=Vie(n);await Die(i,t,!0,!1)}async function Die(n,t,i,a){const l=await A4e(n.localStore,Qh(t)),d=l.targetId,p=n.sharedClientState.addLocalQueryTarget(d,i);let E;return a&&(E=await l3e(n,t,d,p==="current",l.resumeToken)),n.isPrimaryClient&&i&&Rie(n.remoteStore,l),E}async function l3e(n,t,i,a,l){n.Ha=(A,N,F)=>async function(B,H,ee,K){let te=H.view.Sa(ee);te.ls&&(te=await WX(B.localStore,H.query,!1).then(({documents:Z})=>H.view.Sa(Z,te)));const le=K&&K.targetChanges.get(H.targetId),oe=K&&K.targetMismatches.get(H.targetId)!=null,ge=H.view.applyChanges(te,B.isPrimaryClient,le,oe);return QX(B,H.targetId,ge.Ma),ge.snapshot}(n,A,N,F);const d=await WX(n.localStore,t,!0),p=new r3e(t,d.gs),E=p.Sa(d.documents),v=cC.createSynthesizedTargetChangeForCurrentChange(i,a&&n.onlineState!=="Offline",l),b=p.applyChanges(E,n.isPrimaryClient,v);QX(n,i,b.Ma);const w=new i3e(t,i,p);return n.ka.set(t,w),n.qa.has(i)?n.qa.get(i).push(t):n.qa.set(i,[t]),b.snapshot}async function u3e(n,t,i){const a=qn(n),l=a.ka.get(t),d=a.qa.get(l.targetId);if(d.length>1)return a.qa.set(l.targetId,d.filter(p=>!HN(p,t))),void a.ka.delete(t);a.isPrimaryClient?(a.sharedClientState.removeLocalQueryTarget(l.targetId),a.sharedClientState.isActiveQueryTarget(l.targetId)||await NV(a.localStore,l.targetId,!1).then(()=>{a.sharedClientState.clearQueryState(l.targetId),i&&Jj(a.remoteStore,l.targetId),xV(a,l.targetId)}).catch(x0)):(xV(a,l.targetId),await NV(a.localStore,l.targetId,!0))}async function d3e(n,t){const i=qn(n),a=i.ka.get(t),l=i.qa.get(a.targetId);i.isPrimaryClient&&l.length===1&&(i.sharedClientState.removeLocalQueryTarget(a.targetId),Jj(i.remoteStore,a.targetId))}async function h3e(n,t,i){const a=y3e(n);try{const l=await function(p,E){const v=qn(p),b=as.now(),w=E.reduce((F,j)=>F.add(j.key),br());let A,N;return v.persistence.runTransaction("Locally write mutations","readwrite",F=>{let j=Dp(),B=br();return v.ds.getEntries(F,w).next(H=>{j=H,j.forEach((ee,K)=>{K.isValidDocument()||(B=B.add(ee))})}).next(()=>v.localDocuments.getOverlayedDocuments(F,j)).next(H=>{A=H;const ee=[];for(const K of E){const te=Ije(K,A.get(K.key).overlayedDocument);te!=null&&ee.push(new Og(K.key,te,zre(te.value.mapValue),Zh.exists(!0)))}return v.mutationQueue.addMutationBatch(F,b,ee,E)}).next(H=>{N=H;const ee=H.applyToLocalDocumentSet(A,B);return v.documentOverlayCache.saveOverlays(F,H.batchId,ee)})}).then(()=>({batchId:N.batchId,changes:Zre(A)}))}(a.localStore,t);a.sharedClientState.addPendingMutation(l.batchId),function(p,E,v){let b=p.Wa[p.currentUser.toKey()];b||(b=new lo(Ar)),b=b.insert(E,v),p.Wa[p.currentUser.toKey()]=b}(a,l.batchId,i),await uC(a,l.changes),await QN(a.remoteStore)}catch(l){const d=n4(l,"Failed to persist write");i.reject(d)}}async function Lie(n,t){const i=qn(n);try{const a=await R4e(i.localStore,t);t.targetChanges.forEach((l,d)=>{const p=i.Ka.get(d);p&&(ii(l.addedDocuments.size+l.modifiedDocuments.size+l.removedDocuments.size<=1),l.addedDocuments.size>0?p.Ba=!0:l.modifiedDocuments.size>0?ii(p.Ba):l.removedDocuments.size>0&&(ii(p.Ba),p.Ba=!1))}),await uC(i,a,t)}catch(a){await x0(a)}}function JX(n,t,i){const a=qn(n);if(a.isPrimaryClient&&i===0||!a.isPrimaryClient&&i===1){const l=[];a.ka.forEach((d,p)=>{const E=p.view.sa(t);E.snapshot&&l.push(E.snapshot)}),function(p,E){const v=qn(p);v.onlineState=E;let b=!1;v.queries.forEach((w,A)=>{for(const N of A.ta)N.sa(E)&&(b=!0)}),b&&o4(v)}(a.eventManager,t),l.length&&a.La.p_(l),a.onlineState=t,a.isPrimaryClient&&a.sharedClientState.setOnlineState(t)}}async function f3e(n,t,i){const a=qn(n);a.sharedClientState.updateQueryState(t,"rejected",i);const l=a.Ka.get(t),d=l&&l.key;if(d){let p=new lo(En.comparator);p=p.insert(d,Na.newNoDocument(d,Gn.min()));const E=br().add(d),v=new YN(Gn.min(),new Map,new lo(Ar),p,E);await Lie(a,v),a.$a=a.$a.remove(d),a.Ka.delete(t),c4(a)}else await NV(a.localStore,t,!1).then(()=>xV(a,t,i)).catch(x0)}async function p3e(n,t){const i=qn(n),a=t.batch.batchId;try{const l=await w4e(i.localStore,t);Mie(i,a,null),xie(i,a),i.sharedClientState.updateMutationState(a,"acknowledged"),await uC(i,l)}catch(l){await x0(l)}}async function m3e(n,t,i){const a=qn(n);try{const l=await function(p,E){const v=qn(p);return v.persistence.runTransaction("Reject batch","readwrite-primary",b=>{let w;return v.mutationQueue.lookupMutationBatch(b,E).next(A=>(ii(A!==null),w=A.keys(),v.mutationQueue.removeMutationBatch(b,A))).next(()=>v.mutationQueue.performConsistencyCheck(b)).next(()=>v.documentOverlayCache.removeOverlaysForBatchId(b,w,E)).next(()=>v.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(b,w)).next(()=>v.localDocuments.getDocuments(b,w))})}(a.localStore,t);Mie(a,t,i),xie(a,t),a.sharedClientState.updateMutationState(t,"rejected",i),await uC(a,l)}catch(l){await x0(l)}}function xie(n,t){(n.Ga.get(t)||[]).forEach(i=>{i.resolve()}),n.Ga.delete(t)}function Mie(n,t,i){const a=qn(n);let l=a.Wa[a.currentUser.toKey()];if(l){const d=l.get(t);d&&(i?d.reject(i):d.resolve(),l=l.remove(t)),a.Wa[a.currentUser.toKey()]=l}}function xV(n,t,i=null){n.sharedClientState.removeLocalQueryTarget(t);for(const a of n.qa.get(t))n.ka.delete(a),i&&n.La.Ja(a,i);n.qa.delete(t),n.isPrimaryClient&&n.Ua.Sr(t).forEach(a=>{n.Ua.containsKey(a)||Uie(n,a)})}function Uie(n,t){n.Qa.delete(t.path.canonicalString());const i=n.$a.get(t);i!==null&&(Jj(n.remoteStore,i),n.$a=n.$a.remove(t),n.Ka.delete(i),c4(n))}function QX(n,t,i){for(const a of i)a instanceof kie?(n.Ua.addReference(a.key,t),g3e(n,a)):a instanceof Nie?(Zt(a4,"Document no longer in limbo: "+a.key),n.Ua.removeReference(a.key,t),n.Ua.containsKey(a.key)||Uie(n,a.key)):Fn()}function g3e(n,t){const i=t.key,a=i.path.canonicalString();n.$a.get(i)||n.Qa.has(a)||(Zt(a4,"New document in limbo: "+i),n.Qa.add(a),c4(n))}function c4(n){for(;n.Qa.size>0&&n.$a.size<n.maxConcurrentLimboResolutions;){const t=n.Qa.values().next().value;n.Qa.delete(t);const i=new En(Di.fromString(t)),a=n.za.next();n.Ka.set(a,new o3e(i)),n.$a=n.$a.insert(i,a),Rie(n.remoteStore,new sg(Qh(GN(i.path)),a,"TargetPurposeLimboResolution",jN.ae))}}async function uC(n,t,i){const a=qn(n),l=[],d=[],p=[];a.ka.isEmpty()||(a.ka.forEach((E,v)=>{p.push(a.Ha(v,t,i).then(b=>{var w;if((b||i)&&a.isPrimaryClient){const A=b?!b.fromCache:(w=i==null?void 0:i.targetChanges.get(v.targetId))===null||w===void 0?void 0:w.current;a.sharedClientState.updateQueryState(v.targetId,A?"current":"not-current")}if(b){l.push(b);const A=Yj.Yi(v.targetId,b);d.push(A)}}))}),await Promise.all(p),a.La.p_(l),await async function(v,b){const w=qn(v);try{await w.persistence.runTransaction("notifyLocalViewChanges","readwrite",A=>Tt.forEach(b,N=>Tt.forEach(N.Hi,F=>w.persistence.referenceDelegate.addReference(A,N.targetId,F)).next(()=>Tt.forEach(N.Ji,F=>w.persistence.referenceDelegate.removeReference(A,N.targetId,F)))))}catch(A){if(!M0(A))throw A;Zt(Xj,"Failed to update sequence numbers: "+A)}for(const A of b){const N=A.targetId;if(!A.fromCache){const F=w.Ts.get(N),j=F.snapshotVersion,B=F.withLastLimboFreeSnapshotVersion(j);w.Ts=w.Ts.insert(N,B)}}}(a.localStore,d))}async function _3e(n,t){const i=qn(n);if(!i.currentUser.isEqual(t)){Zt(a4,"User change. New user:",t.toKey());const a=await Sie(i.localStore,t);i.currentUser=t,function(d,p){d.Ga.forEach(E=>{E.forEach(v=>{v.reject(new Wt(_t.CANCELLED,p))})}),d.Ga.clear()}(i,"'waitForPendingWrites' promise is rejected due to a user change."),i.sharedClientState.handleUserChange(t,a.removedBatchIds,a.addedBatchIds),await uC(i,a.Rs)}}function E3e(n,t){const i=qn(n),a=i.Ka.get(t);if(a&&a.Ba)return br().add(a.key);{let l=br();const d=i.qa.get(t);if(!d)return l;for(const p of d){const E=i.ka.get(p);l=l.unionWith(E.view.ba)}return l}}function Vie(n){const t=qn(n);return t.remoteStore.remoteSyncer.applyRemoteEvent=Lie.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=E3e.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=f3e.bind(null,t),t.La.p_=t3e.bind(null,t.eventManager),t.La.Ja=n3e.bind(null,t.eventManager),t}function y3e(n){const t=qn(n);return t.remoteStore.remoteSyncer.applySuccessfulWrite=p3e.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=m3e.bind(null,t),t}class qk{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(t){this.serializer=XN(t.databaseInfo.databaseId),this.sharedClientState=this.Za(t),this.persistence=this.Xa(t),await this.persistence.start(),this.localStore=this.eu(t),this.gcScheduler=this.tu(t,this.localStore),this.indexBackfillerScheduler=this.nu(t,this.localStore)}tu(t,i){return null}nu(t,i){return null}eu(t){return T4e(this.persistence,new v4e,t.initialUser,this.serializer)}Xa(t){return new vie(qj.ri,this.serializer)}Za(t){return new O4e}async terminate(){var t,i;(t=this.gcScheduler)===null||t===void 0||t.stop(),(i=this.indexBackfillerScheduler)===null||i===void 0||i.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}qk.provider={build:()=>new qk};class v3e extends qk{constructor(t){super(),this.cacheSizeBytes=t}tu(t,i){ii(this.persistence.referenceDelegate instanceof $k);const a=this.persistence.referenceDelegate.garbageCollector;return new o4e(a,t.asyncQueue,i)}Xa(t){const i=this.cacheSizeBytes!==void 0?Hc.withCacheSize(this.cacheSizeBytes):Hc.DEFAULT;return new vie(a=>$k.ri(a,i),this.serializer)}}class MV{async initialize(t,i){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(i),this.remoteStore=this.createRemoteStore(i),this.eventManager=this.createEventManager(i),this.syncEngine=this.createSyncEngine(i,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=a=>JX(this.syncEngine,a,1),this.remoteStore.remoteSyncer.handleCredentialChange=_3e.bind(null,this.syncEngine),await Q4e(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return function(){return new e3e}()}createDatastore(t){const i=XN(t.databaseInfo.databaseId),a=function(d){return new x4e(d)}(t.databaseInfo);return function(d,p,E,v){return new F4e(d,p,E,v)}(t.authCredentials,t.appCheckCredentials,a,i)}createRemoteStore(t){return function(a,l,d,p,E){return new B4e(a,l,d,p,E)}(this.localStore,this.datastore,t.asyncQueue,i=>JX(this.syncEngine,i,0),function(){return HX.D()?new HX:new k4e}())}createSyncEngine(t,i){return function(l,d,p,E,v,b,w){const A=new s3e(l,d,p,E,v,b);return w&&(A.ja=!0),A}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,i)}async terminate(){var t,i;await async function(l){const d=qn(l);Zt(xE,"RemoteStore shutting down."),d.W_.add(5),await lC(d),d.z_.shutdown(),d.j_.set("Unknown")}(this.remoteStore),(t=this.datastore)===null||t===void 0||t.terminate(),(i=this.eventManager)===null||i===void 0||i.terminate()}}MV.provider={build:()=>new MV};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class l4{constructor(t){this.observer=t,this.muted=!1}next(t){this.muted||this.observer.next&&this.iu(this.observer.next,t)}error(t){this.muted||(this.observer.error?this.iu(this.observer.error,t):Np("Uncaught Error in snapshot listener:",t.toString()))}su(){this.muted=!0}iu(t,i){setTimeout(()=>{this.muted||t(i)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wg="FirestoreClient";class S3e{constructor(t,i,a,l,d){this.authCredentials=t,this.appCheckCredentials=i,this.asyncQueue=a,this.databaseInfo=l,this.user=Oa.UNAUTHENTICATED,this.clientId=Dre.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=d,this.authCredentials.start(a,async p=>{Zt(wg,"Received user=",p.uid),await this.authCredentialListener(p),this.user=p}),this.appCheckCredentials.start(a,p=>(Zt(wg,"Received new app check token=",p),this.appCheckCredentialListener(p,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}terminate(){this.asyncQueue.enterRestrictedMode();const t=new Rp;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(i){const a=n4(i,"Failed to shutdown persistence");t.reject(a)}}),t.promise}}async function tU(n,t){n.asyncQueue.verifyOperationInProgress(),Zt(wg,"Initializing OfflineComponentProvider");const i=n.configuration;await t.initialize(i);let a=i.initialUser;n.setCredentialChangeListener(async l=>{a.isEqual(l)||(await Sie(t.localStore,l),a=l)}),t.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=t}async function ZX(n,t){n.asyncQueue.verifyOperationInProgress();const i=await b3e(n);Zt(wg,"Initializing OnlineComponentProvider"),await t.initialize(i,n.configuration),n.setCredentialChangeListener(a=>KX(t.remoteStore,a)),n.setAppCheckTokenChangeListener((a,l)=>KX(t.remoteStore,l)),n._onlineComponents=t}async function b3e(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){Zt(wg,"Using user provided OfflineComponentProvider");try{await tU(n,n._uninitializedComponentsProvider._offline)}catch(t){const i=t;if(!function(l){return l.name==="FirebaseError"?l.code===_t.FAILED_PRECONDITION||l.code===_t.UNIMPLEMENTED:!(typeof DOMException<"u"&&l instanceof DOMException)||l.code===22||l.code===20||l.code===11}(i))throw i;f0("Error using user provided cache. Falling back to memory cache: "+i),await tU(n,new qk)}}else Zt(wg,"Using default OfflineComponentProvider"),await tU(n,new v3e(void 0));return n._offlineComponents}async function Fie(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(Zt(wg,"Using user provided OnlineComponentProvider"),await ZX(n,n._uninitializedComponentsProvider._online)):(Zt(wg,"Using default OnlineComponentProvider"),await ZX(n,new MV))),n._onlineComponents}function T3e(n){return Fie(n).then(t=>t.syncEngine)}async function Yk(n){const t=await Fie(n),i=t.eventManager;return i.onListen=a3e.bind(null,t.syncEngine),i.onUnlisten=u3e.bind(null,t.syncEngine),i.onFirstRemoteStoreListen=c3e.bind(null,t.syncEngine),i.onLastRemoteStoreUnlisten=d3e.bind(null,t.syncEngine),i}function w3e(n,t,i={}){const a=new Rp;return n.asyncQueue.enqueueAndForget(async()=>function(d,p,E,v,b){const w=new l4({next:N=>{w.su(),p.enqueueAndForget(()=>i4(d,A));const F=N.docs.has(E);!F&&N.fromCache?b.reject(new Wt(_t.UNAVAILABLE,"Failed to get document because the client is offline.")):F&&N.fromCache&&v&&v.source==="server"?b.reject(new Wt(_t.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):b.resolve(N)},error:N=>b.reject(N)}),A=new s4(GN(E.path),w,{includeMetadataChanges:!0,Ta:!0});return r4(d,A)}(await Yk(n),n.asyncQueue,t,i,a)),a.promise}function R3e(n,t,i={}){const a=new Rp;return n.asyncQueue.enqueueAndForget(async()=>function(d,p,E,v,b){const w=new l4({next:N=>{w.su(),p.enqueueAndForget(()=>i4(d,A)),N.fromCache&&v.source==="server"?b.reject(new Wt(_t.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):b.resolve(N)},error:N=>b.reject(N)}),A=new s4(E,w,{includeMetadataChanges:!0,Ta:!0});return r4(d,A)}(await Yk(n),n.asyncQueue,t,i,a)),a.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jie(n){const t={};return n.timeoutSeconds!==void 0&&(t.timeoutSeconds=n.timeoutSeconds),t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eJ=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bie(n,t,i){if(!i)throw new Wt(_t.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${t}.`)}function C3e(n,t,i,a){if(t===!0&&a===!0)throw new Wt(_t.INVALID_ARGUMENT,`${n} and ${i} cannot be used together.`)}function tJ(n){if(!En.isDocumentKey(n))throw new Wt(_t.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function nJ(n){if(En.isDocumentKey(n))throw new Wt(_t.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function ZN(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const t=function(a){return a.constructor?a.constructor.name:null}(n);return t?`a custom ${t} object`:"an object"}}return typeof n=="function"?"a function":Fn()}function Au(n,t){if("_delegate"in n&&(n=n._delegate),!(n instanceof t)){if(t.name===n.constructor.name)throw new Wt(_t.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const i=ZN(n);throw new Wt(_t.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${i}`)}}return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wie="firestore.googleapis.com",rJ=!0;class iJ{constructor(t){var i,a;if(t.host===void 0){if(t.ssl!==void 0)throw new Wt(_t.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Wie,this.ssl=rJ}else this.host=t.host,this.ssl=(i=t.ssl)!==null&&i!==void 0?i:rJ;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,t.cacheSizeBytes===void 0)this.cacheSizeBytes=yie;else{if(t.cacheSizeBytes!==-1&&t.cacheSizeBytes<r4e)throw new Wt(_t.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}C3e("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:t.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=jie((a=t.experimentalLongPollingOptions)!==null&&a!==void 0?a:{}),function(d){if(d.timeoutSeconds!==void 0){if(isNaN(d.timeoutSeconds))throw new Wt(_t.INVALID_ARGUMENT,`invalid long polling timeout: ${d.timeoutSeconds} (must not be NaN)`);if(d.timeoutSeconds<5)throw new Wt(_t.INVALID_ARGUMENT,`invalid long polling timeout: ${d.timeoutSeconds} (minimum allowed value is 5)`);if(d.timeoutSeconds>30)throw new Wt(_t.INVALID_ARGUMENT,`invalid long polling timeout: ${d.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(a,l){return a.timeoutSeconds===l.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class e1{constructor(t,i,a,l){this._authCredentials=t,this._appCheckCredentials=i,this._databaseId=a,this._app=l,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new iJ({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Wt(_t.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(t){if(this._settingsFrozen)throw new Wt(_t.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new iJ(t),this._emulatorOptions=t.emulatorOptions||{},t.credentials!==void 0&&(this._authCredentials=function(a){if(!a)return new LFe;switch(a.type){case"firstParty":return new VFe(a.sessionIndex||"0",a.iamToken||null,a.authTokenFactory||null);case"provider":return a.client;default:throw new Wt(_t.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(i){const a=eJ.get(i);a&&(Zt("ComponentProvider","Removing Datastore"),eJ.delete(i),a.terminate())}(this),Promise.resolve()}}function I3e(n,t,i,a={}){var l;const d=(n=Au(n,e1))._getSettings(),p=Object.assign(Object.assign({},d),{emulatorOptions:n._getEmulatorOptions()}),E=`${t}:${i}`;d.host!==Wie&&d.host!==E&&f0("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const v=Object.assign(Object.assign({},d),{host:E,ssl:!1,emulatorOptions:a});if(!OE(v,p)&&(n._setSettings(v),a.mockUserToken)){let b,w;if(typeof a.mockUserToken=="string")b=a.mockUserToken,w=Oa.MOCK_USER;else{b=Une(a.mockUserToken,(l=n._app)===null||l===void 0?void 0:l.options.projectId);const A=a.mockUserToken.sub||a.mockUserToken.user_id;if(!A)throw new Wt(_t.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");w=new Oa(A)}n._authCredentials=new xFe(new Nre(b,w))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Up{constructor(t,i,a){this.converter=i,this._query=a,this.type="query",this.firestore=t}withConverter(t){return new Up(this.firestore,t,this._query)}}class La{constructor(t,i,a){this.converter=i,this._key=a,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new hg(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new La(this.firestore,t,this._key)}}class hg extends Up{constructor(t,i,a){super(t,i,GN(a)),this._path=a,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new La(this.firestore,null,new En(t))}withConverter(t){return new hg(this.firestore,t,this._path)}}function xR(n,t,...i){if(n=Li(n),Bie("collection","path",t),n instanceof e1){const a=Di.fromString(t,...i);return nJ(a),new hg(n,null,a)}{if(!(n instanceof La||n instanceof hg))throw new Wt(_t.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const a=n._path.child(Di.fromString(t,...i));return nJ(a),new hg(n.firestore,null,a)}}function Cs(n,t,...i){if(n=Li(n),arguments.length===1&&(t=Dre.newId()),Bie("doc","path",t),n instanceof e1){const a=Di.fromString(t,...i);return tJ(a),new La(n,null,new En(a))}{if(!(n instanceof La||n instanceof hg))throw new Wt(_t.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const a=n._path.child(Di.fromString(t,...i));return tJ(a),new La(n.firestore,n instanceof hg?n.converter:null,new En(a))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oJ="AsyncQueue";class sJ{constructor(t=Promise.resolve()){this.Vu=[],this.mu=!1,this.fu=[],this.gu=null,this.pu=!1,this.yu=!1,this.wu=[],this.a_=new Tie(this,"async_queue_retry"),this.bu=()=>{const a=eU();a&&Zt(oJ,"Visibility state changed to "+a.visibilityState),this.a_.t_()},this.Su=t;const i=eU();i&&typeof i.addEventListener=="function"&&i.addEventListener("visibilitychange",this.bu)}get isShuttingDown(){return this.mu}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.Du(),this.vu(t)}enterRestrictedMode(t){if(!this.mu){this.mu=!0,this.yu=t||!1;const i=eU();i&&typeof i.removeEventListener=="function"&&i.removeEventListener("visibilitychange",this.bu)}}enqueue(t){if(this.Du(),this.mu)return new Promise(()=>{});const i=new Rp;return this.vu(()=>this.mu&&this.yu?Promise.resolve():(t().then(i.resolve,i.reject),i.promise)).then(()=>i.promise)}enqueueRetryable(t){this.enqueueAndForget(()=>(this.Vu.push(t),this.Cu()))}async Cu(){if(this.Vu.length!==0){try{await this.Vu[0](),this.Vu.shift(),this.a_.reset()}catch(t){if(!M0(t))throw t;Zt(oJ,"Operation failed with retryable error: "+t)}this.Vu.length>0&&this.a_.Xo(()=>this.Cu())}}vu(t){const i=this.Su.then(()=>(this.pu=!0,t().catch(a=>{this.gu=a,this.pu=!1;const l=function(p){let E=p.message||"";return p.stack&&(E=p.stack.includes(p.message)?p.stack:p.message+`
`+p.stack),E}(a);throw Np("INTERNAL UNHANDLED ERROR: ",l),a}).then(a=>(this.pu=!1,a))));return this.Su=i,i}enqueueAfterDelay(t,i,a){this.Du(),this.wu.indexOf(t)>-1&&(i=0);const l=t4.createAndSchedule(this,t,i,a,d=>this.Fu(d));return this.fu.push(l),l}Du(){this.gu&&Fn()}verifyOperationInProgress(){}async Mu(){let t;do t=this.Su,await t;while(t!==this.Su)}xu(t){for(const i of this.fu)if(i.timerId===t)return!0;return!1}Ou(t){return this.Mu().then(()=>{this.fu.sort((i,a)=>i.targetTimeMs-a.targetTimeMs);for(const i of this.fu)if(i.skipDelay(),t!=="all"&&i.timerId===t)break;return this.Mu()})}Nu(t){this.wu.push(t)}Fu(t){const i=this.fu.indexOf(t);this.fu.splice(i,1)}}function aJ(n){return function(i,a){if(typeof i!="object"||i===null)return!1;const l=i;for(const d of a)if(d in l&&typeof l[d]=="function")return!0;return!1}(n,["next","error","complete"])}class ME extends e1{constructor(t,i,a,l){super(t,i,a,l),this.type="firestore",this._queue=new sJ,this._persistenceKey=(l==null?void 0:l.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const t=this._firestoreClient.terminate();this._queue=new sJ(t),this._firestoreClient=void 0,await t}}}function UV(n,t){const i=typeof n=="object"?n:Aj(),a=typeof n=="string"?n:jk,l=MN(i,"firestore").getImmediate({identifier:a});if(!l._initialized){const d=Lne("firestore");d&&I3e(l,...d)}return l}function t1(n){if(n._terminated)throw new Wt(_t.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||A3e(n),n._firestoreClient}function A3e(n){var t,i,a;const l=n._freezeSettings(),d=function(E,v,b,w){return new QFe(E,v,b,w.host,w.ssl,w.experimentalForceLongPolling,w.experimentalAutoDetectLongPolling,jie(w.experimentalLongPollingOptions),w.useFetchStreams)}(n._databaseId,((t=n._app)===null||t===void 0?void 0:t.options.appId)||"",n._persistenceKey,l);n._componentsProvider||!((i=l.localCache)===null||i===void 0)&&i._offlineComponentProvider&&(!((a=l.localCache)===null||a===void 0)&&a._onlineComponentProvider)&&(n._componentsProvider={_offline:l.localCache._offlineComponentProvider,_online:l.localCache._onlineComponentProvider}),n._firestoreClient=new S3e(n._authCredentials,n._appCheckCredentials,n._queue,d,n._componentsProvider&&function(E){const v=E==null?void 0:E._online.build();return{_offline:E==null?void 0:E._offline.build(v),_online:v}}(n._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v0{constructor(t){this._byteString=t}static fromBase64String(t){try{return new v0(ra.fromBase64String(t))}catch(i){throw new Wt(_t.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+i)}}static fromUint8Array(t){return new v0(ra.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n1{constructor(...t){for(let i=0;i<t.length;++i)if(t[i].length===0)throw new Wt(_t.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new na(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class u4{constructor(t){this._methodName=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class d4{constructor(t,i){if(!isFinite(t)||t<-90||t>90)throw new Wt(_t.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(i)||i<-180||i>180)throw new Wt(_t.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+i);this._lat=t,this._long=i}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return Ar(this._lat,t._lat)||Ar(this._long,t._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h4{constructor(t){this._values=(t||[]).map(i=>i)}toArray(){return this._values.map(t=>t)}isEqual(t){return function(a,l){if(a.length!==l.length)return!1;for(let d=0;d<a.length;++d)if(a[d]!==l[d])return!1;return!0}(this._values,t._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const P3e=/^__.*__$/;class O3e{constructor(t,i,a){this.data=t,this.fieldMask=i,this.fieldTransforms=a}toMutation(t,i){return this.fieldMask!==null?new Og(t,this.data,this.fieldMask,i,this.fieldTransforms):new aC(t,this.data,i,this.fieldTransforms)}}class zie{constructor(t,i,a){this.data=t,this.fieldMask=i,this.fieldTransforms=a}toMutation(t,i){return new Og(t,this.data,this.fieldMask,i,this.fieldTransforms)}}function Gie(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Fn()}}class f4{constructor(t,i,a,l,d,p){this.settings=t,this.databaseId=i,this.serializer=a,this.ignoreUndefinedProperties=l,d===void 0&&this.Bu(),this.fieldTransforms=d||[],this.fieldMask=p||[]}get path(){return this.settings.path}get Lu(){return this.settings.Lu}ku(t){return new f4(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}qu(t){var i;const a=(i=this.path)===null||i===void 0?void 0:i.child(t),l=this.ku({path:a,Qu:!1});return l.$u(t),l}Ku(t){var i;const a=(i=this.path)===null||i===void 0?void 0:i.child(t),l=this.ku({path:a,Qu:!1});return l.Bu(),l}Uu(t){return this.ku({path:void 0,Qu:!0})}Wu(t){return Xk(t,this.settings.methodName,this.settings.Gu||!1,this.path,this.settings.zu)}contains(t){return this.fieldMask.find(i=>t.isPrefixOf(i))!==void 0||this.fieldTransforms.find(i=>t.isPrefixOf(i.field))!==void 0}Bu(){if(this.path)for(let t=0;t<this.path.length;t++)this.$u(this.path.get(t))}$u(t){if(t.length===0)throw this.Wu("Document fields must not be empty");if(Gie(this.Lu)&&P3e.test(t))throw this.Wu('Document fields cannot begin and end with "__"')}}class k3e{constructor(t,i,a){this.databaseId=t,this.ignoreUndefinedProperties=i,this.serializer=a||XN(t)}ju(t,i,a,l=!1){return new f4({Lu:t,methodName:i,zu:a,path:na.emptyPath(),Qu:!1,Gu:l},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function r1(n){const t=n._freezeSettings(),i=XN(n._databaseId);return new k3e(n._databaseId,!!t.ignoreUndefinedProperties,i)}function N3e(n,t,i,a,l,d={}){const p=n.ju(d.merge||d.mergeFields?2:0,t,i,l);p4("Data must be an object, but it was:",p,a);const E=$ie(a,p);let v,b;if(d.merge)v=new Il(p.fieldMask),b=p.fieldTransforms;else if(d.mergeFields){const w=[];for(const A of d.mergeFields){const N=VV(t,A,i);if(!p.contains(N))throw new Wt(_t.INVALID_ARGUMENT,`Field '${N}' is specified in your field mask but missing from your input data.`);qie(w,N)||w.push(N)}v=new Il(w),b=p.fieldTransforms.filter(A=>v.covers(A.field))}else v=null,b=p.fieldTransforms;return new O3e(new qc(E),v,b)}class i1 extends u4{_toFieldTransform(t){if(t.Lu!==2)throw t.Lu===1?t.Wu(`${this._methodName}() can only appear at the top level of your update data`):t.Wu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof i1}}function D3e(n,t,i,a){const l=n.ju(1,t,i);p4("Data must be an object, but it was:",l,a);const d=[],p=qc.empty();Pg(a,(v,b)=>{const w=m4(t,v,i);b=Li(b);const A=l.Ku(w);if(b instanceof i1)d.push(w);else{const N=dC(b,A);N!=null&&(d.push(w),p.set(w,N))}});const E=new Il(d);return new zie(p,E,l.fieldTransforms)}function L3e(n,t,i,a,l,d){const p=n.ju(1,t,i),E=[VV(t,a,i)],v=[l];if(d.length%2!=0)throw new Wt(_t.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let N=0;N<d.length;N+=2)E.push(VV(t,d[N])),v.push(d[N+1]);const b=[],w=qc.empty();for(let N=E.length-1;N>=0;--N)if(!qie(b,E[N])){const F=E[N];let j=v[N];j=Li(j);const B=p.Ku(F);if(j instanceof i1)b.push(F);else{const H=dC(j,B);H!=null&&(b.push(F),w.set(F,H))}}const A=new Il(b);return new zie(w,A,p.fieldTransforms)}function Hie(n,t,i,a=!1){return dC(i,n.ju(a?4:3,t))}function dC(n,t){if(Kie(n=Li(n)))return p4("Unsupported field value:",t,n),$ie(n,t);if(n instanceof u4)return function(a,l){if(!Gie(l.Lu))throw l.Wu(`${a._methodName}() can only be used with update() and set()`);if(!l.path)throw l.Wu(`${a._methodName}() is not currently supported inside arrays`);const d=a._toFieldTransform(l);d&&l.fieldTransforms.push(d)}(n,t),null;if(n===void 0&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),n instanceof Array){if(t.settings.Qu&&t.Lu!==4)throw t.Wu("Nested arrays are not supported");return function(a,l){const d=[];let p=0;for(const E of a){let v=dC(E,l.Uu(p));v==null&&(v={nullValue:"NULL_VALUE"}),d.push(v),p++}return{arrayValue:{values:d}}}(n,t)}return function(a,l){if((a=Li(a))===null)return{nullValue:"NULL_VALUE"};if(typeof a=="number")return Sje(l.serializer,a);if(typeof a=="boolean")return{booleanValue:a};if(typeof a=="string")return{stringValue:a};if(a instanceof Date){const d=as.fromDate(a);return{timestampValue:Hk(l.serializer,d)}}if(a instanceof as){const d=new as(a.seconds,1e3*Math.floor(a.nanoseconds/1e3));return{timestampValue:Hk(l.serializer,d)}}if(a instanceof d4)return{geoPointValue:{latitude:a.latitude,longitude:a.longitude}};if(a instanceof v0)return{bytesValue:hie(l.serializer,a._byteString)};if(a instanceof La){const d=l.databaseId,p=a.firestore._databaseId;if(!p.isEqual(d))throw l.Wu(`Document reference is for database ${p.projectId}/${p.database} but should be for database ${d.projectId}/${d.database}`);return{referenceValue:$j(a.firestore._databaseId||l.databaseId,a._key.path)}}if(a instanceof h4)return function(p,E){return{mapValue:{fields:{[Bre]:{stringValue:Wre},[Bk]:{arrayValue:{values:p.toArray().map(b=>{if(typeof b!="number")throw E.Wu("VectorValues must only contain numeric values.");return zj(E.serializer,b)})}}}}}}(a,l);throw l.Wu(`Unsupported field value: ${ZN(a)}`)}(n,t)}function $ie(n,t){const i={};return xre(n)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):Pg(n,(a,l)=>{const d=dC(l,t.qu(a));d!=null&&(i[a]=d)}),{mapValue:{fields:i}}}function Kie(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof as||n instanceof d4||n instanceof v0||n instanceof La||n instanceof u4||n instanceof h4)}function p4(n,t,i){if(!Kie(i)||!function(l){return typeof l=="object"&&l!==null&&(Object.getPrototypeOf(l)===Object.prototype||Object.getPrototypeOf(l)===null)}(i)){const a=ZN(i);throw a==="an object"?t.Wu(n+" a custom object"):t.Wu(n+" "+a)}}function VV(n,t,i){if((t=Li(t))instanceof n1)return t._internalPath;if(typeof t=="string")return m4(n,t);throw Xk("Field path arguments must be of type string or ",n,!1,void 0,i)}const x3e=new RegExp("[~\\*/\\[\\]]");function m4(n,t,i){if(t.search(x3e)>=0)throw Xk(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,i);try{return new n1(...t.split("."))._internalPath}catch{throw Xk(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,i)}}function Xk(n,t,i,a,l){const d=a&&!a.isEmpty(),p=l!==void 0;let E=`Function ${t}() called with invalid data`;i&&(E+=" (via `toFirestore()`)"),E+=". ";let v="";return(d||p)&&(v+=" (found",d&&(v+=` in field ${a}`),p&&(v+=` in document ${l}`),v+=")"),new Wt(_t.INVALID_ARGUMENT,E+n+v)}function qie(n,t){return n.some(i=>i.isEqual(t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class g4{constructor(t,i,a,l,d){this._firestore=t,this._userDataWriter=i,this._key=a,this._document=l,this._converter=d}get id(){return this._key.path.lastSegment()}get ref(){return new La(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const t=new M3e(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const i=this._document.data.field(o1("DocumentSnapshot.get",t));if(i!==null)return this._userDataWriter.convertValue(i)}}}class M3e extends g4{data(){return super.data()}}function o1(n,t){return typeof t=="string"?m4(n,t):t instanceof n1?t._internalPath:t._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yie(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new Wt(_t.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class _4{}class E4 extends _4{}function FV(n,t,...i){let a=[];t instanceof _4&&a.push(t),a=a.concat(i),function(d){const p=d.filter(v=>v instanceof y4).length,E=d.filter(v=>v instanceof s1).length;if(p>1||p>0&&E>0)throw new Wt(_t.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(a);for(const l of a)n=l._apply(n);return n}class s1 extends E4{constructor(t,i,a){super(),this._field=t,this._op=i,this._value=a,this.type="where"}static _create(t,i,a){return new s1(t,i,a)}_apply(t){const i=this._parse(t);return Xie(t._query,i),new Up(t.firestore,t.converter,CV(t._query,i))}_parse(t){const i=r1(t.firestore);return function(d,p,E,v,b,w,A){let N;if(b.isKeyField()){if(w==="array-contains"||w==="array-contains-any")throw new Wt(_t.INVALID_ARGUMENT,`Invalid Query. You can't perform '${w}' queries on documentId().`);if(w==="in"||w==="not-in"){uJ(A,w);const j=[];for(const B of A)j.push(lJ(v,d,B));N={arrayValue:{values:j}}}else N=lJ(v,d,A)}else w!=="in"&&w!=="not-in"&&w!=="array-contains-any"||uJ(A,w),N=Hie(E,p,A,w==="in"||w==="not-in");return qo.create(b,w,N)}(t._query,"where",i,t.firestore._databaseId,this._field,this._op,this._value)}}function cJ(n,t,i){const a=t,l=o1("where",n);return s1._create(l,a,i)}class y4 extends _4{constructor(t,i){super(),this.type=t,this._queryConstraints=i}static _create(t,i){return new y4(t,i)}_parse(t){const i=this._queryConstraints.map(a=>a._parse(t)).filter(a=>a.getFilters().length>0);return i.length===1?i[0]:Nd.create(i,this._getOperator())}_apply(t){const i=this._parse(t);return i.getFilters().length===0?t:(function(l,d){let p=l;const E=d.getFlattenedFilters();for(const v of E)Xie(p,v),p=CV(p,v)}(t._query,i),new Up(t.firestore,t.converter,CV(t._query,i)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class v4 extends E4{constructor(t,i){super(),this._field=t,this._direction=i,this.type="orderBy"}static _create(t,i){return new v4(t,i)}_apply(t){const i=function(l,d,p){if(l.startAt!==null)throw new Wt(_t.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(l.endAt!==null)throw new Wt(_t.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new NR(d,p)}(t._query,this._field,this._direction);return new Up(t.firestore,t.converter,function(l,d){const p=l.explicitOrderBy.concat([d]);return new BE(l.path,l.collectionGroup,p,l.filters.slice(),l.limit,l.limitType,l.startAt,l.endAt)}(t._query,i))}}function U3e(n,t="asc"){const i=t,a=o1("orderBy",n);return v4._create(a,i)}class S4 extends E4{constructor(t,i,a){super(),this.type=t,this._docOrFields=i,this._inclusive=a}static _create(t,i,a){return new S4(t,i,a)}_apply(t){const i=F3e(t,this.type,this._docOrFields,this._inclusive);return new Up(t.firestore,t.converter,function(l,d){return new BE(l.path,l.collectionGroup,l.explicitOrderBy.slice(),l.filters.slice(),l.limit,l.limitType,d,l.endAt)}(t._query,i))}}function V3e(...n){return S4._create("startAt",n,!0)}function F3e(n,t,i,a){if(i[0]=Li(i[0]),i[0]instanceof g4)return function(d,p,E,v,b){if(!v)throw new Wt(_t.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${E}().`);const w=[];for(const A of YS(d))if(A.field.isKeyField())w.push(Wk(p,v.key));else{const N=v.data.field(A.field);if(WN(N))throw new Wt(_t.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+A.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(N===null){const F=A.field.canonicalString();throw new Wt(_t.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${F}' (used as the orderBy) does not exist.`)}w.push(N)}return new _0(w,b)}(n._query,n.firestore._databaseId,t,i[0]._document,a);{const l=r1(n.firestore);return function(p,E,v,b,w,A){const N=p.explicitOrderBy;if(w.length>N.length)throw new Wt(_t.INVALID_ARGUMENT,`Too many arguments provided to ${b}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const F=[];for(let j=0;j<w.length;j++){const B=w[j];if(N[j].field.isKeyField()){if(typeof B!="string")throw new Wt(_t.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${b}(), but got a ${typeof B}`);if(!Wj(p)&&B.indexOf("/")!==-1)throw new Wt(_t.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${b}() must be a plain document ID, but '${B}' contains a slash.`);const H=p.path.child(Di.fromString(B));if(!En.isDocumentKey(H))throw new Wt(_t.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${b}() must result in a valid document path, but '${H}' is not because it contains an odd number of segments.`);const ee=new En(H);F.push(Wk(E,ee))}else{const H=Hie(v,b,B);F.push(H)}}return new _0(F,A)}(n._query,n.firestore._databaseId,l,t,i,a)}}function lJ(n,t,i){if(typeof(i=Li(i))=="string"){if(i==="")throw new Wt(_t.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Wj(t)&&i.indexOf("/")!==-1)throw new Wt(_t.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${i}' contains a '/' character.`);const a=t.path.child(Di.fromString(i));if(!En.isDocumentKey(a))throw new Wt(_t.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${a}' is not because it has an odd number of segments (${a.length}).`);return Wk(n,new En(a))}if(i instanceof La)return Wk(n,i._key);throw new Wt(_t.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${ZN(i)}.`)}function uJ(n,t){if(!Array.isArray(n)||n.length===0)throw new Wt(_t.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function Xie(n,t){const i=function(l,d){for(const p of l)for(const E of p.getFlattenedFilters())if(d.indexOf(E.op)>=0)return E.op;return null}(n.filters,function(l){switch(l){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(i!==null)throw i===t.op?new Wt(_t.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new Wt(_t.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${i.toString()}' filters.`)}class j3e{convertValue(t,i="none"){switch(bg(t)){case 0:return null;case 1:return t.booleanValue;case 2:return Mo(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,i);case 5:return t.stringValue;case 6:return this.convertBytes(Sg(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,i);case 11:return this.convertObject(t.mapValue,i);case 10:return this.convertVectorValue(t.mapValue);default:throw Fn()}}convertObject(t,i){return this.convertObjectMap(t.fields,i)}convertObjectMap(t,i="none"){const a={};return Pg(t,(l,d)=>{a[l]=this.convertValue(d,i)}),a}convertVectorValue(t){var i,a,l;const d=(l=(a=(i=t.fields)===null||i===void 0?void 0:i[Bk].arrayValue)===null||a===void 0?void 0:a.values)===null||l===void 0?void 0:l.map(p=>Mo(p.doubleValue));return new h4(d)}convertGeoPoint(t){return new d4(Mo(t.latitude),Mo(t.longitude))}convertArray(t,i){return(t.values||[]).map(a=>this.convertValue(a,i))}convertServerTimestamp(t,i){switch(i){case"previous":const a=zN(t);return a==null?null:this.convertValue(a,i);case"estimate":return this.convertTimestamp(PR(t));default:return null}}convertTimestamp(t){const i=vg(t);return new as(i.seconds,i.nanos)}convertDocumentKey(t,i){const a=Di.fromString(t);ii(Eie(a));const l=new OR(a.get(1),a.get(3)),d=new En(a.popFirst(5));return l.isEqual(i)||Np(`Document ${d} contains a document reference within a different database (${l.projectId}/${l.database}) which is not supported. It will be treated as a reference in the current database (${i.projectId}/${i.database}) instead.`),d}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function B3e(n,t,i){let a;return a=n?i&&(i.merge||i.mergeFields)?n.toFirestore(t,i):n.toFirestore(t):t,a}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vw{constructor(t,i){this.hasPendingWrites=t,this.fromCache=i}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class Jie extends g4{constructor(t,i,a,l,d,p){super(t,i,a,l,p),this._firestore=t,this._firestoreImpl=t,this.metadata=d}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const i=new ck(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(i,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,i={}){if(this._document){const a=this._document.data.field(o1("DocumentSnapshot.get",t));if(a!==null)return this._userDataWriter.convertValue(a,i.serverTimestamps)}}}class ck extends Jie{data(t={}){return super.data(t)}}class Qie{constructor(t,i,a,l){this._firestore=t,this._userDataWriter=i,this._snapshot=l,this.metadata=new Vw(l.hasPendingWrites,l.fromCache),this.query=a}get docs(){const t=[];return this.forEach(i=>t.push(i)),t}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(t,i){this._snapshot.docs.forEach(a=>{t.call(i,new ck(this._firestore,this._userDataWriter,a.key,a,new Vw(this._snapshot.mutatedKeys.has(a.key),this._snapshot.fromCache),this.query.converter))})}docChanges(t={}){const i=!!t.includeMetadataChanges;if(i&&this._snapshot.excludesMetadataChanges)throw new Wt(_t.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===i||(this._cachedChanges=function(l,d){if(l._snapshot.oldDocs.isEmpty()){let p=0;return l._snapshot.docChanges.map(E=>{const v=new ck(l._firestore,l._userDataWriter,E.doc.key,E.doc,new Vw(l._snapshot.mutatedKeys.has(E.doc.key),l._snapshot.fromCache),l.query.converter);return E.doc,{type:"added",doc:v,oldIndex:-1,newIndex:p++}})}{let p=l._snapshot.oldDocs;return l._snapshot.docChanges.filter(E=>d||E.type!==3).map(E=>{const v=new ck(l._firestore,l._userDataWriter,E.doc.key,E.doc,new Vw(l._snapshot.mutatedKeys.has(E.doc.key),l._snapshot.fromCache),l.query.converter);let b=-1,w=-1;return E.type!==0&&(b=p.indexOf(E.doc.key),p=p.delete(E.doc.key)),E.type!==1&&(p=p.add(E.doc),w=p.indexOf(E.doc.key)),{type:W3e(E.type),doc:v,oldIndex:b,newIndex:w}})}}(this,i),this._cachedChangesIncludeMetadataChanges=i),this._cachedChanges}}function W3e(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Fn()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rg(n){n=Au(n,La);const t=Au(n.firestore,ME);return w3e(t1(t),n._key).then(i=>toe(t,n,i))}class b4 extends j3e{constructor(t){super(),this.firestore=t}convertBytes(t){return new v0(t)}convertReference(t){const i=this.convertDocumentKey(t,this.firestore._databaseId);return new La(this.firestore,null,i)}}function Jk(n){n=Au(n,Up);const t=Au(n.firestore,ME),i=t1(t),a=new b4(t);return Yie(n._query),R3e(i,n._query).then(l=>new Qie(t,a,n,l))}function jV(n,t,i){n=Au(n,La);const a=Au(n.firestore,ME),l=B3e(n.converter,t,i);return eoe(a,[N3e(r1(a),"setDoc",n._key,l,n.converter!==null,i).toMutation(n._key,Zh.none())])}function Du(n,t,i,...a){n=Au(n,La);const l=Au(n.firestore,ME),d=r1(l);let p;return p=typeof(t=Li(t))=="string"||t instanceof n1?L3e(d,"updateDoc",n._key,t,i,a):D3e(d,"updateDoc",n._key,t),eoe(l,[p.toMutation(n._key,Zh.exists(!0))])}function Zie(n,...t){var i,a,l;n=Li(n);let d={includeMetadataChanges:!1,source:"default"},p=0;typeof t[p]!="object"||aJ(t[p])||(d=t[p],p++);const E={includeMetadataChanges:d.includeMetadataChanges,source:d.source};if(aJ(t[p])){const A=t[p];t[p]=(i=A.next)===null||i===void 0?void 0:i.bind(A),t[p+1]=(a=A.error)===null||a===void 0?void 0:a.bind(A),t[p+2]=(l=A.complete)===null||l===void 0?void 0:l.bind(A)}let v,b,w;if(n instanceof La)b=Au(n.firestore,ME),w=GN(n._key.path),v={next:A=>{t[p]&&t[p](toe(b,n,A))},error:t[p+1],complete:t[p+2]};else{const A=Au(n,Up);b=Au(A.firestore,ME),w=A._query;const N=new b4(b);v={next:F=>{t[p]&&t[p](new Qie(b,N,A,F))},error:t[p+1],complete:t[p+2]},Yie(n._query)}return function(N,F,j,B){const H=new l4(B),ee=new s4(F,H,j);return N.asyncQueue.enqueueAndForget(async()=>r4(await Yk(N),ee)),()=>{H.su(),N.asyncQueue.enqueueAndForget(async()=>i4(await Yk(N),ee))}}(t1(b),w,E,v)}function eoe(n,t){return function(a,l){const d=new Rp;return a.asyncQueue.enqueueAndForget(async()=>h3e(await T3e(a),l,d)),d.promise}(t1(n),t)}function toe(n,t,i){const a=i.docs.get(t._key),l=new b4(n);return new Jie(n,l,t._key,a,new Vw(i.hasPendingWrites,i.fromCache),t.converter)}(function(t,i=!0){(function(l){L0=l})(jE),kE(new Eg("firestore",(a,{instanceIdentifier:l,options:d})=>{const p=a.getProvider("app").getImmediate(),E=new ME(new MFe(a.getProvider("auth-internal")),new FFe(p,a.getProvider("app-check-internal")),function(b,w){if(!Object.prototype.hasOwnProperty.apply(b.options,["projectId"]))throw new Wt(_t.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new OR(b.options.projectId,w)}(p,l),p);return d=Object.assign({useFetchStreams:i},d),E._setSettings(d),E},"PUBLIC").setMultipleInstances(!0)),Yh(fX,pX,t),Yh(fX,pX,"esm2017")})();var z3e="firebase",G3e="11.4.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Yh(z3e,G3e,"app");const H3e={BASE_URL:"./",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_AGORA_APP_ID:"a2a7f4eb05284449b1063eb71d8301dc"};console.log("Environment variables check:");console.log("VITE_FIREBASE_API_KEY exists:",!1);console.log("import.meta.env:",H3e);const Jm={apiKey:"AIzaSyCaxoNKRIMaXhotGzdAjXc5gkARoqtS3bU",authDomain:"disruptive-metaverse.firebaseapp.com",projectId:"disruptive-metaverse",storageBucket:"disruptive-metaverse.appspot.com",messagingSenderId:"294433070603",appId:"1:294433070603:web:136cddd196eea9614fb10e"};console.log("Firebase config being used:",{apiKey:Jm.apiKey?`${Jm.apiKey.substring(0,5)}...`:"missing",authDomain:Jm.authDomain,projectId:Jm.projectId,storageBucket:Jm.storageBucket,messagingSenderId:Jm.messagingSenderId?"present":"missing",appId:Jm.appId?"present":"missing"});const noe=jne(Jm),roe=Rre(noe),Yo=UV(noe),rf=async n=>{try{Te.log("userFirestore: Get user Profile data for user ID: "+n);const t=Cs(Yo,"users",n),i=await Rg(t);return i.exists()?(Te.log("userFirestore: Found Profile for : "+i.data().Nickname),i.data()):(Te.error("userFirestore: user profile document not found"),null)}catch(t){throw Te.error("userFirestore: Error fetching user profile data:",t),t}},$3e=async(n,t,i)=>{try{Te.log("userFirestore: Registering new user with email:",n);const l=(await _Ve(roe,n,t)).user;await yV(l),Te.log("userFirestore: Verification email sent to:",n);const d={email:l.email,createdAt:new Date,groups:["users"],emailVerified:!1,...i};Te.log("userFirestore: Creating user document with data:",d);const p=Cs(Yo,"users",l.uid);return await jV(p,d),Te.log("userFirestore: User created successfully with groups:",d.groups),{...l,...d}}catch(a){throw Te.error("userFirestore: Error creating user:",a),a}},ioe=async(n,t)=>{try{Te.log(`userFirestore: Updating rpmURL for user ID: ${n}`);const i=Cs(Yo,"users",n);await Du(i,{rpmURL:t,lastUpdated:new Date().toISOString()}),Te.log("userFirestore: rpmURL updated successfully.")}catch(i){throw Te.error("userFirestore: Error updating rpmURL:",i),i}},K3e=(n,t)=>{if(t==="users")return console.log(`OVERRIDE: userBelongsToGroup check for user ${n} and group ${t} - Returning true`),!0;if(t==="disruptiveAdmin"){const a=["lppDQiMb3hhloApQ7llOtk5tckY2","XutdlDmDSncMBUw6vwlQGdkpjNr2","aMhQYu0ArucoNCc6pJJtyfRbn8k2","fJVBogzjtTQqUHnYCYLhTt6jBW13","9NrbbBoc2rOYQC3xAkRBDkig8eg1"].includes(n);return console.log(`OVERRIDE: userBelongsToGroup check for user ${n} and admin group ${t} - Returning ${a}`),a}return console.log(`OVERRIDE: userBelongsToGroup check for user ${n} and group ${t} - Returning false`),!1},ooe=async(n,t)=>K3e(n,t),q3e=["email","name","rpmURL","Nickname","created_on","height_cm","companyName","firstName","lastName","linkedInProfile","groups"],Pd={sendUserToUnity:"sendUserToUnity"};class Y3e{constructor(){this.events={}}subscribe(t,i){this.events[t]||(this.events[t]=[]),this.events[t].push(i)}publish(t,i){const a=this.events[t];a?(a.forEach(l=>{l(i)}),Te.log(`EventBus: Published event '${t}'`)):Te.log(`EventBus: No subscribers for event '${t}'`)}unsubscribe(t,i){var l;const a=(l=this.events[t])==null?void 0:l.indexOf(i);a>-1&&this.events[t].splice(a,1)}}const Od=new Y3e;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const soe="firebasestorage.googleapis.com",aoe="storageBucket",X3e=2*60*1e3,J3e=10*60*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ao extends af{constructor(t,i,a=0){super(nU(t),`Firebase Storage: ${i} (${nU(t)})`),this.status_=a,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,Ao.prototype)}get status(){return this.status_}set status(t){this.status_=t}_codeEquals(t){return nU(t)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(t){this.customData.serverResponse=t,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var Io;(function(n){n.UNKNOWN="unknown",n.OBJECT_NOT_FOUND="object-not-found",n.BUCKET_NOT_FOUND="bucket-not-found",n.PROJECT_NOT_FOUND="project-not-found",n.QUOTA_EXCEEDED="quota-exceeded",n.UNAUTHENTICATED="unauthenticated",n.UNAUTHORIZED="unauthorized",n.UNAUTHORIZED_APP="unauthorized-app",n.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",n.INVALID_CHECKSUM="invalid-checksum",n.CANCELED="canceled",n.INVALID_EVENT_NAME="invalid-event-name",n.INVALID_URL="invalid-url",n.INVALID_DEFAULT_BUCKET="invalid-default-bucket",n.NO_DEFAULT_BUCKET="no-default-bucket",n.CANNOT_SLICE_BLOB="cannot-slice-blob",n.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",n.NO_DOWNLOAD_URL="no-download-url",n.INVALID_ARGUMENT="invalid-argument",n.INVALID_ARGUMENT_COUNT="invalid-argument-count",n.APP_DELETED="app-deleted",n.INVALID_ROOT_OPERATION="invalid-root-operation",n.INVALID_FORMAT="invalid-format",n.INTERNAL_ERROR="internal-error",n.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(Io||(Io={}));function nU(n){return"storage/"+n}function T4(){const n="An unknown error occurred, please check the error payload for server response.";return new Ao(Io.UNKNOWN,n)}function Q3e(n){return new Ao(Io.OBJECT_NOT_FOUND,"Object '"+n+"' does not exist.")}function Z3e(n){return new Ao(Io.QUOTA_EXCEEDED,"Quota for bucket '"+n+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function eBe(){const n="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new Ao(Io.UNAUTHENTICATED,n)}function tBe(){return new Ao(Io.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function nBe(n){return new Ao(Io.UNAUTHORIZED,"User does not have permission to access '"+n+"'.")}function rBe(){return new Ao(Io.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function iBe(){return new Ao(Io.CANCELED,"User canceled the upload/download.")}function oBe(n){return new Ao(Io.INVALID_URL,"Invalid URL '"+n+"'.")}function sBe(n){return new Ao(Io.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+n+"'.")}function aBe(){return new Ao(Io.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+aoe+"' property when initializing the app?")}function cBe(){return new Ao(Io.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function lBe(){return new Ao(Io.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function uBe(n){return new Ao(Io.UNSUPPORTED_ENVIRONMENT,`${n} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function BV(n){return new Ao(Io.INVALID_ARGUMENT,n)}function coe(){return new Ao(Io.APP_DELETED,"The Firebase app was deleted.")}function dBe(n){return new Ao(Io.INVALID_ROOT_OPERATION,"The operation '"+n+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function rR(n,t){return new Ao(Io.INVALID_FORMAT,"String does not match format '"+n+"': "+t)}function cw(n){throw new Ao(Io.INTERNAL_ERROR,"Internal error: "+n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Al{constructor(t,i){this.bucket=t,this.path_=i}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const t=encodeURIComponent;return"/b/"+t(this.bucket)+"/o/"+t(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(t,i){let a;try{a=Al.makeFromUrl(t,i)}catch{return new Al(t,"")}if(a.path==="")return a;throw sBe(t)}static makeFromUrl(t,i){let a=null;const l="([A-Za-z0-9.\\-_]+)";function d(le){le.path.charAt(le.path.length-1)==="/"&&(le.path_=le.path_.slice(0,-1))}const p="(/(.*))?$",E=new RegExp("^gs://"+l+p,"i"),v={bucket:1,path:3};function b(le){le.path_=decodeURIComponent(le.path)}const w="v[A-Za-z0-9_]+",A=i.replace(/[.]/g,"\\."),N="(/([^?#]*).*)?$",F=new RegExp(`^https?://${A}/${w}/b/${l}/o${N}`,"i"),j={bucket:1,path:3},B=i===soe?"(?:storage.googleapis.com|storage.cloud.google.com)":i,H="([^?#]*)",ee=new RegExp(`^https?://${B}/${l}/${H}`,"i"),te=[{regex:E,indices:v,postModify:d},{regex:F,indices:j,postModify:b},{regex:ee,indices:{bucket:1,path:2},postModify:b}];for(let le=0;le<te.length;le++){const oe=te[le],ge=oe.regex.exec(t);if(ge){const Z=ge[oe.indices.bucket];let Q=ge[oe.indices.path];Q||(Q=""),a=new Al(Z,Q),oe.postModify(a);break}}if(a==null)throw oBe(t);return a}}class hBe{constructor(t){this.promise_=Promise.reject(t)}getPromise(){return this.promise_}cancel(t=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fBe(n,t,i){let a=1,l=null,d=null,p=!1,E=0;function v(){return E===2}let b=!1;function w(...H){b||(b=!0,t.apply(null,H))}function A(H){l=setTimeout(()=>{l=null,n(F,v())},H)}function N(){d&&clearTimeout(d)}function F(H,...ee){if(b){N();return}if(H){N(),w.call(null,H,...ee);return}if(v()||p){N(),w.call(null,H,...ee);return}a<64&&(a*=2);let te;E===1?(E=2,te=0):te=(a+Math.random())*1e3,A(te)}let j=!1;function B(H){j||(j=!0,N(),!b&&(l!==null?(H||(E=2),clearTimeout(l),A(0)):H||(E=1)))}return A(0),d=setTimeout(()=>{p=!0,B(!0)},i),B}function pBe(n){n(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mBe(n){return n!==void 0}function gBe(n){return typeof n=="object"&&!Array.isArray(n)}function w4(n){return typeof n=="string"||n instanceof String}function dJ(n){return R4()&&n instanceof Blob}function R4(){return typeof Blob<"u"}function hJ(n,t,i,a){if(a<t)throw BV(`Invalid value for '${n}'. Expected ${t} or greater.`);if(a>i)throw BV(`Invalid value for '${n}'. Expected ${i} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function a1(n,t,i){let a=t;return i==null&&(a=`https://${t}`),`${i}://${a}/v0${n}`}function loe(n){const t=encodeURIComponent;let i="?";for(const a in n)if(n.hasOwnProperty(a)){const l=t(a)+"="+t(n[a]);i=i+l+"&"}return i=i.slice(0,-1),i}var bE;(function(n){n[n.NO_ERROR=0]="NO_ERROR",n[n.NETWORK_ERROR=1]="NETWORK_ERROR",n[n.ABORT=2]="ABORT"})(bE||(bE={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _Be(n,t){const i=n>=500&&n<600,l=[408,429].indexOf(n)!==-1,d=t.indexOf(n)!==-1;return i||l||d}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EBe{constructor(t,i,a,l,d,p,E,v,b,w,A,N=!0){this.url_=t,this.method_=i,this.headers_=a,this.body_=l,this.successCodes_=d,this.additionalRetryCodes_=p,this.callback_=E,this.errorCallback_=v,this.timeout_=b,this.progressCallback_=w,this.connectionFactory_=A,this.retry=N,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((F,j)=>{this.resolve_=F,this.reject_=j,this.start_()})}start_(){const t=(a,l)=>{if(l){a(!1,new RO(!1,null,!0));return}const d=this.connectionFactory_();this.pendingConnection_=d;const p=E=>{const v=E.loaded,b=E.lengthComputable?E.total:-1;this.progressCallback_!==null&&this.progressCallback_(v,b)};this.progressCallback_!==null&&d.addUploadProgressListener(p),d.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&d.removeUploadProgressListener(p),this.pendingConnection_=null;const E=d.getErrorCode()===bE.NO_ERROR,v=d.getStatus();if(!E||_Be(v,this.additionalRetryCodes_)&&this.retry){const w=d.getErrorCode()===bE.ABORT;a(!1,new RO(!1,null,w));return}const b=this.successCodes_.indexOf(v)!==-1;a(!0,new RO(b,d))})},i=(a,l)=>{const d=this.resolve_,p=this.reject_,E=l.connection;if(l.wasSuccessCode)try{const v=this.callback_(E,E.getResponse());mBe(v)?d(v):d()}catch(v){p(v)}else if(E!==null){const v=T4();v.serverResponse=E.getErrorText(),this.errorCallback_?p(this.errorCallback_(E,v)):p(v)}else if(l.canceled){const v=this.appDelete_?coe():iBe();p(v)}else{const v=rBe();p(v)}};this.canceled_?i(!1,new RO(!1,null,!0)):this.backoffId_=fBe(t,i,this.timeout_)}getPromise(){return this.promise_}cancel(t){this.canceled_=!0,this.appDelete_=t||!1,this.backoffId_!==null&&pBe(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class RO{constructor(t,i,a){this.wasSuccessCode=t,this.connection=i,this.canceled=!!a}}function yBe(n,t){t!==null&&t.length>0&&(n.Authorization="Firebase "+t)}function vBe(n,t){n["X-Firebase-Storage-Version"]="webjs/"+(t??"AppManager")}function SBe(n,t){t&&(n["X-Firebase-GMPID"]=t)}function bBe(n,t){t!==null&&(n["X-Firebase-AppCheck"]=t)}function TBe(n,t,i,a,l,d,p=!0){const E=loe(n.urlParams),v=n.url+E,b=Object.assign({},n.headers);return SBe(b,t),yBe(b,i),vBe(b,d),bBe(b,a),new EBe(v,n.method,b,n.body,n.successCodes,n.additionalRetryCodes,n.handler,n.errorHandler,n.timeout,n.progressCallback,l,p)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wBe(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function RBe(...n){const t=wBe();if(t!==void 0){const i=new t;for(let a=0;a<n.length;a++)i.append(n[a]);return i.getBlob()}else{if(R4())return new Blob(n);throw new Ao(Io.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function CBe(n,t,i){return n.webkitSlice?n.webkitSlice(t,i):n.mozSlice?n.mozSlice(t,i):n.slice?n.slice(t,i):null}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function IBe(n){if(typeof atob>"u")throw uBe("base-64");return atob(n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wh={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class rU{constructor(t,i){this.data=t,this.contentType=i||null}}function ABe(n,t){switch(n){case Wh.RAW:return new rU(uoe(t));case Wh.BASE64:case Wh.BASE64URL:return new rU(doe(n,t));case Wh.DATA_URL:return new rU(OBe(t),kBe(t))}throw T4()}function uoe(n){const t=[];for(let i=0;i<n.length;i++){let a=n.charCodeAt(i);if(a<=127)t.push(a);else if(a<=2047)t.push(192|a>>6,128|a&63);else if((a&64512)===55296)if(!(i<n.length-1&&(n.charCodeAt(i+1)&64512)===56320))t.push(239,191,189);else{const d=a,p=n.charCodeAt(++i);a=65536|(d&1023)<<10|p&1023,t.push(240|a>>18,128|a>>12&63,128|a>>6&63,128|a&63)}else(a&64512)===56320?t.push(239,191,189):t.push(224|a>>12,128|a>>6&63,128|a&63)}return new Uint8Array(t)}function PBe(n){let t;try{t=decodeURIComponent(n)}catch{throw rR(Wh.DATA_URL,"Malformed data URL.")}return uoe(t)}function doe(n,t){switch(n){case Wh.BASE64:{const l=t.indexOf("-")!==-1,d=t.indexOf("_")!==-1;if(l||d)throw rR(n,"Invalid character '"+(l?"-":"_")+"' found: is it base64url encoded?");break}case Wh.BASE64URL:{const l=t.indexOf("+")!==-1,d=t.indexOf("/")!==-1;if(l||d)throw rR(n,"Invalid character '"+(l?"+":"/")+"' found: is it base64 encoded?");t=t.replace(/-/g,"+").replace(/_/g,"/");break}}let i;try{i=IBe(t)}catch(l){throw l.message.includes("polyfill")?l:rR(n,"Invalid character found")}const a=new Uint8Array(i.length);for(let l=0;l<i.length;l++)a[l]=i.charCodeAt(l);return a}class hoe{constructor(t){this.base64=!1,this.contentType=null;const i=t.match(/^data:([^,]+)?,/);if(i===null)throw rR(Wh.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const a=i[1]||null;a!=null&&(this.base64=NBe(a,";base64"),this.contentType=this.base64?a.substring(0,a.length-7):a),this.rest=t.substring(t.indexOf(",")+1)}}function OBe(n){const t=new hoe(n);return t.base64?doe(Wh.BASE64,t.rest):PBe(t.rest)}function kBe(n){return new hoe(n).contentType}function NBe(n,t){return n.length>=t.length?n.substring(n.length-t.length)===t:!1}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ig{constructor(t,i){let a=0,l="";dJ(t)?(this.data_=t,a=t.size,l=t.type):t instanceof ArrayBuffer?(i?this.data_=new Uint8Array(t):(this.data_=new Uint8Array(t.byteLength),this.data_.set(new Uint8Array(t))),a=this.data_.length):t instanceof Uint8Array&&(i?this.data_=t:(this.data_=new Uint8Array(t.length),this.data_.set(t)),a=t.length),this.size_=a,this.type_=l}size(){return this.size_}type(){return this.type_}slice(t,i){if(dJ(this.data_)){const a=this.data_,l=CBe(a,t,i);return l===null?null:new ig(l)}else{const a=new Uint8Array(this.data_.buffer,t,i-t);return new ig(a,!0)}}static getBlob(...t){if(R4()){const i=t.map(a=>a instanceof ig?a.data_:a);return new ig(RBe.apply(null,i))}else{const i=t.map(p=>w4(p)?ABe(Wh.RAW,p).data:p.data_);let a=0;i.forEach(p=>{a+=p.byteLength});const l=new Uint8Array(a);let d=0;return i.forEach(p=>{for(let E=0;E<p.length;E++)l[d++]=p[E]}),new ig(l,!0)}}uploadData(){return this.data_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function foe(n){let t;try{t=JSON.parse(n)}catch{return null}return gBe(t)?t:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function DBe(n){if(n.length===0)return null;const t=n.lastIndexOf("/");return t===-1?"":n.slice(0,t)}function LBe(n,t){const i=t.split("/").filter(a=>a.length>0).join("/");return n.length===0?i:n+"/"+i}function poe(n){const t=n.lastIndexOf("/",n.length-2);return t===-1?n:n.slice(t+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xBe(n,t){return t}class ic{constructor(t,i,a,l){this.server=t,this.local=i||t,this.writable=!!a,this.xform=l||xBe}}let CO=null;function MBe(n){return!w4(n)||n.length<2?n:poe(n)}function moe(){if(CO)return CO;const n=[];n.push(new ic("bucket")),n.push(new ic("generation")),n.push(new ic("metageneration")),n.push(new ic("name","fullPath",!0));function t(d,p){return MBe(p)}const i=new ic("name");i.xform=t,n.push(i);function a(d,p){return p!==void 0?Number(p):p}const l=new ic("size");return l.xform=a,n.push(l),n.push(new ic("timeCreated")),n.push(new ic("updated")),n.push(new ic("md5Hash",null,!0)),n.push(new ic("cacheControl",null,!0)),n.push(new ic("contentDisposition",null,!0)),n.push(new ic("contentEncoding",null,!0)),n.push(new ic("contentLanguage",null,!0)),n.push(new ic("contentType",null,!0)),n.push(new ic("metadata","customMetadata",!0)),CO=n,CO}function UBe(n,t){function i(){const a=n.bucket,l=n.fullPath,d=new Al(a,l);return t._makeStorageReference(d)}Object.defineProperty(n,"ref",{get:i})}function VBe(n,t,i){const a={};a.type="file";const l=i.length;for(let d=0;d<l;d++){const p=i[d];a[p.local]=p.xform(a,t[p.server])}return UBe(a,n),a}function goe(n,t,i){const a=foe(t);return a===null?null:VBe(n,a,i)}function FBe(n,t,i,a){const l=foe(t);if(l===null||!w4(l.downloadTokens))return null;const d=l.downloadTokens;if(d.length===0)return null;const p=encodeURIComponent;return d.split(",").map(b=>{const w=n.bucket,A=n.fullPath,N="/b/"+p(w)+"/o/"+p(A),F=a1(N,i,a),j=loe({alt:"media",token:b});return F+j})[0]}function jBe(n,t){const i={},a=t.length;for(let l=0;l<a;l++){const d=t[l];d.writable&&(i[d.server]=n[d.local])}return JSON.stringify(i)}class C4{constructor(t,i,a,l){this.url=t,this.method=i,this.handler=a,this.timeout=l,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _oe(n){if(!n)throw T4()}function BBe(n,t){function i(a,l){const d=goe(n,l,t);return _oe(d!==null),d}return i}function WBe(n,t){function i(a,l){const d=goe(n,l,t);return _oe(d!==null),FBe(d,l,n.host,n._protocol)}return i}function Eoe(n){function t(i,a){let l;return i.getStatus()===401?i.getErrorText().includes("Firebase App Check token is invalid")?l=tBe():l=eBe():i.getStatus()===402?l=Z3e(n.bucket):i.getStatus()===403?l=nBe(n.path):l=a,l.status=i.getStatus(),l.serverResponse=a.serverResponse,l}return t}function yoe(n){const t=Eoe(n);function i(a,l){let d=t(a,l);return a.getStatus()===404&&(d=Q3e(n.path)),d.serverResponse=l.serverResponse,d}return i}function zBe(n,t,i){const a=t.fullServerUrl(),l=a1(a,n.host,n._protocol),d="GET",p=n.maxOperationRetryTime,E=new C4(l,d,WBe(n,i),p);return E.errorHandler=yoe(t),E}function GBe(n,t){const i=t.fullServerUrl(),a=a1(i,n.host,n._protocol),l="DELETE",d=n.maxOperationRetryTime;function p(v,b){}const E=new C4(a,l,p,d);return E.successCodes=[200,204],E.errorHandler=yoe(t),E}function HBe(n,t){return n&&n.contentType||t&&t.type()||"application/octet-stream"}function $Be(n,t,i){const a=Object.assign({},i);return a.fullPath=n.path,a.size=t.size(),a.contentType||(a.contentType=HBe(null,t)),a}function KBe(n,t,i,a,l){const d=t.bucketOnlyServerUrl(),p={"X-Goog-Upload-Protocol":"multipart"};function E(){let te="";for(let le=0;le<2;le++)te=te+Math.random().toString().slice(2);return te}const v=E();p["Content-Type"]="multipart/related; boundary="+v;const b=$Be(t,a,l),w=jBe(b,i),A="--"+v+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+w+`\r
--`+v+`\r
Content-Type: `+b.contentType+`\r
\r
`,N=`\r
--`+v+"--",F=ig.getBlob(A,a,N);if(F===null)throw cBe();const j={name:b.fullPath},B=a1(d,n.host,n._protocol),H="POST",ee=n.maxUploadRetryTime,K=new C4(B,H,BBe(n,i),ee);return K.urlParams=j,K.headers=p,K.body=F.uploadData(),K.errorHandler=Eoe(t),K}class qBe{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=bE.NO_ERROR,this.sendPromise_=new Promise(t=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=bE.ABORT,t()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=bE.NETWORK_ERROR,t()}),this.xhr_.addEventListener("load",()=>{t()})})}send(t,i,a,l){if(this.sent_)throw cw("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(i,t,!0),l!==void 0)for(const d in l)l.hasOwnProperty(d)&&this.xhr_.setRequestHeader(d,l[d].toString());return a!==void 0?this.xhr_.send(a):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw cw("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw cw("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw cw("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw cw("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(t){return this.xhr_.getResponseHeader(t)}addUploadProgressListener(t){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",t)}removeUploadProgressListener(t){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",t)}}class YBe extends qBe{initXhr(){this.xhr_.responseType="text"}}function I4(){return new YBe}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UE{constructor(t,i){this._service=t,i instanceof Al?this._location=i:this._location=Al.makeFromUrl(i,t.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(t,i){return new UE(t,i)}get root(){const t=new Al(this._location.bucket,"");return this._newRef(this._service,t)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return poe(this._location.path)}get storage(){return this._service}get parent(){const t=DBe(this._location.path);if(t===null)return null;const i=new Al(this._location.bucket,t);return new UE(this._service,i)}_throwIfRoot(t){if(this._location.path==="")throw dBe(t)}}function XBe(n,t,i){n._throwIfRoot("uploadBytes");const a=KBe(n.storage,n._location,moe(),new ig(t,!0),i);return n.storage.makeRequestWithTokens(a,I4).then(l=>({metadata:l,ref:n}))}function JBe(n){n._throwIfRoot("getDownloadURL");const t=zBe(n.storage,n._location,moe());return n.storage.makeRequestWithTokens(t,I4).then(i=>{if(i===null)throw lBe();return i})}function QBe(n){n._throwIfRoot("deleteObject");const t=GBe(n.storage,n._location);return n.storage.makeRequestWithTokens(t,I4)}function ZBe(n,t){const i=LBe(n._location.path,t),a=new Al(n._location.bucket,i);return new UE(n.storage,a)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function e5e(n){return/^[A-Za-z]+:\/\//.test(n)}function t5e(n,t){return new UE(n,t)}function voe(n,t){if(n instanceof A4){const i=n;if(i._bucket==null)throw aBe();const a=new UE(i,i._bucket);return t!=null?voe(a,t):a}else return t!==void 0?ZBe(n,t):n}function n5e(n,t){if(t&&e5e(t)){if(n instanceof A4)return t5e(n,t);throw BV("To use ref(service, url), the first argument must be a Storage instance.")}else return voe(n,t)}function fJ(n,t){const i=t==null?void 0:t[aoe];return i==null?null:Al.makeFromBucketSpec(i,n)}function r5e(n,t,i,a={}){n.host=`${t}:${i}`,n._protocol="http";const{mockUserToken:l}=a;l&&(n._overrideAuthToken=typeof l=="string"?l:Une(l,n.app.options.projectId))}class A4{constructor(t,i,a,l,d){this.app=t,this._authProvider=i,this._appCheckProvider=a,this._url=l,this._firebaseVersion=d,this._bucket=null,this._host=soe,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=X3e,this._maxUploadRetryTime=J3e,this._requests=new Set,l!=null?this._bucket=Al.makeFromBucketSpec(l,this._host):this._bucket=fJ(this._host,this.app.options)}get host(){return this._host}set host(t){this._host=t,this._url!=null?this._bucket=Al.makeFromBucketSpec(this._url,t):this._bucket=fJ(t,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(t){hJ("time",0,Number.POSITIVE_INFINITY,t),this._maxUploadRetryTime=t}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(t){hJ("time",0,Number.POSITIVE_INFINITY,t),this._maxOperationRetryTime=t}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const t=this._authProvider.getImmediate({optional:!0});if(t){const i=await t.getToken();if(i!==null)return i.accessToken}return null}async _getAppCheckToken(){if(Cl(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const t=this._appCheckProvider.getImmediate({optional:!0});return t?(await t.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(t=>t.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(t){return new UE(this,t)}_makeRequest(t,i,a,l,d=!0){if(this._deleted)return new hBe(coe());{const p=TBe(t,this._appId,a,l,i,this._firebaseVersion,d);return this._requests.add(p),p.getPromise().then(()=>this._requests.delete(p),()=>this._requests.delete(p)),p}}async makeRequestWithTokens(t,i){const[a,l]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(t,i,a,l).getPromise()}}const pJ="@firebase/storage",mJ="0.13.7";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Soe="storage";function P4(n,t,i){return n=Li(n),XBe(n,t,i)}function c1(n){return n=Li(n),JBe(n)}function O4(n){return n=Li(n),QBe(n)}function GE(n,t){return n=Li(n),n5e(n,t)}function HE(n=Aj(),t){n=Li(n);const a=MN(n,Soe).getImmediate({identifier:t}),l=Lne("storage");return l&&i5e(a,...l),a}function i5e(n,t,i,a={}){r5e(n,t,i,a)}function o5e(n,{instanceIdentifier:t}){const i=n.getProvider("app").getImmediate(),a=n.getProvider("auth-internal"),l=n.getProvider("app-check-internal");return new A4(i,a,l,t,jE)}function s5e(){kE(new Eg(Soe,o5e,"PUBLIC").setMultipleInstances(!0)),Yh(pJ,mJ,""),Yh(pJ,mJ,"esm2017")}s5e();const lk=async n=>{const t=HE(),i=GE(t,n);try{return await c1(i)}catch(a){throw Te.error("Failed to fetch HTTP URL from gs:// URL:","/src/packages/shared/firebase/firebaseStorage.js",a),a}};let MR={};const fg=async n=>{try{const t=Cs(Yo,"spaces",n),i=await Rg(t);if(i.exists()){let a=i.data();const l=a.name,d=a.description;if(a.webglBuildId){const p=Cs(Yo,"webglBuilds",a.webglBuildId),E=await Rg(p);if(E.exists()){const v=E.data();a={...a,...v,name:l||v.name,description:d||v.description}}else Te.warn(`spacesFirestore: No document found for webglBuildId: ${a.webglBuildId}`)}return a=await a5e(a),a=c5e(a),console.log("Space data:",a),Te.log(`spacesFirestore: Caching space data for: ${n}`),MR[n]=a,a}else return Te.warn(`spacesFirestore: No document found for item ID: ${n}`),null}catch(t){throw Te.error("spacesFirestore: Error fetching item data:",t),t}},a5e=async n=>{const i=["gsUrlCode","gsUrlData","gsUrlFramework","gsUrlLoader","gsUrlLoadingBackground"].map(async a=>{const l=n[a];l&&l.startsWith("gs://")&&(n[a]=await lk(l))});return await Promise.all(i),n},c5e=n=>{const{gsUrlCode:t,gsUrlData:i,gsUrlFramework:a,gsUrlLoader:l,...d}=n;return{...d,codeUrl:t,dataUrl:i,frameworkUrl:a,loaderUrl:l}};let iU={};const boe=async n=>{Te.log("spacesFirestore: Get Videos from Firestore for space: ",n);try{if(iU[n])return Te.log("spacesFirestore: Returning cached videos for space:",n),iU[n];const t=xR(Yo,`spaces/${n}/videos`),i=await Jk(t),a=[];return i.forEach(l=>{a.push({id:l.id,...l.data()})}),iU[n]=a,a}catch(t){throw Te.error("spacesFirestore: Error fetching Space videos from Firestore:",t),t}},l5e=async(n,t)=>{try{if(!n||!t)throw new Error("Missing required parameters: spaceId and logoFile");if(!t.type.startsWith("image/"))throw new Error("File must be an image");const i=HE(),a=Date.now(),l=t.name.split(".").pop(),d=`logo_${a}.${l}`,p=GE(i,`spaces/${n}/logo/${d}`);Te.log(`Uploading logo for space ${n}`);const E=await P4(p,t),v=await c1(E.ref),b=Cs(Yo,"spaces",n);return await Du(b,{logoUrl:v,logoGsUrl:`gs://${E.ref.bucket}/${E.ref.fullPath}`,logoFileName:d,updatedAt:new Date().toISOString()}),Te.log(`Successfully uploaded logo for space ${n}`),v}catch(i){throw Te.error("Error uploading space logo:",i),i}},u5e=async n=>{try{const t=Cs(Yo,"spaces",n),i=await Rg(t);if(!i.exists())return Te.warn(`No space found with ID: ${n}`),!1;const a=i.data();if(a.logoGsUrl){const l=HE(),d=GE(l,a.logoGsUrl);try{await O4(d),Te.log(`Deleted logo file from storage: ${a.logoGsUrl}`)}catch(p){Te.warn(`Could not delete logo file from storage: ${p.message}`)}}return await Du(t,{logoUrl:null,logoGsUrl:null,logoFileName:null,updatedAt:new Date().toISOString()}),Te.log(`Successfully removed logo for space ${n}`),!0}catch(t){throw Te.error("Error deleting space logo:",t),t}},d5e=async(n,t)=>{try{if(!n||!t)throw new Error("Missing required parameters: spaceId and backgroundFile");if(!t.type.startsWith("image/"))throw new Error("File must be an image");const i=HE(),a=Date.now(),l=t.name.split(".").pop(),d=`background_${a}.${l}`,p=GE(i,`spaces/${n}/background/${d}`);Te.log(`Uploading background for space ${n}`);const E=await P4(p,t),v=await c1(E.ref),b=Cs(Yo,"spaces",n);return await Du(b,{backgroundUrl:v,backgroundGsUrl:`gs://${E.ref.bucket}/${E.ref.fullPath}`,backgroundFileName:d,gsUrlLoadingBackground:`gs://${E.ref.bucket}/${E.ref.fullPath}`,updatedAt:new Date().toISOString()}),Te.log(`Successfully uploaded background for space ${n}`),v}catch(i){throw Te.error("Error uploading space background:",i),i}},h5e=async n=>{try{const t=Cs(Yo,"spaces",n),i=await Rg(t);if(!i.exists())return Te.warn(`No space found with ID: ${n}`),!1;const a=i.data();if(a.backgroundGsUrl){const l=HE(),d=GE(l,a.backgroundGsUrl);try{await O4(d),Te.log(`Deleted background file from storage: ${a.backgroundGsUrl}`)}catch(p){Te.warn(`Could not delete background file from storage: ${p.message}`)}}return await Du(t,{backgroundUrl:null,backgroundGsUrl:null,backgroundFileName:null,gsUrlLoadingBackground:null,updatedAt:new Date().toISOString()}),Te.log(`Successfully removed background references for space ${n}`),!0}catch(t){throw Te.error("Error deleting space background:",t),t}},f5e=async(n,t)=>{try{Te.log(`spacesFirestore: Updating settings for space: ${n}`,t);const i=Cs(Yo,"spaces",n),a=await Rg(i);if(!a.exists())throw new Error(`Space with ID ${n} not found`);const l=a.data(),d={...t,accessibleToAllUsers:t.accessibleToAllUsers!==void 0?t.accessibleToAllUsers:l.accessibleToAllUsers!==void 0?l.accessibleToAllUsers:!0,updatedAt:new Date().toISOString()};await Du(i,d),MR[n]&&delete MR[n],Te.log(`spacesFirestore: Successfully updated settings for space: ${n}`)}catch(i){throw Te.error(`spacesFirestore: Error updating settings for space: ${n}`,i),i}},p5e=async(n,t)=>{try{Te.log(`spacesFirestore: Setting accessibleToAllUsers=${t} for space: ${n}`);const i=Cs(Yo,"spaces",n);if(!(await Rg(i)).exists())throw new Error(`Space with ID ${n} not found`);await Du(i,{accessibleToAllUsers:t,updatedAt:new Date().toISOString()}),MR[n]&&delete MR[n],typeof window<"u"&&window.dispatchEvent(new CustomEvent("SpaceAccessibilityChanged",{detail:{spaceId:n,accessibleToAllUsers:t}})),Te.log(`spacesFirestore: Successfully updated accessibleToAllUsers for space: ${n}`)}catch(i){throw Te.error(`spacesFirestore: Error updating accessibleToAllUsers for space: ${n}`,i),i}},ja=L.createContext(null),l1=({children:n})=>{const[t,i]=L.useState(null),a=L.useRef(null),[l,d]=L.useState(!0),p=Rre(),E=K=>K?K.Nickname?K.Nickname:`${K.firstName} ${K.lastName}`:"Anon";L.useEffect(()=>{const K=SVe(p,async te=>{if(Te.log("UserProvider: Firebase onAuthStateChanged() fired"),te)try{const le=await rf(te.uid),oe=E(le),ge={uid:te.uid,email:te.email,emailVerified:te.emailVerified,...le,displayName:oe};console.log(ge),i(ge),a.current=ge,A(ge)}catch(le){Te.error("UserProvider: Error fetching user profile data:",le)}else i(null),a.current=null;d(!1)});return()=>{K&&K()}},[]);const v=async(K,te,le)=>{try{const{firstName:oe,lastName:ge}=le,Z=`${oe}${ge.charAt(0).toUpperCase()}`,Q={...le,Nickname:Z,rpmURL:"https://models.readyplayer.me/67c8408d38f7924e15a8bd0a.glb",groups:["users"]},ne=await $3e(K,te,Q),se=E(Q),fe={uid:ne.uid,email:ne.email,...Q,displayName:se};return i(fe),a.current=fe,Te.log("UserProvider: User registered successfully with groups:",Q.groups),fe}catch(oe){throw Te.error("UserProvider: Error creating user:",oe),oe}},b=async(K,te)=>{try{const le=await EVe(p,K,te);if(!le.user.emailVerified)throw await yV(le.user),Te.log("UserProvider: Verification email sent again to:",K),new Error("Please verify your email before signing in. A new verification email has been sent.");const oe=await rf(le.user.uid),ge=E(oe),Z={uid:le.user.uid,email:le.user.email,emailVerified:le.user.emailVerified,...oe,displayName:ge};i(Z),A(Z)}catch(le){throw Te.error("UserProvider: Error signing in:",le),le}},w=async()=>{try{await bVe(p),i(null),Te.log("UserProvider: User signed out.")}catch(K){throw Te.error("UserProvider: Error signing out:",K),K}},A=()=>{const K=a.current;if(K){const te=N(K);Te.log("UserProvider: sendUserToUnity() using the eventBus",te),Od.publish(Pd.sendUserToUnity,te)}else Te.log("UserProvider: No current user to send to Unity.")},N=K=>{const te={};return[...q3e,"uid"].forEach(oe=>{K.hasOwnProperty(oe)&&(te[oe]=K[oe])}),te},F=async K=>!t||!t.uid?!1:await ooe(t.uid,K),j=async K=>{if(!t||!t.uid)return!1;try{const te=await fg(K);if(te.usersAllowed.includes(t.uid)||te.userAdmin.includes(t.uid)||te.usersModerators.includes(t.uid))return!0;if(t.groups&&Array.isArray(t.groups)){const oe=`space_${K}_owners`,ge=`space_${K}_hosts`;if(t.groups.includes(oe)||t.groups.includes(ge))return Te.log(`UserProvider: User ${t.uid} has access to space ${K} as owner/host`),!0}return te.accessibleToAllUsers===!0&&t.groups?t.groups.includes("users"):!1}catch(te){return Te.error("UserProvider: Error verifying user access to space:",te),!1}},B=async K=>{if(!t||!t.uid)return!1;try{return(await fg(K)).userAdmin.includes(t.uid)}catch(te){return Te.error("UserProvider: Error verifying user admin status for space:",te),!1}},H=async K=>{if(!t||!t.uid)return!1;try{return(await fg(K)).usersModerators.includes(t.uid)}catch(te){return Te.error("UserProvider: Error verifying user moderator status for space:",te),!1}},ee=async()=>{try{const K=p.currentUser;return K&&!K.emailVerified?(await yV(K),Te.log("UserProvider: Verification email resent to:",K.email),!0):!1}catch(K){throw Te.error("UserProvider: Error resending verification email:",K),K}};return C.jsx(ja.Provider,{value:{user:t,loading:l,register:v,signIn:b,signOut:w,sendUserToUnity:A,isUserInGroup:F,userHasAccessToSpace:j,userIsAdminOfSpace:B,userIsModeratorOfSpace:H,resendVerificationEmail:ee},children:n})},Toe=L.createContext(),Ld=()=>L.useContext(Toe),k4=({children:n})=>{const[t,i]=L.useState(!1),a=L.useRef(null),[l,d]=L.useState(!1);L.useEffect(()=>{const v=()=>{const b=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent);d(b)};return v(),window.addEventListener("resize",v),()=>window.removeEventListener("resize",v)},[]);const p=L.useCallback(v=>{a.current=v},[]),E=L.useCallback(()=>{const v=a.current;if(!v)return;const b=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;if(l){console.log("Attempting mobile fullscreen...");const w=v.querySelector("video")||v;if(/iPhone|iPad|iPod/i.test(navigator.userAgent)){if(w.webkitEnterFullscreen)try{w.webkitEnterFullscreen(),i(!0);return}catch(A){console.error("iOS fullscreen error:",A)}try{if(w.webkitRequestFullscreen){w.webkitRequestFullscreen(),i(!0);return}}catch(A){console.error("iOS fallback fullscreen error:",A)}}if(/Android/i.test(navigator.userAgent))try{b?(document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen(),i(!1)):(v.requestFullscreen?v.requestFullscreen():v.webkitRequestFullscreen?v.webkitRequestFullscreen():v.mozRequestFullScreen?v.mozRequestFullScreen():v.msRequestFullscreen&&v.msRequestFullscreen(),i(!0));return}catch(A){console.error("Android fullscreen error:",A)}}try{b?document.exitFullscreen?document.exitFullscreen().then(()=>{i(!1)}).catch(w=>console.error("Error exiting fullscreen:",w)):document.webkitExitFullscreen?(document.webkitExitFullscreen(),i(!1)):document.mozCancelFullScreen?(document.mozCancelFullScreen(),i(!1)):document.msExitFullscreen&&(document.msExitFullscreen(),i(!1)):v.requestFullscreen?v.requestFullscreen().then(()=>{i(!0)}).catch(w=>console.error("Error entering fullscreen:",w)):v.webkitRequestFullscreen?(v.webkitRequestFullscreen(),i(!0)):v.mozRequestFullScreen?(v.mozRequestFullScreen(),i(!0)):v.msRequestFullscreen&&(v.msRequestFullscreen(),i(!0))}catch(w){console.error("Fullscreen error:",w)}},[l]);return L.useEffect(()=>{const v=()=>{const b=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;i(!!b)};return document.addEventListener("fullscreenchange",v),document.addEventListener("webkitfullscreenchange",v),document.addEventListener("mozfullscreenchange",v),document.addEventListener("MSFullscreenChange",v),()=>{document.removeEventListener("fullscreenchange",v),document.removeEventListener("webkitfullscreenchange",v),document.removeEventListener("mozfullscreenchange",v),document.removeEventListener("MSFullscreenChange",v)}},[]),C.jsx(Toe.Provider,{value:{isFullscreen:t,toggleFullscreen:E,fullscreenRef:a,setFullscreenRef:p,isMobile:l},children:C.jsx("div",{ref:p,style:{position:"relative",zIndex:1,width:"100%",height:"100%",overflow:"hidden"},children:n})})},m5e=O0({d:"M19.5,9.5h-.75V6.75a6.75,6.75,0,0,0-13.5,0V9.5H4.5a2,2,0,0,0-2,2V22a2,2,0,0,0,2,2h15a2,2,0,0,0,2-2V11.5A2,2,0,0,0,19.5,9.5Zm-9.5,6a2,2,0,1,1,3,1.723V19.5a1,1,0,0,1-2,0V17.223A1.994,1.994,0,0,1,10,15.5ZM7.75,6.75a4.25,4.25,0,0,1,8.5,0V9a.5.5,0,0,1-.5.5H8.25a.5.5,0,0,1-.5-.5Z",displayName:"LockIcon"}),g5e=O0({displayName:"ChevronDownIcon",d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"}),gJ=O0({displayName:"EmailIcon",path:C.jsxs("g",{fill:"currentColor",children:[C.jsx("path",{d:"M11.114,14.556a1.252,1.252,0,0,0,1.768,0L22.568,4.87a.5.5,0,0,0-.281-.849A1.966,1.966,0,0,0,22,4H2a1.966,1.966,0,0,0-.289.021.5.5,0,0,0-.281.849Z"}),C.jsx("path",{d:"M23.888,5.832a.182.182,0,0,0-.2.039l-6.2,6.2a.251.251,0,0,0,0,.354l5.043,5.043a.75.75,0,1,1-1.06,1.061l-5.043-5.043a.25.25,0,0,0-.354,0l-2.129,2.129a2.75,2.75,0,0,1-3.888,0L7.926,13.488a.251.251,0,0,0-.354,0L2.529,18.531a.75.75,0,0,1-1.06-1.061l5.043-5.043a.251.251,0,0,0,0-.354l-6.2-6.2a.18.18,0,0,0-.2-.039A.182.182,0,0,0,0,6V18a2,2,0,0,0,2,2H22a2,2,0,0,0,2-2V6A.181.181,0,0,0,23.888,5.832Z"})]})}),_5e=O0({displayName:"CloseIcon",d:"M.439,21.44a1.5,1.5,0,0,0,2.122,2.121L11.823,14.3a.25.25,0,0,1,.354,0l9.262,9.263a1.5,1.5,0,1,0,2.122-2.121L14.3,12.177a.25.25,0,0,1,0-.354l9.263-9.262A1.5,1.5,0,0,0,21.439.44L12.177,9.7a.25.25,0,0,1-.354,0L2.561.44A1.5,1.5,0,0,0,.439,2.561L9.7,11.823a.25.25,0,0,1,0,.354Z"}),E5e=O0({displayName:"QuestionOutlineIcon",path:C.jsxs("g",{stroke:"currentColor",strokeWidth:"1.5",children:[C.jsx("path",{strokeLinecap:"round",fill:"none",d:"M9,9a3,3,0,1,1,4,2.829,1.5,1.5,0,0,0-1,1.415V14.25"}),C.jsx("path",{fill:"none",strokeLinecap:"round",d:"M12,17.25a.375.375,0,1,0,.375.375A.375.375,0,0,0,12,17.25h0"}),C.jsx("circle",{fill:"none",strokeMiterlimit:"10",cx:"12",cy:"12",r:"11.25"})]})}),y5e=O0({displayName:"HamburgerIcon",viewBox:"0 0 24 24",d:"M 3 5 A 1.0001 1.0001 0 1 0 3 7 L 21 7 A 1.0001 1.0001 0 1 0 21 5 L 3 5 z M 3 11 A 1.0001 1.0001 0 1 0 3 13 L 21 13 A 1.0001 1.0001 0 1 0 21 11 L 3 11 z M 3 17 A 1.0001 1.0001 0 1 0 3 19 L 21 19 A 1.0001 1.0001 0 1 0 21 17 L 3 17 z"});var hC=n=>n.type==="checkbox",fE=n=>n instanceof Date,oc=n=>n==null;const woe=n=>typeof n=="object";var Vo=n=>!oc(n)&&!Array.isArray(n)&&woe(n)&&!fE(n),v5e=n=>Vo(n)&&n.target?hC(n.target)?n.target.checked:n.target.value:n,S5e=n=>n.substring(0,n.search(/\.\d+(\.|$)/))||n,b5e=(n,t)=>n.has(S5e(t)),T5e=n=>{const t=n.constructor&&n.constructor.prototype;return Vo(t)&&t.hasOwnProperty("isPrototypeOf")},N4=typeof window<"u"&&typeof window.HTMLElement<"u"&&typeof document<"u";function Su(n){let t;const i=Array.isArray(n),a=typeof FileList<"u"?n instanceof FileList:!1;if(n instanceof Date)t=new Date(n);else if(n instanceof Set)t=new Set(n);else if(!(N4&&(n instanceof Blob||a))&&(i||Vo(n)))if(t=i?[]:{},!i&&!T5e(n))t=n;else for(const l in n)n.hasOwnProperty(l)&&(t[l]=Su(n[l]));else return n;return t}var u1=n=>Array.isArray(n)?n.filter(Boolean):[],Ho=n=>n===void 0,sn=(n,t,i)=>{if(!t||!Vo(n))return i;const a=u1(t.split(/[,[\].]+?/)).reduce((l,d)=>oc(l)?l:l[d],n);return Ho(a)||a===n?Ho(n[t])?i:n[t]:a},Lh=n=>typeof n=="boolean",D4=n=>/^\w*$/.test(n),Roe=n=>u1(n.replace(/["|']|\]/g,"").split(/\.|\[/)),Hi=(n,t,i)=>{let a=-1;const l=D4(t)?[t]:Roe(t),d=l.length,p=d-1;for(;++a<d;){const E=l[a];let v=i;if(a!==p){const b=n[E];v=Vo(b)||Array.isArray(b)?b:isNaN(+l[a+1])?{}:[]}if(E==="__proto__"||E==="constructor"||E==="prototype")return;n[E]=v,n=n[E]}return n};const _J={BLUR:"blur",FOCUS_OUT:"focusout"},Id={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},op={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"};ni.createContext(null);var w5e=(n,t,i,a=!0)=>{const l={defaultValues:t._defaultValues};for(const d in n)Object.defineProperty(l,d,{get:()=>{const p=d;return t._proxyFormState[p]!==Id.all&&(t._proxyFormState[p]=!a||Id.all),n[p]}});return l},Gc=n=>Vo(n)&&!Object.keys(n).length,R5e=(n,t,i,a)=>{i(n);const{name:l,...d}=n;return Gc(d)||Object.keys(d).length>=Object.keys(t).length||Object.keys(d).find(p=>t[p]===Id.all)},uk=n=>Array.isArray(n)?n:[n];function C5e(n){const t=ni.useRef(n);t.current=n,ni.useEffect(()=>{const i=!n.disabled&&t.current.subject&&t.current.subject.subscribe({next:t.current.next});return()=>{i&&i.unsubscribe()}},[n.disabled])}var zh=n=>typeof n=="string",I5e=(n,t,i,a,l)=>zh(n)?(a&&t.watch.add(n),sn(i,n,l)):Array.isArray(n)?n.map(d=>(a&&t.watch.add(d),sn(i,d))):(a&&(t.watchAll=!0),i),A5e=(n,t,i,a,l)=>t?{...i[n],types:{...i[n]&&i[n].types?i[n].types:{},[a]:l||!0}}:{},EJ=n=>({isOnSubmit:!n||n===Id.onSubmit,isOnBlur:n===Id.onBlur,isOnChange:n===Id.onChange,isOnAll:n===Id.all,isOnTouch:n===Id.onTouched}),yJ=(n,t,i)=>!i&&(t.watchAll||t.watch.has(n)||[...t.watch].some(a=>n.startsWith(a)&&/^\.\w+/.test(n.slice(a.length))));const iR=(n,t,i,a)=>{for(const l of i||Object.keys(n)){const d=sn(n,l);if(d){const{_f:p,...E}=d;if(p){if(p.refs&&p.refs[0]&&t(p.refs[0],l)&&!a)return!0;if(p.ref&&t(p.ref,p.name)&&!a)return!0;if(iR(E,t))break}else if(Vo(E)&&iR(E,t))break}}};var P5e=(n,t,i)=>{const a=uk(sn(n,i));return Hi(a,"root",t[i]),Hi(n,i,a),n},L4=n=>n.type==="file",Fh=n=>typeof n=="function",Qk=n=>{if(!N4)return!1;const t=n?n.ownerDocument:0;return n instanceof(t&&t.defaultView?t.defaultView.HTMLElement:HTMLElement)},dk=n=>zh(n),x4=n=>n.type==="radio",Zk=n=>n instanceof RegExp;const vJ={value:!1,isValid:!1},SJ={value:!0,isValid:!0};var Coe=n=>{if(Array.isArray(n)){if(n.length>1){const t=n.filter(i=>i&&i.checked&&!i.disabled).map(i=>i.value);return{value:t,isValid:!!t.length}}return n[0].checked&&!n[0].disabled?n[0].attributes&&!Ho(n[0].attributes.value)?Ho(n[0].value)||n[0].value===""?SJ:{value:n[0].value,isValid:!0}:SJ:vJ}return vJ};const bJ={isValid:!1,value:null};var Ioe=n=>Array.isArray(n)?n.reduce((t,i)=>i&&i.checked&&!i.disabled?{isValid:!0,value:i.value}:t,bJ):bJ;function TJ(n,t,i="validate"){if(dk(n)||Array.isArray(n)&&n.every(dk)||Lh(n)&&!n)return{type:i,message:dk(n)?n:"",ref:t}}var mS=n=>Vo(n)&&!Zk(n)?n:{value:n,message:""},wJ=async(n,t,i,a,l,d)=>{const{ref:p,refs:E,required:v,maxLength:b,minLength:w,min:A,max:N,pattern:F,validate:j,name:B,valueAsNumber:H,mount:ee}=n._f,K=sn(i,B);if(!ee||t.has(B))return{};const te=E?E[0]:p,le=he=>{l&&te.reportValidity&&(te.setCustomValidity(Lh(he)?"":he||""),te.reportValidity())},oe={},ge=x4(p),Z=hC(p),Q=ge||Z,ne=(H||L4(p))&&Ho(p.value)&&Ho(K)||Qk(p)&&p.value===""||K===""||Array.isArray(K)&&!K.length,se=A5e.bind(null,B,a,oe),fe=(he,ue,Me,He=op.maxLength,rt=op.minLength)=>{const we=he?ue:Me;oe[B]={type:he?He:rt,message:we,ref:p,...se(he?He:rt,we)}};if(d?!Array.isArray(K)||!K.length:v&&(!Q&&(ne||oc(K))||Lh(K)&&!K||Z&&!Coe(E).isValid||ge&&!Ioe(E).isValid)){const{value:he,message:ue}=dk(v)?{value:!!v,message:v}:mS(v);if(he&&(oe[B]={type:op.required,message:ue,ref:te,...se(op.required,ue)},!a))return le(ue),oe}if(!ne&&(!oc(A)||!oc(N))){let he,ue;const Me=mS(N),He=mS(A);if(!oc(K)&&!isNaN(K)){const rt=p.valueAsNumber||K&&+K;oc(Me.value)||(he=rt>Me.value),oc(He.value)||(ue=rt<He.value)}else{const rt=p.valueAsDate||new Date(K),we=Ne=>new Date(new Date().toDateString()+" "+Ne),Ce=p.type=="time",ye=p.type=="week";zh(Me.value)&&K&&(he=Ce?we(K)>we(Me.value):ye?K>Me.value:rt>new Date(Me.value)),zh(He.value)&&K&&(ue=Ce?we(K)<we(He.value):ye?K<He.value:rt<new Date(He.value))}if((he||ue)&&(fe(!!he,Me.message,He.message,op.max,op.min),!a))return le(oe[B].message),oe}if((b||w)&&!ne&&(zh(K)||d&&Array.isArray(K))){const he=mS(b),ue=mS(w),Me=!oc(he.value)&&K.length>+he.value,He=!oc(ue.value)&&K.length<+ue.value;if((Me||He)&&(fe(Me,he.message,ue.message),!a))return le(oe[B].message),oe}if(F&&!ne&&zh(K)){const{value:he,message:ue}=mS(F);if(Zk(he)&&!K.match(he)&&(oe[B]={type:op.pattern,message:ue,ref:p,...se(op.pattern,ue)},!a))return le(ue),oe}if(j){if(Fh(j)){const he=await j(K,i),ue=TJ(he,te);if(ue&&(oe[B]={...ue,...se(op.validate,ue.message)},!a))return le(ue.message),oe}else if(Vo(j)){let he={};for(const ue in j){if(!Gc(he)&&!a)break;const Me=TJ(await j[ue](K,i),te,ue);Me&&(he={...Me,...se(ue,Me.message)},le(Me.message),a&&(oe[B]=he))}if(!Gc(he)&&(oe[B]={ref:te,...he},!a))return oe}}return le(!0),oe};function O5e(n,t){const i=t.slice(0,-1).length;let a=0;for(;a<i;)n=Ho(n)?a++:n[t[a++]];return n}function k5e(n){for(const t in n)if(n.hasOwnProperty(t)&&!Ho(n[t]))return!1;return!0}function ss(n,t){const i=Array.isArray(t)?t:D4(t)?[t]:Roe(t),a=i.length===1?n:O5e(n,i),l=i.length-1,d=i[l];return a&&delete a[d],l!==0&&(Vo(a)&&Gc(a)||Array.isArray(a)&&k5e(a))&&ss(n,i.slice(0,-1)),n}var oU=()=>{let n=[];return{get observers(){return n},next:l=>{for(const d of n)d.next&&d.next(l)},subscribe:l=>(n.push(l),{unsubscribe:()=>{n=n.filter(d=>d!==l)}}),unsubscribe:()=>{n=[]}}},WV=n=>oc(n)||!woe(n);function og(n,t){if(WV(n)||WV(t))return n===t;if(fE(n)&&fE(t))return n.getTime()===t.getTime();const i=Object.keys(n),a=Object.keys(t);if(i.length!==a.length)return!1;for(const l of i){const d=n[l];if(!a.includes(l))return!1;if(l!=="ref"){const p=t[l];if(fE(d)&&fE(p)||Vo(d)&&Vo(p)||Array.isArray(d)&&Array.isArray(p)?!og(d,p):d!==p)return!1}}return!0}var Aoe=n=>n.type==="select-multiple",N5e=n=>x4(n)||hC(n),sU=n=>Qk(n)&&n.isConnected,Poe=n=>{for(const t in n)if(Fh(n[t]))return!0;return!1};function eN(n,t={}){const i=Array.isArray(n);if(Vo(n)||i)for(const a in n)Array.isArray(n[a])||Vo(n[a])&&!Poe(n[a])?(t[a]=Array.isArray(n[a])?[]:{},eN(n[a],t[a])):oc(n[a])||(t[a]=!0);return t}function Ooe(n,t,i){const a=Array.isArray(n);if(Vo(n)||a)for(const l in n)Array.isArray(n[l])||Vo(n[l])&&!Poe(n[l])?Ho(t)||WV(i[l])?i[l]=Array.isArray(n[l])?eN(n[l],[]):{...eN(n[l])}:Ooe(n[l],oc(t)?{}:t[l],i[l]):i[l]=!og(n[l],t[l]);return i}var lw=(n,t)=>Ooe(n,t,eN(t)),koe=(n,{valueAsNumber:t,valueAsDate:i,setValueAs:a})=>Ho(n)?n:t?n===""?NaN:n&&+n:i&&zh(n)?new Date(n):a?a(n):n;function aU(n){const t=n.ref;return L4(t)?t.files:x4(t)?Ioe(n.refs).value:Aoe(t)?[...t.selectedOptions].map(({value:i})=>i):hC(t)?Coe(n.refs).value:koe(Ho(t.value)?n.ref.value:t.value,n)}var D5e=(n,t,i,a)=>{const l={};for(const d of n){const p=sn(t,d);p&&Hi(l,d,p._f)}return{criteriaMode:i,names:[...n],fields:l,shouldUseNativeValidation:a}},uw=n=>Ho(n)?n:Zk(n)?n.source:Vo(n)?Zk(n.value)?n.value.source:n.value:n;const RJ="AsyncFunction";var L5e=n=>!!n&&!!n.validate&&!!(Fh(n.validate)&&n.validate.constructor.name===RJ||Vo(n.validate)&&Object.values(n.validate).find(t=>t.constructor.name===RJ)),x5e=n=>n.mount&&(n.required||n.min||n.max||n.maxLength||n.minLength||n.pattern||n.validate);function CJ(n,t,i){const a=sn(n,i);if(a||D4(i))return{error:a,name:i};const l=i.split(".");for(;l.length;){const d=l.join("."),p=sn(t,d),E=sn(n,d);if(p&&!Array.isArray(p)&&i!==d)return{name:i};if(E&&E.type)return{name:d,error:E};l.pop()}return{name:i}}var M5e=(n,t,i,a,l)=>l.isOnAll?!1:!i&&l.isOnTouch?!(t||n):(i?a.isOnBlur:l.isOnBlur)?!n:(i?a.isOnChange:l.isOnChange)?n:!0,U5e=(n,t)=>!u1(sn(n,t)).length&&ss(n,t);const V5e={mode:Id.onSubmit,reValidateMode:Id.onChange,shouldFocusError:!0};function F5e(n={}){let t={...V5e,...n},i={submitCount:0,isDirty:!1,isLoading:Fh(t.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:t.errors||{},disabled:t.disabled||!1},a={},l=Vo(t.defaultValues)||Vo(t.values)?Su(t.defaultValues||t.values)||{}:{},d=t.shouldUnregister?{}:Su(l),p={action:!1,mount:!1,watch:!1},E={mount:new Set,disabled:new Set,unMount:new Set,array:new Set,watch:new Set},v,b=0;const w={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1},A={values:oU(),array:oU(),state:oU()},N=EJ(t.mode),F=EJ(t.reValidateMode),j=t.criteriaMode===Id.all,B=Re=>Fe=>{clearTimeout(b),b=setTimeout(Re,Fe)},H=async Re=>{if(!t.disabled&&(w.isValid||Re)){const Fe=t.resolver?Gc((await Q()).errors):await se(a,!0);Fe!==i.isValid&&A.state.next({isValid:Fe})}},ee=(Re,Fe)=>{!t.disabled&&(w.isValidating||w.validatingFields)&&((Re||Array.from(E.mount)).forEach(Ke=>{Ke&&(Fe?Hi(i.validatingFields,Ke,Fe):ss(i.validatingFields,Ke))}),A.state.next({validatingFields:i.validatingFields,isValidating:!Gc(i.validatingFields)}))},K=(Re,Fe=[],Ke,yt,St=!0,Ge=!0)=>{if(yt&&Ke&&!t.disabled){if(p.action=!0,Ge&&Array.isArray(sn(a,Re))){const Ot=Ke(sn(a,Re),yt.argA,yt.argB);St&&Hi(a,Re,Ot)}if(Ge&&Array.isArray(sn(i.errors,Re))){const Ot=Ke(sn(i.errors,Re),yt.argA,yt.argB);St&&Hi(i.errors,Re,Ot),U5e(i.errors,Re)}if(w.touchedFields&&Ge&&Array.isArray(sn(i.touchedFields,Re))){const Ot=Ke(sn(i.touchedFields,Re),yt.argA,yt.argB);St&&Hi(i.touchedFields,Re,Ot)}w.dirtyFields&&(i.dirtyFields=lw(l,d)),A.state.next({name:Re,isDirty:he(Re,Fe),dirtyFields:i.dirtyFields,errors:i.errors,isValid:i.isValid})}else Hi(d,Re,Fe)},te=(Re,Fe)=>{Hi(i.errors,Re,Fe),A.state.next({errors:i.errors})},le=Re=>{i.errors=Re,A.state.next({errors:i.errors,isValid:!1})},oe=(Re,Fe,Ke,yt)=>{const St=sn(a,Re);if(St){const Ge=sn(d,Re,Ho(Ke)?sn(l,Re):Ke);Ho(Ge)||yt&&yt.defaultChecked||Fe?Hi(d,Re,Fe?Ge:aU(St._f)):He(Re,Ge),p.mount&&H()}},ge=(Re,Fe,Ke,yt,St)=>{let Ge=!1,Ot=!1;const Jt={name:Re};if(!t.disabled){const fn=!!(sn(a,Re)&&sn(a,Re)._f&&sn(a,Re)._f.disabled);if(!Ke||yt){w.isDirty&&(Ot=i.isDirty,i.isDirty=Jt.isDirty=he(),Ge=Ot!==Jt.isDirty);const an=fn||og(sn(l,Re),Fe);Ot=!!(!fn&&sn(i.dirtyFields,Re)),an||fn?ss(i.dirtyFields,Re):Hi(i.dirtyFields,Re,!0),Jt.dirtyFields=i.dirtyFields,Ge=Ge||w.dirtyFields&&Ot!==!an}if(Ke){const an=sn(i.touchedFields,Re);an||(Hi(i.touchedFields,Re,Ke),Jt.touchedFields=i.touchedFields,Ge=Ge||w.touchedFields&&an!==Ke)}Ge&&St&&A.state.next(Jt)}return Ge?Jt:{}},Z=(Re,Fe,Ke,yt)=>{const St=sn(i.errors,Re),Ge=w.isValid&&Lh(Fe)&&i.isValid!==Fe;if(t.delayError&&Ke?(v=B(()=>te(Re,Ke)),v(t.delayError)):(clearTimeout(b),v=null,Ke?Hi(i.errors,Re,Ke):ss(i.errors,Re)),(Ke?!og(St,Ke):St)||!Gc(yt)||Ge){const Ot={...yt,...Ge&&Lh(Fe)?{isValid:Fe}:{},errors:i.errors,name:Re};i={...i,...Ot},A.state.next(Ot)}},Q=async Re=>{ee(Re,!0);const Fe=await t.resolver(d,t.context,D5e(Re||E.mount,a,t.criteriaMode,t.shouldUseNativeValidation));return ee(Re),Fe},ne=async Re=>{const{errors:Fe}=await Q(Re);if(Re)for(const Ke of Re){const yt=sn(Fe,Ke);yt?Hi(i.errors,Ke,yt):ss(i.errors,Ke)}else i.errors=Fe;return Fe},se=async(Re,Fe,Ke={valid:!0})=>{for(const yt in Re){const St=Re[yt];if(St){const{_f:Ge,...Ot}=St;if(Ge){const Jt=E.array.has(Ge.name),fn=St._f&&L5e(St._f);fn&&w.validatingFields&&ee([yt],!0);const an=await wJ(St,E.disabled,d,j,t.shouldUseNativeValidation&&!Fe,Jt);if(fn&&w.validatingFields&&ee([yt]),an[Ge.name]&&(Ke.valid=!1,Fe))break;!Fe&&(sn(an,Ge.name)?Jt?P5e(i.errors,an,Ge.name):Hi(i.errors,Ge.name,an[Ge.name]):ss(i.errors,Ge.name))}!Gc(Ot)&&await se(Ot,Fe,Ke)}}return Ke.valid},fe=()=>{for(const Re of E.unMount){const Fe=sn(a,Re);Fe&&(Fe._f.refs?Fe._f.refs.every(Ke=>!sU(Ke)):!sU(Fe._f.ref))&&et(Re)}E.unMount=new Set},he=(Re,Fe)=>!t.disabled&&(Re&&Fe&&Hi(d,Re,Fe),!og(be(),l)),ue=(Re,Fe,Ke)=>I5e(Re,E,{...p.mount?d:Ho(Fe)?l:zh(Re)?{[Re]:Fe}:Fe},Ke,Fe),Me=Re=>u1(sn(p.mount?d:l,Re,t.shouldUnregister?sn(l,Re,[]):[])),He=(Re,Fe,Ke={})=>{const yt=sn(a,Re);let St=Fe;if(yt){const Ge=yt._f;Ge&&(!Ge.disabled&&Hi(d,Re,koe(Fe,Ge)),St=Qk(Ge.ref)&&oc(Fe)?"":Fe,Aoe(Ge.ref)?[...Ge.ref.options].forEach(Ot=>Ot.selected=St.includes(Ot.value)):Ge.refs?hC(Ge.ref)?Ge.refs.length>1?Ge.refs.forEach(Ot=>(!Ot.defaultChecked||!Ot.disabled)&&(Ot.checked=Array.isArray(St)?!!St.find(Jt=>Jt===Ot.value):St===Ot.value)):Ge.refs[0]&&(Ge.refs[0].checked=!!St):Ge.refs.forEach(Ot=>Ot.checked=Ot.value===St):L4(Ge.ref)?Ge.ref.value="":(Ge.ref.value=St,Ge.ref.type||A.values.next({name:Re,values:{...d}})))}(Ke.shouldDirty||Ke.shouldTouch)&&ge(Re,St,Ke.shouldTouch,Ke.shouldDirty,!0),Ke.shouldValidate&&Ne(Re)},rt=(Re,Fe,Ke)=>{for(const yt in Fe){const St=Fe[yt],Ge=`${Re}.${yt}`,Ot=sn(a,Ge);(E.array.has(Re)||Vo(St)||Ot&&!Ot._f)&&!fE(St)?rt(Ge,St,Ke):He(Ge,St,Ke)}},we=(Re,Fe,Ke={})=>{const yt=sn(a,Re),St=E.array.has(Re),Ge=Su(Fe);Hi(d,Re,Ge),St?(A.array.next({name:Re,values:{...d}}),(w.isDirty||w.dirtyFields)&&Ke.shouldDirty&&A.state.next({name:Re,dirtyFields:lw(l,d),isDirty:he(Re,Ge)})):yt&&!yt._f&&!oc(Ge)?rt(Re,Ge,Ke):He(Re,Ge,Ke),yJ(Re,E)&&A.state.next({...i}),A.values.next({name:p.mount?Re:void 0,values:{...d}})},Ce=async Re=>{p.mount=!0;const Fe=Re.target;let Ke=Fe.name,yt=!0;const St=sn(a,Ke),Ge=()=>Fe.type?aU(St._f):v5e(Re),Ot=Jt=>{yt=Number.isNaN(Jt)||fE(Jt)&&isNaN(Jt.getTime())||og(Jt,sn(d,Ke,Jt))};if(St){let Jt,fn;const an=Ge(),ir=Re.type===_J.BLUR||Re.type===_J.FOCUS_OUT,ia=!x5e(St._f)&&!t.resolver&&!sn(i.errors,Ke)&&!St._f.deps||M5e(ir,sn(i.touchedFields,Ke),i.isSubmitted,F,N),Vt=yJ(Ke,E,ir);Hi(d,Ke,an),ir?(St._f.onBlur&&St._f.onBlur(Re),v&&v(0)):St._f.onChange&&St._f.onChange(Re);const on=ge(Ke,an,ir,!1),Pi=!Gc(on)||Vt;if(!ir&&A.values.next({name:Ke,type:Re.type,values:{...d}}),ia)return w.isValid&&(t.mode==="onBlur"&&ir?H():ir||H()),Pi&&A.state.next({name:Ke,...Vt?{}:on});if(!ir&&Vt&&A.state.next({...i}),t.resolver){const{errors:fi}=await Q([Ke]);if(Ot(an),yt){const Ti=CJ(i.errors,a,Ke),ur=CJ(fi,a,Ti.name||Ke);Jt=ur.error,Ke=ur.name,fn=Gc(fi)}}else ee([Ke],!0),Jt=(await wJ(St,E.disabled,d,j,t.shouldUseNativeValidation))[Ke],ee([Ke]),Ot(an),yt&&(Jt?fn=!1:w.isValid&&(fn=await se(a,!0)));yt&&(St._f.deps&&Ne(St._f.deps),Z(Ke,fn,Jt,on))}},ye=(Re,Fe)=>{if(sn(i.errors,Fe)&&Re.focus)return Re.focus(),1},Ne=async(Re,Fe={})=>{let Ke,yt;const St=uk(Re);if(t.resolver){const Ge=await ne(Ho(Re)?Re:St);Ke=Gc(Ge),yt=Re?!St.some(Ot=>sn(Ge,Ot)):Ke}else Re?(yt=(await Promise.all(St.map(async Ge=>{const Ot=sn(a,Ge);return await se(Ot&&Ot._f?{[Ge]:Ot}:Ot)}))).every(Boolean),!(!yt&&!i.isValid)&&H()):yt=Ke=await se(a);return A.state.next({...!zh(Re)||w.isValid&&Ke!==i.isValid?{}:{name:Re},...t.resolver||!Re?{isValid:Ke}:{},errors:i.errors}),Fe.shouldFocus&&!yt&&iR(a,ye,Re?St:E.mount),yt},be=Re=>{const Fe={...p.mount?d:l};return Ho(Re)?Fe:zh(Re)?sn(Fe,Re):Re.map(Ke=>sn(Fe,Ke))},Se=(Re,Fe)=>({invalid:!!sn((Fe||i).errors,Re),isDirty:!!sn((Fe||i).dirtyFields,Re),error:sn((Fe||i).errors,Re),isValidating:!!sn(i.validatingFields,Re),isTouched:!!sn((Fe||i).touchedFields,Re)}),Ae=Re=>{Re&&uk(Re).forEach(Fe=>ss(i.errors,Fe)),A.state.next({errors:Re?i.errors:{}})},Ue=(Re,Fe,Ke)=>{const yt=(sn(a,Re,{_f:{}})._f||{}).ref,St=sn(i.errors,Re)||{},{ref:Ge,message:Ot,type:Jt,...fn}=St;Hi(i.errors,Re,{...fn,...Fe,ref:yt}),A.state.next({name:Re,errors:i.errors,isValid:!1}),Ke&&Ke.shouldFocus&&yt&&yt.focus&&yt.focus()},ze=(Re,Fe)=>Fh(Re)?A.values.subscribe({next:Ke=>Re(ue(void 0,Fe),Ke)}):ue(Re,Fe,!0),et=(Re,Fe={})=>{for(const Ke of Re?uk(Re):E.mount)E.mount.delete(Ke),E.array.delete(Ke),Fe.keepValue||(ss(a,Ke),ss(d,Ke)),!Fe.keepError&&ss(i.errors,Ke),!Fe.keepDirty&&ss(i.dirtyFields,Ke),!Fe.keepTouched&&ss(i.touchedFields,Ke),!Fe.keepIsValidating&&ss(i.validatingFields,Ke),!t.shouldUnregister&&!Fe.keepDefaultValue&&ss(l,Ke);A.values.next({values:{...d}}),A.state.next({...i,...Fe.keepDirty?{isDirty:he()}:{}}),!Fe.keepIsValid&&H()},nt=({disabled:Re,name:Fe,field:Ke,fields:yt})=>{(Lh(Re)&&p.mount||Re||E.disabled.has(Fe))&&(Re?E.disabled.add(Fe):E.disabled.delete(Fe),ge(Fe,aU(Ke?Ke._f:sn(yt,Fe)._f),!1,!1,!0))},dt=(Re,Fe={})=>{let Ke=sn(a,Re);const yt=Lh(Fe.disabled)||Lh(t.disabled);return Hi(a,Re,{...Ke||{},_f:{...Ke&&Ke._f?Ke._f:{ref:{name:Re}},name:Re,mount:!0,...Fe}}),E.mount.add(Re),Ke?nt({field:Ke,disabled:Lh(Fe.disabled)?Fe.disabled:t.disabled,name:Re}):oe(Re,!0,Fe.value),{...yt?{disabled:Fe.disabled||t.disabled}:{},...t.progressive?{required:!!Fe.required,min:uw(Fe.min),max:uw(Fe.max),minLength:uw(Fe.minLength),maxLength:uw(Fe.maxLength),pattern:uw(Fe.pattern)}:{},name:Re,onChange:Ce,onBlur:Ce,ref:St=>{if(St){dt(Re,Fe),Ke=sn(a,Re);const Ge=Ho(St.value)&&St.querySelectorAll&&St.querySelectorAll("input,select,textarea")[0]||St,Ot=N5e(Ge),Jt=Ke._f.refs||[];if(Ot?Jt.find(fn=>fn===Ge):Ge===Ke._f.ref)return;Hi(a,Re,{_f:{...Ke._f,...Ot?{refs:[...Jt.filter(sU),Ge,...Array.isArray(sn(l,Re))?[{}]:[]],ref:{type:Ge.type,name:Re}}:{ref:Ge}}}),oe(Re,!1,void 0,Ge)}else Ke=sn(a,Re,{}),Ke._f&&(Ke._f.mount=!1),(t.shouldUnregister||Fe.shouldUnregister)&&!(b5e(E.array,Re)&&p.action)&&E.unMount.add(Re)}}},Xe=()=>t.shouldFocusError&&iR(a,ye,E.mount),It=Re=>{Lh(Re)&&(A.state.next({disabled:Re}),iR(a,(Fe,Ke)=>{const yt=sn(a,Ke);yt&&(Fe.disabled=yt._f.disabled||Re,Array.isArray(yt._f.refs)&&yt._f.refs.forEach(St=>{St.disabled=yt._f.disabled||Re}))},0,!1))},hn=(Re,Fe)=>async Ke=>{let yt;Ke&&(Ke.preventDefault&&Ke.preventDefault(),Ke.persist&&Ke.persist());let St=Su(d);if(E.disabled.size)for(const Ge of E.disabled)Hi(St,Ge,void 0);if(A.state.next({isSubmitting:!0}),t.resolver){const{errors:Ge,values:Ot}=await Q();i.errors=Ge,St=Ot}else await se(a);if(ss(i.errors,"root"),Gc(i.errors)){A.state.next({errors:{}});try{await Re(St,Ke)}catch(Ge){yt=Ge}}else Fe&&await Fe({...i.errors},Ke),Xe(),setTimeout(Xe);if(A.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:Gc(i.errors)&&!yt,submitCount:i.submitCount+1,errors:i.errors}),yt)throw yt},Ut=(Re,Fe={})=>{sn(a,Re)&&(Ho(Fe.defaultValue)?we(Re,Su(sn(l,Re))):(we(Re,Fe.defaultValue),Hi(l,Re,Su(Fe.defaultValue))),Fe.keepTouched||ss(i.touchedFields,Re),Fe.keepDirty||(ss(i.dirtyFields,Re),i.isDirty=Fe.defaultValue?he(Re,Su(sn(l,Re))):he()),Fe.keepError||(ss(i.errors,Re),w.isValid&&H()),A.state.next({...i}))},ln=(Re,Fe={})=>{const Ke=Re?Su(Re):l,yt=Su(Ke),St=Gc(Re),Ge=St?l:yt;if(Fe.keepDefaultValues||(l=Ke),!Fe.keepValues){if(Fe.keepDirtyValues){const Ot=new Set([...E.mount,...Object.keys(lw(l,d))]);for(const Jt of Array.from(Ot))sn(i.dirtyFields,Jt)?Hi(Ge,Jt,sn(d,Jt)):we(Jt,sn(Ge,Jt))}else{if(N4&&Ho(Re))for(const Ot of E.mount){const Jt=sn(a,Ot);if(Jt&&Jt._f){const fn=Array.isArray(Jt._f.refs)?Jt._f.refs[0]:Jt._f.ref;if(Qk(fn)){const an=fn.closest("form");if(an){an.reset();break}}}}a={}}d=t.shouldUnregister?Fe.keepDefaultValues?Su(l):{}:Su(Ge),A.array.next({values:{...Ge}}),A.values.next({values:{...Ge}})}E={mount:Fe.keepDirtyValues?E.mount:new Set,unMount:new Set,array:new Set,disabled:new Set,watch:new Set,watchAll:!1,focus:""},p.mount=!w.isValid||!!Fe.keepIsValid||!!Fe.keepDirtyValues,p.watch=!!t.shouldUnregister,A.state.next({submitCount:Fe.keepSubmitCount?i.submitCount:0,isDirty:St?!1:Fe.keepDirty?i.isDirty:!!(Fe.keepDefaultValues&&!og(Re,l)),isSubmitted:Fe.keepIsSubmitted?i.isSubmitted:!1,dirtyFields:St?{}:Fe.keepDirtyValues?Fe.keepDefaultValues&&d?lw(l,d):i.dirtyFields:Fe.keepDefaultValues&&Re?lw(l,Re):Fe.keepDirty?i.dirtyFields:{},touchedFields:Fe.keepTouched?i.touchedFields:{},errors:Fe.keepErrors?i.errors:{},isSubmitSuccessful:Fe.keepIsSubmitSuccessful?i.isSubmitSuccessful:!1,isSubmitting:!1})},Ln=(Re,Fe)=>ln(Fh(Re)?Re(d):Re,Fe);return{control:{register:dt,unregister:et,getFieldState:Se,handleSubmit:hn,setError:Ue,_executeSchema:Q,_getWatch:ue,_getDirty:he,_updateValid:H,_removeUnmounted:fe,_updateFieldArray:K,_updateDisabledField:nt,_getFieldArray:Me,_reset:ln,_resetDefaultValues:()=>Fh(t.defaultValues)&&t.defaultValues().then(Re=>{Ln(Re,t.resetOptions),A.state.next({isLoading:!1})}),_updateFormState:Re=>{i={...i,...Re}},_disableForm:It,_subjects:A,_proxyFormState:w,_setErrors:le,get _fields(){return a},get _formValues(){return d},get _state(){return p},set _state(Re){p=Re},get _defaultValues(){return l},get _names(){return E},set _names(Re){E=Re},get _formState(){return i},set _formState(Re){i=Re},get _options(){return t},set _options(Re){t={...t,...Re}}},trigger:Ne,register:dt,handleSubmit:hn,watch:ze,setValue:we,getValues:be,reset:Ln,resetField:Ut,clearErrors:Ae,unregister:et,setError:Ue,setFocus:(Re,Fe={})=>{const Ke=sn(a,Re),yt=Ke&&Ke._f;if(yt){const St=yt.refs?yt.refs[0]:yt.ref;St.focus&&(St.focus(),Fe.shouldSelect&&Fh(St.select)&&St.select())}},getFieldState:Se}}function Noe(n={}){const t=ni.useRef(void 0),i=ni.useRef(void 0),[a,l]=ni.useState({isDirty:!1,isValidating:!1,isLoading:Fh(n.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:n.errors||{},disabled:n.disabled||!1,defaultValues:Fh(n.defaultValues)?void 0:n.defaultValues});t.current||(t.current={...F5e(n),formState:a});const d=t.current.control;return d._options=n,C5e({subject:d._subjects.state,next:p=>{R5e(p,d._proxyFormState,d._updateFormState)&&l({...d._formState})}}),ni.useEffect(()=>d._disableForm(n.disabled),[d,n.disabled]),ni.useEffect(()=>{if(d._proxyFormState.isDirty){const p=d._getDirty();p!==a.isDirty&&d._subjects.state.next({isDirty:p})}},[d,a.isDirty]),ni.useEffect(()=>{n.values&&!og(n.values,i.current)?(d._reset(n.values,d._options.resetOptions),i.current=n.values,l(p=>({...p}))):d._resetDefaultValues()},[n.values,d]),ni.useEffect(()=>{n.errors&&d._setErrors(n.errors)},[n.errors,d]),ni.useEffect(()=>{d._state.mount||(d._updateValid(),d._state.mount=!0),d._state.watch&&(d._state.watch=!1,d._subjects.state.next({...d._formState})),d._removeUnmounted()}),ni.useEffect(()=>{n.shouldUnregister&&d._subjects.values.next({values:d._getWatch()})},[n.shouldUnregister,d]),t.current.formState=w5e(a,d),t.current}const d1=(n,t="generic-modal")=>{L.useEffect(()=>{if(!window.unityInstance)return;const i=()=>{try{window.unityInstance.SendMessage("WebGLInputManager","Disable"),Te.log(`Unity input disabled for ${t}`),document.body.classList.add("unity-input-disabled"),window.unityInputDisabled=!0,window.unityInputDisabledBy=t}catch(l){Te.error(`Failed to disable Unity input for ${t}:`,l)}},a=()=>{try{window.unityInputDisabledBy===t?(window.unityInstance.SendMessage("WebGLInputManager","Enable"),Te.log(`Unity input re-enabled (was disabled by ${t})`),document.body.classList.remove("unity-input-disabled"),window.unityInputDisabled=!1,window.unityInputDisabledBy=null):Te.log(`Not re-enabling Unity input for ${t} because it was disabled by ${window.unityInputDisabledBy}`)}catch(l){Te.error(`Failed to enable Unity input for ${t}:`,l)}};return n?i():a(),()=>{n&&a()}},[n,t])};function h1({mode:n,label:t,buttonProps:i={},isOpen:a,onClose:l}){const{register:d,handleSubmit:p,formState:{errors:E}}=Noe(),{register:v}=L.useContext(ja),b=Dd(),{fullscreenRef:w}=Ld(),[A,N]=L.useState(!1),[F,j]=L.useState(!1),B=a!==void 0?a:A,H=l||(()=>N(!1));d1(B);const ee=async le=>{const{email:oe,password:ge,confirmPassword:Z,...Q}=le;if(ge!==Z){b({title:"Error",description:"Passwords do not match.",status:"error",duration:3e3,isClosable:!0,position:"top"});return}j(!0);try{const ne=await v(oe,ge,Q);Te.log("User: Registration process complete."),H(),b({title:"Registration Successful",description:"Your account has been created. Please check your email to verify your account before signing in.",status:"success",duration:7e3,isClosable:!0,position:"top"})}catch(ne){Te.error("User: Registration Error:",ne),b({title:"Error",description:"An error occurred during registration. Please try again.",status:"error",duration:3e3,isClosable:!0,position:"top"})}finally{j(!1)}},K=()=>{l?l():N(!A)},te=n==="link"?C.jsx(Ru,{variant:"header",onClick:K,children:t}):C.jsx(bi,{onClick:K,...i,children:t});return C.jsxs(C.Fragment,{children:[!a&&te,C.jsxs(xa,{isOpen:B,onClose:H,size:"md",portalProps:{containerRef:w},isCentered:!0,motionPreset:"slideInBottom",blockScrollOnMount:!1,children:[C.jsx(Va,{bg:"blackAlpha.800",backdropFilter:"blur(5px)"}),C.jsxs(Ma,{bg:"gray.800",borderRadius:"xl",boxShadow:"xl",color:"white",maxW:"md",mx:4,position:"relative",zIndex:9999,sx:{isolation:"isolate","& input":{position:"relative",zIndex:1e4,isolation:"isolate"},"& *":{pointerEvents:"auto !important"}},onKeyDown:le=>{le.stopPropagation()},children:[C.jsxs(Ll,{p:8,textAlign:"center",children:[C.jsx(Ok,{size:"lg",mb:2,children:"Create Account"}),C.jsx(ht,{fontSize:"sm",color:"gray.400",children:"Fill in your details to get started"})]}),C.jsx(cc,{color:"gray.400"}),C.jsx(Ua,{px:8,children:C.jsx("form",{onSubmit:p(ee),children:C.jsxs(ri,{spacing:4,children:[C.jsxs(Si,{isInvalid:E.companyName,isRequired:!0,children:[C.jsx(ao,{placeholder:"Company Name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("companyName",{required:"Company name is required"})}),C.jsx(cp,{children:E.companyName&&E.companyName.message})]}),C.jsxs(Ai,{gap:4,w:"100%",children:[C.jsxs(Si,{isInvalid:E.firstName,isRequired:!0,children:[C.jsx(ao,{placeholder:"First Name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("firstName",{required:"First name is required"})}),C.jsx(cp,{children:E.firstName&&E.firstName.message})]}),C.jsxs(Si,{isInvalid:E.lastName,isRequired:!0,children:[C.jsx(ao,{placeholder:"Last Name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("lastName",{required:"Last name is required"})}),C.jsx(cp,{children:E.lastName&&E.lastName.message})]})]}),C.jsxs(Si,{isInvalid:E.email,isRequired:!0,children:[C.jsx(ao,{type:"email",placeholder:"Work Email Address",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("email",{required:"Email is required",pattern:{value:/^[^@ \t\r\n]+@[^@ \t\r\n]+\.[^@ \t\r\n]+$/,message:"Invalid email address"}})}),C.jsx(cp,{children:E.email&&E.email.message})]}),C.jsxs(Ai,{gap:4,w:"100%",children:[C.jsxs(Si,{isInvalid:E.password,isRequired:!0,children:[C.jsx(ao,{type:"password",placeholder:"Password",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("password",{required:"Password is required",minLength:{value:8,message:"Password must be at least 8 characters long"}})}),C.jsx(cp,{children:E.password&&E.password.message})]}),C.jsxs(Si,{isInvalid:E.confirmPassword,isRequired:!0,children:[C.jsx(ao,{type:"password",placeholder:"Confirm Password",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("confirmPassword",{required:"Confirm password is required"})}),C.jsx(cp,{children:E.confirmPassword&&E.confirmPassword.message})]})]}),C.jsx(Si,{children:C.jsx(ao,{placeholder:"Access Code",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("accessCode")})}),C.jsx(Si,{children:C.jsx(ao,{placeholder:"LinkedIn Profile (optional)",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("linkedInProfile")})})]})})}),C.jsxs(PE,{px:8,pb:8,flexDirection:"column",gap:4,children:[C.jsx(bi,{type:"submit",colorScheme:"blue",size:"lg",width:"100%",onClick:p(ee),isLoading:F,loadingText:"Creating Account",children:"Create Account"}),C.jsxs(ht,{fontSize:"sm",color:"gray.400",textAlign:"center",children:["Already have an account?"," ",C.jsx(Ru,{color:"blue.400",onClick:()=>{H(),window.dispatchEvent(new CustomEvent("openSignInModal"))},children:"Sign In"})]})]})]})]})]})}h1.propTypes={mode:gr.oneOf(["button","link"]),label:gr.string,buttonProps:gr.object,isOpen:gr.bool,onClose:gr.func};function f1({mode:n="button",label:t="Sign In",buttonProps:i={},initialIsOpen:a=!1}){const{signIn:l}=L.useContext(ja),{fullscreenRef:d}=Ld(),p=Dd(),{register:E,handleSubmit:v,formState:{errors:b,isSubmitting:w}}=Noe({defaultValues:{email:"neil@pursey.net",password:"123456"}}),[A,N]=L.useState(a),[F,j]=L.useState(!1),[B,H]=L.useState(!1),[ee,K]=L.useState(""),[te,le]=L.useState(!1);d1(A||B),L.useEffect(()=>{const fe=()=>{N(!0)};return window.addEventListener("openSignInModal",fe),()=>{window.removeEventListener("openSignInModal",fe)}},[]);const oe=async fe=>{try{await l(fe.email,fe.password),Te.log("User: Sign-in process complete."),N(!1),window.location.reload()}catch(he){Te.error("User: SignIn Error:",he);const ue=he.message||"An error occurred while logging in. Please check your credentials.",Me=ue.includes("verify your email");p({title:Me?"Email Verification Required":"Error",description:ue,status:Me?"warning":"error",duration:1e4,isClosable:!0,position:"top",container:d.current})}},ge=async()=>{if(!ee){p({title:"Email Required",description:"Please enter your email address to reset your password.",status:"warning",duration:3e3,isClosable:!0,position:"top",container:d.current});return}try{le(!0),await gVe(roe,ee),p({title:"Password Reset Email Sent",description:"Check your email for instructions to reset your password.",status:"success",duration:5e3,isClosable:!0,position:"top",container:d.current}),H(!1)}catch(fe){Te.error("User: Reset Password Error:",fe),p({title:"Error",description:fe.message||"Failed to send password reset email. Please try again.",status:"error",duration:5e3,isClosable:!0,position:"top",container:d.current})}finally{le(!1)}},Z=()=>N(fe=>!fe),Q=()=>{N(!1),j(!0)},ne=()=>{H(!0)},se=n==="link"?C.jsx(Ru,{variant:"header",onClick:Z,children:t}):C.jsx(bi,{onClick:Z,...i,children:t});return C.jsxs(C.Fragment,{children:[se,C.jsxs(xa,{isOpen:A,onClose:Z,size:"md",portalProps:{containerRef:d},isCentered:!0,motionPreset:"slideInBottom",blockScrollOnMount:!1,children:[C.jsx(Va,{bg:"blackAlpha.800",backdropFilter:"blur(5px)"}),C.jsx("form",{onSubmit:v(oe),children:C.jsxs(Ma,{bg:"gray.800",borderRadius:"xl",boxShadow:"xl",color:"white",maxW:"md",mx:4,position:"relative",zIndex:9999,sx:{isolation:"isolate","& input":{position:"relative",zIndex:1e4,isolation:"isolate"},"& *":{pointerEvents:"auto !important"}},onKeyDown:fe=>{fe.stopPropagation()},children:[C.jsxs(Ll,{p:8,textAlign:"center",children:[C.jsx(Ok,{size:"lg",mb:2,children:"Welcome Back"}),C.jsx(ht,{fontSize:"sm",color:"gray.400",children:"Enter your credentials to access your account"})]}),C.jsx(cc,{color:"gray.400"}),C.jsx(Ua,{px:8,pb:8,children:C.jsxs(ri,{spacing:4,children:[C.jsxs(Si,{isInvalid:b.email,children:[C.jsxs(qO,{children:[C.jsx(Xw,{pointerEvents:"none",children:C.jsx(gJ,{color:"gray.500"})}),C.jsx(ao,{type:"email",placeholder:"Email",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...E("email",{required:"Email is required."})})]}),C.jsx(cp,{children:b.email&&b.email.message})]}),C.jsxs(Si,{isInvalid:b.password,children:[C.jsxs(qO,{children:[C.jsx(Xw,{pointerEvents:"none",children:C.jsx(m5e,{color:"gray.500"})}),C.jsx(ao,{type:"password",placeholder:"Password",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...E("password",{required:"Password is required."})})]}),C.jsx(cp,{children:b.password&&b.password.message})]}),C.jsx(Rt,{alignSelf:"flex-end",children:C.jsx(Ru,{color:"blue.400",fontSize:"sm",onClick:ne,children:"Forgot Password?"})})]})}),C.jsxs(PE,{px:8,pb:8,flexDirection:"column",gap:4,children:[C.jsx(bi,{type:"submit",colorScheme:"blue",size:"lg",width:"100%",isLoading:w,loadingText:"Signing In",children:"Sign In"}),C.jsxs(ht,{fontSize:"sm",color:"gray.400",textAlign:"center",children:["Don't have an account?"," ",C.jsx(Ru,{color:"blue.400",onClick:Q,children:"Sign Up"})]})]})]})})]}),C.jsxs(xa,{isOpen:B,onClose:()=>H(!1),size:"md",portalProps:{containerRef:d},isCentered:!0,motionPreset:"slideInBottom",blockScrollOnMount:!1,children:[C.jsx(Va,{bg:"blackAlpha.800",backdropFilter:"blur(5px)"}),C.jsxs(Ma,{bg:"gray.800",borderRadius:"xl",boxShadow:"xl",color:"white",maxW:"md",mx:4,position:"relative",zIndex:9999,sx:{isolation:"isolate","& input":{position:"relative",zIndex:1e4,isolation:"isolate"},"& *":{pointerEvents:"auto !important"}},onKeyDown:fe=>{fe.stopPropagation()},children:[C.jsxs(Ll,{p:8,textAlign:"center",children:[C.jsx(Ok,{size:"lg",mb:2,children:"Reset Password"}),C.jsx(ht,{fontSize:"sm",color:"gray.400",children:"Enter your email to receive password reset instructions"})]}),C.jsx(cc,{color:"gray.400"}),C.jsx(Ua,{px:8,pb:4,children:C.jsx(Si,{children:C.jsxs(qO,{children:[C.jsx(Xw,{pointerEvents:"none",children:C.jsx(gJ,{color:"gray.500"})}),C.jsx(ao,{type:"email",placeholder:"Email",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},value:ee,onChange:fe=>K(fe.target.value)})]})})}),C.jsxs(PE,{px:8,pb:8,flexDirection:"column",gap:4,children:[C.jsx(bi,{colorScheme:"blue",size:"lg",width:"100%",onClick:ge,isLoading:te,loadingText:"Sending",children:"Send Reset Link"}),C.jsxs(ht,{fontSize:"sm",color:"gray.400",textAlign:"center",children:["Remember your password?"," ",C.jsx(Ru,{color:"blue.400",onClick:()=>H(!1),children:"Back to Sign In"})]})]})]})]}),C.jsx(h1,{mode:"link",isOpen:F,onClose:()=>j(!1)})]})}f1.propTypes={mode:gr.oneOf(["button","link"]),label:gr.string,buttonProps:gr.object,initialIsOpen:gr.bool};function M4({mode:n="button",label:t="Sign Out"}){const i=Dd(),{signOut:a}=L.useContext(ja),{fullscreenRef:l}=Ld(),d=async()=>{try{await a(),i({title:"Logged Out",description:"You have been successfully logged out.",status:"success",duration:3e3,isClosable:!0,position:"top",container:l.current}),window.location.href="/"}catch(E){console.error("SignOut Error:",E),i({title:"Error",description:"An error occurred while logging out.",status:"error",duration:3e3,isClosable:!0,position:"top",container:l.current})}},p=n==="link"?C.jsx(Ru,{variant:"header",onClick:d,style:{cursor:"pointer"},children:t}):null;return C.jsx(C.Fragment,{children:p})}M4.propTypes={mode:gr.oneOf(["button","link"]),label:gr.string};const S0=()=>window.unityInstance||window.gameInstance||window.reactUnityInstance,U4=()=>{document.body.classList.add("unity-focused");const n=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Space","PageUp","PageDown","Home","End"],t=a=>{if(n.includes(a.key)){const l=a.target.tagName==="INPUT"||a.target.tagName==="TEXTAREA"||a.target.isContentEditable,d=document.querySelector("canvas")||document.getElementById("unity-canvas"),p=a.target.closest("canvas")||a.target.closest("#webgl-root"),E=document.activeElement===d;!l&&(p||E)&&a.preventDefault()}},i=a=>{document.querySelector("canvas")||document.getElementById("unity-canvas"),document.getElementById("unity-container")||document.getElementById("webgl-root"),a.target.closest("canvas")||a.target.closest("#webgl-root")?document.body.classList.add("unity-focused"):document.body.classList.remove("unity-focused")};return document.addEventListener("keydown",t),document.addEventListener("click",i),()=>{document.body.classList.remove("unity-focused"),document.removeEventListener("keydown",t),document.removeEventListener("click",i)}},Doe=()=>{document.body.classList.remove("unity-focused")};function tN(n){return console.log(`Setting Unity keyboard capture: ${n}`),n?(document.body.classList.add("unity-focused"),window.unityKeyboardEnabled=!0):(document.body.classList.remove("unity-focused"),window.unityKeyboardEnabled=!1),n?U4():Doe(),new Promise(t=>{try{const i=S0();if(i){try{n?i.SendMessage("WebGLInput","EnableKeyboardCapture"):i.SendMessage("WebGLInput","DisableKeyboardCapture"),console.log(`Unity keyboard capture ${n?"enabled":"disabled"} (using Unity preferred method)`),t(!0);return}catch(a){console.warn("Failed to use Unity preferred keyboard method, falling back to SetCaptureAllKeyboardInput",a)}try{i.SendMessage("WebGLInput","SetCaptureAllKeyboardInput",n),console.log(`Unity keyboard capture ${n?"enabled":"disabled"} (using fallback method)`),t(!0);return}catch(a){console.warn("Failed to use SetCaptureAllKeyboardInput, trying module method",a)}if(i.Module){!n&&i.Module.WebGLInputHandler&&!window._originalWebGLInputHandler&&(window._originalWebGLInputHandler=i.Module.WebGLInputHandler),n&&window._originalWebGLInputHandler?(i.Module.WebGLInputHandler=window._originalWebGLInputHandler,window._originalWebGLInputHandler=null):n||(i.Module.WebGLInputHandler=null),console.log(`Unity keyboard capture ${n?"enabled":"disabled"} (using Module method)`),t(!0);return}}else console.warn("Unity instance not available, cannot set keyboard capture"),window.__pendingKeyboardCaptureState=n,document.getElementById("webgl-root")&&(console.log("webgl-root detected, will poll for Unity instance"),zV(n)),t(!1)}catch(i){console.error("Error setting Unity keyboard capture:",i),t(!1)}})}function zV(n){window.__unityInstancePoller&&clearTimeout(window.__unityInstancePoller);const t=20;let i=0;const a=()=>{i++;const l=S0();if(l){console.log(`Unity instance found after ${i} attempts`);try{n?l.SendMessage("WebGLInput","EnableKeyboardCapture"):l.SendMessage("WebGLInput","DisableKeyboardCapture"),console.log(`Applied pending keyboard state: ${n}`),window.__pendingKeyboardCaptureState=null}catch(d){console.warn("Failed to apply pending keyboard state with preferred method, trying fallback",d);try{l.SendMessage("WebGLInput","SetCaptureAllKeyboardInput",n),console.log(`Applied pending keyboard state: ${n} (fallback method)`),window.__pendingKeyboardCaptureState=null}catch(p){console.error("Failed to apply pending keyboard state with fallback method",p)}}}else if(i<t){const d=Math.min(500*Math.pow(1.2,i),5e3);console.log(`Unity instance not found (attempt ${i}/${t}), retrying in ${d}ms`),window.__unityInstancePoller=setTimeout(a,d)}else console.warn(`Unity instance still not found after ${t} attempts, giving up`)};window.__unityInstancePoller=setTimeout(a,500)}function j5e(){const n=S0();if(!n)return!1;const t=document.querySelector("canvas")||document.getElementById("unity-canvas");return!!(t&&document.activeElement===t||n.Module&&n.Module.WebGLInputHandler)}function cE(n=!0){return console.log("Focusing Unity canvas"),n?U4():Doe(),new Promise(t=>{try{const i=document.querySelector("canvas")||document.getElementById("unity-canvas");if(i){try{i.focus({preventScroll:!0})}catch{i.focus()}if(i.style.pointerEvents="auto",n){tN(!0).then(t);return}t(!0)}else console.warn("Unity canvas not found"),t(!1)}catch(i){console.error("Error focusing Unity canvas:",i),t(!1)}})}function Ad(n=!0){return console.log(`${n?"Blocking":"Unblocking"} Unity keyboard input`),U4(),new Promise(t=>{try{if(n)tN(!1).then(i=>{var d;i&&console.log("Successfully disabled Unity keyboard capture");const a=document.querySelector("canvas")||document.getElementById("unity-canvas");a&&(a.blur(),a.style.pointerEvents="none"),window.__keyEventHandler||(window.__keyEventHandler=p=>{window.__blockKeyboardInput&&!["INPUT","TEXTAREA","SELECT"].includes(p.target.tagName)&&p.stopPropagation()},document.addEventListener("keydown",window.__keyEventHandler,!0),document.addEventListener("keyup",window.__keyEventHandler,!0),document.addEventListener("keypress",window.__keyEventHandler,!0)),window.__blockKeyboardInput=!0;const l=S0();(d=l==null?void 0:l.Module)!=null&&d.WebGLInputHandler&&(window._savedWebGLInputHandler=l.Module.WebGLInputHandler,l.Module.WebGLInputHandler=null),t(!0)});else{window.__blockKeyboardInput=!1,window.__keyEventHandler&&(document.removeEventListener("keydown",window.__keyEventHandler,!0),document.removeEventListener("keyup",window.__keyEventHandler,!0),document.removeEventListener("keypress",window.__keyEventHandler,!0),window.__keyEventHandler=null);const i=S0();i!=null&&i.Module&&window._savedWebGLInputHandler&&(i.Module.WebGLInputHandler=window._savedWebGLInputHandler,window._savedWebGLInputHandler=null);const a=document.querySelector("canvas")||document.getElementById("unity-canvas");a&&(a.style.pointerEvents="auto"),tN(!0).then(l=>{l&&console.log("Successfully re-enabled Unity keyboard capture"),t(!0)})}}catch(i){console.error("Error in blockUnityKeyboardInput:",i),t(!1)}})}function B5e(n){if(n){if(console.log("Registering Unity instance"),window.unityInstance=n,typeof window.__pendingKeyboardCaptureState=="boolean")try{const t=window.__pendingKeyboardCaptureState;console.log(`Applying pending keyboard state: ${t}`);try{t?n.SendMessage("WebGLInput","EnableKeyboardCapture"):n.SendMessage("WebGLInput","DisableKeyboardCapture"),console.log(`Applied pending keyboard state: ${t} (Unity preferred method)`),window.__pendingKeyboardCaptureState=null}catch(i){console.warn("Failed to apply pending keyboard state with preferred method, trying fallback",i);try{n.SendMessage("WebGLInput","SetCaptureAllKeyboardInput",t),console.log(`Applied pending keyboard state: ${t} (fallback method)`),window.__pendingKeyboardCaptureState=null}catch(a){console.error("Failed to apply pending keyboard state with fallback method",a)}}}catch(t){console.error("Error applying pending keyboard state:",t)}window.__unityInstancePoller&&(clearTimeout(window.__unityInstancePoller),window.__unityInstancePoller=null)}}function W5e(){if(console.log("Initializing Unity keyboard helpers"),window.setUnityKeyboardCapture=tN,window.focusUnity=cE,window.blockUnityKeyboardInput=Ad,window.hasUnityKeyboardFocus=j5e,window.getUnityInstance=S0,window.registerUnityInstance=B5e,document.getElementById("webgl-root")){const n=new MutationObserver(t=>{for(const i of t)if(i.addedNodes.length)for(let a=0;a<i.addedNodes.length;a++){const l=i.addedNodes[a];if(l.nodeName==="CANVAS"||l.querySelector&&l.querySelector("canvas")){console.log("Canvas detected, Unity might be loading. Setting up instance detection."),zV(!0),n.disconnect();break}}});n.observe(document.body,{childList:!0,subtree:!0}),document.querySelector("canvas")&&(console.log("Canvas already exists, Unity might be loaded. Starting instance detection."),zV(!0))}if(typeof window<"u"&&typeof require=="function")try{const n=require("react");window.useUnityKeyboardFocus=function(){const[i,a]=n.useState(!1);return n.useEffect(()=>(i?(console.log("useUnityKeyboardFocus: Blocking Unity keyboard input"),Ad(!0),window.dispatchEvent(new CustomEvent("modal-opened"))):(console.log("useUnityKeyboardFocus: Unblocking Unity keyboard input"),Ad(!1),window.dispatchEvent(new CustomEvent("modal-closed"))),()=>{i&&(console.log("useUnityKeyboardFocus: Cleanup - unblocking Unity keyboard input"),Ad(!1),window.dispatchEvent(new CustomEvent("modal-closed")))}),[i]),[i,a]},console.log("Created useUnityKeyboardFocus hook globally")}catch(n){console.warn("Could not create React hook, React might not be available yet:",n)}}typeof window<"u"&&setTimeout(W5e,0);const z5e=({isOpen:n,onClose:t,user:i,profileImageUrl:a})=>{const[l,d]=L.useState(!1),[p,E]=L.useState({Nickname:(i==null?void 0:i.Nickname)||"",companyName:(i==null?void 0:i.companyName)||"",firstName:(i==null?void 0:i.firstName)||"",lastName:(i==null?void 0:i.lastName)||"",linkedInProfile:(i==null?void 0:i.linkedInProfile)||""}),[v,b]=L.useState(!1),[w,A]=L.useState(!1),N=Dd(),{sendUserToUnity:F}=L.useContext(ja),j=L.useRef(null);L.useEffect(()=>{E({Nickname:(i==null?void 0:i.Nickname)||"",companyName:(i==null?void 0:i.companyName)||"",firstName:(i==null?void 0:i.firstName)||"",lastName:(i==null?void 0:i.lastName)||"",linkedInProfile:(i==null?void 0:i.linkedInProfile)||""})},[i]),L.useEffect(()=>(n?(console.log("ProfileModal: Modal opened, blocking Unity keyboard input"),Ad(!0),window.dispatchEvent(new CustomEvent("modal-opened"))):(console.log("ProfileModal: Modal closed, unblocking Unity keyboard input"),Ad(!1).then(()=>{setTimeout(()=>{cE(!0)},100)}),window.dispatchEvent(new CustomEvent("modal-closed"))),()=>{n&&(console.log("ProfileModal: Cleanup on unmount, unblocking Unity keyboard input"),Ad(!1),window.dispatchEvent(new CustomEvent("modal-closed")))}),[n]),L.useEffect(()=>{if(l&&j.current){const le=()=>{j.current.focus(),A(!0),Ad(!0)};le();const oe=setTimeout(le,100),ge=setTimeout(le,300);return()=>{clearTimeout(oe),clearTimeout(ge)}}else A(!1)},[l]);const B=()=>{d(!1),A(!1),t()},H=le=>{const{name:oe,value:ge}=le.target;E(Z=>({...Z,[oe]:ge}))},ee=async()=>{if(p.Nickname.trim()===""){N({title:"Error",description:"Nickname cannot be empty",status:"error",duration:3e3,isClosable:!0});return}b(!0);try{const le=Cs(Yo,"users",i.uid),oe=Zie(le,ge=>{ge.exists()&&ge.data().Nickname===p.Nickname&&(F(),oe())});await Du(le,{...p,lastUpdated:new Date().toISOString()}),await updateUser(),E({Nickname:p.Nickname,companyName:p.companyName,firstName:p.firstName,lastName:p.lastName,linkedInProfile:p.linkedInProfile}),N({title:"Success",description:"Profile updated successfully",status:"success",duration:3e3,isClosable:!0}),d(!1)}catch(le){N({title:"Error",description:"Failed to update profile",status:"error",duration:3e3,isClosable:!0}),console.error("Error updating profile:",le)}finally{b(!1)}},K=()=>C.jsxs(ri,{spacing:4,align:"stretch",w:"100%",children:[C.jsx(Ai,{direction:"column",align:"center",gap:2,children:C.jsx(ht,{fontSize:"2xl",fontWeight:"bold",children:i.Nickname})}),C.jsxs(ri,{spacing:3,align:"stretch",bg:"gray.700",p:4,borderRadius:"md",children:[C.jsxs(Ai,{direction:"column",children:[C.jsx(ht,{color:"gray.400",fontSize:"sm",children:"Company"}),C.jsx(ht,{children:i.companyName||"Not specified"})]}),C.jsxs(Ai,{direction:"column",children:[C.jsx(ht,{color:"gray.400",fontSize:"sm",children:"Full Name"}),C.jsx(ht,{children:`${i.firstName||""} ${i.lastName||""}`.trim()||"Not specified"})]}),C.jsxs(Ai,{direction:"column",children:[C.jsx(ht,{color:"gray.400",fontSize:"sm",children:"LinkedIn"}),C.jsx(ht,{children:i.linkedInProfile||"Not specified"})]})]}),C.jsx(bi,{onClick:()=>d(!0),size:"sm",variant:"outline",_hover:{bg:"gray.700"},color:"white",borderColor:"gray.600",children:"Edit Profile"})]}),te=()=>C.jsxs(ri,{spacing:4,align:"stretch",w:"100%",children:[C.jsxs(Si,{children:[C.jsx(ta,{color:"gray.400",fontSize:"sm",children:"Nickname"}),C.jsx(ao,{ref:j,name:"Nickname",value:p.Nickname,onChange:H,onFocus:()=>{A(!0),Ad(!0)},placeholder:"Enter nickname",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"}})]}),C.jsxs(Si,{children:[C.jsx(ta,{color:"gray.400",fontSize:"sm",children:"Company Name"}),C.jsx(ao,{name:"companyName",value:p.companyName,onChange:H,placeholder:"Enter company name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"}})]}),C.jsxs(Ai,{gap:4,children:[C.jsxs(Si,{children:[C.jsx(ta,{color:"gray.400",fontSize:"sm",children:"First Name"}),C.jsx(ao,{name:"firstName",value:p.firstName,onChange:H,placeholder:"Enter first name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"}})]}),C.jsxs(Si,{children:[C.jsx(ta,{color:"gray.400",fontSize:"sm",children:"Last Name"}),C.jsx(ao,{name:"lastName",value:p.lastName,onChange:H,placeholder:"Enter last name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"}})]})]}),C.jsxs(Si,{children:[C.jsx(ta,{color:"gray.400",fontSize:"sm",children:"LinkedIn Profile"}),C.jsx(ao,{name:"linkedInProfile",value:p.linkedInProfile,onChange:H,placeholder:"Enter LinkedIn profile URL",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"}})]}),C.jsxs(Ai,{gap:2,justify:"flex-end",mt:2,children:[C.jsx(bi,{onClick:()=>{E({Nickname:(i==null?void 0:i.Nickname)||"",companyName:(i==null?void 0:i.companyName)||"",firstName:(i==null?void 0:i.firstName)||"",lastName:(i==null?void 0:i.lastName)||"",linkedInProfile:(i==null?void 0:i.linkedInProfile)||""}),d(!1)},variant:"outline",size:"sm",isDisabled:v,color:"white",borderColor:"gray.600",_hover:{bg:"gray.700"},children:"Cancel"}),C.jsx(bi,{onClick:ee,colorScheme:"blue",size:"sm",isLoading:v,children:"Save Changes"})]})]});return C.jsxs(xa,{isOpen:n,onClose:B,isCentered:!0,closeOnOverlayClick:!l,trapFocus:!0,blockScrollOnMount:!1,size:"md",children:[C.jsx(Va,{backdropFilter:"blur(10px)"}),C.jsxs(Ma,{bg:"gray.800",color:"white",children:[C.jsx(Ll,{children:"Profile"}),C.jsx(cc,{}),C.jsx(Ua,{pb:6,children:C.jsxs(ri,{spacing:6,children:[C.jsx(Ou,{src:a,size:"2xl",borderRadius:"full"}),l?te():K()]})})]})]})},IO={bg:"white",color:"black",borderRadius:"full",px:"6",py:"2",height:"auto",fontSize:"md",fontWeight:"medium",_hover:{bg:"gray.100"},display:"flex",alignItems:"center",gap:2},Loe=()=>{var w;const{user:n,updateUser:t}=L.useContext(ja),[i,a]=L.useState(!0),{isOpen:l,onOpen:d,onClose:p}=Cp();L.useEffect(()=>{const A=setTimeout(()=>{a(!1)},500);return()=>clearTimeout(A)},[]);const E=()=>{p(),t()},v=n!=null&&n.rpmURL?n.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null,b=(w=n==null?void 0:n.groups)==null?void 0:w.includes("disruptiveAdmin");return i?null:C.jsx(Ai,{align:"center",gap:"4",children:n?C.jsxs(C.Fragment,{children:[C.jsx(z5e,{isOpen:l,onClose:E,user:n,profileImageUrl:v}),C.jsxs(RN,{children:[C.jsx(CN,{as:Rt,cursor:"pointer",children:C.jsx(Ai,{align:"center",height:"40px",px:4,borderRadius:"full",border:"1px solid rgba(255, 255, 255, 0.3)",transition:"all 0.2s",sx:{"&:hover":{border:"2px solid white"}},children:C.jsxs(Ai,{align:"center",gap:"3",children:[C.jsx(Rt,{width:"28px",height:"28px",borderRadius:"full",overflow:"hidden",bg:"white",display:"flex",alignItems:"center",justifyContent:"center",children:C.jsx(Ou,{src:v,width:"100%",height:"100%",borderRadius:"full"})}),C.jsx(ht,{color:"white",fontWeight:"medium",children:n.Nickname}),C.jsx(Rt,{display:"flex",alignItems:"center",height:"28px",children:C.jsx(g5e,{color:"white",w:4,h:4})})]})})}),C.jsx(Ml,{children:C.jsxs(IN,{bg:"gray.800",borderColor:"gray.700",zIndex:9999,children:[C.jsxs(Rt,{p:4,display:"flex",alignItems:"center",gap:3,children:[C.jsx(Ou,{src:v,size:"md",borderRadius:"full"}),C.jsx(ht,{fontSize:"xl",fontWeight:"bold",color:"white",children:n.Nickname})]}),C.jsx(Tp,{borderColor:"gray.700"}),b&&C.jsx(hp,{as:"a",href:"/myadmin",_hover:{bg:"gray.700"},color:"white",bg:"gray.800",children:"My Admin"}),C.jsx(hp,{_hover:{bg:"gray.700"},color:"white",bg:"gray.800",children:"My Spaces"}),C.jsx(hp,{onClick:d,_hover:{bg:"gray.700"},color:"white",bg:"gray.800",children:"View Profile"}),C.jsx(Tp,{borderColor:"gray.700"}),C.jsx(hp,{_hover:{bg:"gray.700"},color:"white",bg:"gray.800",children:"Support"}),C.jsx(hp,{_hover:{bg:"gray.700"},color:"white",bg:"gray.800",children:C.jsx(M4,{mode:"link",label:"Log out",linkProps:{color:"white",_hover:{textDecoration:"none"}}})})]})})]})]}):C.jsxs(C.Fragment,{children:[C.jsx(h1,{mode:"button",label:"Register",buttonProps:{...IO,width:["100%","auto"]},customButton:C.jsxs(bi,{...IO,children:[C.jsx(Rt,{as:"span",fontSize:"xl",children:""}),"Register"]})}),C.jsx(f1,{mode:"button",label:"Sign In",buttonProps:{...IO,width:["100%","auto"]},customButton:C.jsxs(bi,{...IO,children:[C.jsx(Rt,{as:"span",fontSize:"xl",children:""}),"Sign In"]})})]})})},cU=document.getElementById("header-auth-root");if(cU){const n=cU.getAttribute("data-theme")||"default",t=()=>{const[i,a]=L.useState(null);return L.useEffect(()=>{wR(n).then(a)},[]),i?C.jsx(bN,{theme:i,children:C.jsx(l1,{children:C.jsx(k4,{children:C.jsx(Loe,{})})})}):C.jsx("div",{children:"Loading theme..."})};rN.createRoot(cU).render(C.jsx(t,{}))}else console.error("Root element 'header-auth-root' not found.");var lU={},dw={},hw={},IJ;function G5e(){if(IJ)return hw;IJ=1,Object.defineProperty(hw,"__esModule",{value:!0}),hw.useUnityCanvasId=void 0;var n=Pu(),t=0,i="react-unity-webgl-canvas",a=function(l){if(l.id!==void 0)return l.id;var d=(0,n.useMemo)(function(){return[i,++t].join("-")},[]);return d};return hw.useUnityCanvasId=a,hw}var sp={},fw={},AJ;function xoe(){if(AJ)return fw;AJ=1,Object.defineProperty(fw,"__esModule",{value:!0}),fw.UnityLoaderStatus=void 0;var n;return function(t){t.Idle="Idle",t.Loading="Loading",t.Loaded="Loaded",t.Error="Error"}(n||(fw.UnityLoaderStatus=n={})),fw}var pw={},PJ;function V4(){return PJ||(PJ=1,Object.defineProperty(pw,"__esModule",{value:!0}),pw.isBrowserEnvironment=void 0,pw.isBrowserEnvironment=typeof window<"u"&&typeof document<"u"),pw}var OJ;function H5e(){if(OJ)return sp;OJ=1;var n=sp&&sp.__awaiter||function(p,E,v,b){function w(A){return A instanceof v?A:new v(function(N){N(A)})}return new(v||(v=Promise))(function(A,N){function F(H){try{B(b.next(H))}catch(ee){N(ee)}}function j(H){try{B(b.throw(H))}catch(ee){N(ee)}}function B(H){H.done?A(H.value):w(H.value).then(F,j)}B((b=b.apply(p,E||[])).next())})},t=sp&&sp.__generator||function(p,E){var v={label:0,sent:function(){if(A[0]&1)throw A[1];return A[1]},trys:[],ops:[]},b,w,A,N=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return N.next=F(0),N.throw=F(1),N.return=F(2),typeof Symbol=="function"&&(N[Symbol.iterator]=function(){return this}),N;function F(B){return function(H){return j([B,H])}}function j(B){if(b)throw new TypeError("Generator is already executing.");for(;N&&(N=0,B[0]&&(v=0)),v;)try{if(b=1,w&&(A=B[0]&2?w.return:B[0]?w.throw||((A=w.return)&&A.call(w),0):w.next)&&!(A=A.call(w,B[1])).done)return A;switch(w=0,A&&(B=[B[0]&2,A.value]),B[0]){case 0:case 1:A=B;break;case 4:return v.label++,{value:B[1],done:!1};case 5:v.label++,w=B[1],B=[0];continue;case 7:B=v.ops.pop(),v.trys.pop();continue;default:if(A=v.trys,!(A=A.length>0&&A[A.length-1])&&(B[0]===6||B[0]===2)){v=0;continue}if(B[0]===3&&(!A||B[1]>A[0]&&B[1]<A[3])){v.label=B[1];break}if(B[0]===6&&v.label<A[1]){v.label=A[1],A=B;break}if(A&&v.label<A[2]){v.label=A[2],v.ops.push(B);break}A[2]&&v.ops.pop(),v.trys.pop();continue}B=E.call(p,v)}catch(H){B=[6,H],w=0}finally{b=A=0}if(B[0]&5)throw B[1];return{value:B[0]?B[1]:void 0,done:!0}}};Object.defineProperty(sp,"__esModule",{value:!0}),sp.useUnityInstance=void 0;var i=Pu(),a=xoe(),l=V4(),d=function(p,E,v,b){(0,i.useEffect)(function(){(function(){return n(void 0,void 0,void 0,function(){var w,A;return t(this,function(N){switch(N.label){case 0:if(l.isBrowserEnvironment===!1)return[2];if(p!==a.UnityLoaderStatus.Loaded||E===null)return b.setUnityInstance(null),b.setInitialisationError(null),[2];N.label=1;case 1:return N.trys.push([1,3,,4]),[4,window.createUnityInstance(E,v,b.setLoadingProgression)];case 2:return w=N.sent(),b.setUnityInstance(w),b.setInitialisationError(null),[3,4];case 3:return A=N.sent(),b.setUnityInstance(null),b.setInitialisationError(A),[3,4];case 4:return[2]}})})})()},[p,E,v,b])};return sp.useUnityInstance=d,sp}var mw={},kJ;function $5e(){if(kJ)return mw;kJ=1,Object.defineProperty(mw,"__esModule",{value:!0}),mw.useUnityArguments=void 0;var n=Pu(),t=function(i){return(0,n.useMemo)(function(){return{dataUrl:i.unityProvider.unityConfig.dataUrl,frameworkUrl:i.unityProvider.unityConfig.frameworkUrl,codeUrl:i.unityProvider.unityConfig.codeUrl,streamingAssetsUrl:i.unityProvider.unityConfig.streamingAssetsUrl,memoryUrl:i.unityProvider.unityConfig.memoryUrl,symbolsUrl:i.unityProvider.unityConfig.symbolsUrl,workerUrl:i.unityProvider.unityConfig.workerUrl,companyName:i.unityProvider.unityConfig.companyName,productName:i.unityProvider.unityConfig.productName,productVersion:i.unityProvider.unityConfig.productVersion,webglContextAttributes:i.unityProvider.unityConfig.webglContextAttributes||{},cacheControl:i.unityProvider.unityConfig.cacheControl||function(){return"must-revalidate"},devicePixelRatio:i.devicePixelRatio||1,autoSyncPersistentDataPath:i.autoSyncPersistentDataPath,matchWebGLToCanvasSize:typeof i.matchWebGLToCanvasSize=="boolean"?i.matchWebGLToCanvasSize:!0,disabledCanvasEvents:i.disabledCanvasEvents||["contextmenu","dragstart"],print:function(a){},printErr:function(a){}}},[])};return mw.useUnityArguments=t,mw}var gw={},NJ;function K5e(){if(NJ)return gw;NJ=1,Object.defineProperty(gw,"__esModule",{value:!0}),gw.useUnityLoader=void 0;var n=Pu(),t=V4(),i=xoe(),a=function(l){var d=(0,n.useState)(i.UnityLoaderStatus.Loading),p=d[0],E=d[1];return(0,n.useEffect)(function(){if(t.isBrowserEnvironment!==!1){if(l.loaderUrl===null){E(i.UnityLoaderStatus.Idle);return}var v=window.document.querySelector('script[src="'.concat(l.loaderUrl,'"]'));v===null?(v=window.document.createElement("script"),v.type="text/javascript",v.src=l.loaderUrl,v.async=!0,v.setAttribute("data-status","loading"),window.document.body.appendChild(v),v.addEventListener("load",function(){return v==null?void 0:v.setAttribute("data-status","loaded")}),v.addEventListener("error",function(){return v==null?void 0:v.setAttribute("data-status","error")})):E(v.getAttribute("data-status")==="loaded"?i.UnityLoaderStatus.Loaded:i.UnityLoaderStatus.Error);var b=function(w){return E(w.type==="load"?i.UnityLoaderStatus.Loaded:i.UnityLoaderStatus.Error)};return v.addEventListener("load",b),v.addEventListener("error",b),function(){v!==null&&(v.removeEventListener("load",b),v.removeEventListener("error",b),window.document.body.removeChild(v))}}},[l.loaderUrl]),p};return gw.useUnityLoader=a,gw}var DJ;function q5e(){if(DJ)return dw;DJ=1,Object.defineProperty(dw,"__esModule",{value:!0}),dw.Unity=void 0;var n=Pu(),t=Pu(),i=G5e(),a=H5e(),l=$5e(),d=K5e(),p=(0,t.forwardRef)(function(E,v){var b=(0,t.useRef)(null),w=(0,i.useUnityCanvasId)(E),A=(0,l.useUnityArguments)(E),N=(0,d.useUnityLoader)(E.unityProvider.unityConfig);return(0,a.useUnityInstance)(N,b.current,A,E.unityProvider),(0,n.useImperativeHandle)(v,function(){return b.current}),(0,n.createElement)("canvas",{ref:b,id:w,style:E.style,className:E.className,tabIndex:E.tabIndex})});return dw.Unity=p,dw}var ap={},_w={},LJ;function Moe(){if(LJ)return _w;LJ=1,Object.defineProperty(_w,"__esModule",{value:!0}),_w.errorMessages=void 0;var n={genericNoUnityInstance:"No Unity Instance found.",requestFullscreenNoUnityInstance:"Unable to Set Fullscreen while Unity is not Instantiated.",requestPointerLockNoUnityInstanceOrCanvas:"Unable to Request Pointer Lock while Unity is not Instantiated or the Canvas is not found.",sendMessageNoUnityInstance:"Unable to Send Message while Unity is not Instantiated.",quitNoUnityInstance:"Unable to Quit Unity while Unity is not Instantiated.",screenshotNoUnityInstanceOrCanvas:"Unable to Take Screenshot while Unity is not Instantiated or Canvas is not available.",noEventListener:"Unable to find Event Listener in Event System for Event"};return _w.errorMessages=n,_w}var tE={},xJ;function Y5e(){if(xJ)return tE;xJ=1;var n=tE&&tE.__spreadArray||function(E,v,b){if(b||arguments.length===2)for(var w=0,A=v.length,N;w<A;w++)(N||!(w in v))&&(N||(N=Array.prototype.slice.call(v,0,w)),N[w]=v[w]);return E.concat(N||Array.prototype.slice.call(v))};Object.defineProperty(tE,"__esModule",{value:!0}),tE.useEventSystem=void 0;var t=Pu(),i=Moe(),a=V4(),l=[],d=function(E){for(var v=[],b=1;b<arguments.length;b++)v[b-1]=arguments[b];var w=void 0;return l.forEach(function(A){w=A.apply(void 0,n([E],v,!1))}),w};a.isBrowserEnvironment===!0&&(window.dispatchReactUnityEvent=d);var p=function(){var E=(0,t.useRef)([]),v=(0,t.useCallback)(function(A,N){E.current=n(n([],E.current,!0),[{eventName:A,callback:N}],!1)},[E]),b=(0,t.useCallback)(function(A,N){E.current=E.current.filter(function(F){return F.eventName!==A&&F.callback!==N})},[E]),w=(0,t.useCallback)(function(A){for(var N=[],F=1;F<arguments.length;F++)N[F-1]=arguments[F];var j=E.current.find(function(B){return B.eventName===A});if(typeof j>"u"){console.warn(i.errorMessages.noEventListener,{eventName:A});return}return j.callback.apply(j,N)},[E]);return(0,t.useEffect)(function(){return l.push(w),function(){l.splice(l.indexOf(w),1)}},[w]),{addEventListener:v,removeEventListener:b}};return tE.useEventSystem=p,tE}var Ew={},MJ;function X5e(){if(MJ)return Ew;MJ=1,Object.defineProperty(Ew,"__esModule",{value:!0}),Ew.useNullableState=void 0;var n=Pu(),t=function(i){return(0,n.useState)(i||null)};return Ew.useNullableState=t,Ew}var UJ;function J5e(){if(UJ)return ap;UJ=1;var n=ap&&ap.__awaiter||function(E,v,b,w){function A(N){return N instanceof b?N:new b(function(F){F(N)})}return new(b||(b=Promise))(function(N,F){function j(ee){try{H(w.next(ee))}catch(K){F(K)}}function B(ee){try{H(w.throw(ee))}catch(K){F(K)}}function H(ee){ee.done?N(ee.value):A(ee.value).then(j,B)}H((w=w.apply(E,v||[])).next())})},t=ap&&ap.__generator||function(E,v){var b={label:0,sent:function(){if(N[0]&1)throw N[1];return N[1]},trys:[],ops:[]},w,A,N,F=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return F.next=j(0),F.throw=j(1),F.return=j(2),typeof Symbol=="function"&&(F[Symbol.iterator]=function(){return this}),F;function j(H){return function(ee){return B([H,ee])}}function B(H){if(w)throw new TypeError("Generator is already executing.");for(;F&&(F=0,H[0]&&(b=0)),b;)try{if(w=1,A&&(N=H[0]&2?A.return:H[0]?A.throw||((N=A.return)&&N.call(A),0):A.next)&&!(N=N.call(A,H[1])).done)return N;switch(A=0,N&&(H=[H[0]&2,N.value]),H[0]){case 0:case 1:N=H;break;case 4:return b.label++,{value:H[1],done:!1};case 5:b.label++,A=H[1],H=[0];continue;case 7:H=b.ops.pop(),b.trys.pop();continue;default:if(N=b.trys,!(N=N.length>0&&N[N.length-1])&&(H[0]===6||H[0]===2)){b=0;continue}if(H[0]===3&&(!N||H[1]>N[0]&&H[1]<N[3])){b.label=H[1];break}if(H[0]===6&&b.label<N[1]){b.label=N[1],N=H;break}if(N&&b.label<N[2]){b.label=N[2],b.ops.push(H);break}N[2]&&b.ops.pop(),b.trys.pop();continue}H=v.call(E,b)}catch(ee){H=[6,ee],A=0}finally{w=N=0}if(H[0]&5)throw H[1];return{value:H[0]?H[1]:void 0,done:!0}}};Object.defineProperty(ap,"__esModule",{value:!0}),ap.useUnityContext=void 0;var i=Pu(),a=Moe(),l=Y5e(),d=X5e(),p=function(E){var v=(0,d.useNullableState)(),b=v[0],w=v[1],A=(0,i.useState)(0),N=A[0],F=A[1],j=(0,i.useState)(!1),B=j[0],H=j[1],ee=(0,d.useNullableState)(),K=ee[0],te=ee[1],le=(0,l.useEventSystem)(),oe=(0,i.useRef)({setLoadingProgression:F,setInitialisationError:te,setUnityInstance:w,setIsLoaded:H,unityConfig:E}),ge=(0,i.useCallback)(function(he){if(b===null){console.warn(a.errorMessages.requestFullscreenNoUnityInstance);return}b.SetFullscreen(he===!0?1:0)},[b]),Z=(0,i.useCallback)(function(){if(b===null||typeof b.Module.canvas>"u"){console.warn(a.errorMessages.requestPointerLockNoUnityInstanceOrCanvas);return}return b.Module.canvas.requestPointerLock()},[b]),Q=(0,i.useCallback)(function(he,ue,Me){if(b===null){console.warn(a.errorMessages.sendMessageNoUnityInstance);return}b.SendMessage(he,ue,Me)},[b]),ne=(0,i.useCallback)(function(he,ue){if(b===null||typeof b.Module.canvas>"u"){console.warn(a.errorMessages.screenshotNoUnityInstanceOrCanvas);return}return b.Module.canvas.toDataURL(he,ue)},[b]),se=(0,i.useCallback)(function(){return b===null?(console.warn(a.errorMessages.quitNoUnityInstance),Promise.reject()):b.Quit()},[b]),fe=(0,i.useCallback)(function(){return n(void 0,void 0,void 0,function(){var he;return t(this,function(ue){switch(ue.label){case 0:return b===null||typeof b.Module.canvas>"u"?(console.warn(a.errorMessages.genericNoUnityInstance),[2,Promise.reject()]):(he=b.Module.canvas,document.body.appendChild(he),he.style.display="none",[4,se()]);case 1:return ue.sent(),he.remove(),[2]}})})},[b]);return(0,i.useEffect)(function(){H(N===1)},[N]),{unityProvider:oe.current,loadingProgression:N,initialisationError:K,isLoaded:B,UNSAFE__unityInstance:b,requestFullscreen:ge,requestPointerLock:Z,sendMessage:Q,takeScreenshot:ne,unload:se,UNSAFE__detachAndUnloadImmediate:fe,addEventListener:le.addEventListener,removeEventListener:le.removeEventListener}};return ap.useUnityContext=p,ap}var VJ;function Q5e(){return VJ||(VJ=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.useUnityContext=n.Unity=void 0;var t=q5e();Object.defineProperty(n,"Unity",{enumerable:!0,get:function(){return t.Unity}});var i=J5e();Object.defineProperty(n,"useUnityContext",{enumerable:!0,get:function(){return i.useUnityContext}})}(lU)),lU}var Uoe=Q5e();const wd="[UnityProvider]",GV=L.createContext(),Z5e=({spaceID:n,children:t,loaderUrl:i,dataUrl:a,frameworkUrl:l,codeUrl:d,loadingBackground:p,showLoginButton:E,showDisruptiveLogo:v})=>{Te.log(`${wd} Initializing with spaceID:`,n),Te.log(`${wd} Unity URLs:`,{loaderUrl:i,dataUrl:a,frameworkUrl:l,codeUrl:d});const{unityProvider:b,loadingProgression:w,isLoaded:A,sendMessage:N,addEventListener:F,removeEventListener:j,error:B}=Uoe.useUnityContext({loaderUrl:i,dataUrl:a,frameworkUrl:l,codeUrl:d}),H={unityProvider:b,loadingProgression:w,isLoaded:A,sendMessage:N,addEventListener:F,removeEventListener:j,error:B,spaceID:n},ee=L.useRef(null),K=L.useRef(Date.now());L.useEffect(()=>{const ge=()=>{document.hidden?(Te.log(`${wd} Page hidden, starting keep-alive`),te()):(Te.log(`${wd} Page visible, stopping keep-alive`),le())};return document.addEventListener("visibilitychange",ge),()=>{document.removeEventListener("visibilitychange",ge),le()}},[]),L.useEffect(()=>{const ge=()=>{K.current=Date.now(),document.hidden&&N("WebGLInputManager","KeepAlive")};return window.addEventListener("mousemove",ge),window.addEventListener("keydown",ge),window.addEventListener("touchstart",ge),()=>{window.removeEventListener("mousemove",ge),window.removeEventListener("keydown",ge),window.removeEventListener("touchstart",ge)}},[N]);const te=()=>{ee.current||(ee.current=setInterval(()=>{A&&document.hidden&&(N("WebGLInputManager","KeepAlive"),Te.debug(`${wd} Sent keep-alive message`))},1e4))},le=()=>{ee.current&&(clearInterval(ee.current),ee.current=null)};L.useEffect(()=>(Te.log(`${wd} Component mounted`),()=>{Te.log(`${wd} Component unmounting`),le()}),[]),L.useEffect(()=>{Te.log(`${wd} Loading progress:`,w)},[w]),L.useEffect(()=>{A&&(Te.log(`${wd} Unity instance loaded for:`,n),document.hidden&&te())},[A,n]),L.useEffect(()=>{B&&Te.error(`${wd} Unity error:`,B)},[B]),Te.log(`${wd} Rendering provider with instance:`,H),L.useEffect(()=>{Te.log("UnityProvider: Unity build URLs:",{loaderUrl:i,dataUrl:a,frameworkUrl:l,codeUrl:d})},[i,a,l,d]);const oe=[];if(i||oe.push("loaderUrl"),a||oe.push("dataUrl"),l||oe.push("frameworkUrl"),d||oe.push("codeUrl"),oe.length>0)return Te.error(`UnityProvider: Missing required Unity build URLs: ${oe.join(", ")}`),C.jsx(GV.Provider,{value:{unityProvider:null,loadingProgression:0,isLoaded:!1,sendMessage:()=>{},addEventListener:()=>{},removeEventListener:()=>{},error:new Error(`Missing required Unity build URLs: ${oe.join(", ")}`),spaceID:n},children:t});try{return L.useEffect(()=>{Te.log("UnityProvider: Unity context created:",b),b?Te.log("UnityProvider: Unity provider is available"):Te.error("UnityProvider: Unity provider is not available"),A?Te.log("UnityProvider: Unity is loaded"):Te.log("UnityProvider: Unity is not loaded yet")},[b,A]),C.jsx(GV.Provider,{value:H,children:t})}catch(ge){return Te.error("UnityProvider: Error creating Unity context:",ge),C.jsxs("div",{style:{padding:"20px",color:"red",backgroundColor:"#ffeeee",border:"1px solid red",borderRadius:"5px"},children:[C.jsx("h3",{children:"Unity Error"}),C.jsxs("p",{children:["Error creating Unity context: ",ge.message]}),C.jsx("p",{children:"Please check the console for more details."})]})}},el=()=>L.useContext(GV),kg=()=>{const{sendMessage:n,isLoaded:t}=el(),i=L.useRef([]),a=L.useCallback(()=>{if(t)for(;i.current.length>0;){const{eventName:d,data:p}=i.current.shift();Te.log("useSendUnityEvent: Processing queued event to Unity:",d,p);try{n("ReactIncomingEvent","HandleEvent",JSON.stringify({eventName:d,data:JSON.stringify(p)}))}catch(E){Te.error("useSendUnityEvent: Error sending event to Unity:",E),i.current.unshift({eventName:d,data:p});break}}},[n,t]);return L.useEffect(()=>{const d=setInterval(()=>{a()},1e3);return()=>clearInterval(d)},[a]),L.useCallback((d,p)=>{Te.log("useSendUnityEvent: Queuing event for Unity:",d),i.current.push({eventName:d,data:p}),a()},[a])},Vp=()=>{const{addEventListener:n,removeEventListener:t}=el();return L.useCallback((i,a)=>{const l=d=>{Te.log(i+" unity message received.");let p=null;if(d)try{p=JSON.parse(d)}catch(E){Te.warn("Failed to parse JSON data from Unity message:",E)}a(p)};return n(i,l),()=>{t(i,l)}},[n,t])},e6e=()=>{const[n,t]=L.useState(!1),i=Vp();return L.useEffect(()=>{const l=i("FirstSceneLoaded",()=>{Te.log("FirstSceneLoaded unity message received."),t(!0)});return()=>{l()}},[i]),n},t6e=n=>{const[t,i]=L.useState(null),a=Vp(),{spaceID:l}=el();return L.useEffect(()=>{let p=!0;const v=a("PlayVideo",async b=>{try{const{gameObjectName:w}=b;if(!w){Te.error("Game object name is missing in Unity event data.");return}const A=await boe(l);Te.log("SPACES VIDEOS",A);const N=A.find(F=>F.id===w);N&&p?(i(N.url),Te.log("Video URL set to:",N.url)):console.error("Video not found for game object:",w)}catch(w){console.error("Error fetching space videos:",w)}});return()=>{p=!1,v()}},[a,l,n]),[t,()=>{i(null)}]},n6e=()=>{const n=Vp(),{sendUserToUnity:t}=L.useContext(ja);return L.useEffect(()=>{const a=n("RequestUserForUnity",()=>{Te.log("React: Request from Unity to send user data"),t()});return()=>{a()}},[n,t]),!0},r6e=()=>{const{spaceID:n}=el(),t=kg(),[i,a]=L.useState(!1);L.useEffect(()=>{if(window.isPlayerInstantiated){Te.log("useUnityThumbnails: Unity already ready (via window flag)"),a(!0);return}const l=()=>{Te.log("useUnityThumbnails: Unity is now ready (PlayerInstantiated event)"),a(!0)};return window.addEventListener("PlayerInstantiated",l),()=>{window.removeEventListener("PlayerInstantiated",l)}},[]),L.useEffect(()=>{if(!i){Te.log("useUnityThumbnails: Waiting for Unity to be ready before loading thumbnails");return}Te.log("useUnityThumbnails: Unity is ready, now loading thumbnails"),(async()=>{try{if(!n)throw new Error("spaceID is not defined.");const d=await boe(n),p=async b=>{const w=`https://vimeo.com/api/oembed.json?url=${b}`,A=await fetch(w);if(!A.ok)throw new Error(`Failed to fetch thumbnail: ${A.statusText}`);const N=await A.json(),F=N.thumbnail_url.replace(/_\d+x\d+/,""),j=["640x360","295x166"];let B=null;for(let H of j){const ee=`https://i.vimeocdn.com/filter/overlay?src0=${encodeURIComponent(`${F}_${H}`)}&src1=http://f.vimeocdn.com/p/images/crawler_play.png`;try{if((await fetch(ee,{method:"HEAD"})).ok){B=ee;break}}catch(K){console.warn(`Failed to validate thumbnail URL: ${ee}`,K)}}return B||N.thumbnail_url},E=d.map(async b=>{const w=await p(b.url);return{gameObjectName:b.id,thumbnailUrl:w}}),v=await Promise.all(E);Te.log("Fetched Thumbnails",v),v.forEach(({gameObjectName:b,thumbnailUrl:w})=>{t("SetThumbnail",{gameObjectName:b,thumbnailUrl:w})})}catch(d){Te.error("Error fetching thumbnails:",d)}})()},[t,n,i])},i6e=()=>{const[n,t]=L.useState(null),i=Vp();return console.log(" Nameplate click hook initialized"),L.useEffect(()=>{console.log(" Setting up nameplate click listener...");const d=i("OpenNameplateModal",p=>{if(console.log(" Nameplate click detected!",p),!p){console.warn(" Received empty data in nameplate click handler");return}try{const E=typeof p=="string"?JSON.parse(p):p;t({playerName:E.playerName,playerId:E.playerId,uid:E.uid,isLocalPlayer:E.isLocalPlayer}),console.log(" Processed nameplate data:",E)}catch(E){console.error(" Error processing nameplate data:",E)}});return()=>{console.log(" Cleaning up nameplate click listener"),typeof d=="function"&&d()}},[i]),[n,()=>{console.log(" Resetting nameplate data"),t(null)}]},Voe=()=>{const[n,t]=L.useState([]),i=Vp();return L.useEffect(()=>{let a=!0,l=null;const d=()=>{window.unityInstance&&(Te.log("Requesting fresh player list"),window.unityInstance.SendMessage("NetworkManager","RequestPlayerList"))},p=F=>{if(a){Te.log("UpdatePlayerList unity message received.");try{let j=[];if(typeof F=="object"&&F!==null?j=F.players||[]:j=JSON.parse(F).players||[],Array.isArray(j)){const B=Array.from(new Map(j.map(H=>[H.playerId,H])).values());t(B),l&&(clearTimeout(l),l=null)}}catch(j){Te.error("Error handling player list data:",j),l||(l=setTimeout(d,1e3))}}},E=()=>{Te.log("Player disconnected, requesting fresh player list"),d()},v=()=>{Te.log("Player left, requesting fresh player list"),d()};d();const b=i("UpdatePlayerList",p),w=i("PlayerDisconnected",E),A=i("PlayerLeft",v),N=setInterval(d,5e3);return()=>{a=!1,l&&clearTimeout(l),typeof b=="function"&&b(),typeof w=="function"&&w(),typeof A=="function"&&A(),clearInterval(N)}},[i]),n},FJ=async(n,t,i,a={})=>{try{const{mediaType:l="image",displayAsVideo:d=!1,directUrl:p=null}=a;if(!n||!t)throw new Error("Missing required parameters: spaceId and mediaScreenId");let E=null;if(i){if(!i.type.startsWith("image/"))throw new Error("File must be an image");const v=HE(),b=Date.now(),w=i.name.split(".").pop(),A=`${t}_${b}.${w}`,N=GE(v,`spaces/${n}/mediaScreens/${A}`);Te.log(`Uploading image for media screen ${t} in space ${n}`);const F=await P4(N,i);E=await c1(F.ref);const j=Cs(Yo,`spaces/${n}/mediaScreens`,t);await jV(j,{imageUrl:E,gsUrl:`gs://${F.ref.bucket}/${F.ref.fullPath}`,fileName:A,mediaType:l,displayAsVideo:d,uploadedAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{merge:!0})}else if(p){E=p;const v=Cs(Yo,`spaces/${n}/mediaScreens`,t);await jV(v,{videoUrl:p,mediaType:l,displayAsVideo:d,uploadedAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{merge:!0})}else throw new Error("Either imageFile or directUrl must be provided");return Te.log(`Successfully uploaded ${l} for media screen ${t} (display as video: ${d})`),E}catch(l){throw Te.error(`Error uploading media screen ${(a==null?void 0:a.mediaType)||"image"}:`,l),l}},F4=async n=>{Te.log(`Getting media screen images for space: ${n}`);try{const t=xR(Yo,`spaces/${n}/mediaScreens`),i=await Jk(t),a=[];return i.forEach(l=>{a.push({id:l.id,...l.data()})}),a}catch(t){throw Te.error("Error fetching media screen images from Firestore:",t),t}},Ep=async(n,t)=>{try{const i=Cs(Yo,`spaces/${n}/mediaScreens`,t),a=await Rg(i);return a.exists()?{id:a.id,...a.data()}:(Te.warn(`No media screen found with ID: ${t}`),null)}catch(i){throw Te.error("Error fetching media screen image:",i),i}},o6e=async(n,t)=>{try{const i=await Ep(n,t);if(!i)return Te.warn(`No media screen found with ID: ${t} to delete`),!1;if(i.gsUrl){const l=HE(),d=GE(l,i.gsUrl);try{await O4(d),Te.log(`Deleted file from storage: ${i.gsUrl}`)}catch(p){Te.warn(`Could not delete file from storage: ${p.message}`)}}const a=Cs(Yo,`spaces/${n}/mediaScreens`,t);return i.mediaType==="video"?(await Du(a,{videoUrl:null,mediaType:null,displayAsVideo:!1,deletedAt:new Date().toISOString(),updatedAt:new Date().toISOString()}),Te.log(`Successfully removed video for media screen ${t}`)):(await Du(a,{imageUrl:null,gsUrl:null,fileName:null,mediaType:null,displayAsVideo:!1,deletedAt:new Date().toISOString(),updatedAt:new Date().toISOString()}),Te.log(`Successfully removed image for media screen ${t}`)),!0}catch(i){throw Te.error("Error deleting media screen image:",i),i}},s6e=async(n,t,i)=>{try{if(!n||!t||typeof i!="boolean")throw new Error("Missing or invalid required parameters");const a=await Ep(n,t);if(!a||!a.imageUrl&&!a.videoUrl)return Te.warn(`No media screen content found with ID: ${t} to update`),!1;const l=Cs(Yo,`spaces/${n}/mediaScreens`,t);return await Du(l,{displayAsVideo:i,updatedAt:new Date().toISOString()}),Te.log(`Successfully updated display mode for media screen ${t} to ${i?"video":"image"}`),!0}catch(a){throw Te.error("Error updating media screen display mode:",a),a}},a6e=n=>{if(!n)return null;try{if(n.includes("firebasestorage.googleapis.com")){const t=new URL(n),i=t.searchParams.get("alt"),a=t.searchParams.get("token");return t.search="",i&&t.searchParams.set("alt",i),a&&t.searchParams.set("token",a),console.log(`Cleaned Firebase URL from ${n} to ${t.toString()}`),t.toString()}return n}catch(t){return console.error("Error cleaning Firebase URL:",t),n}},Foe=()=>{const{spaceID:n}=el(),t=kg(),[i,a]=L.useState(!1);L.useEffect(()=>{if(window.isPlayerInstantiated){Te.log("useUnityMediaScreenImages: Unity already ready (via window flag)"),a(!0);return}const l=()=>{Te.log("useUnityMediaScreenImages: Unity is now ready (PlayerInstantiated event)"),a(!0)};return window.addEventListener("PlayerInstantiated",l),()=>{window.removeEventListener("PlayerInstantiated",l)}},[]),L.useEffect(()=>{if(!i){Te.log("useUnityMediaScreenImages: Waiting for Unity to be ready before loading media screens");return}Te.log("useUnityMediaScreenImages: Unity is ready, now loading media screens"),(async()=>{try{if(!n)throw new Error("spaceID is not defined.");const d=await F4(n);Te.log("Fetched Media Screen Images",d),d.forEach(p=>{const{id:E,imageUrl:v,displayAsVideo:b,videoUrl:w}=p;let A=null;(!b||!w)&&(A=v?a6e(v):null),t("SetMediaScreenImage",{mediaScreenId:E,imageUrl:A,videoUrl:w||null,displayAsVideo:b||!1,timestamp:Date.now()}),Te.log(`Sent media screen data for ${E} to Unity (displayAsVideo: ${b})`),b&&w&&(t("SetMediaScreenDisplayMode",{mediaScreenId:E,displayAsVideo:!0,videoUrl:w,timestamp:Date.now()}),Te.log(`Set display mode to video for screen ${E}`))})}catch(d){Te.error("Error fetching media screen images:",d)}})()},[t,n,i])},c6e=n=>({opacity:1});function l6e(){const{loadingProgression:n,isLoaded:t,error:i}=el(),{user:a}=L.useContext(ja),[l,d]=L.useState(!1),[p,E]=L.useState(!1),[v,b]=L.useState(!1),[w,A]=L.useState(!1),N=L.useRef(!1),F=L.useRef(!1),j=L.useRef(null),B=L.useRef(null),H=L.useRef(null),ee=Vp(),K=L.useRef(null),te=L.useRef(null),le=L.useRef(null),oe=L.useRef(null);L.useEffect(()=>{d(!a&&n===0)},[a,n]),L.useEffect(()=>{const Q=document.createElement("style");return Q.textContent=`
      /* Set initial Unity canvas styles */
      #unity-canvas, #unity-container {
        opacity: 0 !important;
        transition: opacity 1s ease-in-out;
        z-index: 1 !important; /* Ensure Unity is below our loader */
      }
      
      /* Loader overlay styles */
      .loader-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 99999 !important; /* Extremely high z-index */
        display: flex;
        align-items: center;
        justify-content: center;
        transition: opacity 1.5s ease-in-out;
        pointer-events: auto !important;
        transform: translateZ(0); /* Create stacking context */
      }
      
      /* Loader content styles */
      .loader-content {
        background-color: rgba(0, 0, 0, 0.8);
        padding: 1rem;
        border-radius: 0.5rem;
        color: white;
        text-align: center;
        z-index: 100000 !important; /* Even higher z-index */
      }
    `,document.head.appendChild(Q),K.current=Q,()=>{K.current&&document.head.removeChild(K.current)}},[]),L.useEffect(()=>{const Q=()=>{const ne=document.getElementById("unity-canvas"),se=document.getElementById("unity-container");ne&&(j.current=ne,console.log("LoaderProgress: Found Unity canvas"),ne.style.zIndex="1"),se&&(B.current=se,console.log("LoaderProgress: Found Unity container"),se.style.zIndex="1"),ne&&se&&le.current&&(clearInterval(le.current),le.current=null)};return Q(),le.current=setInterval(Q,100),()=>{le.current&&(clearInterval(le.current),le.current=null)}},[]),L.useEffect(()=>{console.log("LoaderProgress: Setting up FirstSceneLoaded listener"),window.isFirstSceneLoaded&&(console.log("LoaderProgress: FirstSceneLoaded already set via window flag"),F.current=!0,A(!0));const ne=ee("FirstSceneLoaded",()=>{console.log("LoaderProgress: FirstSceneLoaded event received"),F.current=!0,A(!0),window.isFirstSceneLoaded=!0}),se=setTimeout(()=>{F.current||(console.log("LoaderProgress: Forcing FirstSceneLoaded after timeout"),F.current=!0,A(!0),window.isFirstSceneLoaded=!0)},1e4);return()=>{ne(),clearTimeout(se)}},[ee]),L.useEffect(()=>{console.log("LoaderProgress: Setting up PlayerInstantiated listener"),window.isPlayerInstantiated&&(console.log("LoaderProgress: Player already instantiated via window flag"),N.current=!0,b(!0),F.current||(console.log("LoaderProgress: Forcing FirstSceneLoaded because player is already instantiated"),F.current=!0,A(!0),window.isFirstSceneLoaded=!0));const Q=()=>{console.log("LoaderProgress: PlayerInstantiated event received"),N.current=!0,b(!0),F.current||(console.log("LoaderProgress: Forcing FirstSceneLoaded because player is instantiated"),F.current=!0,A(!0),window.isFirstSceneLoaded=!0)};window.addEventListener("PlayerInstantiated",Q);const ne=ee("PlayerInstantiated",Q),se=setTimeout(()=>{N.current||(console.log("LoaderProgress: Forcing player instantiation after timeout"),N.current=!0,b(!0),F.current||(console.log("LoaderProgress: Forcing FirstSceneLoaded because of timeout"),F.current=!0,A(!0),window.isFirstSceneLoaded=!0))},2e4);return()=>{window.removeEventListener("PlayerInstantiated",Q),ne(),clearTimeout(se)}},[ee]),L.useEffect(()=>(console.log("LoaderProgress: Handling visibility changes",{isFirstSceneLoaded:w,isPlayerInstantiated:v}),w&&v&&(console.log("LoaderProgress: Both conditions met, showing Unity canvas"),te.current&&clearTimeout(te.current),te.current=setTimeout(()=>{console.log("LoaderProgress: Showing Unity canvas now"),j.current&&(j.current.style.opacity="1",j.current.style.removeProperty("opacity")),B.current&&(B.current.style.opacity="1",B.current.style.removeProperty("opacity")),H.current&&(H.current.style.opacity="0",H.current.style.pointerEvents="none",setTimeout(()=>{H.current&&(H.current.style.display="none")},1500))},2e3)),()=>{te.current&&clearTimeout(te.current)}),[w,v]),L.useEffect(()=>(oe.current=setInterval(()=>{var Q,ne;console.log("LoaderProgress: Debug interval",{isLoaded:t,isFirstSceneLoaded:F.current,isPlayerInstantiated:N.current,windowFirstSceneLoaded:window.isFirstSceneLoaded,windowPlayerInstantiated:window.isPlayerInstantiated,unityCanvasZIndex:(Q=j.current)==null?void 0:Q.style.zIndex,loaderZIndex:(ne=H.current)==null?void 0:ne.style.zIndex})},5e3),()=>{oe.current&&clearInterval(oe.current)}),[t]),L.useEffect(()=>{console.log("LoaderProgress: State updated",{isLoaded:t,isFirstSceneLoaded:w,isPlayerInstantiated:v,loadingProgression:n})},[t,w,v,n]);const ge=()=>t?t&&!w&&!v?"Scene initializing":w&&!v?"Player initializing":"Ready":"World loading",Z=()=>t?t&&!w&&!v?85:w&&!v?95:100:n*80;return C.jsx(C.Fragment,{children:l?C.jsx(Rt,{position:"absolute",zIndex:"99999",width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",style:{transform:"translateZ(0)"},children:C.jsxs(ri,{spacing:4,padding:6,borderRadius:"md",backgroundColor:"rgba(0, 0, 0, 0.8)",color:"white",children:[C.jsx(ht,{fontSize:"xl",fontWeight:"bold",children:"Sign In Required"}),C.jsx(ht,{textAlign:"center",children:"Please sign in to enter The Disruptive Spaces"}),C.jsx(bi,{colorScheme:"blue",size:"lg",width:"200px",onClick:()=>E(!0),children:"Sign In"})]})}):C.jsx(Rt,{ref:H,className:"loader-overlay",style:{transform:"translateZ(0)",zIndex:99999},children:C.jsxs(Ai,{className:"loader-content",flexDirection:"column",alignItems:"center",width:"300px",style:{zIndex:1e5},children:[C.jsx(ht,{fontWeight:"bold",children:"Entering The Spaces Metaverse"}),C.jsx(ht,{fontSize:"sm",children:ge()}),C.jsx(h0,{value:Z(),size:"lg",width:"100%",marginY:2})]})})})}function u6e(){const{user:n}=L.useContext(ja);return C.jsx("div",{children:n!==null?C.jsx("div",{children:C.jsx(M4,{})}):C.jsxs("div",{children:[C.jsx(h1,{}),C.jsx(f1,{})]})})}function d6e(){const{fullscreenRef:n}=Ld(),[t,i]=L.useState(!1),a=()=>{i(!t)};return C.jsxs(C.Fragment,{children:[C.jsx(cg,{label:"Help",hasArrow:!0,placement:"top",closeOnClick:!0,portalProps:{containerRef:n},children:C.jsx(ka,{"aria-label":"Controller Help",icon:C.jsx(E5e,{}),onClick:a,variant:"iconButton"})}),C.jsxs(xa,{isOpen:t,onClose:a,size:"md",portalProps:{containerRef:n},children:[C.jsx(Va,{}),C.jsxs(Ma,{children:[C.jsx(Ll,{children:"Notes"}),C.jsx(cc,{}),C.jsx(Ua,{children:C.jsx(ht,{variant:"formIntro",children:"The help button is showing so we can see the blur and transparency styles on the button."})}),C.jsx(PE,{children:C.jsx(bi,{variant:"primary",onClick:a,children:"Close"})})]})]})]})}var joe={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},jJ=ni.createContext&&ni.createContext(joe),pg=function(){return pg=Object.assign||function(n){for(var t,i=1,a=arguments.length;i<a;i++){t=arguments[i];for(var l in t)Object.prototype.hasOwnProperty.call(t,l)&&(n[l]=t[l])}return n},pg.apply(this,arguments)},h6e=function(n,t){var i={};for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&t.indexOf(a)<0&&(i[a]=n[a]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,a=Object.getOwnPropertySymbols(n);l<a.length;l++)t.indexOf(a[l])<0&&Object.prototype.propertyIsEnumerable.call(n,a[l])&&(i[a[l]]=n[a[l]]);return i};function Boe(n){return n&&n.map(function(t,i){return ni.createElement(t.tag,pg({key:i},t.attr),Boe(t.child))})}function Vr(n){return function(t){return ni.createElement(f6e,pg({attr:pg({},n.attr)},t),Boe(n.child))}}function f6e(n){var t=function(i){var a=n.attr,l=n.size,d=n.title,p=h6e(n,["attr","size","title"]),E=l||i.size||"1em",v;return i.className&&(v=i.className),n.className&&(v=(v?v+" ":"")+n.className),ni.createElement("svg",pg({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},i.attr,a,p,{className:v,style:pg(pg({color:n.color||i.color},i.style),n.style),height:E,width:E,xmlns:"http://www.w3.org/2000/svg"}),d&&ni.createElement("title",null,d),n.children)};return jJ!==void 0?ni.createElement(jJ.Consumer,null,function(i){return t(i)}):t(joe)}function Woe(n){return Vr({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"}}]})(n)}function p6e(n){return Vr({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 8C119.034 8 8 119.033 8 256s111.034 248 248 248 248-111.034 248-248S392.967 8 256 8zm130.108 117.892c65.448 65.448 70 165.481 20.677 235.637L150.47 105.216c70.204-49.356 170.226-44.735 235.638 20.676zM125.892 386.108c-65.448-65.448-70-165.481-20.677-235.637L361.53 406.784c-70.203 49.356-170.226 44.736-235.638-20.676z"}}]})(n)}function HV(n){return Vr({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M528 448H112c-8.8 0-16 7.2-16 16v32c0 8.8 7.2 16 16 16h416c8.8 0 16-7.2 16-16v-32c0-8.8-7.2-16-16-16zm64-320c-26.5 0-48 21.5-48 48 0 7.1 1.6 13.7 4.4 19.8L476 239.2c-15.4 9.2-35.3 4-44.2-11.6L350.3 85C361 76.2 368 63 368 48c0-26.5-21.5-48-48-48s-48 21.5-48 48c0 15 7 28.2 17.7 37l-81.5 142.6c-8.9 15.6-28.9 20.8-44.2 11.6l-72.3-43.4c2.7-6 4.4-12.7 4.4-19.8 0-26.5-21.5-48-48-48S0 149.5 0 176s21.5 48 48 48c2.6 0 5.2-.4 7.7-.8L128 416h384l72.3-192.8c2.5.4 5.1.8 7.7.8 26.5 0 48-21.5 48-48s-21.5-48-48-48z"}}]})(n)}function m6e(n){return Vr({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M402.6 83.2l90.2 90.2c3.8 3.8 3.8 10 0 13.8L274.4 405.6l-92.8 10.3c-12.4 1.4-22.9-9.1-21.5-21.5l10.3-92.8L388.8 83.2c3.8-3.8 10-3.8 13.8 0zm162-22.9l-48.8-48.8c-15.2-15.2-39.9-15.2-55.2 0l-35.4 35.4c-3.8 3.8-3.8 10 0 13.8l90.2 90.2c3.8 3.8 10 3.8 13.8 0l35.4-35.4c15.2-15.3 15.2-40 0-55.2zM384 346.2V448H64V128h229.8c3.2 0 6.2-1.3 8.5-3.5l40-40c7.6-7.6 2.2-20.5-8.5-20.5H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V306.2c0-10.7-12.9-16-20.5-8.5l-40 40c-2.2 2.3-3.5 5.3-3.5 8.5z"}}]})(n)}function g6e(n){return Vr({attr:{viewBox:"0 0 192 512"},child:[{tag:"path",attr:{d:"M96 184c39.8 0 72 32.2 72 72s-32.2 72-72 72-72-32.2-72-72 32.2-72 72-72zM24 80c0 39.8 32.2 72 72 72s72-32.2 72-72S135.8 8 96 8 24 40.2 24 80zm0 352c0 39.8 32.2 72 72 72s72-32.2 72-72-32.2-72-72-72-72 32.2-72 72z"}}]})(n)}function _6e(n){return Vr({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M480.07 96H160a160 160 0 1 0 114.24 272h91.52A160 160 0 1 0 480.07 96zM248 268a12 12 0 0 1-12 12h-52v52a12 12 0 0 1-12 12h-24a12 12 0 0 1-12-12v-52H84a12 12 0 0 1-12-12v-24a12 12 0 0 1 12-12h52v-52a12 12 0 0 1 12-12h24a12 12 0 0 1 12 12v52h52a12 12 0 0 1 12 12zm216 76a40 40 0 1 1 40-40 40 40 0 0 1-40 40zm64-96a40 40 0 1 1 40-40 40 40 0 0 1-40 40z"}}]})(n)}function zoe(n){return Vr({attr:{viewBox:"0 0 496 512"},child:[{tag:"path",attr:{d:"M336.5 160C322 70.7 287.8 8 248 8s-74 62.7-88.5 152h177zM152 256c0 22.2 1.2 43.5 3.3 64h185.3c2.1-20.5 3.3-41.8 3.3-64s-1.2-43.5-3.3-64H155.3c-2.1 20.5-3.3 41.8-3.3 64zm324.7-96c-28.6-67.9-86.5-120.4-158-141.6 24.4 33.8 41.2 84.7 50 141.6h108zM177.2 18.4C105.8 39.6 47.8 92.1 19.3 160h108c8.7-56.9 25.5-107.8 49.9-141.6zM487.4 192H372.7c2.1 21 3.3 42.5 3.3 64s-1.2 43-3.3 64h114.6c5.5-20.5 8.6-41.8 8.6-64s-3.1-43.5-8.5-64zM120 256c0-21.5 1.2-43 3.3-64H8.6C3.2 212.5 0 233.8 0 256s3.2 43.5 8.6 64h114.6c-2-21-3.2-42.5-3.2-64zm39.5 96c14.5 89.3 48.7 152 88.5 152s74-62.7 88.5-152h-177zm159.3 141.6c71.4-21.2 129.4-73.7 158-141.6h-108c-8.8 56.9-25.6 107.8-50 141.6zM19.3 352c28.6 67.9 86.5 120.4 158 141.6-24.4-33.8-41.2-84.7-50-141.6h-108z"}}]})(n)}function E6e(n){return Vr({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z"}}]})(n)}function y6e(n){return Vr({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M528 448H48c-26.51 0-48-21.49-48-48V112c0-26.51 21.49-48 48-48h480c26.51 0 48 21.49 48 48v288c0 26.51-21.49 48-48 48zM128 180v-40c0-6.627-5.373-12-12-12H76c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm-336 96v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm-336 96v-40c0-6.627-5.373-12-12-12H76c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm288 0v-40c0-6.627-5.373-12-12-12H172c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h232c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12z"}}]})(n)}function $V(n){return Vr({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M633.82 458.1l-157.8-121.96C488.61 312.13 496 285.01 496 256v-48c0-8.84-7.16-16-16-16h-16c-8.84 0-16 7.16-16 16v48c0 17.92-3.96 34.8-10.72 50.2l-26.55-20.52c3.1-9.4 5.28-19.22 5.28-29.67V96c0-53.02-42.98-96-96-96s-96 42.98-96 96v45.36L45.47 3.37C38.49-2.05 28.43-.8 23.01 6.18L3.37 31.45C-2.05 38.42-.8 48.47 6.18 53.9l588.36 454.73c6.98 5.43 17.03 4.17 22.46-2.81l19.64-25.27c5.41-6.97 4.16-17.02-2.82-22.45zM400 464h-56v-33.77c11.66-1.6 22.85-4.54 33.67-8.31l-50.11-38.73c-6.71.4-13.41.87-20.35.2-55.85-5.45-98.74-48.63-111.18-101.85L144 241.31v6.85c0 89.64 63.97 169.55 152 181.69V464h-56c-8.84 0-16 7.16-16 16v16c0 8.84 7.16 16 16 16h160c8.84 0 16-7.16 16-16v-16c0-8.84-7.16-16-16-16z"}}]})(n)}function KV(n){return Vr({attr:{viewBox:"0 0 352 512"},child:[{tag:"path",attr:{d:"M176 352c53.02 0 96-42.98 96-96V96c0-53.02-42.98-96-96-96S80 42.98 80 96v160c0 53.02 42.98 96 96 96zm160-160h-16c-8.84 0-16 7.16-16 16v48c0 74.8-64.49 134.82-140.79 127.38C96.71 376.89 48 317.11 48 250.3V208c0-8.84-7.16-16-16-16H16c-8.84 0-16 7.16-16 16v40.16c0 89.64 63.97 169.55 152 181.69V464H96c-8.84 0-16 7.16-16 16v16c0 8.84 7.16 16 16 16h160c8.84 0 16-7.16 16-16v-16c0-8.84-7.16-16-16-16h-56v-33.77C285.71 418.47 352 344.9 352 256v-48c0-8.84-7.16-16-16-16z"}}]})(n)}function v6e(n){return Vr({attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M0 352a160 160 0 0 0 160 160h64a160 160 0 0 0 160-160V224H0zM176 0h-16A160 160 0 0 0 0 160v32h176zm48 0h-16v192h176v-32A160 160 0 0 0 224 0z"}}]})(n)}function S6e(n){return Vr({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M416 208H272V64c0-17.67-14.33-32-32-32h-32c-17.67 0-32 14.33-32 32v144H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h144v144c0 17.67 14.33 32 32 32h32c17.67 0 32-14.33 32-32V304h144c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z"}}]})(n)}function b6e(n){return Vr({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M466.5 83.7l-192-80a48.15 48.15 0 0 0-36.9 0l-192 80C27.7 91.1 16 108.6 16 128c0 198.5 114.5 335.7 221.5 380.3 11.8 4.9 25.1 4.9 36.9 0C360.1 472.6 496 349.3 496 128c0-19.4-11.7-36.9-29.5-44.3zM256.1 446.3l-.1-381 175.9 73.3c-3.3 151.4-82.1 261.1-175.8 307.7z"}}]})(n)}function qV(n){return Vr({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M259.3 17.8L194 150.2 47.9 171.5c-26.2 3.8-36.7 36.1-17.7 54.6l105.7 103-25 145.5c-4.5 26.3 23.2 46 46.4 33.7L288 439.6l130.7 68.7c23.2 12.2 50.9-7.4 46.4-33.7l-25-145.5 105.7-103c19-18.5 8.5-50.8-17.7-54.6L382 150.2 316.7 17.8c-11.7-23.6-45.6-23.9-57.4 0z"}}]})(n)}function T6e(n){return Vr({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M624 208h-64v-64c0-8.8-7.2-16-16-16h-32c-8.8 0-16 7.2-16 16v64h-64c-8.8 0-16 7.2-16 16v32c0 8.8 7.2 16 16 16h64v64c0 8.8 7.2 16 16 16h32c8.8 0 16-7.2 16-16v-64h64c8.8 0 16-7.2 16-16v-32c0-8.8-7.2-16-16-16zm-400 48c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm89.6 32h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-41.6c0-74.2-60.2-134.4-134.4-134.4z"}}]})(n)}function w6e(n){return Vr({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M96 224c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm448 0c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm32 32h-64c-17.6 0-33.5 7.1-45.1 18.6 40.3 22.1 68.9 62 75.1 109.4h66c17.7 0 32-14.3 32-32v-32c0-35.3-28.7-64-64-64zm-256 0c61.9 0 112-50.1 112-112S381.9 32 320 32 208 82.1 208 144s50.1 112 112 112zm76.8 32h-8.3c-20.8 10-43.9 16-68.5 16s-47.6-6-68.5-16h-8.3C179.6 288 128 339.6 128 403.2V432c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48v-28.8c0-63.6-51.6-115.2-115.2-115.2zm-223.7-13.4C161.5 263.1 145.6 256 128 256H64c-35.3 0-64 28.7-64 64v32c0 17.7 14.3 32 32 32h65.9c6.3-47.4 34.9-87.3 75.2-109.4z"}}]})(n)}function R6e(n){return Vr({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M215.03 71.05L126.06 160H24c-13.26 0-24 10.74-24 24v144c0 13.25 10.74 24 24 24h102.06l88.97 88.95c15.03 15.03 40.97 4.47 40.97-16.97V88.02c0-21.46-25.96-31.98-40.97-16.97zM461.64 256l45.64-45.64c6.3-6.3 6.3-16.52 0-22.82l-22.82-22.82c-6.3-6.3-16.52-6.3-22.82 0L416 210.36l-45.64-45.64c-6.3-6.3-16.52-6.3-22.82 0l-22.82 22.82c-6.3 6.3-6.3 16.52 0 22.82L370.36 256l-45.63 45.63c-6.3 6.3-6.3 16.52 0 22.82l22.82 22.82c6.3 6.3 16.52 6.3 22.82 0L416 301.64l45.64 45.64c6.3 6.3 16.52 6.3 22.82 0l22.82-22.82c6.3-6.3 6.3-16.52 0-22.82L461.64 256z"}}]})(n)}function C6e(n){return Vr({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M215.03 71.05L126.06 160H24c-13.26 0-24 10.74-24 24v144c0 13.25 10.74 24 24 24h102.06l88.97 88.95c15.03 15.03 40.97 4.47 40.97-16.97V88.02c0-21.46-25.96-31.98-40.97-16.97zm233.32-51.08c-11.17-7.33-26.18-4.24-33.51 6.95-7.34 11.17-4.22 26.18 6.95 33.51 66.27 43.49 105.82 116.6 105.82 195.58 0 78.98-39.55 152.09-105.82 195.58-11.17 7.32-14.29 22.34-6.95 33.5 7.04 10.71 21.93 14.56 33.51 6.95C528.27 439.58 576 351.33 576 256S528.27 72.43 448.35 19.97zM480 256c0-63.53-32.06-121.94-85.77-156.24-11.19-7.14-26.03-3.82-33.12 7.46s-3.78 26.21 7.41 33.36C408.27 165.97 432 209.11 432 256s-23.73 90.03-63.48 115.42c-11.19 7.14-14.5 22.07-7.41 33.36 6.51 10.36 21.12 15.14 33.12 7.46C447.94 377.94 480 319.54 480 256zm-141.77-76.87c-11.58-6.33-26.19-2.16-32.61 9.45-6.39 11.61-2.16 26.2 9.45 32.61C327.98 228.28 336 241.63 336 256c0 14.38-8.02 27.72-20.92 34.81-11.61 6.41-15.84 21-9.45 32.61 6.43 11.66 21.05 15.8 32.61 9.45 28.23-15.55 45.77-45 45.77-76.88s-17.54-61.32-45.78-76.86z"}}]})(n)}function Goe({open:n,onClose:t}){const i=L.useRef(null),a=kg(),{user:l}=L.useContext(ja),d=v=>{i.current&&!i.current.contains(v.target)&&t()},p=async v=>{const b=E(v);if((b==null?void 0:b.source)==="readyplayerme"&&(b.eventName==="v1.frame.ready"&&i.current.contentWindow.postMessage(JSON.stringify({target:"readyplayerme",type:"subscribe",eventName:"v1.**"}),"*"),b.eventName==="v1.avatar.exported")){const w=b.data.url;if(console.log(`Avatar URL: ${w}`),a("AvatarUrlFromReact",{url:w}),l&&l.uid)try{await ioe(l.uid,w),t()}catch(A){console.error("Error updating RPM URL:",A)}else console.error("No authenticated user found to update rpmURL.")}},E=v=>{try{return JSON.parse(v.data)}catch{return null}};return L.useEffect(()=>(n&&(document.addEventListener("mousedown",d),window.addEventListener("message",p)),()=>{document.removeEventListener("mousedown",d),window.removeEventListener("message",p)}),[n]),n&&C.jsx(Ml,{children:C.jsx(Rt,{position:"fixed",top:"0",left:"0",width:"100%",height:"100%",bg:"rgba(0, 0, 0, 0.8)",zIndex:1e4,display:"flex",justifyContent:"center",alignItems:"center",onClick:v=>v.stopPropagation(),children:C.jsx(Rt,{position:"relative",maxWidth:"1080px",maxHeight:"800px",width:"90%",height:"90%",children:C.jsx("iframe",{ref:i,src:"https://spacesmetaverse.readyplayer.me/avatar?frameApi",title:"Ready Player Me",width:"100%",height:"100%",style:{border:"none",borderRadius:"8px"},allow:"camera *; microphone *; clipboard-write"})})})})}function I6e({isOpen:n,onClose:t}){const[i,a]=L.useState(!1),[l,d]=L.useState(null),{user:p}=L.useContext(ja),E=kg(),v=j=>{j.stopPropagation(),a(!0)},b=()=>{a(!1),t()},w=async j=>{if(d(j),p&&p.uid)try{await ioe(p.uid,j.url),E("AvatarUrlFromReact",{url:j.url}),t()}catch(B){console.error("Error updating RPM URL:",B)}else console.error("No authenticated user found to update rpmURL.")},A=TCe("gray.200","whiteAlpha.300"),N="rgba(0, 0, 0, 0.3)",F=[{id:1,url:"https://models.readyplayer.me/67c8408d38f7924e15a8bd0a.glb",name:"Default Avatar 1"},{id:2,url:"https://models.readyplayer.me/67c8576838e3cf57cc697c15.glb",name:"Default Avatar 2"},{id:3,url:"https://models.readyplayer.me/67c884144c4878c55e515ff5.glb",name:"Default Avatar 3"},{id:4,url:"https://models.readyplayer.me/67c885af25f4d62e75c0ff1e.glb",name:"Default Avatar 4"},{id:5,url:"https://models.readyplayer.me/67c8860f4c4878c55e5189b6.glb",name:"Default Avatar 5"},{id:6,url:"https://models.readyplayer.me/67c8869db6d0b438b7abd822.glb",name:"Default Avatar 6"},{id:7,url:"https://models.readyplayer.me/67c886ed28ee0e0bfac89688.glb",name:"Default Avatar 7"},{id:8,url:"https://models.readyplayer.me/67c88731795ea3e2e6ea84db.glb",name:"Default Avatar 8"},{id:9,url:"https://models.readyplayer.me/67c8878b0cdc0f22383f0f8f.glb",name:"Default Avatar 9"}];return C.jsxs(C.Fragment,{children:[C.jsx(Ml,{children:C.jsxs(xa,{isOpen:n,onClose:t,isCentered:!0,size:"xl",zIndex:9999,children:[C.jsx(Va,{bg:"rgba(0, 0, 0, 0.7)"}),C.jsxs(Ma,{bg:"gray.800",color:"white",maxW:"900px",children:[C.jsx(Ll,{fontSize:"lg",children:"Customise Your Avatar"}),C.jsx(cc,{color:"white",_hover:{bg:"transparent",color:"whiteAlpha.800"},_focus:{boxShadow:"none"},size:"lg",position:"absolute",right:2,top:2}),C.jsx(Ua,{pb:4,children:C.jsxs(ri,{spacing:4,align:"stretch",children:[C.jsx(ht,{fontSize:"sm",children:"Choose from our collection or create your own unique avatar"}),C.jsxs(zte,{columns:5,spacing:2,children:[C.jsx(Rt,{position:"relative",cursor:"pointer",borderWidth:"2px",borderStyle:"dashed",borderColor:A,borderRadius:"lg",overflow:"hidden",onClick:v,_hover:{bg:N},transition:"all 0.2s",display:"flex",alignItems:"center",justifyContent:"center",aspectRatio:"1",children:C.jsxs(ri,{spacing:1,children:[C.jsx(Wn,{as:S6e,boxSize:4}),C.jsx(ht,{fontSize:"xs",children:"Create Custom Avatar"})]})}),F.map(j=>C.jsxs(Rt,{position:"relative",cursor:"pointer",borderWidth:"2px",borderColor:(l==null?void 0:l.id)===j.id?"blue.400":A,borderRadius:"lg",overflow:"hidden",onClick:()=>w(j),_hover:{bg:N},transition:"all 0.2s",aspectRatio:"1",children:[C.jsx(Bh,{src:j.url.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"),alt:j.name,width:"100%",height:"100%",objectFit:"cover"}),C.jsx(Rt,{position:"absolute",bottom:"0",left:"0",right:"0",p:1,bg:"rgba(0, 0, 0, 0.7)",children:C.jsx(ht,{fontSize:"xs",children:j.name})})]},j.id))]})]})})]})]})}),i&&C.jsx(Goe,{open:i,onClose:b})]})}function A6e(){const{fullscreenRef:n}=Ld(),[t,i]=L.useState(!1),[a,l]=L.useState(!1),[d,p]=L.useState(!1),[E,v]=L.useState(!1),{user:b}=L.useContext(ja),[w,A]=L.useState(null),[N,F]=L.useState(!0),j=(K,te)=>!K||!te?"?":`${K.charAt(0)}${te.charAt(0)}`.toUpperCase(),B=async()=>{if(b!=null&&b.uid){F(!0);try{const K=await rf(b.uid);A({rpmURL:K.rpmURL?K.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null,firstName:K.firstName,lastName:K.lastName})}catch(K){console.error("Error fetching profile data:",K)}finally{F(!1)}}};L.useEffect(()=>{B()},[b==null?void 0:b.uid]),L.useEffect(()=>{const K=()=>{i(!0)};return window.addEventListener("PlayerInstantiated",K),()=>{window.removeEventListener("PlayerInstantiated",K)}},[]);const H=()=>l(!a),ee=()=>{l(!1),B()};return t?C.jsxs(C.Fragment,{children:[C.jsx(cg,{label:"Edit Avatar",hasArrow:!0,placement:"top",closeOnClick:!0,isOpen:E,portalProps:{containerRef:n},children:C.jsxs(Rt,{position:"relative",onMouseEnter:()=>{p(!0),v(!0)},onMouseLeave:()=>{p(!1),v(!1)},cursor:"pointer",onClick:H,children:[C.jsx(Ou,{src:N||w==null?void 0:w.rpmURL,size:"md",borderRadius:"full",bg:"white",name:N?j(w==null?void 0:w.firstName,w==null?void 0:w.lastName):" ",borderWidth:"1px",borderColor:"whiteAlpha.300"}),d&&C.jsx(Rt,{position:"absolute",top:"0",left:"0",right:"0",bottom:"0",display:"flex",alignItems:"center",justifyContent:"center",bg:"rgba(0, 0, 0, 0.4)",borderRadius:"full",children:C.jsx(ht,{fontSize:"xs",fontWeight:"bold",color:"white",children:"Edit"})})]})}),C.jsx(I6e,{isOpen:a,onClose:ee})]}):null}function P6e(n){return Vr({attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M391 240.9c-.8-6.6-8.9-9.4-13.6-4.7l-43.7 43.7L200 146.3a8.03 8.03 0 0 0-11.3 0l-42.4 42.3a8.03 8.03 0 0 0 0 11.3L280 333.6l-43.9 43.9a8.01 8.01 0 0 0 4.7 13.6L401 410c5.1.6 9.5-3.7 8.9-8.9L391 240.9zm10.1 373.2L240.8 633c-6.6.8-9.4 8.9-4.7 13.6l43.9 43.9L146.3 824a8.03 8.03 0 0 0 0 11.3l42.4 42.3c3.1 3.1 8.2 3.1 11.3 0L333.7 744l43.7 43.7A8.01 8.01 0 0 0 391 783l18.9-160.1c.6-5.1-3.7-9.4-8.8-8.8zm221.8-204.2L783.2 391c6.6-.8 9.4-8.9 4.7-13.6L744 333.6 877.7 200c3.1-3.1 3.1-8.2 0-11.3l-42.4-42.3a8.03 8.03 0 0 0-11.3 0L690.3 279.9l-43.7-43.7a8.01 8.01 0 0 0-13.6 4.7L614.1 401c-.6 5.2 3.7 9.5 8.8 8.9zM744 690.4l43.9-43.9a8.01 8.01 0 0 0-4.7-13.6L623 614c-5.1-.6-9.5 3.7-8.9 8.9L633 783.1c.8 6.6 8.9 9.4 13.6 4.7l43.7-43.7L824 877.7c3.1 3.1 8.2 3.1 11.3 0l42.4-42.3c3.1-3.1 3.1-8.2 0-11.3L744 690.4z"}}]})(n)}function O6e(n){return Vr({attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M290 236.4l43.9-43.9a8.01 8.01 0 0 0-4.7-13.6L169 160c-5.1-.6-9.5 3.7-8.9 8.9L179 329.1c.8 6.6 8.9 9.4 13.6 4.7l43.7-43.7L370 423.7c3.1 3.1 8.2 3.1 11.3 0l42.4-42.3c3.1-3.1 3.1-8.2 0-11.3L290 236.4zm352.7 187.3c3.1 3.1 8.2 3.1 11.3 0l133.7-133.6 43.7 43.7a8.01 8.01 0 0 0 13.6-4.7L863.9 169c.6-5.1-3.7-9.5-8.9-8.9L694.8 179c-6.6.8-9.4 8.9-4.7 13.6l43.9 43.9L600.3 370a8.03 8.03 0 0 0 0 11.3l42.4 42.4zM845 694.9c-.8-6.6-8.9-9.4-13.6-4.7l-43.7 43.7L654 600.3a8.03 8.03 0 0 0-11.3 0l-42.4 42.3a8.03 8.03 0 0 0 0 11.3L734 787.6l-43.9 43.9a8.01 8.01 0 0 0 4.7 13.6L855 864c5.1.6 9.5-3.7 8.9-8.9L845 694.9zm-463.7-94.6a8.03 8.03 0 0 0-11.3 0L236.3 733.9l-43.7-43.7a8.01 8.01 0 0 0-13.6 4.7L160.1 855c-.6 5.1 3.7 9.5 8.9 8.9L329.2 845c6.6-.8 9.4-8.9 4.7-13.6L290 787.6 423.7 654c3.1-3.1 3.1-8.2 0-11.3l-42.4-42.4z"}}]})(n)}function k6e(){const{isFullscreen:n,toggleFullscreen:t,fullscreenRef:i,isMobile:a}=Ld(),l=Dd();L.useEffect(()=>{const p=E=>{console.error("Fullscreen error:",E),l({title:"Fullscreen Error",description:"Could not enter fullscreen mode. Try tapping the button again or use the browser's fullscreen option.",status:"error",duration:5e3,isClosable:!0,position:"top"})};return document.addEventListener("fullscreenerror",p),document.addEventListener("webkitfullscreenerror",p),document.addEventListener("mozfullscreenerror",p),document.addEventListener("MSFullscreenError",p),()=>{document.removeEventListener("fullscreenerror",p),document.removeEventListener("webkitfullscreenerror",p),document.removeEventListener("mozfullscreenerror",p),document.removeEventListener("MSFullscreenError",p)}},[l]);const d=()=>{i.current?(a&&/iPhone|iPad|iPod/i.test(navigator.userAgent)&&!n&&l({title:"Mobile Fullscreen",description:"Tap the button again if fullscreen doesn't activate. For iOS, you may need to use the browser's share button and 'Add to Home Screen' for the best experience.",status:"info",duration:5e3,isClosable:!0,position:"top"}),t()):(console.error("Fullscreen target not set"),l({title:"Fullscreen Error",description:"Could not find fullscreen target element.",status:"error",duration:3e3,isClosable:!0,position:"top"}))};return C.jsx(cg,{label:n?"Exit Fullscreen":"Enter Fullscreen",hasArrow:!0,placement:"bottom",closeOnClick:!0,portalProps:{containerRef:i},children:C.jsx(ka,{"aria-label":n?"Exit Fullscreen":"Enter Fullscreen",icon:n?C.jsx(P6e,{}):C.jsx(O6e,{}),onClick:d,variant:"iconButton",size:a?"lg":"md"})})}const BJ={iframeContainer:{position:"relative",paddingBottom:"56.25%",height:0,overflow:"hidden",width:"100%"},iframe:{position:"absolute",top:0,left:0,width:"100%",height:"100%",border:"none"}};function N6e(){const{isOpen:n,onOpen:t,onClose:i}=Cp(),{fullscreenRef:a}=Ld(),[l,d]=t6e(!1);L.useEffect(()=>{Te.log("VideoPlayer: Current video URL:",l),l&&(Te.log("VideoPlayer: Opening modal for video URL:",l),t())},[l,t]);const p=()=>{Te.log("VideoPlayer: Closing modal"),d(),i()};return C.jsx(Ml,{containerRef:a,children:C.jsxs(xa,{isOpen:n,onClose:p,size:"lg",isCentered:!0,portalProps:{containerRef:a},children:[C.jsx(Va,{bg:"rgba(0, 0, 0, 0.8)"}),C.jsxs(Ma,{bg:"gray.900",color:"white",borderRadius:"lg",overflow:"hidden",maxWidth:"80vw",maxHeight:"80vh",display:"flex",justifyContent:"center",alignItems:"center",position:"relative",zIndex:"modal",children:[C.jsx(cc,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",zIndex:"modal",_hover:{bg:"gray.600"},_focus:{boxShadow:"none"},position:"absolute",top:"10px",right:"10px"}),C.jsx(Ua,{p:0,width:"100%",children:l&&C.jsx(Rt,{style:BJ.iframeContainer,children:C.jsx("iframe",{src:l,style:BJ.iframe,allow:"autoplay; fullscreen",allowFullScreen:!0,title:"Video Player"})})})]})]})})}function D6e({isOpen:n,onClose:t,playerName:i,playerId:a,uid:l}){const[d,p]=L.useState(null),[E,v]=L.useState(!0),[b,w]=L.useState(null);return L.useEffect(()=>{n&&(async()=>{if(v(!0),w(null),!l){Te.warn("NameplateModal: No UID provided for player:",i),w("No user ID available for this player"),v(!1);return}try{Te.log("NameplateModal: Fetching profile for UID:",l);const N=await rf(l);N?p({firstName:N.firstName,lastName:N.lastName,linkedinUrl:N.linkedinUrl,websiteUrl:N.websiteUrl,rpmURL:N.rpmURL?N.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null}):w("Could not find profile data for this player")}catch(N){Te.error("Error fetching profile data:",N),w("Error loading profile data")}finally{v(!1)}})()},[l,n,i]),C.jsxs(xa,{isOpen:n,onClose:t,isCentered:!0,size:"md",children:[C.jsx(Va,{backdropFilter:"blur(10px)"}),C.jsxs(Ma,{bg:"gray.900",color:"white",borderRadius:"xl",children:[C.jsx(Ll,{children:"Player Info"}),C.jsx(cc,{}),C.jsx(Ua,{pb:6,children:E?C.jsx(ste,{py:8,children:C.jsx(Lp,{size:"xl",color:"blue.400"})}):b?C.jsxs(o0,{status:"warning",variant:"solid",borderRadius:"md",children:[C.jsx(s0,{}),b]}):C.jsxs(ri,{spacing:4,align:"center",children:[C.jsx(Ou,{size:"2xl",src:d==null?void 0:d.rpmURL,bg:"whiteAlpha.300",name:i,borderWidth:"2px",borderColor:"whiteAlpha.300"}),C.jsxs(ri,{spacing:1,children:[C.jsx(ht,{fontSize:"2xl",fontWeight:"bold",children:i}),(d==null?void 0:d.firstName)&&C.jsxs(ht,{fontSize:"md",color:"gray.400",children:[d.firstName," ",d.lastName]}),C.jsxs(ht,{fontSize:"xs",color:"gray.500",mt:1,children:["ID: ",a]})]}),((d==null?void 0:d.linkedinUrl)||(d==null?void 0:d.websiteUrl))&&C.jsxs(C.Fragment,{children:[C.jsx(Tp,{borderColor:"whiteAlpha.300"}),C.jsxs(Ni,{spacing:4,pt:2,children:[(d==null?void 0:d.linkedinUrl)&&C.jsx(Ru,{href:d.linkedinUrl,isExternal:!0,children:C.jsx(ka,{icon:C.jsx(Woe,{}),variant:"ghost",colorScheme:"linkedin",size:"lg","aria-label":"LinkedIn profile",_hover:{bg:"whiteAlpha.200"}})}),(d==null?void 0:d.websiteUrl)&&C.jsx(Ru,{href:d.websiteUrl,isExternal:!0,children:C.jsx(ka,{icon:C.jsx(zoe,{}),variant:"ghost",colorScheme:"blue",size:"lg","aria-label":"Personal website",_hover:{bg:"whiteAlpha.200"}})})]})]})]})})]})]})}const L6e=({isVisible:n,onToggleVisibility:t,spaceID:i})=>{const[a]=iDe("(max-width: 768px)"),[l,d]=L.useState(!1);L.useEffect(()=>{(()=>{const Ce=navigator.userAgent||navigator.vendor||window.opera,Ne=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(Ce);d(Ne),Ne&&Te.log("UnityPlayerList: Mobile browser detected, component will not render")})()},[]);const p=a||l,E=Voe(),[v,b]=L.useState(!1),[w,A]=L.useState([]),[N,F]=L.useState(!1),[j,B]=L.useState({}),[H,ee]=L.useState({}),[K,te]=L.useState(null),[le,oe]=L.useState(!1),ge=Dd(),Z=window.currentUser||{},ne=(()=>{if(i)return i;if(window.spaceID)return window.spaceID;const Ce=(window.location.pathname||"").split("/"),ye=Ce[Ce.length-1];if(ye&&ye.length>5)return ye;const Ne=document.body.getAttribute("data-space-id");if(Ne)return Ne;const be=localStorage.getItem("currentSpaceId");return be||"fallback-space-id"})();L.useEffect(()=>{(async()=>{try{const ye=await fg(ne);ye&&ye.voiceDisabled?(console.log("UnityPlayerList: Voice is disabled for this space"),oe(!0)):oe(!1)}catch(ye){console.error("UnityPlayerList: Error checking if voice is disabled:",ye)}})();const Ce=ye=>{ye.detail&&typeof ye.detail.voiceDisabled=="boolean"&&(console.log("UnityPlayerList: Voice setting changed:",ye.detail.voiceDisabled),oe(ye.detail.voiceDisabled))};return window.addEventListener("SpaceVoiceSettingChanged",Ce),()=>{window.removeEventListener("SpaceVoiceSettingChanged",Ce)}},[ne]),L.useEffect(()=>{const we={};E.forEach(Ce=>{if(Ce.uid){if(Ce.isLocalPlayer&&window.agoraClient&&window.agoraClient.client)we[Ce.uid]=window.agoraClient.client.uid;else if(window.agoraClient&&window.agoraClient.client&&window.agoraClient.client.remoteUsers){const ye=window.agoraClient.client.remoteUsers,Ne=ye.find(be=>String(be.uid)===String(Ce.uid));if(Ne)we[Ce.uid]=Ne.uid;else{const be=ye.find(Se=>typeof Se.uid=="string"&&Se.uid.includes(Ce.uid));if(be)we[Ce.uid]=be.uid;else{const Se=ye.find(Ae=>typeof Ce.uid=="string"&&Ce.uid.includes(String(Ae.uid)));if(Se)we[Ce.uid]=Se.uid;else{const Ae=ye.filter(Ue=>!(typeof Ue.uid=="string"&&Ue.uid.startsWith("screen-")));Ae.length===1&&!Ce.isLocalPlayer&&(we[Ce.uid]=Ae[0].uid)}}}}}}),ee(we)},[E]);const se=()=>{if(window.agoraClient&&typeof window.agoraClient.isVoiceEnabled=="boolean"){const we=window.agoraClient.isVoiceEnabled;we!==N&&F(we)}if(window.agoraClient&&window.agoraClient.client&&window.agoraClient.client.remoteUsers){const we=window.agoraClient.client.remoteUsers,Ce={};we.forEach(ye=>{typeof ye.uid=="string"&&ye.uid.startsWith("screen-")||(Ce[ye.uid]=!!ye.audioTrack&&!ye.audioTrack.muted)}),JSON.stringify(Ce)!==JSON.stringify(j)&&B(Ce)}};L.useEffect(()=>{const we=setInterval(se,500),Ce=ye=>{ye.detail&&typeof ye.detail.enabled=="boolean"&&F(ye.detail.enabled)};return window.addEventListener("VoiceToggled",Ce),se(),()=>{clearInterval(we),window.removeEventListener("VoiceToggled",Ce)}},[]),L.useEffect(()=>{const we=()=>{Te.log("UnityPlayerList: Player instantiated, showing list"),b(!0)};return window.addEventListener("PlayerInstantiated",we),window.isPlayerInstantiated&&(Te.log("UnityPlayerList: Player was already instantiated"),b(!0)),()=>{window.removeEventListener("PlayerInstantiated",we)}},[]),L.useEffect(()=>{(async()=>{const Ce=await Promise.all(E.map(async ye=>{if(ye.uid)try{const Ne=await rf(ye.uid);let be=null;if(Ne.groups){const Se=`space_${ne}_owners`,Ae=`space_${ne}_hosts`;Ne.groups.includes(Se)?be="owner":Ne.groups.includes(Ae)&&(be="host")}return ue({uid:ye.uid})&&te(be),{...ye,firstName:Ne.firstName,lastName:Ne.lastName,linkedInProfile:Ne.linkedInProfile,websiteUrl:Ne.websiteUrl,rpmURL:Ne.rpmURL?Ne.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null,role:be}}catch(Ne){return Te.error(`Error fetching data for player ${ye.playerName}:`,Ne),ye}return ye}));A(Ce)})()},[E,ne]);const fe=[...w].sort((we,Ce)=>we.isLocalPlayer?-1:Ce.isLocalPlayer?1:0),he=()=>{Te.log("UnityPlayerList: Toggling visibility"),t&&t()},ue=we=>!!(we.isLocalPlayer||Z&&Z.uid&&we.uid===Z.uid),Me=we=>{try{if(ue(we))return window.agoraClient&&typeof window.agoraClient.isVoiceEnabled=="boolean"?window.agoraClient.isVoiceEnabled:N;if(we.uid){if(j[we.uid])return!0;const Ce=H[we.uid];if(Ce&&j[Ce])return!0;const ye=parseInt(we.uid);if(!isNaN(ye)&&j[ye])return!0}return!1}catch(Ce){return console.error("Error in hasActiveMic:",Ce),!1}},He=({player:we})=>{const Ce=we.role;return Ce==="owner"?C.jsxs(Ni,{spacing:1,bg:"green.900",p:2,borderRadius:"md",px:3,boxShadow:"0 0 10px rgba(72, 187, 120, 0.5)",border:"1px solid",borderColor:"green.400",children:[C.jsx(Wn,{as:HV,color:"green.400",boxSize:5}),C.jsx(pp,{colorScheme:"green",variant:"solid",fontSize:"md",px:2,children:"Owner"})]}):Ce==="host"?C.jsxs(Ni,{spacing:1,bg:"purple.900",p:2,borderRadius:"md",px:3,boxShadow:"0 0 10px rgba(159, 122, 234, 0.5)",border:"1px solid",borderColor:"purple.400",children:[C.jsx(Wn,{as:qV,color:"purple.400",boxSize:5}),C.jsx(pp,{colorScheme:"purple",variant:"solid",fontSize:"md",px:2,children:"Host"})]}):null},rt=(we,Ce)=>{switch(console.log(`Action "${we}" performed on player: ${Ce.playerName}`),we){case"mute":ge({title:"Player Muted",description:`${Ce.playerName} has been muted.`,status:"info",duration:3e3,isClosable:!0});break;case"kick":ge({title:"Player Kicked",description:`${Ce.playerName} has been kicked from the space.`,status:"warning",duration:3e3,isClosable:!0});break;case"promote":ge({title:"Player Promoted",description:`${Ce.playerName} has been promoted to host.`,status:"success",duration:3e3,isClosable:!0});break}};return C.jsxs(Rt,{position:"absolute",top:"100px",right:"20px",zIndex:"1",bg:"rgba(0,0,0,0.4)",p:4,borderRadius:"md",color:"white",minWidth:"200px",maxHeight:"300px",visibility:v&&n&&!p?"visible":"hidden",role:"group",children:[C.jsx(Rt,{position:"absolute",top:2,right:2,opacity:0,_groupHover:{opacity:1},transition:"opacity 0.2s",children:C.jsx(ka,{icon:C.jsx(_5e,{boxSize:3}),size:"xs","aria-label":"Close list",variant:"unstyled",color:"white",onClick:he,_hover:{opacity:.8}})}),C.jsxs(ht,{fontWeight:"bold",mb:2,fontSize:"sm",children:["People Online: ",E.length]}),C.jsx(Rt,{maxHeight:"200px",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"4px"},"&::-webkit-scrollbar-track":{background:"rgba(0,0,0,0.1)"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"2px"}},children:C.jsx(ri,{align:"stretch",spacing:1,width:"100%",children:fe.map((we,Ce)=>{const ye=ue(we),Ne=!le&&Me(we);return C.jsx(Rt,{children:C.jsxs(_ne,{placement:"left",trigger:"hover",children:[C.jsx(bne,{children:C.jsxs(Ni,{width:"100%",spacing:2,p:1,borderRadius:"md",_hover:{bg:"whiteAlpha.200"},transition:"background 0.2s",children:[C.jsx(Ou,{size:"xs",src:we.rpmURL,bg:"whiteAlpha.400",name:" ",borderWidth:"1px",borderColor:"whiteAlpha.300"}),C.jsx(ht,{fontSize:"xs",children:we.playerName}),we.role==="owner"&&C.jsx(Wn,{as:HV,color:"green.400",boxSize:2.5}),we.role==="host"&&C.jsx(Wn,{as:qV,color:"purple.400",boxSize:2.5}),C.jsx(Pk,{}),K==="owner"&&C.jsxs(RN,{closeOnSelect:!0,placement:"bottom-end",children:[C.jsx(CN,{as:ka,"aria-label":"Options",icon:C.jsx(g6e,{}),variant:"ghost",size:"xs",color:"whiteAlpha.700",_hover:{color:"white",bg:"whiteAlpha.300"},onClick:be=>be.stopPropagation()}),C.jsxs(IN,{bg:"rgba(0,0,0,0.8)",borderColor:"whiteAlpha.300",minW:"120px",zIndex:10001,children:[C.jsx(hp,{icon:C.jsx(C6e,{}),onClick:()=>rt("mute",we),_hover:{bg:"whiteAlpha.200"},fontSize:"sm",isDisabled:le,children:"Mute Player"}),C.jsx(hp,{icon:C.jsx(T6e,{}),onClick:()=>rt("promote",we),_hover:{bg:"whiteAlpha.200"},fontSize:"sm",children:"Promote to Host"}),C.jsx(rne,{borderColor:"whiteAlpha.300"}),C.jsx(hp,{icon:C.jsx(p6e,{}),onClick:()=>rt("kick",we),_hover:{bg:"red.800"},color:"red.300",fontSize:"sm",children:"Kick from Space"})]})]}),!le&&(Ne?C.jsx(Rt,{color:"green.400",children:C.jsx(KV,{})}):C.jsx(Rt,{color:"red.400",children:C.jsx($V,{})})),ye&&C.jsx(ht,{fontSize:"xs",color:"gray.300",ml:1,children:"(you)"})]})}),C.jsx(Sne,{bg:"rgba(0,0,0,0.8)",border:"none",boxShadow:"dark-lg",color:"white",p:4,width:"auto",minWidth:"250px",ml:"-20px",position:"absolute",left:"-250px",top:"-100px",transform:"none !important",zIndex:1e4,children:C.jsx(yne,{children:C.jsxs(ri,{align:"center",spacing:3,children:[C.jsx(Ou,{size:"xl",src:we.rpmURL,bg:"whiteAlpha.400",name:" ",borderWidth:"2px",borderColor:"whiteAlpha.300"}),C.jsx(ht,{fontSize:"xl",fontWeight:"bold",children:we.playerName}),C.jsx(He,{player:we}),we.firstName&&C.jsxs(ht,{fontSize:"sm",color:"gray.300",children:[we.firstName," ",we.lastName]}),C.jsxs(Ni,{spacing:4,pt:2,children:[we.linkedInProfile&&C.jsx(Ru,{href:we.linkedInProfile,isExternal:!0,children:C.jsx(ka,{icon:C.jsx(Woe,{}),variant:"ghost",colorScheme:"whiteAlpha",size:"md","aria-label":"LinkedIn profile",_hover:{bg:"whiteAlpha.200"}})}),we.websiteUrl&&C.jsx(Ru,{href:we.websiteUrl,isExternal:!0,children:C.jsx(ka,{icon:C.jsx(zoe,{}),variant:"ghost",colorScheme:"whiteAlpha",size:"md","aria-label":"Personal website",_hover:{bg:"whiteAlpha.200"}})}),!le&&C.jsx(ka,{icon:Ne?C.jsx(KV,{}):C.jsx($V,{}),variant:"ghost",colorScheme:Ne?"green":"red",size:"md","aria-label":"Microphone status",isDisabled:!0}),le&&C.jsx(ka,{icon:C.jsx(R6e,{}),variant:"ghost",colorScheme:"red",size:"md","aria-label":"Voice chat disabled",isDisabled:!0,title:"Voice chat is disabled for this space"})]})]})})})]})},Ce)})})})]})};var hk={exports:{}},x6e=hk.exports,WJ;function M6e(){return WJ||(WJ=1,function(n,t){(function(i,a){n.exports=a()})(x6e,function(){function i(e,r){return r.forEach(function(o){o&&typeof o!="string"&&!Array.isArray(o)&&Object.keys(o).forEach(function(s){if(s!=="default"&&!(s in e)){var c=Object.getOwnPropertyDescriptor(o,s);Object.defineProperty(e,s,c.get?c:{enumerable:!0,get:function(){return o[s]}})}})}),Object.freeze(e)}var a=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof lE<"u"?lE:typeof self<"u"?self:{};function l(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var d=function(e){try{return!!e()}catch{return!0}},p=!d(function(){var e=(function(){}).bind();return typeof e!="function"||e.hasOwnProperty("prototype")}),E=p,v=Function.prototype,b=v.call,w=E&&v.bind.bind(b,b),A=E?w:function(e){return function(){return b.apply(e,arguments)}},N=A({}.isPrototypeOf),F=function(e){return e&&e.Math==Math&&e},j=F(typeof globalThis=="object"&&globalThis)||F(typeof window=="object"&&window)||F(typeof self=="object"&&self)||F(typeof a=="object"&&a)||function(){return this}()||a||Function("return this")(),B=p,H=Function.prototype,ee=H.apply,K=H.call,te=typeof Reflect=="object"&&Reflect.apply||(B?K.bind(ee):function(){return K.apply(ee,arguments)}),le=A,oe=le({}.toString),ge=le("".slice),Z=function(e){return ge(oe(e),8,-1)},Q=Z,ne=A,se=function(e){if(Q(e)==="Function")return ne(e)},fe=typeof document=="object"&&document.all,he={all:fe,IS_HTMLDDA:fe===void 0&&fe!==void 0},ue=he.all,Me=he.IS_HTMLDDA?function(e){return typeof e=="function"||e===ue}:function(e){return typeof e=="function"},He={},rt=!d(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),we=p,Ce=Function.prototype.call,ye=we?Ce.bind(Ce):function(){return Ce.apply(Ce,arguments)},Ne={},be={}.propertyIsEnumerable,Se=Object.getOwnPropertyDescriptor,Ae=Se&&!be.call({1:2},1);Ne.f=Ae?function(e){var r=Se(this,e);return!!r&&r.enumerable}:be;var Ue,ze,et=function(e,r){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:r}},nt=d,dt=Z,Xe=Object,It=A("".split),hn=nt(function(){return!Xe("z").propertyIsEnumerable(0)})?function(e){return dt(e)=="String"?It(e,""):Xe(e)}:Xe,Ut=function(e){return e==null},ln=Ut,Ln=TypeError,Xt=function(e){if(ln(e))throw Ln("Can't call method on "+e);return e},Yn=hn,Kt=Xt,Re=function(e){return Yn(Kt(e))},Fe=Me,Ke=he.all,yt=he.IS_HTMLDDA?function(e){return typeof e=="object"?e!==null:Fe(e)||e===Ke}:function(e){return typeof e=="object"?e!==null:Fe(e)},St={},Ge=St,Ot=j,Jt=Me,fn=function(e){return Jt(e)?e:void 0},an=function(e,r){return arguments.length<2?fn(Ge[e])||fn(Ot[e]):Ge[e]&&Ge[e][r]||Ot[e]&&Ot[e][r]},ir=typeof navigator<"u"&&String(navigator.userAgent)||"",ia=j,Vt=ir,on=ia.process,Pi=ia.Deno,fi=on&&on.versions||Pi&&Pi.version,Ti=fi&&fi.v8;Ti&&(ze=(Ue=Ti.split("."))[0]>0&&Ue[0]<4?1:+(Ue[0]+Ue[1])),!ze&&Vt&&(!(Ue=Vt.match(/Edge\/(\d+)/))||Ue[1]>=74)&&(Ue=Vt.match(/Chrome\/(\d+)/))&&(ze=+Ue[1]);var ur=ze,Ba=ur,nl=d,us=j.String,ds=!!Object.getOwnPropertySymbols&&!nl(function(){var e=Symbol();return!us(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&Ba&&Ba<41}),Ul=ds&&!Symbol.sham&&typeof Symbol.iterator=="symbol",Fo=an,lc=Me,oa=N,uc=Object,rl=Ul?function(e){return typeof e=="symbol"}:function(e){var r=Fo("Symbol");return lc(r)&&oa(r.prototype,uc(e))},Lu=String,dc=function(e){try{return Lu(e)}catch{return"Object"}},il=Me,Is=dc,Mi=TypeError,uo=function(e){if(il(e))return e;throw Mi(Is(e)+" is not a function")},Wa=uo,xu=Ut,hc=function(e,r){var o=e[r];return xu(o)?void 0:Wa(o)},sa=ye,aa=Me,Md=yt,Ng=TypeError,Mu={exports:{}},cf=j,jo=Object.defineProperty,Uu=function(e,r){try{jo(cf,e,{value:r,configurable:!0,writable:!0})}catch{cf[e]=r}return r},ca="__core-js_shared__",Ud=j[ca]||Uu(ca,{}),Vd=Ud;(Mu.exports=function(e,r){return Vd[e]||(Vd[e]=r!==void 0?r:{})})("versions",[]).push({version:"3.31.1",mode:"pure",copyright:" 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.31.1/LICENSE",source:"https://github.com/zloirock/core-js"});var za=Mu.exports,Fd=Xt,Vu=Object,As=function(e){return Vu(Fd(e))},jd=As,Fr=A({}.hasOwnProperty),pi=Object.hasOwn||function(e,r){return Fr(jd(e),r)},fc=A,ol=0,la=Math.random(),lf=fc(1 .toString),Bd=function(e){return"Symbol("+(e===void 0?"":e)+")_"+lf(++ol+la,36)},Vl=za,hs=pi,Fp=Bd,Xo=ds,uf=Ul,sl=j.Symbol,Wd=Vl("wks"),zd=uf?sl.for||sl:sl&&sl.withoutSetter||Fp,dr=function(e){return hs(Wd,e)||(Wd[e]=Xo&&hs(sl,e)?sl[e]:zd("Symbol."+e)),Wd[e]},Fl=ye,jl=yt,Fu=rl,Ga=hc,Ps=function(e,r){var o,s;if(aa(o=e.toString)&&!Md(s=sa(o,e))||aa(o=e.valueOf)&&!Md(s=sa(o,e)))return s;throw Ng("Can't convert object to primitive value")},ju=TypeError,al=dr("toPrimitive"),Bl=function(e,r){if(!jl(e)||Fu(e))return e;var o,s=Ga(e,al);if(s){if(o=Fl(s,e,r),!jl(o)||Fu(o))return o;throw ju("Can't convert object to primitive value")}return Ps(e)},zr=rl,Ha=function(e){var r=Bl(e,"string");return zr(r)?r:r+""},nr=yt,pc=j.document,jp=nr(pc)&&nr(pc.createElement),Wl=function(e){return jp?pc.createElement(e):{}},Gd=Wl,df=!rt&&!d(function(){return Object.defineProperty(Gd("div"),"a",{get:function(){return 7}}).a!=7}),Bp=rt,hf=ye,Os=Ne,no=et,ks=Re,Ns=Ha,zl=pi,Ds=df,Ls=Object.getOwnPropertyDescriptor;He.f=Bp?Ls:function(e,r){if(e=ks(e),r=Ns(r),Ds)try{return Ls(e,r)}catch{}if(zl(e,r))return no(!hf(Os.f,e,r),e[r])};var Wp=d,mc=Me,ho=/#|\.prototype\./,Bu=function(e,r){var o=cl[ff(e)];return o==zp||o!=Gl&&(mc(r)?Wp(r):!!r)},ff=Bu.normalize=function(e){return String(e).replace(ho,".").toLowerCase()},cl=Bu.data={},Gl=Bu.NATIVE="N",zp=Bu.POLYFILL="P",ua=Bu,da=uo,ll=p,ve=se(se.bind),De=function(e,r){return da(e),r===void 0?e:ll?ve(e,r):function(){return e.apply(r,arguments)}},tt={},$t=rt&&d(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),Hn=yt,_r=String,jr=TypeError,cn=function(e){if(Hn(e))return e;throw jr(_r(e)+" is not an object")},Nr=rt,mi=df,Po=$t,xs=cn,Ms=Ha,Wu=TypeError,Yi=Object.defineProperty,ul=Object.getOwnPropertyDescriptor,Hd="enumerable",gc="configurable",Dg="writable";tt.f=Nr?Po?function(e,r,o){if(xs(e),r=Ms(r),xs(o),typeof e=="function"&&r==="prototype"&&"value"in o&&Dg in o&&!o[Dg]){var s=ul(e,r);s&&s[Dg]&&(e[r]=o.value,o={configurable:gc in o?o[gc]:s[gc],enumerable:Hd in o?o[Hd]:s[Hd],writable:!1})}return Yi(e,r,o)}:Yi:function(e,r,o){if(xs(e),r=Ms(r),xs(o),mi)try{return Yi(e,r,o)}catch{}if("get"in o||"set"in o)throw Wu("Accessors not supported");return"value"in o&&(e[r]=o.value),e};var Gp=tt,zu=et,Us=rt?function(e,r,o){return Gp.f(e,r,zu(1,o))}:function(e,r,o){return e[r]=o,e},Hl=j,Hp=te,Lg=se,$E=Me,$p=He.f,Kp=ua,Gu=St,Hu=De,$u=Us,xg=pi,KE=function(e){var r=function(o,s,c){if(this instanceof r){switch(arguments.length){case 0:return new e;case 1:return new e(o);case 2:return new e(o,s)}return new e(o,s,c)}return Hp(e,this,arguments)};return r.prototype=e.prototype,r},xn=function(e,r){var o,s,c,u,h,m,_,y,S,R=e.target,P=e.global,k=e.stat,z=e.proto,U=P?Hl:k?Hl[R]:(Hl[R]||{}).prototype,V=P?Gu:Gu[R]||$u(Gu,R,{})[R],q=V.prototype;for(u in r)s=!(o=Kp(P?u:R+(k?".":"#")+u,e.forced))&&U&&xg(U,u),m=V[u],s&&(_=e.dontCallGetSet?(S=$p(U,u))&&S.value:U[u]),h=s&&_?_:r[u],s&&typeof m==typeof h||(y=e.bind&&s?Hu(h,Hl):e.wrap&&s?KE(h):z&&$E(h)?Lg(h):h,(e.sham||h&&h.sham||m&&m.sham)&&$u(y,"sham",!0),$u(V,u,y),z&&(xg(Gu,c=R+"Prototype")||$u(Gu,c,{}),$u(Gu[c],u,h),e.real&&q&&(o||!q[u])&&$u(q,u,h)))},qp=Math.ceil,Vs=Math.floor,qE=Math.trunc||function(e){var r=+e;return(r>0?Vs:qp)(r)},YE=qE,_c=function(e){var r=+e;return r!=r||r===0?0:YE(r)},I=_c,W=Math.max,J=Math.min,pe=function(e,r){var o=I(e);return o<0?W(o+r,0):J(o,r)},qe=_c,at=Math.min,xt=function(e){return e>0?at(qe(e),9007199254740991):0},Gr=xt,oi=function(e){return Gr(e.length)},Er=Re,Bo=pe,fo=oi,$a=function(e){return function(r,o,s){var c,u=Er(r),h=fo(u),m=Bo(s,h);if(e&&o!=o){for(;h>m;)if((c=u[m++])!=c)return!0}else for(;h>m;m++)if((e||m in u)&&u[m]===o)return e||m||0;return!e&&-1}},Fs={includes:$a(!0),indexOf:$a(!1)},pf=Fs.includes;xn({target:"Array",proto:!0,forced:d(function(){return!Array(1).includes()})},{includes:function(e){return pf(this,e,arguments.length>1?arguments[1]:void 0)}});var Yp=St,Ka=function(e){return Yp[e+"Prototype"]},fC=Ka("Array").includes,pC=yt,Xp=Z,m1=dr("match"),mC=function(e){var r;return pC(e)&&((r=e[m1])!==void 0?!!r:Xp(e)=="RegExp")},g1=mC,gC=TypeError,V0={};V0[dr("toStringTag")]="z";var mf=String(V0)==="[object z]",Mg=mf,_1=Me,gf=Z,E1=dr("toStringTag"),_C=Object,F0=gf(function(){return arguments}())=="Arguments",Ec=Mg?gf:function(e){var r,o,s;return e===void 0?"Undefined":e===null?"Null":typeof(o=function(c,u){try{return c[u]}catch{}}(r=_C(e),E1))=="string"?o:F0?gf(r):(s=gf(r))=="Object"&&_1(r.callee)?"Arguments":s},EC=Ec,yC=String,ha=function(e){if(EC(e)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return yC(e)},y1=dr("match"),v1=xn,S1=function(e){if(g1(e))throw gC("The method doesn't accept regular expressions");return e},b1=Xt,vC=ha,dl=function(e){var r=/./;try{"/./"[e](r)}catch{try{return r[y1]=!1,"/./"[e](r)}catch{}}return!1},Ug=A("".indexOf);v1({target:"String",proto:!0,forced:!dl("includes")},{includes:function(e){return!!~Ug(vC(b1(this)),vC(S1(e)),arguments.length>1?arguments[1]:void 0)}});var SC=Ka("String").includes,j0=N,bC=fC,TC=SC,Vg=Array.prototype,B0=String.prototype,T1=function(e){var r=e.includes;return e===Vg||j0(Vg,e)&&r===Vg.includes?bC:typeof e=="string"||e===B0||j0(B0,e)&&r===B0.includes?TC:r},st=l(T1),W0=uo,Fg=As,z0=hn,wC=oi,XE=TypeError,Jp=function(e){return function(r,o,s,c){W0(o);var u=Fg(r),h=z0(u),m=wC(u),_=e?m-1:0,y=e?-1:1;if(s<2)for(;;){if(_ in h){c=h[_],_+=y;break}if(_+=y,e?_<0:m<=_)throw XE("Reduce of empty array with no initial value")}for(;e?_>=0:m>_;_+=y)_ in h&&(c=o(c,h[_],_,u));return c}},G0={left:Jp(!1)},RC=d,_f=function(e,r){var o=[][e];return!!o&&RC(function(){o.call(null,r||function(){return 1},1)})},Ef=typeof process<"u"&&Z(process)=="process",CC=G0.left;xn({target:"Array",proto:!0,forced:!Ef&&ur>79&&ur<83||!_f("reduce")},{reduce:function(e){var r=arguments.length;return CC(this,e,r,r>1?arguments[1]:void 0)}});var IC=Ka("Array").reduce,AC=N,PC=IC,JE=Array.prototype,$d=function(e){var r=e.reduce;return e===JE||AC(JE,e)&&r===JE.reduce?PC:r},QE=$d,qa=l(QE),w1=Z,jg=Array.isArray||function(e){return w1(e)=="Array"},Bg=xn,R1=jg,OC=A([].reverse),H0=[1,2];Bg({target:"Array",proto:!0,forced:String(H0)===String(H0.reverse())},{reverse:function(){return R1(this)&&(this.length=this.length),OC(this)}});var wi=Ka("Array").reverse,$0=N,ZE=wi,yf=Array.prototype,kC=function(e){var r=e.reverse;return e===yf||$0(yf,e)&&r===yf.reverse?ZE:r},ey=kC,Qp=l(ey),ty=Bd,vf=za("keys"),Wg=function(e){return vf[e]||(vf[e]=ty(e))},C1=!d(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),I1=pi,NC=Me,ny=As,ry=C1,iy=Wg("IE_PROTO"),zg=Object,K0=zg.prototype,Gg=ry?zg.getPrototypeOf:function(e){var r=ny(e);if(I1(r,iy))return r[iy];var o=r.constructor;return NC(o)&&r instanceof o?o.prototype:r instanceof zg?K0:null},A1=A,DC=uo,P1=Me,O1=String,q0=TypeError,Kd=function(e,r,o){try{return A1(DC(Object.getOwnPropertyDescriptor(e,r)[o]))}catch{}},LC=cn,Zp=function(e){if(typeof e=="object"||P1(e))return e;throw q0("Can't set "+O1(e)+" as a prototype")},$l=Object.setPrototypeOf||("__proto__"in{}?function(){var e,r=!1,o={};try{(e=Kd(Object.prototype,"__proto__","set"))(o,[]),r=o instanceof Array}catch{}return function(s,c){return LC(s),Zp(c),r?e(s,c):s.__proto__=c,s}}():void 0),qd={},yc={},Hg=pi,k1=Re,N1=Fs.indexOf,Sf=yc,em=A([].push),bf=function(e,r){var o,s=k1(e),c=0,u=[];for(o in s)!Hg(Sf,o)&&Hg(s,o)&&em(u,o);for(;r.length>c;)Hg(s,o=r[c++])&&(~N1(u,o)||em(u,o));return u},tm=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Y0=bf,nm=tm.concat("length","prototype");qd.f=Object.getOwnPropertyNames||function(e){return Y0(e,nm)};var vc={};vc.f=Object.getOwnPropertySymbols;var Ri=an,gi=qd,Yd=vc,fs=cn,fa=A([].concat),Tf=Ri("Reflect","ownKeys")||function(e){var r=gi.f(fs(e)),o=Yd.f;return o?fa(r,o(e)):r},wf=pi,pa=Tf,oy=He,xC=tt,sy={},ay=bf,MC=tm,Sc=Object.keys||function(e){return ay(e,MC)},cy=rt,X0=$t,UC=tt,D1=cn,Xd=Re,rm=Sc;sy.f=cy&&!X0?Object.defineProperties:function(e,r){D1(e);for(var o,s=Xd(r),c=rm(r),u=c.length,h=0;u>h;)UC.f(e,o=c[h++],s[o]);return e};var Ku,$g=an("document","documentElement"),ly=cn,bc=sy,Ya=tm,Rf=yc,qu=$g,Yu=Wl,Xu="prototype",uy="script",dy=Wg("IE_PROTO"),Kg=function(){},ma=function(e){return"<"+uy+">"+e+"</"+uy+">"},ga=function(e){e.write(ma("")),e.close();var r=e.parentWindow.Object;return e=null,r},si=function(){try{Ku=new ActiveXObject("htmlfile")}catch{}var e,r,o;si=typeof document<"u"?document.domain&&Ku?ga(Ku):(r=Yu("iframe"),o="java"+uy+":",r.style.display="none",qu.appendChild(r),r.src=String(o),(e=r.contentWindow.document).open(),e.write(ma("document.F=Object")),e.close(),e.F):ga(Ku);for(var s=Ya.length;s--;)delete si[Xu][Ya[s]];return si()};Rf[dy]=!0;var js=Object.create||function(e,r){var o;return e!==null?(Kg[Xu]=ly(e),o=new Kg,Kg[Xu]=null,o[dy]=e):o=si(),r===void 0?o:bc.f(o,r)},VC=yt,FC=Us,hy=Error,J0=A("".replace),jC=String(hy("zxcasd").stack),qg=/\n\s*at [^:]*:[^\n]*/,BC=qg.test(jC),im=et,Q0=!d(function(){var e=Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",im(1,7)),e.stack!==7)}),L1=Us,Yg=function(e,r){if(BC&&typeof e=="string"&&!hy.prepareStackTrace)for(;r--;)e=J0(e,qg,"");return e},fy=Q0,Z0=Error.captureStackTrace,Jd={},om=Jd,WC=dr("iterator"),py=Array.prototype,Xg=function(e){return e!==void 0&&(om.Array===e||py[WC]===e)},sm=Ec,my=hc,eb=Ut,tb=Jd,nb=dr("iterator"),Ju=function(e){if(!eb(e))return my(e,nb)||my(e,"@@iterator")||tb[sm(e)]},Tc=ye,Cf=uo,rb=cn,zC=dc,Qu=Ju,Qd=TypeError,Jg=function(e,r){var o=arguments.length<2?Qu(e):r;if(Cf(o))return rb(Tc(o,e));throw Qd(zC(e)+" is not iterable")},GC=ye,Kl=cn,Zd=hc,Qg=function(e,r,o){var s,c;Kl(e);try{if(!(s=Zd(e,"return"))){if(r==="throw")throw o;return o}s=GC(s,e)}catch(u){c=!0,s=u}if(r==="throw")throw o;if(c)throw s;return Kl(s),o},HC=De,gy=ye,$C=cn,Zg=dc,ql=Xg,e_=oi,am=N,If=Jg,ib=Ju,Af=Qg,KC=TypeError,cm=function(e,r){this.stopped=e,this.result=r},Oi=cm.prototype,eh=function(e,r,o){var s,c,u,h,m,_,y,S=o&&o.that,R=!(!o||!o.AS_ENTRIES),P=!(!o||!o.IS_RECORD),k=!(!o||!o.IS_ITERATOR),z=!(!o||!o.INTERRUPTED),U=HC(r,S),V=function(Y){return s&&Af(s,"normal",Y),new cm(!0,Y)},q=function(Y){return R?($C(Y),z?U(Y[0],Y[1],V):U(Y[0],Y[1])):z?U(Y,V):U(Y)};if(P)s=e.iterator;else if(k)s=e;else{if(!(c=ib(e)))throw KC(Zg(e)+" is not iterable");if(ql(c)){for(u=0,h=e_(e);h>u;u++)if((m=q(e[u]))&&am(Oi,m))return m;return new cm(!1)}s=If(e,c)}for(_=P?e.next:s.next;!(y=gy(_,s)).done;){try{m=q(y.value)}catch(Y){Af(s,"throw",Y)}if(typeof m=="object"&&m&&am(Oi,m))return m}return new cm(!1)},ob=ha,sb=xn,_y=N,ab=Gg,Yl=$l,Ui=function(e,r,o){for(var s=pa(r),c=xC.f,u=oy.f,h=0;h<s.length;h++){var m=s[h];wf(e,m)||o&&wf(o,m)||c(e,m,u(r,m))}},po=js,mo=Us,lm=et,t_=function(e,r){VC(r)&&"cause"in r&&FC(e,"cause",r.cause)},n_=function(e,r,o,s){fy&&(Z0?Z0(e,r):L1(e,"stack",Yg(o,s)))},x1=eh,ps=function(e,r){return e===void 0?arguments.length<2?"":r:ob(e)},cb=dr("toStringTag"),um=Error,lb=[].push,Bs=function(e,r){var o,s=_y(_a,this);Yl?o=Yl(um(),s?ab(this):_a):(o=s?this:po(_a),mo(o,cb,"Error")),r!==void 0&&mo(o,"message",ps(r)),n_(o,Bs,o.stack,1),arguments.length>2&&t_(o,arguments[2]);var c=[];return x1(e,lb,{that:c}),mo(o,"errors",c),o};Yl?Yl(Bs,um):Ui(Bs,um,{name:!0});var _a=Bs.prototype=po(um.prototype,{constructor:lm(1,Bs),message:lm(1,""),name:lm(1,"AggregateError")});sb({global:!0},{AggregateError:Bs});var th,Pf,dm,qC=Me,ub=j.WeakMap,YC=qC(ub)&&/native code/.test(String(ub)),db=j,XC=yt,JC=Us,Ey=pi,yy=Ud,r_=Wg,QC=yc,i_="Object already initialized",hm=db.TypeError,ZC=db.WeakMap;if(YC||yy.state){var wc=yy.state||(yy.state=new ZC);wc.get=wc.get,wc.has=wc.has,wc.set=wc.set,th=function(e,r){if(wc.has(e))throw hm(i_);return r.facade=e,wc.set(e,r),r},Pf=function(e){return wc.get(e)||{}},dm=function(e){return wc.has(e)}}else{var Of=r_("state");QC[Of]=!0,th=function(e,r){if(Ey(e,Of))throw hm(i_);return r.facade=e,JC(e,Of,r),r},Pf=function(e){return Ey(e,Of)?e[Of]:{}},dm=function(e){return Ey(e,Of)}}var nh,hb,fb,Zu={set:th,get:Pf,has:dm,enforce:function(e){return dm(e)?Pf(e):th(e,{})},getterFor:function(e){return function(r){var o;if(!XC(r)||(o=Pf(r)).type!==e)throw hm("Incompatible receiver, "+e+" required");return o}}},vy=rt,eI=pi,pb=Function.prototype,M1=vy&&Object.getOwnPropertyDescriptor,mb=eI(pb,"name"),tI={PROPER:mb&&(function(){}).name==="something",CONFIGURABLE:mb&&(!vy||vy&&M1(pb,"name").configurable)},U1=Us,ed=function(e,r,o,s){return s&&s.enumerable?e[r]=o:U1(e,r,o),e},nI=d,rI=Me,Sy=yt,V1=js,iI=Gg,F1=ed,Xa=dr("iterator"),by=!1;[].keys&&("next"in(fb=[].keys())?(hb=iI(iI(fb)))!==Object.prototype&&(nh=hb):by=!0);var Ty=!Sy(nh)||nI(function(){var e={};return nh[Xa].call(e)!==e});rI((nh=Ty?{}:V1(nh))[Xa])||F1(nh,Xa,function(){return this});var gb={IteratorPrototype:nh,BUGGY_SAFARI_ITERATORS:by},oI=Ec,sI=mf?{}.toString:function(){return"[object "+oI(this)+"]"},_b=mf,fm=tt.f,Eb=Us,yb=pi,j1=sI,vb=dr("toStringTag"),td=function(e,r,o,s){if(e){var c=o?e:e.prototype;yb(c,vb)||fm(c,vb,{configurable:!0,value:r}),s&&!_b&&Eb(c,"toString",j1)}},aI=gb.IteratorPrototype,cI=js,lI=et,B1=td,Ea=Jd,Ws=function(){return this},wy=function(e,r,o,s){var c=r+" Iterator";return e.prototype=cI(aI,{next:lI(+!s,o)}),B1(e,c,!1,!0),Ea[c]=Ws,e},uI=xn,dI=ye,hI=tI,fI=wy,Sb=Gg,pI=td,Ry=ed,bb=Jd,mI=gb,Tb=hI.PROPER,pm=mI.BUGGY_SAFARI_ITERATORS,Cy=dr("iterator"),Iy="keys",kf="values",gI="entries",_I=function(){return this},Ay=function(e,r,o,s,c,u,h){fI(o,r,s);var m,_,y,S=function(q){if(q===c&&U)return U;if(!pm&&q in k)return k[q];switch(q){case Iy:case kf:case gI:return function(){return new o(this,q)}}return function(){return new o(this)}},R=r+" Iterator",P=!1,k=e.prototype,z=k[Cy]||k["@@iterator"]||c&&k[c],U=!pm&&z||S(c),V=r=="Array"&&k.entries||z;if(V&&(m=Sb(V.call(new e)))!==Object.prototype&&m.next&&(pI(m,R,!0,!0),bb[R]=_I),Tb&&c==kf&&z&&z.name!==kf&&(P=!0,U=function(){return dI(z,this)}),c)if(_={values:S(kf),keys:u?U:S(Iy),entries:S(gI)},h)for(y in _)(pm||P||!(y in k))&&Ry(k,y,_[y]);else uI({target:r,proto:!0,forced:pm||P},_);return h&&k[Cy]!==U&&Ry(k,Cy,U,{}),bb[r]=U,_},Py=function(e,r){return{value:e,done:r}},Oy=Re,Xl=Jd,EI=Zu;tt.f;var yI=Ay,ky=Py,wb="Array Iterator",vI=EI.set,o_=EI.getterFor(wb);yI(Array,"Array",function(e,r){vI(this,{type:wb,target:Oy(e),index:0,kind:r})},function(){var e=o_(this),r=e.target,o=e.kind,s=e.index++;return!r||s>=r.length?(e.target=void 0,ky(void 0,!0)):ky(o=="keys"?s:o=="values"?r[s]:[s,r[s]],!1)},"values"),Xl.Arguments=Xl.Array;var ms=tt,Ny=function(e,r,o){return ms.f(e,r,o)},W1=an,Dy=Ny,gs=rt,SI=dr("species"),Qt=N,mm=TypeError,s_=function(e,r){if(Qt(r,e))return e;throw mm("Incorrect invocation")},bI=Me,Rb=Ud,a_=A(Function.toString);bI(Rb.inspectSource)||(Rb.inspectSource=function(e){return a_(e)});var c_=Rb.inspectSource,Cb=A,TI=d,Ib=Me,wI=Ec,Ab=c_,Ly=function(){},Jo=[],Rc=an("Reflect","construct"),Jl=/^\s*(?:class|function)\b/,RI=Cb(Jl.exec),CI=!Jl.exec(Ly),zs=function(e){if(!Ib(e))return!1;try{return Rc(Ly,Jo,e),!0}catch{return!1}},Pb=function(e){if(!Ib(e))return!1;switch(wI(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return CI||!!RI(Jl,Ab(e))}catch{return!0}};Pb.sham=!0;var ya,gm,Ob,xy,l_=!Rc||TI(function(){var e;return zs(zs.call)||!zs(Object)||!zs(function(){e=!0})||e})?Pb:zs,II=l_,z1=dc,My=TypeError,Uy=cn,Cc=function(e){if(II(e))return e;throw My(z1(e)+" is not a constructor")},Tr=Ut,Wo=dr("species"),Xi=function(e,r){var o,s=Uy(e).constructor;return s===void 0||Tr(o=Uy(s)[Wo])?r:Cc(o)},go=A([].slice),Ja=TypeError,hl=function(e,r){if(e<r)throw Ja("Not enough arguments");return e},_o=/(?:ipad|iphone|ipod).*applewebkit/i.test(ir),Qo=j,Nf=te,Vy=De,Fy=Me,u_=pi,Gs=d,jy=$g,_m=go,Ql=Wl,By=hl,kb=_o,rh=Ef,Em=Qo.setImmediate,Zl=Qo.clearImmediate,Wy=Qo.process,Df=Qo.Dispatch,Nb=Qo.Function,d_=Qo.MessageChannel,zy=Qo.String,Zo=0,Ic={},Ac="onreadystatechange";Gs(function(){ya=Qo.location});var _s=function(e){if(u_(Ic,e)){var r=Ic[e];delete Ic[e],r()}},Gy=function(e){return function(){_s(e)}},Hy=function(e){_s(e.data)},$y=function(e){Qo.postMessage(zy(e),ya.protocol+"//"+ya.host)};Em&&Zl||(Em=function(e){By(arguments.length,1);var r=Fy(e)?e:Nb(e),o=_m(arguments,1);return Ic[++Zo]=function(){Nf(r,void 0,o)},gm(Zo),Zo},Zl=function(e){delete Ic[e]},rh?gm=function(e){Wy.nextTick(Gy(e))}:Df&&Df.now?gm=function(e){Df.now(Gy(e))}:d_&&!kb?(xy=(Ob=new d_).port2,Ob.port1.onmessage=Hy,gm=Vy(xy.postMessage,xy)):Qo.addEventListener&&Fy(Qo.postMessage)&&!Qo.importScripts&&ya&&ya.protocol!=="file:"&&!Gs($y)?(gm=$y,Qo.addEventListener("message",Hy,!1)):gm=Ac in Ql("script")?function(e){jy.appendChild(Ql("script"))[Ac]=function(){jy.removeChild(this),_s(e)}}:function(e){setTimeout(Gy(e),0)});var Ky={set:Em,clear:Zl},nd=function(){this.head=null,this.tail=null};nd.prototype={add:function(e){var r={item:e,next:null},o=this.tail;o?o.next=r:this.head=r,this.tail=r},get:function(){var e=this.head;if(e)return(this.head=e.next)===null&&(this.tail=null),e.item}};var Lf,h_,rd,f_,ih,Db=nd,AI=/ipad|iphone|ipod/i.test(ir)&&typeof Pebble<"u",Lb=/web0s(?!.*chrome)/i.test(ir),eu=j,PI=De,G1=He.f,qy=Ky.set,OI=Db,xf=_o,H1=AI,ym=Lb,Yy=Ef,Vi=eu.MutationObserver||eu.WebKitMutationObserver,kI=eu.document,xb=eu.process,Xy=eu.Promise,NI=G1(eu,"queueMicrotask"),Jy=NI&&NI.value;if(!Jy){var p_=new OI,Qy=function(){var e,r;for(Yy&&(e=xb.domain)&&e.exit();r=p_.get();)try{r()}catch(o){throw p_.head&&Lf(),o}e&&e.enter()};xf||Yy||ym||!Vi||!kI?!H1&&Xy&&Xy.resolve?((f_=Xy.resolve(void 0)).constructor=Xy,ih=PI(f_.then,f_),Lf=function(){ih(Qy)}):Yy?Lf=function(){xb.nextTick(Qy)}:(qy=PI(qy,eu),Lf=function(){qy(Qy)}):(h_=!0,rd=kI.createTextNode(""),new Vi(Qy).observe(rd,{characterData:!0}),Lf=function(){rd.data=h_=!h_}),Jy=function(e){p_.head||Lf(),p_.add(e)}}var Qa=Jy,oh=function(e){try{return{error:!1,value:e()}}catch(r){return{error:!0,value:r}}},Mf=j.Promise,id=typeof Deno=="object"&&Deno&&typeof Deno.version=="object",Zy=!id&&!Ef&&typeof window=="object"&&typeof document=="object",Uf=j,sh=Mf,Mb=Me,Ub=ua,$1=c_,Vb=dr,K1=Zy,DI=id,ev=ur,m_=sh&&sh.prototype,tv=Vb("species"),Fb=Mb(Uf.PromiseRejectionEvent),jb=Ub("Promise",function(){var e=$1(sh),r=e!==String(sh);if(!r&&ev===66||!m_.catch||!m_.finally)return!0;if(!ev||ev<51||!/native code/.test(e)){var o=new sh(function(c){c(1)}),s=function(c){c(function(){},function(){})};if((o.constructor={})[tv]=s,!(o.then(function(){})instanceof s))return!0}return!r&&(K1||DI)&&!Fb}),g_={CONSTRUCTOR:jb,REJECTION_EVENT:Fb},fl={},nv=uo,rv=TypeError,Bb=function(e){var r,o;this.promise=new e(function(s,c){if(r!==void 0||o!==void 0)throw rv("Bad Promise constructor");r=s,o=c}),this.resolve=nv(r),this.reject=nv(o)};fl.f=function(e){return new Bb(e)};var vm,Wb,q1=xn,Vf=Ef,ah=j,od=ye,Y1=ed,iv=td,f=function(e){var r=W1(e);gs&&r&&!r[SI]&&Dy(r,SI,{configurable:!0,get:function(){return this}})},g=uo,T=Me,O=yt,M=s_,G=Xi,ae=Ky.set,Ie=Qa,xe=function(e,r){try{arguments.length==1?console.error(e):console.error(e,r)}catch{}},it=oh,At=Db,Pt=Zu,Ct=Mf,Gt=g_,en=fl,tn="Promise",Ji=Gt.CONSTRUCTOR,Je=Gt.REJECTION_EVENT,Ve=Pt.getterFor(tn),Ze=Pt.set,Nt=Ct&&Ct.prototype,nn=Ct,pn=Nt,yn=ah.TypeError,On=ah.document,Eo=ah.process,yr=en.f,ch=yr,X1=!!(On&&On.createEvent&&ah.dispatchEvent),W4="unhandledrejection",z4=function(e){var r;return!(!O(e)||!T(r=e.then))&&r},G4=function(e,r){var o,s,c,u=r.value,h=r.state==1,m=h?e.ok:e.fail,_=e.resolve,y=e.reject,S=e.domain;try{m?(h||(r.rejection===2&&ase(r),r.rejection=1),m===!0?o=u:(S&&S.enter(),o=m(u),S&&(S.exit(),c=!0)),o===e.promise?y(yn("Promise-chain cycle")):(s=z4(o))?od(s,o,_,y):_(o)):y(u)}catch(R){S&&!c&&S.exit(),y(R)}},H4=function(e,r){e.notified||(e.notified=!0,Ie(function(){for(var o,s=e.reactions;o=s.get();)G4(o,e);e.notified=!1,r&&!e.rejection&&sse(e)}))},$4=function(e,r,o){var s,c;X1?((s=On.createEvent("Event")).promise=r,s.reason=o,s.initEvent(e,!1,!0),ah.dispatchEvent(s)):s={promise:r,reason:o},!Je&&(c=ah["on"+e])?c(s):e===W4&&xe("Unhandled promise rejection",o)},sse=function(e){od(ae,ah,function(){var r,o=e.facade,s=e.value;if(K4(e)&&(r=it(function(){Vf?Eo.emit("unhandledRejection",s,o):$4(W4,o,s)}),e.rejection=Vf||K4(e)?2:1,r.error))throw r.value})},K4=function(e){return e.rejection!==1&&!e.parent},ase=function(e){od(ae,ah,function(){var r=e.facade;Vf?Eo.emit("rejectionHandled",r):$4("rejectionhandled",r,e.value)})},ov=function(e,r,o){return function(s){e(r,s,o)}},sv=function(e,r,o){e.done||(e.done=!0,o&&(e=o),e.value=r,e.state=2,H4(e,!0))},J1=function(e,r,o){if(!e.done){e.done=!0,o&&(e=o);try{if(e.facade===r)throw yn("Promise can't be resolved itself");var s=z4(r);s?Ie(function(){var c={done:!1};try{od(s,r,ov(J1,c,e),ov(sv,c,e))}catch(u){sv(c,u,e)}}):(e.value=r,e.state=1,H4(e,!1))}catch(c){sv({done:!1},c,e)}}};Ji&&(pn=(nn=function(e){M(this,pn),g(e),od(vm,this);var r=Ve(this);try{e(ov(J1,r),ov(sv,r))}catch(o){sv(r,o)}}).prototype,(vm=function(e){Ze(this,{type:tn,done:!1,notified:!1,parent:!1,reactions:new At,rejection:!1,state:0,value:void 0})}).prototype=Y1(pn,"then",function(e,r){var o=Ve(this),s=yr(G(this,nn));return o.parent=!0,s.ok=!T(e)||e,s.fail=T(r)&&r,s.domain=Vf?Eo.domain:void 0,o.state==0?o.reactions.add(s):Ie(function(){G4(s,o)}),s.promise}),Wb=function(){var e=new vm,r=Ve(e);this.promise=e,this.resolve=ov(J1,r),this.reject=ov(sv,r)},en.f=yr=function(e){return e===nn||e===void 0?new Wb(e):ch(e)}),q1({global:!0,wrap:!0,forced:Ji},{Promise:nn}),iv(nn,tn,!1,!0),f(tn);var q4=dr("iterator"),Y4=!1;try{var cse=0,X4={next:function(){return{done:!!cse++}},return:function(){Y4=!0}};X4[q4]=function(){return this},Array.from(X4,function(){throw 2})}catch{}var lse=Mf,use=function(e,r){if(!Y4)return!1;var o=!1;try{var s={};s[q4]=function(){return{next:function(){return{done:o=!0}}}},e(s)}catch{}return o},LI=g_.CONSTRUCTOR||!use(function(e){lse.all(e).then(void 0,function(){})}),dse=ye,hse=uo,fse=fl,pse=oh,mse=eh;xn({target:"Promise",stat:!0,forced:LI},{all:function(e){var r=this,o=fse.f(r),s=o.resolve,c=o.reject,u=pse(function(){var h=hse(r.resolve),m=[],_=0,y=1;mse(e,function(S){var R=_++,P=!1;y++,dse(h,r,S).then(function(k){P||(P=!0,m[R]=k,--y||s(m))},c)}),--y||s(m)});return u.error&&c(u.value),o.promise}});var gse=xn,_se=g_.CONSTRUCTOR;Mf&&Mf.prototype,gse({target:"Promise",proto:!0,forced:_se,real:!0},{catch:function(e){return this.then(void 0,e)}});var Ese=ye,yse=uo,vse=fl,Sse=oh,bse=eh;xn({target:"Promise",stat:!0,forced:LI},{race:function(e){var r=this,o=vse.f(r),s=o.reject,c=Sse(function(){var u=yse(r.resolve);bse(e,function(h){Ese(u,r,h).then(o.resolve,s)})});return c.error&&s(c.value),o.promise}});var Tse=ye,wse=fl;xn({target:"Promise",stat:!0,forced:g_.CONSTRUCTOR},{reject:function(e){var r=wse.f(this);return Tse(r.reject,void 0,e),r.promise}});var Rse=cn,Cse=yt,Ise=fl,J4=function(e,r){if(Rse(e),Cse(r)&&r.constructor===e)return r;var o=Ise.f(e);return(0,o.resolve)(r),o.promise},Ase=xn,Pse=Mf,Ose=g_.CONSTRUCTOR,kse=J4,Nse=an("Promise"),Dse=!Ose;Ase({target:"Promise",stat:!0,forced:!0},{resolve:function(e){return kse(Dse&&this===Nse?Pse:this,e)}});var Lse=ye,xse=uo,Mse=fl,Use=oh,Vse=eh;xn({target:"Promise",stat:!0,forced:LI},{allSettled:function(e){var r=this,o=Mse.f(r),s=o.resolve,c=o.reject,u=Use(function(){var h=xse(r.resolve),m=[],_=0,y=1;Vse(e,function(S){var R=_++,P=!1;y++,Lse(h,r,S).then(function(k){P||(P=!0,m[R]={status:"fulfilled",value:k},--y||s(m))},function(k){P||(P=!0,m[R]={status:"rejected",reason:k},--y||s(m))})}),--y||s(m)});return u.error&&c(u.value),o.promise}});var Fse=ye,jse=uo,Bse=an,Wse=fl,zse=oh,Gse=eh,Q4="No one promise resolved";xn({target:"Promise",stat:!0,forced:LI},{any:function(e){var r=this,o=Bse("AggregateError"),s=Wse.f(r),c=s.resolve,u=s.reject,h=zse(function(){var m=jse(r.resolve),_=[],y=0,S=1,R=!1;Gse(e,function(P){var k=y++,z=!1;S++,Fse(m,r,P).then(function(U){z||R||(R=!0,c(U))},function(U){z||R||(z=!0,_[k]=U,--S||u(new o(_,Q4)))})}),--S||u(new o(_,Q4))});return h.error&&u(h.value),s.promise}});var Hse=xn,Q1=Mf,$se=d,Kse=an,qse=Me,Yse=Xi,Z4=J4,Xse=Q1&&Q1.prototype;Hse({target:"Promise",proto:!0,real:!0,forced:!!Q1&&$se(function(){Xse.finally.call({then:function(){}},function(){})})},{finally:function(e){var r=Yse(this,Kse("Promise")),o=qse(e);return this.then(o?function(s){return Z4(r,e()).then(function(){return s})}:e,o?function(s){return Z4(r,e()).then(function(){throw s})}:e)}});var Z1=A,Jse=_c,Qse=ha,Zse=Xt,eae=Z1("".charAt),e3=Z1("".charCodeAt),tae=Z1("".slice),t3=function(e){return function(r,o){var s,c,u=Qse(Zse(r)),h=Jse(o),m=u.length;return h<0||h>=m?e?"":void 0:(s=e3(u,h))<55296||s>56319||h+1===m||(c=e3(u,h+1))<56320||c>57343?e?eae(u,h):s:e?tae(u,h,h+2):c-56320+(s-55296<<10)+65536}},eD={codeAt:t3(!1),charAt:t3(!0)},nae=eD.charAt,rae=ha,n3=Zu,iae=Ay,r3=Py,i3="String Iterator",oae=n3.set,sae=n3.getterFor(i3);iae(String,"String",function(e){oae(this,{type:i3,string:rae(e),index:0})},function(){var e,r=sae(this),o=r.string,s=r.index;return s>=o.length?r3(void 0,!0):(e=nae(o,s),r.index+=e.length,r3(e,!1))});var aae=St.Promise,cae={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},lae=j,uae=Ec,dae=Us,o3=Jd,s3=dr("toStringTag");for(var tD in cae){var a3=lae[tD],nD=a3&&a3.prototype;nD&&uae(nD)!==s3&&dae(nD,s3,tD),o3[tD]=o3.Array}var c3=aae,lt=l(c3),hae=Ka("Array").values,fae=Ec,pae=pi,mae=N,gae=hae,rD=Array.prototype,_ae={DOMTokenList:!0,NodeList:!0},Eae=function(e){var r=e.values;return e===rD||mae(rD,e)&&r===rD.values||pae(_ae,fae(e))?gae:r},Pc=l(Eae),yae=d,vae=dr("iterator"),iD=!yae(function(){var e=new URL("b?a=1&b=2&c=3","http://a"),r=e.searchParams,o=new URLSearchParams("a=1&a=2"),s="";return e.pathname="c%20d",r.forEach(function(c,u){r.delete("b"),s+=u+c}),o.delete("a",2),!e.toJSON||!o.has("a",1)||o.has("a",2)||!r.size&&!0||!r.sort||e.href!=="http://a/c%20d?a=1&c=3"||r.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!r[vae]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("http://").host!=="xn--e1aybc"||new URL("http://a#").hash!=="#%D0%B1"||s!=="a1c3"||new URL("http://x",void 0).host!=="x"}),Sae=ed,bae=Ha,Tae=tt,wae=et,xI=function(e,r,o){var s=bae(r);s in e?Tae.f(e,s,wae(0,o)):e[s]=o},l3=pe,Rae=oi,Cae=xI,Iae=Array,Aae=Math.max,oD=function(e,r,o){for(var s=Rae(e),c=l3(r,s),u=l3(o===void 0?s:o,s),h=Iae(Aae(u-c,0)),m=0;c<u;c++,m++)Cae(h,m,e[c]);return h.length=m,h},u3=oD,Pae=Math.floor,sD=function(e,r){var o=e.length,s=Pae(o/2);return o<8?Oae(e,r):kae(e,sD(u3(e,0,s),r),sD(u3(e,s),r),r)},Oae=function(e,r){for(var o,s,c=e.length,u=1;u<c;){for(s=u,o=e[u];s&&r(e[s-1],o)>0;)e[s]=e[--s];s!==u++&&(e[s]=o)}return e},kae=function(e,r,o,s){for(var c=r.length,u=o.length,h=0,m=0;h<c||m<u;)e[h+m]=h<c&&m<u?s(r[h],o[m])<=0?r[h++]:o[m++]:h<c?r[h++]:o[m++];return e},d3=sD,aD=xn,av=j,MI=ye,lh=A,cv=rt,h3=iD,f3=ed,Nae=Ny,Dae=function(e,r,o){for(var s in r)o&&o.unsafe&&e[s]?e[s]=r[s]:Sae(e,s,r[s],o);return e},Lae=td,xae=wy,cD=Zu,p3=s_,lD=Me,Mae=pi,Uae=De,Vae=Ec,Fae=cn,m3=yt,Za=ha,jae=js,g3=et,uD=Jg,Bae=Ju,lv=hl,Wae=d3,zae=dr("iterator"),zb="URLSearchParams",_3=zb+"Iterator",E3=cD.set,tu=cD.getterFor(zb),Gae=cD.getterFor(_3),Hae=Object.getOwnPropertyDescriptor,dD=function(e){if(!cv)return av[e];var r=Hae(av,e);return r&&r.value},y3=dD("fetch"),UI=dD("Request"),Gb=dD("Headers"),hD=UI&&UI.prototype,v3=Gb&&Gb.prototype,$ae=av.RegExp,Kae=av.TypeError,S3=av.decodeURIComponent,qae=av.encodeURIComponent,Yae=lh("".charAt),b3=lh([].join),__=lh([].push),fD=lh("".replace),Xae=lh([].shift),T3=lh([].splice),w3=lh("".split),Jae=lh("".slice),Qae=/\+/g,R3=Array(4),Zae=function(e){return R3[e-1]||(R3[e-1]=$ae("((?:%[\\da-f]{2}){"+e+"})","gi"))},ece=function(e){try{return S3(e)}catch{return e}},C3=function(e){var r=fD(e,Qae," "),o=4;try{return S3(r)}catch{for(;o;)r=fD(r,Zae(o--),ece);return r}},tce=/[!'()~]|%20/g,nce={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},rce=function(e){return nce[e]},I3=function(e){return fD(qae(e),tce,rce)},pD=xae(function(e,r){E3(this,{type:_3,iterator:uD(tu(e).entries),kind:r})},"Iterator",function(){var e=Gae(this),r=e.kind,o=e.iterator.next(),s=o.value;return o.done||(o.value=r==="keys"?s.key:r==="values"?s.value:[s.key,s.value]),o},!0),A3=function(e){this.entries=[],this.url=null,e!==void 0&&(m3(e)?this.parseObject(e):this.parseQuery(typeof e=="string"?Yae(e,0)==="?"?Jae(e,1):e:Za(e)))};A3.prototype={type:zb,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var r,o,s,c,u,h,m,_=Bae(e);if(_)for(o=(r=uD(e,_)).next;!(s=MI(o,r)).done;){if(u=(c=uD(Fae(s.value))).next,(h=MI(u,c)).done||(m=MI(u,c)).done||!MI(u,c).done)throw Kae("Expected sequence with length 2");__(this.entries,{key:Za(h.value),value:Za(m.value)})}else for(var y in e)Mae(e,y)&&__(this.entries,{key:y,value:Za(e[y])})},parseQuery:function(e){if(e)for(var r,o,s=w3(e,"&"),c=0;c<s.length;)(r=s[c++]).length&&(o=w3(r,"="),__(this.entries,{key:C3(Xae(o)),value:C3(b3(o,"="))}))},serialize:function(){for(var e,r=this.entries,o=[],s=0;s<r.length;)e=r[s++],__(o,I3(e.key)+"="+I3(e.value));return b3(o,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var VI=function(){p3(this,uv);var e=E3(this,new A3(arguments.length>0?arguments[0]:void 0));cv||(this.size=e.entries.length)},uv=VI.prototype;if(Dae(uv,{append:function(e,r){var o=tu(this);lv(arguments.length,2),__(o.entries,{key:Za(e),value:Za(r)}),cv||this.length++,o.updateURL()},delete:function(e){for(var r=tu(this),o=lv(arguments.length,1),s=r.entries,c=Za(e),u=o<2?void 0:arguments[1],h=u===void 0?u:Za(u),m=0;m<s.length;){var _=s[m];if(_.key!==c||h!==void 0&&_.value!==h)m++;else if(T3(s,m,1),h!==void 0)break}cv||(this.size=s.length),r.updateURL()},get:function(e){var r=tu(this).entries;lv(arguments.length,1);for(var o=Za(e),s=0;s<r.length;s++)if(r[s].key===o)return r[s].value;return null},getAll:function(e){var r=tu(this).entries;lv(arguments.length,1);for(var o=Za(e),s=[],c=0;c<r.length;c++)r[c].key===o&&__(s,r[c].value);return s},has:function(e){for(var r=tu(this).entries,o=lv(arguments.length,1),s=Za(e),c=o<2?void 0:arguments[1],u=c===void 0?c:Za(c),h=0;h<r.length;){var m=r[h++];if(m.key===s&&(u===void 0||m.value===u))return!0}return!1},set:function(e,r){var o=tu(this);lv(arguments.length,1);for(var s,c=o.entries,u=!1,h=Za(e),m=Za(r),_=0;_<c.length;_++)(s=c[_]).key===h&&(u?T3(c,_--,1):(u=!0,s.value=m));u||__(c,{key:h,value:m}),cv||(this.size=c.length),o.updateURL()},sort:function(){var e=tu(this);Wae(e.entries,function(r,o){return r.key>o.key?1:-1}),e.updateURL()},forEach:function(e){for(var r,o=tu(this).entries,s=Uae(e,arguments.length>1?arguments[1]:void 0),c=0;c<o.length;)s((r=o[c++]).value,r.key,this)},keys:function(){return new pD(this,"keys")},values:function(){return new pD(this,"values")},entries:function(){return new pD(this,"entries")}},{enumerable:!0}),f3(uv,zae,uv.entries,{}),f3(uv,"toString",function(){return tu(this).serialize()},{enumerable:!0}),cv&&Nae(uv,"size",{get:function(){return tu(this).entries.length},configurable:!0,enumerable:!0}),Lae(VI,zb),aD({global:!0,forced:!h3},{URLSearchParams:VI}),!h3&&lD(Gb)){var ice=lh(v3.has),oce=lh(v3.set),P3=function(e){if(m3(e)){var r,o=e.body;if(Vae(o)===zb)return r=e.headers?new Gb(e.headers):new Gb,ice(r,"content-type")||oce(r,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),jae(e,{body:g3(0,Za(o)),headers:g3(0,r)})}return e};if(lD(y3)&&aD({global:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return y3(e,arguments.length>1?P3(arguments[1]):{})}}),lD(UI)){var mD=function(e){return p3(this,hD),new UI(e,arguments.length>1?P3(arguments[1]):{})};hD.constructor=mD,mD.prototype=hD,aD({global:!0,dontCallGetSet:!0,forced:!0},{Request:mD})}}var nu,sce={URLSearchParams:VI,getState:tu},ace=St.URLSearchParams,O3=rt,cce=A,lce=ye,uce=d,gD=Sc,dce=vc,hce=Ne,fce=As,pce=hn,dv=Object.assign,k3=Object.defineProperty,mce=cce([].concat),gce=!dv||uce(function(){if(O3&&dv({b:1},dv(k3({},"a",{enumerable:!0,get:function(){k3(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var e={},r={},o=Symbol(),s="abcdefghijklmnopqrst";return e[o]=7,s.split("").forEach(function(c){r[c]=c}),dv({},e)[o]!=7||gD(dv({},r)).join("")!=s})?function(e,r){for(var o=fce(e),s=arguments.length,c=1,u=dce.f,h=hce.f;s>c;)for(var m,_=pce(arguments[c++]),y=u?mce(gD(_),u(_)):gD(_),S=y.length,R=0;S>R;)m=y[R++],O3&&!lce(h,_,m)||(o[m]=_[m]);return o}:dv,_ce=cn,Ece=Qg,yce=De,vce=ye,Sce=As,bce=function(e,r,o,s){try{return s?r(_ce(o)[0],o[1]):r(o)}catch(c){Ece(e,"throw",c)}},Tce=Xg,wce=l_,Rce=oi,N3=xI,Cce=Jg,Ice=Ju,D3=Array,E_=A,_D=2147483647,Ace=/[^\0-\u007E]/,L3=/[.\u3002\uFF0E\uFF61]/g,x3="Overflow: input needs wider integers to process",M3=RangeError,Pce=E_(L3.exec),hv=Math.floor,ED=String.fromCharCode,U3=E_("".charCodeAt),V3=E_([].join),Sm=E_([].push),Oce=E_("".replace),kce=E_("".split),Nce=E_("".toLowerCase),F3=function(e){return e+22+75*(e<26)},Dce=function(e,r,o){var s=0;for(e=o?hv(e/700):e>>1,e+=hv(e/r);e>455;)e=hv(e/35),s+=36;return hv(s+36*e/(e+38))},Lce=function(e){var r=[];e=function(q){for(var Y=[],ce=0,_e=q.length;ce<_e;){var Ee=U3(q,ce++);if(Ee>=55296&&Ee<=56319&&ce<_e){var me=U3(q,ce++);(64512&me)==56320?Sm(Y,((1023&Ee)<<10)+(1023&me)+65536):(Sm(Y,Ee),ce--)}else Sm(Y,Ee)}return Y}(e);var o,s,c=e.length,u=128,h=0,m=72;for(o=0;o<e.length;o++)(s=e[o])<128&&Sm(r,ED(s));var _=r.length,y=_;for(_&&Sm(r,"-");y<c;){var S=_D;for(o=0;o<e.length;o++)(s=e[o])>=u&&s<S&&(S=s);var R=y+1;if(S-u>hv((_D-h)/R))throw M3(x3);for(h+=(S-u)*R,u=S,o=0;o<e.length;o++){if((s=e[o])<u&&++h>_D)throw M3(x3);if(s==u){for(var P=h,k=36;;){var z=k<=m?1:k>=m+26?26:k-m;if(P<z)break;var U=P-z,V=36-z;Sm(r,ED(F3(z+U%V))),P=hv(U/V),k+=36}Sm(r,ED(F3(P))),m=Dce(h,R,y==_),h=0,y++}}h++,u++}return V3(r,"")},xce=xn,yD=rt,Mce=iD,vD=j,j3=De,ru=A,FI=ed,iu=Ny,Uce=s_,SD=pi,bD=gce,fv=function(e){var r=Sce(e),o=wce(this),s=arguments.length,c=s>1?arguments[1]:void 0,u=c!==void 0;u&&(c=yce(c,s>2?arguments[2]:void 0));var h,m,_,y,S,R,P=Ice(r),k=0;if(!P||this===D3&&Tce(P))for(h=Rce(r),m=o?new this(h):D3(h);h>k;k++)R=u?c(r[k],k):r[k],N3(m,k,R);else for(S=(y=Cce(r,P)).next,m=o?new this:[];!(_=vce(S,y)).done;k++)R=u?bce(y,c,[_.value,k],!0):_.value,N3(m,k,R);return m.length=k,m},sd=oD,Vce=eD.codeAt,Fce=function(e){var r,o,s=[],c=kce(Oce(Nce(e),L3,"."),".");for(r=0;r<c.length;r++)o=c[r],Sm(s,Pce(Ace,o)?"xn--"+Lce(o):o);return V3(s,".")},Ff=ha,jce=td,Bce=hl,B3=sce,W3=Zu,Wce=W3.set,jI=W3.getterFor("URL"),zce=B3.URLSearchParams,Gce=B3.getState,Hb=vD.URL,TD=vD.TypeError,BI=vD.parseInt,Hce=Math.floor,z3=Math.pow,ou=ru("".charAt),ad=ru(/./.exec),$b=ru([].join),$ce=ru(1 .toString),Kce=ru([].pop),pv=ru([].push),wD=ru("".replace),qce=ru([].shift),Yce=ru("".split),Kb=ru("".slice),WI=ru("".toLowerCase),Xce=ru([].unshift),RD="Invalid scheme",y_="Invalid host",G3="Invalid port",H3=/[a-z]/i,Jce=/[\d+-.a-z]/i,CD=/\d/,Qce=/^0x/i,Zce=/^[0-7]+$/,ele=/^\d+$/,$3=/^[\da-f]+$/i,tle=/[\0\t\n\r #%/:<>?@[\\\]^|]/,nle=/[\0\t\n\r #/:<>?@[\\\]^|]/,rle=/^[\u0000-\u0020]+/,ile=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,ole=/[\t\n\r]/g,qb=function(e){var r,o,s,c;if(typeof e=="number"){for(r=[],o=0;o<4;o++)Xce(r,e%256),e=Hce(e/256);return $b(r,".")}if(typeof e=="object"){for(r="",s=function(u){for(var h=null,m=1,_=null,y=0,S=0;S<8;S++)u[S]!==0?(y>m&&(h=_,m=y),_=null,y=0):(_===null&&(_=S),++y);return y>m&&(h=_,m=y),h}(e),o=0;o<8;o++)c&&e[o]===0||(c&&(c=!1),s===o?(r+=o?":":"::",c=!0):(r+=$ce(e[o],16),o<7&&(r+=":")));return"["+r+"]"}return e},zI={},K3=bD({},zI,{" ":1,'"':1,"<":1,">":1,"`":1}),q3=bD({},K3,{"#":1,"?":1,"{":1,"}":1}),ID=bD({},q3,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),bm=function(e,r){var o=Vce(e,0);return o>32&&o<127&&!SD(r,e)?e:encodeURIComponent(e)},GI={ftp:21,file:null,http:80,https:443,ws:80,wss:443},Yb=function(e,r){var o;return e.length==2&&ad(H3,ou(e,0))&&((o=ou(e,1))==":"||!r&&o=="|")},Y3=function(e){var r;return e.length>1&&Yb(Kb(e,0,2))&&(e.length==2||(r=ou(e,2))==="/"||r==="\\"||r==="?"||r==="#")},sle=function(e){return e==="."||WI(e)==="%2e"},AD={},X3={},PD={},J3={},Q3={},OD={},Z3={},eB={},HI={},$I={},kD={},ND={},DD={},LD={},tB={},xD={},mv={},uh={},nB={},v_={},jf={},MD=function(e,r,o){var s,c,u,h=Ff(e);if(r){if(c=this.parse(h))throw TD(c);this.searchParams=null}else{if(o!==void 0&&(s=new MD(o,!0)),c=this.parse(h,null,s))throw TD(c);(u=Gce(new zce)).bindURL(this),this.searchParams=u}};MD.prototype={type:"URL",parse:function(e,r,o){var s,c,u,h,m,_=this,y=r||AD,S=0,R="",P=!1,k=!1,z=!1;for(e=Ff(e),r||(_.scheme="",_.username="",_.password="",_.host=null,_.port=null,_.path=[],_.query=null,_.fragment=null,_.cannotBeABaseURL=!1,e=wD(e,rle,""),e=wD(e,ile,"$1")),e=wD(e,ole,""),s=fv(e);S<=s.length;){switch(c=s[S],y){case AD:if(!c||!ad(H3,c)){if(r)return RD;y=PD;continue}R+=WI(c),y=X3;break;case X3:if(c&&(ad(Jce,c)||c=="+"||c=="-"||c=="."))R+=WI(c);else{if(c!=":"){if(r)return RD;R="",y=PD,S=0;continue}if(r&&(_.isSpecial()!=SD(GI,R)||R=="file"&&(_.includesCredentials()||_.port!==null)||_.scheme=="file"&&!_.host))return;if(_.scheme=R,r)return void(_.isSpecial()&&GI[_.scheme]==_.port&&(_.port=null));R="",_.scheme=="file"?y=LD:_.isSpecial()&&o&&o.scheme==_.scheme?y=J3:_.isSpecial()?y=eB:s[S+1]=="/"?(y=Q3,S++):(_.cannotBeABaseURL=!0,pv(_.path,""),y=nB)}break;case PD:if(!o||o.cannotBeABaseURL&&c!="#")return RD;if(o.cannotBeABaseURL&&c=="#"){_.scheme=o.scheme,_.path=sd(o.path),_.query=o.query,_.fragment="",_.cannotBeABaseURL=!0,y=jf;break}y=o.scheme=="file"?LD:OD;continue;case J3:if(c!="/"||s[S+1]!="/"){y=OD;continue}y=HI,S++;break;case Q3:if(c=="/"){y=$I;break}y=uh;continue;case OD:if(_.scheme=o.scheme,c==nu)_.username=o.username,_.password=o.password,_.host=o.host,_.port=o.port,_.path=sd(o.path),_.query=o.query;else if(c=="/"||c=="\\"&&_.isSpecial())y=Z3;else if(c=="?")_.username=o.username,_.password=o.password,_.host=o.host,_.port=o.port,_.path=sd(o.path),_.query="",y=v_;else{if(c!="#"){_.username=o.username,_.password=o.password,_.host=o.host,_.port=o.port,_.path=sd(o.path),_.path.length--,y=uh;continue}_.username=o.username,_.password=o.password,_.host=o.host,_.port=o.port,_.path=sd(o.path),_.query=o.query,_.fragment="",y=jf}break;case Z3:if(!_.isSpecial()||c!="/"&&c!="\\"){if(c!="/"){_.username=o.username,_.password=o.password,_.host=o.host,_.port=o.port,y=uh;continue}y=$I}else y=HI;break;case eB:if(y=HI,c!="/"||ou(R,S+1)!="/")continue;S++;break;case HI:if(c!="/"&&c!="\\"){y=$I;continue}break;case $I:if(c=="@"){P&&(R="%40"+R),P=!0,u=fv(R);for(var U=0;U<u.length;U++){var V=u[U];if(V!=":"||z){var q=bm(V,ID);z?_.password+=q:_.username+=q}else z=!0}R=""}else if(c==nu||c=="/"||c=="?"||c=="#"||c=="\\"&&_.isSpecial()){if(P&&R=="")return"Invalid authority";S-=fv(R).length+1,R="",y=kD}else R+=c;break;case kD:case ND:if(r&&_.scheme=="file"){y=xD;continue}if(c!=":"||k){if(c==nu||c=="/"||c=="?"||c=="#"||c=="\\"&&_.isSpecial()){if(_.isSpecial()&&R=="")return y_;if(r&&R==""&&(_.includesCredentials()||_.port!==null))return;if(h=_.parseHost(R))return h;if(R="",y=mv,r)return;continue}c=="["?k=!0:c=="]"&&(k=!1),R+=c}else{if(R=="")return y_;if(h=_.parseHost(R))return h;if(R="",y=DD,r==ND)return}break;case DD:if(!ad(CD,c)){if(c==nu||c=="/"||c=="?"||c=="#"||c=="\\"&&_.isSpecial()||r){if(R!=""){var Y=BI(R,10);if(Y>65535)return G3;_.port=_.isSpecial()&&Y===GI[_.scheme]?null:Y,R=""}if(r)return;y=mv;continue}return G3}R+=c;break;case LD:if(_.scheme="file",c=="/"||c=="\\")y=tB;else{if(!o||o.scheme!="file"){y=uh;continue}if(c==nu)_.host=o.host,_.path=sd(o.path),_.query=o.query;else if(c=="?")_.host=o.host,_.path=sd(o.path),_.query="",y=v_;else{if(c!="#"){Y3($b(sd(s,S),""))||(_.host=o.host,_.path=sd(o.path),_.shortenPath()),y=uh;continue}_.host=o.host,_.path=sd(o.path),_.query=o.query,_.fragment="",y=jf}}break;case tB:if(c=="/"||c=="\\"){y=xD;break}o&&o.scheme=="file"&&!Y3($b(sd(s,S),""))&&(Yb(o.path[0],!0)?pv(_.path,o.path[0]):_.host=o.host),y=uh;continue;case xD:if(c==nu||c=="/"||c=="\\"||c=="?"||c=="#"){if(!r&&Yb(R))y=uh;else if(R==""){if(_.host="",r)return;y=mv}else{if(h=_.parseHost(R))return h;if(_.host=="localhost"&&(_.host=""),r)return;R="",y=mv}continue}R+=c;break;case mv:if(_.isSpecial()){if(y=uh,c!="/"&&c!="\\")continue}else if(r||c!="?")if(r||c!="#"){if(c!=nu&&(y=uh,c!="/"))continue}else _.fragment="",y=jf;else _.query="",y=v_;break;case uh:if(c==nu||c=="/"||c=="\\"&&_.isSpecial()||!r&&(c=="?"||c=="#")){if((m=WI(m=R))===".."||m==="%2e."||m===".%2e"||m==="%2e%2e"?(_.shortenPath(),c=="/"||c=="\\"&&_.isSpecial()||pv(_.path,"")):sle(R)?c=="/"||c=="\\"&&_.isSpecial()||pv(_.path,""):(_.scheme=="file"&&!_.path.length&&Yb(R)&&(_.host&&(_.host=""),R=ou(R,0)+":"),pv(_.path,R)),R="",_.scheme=="file"&&(c==nu||c=="?"||c=="#"))for(;_.path.length>1&&_.path[0]==="";)qce(_.path);c=="?"?(_.query="",y=v_):c=="#"&&(_.fragment="",y=jf)}else R+=bm(c,q3);break;case nB:c=="?"?(_.query="",y=v_):c=="#"?(_.fragment="",y=jf):c!=nu&&(_.path[0]+=bm(c,zI));break;case v_:r||c!="#"?c!=nu&&(c=="'"&&_.isSpecial()?_.query+="%27":_.query+=c=="#"?"%23":bm(c,zI)):(_.fragment="",y=jf);break;case jf:c!=nu&&(_.fragment+=bm(c,K3))}S++}},parseHost:function(e){var r,o,s;if(ou(e,0)=="["){if(ou(e,e.length-1)!="]"||(r=function(c){var u,h,m,_,y,S,R,P=[0,0,0,0,0,0,0,0],k=0,z=null,U=0,V=function(){return ou(c,U)};if(V()==":"){if(ou(c,1)!=":")return;U+=2,z=++k}for(;V();){if(k==8)return;if(V()!=":"){for(u=h=0;h<4&&ad($3,V());)u=16*u+BI(V(),16),U++,h++;if(V()=="."){if(h==0||(U-=h,k>6))return;for(m=0;V();){if(_=null,m>0){if(!(V()=="."&&m<4))return;U++}if(!ad(CD,V()))return;for(;ad(CD,V());){if(y=BI(V(),10),_===null)_=y;else{if(_==0)return;_=10*_+y}if(_>255)return;U++}P[k]=256*P[k]+_,++m!=2&&m!=4||k++}if(m!=4)return;break}if(V()==":"){if(U++,!V())return}else if(V())return;P[k++]=u}else{if(z!==null)return;U++,z=++k}}if(z!==null)for(S=k-z,k=7;k!=0&&S>0;)R=P[k],P[k--]=P[z+S-1],P[z+--S]=R;else if(k!=8)return;return P}(Kb(e,1,-1)),!r))return y_;this.host=r}else if(this.isSpecial()){if(e=Fce(e),ad(tle,e)||(r=function(c){var u,h,m,_,y,S,R,P=Yce(c,".");if(P.length&&P[P.length-1]==""&&P.length--,(u=P.length)>4)return c;for(h=[],m=0;m<u;m++){if((_=P[m])=="")return c;if(y=10,_.length>1&&ou(_,0)=="0"&&(y=ad(Qce,_)?16:8,_=Kb(_,y==8?1:2)),_==="")S=0;else{if(!ad(y==10?ele:y==8?Zce:$3,_))return c;S=BI(_,y)}pv(h,S)}for(m=0;m<u;m++)if(S=h[m],m==u-1){if(S>=z3(256,5-u))return null}else if(S>255)return null;for(R=Kce(h),m=0;m<h.length;m++)R+=h[m]*z3(256,3-m);return R}(e),r===null))return y_;this.host=r}else{if(ad(nle,e))return y_;for(r="",o=fv(e),s=0;s<o.length;s++)r+=bm(o[s],zI);this.host=r}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme=="file"},includesCredentials:function(){return this.username!=""||this.password!=""},isSpecial:function(){return SD(GI,this.scheme)},shortenPath:function(){var e=this.path,r=e.length;!r||this.scheme=="file"&&r==1&&Yb(e[0],!0)||e.length--},serialize:function(){var e=this,r=e.scheme,o=e.username,s=e.password,c=e.host,u=e.port,h=e.path,m=e.query,_=e.fragment,y=r+":";return c!==null?(y+="//",e.includesCredentials()&&(y+=o+(s?":"+s:"")+"@"),y+=qb(c),u!==null&&(y+=":"+u)):r=="file"&&(y+="//"),y+=e.cannotBeABaseURL?h[0]:h.length?"/"+$b(h,"/"):"",m!==null&&(y+="?"+m),_!==null&&(y+="#"+_),y},setHref:function(e){var r=this.parse(e);if(r)throw TD(r);this.searchParams.update()},getOrigin:function(){var e=this.scheme,r=this.port;if(e=="blob")try{return new gv(e.path[0]).origin}catch{return"null"}return e!="file"&&this.isSpecial()?e+"://"+qb(this.host)+(r!==null?":"+r:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(Ff(e)+":",AD)},getUsername:function(){return this.username},setUsername:function(e){var r=fv(Ff(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var o=0;o<r.length;o++)this.username+=bm(r[o],ID)}},getPassword:function(){return this.password},setPassword:function(e){var r=fv(Ff(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var o=0;o<r.length;o++)this.password+=bm(r[o],ID)}},getHost:function(){var e=this.host,r=this.port;return e===null?"":r===null?qb(e):qb(e)+":"+r},setHost:function(e){this.cannotBeABaseURL||this.parse(e,kD)},getHostname:function(){var e=this.host;return e===null?"":qb(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,ND)},getPort:function(){var e=this.port;return e===null?"":Ff(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||((e=Ff(e))==""?this.port=null:this.parse(e,DD))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+$b(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,mv))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){(e=Ff(e))==""?this.query=null:(ou(e,0)=="?"&&(e=Kb(e,1)),this.query="",this.parse(e,v_)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){(e=Ff(e))!=""?(ou(e,0)=="#"&&(e=Kb(e,1)),this.fragment="",this.parse(e,jf)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var gv=function(e){var r=Uce(this,ec),o=Bce(arguments.length,1)>1?arguments[1]:void 0,s=Wce(r,new MD(e,!1,o));yD||(r.href=s.serialize(),r.origin=s.getOrigin(),r.protocol=s.getProtocol(),r.username=s.getUsername(),r.password=s.getPassword(),r.host=s.getHost(),r.hostname=s.getHostname(),r.port=s.getPort(),r.pathname=s.getPathname(),r.search=s.getSearch(),r.searchParams=s.getSearchParams(),r.hash=s.getHash())},ec=gv.prototype,su=function(e,r){return{get:function(){return jI(this)[e]()},set:r&&function(o){return jI(this)[r](o)},configurable:!0,enumerable:!0}};if(yD&&(iu(ec,"href",su("serialize","setHref")),iu(ec,"origin",su("getOrigin")),iu(ec,"protocol",su("getProtocol","setProtocol")),iu(ec,"username",su("getUsername","setUsername")),iu(ec,"password",su("getPassword","setPassword")),iu(ec,"host",su("getHost","setHost")),iu(ec,"hostname",su("getHostname","setHostname")),iu(ec,"port",su("getPort","setPort")),iu(ec,"pathname",su("getPathname","setPathname")),iu(ec,"search",su("getSearch","setSearch")),iu(ec,"searchParams",su("getSearchParams")),iu(ec,"hash",su("getHash","setHash"))),FI(ec,"toJSON",function(){return jI(this).serialize()},{enumerable:!0}),FI(ec,"toString",function(){return jI(this).serialize()},{enumerable:!0}),Hb){var rB=Hb.createObjectURL,iB=Hb.revokeObjectURL;rB&&FI(gv,"createObjectURL",j3(rB,Hb)),iB&&FI(gv,"revokeObjectURL",j3(iB,Hb))}jce(gv,"URL"),xce({global:!0,forced:!Mce,sham:!yD},{URL:gv});var ale=xn,cle=d,lle=hl,oB=ha,ule=iD,sB=an("URL");ale({target:"URL",stat:!0,forced:!(ule&&cle(function(){sB.canParse()}))},{canParse:function(e){var r=lle(arguments.length,1),o=oB(e),s=r<2||arguments[1]===void 0?void 0:oB(arguments[1]);try{return!!new sB(o,s)}catch{return!1}}});var KI=l(St.URL);let aB=!0,cB=!0;function qI(e,r,o){const s=e.match(r);return s&&s.length>=o&&parseInt(s[o],10)}function S_(e,r,o){if(!e.RTCPeerConnection)return;const s=e.RTCPeerConnection.prototype,c=s.addEventListener;s.addEventListener=function(h,m){if(h!==r)return c.apply(this,arguments);const _=y=>{const S=o(y);S&&(m.handleEvent?m.handleEvent(S):m(S))};return this._eventMap=this._eventMap||{},this._eventMap[r]||(this._eventMap[r]=new Map),this._eventMap[r].set(m,_),c.apply(this,[h,_])};const u=s.removeEventListener;s.removeEventListener=function(h,m){if(h!==r||!this._eventMap||!this._eventMap[r])return u.apply(this,arguments);if(!this._eventMap[r].has(m))return u.apply(this,arguments);const _=this._eventMap[r].get(m);return this._eventMap[r].delete(m),this._eventMap[r].size===0&&delete this._eventMap[r],Object.keys(this._eventMap).length===0&&delete this._eventMap,u.apply(this,[h,_])},Object.defineProperty(s,"on"+r,{get(){return this["_on"+r]},set(h){this["_on"+r]&&(this.removeEventListener(r,this["_on"+r]),delete this["_on"+r]),h&&this.addEventListener(r,this["_on"+r]=h)},enumerable:!0,configurable:!0})}function dle(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(aB=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function hle(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(cB=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function lB(){if(typeof window=="object"){if(aB)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function UD(e,r){cB&&console.warn(e+" is deprecated, please use "+r+" instead.")}function uB(e){return Object.prototype.toString.call(e)==="[object Object]"}function dB(e){var r;return uB(e)?qa(r=Object.keys(e)).call(r,function(o,s){const c=uB(e[s]),u=c?dB(e[s]):e[s],h=c&&!Object.keys(u).length;return u===void 0||h?o:Object.assign(o,{[s]:u})},{}):e}function VD(e,r,o){r&&!o.has(r.id)&&(o.set(r.id,r),Object.keys(r).forEach(s=>{s.endsWith("Id")?VD(e,e.get(r[s]),o):s.endsWith("Ids")&&r[s].forEach(c=>{VD(e,e.get(c),o)})}))}function hB(e,r,o){const s=o?"outbound-rtp":"inbound-rtp",c=new Map;if(r===null)return c;const u=[];return e.forEach(h=>{h.type==="track"&&h.trackIdentifier===r.id&&u.push(h)}),u.forEach(h=>{e.forEach(m=>{m.type===s&&m.trackId===h.id&&VD(e,m,c)})}),c}const fB=lB;function pB(e,r){const o=e&&e.navigator;if(!o.mediaDevices)return;const s=function(h){if(typeof h!="object"||h.mandatory||h.optional)return h;const m={};return Object.keys(h).forEach(_=>{if(_==="require"||_==="advanced"||_==="mediaSource")return;const y=typeof h[_]=="object"?h[_]:{ideal:h[_]};y.exact!==void 0&&typeof y.exact=="number"&&(y.min=y.max=y.exact);const S=function(R,P){return R?R+P.charAt(0).toUpperCase()+P.slice(1):P==="deviceId"?"sourceId":P};if(y.ideal!==void 0){m.optional=m.optional||[];let R={};typeof y.ideal=="number"?(R[S("min",_)]=y.ideal,m.optional.push(R),R={},R[S("max",_)]=y.ideal,m.optional.push(R)):(R[S("",_)]=y.ideal,m.optional.push(R))}y.exact!==void 0&&typeof y.exact!="number"?(m.mandatory=m.mandatory||{},m.mandatory[S("",_)]=y.exact):["min","max"].forEach(R=>{y[R]!==void 0&&(m.mandatory=m.mandatory||{},m.mandatory[S(R,_)]=y[R])})}),h.advanced&&(m.optional=(m.optional||[]).concat(h.advanced)),m},c=function(h,m){if(r.version>=61)return m(h);if((h=JSON.parse(JSON.stringify(h)))&&typeof h.audio=="object"){const _=function(y,S,R){S in y&&!(R in y)&&(y[R]=y[S],delete y[S])};_((h=JSON.parse(JSON.stringify(h))).audio,"autoGainControl","googAutoGainControl"),_(h.audio,"noiseSuppression","googNoiseSuppression"),h.audio=s(h.audio)}if(h&&typeof h.video=="object"){let _=h.video.facingMode;_=_&&(typeof _=="object"?_:{ideal:_});const y=r.version<66;if(_&&(_.exact==="user"||_.exact==="environment"||_.ideal==="user"||_.ideal==="environment")&&(!o.mediaDevices.getSupportedConstraints||!o.mediaDevices.getSupportedConstraints().facingMode||y)){let S;if(delete h.video.facingMode,_.exact==="environment"||_.ideal==="environment"?S=["back","rear"]:_.exact!=="user"&&_.ideal!=="user"||(S=["front"]),S)return o.mediaDevices.enumerateDevices().then(R=>{let P=(R=R.filter(k=>k.kind==="videoinput")).find(k=>S.some(z=>{var U;return st(U=k.label.toLowerCase()).call(U,z)}));return!P&&R.length&&st(S).call(S,"back")&&(P=R[R.length-1]),P&&(h.video.deviceId=_.exact?{exact:P.deviceId}:{ideal:P.deviceId}),h.video=s(h.video),fB("chrome: "+JSON.stringify(h)),m(h)})}h.video=s(h.video)}return fB("chrome: "+JSON.stringify(h)),m(h)},u=function(h){return r.version>=64?h:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[h.name]||h.name,message:h.message,constraint:h.constraint||h.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(o.getUserMedia=(function(h,m,_){c(h,y=>{o.webkitGetUserMedia(y,m,S=>{_&&_(u(S))})})}).bind(o),o.mediaDevices.getUserMedia){const h=o.mediaDevices.getUserMedia.bind(o.mediaDevices);o.mediaDevices.getUserMedia=function(m){return c(m,_=>h(_).then(y=>{if(_.audio&&!y.getAudioTracks().length||_.video&&!y.getVideoTracks().length)throw y.getTracks().forEach(S=>{S.stop()}),new DOMException("","NotFoundError");return y},y=>lt.reject(u(y))))}}}function mB(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function gB(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(o){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=o)},enumerable:!0,configurable:!0});const r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=o=>{o.stream.addEventListener("addtrack",s=>{let c;c=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===s.track.id):{track:s.track};const u=new Event("track");u.track=s.track,u.receiver=c,u.transceiver={receiver:c},u.streams=[o.stream],this.dispatchEvent(u)}),o.stream.getTracks().forEach(s=>{let c;c=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===s.id):{track:s};const u=new Event("track");u.track=s,u.receiver=c,u.transceiver={receiver:c},u.streams=[o.stream],this.dispatchEvent(u)})},this.addEventListener("addstream",this._ontrackpoly)),r.apply(this,arguments)}}else S_(e,"track",r=>(r.transceiver||Object.defineProperty(r,"transceiver",{value:{receiver:r.receiver}}),r))}function _B(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const r=function(c,u){return{track:u,get dtmf(){return this._dtmf===void 0&&(u.kind==="audio"?this._dtmf=c.createDTMFSender(u):this._dtmf=null),this._dtmf},_pc:c}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const c=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(h,m){let _=c.apply(this,arguments);return _||(_=r(this,h),this._senders.push(_)),_};const u=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(h){u.apply(this,arguments);const m=this._senders.indexOf(h);m!==-1&&this._senders.splice(m,1)}}const o=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(c){this._senders=this._senders||[],o.apply(this,[c]),c.getTracks().forEach(u=>{this._senders.push(r(this,u))})};const s=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(c){this._senders=this._senders||[],s.apply(this,[c]),c.getTracks().forEach(u=>{const h=this._senders.find(m=>m.track===u);h&&this._senders.splice(this._senders.indexOf(h),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const r=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const o=r.apply(this,[]);return o.forEach(s=>s._pc=this),o},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function EB(e){if(!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[o,s,c]=arguments;if(arguments.length>0&&typeof o=="function")return r.apply(this,arguments);if(r.length===0&&(arguments.length===0||typeof o!="function"))return r.apply(this,[]);const u=function(m){const _={};return m.result().forEach(y=>{const S={id:y.id,timestamp:y.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[y.type]||y.type};y.names().forEach(R=>{S[R]=y.stat(R)}),_[S.id]=S}),_},h=function(m){return new Map(Object.keys(m).map(_=>[_,m[_]]))};if(arguments.length>=2){const m=function(_){s(h(u(_)))};return r.apply(this,[m,o])}return new lt((m,_)=>{r.apply(this,[function(y){m(h(u(y)))},_])}).then(s,c)}}function yB(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const o=e.RTCPeerConnection.prototype.getSenders;o&&(e.RTCPeerConnection.prototype.getSenders=function(){const c=o.apply(this,[]);return c.forEach(u=>u._pc=this),c});const s=e.RTCPeerConnection.prototype.addTrack;s&&(e.RTCPeerConnection.prototype.addTrack=function(){const c=s.apply(this,arguments);return c._pc=this,c}),e.RTCRtpSender.prototype.getStats=function(){const c=this;return this._pc.getStats().then(u=>hB(u,c.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const o=e.RTCPeerConnection.prototype.getReceivers;o&&(e.RTCPeerConnection.prototype.getReceivers=function(){const s=o.apply(this,[]);return s.forEach(c=>c._pc=this),s}),S_(e,"track",s=>(s.receiver._pc=s.srcElement,s)),e.RTCRtpReceiver.prototype.getStats=function(){const s=this;return this._pc.getStats().then(c=>hB(c,s.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const o=arguments[0];let s,c,u;return this.getSenders().forEach(h=>{h.track===o&&(s?u=!0:s=h)}),this.getReceivers().forEach(h=>(h.track===o&&(c?u=!0:c=h),h.track===o)),u||s&&c?lt.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):s?s.getStats():c?c.getStats():lt.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return r.apply(this,arguments)}}function vB(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(u=>this._shimmedLocalStreams[u][0])};const r=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(u,h){if(!h)return r.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const m=r.apply(this,arguments);return this._shimmedLocalStreams[h.id]?this._shimmedLocalStreams[h.id].indexOf(m)===-1&&this._shimmedLocalStreams[h.id].push(m):this._shimmedLocalStreams[h.id]=[h,m],m};const o=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(u){this._shimmedLocalStreams=this._shimmedLocalStreams||{},u.getTracks().forEach(_=>{if(this.getSenders().find(S=>S.track===_))throw new DOMException("Track already exists.","InvalidAccessError")});const h=this.getSenders();o.apply(this,arguments);const m=this.getSenders().filter(_=>h.indexOf(_)===-1);this._shimmedLocalStreams[u.id]=[u].concat(m)};const s=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(u){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[u.id],s.apply(this,arguments)};const c=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(u){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},u&&Object.keys(this._shimmedLocalStreams).forEach(h=>{const m=this._shimmedLocalStreams[h].indexOf(u);m!==-1&&this._shimmedLocalStreams[h].splice(m,1),this._shimmedLocalStreams[h].length===1&&delete this._shimmedLocalStreams[h]}),c.apply(this,arguments)}}function SB(e,r){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&r.version>=65)return vB(e);const o=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const _=o.apply(this);return this._reverseStreams=this._reverseStreams||{},_.map(y=>this._reverseStreams[y.id])};const s=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(_){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},_.getTracks().forEach(y=>{if(this.getSenders().find(R=>R.track===y))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[_.id]){const y=new e.MediaStream(_.getTracks());this._streams[_.id]=y,this._reverseStreams[y.id]=_,_=y}s.apply(this,[_])};const c=e.RTCPeerConnection.prototype.removeStream;function u(_,y){let S=y.sdp;return Object.keys(_._reverseStreams||[]).forEach(R=>{const P=_._reverseStreams[R],k=_._streams[P.id];S=S.replace(new RegExp(k.id,"g"),P.id)}),new RTCSessionDescription({type:y.type,sdp:S})}e.RTCPeerConnection.prototype.removeStream=function(_){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},c.apply(this,[this._streams[_.id]||_]),delete this._reverseStreams[this._streams[_.id]?this._streams[_.id].id:_.id],delete this._streams[_.id]},e.RTCPeerConnection.prototype.addTrack=function(_,y){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const S=[].slice.call(arguments,1);if(S.length!==1||!S[0].getTracks().find(k=>k===_))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(k=>k.track===_))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const P=this._streams[y.id];if(P)P.addTrack(_),lt.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const k=new e.MediaStream([_]);this._streams[y.id]=k,this._reverseStreams[k.id]=y,this.addStream(k)}return this.getSenders().find(k=>k.track===_)},["createOffer","createAnswer"].forEach(function(_){const y=e.RTCPeerConnection.prototype[_],S={[_](){const R=arguments;return arguments.length&&typeof arguments[0]=="function"?y.apply(this,[P=>{const k=u(this,P);R[0].apply(null,[k])},P=>{R[1]&&R[1].apply(null,P)},arguments[2]]):y.apply(this,arguments).then(P=>u(this,P))}};e.RTCPeerConnection.prototype[_]=S[_]});const h=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(_,y){let S=y.sdp;return Object.keys(_._reverseStreams||[]).forEach(R=>{const P=_._reverseStreams[R],k=_._streams[P.id];S=S.replace(new RegExp(P.id,"g"),k.id)}),new RTCSessionDescription({type:y.type,sdp:S})}(this,arguments[0]),h.apply(this,arguments)):h.apply(this,arguments)};const m=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const _=m.get.apply(this);return _.type===""?_:u(this,_)}}),e.RTCPeerConnection.prototype.removeTrack=function(_){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!_._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(_._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let y;this._streams=this._streams||{},Object.keys(this._streams).forEach(S=>{this._streams[S].getTracks().find(R=>_.track===R)&&(y=this._streams[S])}),y&&(y.getTracks().length===1?this.removeStream(this._reverseStreams[y.id]):y.removeTrack(_.track),this.dispatchEvent(new Event("negotiationneeded")))}}function FD(e,r){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&r.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(o){const s=e.RTCPeerConnection.prototype[o],c={[o](){return arguments[0]=new(o==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};e.RTCPeerConnection.prototype[o]=c[o]})}function bB(e,r){S_(e,"negotiationneeded",o=>{const s=o.target;if(!(r.version<72||s.getConfiguration&&s.getConfiguration().sdpSemantics==="plan-b")||s.signalingState==="stable")return o})}var TB=Object.freeze({__proto__:null,fixNegotiationNeeded:bB,shimAddTrackRemoveTrack:SB,shimAddTrackRemoveTrackWithNative:vB,shimGetDisplayMedia:function(e,r){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(typeof r=="function"?e.navigator.mediaDevices.getDisplayMedia=function(o){return r(o).then(s=>{const c=o.video&&o.video.width,u=o.video&&o.video.height,h=o.video&&o.video.frameRate;return o.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:s,maxFrameRate:h||3}},c&&(o.video.mandatory.maxWidth=c),u&&(o.video.mandatory.maxHeight=u),e.navigator.mediaDevices.getUserMedia(o)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:_B,shimGetStats:EB,shimGetUserMedia:pB,shimMediaStream:mB,shimOnTrack:gB,shimPeerConnection:FD,shimSenderReceiverGetStats:yB});function wB(e,r){const o=e&&e.navigator,s=e&&e.MediaStreamTrack;if(o.getUserMedia=function(c,u,h){UD("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),o.mediaDevices.getUserMedia(c).then(u,h)},!(r.version>55&&"autoGainControl"in o.mediaDevices.getSupportedConstraints())){const c=function(h,m,_){m in h&&!(_ in h)&&(h[_]=h[m],delete h[m])},u=o.mediaDevices.getUserMedia.bind(o.mediaDevices);if(o.mediaDevices.getUserMedia=function(h){return typeof h=="object"&&typeof h.audio=="object"&&(h=JSON.parse(JSON.stringify(h)),c(h.audio,"autoGainControl","mozAutoGainControl"),c(h.audio,"noiseSuppression","mozNoiseSuppression")),u(h)},s&&s.prototype.getSettings){const h=s.prototype.getSettings;s.prototype.getSettings=function(){const m=h.apply(this,arguments);return c(m,"mozAutoGainControl","autoGainControl"),c(m,"mozNoiseSuppression","noiseSuppression"),m}}if(s&&s.prototype.applyConstraints){const h=s.prototype.applyConstraints;s.prototype.applyConstraints=function(m){return this.kind==="audio"&&typeof m=="object"&&(m=JSON.parse(JSON.stringify(m)),c(m,"autoGainControl","mozAutoGainControl"),c(m,"noiseSuppression","mozNoiseSuppression")),h.apply(this,[m])}}}}function RB(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function jD(e,r){if(typeof e!="object"||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),r.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(c){const u=e.RTCPeerConnection.prototype[c],h={[c](){return arguments[0]=new(c==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),u.apply(this,arguments)}};e.RTCPeerConnection.prototype[c]=h[c]});const o={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},s=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[c,u,h]=arguments;return s.apply(this,[c||null]).then(m=>{if(r.version<53&&!u)try{m.forEach(_=>{_.type=o[_.type]||_.type})}catch(_){if(_.name!=="TypeError")throw _;m.forEach((y,S)=>{m.set(S,Object.assign({},y,{type:o[y.type]||y.type}))})}return m}).then(u,h)}}function CB(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const r=e.RTCPeerConnection.prototype.getSenders;r&&(e.RTCPeerConnection.prototype.getSenders=function(){const s=r.apply(this,[]);return s.forEach(c=>c._pc=this),s});const o=e.RTCPeerConnection.prototype.addTrack;o&&(e.RTCPeerConnection.prototype.addTrack=function(){const s=o.apply(this,arguments);return s._pc=this,s}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):lt.resolve(new Map)}}function IB(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const r=e.RTCPeerConnection.prototype.getReceivers;r&&(e.RTCPeerConnection.prototype.getReceivers=function(){const o=r.apply(this,[]);return o.forEach(s=>s._pc=this),o}),S_(e,"track",o=>(o.receiver._pc=o.srcElement,o)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function AB(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(r){UD("removeStream","removeTrack"),this.getSenders().forEach(o=>{var s;o.track&&st(s=r.getTracks()).call(s,o.track)&&this.removeTrack(o)})})}function PB(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function OB(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype.addTransceiver;r&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let o=arguments[1]&&arguments[1].sendEncodings;o===void 0&&(o=[]),o=[...o];const s=o.length>0;s&&o.forEach(u=>{if("rid"in u&&!/^[a-z0-9]{0,16}$/i.test(u.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in u&&!(parseFloat(u.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in u&&!(parseFloat(u.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const c=r.apply(this,arguments);if(s){const{sender:u}=c,h=u.getParameters();(!("encodings"in h)||h.encodings.length===1&&Object.keys(h.encodings[0]).length===0)&&(h.encodings=o,u.sendEncodings=o,this.setParametersPromises.push(u.setParameters(h).then(()=>{delete u.sendEncodings}).catch(()=>{delete u.sendEncodings})))}return c})}function kB(e){if(typeof e!="object"||!e.RTCRtpSender)return;const r=e.RTCRtpSender.prototype.getParameters;r&&(e.RTCRtpSender.prototype.getParameters=function(){const o=r.apply(this,arguments);return"encodings"in o||(o.encodings=[].concat(this.sendEncodings||[{}])),o})}function NB(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?lt.all(this.setParametersPromises).then(()=>r.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):r.apply(this,arguments)}}function DB(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?lt.all(this.setParametersPromises).then(()=>r.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):r.apply(this,arguments)}}var LB=Object.freeze({__proto__:null,shimAddTransceiver:OB,shimCreateAnswer:DB,shimCreateOffer:NB,shimGetDisplayMedia:function(e,r){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(o){if(!o||!o.video){const s=new DOMException("getDisplayMedia without video constraints is undefined");return s.name="NotFoundError",s.code=8,lt.reject(s)}return o.video===!0?o.video={mediaSource:r}:o.video.mediaSource=r,e.navigator.mediaDevices.getUserMedia(o)})},shimGetParameters:kB,shimGetUserMedia:wB,shimOnTrack:RB,shimPeerConnection:jD,shimRTCDataChannel:PB,shimReceiverGetStats:IB,shimRemoveStream:AB,shimSenderGetStats:CB});function xB(e){if(typeof e=="object"&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const r=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(o){var s;this._localStreams||(this._localStreams=[]),st(s=this._localStreams).call(s,o)||this._localStreams.push(o),o.getAudioTracks().forEach(c=>r.call(this,c,o)),o.getVideoTracks().forEach(c=>r.call(this,c,o))},e.RTCPeerConnection.prototype.addTrack=function(o){for(var s=arguments.length,c=new Array(s>1?s-1:0),u=1;u<s;u++)c[u-1]=arguments[u];return c&&c.forEach(h=>{var m;this._localStreams?st(m=this._localStreams).call(m,h)||this._localStreams.push(h):this._localStreams=[h]}),r.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(r){this._localStreams||(this._localStreams=[]);const o=this._localStreams.indexOf(r);if(o===-1)return;this._localStreams.splice(o,1);const s=r.getTracks();this.getSenders().forEach(c=>{st(s).call(s,c.track)&&this.removeTrack(c)})})}}function MB(e){if(typeof e=="object"&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(o){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=o),this.addEventListener("track",this._onaddstreampoly=s=>{s.streams.forEach(c=>{var u;if(this._remoteStreams||(this._remoteStreams=[]),st(u=this._remoteStreams).call(u,c))return;this._remoteStreams.push(c);const h=new Event("addstream");h.stream=c,this.dispatchEvent(h)})})}});const r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const o=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(s){s.streams.forEach(c=>{if(o._remoteStreams||(o._remoteStreams=[]),o._remoteStreams.indexOf(c)>=0)return;o._remoteStreams.push(c);const u=new Event("addstream");u.stream=c,o.dispatchEvent(u)})}),r.apply(o,arguments)}}}function UB(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype,o=r.createOffer,s=r.createAnswer,c=r.setLocalDescription,u=r.setRemoteDescription,h=r.addIceCandidate;r.createOffer=function(_,y){const S=arguments.length>=2?arguments[2]:arguments[0],R=o.apply(this,[S]);return y?(R.then(_,y),lt.resolve()):R},r.createAnswer=function(_,y){const S=arguments.length>=2?arguments[2]:arguments[0],R=s.apply(this,[S]);return y?(R.then(_,y),lt.resolve()):R};let m=function(_,y,S){const R=c.apply(this,[_]);return S?(R.then(y,S),lt.resolve()):R};r.setLocalDescription=m,m=function(_,y,S){const R=u.apply(this,[_]);return S?(R.then(y,S),lt.resolve()):R},r.setRemoteDescription=m,m=function(_,y,S){const R=h.apply(this,[_]);return S?(R.then(y,S),lt.resolve()):R},r.addIceCandidate=m}function VB(e){const r=e&&e.navigator;if(r.mediaDevices&&r.mediaDevices.getUserMedia){const o=r.mediaDevices,s=o.getUserMedia.bind(o);r.mediaDevices.getUserMedia=c=>s(FB(c))}!r.getUserMedia&&r.mediaDevices&&r.mediaDevices.getUserMedia&&(r.getUserMedia=(function(o,s,c){r.mediaDevices.getUserMedia(o).then(s,c)}).bind(r))}function FB(e){return e&&e.video!==void 0?Object.assign({},e,{video:dB(e.video)}):e}function jB(e){if(!e.RTCPeerConnection)return;const r=e.RTCPeerConnection;e.RTCPeerConnection=function(o,s){if(o&&o.iceServers){const c=[];for(let u=0;u<o.iceServers.length;u++){let h=o.iceServers[u];!h.hasOwnProperty("urls")&&h.hasOwnProperty("url")?(UD("RTCIceServer.url","RTCIceServer.urls"),h=JSON.parse(JSON.stringify(h)),h.urls=h.url,delete h.url,c.push(h)):c.push(o.iceServers[u])}o.iceServers=c}return new r(o,s)},e.RTCPeerConnection.prototype=r.prototype,"generateCertificate"in r&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>r.generateCertificate})}function BB(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function WB(e){const r=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(o){if(o){o.offerToReceiveAudio!==void 0&&(o.offerToReceiveAudio=!!o.offerToReceiveAudio);const s=this.getTransceivers().find(u=>u.receiver.track.kind==="audio");o.offerToReceiveAudio===!1&&s?s.direction==="sendrecv"?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":s.direction==="recvonly"&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):o.offerToReceiveAudio!==!0||s||this.addTransceiver("audio",{direction:"recvonly"}),o.offerToReceiveVideo!==void 0&&(o.offerToReceiveVideo=!!o.offerToReceiveVideo);const c=this.getTransceivers().find(u=>u.receiver.track.kind==="video");o.offerToReceiveVideo===!1&&c?c.direction==="sendrecv"?c.setDirection?c.setDirection("sendonly"):c.direction="sendonly":c.direction==="recvonly"&&(c.setDirection?c.setDirection("inactive"):c.direction="inactive"):o.offerToReceiveVideo!==!0||c||this.addTransceiver("video",{direction:"recvonly"})}return r.apply(this,arguments)}}function zB(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var GB=Object.freeze({__proto__:null,shimAudioContext:zB,shimCallbacksAPI:UB,shimConstraints:FB,shimCreateOfferLegacy:WB,shimGetUserMedia:VB,shimLocalStreamsAPI:xB,shimRTCIceServerUrls:jB,shimRemoteStreamsAPI:MB,shimTrackEventTransceiver:BB}),HB=`	
\v\f\r \u2028\u2029\uFEFF`,fle=Xt,ple=ha,BD=HB,$B=A("".replace),mle=RegExp("^["+BD+"]+"),gle=RegExp("(^|[^"+BD+"])["+BD+"]+$"),_le=function(e){return function(r){var o=ple(fle(r));return 1&e&&(o=$B(o,mle,"")),2&e&&(o=$B(o,gle,"$1")),o}},Ele={trim:_le(3)},yle=tI.PROPER,vle=d,KB=HB,Sle=Ele.trim;xn({target:"String",proto:!0,forced:function(e){return vle(function(){return!!KB[e]()||""[e]()!==""||yle&&KB[e].name!==e})}("trim")},{trim:function(){return Sle(this)}});var ble=Ka("String").trim,Tle=N,wle=ble,WD=String.prototype,Rle=function(e){var r=e.trim;return typeof e=="string"||e===WD||Tle(WD,e)&&r===WD.trim?wle:r},es=l(Rle),qB={exports:{}};(function(e){const r={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};r.localCName=r.generateIdentifier(),r.splitLines=function(o){return o.trim().split(`
`).map(s=>s.trim())},r.splitSections=function(o){return o.split(`
m=`).map((s,c)=>(c>0?"m="+s:s).trim()+`\r
`)},r.getDescription=function(o){const s=r.splitSections(o);return s&&s[0]},r.getMediaSections=function(o){const s=r.splitSections(o);return s.shift(),s},r.matchPrefix=function(o,s){return r.splitLines(o).filter(c=>c.indexOf(s)===0)},r.parseCandidate=function(o){let s;s=o.indexOf("a=candidate:")===0?o.substring(12).split(" "):o.substring(10).split(" ");const c={foundation:s[0],component:{1:"rtp",2:"rtcp"}[s[1]]||s[1],protocol:s[2].toLowerCase(),priority:parseInt(s[3],10),ip:s[4],address:s[4],port:parseInt(s[5],10),type:s[7]};for(let u=8;u<s.length;u+=2)switch(s[u]){case"raddr":c.relatedAddress=s[u+1];break;case"rport":c.relatedPort=parseInt(s[u+1],10);break;case"tcptype":c.tcpType=s[u+1];break;case"ufrag":c.ufrag=s[u+1],c.usernameFragment=s[u+1];break;default:c[s[u]]===void 0&&(c[s[u]]=s[u+1])}return c},r.writeCandidate=function(o){const s=[];s.push(o.foundation);const c=o.component;c==="rtp"?s.push(1):c==="rtcp"?s.push(2):s.push(c),s.push(o.protocol.toUpperCase()),s.push(o.priority),s.push(o.address||o.ip),s.push(o.port);const u=o.type;return s.push("typ"),s.push(u),u!=="host"&&o.relatedAddress&&o.relatedPort&&(s.push("raddr"),s.push(o.relatedAddress),s.push("rport"),s.push(o.relatedPort)),o.tcpType&&o.protocol.toLowerCase()==="tcp"&&(s.push("tcptype"),s.push(o.tcpType)),(o.usernameFragment||o.ufrag)&&(s.push("ufrag"),s.push(o.usernameFragment||o.ufrag)),"candidate:"+s.join(" ")},r.parseIceOptions=function(o){return o.substring(14).split(" ")},r.parseRtpMap=function(o){let s=o.substring(9).split(" ");const c={payloadType:parseInt(s.shift(),10)};return s=s[0].split("/"),c.name=s[0],c.clockRate=parseInt(s[1],10),c.channels=s.length===3?parseInt(s[2],10):1,c.numChannels=c.channels,c},r.writeRtpMap=function(o){let s=o.payloadType;o.preferredPayloadType!==void 0&&(s=o.preferredPayloadType);const c=o.channels||o.numChannels||1;return"a=rtpmap:"+s+" "+o.name+"/"+o.clockRate+(c!==1?"/"+c:"")+`\r
`},r.parseExtmap=function(o){const s=o.substring(9).split(" ");return{id:parseInt(s[0],10),direction:s[0].indexOf("/")>0?s[0].split("/")[1]:"sendrecv",uri:s[1],attributes:s.slice(2).join(" ")}},r.writeExtmap=function(o){return"a=extmap:"+(o.id||o.preferredId)+(o.direction&&o.direction!=="sendrecv"?"/"+o.direction:"")+" "+o.uri+(o.attributes?" "+o.attributes:"")+`\r
`},r.parseFmtp=function(o){const s={};let c;const u=o.substring(o.indexOf(" ")+1).split(";");for(let h=0;h<u.length;h++)c=u[h].trim().split("="),s[c[0].trim()]=c[1];return s},r.writeFmtp=function(o){let s="",c=o.payloadType;if(o.preferredPayloadType!==void 0&&(c=o.preferredPayloadType),o.parameters&&Object.keys(o.parameters).length){const u=[];Object.keys(o.parameters).forEach(h=>{o.parameters[h]!==void 0?u.push(h+"="+o.parameters[h]):u.push(h)}),s+="a=fmtp:"+c+" "+u.join(";")+`\r
`}return s},r.parseRtcpFb=function(o){const s=o.substring(o.indexOf(" ")+1).split(" ");return{type:s.shift(),parameter:s.join(" ")}},r.writeRtcpFb=function(o){let s="",c=o.payloadType;return o.preferredPayloadType!==void 0&&(c=o.preferredPayloadType),o.rtcpFeedback&&o.rtcpFeedback.length&&o.rtcpFeedback.forEach(u=>{s+="a=rtcp-fb:"+c+" "+u.type+(u.parameter&&u.parameter.length?" "+u.parameter:"")+`\r
`}),s},r.parseSsrcMedia=function(o){const s=o.indexOf(" "),c={ssrc:parseInt(o.substring(7,s),10)},u=o.indexOf(":",s);return u>-1?(c.attribute=o.substring(s+1,u),c.value=o.substring(u+1)):c.attribute=o.substring(s+1),c},r.parseSsrcGroup=function(o){const s=o.substring(13).split(" ");return{semantics:s.shift(),ssrcs:s.map(c=>parseInt(c,10))}},r.getMid=function(o){const s=r.matchPrefix(o,"a=mid:")[0];if(s)return s.substring(6)},r.parseFingerprint=function(o){const s=o.substring(14).split(" ");return{algorithm:s[0].toLowerCase(),value:s[1].toUpperCase()}},r.getDtlsParameters=function(o,s){return{role:"auto",fingerprints:r.matchPrefix(o+s,"a=fingerprint:").map(r.parseFingerprint)}},r.writeDtlsParameters=function(o,s){let c="a=setup:"+s+`\r
`;return o.fingerprints.forEach(u=>{c+="a=fingerprint:"+u.algorithm+" "+u.value+`\r
`}),c},r.parseCryptoLine=function(o){const s=o.substring(9).split(" ");return{tag:parseInt(s[0],10),cryptoSuite:s[1],keyParams:s[2],sessionParams:s.slice(3)}},r.writeCryptoLine=function(o){return"a=crypto:"+o.tag+" "+o.cryptoSuite+" "+(typeof o.keyParams=="object"?r.writeCryptoKeyParams(o.keyParams):o.keyParams)+(o.sessionParams?" "+o.sessionParams.join(" "):"")+`\r
`},r.parseCryptoKeyParams=function(o){if(o.indexOf("inline:")!==0)return null;const s=o.substring(7).split("|");return{keyMethod:"inline",keySalt:s[0],lifeTime:s[1],mkiValue:s[2]?s[2].split(":")[0]:void 0,mkiLength:s[2]?s[2].split(":")[1]:void 0}},r.writeCryptoKeyParams=function(o){return o.keyMethod+":"+o.keySalt+(o.lifeTime?"|"+o.lifeTime:"")+(o.mkiValue&&o.mkiLength?"|"+o.mkiValue+":"+o.mkiLength:"")},r.getCryptoParameters=function(o,s){return r.matchPrefix(o+s,"a=crypto:").map(r.parseCryptoLine)},r.getIceParameters=function(o,s){const c=r.matchPrefix(o+s,"a=ice-ufrag:")[0],u=r.matchPrefix(o+s,"a=ice-pwd:")[0];return c&&u?{usernameFragment:c.substring(12),password:u.substring(10)}:null},r.writeIceParameters=function(o){let s="a=ice-ufrag:"+o.usernameFragment+`\r
a=ice-pwd:`+o.password+`\r
`;return o.iceLite&&(s+=`a=ice-lite\r
`),s},r.parseRtpParameters=function(o){const s={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},c=r.splitLines(o)[0].split(" ");s.profile=c[2];for(let h=3;h<c.length;h++){const m=c[h],_=r.matchPrefix(o,"a=rtpmap:"+m+" ")[0];if(_){const y=r.parseRtpMap(_),S=r.matchPrefix(o,"a=fmtp:"+m+" ");switch(y.parameters=S.length?r.parseFmtp(S[0]):{},y.rtcpFeedback=r.matchPrefix(o,"a=rtcp-fb:"+m+" ").map(r.parseRtcpFb),s.codecs.push(y),y.name.toUpperCase()){case"RED":case"ULPFEC":s.fecMechanisms.push(y.name.toUpperCase())}}}r.matchPrefix(o,"a=extmap:").forEach(h=>{s.headerExtensions.push(r.parseExtmap(h))});const u=r.matchPrefix(o,"a=rtcp-fb:* ").map(r.parseRtcpFb);return s.codecs.forEach(h=>{u.forEach(m=>{h.rtcpFeedback.find(_=>_.type===m.type&&_.parameter===m.parameter)||h.rtcpFeedback.push(m)})}),s},r.writeRtpDescription=function(o,s){let c="";c+="m="+o+" ",c+=s.codecs.length>0?"9":"0",c+=" "+(s.profile||"UDP/TLS/RTP/SAVPF")+" ",c+=s.codecs.map(h=>h.preferredPayloadType!==void 0?h.preferredPayloadType:h.payloadType).join(" ")+`\r
`,c+=`c=IN IP4 0.0.0.0\r
`,c+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,s.codecs.forEach(h=>{c+=r.writeRtpMap(h),c+=r.writeFmtp(h),c+=r.writeRtcpFb(h)});let u=0;return s.codecs.forEach(h=>{h.maxptime>u&&(u=h.maxptime)}),u>0&&(c+="a=maxptime:"+u+`\r
`),s.headerExtensions&&s.headerExtensions.forEach(h=>{c+=r.writeExtmap(h)}),c},r.parseRtpEncodingParameters=function(o){const s=[],c=r.parseRtpParameters(o),u=c.fecMechanisms.indexOf("RED")!==-1,h=c.fecMechanisms.indexOf("ULPFEC")!==-1,m=r.matchPrefix(o,"a=ssrc:").map(P=>r.parseSsrcMedia(P)).filter(P=>P.attribute==="cname"),_=m.length>0&&m[0].ssrc;let y;const S=r.matchPrefix(o,"a=ssrc-group:FID").map(P=>P.substring(17).split(" ").map(k=>parseInt(k,10)));S.length>0&&S[0].length>1&&S[0][0]===_&&(y=S[0][1]),c.codecs.forEach(P=>{if(P.name.toUpperCase()==="RTX"&&P.parameters.apt){let k={ssrc:_,codecPayloadType:parseInt(P.parameters.apt,10)};_&&y&&(k.rtx={ssrc:y}),s.push(k),u&&(k=JSON.parse(JSON.stringify(k)),k.fec={ssrc:_,mechanism:h?"red+ulpfec":"red"},s.push(k))}}),s.length===0&&_&&s.push({ssrc:_});let R=r.matchPrefix(o,"b=");return R.length&&(R=R[0].indexOf("b=TIAS:")===0?parseInt(R[0].substring(7),10):R[0].indexOf("b=AS:")===0?1e3*parseInt(R[0].substring(5),10)*.95-16e3:void 0,s.forEach(P=>{P.maxBitrate=R})),s},r.parseRtcpParameters=function(o){const s={},c=r.matchPrefix(o,"a=ssrc:").map(m=>r.parseSsrcMedia(m)).filter(m=>m.attribute==="cname")[0];c&&(s.cname=c.value,s.ssrc=c.ssrc);const u=r.matchPrefix(o,"a=rtcp-rsize");s.reducedSize=u.length>0,s.compound=u.length===0;const h=r.matchPrefix(o,"a=rtcp-mux");return s.mux=h.length>0,s},r.writeRtcpParameters=function(o){let s="";return o.reducedSize&&(s+=`a=rtcp-rsize\r
`),o.mux&&(s+=`a=rtcp-mux\r
`),o.ssrc!==void 0&&o.cname&&(s+="a=ssrc:"+o.ssrc+" cname:"+o.cname+`\r
`),s},r.parseMsid=function(o){let s;const c=r.matchPrefix(o,"a=msid:");if(c.length===1)return s=c[0].substring(7).split(" "),{stream:s[0],track:s[1]};const u=r.matchPrefix(o,"a=ssrc:").map(h=>r.parseSsrcMedia(h)).filter(h=>h.attribute==="msid");return u.length>0?(s=u[0].value.split(" "),{stream:s[0],track:s[1]}):void 0},r.parseSctpDescription=function(o){const s=r.parseMLine(o),c=r.matchPrefix(o,"a=max-message-size:");let u;c.length>0&&(u=parseInt(c[0].substring(19),10)),isNaN(u)&&(u=65536);const h=r.matchPrefix(o,"a=sctp-port:");if(h.length>0)return{port:parseInt(h[0].substring(12),10),protocol:s.fmt,maxMessageSize:u};const m=r.matchPrefix(o,"a=sctpmap:");if(m.length>0){const _=m[0].substring(10).split(" ");return{port:parseInt(_[0],10),protocol:_[1],maxMessageSize:u}}},r.writeSctpDescription=function(o,s){let c=[];return c=o.protocol!=="DTLS/SCTP"?["m="+o.kind+" 9 "+o.protocol+" "+s.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+s.port+`\r
`]:["m="+o.kind+" 9 "+o.protocol+" "+s.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+s.port+" "+s.protocol+` 65535\r
`],s.maxMessageSize!==void 0&&c.push("a=max-message-size:"+s.maxMessageSize+`\r
`),c.join("")},r.generateSessionId=function(){return Math.random().toString().substr(2,22)},r.writeSessionBoilerplate=function(o,s,c){let u;const h=s!==void 0?s:2;return u=o||r.generateSessionId(),`v=0\r
o=`+(c||"thisisadapterortc")+" "+u+" "+h+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},r.getDirection=function(o,s){const c=r.splitLines(o);for(let u=0;u<c.length;u++)switch(c[u]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return c[u].substring(2)}return s?r.getDirection(s):"sendrecv"},r.getKind=function(o){return r.splitLines(o)[0].split(" ")[0].substring(2)},r.isRejected=function(o){return o.split(" ",2)[1]==="0"},r.parseMLine=function(o){const s=r.splitLines(o)[0].substring(2).split(" ");return{kind:s[0],port:parseInt(s[1],10),protocol:s[2],fmt:s.slice(3).join(" ")}},r.parseOLine=function(o){const s=r.matchPrefix(o,"o=")[0].substring(2).split(" ");return{username:s[0],sessionId:s[1],sessionVersion:parseInt(s[2],10),netType:s[3],addressType:s[4],address:s[5]}},r.isValidSDP=function(o){if(typeof o!="string"||o.length===0)return!1;const s=r.splitLines(o);for(let c=0;c<s.length;c++)if(s[c].length<2||s[c].charAt(1)!=="=")return!1;return!0},e.exports=r})(qB);var YB=qB.exports,_v=l(YB),Cle=i({__proto__:null,default:_v},[YB]);function YI(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const r=e.RTCIceCandidate;e.RTCIceCandidate=function(o){if(typeof o=="object"&&o.candidate&&o.candidate.indexOf("a=")===0&&((o=JSON.parse(JSON.stringify(o))).candidate=o.candidate.substr(2)),o.candidate&&o.candidate.length){const s=new r(o),c=_v.parseCandidate(o.candidate),u=Object.assign(s,c);return u.toJSON=function(){return{candidate:u.candidate,sdpMid:u.sdpMid,sdpMLineIndex:u.sdpMLineIndex,usernameFragment:u.usernameFragment}},u}return new r(o)},e.RTCIceCandidate.prototype=r.prototype,S_(e,"icecandidate",o=>(o.candidate&&Object.defineProperty(o,"candidate",{value:new e.RTCIceCandidate(o.candidate),writable:"false"}),o))}function zD(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||S_(e,"icecandidate",r=>{if(r.candidate){const o=_v.parseCandidate(r.candidate.candidate);o.type==="relay"&&(r.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[o.priority>>24])}return r})}function XI(e,r){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const o=function(m){if(!m||!m.sdp)return!1;const _=_v.splitSections(m.sdp);return _.shift(),_.some(y=>{const S=_v.parseMLine(y);return S&&S.kind==="application"&&S.protocol.indexOf("SCTP")!==-1})},s=function(m){const _=m.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(_===null||_.length<2)return-1;const y=parseInt(_[1],10);return y!=y?-1:y},c=function(m){let _=65536;return r.browser==="firefox"&&(_=r.version<57?m===-1?16384:2147483637:r.version<60?r.version===57?65535:65536:2147483637),_},u=function(m,_){let y=65536;r.browser==="firefox"&&r.version===57&&(y=65535);const S=_v.matchPrefix(m.sdp,"a=max-message-size:");return S.length>0?y=parseInt(S[0].substr(19),10):r.browser==="firefox"&&_!==-1&&(y=2147483637),y},h=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,r.browser==="chrome"&&r.version>=76){const{sdpSemantics:m}=this.getConfiguration();m==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(o(arguments[0])){const m=s(arguments[0]),_=c(m),y=u(arguments[0],m);let S;S=_===0&&y===0?Number.POSITIVE_INFINITY:_===0||y===0?Math.max(_,y):Math.min(_,y);const R={};Object.defineProperty(R,"maxMessageSize",{get:()=>S}),this._sctp=R}return h.apply(this,arguments)}}function JI(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function r(s,c){const u=s.send;s.send=function(){const h=arguments[0],m=h.length||h.size||h.byteLength;if(s.readyState==="open"&&c.sctp&&m>c.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+c.sctp.maxMessageSize+" bytes)");return u.apply(s,arguments)}}const o=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const s=o.apply(this,arguments);return r(s,this),s},S_(e,"datachannel",s=>(r(s.channel,s.target),s))}function GD(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const r=e.RTCPeerConnection.prototype;Object.defineProperty(r,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(r,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(o){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),o&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=o)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(o=>{const s=r[o];r[o]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=c=>{const u=c.target;if(u._lastConnectionState!==u.connectionState){u._lastConnectionState=u.connectionState;const h=new Event("connectionstatechange",c);u.dispatchEvent(h)}return c},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),s.apply(this,arguments)}})}function HD(e,r){if(!e.RTCPeerConnection||r.browser==="chrome"&&r.version>=71||r.browser==="safari"&&r.version>=605)return;const o=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(s){if(s&&s.sdp&&s.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const c=s.sdp.split(`
`).filter(u=>es(u).call(u)!=="a=extmap-allow-mixed").join(`
`);e.RTCSessionDescription&&s instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:s.type,sdp:c}):s.sdp=c}return o.apply(this,arguments)}}function QI(e,r){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const o=e.RTCPeerConnection.prototype.addIceCandidate;o&&o.length!==0&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(r.browser==="chrome"&&r.version<78||r.browser==="firefox"&&r.version<68||r.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?lt.resolve():o.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),lt.resolve())})}function ZI(e,r){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const o=e.RTCPeerConnection.prototype.setLocalDescription;o&&o.length!==0&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let s=arguments[0]||{};if(typeof s!="object"||s.type&&s.sdp)return o.apply(this,arguments);if(s={type:s.type,sdp:s.sdp},!s.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":s.type="offer";break;default:s.type="answer"}return s.sdp||s.type!=="offer"&&s.type!=="answer"?o.apply(this,[s]):(s.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(c=>o.apply(this,[c]))})}var Ile=Object.freeze({__proto__:null,removeExtmapAllowMixed:HD,shimAddIceCandidateNullOrEmpty:QI,shimConnectionState:GD,shimMaxMessageSize:XI,shimParameterlessSetLocalDescription:ZI,shimRTCIceCandidate:YI,shimRTCIceCandidateRelayProtocol:zD,shimSendThrowTypeError:JI});(function(){let{window:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const o=lB,s=function(u){const h={browser:null,version:null};if(u===void 0||!u.navigator)return h.browser="Not a browser.",h;const{navigator:m}=u;if(m.mozGetUserMedia)h.browser="firefox",h.version=qI(m.userAgent,/Firefox\/(\d+)\./,1);else if(m.webkitGetUserMedia||u.isSecureContext===!1&&u.webkitRTCPeerConnection)h.browser="chrome",h.version=qI(m.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!u.RTCPeerConnection||!m.userAgent.match(/AppleWebKit\/(\d+)\./))return h.browser="Not a supported browser.",h;h.browser="safari",h.version=qI(m.userAgent,/AppleWebKit\/(\d+)\./,1),h.supportsUnifiedPlan=u.RTCRtpTransceiver&&"currentDirection"in u.RTCRtpTransceiver.prototype}return h}(e),c={browserDetails:s,commonShim:Ile,extractVersion:qI,disableLog:dle,disableWarnings:hle,sdp:Cle};switch(s.browser){case"chrome":if(!TB||!FD||!r.shimChrome)return o("Chrome shim is not included in this adapter release."),c;if(s.version===null)return o("Chrome shim can not determine version, not shimming."),c;o("adapter.js shimming chrome."),c.browserShim=TB,QI(e,s),ZI(e),pB(e,s),mB(e),FD(e,s),gB(e),SB(e,s),_B(e),EB(e),yB(e),bB(e,s),YI(e),zD(e),GD(e),XI(e,s),JI(e),HD(e,s);break;case"firefox":if(!LB||!jD||!r.shimFirefox)return o("Firefox shim is not included in this adapter release."),c;o("adapter.js shimming firefox."),c.browserShim=LB,QI(e,s),ZI(e),wB(e,s),jD(e,s),RB(e),AB(e),CB(e),IB(e),PB(e),OB(e),kB(e),NB(e),DB(e),YI(e),GD(e),XI(e,s),JI(e);break;case"safari":if(!GB||!r.shimSafari)return o("Safari shim is not included in this adapter release."),c;o("adapter.js shimming safari."),c.browserShim=GB,QI(e,s),ZI(e),jB(e),WB(e),UB(e),xB(e),MB(e),BB(e),VB(e),zB(e),YI(e),zD(e),XI(e,s),JI(e),HD(e,s);break;default:o("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var XB=dc,Ale=TypeError,JB=ir.match(/firefox\/(\d+)/i),Ple=!!JB&&+JB[1],Ole=/MSIE|Trident/.test(ir),QB=ir.match(/AppleWebKit\/(\d+)\./),kle=!!QB&&+QB[1],Nle=xn,ZB=A,Dle=uo,Lle=As,e5=oi,xle=function(e,r){if(!delete e[r])throw Ale("Cannot delete property "+XB(r)+" of "+XB(e))},t5=ha,$D=d,Mle=d3,Ule=_f,n5=Ple,Vle=Ole,r5=ur,i5=kle,Tm=[],o5=ZB(Tm.sort),Fle=ZB(Tm.push),jle=$D(function(){Tm.sort(void 0)}),Ble=$D(function(){Tm.sort(null)}),Wle=Ule("sort"),s5=!$D(function(){if(r5)return r5<70;if(!(n5&&n5>3)){if(Vle)return!0;if(i5)return i5<603;var e,r,o,s,c="";for(e=65;e<76;e++){switch(r=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:o=3;break;case 68:case 71:o=4;break;default:o=2}for(s=0;s<47;s++)Tm.push({k:r+s,v:o})}for(Tm.sort(function(u,h){return h.v-u.v}),s=0;s<Tm.length;s++)r=Tm[s].k.charAt(0),c.charAt(c.length-1)!==r&&(c+=r);return c!=="DGBEFHACIJK"}});Nle({target:"Array",proto:!0,forced:jle||!Ble||!Wle||!s5},{sort:function(e){e!==void 0&&Dle(e);var r=Lle(this);if(s5)return e===void 0?o5(r):o5(r,e);var o,s,c=[],u=e5(r);for(s=0;s<u;s++)s in r&&Fle(c,r[s]);for(Mle(c,function(h){return function(m,_){return _===void 0?-1:m===void 0?1:h!==void 0?+h(m,_)||0:t5(m)>t5(_)?1:-1}}(e)),o=e5(c),s=0;s<o;)r[s]=c[s++];for(;s<u;)xle(r,s++);return r}});var zle=Ka("Array").sort,Gle=N,Hle=zle,KD=Array.prototype,$le=function(e){var r=e.sort;return e===KD||Gle(KD,e)&&r===KD.sort?Hle:r},Xb=l($le),qD=j;xn({global:!0,forced:qD.globalThis!==qD},{globalThis:qD});var a5=l(j),YD={exports:{}};(function(e,r){(function(o,s){var c="function",u="undefined",h="object",m="string",_="major",y="model",S="name",R="type",P="vendor",k="version",z="architecture",U="console",V="mobile",q="tablet",Y="smarttv",ce="wearable",_e="embedded",Ee="Amazon",me="Apple",ke="ASUS",Ye="BlackBerry",ut="Browser",pt="Chrome",vn="Firefox",Sn="Google",cr="Huawei",Zr="LG",Wr="Microsoft",Js="Motorola",je="Opera",ot="Samsung",bt="Sharp",We="Sony",x="Xiaomi",ie="Zebra",de="Facebook",Qe="Chromium OS",Ht="Mac OS",tr=function(vi){for(var zi={},vr=0;vr<vi.length;vr++)zi[vi[vr].toUpperCase()]=vi[vr];return zi},Wi=function(vi,zi){return typeof vi===m&&Ra(zi).indexOf(Ra(vi))!==-1},Ra=function(vi){return vi.toLowerCase()},rp=function(vi,zi){if(typeof vi===m)return vi=vi.replace(/^\s\s*/,""),typeof zi===u?vi:vi.substring(0,350)},Q_=function(vi,zi){for(var vr,rc,Ph,ei,Vn,Ca,Hm=0;Hm<zi.length&&!Vn;){var Sd=zi[Hm],L$=zi[Hm+1];for(vr=rc=0;vr<Sd.length&&!Vn&&Sd[vr];)if(Vn=Sd[vr++].exec(vi))for(Ph=0;Ph<L$.length;Ph++)Ca=Vn[++rc],typeof(ei=L$[Ph])===h&&ei.length>0?ei.length===2?typeof ei[1]==c?this[ei[0]]=ei[1].call(this,Ca):this[ei[0]]=ei[1]:ei.length===3?typeof ei[1]!==c||ei[1].exec&&ei[1].test?this[ei[0]]=Ca?Ca.replace(ei[1],ei[2]):s:this[ei[0]]=Ca?ei[1].call(this,Ca,ei[2]):s:ei.length===4&&(this[ei[0]]=Ca?ei[3].call(this,Ca.replace(ei[1],ei[2])):s):this[ei]=Ca||s;Hm+=2}},ZT=function(vi,zi){for(var vr in zi)if(typeof zi[vr]===h&&zi[vr].length>0){for(var rc=0;rc<zi[vr].length;rc++)if(Wi(zi[vr][rc],vi))return vr==="?"?s:vr}else if(Wi(zi[vr],vi))return vr==="?"?s:vr;return vi},XP={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},JP={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[k,[S,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[k,[S,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[S,k],[/opios[\/ ]+([\w\.]+)/i],[k,[S,je+" Mini"]],[/\bopr\/([\w\.]+)/i],[k,[S,je]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[S,k],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[k,[S,"UC"+ut]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[k,[S,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[k,[S,"WeChat"]],[/konqueror\/([\w\.]+)/i],[k,[S,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[k,[S,"IE"]],[/yabrowser\/([\w\.]+)/i],[k,[S,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[S,/(.+)/,"$1 Secure "+ut],k],[/\bfocus\/([\w\.]+)/i],[k,[S,vn+" Focus"]],[/\bopt\/([\w\.]+)/i],[k,[S,je+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[k,[S,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[k,[S,"Dolphin"]],[/coast\/([\w\.]+)/i],[k,[S,je+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[k,[S,"MIUI "+ut]],[/fxios\/([-\w\.]+)/i],[k,[S,vn]],[/\bqihu|(qi?ho?o?|360)browser/i],[[S,"360 "+ut]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[S,/(.+)/,"$1 "+ut],k],[/(comodo_dragon)\/([\w\.]+)/i],[[S,/_/g," "],k],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[S,k],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[S],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[S,de],k],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[S,k],[/\bgsa\/([\w\.]+) .*safari\//i],[k,[S,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[k,[S,pt+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[S,pt+" WebView"],k],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[k,[S,"Android "+ut]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[S,k],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[k,[S,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[k,S],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[S,[k,ZT,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[S,k],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[S,"Netscape"],k],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[k,[S,vn+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[S,k],[/(cobalt)\/([\w\.]+)/i],[S,[k,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[z,"amd64"]],[/(ia32(?=;))/i],[[z,Ra]],[/((?:i[346]|x)86)[;\)]/i],[[z,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[z,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[z,"armhf"]],[/windows (ce|mobile); ppc;/i],[[z,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[z,/ower/,"",Ra]],[/(sun4\w)[;\)]/i],[[z,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[z,Ra]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[y,[P,ot],[R,q]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[y,[P,ot],[R,V]],[/\((ip(?:hone|od)[\w ]*);/i],[y,[P,me],[R,V]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[y,[P,me],[R,q]],[/(macintosh);/i],[y,[P,me]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[y,[P,bt],[R,V]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[y,[P,cr],[R,q]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[y,[P,cr],[R,V]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[y,/_/g," "],[P,x],[R,V]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[y,/_/g," "],[P,x],[R,q]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[y,[P,"OPPO"],[R,V]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[y,[P,"Vivo"],[R,V]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[y,[P,"Realme"],[R,V]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[y,[P,Js],[R,V]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[y,[P,Js],[R,q]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[y,[P,Zr],[R,q]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[y,[P,Zr],[R,V]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[y,[P,"Lenovo"],[R,q]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[y,/_/g," "],[P,"Nokia"],[R,V]],[/(pixel c)\b/i],[y,[P,Sn],[R,q]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[y,[P,Sn],[R,V]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[y,[P,We],[R,V]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[y,"Xperia Tablet"],[P,We],[R,q]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[y,[P,"OnePlus"],[R,V]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[y,[P,Ee],[R,q]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[y,/(.+)/g,"Fire Phone $1"],[P,Ee],[R,V]],[/(playbook);[-\w\),; ]+(rim)/i],[y,P,[R,q]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[y,[P,Ye],[R,V]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[y,[P,ke],[R,q]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[y,[P,ke],[R,V]],[/(nexus 9)/i],[y,[P,"HTC"],[R,q]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[P,[y,/_/g," "],[R,V]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[y,[P,"Acer"],[R,q]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[y,[P,"Meizu"],[R,V]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[P,y,[R,V]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[P,y,[R,q]],[/(surface duo)/i],[y,[P,Wr],[R,q]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[y,[P,"Fairphone"],[R,V]],[/(u304aa)/i],[y,[P,"AT&T"],[R,V]],[/\bsie-(\w*)/i],[y,[P,"Siemens"],[R,V]],[/\b(rct\w+) b/i],[y,[P,"RCA"],[R,q]],[/\b(venue[\d ]{2,7}) b/i],[y,[P,"Dell"],[R,q]],[/\b(q(?:mv|ta)\w+) b/i],[y,[P,"Verizon"],[R,q]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[y,[P,"Barnes & Noble"],[R,q]],[/\b(tm\d{3}\w+) b/i],[y,[P,"NuVision"],[R,q]],[/\b(k88) b/i],[y,[P,"ZTE"],[R,q]],[/\b(nx\d{3}j) b/i],[y,[P,"ZTE"],[R,V]],[/\b(gen\d{3}) b.+49h/i],[y,[P,"Swiss"],[R,V]],[/\b(zur\d{3}) b/i],[y,[P,"Swiss"],[R,q]],[/\b((zeki)?tb.*\b) b/i],[y,[P,"Zeki"],[R,q]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[P,"Dragon Touch"],y,[R,q]],[/\b(ns-?\w{0,9}) b/i],[y,[P,"Insignia"],[R,q]],[/\b((nxa|next)-?\w{0,9}) b/i],[y,[P,"NextBook"],[R,q]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[P,"Voice"],y,[R,V]],[/\b(lvtel\-)?(v1[12]) b/i],[[P,"LvTel"],y,[R,V]],[/\b(ph-1) /i],[y,[P,"Essential"],[R,V]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[y,[P,"Envizen"],[R,q]],[/\b(trio[-\w\. ]+) b/i],[y,[P,"MachSpeed"],[R,q]],[/\btu_(1491) b/i],[y,[P,"Rotor"],[R,q]],[/(shield[\w ]+) b/i],[y,[P,"Nvidia"],[R,q]],[/(sprint) (\w+)/i],[P,y,[R,V]],[/(kin\.[onetw]{3})/i],[[y,/\./g," "],[P,Wr],[R,V]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[y,[P,ie],[R,q]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[y,[P,ie],[R,V]],[/smart-tv.+(samsung)/i],[P,[R,Y]],[/hbbtv.+maple;(\d+)/i],[[y,/^/,"SmartTV"],[P,ot],[R,Y]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[P,Zr],[R,Y]],[/(apple) ?tv/i],[P,[y,me+" TV"],[R,Y]],[/crkey/i],[[y,pt+"cast"],[P,Sn],[R,Y]],[/droid.+aft(\w)( bui|\))/i],[y,[P,Ee],[R,Y]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[y,[P,bt],[R,Y]],[/(bravia[\w ]+)( bui|\))/i],[y,[P,We],[R,Y]],[/(mitv-\w{5}) bui/i],[y,[P,x],[R,Y]],[/Hbbtv.*(technisat) (.*);/i],[P,y,[R,Y]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[P,rp],[y,rp],[R,Y]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[R,Y]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[P,y,[R,U]],[/droid.+; (shield) bui/i],[y,[P,"Nvidia"],[R,U]],[/(playstation [345portablevi]+)/i],[y,[P,We],[R,U]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[y,[P,Wr],[R,U]],[/((pebble))app/i],[P,y,[R,ce]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[y,[P,me],[R,ce]],[/droid.+; (glass) \d/i],[y,[P,Sn],[R,ce]],[/droid.+; (wt63?0{2,3})\)/i],[y,[P,ie],[R,ce]],[/(quest( 2| pro)?)/i],[y,[P,de],[R,ce]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[P,[R,_e]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[y,[R,V]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[y,[R,q]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[R,q]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[R,V]],[/(android[-\w\. ]{0,9});.+buil/i],[y,[P,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[k,[S,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[k,[S,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[S,k],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[k,S]],os:[[/microsoft (windows) (vista|xp)/i],[S,k],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[S,[k,ZT,XP]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[S,"Windows"],[k,ZT,XP]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[k,/_/g,"."],[S,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[S,Ht],[k,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[k,S],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[S,k],[/\(bb(10);/i],[k,[S,Ye]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[k,[S,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[k,[S,vn+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[k,[S,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[k,[S,"watchOS"]],[/crkey\/([\d\.]+)/i],[k,[S,pt+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[S,Qe],k],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[S,k],[/(sunos) ?([\w\.\d]*)/i],[[S,"Solaris"],k],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[S,k]]},wl=function(vi,zi){if(typeof vi===h&&(zi=vi,vi=s),!(this instanceof wl))return new wl(vi,zi).getResult();var vr=typeof o!==u&&o.navigator?o.navigator:s,rc=vi||(vr&&vr.userAgent?vr.userAgent:""),Ph=vr&&vr.userAgentData?vr.userAgentData:s,ei=zi?function(Vn,Ca){var Hm={};for(var Sd in Vn)Ca[Sd]&&Ca[Sd].length%2==0?Hm[Sd]=Ca[Sd].concat(Vn[Sd]):Hm[Sd]=Vn[Sd];return Hm}(JP,zi):JP;return this.getBrowser=function(){var Vn={};return Vn[S]=s,Vn[k]=s,Q_.call(Vn,rc,ei.browser),Vn[_]=function(Ca){return typeof Ca===m?Ca.replace(/[^\d\.]/g,"").split(".")[0]:s}(Vn[k]),vr&&vr.brave&&typeof vr.brave.isBrave==c&&(Vn[S]="Brave"),Vn},this.getCPU=function(){var Vn={};return Vn[z]=s,Q_.call(Vn,rc,ei.cpu),Vn},this.getDevice=function(){var Vn={};return Vn[P]=s,Vn[y]=s,Vn[R]=s,Q_.call(Vn,rc,ei.device),!Vn[R]&&Ph&&Ph.mobile&&(Vn[R]=V),Vn[y]=="Macintosh"&&vr&&typeof vr.standalone!==u&&vr.maxTouchPoints&&vr.maxTouchPoints>2&&(Vn[y]="iPad",Vn[R]=q),Vn},this.getEngine=function(){var Vn={};return Vn[S]=s,Vn[k]=s,Q_.call(Vn,rc,ei.engine),Vn},this.getOS=function(){var Vn={};return Vn[S]=s,Vn[k]=s,Q_.call(Vn,rc,ei.os),!Vn[S]&&Ph&&Ph.platform!="Unknown"&&(Vn[S]=Ph.platform.replace(/chrome os/i,Qe).replace(/macos/i,Ht)),Vn},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return rc},this.setUA=function(Vn){return rc=typeof Vn===m&&Vn.length>350?rp(Vn,350):Vn,this},this.setUA(rc),this};wl.VERSION="0.7.34",wl.BROWSER=tr([S,k,_]),wl.CPU=tr([z]),wl.DEVICE=tr([y,P,R,U,V,Y,q,ce,_e]),wl.ENGINE=wl.OS=tr([S,k]),e.exports&&(r=e.exports=wl),r.UAParser=wl;var Gm=typeof o!==u&&(o.jQuery||o.Zepto);if(Gm&&!Gm.ua){var Z_=new wl;Gm.ua=Z_.getResult(),Gm.ua.get=function(){return Z_.getUA()},Gm.ua.set=function(vi){Z_.setUA(vi);var zi=Z_.getResult();for(var vr in zi)Gm.ua[vr]=zi[vr]}}})(typeof window=="object"?window:a)})(YD,YD.exports);var Kle=l(YD.exports),qle=Ec,Yle=pi,Xle=Ut,Jle=Jd,Qle=dr("iterator"),Zle=Object,eue=function(e){if(Xle(e))return!1;var r=Zle(e);return r[Qle]!==void 0||"@@iterator"in r||Yle(Jle,qle(r))},tue=l(eue),c5=Ky.clear;xn({global:!0,bind:!0,forced:j.clearImmediate!==c5},{clearImmediate:c5});var nue=typeof Bun=="function"&&Bun&&typeof Bun.version=="string",l5=j,rue=te,iue=Me,oue=nue,sue=ir,aue=go,cue=hl,lue=l5.Function,uue=/MSIE .\./.test(sue)||oue&&function(){var e=l5.Bun.version.split(".");return e.length<3||e[0]==0&&(e[1]<3||e[1]==3&&e[2]==0)}(),due=xn,u5=j,d5=Ky.set,hue=function(e,r){var o=1;return uue?function(s,c){var u=cue(arguments.length,1)>o,h=iue(s)?s:lue(s),m=u?aue(arguments,o):[],_=u?function(){rue(h,this,m)}:h;return e(_)}:e},h5=u5.setImmediate?hue(d5):d5;due({global:!0,bind:!0,forced:u5.setImmediate!==h5},{setImmediate:h5});var f5=l(St.setImmediate),fue=xn,pue=Qa,mue=uo,gue=hl,_ue=Ef,Eue=j.process;fue({global:!0,dontCallGetSet:!0},{queueMicrotask:function(e){gue(arguments.length,1),mue(e);var r=_ue&&Eue.domain;pue(r?r.bind(e):e)}});var p5=l(St.queueMicrotask);function m5(e,r){return function(){return e.apply(r,arguments)}}const{toString:yue}=Object.prototype,{getPrototypeOf:XD}=Object,eA=(JD=Object.create(null),e=>{const r=yue.call(e);return JD[r]||(JD[r]=r.slice(8,-1).toLowerCase())});var JD;const cd=e=>(e=e.toLowerCase(),r=>eA(r)===e),tA=e=>r=>typeof r===e,{isArray:Ev}=Array,Jb=tA("undefined"),g5=cd("ArrayBuffer"),vue=tA("string"),pl=tA("function"),_5=tA("number"),nA=e=>e!==null&&typeof e=="object",rA=e=>{if(eA(e)!=="object")return!1;const r=XD(e);return!(r!==null&&r!==Object.prototype&&Object.getPrototypeOf(r)!==null||Symbol.toStringTag in e||tue(e))},Sue=cd("Date"),bue=cd("File"),Tue=cd("Blob"),wue=cd("FileList"),Rue=cd("URLSearchParams"),[Cue,Iue,Aue,Pue]=["ReadableStream","Request","Response","Headers"].map(cd);function Qb(e,r){let o,s,{allOwnKeys:c=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(e!=null)if(typeof e!="object"&&(e=[e]),Ev(e))for(o=0,s=e.length;o<s;o++)r.call(null,e[o],o,e);else{const u=c?Object.getOwnPropertyNames(e):Object.keys(e),h=u.length;let m;for(o=0;o<h;o++)m=u[o],r.call(null,e[m],m,e)}}function E5(e,r){r=r.toLowerCase();const o=Object.keys(e);let s,c=o.length;for(;c-- >0;)if(s=o[c],r===s.toLowerCase())return s;return null}const b_=a5!==void 0?a5:typeof self<"u"?self:typeof window<"u"?window:lE,y5=e=>!Jb(e)&&e!==b_,Oue=(QD=typeof Uint8Array<"u"&&XD(Uint8Array),e=>QD&&e instanceof QD);var QD;const kue=cd("HTMLFormElement"),v5=(e=>{let{hasOwnProperty:r}=e;return(o,s)=>r.call(o,s)})(Object.prototype),Nue=cd("RegExp"),S5=(e,r)=>{const o=Object.getOwnPropertyDescriptors(e),s={};Qb(o,(c,u)=>{let h;(h=r(c,u,e))!==!1&&(s[u]=h||c)}),Object.defineProperties(e,s)},ZD="abcdefghijklmnopqrstuvwxyz",b5="0123456789",T5={DIGIT:b5,ALPHA:ZD,ALPHA_DIGIT:ZD+ZD.toUpperCase()+b5},Due=cd("AsyncFunction"),w5=(R5=typeof f5=="function",C5=pl(b_.postMessage),R5?f5:C5?(eL="axios@".concat(Math.random()),iA=[],b_.addEventListener("message",e=>{let{source:r,data:o}=e;r===b_&&o===eL&&iA.length&&iA.shift()()},!1),e=>{iA.push(e),b_.postMessage(eL,"*")}):e=>setTimeout(e));var R5,C5,eL,iA;const Lue=p5!==void 0?p5.bind(b_):typeof process<"u"&&process.nextTick||w5;var ct={isArray:Ev,isArrayBuffer:g5,isBuffer:function(e){return e!==null&&!Jb(e)&&e.constructor!==null&&!Jb(e.constructor)&&pl(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let r;return e&&(typeof FormData=="function"&&e instanceof FormData||pl(e.append)&&((r=eA(e))==="formdata"||r==="object"&&pl(e.toString)&&e.toString()==="[object FormData]"))},isArrayBufferView:function(e){let r;return r=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&g5(e.buffer),r},isString:vue,isNumber:_5,isBoolean:e=>e===!0||e===!1,isObject:nA,isPlainObject:rA,isReadableStream:Cue,isRequest:Iue,isResponse:Aue,isHeaders:Pue,isUndefined:Jb,isDate:Sue,isFile:bue,isBlob:Tue,isRegExp:Nue,isFunction:pl,isStream:e=>nA(e)&&pl(e.pipe),isURLSearchParams:Rue,isTypedArray:Oue,isFileList:wue,forEach:Qb,merge:function e(){const{caseless:r}=y5(this)&&this||{},o={},s=(c,u)=>{const h=r&&E5(o,u)||u;rA(o[h])&&rA(c)?o[h]=e(o[h],c):rA(c)?o[h]=e({},c):Ev(c)?o[h]=c.slice():o[h]=c};for(let c=0,u=arguments.length;c<u;c++)arguments[c]&&Qb(arguments[c],s);return o},extend:function(e,r,o){let{allOwnKeys:s}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return Qb(r,(c,u)=>{o&&pl(c)?e[u]=m5(c,o):e[u]=c},{allOwnKeys:s}),e},trim:e=>es(e)?es(e).call(e):e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),inherits:(e,r,o,s)=>{e.prototype=Object.create(r.prototype,s),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:r.prototype}),o&&Object.assign(e.prototype,o)},toFlatObject:(e,r,o,s)=>{let c,u,h;const m={};if(r=r||{},e==null)return r;do{for(c=Object.getOwnPropertyNames(e),u=c.length;u-- >0;)h=c[u],s&&!s(h,e,r)||m[h]||(r[h]=e[h],m[h]=!0);e=o!==!1&&XD(e)}while(e&&(!o||o(e,r))&&e!==Object.prototype);return r},kindOf:eA,kindOfTest:cd,endsWith:(e,r,o)=>{e=String(e),(o===void 0||o>e.length)&&(o=e.length),o-=r.length;const s=e.indexOf(r,o);return s!==-1&&s===o},toArray:e=>{if(!e)return null;if(Ev(e))return e;let r=e.length;if(!_5(r))return null;const o=new Array(r);for(;r-- >0;)o[r]=e[r];return o},forEachEntry:(e,r)=>{const o=(e&&e[Symbol.iterator]).call(e);let s;for(;(s=o.next())&&!s.done;){const c=s.value;r.call(e,c[0],c[1])}},matchAll:(e,r)=>{let o;const s=[];for(;(o=e.exec(r))!==null;)s.push(o);return s},isHTMLForm:kue,hasOwnProperty:v5,hasOwnProp:v5,reduceDescriptors:S5,freezeMethods:e=>{S5(e,(r,o)=>{if(pl(e)&&["arguments","caller","callee"].indexOf(o)!==-1)return!1;const s=e[o];pl(s)&&(r.enumerable=!1,"writable"in r?r.writable=!1:r.set||(r.set=()=>{throw Error("Can not rewrite read-only method '"+o+"'")}))})},toObjectSet:(e,r)=>{const o={},s=c=>{c.forEach(u=>{o[u]=!0})};return Ev(e)?s(e):s(String(e).split(r)),o},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(r,o,s){return o.toUpperCase()+s}),noop:()=>{},toFiniteNumber:(e,r)=>e!=null&&Number.isFinite(e=+e)?e:r,findKey:E5,global:b_,isContextDefined:y5,ALPHABET:T5,generateString:function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:T5.ALPHA_DIGIT,o="";const{length:s}=r;for(;e--;)o+=r[Math.random()*s|0];return o},isSpecCompliantForm:function(e){return!!(e&&pl(e.append)&&e[Symbol.toStringTag]==="FormData"&&e[Symbol.iterator])},toJSONObject:e=>{const r=new Array(10),o=(s,c)=>{if(nA(s)){if(r.indexOf(s)>=0)return;if(!("toJSON"in s)){r[c]=s;const u=Ev(s)?[]:{};return Qb(s,(h,m)=>{const _=o(h,c+1);!Jb(_)&&(u[m]=_)}),r[c]=void 0,u}}return s};return o(e,0)},isAsyncFn:Due,isThenable:e=>e&&(nA(e)||pl(e))&&pl(e.then)&&pl(e.catch),setImmediate:w5,asap:Lue};function Zn(e,r,o,s,c){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",r&&(this.code=r),o&&(this.config=o),s&&(this.request=s),c&&(this.response=c,this.status=c.status?c.status:null)}ct.inherits(Zn,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:ct.toJSONObject(this.config),code:this.code,status:this.status}}});const I5=Zn.prototype,A5={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{A5[e]={value:e}}),Object.defineProperties(Zn,A5),Object.defineProperty(I5,"isAxiosError",{value:!0}),Zn.from=(e,r,o,s,c,u)=>{const h=Object.create(I5);return ct.toFlatObject(e,h,function(m){return m!==Error.prototype},m=>m!=="isAxiosError"),Zn.call(h,e.message,r,o,s,c),h.cause=e,h.name=e.name,u&&Object.assign(h,u),h};function tL(e){return ct.isPlainObject(e)||ct.isArray(e)}function P5(e){return ct.endsWith(e,"[]")?e.slice(0,-2):e}function O5(e,r,o){return e?e.concat(r).map(function(s,c){return s=P5(s),!o&&c?"["+s+"]":s}).join(o?".":""):r}const xue=ct.toFlatObject(ct,{},null,function(e){return/^is[A-Z]/.test(e)});function oA(e,r,o){if(!ct.isObject(e))throw new TypeError("target must be an object");r=r||new FormData;const s=(o=ct.toFlatObject(o,{metaTokens:!0,dots:!1,indexes:!1},!1,function(P,k){return!ct.isUndefined(k[P])})).metaTokens,c=o.visitor||y,u=o.dots,h=o.indexes,m=(o.Blob||typeof Blob<"u"&&Blob)&&ct.isSpecCompliantForm(r);if(!ct.isFunction(c))throw new TypeError("visitor must be a function");function _(P){if(P===null)return"";if(ct.isDate(P))return P.toISOString();if(!m&&ct.isBlob(P))throw new Zn("Blob is not supported. Use a Buffer instead.");return ct.isArrayBuffer(P)||ct.isTypedArray(P)?m&&typeof Blob=="function"?new Blob([P]):Buffer.from(P):P}function y(P,k,z){let U=P;if(P&&!z&&typeof P=="object"){if(ct.endsWith(k,"{}"))k=s?k:k.slice(0,-2),P=JSON.stringify(P);else if(ct.isArray(P)&&function(V){return ct.isArray(V)&&!V.some(tL)}(P)||(ct.isFileList(P)||ct.endsWith(k,"[]"))&&(U=ct.toArray(P)))return k=P5(k),U.forEach(function(V,q){!ct.isUndefined(V)&&V!==null&&r.append(h===!0?O5([k],q,u):h===null?k:k+"[]",_(V))}),!1}return!!tL(P)||(r.append(O5(z,k,u),_(P)),!1)}const S=[],R=Object.assign(xue,{defaultVisitor:y,convertValue:_,isVisitable:tL});if(!ct.isObject(e))throw new TypeError("data must be an object");return function P(k,z){if(!ct.isUndefined(k)){if(S.indexOf(k)!==-1)throw Error("Circular reference detected in "+z.join("."));S.push(k),ct.forEach(k,function(U,V){(!(ct.isUndefined(U)||U===null)&&c.call(r,U,ct.isString(V)?es(V).call(V):V,z,R))===!0&&P(U,z?z.concat(V):[V])}),S.pop()}}(e),r}function k5(e){const r={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(o){return r[o]})}function nL(e,r){this._pairs=[],e&&oA(e,this,r)}const N5=nL.prototype;function Mue(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function D5(e,r,o){if(!r)return e;const s=o&&o.encode||Mue;ct.isFunction(o)&&(o={serialize:o});const c=o&&o.serialize;let u;if(u=c?c(r,o):ct.isURLSearchParams(r)?r.toString():new nL(r,o).toString(s),u){const h=e.indexOf("#");h!==-1&&(e=e.slice(0,h)),e+=(e.indexOf("?")===-1?"?":"&")+u}return e}N5.append=function(e,r){this._pairs.push([e,r])},N5.toString=function(e){const r=e?function(o){return e.call(this,o,k5)}:k5;return this._pairs.map(function(o){return r(o[0])+"="+r(o[1])},"").join("&")};var L5=class{constructor(){this.handlers=[]}use(e,r,o){return this.handlers.push({fulfilled:e,rejected:r,synchronous:!!o&&o.synchronous,runWhen:o?o.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){ct.forEach(this.handlers,function(r){r!==null&&e(r)})}},x5={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},M5={exports:{}},Uue=xn,Vue=rt,U5=tt.f;Uue({target:"Object",stat:!0,forced:Object.defineProperty!==U5,sham:!Vue},{defineProperty:U5});var V5=St.Object,Fue=M5.exports=function(e,r,o){return V5.defineProperty(e,r,o)};V5.defineProperty.sham&&(Fue.sham=!0);var F5=l(M5.exports),jue=TypeError,j5=jg,Bue=l_,Wue=yt,zue=dr("species"),B5=Array,Gue=function(e){var r;return j5(e)&&(r=e.constructor,(Bue(r)&&(r===B5||j5(r.prototype))||Wue(r)&&(r=r[zue])===null)&&(r=void 0)),r===void 0?B5:r},W5=function(e,r){return new(Gue(e))(r===0?0:r)},Hue=d,$ue=ur,Kue=dr("species"),z5=function(e){return $ue>=51||!Hue(function(){var r=[];return(r.constructor={})[Kue]=function(){return{foo:1}},r[e](Boolean).foo!==1})},que=xn,Yue=d,Xue=jg,Jue=yt,Que=As,Zue=oi,G5=function(e){if(e>9007199254740991)throw jue("Maximum allowed index exceeded");return e},H5=xI,ede=W5,tde=z5,nde=ur,$5=dr("isConcatSpreadable"),rde=nde>=51||!Yue(function(){var e=[];return e[$5]=!1,e.concat()[0]!==e}),ide=function(e){if(!Jue(e))return!1;var r=e[$5];return r!==void 0?!!r:Xue(e)};que({target:"Array",proto:!0,forced:!rde||!tde("concat")},{concat:function(e){var r,o,s,c,u,h=Que(this),m=ede(h,0),_=0;for(r=-1,s=arguments.length;r<s;r++)if(ide(u=r===-1?h:arguments[r]))for(c=Zue(u),G5(_+c),o=0;o<c;o++,_++)o in u&&H5(m,_,u[o]);else G5(_+1),H5(m,_++,u);return m.length=_,m}});var K5={},ode=Z,sde=Re,q5=qd.f,ade=oD,Y5=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];K5.f=function(e){return Y5&&ode(e)=="Window"?function(r){try{return q5(r)}catch{return ade(Y5)}}(e):q5(sde(e))};var yv={},cde=dr;yv.f=cde;var X5=St,lde=pi,ude=yv,dde=tt.f,yo=function(e){var r=X5.Symbol||(X5.Symbol={});lde(r,e)||dde(r,e,{value:ude.f(e)})},hde=ye,fde=an,pde=dr,mde=ed,J5=function(){var e=fde("Symbol"),r=e&&e.prototype,o=r&&r.valueOf,s=pde("toPrimitive");r&&!r[s]&&mde(r,s,function(c){return hde(o,this)},{})},gde=De,_de=hn,Ede=As,yde=oi,vde=W5,Q5=A([].push),Sde=function(e){var r=e==1,o=e==2,s=e==3,c=e==4,u=e==6,h=e==7,m=e==5||u;return function(_,y,S,R){for(var P,k,z=Ede(_),U=_de(z),V=gde(y,S),q=yde(U),Y=0,ce=R||vde,_e=r?ce(_,q):o||h?ce(_,0):void 0;q>Y;Y++)if((m||Y in U)&&(k=V(P=U[Y],Y,z),e))if(r)_e[Y]=k;else if(k)switch(e){case 3:return!0;case 5:return P;case 6:return Y;case 2:Q5(_e,P)}else switch(e){case 4:return!1;case 7:Q5(_e,P)}return u?-1:s||c?c:_e}},Z5={forEach:Sde(0)},sA=xn,rL=j,iL=ye,bde=A,vv=rt,Sv=ds,Tde=d,Es=pi,wde=N,oL=cn,aA=Re,sL=Ha,Rde=ha,aL=et,Zb=js,e6=Sc,Cde=qd,t6=K5,Ide=vc,n6=He,r6=tt,Ade=sy,i6=Ne,o6=ed,Pde=Ny,cL=za,s6=yc,a6=Bd,Ode=dr,kde=yv,Nde=yo,Dde=J5,Lde=td,c6=Zu,cA=Z5.forEach,Oc=Wg("hidden"),lA="Symbol",eT="prototype",xde=c6.set,l6=c6.getterFor(lA),ld=Object[eT],T_=rL.Symbol,uA=T_&&T_[eT],Mde=rL.TypeError,lL=rL.QObject,u6=n6.f,w_=r6.f,d6=t6.f,Ude=i6.f,h6=bde([].push),Bf=cL("symbols"),tT=cL("op-symbols"),Vde=cL("wks"),uL=!lL||!lL[eT]||!lL[eT].findChild,dL=vv&&Tde(function(){return Zb(w_({},"a",{get:function(){return w_(this,"a",{value:7}).a}})).a!=7})?function(e,r,o){var s=u6(ld,r);s&&delete ld[r],w_(e,r,o),s&&e!==ld&&w_(ld,r,s)}:w_,hL=function(e,r){var o=Bf[e]=Zb(uA);return xde(o,{type:lA,tag:e,description:r}),vv||(o.description=r),o},dA=function(e,r,o){e===ld&&dA(tT,r,o),oL(e);var s=sL(r);return oL(o),Es(Bf,s)?(o.enumerable?(Es(e,Oc)&&e[Oc][s]&&(e[Oc][s]=!1),o=Zb(o,{enumerable:aL(0,!1)})):(Es(e,Oc)||w_(e,Oc,aL(1,{})),e[Oc][s]=!0),dL(e,s,o)):w_(e,s,o)},fL=function(e,r){oL(e);var o=aA(r),s=e6(o).concat(g6(o));return cA(s,function(c){vv&&!iL(f6,o,c)||dA(e,c,o[c])}),e},f6=function(e){var r=sL(e),o=iL(Ude,this,r);return!(this===ld&&Es(Bf,r)&&!Es(tT,r))&&(!(o||!Es(this,r)||!Es(Bf,r)||Es(this,Oc)&&this[Oc][r])||o)},p6=function(e,r){var o=aA(e),s=sL(r);if(o!==ld||!Es(Bf,s)||Es(tT,s)){var c=u6(o,s);return!c||!Es(Bf,s)||Es(o,Oc)&&o[Oc][s]||(c.enumerable=!0),c}},m6=function(e){var r=d6(aA(e)),o=[];return cA(r,function(s){Es(Bf,s)||Es(s6,s)||h6(o,s)}),o},g6=function(e){var r=e===ld,o=d6(r?tT:aA(e)),s=[];return cA(o,function(c){!Es(Bf,c)||r&&!Es(ld,c)||h6(s,Bf[c])}),s};Sv||(T_=function(){if(wde(uA,this))throw Mde("Symbol is not a constructor");var e=arguments.length&&arguments[0]!==void 0?Rde(arguments[0]):void 0,r=a6(e),o=function(s){this===ld&&iL(o,tT,s),Es(this,Oc)&&Es(this[Oc],r)&&(this[Oc][r]=!1),dL(this,r,aL(1,s))};return vv&&uL&&dL(ld,r,{configurable:!0,set:o}),hL(r,e)},o6(uA=T_[eT],"toString",function(){return l6(this).tag}),o6(T_,"withoutSetter",function(e){return hL(a6(e),e)}),i6.f=f6,r6.f=dA,Ade.f=fL,n6.f=p6,Cde.f=t6.f=m6,Ide.f=g6,kde.f=function(e){return hL(Ode(e),e)},vv&&Pde(uA,"description",{configurable:!0,get:function(){return l6(this).description}})),sA({global:!0,wrap:!0,forced:!Sv,sham:!Sv},{Symbol:T_}),cA(e6(Vde),function(e){Nde(e)}),sA({target:lA,stat:!0,forced:!Sv},{useSetter:function(){uL=!0},useSimple:function(){uL=!1}}),sA({target:"Object",stat:!0,forced:!Sv,sham:!vv},{create:function(e,r){return r===void 0?Zb(e):fL(Zb(e),r)},defineProperty:dA,defineProperties:fL,getOwnPropertyDescriptor:p6}),sA({target:"Object",stat:!0,forced:!Sv},{getOwnPropertyNames:m6}),Dde(),Lde(T_,lA),s6[Oc]=!0;var _6=ds&&!!Symbol.for&&!!Symbol.keyFor,Fde=xn,jde=an,Bde=pi,Wde=ha,E6=za,zde=_6,pL=E6("string-to-symbol-registry"),Gde=E6("symbol-to-string-registry");Fde({target:"Symbol",stat:!0,forced:!zde},{for:function(e){var r=Wde(e);if(Bde(pL,r))return pL[r];var o=jde("Symbol")(r);return pL[r]=o,Gde[o]=r,o}});var Hde=xn,$de=pi,Kde=rl,qde=dc,Yde=_6,y6=za("symbol-to-string-registry");Hde({target:"Symbol",stat:!0,forced:!Yde},{keyFor:function(e){if(!Kde(e))throw TypeError(qde(e)+" is not a symbol");if($de(y6,e))return y6[e]}});var v6=jg,Xde=Me,S6=Z,Jde=ha,b6=A([].push),Qde=xn,T6=an,w6=te,Zde=ye,nT=A,R6=d,C6=Me,I6=rl,A6=go,ehe=function(e){if(Xde(e))return e;if(v6(e)){for(var r=e.length,o=[],s=0;s<r;s++){var c=e[s];typeof c=="string"?b6(o,c):typeof c!="number"&&S6(c)!="Number"&&S6(c)!="String"||b6(o,Jde(c))}var u=o.length,h=!0;return function(m,_){if(h)return h=!1,_;if(v6(this))return _;for(var y=0;y<u;y++)if(o[y]===m)return _}}},the=ds,nhe=String,wm=T6("JSON","stringify"),hA=nT(/./.exec),P6=nT("".charAt),rhe=nT("".charCodeAt),ihe=nT("".replace),ohe=nT(1 .toString),she=/[\uD800-\uDFFF]/g,O6=/^[\uD800-\uDBFF]$/,k6=/^[\uDC00-\uDFFF]$/,N6=!the||R6(function(){var e=T6("Symbol")();return wm([e])!="[null]"||wm({a:e})!="{}"||wm(Object(e))!="{}"}),D6=R6(function(){return wm("\uDF06\uD834")!=='"\\udf06\\ud834"'||wm("\uDEAD")!=='"\\udead"'}),ahe=function(e,r){var o=A6(arguments),s=ehe(r);if(C6(s)||e!==void 0&&!I6(e))return o[1]=function(c,u){if(C6(s)&&(u=Zde(s,this,nhe(c),u)),!I6(u))return u},w6(wm,null,o)},che=function(e,r,o){var s=P6(o,r-1),c=P6(o,r+1);return hA(O6,e)&&!hA(k6,c)||hA(k6,e)&&!hA(O6,s)?"\\u"+ohe(rhe(e,0),16):e};wm&&Qde({target:"JSON",stat:!0,forced:N6||D6},{stringify:function(e,r,o){var s=A6(arguments),c=w6(N6?ahe:wm,null,s);return D6&&typeof c=="string"?ihe(c,she,che):c}});var L6=vc,lhe=As;xn({target:"Object",stat:!0,forced:!ds||d(function(){L6.f(1)})},{getOwnPropertySymbols:function(e){var r=L6.f;return r?r(lhe(e)):[]}}),yo("asyncIterator"),yo("hasInstance"),yo("isConcatSpreadable"),yo("iterator"),yo("match"),yo("matchAll"),yo("replace"),yo("search"),yo("species"),yo("split");var uhe=J5;yo("toPrimitive"),uhe();var dhe=an,hhe=td;yo("toStringTag"),hhe(dhe("Symbol"),"Symbol"),yo("unscopables"),td(j.JSON,"JSON",!0);var fhe=St.Symbol,phe=dr,mhe=tt.f,x6=phe("metadata"),M6=Function.prototype;M6[x6]===void 0&&mhe(M6,x6,{value:null}),yo("dispose"),yo("metadata");var ghe=fhe;yo("asyncDispose");var _he=A,mL=an("Symbol"),Ehe=mL.keyFor,yhe=_he(mL.prototype.valueOf),U6=mL.isRegisteredSymbol||function(e){try{return Ehe(yhe(e))!==void 0}catch{return!1}};xn({target:"Symbol",stat:!0},{isRegisteredSymbol:U6});for(var vhe=za,V6=an,She=A,bhe=rl,The=dr,fA=V6("Symbol"),F6=fA.isWellKnownSymbol,j6=V6("Object","getOwnPropertyNames"),whe=She(fA.prototype.valueOf),B6=vhe("wks"),gL=0,W6=j6(fA),Rhe=W6.length;gL<Rhe;gL++)try{var z6=W6[gL];bhe(fA[z6])&&The(z6)}catch{}var G6=function(e){if(F6&&F6(e))return!0;try{for(var r=whe(e),o=0,s=j6(B6),c=s.length;o<c;o++)if(B6[s[o]]==r)return!0}catch{}return!1};xn({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:G6}),yo("matcher"),yo("observable"),xn({target:"Symbol",stat:!0},{isRegistered:U6}),xn({target:"Symbol",stat:!0,forced:!0},{isWellKnown:G6}),yo("metadataKey"),yo("patternMatch"),yo("replaceAll");var bv=l(ghe),H6=l(yv.f("iterator"));function rT(e){return rT=typeof bv=="function"&&typeof H6=="symbol"?function(r){return typeof r}:function(r){return r&&typeof bv=="function"&&r.constructor===bv&&r!==bv.prototype?"symbol":typeof r},rT(e)}var Che=l(yv.f("toPrimitive"));function Ihe(e){var r=function(o,s){if(rT(o)!=="object"||o===null)return o;var c=o[Che];if(c!==void 0){var u=c.call(o,s);if(rT(u)!=="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return(s==="string"?String:Number)(o)}(e,"string");return rT(r)==="symbol"?r:String(r)}function $(e,r,o){return(r=Ihe(r))in e?F5(e,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[r]=o,e}var $6=l(ace),Ahe={isBrowser:!0,classes:{URLSearchParams:$6!==void 0?$6:nL,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const _L=typeof window<"u"&&typeof document<"u",EL=typeof navigator=="object"&&navigator||void 0,Phe=_L&&(!EL||["ReactNative","NativeScript","NS"].indexOf(EL.product)<0),Ohe=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",khe=_L&&window.location.href||"http://localhost";function K6(e,r){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),o.push.apply(o,s)}return o}function q6(e){for(var r=1;r<arguments.length;r++){var o=arguments[r]!=null?arguments[r]:{};r%2?K6(Object(o),!0).forEach(function(s){$(e,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):K6(Object(o)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(o,s))})}return e}var va=q6(q6({},Object.freeze({__proto__:null,hasBrowserEnv:_L,hasStandardBrowserEnv:Phe,hasStandardBrowserWebWorkerEnv:Ohe,navigator:EL,origin:khe})),Ahe),Nhe=cn,Dhe=ye,Lhe=pi,xhe=N,Mhe=function(){var e=Nhe(this),r="";return e.hasIndices&&(r+="d"),e.global&&(r+="g"),e.ignoreCase&&(r+="i"),e.multiline&&(r+="m"),e.dotAll&&(r+="s"),e.unicode&&(r+="u"),e.unicodeSets&&(r+="v"),e.sticky&&(r+="y"),r},Y6=RegExp.prototype,X6=function(e){var r=e.flags;return r!==void 0||"flags"in Y6||Lhe(e,"flags")||!xhe(Y6,e)?r:Dhe(Mhe,e)},Uhe=eD.charAt,J6=ye,Vhe=cn,Fhe=Me,jhe=Z,Bhe=/./.exec,Whe=TypeError,zhe=xn,Q6=ye,Z6=se,Ghe=wy,pA=Py,eW=Xt,tW=xt,iT=ha,Hhe=cn,$he=Ut,Khe=Z,qhe=mC,nW=X6,Yhe=hc,Xhe=d,Jhe=Xi,Qhe=function(e,r,o){return r+(o?Uhe(e,r).length:1)},Zhe=function(e,r){var o=e.exec;if(Fhe(o)){var s=J6(o,e,r);return s!==null&&Vhe(s),s}if(jhe(e)==="RegExp")return J6(Bhe,e,r);throw Whe("RegExp#exec called on incompatible receiver")},rW=Zu,efe=dr("matchAll"),iW="RegExp String",oW=iW+" Iterator",tfe=rW.set,nfe=rW.getterFor(oW),rfe=TypeError,yL=Z6("".indexOf),mA=Z6("".matchAll),vL=!!mA&&!Xhe(function(){mA("a",/./)}),ife=Ghe(function(e,r,o,s){tfe(this,{type:oW,regexp:e,string:r,global:o,unicode:s,done:!1})},iW,function(){var e=nfe(this);if(e.done)return pA(void 0,!0);var r=e.regexp,o=e.string,s=Zhe(r,o);return s===null?(e.done=!0,pA(void 0,!0)):e.global?(iT(s[0])===""&&(r.lastIndex=Qhe(o,tW(r.lastIndex),e.unicode)),pA(s,!1)):(e.done=!0,pA(s,!1))}),sW=function(e){var r,o,s,c=Hhe(this),u=iT(e),h=Jhe(c,RegExp),m=iT(nW(c));return r=new h(h===RegExp?c.source:c,m),o=!!~yL(m,"g"),s=!!~yL(m,"u"),r.lastIndex=tW(c.lastIndex),new ife(r,u,o,s)};zhe({target:"String",proto:!0,forced:vL},{matchAll:function(e){var r,o,s,c,u=eW(this);if($he(e)){if(vL)return mA(u,e)}else{if(qhe(e)&&(r=iT(eW(nW(e))),!~yL(r,"g")))throw rfe("`.matchAll` does not allow non-global regexes");if(vL)return mA(u,e);if((s=Yhe(e,efe))===void 0&&Khe(e)=="RegExp"&&(s=sW),s)return Q6(s,e,u)}return o=iT(u),c=new RegExp(e,"g"),Q6(sW,c,o)}});var ofe=Ka("String").matchAll,sfe=N,afe=ofe,SL=String.prototype,cfe=function(e){var r=e.matchAll;return typeof e=="string"||e===SL||sfe(SL,e)&&r===SL.matchAll?afe:r},lfe=l(cfe);function aW(e){function r(o,s,c,u){let h=o[u++];if(h==="__proto__")return!0;const m=Number.isFinite(+h),_=u>=o.length;return h=!h&&ct.isArray(c)?c.length:h,_?(ct.hasOwnProp(c,h)?c[h]=[c[h],s]:c[h]=s,!m):(c[h]&&ct.isObject(c[h])||(c[h]=[]),r(o,s,c[h],u)&&ct.isArray(c[h])&&(c[h]=function(y){const S={},R=Object.keys(y);let P;const k=R.length;let z;for(P=0;P<k;P++)z=R[P],S[z]=y[z];return S}(c[h])),!m)}if(ct.isFormData(e)&&ct.isFunction(e.entries)){const o={};return ct.forEachEntry(e,(s,c)=>{r(function(u){return lfe(ct).call(ct,/\w+|\[(\w*)]/g,u).map(h=>h[0]==="[]"?"":h[1]||h[0])}(s),c,o,0)}),o}return null}const bL={transitional:x5,adapter:["xhr","http","fetch"],transformRequest:[function(e,r){const o=r.getContentType()||"",s=o.indexOf("application/json")>-1,c=ct.isObject(e);if(c&&ct.isHTMLForm(e)&&(e=new FormData(e)),ct.isFormData(e))return s?JSON.stringify(aW(e)):e;if(ct.isArrayBuffer(e)||ct.isBuffer(e)||ct.isStream(e)||ct.isFile(e)||ct.isBlob(e)||ct.isReadableStream(e))return e;if(ct.isArrayBufferView(e))return e.buffer;if(ct.isURLSearchParams(e))return r.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let u;if(c){if(o.indexOf("application/x-www-form-urlencoded")>-1)return function(h,m){return oA(h,new va.classes.URLSearchParams,Object.assign({visitor:function(_,y,S,R){return va.isNode&&ct.isBuffer(_)?(this.append(y,_.toString("base64")),!1):R.defaultVisitor.apply(this,arguments)}},m))}(e,this.formSerializer).toString();if((u=ct.isFileList(e))||o.indexOf("multipart/form-data")>-1){const h=this.env&&this.env.FormData;return oA(u?{"files[]":e}:e,h&&new h,this.formSerializer)}}return c||s?(r.setContentType("application/json",!1),function(h,m,_){if(ct.isString(h))try{return(m||JSON.parse)(h),es(ct).call(ct,h)}catch(y){if(y.name!=="SyntaxError")throw y}return(_||JSON.stringify)(h)}(e)):e}],transformResponse:[function(e){const r=this.transitional||bL.transitional,o=r&&r.forcedJSONParsing,s=this.responseType==="json";if(ct.isResponse(e)||ct.isReadableStream(e))return e;if(e&&ct.isString(e)&&(o&&!this.responseType||s)){const c=!(r&&r.silentJSONParsing)&&s;try{return JSON.parse(e)}catch(u){if(c)throw u.name==="SyntaxError"?Zn.from(u,Zn.ERR_BAD_RESPONSE,this,null,this.response):u}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:va.classes.FormData,Blob:va.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};ct.forEach(["delete","get","head","post","put","patch"],e=>{bL.headers[e]={}});var TL=bL;const ufe=ct.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),cW=Symbol("internals");function oT(e){var r;return e&&es(r=String(e)).call(r).toLowerCase()}function gA(e){return e===!1||e==null?e:ct.isArray(e)?e.map(gA):String(e)}function wL(e,r,o,s,c){return ct.isFunction(s)?s.call(this,r,o):(c&&(r=o),ct.isString(r)?ct.isString(s)?r.indexOf(s)!==-1:ct.isRegExp(s)?s.test(r):void 0:void 0)}class _A{constructor(r){r&&this.set(r)}set(r,o,s){const c=this;function u(_,y,S){const R=oT(y);if(!R)throw new Error("header name must be a non-empty string");const P=ct.findKey(c,R);(!P||c[P]===void 0||S===!0||S===void 0&&c[P]!==!1)&&(c[P||y]=gA(_))}const h=(_,y)=>ct.forEach(_,(S,R)=>u(S,R,y));if(ct.isPlainObject(r)||r instanceof this.constructor)h(r,o);else if(ct.isString(r)&&(r=es(r).call(r))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(es(m=r).call(m)))h((_=>{const y={};let S,R,P;return _&&_.split(`
`).forEach(function(k){var z,U;P=k.indexOf(":"),S=es(z=k.substring(0,P)).call(z).toLowerCase(),R=es(U=k.substring(P+1)).call(U),!S||y[S]&&ufe[S]||(S==="set-cookie"?y[S]?y[S].push(R):y[S]=[R]:y[S]=y[S]?y[S]+", "+R:R)}),y})(r),o);else if(ct.isHeaders(r))for(const[_,y]of r.entries())u(y,_,s);else r!=null&&u(o,r,s);var m;return this}get(r,o){if(r=oT(r)){const s=ct.findKey(this,r);if(s){const c=this[s];if(!o)return c;if(o===!0)return function(u){const h=Object.create(null),m=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let _;for(;_=m.exec(u);)h[_[1]]=_[2];return h}(c);if(ct.isFunction(o))return o.call(this,c,s);if(ct.isRegExp(o))return o.exec(c);throw new TypeError("parser must be boolean|regexp|function")}}}has(r,o){if(r=oT(r)){const s=ct.findKey(this,r);return!(!s||this[s]===void 0||o&&!wL(0,this[s],s,o))}return!1}delete(r,o){const s=this;let c=!1;function u(h){if(h=oT(h)){const m=ct.findKey(s,h);!m||o&&!wL(0,s[m],m,o)||(delete s[m],c=!0)}}return ct.isArray(r)?r.forEach(u):u(r),c}clear(r){const o=Object.keys(this);let s=o.length,c=!1;for(;s--;){const u=o[s];r&&!wL(0,this[u],u,r,!0)||(delete this[u],c=!0)}return c}normalize(r){const o=this,s={};return ct.forEach(this,(c,u)=>{var h;const m=ct.findKey(s,u);if(m)return o[m]=gA(c),void delete o[u];const _=r?function(y){return es(y).call(y).toLowerCase().replace(/([a-z\d])(\w*)/g,(S,R,P)=>R.toUpperCase()+P)}(u):es(h=String(u)).call(h);_!==u&&delete o[u],o[_]=gA(c),s[_]=!0}),this}concat(){for(var r=arguments.length,o=new Array(r),s=0;s<r;s++)o[s]=arguments[s];return this.constructor.concat(this,...o)}toJSON(r){const o=Object.create(null);return ct.forEach(this,(s,c)=>{s!=null&&s!==!1&&(o[c]=r&&ct.isArray(s)?s.join(", "):s)}),o}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(r=>{let[o,s]=r;return o+": "+s}).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(r){return r instanceof this?r:new this(r)}static concat(r){const o=new this(r);for(var s=arguments.length,c=new Array(s>1?s-1:0),u=1;u<s;u++)c[u-1]=arguments[u];return c.forEach(h=>o.set(h)),o}static accessor(r){const o=(this[cW]=this[cW]={accessors:{}}).accessors,s=this.prototype;function c(u){const h=oT(u);o[h]||(function(m,_){const y=ct.toCamelCase(" "+_);["get","set","has"].forEach(S=>{Object.defineProperty(m,S+y,{value:function(R,P,k){return this[S].call(this,_,R,P,k)},configurable:!0})})}(s,u),o[h]=!0)}return ct.isArray(r)?r.forEach(c):c(r),this}}_A.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),ct.reduceDescriptors(_A.prototype,(e,r)=>{let{value:o}=e,s=r[0].toUpperCase()+r.slice(1);return{get:()=>o,set(c){this[s]=c}}}),ct.freezeMethods(_A);var ud=_A;function RL(e,r){const o=this||TL,s=r||o,c=ud.from(s.headers);let u=s.data;return ct.forEach(e,function(h){u=h.call(o,u,c.normalize(),r?r.status:void 0)}),c.normalize(),u}function lW(e){return!(!e||!e.__CANCEL__)}function Tv(e,r,o){Zn.call(this,e??"canceled",Zn.ERR_CANCELED,r,o),this.name="CanceledError"}function uW(e,r,o){const s=o.config.validateStatus;o.status&&s&&!s(o.status)?r(new Zn("Request failed with status code "+o.status,[Zn.ERR_BAD_REQUEST,Zn.ERR_BAD_RESPONSE][Math.floor(o.status/100)-4],o.config,o.request,o)):e(o)}ct.inherits(Tv,Zn,{__CANCEL__:!0});const EA=function(e,r){let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,s=0;const c=function(u,h){u=u||10;const m=new Array(u),_=new Array(u);let y,S=0,R=0;return h=h!==void 0?h:1e3,function(P){const k=Date.now(),z=_[R];y||(y=k),m[S]=P,_[S]=k;let U=R,V=0;for(;U!==S;)V+=m[U++],U%=u;if(S=(S+1)%u,S===R&&(R=(R+1)%u),k-y<h)return;const q=z&&k-z;return q?Math.round(1e3*V/q):void 0}}(50,250);return function(u,h){let m,_,y=0,S=1e3/h;const R=function(P){y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),m=null,_&&(clearTimeout(_),_=null),u.apply(null,P)};return[function(){const P=Date.now(),k=P-y;for(var z=arguments.length,U=new Array(z),V=0;V<z;V++)U[V]=arguments[V];k>=S?R(U,P):(m=U,_||(_=setTimeout(()=>{_=null,R(m)},S-k)))},()=>m&&R(m)]}(u=>{const h=u.loaded,m=u.lengthComputable?u.total:void 0,_=h-s,y=c(_);s=h,e({loaded:h,total:m,progress:m?h/m:void 0,bytes:_,rate:y||void 0,estimated:y&&m&&h<=m?(m-h)/y:void 0,event:u,lengthComputable:m!=null,[r?"download":"upload"]:!0})},o)},dW=(e,r)=>{const o=e!=null;return[s=>r[0]({lengthComputable:o,total:e,loaded:s}),r[1]]},hW=e=>function(){for(var r=arguments.length,o=new Array(r),s=0;s<r;s++)o[s]=arguments[s];return ct.asap(()=>e(...o))};var dfe=va.hasStandardBrowserEnv?((e,r)=>o=>(o=new KI(o,va.origin),e.protocol===o.protocol&&e.host===o.host&&(r||e.port===o.port)))(new KI(va.origin),va.navigator&&/(msie|trident)/i.test(va.navigator.userAgent)):()=>!0,hfe=va.hasStandardBrowserEnv?{write(e,r,o,s,c,u){const h=[e+"="+encodeURIComponent(r)];ct.isNumber(o)&&h.push("expires="+new Date(o).toGMTString()),ct.isString(s)&&h.push("path="+s),ct.isString(c)&&h.push("domain="+c),u===!0&&h.push("secure"),document.cookie=h.join("; ")},read(e){const r=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return r?decodeURIComponent(r[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function fW(e,r){return e&&!function(o){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(o)}(r)?function(o,s){return s?o.replace(/\/?\/$/,"")+"/"+s.replace(/^\/+/,""):o}(e,r):r}function pW(e,r){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),o.push.apply(o,s)}return o}const mW=e=>e instanceof ud?function(r){for(var o=1;o<arguments.length;o++){var s=arguments[o]!=null?arguments[o]:{};o%2?pW(Object(s),!0).forEach(function(c){$(r,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(s)):pW(Object(s)).forEach(function(c){Object.defineProperty(r,c,Object.getOwnPropertyDescriptor(s,c))})}return r}({},e):e;function R_(e,r){r=r||{};const o={};function s(y,S,R,P){return ct.isPlainObject(y)&&ct.isPlainObject(S)?ct.merge.call({caseless:P},y,S):ct.isPlainObject(S)?ct.merge({},S):ct.isArray(S)?S.slice():S}function c(y,S,R,P){return ct.isUndefined(S)?ct.isUndefined(y)?void 0:s(void 0,y,0,P):s(y,S,0,P)}function u(y,S){if(!ct.isUndefined(S))return s(void 0,S)}function h(y,S){return ct.isUndefined(S)?ct.isUndefined(y)?void 0:s(void 0,y):s(void 0,S)}function m(y,S,R){return R in r?s(y,S):R in e?s(void 0,y):void 0}const _={url:u,method:u,data:u,baseURL:h,transformRequest:h,transformResponse:h,paramsSerializer:h,timeout:h,timeoutMessage:h,withCredentials:h,withXSRFToken:h,adapter:h,responseType:h,xsrfCookieName:h,xsrfHeaderName:h,onUploadProgress:h,onDownloadProgress:h,decompress:h,maxContentLength:h,maxBodyLength:h,beforeRedirect:h,transport:h,httpAgent:h,httpsAgent:h,cancelToken:h,socketPath:h,responseEncoding:h,validateStatus:m,headers:(y,S,R)=>c(mW(y),mW(S),0,!0)};return ct.forEach(Object.keys(Object.assign({},e,r)),function(y){const S=_[y]||c,R=S(e[y],r[y],y);ct.isUndefined(R)&&S!==m||(o[y]=R)}),o}var gW=e=>{const r=R_({},e);let o,{data:s,withXSRFToken:c,xsrfHeaderName:u,xsrfCookieName:h,headers:m,auth:_}=r;if(r.headers=m=ud.from(m),r.url=D5(fW(r.baseURL,r.url),e.params,e.paramsSerializer),_&&m.set("Authorization","Basic "+btoa((_.username||"")+":"+(_.password?unescape(encodeURIComponent(_.password)):""))),ct.isFormData(s)){if(va.hasStandardBrowserEnv||va.hasStandardBrowserWebWorkerEnv)m.setContentType(void 0);else if((o=m.getContentType())!==!1){const[y,...S]=o?o.split(";").map(R=>es(R).call(R)).filter(Boolean):[];m.setContentType([y||"multipart/form-data",...S].join("; "))}}if(va.hasStandardBrowserEnv&&(c&&ct.isFunction(c)&&(c=c(r)),c||c!==!1&&dfe(r.url))){const y=u&&h&&hfe.read(h);y&&m.set(u,y)}return r},ffe=typeof XMLHttpRequest<"u"&&function(e){return new lt(function(r,o){const s=gW(e);let c=s.data;const u=ud.from(s.headers).normalize();let h,m,_,y,S,{responseType:R,onUploadProgress:P,onDownloadProgress:k}=s;function z(){y&&y(),S&&S(),s.cancelToken&&s.cancelToken.unsubscribe(h),s.signal&&s.signal.removeEventListener("abort",h)}let U=new XMLHttpRequest;function V(){if(!U)return;const Y=ud.from("getAllResponseHeaders"in U&&U.getAllResponseHeaders());uW(function(ce){r(ce),z()},function(ce){o(ce),z()},{data:R&&R!=="text"&&R!=="json"?U.response:U.responseText,status:U.status,statusText:U.statusText,headers:Y,config:e,request:U}),U=null}U.open(s.method.toUpperCase(),s.url,!0),U.timeout=s.timeout,"onloadend"in U?U.onloadend=V:U.onreadystatechange=function(){U&&U.readyState===4&&(U.status!==0||U.responseURL&&U.responseURL.indexOf("file:")===0)&&setTimeout(V)},U.onabort=function(){U&&(o(new Zn("Request aborted",Zn.ECONNABORTED,e,U)),U=null)},U.onerror=function(){o(new Zn("Network Error",Zn.ERR_NETWORK,e,U)),U=null},U.ontimeout=function(){let Y=s.timeout?"timeout of "+s.timeout+"ms exceeded":"timeout exceeded";const ce=s.transitional||x5;s.timeoutErrorMessage&&(Y=s.timeoutErrorMessage),o(new Zn(Y,ce.clarifyTimeoutError?Zn.ETIMEDOUT:Zn.ECONNABORTED,e,U)),U=null},c===void 0&&u.setContentType(null),"setRequestHeader"in U&&ct.forEach(u.toJSON(),function(Y,ce){U.setRequestHeader(ce,Y)}),ct.isUndefined(s.withCredentials)||(U.withCredentials=!!s.withCredentials),R&&R!=="json"&&(U.responseType=s.responseType),k&&([_,S]=EA(k,!0),U.addEventListener("progress",_)),P&&U.upload&&([m,y]=EA(P),U.upload.addEventListener("progress",m),U.upload.addEventListener("loadend",y)),(s.cancelToken||s.signal)&&(h=Y=>{U&&(o(!Y||Y.type?new Tv(null,e,U):Y),U.abort(),U=null)},s.cancelToken&&s.cancelToken.subscribe(h),s.signal&&(s.signal.aborted?h():s.signal.addEventListener("abort",h)));const q=function(Y){const ce=/^([-+\w]{1,25})(:?\/\/|:)/.exec(Y);return ce&&ce[1]||""}(s.url);q&&va.protocols.indexOf(q)===-1?o(new Zn("Unsupported protocol "+q+":",Zn.ERR_BAD_REQUEST,e)):U.send(c||null)})},pfe=(e,r)=>{const{length:o}=e=e?e.filter(Boolean):[];if(r||o){let s,c=new AbortController;const u=function(y){if(!s){s=!0,m();const S=y instanceof Error?y:this.reason;c.abort(S instanceof Zn?S:new Tv(S instanceof Error?S.message:S))}};let h=r&&setTimeout(()=>{h=null,u(new Zn("timeout ".concat(r," of ms exceeded"),Zn.ETIMEDOUT))},r);const m=()=>{e&&(h&&clearTimeout(h),h=null,e.forEach(y=>{y.unsubscribe?y.unsubscribe(u):y.removeEventListener("abort",u)}),e=null)};e.forEach(y=>y.addEventListener("abort",u));const{signal:_}=c;return _.unsubscribe=()=>ct.asap(m),_}},mfe=c3,gfe=fl;xn({target:"Promise",stat:!0,forced:!0},{withResolvers:function(){var e=gfe.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}});var _fe=fl,Efe=oh;xn({target:"Promise",stat:!0,forced:!0},{try:function(e){var r=_fe.f(this),o=Efe(e);return(o.error?r.reject:r.resolve)(o.value),r.promise}});var CL=l(mfe),_W=yv.f("asyncIterator"),yfe=l(_W);function IL(e,r){this.v=e,this.k=r}function sT(e){var r,o;function s(u,h){try{var m=e[u](h),_=m.value,y=_ instanceof IL;CL.resolve(y?_.v:_).then(function(S){if(y){var R=u==="return"?"return":"next";if(!_.k||S.done)return s(R,S);S=e[R](S).value}c(m.done?"return":"normal",S)},function(S){s("throw",S)})}catch(S){c("throw",S)}}function c(u,h){switch(u){case"return":r.resolve({value:h,done:!0});break;case"throw":r.reject(h);break;default:r.resolve({value:h,done:!1})}(r=r.next)?s(r.key,r.arg):o=null}this._invoke=function(u,h){return new CL(function(m,_){var y={key:u,arg:h,resolve:m,reject:_,next:null};o?o=o.next=y:(r=o=y,s(u,h))})},typeof e.return!="function"&&(this.return=void 0)}function ml(e){return function(){return new sT(e.apply(this,arguments))}}function wn(e){return new IL(e,0)}function yA(e){var r={},o=!1;function s(c,u){return o=!0,{done:!1,value:new IL(u=new CL(function(h){h(e[c](u))}),1)}}return r[bv!==void 0&&H6||"@@iterator"]=function(){return this},r.next=function(c){return o?(o=!1,c):s("next",c)},typeof e.throw=="function"&&(r.throw=function(c){if(o)throw o=!1,c;return s("throw",c)}),typeof e.return=="function"&&(r.return=function(c){return o?(o=!1,c):s("return",c)}),r}sT.prototype[typeof bv=="function"&&yfe||"@@asyncIterator"]=function(){return this},sT.prototype.next=function(e){return this._invoke("next",e)},sT.prototype.throw=function(e){return this._invoke("throw",e)},sT.prototype.return=function(e){return this._invoke("return",e)};var AL=l(_W);function PL(e){var r,o,s,c=2;for(typeof Symbol<"u"&&(o=AL,s=Symbol.iterator);c--;){if(o&&(r=e[o])!=null)return r.call(e);if(s&&(r=e[s])!=null)return new vA(r.call(e));o="@@asyncIterator",s="@@iterator"}throw new TypeError("Object is not async iterable")}function vA(e){function r(o){if(Object(o)!==o)return lt.reject(new TypeError(o+" is not an object."));var s=o.done;return lt.resolve(o.value).then(function(c){return{value:c,done:s}})}return vA=function(o){this.s=o,this.n=o.next},vA.prototype={s:null,n:null,next:function(){return r(this.n.apply(this.s,arguments))},return:function(o){var s=this.s.return;return s===void 0?lt.resolve({value:o,done:!0}):r(s.apply(this.s,arguments))},throw:function(o){var s=this.s.return;return s===void 0?lt.reject(o):r(s.apply(this.s,arguments))}},new vA(e)}const vfe=function*(e,r){let o=e.byteLength;if(!r||o<r)return void(yield e);let s,c=0;for(;c<o;)s=c+r,yield e.slice(c,s),c=s},Sfe=function(){var e=ml(function*(r,o){var s,c=!1,u=!1;try{for(var h,m=PL(bfe(r));c=!(h=yield wn(m.next())).done;c=!1){const _=h.value;yield*yA(PL(vfe(_,o)))}}catch(_){u=!0,s=_}finally{try{c&&m.return!=null&&(yield wn(m.return()))}finally{if(u)throw s}}});return function(r,o){return e.apply(this,arguments)}}(),bfe=function(){var e=ml(function*(r){if(r[AL])return void(yield*yA(PL(r)));const o=r.getReader();try{for(;;){const{done:s,value:c}=yield wn(o.read());if(s)break;yield c}}finally{yield wn(o.cancel())}});return function(r){return e.apply(this,arguments)}}(),EW=(e,r,o,s)=>{const c=Sfe(e,r);let u,h=0,m=_=>{u||(u=!0,s&&s(_))};return new ReadableStream({async pull(_){try{const{done:y,value:S}=await c.next();if(y)return m(),void _.close();let R=S.byteLength;if(o){let P=h+=R;o(P)}_.enqueue(new Uint8Array(S))}catch(y){throw m(y),y}},cancel:_=>(m(_),c.return())},{highWaterMark:2})};function yW(e,r){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),o.push.apply(o,s)}return o}function vW(e){for(var r=1;r<arguments.length;r++){var o=arguments[r]!=null?arguments[r]:{};r%2?yW(Object(o),!0).forEach(function(s){$(e,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):yW(Object(o)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(o,s))})}return e}const SA=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",SW=SA&&typeof ReadableStream=="function",Tfe=SA&&(typeof TextEncoder=="function"?(bW=new TextEncoder,e=>bW.encode(e)):async e=>new Uint8Array(await new Response(e).arrayBuffer()));var bW;const TW=function(e){try{for(var r=arguments.length,o=new Array(r>1?r-1:0),s=1;s<r;s++)o[s-1]=arguments[s];return!!e(...o)}catch{return!1}},wfe=SW&&TW(()=>{let e=!1;const r=new Request(va.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!r}),OL=SW&&TW(()=>ct.isReadableStream(new Response("").body)),bA={stream:OL&&(e=>e.body)};var wW;SA&&(wW=new Response,["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!bA[e]&&(bA[e]=ct.isFunction(wW[e])?r=>r[e]():(r,o)=>{throw new Zn("Response type '".concat(e,"' is not supported"),Zn.ERR_NOT_SUPPORT,o)})}));const Rfe=async(e,r)=>{const o=ct.toFiniteNumber(e.getContentLength());return o??(async s=>s==null?0:ct.isBlob(s)?s.size:ct.isSpecCompliantForm(s)?(await new Request(va.origin,{method:"POST",body:s}).arrayBuffer()).byteLength:ct.isArrayBufferView(s)||ct.isArrayBuffer(s)?s.byteLength:(ct.isURLSearchParams(s)&&(s+=""),ct.isString(s)?(await Tfe(s)).byteLength:void 0))(r)};var Cfe=SA&&(async e=>{let{url:r,method:o,data:s,signal:c,cancelToken:u,timeout:h,onDownloadProgress:m,onUploadProgress:_,responseType:y,headers:S,withCredentials:R="same-origin",fetchOptions:P}=gW(e);y=y?(y+"").toLowerCase():"text";let k,z=pfe([c,u&&u.toAbortSignal()],h);const U=z&&z.unsubscribe&&(()=>{z.unsubscribe()});let V;try{if(_&&wfe&&o!=="get"&&o!=="head"&&(V=await Rfe(S,s))!==0){let Ee,me=new Request(r,{method:"POST",body:s,duplex:"half"});if(ct.isFormData(s)&&(Ee=me.headers.get("content-type"))&&S.setContentType(Ee),me.body){const[ke,Ye]=dW(V,EA(hW(_)));s=EW(me.body,65536,ke,Ye)}}ct.isString(R)||(R=R?"include":"omit");const q="credentials"in Request.prototype;k=new Request(r,vW(vW({},P),{},{signal:z,method:o.toUpperCase(),headers:S.normalize().toJSON(),body:s,duplex:"half",credentials:q?R:void 0}));let Y=await fetch(k);const ce=OL&&(y==="stream"||y==="response");if(OL&&(m||ce&&U)){const Ee={};["status","statusText","headers"].forEach(ut=>{Ee[ut]=Y[ut]});const me=ct.toFiniteNumber(Y.headers.get("content-length")),[ke,Ye]=m&&dW(me,EA(hW(m),!0))||[];Y=new Response(EW(Y.body,65536,ke,()=>{Ye&&Ye(),U&&U()}),Ee)}y=y||"text";let _e=await bA[ct.findKey(bA,y)||"text"](Y,e);return!ce&&U&&U(),await new lt((Ee,me)=>{uW(Ee,me,{data:_e,headers:ud.from(Y.headers),status:Y.status,statusText:Y.statusText,config:e,request:k})})}catch(q){throw U&&U(),q&&q.name==="TypeError"&&/fetch/i.test(q.message)?Object.assign(new Zn("Network Error",Zn.ERR_NETWORK,e,k),{cause:q.cause||q}):Zn.from(q,q&&q.code,e,k)}});const kL={http:null,xhr:ffe,fetch:Cfe};ct.forEach(kL,(e,r)=>{if(e){try{Object.defineProperty(e,"name",{value:r})}catch{}Object.defineProperty(e,"adapterName",{value:r})}});const RW=e=>"- ".concat(e),Ife=e=>ct.isFunction(e)||e===null||e===!1;var CW={getAdapter:e=>{e=ct.isArray(e)?e:[e];const{length:r}=e;let o,s;const c={};for(let u=0;u<r;u++){let h;if(o=e[u],s=o,!Ife(o)&&(s=kL[(h=String(o)).toLowerCase()],s===void 0))throw new Zn("Unknown adapter '".concat(h,"'"));if(s)break;c[h||"#"+u]=s}if(!s){const u=Object.entries(c).map(h=>{let[m,_]=h;return"adapter ".concat(m," ")+(_===!1?"is not supported by the environment":"is not available in the build")});throw new Zn("There is no suitable adapter to dispatch the request "+(r?u.length>1?`since :
`+u.map(RW).join(`
`):" "+RW(u[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return s},adapters:kL};function NL(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new Tv(null,e)}function IW(e){return NL(e),e.headers=ud.from(e.headers),e.data=RL.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),CW.getAdapter(e.adapter||TL.adapter)(e).then(function(r){return NL(e),r.data=RL.call(e,e.transformResponse,r),r.headers=ud.from(r.headers),r},function(r){return lW(r)||(NL(e),r&&r.response&&(r.response.data=RL.call(e,e.transformResponse,r.response),r.response.headers=ud.from(r.response.headers))),lt.reject(r)})}const AW="1.7.9",TA={};["object","boolean","number","function","string","symbol"].forEach((e,r)=>{TA[e]=function(o){return typeof o===e||"a"+(r<1?"n ":" ")+e}});const PW={};TA.transitional=function(e,r,o){function s(c,u){return"[Axios v"+AW+"] Transitional option '"+c+"'"+u+(o?". "+o:"")}return(c,u,h)=>{if(e===!1)throw new Zn(s(u," has been removed"+(r?" in "+r:"")),Zn.ERR_DEPRECATED);return r&&!PW[u]&&(PW[u]=!0,console.warn(s(u," has been deprecated since v"+r+" and will be removed in the near future"))),!e||e(c,u,h)}},TA.spelling=function(e){return(r,o)=>(console.warn("".concat(o," is likely a misspelling of ").concat(e)),!0)};var wA={assertOptions:function(e,r,o){if(typeof e!="object")throw new Zn("options must be an object",Zn.ERR_BAD_OPTION_VALUE);const s=Object.keys(e);let c=s.length;for(;c-- >0;){const u=s[c],h=r[u];if(h){const m=e[u],_=m===void 0||h(m,u,e);if(_!==!0)throw new Zn("option "+u+" must be "+_,Zn.ERR_BAD_OPTION_VALUE)}else if(o!==!0)throw new Zn("Unknown option "+u,Zn.ERR_BAD_OPTION)}},validators:TA};const dh=wA.validators;let RA=class{constructor(e){this.defaults=e,this.interceptors={request:new L5,response:new L5}}async request(e,r){try{return await this._request(e,r)}catch(o){if(o instanceof Error){let s={};Error.captureStackTrace?Error.captureStackTrace(s):s=new Error;const c=s.stack?s.stack.replace(/^.+\n/,""):"";try{o.stack?c&&!String(o.stack).endsWith(c.replace(/^.+\n.+\n/,""))&&(o.stack+=`
`+c):o.stack=c}catch{}}throw o}}_request(e,r){typeof e=="string"?(r=r||{}).url=e:r=e||{},r=R_(this.defaults,r);const{transitional:o,paramsSerializer:s,headers:c}=r;o!==void 0&&wA.assertOptions(o,{silentJSONParsing:dh.transitional(dh.boolean),forcedJSONParsing:dh.transitional(dh.boolean),clarifyTimeoutError:dh.transitional(dh.boolean)},!1),s!=null&&(ct.isFunction(s)?r.paramsSerializer={serialize:s}:wA.assertOptions(s,{encode:dh.function,serialize:dh.function},!0)),wA.assertOptions(r,{baseUrl:dh.spelling("baseURL"),withXsrfToken:dh.spelling("withXSRFToken")},!0),r.method=(r.method||this.defaults.method||"get").toLowerCase();let u=c&&ct.merge(c.common,c[r.method]);c&&ct.forEach(["delete","get","head","post","put","patch","common"],k=>{delete c[k]}),r.headers=ud.concat(u,c);const h=[];let m=!0;this.interceptors.request.forEach(function(k){typeof k.runWhen=="function"&&k.runWhen(r)===!1||(m=m&&k.synchronous,h.unshift(k.fulfilled,k.rejected))});const _=[];let y;this.interceptors.response.forEach(function(k){_.push(k.fulfilled,k.rejected)});let S,R=0;if(!m){const k=[IW.bind(this),void 0];for(k.unshift.apply(k,h),k.push.apply(k,_),S=k.length,y=lt.resolve(r);R<S;)y=y.then(k[R++],k[R++]);return y}S=h.length;let P=r;for(R=0;R<S;){const k=h[R++],z=h[R++];try{P=k(P)}catch(U){z.call(this,U);break}}try{y=IW.call(this,P)}catch(k){return lt.reject(k)}for(R=0,S=_.length;R<S;)y=y.then(_[R++],_[R++]);return y}getUri(e){return D5(fW((e=R_(this.defaults,e)).baseURL,e.url),e.params,e.paramsSerializer)}};ct.forEach(["delete","get","head","options"],function(e){RA.prototype[e]=function(r,o){return this.request(R_(o||{},{method:e,url:r,data:(o||{}).data}))}}),ct.forEach(["post","put","patch"],function(e){function r(o){return function(s,c,u){return this.request(R_(u||{},{method:e,headers:o?{"Content-Type":"multipart/form-data"}:{},url:s,data:c}))}}RA.prototype[e]=r(),RA.prototype[e+"Form"]=r(!0)});var CA=RA;class DL{constructor(r){if(typeof r!="function")throw new TypeError("executor must be a function.");let o;this.promise=new lt(function(c){o=c});const s=this;this.promise.then(c=>{if(!s._listeners)return;let u=s._listeners.length;for(;u-- >0;)s._listeners[u](c);s._listeners=null}),this.promise.then=c=>{let u;const h=new lt(m=>{s.subscribe(m),u=m}).then(c);return h.cancel=function(){s.unsubscribe(u)},h},r(function(c,u,h){s.reason||(s.reason=new Tv(c,u,h),o(s.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(r){this.reason?r(this.reason):this._listeners?this._listeners.push(r):this._listeners=[r]}unsubscribe(r){if(!this._listeners)return;const o=this._listeners.indexOf(r);o!==-1&&this._listeners.splice(o,1)}toAbortSignal(){const r=new AbortController,o=s=>{r.abort(s)};return this.subscribe(o),r.signal.unsubscribe=()=>this.unsubscribe(o),r.signal}static source(){let r;return{token:new DL(function(s){r=s}),cancel:r}}}var Afe=DL;const LL={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(LL).forEach(e=>{let[r,o]=e;LL[o]=r});var Pfe=LL;const zo=function e(r){const o=new CA(r),s=m5(CA.prototype.request,o);return ct.extend(s,CA.prototype,o,{allOwnKeys:!0}),ct.extend(s,o,null,{allOwnKeys:!0}),s.create=function(c){return e(R_(r,c))},s}(TL);zo.Axios=CA,zo.CanceledError=Tv,zo.CancelToken=Afe,zo.isCancel=lW,zo.VERSION=AW,zo.toFormData=oA,zo.AxiosError=Zn,zo.Cancel=zo.CanceledError,zo.all=function(e){return lt.all(e)},zo.spread=function(e){return function(r){return e.apply(null,r)}},zo.isAxiosError=function(e){return ct.isObject(e)&&e.isAxiosError===!0},zo.mergeConfig=R_,zo.AxiosHeaders=ud,zo.formToJSON=e=>aW(ct.isHTMLForm(e)?new FormData(e):e),zo.getAdapter=CW.getAdapter,zo.HttpStatusCode=Pfe,zo.default=zo;var Hs=zo;const Ofe=()=>{};function aT(){const e={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:Ofe};return e.promise=new lt((r,o)=>{e.resolve=s=>{e.isFinished||(e.isResolved=!0,e.isFinished=!0,r(s),e.value=s)},e.reject=s=>{e.isFinished||(e.isRejected=!0,e.isFinished=!0,o(s))}}),e}const IA=new Map,AA=new Map,hh=new Map;let Fi=function(e){return e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.HARMONY_OS="HarmonyOS",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS="Mac OS",e.CHROMIUM_OS="Chromium OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot",e}({}),Mn=function(e){return e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger",e}({});const OW=new Kle;let dd=OW.getResult(),xL=null;function Rn(e){if(!xL){dd=OW.getResult();const r=function(m){if(m.engine.name==="Blink"&&m.browser.name!=="WeChat")return Mn.CHROME;switch(m.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return Mn.CHROME;case"Safari":case"Mobile Safari":return Mn.SAFARI;case"Edge":return Mn.EDGE;case"Firefox":return Mn.FIREFOX;case"QQ":case"QQBrowser":return Mn.QQ;case"Opera":return Mn.OPERA;case"WeChat":return Mn.WECHAT;default:return m.browser.name||""}}(dd),o=kW(dd),s=function(m){return m.os.name==="Windows"?m.os.version?m.os.name+" "+m.os.version:m.os.name:m.os.name||""}(dd),c=dd.os.version,u=kW(dd,!1),h=dd.device.type;if(!(r&&o&&s&&c))return{name:r,version:o,os:s,osVersion:c,browserVersion:u,deviceType:h};xL={name:r,version:o,os:s,osVersion:c,browserVersion:u,deviceType:h}}return xL}function kW(e){let r,o=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return r=e.engine.name==="Blink"?e.engine.version||"":e.browser.version||"",o?r.split(".")[0]:r}function PA(){return Rn().os}function NW(){const e=Rn();return"".concat(e.os," ").concat(e.osVersion)}function OA(){const e=Rn();return!!(dd.engine.name==="WebKit"&&e.os===Fi.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==Mn.SAFARI||ys()&&e.name!==Mn.SAFARI)}function Wf(){return Rn().name===Mn.CHROME}function vo(){return Rn().name===Mn.SAFARI}function DW(){return Rn().name===Mn.EDGE}function Dr(){return Rn().name===Mn.FIREFOX}function ys(){return Rn().os===Fi.IOS}function cT(e){const r=Rn();return!(r.name!==Mn.CHROME||!r.osVersion)&&Number(r.version)>=e}function LW(e){const r=Rn();return!(r.name!==Mn.CHROME||!r.osVersion)&&Number(r.version)<e}function ML(e,r,o){const s=Rn();return!(s.name!==e||!s.osVersion)&&(o?Number(s.version)>=r&&Number(s.version)<=o:Number(s.version)===r)}function UL(e){const r=Rn();return!(r.name!==Mn.EDGE||!r.osVersion)&&Number(r.version)>=e}function xW(e){const r=Rn();return!(r.name!==Mn.SAFARI||!r.osVersion)&&Number(r.version)>=e}function MW(e,r,o){const s=Rn();if(s.os!==Fi.IOS||!s.osVersion)return!1;const c=s.osVersion.split(".");return r&&Number(c[0])===e&&Number(c[1])<r||Number(c[0])<e}function UW(e,r,o){const s=Rn();if(s.name!==Mn.SAFARI||!s.osVersion||!s.browserVersion)return!1;const c=s.browserVersion.split(".");return o?r&&Number(c[0])===e&&Number(c[1])<r||Number(c[0])<e:r?Number(c[0])===e&&Number(c[1])<=r||Number(c[0])<e:Number(c[0])<=e}function VL(e){const r=Rn();return!(r.name!==Mn.OPERA||!r.osVersion)&&Number(r.version)>=e}function VW(){const e=Rn();if(e.os!==Fi.IOS||!e.osVersion)return!1;const r=e.osVersion.split(".");return Number(r[0])<14||Number(r[0])===14&&Number(r[1])<=6}function wv(){const e=Rn();if(e.os!==Fi.IOS||!e.osVersion)return!1;const r=e.osVersion.split(".");return Number(r[0])===15}function FL(){const e=Rn();if(e.os!==Fi.IOS||!e.osVersion)return!1;const r=e.osVersion.split(".");return Number(r[0])===16}function FW(){const e=Rn();if(e.os!==Fi.IOS||!e.osVersion)return!1;const r=e.osVersion.split(".");return Number(r[0])===15&&Number(r[1])>=1}function au(){return vo()&&navigator.maxTouchPoints>0}function jW(){return Rn().name===Mn.WECHAT}function BW(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function jL(){const e=PA();return function(){const{deviceType:r}=Rn();return r==="mobile"||r==="tablet"}()||e===Fi.ANDROID||e===Fi.IOS||e===Fi.HARMONY_OS}function zf(){const e=Rn();return e.name!==Mn.EDGE&&e.name!==Mn.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function kA(){return PA()===Fi.ANDROID}function lT(){const e=Rn();return kA()&&(e.name===Mn.CHROME||e.name===Mn.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function WW(e,r){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),o.push.apply(o,s)}return o}function mt(e){for(var r=1;r<arguments.length;r++){var o=arguments[r]!=null?arguments[r]:{};r%2?WW(Object(o),!0).forEach(function(s){zt(e,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):WW(Object(o)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(o,s))})}return e}function zt(e,r,o){return(r=function(s){var c=function(u,h){if(typeof u!="object"||u===null)return u;var m=u[Symbol.toPrimitive];if(m!==void 0){var _=m.call(u,"string");if(typeof _!="object")return _;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(u)}(s);return typeof c=="symbol"?c:String(c)}(r))in e?Object.defineProperty(e,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[r]=o,e}let X=function(e){return e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",e.DATACHANNEL_FAILED="DATACHANNEL_FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e.INVALID_PLUGIN="INVALID_PLUGIN",e.DISCONNECT_P2P="DISCONNECT_P2P",e.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",e.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",e.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",e.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",e.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",e.PROHIBITED_OPERATION="PROHIBITED_OPERATION",e.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",e.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",e}({}),Le=class extends Error{constructor(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",o=arguments.length>2?arguments[2]:void 0;super(r),zt(this,"code",void 0),zt(this,"message",void 0),zt(this,"data",void 0),zt(this,"name","AgoraRTCException"),this.code=e,this.message="AgoraRTCError ".concat(this.code,": ").concat(r),this.data=o}toString(){return this.data?"".concat(this.message,`
data: `).concat(JSON.stringify(this.data)):this.message}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",r=arguments.length>1?arguments[1]:void 0;return e==="error"&&(r||console).error(this.toString()),e==="warning"&&(r||console).warn(this.toString()),this}throw(e){throw this.print("error",e),this}};function Gf(e,r){if(typeof e!="boolean")throw new Le(X.INVALID_PARAMS,"Invalid ".concat(r,": The value is of the boolean type."))}function ki(e,r,o){if(!st(o).call(o,e))throw new Le(X.INVALID_PARAMS,"".concat(r," can only be set as ").concat(JSON.stringify(o)))}function er(e,r){let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(e<o||e>s||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(c){return typeof c=="number"&&c%1==0}(e))throw new Le(X.INVALID_PARAMS,"invalid ".concat(r,": the value range is [").concat(o,", ").concat(s,"]. integer only"))}function BL(e,r){if(typeof e!="number"){if(!(e.min||e.max||e.ideal||e.exact))throw new Le(X.INVALID_PARAMS,"".concat(r," is not a valid ConstrainLong"));e.min!==void 0&&er(e.min,"".concat(r,".min"),0,1/0),e.max!==void 0&&er(e.max,"".concat(r,".max"),1,1/0),e.exact!==void 0&&er(e.exact,"".concat(r,".exact"),1,1/0),e.ideal!==void 0&&er(e.ideal,"".concat(r,".ideal"),1,1/0)}else er(e,r,1,1/0)}function ro(e,r){let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,c=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(e==null)throw new Le(X.INVALID_PARAMS,"".concat(r||"param"," cannot be empty"));if(!zW(e,o,s,c))throw new Le(X.INVALID_PARAMS,"Invalid ".concat(r||"string param",": Length of the string: [").concat(o,",").concat(s,"].").concat(c?" ASCII characters only.":""))}function Hf(e,r){if(!Array.isArray(e))throw new Le(X.INVALID_PARAMS,"".concat(r," should be an array"))}function Lr(e){return e==null}function zW(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,s=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof e=="string"&&e.length<=o&&e.length>=r&&(!s||function(c){if(typeof c!="string")return!1;for(let u=0;u<c.length;u+=1){const h=c.charCodeAt(u);if(h<0||h>255)return!1}return!0}(e))}var uT=function(e){return e.COVERED="COVERED",e.POSITION="POSITION",e.SIZE="SIZE",e.STYLE="STYLE",e}(uT||{}),WL=function(e){return e.UNMOUNTED="UNMOUNTED",e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",e}(WL||{});const GW=new class{constructor(){zt(this,"_clientSize",null),zt(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),zt(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),zt(this,"getStyle",e=>window.getComputedStyle(e,null)),zt(this,"checkCssVisibleProperty",e=>{var r;let o=!0;const s=this.getStyle(e),{display:c,visibility:u,opacity:h,filter:m}=s;return(c==="none"||st(r=["hidden","collapse"]).call(r,u)||Number(h)<.1)&&(o=!1),!!o&&(m&&m.split(" ").filter(_=>{var y;const S=_.split("(")[0];return st(y=["brightness","blur","opacity"]).call(y,S)}).map(_=>{const[y,S]=_.split(/\(|\)/);return[y,Number(S.match(/^[0-9\.]+/))]}).forEach(_=>{const[y,S]=_;switch(y){case"brightness":(S<.1||S>3)&&(o=!1);break;case"blur":S>3&&(o=!1);break;case"opacity":S<.1&&(o=!1)}}),o)}),zt(this,"checkPropertyUpToAllParentNodes",(e,r)=>{let o=!0,s=!0;const c=h=>r(h);let u=e;for(;u&&s;)c(u)||(o=!1,s=!1),u=u.parentElement,u||(s=!1);return o}),zt(this,"checkActualCssVisibleIncludeInherit",e=>this.checkPropertyUpToAllParentNodes(e,this.checkCssVisibleProperty)),zt(this,"getSizeAboutClient",e=>{const{width:r,height:o,left:s,right:c,top:u,bottom:h}=e.getBoundingClientRect(),m=this.getClientWidth(),_=this.getClientHeight();return{width:r,height:o,left:s,right:c,top:u,bottom:h,clientWidth:m,clientHeight:_,clientMin:Math.min(m,_)}}),zt(this,"checkActualSize",()=>{const{width:e,height:r,clientMin:o}=this._clientSize;return this.checkSizeIsVisible(e,r,o)}),zt(this,"elementFromPoint",(e,r)=>document.elementFromPoint?document.elementFromPoint(e,r):null),zt(this,"checkCoverForAPoint",(e,r,o)=>{const s=this.elementFromPoint(e,r);return s!==null&&s!==o}),zt(this,"getPointPositionList",()=>{const{width:e,height:r,left:o,top:s}=this._clientSize,c=e/6,u=r/6,h=[],m=10**6;for(let _=0;_<5;_++)for(let y=0;y<5;y++){const S=(o*m+(_===0?.1:_===4?(c*_*m-1e5)/m:c*_)*m)/m,R=(s*m+(y===0?.1:y===4?(u*y*m-1e5)/m:u*y)*m)/m;h.push({x:S,y:R})}return[...h]}),zt(this,"checkElementCover",e=>this.getPointPositionList().map(r=>this.checkCoverForAPoint(r.x,r.y,e)).filter(r=>!!r).length>6),zt(this,"checkSizeIsVisible",(e,r,o)=>(e>50||o/e<=10)&&(r>50||o/r<=10)),zt(this,"checkSizeOfPartInClient",()=>{const{left:e,right:r,top:o,bottom:s,clientHeight:c,clientWidth:u,clientMin:h}=this._clientSize;let m,_,y,S;if(e<0)m=0;else{if(!(e<u))return!1;m=e}if(r<0)return!1;if(_=r<u?r:u,o<0)y=0;else{if(!(o<c))return!1;y=o}if(s<0)return!1;S=s<c?s:c;const R=_-m,P=S-y;return this.checkSizeIsVisible(R,P,h)}),zt(this,"returnHiddenResult",e=>(this._clientSize=null,{visible:!1,reason:e})),zt(this,"checkOneElementVisible",e=>{if(e instanceof HTMLElement){if(this.checkElementIsMountedOnDom(e)){if(this.checkActualCssVisibleIncludeInherit(e)){if(this._clientSize=this.getSizeAboutClient(e),this.checkElementCover(e))return this.returnHiddenResult(uT.COVERED);{const r=this.checkActualSize(),o=this.checkSizeOfPartInClient();return r&&!o?this.returnHiddenResult(uT.POSITION):r?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(uT.SIZE)}}return this.returnHiddenResult(uT.STYLE)}return this.returnHiddenResult(WL.UNMOUNTED)}return this.returnHiddenResult(WL.INVALID_HTML_ELEMENT)}),zt(this,"checkElementIsMountedOnDom",e=>this.checkPropertyUpToAllParentNodes(e,r=>r.nodeName.toUpperCase()!=="HTML"?r.parentElement!==null:!!document.documentElement))}};function zL(e){return new TextEncoder().encode(e)}const HW=function(e,r){const o=new Uint8Array(e.byteLength+r.byteLength);return o.set(new Uint8Array(e),0),o.set(new Uint8Array(r),e.byteLength),o},GL=async e=>function(r,o){let s="";return new Uint8Array(r).forEach(c=>{s+=c.toString(o).padStart(2,"0")}),s}(await crypto.subtle.digest("SHA-256",zL(e)),16);let Pr=class{constructor(){zt(this,"_events",{}),zt(this,"addListener",this.on)}getListeners(e){return this._events[e]?this._events[e].map(r=>r.listener):[]}on(e,r){this._events[e]||(this._events[e]=[]);const o=this._events[e];this._indexOfListener(o,r)===-1&&o.push({listener:r,once:!1})}once(e,r){this._events[e]||(this._events[e]=[]);const o=this._events[e];this._indexOfListener(o,r)===-1&&o.push({listener:r,once:!0})}off(e,r){if(!this._events[e])return;const o=this._events[e],s=this._indexOfListener(o,r);s!==-1&&o.splice(s,1),this._events[e].length===0&&delete this._events[e]}removeAllListeners(e){e?delete this._events[e]:this._events={}}emit(e){this._events[e]||(this._events[e]=[]);const r=this._events[e].map(u=>u);for(var o=arguments.length,s=new Array(o>1?o-1:0),c=1;c<o;c++)s[c-1]=arguments[c];for(let u=0;u<r.length;u+=1){const h=r[u];h.once&&this.off(e,h.listener),h.listener.apply(this,s||[])}}safeEmit(e){for(var r=arguments.length,o=new Array(r>1?r-1:0),s=1;s<r;s++)o[s-1]=arguments[s];[...this._events[e]||[]].forEach(c=>{c.once&&this.off(e,c.listener);try{c.listener.apply(this,o)}catch(u){console.error("safeEmit event:".concat(e," error ").concat(u==null?void 0:u.toString()))}})}_indexOfListener(e,r){let o=e.length;for(;o--;)if(e[o].listener===r)return o;return-1}},dT=null;function $W(){if(dT)return dT;if(window.electron)return dT=window.electron;if(!window.require)return null;try{return dT=window.require("electron"),dT}catch{return null}}let _i=function(e){return e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.PRELOAD="PRELOAD",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.MASS_SUBSCRIBE="Client.massSubscribe",e.MASS_UNSUBSCRIBE="Client.massUnsubscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",e.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",e.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange",e.CONNECTION_STATE_CHANGE="connectionStateChange",e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",e.IMAGE_MODERATION_UPLOAD="imageModerationUpload",e.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",e}({}),xr=function(e){return e.TRACER="tracer",e}({});function KW(e){return er(e.timeout,"config.timeout",0,1e5),er(e.timeoutFactor,"config.timeoutFactor",0,100,!1),er(e.maxRetryCount,"config.maxRetryConfig",0,1/0),er(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let kfe=function(e){return e[e.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",e[e.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",e[e.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",e}({}),jn=function(e){return e.LEAVE="LEAVE",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.UID_BANNED="UID_BANNED",e.FALLBACK="FALLBACK",e.IP_BANNED="IP_BANNED",e.CHANNEL_BANNED="CHANNEL_BANNED",e.LICENSE_MISSING="LICENSE_MISSING",e.LICENSE_EXPIRED="LICENSE_EXPIRED",e.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",e.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",e.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",e.LICENSE_ILLEGAL="LICENSE_ILLEGAL",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e}({});function hT(e){if(!Array.isArray(e)||e.length<1)return!1;try{e.forEach(r=>{if(!r.urls)throw Error()})}catch{return!1}return!0}function qW(e){return ro(e.turnServerURL,"turnServerURL"),ro(e.username,"username"),ro(e.password,"password"),e.udpport&&er(e.udpport,"udpport",1,99999,!0),e.forceturn&&Gf(e.forceturn,"forceturn"),e.security&&Gf(e.security,"security"),e.tcpport&&er(e.tcpport,"tcpport",1,99999,!0),!0}function HL(e){return e.level!==void 0&&ki(e.level,"level",[1,2,3]),e.delay!==void 0&&er(e.delay,"delay",0,3e3,!0),!0}let mn=function(e){return e.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",e.AUDIO_METADATA="audio-metadata",e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.EXCEPTION="exception",e.ERROR="error",e.P2P_LOST="p2p_lost",e.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",e.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",e.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",e.PUBLISHED_USER_LIST="published-user-list",e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",e.CONTENT_INSPECT_ERROR="content-inspect-error",e.CONTENT_INSPECT_RESULT="content-inspect-result",e.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",e}({}),So=function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",e}({}),tc=function(e){return e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({}),Rv=function(e){return e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({});function bo(e,r){for(var o=arguments.length,s=new Array(o>2?o-2:0),c=2;c<o;c++)s[c-2]=arguments[c];return e.getListeners(r).length===0?lt.reject(new Le(X.UNEXPECTED_ERROR,"can not emit promise")):new lt((u,h)=>{e.emit(r,...s,u,h)})}function or(e,r){if(e.getListeners(r).length===0)return lt.resolve();for(var o=arguments.length,s=new Array(o>2?o-2:0),c=2;c<o;c++)s[c-2]=arguments[c];return bo(e,r,...s)}function kc(e,r){if(e.getListeners(r).length===0)return null;for(var o=arguments.length,s=new Array(o>2?o-2:0),c=2;c<o;c++)s[c-2]=arguments[c];return fT(e,r,...s)}function fT(e,r){let o=null,s=null;for(var c=arguments.length,u=new Array(c>2?c-2:0),h=2;h<c;h++)u[h-2]=arguments[h];if(e.emit(r,...u,m=>{o=m},m=>{s=m}),s!==null)throw s;if(o===null)throw new Le(X.UNEXPECTED_ERROR,"handler is not sync");return o}const ai=new class extends Pr{set networkState(e){this.emit(Rv.NETWORK_STATE_CHANGE,e,this._networkState),e===tc.ONLINE?this.emit(Rv.ONLINE):e===tc.OFFLINE&&(this.onlineWaiter=new lt(r=>{this.once(Rv.ONLINE,()=>{this.onlineWaiter=void 0,r(tc.ONLINE)})}),this.emit(Rv.OFFLINE)),this._networkState=e}get networkState(){return this._networkState}get isOnline(){return this._networkState===tc.ONLINE}constructor(){super(),zt(this,"_moduleName","network-indicator"),zt(this,"_networkState",tc.ONLINE),zt(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=tc.ONLINE}),window.addEventListener("offline",()=>{this.networkState=tc.OFFLINE})}};function NA(e,r){const o=e.indexOf(r);o!==-1&&e.splice(o,1)}function Cv(e){const r=[];return e.forEach(o=>{r.indexOf(o)===-1&&r.push(o)}),r}function DA(e){lt!==void 0?lt.resolve().then(e):setTimeout(e,0)}function Mr(e){return JSON.parse(JSON.stringify(e))}function C_(e){try{return Mr(e)}catch{return e}}const YW={};function Rm(e,r){YW[r]||(YW[r]=!0,e())}function I_(e){const r=window.atob(e),o=new Uint8Array(new ArrayBuffer(r.length));for(let s=0;s<r.length;s+=1)o[s]=r.charCodeAt(s);return o}function Cm(e){let r="";for(let o=0;o<e.length;o+=1)r+=String.fromCharCode(e[o]);return window.btoa(r)}function XW(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,o=new TextEncoder().encode(e);if(o.length>r)o=o.slice(0,r);else if(o.length<r){const s=new Uint8Array(r);s.set(o),o=s}return o}function JW(){for(var e=arguments.length,r=new Array(e),o=0;o<e;o++)r[o]=arguments[o];const s=qa(r).call(r,(h,m)=>h+m.length,0),c=new Uint8Array(new ArrayBuffer(s));let u=0;return r.forEach(h=>{c.set(h,u),u+=h.length}),c}function fh(e){return window.TextEncoder?new TextEncoder().encode(e).length:e.length}function QW(e){let r=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&e.realFormData&&(e=e.realFormData),e.forEach(o=>{r+=typeof o=="string"?fh(o):o.size}),r+138}function Nfe(e){const r=new Le(X.TIMEOUT,"timeout");return new lt((o,s)=>{window.setTimeout(()=>s(r),e)})}function io(e){return new lt(r=>{window.setTimeout(r,e)})}function sr(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,r=arguments.length>1?arguments[1]:void 0;const o=Math.random().toString(16).substr(2,e).toLowerCase();return o.length===e?"".concat(r).concat(o):"".concat(r).concat(o)+sr(e-o.length,"")}function A_(){return sr(32,"").toUpperCase()}const LA=()=>{},ZW=new class{constructor(){zt(this,"fnMap",new Map)}throttleByKey(e,r,o,s){for(var c=arguments.length,u=new Array(c>4?c-4:0),h=4;h<c;h++)u[h-4]=arguments[h];if(this.fnMap.has(r)){const m=this.fnMap.get(r);if(m.threshold!==o){m.fn(...m.args),clearTimeout(m.timer);const _=window.setTimeout(()=>{const y=this.fnMap.get(r);y&&y.fn(...y.args),this.fnMap.delete(r)},o);this.fnMap.set(r,{fn:e,threshold:o,timer:_,args:u,skipFn:s})}else m.skipFn&&m.skipFn(...m.args),this.fnMap.set(r,mt(mt({},m),{},{fn:e,args:u,skipFn:s}))}else{const m=window.setTimeout(()=>{const _=this.fnMap.get(r);_&&_.fn(..._.args),this.fnMap.delete(r)},o);this.fnMap.set(r,{fn:e,threshold:o,timer:m,args:u,skipFn:s})}}},e8=ZW.throttleByKey.bind(ZW);function t8(e){return typeof e=="object"&&e!==null&&!(e instanceof RegExp)}function $L(e,r){if(!t8(e)||!t8(r)||Array.isArray(e)&&!Array.isArray(r)||!Array.isArray(e)&&Array.isArray(r))return r;if(Array.isArray(r)&&Array.isArray(e)){const o=[...e];for(let s=0;s<r.length;s++)o[s]=$L(e[s],r[s]);return o}{const o=mt({},e);for(const s in r)Object.prototype.hasOwnProperty.call(r,s)&&(Object.prototype.hasOwnProperty.call(e,s)?o[s]=$L(e[s],r[s]):o[s]=r[s]);return o}}function n8(e,r){let o=[0];if(o=new Array(r).fill(0),e===0)return o;let s=0;for(;e>0&&(o[s]=255&e,e>>=8,s++,s!==r););return o}function KL(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function r8(e){const r="0123456789abcdef";function o(ce){let _e,Ee="";for(_e=0;_e<=3;_e++)Ee+=r.charAt(ce>>8*_e+4&15)+r.charAt(ce>>8*_e&15);return Ee}function s(ce,_e){const Ee=(65535&ce)+(65535&_e);return(ce>>16)+(_e>>16)+(Ee>>16)<<16|65535&Ee}function c(ce,_e,Ee,me,ke,Ye){return s(function(ut,pt){return ut<<pt|ut>>>32-pt}(s(s(_e,ce),s(me,Ye)),ke),Ee)}function u(ce,_e,Ee,me,ke,Ye,ut){return c(_e&Ee|~_e&me,ce,_e,ke,Ye,ut)}function h(ce,_e,Ee,me,ke,Ye,ut){return c(_e&me|Ee&~me,ce,_e,ke,Ye,ut)}function m(ce,_e,Ee,me,ke,Ye,ut){return c(_e^Ee^me,ce,_e,ke,Ye,ut)}function _(ce,_e,Ee,me,ke,Ye,ut){return c(Ee^(_e|~me),ce,_e,ke,Ye,ut)}const y=function(ce){let _e;const Ee=1+(ce.length+8>>6),me=new Array(16*Ee);for(_e=0;_e<16*Ee;_e++)me[_e]=0;for(_e=0;_e<ce.length;_e++)me[_e>>2]|=ce.charCodeAt(_e)<<_e%4*8;return me[_e>>2]|=128<<_e%4*8,me[16*Ee-2]=8*ce.length,me}(e);let S,R,P,k,z,U=1732584193,V=-271733879,q=-1732584194,Y=271733878;for(S=0;S<y.length;S+=16)R=U,P=V,k=q,z=Y,U=u(U,V,q,Y,y[S+0],7,-680876936),Y=u(Y,U,V,q,y[S+1],12,-389564586),q=u(q,Y,U,V,y[S+2],17,606105819),V=u(V,q,Y,U,y[S+3],22,-1044525330),U=u(U,V,q,Y,y[S+4],7,-176418897),Y=u(Y,U,V,q,y[S+5],12,1200080426),q=u(q,Y,U,V,y[S+6],17,-1473231341),V=u(V,q,Y,U,y[S+7],22,-45705983),U=u(U,V,q,Y,y[S+8],7,1770035416),Y=u(Y,U,V,q,y[S+9],12,-1958414417),q=u(q,Y,U,V,y[S+10],17,-42063),V=u(V,q,Y,U,y[S+11],22,-1990404162),U=u(U,V,q,Y,y[S+12],7,1804603682),Y=u(Y,U,V,q,y[S+13],12,-40341101),q=u(q,Y,U,V,y[S+14],17,-1502002290),V=u(V,q,Y,U,y[S+15],22,1236535329),U=h(U,V,q,Y,y[S+1],5,-165796510),Y=h(Y,U,V,q,y[S+6],9,-1069501632),q=h(q,Y,U,V,y[S+11],14,643717713),V=h(V,q,Y,U,y[S+0],20,-373897302),U=h(U,V,q,Y,y[S+5],5,-701558691),Y=h(Y,U,V,q,y[S+10],9,38016083),q=h(q,Y,U,V,y[S+15],14,-660478335),V=h(V,q,Y,U,y[S+4],20,-405537848),U=h(U,V,q,Y,y[S+9],5,568446438),Y=h(Y,U,V,q,y[S+14],9,-1019803690),q=h(q,Y,U,V,y[S+3],14,-187363961),V=h(V,q,Y,U,y[S+8],20,1163531501),U=h(U,V,q,Y,y[S+13],5,-1444681467),Y=h(Y,U,V,q,y[S+2],9,-51403784),q=h(q,Y,U,V,y[S+7],14,1735328473),V=h(V,q,Y,U,y[S+12],20,-1926607734),U=m(U,V,q,Y,y[S+5],4,-378558),Y=m(Y,U,V,q,y[S+8],11,-2022574463),q=m(q,Y,U,V,y[S+11],16,1839030562),V=m(V,q,Y,U,y[S+14],23,-35309556),U=m(U,V,q,Y,y[S+1],4,-1530992060),Y=m(Y,U,V,q,y[S+4],11,1272893353),q=m(q,Y,U,V,y[S+7],16,-155497632),V=m(V,q,Y,U,y[S+10],23,-1094730640),U=m(U,V,q,Y,y[S+13],4,681279174),Y=m(Y,U,V,q,y[S+0],11,-358537222),q=m(q,Y,U,V,y[S+3],16,-722521979),V=m(V,q,Y,U,y[S+6],23,76029189),U=m(U,V,q,Y,y[S+9],4,-640364487),Y=m(Y,U,V,q,y[S+12],11,-421815835),q=m(q,Y,U,V,y[S+15],16,530742520),V=m(V,q,Y,U,y[S+2],23,-995338651),U=_(U,V,q,Y,y[S+0],6,-198630844),Y=_(Y,U,V,q,y[S+7],10,1126891415),q=_(q,Y,U,V,y[S+14],15,-1416354905),V=_(V,q,Y,U,y[S+5],21,-57434055),U=_(U,V,q,Y,y[S+12],6,1700485571),Y=_(Y,U,V,q,y[S+3],10,-1894986606),q=_(q,Y,U,V,y[S+10],15,-1051523),V=_(V,q,Y,U,y[S+1],21,-2054922799),U=_(U,V,q,Y,y[S+8],6,1873313359),Y=_(Y,U,V,q,y[S+15],10,-30611744),q=_(q,Y,U,V,y[S+6],15,-1560198380),V=_(V,q,Y,U,y[S+13],21,1309151649),U=_(U,V,q,Y,y[S+4],6,-145523070),Y=_(Y,U,V,q,y[S+11],10,-1120210379),q=_(q,Y,U,V,y[S+2],15,718787259),V=_(V,q,Y,U,y[S+9],21,-343485551),U=s(U,R),V=s(V,P),q=s(q,k),Y=s(Y,z);return o(U)+o(V)+o(q)+o(Y)}let Dfe=1,i8=console,Oo=class{static setLogger(e){i8=e}constructor(e,r){zt(this,"id",void 0),zt(this,"lockingPromise",lt.resolve()),zt(this,"locks",0),zt(this,"name",""),zt(this,"lockId",void 0),this.lockId=Dfe++,e&&(this.name=e),r&&(this.id=r),this.logger("created")}logger(e,r){const o=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),s=e==="created"?"is ".concat(e,"."):"is ".concat(e,", current queue ").concat(this.locks,". ").concat(r??"");i8.debug("".concat(o," ").concat(s))}setId(e){this.id=e}get isLocked(){return this.locks>0}lock(e){let r;this.locks+=1,this.logger("locked",e);const o=new lt(c=>{r=()=>{this.locks-=1,this.logger("unlocked",e),c()}}),s=this.lockingPromise.then(()=>r);return this.lockingPromise=this.lockingPromise.then(()=>o),s}};function Iv(e,r){return function(o,s,c){const u=c.value;if(typeof u!="function")throw new Error("Cannot use mutex on object property.");return c.value=async function(){const h=this[r];if(!h)throw new Error("mutex property key ".concat(r," doesn't exist on ").concat(e));const m=await h.lock("From ".concat(e,".").concat(s));try{for(var _=arguments.length,y=new Array(_),S=0;S<_;S++)y[S]=arguments[S];return await u.apply(this,y)}finally{m()}},c}}const Ei={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function qL(e,r){const o=Math.floor(r.timeout*Math.pow(r.timeoutFactor,e));return Math.min(r.maxRetryTimeout,o)}function hd(e,r,o,s){const c=Object.assign({},Ei,s);let u=c.timeout;const h=async()=>{await function(y){return new lt(S=>{window.setTimeout(S,y)})}(u),u*=c.timeoutFactor,u=Math.min(c.maxRetryTimeout,u)};let m=!1;const _=new lt(async(y,S)=>{r=r||(()=>!1),o=o||(()=>!0);for(let R=0;R<c.maxRetryCount;R+=1){if(m)return S(new Le(X.OPERATION_ABORTED));try{const P=await e();if(!r(P,R)||R+1===c.maxRetryCount)return y(P);await h()}catch(P){if(!o(P,R)||R+1===c.maxRetryCount)return S(P);await h()}}});return _.cancel=()=>m=!0,_}let xA,o8=class{constructor(e){zt(this,"input",[]),zt(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}mean(){var e;return this.input.length===0?0:qa(e=this.input).call(e,(r,o)=>r+o)/this.input.length}},MA=0,YL=0;function XL(e,r,o,s){return new lt((c,u)=>{r.responseType=r.responseType||"json",r.data&&!o?(r.data=JSON.stringify(r.data),MA+=fh(r.data)):o&&(r.data.size?MA+=r.data.size:r.data instanceof FormData?MA+=QW(r.data):MA+=fh(JSON.stringify(r.data))),r.headers=r.headers||{},r.headers["Content-Type"]=r.headers["Content-Type"]||"application/json",r.method="POST",r.url=e,Hs.request(r).then(h=>{typeof h.data=="string"?YL+=fh(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?YL+=h.data.byteLength:YL+=fh(JSON.stringify(h.data)),c(h.data)}).catch(h=>{Hs.isCancel(h)?u(new Le(X.OPERATION_ABORTED,"cancel token canceled")):h.code==="ECONNABORTED"?u(new Le(X.NETWORK_TIMEOUT,h.message)):h.response?u(new Le(X.NETWORK_RESPONSE_ERROR,h.response.status)):u(new Le(X.NETWORK_ERROR,h.message))})})}async function Lfe(e,r){const o=new Blob([r.data],{type:"buffer"});return await XL(e,mt(mt({},r),{},{data:o,headers:{"Content-Type":"application/octet-stream"}}),!0)}const s8=()=>window.isSecureContext!==void 0;function cu(e){if(Array.isArray(e))return e.map(o=>o);if(!a8(e))return e;const r={};for(const o in e){const s=e[o];a8(s)||Array.isArray(s)?r[o]=cu(s):r[o]=s}return r}function a8(e){return!(typeof e!="object"||Array.isArray(e)||!e)}let JL=class{constructor(e){zt(this,"input",[]),zt(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}};const ph={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},pT={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:ph,remoteCandidate:ph},updateInterval:0},c8={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},l8={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},u8={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},d8={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0};let QL=class{constructor(e,r){zt(this,"onFirstVideoReceived",void 0),zt(this,"onFirstVideoDecoded",void 0),zt(this,"onFirstAudioReceived",void 0),zt(this,"onFirstVideoDecodedTimeout",void 0),zt(this,"onFirstAudioDecoded",void 0),zt(this,"onSelectedLocalCandidateChanged",void 0),zt(this,"onSelectedRemoteCandidateChanged",void 0),zt(this,"videoIsReady",!1),zt(this,"videoIsReady2",{}),zt(this,"pc",void 0),zt(this,"options",void 0),zt(this,"intervalTimer",void 0),zt(this,"stats",cu(pT)),zt(this,"isFirstVideoReceived",{}),zt(this,"isFirstVideoDecoded",{}),zt(this,"isFirstAudioReceived",{}),zt(this,"isFirstAudioDecoded",{}),zt(this,"isFirstVideoDecodedTimeout",{}),zt(this,"lossRateWindowStats",[]),this.pc=e,this.options=r,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new lt(e=>{e({local:mt({},ph),remote:mt({},ph)})})}setVideoIsReady(e){this.videoIsReady=e}setVideoIsReady2(e,r){this.videoIsReady2[e]=r}getVideoIsReady(e){return this.videoIsReady2[e]||!1}setIsFirstAudioDecoded(e){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(e){this.lossRateWindowStats.push(e),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const r=this.lossRateWindowStats.length,o=["videoSend","audioSend","videoRecv","audioRecv"];let s=0,c=0,u=0,h=0;for(const m of o)e[m].forEach((_,y)=>{if(!this.lossRateWindowStats[r-1][m][y]||!this.lossRateWindowStats[0][m][y])return;const S=this.lossRateWindowStats[r-1][m][y].packets-this.lossRateWindowStats[0][m][y].packets,R=this.lossRateWindowStats[r-1][m][y].packetsLost-this.lossRateWindowStats[0][m][y].packetsLost;m==="videoSend"||m==="audioSend"?(s+=S,u+=R):(c+=S,h+=R),Number.isNaN(S)||Number.isNaN(S)?_.packetLostRate=0:_.packetLostRate=S<=0||R<=0?0:R/(S+R)});e.sendPacketLossRate=s<=0||u<=0?0:u/(s+u),e.recvPacketLossRate=c<=0||h<=0?0:h/(c+h)}},xfe=class extends QL{constructor(){super(...arguments),zt(this,"_stats",pT),zt(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const e=await this._getStats(),r=this.statsResponsesToObjects(e);this._stats=cu(pT);const o=r.filter(c=>c.type==="ssrc");this.processSSRCStats(o);const s=r.find(c=>c.type==="VideoBwe");s&&this.processBandwidthStats(s),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(e){this._stats.bitrate={actualEncoded:Number(e.googActualEncBitrate),targetEncoded:Number(e.googTargetEncBitrate),retransmit:Number(e.googRetransmitBitrate),transmit:Number(e.googTransmitBitrate)},this._stats.sendBandwidth=Number(e.googAvailableSendBandwidth)}processSSRCStats(e){e.forEach(r=>{var o;const s=st(o=r.id).call(o,"send");switch("".concat(r.mediaType,"_").concat(s?"send":"recv")){case"video_send":{const c=cu(l8);c.codec=r.googCodecName,c.adaptionChangeReason="none",r.googCpuLimitedResolution&&(c.adaptionChangeReason="cpu"),r.googBandwidthLimitedResolution&&(c.adaptionChangeReason="bandwidth"),c.avgEncodeMs=Number(r.googAvgEncodeMs),c.inputFrame={width:Number(r.googFrameWidthInput)||Number(r.googFrameWidthSent),height:Number(r.googFrameHeightInput)||Number(r.googFrameHeightSent),frameRate:Number(r.googFrameRateInput)},c.sentFrame={width:Number(r.googFrameWidthSent),height:Number(r.googFrameHeightSent),frameRate:Number(r.googFrameRateInput)},c.firsCount=Number(r.googFirReceived),c.nacksCount=Number(r.googNacksReceived),c.plisCount=Number(r.googPlisReceived),c.frameCount=Number(r.framesEncoded),c.bytes=Number(r.bytesSent),c.packets=Number(r.packetsSent),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.rttMs=Number(r.googRtt||0),this._stats.videoSend.push(c),this._stats.rtt=c.rttMs;break}case"video_recv":{const c=cu(c8),u=this.lastDecodeVideoReceiverStats.get(Number(r.ssrc));if(c.codec=r.googCodecName,c.targetDelayMs=Number(r.googTargetDelayMs),c.renderDelayMs=Number(r.googRenderDelayMs),c.currentDelayMs=Number(r.googCurrentDelayMs),c.minPlayoutDelayMs=Number(r.googMinPlayoutDelayMs),c.decodeMs=Number(r.googDecodeMs),c.maxDecodeMs=Number(r.googMaxDecodeMs),c.receivedFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateReceived)},c.decodedFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateDecoded)},c.decodeFrameRate=Number(r.googFrameRateDecoded),c.outputFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateOutput)},c.jitterBufferMs=Number(r.googJitterBufferMs),c.firsCount=Number(r.googFirsSent),c.nacksCount=Number(r.googNacksSent),c.plisCount=Number(r.googPlisSent),c.framesDecodeCount=Number(r.framesDecoded),c.bytes=Number(r.bytesReceived),c.packets=Number(r.packetsReceived),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.packets>0&&!this.isFirstVideoReceived[c.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(c.ssrc),this.isFirstVideoReceived[c.ssrc]=!0),c.framesDecodeCount>0&&!this.isFirstVideoDecoded[c.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(c.ssrc,c.decodedFrame.width,c.decodedFrame.height),this.isFirstVideoDecoded[c.ssrc]=!0),u){const h=u.stats,m=Date.now()-u.lts;c.framesDecodeFreezeTime=h.framesDecodeFreezeTime,c.framesDecodeInterval=h.framesDecodeInterval,c.framesDecodeCount>h.framesDecodeCount&&this.isFirstVideoDecoded[c.ssrc]?(u.lts=Date.now(),c.framesDecodeInterval=m,c.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(r.ssrc,10))?c.framesDecodeFreezeTime+=c.framesDecodeInterval:this.setVideoIsReady2(parseInt(r.ssrc,10),!0))):c.framesDecodeCount<u.stats.framesDecodeCount&&(c.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(c.ssrc,{stats:mt({},c),lts:Date.now()}),this._stats.videoRecv.push(c);break}case"audio_recv":{const c=cu(d8);c.codec=r.googCodecName,c.outputLevel=Math.abs(Number(r.audioOutputLevel))/32767,c.decodingCNG=Number(r.googDecodingCNG),c.decodingCTN=Number(r.googDecodingCTN),c.decodingCTSG=Number(r.googDecodingCTSG),c.decodingNormal=Number(r.googDecodingNormal),c.decodingPLC=Number(r.googDecodingPLC),c.decodingPLCCNG=Number(r.googDecodingPLCCNG),c.expandRate=Number(r.googExpandRate),c.accelerateRate=Number(r.googAccelerateRate),c.preemptiveExpandRate=Number(r.googPreemptiveExpandRate),c.secondaryDecodedRate=Number(r.googSecondaryDecodedRate),c.speechExpandRate=Number(r.googSpeechExpandRate),c.preferredJitterBufferMs=Number(r.googPreferredJitterBufferMs),c.jitterBufferMs=Number(r.googJitterBufferMs),c.jitterMs=Number(r.googJitterReceived),c.bytes=Number(r.bytesReceived),c.packets=Number(r.packetsReceived),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.receivedFrames=Number(r.googDecodingCTN)||Number(r.packetsReceived),c.droppedFrames=Number(r.googDecodingPLC)+Number(r.googDecodingPLCCNG)||Number(r.packetsLost),c.receivedFrames>0&&!this.isFirstAudioReceived[c.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(c.ssrc),this.isFirstAudioReceived[c.ssrc]=!0),c.decodingNormal>0&&!this.isFirstAudioDecoded[c.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(c.ssrc),this.isFirstAudioDecoded[c.ssrc]=!0),this._stats.audioRecv.push(c);break}case"audio_send":{const c=cu(u8);c.codec=r.googCodecName,c.inputLevel=Math.abs(Number(r.audioInputLevel))/32767,c.aecReturnLoss=Number(r.googEchoCancellationReturnLoss||0),c.aecReturnLossEnhancement=Number(r.googEchoCancellationReturnLossEnhancement||0),c.residualEchoLikelihood=Number(r.googResidualEchoLikelihood||0),c.residualEchoLikelihoodRecentMax=Number(r.googResidualEchoLikelihoodRecentMax||0),c.bytes=Number(r.bytesSent),c.packets=Number(r.packetsSent),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.rttMs=Number(r.googRtt||0),this._stats.rtt=c.rttMs,this._stats.audioSend.push(c);break}}})}_getStats(){return new lt((e,r)=>{this.pc.getStats(e,r)})}statsResponsesToObjects(e){const r=[];return e.result().forEach(o=>{const s={id:o.id,timestamp:o.timestamp.valueOf().toString(),type:o.type};o.names().forEach(c=>{s[c]=o.stat(c)}),r.push(s)}),r}},mT=function(e){return e.BANDWIDTH="bandwidth",e.CPU="cpu",e.NONE="none",e.OTHER="other",e}({}),UA=function(e){return e.L1T1="L1T1",e.L1T2="L1T2",e.L1T3="L1T3",e.L1T3_KEY="L1T3_KEY",e.L2T1_KEY="L2T1_KEY",e.L2T2_KEY="L2T2_KEY",e.L2T3_KEY="L2T3_KEY",e.L3T1_KEY="L3T1_KEY",e.L3T2_KEY="L3T2_KEY",e.L3T3_KEY="L3T3_KEY",e}({}),ZL=function(e){return e[e.new=0]="new",e[e.connecting=1]="connecting",e[e.connected=2]="connected",e[e.disconnected=3]="disconnected",e[e.failed=4]="failed",e[e.closed=5]="closed",e}({}),Nc=function(e){return e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver",e}({});var Av=function(e){return e[e.kNone=1]="kNone",e[e.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",e[e.kBytesToBits=8]="kBytesToBits",e}(Av||{});function gT(e,r,o,s){let c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:Av.kNone;if(!r)return;const u=Number(r[o]);if(typeof u!="number")return;const h=Number(r[s]);if(typeof h!="number")return;if(!e)return h?u/h*c:void 0;const m=Number(e[o]);if(typeof m!="number")return;const _=Number(e[s]);if(typeof _!="number")return;const y=h-_;return y?(u-m)/y*c:void 0}let h8=class extends QL{constructor(){super(...arguments),zt(this,"_stats",pT),zt(this,"report",void 0),zt(this,"lastDecodeVideoReceiverStats",new Map),zt(this,"lastVideoFramesRecv",new Map),zt(this,"lastVideoFramesSent",new Map),zt(this,"lastVideoFramesDecode",new Map),zt(this,"lastVideoFramesOutput",new Map),zt(this,"lastVideoJBDelay",new Map),zt(this,"lastAudioJBDelay",new Map),zt(this,"mediaBytesSent",new Map),zt(this,"mediaBytesRetransmit",new Map),zt(this,"mediaBytesTargetEncode",new Map),zt(this,"lastDecodeAudioReceiverStats",new Map),zt(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=cu(pT),this.report.forEach(e=>{switch(e.type){case Nc.OUTBOUND:case Nc.INBOUND:{const r=e.mediaType||e.kind,o=!r&&"frameWidth"in e,s=!r&&!("frameWidth"in e);e.type===Nc.OUTBOUND?r==="audio"||s?this.processAudioOutboundStats(e):(r==="video"||o)&&this.processVideoOutboundStats(e):e.type===Nc.INBOUND&&(r==="audio"||s?this.processAudioInboundStats(e):(r==="video"||o)&&this.processVideoInboundStats(e));break}case Nc.TRANSPORT:{const r=this.report.get(e.selectedCandidatePairId);r&&this.processCandidatePairStats(r);break}case Nc.CANDIDATE_PAIR:e.selected&&this.processCandidatePairStats(e)}}),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const e=await this.pc.getStats(),r={local:mt({},ph),remote:mt({},ph)};return e.forEach(o=>{let s;if(o.type===Nc.TRANSPORT&&(s=e.get(o.selectedCandidatePairId)),o.type===Nc.CANDIDATE_PAIR&&o.selected&&(s=o),s){const c=(u,h)=>{u.type=h.type,u.id=h.id,h.address&&(u.address=h.address),h.candidateType&&(u.candidateType=h.candidateType),h.port&&(u.port=h.port),h.priority&&(u.priority=h.priority),h.protocol&&(u.protocol=h.protocol),h.relayProtocol&&(u.relayProtocol=h.relayProtocol)};if(s.localCandidateId){const u=e.get(s.localCandidateId);u&&c(r.local,u)}if(s.remoteCandidateId){const u=e.get(s.remoteCandidateId);u&&c(r.remote,u)}}}),r}processCandidatePairStats(e){if(this._stats.sendBandwidth=e.availableOutgoingBitrate||0,e.currentRoundTripTime&&(this._stats.rtt=1e3*e.currentRoundTripTime),this._stats.videoSend.forEach(r=>{e.currentRoundTripTime&&(r.rttMs=1e3*e.currentRoundTripTime)}),this._stats.audioSend.forEach(r=>{e.currentRoundTripTime&&(r.rttMs=1e3*e.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=e.id,e.localCandidateId){const r=this.report.get(e.localCandidateId);r&&this.processCandidateStats(r)}if(e.remoteCandidateId){const r=this.report.get(e.remoteCandidateId);r&&this.processCandidateStats(r)}}processCandidateStats(e){let r;e.type===Nc.LOCAL_CANDIDATE&&(r=this._stats.selectedCandidatePair.localCandidate),e.type===Nc.REMOTE_CANDIDATE&&(r=this._stats.selectedCandidatePair.remoteCandidate),r&&(r.type=e.type,r.id=e.id,e.address&&(r.address=e.address),e.candidateType&&(r.candidateType=e.candidateType),e.port&&(r.port=e.port),e.priority&&(r.priority=e.priority),e.protocol&&(r.protocol=e.protocol),e.relayProtocol&&(r.relayProtocol=e.relayProtocol),e.type===Nc.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==r.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(mt({},r),mt({},this.stats.selectedCandidatePair.localCandidate)),e.type===Nc.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==r.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(mt({},r),mt({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(e){let r=this._stats.audioRecv.find(s=>s.ssrc===e.ssrc);r||(r=cu(d8),this._stats.audioRecv.push(r)),r.ssrc=e.ssrc,r.packets=e.packetsReceived,r.packetsLost=e.packetsLost,r.packetsDiscarded=e.packetsDiscarded,r.bytes=e.bytesReceived,r.jitterMs=1e3*e.jitter,r.retransmittedBytesReceived=e.retransmittedBytesReceived,r.retransmittedPacketsReceived=e.retransmittedPacketsReceived,r.totalProcessingDelay=e.totalProcessingDelay,r.jitterBufferEmittedCount=e.jitterBufferEmittedCount;const o=this.lastDecodeAudioReceiverStats.get(r.ssrc);r.avgProcessingDelayMs=gT(o,r,"totalProcessingDelay","jitterBufferEmittedCount",Av.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(e,e.trackId,r),e.codecId&&(r.codec=this.getCodecFromCodecStats(e.codecId)),r.receivedFrames||(r.receivedFrames=e.packetsReceived),r.droppedFrames||(r.droppedFrames=e.packetsLost),r.receivedFrames>0&&!this.isFirstAudioReceived[r.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(r.ssrc),this.isFirstAudioReceived[r.ssrc]=!0),r.outputLevel&&r.outputLevel>0&&!this.isFirstAudioDecoded[r.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(r.ssrc),this.isFirstAudioDecoded[r.ssrc]=!0),typeof e.concealedSamples=="number"&&(r.concealedSamples=e.concealedSamples),this.lastDecodeAudioReceiverStats.set(r.ssrc,mt({},r))}processVideoInboundStats(e){let r=this._stats.videoRecv.find(h=>h.ssrc===e.ssrc);r||(r=cu(c8),this._stats.videoRecv.push(r)),r.ssrc=e.ssrc,r.packets=e.packetsReceived,r.packetsLost=e.packetsLost,r.bytes=e.bytesReceived,r.firsCount=e.firCount,r.nacksCount=e.nackCount,r.plisCount=e.pliCount,r.framesDecodeCount=e.framesDecoded,r.framesDroppedCount=e.framesDropped,r.totalInterFrameDelay=e.totalInterFrameDelay,r.totalSquaredInterFrameDelay=e.totalSquaredInterFrameDelay,r.totalFreezesDuration=e.totalFreezesDuration,r.totalProcessingDelay=e.totalProcessingDelay,r.packetsDiscarded=e.packetsDiscarded,r.framesAssembledFromMultiplePackets=e.framesAssembledFromMultiplePackets,r.totalAssemblyTime=e.totalAssemblyTime,r.keyFramesDecoded=e.keyFramesDecoded,r.retransmittedBytesReceived=e.retransmittedBytesReceived,r.retransmittedPacketsReceived=e.retransmittedPacketsReceived;const o=this.lastDecodeVideoReceiverStats.get(r.ssrc),s=this.lastVideoFramesDecode.get(r.ssrc),c=this.lastVideoFramesOutput.get(r.ssrc),u=Date.now();if(r.framesDecodeCount>0&&!this.isFirstVideoDecoded[r.ssrc]){const h=r.decodedFrame?r.decodedFrame.width:0,m=r.decodedFrame?r.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(r.ssrc,h,m),this.isFirstVideoDecoded[r.ssrc]=!0}if(o){const h=o.stats,m=u-o.lts;r.framesDecodeFreezeTime=h.framesDecodeFreezeTime,r.framesDecodeInterval=h.framesDecodeInterval,!this.isFirstVideoDecoded[r.ssrc]&&m>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[r.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(r.ssrc),this.isFirstVideoDecodedTimeout[r.ssrc]=!0),r.framesDecodeCount>h.framesDecodeCount&&this.isFirstVideoDecoded[r.ssrc]?(o.lts=Date.now(),r.framesDecodeInterval=m,r.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc))?r.framesDecodeFreezeTime+=r.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):r.framesDecodeCount<h.framesDecodeCount&&(r.framesDecodeInterval=0),e.framesDecoded&&e.qpSum&&(o.stats.framesDecodeCount>e.framesDecoded?r.qpSumPerFrame=e.qpSum/e.framesDecoded:r.qpSumPerFrame=(e.qpSum-o.qpSum)/(e.framesDecoded-o.stats.framesDecodeCount))}e.totalDecodeTime&&(r.decodeMs=1e3*e.totalDecodeTime,r.avgDecodeMs=gT(o==null?void 0:o.stats,r,"decodeMs","framesDecodeCount")),r.avgProcessingDelayMs=gT(o==null?void 0:o.stats,r,"totalProcessingDelay","framesDecodeCount",Av.kMillisecondsFromSeconds),r.avgFramesAssembledFromMultiplePacketsMs=gT(o==null?void 0:o.stats,r,"totalAssemblyTime","framesAssembledFromMultiplePackets",Av.kMillisecondsFromSeconds),r.avgInterFrameDelayMs=gT(o==null?void 0:o.stats,r,"totalInterFrameDelay","framesDecodeCount",Av.kMillisecondsFromSeconds),s&&u-s.lts>=800?(r.decodeFrameRate=Math.round((r.framesDecodeCount-s.count)/((u-s.lts)/1e3)),this.lastVideoFramesDecode.set(r.ssrc,{count:r.framesDecodeCount,lts:u,rate:r.decodeFrameRate})):s?r.decodeFrameRate=s.rate:this.lastVideoFramesDecode.set(r.ssrc,{count:r.framesDecodeCount,lts:u,rate:0}),r.framesDroppedCount&&e.framesReceived&&(c&&u-c.lts>=800?(r.outputFrameRate=Math.round((e.framesReceived-r.framesDroppedCount-c.count)/((u-c.lts)/1e3)),this.lastVideoFramesOutput.set(r.ssrc,{count:e.framesReceived-r.framesDroppedCount,lts:u,rate:Math.max(r.outputFrameRate,0)})):c?r.outputFrameRate=c.rate:this.lastVideoFramesOutput.set(r.ssrc,{count:e.framesReceived-r.framesDroppedCount,lts:u,rate:0})),this.processVideoTrackReceiverStats(e,e.trackId,r),e.codecId&&(r.codec=this.getCodecFromCodecStats(e.codecId)),e.framerateMean&&(r.framesRateFirefox=e.framerateMean),r.packets>0&&!this.isFirstVideoReceived[r.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(r.ssrc),this.isFirstVideoReceived[r.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(r.ssrc,{stats:mt({},r),lts:o?o.lts:Date.now(),qpSum:e.qpSum})}processVideoOutboundStats(e){let r=this._stats.videoSend.find(s=>s.ssrc===e.ssrc);r||(r=cu(l8),this._stats.videoSend.push(r));const o=this.mediaBytesSent.get(e.ssrc);if(o)o.add(e.bytesSent);else{const s=new JL(10);s.add(e.bytesSent),this.mediaBytesSent.set(e.ssrc,s)}if(e.retransmittedBytesSent!==void 0){const s=this.mediaBytesRetransmit.get(e.ssrc);if(s)s.add(e.retransmittedBytesSent);else{const c=new JL(10);c.add(e.retransmittedBytesSent),this.mediaBytesRetransmit.set(e.ssrc,c)}}if(e.totalEncodedBytesTarget){const s=this.mediaBytesTargetEncode.get(e.ssrc);if(s)s.add(e.totalEncodedBytesTarget);else{const c=new JL(10);c.add(e.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(e.ssrc,c)}}if(r.ssrc=e.ssrc,r.bytes=e.bytesSent,r.packets=e.packetsSent,r.firsCount=e.firCount,r.nacksCount=e.nackCount,r.plisCount=e.pliCount,r.frameCount=e.framesEncoded,r.adaptionChangeReason=e.qualityLimitationReason,r.scalabilityMode=e.scalabilityMode,r.retransmittedBytesSent=e.retransmittedBytesSent,r.retransmittedPacketsSent=e.retransmittedPacketsSent,r.hugeFramesSent=e.hugeFramesSent,r.keyFramesEncoded=e.keyFramesEncoded,e.totalEncodeTime&&e.framesEncoded){const s=this.lastEncoderMs.get(e.ssrc);if(!s||s.lastFrameCount>e.framesEncoded)r.avgEncodeMs=1e3*e.totalEncodeTime/e.framesEncoded;else{const c=e.framesEncoded-s.lastFrameCount,u=e.totalEncodeTime-s.lastEncoderTime;r.avgEncodeMs=1e3*u/c}}if(e.framesEncoded&&e.qpSum){const s=this.lastEncoderMs.get(e.ssrc);!s||s.lastFrameCount>e.framesEncoded?r.qpSumPerFrame=e.qpSum/e.framesEncoded:r.qpSumPerFrame=(e.qpSum-s.lastQpSum)/(e.framesEncoded-s.lastFrameCount)}if(this.lastEncoderMs.set(e.ssrc,{lastFrameCount:e.framesEncoded,lastEncoderTime:e.totalEncodeTime,lastQpSum:e.qpSum,lts:Date.now()}),e.codecId&&(r.codec=this.getCodecFromCodecStats(e.codecId)),e.mediaSourceId&&this.processVideoMediaSource(e.mediaSourceId,r),this.processVideoTrackSenderStats(e,e.trackId,r),e.remoteId)this.processRemoteInboundStats(e.remoteId,r);else{const s=this.findRemoteStatsId(e.ssrc,Nc.REMOTE_INBOUND);s&&this.processRemoteInboundStats(s,r)}}processAudioOutboundStats(e){let r=this._stats.audioSend.find(o=>o.ssrc===e.ssrc);if(r||(r=cu(u8),this._stats.audioSend.push(r)),r.ssrc=e.ssrc,r.packets=e.packetsSent,r.bytes=e.bytesSent,r.retransmittedBytesSent=e.retransmittedBytesSent,r.retransmittedPacketsSent=e.retransmittedPacketsSent,e.mediaSourceId&&this.processAudioMediaSource(e.mediaSourceId,r),e.codecId&&(r.codec=this.getCodecFromCodecStats(e.codecId)),this.processAudioTrackSenderStats(e,e.trackId,r),e.remoteId)this.processRemoteInboundStats(e.remoteId,r);else{const o=this.findRemoteStatsId(e.ssrc,Nc.REMOTE_INBOUND);o&&this.processRemoteInboundStats(o,r)}}findRemoteStatsId(e,r){var o;const s=Array.from(Pc(o=this.report).call(o)).find(c=>c.type===r&&c.ssrc===e);return s?s.id:null}processVideoMediaSource(e,r){const o=this.report.get(e);o&&o.width&&o.height&&o.framesPerSecond&&(r.inputFrame={width:o.width,height:o.height,frameRate:o.framesPerSecond})}processAudioMediaSource(e,r){const o=this.report.get(e);o&&(r.inputLevel=o.audioLevel)}processVideoTrackSenderStats(e,r,o){var s,c,u,h;const m=r?this.report.get(r):void 0,_=(s=m==null?void 0:m.framesSent)!==null&&s!==void 0?s:e.framesSent;if(typeof _!="number")return;let y=(c=m==null?void 0:m.frameWidth)!==null&&c!==void 0?c:e.frameWidth,S=(u=m==null?void 0:m.frameHeight)!==null&&u!==void 0?u:e.frameHeight,R=(h=m==null?void 0:m.framesPerSecond)!==null&&h!==void 0?h:e.framesPerSecond;if(typeof y=="number"&&typeof S=="number"||(y=0,S=0),R==null){const P=Date.now(),k=this.lastVideoFramesSent.get(o.ssrc);k&&P-k.lts>=800?(R=Math.round((_-k.count)/((P-k.lts)/1e3)),this.lastVideoFramesSent.set(o.ssrc,{count:_,lts:P,rate:R})):k?R=k.rate:this.lastVideoFramesSent.set(o.ssrc,{count:_,lts:P,rate:0})}o.sentFrame={width:y,height:S,frameRate:Math.max(0,R)}}processVideoTrackReceiverStats(e,r,o){var s,c,u,h,m;const _=r?this.report.get(r):void 0,y=(s=_==null?void 0:_.framesReceived)!==null&&s!==void 0?s:e.framesReceived,S=(c=_==null?void 0:_.frameWidth)!==null&&c!==void 0?c:e.frameWidth,R=(u=_==null?void 0:_.frameHeight)!==null&&u!==void 0?u:e.frameHeight,P=(h=_==null?void 0:_.jitterBufferDelay)!==null&&h!==void 0?h:e.jitterBufferDelay,k=(m=_==null?void 0:_.jitterBufferEmittedCount)!==null&&m!==void 0?m:e.jitterBufferEmittedCount;if(typeof y=="number"){const z=this.lastVideoFramesRecv.get(o.ssrc),U=Date.now();o.framesReceivedCount=y;let V=0;z&&U-z.lts>=800?(V=Math.round((y-z.count)/((U-z.lts)/1e3)),this.lastVideoFramesRecv.set(o.ssrc,{count:y,lts:U,rate:V})):z?V=z.rate:this.lastVideoFramesRecv.set(o.ssrc,{count:y,lts:U,rate:0}),o.receivedFrame={width:S||0,height:R||0,frameRate:V||0},o.decodedFrame={width:S||0,height:R||0,frameRate:o.decodeFrameRate||0},o.outputFrame={width:S||0,height:R||0,frameRate:o.outputFrameRate||o.decodeFrameRate||0}}if(P&&k){const z=this.lastVideoJBDelay.get(o.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let U=z.jitterBufferMs;const V=k-z.jitterBufferEmittedCount;V>0&&(U=1e3*(P-z.jitterBufferDelay)/V),o.jitterBufferMs=U,o.currentDelayMs=Math.round(U),this.lastVideoJBDelay.set(o.ssrc,{jitterBufferDelay:P,jitterBufferEmittedCount:k,jitterBufferMs:o.currentDelayMs})}}processAudioTrackSenderStats(e,r,o){var s,c,u,h;const m=r?this.report.get(r):void 0,_=(s=(c=m==null?void 0:m.echoReturnLoss)!==null&&c!==void 0?c:e.echoReturnLoss)!==null&&s!==void 0?s:0,y=(u=(h=m==null?void 0:m.echoReturnLossEnhancement)!==null&&h!==void 0?h:e.echoReturnLossEnhancement)!==null&&u!==void 0?u:0;o.aecReturnLoss=_,o.aecReturnLossEnhancement=y}processAudioTrackReceiverStats(e,r,o){var s,c,u,h,m,_,y;const S=r?this.report.get(r):void 0,R=(s=S==null?void 0:S.removedSamplesForAcceleration)!==null&&s!==void 0?s:e.removedSamplesForAcceleration,P=(c=S==null?void 0:S.totalSamplesReceived)!==null&&c!==void 0?c:e.totalSamplesReceived,k=(u=S==null?void 0:S.jitterBufferDelay)!==null&&u!==void 0?u:e.jitterBufferDelay,z=(h=S==null?void 0:S.jitterBufferEmittedCount)!==null&&h!==void 0?h:e.jitterBufferEmittedCount,U=(m=S==null?void 0:S.audioLevel)!==null&&m!==void 0?m:e==null?void 0:e.audioLevel,V=(_=S==null?void 0:S.totalSamplesDuration)!==null&&_!==void 0?_:e==null?void 0:e.totalSamplesDuration,q=(y=S==null?void 0:S.concealedSamples)!==null&&y!==void 0?y:e.concealedSamples;if(typeof P=="number"&&(o.totalSamplesReceived=P),R&&P&&(o.accelerateRate=R/P),k&&z){const ce=this.lastAudioJBDelay.get(o.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let _e=ce.jitterBufferMs;const Ee=z-ce.jitterBufferEmittedCount;Ee>0&&(_e=1e3*(k-ce.jitterBufferDelay)/Ee),o.jitterBufferMs=Math.round(_e),this.lastAudioJBDelay.set(o.ssrc,{jitterBufferDelay:k,jitterBufferEmittedCount:z,jitterBufferMs:o.jitterBufferMs})}o.outputLevel=U;let Y=1920;V&&P&&(Y=P/V/50,o.receivedFrames=Math.round(P/Y)),q&&(o.droppedFrames=Math.round(q/Y))}processRemoteInboundStats(e,r){const o=this.report.get(e);o&&(r.packetsLost=o.packetsLost,o.roundTripTime&&(r.rttMs=1e3*o.roundTripTime),o.jitter&&(r.jitterMs=1e3*o.jitter),o.timestamp&&(r.timestamp=o.timestamp))}getCodecFromCodecStats(e){const r=this.report.get(e);if(!r)return"";const o=r.mimeType.match(/\/(.*)$/);return o&&o[1]?o[1]:""}updateSendBitrate(){let e=0,r=null,o=null;this.mediaBytesSent.forEach(c=>{e+=c.diffMean()}),this.mediaBytesRetransmit.forEach(c=>{r=r===null?c.diffMean():r+c.diffMean()}),this.mediaBytesTargetEncode.forEach(c=>{o=o===null?c.diffMean():o+c.diffMean()});const s=r!==null?e-r:e;this._stats.bitrate={actualEncoded:8*s/(this.options.updateInterval/1e3),transmit:8*e/(this.options.updateInterval/1e3)},r!==null&&(this._stats.bitrate.retransmit=8*r/(this.options.updateInterval/1e3)),o!==null&&(this._stats.bitrate.targetEncoded=8*o/(this.options.updateInterval/1e3))}},Mfe=class extends QL{updateStats(){return lt.resolve()}};function ex(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const u=function(){const h=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return h&&h[0]?Number(h[0].split("/")[1]):null}();return u?u<76?new xfe(e,{updateInterval:r,lossRateInterval:o,freezeRateLimit:s,firstVideoDecodedTimeout:c}):new h8(e,{updateInterval:r,lossRateInterval:o,freezeRateLimit:s,firstVideoDecodedTimeout:c}):function(h){if(!window.RTCStatsReport)return!1;const m=h.getStats();return!!(m instanceof lt||function(_){return!!_&&(typeof _=="object"||typeof _=="function")&&typeof _.then=="function"}(m))}(e)?new h8(e,{updateInterval:r,lossRateInterval:o,freezeRateLimit:s,firstVideoDecodedTimeout:c}):new Mfe(e,{updateInterval:r,lossRateInterval:o,freezeRateLimit:s,firstVideoDecodedTimeout:c})}const f8="websdk_ng_install_id";function tx(){try{if(re("INSTALL_ID"))return re("INSTALL_ID");let e=window.localStorage.getItem(f8);return e||(e=A_(),window.localStorage.setItem(f8,e)),Xn("INSTALL_ID",e),e}catch{return}}const gl=function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;const r=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(r&&r[1]&&r[2]){const o=r[1],s=r[2];return"".concat(o,".").concat(s)}return"4.0.0.999"}("4.23.2"),nx=function(){try{return JSON.parse("true")===!0}catch{return!0}}();let P_=function(e){return e.Default="default",e.Auto="auto",e.Relay="relay",e.SdRtn="sd-rtn",e}({});const To=function(){const e="us".concat("erna","me"),r="pa".concat("sswo","rd"),o=["t","s","t"];o.splice(1,0,"e");const s=o.join(""),c=[];for(let m=0;m<6;m++)c.push("1");const u=c.join(""),h={};return h[e]=s,h[r]=u,Object.assign(h,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=To;const VA={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:2,ENABLE_AUT_FEEDBACK:!1,SVC_EXTENDED:["VP9"]},rx={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},ix="v4.23.2-0-g1599fdac-dirty(3/4/2025, 5:13:36 PM)",ox={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!1,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",USE_TURN_IP:!1,NEW_TURN_MODE:void 0,NEW_FORCE_TURN:!1},pr=mt(mt(mt({},ox),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS_METADATA:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:rx,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},VA),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1},{INSTALL_ID:""});function Xn(e,r,o){var s,c,u;st(s=Object.keys(pr)).call(s,e)&&(!o&&st(c=Object.keys(fd)).call(c,e)||(pr[e]=r,e!=="ENABLE_VIDEO_SEI"&&e!=="ENABLE_AUDIO_TOPN"&&e!=="ENABLE_AUDIO_METADATA"&&e!=="ENABLE_AUDIO_PTS_METADATA"||r!==!0||(pr.ENABLE_ENCODED_TRANSFORM=!0,e==="ENABLE_AUDIO_PTS_METADATA"&&(pr.ENABLE_AUDIO_METADATA=!0)),e==="USE_NEW_NETWORK_CONFIG"&&r&&(u=!!r,pr.USE_NEW_NETWORK_CONFIG=u,u&&(pr.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],pr.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],pr.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],pr.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],pr.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",pr.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",pr.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),e==="ENABLE_PRE_SUB"&&r&&(pr.ENABLE_INSTANT_VIDEO=!0,pr.ENABLE_PREALLOC_PC=!0),e==="ENABLE_SVC"&&r&&(pr.ENABLE_AUT_CC=!0),e==="NEW_FORCE_TURN"&&r&&(pr.NEW_TURN_MODE||(pr.NEW_TURN_MODE=4))))}function re(e){return pr[e]}nx||(pr.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],pr.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],pr.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],pr.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],pr.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],pr.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],pr.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",pr.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",pr.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",pr.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",pr.AREAS=["NORTH_AMERICA","OVERSEA"]);let p8=function(e){return e[e.REALTIME=1]="REALTIME",e}({});const fd={};var gn=function(e){return e.SET_SESSION_ID="SET_SESSION_ID",e.SET_P2P_ID="SET_P2P_id",e.SET_DC_ID="SET_DC_id",e.SET_UID="SET_UID",e.SET_INT_UID="SET_INT_UID",e.SET_PUB_ID="SET_PUB_ID",e.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e.AVOID_JOIN_START="AVOID_JOIN_START",e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",e.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",e.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",e.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",e.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",e.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",e.RESET_KEY_METRICS="RESET_KEY_METRICS",e.SET_USE_P2P="SET_USE_P2P",e.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",e}(gn||{});let FA=function(e){return e.h264="h264",e.h265="h265",e.vp8="vp8",e.vp9="vp9",e.av1="av1",e}({});(function(e){e.opus="opus",e.pcma="pcma",e.pcmu="pcmu",e.g722="g722"})({});const m8=128,Ufe=96,g8=1e3,Pv=10;let Vfe=0;var _8=(()=>{var e={8:(s,c,u)=>{u.r(c),u.d(c,{Parser:()=>ut,Printer:()=>Zr,parse:()=>ot,print:()=>bt});const h=`
`,m="".concat("\r").concat(h),_=" ";let y;function S(We){return We>="0"&&We<="9"}function R(We){return We>="!"&&We<="~"}function P(We){return R(We)||We>=""&&We<=""}function k(We){return We==="!"||We>="#"&&We<="'"||We>="*"&&We<="+"||We>="-"&&We<="."||We>="0"&&We<="9"||We>="A"&&We<="Z"||We>="^"&&We<="~"}function z(We){return We>="1"&&We<="9"}function U(We){return We>="A"&&We<="Z"||We>="a"&&We<="z"}function V(We){return We==="d"||We==="h"||We==="m"||We==="s"}function q(We){return We>""&&We<"	"||We>"\v"&&We<"\f"||We>""&&We<""}function Y(We){return U(We)||S(We)||We==="+"||We==="/"}function ce(We){return S(We)||U(We)||We==="+"||We==="/"||We==="-"||We==="_"}function _e(We){return U(We)||S(We)||We==="+"||We==="/"}function Ee(We,x){var ie=Object.keys(We);if(Object.getOwnPropertySymbols){var de=Object.getOwnPropertySymbols(We);x&&(de=de.filter(function(Qe){return Object.getOwnPropertyDescriptor(We,Qe).enumerable})),ie.push.apply(ie,de)}return ie}function me(We){for(var x=1;x<arguments.length;x++){var ie=arguments[x]!=null?arguments[x]:{};x%2?Ee(Object(ie),!0).forEach(function(de){ke(We,de,ie[de])}):Object.getOwnPropertyDescriptors?Object.defineProperties(We,Object.getOwnPropertyDescriptors(ie)):Ee(Object(ie)).forEach(function(de){Object.defineProperty(We,de,Object.getOwnPropertyDescriptor(ie,de))})}return We}function ke(We,x,ie){return x in We?Object.defineProperty(We,x,{value:ie,enumerable:!0,configurable:!0,writable:!0}):We[x]=ie,We}(function(We){We.VERSION="v",We.ORIGIN="o",We.SESSION_NAME="s",We.INFORMATION="i",We.URI="u",We.EMAIL="e",We.PHONE="p",We.CONNECTION="c",We.BANDWIDTH="b",We.TIME="t",We.REPEAT="r",We.ZONE_ADJUSTMENTS="z",We.KEY="k",We.ATTRIBUTE="a",We.MEDIA="m"})(y||(y={}));class Ye{consumeText(x,ie){let de=ie;for(;de<x.length;){const Qe=x[de];if(Qe==="\0"||Qe==="\r"||Qe===h)break;de+=1}if(de-ie==0)throw new Error("Invalid text, at ".concat(x));return de}consumeUnicastAddress(x,ie,de){return this.consumeTill(x,ie,_)}consumeOneOrMore(x,ie,de){let Qe=ie;for(;de(x[Qe]);)Qe++;if(Qe-ie==0)throw new Error("Invalid rule at ".concat(ie,"."));return Qe}consumeSpace(x,ie){if(x[ie]===_)return ie+1;throw new Error("Invalid space at ".concat(ie,"."))}consumeIP4Address(x,ie){let de=ie;for(let Qe=0;Qe<4;Qe++)if(de=this.consumeDecimalUChar(x,de),Qe!==3){if(x[de]!==".")throw new Error("Invalid IP4 address.");de++}return de}consumeDecimalUChar(x,ie){let de=ie;for(let Ht=0;Ht<3&&S(x[de]);Ht++,de++);if(de-ie==0)throw new Error("Invalid decimal uchar.");const Qe=parseInt(x.slice(ie,de));if(Qe>=0&&Qe<=255)return de;throw new Error("Invalid decimal uchar")}consumeIP6Address(x,ie){let de=this.consumeHexpart(x,ie);return x[de]===":"&&(de+=1,de=this.consumeIP4Address(x,de)),de}consumeHexpart(x,ie){let de=ie;if(x[de]===":"&&x[de+1]===":"){de+=2;try{de=this.consumeHexseq(x,de)}catch{}return de}if(de=this.consumeHexseq(x,de),x[de]===":"&&x[de+1]===":"){de+=2;try{de=this.consumeHexseq(x,de)}catch{}return de}return de}consumeHexseq(x,ie){let de=ie;for(;de=this.consumeHex4(x,de),x[de]===":"&&x[de+1]!==":";)de+=1;return de}consumeHex4(x,ie){let de=0;for(;de<4;de++)if(!((Qe=x[ie+de])>="0"&&Qe<="9"||Qe>="a"&&Qe<="f"||Qe>="A"&&Qe<="F")){if(de===0)throw new Error("Invalid hex 4");break}var Qe;return ie+de}consumeFQDN(x,ie){let de=ie;for(;S(x[de])||U(x[de])||x[de]==="-"||x[de]===".";)de+=1;if(de-ie<4)throw new Error("Invalid FQDN");return de}consumeExtnAddr(x,ie){return this.consumeOneOrMore(x,ie,P)}consumeMulticastAddress(x,ie,de){switch(de){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(x,ie);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(x,ie);default:try{return this.consumeFQDN(x,ie)}catch{return this.consumeExtnAddr(x,ie)}}}consumeIP6MulticastAddress(x,ie){const de=this.consumeHexpart(x,ie);return x[de]==="/"?this.consumeInteger(x,de+1):de}consumeIP4MulticastAddress(x,ie){let de=ie+3;const Qe=x.slice(ie,de),Ht=parseInt(Qe);if(Ht<224||Ht>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let tr=0;tr<3;tr++){if(x[de]!==".")throw new Error("Invalid IP4 multicast address.");de+=1,de=this.consumeDecimalUChar(x,de)}return x[de]==="/"&&(de+=1),de=this.consumeTTL(x,de),x[de]==="/"&&(de=this.consumeInteger(x,de)),de}consumeInteger(x,ie){if(!z(x[ie]))throw new Error("Invalid integer.");for(ie+=1;S(x[ie]);)ie+=1;return ie}consumeTTL(x,ie){if(x[ie]==="0")return ie+1;if(!z(x[ie]))throw new Error("Invalid TTL.");ie+=1;for(let de=0;de<2&&S(x[ie]);de++)ie+=1;return ie}consumeToken(x,ie){return this.consumeOneOrMore(x,ie,k)}consumeTime(x,ie){let de=ie;if(x[de]==="0")return de+1;for(z(x[de])&&(de+=1);S(x[de]);)de++;if(de-ie<10)throw new Error("Invalid time");return de}consumeAddress(x,ie){return this.consumeTill(x,ie,_)}consumeTypedTime(x,ie){let de=ie;return de=this.consumeOneOrMore(x,de,S),V(x[de])?de+1:de}consumeRepeatInterval(x,ie){if(!z(x[ie]))throw new Error("Invalid repeat interval");for(ie+=1;S(x[ie]);)ie+=1;return V(x[ie])&&(ie+=1),ie}consumePort(x,ie){return this.consumeOneOrMore(x,ie,S)}consume(x,ie,de){for(let Qe=0;Qe<de.length;Qe++){if(ie+Qe>=x.length)throw new Error("consume exceeding value length");if(x[ie+Qe]!==de[Qe])throw new Error("consume ".concat(de," failed at ").concat(Qe))}return ie+de.length}consumeTill(x,ie,de){let Qe=ie;for(;Qe<x.length&&(typeof de!="string"||x[Qe]!==de)&&(typeof de!="function"||!de(x[Qe]));)Qe++;return Qe}}class ut extends Ye{constructor(){super(),ke(this,"records",[]),ke(this,"currentLine",0)}parse(x){const ie=this.probeEOL(x);this.records=x.split(ie).filter(Z_=>!!es(Z_).call(Z_)).map(this.parseLine),this.currentLine=0;const de=this.parseVersion(),Qe=this.parseOrigin(),Ht=this.parseSessionName(),tr=this.parseInformation(),Wi=this.parseUri(),Ra=this.parseEmail(),rp=this.parsePhone(),Q_=this.parseConnection(),ZT=this.parseBandWidth(),XP=this.parseTimeFields(),JP=this.parseKey(),wl=this.parseSessionAttribute(),Gm=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:de,origin:Qe,sessionName:Ht,information:tr,uri:Wi,emails:Ra,phones:rp,connection:Q_,bandwidths:ZT,timeFields:XP,key:JP,attributes:wl,mediaDescriptions:Gm}}getCurrentRecord(){const x=this.records[this.currentLine];if(!x)throw new Error("Record doesn't exit.");return x}probeEOL(x){for(let ie=0;ie<x.length;ie++)if(x[ie]===h)return x[ie-1]==="\r"?m:h;throw new Error("Invalid newline character.")}parseLine(x,ie){if(x.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const de=x[0];if(x[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:de,value:x.slice(2),line:ie,cur:0}}parseSessionAttribute(){const x=new vn;for(;this.currentLine<this.records.length;){const ie=this.getCurrentRecord();if(ie.type!==y.ATTRIBUTE)break;const de={attField:this.extractOneOrMore(ie,Qe=>k(Qe)&&Qe!==":"),_cur:0};ie.value[ie.cur]===":"&&(ie.cur+=1,de.attValue=this.extractOneOrMore(ie,q)),x.parse(de),this.currentLine++}return x.digest()}parseMediaAttributes(x){const ie=new Sn(x);for(;this.currentLine<this.records.length;){const de=this.getCurrentRecord();if(de.type!==y.ATTRIBUTE)break;const Qe={attField:this.extractOneOrMore(de,Ht=>k(Ht)&&Ht!==":"),_cur:0};de.value[de.cur]===":"&&(de.cur+=1,Qe.attValue=this.extractOneOrMore(de,q)),ie.parse(Qe),this.currentLine++}return ie.digest()}parseKey(){const x=this.getCurrentRecord();if(x.type===y.KEY){if(x.value==="prompt"||x.value==="clear:"||x.value==="base64:"||x.value==="uri:")return x.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const x=this.getCurrentRecord();if(x.type===y.ZONE_ADJUSTMENTS){const ie=[];for(;;)try{const de=this.extract(x,this.consumeTime);this.consumeSpaceForRecord(x);let Qe=!1;x.value[x.cur]==="-"&&(Qe=!0,x.cur+=1);const Ht=this.extract(x,this.consumeTypedTime);ie.push({time:de,typedTime:Ht,back:Qe})}catch{break}if(ie.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,ie}return[]}parseRepeat(){const x=[];for(;;){const ie=this.getCurrentRecord();if(ie.type!==y.REPEAT)break;{const de=this.extract(ie,this.consumeRepeatInterval),Qe=this.parseTypedTime(ie);x.push({repeatInterval:de,typedTimes:Qe}),this.currentLine++}}return x}parseTypedTime(x){const ie=[];for(;;)try{this.consumeSpaceForRecord(x),ie.push(this.extract(x,this.consumeTypedTime))}catch{break}if(ie.length===0)throw new Error("Invalid typed time.");return ie}parseTime(){const x=this.getCurrentRecord(),ie=this.extract(x,this.consumeTime);this.consumeSpaceForRecord(x);const de=this.extract(x,this.consumeTime);return this.currentLine++,{startTime:ie,stopTime:de}}parseBandWidth(){const x=[];for(;this.currentLine<this.records.length;){const ie=this.getCurrentRecord();if(ie.type!==y.BANDWIDTH)break;{const de=this.extractOneOrMore(ie,k);if(ie.value[ie.cur]!==":")throw new Error("Invalid bandwidth field.");ie.cur++;const Qe=this.extractOneOrMore(ie,S);x.push({bwtype:de,bandwidth:Qe}),this.currentLine++}}return x}parseVersion(){const x=this.getCurrentRecord();if(x.type!==y.VERSION)throw new Error("first sdp record must be version");const ie=x.value.slice(0,this.consumeOneOrMore(x.value,0,S));if(ie.length!==x.value.length)throw new Error('invalid proto version, "v='.concat(x.value,'"'));return this.currentLine++,ie}parseOrigin(){const x=this.getCurrentRecord();if(x.type!==y.ORIGIN)throw new Error("second line of sdp must be origin");const ie=this.extractOneOrMore(x,P);this.consumeSpaceForRecord(x);const de=this.extractOneOrMore(x,S);this.consumeSpaceForRecord(x);const Qe=this.extractOneOrMore(x,S);this.consumeSpaceForRecord(x);const Ht=this.extractOneOrMore(x,k);this.consumeSpaceForRecord(x);const tr=this.extractOneOrMore(x,k);this.consumeSpaceForRecord(x);const Wi=this.extract(x,this.consumeUnicastAddress);return this.currentLine++,{username:ie,sessId:de,sessVersion:Qe,nettype:Ht,addrtype:tr,unicastAddress:Wi}}parseSessionName(){const x=this.getCurrentRecord();if(x.type===y.SESSION_NAME){const ie=this.extract(x,this.consumeText);return this.currentLine++,ie}}parseInformation(){const x=this.getCurrentRecord();if(x.type!==y.INFORMATION)return;const ie=this.extract(x,this.consumeText);return this.currentLine++,ie}parseUri(){const x=this.getCurrentRecord();if(x.type===y.URI)return this.currentLine++,x.value}parseEmail(){const x=[];for(;;){const ie=this.getCurrentRecord();if(ie.type!==y.EMAIL)break;x.push(ie.value),this.currentLine++}return x}parsePhone(){const x=[];for(;;){const ie=this.getCurrentRecord();if(ie.type!==y.PHONE)break;x.push(ie.value),this.currentLine++}return x}parseConnection(){const x=this.getCurrentRecord();if(x.type===y.CONNECTION){const ie=this.extractOneOrMore(x,k);this.consumeSpaceForRecord(x);const de=this.extractOneOrMore(x,k);this.consumeSpaceForRecord(x);const Qe=this.extract(x,this.consumeAddress);return this.currentLine++,{nettype:ie,addrtype:de,address:Qe}}}parseMedia(){const x=this.getCurrentRecord(),ie=this.extract(x,this.consumeToken);this.consumeSpaceForRecord(x);let de=this.extract(x,this.consumePort);x.value[x.cur]==="/"&&(x.cur+=1,de+=this.extract(x,this.consumeInteger)),this.consumeSpaceForRecord(x);const Qe=[];for(Qe.push(this.extract(x,this.consumeToken));x.value[x.cur]==="/";)x.cur+=1,Qe.push(this.extract(x,this.consumeToken));if(Qe.length===0)throw new Error("Invalid proto");const Ht=this.parseFmt(x);return this.currentLine++,{mediaType:ie,port:de,protos:Qe,fmts:Ht}}parseTimeFields(){const x=[];for(;this.getCurrentRecord().type===y.TIME;){const ie=this.parseTime(),de=this.parseRepeat(),Qe=this.parseZone();x.push({time:ie,repeats:de,zones:Qe})}return x}parseMediaDescription(){const x=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===y.MEDIA;){const ie=this.parseMedia(),de=this.parseInformation(),Qe=this.parseConnections(),Ht=this.parseBandWidth(),tr=this.parseKey(),Wi=this.parseMediaAttributes(ie);x.push({media:ie,information:de,connections:Qe,bandwidths:Ht,key:tr,attributes:Wi})}return x}parseConnections(){const x=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===y.CONNECTION;)x.push(this.parseConnection());return x}parseFmt(x){const ie=[];for(;;)try{this.consumeSpaceForRecord(x),ie.push(this.extract(x,this.consumeToken))}catch{break}if(ie.length===0)throw new Error("Invalid fmts");return ie}extract(x,ie){for(var de=arguments.length,Qe=new Array(de>2?de-2:0),Ht=2;Ht<de;Ht++)Qe[Ht-2]=arguments[Ht];const tr=ie.call(this,x.value,x.cur,...Qe),Wi=x.value.slice(x.cur,tr);return x.cur=tr,Wi}extractOneOrMore(x,ie){const de=this.consumeOneOrMore(x.value,x.cur,ie),Qe=x.value.slice(x.cur,de);return x.cur=de,Qe}consumeSpaceForRecord(x){if(x.value[x.cur]!==_)throw new Error("Invalid space at ".concat(x.cur,"."));x.cur+=1}}class pt extends Ye{constructor(){super(...arguments),ke(this,"attributes",void 0),ke(this,"digested",!1)}extractOneOrMore(x,ie,de){const Qe=this.consumeOneOrMore(x.attValue,x._cur,ie),Ht=x.attValue.slice(x._cur,Qe),[tr,Wi]=de||[];if(typeof tr=="number"&&Ht.length<tr)throw new Error("error in length, should be more or equal than ".concat(tr," characters."));if(typeof Wi=="number"&&Ht.length>Wi)throw new Error("error in length, should be less or equal than ".concat(Wi," characters."));return x._cur=Qe,Ht}consumeAttributeSpace(x){if(x.attValue[x._cur]!==_)throw new Error("Invalid space at ".concat(x._cur,"."));x._cur+=1}extract(x,ie){if(!x.attValue)throw new Error("Nothing to extract from attValue.");for(var de=arguments.length,Qe=new Array(de>2?de-2:0),Ht=2;Ht<de;Ht++)Qe[Ht-2]=arguments[Ht];const tr=ie.call(this,x.attValue,x._cur,...Qe),Wi=x.attValue.slice(x._cur,tr);return x._cur=tr,Wi}atEnd(x){if(!x.attValue)throw new Error;return x._cur>=x.attValue.length}peekChar(x){if(!x.attValue)throw new Error;return x.attValue[x._cur]}peek(x,ie){if(!x.attValue)throw new Error;for(let de=0;de<ie.length;de++)if(ie[de]!==x.attValue[x._cur+de])return!1;return!0}parseIceUfrag(x){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(x,Y,[4,256])}parseIcePwd(x){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(x,Y,[22,256])}parseIceOptions(x){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const ie=[];for(;!this.atEnd(x);){ie.push(this.extractOneOrMore(x,Y));try{this.consumeAttributeSpace(x)}catch(de){if(this.atEnd(x))break;throw de}}this.attributes.iceOptions=ie}parseFingerprint(x){const ie=this.extract(x,this.consumeToken);this.consumeAttributeSpace(x);const de=this.extract(x,this.consumeTill);this.attributes.fingerprints.push({hashFunction:ie,fingerprint:de})}parseExtmap(x){const ie=this.extractOneOrMore(x,S);let de;this.peekChar(x)==="/"&&(this.extract(x,this.consume,"/"),de=this.extract(x,this.consumeToken)),this.consumeAttributeSpace(x);const Qe=this.extract(x,this.consumeTill,_),Ht=me(me({entry:parseInt(ie,10)},de&&{direction:de}),{},{extensionName:Qe});this.peekChar(x)===_&&(this.consumeAttributeSpace(x),Ht.extensionAttributes=this.extract(x,this.consumeTill)),this.attributes.extmaps.push(Ht)}parseSetup(x){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const ie=this.extract(x,this.consumeTill);if(ie!=="active"&&ie!=="passive"&&ie!=="actpass"&&ie!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=ie}}class vn extends pt{constructor(){super(...arguments),ke(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(x){if(this.digested)throw new Error("already digested");try{switch(x.attField){case"group":this.parseGroup(x);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(x);break;case"ice-pwd":this.parseIcePwd(x);break;case"ice-options":this.parseIceOptions(x);break;case"fingerprint":this.parseFingerprint(x);break;case"setup":this.parseSetup(x);break;case"tls-id":this.parseTlsId(x);break;case"identity":this.parseIdentity(x);break;case"extmap":this.parseExtmap(x);break;case"msid-semantic":this.parseMsidSemantic(x);break;default:x.ignored=!0,this.attributes.unrecognized.push(x)}}catch(ie){throw console.error("parsing session attribute ".concat(x.attField,' error, "a=').concat(x.attField,":").concat(x.attValue,'"')),ie}if(!x.ignored&&x.attValue&&!this.atEnd(x))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(x){const ie=this.extract(x,this.consumeToken),de=[];for(;!this.atEnd(x)&&this.peekChar(x)===_;)this.consumeAttributeSpace(x),de.push(this.extract(x,this.consumeToken));this.attributes.groups.push({semantic:ie,identificationTag:de})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(x){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(x,ce)}parseIdentity(x){const ie=this.extractOneOrMore(x,_e),de=[];for(;!this.atEnd(x)&&this.peekChar(x)===_;){this.consumeAttributeSpace(x);const Qe=this.extract(x,this.consumeToken);this.extract(x,this.consume,"=");const Ht=this.extractOneOrMore(x,tr=>tr!==_&&q(tr));de.push({name:Qe,value:Ht})}this.attributes.identities.push({assertionValue:ie,extensions:de})}parseMsidSemantic(x){this.peekChar(x)===_&&this.consumeAttributeSpace(x);const ie={semantic:this.extract(x,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(x)}catch{break}if(this.peekChar(x)==="*"){this.extract(x,this.consume,"*"),ie.applyForAll=!0;break}{const de=this.extract(x,this.consumeTill,_);ie.identifierList.push(de)}}this.attributes.msidSemantic=ie}}class Sn extends pt{constructor(x){super(),ke(this,"attributes",void 0),x.protos.indexOf("RTP")!==-1||x.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(x){if(this.digested)throw new Error("already digested");try{switch(x.attField){case"extmap":this.parseExtmap(x);break;case"setup":this.parseSetup(x);break;case"ice-ufrag":this.parseIceUfrag(x);break;case"ice-pwd":this.parseIcePwd(x);break;case"ice-options":this.parseIceOptions(x);break;case"candidate":this.parseCandidate(x);break;case"remote-candidate":this.parseRemoteCandidate(x);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(x);break;case"rtpmap":this.parseRtpmap(x);break;case"ptime":this.parsePtime(x);break;case"maxptime":this.parseMaxPtime(x);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(x);break;case"ssrc":this.parseSSRC(x);break;case"fmtp":this.parseFmtp(x);break;case"rtcp-fb":this.parseRtcpFb(x);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(x);break;case"mid":this.parseMid(x);break;case"msid":this.parseMsid(x);break;case"imageattr":this.parseImageAttr(x);break;case"rid":this.parseRid(x);break;case"simulcast":this.parseSimulcast(x);break;case"sctp-port":this.parseSctpPort(x);break;case"max-message-size":this.parseMaxMessageSize(x);break;case"ssrc-group":this.parseSSRCGroup(x);break;default:x.ignored=!0,this.attributes.unrecognized.push(x)}}catch(ie){throw console.error("parsing media attribute ".concat(x.attField,' error, "a=').concat(x.attField,":").concat(x.attValue,'"')),ie}if(!x.ignored&&x.attValue&&!this.atEnd(x))throw new Error("attribute parsing error")}parseCandidate(x){const ie=this.extractOneOrMore(x,Y,[1,32]);this.consumeAttributeSpace(x);const de=this.extractOneOrMore(x,S,[1,5]);this.consumeAttributeSpace(x);const Qe=this.extract(x,this.consumeToken);this.consumeAttributeSpace(x);const Ht=this.extractOneOrMore(x,S,[1,10]);this.consumeAttributeSpace(x);const tr=this.extract(x,this.consumeAddress);this.consumeAttributeSpace(x);const Wi=this.extract(x,this.consumePort);this.consumeAttributeSpace(x),this.extract(x,this.consume,"typ"),this.consumeAttributeSpace(x);const Ra={foundation:ie,componentId:de,transport:Qe,priority:Ht,connectionAddress:tr,port:Wi,type:this.extract(x,this.consumeToken),extension:{}};for(this.peek(x," raddr")&&(this.extract(x,this.consume," raddr"),this.consumeAttributeSpace(x),Ra.relAddr=this.extract(x,this.consumeAddress)),this.peek(x," rport")&&(this.extract(x,this.consume," rport"),this.consumeAttributeSpace(x),Ra.relPort=this.extract(x,this.consumePort));this.peekChar(x)===_;){this.consumeAttributeSpace(x);const rp=this.extract(x,this.consumeToken);this.consumeAttributeSpace(x),Ra.extension[rp]=this.extractOneOrMore(x,R)}this.attributes.candidates.push(Ra)}parseRemoteCandidate(x){const ie=[];for(;;){const de=this.extractOneOrMore(x,S,[1,5]);this.consumeAttributeSpace(x);const Qe=this.extract(x,this.consumeAddress);this.consumeAttributeSpace(x);const Ht=this.extract(x,this.consumePort);ie.push({componentId:de,connectionAddress:Qe,port:Ht});try{this.consumeAttributeSpace(x)}catch{break}}this.attributes.remoteCandidatesList.push(ie)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(x){const ie=this.extract(x,this.consumeToken);this.consumeAttributeSpace(x);const de=this.extract(x,this.consumeTill,"/");this.extract(x,this.consume,"/");const Qe={encodingName:de,clockRate:this.extractOneOrMore(x,S)};this.atEnd(x)||this.peekChar(x)!=="/"||(this.extract(x,this.consume,"/"),Qe.encodingParameters=parseInt(this.extract(x,this.consumeTill),10));const Ht=this.attributes.payloads.find(tr=>tr.payloadType===parseInt(ie,10));Ht?Ht.rtpMap=Qe:this.attributes.payloads.push({payloadType:parseInt(ie,10),rtpMap:Qe,rtcpFeedbacks:[]})}parsePtime(x){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(x,this.consumeTill)}parseMaxPtime(x){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(x,this.consumeTill)}parseDirection(x){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=x.attField}parseSSRC(x){const ie=this.extractOneOrMore(x,S);this.consumeAttributeSpace(x);const de=this.extract(x,this.consumeTill,":");let Qe;this.peekChar(x)===":"&&(this.extract(x,this.consume,":"),Qe=this.extract(x,this.consumeTill));const Ht=this.attributes.ssrcs.find(tr=>tr.ssrcId===parseInt(ie,10));Ht?Ht.attributes[de]=Qe:this.attributes.ssrcs.push({ssrcId:parseInt(ie,10),attributes:{[de]:Qe}})}parseFmtp(x){const ie=this.extract(x,this.consumeTill,_);this.consumeAttributeSpace(x);const de=this.extract(x,this.consumeTill),Qe={};de.split(";").forEach(tr=>{let[Wi,Ra]=tr.split("=");Wi=es(Wi).call(Wi);const rp=typeof Ra=="string"?es(Ra).call(Ra):null;typeof Wi=="string"&&Wi.length>0&&(Qe[Wi]=rp)});const Ht=this.attributes.payloads.find(tr=>tr.payloadType===parseInt(ie,10));Ht?Ht.fmtp={parameters:Qe}:this.attributes.payloads.push({payloadType:parseInt(ie,10),rtcpFeedbacks:[],fmtp:{parameters:Qe}})}parseFmtParameters(x){const ie={},de=this.extract(x,this.consumeTill,"=");x._cur++;const Qe=this.extract(x,this.consumeTill,";");for(ie[de]=Qe;x.attValue[x._cur]===";";){const Ht=this.extract(x,this.consumeTill,"=");x._cur++;const tr=this.extract(x,this.consumeTill,";");ie[Ht]=tr}return ie}parseRtcpFb(x){let ie="";ie=this.peekChar(x)==="*"?this.extract(x,this.consume,"*"):this.extract(x,this.consumeTill,_),this.consumeAttributeSpace(x);const de=this.extract(x,this.consumeTill,_);let Qe;if(de==="trr-int")Qe={type:de,interval:this.extract(x,this.consumeTill)};else{const Ht={type:de};this.peekChar(x)===_&&(this.consumeAttributeSpace(x),Ht.parameter=this.extract(x,this.consumeToken),this.peekChar(x)===_&&(Ht.additional=this.extract(x,this.consumeTill))),Qe=Ht}if(ie==="*")this.attributes.rtcpFeedbackWildcards.push(Qe);else{const Ht=this.attributes.payloads.find(tr=>tr.payloadType===parseInt(ie,10));Ht?Ht.rtcpFeedbacks.push(Qe):this.attributes.payloads.push({payloadType:parseInt(ie,10),rtcpFeedbacks:[Qe]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(x){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const ie={port:this.extract(x,this.consumePort)};this.peekChar(x)===_&&(this.consumeAttributeSpace(x),ie.netType=this.extractOneOrMore(x,k),this.consumeAttributeSpace(x),ie.addressType=this.extractOneOrMore(x,k),this.consumeAttributeSpace(x),ie.address=this.extract(x,this.consumeAddress)),this.attributes.rtcp=ie}parseMsid(x){const ie={id:this.extractOneOrMore(x,k,[1,64])};this.peekChar(x)===_&&(this.consumeAttributeSpace(x),ie.appdata=this.extractOneOrMore(x,k,[1,64])),this.attributes.msids.push(ie)}parseImageAttr(x){this.attributes.imageattr.push(x.attValue)}parseRid(x){const ie=this.extractOneOrMore(x,Qe=>U(Qe)||S(Qe)||Qe==="_"||Qe==="-");this.consumeAttributeSpace(x);const de={id:ie,direction:this.extract(x,this.consumeToken),params:[]};if(this.peekChar(x)===_){if(this.consumeAttributeSpace(x),this.peek(x,"pt=")){this.extract(x,this.consume,"pt=");const Qe=[];for(;;){const Ht=this.extract(x,this.consumeToken);Qe.push(Ht);try{this.extract(x,this.consume,",")}catch{break}}de.payloads=Qe,this.peekChar(x)===_&&this.extract(x,this.consume,_)}for(;;){const Qe=this.extract(x,this.consumeToken);switch(Qe){case"depend":{const Ht={type:Qe,rids:this.extract(x,this.consume,"=").split(",")};de.params.push(Ht);break}default:{const Ht={type:Qe};this.peekChar(x)==="="&&(this.extract(x,this.consume,"="),Ht.val=this.extract(x,this.consumeTill,";")),de.params.push(Ht)}}try{this.extract(x,this.consume,";")}catch{break}}}this.attributes.rids.push(de)}parseSimulcast(x){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=x.attValue,this.extract(x,this.consumeTill)}parseSctpPort(x){this.attributes.sctpPort=this.extractOneOrMore(x,S,[1,5])}parseMaxMessageSize(x){this.attributes.maxMessageSize=this.extractOneOrMore(x,S,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(x){this.attributes.mid=this.extract(x,this.consumeToken)}parseSSRCGroup(x){const ie=this.extract(x,this.consumeToken),de=[];for(;;)try{this.consumeAttributeSpace(x);const Qe=this.extract(x,this.consumeInteger);de.push(parseInt(Qe,10))}catch{break}this.attributes.ssrcGroups.push({semantic:ie,ssrcIds:de})}}function cr(We,x,ie){return x in We?Object.defineProperty(We,x,{value:ie,enumerable:!0,configurable:!0,writable:!0}):We[x]=ie,We}class Zr{constructor(){cr(this,"eol",m)}print(x,ie){let de="";return ie&&(this.eol=ie),de+=this.printVersion(x.version),de+=this.printOrigin(x.origin),de+=this.printSessionName(x.sessionName),de+=this.printInformation(x.information),de+=this.printUri(x.uri),de+=this.printEmail(x.emails),de+=this.printPhone(x.phones),de+=this.printConnection(x.connection),de+=this.printBandwidth(x.bandwidths),de+=this.printTimeFields(x.timeFields),de+=this.printKey(x.key),de+=this.printSessionAttributes(x.attributes),de+=this.printMediaDescription(x.mediaDescriptions),de}printVersion(x){return"v=".concat(x).concat(this.eol)}printOrigin(x){return"o=".concat(x.username," ").concat(x.sessId," ").concat(x.sessVersion," ").concat(x.nettype," ").concat(x.addrtype," ").concat(x.unicastAddress).concat(this.eol)}printSessionName(x){return x?"s=".concat(x).concat(this.eol):""}printInformation(x){return x?"i=".concat(x).concat(this.eol):""}printUri(x){return x?"u=".concat(x).concat(this.eol):""}printEmail(x){let ie="";for(const de of x)ie+="e=".concat(de).concat(this.eol);return ie}printPhone(x){let ie="";for(const de of x)ie+="e=".concat(de).concat(this.eol);return ie}printConnection(x){return x?"c=".concat(x.nettype," ").concat(x.addrtype," ").concat(x.address).concat(this.eol):""}printBandwidth(x){let ie="";for(const de of x)ie+="b=".concat(de.bwtype,":").concat(de.bandwidth).concat(this.eol);return ie}printTimeFields(x){let ie="";for(const de of x){ie+="t=".concat(de.time.startTime," ").concat(de.time.startTime).concat(this.eol);for(const Qe of de.repeats)ie+="r=".concat(Qe.repeatInterval," ").concat(Qe.typedTimes.join(" ")).concat(this.eol);de.zoneAdjustments&&(ie+="z=",ie+="z=".concat(de.zoneAdjustments.map(Qe=>"".concat(Qe.time," ").concat(Qe.back?"-":""," ").concat(Qe.typedTime)).join(" ")).concat(this.eol),ie+=this.eol)}return ie}printKey(x){return x?"k=".concat(x).concat(this.eol):""}printAttributes(x){let ie="";for(const de of x)ie+="a=".concat(de.attField).concat(de.attValue?":".concat(de.attValue):"").concat(this.eol);return ie}printMediaDescription(x){let ie="";for(const de of x)ie+=this.printMedia(de.media),ie+=this.printInformation(de.information),ie+=this.printConnections(de.connections),ie+=this.printBandwidth(de.bandwidths),ie+=this.printKey(de.key),ie+=this.printMediaAttributes(de);return ie}printConnections(x){let ie="";for(const de of x)ie+=this.printConnection(de);return ie}printMedia(x){return"m=".concat(x.mediaType," ").concat(x.port," ").concat(x.protos.join("/")," ").concat(x.fmts.join(" ")).concat(this.eol)}printSessionAttributes(x){return new Js(this.eol).print(x)}printMediaAttributes(x){return new je(this.eol).print(x)}}class Wr{constructor(x){cr(this,"eol",void 0),this.eol=x}printIceUfrag(x){return x===void 0?"":"a=ice-ufrag:".concat(x).concat(this.eol)}printIcePwd(x){return x===void 0?"":"a=ice-pwd:".concat(x).concat(this.eol)}printIceOptions(x){return x===void 0?"":"a=ice-options:".concat(x.join(_)).concat(this.eol)}printFingerprints(x){return x.length>0?x.map(ie=>"a=fingerprint:".concat(ie.hashFunction).concat(_).concat(ie.fingerprint)).join(this.eol)+this.eol:""}printExtmap(x){return x.map(ie=>"a=extmap:".concat(ie.entry).concat(ie.direction?"/".concat(ie.direction):"").concat(_).concat(ie.extensionName).concat(ie.extensionAttributes?"".concat(_).concat(ie.extensionAttributes):"").concat(this.eol)).join("")}printSetup(x){return x===void 0?"":"a=setup:".concat(x).concat(this.eol)}printUnrecognized(x){return x.map(ie=>"a=".concat(ie.attField).concat(ie.attValue?":".concat(ie.attValue):"").concat(this.eol)).join("")}}class Js extends Wr{print(x){let ie="";return ie+=this.printGroups(x.groups),ie+=this.printMsidSemantic(x.msidSemantic),ie+=this.printIceLite(x.iceLite),ie+=this.printIceUfrag(x.iceUfrag),ie+=this.printIcePwd(x.icePwd),ie+=this.printIceOptions(x.iceOptions),ie+=this.printFingerprints(x.fingerprints),ie+=this.printSetup(x.setup),ie+=this.printTlsId(x.tlsId),ie+=this.printIdentity(x.identities),ie+=this.printExtmap(x.extmaps),ie+=this.printUnrecognized(x.unrecognized),ie}printGroups(x){let ie="";return x.length>0&&(ie+=x.map(de=>"a=group:".concat(de.semantic).concat(de.identificationTag.map(Qe=>"".concat(_).concat(Qe)).join("")).concat(this.eol)).join("")),ie}printIceLite(x){return x===void 0?"":"a=ice-lite"+this.eol}printTlsId(x){return x?"a=tls-id:".concat(x).concat(this.eol):""}printIdentity(x){return x.length===0?"":x.map(ie=>"a=identity:".concat(ie.assertionValue).concat(ie.extensions.map(de=>"".concat(_).concat(de.name).concat(de.value?"=".concat(de.value):"")))).join(this.eol)+this.eol}printMsidSemantic(x){if(!x)return"";let ie="a=msid-semantic:".concat(x.semantic);return x.applyForAll?ie+="".concat(_,"*"):x.identifierList.length>0&&(ie+=x.identifierList.map(de=>"".concat(_).concat(de))),ie+this.eol}}class je extends Wr{print(x){const ie=x.attributes;let de="";return de+=this.printRTCP(ie.rtcp),de+=this.printIceUfrag(ie.iceUfrag),de+=this.printIcePwd(ie.icePwd),de+=this.printIceOptions(ie.iceOptions),de+=this.printCandidates(ie.candidates),de+=this.printRemoteCandidatesList(ie.remoteCandidatesList),de+=this.printEndOfCandidates(ie.endOfCandidates),de+=this.printFingerprints(ie.fingerprints),de+=this.printSetup(ie.setup),de+=this.printMid(ie.mid),de+=this.printExtmap(ie.extmaps),de+=this.printRTPRelated(ie),de+=this.printPtime(ie.ptime),de+=this.printMaxPtime(ie.maxPtime),de+=this.printDirection(ie.direction),de+=this.printSSRCGroups(ie.ssrcGroups),de+=this.printSSRC(ie.ssrcs),de+=this.printRTCPMux(ie.rtcpMux),de+=this.printRTCPMuxOnly(ie.rtcpMuxOnly),de+=this.printRTCPRsize(ie.rtcpRsize),de+=this.printMSId(ie.msids),de+=this.printImageattr(ie.imageattr),de+=this.printRid(ie.rids),de+=this.printSimulcast(ie.simulcast),de+=this.printSCTPPort(ie.sctpPort),de+=this.printMaxMessageSize(ie.maxMessageSize),de+=this.printUnrecognized(ie.unrecognized),de}printCandidates(x){return x.map(ie=>"a=candidate:".concat(ie.foundation).concat(_).concat(ie.componentId).concat(_).concat(ie.transport).concat(_).concat(ie.priority).concat(_).concat(ie.connectionAddress).concat(_).concat(ie.port).concat(_,"typ").concat(_).concat(ie.type).concat(ie.relAddr?"".concat(_,"raddr").concat(_).concat(ie.relAddr):"").concat(ie.relPort?"".concat(_,"rport").concat(_).concat(ie.relPort):"").concat(Object.keys(ie.extension).map(de=>"".concat(_).concat(de).concat(_).concat(ie.extension[de])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(x){return x.map(ie=>"a=remote-candidates:".concat(ie.join(_)).concat(this.eol)).join("")}printEndOfCandidates(x){return x===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(x){if(!x.payloads)return"";const ie=x.payloads;let de="";de+=x.rtcpFeedbackWildcards.map(Qe=>this.printRTCPFeedback("*",Qe)).join("");for(const Qe of ie)de+=this.printRtpMap(Qe.payloadType,Qe.rtpMap),de+=this.printFmtp(Qe.payloadType,Qe.fmtp),de+=Qe.rtcpFeedbacks.map(Ht=>this.printRTCPFeedback(Qe.payloadType,Ht)).join("");return de}printFmtp(x,ie){if(!ie)return"";const de=Object.keys(ie.parameters);return de.length===1&&ie.parameters[de[0]]===null?"a=fmtp:".concat(x).concat(_).concat(de[0]).concat(this.eol):"a=fmtp:".concat(x).concat(_).concat(Object.keys(ie.parameters).map(Qe=>"".concat(Qe,"=").concat(ie.parameters[Qe])).join(";")).concat(this.eol)}printRtpMap(x,ie){return ie?"a=rtpmap:".concat(x).concat(_).concat(ie.encodingName,"/").concat(ie.clockRate).concat(ie.encodingParameters?"/".concat(ie.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(x,ie){let de="a=rtcp-fb:".concat(x).concat(_),Qe=ie;return Qe.type==="trr-int"?de+="ttr-int".concat(_).concat(Qe.interval):(de+="".concat(Qe.type),Qe.parameter&&(de+="".concat(_).concat(Qe.parameter),Qe.additional&&(de+="".concat(_).concat(Qe.additional)))),de+this.eol}printPtime(x){return x===void 0?"":"a=ptime:".concat(x).concat(this.eol)}printMaxPtime(x){return x===void 0?"":"a=maxptime:".concat(x).concat(this.eol)}printDirection(x){return x===void 0?"":"a=".concat(x).concat(this.eol)}printSSRC(x){return x.map(ie=>Object.keys(ie.attributes).map(de=>"a=ssrc:".concat(ie.ssrcId.toString(10)).concat(_).concat(de).concat(ie.attributes[de]?":".concat(ie.attributes[de]):"").concat(this.eol)).join("")).join("")}printRTCPMux(x){return x===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(x){return x===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(x){return x===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(x){if(x===void 0)return"";let ie="a=rtcp:".concat(x.port);return x.netType&&(ie+="".concat(_).concat(x.netType)),x.addressType&&(ie+="".concat(_).concat(x.addressType)),x.address&&(ie+="".concat(_).concat(x.address)),ie+this.eol}printMSId(x){return x.map(ie=>"a=msid:".concat(ie.id).concat(ie.appdata?"".concat(_).concat(ie.appdata):"").concat(this.eol)).join("")}printImageattr(x){return x.map(ie=>"a=imageattr:".concat(ie).concat(this.eol)).join("")}printRid(x){return x.map(ie=>{let de="a=rid:".concat(ie.id).concat(_).concat(ie.direction);return ie.payloads&&(de+="".concat(_,"pt=").concat(ie.payloads.join(","))),ie.params.length>0&&(de+="".concat(_).concat(ie.params.map(Qe=>Qe.type==="depend"?"depend=".concat(Qe.rids.join(",")):"".concat(Qe.type,"=").concat(Qe.val)).join(";"))),de+this.eol}).join("")}printSimulcast(x){return x===void 0?"":"a=simulcast:".concat(x).concat(this.eol)}printSCTPPort(x){return x===void 0?"":"a=sctp-port:".concat(x).concat(this.eol)}printMaxMessageSize(x){return x===void 0?"":"a=max-message-size:".concat(x).concat(this.eol)}printMid(x){return x===void 0?"":"a=mid:".concat(x).concat(this.eol)}printSSRCGroups(x){return x.map(ie=>"a=ssrc-group:".concat(ie.semantic).concat(ie.ssrcIds.map(de=>"".concat(_).concat(de.toString(10))).join("")).concat(this.eol)).join("")}}function ot(We){return new ut().parse(We)}function bt(We,x){return new Zr().print(We,x)}}},r={};function o(s){if(r[s])return r[s].exports;var c=r[s]={exports:{}};return e[s](c,c.exports,o),c.exports}return o.d=(s,c)=>{for(var u in c)o.o(c,u)&&!o.o(s,u)&&Object.defineProperty(s,u,{enumerable:!0,get:c[u]})},o.o=(s,c)=>Object.prototype.hasOwnProperty.call(s,c),o.r=s=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(s,"__esModule",{value:!0})},o(8)})();function Sa(e){return _8.parse(e)}function Im(e,r){return _8.print(e,r)}var Ffe=Ka("Array").keys,jfe=Ec,Bfe=pi,Wfe=N,zfe=Ffe,sx=Array.prototype,Gfe={DOMTokenList:!0,NodeList:!0},Hfe=function(e){var r=e.keys;return e===sx||Wfe(sx,e)&&r===sx.keys||Bfe(Gfe,jfe(e))?zfe:r},Dc=l(Hfe);function E8(e,r){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),o.push.apply(o,s)}return o}function rn(e){for(var r=1;r<arguments.length;r++){var o=arguments[r]!=null?arguments[r]:{};r%2?E8(Object(o),!0).forEach(function(s){Ur(e,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):E8(Object(o)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(o,s))})}return e}function Ur(e,r,o){return(r=function(s){var c=function(u,h){if(typeof u!="object"||u===null)return u;var m=u[Symbol.toPrimitive];if(m!==void 0){var _=m.call(u,"string");if(typeof _!="object")return _;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(u)}(s);return typeof c=="symbol"?c:String(c)}(r))in e?Object.defineProperty(e,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[r]=o,e}const y8=new class extends Pr{constructor(){super(...arguments),Ur(this,"currentUploadLogID",0)}reportLogUploadError(e){const{errorRange:r}=e;r[r.length-1]&&r[r.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=r[r.length-1],this.emit("REPORT_LOG_UPLOAD",e))}};class $fe{constructor(r){Ur(this,"logger",void 0),Ur(this,"prefixLists",[]),this.logger=r}debug(){for(var r=arguments.length,o=new Array(r),s=0;s<r;s++)o[s]=arguments[s];this.logger.debug(...this.prefixLists,...o)}info(){for(var r=arguments.length,o=new Array(r),s=0;s<r;s++)o[s]=arguments[s];this.logger.info(...this.prefixLists,...o)}warning(){for(var r=arguments.length,o=new Array(r),s=0;s<r;s++)o[s]=arguments[s];this.logger.warning(...this.prefixLists,...o)}error(){for(var r=arguments.length,o=new Array(r),s=0;s<r;s++)o[s]=arguments[s];this.logger.error(...this.prefixLists,...o)}prefix(r){return this.prefixLists.push(r),this}popPrefix(){return this.prefixLists.pop(),this}}function ax(){const e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function v8(){const e=new Date,r=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return r?(r==null?void 0:r[0])+":"+e.getUTCMilliseconds():e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}const _l={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},jA=Date.now(),_T=e=>{for(const r in _l)if(Object.prototype.hasOwnProperty.call(_l,r)&&_l[r]===e)return r;return"DEFAULT"},D=new class{constructor(){Ur(this,"proxyServerURL",void 0),Ur(this,"logLevel",_l.DEBUG),Ur(this,"uploadState","collecting"),Ur(this,"uploadLogWaitingList",[]),Ur(this,"uploadLogUploadingList",[]),Ur(this,"uploadErrorCount",0),Ur(this,"currentLogID",0),Ur(this,"url",void 0),Ur(this,"extLog",(e,r)=>{this.appendLogToWaitingList(e,...r)})}debug(){for(var e=arguments.length,r=new Array(e),o=0;o<e;o++)r[o]=arguments[o];const s=[_l.DEBUG].concat(r);this.log.apply(this,s)}info(){for(var e=arguments.length,r=new Array(e),o=0;o<e;o++)r[o]=arguments[o];const s=[_l.INFO].concat(r);this.log.apply(this,s)}warning(){for(var e=arguments.length,r=new Array(e),o=0;o<e;o++)r[o]=arguments[o];const s=[_l.WARNING].concat(r);this.log.apply(this,s)}warn(){this.warning(...arguments)}error(){for(var e=arguments.length,r=new Array(e),o=0;o<e;o++)r[o]=arguments[o];const s=[_l.ERROR].concat(r);this.log.apply(this,s)}upload(){for(var e=arguments.length,r=new Array(e),o=0;o<e;o++)r[o]=arguments[o];const s=[_l.DEBUG].concat(r);this.uploadLog.apply(this,s)}setLogLevel(e){e=Math.min(Math.max(0,e),4),this.logLevel=e}enableLogUpload(){Xn("UPLOAD_LOG",!0)}disableLogUpload(){Xn("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e){this.proxyServerURL=e}prefix(e){return new $fe(this).prefix(e)}log(){for(var e=arguments.length,r=new Array(e),o=0;o<e;o++)r[o]=arguments[o];if(Date.now()-jA<100)return void setTimeout(()=>{this.log(...r)},Date.now()-jA);const s=Math.max(0,Math.min(4,r[0]));if(r[0]=ax()+" Agora-SDK [".concat(_T(s),"]:"),this.appendLogToWaitingList(s,...r),s<this.logLevel)return;const c=ax()+" %cAgora-SDK [".concat(_T(s),"]:");let u=[];if(!re("USE_NEW_LOG"))switch(s){case _l.DEBUG:u=[c,"color: #64B5F6;"].concat(r.slice(1)),console.log.apply(console,u);break;case _l.INFO:u=[c,"color: #1E88E5; font-weight: bold;"].concat(r.slice(1)),console.log.apply(console,u);break;case _l.WARNING:u=[c,"color: #FB8C00; font-weight: bold;"].concat(r.slice(1)),console.warn.apply(console,u);break;case _l.ERROR:u=[c,"color: #B00020; font-weight: bold;"].concat(r.slice(1)),console.error.apply(console,u)}}uploadLog(){for(var e=arguments.length,r=new Array(e),o=0;o<e;o++)r[o]=arguments[o];if(Date.now()-jA<100)return void setTimeout(()=>{this.uploadLog(...r)},Date.now()-jA);const s=Math.max(0,Math.min(4,r[0]));r[0]=ax()+" Agora-SDK [".concat(_T(s),"]:"),this.appendLogToWaitingList(s,...r)}appendLogToWaitingList(e){if(!re("UPLOAD_LOG"))return;for(var r=arguments.length,o=new Array(r>1?r-1:0),s=1;s<r;s++)o[s-1]=arguments[s];Array.isArray(o[0])?o[0][0]=v8()+" Agora-SDK [".concat(_T(e),"]:"):o[0]=v8()+" Agora-SDK [".concat(_T(e),"]:");let c="";o.forEach(u=>{typeof u=="object"&&(u=JSON.stringify(u)),c+="".concat(u," ")}),this.uploadLogWaitingList.push({payload_str:c,log_level:e,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const e=this.uploadLogUploadingList,r={sdk_version:gl,process_id:re("PROCESS_ID"),payload:JSON.stringify(e)};return hd(async()=>{const o=await Hs.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(re("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(re("LOG_UPLOAD_SERVER"),"/upload/v1")),r,{responseType:"text"});if(o.data!=="OK"){const s=new Error("unexpected upload log response");throw s.response=o,s}},()=>(this.uploadLogUploadingList=[],!1),o=>{const s={status:-1,message:o.message,errorRange:e.map(c=>c.log_item_id)};return o.response?(s.status=o.response.status,s.data=o.response.data,s.headers=o.response.headers):o.request&&(s.status=o.request.status),y8.reportLogUploadError(s),!0},{timeout:re("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:re("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,re("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),re("UPLOAD_LOG_INTERVAL"))}).catch(e=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),re("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),re("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var S8;function Kfe(e){return ro(e.reportId,"params.reportId",0,100,!1),ro(e.category,"params.category",0,100,!1),ro(e.event,"params.event",0,100,!1),ro(e.label,"params.label",0,100,!1),er(e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(S8={}).FREE="free",S8.UPLOADING="uploading",function(e){e[e.MISC=0]="MISC",e[e.INTERNAL_EVENT=1]="INTERNAL_EVENT",e[e.PUBLIC_EVENT=2]="PUBLIC_EVENT",e[e.WEB_EVENT=3]="WEB_EVENT",e[e.INTERNAL_API=4]="INTERNAL_API",e[e.WEB_API=5]="WEB_API",e[e.PUBLIC_API=6]="PUBLIC_API"}({});const qfe={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let ji=function(e){return e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.WS_COMPRESSOR_INIT="ws_compressor_init",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.REJOIN_GATEWAY="rejoin_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics",e.PC_STATS="pc_stats",e.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",e.AB_TEST="ab_test",e}({}),wr=function(e){return e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",e.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",e.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",e.PC_STATS="io.agora.pb.Wrtc.PCStats",e.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",e.AB_TEST="io.agora.pb.Wrtc.ABTest",e}({});(function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let Yfe=function(e){return e[e.SESSION=26]="SESSION",e[e.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",e[e.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",e[e.JOIN_GATEWAY=28]="JOIN_GATEWAY",e[e.PUBLISH=30]="PUBLISH",e[e.SUBSCRIBE=29]="SUBSCRIBE",e[e.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",e[e.STREAM_SWITCH=32]="STREAM_SWITCH",e[e.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",e[e.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",e[e.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",e[e.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",e[e.API_INVOKE=41]="API_INVOKE",e[e.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",e[e.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",e[e.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",e[e.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",e[e.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",e[e.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",e[e.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",e[e.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",e[e.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",e[e.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",e[e.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",e[e.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",e[e.USER_ANALYTICS=1e4]="USER_ANALYTICS",e[e.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",e}({});function Mt(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(r,o,s){const c=s.value;if(typeof c=="function"){const u=e.className||r.__className__||(r.constructor.name==="AgoraRTCClient"?"Client":r.constructor.name);s.value=function(){for(var h,m=arguments.length,_=new Array(m),y=0;y<m;y++)_[y]=arguments[y];let S=_;if(e.argsMap)try{S=e.argsMap(this,..._)}catch(P){D.warning(P),S=[]}try{JSON.stringify(S)}catch{D.warning("arguments for method ".concat(u,".").concat(String(o)," not serializable for apiInvoke.")),S=[]}const R=(e.report||wt).reportApiInvoke(this._sessionId||null,{id:this._clientId||((h=this.store)===null||h===void 0?void 0:h.clientId)||this._ID,name:"".concat(u,".").concat(String(o)),options:S,tag:xr.TRACER,reportResult:e.reportResult},e.throttleTime);try{const P=c.apply(this,_);return P instanceof lt?P.then(k=>(R.onSuccess(e.reportResult&&k),k)).catch(k=>{throw R.onError(k),k}):(R.onSuccess(e.reportResult&&P),P)}catch(P){throw R.onError(P),P}}}return s}}const wt=new class{constructor(){Ur(this,"baseInfoMap",new Map),Ur(this,"proxyServer",void 0),Ur(this,"eventUploadTimer",void 0),Ur(this,"setSessionIdTimer",void 0),Ur(this,"url",void 0),Ur(this,"sids",new Set),Ur(this,"backupUrl",void 0),Ur(this,"_appId",void 0),Ur(this,"_aid",0),Ur(this,"keyEventUploadPendingItems",[]),Ur(this,"normalEventUploadPendingItems",[]),Ur(this,"apiInvokeUploadPendingItems",[]),Ur(this,"apiInvokeCount",0),Ur(this,"apiInvokeLoggedCount",0),Ur(this,"ltsList",[]),Ur(this,"lastSendNormalEventTime",Date.now()),Ur(this,"customReportCounterTimer",void 0),Ur(this,"customReportCount",0),Ur(this,"extApiInvoke",async e=>{for(const r of e){const o=rn(rn({},r),{},{sid:null,invokeId:++this.apiInvokeCount,tag:xr.TRACER});this.sendApiInvoke(o)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),re("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),re("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(e){return this.baseInfoMap.get(e)}setAppId(e){this._appId=e,this._aid=parseInt(e.replace(/[a-fA-F0-9]{8}/g,r=>{let[o,s]=r;return o+s}),16)||0}reportApiInvoke(e,r,o){r.timeout=r.timeout||6e4,r.reportResult=r.reportResult===void 0||r.reportResult;const s=Date.now();this.apiInvokeCount+=1;const c=this.apiInvokeCount,u=!!re("SHOW_REPORT_INVOKER_LOG"),h=!!re("SHOW_REPORT_USER_INVOKER_LOG"),m=u||h&&r.id;m&&(this.apiInvokeLoggedCount+=1);const _=this.apiInvokeLoggedCount;function y(k,z){if(m){let U="[apiInvoke-".concat(_,"]");r.id&&(U+="[".concat(r.id,"]")),r.name&&(U+="[".concat(r.name,"]")),D.info("".concat(U," ").concat(k),k==="start"?r.options:z||"")}}const S=()=>({tag:r.tag,invokeId:c,sid:e,name:r.name,apiInvokeTime:s,options:r.options,states:r.states||null});y("start");let R=!1;io(r.timeout).then(()=>{R||(this.sendApiInvoke(rn(rn({},S()),{},{error:X.API_INVOKE_TIMEOUT,success:!1})),y("timeout"))});const P=new Le(X.UNEXPECTED_ERROR,"".concat(r.name,": this api invoke is end"));return{onSuccess:k=>{const z=()=>{if(R)throw P;return R=!0,this.sendApiInvoke(rn(rn({},S()),{},{success:!0},r.reportResult&&{result:k})),y("onSuccess"),k};return o?e8(z,r.name+"Success",o,()=>R=!0):z()},onError:k=>{const z=()=>{if(R)throw k;R=!0,this.sendApiInvoke(rn(rn({},S()),{},{success:!1,error:k})),y("onFailure",k.toString())};return o?e8(z,r.name+"Error",o,()=>R=!0):z()}}}sessionInit(e,r){if(this.baseInfoMap.has(e))return;const o=Date.now(),s=this.createBaseInfo(e,o);s.cname=r.cname;const c=Object.assign({},{willUploadConsoleLog:re("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:nx?"global":"oversea",areas:re("AREAS")&&re("AREAS").join(",")},r.extend),{stringUid:u,channelProfile:h,channelMode:m,isABTestSuccess:_,lsid:y,clientRole:S}=r,R=Date.now(),P=rn(rn({},s),{},{eventType:ji.SESSION_INIT,appid:r.appid,browser:navigator.userAgent,buildFormat:r.buildFormat,build:ix,lts:R,elapse:R-o,extend:JSON.stringify(c),mode:r.mode,process:re("PROCESS_ID"),appType:re("APP_TYPE"),success:!0,version:gl,stringUid:u,channelProfile:h,channelMode:m,isABTestSuccess:_,lsid:y,clientType:st(k=window.navigator.userAgent).call(k,"AgoraWebView")?42:20,clientRole:S,serviceId:re("PROCESS_ID"),extensionID:re("PLUGIN_INFO").join(",")||""});var k;this.send({type:wr.SESSION,data:P},!0)}joinChooseServer(e,r){const o=this.baseInfoMap.get(e);if(!o)return;const s=o.info,c=Date.now(),u=rn(rn({},s),{},{role:r.role,eventType:ji.JOIN_CHOOSE_SERVER,lts:c,eventElapse:r.elapse||c-r.lts,chooseServerAddr:r.csAddr,errorCode:r.ec,elapse:c-o.startTime,success:r.succ,chooseServerAddrList:JSON.stringify(r.serverList),uid:r.uid?parseInt(r.uid):null,cid:r.cid?parseInt(r.cid):null,chooseServerIp:r.csIp||"",opid:r.opid,unilbsServerIds:r.unilbsServerIds,extend:r.extend||void 0,isHttp3:r.isHttp3,corssRegionTagReq:r.corssRegionTagReq||void 0,corssRegionTagRes:r.corssRegionTagRes||void 0});this.send({type:wr.JOIN_CHOOSE_SERVER,data:u},!0)}reqUserAccount(e,r){const o=this.baseInfoMap.get(e);if(!o)return;const s=o.info,c=Date.now(),u=rn(rn({},s),{},{eventType:ji.REQ_USER_ACCOUNT,lts:c,success:r.success,serverAddress:r.serverAddr,stringUid:r.stringUid,uid:r.uid,errorCode:r.errorCode,elapse:r.elapse||c-o.startTime,eventElapse:c-r.lts,extend:JSON.stringify(r.extend)});this.send({type:wr.REQ_USER_ACCOUNT,data:u},!0)}joinGateway(e,r){const o=this.baseInfoMap.get(e);if(!o)return;const s=o.info;r.vid&&(s.vid=r.vid),s.uid=r.uid,s.cid=r.cid;const c=Date.now(),{firstSuccess:u,avoidJoinStartTime:h,addr:m,isProxy:_}=r,y=c-(u&&h?h:o.startTime),S=rn(rn({},s),{},{eventType:ji.JOIN_GATEWAY,lts:c,gatewayAddr:r.addr,success:r.succ,errorCode:r.ec,errorMsg:r.errorMsg||"",elapse:y,eventElapse:c-r.lts,firstSuccess:u,signalChannel:r.signalChannel,preload:r.preload?1:0,installId:tx(),isABTestSuccess:r.isABTestSuccess?1:0}),R=S.success?1:0;if(r.succ&&(o.lastJoinSuccessTime=c),u)this.send({type:wr.JOIN_GATEWAY,data:S},!0);else{let P;if(m)if(_){const z=m.match(/h=(\d{1,3}-){3}\d{1,3}/g),U=m.match(/p=[0-9]{1,6}/g);P={isSuccess:R,gatewayIp:z&&z.length?z[0].split("=")[1].replace(/-/g,"."):"",port:U&&U.length?U[0].split("=")[1]:"",isProxy:_?1:0}}else{const z=m.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),U=m.match(/(:|p=)[0-9]{1,6}/g);P={isSuccess:R,gatewayIp:z&&z.length?z[0].split("//")[1].replace(/-/g,"."):"",port:U&&U.length?U[0].split(/:|p=/g)[1]:"",isProxy:_?1:0}}else P={isSuccess:R,gatewayIp:"",port:"",isProxy:_?1:0};delete S.success,delete S.eventType,delete S.firstSuccess,S.vid=Number(S.vid);const k=Object.assign({},S,P,{eventType:ji.REJOIN_GATEWAY});this.send({type:wr.RE_JOIN_GATEWAY,data:k},!0)}}joinChannelTimeout(e,r){const o=this.baseInfoMap.get(e);if(!o)return;const s=Date.now(),c=rn(rn({},o.info),{},{lts:s,timeout:r,elapse:s-o.startTime});this.send({type:wr.JOIN_CHANNEL_TIMEOUT,data:c},!0)}publish(e,r){const o=this.baseInfoMap.get(e);if(!o)return;const s=o.info,c=Date.now(),u=rn(rn({},s),{},{eventType:ji.PUBLISH,lts:c,eventElapse:r.eventElapse,elapse:c-o.startTime,success:r.succ,errorCode:r.ec,videoName:r.videoName,audioName:r.audioName,screenName:r.screenName,screenshare:r.screenshare,audio:r.audio,video:r.video,p2pid:r.p2pid,publishRequestid:r.publishRequestid});this.send({type:wr.PUBLISH,data:u},!0)}subscribe(e,r,o){const s=this.baseInfoMap.get(e);if(!s)return;const c=s.info,u=Date.now(),h=rn(rn({},c),{},{eventType:ji.SUBSCRIBE,lts:u,eventElapse:r.eventElapse,elapse:u-s.startTime,success:r.succ,errorCode:r.ec,video:r.video,audio:r.audio,subscribeRequestid:r.subscribeRequestid,p2pid:r.p2pid,preSsrc:r.preSsrc?1:0},o&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof r.peerid=="string"?h.peerSuid=r.peerid:h.peer=r.peerid,this.send({type:wr.SUBSCRIBE,data:h},!0)}wsCompressorInit(e){var r;const o=[...Dc(r=this.baseInfoMap).call(r)],s=o.length?o[0]:"UnableToGetSid",c=this.baseInfoMap.get(s);if(!c)return;const u=c.info,h=Date.now(),m=rn(rn({},u),{},{eventType:ji.WS_COMPRESSOR_INIT,lts:h,eventElapse:e.eventElapse,elapse:h-c.startTime,status:e.status?1:2});this.send({type:wr.WS_COMPRESSOR_INIT,data:m},!0)}firstRemoteVideoDecode(e,r,o,s){const c=this.baseInfoMap.get(e);if(!c)return;const u=c.info,h=Date.now(),m=rn(rn(rn({},u),s),{},{elapse:h-c.startTime,eventType:r,lts:h,firstDecodeFrame:Math.max((s.firstFrame||h)-c.startTime,0),apEnd:Math.max(s.apEnd-c.startTime,0),apStart:Math.max(s.apStart-c.startTime,0),joinGwEnd:Math.max(s.joinGwEnd-c.startTime,0),joinGwStart:Math.max(s.joinGwStart-c.startTime,0),pcEnd:Math.max(s.pcEnd-c.startTime,0),pcStart:Math.max(s.pcStart-c.startTime,0),subscriberEnd:Math.max(s.subscriberEnd-c.startTime,0),subscriberStart:Math.max(s.subscriberStart-c.startTime,0),videoAddNotify:Math.max(s.videoAddNotify-c.startTime,0)});this.send({type:o,data:m},!0)}firstRemoteFrame(e,r,o,s){const c=this.baseInfoMap.get(e);if(!c)return;const u=c.info,h=Date.now(),m=rn(rn(rn({},u),s),{},{elapse:h-c.startTime,eventType:r,lts:h});this.send({type:o,data:m},!0)}abTest(e,r){const o=this.baseInfoMap.get(e);if(!o)return;const s=o.info,c=Date.now(),u=rn(rn(rn({},s),r),{},{vid:s.vid===void 0?0:Number(s.vid),elapse:c-o.startTime,eventType:ji.AB_TEST,lts:c});this.send({type:wr.AB_TEST,data:u},!0)}pcStats(e,r){const o=this.baseInfoMap.get(e);if(!o)return;const s=o.info,c=Date.now(),u=rn(rn(rn({},s),r),{},{vid:s.vid===void 0?0:Number(s.vid),elapse:c-o.startTime,eventType:ji.PC_STATS,lts:c,preallocation:r.preallocation?1:0});this.send({type:wr.PC_STATS,data:u},!0)}updateRemoteRTPCapabilities(e,r){if(e){const o=this.baseInfoMap.get(e);if(!o)return;const s=o.info,c=Date.now(),u=rn(rn(rn({},s),r),{},{vid:s.vid===void 0?0:Number(s.vid),eventType:ji.UPDATE_REMOTE_RTPCAPABILITIES,lts:c});this.send({type:wr.UPDATE_REMOTE_RTPCAPABILITIES,data:u},!0)}}onGatewayStream(e,r,o,s){const c=this.baseInfoMap.get(e);if(!c)return;const u=c.info,h=Date.now(),m=rn(rn(rn({},u),s),{},{eventType:r,lts:h});this.send({type:o,data:m},!0)}streamSwitch(e,r){const o=this.baseInfoMap.get(e);if(!o)return;const s=o.info,c=Date.now(),u=rn(rn({},s),{},{eventType:ji.STREAM_SWITCH,lts:c,isDual:r.isdual,elapse:c-o.startTime,success:r.succ});this.send({type:wr.STREAM_SWITCH,data:u},!0)}requestProxyAppCenter(e,r){const o=this.baseInfoMap.get(e);if(!o)return;const s=o.info,c=Date.now(),u=rn(rn({},s),{},{eventType:ji.REQUEST_PROXY_APPCENTER,lts:c,eventElapse:c-r.lts,elapse:c-o.startTime,APAddr:r.APAddr,workerManagerList:r.workerManagerList,response:r.response,errorCode:r.ec,success:r.succ});this.send({type:wr.REQUEST_PROXY_APPCENTER,data:u},!0)}requestProxyWorkerManager(e,r){const o=this.baseInfoMap.get(e);if(!o)return;const s=o.info,c=Date.now(),u=rn(rn({},s),{},{eventType:ji.REQUEST_PROXY_WORKER_MANAGER,lts:c,eventElapse:c-r.lts,elapse:c-o.startTime,workerManagerAddr:r.workerManagerAddr,response:r.response,errorCode:r.ec,success:r.succ});this.send({type:wr.REQUEST_PROXY_WORKER_MANAGER,data:u},!0)}setProxyServer(e){this.proxyServer=e,e?D.debug("reportProxyServerurl: ".concat(e)):D.debug("disable reportProxyServerurl: ".concat(e))}peerPublishStatus(e,r){const o=this.baseInfoMap.get(e);if(!o)return;const s=o.info,c=Date.now(),u=rn(rn({},s),{},{subscribeElapse:r.subscribeElapse,peer:r.peer,peerPublishDuration:Math.max(r.audioPublishDuration,r.videoPublishDuration),audiotag:r.audioPublishDuration>0?1:-1,videotag:r.videoPublishDuration>0?1:-1,lts:c,elapse:c-o.startTime,joinChannelSuccessElapse:c-(o.lastJoinSuccessTime||c),peerPublishDurationVideo:r.videoPublishDuration,peerPublishDurationAudio:r.audioPublishDuration});this.send({type:wr.PEER_PUBLISH_STATUS,data:u},!0)}workerEvent(e,r){const o=this.baseInfoMap.get(e);if(!o)return;const s=o.info,c=Date.now();(function(u,h,m){const _=u[h];if(!_||typeof _!="string")return[u];u[h]="";const y=fh(JSON.stringify(u));let S=0;const R=[];let P=0;for(let k=0;k<_.length;k++)P+=_.charCodeAt(k)<=127?1:3,P<=m-y||(R[R.length]=mt(mt({},u),{},{[h]:_.substring(S,k)}),S=k,P=_.charCodeAt(k)<=127?1:3);return S!==_.length-1&&(R[R.length]=mt(mt({},u),{},{[h]:_.substring(S)})),R})(rn(rn(rn({},s),r),{},{elapse:c-o.startTime,lts:c,productType:"WebRTC"}),"payload",1300).forEach(u=>this.send({type:wr.WORKER_EVENT,data:u},!0))}apworkerEvent(e,r){const o=this.baseInfoMap.get(e);if(!o)return;const s=o.info,c=Date.now(),u=rn(rn(rn({},s),r),{},{elapse:c-o.startTime,lts:c});this.send({type:wr.AP_WORKER_EVENT,data:u},!0)}joinWebProxyAP(e,r){const o=this.baseInfoMap.get(e);if(!o)return;const s=o.info,c=Date.now(),u=rn(rn(rn({},s),r),{},{elapse:c-o.startTime,lts:c,extend:r.extend||void 0});this.send({type:wr.JOIN_WEB_PROXY_AP,data:u},!0)}WebSocketQuit(e,r){const o=this.baseInfoMap.get(e);if(!o)return;const s=o.info,c=Date.now(),u=rn(rn(rn({},s),r),{},{elapse:c-o.startTime,lts:c});this.send({type:wr.WEBSOCKET_QUIT,data:u},!0)}async sendCustomReportMessage(e,r){if(this.customReportCount+=r.length,this.customReportCount>re("CUSTOM_REPORT_LIMIT"))throw new Le(X.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const o=Date.now(),s=r.map(c=>({type:wr.USER_ANALYTICS,data:rn(rn({sid:e},c),{},{lts:o})}));try{re("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(s):await this.postDataToStatsCollector(s)}catch(c){throw D.error("send custom report message failed",c.toString()),new Le(X.CUSTOM_REPORT_SEND_FAILED,c.message)}}sendApiInvoke(e){const r=re("NOT_REPORT_EVENT");if(e.tag&&st(r)&&st(r).call(r,e.tag))return!1;if(e.sid===null)return this.apiInvokeUploadPendingItems.push(e),!1;const o=this.baseInfoMap.get(e.sid);if(!o)return this.apiInvokeUploadPendingItems.push(e),!1;const{cname:s,uid:c,cid:u}=o.info;let h;if(e.lts=e.lts||Date.now(),e.error)if(e.error instanceof Le){const{code:_,message:y}=e.error;h=_||y||e.error.toString()}else h=e.error.toString();const m={invokeId:e.invokeId,sid:e.sid,cname:s,cid:u,uid:c,lts:e.lts,success:e.success,elapse:e.lts-o.startTime,execElapse:e.lts-e.apiInvokeTime,apiName:e.name,options:e.options?JSON.stringify(e.options):void 0,execStates:e.states?JSON.stringify(e.states):void 0,execResult:e.result?JSON.stringify(e.result):void 0,errorCode:e.error?h:void 0,errorMsg:e.error?JSON.stringify(e.error):void 0};return this.send({type:wr.API_INVOKE,data:m},!1),!0}addSid(e){this.sids.add(e)}removeSid(e){this.sids.delete(e)}appendSessionId(){const e=this.apiInvokeUploadPendingItems;if(e.length===0)return;const r=Array.from(this.sids).find(o=>o!==null);r&&e.forEach(o=>{o&&(o.sid=r,this.sendApiInvoke(Object.assign({},o)))}),e.length=0}send(e,r){if(r)return this.keyEventUploadPendingItems.push(e),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(e),this.normalEventUploadPendingItems.length>re("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(e,r){const o=[],s=[];for(;e.length;){const u=e.shift();o.length<20?o.push(u):s.push(u)}e.push(...s);for(const u of[...o]){var c;this.ltsList.indexOf(u.data.lts)!==-1?(u.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(u.data.lts)):(this.ltsList.push(u.data.lts),Xb(c=this.ltsList).call(c,(h,m)=>h-m))}return r||(this.lastSendNormalEventTime=Date.now()),re("ENABLE_EVENT_REPORT")&&o.length&&(re("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(o):this.postDataToStatsCollector(o)).catch((u=>h=>{re("EVENT_REPORT_RETRY")&&(r?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(u):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(u),this.normalEventUploadPendingItems.length>re("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-re("NORMAL_EVENT_QUEUE_CAPACITY")),D.warning("report: drop normal events"))))})(o)),e}async postDataToStatsCollector2(e){ai.networkState===tc.OFFLINE&&await lt.race([ai.onlineWaiter,io(2*Ei.maxRetryTimeout)]);const r=c=>{let u=new Uint8Array;return c.forEach(h=>{const m=zL(JSON.stringify(h.data)),_=new ArrayBuffer(5),y=(R=>{let P=0;return Object.entries(wr).forEach(k=>{let[z,U]=k;U===R.type&&(P=Yfe[z])}),P})(h),S=new DataView(_);S.setUint16(0,m.byteLength,!0),S.setUint8(2,255&y),S.setUint8(3,y>>>8&255),S.setUint8(4,y>>>16&255),u=HW(u,new Uint8Array(_)),u=HW(u,m)}),u},o="event";let s=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(re("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(o):"https://".concat(re("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(o);for(let c=0;c<2;c+=1){c===1&&(s=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(re("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(o):"https://".concat(re("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(o));try{await XL(s,{timeout:1e4,data:r(e),headers:rn(rn({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(u){if(c===1)throw u;continue}return}}async postDataToStatsCollector(e){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const o=(m=>{const _=m&&m.data.sid&&this.baseInfoMap.get(m.data.sid);return _&&_.info.vid&&+_.info.vid||0})(e[0]),s=o?void 0:this._aid,c={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:e.map(m=>JSON.stringify(m)),vid:o,aid:s};ai.networkState===tc.OFFLINE&&await lt.race([ai.onlineWaiter,io(2*Ei.maxRetryTimeout)]);const u=r?"/events/proto-raws":"/events/messages";let h=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(re("EVENT_REPORT_DOMAIN"),"&p=").concat(re("STATS_COLLECTOR_PORT"),"&d=").concat(u):"https://".concat(re("EVENT_REPORT_DOMAIN"),":").concat(re("STATS_COLLECTOR_PORT")).concat(u));for(let m=0;m<2;m+=1){m===1&&(h=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(re("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(re("STATS_COLLECTOR_PORT"),"&d=").concat(u):"https://".concat(re("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(re("STATS_COLLECTOR_PORT")).concat(u)));try{r?await Lfe(h,{timeout:1e4,data:c}):await XL(h,{timeout:1e4,data:c})}catch(_){if(m===1)throw _;continue}return}}createBaseInfo(e,r){const o=Object.assign({},qfe);return o.sid=e,this.baseInfoMap.set(e,{info:o,startTime:r}),o}reportResourceTiming(e,r){const o=performance.getEntriesByName(e),s=o[o.length-1];s&&this.reportApiInvoke(r,{name:"Client.resourceTiming",options:s,tag:xr.TRACER}).onSuccess()}};y8.on("REPORT_LOG_UPLOAD",e=>{e.networkState=ai.networkState,wt.reportApiInvoke(null,{name:"logUploadError",options:e,tag:xr.TRACER}).onSuccess("logUploadError")});class Oe extends Le{constructor(r){super(r,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),Ur(this,"name","AgoraRTCException")}print(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(r,D)}throw(){super.throw(D)}}const oo={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function kn(){return oo}function b8(){return"setSinkId"in HTMLAudioElement.prototype&&(!re("RESTRICTION_SET_PLAYBACK_DEVICE")||(Wf()||DW())&&!jL())}function T8(){return!oo.supportUnifiedPlan||re("CHROME_FORCE_PLAN_B")&&zf()}let so=function(e){return e.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",e.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",e.IOS_INTERRUPTION_START="ios-interruption-start",e.IOS_INTERRUPTION_END="ios-interruption-end",e.STATE_CHANGE="state-change",e}({});function Ov(e,r,o){return{sampleRate:e,stereo:r,bitrate:o}}function Cn(e,r,o,s,c){return{width:e,height:r,frameRate:o,bitrateMin:s,bitrateMax:c}}function lu(e,r,o,s,c){return{width:{max:e},height:{max:r},frameRate:o,bitrateMin:s,bitrateMax:c}}function cx(e,r){return{numSpatialLayers:e,numTemporalLayers:r}}const Xfe={"90p":Cn(160,90),"90p_1":Cn(160,90),"120p":Cn(160,120,15,30,65),"120p_1":Cn(160,120,15,30,65),"120p_3":Cn(120,120,15,30,50),"120p_4":Cn(212,120),"180p":Cn(320,180,15,30,140),"180p_1":Cn(320,180,15,30,140),"180p_3":Cn(180,180,15,30,100),"180p_4":Cn(240,180,15,30,120),"240p":Cn(320,240,15,40,200),"240p_1":Cn(320,240,15,40,200),"240p_3":Cn(240,240,15,40,140),"240p_4":Cn(424,240,15,40,220),"360p":Cn(640,360,15,80,400),"360p_1":Cn(640,360,15,80,400),"360p_3":Cn(360,360,15,80,260),"360p_4":Cn(640,360,30,80,600),"360p_6":Cn(360,360,30,80,400),"360p_7":Cn(480,360,15,80,320),"360p_8":Cn(480,360,30,80,490),"360p_9":Cn(640,360,15,80,800),"360p_10":Cn(640,360,24,80,800),"360p_11":Cn(640,360,24,80,1e3),"480p":Cn(640,480,15,100,500),"480p_1":Cn(640,480,15,100,500),"480p_2":Cn(640,480,30,100,1e3),"480p_3":Cn(480,480,15,100,400),"480p_4":Cn(640,480,30,100,750),"480p_6":Cn(480,480,30,100,600),"480p_8":Cn(848,480,15,100,610),"480p_9":Cn(848,480,30,100,930),"480p_10":Cn(640,480,10,100,400),"720p":Cn(1280,720,15,120,1130),"720p_auto":Cn(1280,720,30,900,3e3),"720p_1":Cn(1280,720,15,120,1130),"720p_2":Cn(1280,720,30,120,2e3),"720p_3":Cn(1280,720,30,120,1710),"720p_5":Cn(960,720,15,120,910),"720p_6":Cn(960,720,30,120,1380),"1080p":Cn(1920,1080,15,120,2080),"1080p_1":Cn(1920,1080,15,120,2080),"1080p_2":Cn(1920,1080,30,120,3e3),"1080p_3":Cn(1920,1080,30,120,3150),"1080p_5":Cn(1920,1080,60,120,4780),"1440p":Cn(2560,1440,30,120,4850),"1440p_1":Cn(2560,1440,30,120,4850),"1440p_2":Cn(2560,1440,60,120,7350),"4k":Cn(3840,2160,30,120,8910),"4k_1":Cn(3840,2160,30,120,8910),"4k_3":Cn(3840,2160,60,120,13500)},Jfe={"480p":lu(640,480,5),"480p_1":lu(640,480,5),"480p_2":lu(640,480,30),"480p_3":lu(640,480,15),"720p":lu(1280,720,5),"720p_auto":Cn(1280,720,30,900,3e3),"720p_1":lu(1280,720,5),"720p_2":lu(1280,720,30),"720p_3":lu(1280,720,15),"1080p":lu(1920,1080,5),"1080p_1":lu(1920,1080,5),"1080p_2":lu(1920,1080,30),"1080p_3":lu(1920,1080,15)},Qfe={"1SL1TL":cx(1,1),"3SL3TL":cx(3,3),"2SL3TL":cx(2,3)};function mh(e){return e||(e="480p_1"),typeof e=="string"?Object.assign({},Xfe[e]):e}function lx(e){return typeof e=="string"?Object.assign({},Jfe[e]):e}function BA(e){return typeof e=="string"?Object.assign({},Qfe[e]):e}const Zfe={speech_low_quality:Ov(16e3,!1),speech_standard:Ov(32e3,!1,18),music_standard:Ov(48e3,!1),standard_stereo:Ov(48e3,!0,56),high_quality:Ov(48e3,!1,128),high_quality_stereo:Ov(48e3,!0,192)};function WA(e){return typeof e=="string"?Object.assign({},Zfe[e]):e}const kv=[];function w8(e){return ki(e,"mediaSource",["screen","window","application"]),!0}let Et=function(e){return e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",e.NEED_CLOSE="@need_close",e.NEED_ENABLE_TRACK="@need_enable_track",e.NEED_DISABLE_TRACK="@need_disable_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_RTC_STATS="@get_rtc_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",e.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",e.NEED_MUTE_TRACK="@need_mute_track",e.NEED_UNMUTE_TRACK="@need_unmute_track",e}({}),ar=function(e){return e.SCREEN_TRACK="screen_track",e.CUSTOM_TRACK="custome_track",e.LOW_STREAM="low_stream",e.SCREEN_LOW_TRACK="screen_low_track",e}({}),Nv=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e}({}),epe=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",e}({}),tpe=function(e){return e[e.DISABLE=0]="DISABLE",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.AUDIO_ONLY=2]="AUDIO_ONLY",e[e.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",e}({}),O_=function(e){return e.TRANSCEIVER_UPDATED="transceiver-updated",e.SEI_TO_SEND="sei-to-send",e.SEI_RECEIVED="sei-received",e.TRACK_UPDATED="track-updated",e}({}),Dv=function(e){return e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.CLOSED="closed",e}({}),Lv=function(e){return e.FIRST_FRAME_DECODED="first-frame-decoded",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.VIDEO_STATE_CHANGED="video-state-changed",e}({}),xv=function(e){return e.AUDIO="audio",e.VIDEO="video",e.DATA="data",e}({}),Lc=function(e){return e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer",e.UPDATE_SOURCE="update_source",e}({});(function(e){e.UPDATE_TRACK_SOURCE="update-track-source"})({});const ux={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},dx={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},R8={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},npe={uplinkNetworkQuality:0,downlinkNetworkQuality:0},C8={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let vs=function(e){return e.ON_TRACK="on_track",e.ON_NODE="on_node",e}({}),xc=function(e){return e.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",e.REQUEST_CONSTRAINTS="request_constraints",e}({}),ET=function(e){return e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND",e}({}),k_=function(e){return e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",e}({}),ts=function(e){return e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied",e.LOADEDDATA="loadeddata",e}({}),gh=function(e){return e[e.VideoStateStopped=0]="VideoStateStopped",e[e.VideoStateStarting=1]="VideoStateStarting",e[e.VideoStateDecoding=2]="VideoStateDecoding",e[e.VideoStateFrozen=3]="VideoStateFrozen",e}({});const hx={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let zA=function(e){return e.OPEN="open",e.MESSAGE="message",e.CLOSE="close",e.CLOSING="closing",e.ERROR="error",e}({});function I8(e,r){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),o.push.apply(o,s)}return o}function Rr(e){for(var r=1;r<arguments.length;r++){var o=arguments[r]!=null?arguments[r]:{};r%2?I8(Object(o),!0).forEach(function(s){Pe(e,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):I8(Object(o)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(o,s))})}return e}function Pe(e,r,o){return(r=function(s){var c=function(u,h){if(typeof u!="object"||u===null)return u;var m=u[Symbol.toPrimitive];if(m!==void 0){var _=m.call(u,"string");if(typeof _!="object")return _;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(u)}(s);return typeof c=="symbol"?c:String(c)}(r))in e?Object.defineProperty(e,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[r]=o,e}function In(e,r,o,s,c){var u,h,m={};return Object.keys(s).forEach(function(_){m[_]=s[_]}),m.enumerable=!!m.enumerable,m.configurable=!!m.configurable,("value"in m||m.initializer)&&(m.writable=!0),m=qa(u=Qp(h=o.slice()).call(h)).call(u,function(_,y){return y(e,r,_)||_},m),c&&m.initializer!==void 0&&(m.value=m.initializer?m.initializer.call(c):void 0,m.initializer=void 0),m.initializer===void 0&&(Object.defineProperty(e,r,m),m=null),m}class A8 extends Pr{set _mediaStreamTrack(r){r!==this.mediaStreamTrack&&(this.safeEmit(O_.TRACK_UPDATED,r),this.mediaStreamTrack=r)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(r,o){super(),Pe(this,"trackMediaType",void 0),Pe(this,"_ID",void 0),Pe(this,"_rtpTransceiver",void 0),Pe(this,"_lowRtpTransceiver",void 0),Pe(this,"_hints",[]),Pe(this,"_isClosed",!1),Pe(this,"_originMediaStreamTrack",void 0),Pe(this,"mediaStreamTrack",void 0),Pe(this,"_external",{}),this._ID=o||sr(8,"track-"),this._originMediaStreamTrack=r,this.mediaStreamTrack=r,function(s){st(kv).call(kv,s)||kv.push(s)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(r){return r||Rm(()=>{var o;wt.reportApiInvoke(null,{name:_i.GET_MEDIA_STREAM_TRACK,options:[],tag:xr.TRACER}).onSuccess(((o=this._mediaStreamTrack)===null||o===void 0?void 0:o.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(r){return r===Nv.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(r){const o=kv.indexOf(r);o!==-1&&kv.splice(o,1)}(this),this.emit(Dv.CLOSED),this.removeAllListeners(O_.SEI_RECEIVED)}_updateRtpTransceiver(r,o){if(o===Nv.LOW_STREAM){if(this._lowRtpTransceiver===r)return;this._lowRtpTransceiver=r}else{if(this._rtpTransceiver===r)return;this._rtpTransceiver=r}this.emit(O_.TRANSCEIVER_UPDATED,r,o)}}class Mv extends A8{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(r,o){super(r,o),Pe(this,"_enabled",!0),Pe(this,"_muted",!1),Pe(this,"_isExternalTrack",!1),Pe(this,"_isClosed",!1),Pe(this,"_enabledMutex",void 0),Pe(this,"processor",void 0),Pe(this,"_processorContext",void 0),Pe(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new Oo("".concat(this.getTrackId())),r.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var r,o;return(r=(o=this._originMediaStreamTrack)===null||o===void 0?void 0:o.label)!==null&&r!==void 0?r:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,D.debug("[".concat(this.getTrackId(),"] close")),this.emit(Et.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(r,o){let s=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=s,r!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),o&&this._originMediaStreamTrack.stop()),r.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=r,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await or(this,Et.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){D.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Dv.TRACK_ENDED)}stateCheck(r,o){if(D.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(r,": ").concat(o,"]")),Gf(o,r),this._enabled&&this._muted&&r==="enabled"&&o===!1)throw new Le(X.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",D);if(!this._enabled&&!this._muted&&r==="muted"&&o===!0)throw new Le(X.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",D)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():lt.resolve([])}}const P8=window.AudioContext||window.webkitAudioContext;let Mc=null;const Jn=new class extends Pr{constructor(){super(...arguments),Pe(this,"prevState",void 0),Pe(this,"curState",void 0),Pe(this,"currentTime",void 0),Pe(this,"currentTimeStuckAt",void 0),Pe(this,"interruptDetectorTrack",void 0),Pe(this,"onLocalAudioTrackMute",()=>{D.info("ios15-interruption-start"),this.emit(so.IOS_15_16_INTERRUPTION_START)}),Pe(this,"onLocalAudioTrackUnmute",async()=>{D.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?D.info("ios15-interruption-end-canceled"):(Mc&&await Mc.suspend(),this.emit(so.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(e){D.debug("webaudio bindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(e){D.debug("webaudio unbindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function Uv(){if(!Mc){if(function(){if(!P8)return void D.error("your browser is not support web audio");D.info("create audio context");const e=Rr({},re("WEBAUDIO_INIT_OPTIONS"));D.debug("audio context init option:",JSON.stringify(e)),Mc=new P8(e),Jn.curState=Mc.state,Mc.onstatechange=()=>{Jn.prevState=Jn.curState,Jn.curState=Mc?Mc.state:void 0;const{prevState:r,curState:o}=Jn,s=o==="running",c=o==="interrupted",u=r==="running",h=r==="suspended",m=r==="interrupted",_=Rn().osVersion;(ys()||au())&&u&&c&&(D.info("ios".concat(_,"-interruption-start")),Jn.emit(so.IOS_INTERRUPTION_START)),(ys()||au())&&(h||m)&&s&&(D.info("ios".concat(_,"-interruption-end")),Jn.emit(so.IOS_INTERRUPTION_END)),r!==o&&Jn.emit(so.STATE_CHANGE,o,r)},setInterval(()=>{var r;const o=(r=Mc)===null||r===void 0?void 0:r.currentTime;Jn.currentTime!==o?(Jn.currentTimeStuckAt&&(D.debug("AudioContext current time resume at ".concat(o)),Jn.currentTimeStuckAt=void 0),Jn.currentTime=o):(o!==Jn.currentTimeStuckAt&&(wt.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:o},tag:xr.TRACER}).onSuccess(),D.warning("AudioContext current time stuck at ".concat(o))),Jn.currentTimeStuckAt=o)},5e3),async function(r){const o=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let s,c=!1,u=!1,h=!1;function m(U){r.state==="running"?_(!1):ys()||au()?r.state==="suspended"&&(_(!0),U&&r.resume().then(y,y)):r.state!=="closed"&&(_(!0),U&&r.resume().then(y,y))}function _(U){if(c!==U){c=U;for(let V=0,q=o;V<q.length;V+=1){const Y=q[V];U?window.addEventListener(Y,S,{capture:!0,passive:!0}):window.removeEventListener(Y,S,{capture:!0,passive:!0})}}}function y(){m(!1)}function S(){m(!0)}function R(U){if(!h)if(s.paused)if(U){let V;P(!1),h=!0;try{V=s.play(),V?V.then(k,k):(s.addEventListener("playing",k),s.addEventListener("abort",k),s.addEventListener("error",k))}catch{k()}}else P(!0);else P(!1)}function P(U){if(u!==U){u=U;for(let V=0,q=o;V<q.length;V++){const Y=q[V];U?window.addEventListener(Y,z,{capture:!0,passive:!0}):window.removeEventListener(Y,z,{capture:!0,passive:!0})}}}function k(){s.removeEventListener("playing",k),s.removeEventListener("abort",k),s.removeEventListener("error",k),h=!1,R(!1)}function z(){R(!0)}if(ys()){const U=r.createMediaStreamDestination(),V=document.createElement("div");V.innerHTML="<audio x-webkit-airplay='deny'></audio>",s=V.children.item(0),s.controls=!1,s.disableRemotePlayback=!0,s.preload="auto",s.srcObject=U.stream,R(!0)}Jn.on(so.STATE_CHANGE,function(){m(!0)}),m(!1)}(Mc)}(),!Mc)throw new Le(X.NOT_SUPPORTED,"can not create audio context");return Mc}return Mc}function N_(e){if(function(){if(fx!==null)return fx;const s=Uv(),c=s.createBufferSource(),u=s.createGain(),h=s.createGain();c.connect(u),c.connect(h),c.disconnect(u);let m=!1;try{c.disconnect(u)}catch{m=!0}return c.disconnect(),fx=m,m}())return;const r=e.connect,o=e.disconnect;e.connect=(s,c,u)=>{var h;return e._inputNodes||(e._inputNodes=[]),st(h=e._inputNodes).call(h,s)||(s instanceof AudioNode?(e._inputNodes.push(s),r.call(e,s,c,u)):r.call(e,s,c)),e},e.disconnect=(s,c,u)=>{o.call(e),s?NA(e._inputNodes,s):e._inputNodes=[];for(const h of e._inputNodes)r.call(e,h)}}let fx=null;function px(e,r){let o=!1;const s=1/r;if(re("DISABLE_WEBAUDIO")){const c=window.setInterval(()=>{o?window.clearInterval(c):e(performance.now()/1e3)},1e3*s)}else{const c=Uv();let u=c.createGain();u.gain.value=0,u.connect(c.destination);const h=()=>{if(o)return void(u=null);const m=c.createOscillator();m.onended=h,m.connect(u),m.start(0),m.stop(c.currentTime+s),e(c.currentTime)};h()}return()=>{o=!0}}class O8{constructor(){Pe(this,"context",void 0),Pe(this,"analyserNode",void 0),Pe(this,"sourceNode",void 0),this.context=Uv(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(r){if(r!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=r,r==null||r.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||ys()||au()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const r=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(r);else{const s=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(s);for(let c=0;c<r.length;++c)r[c]=s[c]/128-1}const o=qa(r).call(r,(s,c)=>s+c*c,0)/r.length;return Math.max(10*Math.log10(o)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var r,o;(r=this.sourceNode)===null||r===void 0||r.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(o=this.sourceNode)===null||o===void 0||o.connect(this.analyserNode)}catch{D.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class k8 extends Pr{get processSourceNode(){return this.sourceNode}set processedNode(r){var o;if(!this.isDestroyed&&this._processedNode!==r){try{var s;(s=this.sourceNode)===null||s===void 0||s.disconnect(this.outputNode)}catch{}(o=this._processedNode)===null||o===void 0||o.disconnect(),this._processedNode=r,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),Pe(this,"outputNode",void 0),Pe(this,"outputTrack",void 0),Pe(this,"isPlayed",!1),Pe(this,"sourceNode",void 0),Pe(this,"context",void 0),Pe(this,"audioBufferNode",void 0),Pe(this,"destNode",void 0),Pe(this,"audioOutputLevel",0),Pe(this,"volumeLevelAnalyser",void 0),Pe(this,"_processedNode",void 0),Pe(this,"playNode",void 0),Pe(this,"isDestroyed",!1),Pe(this,"onNoAudioInput",void 0),Pe(this,"isNoAudioInput",!1),Pe(this,"_noAudioInputCount",0),this.context=Uv(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),N_(this.outputNode),this.volumeLevelAnalyser=new O8}startGetAudioBuffer(r){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(r),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=o=>{this.emit(Lc.ON_AUDIO_BUFFER,function(s){for(let c=0;c<s.outputBuffer.numberOfChannels;c+=1){const u=s.outputBuffer.getChannelData(c);for(let h=0;h<u.length;h+=1)u[h]=0}return s.inputBuffer}(o))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!kn().webAudioMediaStreamDest)throw new Le(X.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(r){this.context.state!=="running"&&DA(()=>{Jn.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=r||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(r>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;ys()||au()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const o=this.volumeLevelAnalyser.getAnalyserNode();let s;o.getFloatTimeDomainData?(s=new Float32Array(o.fftSize),o.getFloatTimeDomainData(s)):(s=new Uint8Array(o.fftSize),o.getByteTimeDomainData(s));let c=!1;for(let u=0;u<s.length;u++)s[u]!==0&&(c=!0);return c?(this.isNoAudioInput=!1,!0):(await io(200),await this.checkHasAudioInput(r?r+1:1)&&c)}getAudioVolume(){return this.outputNode.gain.value}setVolume(r){this.outputNode.gain.setValueAtTime(r,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var r,o;(r=this.processedNode)===null||r===void 0||r.disconnect(),(o=this.sourceNode)===null||o===void 0||o.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var r;this.processedNode?(r=this.processedNode)===null||r===void 0||r.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class N8 extends k8{get isFreeze(){return!1}constructor(r,o,s){var c;if(super(),Pe(this,"sourceNode",void 0),Pe(this,"track",void 0),Pe(this,"clonedTrack",void 0),Pe(this,"audioElement",void 0),Pe(this,"isCurrentTrackCloned",!1),Pe(this,"isRemoteTrack",!1),Pe(this,"originVolumeLevelAnalyser",void 0),Pe(this,"rebuildWebAudio",async()=>{if(D.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void D.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>D.info("resume success")),D.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const m=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?m.stop():this.isCurrentTrackCloned=!0;const _=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(_),N_(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const y=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(y,this.context.currentTime),N_(this.outputNode),this.emit(Lc.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=_,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),r.kind!=="audio")throw new Le(X.UNEXPECTED_ERROR);this.track=r;const u=new MediaStream([this.track]);if(this.isRemoteTrack=!!o,this.sourceNode=this.context.createMediaStreamSource(u),N_(this.sourceNode),s){const m=s.clone();m.enabled=!0,this.clonedTrack=m,D.debug("create an unmuted track ".concat(m.id," from the original track ").concat(s.id," to get the volume"));const _=this.context.createMediaStreamSource(new MediaStream([m]));N_(_),this.originVolumeLevelAnalyser=new O8,this.originVolumeLevelAnalyser.updateSource(_)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=u;const h=Rn();o&&h.os===Fi.IOS&&Number((c=h.osVersion)===null||c===void 0?void 0:c.split(".")[0])<15&&(Jn.on(so.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(m=>{m||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(r){this.sourceNode.disconnect(),this.track=r,this.isCurrentTrackCloned=!1;const o=new MediaStream([r]);this.sourceNode=this.context.createMediaStreamSource(o),N_(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(Lc.UPDATE_SOURCE),this.audioElement.srcObject=o}destroy(){var r;this.audioElement.srcObject=null,this.audioElement.remove(),Jn.off("state-change",this.rebuildWebAudio),(r=this.originVolumeLevelAnalyser)===null||r===void 0||r.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(r){return this.context.createMediaStreamSource(new MediaStream([r]))}updateOriginTrack(r){const o=r.clone();o.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=o),D.debug("create an unmuted track ".concat(o.id," from the original track ").concat(r.id," to get the volume"));const s=this.context.createMediaStreamSource(new MediaStream([o]));N_(s),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(s)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function D8(e,r,o){const s=(u,h)=>u?typeof u!="number"?u.max||u.exact||u.ideal||u.min||h:u:h,c={audio:!!o&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:s(r.height,1080),maxWidth:s(r.width,1920)}}};return r.frameRate&&typeof r.frameRate!="number"?(c.video.mandatory.maxFrameRate=r.frameRate.max,c.video.mandatory.minFrameRate=r.frameRate.min):typeof r.frameRate=="number"&&(c.video.mandatory.maxFrameRate=r.frameRate),await navigator.mediaDevices.getUserMedia(c)}async function rpe(e,r){const o=await L8(e.mediaSource),{sourceId:s,audio:c}=await function(u){let h=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new lt((m,_)=>{const y=document.createElement("div");y.innerText="share screen",y.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const S=document.createElement("div");S.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const R=document.createElement("div");R.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",R.setAttribute("style","height: 12%;");const P=document.createElement("div");P.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const k=document.createElement("div");k.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const z=document.createElement("button");z.innerHTML="cancel",z.setAttribute("style","width: 85px;"),z.onclick=()=>{document.body.removeChild(q);const Y=new Error("NotAllowedError");Y.name="NotAllowedError",_(Y)};let U=h;const V=document.createElement("div");if(h){const Y=document.createElement("input");Y.setAttribute("type","checkbox");const ce=document.createElement("span");Y.setAttribute("style","margin-right: 6px;"),ce.innerText="Share audio",Y.checked=U,Y.onchange=()=>{U=Y.checked},V.appendChild(Y),V.appendChild(ce)}k.appendChild(V),k.appendChild(z),S.appendChild(R),S.appendChild(P),S.appendChild(k);const q=document.createElement("div");q.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),q.appendChild(y),q.appendChild(S),document.body.appendChild(q),u.map(Y=>{if(Y.id){const ce=document.createElement("div");ce.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let _e=Y.thumbnail;try{const{width:Ee}=_e.getSize();Ee>1920&&(_e=_e.resize({width:1920}))}catch(Ee){throw Ee&&Ee.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),Ee}ce.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+_e.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+Y.name.replace(/[\u00A0-\u9999<>\&]/g,function(Ee){return"&#"+Ee.charCodeAt(0)+";"})+"</span>",ce.onclick=()=>{document.body.removeChild(q),m({sourceId:Y.id,audio:U})},P.appendChild(ce)}})})}(o,r);return await D8(s,e,c)}async function L8(e){let r=["window","screen"];e!=="application"&&e!=="window"||(r=["window"]),e==="screen"&&(r=["screen"]);const o=$W();if(!o)throw console.error("failed to fetch electron, please mount it to window"),new Le(X.ELECTRON_IS_NULL);let s=null;try{var c;s=((c=o.desktopCapturer)===null||c===void 0?void 0:c.getSources({types:r}))||o.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:r})}catch{s=null}s&&s.then||(s=new lt((u,h)=>{o.desktopCapturer.getSources({types:r},(m,_)=>{m?h(m):u(_)})}));try{return await s}catch(u){throw new Le(X.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,u.toString())}}const mx=new Oo("safari");let x8=!1,M8=!1;async function Uc(e,r){let o=0,s=null;for(;o<2;)try{s=await ipe(e,r,o>0);break}catch(c){if(c instanceof Le)throw D.error("[".concat(r,"] ").concat(c.toString())),c;const u=GA(c.name||c.code||c,c.message);if(u.code===X.MEDIA_OPTION_INVALID){D.debug("[".concat(r,"] detect media option invalid, retry")),o+=1,await io(500);continue}throw D.error("[".concat(r,"] ").concat(u.toString())),u}if(!s)throw new Le(X.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return s}async function ipe(e,r,o){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Le(X.NOT_SUPPORTED,"can not find getUserMedia");o&&(e.video&&(delete e.video.width,delete e.video.height),e.screen&&(delete e.screen.width,delete e.screen.height));const s=kn(),c=new MediaStream;if(e.audioSource&&c.addTrack(e.audioSource),e.videoSource&&c.addTrack(e.videoSource),!e.audio&&!e.video&&!e.screen)return D.debug("Using Video Source/ Audio Source"),c;if(e.screen)if($W())e.screen.sourceId?Vv(c,await D8(e.screen.sourceId,e.screen,!!e.screenAudio)):Vv(c,await rpe(e.screen,!!e.screenAudio));else if(Wf()&&e.screen.extensionId&&e.screen.mandatory){if(!s.getStreamFromExtension)throw new Le(X.NOT_SUPPORTED,"This browser does not support screen sharing");D.debug("[".concat(r,'] Screen access on chrome stable, looking for extension"'));const P=await(h=e.screen.extensionId,m=r,new lt((k,z)=>{try{chrome.runtime.sendMessage(h,{getStream:!0},U=>{if(!U||!U.streamId)return D.error("[".concat(m,"] No response from Chrome Plugin. Plugin not installed properly"),U),void z(new Le(X.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));k(U.streamId)})}catch(U){D.error("[".concat(m,"] AgoraRTC screensharing plugin is not accessible(").concat(h,")"),U.toString()),z(new Le(X.CHROME_PLUGIN_NOT_INSTALL))}}));e.screen.mandatory.chromeMediaSourceId=P,Vv(c,await navigator.mediaDevices.getUserMedia({video:{mandatory:e.screen.mandatory}}))}else if(s.getDisplayMedia){var u;e.screen.mediaSource&&w8(e.screen.mediaSource);const P={width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate,displaySurface:(u=e.screen.displaySurface)!==null&&u!==void 0?u:e.screen.mediaSource==="screen"?"monitor":e.screen.mediaSource},{selfBrowserSurface:k,surfaceSwitching:z,systemAudio:U,preferCurrentTab:V}=e.screen,q={selfBrowserSurface:k,surfaceSwitching:z,systemAudio:U,preferCurrentTab:V};!k&&delete q.selfBrowserSurface,!z&&delete q.surfaceSwitching,!U&&delete q.systemAudio,!V&&delete q.preferCurrentTab,D.debug("[".concat(r,"] getDisplayMedia:"),JSON.stringify({video:P,audio:e.screenAudio,controls:q})),Vv(c,await navigator.mediaDevices.getDisplayMedia(Rr({video:P,audio:e.screenAudio},q)))}else{if(!Dr())throw D.error("[".concat(r,"] This browser does not support screenSharing")),new Le(X.NOT_SUPPORTED,"This browser does not support screen sharing");{e.screen.mediaSource&&w8(e.screen.mediaSource);const P={video:{mediaSource:e.screen.mediaSource,width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}};D.debug("[".concat(r,"] getUserMedia: ").concat(JSON.stringify(P))),Vv(c,await navigator.mediaDevices.getUserMedia(P))}}var h,m;if(!e.video&&!e.audio)return c;let _={video:e.video,audio:e.audio},y=re("MEDIA_DEVICE_CONSTRAINTS");if(y)try{typeof y=="string"&&(y=JSON.parse(y)),_=$L(_,y)}catch{}D.debug("[".concat(r,"] GetUserMedia"),JSON.stringify(_)),Rn();let S,R=null;(vo()||ys()||OA())&&(R=await mx.lock());try{S=await navigator.mediaDevices.getUserMedia(_)}catch(P){throw R&&R(),P}return _.audio&&(x8=!0),_.video&&(M8=!0),Vv(c,S),R&&R(),c}function GA(e,r){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new Le(X.MEDIA_OPTION_INVALID,"".concat(e,": ").concat(r));case"NotFoundError":case"DevicesNotFoundError":return new Le(X.DEVICE_NOT_FOUND,"".concat(e,": ").concat(r));case"NotSupportedError":return new Le(X.NOT_SUPPORTED,"".concat(e,": ").concat(r));case"NotReadableError":return new Le(X.NOT_READABLE,"".concat(e,": ").concat(r));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new Le(X.PERMISSION_DENIED,"".concat(e,": ").concat(r));case"ConstraintNotSatisfiedError":return new Le(X.CONSTRAINT_NOT_SATISFIED,"".concat(e,": ").concat(r));default:return D.error("getUserMedia unexpected error",e),new Le(X.UNEXPECTED_ERROR,"".concat(e,": ").concat(r))}}function Vv(e,r){const o=e.getVideoTracks()[0],s=e.getAudioTracks()[0],c=r.getVideoTracks()[0],u=r.getAudioTracks()[0];u&&(s&&e.removeTrack(s),e.addTrack(u)),c&&(o&&e.removeTrack(o),e.addTrack(c))}const Vc=new class extends Pr{get state(){return this._state}set state(e){e!==this._state&&(this.emit(k_.STATE_CHANGE,e),this._state=e)}constructor(){super(),Pe(this,"_state",ET.IDLE),Pe(this,"isAccessMicrophonePermission",!1),Pe(this,"isAccessCameraPermission",!1),Pe(this,"lastAccessMicrophonePermission",!1),Pe(this,"lastAccessCameraPermission",!1),Pe(this,"checkdeviceMatched",!1),Pe(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(re("ENUMERATE_DEVICES_INTERVAL")||(kA()||PA()===Fi.HARMONY_OS)&&zf())&&this.updateDevicesInfo()},re("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(e=>D.error(e.toString()))}async enumerateDevices(e,r){let o=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new Le(X.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const s=await navigator.mediaDevices.enumerateDevices(),c=this.checkMediaDeviceInfoIsOk(s);let u=!this.isAccessMicrophonePermission&&e,h=!this.isAccessCameraPermission&&r;c.audio&&(u=!1),c.video&&(h=!1);let m=null,_=null,y=null;if(!o&&(u||h)){if(mx.isLocked&&(D.debug("[device manager] wait GUM lock"),(await mx.lock())(),D.debug("[device manager] GUM unlock")),x8&&(u=!1,this.isAccessMicrophonePermission=!0),M8&&(h=!1,this.isAccessCameraPermission=!0),D.debug("[device manager] check media device permissions",e,r,u,h),u&&h){try{y=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(S){const R=GA(S.name||S.code||S,S.message);if(R.code===X.PERMISSION_DENIED)throw R;D.warning("getUserMedia failed in getDevices",R)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(u){try{m=await navigator.mediaDevices.getUserMedia({audio:e})}catch(S){const R=GA(S.name||S.code||S,S.message);if(R.code===X.PERMISSION_DENIED)throw R;D.warning("getUserMedia failed in getDevices",R)}this.isAccessMicrophonePermission=!0}else if(h){try{_=await navigator.mediaDevices.getUserMedia({video:r})}catch(S){const R=GA(S.name||S.code||S,S.message);if(R.code===X.PERMISSION_DENIED)throw R;D.warning("getUserMedia failed in getDevices",R)}this.isAccessCameraPermission=!0}D.debug("[device manager] mic permission",e,"cam permission",r)}try{const S=await navigator.mediaDevices.enumerateDevices();return m&&m.getTracks().forEach(R=>R.stop()),_&&_.getTracks().forEach(R=>R.stop()),y&&y.getTracks().forEach(R=>R.stop()),m=null,_=null,y=null,S}catch(S){return m&&m.getTracks().forEach(R=>R.stop()),_&&_.getTracks().forEach(R=>R.stop()),y&&y.getTracks().forEach(R=>R.stop()),m=null,_=null,y=null,new Le(X.ENUMERATE_DEVICES_FAILED,S.toString()).throw()}}async getRecordingDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(r=>r.kind==="audioinput")}async getCamerasDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,e)).filter(r=>r.kind==="videoinput")}async getSpeakers(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(r=>r.kind==="audiooutput")}searchDeviceIdByName(e){let r=null;return this.deviceInfoMap.forEach(o=>{o.device.label===e&&(r=o.device.deviceId)}),r}async getDeviceById(e){const r=(await this.enumerateDevices(!0,!0,!0)).find(o=>o.deviceId===e);if(!r)throw new Le(X.DEVICE_NOT_FOUND,"deviceId: ".concat(e));return r}async init(){this.state=ET.INITING;try{await this.updateDevicesInfo(),this.state=ET.INITEND}catch(e){throw D.warning("Device Detection functionality cannot start properly.",e.toString()),this.state=ET.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new Le(X.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),e}}async updateDevicesInfo(){const e=await this.enumerateDevices(!0,!0,!0),r=Date.now(),o=[];if(e[0]&&e[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const c=e.find(h=>h.kind==="audioinput"&&h.deviceId==="default"),u=e.find(h=>h.kind==="audiooutput"&&h.deviceId==="default");c&&u?u.groupId===c.groupId?D.debug("[device-check] default input ".concat(c.label," and output ").concat(u.label," is the same group")):D.debug("[device-check] default input ".concat(c.label," and output ").concat(u.label," is not the same group")):D.debug("[device-check] default input or output not found")}const s=this.checkMediaDeviceInfoIsOk(e);if(e.forEach(c=>{if(!c.deviceId)return;const u=this.deviceInfoMap.get("".concat(c.kind,"_").concat(c.deviceId));if((u?u.state:"INACTIVE")!=="ACTIVE"){const h={initAt:r,updateAt:r,device:c,state:"ACTIVE"};this.deviceInfoMap.set("".concat(c.kind,"_").concat(c.deviceId),h),o.push(h)}u&&(u.updateAt=r)}),this.deviceInfoMap.forEach((c,u)=>{c.state==="ACTIVE"&&c.updateAt!==r&&(c.state="INACTIVE",o.push(c))}),this.state!==ET.INITEND)return s.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(s.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));o.forEach(c=>{switch(c.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(k_.RECORDING_DEVICE_CHANGED,c);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(k_.CAMERA_DEVICE_CHANGED,c);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(k_.PLAYOUT_DEVICE_CHANGED,c)}}),s.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),s.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(e){const r=e.filter(c=>c.kind==="audioinput"),o=e.filter(c=>c.kind==="videoinput"),s={audio:!1,video:!1};for(const c of r)if(c.label&&c.deviceId){s.audio=!0;break}for(const c of o)if(c.label&&c.deviceId){s.video=!0;break}return s}};let gx=!1;const Fc=new class extends Pr{constructor(){super(...arguments),Pe(this,"onAutoplayFailed",void 0),Pe(this,"onAudioAutoplayFailed",void 0)}};function U8(){if(Rn(),!gx){const e=r=>{r.preventDefault(),gx=!1,lT()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};gx=!0,lT()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),D.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),Fc.onAutoplayFailed?Fc.onAutoplayFailed():Fc.onAudioAutoplayFailed?D.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):D.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),Fc.emit("autoplay-failed")}}function V8(e,r,o,s){if(!e)return;const c=wt.getBaseInfoBySessionId(e);if(!c)return;const u=c.info,h=Date.now(),m=Rr(Rr({},u),{},{vid:u.vid===void 0?0:Number(u.vid),lts:h,elapse:h-c.startTime,cbRegistered:Fc.onAutoplayFailed||Fc.onAudioAutoplayFailed?1:-1,errorMsg:o,mediaType:r,trackId:s,extend:void 0});wt.send({type:wr.AUTOPLAY_FAILED,data:m},!0)}const ope=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],$s=new class{constructor(){Pe(this,"onAutoplayFailed",void 0),Pe(this,"elementMap",new Map),Pe(this,"elementStateMap",new Map),Pe(this,"elementsNeedToResume",[]),Pe(this,"sinkIdMap",new Map),Pe(this,"autoResumeAfterInterruption",e=>{Array.from(this.elementMap.entries()).forEach(r=>{let[o,s]=r;const c=this.elementStateMap.get(o),u=s.srcObject.getAudioTracks()[0],h=u&&u.readyState;if(D.debug("resume after interrupted, ele: ".concat(c," audio: ").concat(h," ").concat(e)),h==="live"){if(e)return s.pause(),void s.play();if(Jn.curState==="running")return wv()?(s.pause(),void s.play()):void(c&&c==="paused"&&s.play())}})}),Pe(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(e=>{let[r,o]=e;const s=o.srcObject.getAudioTracks()[0];s&&s.readyState==="live"&&(D.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),o.pause(),o.play())})}),this.autoResumeAudioElement(),Jn.on(so.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Jn.on(so.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),Jn.on(so.STATE_CHANGE,()=>{ys()&&Jn.prevState==="suspended"&&Jn.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(e,r){const o=this.elementMap.get(e);if(this.sinkIdMap.set(e,r),o)try{await o.setSinkId(r)}catch(s){throw new Le(X.PERMISSION_DENIED,"can not set sink id: "+s.toString())}}play(e,r,o,s){if(this.elementMap.has(r))return;const c=document.createElement("audio");c.autoplay=!0,c.srcObject=new MediaStream([e]),this.bindAudioElementEvents(r,c),this.elementMap.set(r,c),this.elementStateMap.set(r,ts.INIT),this.setVolume(r,o);const u=this.sinkIdMap.get(r);if(u)try{c.setSinkId(u).catch(m=>{D.warning("[".concat(r,"] set sink id failed"),m.toString())})}catch(m){D.warning("[".concat(r,"] set sink id failed"),m.toString())}const h=c.play();h&&h.then&&h.catch(m=>{s&&V8(s,"audio",m.message,r),D.warning("audio element play warning",m.toString()),this.elementMap.has(r)&&m.name==="NotAllowedError"&&(D.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(c),DA(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),U8()}))})}updateTrack(e,r){const o=this.elementMap.get(e);o&&(o.srcObject=new MediaStream([r]))}isPlaying(e){return this.elementMap.has(e)&&this.elementStateMap.get(e)==="playing"}setVolume(e,r){const o=this.elementMap.get(e);o&&(r=Math.max(0,Math.min(100,r)),o.volume=r/100)}stop(e){const r=this.elementMap.get(e);if(this.sinkIdMap.delete(e),!r)return;const o=this.elementsNeedToResume.indexOf(r);this.elementsNeedToResume.splice(o,1),r.srcObject=null,r.remove(),this.elementMap.delete(e),this.elementStateMap.delete(e)}bindAudioElementEvents(e,r){ope.forEach(o=>{r.addEventListener(o,s=>{const c=this.elementStateMap.get(e),u=s.type==="pause"?"paused":s.type;if(D.debug("[".concat(e,"] audio-element-status change ").concat(c," => ").concat(u)),s.type==="error"){const h=r==null?void 0:r.error;h&&D.error("[".concat(e,"] media error, code: ").concat(h.code,", message: ").concat(h.message))}this.elementStateMap.set(e,u)})})}getPlayerState(e){return this.elementStateMap.get(e)||"uninit"}autoResumeAudioElement(){const e=()=>{this.elementsNeedToResume.forEach(r=>{r.play().then(o=>{D.debug("Auto resume audio element success")}).catch(o=>{D.warning("Auto resume audio element failed!",o)})}),this.elementsNeedToResume=[]};new lt(r=>{document.body?r():window.addEventListener("load",()=>r())}).then(()=>{lT()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0))})}};function Jr(){return function(e,r,o){const s=o.value;return typeof s=="function"&&(o.value=function(){this._isClosed&&new Le(X.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",D);for(var c=arguments.length,u=new Array(c),h=0;h<c;h++)u[h]=arguments[h];const m=s.apply(this,u);return m instanceof lt?new lt((_,y)=>{m.then(_).catch(y)}):m}),o}}class F8 extends Pr{constructor(r){super(),Pe(this,"name","VideoProcessorDestination"),Pe(this,"ID","0"),Pe(this,"_source",void 0),Pe(this,"videoContext",void 0),Pe(this,"inputTrack",void 0),this.videoContext=r}get kind(){return"video"}get enabled(){return!0}pipe(){throw new Le(X.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new Le(X.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(r){if(r.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);r.track&&r.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=r.track,this.emit(vs.ON_TRACK,r.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(vs.ON_TRACK,void 0)}}class j8 extends Pr{set chained(r){this._chained=r}get chained(){return this._chained}constructor(r,o){super(),Pe(this,"constraintsMap",new Map),Pe(this,"statsRegistry",[]),Pe(this,"usageRegistry",[]),Pe(this,"trackId",void 0),Pe(this,"direction",void 0),Pe(this,"_chained",!1),this.trackId=r,this.direction=o}async getConstraints(){return await bo(this,xc.REQUEST_CONSTRAINTS)}async requestApplyConstraints(r,o){var s;return D.info("processor ".concat(o.name," requestApplyConstraints for ").concat(this.trackId)),r&&this.constraintsMap.set(o,r),or(this,xc.REQUEST_UPDATE_CONSTRAINTS,Array.from(Pc(s=this.constraintsMap).call(s)))}async requestRevertConstraints(r){var o;if(this.constraintsMap.has(r))return D.info("processor ".concat(r.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(r),or(this,xc.REQUEST_UPDATE_CONSTRAINTS,Array.from(Pc(o=this.constraintsMap).call(o)))}registerStats(r,o,s){this.statsRegistry.find(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===o)||this.statsRegistry.push({processorName:r.name,processorID:r.ID,type:o,cb:s})}unregisterStats(r,o){const s=this.statsRegistry.findIndex(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===o);s!==-1&&this.statsRegistry.splice(s,1)}gatherStats(){const r=[];for(const{processorID:o,processorName:s,type:c,cb:u}of this.statsRegistry)try{const h=u();r.push({processorID:o,processorName:s,type:c,stats:h})}catch(h){D.error(new Le(X.UNEXPECTED_ERROR,h.message))}return r}registerUsage(r,o){this.usageRegistry.find(s=>s.processorID===r.ID&&s.processorName===r.name)||this.usageRegistry.push({processorID:r.ID,processorName:r.name,cb:o})}unregisterUsage(r){const o=this.usageRegistry.findIndex(s=>s.processorID===r.ID&&s.processorName===r.name);o!==-1&&this.usageRegistry.splice(o,1)}async gatherUsage(){const r=[];if(!this.chained)return[];for(const{cb:o}of this.usageRegistry)try{let s=o();s instanceof lt&&(s=await s),r.push(Rr(Rr({},s),{},{direction:this.direction}))}catch(s){D.error("gather extension usage error",s)}return r}getDirection(){return this.direction}}class B8 extends Pr{constructor(r){super(),Pe(this,"name","AudioProcessorDestination"),Pe(this,"ID","0"),Pe(this,"inputTrack",void 0),Pe(this,"inputNode",void 0),Pe(this,"audioProcessorContext",void 0),Pe(this,"_source",void 0),this.audioProcessorContext=r}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new Le(X.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new Le(X.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(vs.ON_TRACK,void 0),this.emit(vs.ON_NODE,void 0)}updateInput(r){if(r.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);r.track&&this.inputTrack!==r.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=r.track,this.emit(vs.ON_TRACK,this.inputTrack)),r.node&&this.inputNode!==r.node&&(this.audioProcessorContext.chained=!0,this.inputNode=r.node,this.emit(vs.ON_NODE,this.inputNode))}}class W8 extends Pr{set chained(r){this._chained=r}get chained(){return this._chained}constructor(r,o,s){super(),Pe(this,"constraintsMap",new Map),Pe(this,"statsRegistry",[]),Pe(this,"audioContext",void 0),Pe(this,"trackId",void 0),Pe(this,"direction",void 0),Pe(this,"usageRegistry",[]),Pe(this,"_chained",!1),this.audioContext=r,this.trackId=o,this.direction=s}async getConstraints(){return bo(this,xc.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(r,o){var s;return D.info("processor ".concat(o.name," requestApplyConstraints for ").concat(this.trackId)),r&&this.constraintsMap.set(o,r),or(this,xc.REQUEST_UPDATE_CONSTRAINTS,Array.from(Pc(s=this.constraintsMap).call(s)))}async requestRevertConstraints(r){var o;if(this.constraintsMap.has(r))return this.constraintsMap.delete(r),or(this,xc.REQUEST_UPDATE_CONSTRAINTS,Array.from(Pc(o=this.constraintsMap).call(o)))}registerStats(r,o,s){this.statsRegistry.find(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===o)||this.statsRegistry.push({processorName:r.name,processorID:r.ID,type:o,cb:s})}unregisterStats(r,o){const s=this.statsRegistry.findIndex(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===o);s!==-1&&this.statsRegistry.splice(s,1)}gatherStats(){const r=[];for(const{processorID:o,processorName:s,type:c,cb:u}of this.statsRegistry)try{const h=u();r.push({processorID:o,processorName:s,type:c,stats:h})}catch(h){D.error(new Le(X.UNEXPECTED_ERROR,h.message))}return r}registerUsage(r,o){this.usageRegistry.find(s=>s.processorID===r.ID&&s.processorName===r.name)||this.usageRegistry.push({processorID:r.ID,processorName:r.name,cb:o})}unregisterUsage(r){const o=this.usageRegistry.findIndex(s=>s.processorID===r.ID&&s.processorName===r.name);o!==-1&&this.usageRegistry.splice(o,1)}async gatherUsage(){const r=[];if(!this.chained)return[];for(const{cb:o}of this.usageRegistry)try{let s=o();s instanceof lt&&(s=await s),r.push(Rr(Rr({},s),{},{direction:this.direction}))}catch(s){D.error("gather extension usage error",s)}return r}getDirection(){return this.direction}}class _x extends Pr{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),Pe(this,"context",void 0),Pe(this,"processSourceNode",void 0),Pe(this,"outputTrack",void 0),Pe(this,"processedNode",void 0),Pe(this,"clonedTrack",void 0),Pe(this,"outputNode",void 0),this.outputNode=new spe}setVolume(){}createOutputTrack(){throw new Le(X.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class spe{disconnect(){}connect(){}}function z8(e){return new lt((r,o)=>{let s=!1;const c=document.createElement("video");c.setAttribute("autoplay",""),c.setAttribute("muted",""),c.muted=!0,c.autoplay=!0,c.setAttribute("playsinline",""),c.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(c);const u=ys()?"canplay":"playing";c.addEventListener(u,()=>{const h=c.videoWidth,m=c.videoHeight;!h&&Dr()||(s=!0,c.srcObject=null,c.remove(),r([h,m]))}),c.srcObject=new MediaStream([e]),c.play().catch(LA),setTimeout(()=>{s||(c.srcObject=null,c.remove(),r([c.videoWidth,c.videoHeight]))},4e3)})}function HA(e){const r={};e.facingMode&&(r.facingMode=e.facingMode),e.cameraId&&(r.deviceId={exact:e.cameraId});const o=mh(e.encoderConfig);return o.width!=null&&(r.width=o.width),o.height!=null&&(r.height=o.height),!BW()&&o.frameRate&&(r.frameRate=o.frameRate),DW()&&typeof r.frameRate=="object"&&(r.frameRate.max=60),Dr()&&(r.frameRate={ideal:30,max:30}),r}function G8(e){const r={};return BW()||(e.AGC!==void 0&&(r.autoGainControl=e.AGC),e.AEC!==void 0&&(r.echoCancellation=e.AEC),e.ANS!==void 0&&(r.noiseSuppression=e.ANS,Wf()&&e.ANS&&(r.googHighpassFilter=e.ANS))),r}function H8(e){const r=G8(e);if(e.encoderConfig){const o=WA(e.encoderConfig);r.channelCount=o.stereo?2:1,r.sampleRate=o.sampleRate,r.sampleSize=o.sampleSize}return e.microphoneId&&(r.deviceId={exact:e.microphoneId}),kA()&&(r.sampleRate=void 0),r}const ape=e=>{const r=e._encoderConfig;if(!r)return;const{frameRate:o,width:s,height:c}=e.getMediaStreamTrackSettings();let{frameRate:u=o,width:h=s,height:m=c}=r;if(!u||!h||!m)return;h=KL(h),m=KL(m),u=KL(u);const{max:_,min:y}=function(k,z,U){const V=200*Math.pow(U/15,.6)*Math.pow(k*z/640/360,.75);return{min:Math.floor(V),max:Math.floor(4*V)}}(h,m,u),{bitrateMax:S,bitrateMin:R}=r||{};S||D.debug("calculate bitrate: [w: ".concat(h,", h: ").concat(m,", fps: ").concat(u,"] => [brMax: ").concat(S,", brMin: ").concat(R,"]"));const{maxFramerate:P}=re("ENCODER_CONFIG_LIMIT");return P&&typeof P=="number"&&(u=Math.min(u,P)),{frameRate:u,bitrateMax:S||_,bitrateMin:R||y,scaleResolutionDownBy:1,scale:0}},$8=async(e,r,o)=>await(async(s,c,u)=>{const h=function(y){const S=[];for(let R=0;R<y.length;R+=2)S.push(parseInt(y.slice(R,R+2),16));return Uint8Array.from(S)}(r8(""+c+u)).slice(0,16),m=h.slice(0,12),_=await window.crypto.subtle.importKey("raw",h,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:m},_,s))})(e.buffer,r,o),Ex=e=>{const r=document.createElement("canvas");return r.width=2,r.height=2,new lt((o,s)=>{r.toBlob(async c=>{if(r.remove(),c){const u=await K8(c);o({buffer:u,width:r.width,height:r.height})}else s(new Le(X.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,1)})},K8=async e=>{const r=await e.arrayBuffer();return new Uint8Array(r)};var q8,Y8,X8,J8,Q8,Z8,ez,tz,nz,rz,iz,oz,sz,az,cz,lz,uz,dz,Or,hz,fz,pz,mz,gz,_z,_h,Ez,yz,vz,Sz,bz,Tz,wz,Rz,Cz,Iz,Az,Pz,Oz,wo;let Br=(q8=Mt({argsMap:(e,r)=>[e.getTrackId(),r],throttleTime:300}),Y8=Mt({argsMap:(e,r)=>[e.getTrackId(),r]}),X8=Jr(),J8=Iv("LocalAudioTrack","_enabledMutex"),Q8=Mt({argsMap:(e,r)=>[e.getTrackId(),r]}),Z8=Jr(),ez=Iv("LocalAudioTrack","_enabledMutex"),tz=Mt({argsMap:(e,r)=>[e.getTrackId(),r]}),nz=Jr(),rz=Jr(),iz=Jr(),oz=Mt({argsMap:e=>[e.getTrackId()]}),sz=Jr(),az=Mt({argsMap:e=>[e.getTrackId()]}),cz=Jr(),lz=Mt({argsMap:e=>[e.getTrackId()]}),uz=Mt({argsMap:(e,r)=>[e.getTrackId(),r.name]}),dz=Mt({argsMap:e=>[e.getTrackId()]}),In((Or=class extends Mv{get _source(){return this.initWebAudio()}set _source(e){this._trackSource=e}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?$s.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(e,r,o,s){super(e,o),Pe(this,"trackMediaType",xv.AUDIO),Pe(this,"_encoderConfig",void 0),Pe(this,"_trackSource",void 0),Pe(this,"metadata",[]),Pe(this,"_enabled",!0),Pe(this,"_volume",100),Pe(this,"_useAudioElement",!0),Pe(this,"_bypassWebAudio",!1),Pe(this,"processor",void 0),Pe(this,"_processorContext",void 0),Pe(this,"_processorDestination",void 0),Pe(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=r,this._getOriginVolumeLevel=!!s,this._trackSource=new _x,re("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),re("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),vo()&&!Mc?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(e){er(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&$s.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void D.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const r=this._source.createOutputTrack();this._mediaStreamTrack!==r&&(this._mediaStreamTrack=r,or(this,Et.NEED_REPLACE_TRACK,this).then(()=>{D.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(o=>{D.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),o)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(e){if(!this._useAudioElement||!b8())throw new Le(X.NOT_SUPPORTED,"your browser does not support setting the audio output device");await $s.setSinkID(this.getTrackId(),e)}async setEnabled(e,r,o){return this._setEnabled(e,r,o)}async _setEnabled(e,r,o){if(!o){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(D.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){this._originMediaStreamTrack.enabled=!0;try{o||(this._enabled=!0),await or(this,Et.NEED_ENABLE_TRACK,this),D.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(e," success"))}catch(s){throw o||(this._enabled=!1),D.error("[".concat(this.getTrackId(),"] setEnabled to true error"),s.toString()),s}}else{this._originMediaStreamTrack.enabled=!1,o||(this._enabled=!1);try{await or(this,Et.NEED_DISABLE_TRACK,this)}catch(s){throw o||(this._enabled=!0),D.error("[".concat(this.getTrackId(),"] setEnabled to false error"),s.toString()),s}}}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,D.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await or(this,Et.NEED_MUTE_TRACK,this):await or(this,Et.NEED_UNMUTE_TRACK,this))}getStats(){return Rm(()=>{D.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),kc(this,Et.GET_STATS)||Rr({},ux)}setAudioFrameCallback(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(Lc.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(r),this._source.removeAllListeners(Lc.ON_AUDIO_BUFFER),this._source.on(Lc.ON_AUDIO_BUFFER,o=>e(o))}play(){D.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(D.debug("[".concat(this.getTrackId(),"] start audio playback in element")),$s.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){D.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?$s.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];D.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&$s.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(e,r){this._originMediaStreamTrack!==e&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),r&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:e,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await or(this,Et.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(e))}renewMediaStreamTrack(e){return lt.resolve(void 0)}pipe(e){if(this._bypassWebAudio)throw new Le(X.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new Le(X.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(!this.processor)return;const r=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,r.reset()}bindProcessorDestinationEvents(e){e.on(vs.ON_TRACK,async r=>{r?r!==this._mediaStreamTrack&&(this._mediaStreamTrack=r,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(r),await or(this,Et.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await or(this,Et.NEED_REPLACE_TRACK,this))}),e.on(vs.ON_NODE,r=>{this._source.processedNode=r})}unbindProcessorDestinationEvents(e){e.removeAllListeners(vs.ON_TRACK),e.removeAllListeners(vs.ON_NODE)}bindProcessorContextEvents(e){e.on(xc.REQUEST_CONSTRAINTS,async r=>{r(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(e){e.removeAllListeners(xc.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof _x&&(this._trackSource=new N8(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const e=new W8(this._source.context,this.getTrackId(),"local"),r=new B8(e);return this._processorContext=e,this._processorDestination=r,this.bindProcessorContextEvents(e),this.bindProcessorDestinationEvents(r),this._source.on(Lc.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:e})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&($s.stop(this.getTrackId()),this._source.play()),or(this,Et.NEED_REPLACE_MIXING_TRACK,this).then(()=>{D.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(o=>{D.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),o)})),{processorContext:e,processorDestination:r}}}).prototype,"setVolume",[q8],Object.getOwnPropertyDescriptor(Or.prototype,"setVolume"),Or.prototype),In(Or.prototype,"setPlaybackDevice",[Y8,X8],Object.getOwnPropertyDescriptor(Or.prototype,"setPlaybackDevice"),Or.prototype),In(Or.prototype,"setEnabled",[J8,Q8,Z8],Object.getOwnPropertyDescriptor(Or.prototype,"setEnabled"),Or.prototype),In(Or.prototype,"setMuted",[ez,tz,nz],Object.getOwnPropertyDescriptor(Or.prototype,"setMuted"),Or.prototype),In(Or.prototype,"getStats",[rz],Object.getOwnPropertyDescriptor(Or.prototype,"getStats"),Or.prototype),In(Or.prototype,"setAudioFrameCallback",[iz],Object.getOwnPropertyDescriptor(Or.prototype,"setAudioFrameCallback"),Or.prototype),In(Or.prototype,"play",[oz,sz],Object.getOwnPropertyDescriptor(Or.prototype,"play"),Or.prototype),In(Or.prototype,"stop",[az,cz],Object.getOwnPropertyDescriptor(Or.prototype,"stop"),Or.prototype),In(Or.prototype,"close",[lz],Object.getOwnPropertyDescriptor(Or.prototype,"close"),Or.prototype),In(Or.prototype,"pipe",[uz],Object.getOwnPropertyDescriptor(Or.prototype,"pipe"),Or.prototype),In(Or.prototype,"unpipe",[dz],Object.getOwnPropertyDescriptor(Or.prototype,"unpipe"),Or.prototype),Or),$A=(hz=Mt({argsMap:(e,r)=>[e.getTrackId(),r]}),fz=Jr(),pz=Iv("MicrophoneAudioTrack","_enabledMutex"),mz=Mt({argsMap:(e,r,o)=>[e.getTrackId(),r,o]}),gz=Jr(),_z=Mt({argsMap:e=>[e.getTrackId()]}),In((_h=class extends Br{get __className__(){return"MicrophoneAudioTrack"}constructor(e,r,o,s){super(e,r.encoderConfig?WA(r.encoderConfig):{},s,re("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),Pe(this,"_config",void 0),Pe(this,"_deviceName","default"),Pe(this,"_constraints",void 0),Pe(this,"_originalConstraints",void 0),Pe(this,"_enabled",!0),this._config=r,this._constraints=o,this._originalConstraints=o,this._deviceName=e.label,typeof r.bypassWebAudio=="boolean"&&(this._bypassWebAudio=r.bypassWebAudio),(wv()||FL())&&Jn.bindInterruptDetectorTrack(this)}async setDevice(e){if(D.info("[".concat(this.getTrackId(),"] start set device to ").concat(e)),this._enabled)try{const r=await Vc.getDeviceById(e),o={};o.audio=Rr({},this._constraints),o.audio.deviceId={exact:e},this._originMediaStreamTrack.stop();let s=null;try{s=await Uc(o,this.getTrackId())}catch(c){throw D.error("[".concat(this.getTrackId(),"] setDevice failed"),c.toString()),s=await Uc({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(s.getAudioTracks()[0],!1),c}await this._updateOriginMediaStreamTrack(s.getAudioTracks()[0],!1),this._deviceName=r.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(r){throw D.error("[".concat(this.getTrackId(),"] setDevice error"),r.toString()),r}else try{const r=await Vc.getDeviceById(e);this._deviceName=r.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(r){throw D.error("[".concat(this.getTrackId(),"] setDevice error"),r.toString()),r}D.info("[".concat(this.getTrackId(),"] set device to ").concat(e," success"))}async setEnabled(e,r,o){if(r)return D.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(e);if(!o){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(D.info("[".concat(this.getTrackId(),"] start setEnabled"),e),re("AUTO_RESET_AUDIO_ROUTE")&&(ys()||au())){const h=navigator.audioSession;h&&(e||(h.type="playback"),h.type="auto")}if(!e){var s;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(s=this._source.clonedTrack)===null||s===void 0||s.stop(),o||(this._enabled=!1);try{await or(this,Et.NEED_DISABLE_TRACK,this)}catch(h){throw D.error("[".concat(this.getTrackId(),"] setEnabled false failed"),h.toString()),h}return}const c=Rr({},this._constraints),u=Vc.searchDeviceIdByName(this._deviceName);u&&!c.deviceId&&(c.deviceId=u);try{o||(this._enabled=!0);const h=await Uc({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(h.getAudioTracks()[0],!1),await or(this,Et.NEED_ENABLE_TRACK,this)}catch(h){throw o||(this._enabled=!1),D.error("[".concat(this.getTrackId(),"] setEnabled true failed"),h.toString()),h}D.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(wv()||FL())&&Jn.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((ys()||au())&&this._enabled&&!this._isClosed&&Jn.duringInterruption){const e=async()=>{Jn.off(so.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(D.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Jn.on(so.IOS_INTERRUPTION_END,e)}else D.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Dv.TRACK_ENDED)}async renewMediaStreamTrack(e){const r=e||this._constraints,o=Vc.searchDeviceIdByName(this._deviceName);if(o&&!r.deviceId&&(r.deviceId=o),this._constraints=r,this._enabled){this._originMediaStreamTrack.stop();const s=await Uc({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(s.getAudioTracks()[0],!0)}}bindProcessorContextEvents(e){super.bindProcessorContextEvents(e),e.on(xc.REQUEST_UPDATE_CONSTRAINTS,async(r,o,s)=>{try{const c=Object.assign({},this._originalConstraints,...r);await this.renewMediaStreamTrack(c),o()}catch(c){s(c)}})}unbindProcessorContextEvents(e){super.unbindProcessorContextEvents(e),e.removeAllListeners(xc.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[hz,fz],Object.getOwnPropertyDescriptor(_h.prototype,"setDevice"),_h.prototype),In(_h.prototype,"setEnabled",[pz,mz,gz],Object.getOwnPropertyDescriptor(_h.prototype,"setEnabled"),_h.prototype),In(_h.prototype,"close",[_z],Object.getOwnPropertyDescriptor(_h.prototype,"close"),_h.prototype),_h),cpe=(Ez=Mt({argsMap:(e,r)=>[e.getTrackId(),r,e.duration]}),yz=Jr(),vz=Mt({argsMap:e=>[e.getTrackId()]}),Sz=Jr(),bz=Mt({argsMap:e=>[e.getTrackId()]}),Tz=Jr(),wz=Mt({argsMap:e=>[e.getTrackId()]}),Rz=Jr(),Cz=Mt({argsMap:e=>[e.getTrackId()]}),Iz=Jr(),Az=Mt({argsMap:e=>[e.getTrackId()]}),Pz=Mt({argsMap:e=>[e.getTrackId()]}),Oz=Jr(),In((wo=class extends Br{get __className__(){return"BufferSourceAudioTrack"}constructor(e,r,o,s){super(r.createOutputTrack(),o,s),Pe(this,"source",void 0),Pe(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=e,this._bufferSource=r,this._bufferSource.on(Lc.AUDIO_SOURCE_STATE_CHANGE,c=>{this.safeEmit(Dv.SOURCE_STATE_CHANGE,c)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(e){this._bufferSource.seekAudioBuffer(e)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(e){er(e,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e)}}).prototype,"startProcessAudioBuffer",[Ez,yz],Object.getOwnPropertyDescriptor(wo.prototype,"startProcessAudioBuffer"),wo.prototype),In(wo.prototype,"pauseProcessAudioBuffer",[vz,Sz],Object.getOwnPropertyDescriptor(wo.prototype,"pauseProcessAudioBuffer"),wo.prototype),In(wo.prototype,"seekAudioBuffer",[bz,Tz],Object.getOwnPropertyDescriptor(wo.prototype,"seekAudioBuffer"),wo.prototype),In(wo.prototype,"resumeProcessAudioBuffer",[wz,Rz],Object.getOwnPropertyDescriptor(wo.prototype,"resumeProcessAudioBuffer"),wo.prototype),In(wo.prototype,"stopProcessAudioBuffer",[Cz,Iz],Object.getOwnPropertyDescriptor(wo.prototype,"stopProcessAudioBuffer"),wo.prototype),In(wo.prototype,"close",[Az],Object.getOwnPropertyDescriptor(wo.prototype,"close"),wo.prototype),In(wo.prototype,"setAudioBufferPlaybackSpeed",[Pz,Oz],Object.getOwnPropertyDescriptor(wo.prototype,"setAudioBufferPlaybackSpeed"),wo.prototype),wo);class Ci extends Br{get __className__(){return"MixingAudioTrack"}get isActive(){for(const r of this.trackList)if(r._enabled&&!r._isClosed&&!r.muted)return!0;return!1}constructor(){const r=Uv().createMediaStreamDestination();super(r.stream.getAudioTracks()[0],void 0,sr(8,"track-mix-")),Pe(this,"trackList",void 0),Pe(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=r,this.trackList=[]}hasAudioTrack(r){return this.trackList.indexOf(r)!==-1}addAudioTrack(r){this.trackList.indexOf(r)===-1?(D.debug("add ".concat(r.getTrackId()," to mixing track")),r._source.outputNode.connect(this.destNode),this.trackList.push(r),this.updateEncoderConfig()):D.debug("track ".concat(r.getTrackId()," is already added"))}removeAudioTrack(r){if(this.trackList.indexOf(r)!==-1){D.debug("remove ".concat(r.getTrackId()," from mixing track"));try{r._source.outputNode.disconnect(this.destNode)}catch{}NA(this.trackList,r),this.updateEncoderConfig()}}updateEncoderConfig(){const r={};this.trackList.forEach(o=>{o._encoderConfig&&((o._encoderConfig.bitrate||0)>(r.bitrate||0)&&(r.bitrate=o._encoderConfig.bitrate),(o._encoderConfig.sampleRate||0)>(r.sampleRate||0)&&(r.sampleRate=o._encoderConfig.sampleRate),(o._encoderConfig.sampleSize||0)>(r.sampleSize||0)&&(r.sampleSize=o._encoderConfig.sampleSize),o._encoderConfig.stereo&&(r.stereo=!0))}),this._encoderConfig=r}_updateRtpTransceiver(r){this._rtpTransceiver!==r&&(this._rtpTransceiver=r,this.trackList.forEach(o=>{o instanceof Ci?o.emit(O_.TRANSCEIVER_UPDATED,r):o._updateRtpTransceiver(r)}))}}class lpe extends k8{set currentState(r){r!==this._currentState&&(this._currentState=r,this.safeEmit(Lc.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(r){let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),Pe(this,"audioBuffer",void 0),Pe(this,"sourceNode",void 0),Pe(this,"startPlayTime",0),Pe(this,"startPlayOffset",0),Pe(this,"pausePlayTime",0),Pe(this,"options",void 0),Pe(this,"currentLoopCount",0),Pe(this,"currentPlaybackSpeed",100),Pe(this,"_currentState","stopped"),this.audioBuffer=r,this.options=o,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(r){this.currentState==="stopped"?(this.options=r,this.startPlayOffset=this.options.startPlayTime||0):D.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(r){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=r,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=r))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(r){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=r/100),this.currentPlaybackSpeed=r}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const r=this.context.createBufferSource();return r.buffer=this.audioBuffer,r.loop=!!this.options.loop,r.connect(this.outputNode),r.playbackRate.value=this.currentPlaybackSpeed/100,r}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const kz=new Map;class yx{get rendFrameRate(){if(this.renderStats&&this.renderStats.curTs!==this.renderStats.lastTs){const r=this.renderStats.curTs-this.renderStats.lastTs,o=(this.renderStats.renderNum-this.renderStats.lastRenderNum)/r;return this.renderStats.lastRenderNum=this.renderStats.renderNum,this.renderStats.lastTs=this.renderStats.curTs,o}return 0}get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(r){r!==this._videoElementStatus&&(D.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(r)),this._videoElementStatus=r)}get videoState(){return this._videoState}set videoState(r){var o;r!==this._videoState&&(this._videoState=r,(o=this.onVideoStateChanged)===null||o===void 0||o.call(this,this.videoState))}constructor(r){Pe(this,"trackId",void 0),Pe(this,"config",void 0),Pe(this,"onFirstVideoFrameDecoded",void 0),Pe(this,"onVideoStateChanged",void 0),Pe(this,"freezeTimeCounterList",[]),Pe(this,"renderFreezeAccTime",0),Pe(this,"isKeepLastFrame",!1),Pe(this,"timeUpdatedCount",0),Pe(this,"freezeTime",0),Pe(this,"playbackTime",0),Pe(this,"lastTimeUpdatedTime",0),Pe(this,"autoplayFailed",!1),Pe(this,"videoTrack",void 0),Pe(this,"videoElement",void 0),Pe(this,"cacheVideoElement",void 0),Pe(this,"renderStats",void 0),Pe(this,"_videoState",gh.VideoStateStopped),Pe(this,"videoElementCheckInterval",void 0),Pe(this,"videoElementFreezeTimeout",void 0),Pe(this,"_videoElementStatus",ts.NONE),Pe(this,"isGettingVideoDimensions",!1),Pe(this,"startGetVideoDimensions",()=>{const o=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return D.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(o,500)};!this.isGettingVideoDimensions&&o()}),Pe(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&Jn.curState==="running"&&(D.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(NW())),FW()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),Pe(this,"handleVideoEvents",o=>{switch(o.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=ts.PLAYING;break;case"loadeddata":if(this.videoState=gh.VideoStateStarting,this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=ts.CANPLAY;break;case"stalled":this.videoElementStatus=ts.STALLED;break;case"suspend":this.videoElementStatus=ts.SUSPEND;break;case"pause":this.videoElementStatus=ts.PAUSED,ys()||au()||vo()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(D.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=ts.WAITING;break;case"abort":this.videoElementStatus=ts.ABORT;break;case"ended":this.videoElementStatus=ts.ENDED;break;case"emptied":this.videoElementStatus=ts.EMPTIED;break;case"error":{const s=this.videoElement.error;s&&(this.videoElementStatus=ts.ERROR,D.error("[".concat(this.trackId,"] media error: ").concat(s.message," (").concat(s.code,")")));break}case"timeupdate":{const s=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=s);const c=s-this.lastTimeUpdatedTime,u=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=s,$f.lastVisibleTime<$f.lastHiddenTime||u<$f.lastHiddenTime||u<$f.lastVisibleTime)return;for(c>re("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=c),this.playbackTime+=c;this.playbackTime>=6e3;){this.playbackTime-=6e3;const h=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(h),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),Pe(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(D.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(NW())),FW()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=r.trackId,this.config=r,r.element instanceof HTMLVideoElement?this.videoElement=r.element:this.videoElement=document.createElement("video"),Jn.on(so.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Jn.on(so.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var r;return(r=this.videoElement.parentElement)!==null&&r!==void 0?r:void 0}updateConfig(r){this.config=r,this.trackId=r.trackId,r.element!==this.videoElement&&(this.destroy(),this.videoElement=r.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(r){this.videoTrack!==r&&(this.videoTrack=r,this.initVideoElement())}play(r){const o=this.videoElement.play();o&&o.catch&&o.catch(c=>{r&&V8(r,"video",c.message,this.trackId),c.name==="NotAllowedError"?(D.warning("detected video element autoplay failed",c),this.autoplayFailed=!0,this.handleAutoPlayFailed()):D.warning("[".concat(this.trackId,"] play warning: "),c)});const s=Rn();if((s.name==="Safari"&&Number(s.version)===15||wv())&&o&&o.then){const c=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};o.then(c).catch(c)}}getCurrentFrame(){const r=document.createElement("canvas");r.width=this.videoElement.videoWidth,r.height=this.videoElement.videoHeight;const o=r.getContext("2d");if(!o)return D.error("create canvas context failed!"),new ImageData(2,2);o.drawImage(this.videoElement,0,0,r.width,r.height);const s=o.getImageData(0,0,r.width,r.height);return r.remove(),s}async getCurrentFrameToUint8Array(r){let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const s=document.createElement("canvas");s.width=this.videoElement.videoWidth,s.height=this.videoElement.videoHeight;const c=s.getContext("2d");return c?(c.drawImage(this.videoElement,0,0,s.width,s.height),new lt((u,h)=>{s.toBlob(async m=>{if(s.remove(),m){const _=await K8(m);u({buffer:_,width:s.width,height:s.height})}else h(new Le(X.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},r,o<0?.1:o>1?1:o)})):await Ex(r)}destroy(){this.renderStats=void 0,Jn.off(so.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Jn.off(so.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=gh.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=ts.INIT,!this.videoElementCheckInterval&&(Nz.forEach(u=>{this.videoElement.addEventListener(u,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{(function(u){return u!==document.body&&document.body.contains(u)})(this.videoElement)||(this.videoElementStatus=ts.DESTROYED)},1e3),re("ENABLE_VIDEO_FRAME_CALLBACK"))){var r,o;let u;const h=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",h),this.videoElementFreezeTimeout=window.setTimeout(m,re("VIDEO_FREEZE_DURATION")))},m=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===gh.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=gh.VideoStateFrozen:document.addEventListener("visibilitychange",h))},_=(y,S)=>{if(this.videoElementStatus===ts.PLAYING){if(this.renderStats?(this.renderStats.renderNum++,this.renderStats.curTs=S.mediaTime):this.renderStats={lastTs:S.mediaTime,curTs:S.mediaTime,lastRenderNum:0,renderNum:0},u){const k=S.presentationTime-u.presentationTime;this.videoState===gh.VideoStateStarting&&(this.videoState=gh.VideoStateDecoding),this.videoState===gh.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(m,re("VIDEO_FREEZE_DURATION"))),k<re("VIDEO_FREEZE_DURATION")&&this.videoState===gh.VideoStateFrozen&&(this.videoState=gh.VideoStateDecoding),k>re("VIDEO_FREEZE_DURATION")&&$f.lastVisibleTime>=$f.lastHiddenTime&&u.timestamp>$f.lastVisibleTime&&u.timestamp>$f.lastHiddenTime&&(this.renderFreezeAccTime+=k)}u=Rr(Rr({},S),{},{timestamp:y})}var R,P;re("ENABLE_VIDEO_FRAME_CALLBACK")&&((R=(P=this.videoElement).requestVideoFrameCallback)===null||R===void 0||R.call(P,_))};(r=(o=this.videoElement).requestVideoFrameCallback)===null||r===void 0||r.call(o,_)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),kA()&&!re("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const s=Rn();s.name==="Safari"&&Number(s.version)===15||wv()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Dr()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Dr()&&this.videoElement.load());const c=this.videoElement.play();c!==void 0&&c.catch(u=>{D.debug("[".concat(this.trackId,"] playback interrupted"),u.toString())})}resetVideoElement(){Nz.forEach(r=>{this.videoElement&&this.videoElement.removeEventListener(r,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=ts.NONE}handleAutoPlayFailed(){const r=o=>{o.preventDefault(),this.videoElement.play().then(()=>{D.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(s=>{D.error(s)}),this.autoplayFailed=!1,lT()?document.body.removeEventListener("click",r,!0):(document.body.removeEventListener("touchstart",r,!0),document.body.removeEventListener("mousedown",r,!0))};lT()?document.body.addEventListener("click",r,!0):(document.body.addEventListener("touchstart",r,!0),document.body.addEventListener("mousedown",r,!0)),U8()}}const Nz=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class Dz extends yx{constructor(r){super(r),Pe(this,"container",void 0),Pe(this,"slot",void 0),this.slot=r.element,this.updateConfig(r)}updateConfig(r){this.config=r,this.trackId=r.trackId;const o=r.element;o!==this.slot&&(this.destroy(),this.slot=o),this.createElements()}updateVideoTrack(r){this.videoTrack!==r&&(this.videoTrack=r,this.createElements())}play(r){var o;(o=this.container)!==null&&o!==void 0&&o.contains(this.videoElement)&&super.play(r)}getCurrentFrame(){var r;return(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(r){var o;let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(o=this.container)!==null&&o!==void 0&&o.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(r,s):await Ex(r)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",re("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var r;!this.container||(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var r;if((r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var r;(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var Lz,xz,Mz,Uz,Vz,Fz,jz,Bz,Wz,zz,Gz,Hz,$z,Kz,qz,Yz,Xz,Jz,Qz,Zz,eG,tG,nG,rG,bn,iG,oG,sG,aG,cG,lG,uG,dG,jc;let mr=(Lz=Mt({argsMap:(e,r,o)=>[e.getTrackId(),typeof r=="string"?r:r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",o]}),xz=Jr(),Mz=Mt({argsMap:e=>[e.getTrackId()]}),Uz=Iv("LocalVideoTrack","_enabledMutex"),Vz=Mt({argsMap:(e,r)=>[e.getTrackId(),r]}),Fz=Jr(),jz=Iv("LocalVideoTrack","_enabledMutex"),Bz=Mt({argsMap:(e,r)=>[e.getTrackId(),r]}),Wz=Jr(),zz=Mt({argsMap:(e,r)=>[e.getTrackId(),r]}),Gz=Jr(),Hz=Jr(),$z=Mt({argsMap:(e,r,o)=>[e.getTrackId(),r,o]}),Kz=Jr(),qz=Jr(),Yz=Jr(),Xz=Jr(),Jz=Jr(),Qz=Jr(),Zz=Jr(),eG=Mt({argsMap:(e,r)=>[e.getTrackId(),r.name]}),tG=Mt({argsMap:e=>[e.getTrackId()]}),nG=Mt({argsMap:e=>[e.getTrackId()]}),rG=Mt({argsMap:(e,r,o)=>[e.getTrackId(),r.label,o]}),bn=class Hoe extends Mv{get videoHeight(){if(vo()){const{height:r}=this._mediaStreamTrack.getSettings();return this._videoHeight=r,this._videoHeight}return this._videoHeight}get videoWidth(){if(vo()){const{width:r}=this._mediaStreamTrack.getSettings();return this._videoWidth=r,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==ts.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(r){this._processorContext=r}get __className__(){return"LocalVideoTrack"}constructor(r,o,s,c,u,h){if(super(r,u),Pe(this,"trackMediaType",xv.VIDEO),Pe(this,"_player",void 0),Pe(this,"isUseScaleResolutionDownBy",!1),Pe(this,"_videoVisibleTimer",null),Pe(this,"_previousVideoVisibleStatus",void 0),Pe(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),Pe(this,"_encoderConfig",void 0),Pe(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),Pe(this,"_optimizationMode",void 0),Pe(this,"_videoHeight",void 0),Pe(this,"_videoWidth",void 0),Pe(this,"_forceBitrateLimit",void 0),Pe(this,"_enabled",!0),Pe(this,"_processorDestination",void 0),Pe(this,"_processorContext",void 0),vo()){const{width:m,height:_}=r.getSettings();this._videoWidth=m,this._videoHeight=_}else this.updateMediaStreamTrackResolution();if(this._encoderConfig=o,this._scalabilityMode=s,this._optimizationMode=c,this._hints=h||[],this._hints.indexOf(ar.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(ML(Mn.CHROME,115)&&PA().indexOf("Windows")!==-1){const m=function(_,y){if("VideoFrame"in window&&"TransformStream"in window&&kn().supportWebRTCInsertableStream){const S=new MediaStreamTrackProcessor(_),R=new MediaStreamTrackGenerator({kind:"video"});let P,k,z=Date.now();const U=()=>{V&&(clearInterval(V),V=void 0),P&&(P.close(),P=void 0),_.stop(),k=void 0,R.removeEventListener("ended",U)};let V=window.setInterval(()=>{if(k&&P&&Date.now()-z>1e3)try{R.readyState==="live"?k.enqueue(P.clone()):U()}catch{U()}},1e3);const q=new TransformStream({transform:(Y,ce)=>{R.readyState==="live"?(k=ce,z=Date.now(),P===void 0?(P=Y,ce.enqueue(Y.clone())):(ce.enqueue(P),P=Y)):Y.close()}});return R.addEventListener("ended",U),S.readable.pipeThrough(q).pipeTo(R.writable),R}}(r);m&&(D.info("local screen video track begin to inject frame"),this._mediaStreamTrack=m)}o&&this._hints.indexOf(ar.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(o),this._processorContext=new j8(this.getTrackId(),"local"),this._processorDestination=new F8(this.processorContext),this.bindProcessorDestinationEvents()}play(r){let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof r=="string"){const c=document.getElementById(r);c?r=c:(D.warning("[".concat(this.getTrackId(),'] can not find "#').concat(r,'" element, use document.body')),r=document.body)}D.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(o));const s=Rr(Rr(Rr({},this._getDefaultPlayerConfig()),o),{},{trackId:this.getTrackId(),element:r});this._player?this._player.updateConfig(s):(r instanceof HTMLVideoElement?this._player=new yx(s):this._player=new Dz(s),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const c=this.getVideoElementVisibleStatus();this.safeEmit(Dv.VIDEO_ELEMENT_VISIBLE_STATUS,c)}catch{}},re("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,D.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(r,o){if(!o){if(r===this._enabled)return;this.stateCheck("enabled",r)}if(D.info("[".concat(this.getTrackId(),"] start setEnabled"),r),!r){this._originMediaStreamTrack.enabled=!1;try{await or(this,Et.NEED_DISABLE_TRACK,this)}catch(s){throw D.error("[".concat(this.getTrackId(),"] setEnabled to false error"),s.toString()),s}return o||(this._enabled=!1),void D.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await or(this,Et.NEED_ENABLE_TRACK,this)}catch(s){throw D.error("[".concat(this.getTrackId(),"] setEnabled to true error"),s.toString()),s}D.info("[".concat(this.getTrackId(),"] setEnabled to true success")),o||(this._enabled=!0)}async setMuted(r){r!==this._muted&&(this.stateCheck("muted",r),this._muted=r,this._originMediaStreamTrack.enabled=!r,D.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(r)),r?await or(this,Et.NEED_MUTE_TRACK,this):await or(this,Et.NEED_UNMUTE_TRACK,this))}async setEncoderConfiguration(r,o){if(!this._enabled)throw new Le(X.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(r=mh(r),this._forceBitrateLimit&&(r.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:r.bitrateMax,r.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:r.bitrateMin),r.width||r.height||r.frameRate){const s=HA({encoderConfig:r});(vo()||ys()||au())&&(s.deviceId=void 0),D.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(r),JSON.stringify(s));try{await this._originMediaStreamTrack.applyConstraints(s),this.updateMediaStreamTrackResolution()}catch(c){const u=new Le(X.UNEXPECTED_ERROR,c.toString());throw D.error("[".concat(this.getTrackId(),"] applyConstraints error"),u.toString()),u}}this._encoderConfig=r,this._hints.indexOf(ar.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await or(this,Et.NEED_UPDATE_VIDEO_ENCODER,this)}catch(s){return s.throw(D)}}getStats(){return Rm(()=>{D.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),kc(this,Et.GET_STATS)||Rr({},dx)}async setBeautyEffect(r){D.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(r){let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(r,o):await Ex(r)}async setBitrateLimit(r){D.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(r))),r&&(this._forceBitrateLimit=r,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<r.max_bitrate?this._encoderConfig.bitrateMax:r.max_bitrate:this._encoderConfig.bitrateMax=r.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=r.min_bitrate))}async setOptimizationMode(r){if(r!=="motion"&&r!=="detail"&&r!=="balanced")return void D.error(X.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const o=this._optimizationMode;try{this._optimizationMode=r,await or(this,Et.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(s){throw this._optimizationMode=o,D.error("[".concat(this.getTrackId(),"] set optimization mode failed"),s.toString()),s}D.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(r,")"))}setScalabiltyMode(r){if(r.numSpatialLayers===1&&r.numTemporalLayers!==1)return D.error(X.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=r,D.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(r,")"))}updateMediaStreamTrackResolution(){z8(this._originMediaStreamTrack).then(r=>{let[o,s]=r;this._videoHeight=s,this._videoWidth=o}).catch(LA)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(r){if(!this._enabled)throw new Le(X.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");D.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(r)),r=mh(r),this._forceBitrateLimit&&(r.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:r.bitrateMax,r.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:r.bitrateMin),this._encoderConfig=r,this._hints.indexOf(ar.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await or(this,Et.NEED_UPDATE_VIDEO_ENCODER,this)}catch(o){return o.throw(D)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:r,height:o,frameRate:s}=this.getMediaStreamTrackSettings();if(!r||!o||!s)return;const{bitrateMax:c,bitrateMin:u}=this._encoderConfig;if(u==null||c==null){const{max:h,min:m}=function(_,y,S,R,P){const k=re("BITRATE_ADAPTER_TYPE");if(k==="DEFAULT_BITRATE")return{min:R,max:P};if(P===void 0){var z;const V=Math.floor(200*Math.pow(S/15,.6)*Math.pow(_*y/640/360,.75));P=k==="STANDARD_BITRATE"?4*V:2*V,R=(z=R)!==null&&z!==void 0?z:V}else{var U;R=(U=R)!==null&&U!==void 0?U:Math.floor(P/10)}return{min:R,max:P}}(r,o,s,u,c);this._encoderConfig.bitrateMin=m,this._encoderConfig.bitrateMax=h,D.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(r,", h: ").concat(o,", fps: ").concat(s,"] => [brMax: ").concat(h,", brMin: ").concat(m,"]"))}}getVideoElementVisibleStatus(){try{var r,o;const s=this==null||(r=this._player)===null||r===void 0?void 0:r.getContainerElement(),c={track:this,element:this==null||(o=this._player)===null||o===void 0?void 0:o.getVideoElement(),slot:s==null?void 0:s.parentElement},{element:u,slot:h}=c;if(this.isPlaying&&u instanceof HTMLVideoElement&&h instanceof HTMLElement){const m=GW.checkOneElementVisible(u),_=Object.assign({},m);if(_.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=_.visible;const y=wt.reportApiInvoke(null,{tag:xr.TRACER,name:_i.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});_.visible?y.onSuccess("Video is visible"):y.onSuccess("Invisible because of ".concat(_.reason))}return _}return}catch(s){throw new Le(X.GET_VIDEO_ELEMENT_VISIBLE_ERROR,s.message)}}async renewMediaStreamTrack(r){}pipe(r){if(this.processor===r)return r;if(r._source)throw new Le(X.INVALID_OPERATION,"Processor ".concat(r.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=r,this.processor._source=this,r.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),r}unpipe(){if(!this.processor)return;const r=this.processor;this.processor._source=void 0,this.processor=void 0,r.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(r){let o=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],s=this._encoderConfig;r&&(s=Rr(Rr({},s),mh(r))),s=C_(s);const c=sr(8,"track-video-cloned-"),u=new Hoe(o?this._mediaStreamTrack.clone():this._mediaStreamTrack,s,C_(this._scalabilityMode),this._optimizationMode,c,C_(this._hints));return r&&s&&u.setEncoderConfiguration(s),D.debug("clone video track from ".concat(this.getTrackId()," to ").concat(c,", clone ").concat(o)),u}async replaceTrack(r,o){if(!(r instanceof MediaStreamTrack))throw new Le(X.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(r.kind!=="video")throw new Le(X.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(r,o,!0),this.updateMediaStreamTrackResolution()}sendSeiData(r){if(Rm(()=>{wt.reportApiInvoke(null,{name:_i.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:xr.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!re("ENABLE_VIDEO_SEI")||!re("ENABLE_ENCODED_TRANSFORM"))return void D.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(r instanceof Uint8Array==0)return new Le(X.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const o=this.getRTCRtpTransceiver();if(!o)return void D.warning("Video track is not published, SEI can not be send");const s=o.sender.getParameters();if(s.codecs.length===0)return;const c=s.codecs[0].mimeType.toLocaleLowerCase();c==="video/h264"?this.safeEmit("sei-to-send",r):D.warning("SEI is not supported by ".concat(c))}bindProcessorDestinationEvents(){this.processorDestination.on(vs.ON_TRACK,async r=>{r?r!==this._mediaStreamTrack&&(this._mediaStreamTrack=r,this._updatePlayerSource(),await or(this,Et.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await or(this,Et.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(vs.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(xc.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(xc.REQUEST_CONSTRAINTS)}},In(bn.prototype,"play",[Lz,xz],Object.getOwnPropertyDescriptor(bn.prototype,"play"),bn.prototype),In(bn.prototype,"stop",[Mz],Object.getOwnPropertyDescriptor(bn.prototype,"stop"),bn.prototype),In(bn.prototype,"setEnabled",[Uz,Vz,Fz],Object.getOwnPropertyDescriptor(bn.prototype,"setEnabled"),bn.prototype),In(bn.prototype,"setMuted",[jz,Bz,Wz],Object.getOwnPropertyDescriptor(bn.prototype,"setMuted"),bn.prototype),In(bn.prototype,"setEncoderConfiguration",[zz,Gz],Object.getOwnPropertyDescriptor(bn.prototype,"setEncoderConfiguration"),bn.prototype),In(bn.prototype,"getStats",[Hz],Object.getOwnPropertyDescriptor(bn.prototype,"getStats"),bn.prototype),In(bn.prototype,"setBeautyEffect",[$z,Kz],Object.getOwnPropertyDescriptor(bn.prototype,"setBeautyEffect"),bn.prototype),In(bn.prototype,"getCurrentFrameData",[qz],Object.getOwnPropertyDescriptor(bn.prototype,"getCurrentFrameData"),bn.prototype),In(bn.prototype,"getCurrentFrameImage",[Yz],Object.getOwnPropertyDescriptor(bn.prototype,"getCurrentFrameImage"),bn.prototype),In(bn.prototype,"setBitrateLimit",[Xz],Object.getOwnPropertyDescriptor(bn.prototype,"setBitrateLimit"),bn.prototype),In(bn.prototype,"setOptimizationMode",[Jz],Object.getOwnPropertyDescriptor(bn.prototype,"setOptimizationMode"),bn.prototype),In(bn.prototype,"setScalabiltyMode",[Qz],Object.getOwnPropertyDescriptor(bn.prototype,"setScalabiltyMode"),bn.prototype),In(bn.prototype,"updateMediaStreamTrackResolution",[Zz],Object.getOwnPropertyDescriptor(bn.prototype,"updateMediaStreamTrackResolution"),bn.prototype),In(bn.prototype,"pipe",[eG],Object.getOwnPropertyDescriptor(bn.prototype,"pipe"),bn.prototype),In(bn.prototype,"unpipe",[tG],Object.getOwnPropertyDescriptor(bn.prototype,"unpipe"),bn.prototype),In(bn.prototype,"close",[nG],Object.getOwnPropertyDescriptor(bn.prototype,"close"),bn.prototype),In(bn.prototype,"replaceTrack",[rG],Object.getOwnPropertyDescriptor(bn.prototype,"replaceTrack"),bn.prototype),bn),vx=(iG=Mt({argsMap:(e,r)=>[e.getTrackId(),r]}),oG=Jr(),sG=Iv("CameraVideoTrack","_enabledMutex"),aG=Mt({argsMap:(e,r)=>[e.getTrackId(),r]}),cG=Jr(),lG=Mt({argsMap:(e,r)=>[e.getTrackId(),r]}),uG=Jr(),dG=Mt({argsMap:e=>[e.getTrackId()]}),jc=class $oe extends mr{get __className__(){return"CameraVideoTrack"}constructor(r,o,s,c,u,h){super(r,mh(o.encoderConfig),c,u,h),Pe(this,"_config",void 0),Pe(this,"_originalConstraints",void 0),Pe(this,"_constraints",void 0),Pe(this,"_enabled",!0),Pe(this,"_deviceName","default"),Pe(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(wv()||FL())&&!function(){const m=Rn();if(m.os!==Fi.IOS||!m.osVersion)return!1;const _=m.osVersion.split(".");return Number(_[0])===15&&Number(_[1])>=2}()&&jW()&&this._enabled&&!this._isClosed&&(D.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=o,this._originalConstraints=s,this._constraints=s,this._deviceName=r.label,this._encoderConfig=mh(this._config.encoderConfig),Jn.on(so.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Jn.on(so.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(r){return typeof r=="string"?this._setDeviceById(r):r.deviceId?this._setDeviceById(r.deviceId):r.facingMode?this._setDeviceByFacingModel(r.facingMode):void 0}async _setDeviceById(r){if(D.info("[".concat(this.getTrackId(),"] set device to ").concat(r)),this._enabled)try{const o=await Vc.getDeviceById(r),s={};s.video=Rr({},this._constraints),s.video.deviceId={exact:r},s.video.facingMode=void 0,this._originMediaStreamTrack.stop();let c=null;try{c=await Uc(s,this.getTrackId())}catch(u){throw D.error("[".concat(this.getTrackId(),"] setDevice failed"),u.toString()),c=await Uc({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1),u}await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=o.label,this._config.cameraId=r,this._constraints.deviceId={exact:r}}catch(o){throw D.error("[".concat(this.getTrackId(),"] setDevice error"),o.toString()),o}else try{const o=await Vc.getDeviceById(r);this._deviceName=o.label,this._config.cameraId=r,this._constraints.deviceId={exact:r}}catch(o){throw D.error("[".concat(this.getTrackId(),"] setDevice error"),o.toString()),o}D.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(r){D.info("[".concat(this.getTrackId(),"] set facingMode ").concat(r));const o={video:Rr(Rr({},this._constraints),{},{deviceId:void 0,facingMode:{exact:r}})};if(this._enabled){this._originMediaStreamTrack.stop();let s=null;try{s=await Uc(o,this.getTrackId())}catch(c){throw D.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),c.toString()),s=await Uc({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(s.getVideoTracks()[0],!1),c}await this._updateOriginMediaStreamTrack(s.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=r,this._config.cameraId=void 0,this._constraints=Rr({},o.video),D.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(r,o){if(!o){if(r===this._enabled)return;this.stateCheck("enabled",r)}if(D.info("[".concat(this.getTrackId(),"] start setEnabled"),r),r){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const s=await Uc({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(s.getVideoTracks()[0],!1)}await or(this,Et.NEED_ENABLE_TRACK,this)}catch(s){throw D.error("[".concat(this.getTrackId(),"] setEnabled true error"),s.toString()),s}this.updateMediaStreamTrackResolution(),D.info("[".concat(this.getTrackId(),"] setEnabled to true success")),o||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),o||(this._enabled=!1);try{await or(this,Et.NEED_DISABLE_TRACK,this)}catch(s){throw D.error("[".concat(this.getTrackId(),"] setEnabled to false error"),s.toString()),s}D.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(r,o){if(!this._enabled)throw new Le(X.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");r=mh(r),this._forceBitrateLimit&&(r.bitrateMax=this._forceBitrateLimit.max_bitrate||r.bitrateMax,r.bitrateMin=this._forceBitrateLimit.min_bitrate||r.bitrateMin);const s=Mr(this._config);s.encoderConfig=r;const c=HA(s);(vo()||ys()||au())&&(c.deviceId=void 0),D.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(r),JSON.stringify(c));try{await this._originMediaStreamTrack.applyConstraints(c),this.updateMediaStreamTrackResolution()}catch(u){const h=new Le(X.UNEXPECTED_ERROR,u.toString());throw D.error("[".concat(this.getTrackId(),"] applyConstraints error"),h.toString()),h}this._config=s,this._constraints=c,this._originalConstraints=c,this._encoderConfig=r,this._hints.indexOf(ar.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await or(this,Et.NEED_UPDATE_VIDEO_ENCODER,this)}catch(u){return u.throw(D)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((ys()||au())&&this._enabled&&!this._isClosed&&Jn.duringInterruption){const r=async()=>{Jn.off(so.IOS_INTERRUPTION_END,r),this._enabled&&!this._isClosed&&(D.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Jn.on(so.IOS_INTERRUPTION_END,r)}else D.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Dv.TRACK_ENDED)}async renewMediaStreamTrack(r){const o=r||this._constraints,s=Vc.searchDeviceIdByName(this._deviceName);if(s&&!o.deviceId&&(o.deviceId={exact:s}),this._enabled){const c=await Uc({video:o},this.getTrackId());this._constraints=o,await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),Jn.off(so.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Jn.off(so.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(r){let o=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],s=this._encoderConfig;r&&(s=Rr(Rr({},s),mh(r))),s=C_(s);const c=sr(8,"track-cam-cloned-"),u=new $oe(o?this._mediaStreamTrack.clone():this._mediaStreamTrack,C_(Rr(Rr({},this._config),{},{encoderConfig:s})),C_(this._constraints),C_(this._scalabilityMode),this._optimizationMode,c);return r&&s&&u.setEncoderConfiguration(s),D.debug("clone track from ".concat(this.getTrackId()," to ").concat(c,", clone ").concat(o)),u}bindProcessorContextEvents(){this.processorContext.on(xc.REQUEST_UPDATE_CONSTRAINTS,async(r,o,s)=>{try{const c=Object.assign({},this._originalConstraints,...r);await this.renewMediaStreamTrack(c),o()}catch(c){s(c)}}),this.processorContext.on(xc.REQUEST_CONSTRAINTS,async r=>{r(this._originMediaStreamTrack.getSettings())})}},In(jc.prototype,"setDevice",[iG,oG],Object.getOwnPropertyDescriptor(jc.prototype,"setDevice"),jc.prototype),In(jc.prototype,"setEnabled",[sG,aG,cG],Object.getOwnPropertyDescriptor(jc.prototype,"setEnabled"),jc.prototype),In(jc.prototype,"setEncoderConfiguration",[lG,uG],Object.getOwnPropertyDescriptor(jc.prototype,"setEncoderConfiguration"),jc.prototype),In(jc.prototype,"close",[dG],Object.getOwnPropertyDescriptor(jc.prototype,"close"),jc.prototype),jc);function Sx(e,r,o,s){o.optimizationMode&&(s&&s.width&&s.height?(o.encoderConfig=Rr(Rr({},s),{},{bitrateMin:s.bitrateMin,bitrateMax:s.bitrateMax}),o.optimizationMode!=="motion"&&o.optimizationMode!=="detail"||(r.contentHint=o.optimizationMode,r.contentHint===o.optimizationMode?D.debug("[".concat(e,"] set content hint to"),o.optimizationMode):D.debug("[".concat(e,"] set content hint failed")))):D.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}var hG,fG,pG,mG,El,gG,_G,EG,yG,vG,SG,ns;class bG extends A8{getUserId(){return this._userId}constructor(r,o,s,c){super(r,"track-".concat(r.kind,"-").concat(o,"-").concat(c.clientId,"_").concat(sr(5,""))),Pe(this,"_userId",void 0),Pe(this,"_uintId",void 0),Pe(this,"_isDestroyed",!1),Pe(this,"store",void 0),Pe(this,"processor",void 0),Pe(this,"processorContext",void 0),this._userId=o,this._uintId=s,this.store=c}_updateOriginMediaStreamTrack(r){this._originMediaStreamTrack=r,this._mediaStreamTrack=r,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,D.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let Fv=(hG=Mt({argsMap:(e,r,o)=>[e.getTrackId(),typeof r=="string"?r:r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",o]}),fG=Mt({argsMap:e=>[e.getTrackId()]}),pG=Mt({argsMap:(e,r)=>[e.getTrackId(),r.name]}),mG=Mt({argsMap:e=>[e.getTrackId()]}),In((El=class extends bG{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==ts.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(e,r,o,s){super(e,r,o,s),Pe(this,"_videoVisibleTimer",null),Pe(this,"_previousVideoVisibleStatus",void 0),Pe(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),Pe(this,"trackMediaType",xv.VIDEO),Pe(this,"_videoWidth",void 0),Pe(this,"_videoHeight",void 0),Pe(this,"_player",void 0),Pe(this,"processorDestination",void 0),Pe(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new j8(this.getTrackId(),"remote"),this.processorDestination=new F8(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return Rm(()=>{D.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),kc(this,Et.GET_STATS)||Rr({},C8)}play(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof e=="string"){const s=document.getElementById(e);s?e=s:(D.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}D.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(r));const o=Rr(Rr({fit:"cover"},r),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(o):(e instanceof HTMLVideoElement?this._player=new yx(o):this._player=new Dz(o),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(Lv.FIRST_FRAME_DECODED)},this._player.onVideoStateChanged=s=>{this.safeEmit(Lv.VIDEO_STATE_CHANGED,s)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const s=this.getVideoElementVisibleStatus();this.safeEmit(Lv.VIDEO_ELEMENT_VISIBLE_STATUS,s)}catch{}},re("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,D.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){z8(this._originMediaStreamTrack).then(e=>{let[r,o]=e;this._videoHeight=o,this._videoWidth=r}).catch(LA)}_updatePlayerSource(){D.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var e,r;const o=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),s={track:this,element:this==null||(r=this._player)===null||r===void 0?void 0:r.getVideoElement(),slot:o==null?void 0:o.parentElement},{element:c,slot:u}=s;if(this.isPlaying&&c instanceof HTMLVideoElement&&u instanceof HTMLElement){const h=GW.checkOneElementVisible(c),m=Object.assign({},h);if(m.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=m.visible;const _=wt.reportApiInvoke(null,{tag:xr.TRACER,name:_i.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});m.visible?_.onSuccess("Video is visible"):_.onSuccess("Invisible because of ".concat(m.reason))}return m}return}catch(o){throw new Le(X.GET_VIDEO_ELEMENT_VISIBLE_ERROR,o.message)}}pipe(e){if(this.processor===e)return e;if(e._source)throw new Le(X.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(vs.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(vs.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(e){this.emit(O_.SEI_RECEIVED,e)}}).prototype,"play",[hG],Object.getOwnPropertyDescriptor(El.prototype,"play"),El.prototype),In(El.prototype,"stop",[fG],Object.getOwnPropertyDescriptor(El.prototype,"stop"),El.prototype),In(El.prototype,"pipe",[pG],Object.getOwnPropertyDescriptor(El.prototype,"pipe"),El.prototype),In(El.prototype,"unpipe",[mG],Object.getOwnPropertyDescriptor(El.prototype,"unpipe"),El.prototype),El),jv=(gG=Mt({argsMap:(e,r)=>[e.getTrackId(),r],throttleTime:300}),_G=Mt({argsMap:(e,r)=>[e.getTrackId(),r]}),EG=Mt({argsMap:e=>[e.getTrackId()]}),yG=Mt({argsMap:e=>[e.getTrackId()]}),vG=Mt({argsMap:(e,r)=>[e.getTrackId(),r.name]}),SG=Mt({argsMap:e=>[e.getTrackId()]}),In((ns=class extends bG{get isPlaying(){return this._useAudioElement?$s.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(e,r,o,s){super(e,r,o,s),Pe(this,"trackMediaType",xv.AUDIO),Pe(this,"_source",void 0),Pe(this,"_useAudioElement",!0),Pe(this,"_volume",100),Pe(this,"processorContext",void 0),Pe(this,"processorDestination",void 0),Pe(this,"_played",!1),Pe(this,"_bypassWebAudio",!1),re("DISABLE_WEBAUDIO")?(this._source=new _x,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new N8(e,!0),re("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(Lc.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(Lv.FIRST_FRAME_DECODED)}),this.processorContext=new W8(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new B8(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(Lc.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(Lc.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(r),this._source.removeAllListeners(Lc.ON_AUDIO_BUFFER),this._source.on(Lc.ON_AUDIO_BUFFER,o=>e(o))}setVolume(e){this._volume=e,this._useAudioElement?$s.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)}async setPlaybackDevice(e){if(!this._useAudioElement||!b8())throw new Le(X.NOT_SUPPORTED,"your browser does not support setting the audio output device");await $s.setSinkID(this.getTrackId(),e)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return Rm(()=>{D.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),kc(this,Et.GET_STATS)||Rr({},R8)}play(){D.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(D.debug("[".concat(this.getTrackId(),"] use audio element to play")),$s.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){D.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?$s.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];D.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&$s.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(e){if(this._bypassWebAudio)throw new Le(X.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new Le(X.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(this._bypassWebAudio)throw new Le(X.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const r=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,r.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(vs.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(vs.ON_NODE,e=>{this._source.processedNode=e;const r=!e;this._useAudioElement!==r&&(this._played?(this.stop(),this._useAudioElement=r,this.play()):this._useAudioElement=r)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(vs.ON_TRACK),this.processorDestination.removeAllListeners(vs.ON_NODE)}}).prototype,"setVolume",[gG],Object.getOwnPropertyDescriptor(ns.prototype,"setVolume"),ns.prototype),In(ns.prototype,"setPlaybackDevice",[_G],Object.getOwnPropertyDescriptor(ns.prototype,"setPlaybackDevice"),ns.prototype),In(ns.prototype,"play",[EG],Object.getOwnPropertyDescriptor(ns.prototype,"play"),ns.prototype),In(ns.prototype,"stop",[yG],Object.getOwnPropertyDescriptor(ns.prototype,"stop"),ns.prototype),In(ns.prototype,"pipe",[vG],Object.getOwnPropertyDescriptor(ns.prototype,"pipe"),ns.prototype),In(ns.prototype,"unpipe",[SG],Object.getOwnPropertyDescriptor(ns.prototype,"unpipe"),ns.prototype),ns);const $f=new class extends Pr{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),Pe(this,"_lastHiddenTime",0),Pe(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),D.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};class TG extends Pr{constructor(r,o){super(),Pe(this,"trackMediaType",xv.DATA),Pe(this,"_version",1),Pe(this,"_type",3),Pe(this,"_config",void 0),Pe(this,"_originDataChannel",void 0),Pe(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),Pe(this,"_dataStreamPacketHandler",{serialize:s=>s,deserialize:s=>s}),Pe(this,"_datachannelEventMap",new Map),this._config=r,o&&(this._originDataChannel=o,this._bandDataChannelEvents(o)),this._initPacketHeader()}useDataStream(r){this._dataStreamPacketHandler=r}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return re("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var r,o;return(r=(o=this._originDataChannel)===null||o===void 0?void 0:o.readyState)!==null&&r!==void 0?r:"connecting"}get _originDataChannelId(){var r,o;return(r=(o=this._originDataChannel)===null||o===void 0?void 0:o.id)!==null&&r!==void 0?r:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new lt((r,o)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&r();const s=setTimeout(()=>{var c;o(new Le(X.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((c=this._originDataChannel)===null||c===void 0?void 0:c.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(s),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),r()},this._originDataChannel.onerror=()=>{throw clearTimeout(s),new Le(X.DATACHANNEL_CONNECTION_TIMEOUT)}}else o(new Le(X.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(r){this._originDataChannel=r,this._bandDataChannelEvents(r)}_initPacketHeader(){const r=new DataView(this._dataStreamPacketHeader);r.setUint16(0,this._version),r.setUint8(2,this._type),r.setUint8(3,this._config.id)}_bandDataChannelEvents(r){this._unbindDataChannelEvents(r),[zA.OPEN,zA.CLOSE,zA.ERROR].forEach(o=>{const s=()=>{this.emit(o)};this._datachannelEventMap.set(o,s),r.addEventListener(o,s)})}_unbindDataChannelEvents(r){Array.from(this._datachannelEventMap.entries()).forEach(o=>{let[s,c]=o;r.removeEventListener(s,c)}),this._datachannelEventMap.clear()}}class upe extends TG{constructor(r){super(r),Pe(this,"_messageListener",void 0),this._messageListener=o=>{if(o.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const s=o.data.slice(0,this._dataStreamPacketHeader.byteLength),c=new DataView(s).getUint8(3);if(c!==this.id)return void(re("SHOW_DATASTREAM2_LOG")&&D.debug("invalid datachannel id: ".concat(c," !== ").concat(this.id)));let u=o.data.slice(this._dataStreamPacketHeader.byteLength);u=this._dataStreamPacketHandler.deserialize(u),this.emit(zA.MESSAGE,u)}}_updateOriginDataChannel(r){super._updateOriginDataChannel(r),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class dpe extends TG{send(r){if(this._originDataChannel){let o=r;o=this._dataStreamPacketHandler.serialize(r);const s=new Uint8Array(this._dataStreamPacketHeader.byteLength+o.byteLength);s.set(new Uint8Array(this._dataStreamPacketHeader),0),s.set(new Uint8Array(o),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(s.buffer)}}}function KA(){const e=new Blob([atob("ZnVuY3Rpb24gdCh0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLG89W10scj0wO2Zvcig7by5sZW5ndGg8bjspciszPG4mJjA9PT1hW3JdJiYwPT09YVtyKzFdJiYzPT09YVtyKzJdJiYoMD09PWFbciszXXx8MT09PWFbciszXXx8Mj09PWFbciszXXx8Mz09PWFbciszXSk/KG8ucHVzaChhW3JdLGFbcisxXSxhW3IrM10pLHIrPTQpOihvLnB1c2goYVtyXSkscisrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobyl9ZnVuY3Rpb24gZSh0LGUpe2NvbnN0IG49ZnVuY3Rpb24odCl7Y29uc3QgZT10Lmxlbmd0aDtsZXQgbj1bXSxhPTA7Zm9yKDthPGU7KWErMjxlJiYwPT09dFthXSYmMD09PXRbYSsxXSYmKDA9PT10W2ErMl18fDE9PT10W2ErMl18fDI9PT10W2ErMl18fDM9PT10W2ErMl0pPyhuLnB1c2godFthXSx0W2ErMV0sMyx0W2ErMl0pLGErPTMpOihuLnB1c2godFthXSksYSsrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobil9KGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxyPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNitvKzErYSt0LmJ5dGVMZW5ndGgpO3NbMF09MCxzWzFdPTAsc1syXT0wLHNbM109MSxzWzRdPTYsc1s1XT0xMDE7bGV0IGk9MDtmb3IoO2k8bzspc1s2K2ldPTI1NSxpKys7cmV0dXJuIHNbNitpXT1yLGkrKyxzLnNldChuLDYraSkscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNitpK2EpLHMuYnVmZmVyfWNvbnN0IG49NzEsYT0xLG89MixyPTEscz0yO3ZhciBpOyFmdW5jdGlvbih0KXt0W3QuQVVESU9fTEVWRUw9MV09IkFVRElPX0xFVkVMIix0W3QuTUVUQURBVEE9Ml09Ik1FVEFEQVRBIix0W3QuQVVESU9fNjRfQklUX1BUUz0zXT0iQVVESU9fNjRfQklUX1BUUyJ9KGl8fChpPXt9KSk7bmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJTYWZhcmkiKT4tMSYmLTE9PT1uYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoIkNocm9tZSIpJiYoc2VsZi5vbnJ0Y3RyYW5zZm9ybT1mPT57Y29uc3QgdT1mLnRyYW5zZm9ybWVyO2xldCBkPVtdLGw9W107dS5vcHRpb25zLnBvcnQub25tZXNzYWdlPXQ9Pnt0LmRhdGEuc2VpJiZkLnB1c2godC5kYXRhLnNlaSksdC5kYXRhLm1ldGFkYXRhJiZsLnB1c2godC5kYXRhLm1ldGFkYXRhKX0sc2VsZi5wb3N0TWVzc2FnZSgic3RhcnRlZCIpO2NvbnN0IGc9dS5yZWFkYWJsZS5nZXRSZWFkZXIoKSxjPXUud3JpdGFibGUuZ2V0V3JpdGVyKCk7InNlaS1yeCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiBlKG4pe2cucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IGU9ZnVuY3Rpb24oZSl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcoZS5kYXRhKTtsZXQgYT0wO2Zvcig7YSs0PGUuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PW4uZ2V0VWludDgoYSswKSYmMD09PW4uZ2V0VWludDgoYSsxKSYmMD09PW4uZ2V0VWludDgoYSsyKSYmMT09PW4uZ2V0VWludDgoYSszKSYmNj09PW4uZ2V0VWludDgoYSs0KSl7bGV0IG89YSs2LHI9MCxzPTA7Zm9yKDsyNTU9PT0ocz1uLmdldFVpbnQ4KG8rKykpOylyKz0yNTU7cis9cztjb25zdCBpPXQoZS5kYXRhLG8scik7cmV0dXJuIG5ldyBVaW50OEFycmF5KGkpfWErK31yZXR1cm4gbnVsbH0oYS52YWx1ZSk7ZSYmbi5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3NlaTplfSl9Yy53cml0ZShhLnZhbHVlKSxuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSxlKG4pfX0pKX0odSk6InNlaS10eCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KG4pe2cucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IHQ9ZC5zaGlmdCgpO3QmJihhLnZhbHVlLmRhdGE9ZShhLnZhbHVlLmRhdGEsdCkpfWMud3JpdGUoYS52YWx1ZSksbi5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3RyYW5zZm9ybWVkOiEwfSksdChuKX19KSl9KHUpOiJhdWRpby1tZXRhZGF0YS1yeCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KGUpe2cucmVhZCgpLnRoZW4oKGY9PntpZighZi5kb25lKXtpZihmLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZEF1ZGlvRnJhbWUpe2NvbnN0IHQ9ZnVuY3Rpb24odCxlPSExKXtjb25zdCBmPXQuZ2V0VWludDgoMCk7aWYoZiE9PW4pcmV0dXJuO2NvbnN0IHU9dC5nZXRVaW50MTYoMSksZD1hK28rdSxsPW5ldyBVaW50OEFycmF5KHQuYnl0ZUxlbmd0aC1kKTtsLnNldChuZXcgVWludDhBcnJheSh0LmJ1ZmZlcixkLHQuYnl0ZUxlbmd0aC1kKSk7Y29uc3QgZz17bTpmLHRsdkxlbjp1LHRsdjpbXSxmcmFtZTpsfTtsZXQgYz1hK287Zm9yKDtjPGQ7KXtjb25zdCBuPXQuZ2V0VWludDgoYyksYT10LmdldFVpbnQxNihjK3IpLG89citzO2lmKG49PT1pLkFVRElPX0xFVkVMKXtsZXQgcj10LmdldFVpbnQ4KGMrbyk7Zm9yKGxldCBlPTE7ZTxhO2UrKylyPXI8PDh8dC5nZXRVaW50OChjK28rZSk7Zy50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZT8xMjdecj4+MToxMjcmcn0pfWVsc2UgaWYobj09PWkuTUVUQURBVEF8fG49PT1pLkFVRElPXzY0X0JJVF9QVFMpe2NvbnN0IGU9bmV3IFVpbnQ4QXJyYXkoYSk7Zm9yKGxldCBuPTA7bjxhO24rKyllW25dPXQuZ2V0VWludDgoYytvK24pO2cudGx2LnB1c2goe3RhZzpuLGxlbmd0aDphLHZhbHVlOmV9KX1jKz1vK2F9cmV0dXJuIGd9KG5ldyBEYXRhVmlldyhmLnZhbHVlLmRhdGEpKTtpZih0KXtjb25zdCBuPXQudGx2LmZpbmQoKHQ9PnQudGFnPT09aS5NRVRBREFUQXx8dC50YWc9PT1pLkFVRElPXzY0X0JJVF9QVFMpKTtuJiZuLnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe21ldGFkYXRhOm4udmFsdWV9KSxmLnZhbHVlLmRhdGE9dC5mcmFtZS5idWZmZXJ9fWMud3JpdGUoZi52YWx1ZSksZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3RyYW5zZm9ybWVkOiEwfSksdChlKX19KSl9KHUpOiJhdWRpby1tZXRhZGF0YS10eCI9PT11Lm9wdGlvbnMubmFtZSYmZnVuY3Rpb24gdChlKXtnLnJlYWQoKS50aGVuKChmPT57aWYoIWYuZG9uZSl7aWYoZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe2dldE1ldGFkYXRhOiEwfSksZi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRBdWRpb0ZyYW1lKXtjb25zdCB0PWwuc2hpZnQoKTt0JiYoZi52YWx1ZS5kYXRhPWZ1bmN0aW9uKHQsZSxpKXtjb25zdCBmPWkuYnl0ZUxlbmd0aCx1PWYrcitzLGQ9YStvK3UsbD1uZXcgQXJyYXlCdWZmZXIodC5ieXRlTGVuZ3RoK2QpLGc9bmV3IERhdGFWaWV3KGwpO2cuc2V0VWludDgoMCxuKSxnLnNldFVpbnQxNigxLHUpLGcuc2V0VWludDgoMyxlKSxnLnNldFVpbnQxNig0LGYpO2ZvcihsZXQgdD0wO3Q8Zjt0KyspZy5zZXRVaW50OCg2K3QsaVt0XSk7Y29uc3QgYz1uZXcgVWludDhBcnJheShnLmJ1ZmZlcik7cmV0dXJuIGMuc2V0KG5ldyBVaW50OEFycmF5KHQpLGQpLGMuYnVmZmVyfShmLnZhbHVlLmRhdGEsaS5BVURJT182NF9CSVRfUFRTLHQpKX1jLndyaXRlKGYudmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfSh1KX0sc2VsZi5wb3N0TWVzc2FnZSgicmVnaXN0ZXJlZCIpKTsK")],{type:"text/javascript"});return setTimeout(()=>KI.revokeObjectURL(e),0),new Worker(KI.createObjectURL(e))}const wG=71,bx=1,Tx=2,wx=1,RG=2;var Kf=function(e){return e[e.AUDIO_LEVEL=1]="AUDIO_LEVEL",e[e.METADATA=2]="METADATA",e[e.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",e}(Kf||{});function CG(e){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const o=e.getUint8(0);if(o!==wG)return;const s=e.getUint16(1),c=bx+Tx+s,u=new Uint8Array(e.byteLength-c);u.set(new Uint8Array(e.buffer,c,e.byteLength-c));const h={m:o,tlvLen:s,tlv:[],frame:u};let m=bx+Tx;for(;m<c;){const _=e.getUint8(m),y=e.getUint16(m+wx),S=wx+RG;if(_===Kf.AUDIO_LEVEL){let R=e.getUint8(m+S);for(let P=1;P<y;P++)R=R<<8|e.getUint8(m+S+P);h.tlv.push({tag:_,length:y,value:r?127^R>>1:127&R})}else if(_===Kf.METADATA||_===Kf.AUDIO_64_BIT_PTS){const R=new Uint8Array(y);for(let P=0;P<y;P++)R[P]=e.getUint8(m+S+P);h.tlv.push({tag:_,length:y,value:R})}m+=S+y}return h}const qA=new Map,YA=127,D_=1e-10,Rx=139/13,XA=new Map;function Cx(e,r,o){const s="".concat(e,"-").concat(r,"-").concat(o);let c=0;return XA.has(s)?c=XA.get(s):(c=Math.log(function(h,m){const _=h-m;m<_&&(m=_);let y=1;for(let S=h,R=1;S>m;S--,R++)y=y*S/R;return y}(r,e))+e*Math.log(.5)+(r-e)*Math.log(1-.5)-Math.log(o)+o*e,XA.set(s,c)),c<D_&&(c=D_),c}function IG(e,r,o){const s=r.length,c=e.length/s;let u=!1;for(let h=0,m=0;h<s;h++){let _=0;for(let y=m+c;m<y;m++)e[m]>o&&_++;r[h]!==_&&(r[h]=_,u=!0)}return u}window.cache=XA;let hpe=0;class AG{constructor(r){Pe(this,"id",void 0),Pe(this,"immediates",[]),Pe(this,"lastNonSilence",-1),Pe(this,"immediateSpeechActivityScore",D_),Pe(this,"lastLevelChangedTime",Date.now()),Pe(this,"levels",[]),Pe(this,"longs",[]),Pe(this,"longSpeechActivityScore",D_),Pe(this,"mediums",[]),Pe(this,"mediumSpeechActivityScore",D_),Pe(this,"minLevel",0),Pe(this,"nextMinLevel",0),Pe(this,"nextMinLevelWindowLength",0),Pe(this,"energyScore",0),this.id=r||"".concat(hpe++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){const r=this.immediates,o=this.levels,s=this.minLevel+Rx;let c=!1;for(let u=0;u<r.length;++u){let h=o[u];h<s&&(h=0);const m=Math.floor(h/Rx);r[u]!==m&&(r[u]=m,c=!0)}return c}computeLongs(){return IG(this.mediums,this.longs,4)}computeMediums(){return IG(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=Cx(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(r){this.longSpeechActivityScore=Cx(this.longs[0],10,47),this.longSpeechActivityScore>D_&&(this.lastNonSilence=r)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=Cx(this.mediums[0],5,24)}evaluateSpeechActivityScores(r){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(r)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var r;return"[".concat(Qp(r=[...this.levels]).call(r).join(),"]")}getSpeechActivityScore(r){switch(r){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+r)}}levelChanged(r,o){if(this.lastLevelChangedTime<=o){this.lastLevelChangedTime=o;let s=r;return r<0&&(s=0),r>YA&&(s=YA),this.levels.unshift(s),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(s),s>=this.minLevel+Rx?s:s/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(r){if(r!==0){if(this.minLevel===0||this.minLevel>r)return this.minLevel=r,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(this.nextMinLevel===0)return this.nextMinLevel=r,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>r&&(this.nextMinLevel=r),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let o=Math.sqrt(this.minLevel*this.nextMinLevel);o<0?o=0:o>YA&&(o=YA),this.minLevel=o,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class fpe{constructor(r){Pe(this,"algorithm",void 0),this.algorithm=r}execute(){let r=!this.algorithm;if(!r)try{const o=this.algorithm.runInDecisionMaker(this);o<=0?r=!0:setTimeout(this.execute.bind(this),o)}catch{r=!0}r&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class Ix{constructor(r,o,s){Pe(this,"isDominant",void 0),Pe(this,"energyRanking",void 0),Pe(this,"energyScore",void 0),this.isDominant=r,this.energyRanking=o,this.energyScore=s}}class ppe extends Pr{constructor(r){super(),Pe(this,"dominantId",null),Pe(this,"lastDecisionTime",0),Pe(this,"lastLevelChangedTime",0),Pe(this,"lastLevelIdleTime",0),Pe(this,"relativeSpeechActivities",[]),Pe(this,"speakers",new Map),Pe(this,"enableSilence",!1),Pe(this,"timeoutToSilenceInterval",0),Pe(this,"decisionMaker",null),Pe(this,"loudest",[]),Pe(this,"numLoudestToTrack",3),Pe(this,"energyExpireTimeMs",250),Pe(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=r,this.enableSilence=r>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3,o=arguments.length>1?arguments[1]:void 0,s=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=r,o!=null&&(this.energyExpireTimeMs=o),s!=null&&(this.energyAlphaPct=s),this.loudest.length>r&&this.loudest.splice(r)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(r){return this.loudest.some(o=>o.id===r)}levelChanged(r,o){const s=Date.now(),c=this.getOrCreateSpeaker(r);this.lastLevelChangedTime<s&&(this.lastLevelChangedTime=s,this.maybeStartDecisionMaker());const u=c.levelChanged(o,s);return this.updateLoudestList(c,u,s)}runInDecisionMaker(r){return this.decisionMaker!==r||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(r){this.decisionMaker===r&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(r){r.forEach(o=>{this.speakers.has(o.id)||this.speakers.set(o.id,o)})}removeSpeakers(r){r.forEach(o=>{this.speakers.delete(o.id)})}getOrCreateSpeaker(r){let o=this.speakers.get(r);return o||(o=new AG(r),this.speakers.set(r,o),this.maybeStartDecisionMaker()),o}updateLoudestList(r,o,s){const c=r.id===this.dominantId;if(o<0){let _=0;for(;_<this.loudest.length&&this.loudest[_]!==r;)++_;return new Ix(c,_,r.energyScore)}if(r.energyScore=Math.floor((this.energyAlphaPct*o+(100-this.energyAlphaPct)*r.energyScore+50)/100),this.numLoudestToTrack===0)return new Ix(c,0,r.energyScore);const u=s-this.energyExpireTimeMs;let h=0;for(;h<this.loudest.length;){const _=this.loudest[h];if(_.getLastLevelChangedTime()<u&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(h,1);else if(_.id!==r.id)++h;else if(this.loudest.splice(h,1),this.loudest.length<this.numLoudestToTrack)break}let m=0;for(;m<this.loudest.length&&!(this.loudest[m].energyScore<r.energyScore);)++m;return m<this.numLoudestToTrack&&(this.loudest.splice(m,0,r),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new Ix(c,m,r.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new fpe(this),this.decisionMaker.execute())}makeDecision(r){let o=null,s=null;const c=this.speakers.size;let u=null;if(c===0)u=null;else if(c===1){var h;const m=Pc(h=this.speakers).call(h).next().value;this.enableSilence&&m&&(u=m.id,m.evaluateSpeechActivityScores(r),r-m.lastNonSilence>this.timeoutToSilenceInterval&&(u=null))}else{let m=this.dominantId==null?null:this.speakers.get(this.dominantId);if(m==null){const S=this.speakers.entries().next();S.value&&(u=S.value[0],m=S.value[1])}else u=m.id;m!=null&&m.evaluateSpeechActivityScores(r);const _=this.relativeSpeechActivities;let y=2;for(const S of this.speakers.entries()){const[R,P]=S;if(P===m)continue;P.evaluateSpeechActivityScores(r);for(let V=0;V<_.length;++V){const q=m==null?D_:m.getSpeechActivityScore(V);_[V]=Math.log(P.getSpeechActivityScore(V)/q)}const k=_[0],z=_[1],U=_[2];k>3&&z>2&&U>0&&z>y&&(y=z,u=R)}this.enableSilence&&m!=null&&u===m.id&&r-m.lastNonSilence>this.timeoutToSilenceInterval&&(u=null)}u==null&&!this.enableSilence||u===this.dominantId||(o=this.dominantId,this.dominantId=u,s=this.dominantId),s==null&&!this.enableSilence||s===o||this.emit("ActiveSpeakerChanged",s)}_runInDecisionMaker(){const r=Date.now(),o=300-(r-this.lastLevelIdleTime);let s=0;o<=0?(this.lastLevelIdleTime!==0&&this.timeoutIdleLevels(r),this.lastLevelIdleTime=r):s=o;let c=300-(r-this.lastDecisionTime);return c<=0&&(this.lastDecisionTime=r,this.makeDecision(r),c=300-(Date.now()-r)),c>0&&s>c&&(s=c),s}timeoutIdleLevels(r){const o=[];for(const c of Pc(s=this.speakers).call(s)){var s;const u=r-c.getLastLevelChangedTime();36e5<u&&(this.dominantId==null||c.id!==this.dominantId)?o.push(c.id):300<u&&c.levelTimedOut()}o.forEach(c=>this.speakers.delete(c))}}const Bv=new Map;let pd=null,JA=null;const PG=3;let L_=[];const md=new Map,QA=new Map;class mpe{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(r,o){Pe(this,"id",void 0),Pe(this,"track",void 0),Pe(this,"score",0),Pe(this,"active",!0),Pe(this,"muted",!1),Pe(this,"timer",0),Pe(this,"actives",0),Pe(this,"inactives",0),this.id=r,this.track=o,this.setActive(md.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){const r=this.active;this.active=this.activeRate>=.8;const{actives:o,inactives:s}=function(){const c=[],u=[];return Array.from(Pc(md).call(md)).forEach(h=>{h.active?c.push(h):u.push(h)}),{actives:c,inactives:u}}();if(o.length>3){let c;o.forEach(u=>{(!c||c.score>u.score)&&(c=u)}),c&&c.setActive(!1)}if(o.length<3&&s.length>0){let c;s.forEach(u=>{(!c||c.score<u.score)&&u.id!==this.id&&(c=u)}),c&&r&&!this.active&&(c.samples>40&&c.activeRate-this.activeRate>.4?c.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(r){this.active=r,this.resetTimer(),this.setMuted(!r)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){const r=function(o){let s;return Array.from(Pc(md).call(md)).forEach(c=>{!c.active||c.id===o||c.samples<40||(!s||c.score<s.score)&&(s=c)}),s}(this.id);r&&this.activeRate-r.activeRate>.4&&(r.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){const r=function(o){let s;return Array.from(Pc(md).call(md)).forEach(c=>{c.active||c.id===o||c.samples<40||(!s||c.score>s.score)&&(s=c)}),s}(this.id);r&&r.activeRate-this.activeRate>.4&&(r.setActive(!0),this.setActive(!1))}addSample(r){r?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()}setMuted(r){this.track&&(this.track.enabled=!r,this.muted=r)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout(()=>{if(this.samples!==0)return this.samples<50?this.resetTimer():void this.autoCheckActive()},1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let ZA;function OG(e){const r=md.get(e);r&&(md.delete(e),r.clearTimer())}const eP=new Map,gpe=new Map;function _pe(e,r,o){let s=new Uint8Array(e,r,o),c=[],u=0;for(;c.length<o;)u+3<o&&s[u]===0&&s[u+1]===0&&s[u+2]===3&&(s[u+3]===0||s[u+3]===1||s[u+3]===2||s[u+3]===3)?(c.push(s[u],s[u+1],s[u+3]),u+=4):(c.push(s[u]),u++);return new Uint8Array(c)}const tP=new Map,yT=new Map;(function(){const e=Rn();oo.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),oo.getStreamFromExtension=e.name===Mn.CHROME&&Number(e.version)>34,oo.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const r=new RTCPeerConnection;let o=!1;try{r.addTransceiver("audio"),o=!0}catch{}return r.close(),o}(),oo.supportMinBitrate=e.name===Mn.CHROME||e.name===Mn.EDGE,oo.supportSetRtpSenderParameters=function(){const r=Rn();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!zf()||!(!vo()&&!OA())||r.name===Mn.FIREFOX&&Number(r.version)>=64)}(),e.name===Mn.SAFARI&&(Number(e.version)>=14?oo.supportDualStream=!0:oo.supportDualStream=!1),oo.webAudioMediaStreamDest=function(){const r=Rn();return!(r.name===Mn.SAFARI&&Number(r.version)<12)}(),oo.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",oo.supportWebGL=typeof WebGLRenderingContext<"u",oo.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,zf()||(oo.webAudioWithAEC=!0),oo.supportShareAudio=function(){const r=Rn();return(r.os===Fi.WIN_10||r.os===Fi.WIN_81||r.os===Fi.WIN_7||r.os===Fi.LINUX||r.os===Fi.MAC_OS||r.os===Fi.CHROMIUM_OS)&&r.name===Mn.CHROME&&Number(r.version)>=74}(),oo.supportDataChannel=!!(cT(76)||function(r){const o=Rn();return!(o.name!==Mn.FIREFOX||!o.osVersion)&&Number(o.version)>=r}(68)||xW(14)),oo.supportPCSetConfiguration=function(){const r=window.RTCPeerConnection;return!Dr()&&!!r&&r.prototype.setConfiguration instanceof Function}(),oo.supportWebRTCEncodedTransform=function(){const r=Rn();return r.name==="Chrome"&&Number(r.version)>=87||r.name==="Safari"&&Number(r.version)>=15}(),oo.supportWebRTCInsertableStream=function(){const r=Rn();return(r.name===Mn.CHROME||r.name===Mn.EDGE)&&Number(r.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),oo.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,oo.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,DA(()=>{oo.supportDualStreamEncoding=function(){const r=Rn();return!!re("DISABLE_WEBAUDIO")||r.name==="Safari"&&Number(r.version)>=14||!!(r.name==="Chrome"&&/Windows/i.test(r.os||"")&&Number(r.version)>=100&&re("CHROME_DUAL_STREAM_USE_ENCODING"))}(),D.debug("browser ua: ",navigator.userAgent),D.info("browser info: ",e),D.info("browser compatibility: ",oo)})})();const Epe=["CHINA","GLOBAL"],kG=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],x_=[],Wv=[];function M_(e,r){return!!r&&x_.some(o=>o.uid===e&&o.channelName===r)}function Ax(){return Wv.length>0}var ype=Z5.forEach,NG=_f("forEach")?[].forEach:function(e){return ype(this,e,arguments.length>1?arguments[1]:void 0)};xn({target:"Array",proto:!0,forced:[].forEach!=NG},{forEach:NG});var vpe=Ka("Array").forEach,Spe=Ec,bpe=pi,Tpe=N,wpe=vpe,Px=Array.prototype,Rpe={DOMTokenList:!0,NodeList:!0},Cpe=function(e){var r=e.forEach;return e===Px||Tpe(Px,e)&&r===Px.forEach||bpe(Rpe,Spe(e))?wpe:r},Ipe=l(Cpe),Ape=As,DG=Sc;xn({target:"Object",stat:!0,forced:d(function(){DG(1)})},{keys:function(e){return DG(Ape(e))}});var LG=l(St.Object.keys),Ppe=l(QE),Ope=l(ey),kpe=xn,xG=jg,Npe=l_,Dpe=yt,MG=pe,Lpe=oi,xpe=Re,Mpe=xI,Upe=dr,Vpe=go,Fpe=z5("slice"),jpe=Upe("species"),Ox=Array,Bpe=Math.max;kpe({target:"Array",proto:!0,forced:!Fpe},{slice:function(e,r){var o,s,c,u=xpe(this),h=Lpe(u),m=MG(e,h),_=MG(r===void 0?h:r,h);if(xG(u)&&(o=u.constructor,(Npe(o)&&(o===Ox||xG(o.prototype))||Dpe(o)&&(o=o[jpe])===null)&&(o=void 0),o===Ox||o===void 0))return Vpe(u,m,_);for(s=new(o===void 0?Ox:o)(Bpe(_-m,0)),c=0;m<_;m++,c++)m in u&&Mpe(s,c,u[m]);return s.length=c,s}});var Wpe=Ka("Array").slice,zpe=N,Gpe=Wpe,kx=Array.prototype,Hpe=function(e){var r=e.slice;return e===kx||zpe(kx,e)&&r===kx.slice?Gpe:r},$pe=l(Hpe);function vt(e,r,o,s,c){var u,h,m,_={};return Ipe(u=LG(s)).call(u,function(y){_[y]=s[y]}),_.enumerable=!!_.enumerable,_.configurable=!!_.configurable,("value"in _||_.initializer)&&(_.writable=!0),_=Ppe(h=Ope(m=$pe(o).call(o)).call(m)).call(h,function(y,S){return S(e,r,y)||y},_),c&&_.initializer!==void 0&&(_.value=_.initializer?_.initializer.call(c):void 0,_.initializer=void 0),_.initializer===void 0&&(F5(e,r,_),_=null),_}let nP=function(e){return e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",e}({}),Nx=function(e){return e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR",e}({}),uu=function(e){return e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",e}({}),Ss=function(e){return e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",e[e.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",e}({}),Dt=function(e){return e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",e[e.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",e[e.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",e[e.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",e[e.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",e[e.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",e[e.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",e[e.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",e[e.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",e}({}),lr=function(e){return e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed",e}({}),Bt=function(e){return e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.ABORT_P2P_EXECUTION="abort_p2p_execution",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success",e.JOIN_RESPONSE="join_response",e.PRE_CONNECT_PC="pre_connect_pc",e.P2P_CONNECTION="p2p_connection",e.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",e.P2P_SUBSCRIBE="p2p_subscribe",e.P2P_UNSUBSCRIBE="p2p_unsubscribe",e.P2P_EXCHANGE_SDP="p2p_exchange_sdp",e.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",e.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",e.RECOVER_NOTIFICATION="recover_notification",e}({}),jt=function(e){return e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v3",e.REJOIN="rejoin_v3",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.PUBLISH_DATASTREAM="publish_datastream",e.UNPUBLISH="unpublish",e.UNPUBLISH_DATASTREAM="unpublish_datastream",e.SUBSCRIBE="subscribe",e.PRE_SUBSCRIBE="pre_subscribe",e.SUBSCRIBE_DATASTREAM="subscribe_datastream",e.SUBSCRIBE_STREAMS="subscribe_streams",e.UNSUBSCRIBE="unsubscribe",e.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",e.UNSUBSCRIBE_STREAMS="unsubscribe_streams",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.DEFAULT_VIDEO_STREAM="default_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer",e.RESTART_ICE="restart_ice",e.CONNECT_PC="connect_pc",e.SET_VIDEO_PROFILE="set_video_profile",e.SET_PARAMETER="set_parameter",e.SET_RTM2_FLAG="set_rtm2_flag",e}({}),vT=function(e){return e.WRTC_STATS="wrtc_stats",e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",e.DENOISER_STATS="denoiser_stats",e.EXTENSION_USAGE_STATS="extension_usage_stats",e}({}),_n=function(e){return e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_USER_LICENSE_BANNED="on_user_license_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.ON_P2P_OK="on_p2p_ok",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",e.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",e.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio",e.ON_PUBLISHED_USER_LIST="on_published_user_list",e}({}),bs=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({}),qt=function(e){return e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls",e.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",e}({});function rP(e){if(typeof e!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e))throw D.error("Invalid Channel Name ".concat(e)),new Oe(X.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function iP(e){if(r=e,!(typeof r=="number"&&Math.floor(r)===r&&0<=r&&r<=4294967295||zW(e,1,255)))throw new Oe(X.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var r;typeof e=="string"&&D.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let qf=function(e){return e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e}({});const Kpe={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},Dx={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function Lx(e,r){ro(e.url,"".concat(r,".url"),1,1e3,!1),Lr(e.x)||er(e.x,"".concat(r,".x"),0,1e4),Lr(e.y)||er(e.y,"".concat(r,".y"),0,1e4),Lr(e.width)||er(e.width,"".concat(r,".width"),0,1e4),Lr(e.height)||er(e.height,"".concat(r,".height"),0,1e4),Lr(e.zOrder)||er(e.zOrder,"".concat(r,".zOrder"),0,255),Lr(e.alpha)||er(e.alpha,"".concat(r,".alpha"),0,1,!1)}const qpe={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let Am=function(e){return e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address",e}({}),xx=function(e){return e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",e}({}),Ii=function(e){return e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",e}({});function UG(e){if(!e.channelName)throw new Oe(X.INVALID_PARAMS,"invalid channelName in info");if(typeof e.uid!="number")throw new Oe(X.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&ro(e.token,"info.token",1,2047),iP(e.uid),rP(e.channelName),!0}let Ts=function(e){return e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile",e}({}),Yf=function(e){return e.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",e.NETWORK_CONNECTED="NETWORK_CONNECTED",e.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",e.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",e.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",e.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",e.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",e.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",e.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",e}({}),ba=function(e){return e.RELAY_STATE_IDLE="RELAY_STATE_IDLE",e.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",e.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",e.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",e}({}),zv=function(e){return e.RELAY_OK="RELAY_OK",e.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",e.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",e.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",e}({}),zn=function(e){return e.High="high",e.Low="low",e.Audio="audio",e.Screen="screen",e.ScreenLow="screen_low",e}({}),Qi=function(e){return e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid",e.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",e.JOIN_RESPONSE="join-response",e.RESET_CONNECTION_EVENTS="reset-connection-events",e.PRE_CONNECT_PC="pre-connect_pc",e.UPDATE_GATEWAY_CONFIG="update-gateway-config",e}({}),oP=function(e){return e.P2P_DISCONNECTED="P2P_DISCONNECTED",e.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",e.TIMEOUT="TIMEOUT",e.UNKNOWN_REASON="UNKNOWN_REASON",e}({}),Bi=function(e){return e[e.Nothing=0]="Nothing",e[e.Audio=1]="Audio",e[e.LwoVideo=2]="LwoVideo",e[e.Video=4]="Video",e[e.Data=8]="Data",e[e.DataStream0=256]="DataStream0",e[e.DataStream1=512]="DataStream1",e[e.DataStream2=1024]="DataStream2",e[e.DataStream3=2048]="DataStream3",e[e.DataStream4=4096]="DataStream4",e[e.DataStream5=8192]="DataStream5",e[e.DataStream6=16384]="DataStream6",e[e.DataStream7=32768]="DataStream7",e}({}),Un=function(e){return e.CHINA="CHINA",e.ASIA="ASIA",e.NORTH_AMERICA="NORTH_AMERICA",e.EUROPE="EUROPE",e.JAPAN="JAPAN",e.INDIA="INDIA",e.KOREA="KOREA",e.HKMC="HKMC",e.US="US",e.OCEANIA="OCEANIA",e.SOUTH_AMERICA="SOUTH_AMERICA",e.AFRICA="AFRICA",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="EXTENSIONS",e}({});const VG=[Un.AFRICA,Un.ASIA,Un.CHINA,Un.EUROPE,Un.GLOBAL,Un.INDIA,Un.JAPAN,Un.NORTH_AMERICA,Un.OCEANIA,Un.OVERSEA,Un.SOUTH_AMERICA];let ko=function(e){return e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.KOREA="KR",e.HKMC="HK",e.US="US",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="GLOBAL",e}({});const sP={CHINA:{},ASIA:{CODE:ko.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:ko.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:ko.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:ko.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:ko.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:ko.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:ko.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:ko.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:ko.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:ko.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:ko.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:ko.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:ko.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};nx&&(sP.CHINA={CODE:ko.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let ST=function(e){return e.UPDATE_BITRATE_LIMIT="update_bitrate_limit",e.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",e}({});function FG(e){return!!e&&!(!e.uplink||!e.id)&&e.uplink.max_bitrate!==void 0&&e.uplink.min_bitrate!==void 0}class jG extends Pr{constructor(r,o){super(),$(this,"onICEConnectionStateChange",void 0),$(this,"onConnectionStateChange",void 0),$(this,"onDTLSTransportStateChange",void 0),$(this,"onDTLSTransportError",void 0),$(this,"onICETransportStateChange",void 0),$(this,"onFirstAudioReceived",void 0),$(this,"onFirstVideoReceived",void 0),$(this,"onFirstAudioDecoded",void 0),$(this,"onFirstVideoDecoded",void 0),$(this,"onFirstVideoDecodedTimeout",void 0),$(this,"onSelectedLocalCandidateChanged",void 0),$(this,"onSelectedRemoteCandidateChanged",void 0),$(this,"onICECandidateError",void 0),$(this,"getLocalVideoStats",void 0)}}class BG extends jG{constructor(r,o){super(r,o),$(this,"establishPromise",void 0)}}let gt=function(e){return e.VIDEO="video",e.AUDIO="audio",e}({}),No=function(e){return e.UDP_RELAY="udp_relay",e.UDP_TCP_RELAY="udp_tcp_relay",e.TCP_RELAY="tcp_relay",e.RELAY="relay",e}({}),Xf=function(e){return e[e.FIRST_CONNECTION=0]="FIRST_CONNECTION",e[e.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",e[e.RELAY_RESTART=2]="RELAY_RESTART",e[e.TCP_RESTART=3]="TCP_RESTART",e[e.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",e[e.OLD_RESTART=11]="OLD_RESTART",e[e.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",e}({});const WG=["disconnected","failed"];let $e=function(e){return e.LocalVideoTrack="videoTrack",e.LocalAudioTrack="audioTrack",e.LocalVideoLowTrack="videoLowTrack",e}({}),Bn=function(e){return e.New="new",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnected="disconnected",e}({}),kt=function(e){return e.AudioMetadata="audioMetadata",e.StateChange="stateChange",e.IceConnectionStateChange="iceConnectionStateChange",e.RequestMuteLocal="requestMuteLocal",e.RequestUnmuteLocal="requestUnmuteLocal",e.RequestRePublish="requestRePublish",e.RequestRePublishDataChannel="requestRePublishDataChannel",e.RequestReSubscribe="requestReSubscribe",e.RequestUploadStats="requestUploadStats",e.RequestUpload="requestUpload",e.MediaReconnectStart="MediaReconnectStart",e.MediaReconnectEnd="MediaReconnectEnd",e.NeedSignalRTT="NeedSignalRTT",e.RequestRestartICE="RequestRestartIce",e.PeerConnectionStateChange="PeerConnectionStateChange",e.RequestReconnect="RequestReconnect",e.RequestReconnectPC="RequestReconnectPC",e.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",e.P2PLost="P2PLost",e.UpdateVideoEncoder="UpdateVideoEncoder",e.ConnectionTypeChange="ConnectionTypeChange",e.RequestLowStreamParameter="RequestLowStreamParameter",e.QueryClientConnectionState="QueryClientConnectionState",e.LocalCandidate="LocalCandidate",e.RequestP2PMuteLocal="requestP2PMuteLocal",e.RequestP2PUnPublish="RequestP2PUnPublish",e.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",e.RequestP2PMuteRemote="RequestP2PMuteRemote",e.RequestP2PRestartICE="RequestP2PRestartICE",e}({}),du=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),hu=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),Zi=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),zG=function(e){return e.CONNECTED="transmitter:connected",e.RECONNECTING="transmitter:reconnecting",e.WILL_RECONNECT="transmitter:will_reconnect",e.CLOSED="transmitter:closed",e.FAILED="transmitter:failed",e.ON_MESSAGE="transmitter:on_message",e.REQUEST_NEW_URLS="transmitter:request_new_urls",e.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",e.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",e.FAILBACK="transmitter:failback",e.PRE_CONNECT_PC="transmitter:pre_connect_pc",e}({}),Eh=function(e){return e.CAMERA_CHANGED="camera-changed",e.MICROPHONE_CHANGED="microphone-changed",e.PLAYBACK_DEVICE_CHANGED="playback-device-changed",e.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",e.AUTOPLAY_FAILED="autoplay-failed",e.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",e.SECURITY_POLICY_VIOLATION="security-policy-violation",e}({}),yl=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),gd=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),Gv=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),Qr=function(e){return e.CALL="call",e.CANDIDATE="candidate",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.CONTROL="control",e.RESTART_ICE="restart_ice",e.ACK="ack",e.RESPONSE="response",e.JOIN="join",e.CHECK="check",e}({}),Hv=function(e){return e.ABORT="abort",e}({}),Pm=function(e){return e.MUTE_LOCAL_AUDIO="mute_local_audio",e.MUTE_LOCAL_VIDEO="mute_local_video",e.UNMUTE_LOCAL_AUDIO="unmute_local_audio",e.UNMUTE_LOCAL_VIDEO="unmute_local_video",e}({}),Ype=function(e){return e.P2P_TOKEN_TIMEOUT="p2p_token_timeout",e.P2P_TOKEN_CHANGED="p2p_token_changed",e}({});const Xpe={[nP.ACCESS_POINT]:{[Ss.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[Ss.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[Ss.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[Ss.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[Ss.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[Ss.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[Ss.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[Ss.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[Ss.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[Ss.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[Ss.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[Ss.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[Ss.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[Ss.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[Ss.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[Ss.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[Ss.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[Ss.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[nP.UNILBS]:{[uu.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[uu.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[uu.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[uu.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[uu.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[uu.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[uu.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[uu.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[uu.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[uu.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[uu.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[uu.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[nP.STRING_UID_ALLOCATOR]:{[Nx.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[Nx.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[Nx.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function $v(e){const r=Xpe[Math.floor(e/1e4)];if(!r)return{desc:"unknown error",retry:!1};const o=r[e%1e4];if(!o){if(Math.floor(e/1e4)===nP.ACCESS_POINT){const s=e%1e4;if(s.toString()[0]==="1")return{desc:e.toString(),retry:!1};if(s.toString()[0]==="2")return{desc:e.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return o}const Jpe={[Dt.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[Dt.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[Dt.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[Dt.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[Dt.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[Dt.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[Dt.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[Dt.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[Dt.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[Dt.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[Dt.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[Dt.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[Dt.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[Dt.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[Dt.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[Dt.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[Dt.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[Dt.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[Dt.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[Dt.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[Dt.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[Dt.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[Dt.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[Dt.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[Dt.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[Dt.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[Dt.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[Dt.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[Dt.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[Dt.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[Dt.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[Dt.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[Dt.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[Dt.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[Dt.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[Dt.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[Dt.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[Dt.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[Dt.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[Dt.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[Dt.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[Dt.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Dt.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Dt.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[Dt.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[Dt.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[Dt.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[Dt.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[Dt.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[Dt.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[Dt.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[Dt.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[Dt.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[Dt.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[Dt.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[Dt.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[Dt.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[Dt.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[Dt.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[Dt.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[Dt.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[Dt.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[Dt.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[Dt.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function bT(e){return Jpe[e]||{desc:"UNKNOWN_ERROR_".concat(e),action:"failed"}}function GG(e,r){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),o.push.apply(o,s)}return o}function Mx(e){for(var r=1;r<arguments.length;r++){var o=arguments[r]!=null?arguments[r]:{};r%2?GG(Object(o),!0).forEach(function(s){$(e,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):GG(Object(o)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(o,s))})}return e}function HG(e,r){if(typeof e=="string")return e;const{proxy:o,host:s,port:c}=e;if(r){const u=re("JOIN_GATEWAY_FALLBACK_PORT")||443;return u===443?"wss://".concat(s,"/ws/?p=").concat(Number(c)+150):"wss://".concat(s,":").concat(u,"/ws/?p=").concat(Number(c)+150)}return o?"wss://".concat(o,"/ws/?h=").concat(s,"&p=").concat(c):"wss://".concat(s,":").concat(c)}const Qpe=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,Zpe=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,eme=/wss:\/\/(.+):([0-9]+)\/?/,tme=/wss:\/\/(.[^\/]+)\/?/;let nme=0;class rme{constructor(r,o){$(this,"id",0),$(this,"store",void 0),$(this,"recordIndex",void 0),$(this,"websockets",[]),$(this,"try443PortDuration",2e3),$(this,"forceCloseWSDuration",5e3),$(this,"try443PortTimeout",null),$(this,"forceCloseTimeout",null),$(this,"isTry443PortFailed",!1),$(this,"isNormalPortFailed",!1),$(this,"useDoubleDomain",!1),$(this,"useProxy",!1),$(this,"startTime",Date.now()),this.id=++nme,this.try443PortDuration=re("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=r||5e3,this.store=o}closeAllWebsockets(){this.websockets.forEach(r=>{r.onopen=null,r.onclose=null,r.onmessage=null,r.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var r;const o=Date.now()-this.startTime;for(var s=arguments.length,c=new Array(s),u=0;u<s;u++)c[u]=arguments[u];D.debug("[choose-best-ws ".concat((r=this.store)===null||r===void 0?void 0:r.clientId," ").concat(this.id,"] ").concat(o,"ms:"),...c)}createWebSocket(r,o,s){this.logger("createWebSocket:",r,{isTry443Port:o,hasTimeoutDetection:s});const c=re("GATEWAY_DOMAINS"),u=Date.now(),h=[],m=c.find(P=>{var k;return st(k=r.host).call(k,P)});m||(this.useDoubleDomain=!1);const _=[];if(this.useDoubleDomain)c.forEach(P=>{_.push(HG(Mx(Mx({},r),{},{host:r.host.replace(m,P)}),o))});else{const P=Mx({},r);if(o&&m){const k=c.find(z=>z!==m);k&&(P.host=P.host.replace(m,k))}_.push(HG(P,o))}try{_.forEach(P=>{const k=new WebSocket(P);k.binaryType="arraybuffer",h.push(k),this.logger("ws is connecting:",k.url)})}catch(P){if(this.logger("ws create failed"),h.forEach(k=>k.close()),h.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(r,o,s);if(!o&&Number(r.port)!==443)return this.createWebSocket(r,!0,s);throw new Oe(X.WS_ERR,"init websocket failed! Error: ".concat(P.toString()))}const y=aT();this.store&&this.store.recordJoinChannelService({urls:h.map(P=>P.url),service:"gateway"},this.recordIndex),h.forEach(P=>{P.onopen=()=>{this.logger("onopen: ws ".concat(P.url," open cost ").concat(Date.now()-u,"ms")),this.websockets.forEach(k=>{k!==P&&(k.onopen=null,k.onclose=null,k.onmessage=null,k.close(),this.logger("close backup websocket: ".concat(k.url)))}),this.websockets.length=0,y.resolve(P)},P.onclose=k=>{this.logger("onclose: ws ".concat(P.url," closed cost ").concat(Date.now()-u,"ms state: ").concat(P.readyState));const z=h.every(U=>U.readyState===WebSocket.CLOSED||U.readyState===WebSocket.CLOSING);this.logger("".concat(o?"443":"47xx"," websocket closed, all failed: ").concat(z)),z&&(o||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(k.reason)),y.reject({code:k.code,reason:oP.A_ROUND_WS_FAILED})):!o&&z&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),R()),o?this.isTry443PortFailed=z:this.isNormalPortFailed=z},P.onmessage=k=>this.logger("".concat(P.url," onmessage: ").concat(k.data))}),this.websockets.push(...h);const S=()=>{this.websockets.forEach(P=>P.readyState!==WebSocket.OPEN&&P.close())},R=()=>{if(y.isResolved)return S();Rn().os===Fi.MAC_OS&&Dr()&&S(),this.createWebSocket(r,!0,!0).then(P=>{y.resolve(P)}).catch(P=>{this.isNormalPortFailed&&y.reject(P),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",y.isResolved),this.forceCloseTimeout=null,S()},this.forceCloseWSDuration)};return s||(()=>{if(o||this.useProxy)return this.logger("add 5s timeout at ".concat(o?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(()=>{this.forceCloseTimeout=null,S()},this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{this.logger("2s timeout, isWebsocket created: ",y.isResolved),this.try443PortTimeout=null,R()},this.try443PortDuration)})(),y.promise}chooseBestWebsocket(r,o,s,c){return this.useDoubleDomain=!!o,typeof r=="string"&&(r=function(u){let h,m,_;return[,h,m,_]=u.match(Qpe)||[],h||([,m,_]=u.match(Zpe)||[]),m&&_||([,m,_]=u.match(eme)||[]),m&&_||([,m]=u.match(tme)||[]),m||D.warning("un-destructible url: ",u),{proxy:h,host:m,port:_||"443"}}(r)),this.recordIndex=c,this.useProxy=!!r.proxy,s&&this.useProxy&&(D.warn("cannot use 443 only when use proxy"),s=!1),this.createWebSocket(r,!!s,!1).finally(()=>this.clearTimeout())}}function $G(e,r){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),o.push.apply(o,s)}return o}class KG extends Pr{get url(){return this.websocket&&this.websocket.url||null}get reconnectMode(){return this._reconnectMode}set reconnectMode(r){var o;st(o=["tryNext","recover"]).call(o,r)&&this.resetReconnectCount(r),this._reconnectMode=r}get state(){return this._state}set state(r){r!==this._state&&(this._state=r,this._state==="reconnecting"?this.emit(qt.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(qt.CONNECTED):this._state==="closed"?this.emit(qt.CLOSED):this._state==="failed"&&this.emit(qt.FAILED))}resetReconnectCount(r){D.debug("websocket reset reconnect count, reason: "+r),this.reconnectCount=0}constructor(r,o){let s=arguments.length>2&&arguments[2]!==void 0&&arguments[2],c=arguments.length>3&&arguments[3]!==void 0&&arguments[3],u=arguments.length>4&&arguments[4]!==void 0&&arguments[4],h=arguments.length>5?arguments[5]:void 0;super(),$(this,"connectionID",0),$(this,"currentURLIndex",0),$(this,"urls",[]),$(this,"_reconnectMode","tryNext"),$(this,"reconnectReason",void 0),$(this,"_initMutex",void 0),$(this,"name",void 0),$(this,"_state","closed"),$(this,"reconnectInterrupter",void 0),$(this,"websocket",void 0),$(this,"retryConfig",void 0),$(this,"reconnectCount",0),$(this,"forceCloseTimeout",5e3),$(this,"onlineReconnectListener",void 0),$(this,"useCompress",void 0),$(this,"tryDoubleDomain",!1),$(this,"use443PortOnly",!1),$(this,"wsInflateLength",0),$(this,"wsDeflateLength",0),$(this,"closeEstablishingWs",()=>{}),$(this,"store",void 0),$(this,"joinGatewayRecordIndex",void 0),this.store=h,this.name=r,this.retryConfig=function(R){for(var P=1;P<arguments.length;P++){var k=arguments[P]!=null?arguments[P]:{};P%2?$G(Object(k),!0).forEach(function(z){$(R,z,k[z])}):Object.getOwnPropertyDescriptors?Object.defineProperties(R,Object.getOwnPropertyDescriptors(k)):$G(Object(k)).forEach(function(z){Object.defineProperty(R,z,Object.getOwnPropertyDescriptor(k,z))})}return R}({},o),this.useCompress=s,this.tryDoubleDomain=c,this.use443PortOnly=u,this._initMutex=new Oo("websocket",h?h.clientId:void 0);const{timeout:m,timeoutFactor:_}=o,y=Math.max(300,Math.floor(3*m/5)),S=Math.max(1.2,Math.floor(8*_)/10);tc.ONLINE&&(this.retryConfig.timeout=y,this.retryConfig.timeoutFactor=S),ai.on(Rv.NETWORK_STATE_CHANGE,(R,P)=>{R!==P&&(this.resetReconnectCount("network state change: ".concat(P," -> ").concat(R)),R===tc.ONLINE?(this.retryConfig.timeout=y,this.retryConfig.timeoutFactor=S):(this.retryConfig.timeout=m,this.retryConfig.timeoutFactor=_))})}getConnection(){return this.websocket||void 0}async init(r){let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const s=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=o,this.urls=r,this.state="connecting";try{const c=aT(),u=this.urls[this.currentURLIndex];re("ENABLE_PREALLOC_PC")&&this.emit(zG.PRE_CONNECT_PC),this.createWebSocketConnection(u).then(c.resolve).catch(c.reject),this.once(qt.CLOSED,()=>{c.reject(new Le(X.WS_DISCONNECT))}),this.once(qt.CONNECTED,c.resolve),await c.promise}catch{}finally{s()}}close(r,o){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const s=this.websocket;o?setTimeout(()=>s.close(),500):s.close(),this.websocket=void 0}this.state=r?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(r,o){if(!this.websocket)return void D.warning("[".concat(this.name,"] can not reconnect, no websocket"));r!==void 0&&(this.reconnectMode=r),D.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(o)]},this.joinGatewayRecordIndex);const s=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),s&&s.bind(this.websocket)({code:9999,reason:o})}sendMessage(r){let o=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new Le(X.WS_ABORT,"websocket is not ready");try{o||(r=JSON.stringify(r)),this.websocket.send(r)}catch(s){throw new Le(X.WS_ERR,"send websocket message error"+s.toString())}}setWsInflateData(r){this.wsDeflateLength=this.wsDeflateLength+r.originLength,this.wsInflateLength=this.wsInflateLength+r.compressedLength}getWsInflateData(){const r=this.wsInflateLength,o=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:r,wsDeflateLength:o}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(r){var o;const s=aT();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const c=S=>{var R;(R=this.store)===null||R===void 0||R.signalChannelOpen(),D.debug("[".concat(this.name,"] websocket opened:"),S),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),s.resolve()},u=async S=>{var R;if(D.debug("[".concat(this.name,"] websocket close ").concat((R=this.websocket)===null||R===void 0?void 0:R.url,", code: ").concat(S.code,", reason: ").concat(S.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)s.reject(new Le(X.WS_DISCONNECT,"websocket close: ".concat(S.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=S.reason,this.state="reconnecting");const P=kc(this,qt.WILL_RECONNECT,this.reconnectMode,S.reason)||this.reconnectMode,k=await this.reconnectWithAction(P);if(this.state==="closed")return void D.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!k)return s.reject(new Le(X.WS_DISCONNECT,"websocket reconnect failed: ".concat(S.code))),this.close(!0);s.resolve()}},h=S=>{this.emit(qt.ON_MESSAGE,S)},m=S=>{D.warn("[".concat(this.connectionID,"] ws open error ").concat(S))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),re("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(r=re("GATEWAY_WSS_ADDRESS")),D.debug("[".concat(this.name,"] start connect, url:"),r);const _=(o=this.store)===null||o===void 0?void 0:o.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var y;const S=await this.chooseBestWebsocketConnection(r);this.websocket=S,c&&c(this.websocket.url),this.websocket.onclose=u,this.websocket.onmessage=h,this.websocket.onerror=m,(y=this.store)===null||y===void 0||y.recordJoinChannelService({endTs:Date.now(),status:"success"},_),this.joinGatewayRecordIndex=_}catch(S){const R=this.state==="closed",P=S instanceof Le,k=P&&S.code===X.WS_ABORT,z=P&&S.code===X.WS_ERR,U=P?S.message:S&&(S.reason||S.toString());D.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(U)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:k?"aborted":"error",errors:[S]},_),R||z?(s.reject(R?new Le(X.WS_DISCONNECT,"websocket is closed: ".concat(U)):new Le(X.WS_ERR,"init websocket failed: ".concat(U))),z&&D.error("[".concat(this.name,"] init websocket failed: ").concat(U))):u&&u(S)}return s.promise}async reconnectWithAction(r){let o=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;D.warning("[choose-best-ws] action: =>",r),this.onlineReconnectListener||ai.isOnline||!ai.onlineWaiter||(this.onlineReconnectListener=ai.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let s=!0;if(this.reconnectInterrupter=()=>s=!1,o){const h=qL(this.reconnectCount,this.retryConfig);D.debug("[".concat(this.name,"] wait ").concat(h,"ms to reconnect websocket, mode: ").concat(r)),await lt.race([io(h),this.onlineReconnectListener||new lt(()=>{})])}if(this._state==="closed"||!s)return!1;this.reconnectCount+=1;const c=async(h,m)=>{this.emit(qt.RECONNECT_CREATE_CONNECTION,m),await this.createWebSocketConnection(h)};try{if(r==="retry")await c(this.urls[this.currentURLIndex],r);else if(r==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);D.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await c(this.urls[this.currentURLIndex],r)}else r==="recover"&&(D.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await bo(this,qt.REQUEST_NEW_URLS),this.currentURLIndex=0,await c(this.urls[this.currentURLIndex],r))}catch(h){var u;D.error("[".concat(this.name,"] reconnect failed ").concat(h&&h.toString()));const m=h==null||(u=h.data)===null||u===void 0?void 0:u.desc;return Array.isArray(m)&&st(m).call(m,"dynamic key expired")?(this.emit(qt.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(r,o)}return!0}}class Ux extends KG{constructor(r,o){super(r,o,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(r,o){const s=aT(),c=function(h,m){return new rme(h,m)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{D.debug("[choose-best-ws] close establishing websockets"),c.closeAllWebsockets(),s.reject(new Le(X.WS_ABORT,"choose best websocket aborted"))};const u=re("GATEWAY_DOMAINS");return D.debug("[choose-best-ws] currentDomain: ",r,", domains: ",u,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),c.chooseBestWebsocket(r,this.tryDoubleDomain,this.use443PortOnly,o).then(s.resolve).catch(s.reject),s.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class TT extends KG{constructor(r,o){super(r,o,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(r,o){return new lt((s,c)=>{let u=!1;const h=[];this.closeEstablishingWs=()=>{D.debug("[choose-best-ws] close establishing websockets"),h.forEach(z=>{z.onclose=null,z.onopen=null,z.onmessage=null,z.close()}),c(new Le(X.WS_ABORT,"choose best websocket aborted"))};const m=re("GATEWAY_DOMAINS");let _;const y=r.indexOf("?h="),S=m.find(z=>y!==-1?st(r).call(r,z,y):st(r).call(r,z));D.debug("[choose-best-ws] currentDomain: ",S,", domains: ",m);let R=!this.tryDoubleDomain||!S;if(!R&&S){var P;const z=Date.now();try{m.forEach(U=>{const V=y===-1?r.replace(S,U):r.substr(0,y)+r.substr(y).replace(S,U),q=new WebSocket(V);q.binaryType="arraybuffer",h.push(q),D.debug("[choose-best-ws] ws is connecting:",q.url)})}catch{for(D.debug("[choose-best-ws] ws create failed, fallback to single url"),h.forEach(V=>V.close());h.length;)h.pop();R=!0}(P=this.store)===null||P===void 0||P.recordJoinChannelService({urls:h.map(U=>U.url),service:"gateway"},o),h.forEach(U=>{U.onopen=()=>{if(u)return;const V=Date.now()-z;D.debug("[choose-best-ws] ws open cost ".concat(V,"ms")),h.filter(q=>q!==U).forEach(q=>{D.debug("[choose-best-ws]close backup websocket: ".concat(q.url)),q.close()}),u=!0,s(U)},U.onclose=V=>{_=V,!u&&(h.find(q=>!(q.readyState===WebSocket.CLOSED||q.readyState===WebSocket.CLOSING))||(D.debug("[choose-best-ws] all websocket is closed"),u=!0,c(_)))},U.onmessage=V=>{D.debug("[choose-best-ws]".concat(U.url," onmessage: ").concat(V.data))}}),io(this.forceCloseTimeout).then(()=>{h.forEach(U=>{U.readyState!==WebSocket.OPEN&&U.close()})})}if(R){var k;let z;D.debug("[choose-best-ws] use single url: ",r),(k=this.store)===null||k===void 0||k.recordJoinChannelService({urls:[r],service:"gateway"},o);try{z=new WebSocket(r),h.push(z),z.binaryType="arraybuffer"}catch(U){const V=new Le(X.WS_ERR,"init websocket failed! Error: ".concat(U.toString()));return D.error("[".concat(this.name,"]").concat(V)),void c(V)}z.onopen=()=>{s(z)},z.onclose=U=>{c(U)},z.onmessage=U=>{D.debug("[choose-best-ws]".concat(z.url," onmessage: ").concat(U.data))},io(this.forceCloseTimeout).then(()=>{z&&z.readyState!==WebSocket.OPEN&&z.close()})}}).then(s=>(this.closeEstablishingWs=void 0,s)).catch(s=>{throw this.closeEstablishingWs=void 0,s})}}class ime extends Pr{get connectionState(){return this._connectionState}set connectionState(r){r!==this._connectionState&&(this._connectionState=r,r===lr.CONNECTED?this.emit(Bt.WS_CONNECTED):r===lr.RECONNECTING?this.emit(Bt.WS_RECONNECTING,this._websocketReconnectReason):r===lr.CLOSED&&this.emit(Bt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(r,o){super(),$(this,"_disconnectedReason",void 0),$(this,"_websocketReconnectReason",void 0),$(this,"_connectionState",lr.CLOSED),$(this,"reconnectToken",void 0),$(this,"websocket",void 0),$(this,"openConnectionTime",void 0),$(this,"clientId",void 0),$(this,"lastMsgTime",Date.now()),$(this,"uploadCache",[]),$(this,"uploadCacheInterval",void 0),$(this,"rttRolling",new o8(5)),$(this,"pingpongTimer",void 0),$(this,"wsInflateDataTimer",void 0),$(this,"pingpongTimeoutCount",0),$(this,"joinResponse",void 0),$(this,"multiIpOption",void 0),$(this,"initError",void 0),$(this,"spec",void 0),$(this,"store",void 0),$(this,"onWebsocketMessage",s=>{if(s.data instanceof ArrayBuffer)return void this.emit(Bt.ON_BINARY_DATA,s.data);const c=JSON.parse(s.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){const u="res-@".concat(c._id);this.emit(u,c._result,c._message)}else if(Object.prototype.hasOwnProperty.call(c,"_type")){if(this.emit(c._type,c._message),c._type===_n.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===_n.ON_USER_BANNED)switch(c._message.error_code){case 14:this.close(jn.UID_BANNED);break;case 15:this.close(jn.IP_BANNED);break;case 16:this.close(jn.CHANNEL_BANNED)}if(c._type===_n.ON_USER_LICENSE_BANNED)switch(c._message.error_code){case Dt.ERR_LICENSE_MISSING:this.close(jn.LICENSE_MISSING);break;case Dt.ERR_LICENSE_EXPIRED:this.close(jn.LICENSE_EXPIRED);break;case Dt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(jn.LICENSE_MINUTES_EXCEEDED);break;case Dt.ERR_LICENSE_PERIOD_INVALID:this.close(jn.LICENSE_PERIOD_INVALID);break;case Dt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(jn.LICENSE_MULTIPLE_SDK_SERVICE);break;case Dt.ERR_LICENSE_ILLEGAL:this.close(jn.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=r.clientId,this.spec=r,this.store=o,this.websocket=new Ux("gateway-".concat(this.clientId),this.spec.retryConfig,!0,re("JOIN_GATEWAY_USE_DUAL_DOMAIN"),re("JOIN_GATEWAY_USE_443PORT_ONLY"),o),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===lr.CONNECTED&&this.reconnect("retry",So.OFFLINE)})}async request(r,o,s,c){const u=sr(6,""),h={_id:u,_type:r,_message:o},m=this.websocket.connectionID,_=()=>new lt((z,U)=>{if(this.connectionState===lr.CONNECTED)return z();const V=()=>{this.off(Bt.WS_CLOSED,q),z()},q=()=>{this.off(Bt.WS_CONNECTED,V),U(new Oe(X.WS_ABORT))};this.once(Bt.WS_CONNECTED,V),this.once(Bt.WS_CLOSED,q),r!==jt.PUBLISH&&r!==jt.PUBLISH_DATASTREAM&&r!==jt.SUBSCRIBE&&r!==jt.SUBSCRIBE_DATASTREAM&&r!==jt.UNSUBSCRIBE&&r!==jt.UNSUBSCRIBE_DATASTREAM&&r!==jt.UNPUBLISH&&r!==jt.UNPUBLISH_DATASTREAM&&r!==jt.CONTROL&&r!==jt.RESTART_ICE||this.once(Bt.DISCONNECT_P2P,()=>{U(new Oe(X.DISCONNECT_P2P))}),r!==jt.PUBLISH&&r!==jt.RESTART_ICE||this.once(Bt.ABORT_P2P_EXECUTION,()=>{U(new Oe(X.DISCONNECT_P2P))})});if(this.connectionState!==lr.CONNECTING&&this.connectionState!==lr.RECONNECTING||r===jt.JOIN||r===jt.REJOIN||await _(),this.websocket.sendMessage(h,!0),c)return;const y=new lt((z,U)=>{let V=!1;const q=(ce,_e)=>{V=!0,z({isSuccess:ce==="success",message:_e||{}}),this.off(Bt.WS_CLOSED,Y),this.off(Bt.WS_RECONNECTING,Y),this.emit(Bt.REQUEST_SUCCESS,r,o)};this.once("res-@".concat(u),q);const Y=()=>{U(new Oe(X.WS_ABORT,"type: ".concat(r))),this.off(Bt.WS_CLOSED,Y),this.off(Bt.WS_RECONNECTING,Y),this.off("res-@".concat(u),q)};this.once(Bt.WS_CLOSED,Y),this.once(Bt.WS_RECONNECTING,Y),io(re("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==m||V||(D.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(r)),this.emit(Bt.REQUEST_TIMEOUT,r,o))})});let S=null;try{S=await y}catch(z){if(this.connectionState===lr.CLOSED||r===jt.LEAVE)throw new Oe(X.WS_ABORT);return!this.spec.forceWaitGatewayResponse||s?z.throw():r===jt.JOIN||r===jt.REJOIN?null:(await _(),await this.request(r,o))}if(S.isSuccess)return S.message;const R=Number(S.message.error_code||S.message.code),P=bT(R),k=new Oe(X.UNEXPECTED_RESPONSE,"".concat(P.desc,": ").concat(S.message.error_str),{code:R,data:S.message,desc:P.desc});return P.action==="success"?S.message:(D.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(r,", error_code: ").concat(R,", message: ").concat(P.desc,", action: ").concat(P.action)),R===Dt.ERR_TOO_MANY_BROADCASTERS?((r===jt.JOIN||r===jt.REJOIN)&&(this.initError=k,this.close()),k.throw()):P.action==="failed"?k.throw():P.action==="quit"?(this.initError=k,this.close(),k.throw()):(R===Dt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=S.message.option,D.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",So.MULTI_IP)):this.reconnect(P.action,So.SERVER_ERROR),r===jt.JOIN||r===jt.REJOIN?null:await this.request(r,o)))}waitMessage(r,o){return new lt(s=>{const c=u=>{(!o||o(u))&&(this.off(r,c),s(u))};this.on(r,c)})}uploadWRTCStats(r){if(!this.store.sessionId)return void D.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const o={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:r};this.upload(vT.WRTC_STATS,o)}upload(r,o){const s={_type:r,_message:o};try{this.websocket.sendMessage(s)}catch{const u=re("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(s),this.uploadCache.length>u&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==lr.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},re("UPLOAD_CACHE_INTERVAL")||2e3))}}send(r,o){const s={_type:r,_message:o};this.websocket.sendMessage(s)}init(r){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new lt((o,s)=>{this.once(Bt.WS_CONNECTED,()=>o(this.joinResponse)),this.once(Bt.WS_CLOSED,c=>s(this.initError||new Oe(X.WS_ABORT,c))),this.connectionState=lr.CONNECTING,this.websocket.init(r).catch(s),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=r||jn.LEAVE,this.connectionState=lr.CLOSED,D.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(Bt.ABORT_P2P_EXECUTION);const r=await bo(this,Bt.REQUEST_JOIN_INFO),o=await this.request(jt.JOIN,r);if(!o)return this.emit(Bt.REPORT_JOIN_GATEWAY,oP.TIMEOUT,this.url||""),!1;this.joinResponse=o,this.emit(Bt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=lr.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new Oe(X.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const r=fT(this,Bt.REQUEST_REJOIN_INFO);r.token=this.reconnectToken;const o=await this.request(jt.REJOIN,r);return!!o&&(this.connectionState=lr.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),o.peers&&o.peers.forEach(s=>{this.emit(_n.ON_USER_ONLINE,{uid:s.uid}),s.audio&&this.emit(_n.ON_ADD_AUDIO_STREAM,{uid:s.uid,uint_id:s.uint_id,audio:!0,ssrcId:s.audio_ssrc}),s.video&&this.emit(_n.ON_ADD_VIDEO_STREAM,{uid:s.uid,uint_id:s.uint_id,video:!0,ssrcId:s.video_ssrc}),s.audio_mute?this.emit(_n.MUTE_AUDIO,{uid:s.uid}):this.emit(_n.UNMUTE_AUDIO,{uid:s.uid}),s.video_mute?this.emit(_n.MUTE_VIDEO,{uid:s.uid}):this.emit(_n.UNMUTE_VIDEO,{uid:s.uid}),s.audio_enable_local?this.emit(_n.ENABLE_LOCAL_AUDIO,{uid:s.uid}):this.emit(_n.DISABLE_LOCAL_AUDIO,{uid:s.uid}),s.video_enable_local?this.emit(_n.ENABLE_LOCAL_VIDEO,{uid:s.uid}):this.emit(_n.DISABLE_LOCAL_VIDEO,{uid:s.uid}),s.audio||s.video||this.emit(_n.ON_REMOVE_STREAM,{uid:s.uid,uint_id:s.uint_id})}),!0)}reconnect(r,o){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(r,o)}handleNotification(r){D.debug("[".concat(this.clientId,"] receive notification: "),r);const o=bT(r.code);if(r.code===28&&"detail"in r&&(D.info("[".concat(this.clientId,"] receive recover notification: "),r.detail),this.emit(Bt.RECOVER_NOTIFICATION,r.detail)),o.action!=="success"){if(o.action!=="failed")return o.action==="quit"?(o.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(jn.UID_BANNED),void this.close()):void this.reconnect(o.action,So.SERVER_ERROR);D.error("[".concat(this.clientId,"] ignore error: "),o.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const r=re("PING_PONG_TIME_OUT"),o=Date.now();this.pingpongTimeoutCount>=r&&(D.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(o-this.lastMsgTime,"ms")),o-this.lastMsgTime>re("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",So.TIMEOUT):this.request(jt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const s=Date.now()-o;this.rttRolling.add(s),re("REPORT_STATS")&&this.send(jt.PING_BACK,{pingpongElapse:s})}).catch(s=>{})}handleWsInflateData(){const{wsInflateLength:r,wsDeflateLength:o}=this.websocket.getWsInflateData();r!==0&&o!==0&&this.upload(vT.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:o,ws_inflate_length:r})}handleWebsocketEvents(){this.websocket.on(qt.RECONNECT_CREATE_CONNECTION,r=>{this.emit(Bt.WS_RECONNECT_CREATE_CONNECTION,r)}),this.websocket.on(qt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(qt.CLOSED,()=>{this.connectionState=lr.CLOSED}),this.websocket.on(qt.FAILED,()=>{this._disconnectedReason=jn.NETWORK_ERROR,this.connectionState=lr.CLOSED}),this.websocket.on(qt.RECONNECTING,r=>{this._websocketReconnectReason=r,this.joinResponse=void 0,this.connectionState===lr.CONNECTED?this.connectionState=lr.RECONNECTING:this.connectionState=lr.CONNECTING}),this.websocket.on(qt.WILL_RECONNECT,(r,o,s)=>{const c=fT(this,Bt.IS_P2P_DISCONNECTED),u=c||r!=="retry";c&&r==="retry"&&(D.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),r="tryNext",o=oP.P2P_DISCONNECTED),u&&(D.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(r)),this.emit(Bt.REPORT_JOIN_GATEWAY,o||oP.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(Bt.DISCONNECT_P2P)),s(r)}),this.websocket.on(qt.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(r=>{D.warning("[".concat(this.clientId,"] rejoin failed ").concat(r)),this.reconnect("tryNext",So.SERVER_ERROR)}):this.join().catch(r=>{if(this.emit(Bt.REPORT_JOIN_GATEWAY,r,this.url||""),r instanceof Oe){if(r.code===X.UNEXPECTED_RESPONSE&&r.data.code===Dt.ERR_NO_AUTHORIZED)return this.initError=new Oe(X.TOKEN_EXPIRE,"dynamic key expired"),void this.close(jn.TOKEN_EXPIRE);D.error("[".concat(this.clientId,"] join gateway request failed"),r.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",So.SERVER_ERROR):(this.initError=r,this.close())}})}),this.websocket.on(qt.REQUEST_NEW_URLS,(r,o)=>{bo(this,Bt.REQUEST_RECOVER,this.multiIpOption).then(r).catch(o)}),this.websocket.on(qt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(_n.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(zG.PRE_CONNECT_PC,()=>{this.emit(Bt.PRE_CONNECT_PC)})}}let ome=function(e){return e.NATIVE_RTC="native_rtc",e.NATIVE_RTM="native_rtm",e.WEB_RTC="web_rtc",e.WEB_RTM="web_rtm",e}({}),ci=function(e){return e[e.CHOOSE_SERVER=11]="CHOOSE_SERVER",e[e.CLOUD_PROXY=18]="CLOUD_PROXY",e[e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",e[e.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",e}({});function qG(e,r){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),o.push.apply(o,s)}return o}function aP(e){for(var r=1;r<arguments.length;r++){var o=arguments[r]!=null?arguments[r]:{};r%2?qG(Object(o),!0).forEach(function(s){$(e,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):qG(Object(o)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(o,s))})}return e}function Om(e){return e.match(/^[\.\:\d]+$/)?"".concat(e.replace(/[^\d]/g,"-"),".").concat(re("TURN_DOMAIN")):(D.debug("Cannot recognized as ip address: ".concat(e,", use as host")),e)}function Vx(e,r){e.addresses||(e.addresses=[]);const o=function(m,_){if(re("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return m.map(R=>{let{ip:P,port:k}=R;return{address:"".concat(P,":").concat(k)}});const y=re("GATEWAY_DOMAINS");let S=y[1]&&st(_).call(_,y[1])?1:0;return m.map(R=>{let{domain_prefix:P,port:k,ip:z}=R;if(P)return{address:"".concat(P,".").concat(y[S++%y.length],":").concat(k)};const U=/^[\.\:\d]+$/.test(z),V=U?"".concat(z.replace(/[^\d]/g,"-"),".").concat(y[S++%y.length],":").concat(k):"".concat(z,":").concat(k);return U||D.debug("Cannot recognized as ip address: ".concat(z,", use as host")),{ip:z,port:k,address:V}})}(e.addresses,r),s=Array.isArray(e.detail)&&e.detail[18];if(s&&typeof s=="string"){const m=s.split(";");for(let _=0;_<m.length;_++){var c;const y=es(c=m[_]).call(c);o[_]&&y&&(o[_].ip6=y)}}const u=e.detail&&e.detail.candidate;let h;if(u){const[m,_]=u.split(":");m&&_&&(h={port:Number(_),ip:m,address:"".concat(m,":").concat(_)})}return{gatewayAddrs:o,apGatewayAddress:h,uid:e.uid,cid:e.cid,cert:e.cert,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function nc(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function YG(e){const r=e._encoderConfig;if(!r)return{};const o={resolution:r.width&&r.height?"".concat(nc(r.width),"x").concat(nc(r.height)):void 0,maxVideoBW:r.bitrateMax,minVideoBW:r.bitrateMin};return typeof r.frameRate=="number"?(o.maxFrameRate=r.frameRate,o.minFrameRate=r.frameRate):r.frameRate&&(o.maxFrameRate=r.frameRate.max||r.frameRate.ideal||r.frameRate.exact||r.frameRate.min,o.minFrameRate=r.frameRate.min||r.frameRate.ideal||r.frameRate.exact||r.frameRate.max),o}function XG(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function wT(e,r){let o,s,c;switch(r){case ci.CHOOSE_SERVER:s=4096,c="choose server";break;case ci.CLOUD_PROXY:s=1048576,c="proxy";break;case ci.CLOUD_PROXY_5:s=4194304,c="proxy5";break;case ci.CLOUD_PROXY_FALLBACK:s=4194310,c="proxy fallback";break;default:throw new Oe(X.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(e.response_body.forEach(u=>{u.buffer&&u.buffer.flag===s&&(o={code:u.buffer.code,addresses:(u.buffer.edges_services||[]).map(h=>aP(aP({},h),{},{ticket:u.buffer.cert})),server_ts:e.enter_ts,uid:u.buffer.uid,cid:u.buffer.cid,cname:u.buffer.cname,detail:aP(aP({},u.buffer.detail),e.detail),flag:u.buffer.flag,opid:e.opid,cert:u.buffer.cert})}),!o)throw new Oe(X.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(c," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return o}async function JG(e,r){return await lt.all(e.addresses.map(async o=>({address:re("USE_TURN_IP")?o.ip:Om(o.ip),tcpport:o.port,udpport:o.port,username:r&&re("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?r.toString():To.username,password:r&&re("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await GL(r.toString()):To.password})))}function Fx(e,r){const o=r.getMediaStreamTrack(!0).getSettings(),s=r.videoHeight||o.height,c=r.videoWidth||o.width;return s&&c?Math.max(Math.min(s,c)/Math.min(nc(e.height),nc(e.width)),1):(D.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function km(e){let{candidateType:r,relayProtocol:o,type:s,address:c,port:u,protocol:h}=e;const m={candidateType:r,relayProtocol:o,protocol:h};if(s!=="local-candidate"){const _=c.split(".");_.length>=4&&(_[1]="*",_[2]="*"),m.address=_.join("."),m.port=u}return m}function cP(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:re("SVC_MODE");if(re("ENABLE_SVC"))return function(r){return r in UA}(e)?e:UA.L1T3}const QG={[gt.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[gt.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function lP(e,r,o){r.forEach(s=>{var c;const u=QG[e].find(m=>{var _;let{key:y}=m;return st(_=s.extensionName).call(_,y)});if(!u)return;const h=o.find(m=>{let{extensionName:_}=m;return st(_).call(_,u.key)});h&&st(c=h.extensionName).call(c,"gdpr_forbidden")&&(s.extensionName=h.extensionName)})}function Kv(e,r){r.forEach(o=>{var s;const c=QG[e].find(u=>{var h;let{key:m}=u;return st(h=o.extensionName).call(h,m)});st(s=o.extensionName).call(s,"gdpr_forbidden")&&c&&(o.extensionName=c.extensionName)})}function ZG(e){return e==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"||st(e).call(e,"abs-send-time")}function uP(e){return e==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"||st(e).call(e,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function eH(e,r){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),o.push.apply(o,s)}return o}function tH(e){for(var r=1;r<arguments.length;r++){var o=arguments[r]!=null?arguments[r]:{};r%2?eH(Object(o),!0).forEach(function(s){$(e,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):eH(Object(o)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(o,s))})}return e}function RT(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=arguments.length>3?arguments[3]:void 0;const{filterRTX:c,filterVideoFec:u,filterAudioFec:h,filterAudioCodec:m,filterVideoCodec:_}=r,{useXR:y}=o;let S=[],R=[],P=[],k=[],z=!1,U=!1;if(Sa(e).mediaDescriptions.forEach(q=>{s&&s!==q.attributes.direction||(q.media.mediaType!=="video"||z||(R=q.attributes.payloads,k=q.attributes.extmaps,z=!0),q.media.mediaType!=="audio"||U||(S=q.attributes.payloads,P=q.attributes.extmaps,U=!0))}),!k||R.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!P||S.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(R.forEach(q=>{var Y;(Y=q.rtpMap)!==null&&Y!==void 0&&Y.clockRate&&(q.rtpMap.clockRate=parseInt(q.rtpMap.clockRate)),y&&q.rtcpFeedbacks.push({type:"rrtr"})}),S.forEach(q=>{var Y;(Y=q.rtpMap)!==null&&Y!==void 0&&Y.clockRate&&(q.rtpMap.clockRate=parseInt(q.rtpMap.clockRate)),y&&q.rtcpFeedbacks.push({type:"rrtr"})}),c&&(S=S.filter(q=>{var Y;return((Y=q.rtpMap)===null||Y===void 0?void 0:Y.encodingName.toLowerCase())!=="rtx"}),R=R.filter(q=>{var Y;return((Y=q.rtpMap)===null||Y===void 0?void 0:Y.encodingName.toLowerCase())!=="rtx"})),u&&(R=R.filter(q=>{var Y;return!/(red)|(ulpfec)|(flexfec)/i.test(((Y=q.rtpMap)===null||Y===void 0?void 0:Y.encodingName)||"")})),h&&(S=S.filter(q=>{var Y;return!/(red)|(ulpfec)|(flexfec)/i.test(((Y=q.rtpMap)===null||Y===void 0?void 0:Y.encodingName)||"")})),m&&(m==null?void 0:m.length)>0&&(S=S.filter(q=>{var Y;return st(m).call(m,((Y=q.rtpMap)===null||Y===void 0?void 0:Y.encodingName.toLowerCase())||"")})),_&&(_==null?void 0:_.length)>0){const q=R.filter(Y=>{var ce;return st(_).call(_,((ce=Y.rtpMap)===null||ce===void 0?void 0:ce.encodingName.toLowerCase())||"")});R=q.concat(c?[]:Wx(q,R))}const V=re("UNSUPPORTED_VIDEO_CODEC");return V&&V.length>0&&(R=R.filter(q=>!(q.rtpMap&&st(V).call(V,q.rtpMap.encodingName.toLowerCase())))),{audioCodecs:S,videoCodecs:R,audioExtensions:P,videoExtensions:k}}function Nm(e){const r=Sa(e);let o,s;for(const c of r.mediaDescriptions){if(!o){const u=c.attributes.iceUfrag,h=c.attributes.icePwd;if(!u||!h)throw new Error("Cannot get iceUfrag or icePwd from SDP.");o={iceUfrag:u,icePwd:h}}if(!s){const u=c.attributes.fingerprints;u.length>0&&(s={fingerprints:u})}}if(!s&&r.attributes.fingerprints.length>0&&(s={fingerprints:r.attributes.fingerprints}),!s||!o)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:o,dtlsParameters:s}}function nH(e,r){const o=[],s=e.attributes.ssrcGroups.filter(h=>h.semantic==="FID"),c=e.attributes.ssrcGroups.find(h=>h.semantic==="SIM"),u=e.attributes.ssrcs;if(c)c.ssrcIds.forEach(h=>{var m;const _=(m=s.find(y=>y.ssrcIds[0]===h))===null||m===void 0?void 0:m.ssrcIds[1];o.push({ssrcId:h,rtx:r?_:void 0})});else if(s.length>0){const h=s[0].ssrcIds[0],m=s[0].ssrcIds[1];o.push({ssrcId:h,rtx:r?m:void 0})}else{if(u.length===0)throw new Error("No ssrcs found on local media description.");o.push({ssrcId:u[0].ssrcId})}return o}function rH(e,r,o){const{cname:s}=e;let c=[];r&&(c=iH(r)),c.length===0&&(c=e.iceParameters.candidates.map(S=>({foundation:S.foundation,componentId:"1",transport:S.protocol,priority:S.priority.toString(),connectionAddress:S.ip,port:S.port.toString(),type:S.type,extension:{}})),D.debug("Using candidates from gateway."));const u={fingerprints:e.dtlsParameters.fingerprints.map(S=>({hashFunction:S.algorithm,fingerprint:S.fingerprint}))},h={iceUfrag:e.iceParameters.iceUfrag,icePwd:e.iceParameters.icePwd};let m;switch(e.dtlsParameters.role){case"server":m="passive";break;case"client":m="active";break;case"auto":m="actpass"}const _=hP(e.rtpCapabilities),y=[];return Array.isArray(o)&&o.length>0&&o.forEach(S=>{y.push({kind:gt.VIDEO,ssrcId:S.v,rtx:S.v_rtx,mslabel:"".concat(S.v,"_").concat(S.a)},{kind:gt.AUDIO,ssrcId:S.a,mslabel:"".concat(S.v,"_").concat(S.a)})}),{dtlsParameters:u,iceParameters:h,candidates:c,rtpCapabilities:_,setup:m,cname:s,preSSRCs:y}}function iH(e){let r=[];return e.ip&&typeof e.port=="number"&&(r=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip,port:e.port.toString(),type:"host",extension:{}}],D.debug("Using remote candidate from AP ".concat(e.ip,":").concat(e.port)),e.ip6&&(r.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip6,port:e.port.toString(),type:"host",extension:{}}),D.debug("Using IPV6 remote candidate from AP ".concat(e.ip6,":").concat(e.port)))),r}function U_(e,r,o){const s=[],c=[];return e.forEach(u=>{let{ssrcId:h,rtx:m}=u;const _=sr(8,"track-"),y={ssrcId:h,attributes:tH({label:_,mslabel:o=o||sr(10,""),msid:"".concat(o," ").concat(_)},r&&{cname:r})};if(s.push(y),m!==void 0){const S={ssrcId:m,attributes:tH({label:_,mslabel:o,msid:"".concat(o," ").concat(_)},r&&{cname:r})};s.push(S),c.push({semantic:"FID",ssrcIds:[h,m]})}}),e.length>1&&c.push({semantic:"SIM",ssrcIds:e.map(u=>{let{ssrcId:h}=u;return h})}),{ssrcs:s,ssrcGroups:c}}function qv(e,r){r instanceof Br&&e.attributes.payloads.forEach(o=>{var s;const c=(s=o.rtpMap)===null||s===void 0?void 0:s.encodingName.toLowerCase();if(!c||["opus","pcmu","pcma","g722"].indexOf(c)===-1)return;o.fmtp||(o.fmtp={parameters:{}}),o.fmtp.parameters.minptime="10",o.fmtp.parameters.useinbandfec="1";const u=r._encoderConfig;u&&c!=="pcmu"&&c!=="pcma"&&c!=="g722"&&(u.bitrate&&!Dr()&&(o.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*u.bitrate))),u.sampleRate&&(o.fmtp.parameters.maxplaybackrate="".concat(u.sampleRate),o.fmtp.parameters["sprop-maxcapturerate"]="".concat(u.sampleRate)),u.stereo&&(o.fmtp.parameters.stereo="1",o.fmtp.parameters["sprop-stereo"]="1"))})}function jx(e){const r=e.attributes.unrecognized.findIndex(o=>o.attField==="x-google-flag"&&o.attValue==="conference");r!==-1&&e.attributes.unrecognized.splice(r,1)}function Bx(e,r){var o;if(!(r instanceof mr&&r._encoderConfig&&r._hints.indexOf(ar.SCREEN_TRACK)===-1))return;const s=r._encoderConfig;kn().supportMinBitrate&&s.bitrateMin&&e.attributes.payloads.forEach(c=>{var u,h;st(u=["h264","h265","vp8","vp9","av1"]).call(u,((h=c.rtpMap)===null||h===void 0?void 0:h.encodingName.toLowerCase())||"")&&(c.fmtp||(c.fmtp={parameters:{}}),c.fmtp.parameters["x-google-min-bitrate"]="".concat(s.bitrateMin))}),kn().supportMinBitrate&&!st(o=r._hints).call(o,ar.LOW_STREAM)&&s.bitrateMax&&e.attributes.payloads.forEach(c=>{var u,h;st(u=["h264","h265","vp8","vp9","av1"]).call(u,((h=c.rtpMap)===null||h===void 0?void 0:h.encodingName.toLowerCase())||"")&&(c.fmtp||(c.fmtp={parameters:{}}),c.fmtp.parameters["x-google-start-bitrate"]="".concat(re("X_GOOGLE_START_BITRATE")||Math.floor(s.bitrateMax)))})}function oH(e){if(e.media.mediaType!=="video")return;const r=Rn();if(r.name!==Mn.SAFARI&&r.os!==Fi.IOS)return;const o=e.attributes.extmaps.findIndex(s=>/video-orientation/g.test(s.extensionName));o!==-1&&e.attributes.extmaps.splice(o,1)}function dP(e,r,o){if(!r)return;let s,c;if(e.media.mediaType==="video"?(s=o.videoExtensions,c=o.videoCodecs):(s=o.audioExtensions,c=o.audioCodecs),r.twcc===!0){const u=s.find(h=>uP(h.extensionName));if(u){const h=u.extensionName;e.attributes.extmaps.find(_=>uP(_.extensionName))||e.attributes.extmaps.push({entry:u.entry,extensionName:h}),function(_,y){return y.filter(S=>!!_.find(R=>R.payloadType===S.payloadType&&!!R.rtcpFeedbacks.find(P=>P.type==="transport-cc")))}(c,e.attributes.payloads).forEach(_=>{_.rtcpFeedbacks.find(y=>y.type==="transport-cc")||_.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(r.twcc===!1){const u=e.attributes.extmaps.findIndex(h=>uP(h.extensionName));u!==-1&&e.attributes.extmaps.splice(u,1),e.attributes.payloads.forEach(h=>{const m=h.rtcpFeedbacks.findIndex(_=>_.type==="transport-cc");m!==-1&&h.rtcpFeedbacks.splice(m,1)})}if(r.remb===!0){const u=s.find(h=>ZG(h.extensionName));if(u){const h=u.extensionName;e.attributes.extmaps.find(_=>_.extensionName===h)||e.attributes.extmaps.push({entry:u.entry,extensionName:h}),function(_,y){return y.filter(S=>!!_.find(R=>R.payloadType===S.payloadType&&!!R.rtcpFeedbacks.find(P=>P.type==="goog-remb")))}(c,e.attributes.payloads).forEach(_=>{_.rtcpFeedbacks.find(y=>y.type==="goog-remb")||_.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(r.remb===!1){const u=e.attributes.extmaps.findIndex(h=>ZG(h.extensionName));u!==-1&&e.attributes.extmaps.splice(u,1),e.attributes.payloads.forEach(h=>{const m=h.rtcpFeedbacks.findIndex(_=>_.type==="goog-remb");m!==-1&&h.rtcpFeedbacks.splice(m,1)})}}function sH(e,r,o){if(Dr()||e.media.mediaType!=="video"||!(r instanceof mr)||o!=="vp9"&&o!=="vp8"||o==="vp8"&&!re("SIMULCAST")||o==="vp9"&&re("ENABLE_SVC")||r._scalabilityMode===void 0||r._scalabilityMode.numSpatialLayers<=1)return;const s=o==="vp8"?2:r._scalabilityMode.numSpatialLayers,c=e.attributes.ssrcs[0],u=e.attributes.ssrcGroups.find(m=>m.semantic==="FID"&&m.ssrcIds[0]===c.ssrcId),h={semantic:"SIM",ssrcIds:[c.ssrcId]};for(let m=1;m<s;m++)e.attributes.ssrcs.push({ssrcId:c.ssrcId+m,attributes:Mr(c.attributes)}),h.ssrcIds.push(c.ssrcId+m),u&&(e.attributes.ssrcs.push({ssrcId:u.ssrcIds[1]+m,attributes:Mr(c.attributes)}),e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[c.ssrcId+m,u.ssrcIds[1]+m]}));e.attributes.ssrcGroups.unshift(h)}async function aH(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const o=new RTCPeerConnection;o.addTransceiver("video",{direction:"sendonly"}),o.addTransceiver("audio",{direction:"sendonly"}),o.addTransceiver("video",{direction:"recvonly"}),o.addTransceiver("audio",{direction:"recvonly"});const s=(await o.createOffer()).sdp,{send:c,recv:u,sendrecv:h}=function(){let m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},_=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},y=arguments.length>2?arguments[2]:void 0;const S=RT(y,m,_,"sendonly"),R=RT(y,m,_,"recvonly"),P={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},k={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},z={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(fu(S,R,"videoExtensions",P,k,z),fu(S,R,"videoCodecs",P,k,z),fu(S,R,"audioExtensions",P,k,z),fu(S,R,"audioCodecs",P,k,z),re("RAISE_H264_BASELINE_PRIORITY")){const U=[],V=[];z.videoCodecs.forEach((q,Y)=>{var ce;if(((ce=q.rtpMap)===null||ce===void 0?void 0:ce.encodingName.toLocaleLowerCase())==="h264"){var _e,Ee;const me=z.videoCodecs[Y+1],ke=me&&hH(q,me),Ye=(_e=q.fmtp)===null||_e===void 0?void 0:_e.parameters["profile-level-id"],ut=(Ee=q.fmtp)===null||Ee===void 0?void 0:Ee.parameters["packetization-mode"];!Ye||Ye!==re("FIRST_H264_PROFILE_LEVEL_ID")||re("FIRST_PACKETIZATION_MODE")&&ut!==re("FIRST_PACKETIZATION_MODE")?ke?V.push([q,me]):V.push([q]):ke?U.push([q,me]):U.push([q])}}),U.length>0&&V.length>0&&(D.debug("raising H264 baseline profile priority"),z.videoCodecs.forEach((q,Y)=>{var ce;if(((ce=q.rtpMap)===null||ce===void 0?void 0:ce.encodingName.toLocaleLowerCase())==="h264"){const _e=hH(q,z.videoCodecs[Y+1]),Ee=U.shift()||V.shift()||[];Ee.length>0&&(_e?z.videoCodecs.splice(Y,2,...Ee):z.videoCodecs.splice(Y,1,...Ee))}}),k.videoCodecs=k.videoCodecs.filter(q=>{var Y,ce;return!(((Y=q.rtpMap)===null||Y===void 0?void 0:Y.encodingName.toLocaleLowerCase())==="h264"&&((ce=q.fmtp)===null||ce===void 0?void 0:ce.parameters["profile-level-id"])!==re("FIRST_H264_PROFILE_LEVEL_ID"))}),re("FILTER_SEND_H264_BASELINE")&&(P.videoCodecs=P.videoCodecs.filter(q=>{var Y,ce;return!(((Y=q.rtpMap)===null||Y===void 0?void 0:Y.encodingName.toLocaleLowerCase())==="h264"&&((ce=q.fmtp)===null||ce===void 0?void 0:ce.parameters["profile-level-id"])!==re("FIRST_H264_PROFILE_LEVEL_ID"))})))}return{send:P,recv:k,sendrecv:z}}(e,r,s);try{o.close()}catch{}return{send:c,recv:u,sendrecv:h}}function cH(){const e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},r=RT(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),o={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},s={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(fu(e,r,"videoExtensions",o,s,c),fu(e,r,"videoCodecs",o,s,c),fu(e,r,"audioExtensions",o,s,c),fu(e,r,"audioCodecs",o,s,c),re("RAISE_H264_BASELINE_PRIORITY")){const u=c.videoCodecs.findIndex(h=>h.rtpMap&&h.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&h.fmtp&&h.fmtp.parameters["profile-level-id"]==="42001f");if(u!==-1){const h=c.videoCodecs.findIndex(m=>m.rtpMap&&m.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(h<u){D.debug("raising H264 baseline profile priority");const m=c.videoCodecs[u];c.videoCodecs.splice(u,1),c.videoCodecs.splice(h,0,m)}h!==-1&&(s.videoCodecs=s.videoCodecs.filter(m=>!(m.rtpMap&&m.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&m.fmtp&&m.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:o,recv:s,sendrecv:c}}function fu(e,r,o,s,c,u){if(o==="videoExtensions"||o==="audioExtensions"){const h=[];return e[o].forEach(m=>{r[o].some((_,y)=>{if(m.entry===_.entry&&m.extensionName===_.extensionName)return h.push(y),!0})?u[o].push(m):s[o].push(m)}),void r[o].forEach((m,_)=>{h.indexOf(_)===-1&&c[o].push(m)})}if(o==="videoCodecs"||o==="audioCodecs"){const h=[];return e[o].forEach(m=>{r[o].some((_,y)=>{if(m.payloadType===_.payloadType&&JSON.stringify(m)===JSON.stringify(_))return h.push(y),!0})?u[o].push(m):s[o].push(m)}),void r[o].forEach((m,_)=>{h.indexOf(_)===-1&&c[o].push(m)})}}function hP(e){const{send:r,recv:o,sendrecv:s}=e;if(!s){if(!r||!o)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:r,recv:o}}let c,u;return r?(c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c.audioCodecs=[...r.audioCodecs,...s.audioCodecs],c.videoCodecs=[...r.videoCodecs,...s.videoCodecs],c.audioExtensions=[...r.audioExtensions,...s.audioExtensions],c.videoExtensions=[...r.videoExtensions,...s.videoExtensions]):c=s,o?(u={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},u.audioCodecs=[...o.audioCodecs,...s.audioCodecs],u.videoCodecs=[...o.videoCodecs,...s.videoCodecs],u.audioExtensions=[...o.audioExtensions,...s.audioExtensions],u.videoExtensions=[...o.videoExtensions,...s.videoExtensions]):u=s,{send:c,recv:u}}function Yv(e){e.media.mediaType==="audio"&&e.attributes.payloads.filter(r=>{var o;return((o=r.rtpMap)===null||o===void 0?void 0:o.encodingName.toLowerCase())==="opus"}).forEach(r=>{r.fmtp||(r.fmtp={parameters:{}}),r.fmtp.parameters.stereo="1",r.fmtp.parameters["sprop-stereo"]="1"})}function CT(e,r,o,s){let c=[];if(e===gt.VIDEO){if(re("H264_PROFILE_LEVEL_ID")&&s==="h264"&&(c=r.videoCodecs.filter(u=>{var h;return st(h=u.rtpMap&&u.rtpMap.encodingName.toLowerCase()||"").call(h,s)&&u&&u.fmtp&&u.fmtp.parameters["profile-level-id"]===re("H264_PROFILE_LEVEL_ID")})),!Array.isArray(c)||c.length===0){let u=[];const h=[],m=[],_=[];if(o.videoCodecs.forEach(y=>{const S=y.rtpMap&&y.rtpMap.encodingName.toLowerCase()||"";st(S).call(S,s)?u.push(y):st(S).call(S,"vp9")?h.push(y):st(S).call(S,"vp8")?m.push(y):st(S).call(S,"h264")&&_.push(y)}),u.length===0){let y="";h.length!==0?(u=h,y="vp9"):m.length!==0?(u=m,y="vp8"):_.length!==0&&(u=_,y="h264"),D.warning("codec ".concat(s," not included in rtpCapabilities, fallback to default payloads: ").concat(y))}u.length!==0&&(c=r.videoCodecs.filter(y=>u.some(S=>S.payloadType===y.payloadType)))}if(c.length===0&&(D.warning("codec ".concat(s," not included in rtpCapabilities, fallback to default payloads: ").concat(r.videoCodecs[0].rtpMap&&r.videoCodecs[0].rtpMap.encodingName)),c=r.videoCodecs),re("USE_PUB_RTX")||re("USE_SUB_RTX")){const u=Wx(c,r.videoCodecs);c=[...c,...u]}}else c=r.audioCodecs.filter(u=>{var h;return st(h=u.rtpMap&&u.rtpMap.encodingName.toLowerCase()||"").call(h,s)}),c.length===0&&(D.warning("codec ".concat(s," not included in rtpCapabilities, fallback to opus")),c=r.audioCodecs.filter(u=>{var h;return st(h=u.rtpMap&&u.rtpMap.encodingName.toLowerCase()||"").call(h,"opus")}));return c}function Wx(e,r){const o=e.map(s=>s.payloadType.toString());return r.filter(s=>s.rtpMap&&s.rtpMap.encodingName==="rtx"&&s.fmtp&&s.fmtp.parameters.apt&&st(o).call(o,s.fmtp&&s.fmtp.parameters.apt))}async function IT(e,r,o){const s=r.toString(),c=uH(s,"offer","remote","exchangeSDP");await e.setRemoteDescription({type:"offer",sdp:s});const u=await e.createAnswer();if(!u.sdp)throw new Error("cannot get answer sdp");let h=u.sdp;h=lH(h,o||{}),c==null||c(h||""),await e.setLocalDescription({type:"answer",sdp:h})}function lH(e,r,o){const s=Sa(e),{useXR:c}=r;return s.mediaDescriptions.forEach(u=>{var h;u.attributes.mid&&(Array.isArray(o)&&!st(o).call(o,u.attributes.mid)||(u.media.mediaType==="audio"&&Yv(u),c&&st(h=["audio","video"]).call(h,u.media.mediaType)&&u.attributes.payloads.forEach(m=>{m.rtcpFeedbacks.findIndex(_=>_.type==="rrtr")===-1&&m.rtcpFeedbacks.push({type:"rrtr"})})))}),Im(s)}function uH(e,r,o,s){if(re("SDP_LOGGING"))return D.upload("exchanging ".concat(o," ").concat(r," SDP during P2PConnection.").concat(s,`
`),e),r==="offer"?c=>{uH(c,"answer",o==="local"?"remote":"local",s)}:void 0}function dH(e){const r=re("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(r)&&r.length>0)&&r.some(o=>st(e).call(e,o))}function hH(e,r){try{var o;return((o=e.fmtp)===null||o===void 0?void 0:o.parameters.apt)===r.payloadType.toString()}catch{return!1}}function fH(e,r){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),o.push.apply(o,s)}return o}function vl(e,r){return typeof re(e)===r?re(e):void 0}function sme(){try{const e=re("EXPERIMENTS")||{};return typeof e=="string"||Array.isArray(e)?{}:function(r){for(var o=1;o<arguments.length;o++){var s=arguments[o]!=null?arguments[o]:{};o%2?fH(Object(s),!0).forEach(function(c){$(r,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(s)):fH(Object(s)).forEach(function(c){Object.defineProperty(r,c,Object.getOwnPropertyDescriptor(s,c))})}return r}({},e)}catch(e){return D.debug("handle gateway attributes failed: ",e),{}}}const pH={};function Dm(e){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&D.debug("install service ".concat(e.name)),pH[e.name]=e}function Jf(e){const r=pH[e];if(!r)throw new Le(X.INVALID_OPERATION,"".concat(e," not found, please use AgoraRTC.use(").concat(e,"Service) to load it first"));return r}function mH(e,r){return Jf("DataStream").create(e,r)}function fP(){return Jf("InterceptFrame").create()}function gH(e,r){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),o.push.apply(o,s)}return o}function Qf(e){for(var r=1;r<arguments.length;r++){var o=arguments[r]!=null?arguments[r]:{};r%2?gH(Object(o),!0).forEach(function(s){$(e,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):gH(Object(o)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(o,s))})}return e}const zx=new Map;class ame extends Pr{get state(){return this._state}set state(r){if(r===this._state)return;const o=this._state;this._state=r,r==="DISCONNECTED"&&this._disconnectedReason?this.emit(Qi.CONNECTION_STATE_CHANGE,r,o,this._disconnectedReason):this.emit(Qi.CONNECTION_STATE_CHANGE,r,o)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(r){D.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(r)),this._joinGatewayStartTime=r}constructor(r,o){var s,c,u;super(),$(this,"store",void 0),$(this,"joinInfo",void 0),$(this,"key",void 0),$(this,"ntpOffset",0),$(this,"signal",void 0),$(this,"role",void 0),$(this,"inChannelInfo",{joinAt:null,duration:0}),$(this,"spec",void 0),$(this,"_state","DISCONNECTED"),$(this,"_statsCollector",void 0),$(this,"_disconnectedReason",void 0),$(this,"isSignalRecover",!1),$(this,"hasChangeBGPAddress",!1),$(this,"trafficStatsInterval",void 0),$(this,"networkQualityInterval",void 0),$(this,"_joinGatewayStartTime",0),$(this,"_signalTimeout",!1),$(this,"_clientRoleOptions",void 0),$(this,"_isProactiveJoin",!1),this.store=r,this.spec=o,this.signal=this.store.useP2P?(s={spec:Qf(Qf({},o),{},{retryConfig:o.websocketRetryConfig}),store:r},(c=(u=Jf("P2PChannel")).createSubmodule)===null||c===void 0?void 0:c.call(u,s)):new ime(Qf(Qf({},o),{},{retryConfig:o.websocketRetryConfig}),r),this._statsCollector=o.statsCollector,this.role=o.role||"audience",this._clientRoleOptions=o.clientRoleOptions,this.handleSignalEvents()}async join(r,o,s){this.store.joinGatewayStart(),r.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const c=Date.now();let u=zx.get(r.cname);if(u||(u=new Map,zx.set(r.cname,u)),this._isProactiveJoin=!0,u.has(r.uid)){const y=new Oe(X.UID_CONFLICT);throw wt.joinGateway(r.sid,{lts:c,succ:!1,ec:y.code,addr:null,uid:r.uid,cid:r.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!r.proxyServer,signalChannel:"0",preload:r.preload}),y}u.set(r.uid,!0),this.joinInfo=r,this.key=o;let h=0;this.joinGatewayStartTime=c;const m=r.proxyServer;try{D.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(h));const y=r.gatewayAddrs.map(S=>{let{address:R}=S;const[P,k]=R.split(":"),z={host:P,port:k};return r.proxyServer&&(z.proxy=r.proxyServer),z});h=(await this.signal.init(y)).uid,D.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(h," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(y){var _;throw D.error("[".concat(this.store.clientId,"] User join failed"),y.toString()),wt.joinGateway(r.sid,{lts:c,succ:!1,ec:((_=y.data)===null||_===void 0?void 0:_.desc)||y.code,errorMsg:y.message,addr:this.signal.url,uid:r.uid,cid:r.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!m,signalChannel:"0",preload:r.preload}),u.delete(r.uid),this.signal.close(),y}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),D.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(y=>{D.warning("[".concat(this.store.clientId,"] get traffic stats error"),y.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(Qi.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(Qi.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(Qi.NETWORK_QUALITY,{uplinkNetworkQuality:XG(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:XG(this._statsCollector.trafficStats.B_dnq)}):this.emit(Qi.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),h}async leave(){let r=arguments.length>0&&arguments[0]!==void 0&&arguments[0],o=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){o!==jn.FALLBACK&&(this.state="DISCONNECTING");try{r||this.signal.connectionState!==lr.CONNECTED||await function(s,c){return c===1/0?s:lt.race([s,Nfe(c)])}(this.signal.request(jt.LEAVE,void 0,!0),3e3)}catch(s){D.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),s)}this.signal.close(o),o!==jn.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(r,o,s){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const c={state:"offer",p2p_id:this.store.p2pId,ortc:o,mode:this.spec.mode,extend:re("PUB_EXTEND"),twcc:!!re("PUBLISH_TWCC"),rtx:!!re("USE_PUB_RTX")};try{return(await this.signal.request(jt.PUBLISH,c,!0))._message}catch(u){if(s&&u.data&&u.data.code===Dt.ERR_PUBLISH_REQUEST_INVALID)return D.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),u.toString()),await this.tryUnpubBeforeRepub(r,o),this.publish(r,o,!1);throw u}}async publishDataChannel(r,o,s){var c;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const u={stream_id:o.streamId,ordered:o.ordered?1:0,max_retrans_times:(c=o.maxRetransmits)!==null&&c!==void 0?c:10,channel_id:o.channelId,metadata:o.metadata};try{await this.signal.request(jt.PUBLISH_DATASTREAM,u,!0)}catch(h){if(s&&h.data&&h.data.code===Dt.ERR_PUBLISH_REQUEST_INVALID)return D.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),h.toString()),await this.tryUnpubDataChannelBeforeRepub(r,o),this.publishDataChannel(r,o,!1);throw h}}async unpublish(r,o){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(jt.UNPUBLISH,{stream_id:o,ortc:r},!0)}catch(s){D.warning("[".concat(this.store.clientId,"] unpublish warning: "),s)}}async unpublishDataChannel(r){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await lt.all(r.map(o=>this.signal.request(jt.UNPUBLISH_DATASTREAM,{channel_id:o},!0)))}catch(o){D.warning("unpublish datachannels warning: ",o)}}async presubscribe(r,o,s){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const c={stream_id:r,stream_type:o,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!re("SUBSCRIBE_TWCC"),rtx:!!re("USE_SUB_RTX")||void 0,extend:re("SUB_EXTEND"),svc:Array.isArray(re("SVC"))&&re("SVC").length!==0?re("SVC"):void 0};try{return await this.signal.request(jt.PRE_SUBSCRIBE,c,!0)}catch(u){if(s&&u.data&&u.data.code===Dt.ERR_SUBSCRIBE_REQUEST_INVALID)return D.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),u.toString()),this.presubscribe(r,o,!1);throw u}}async subscribe(r,o,s){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const c={stream_id:r,stream_type:o.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!re("SUBSCRIBE_TWCC"),rtx:!!re("USE_SUB_RTX"),extend:re("SUB_EXTEND"),ssrcId:o.ssrcId,svc:Array.isArray(re("SVC"))&&re("SVC").length!==0?re("SVC"):void 0};try{return(await this.signal.request(jt.SUBSCRIBE,c,!0))._message}catch(u){if(s&&u.data&&u.data.code===Dt.ERR_SUBSCRIBE_REQUEST_INVALID)return D.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),u.toString()),await this.tryUnsubBeforeResub(r,o),await this.subscribe(r,o,!1);throw u}}async subscribeDataChannel(r,o,s){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const c={uid:r,stream_id:o.id,channel_id:o.datachannelId};try{return void await this.signal.request(jt.SUBSCRIBE_DATASTREAM,c,!0)}catch(u){if(s&&u.data&&u.data.code===Dt.ERR_SUBSCRIBE_REQUEST_INVALID)return D.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),u.toString()),await this.tryUnsubDataChannelBeforeResub(r,o),await this.subscribeDataChannel(r,o,!1);throw u}}async subscribeAll(r,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const s={p2p_id:this.store.p2pId,users:r,dtx:!1,rtx:!!re("USE_SUB_RTX"),twcc:!!re("SUBSCRIBE_TWCC"),svc:Array.isArray(re("SVC"))&&re("SVC").length!==0?re("SVC"):void 0};try{return await this.signal.request(jt.SUBSCRIBE_STREAMS,s,!0)}catch(c){if(o&&c.data&&c.data.code===Dt.ERR_SUBSCRIBE_REQUEST_INVALID)return D.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),c.toString()),await this.tryMassUnsubBeforeResub(r),await this.subscribeAll(r,!1);throw c}}async setVideoProfile(r){const o=function(s){if(!(s.bitrateMax&&s.bitrateMin&&s.frameRate&&s.height&&s.width))return;let c=s.frameRate,u=s.width,h=s.height,m=!0;return typeof c!="number"&&(c=c.exact||c.ideal||c.max||c.min||0,c||(m=!1)),typeof u!="number"&&(u=u.exact||u.ideal||u.max||u.min||0,u||(m=!1)),typeof h!="number"&&(h=h.exact||h.ideal||h.max||h.min||0,c||(m=!1)),m?{stream_type:0,width:u,height:h,fps:c,start_bps:1e3*s.bitrateMax,min_bps:1e3*s.bitrateMin,target_bps:1e3*s.bitrateMax}:void 0}(r);if(o)return this.signal.request(jt.SET_VIDEO_PROFILE,o);D.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(r,o){try{await this.signal.request(jt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:r,stream_id:o},!0)}catch(s){D.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),s)}}async unsubscribeDataChannel(r,o){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await lt.all(r.map(s=>this.signal.request(jt.UNSUBSCRIBE_DATASTREAM,{stream_id:s,uid:o},!0)))}catch(s){D.warning("unsubscribeDataChannel warning: ",s)}}async massUnsubscribe(r){try{await this.signal.request(jt.UNSUBSCRIBE_STREAMS,r,!0)}catch(o){D.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),o)}}async reconnectPC(r){const{iceParameters:o,dtlsParameters:s,rtpCapabilities:c}=r;return{gatewayEstablishParams:await this.signal.request(jt.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:o,dtlsParameters:s,rtpCapabilities:c}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(jt.GATEWAY_INFO)}async renewToken(r){await this.signal.request(jt.RENEW_TOKEN,r),this.key=r.token}updateClientRole(r,o){o&&(this._clientRoleOptions=Object.assign({},o)),re("CLIENT_ROLE_OPTIONS")&&(D.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(re("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},re("CLIENT_ROLE_OPTIONS"))),this.role=r}async setClientRole(r,o){if(o&&(this._clientRoleOptions=Object.assign({},o)),re("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},re("CLIENT_ROLE_OPTIONS")),D.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(re("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),this.state!=="CONNECTED")return void(this.role=r);let s,c=0;r==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(s=this._clientRoleOptions.delay,c=1):c=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:c=0,await this.signal.request(jt.SET_CLIENT_ROLE,{role:r,level:c,delay:s,client_ts:Date.now()}),this.role=r}async setRemoteVideoStreamType(r,o){await this.signal.request(jt.SWITCH_VIDEO_STREAM,{stream_id:r,stream_type:o})}async setDefaultRemoteVideoStreamType(r){await this.signal.request(jt.DEFAULT_VIDEO_STREAM,{stream_type:r})}async setStreamFallbackOption(r,o){await this.signal.request(jt.SET_FALLBACK_OPTION,{stream_id:r,fallback_type:o})}async pickSVCLayer(r,o){await this.signal.request(jt.PICK_SVC_LAYER,{stream_id:r,spatial_layer:o.spatialLayer,temporal_layer:o.temporalLayer})}async setRTM2Flag(r){await this.signal.request(jt.SET_RTM2_FLAG,{rtm2_flag:r})}async sendExtensionMessage(r,o,s){if(this.store.useP2P)return this.signal.sendExtensionMessage(r,o,s)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),Qf({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(jt.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const r=zx.get(this.joinInfo.cname);r&&r.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const r=function(o){let s;return s=o.startsWith("dc")?o.match(/(dc\:\/\/)?([^:]+):(\d+)/):o.match(/(wss\:\/\/)?([^:]+):(\d+)/),s?{username:To.username,password:To.password,turnServerURL:s[2],tcpport:parseInt(s[3])+30,udpport:parseInt(s[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],r&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(Qf(Qf({},To),{},{turnServerURL:r.turnServerURL,tcpport:r.tcpport,udpport:r.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const r=await this.signal.request(jt.TRAFFIC_STATS,void 0,!0);r.timestamp=Date.now(),r.ntp_offset!=null&&(this.ntpOffset=r.ntp_offset),r.peer_delay.forEach(o=>{const s=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(c=>c.peer_uid===o.peer_uid);s&&s.B_st!==o.B_st&&DA(()=>{this.emit(Qi.STREAM_TYPE_CHANGE,o.peer_uid,o.B_st)})}),this._statsCollector.updateTrafficStats(r)}getJoinMessage(r){if(!this.joinInfo||!this.key)throw new Oe(X.UNEXPECTED_ERROR,"can not generate join message, no join info");const o=Object.assign({},this.joinInfo.apResponse);let s=re("REPORT_APP_SCENARIO");if(typeof s!="string")try{s=JSON.stringify(s)}catch{s=void 0}var c;s&&s.length>128&&(s=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(Qi.UPDATE_GATEWAY_CONFIG),c=this.store.clientId,st(Wv).call(Wv,c)||Wv.push(c);const u=!(Dr()||LW(87)||T8())&&typeof re("ENABLE_PRE_SUB")=="boolean"&&re("ENABLE_PRE_SUB"),h=!T8()&&vl("ENABLE_PREALLOC_PC","boolean"),m=sme(),_=cT(87)||function(){const S=Rn();if(S.name!==Mn.SAFARI||!S.browserVersion)return!1;const R=S.browserVersion.split(".");return Number(R[0])>15||Number(R[0])===15&&Number(R[1])>=4}(),y=Qf({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:gl,browser:navigator.userAgent,process_id:re("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:o,extend:re("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:s,attributes:{userAttributes:Qf({enableEncodedTransform:!!re("ENABLE_AUDIO_METADATA")&&_||!!re("ENABLE_AUDIO_TOPN")&&ML(Mn.CHROME,87,116)||void 0,enableAudioMetadata:!!re("ENABLE_AUDIO_METADATA")&&_,enableAudioPts:!!re("ENABLE_AUDIO_PTS_METADATA")&&_,topnSmoothLevel:re("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:re("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:re("TOPN_SWITCH_HOLD_MS"),topnAudioGain:re("TOPN_AUDIO_GAIN"),enablePublishedUserList:re("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:re("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:vl("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:vl("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:vl("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:re("USE_PUB_RTX")===!0||re("USE_SUB_RTX")===!0||void 0,disableFEC:re("DISABLE_FEC"),enableNTPReport:!!re("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:!!re("ENABLE_INSTANT_VIDEO")||void 0,enableFulllinkAvSync:!!re("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:vl("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!re("ENABLE_AUT_FEEDBACK")||void 0,rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!re("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:vl("USE_XR","boolean"),enableLossbasedBwe:vl("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!re("ENABLE_AUT_CC")||void 0,enableCCFallback:vl("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:h,preSubNum:u?vl("PRE_SUB_NUM","number"):void 0,enablePubTWCC:vl("PUBLISH_TWCC","boolean"),enableSubTWCC:vl("SUBSCRIBE_TWCC","boolean"),enablePubRTX:vl("USE_PUB_RTX","boolean"),enableSubRTX:vl("USE_SUB_RTX","boolean"),enableSubSVC:re("ENABLE_SVC")?re("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(re("SVC"))&&re("SVC").length!==0?re("SVC"):void 0,enableSvcExtended:re("ENABLE_SVC")&&Array.isArray(re("SVC_EXTENDED"))&&re("SVC_EXTENDED").length!==0?re("SVC_EXTENDED"):void 0},m)},join_ts:this.joinGatewayStartTime},r);return this.joinInfo.stringUid&&(y.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(y.aes_mode=this.joinInfo.aesmode,re("ENCRYPT_AES")?(y.aes_secret=this.joinInfo.aespassword,y.aes_encrypt=!0):y.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(y.aes_salt=this.joinInfo.aessalt)),o.addresses[this.signal.websocket.currentURLIndex]&&(y.ap_response.ticket=o.addresses[this.signal.websocket.currentURLIndex].ticket,delete o.addresses),this.joinInfo.defaultVideoStream!==void 0&&(y.default_video_stream=this.joinInfo.defaultVideoStream),y}getRejoinMessage(){if(!this.joinInfo)throw new Oe(X.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(Bt.WS_RECONNECT_CREATE_CONNECTION,r=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(Bt.WS_RECONNECTING,r=>{this.joinInfo&&wt.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:r||So.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",wt.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(Bt.WS_CLOSED,r=>{let o;switch(r){case jn.LEAVE:o=So.LEAVE;break;case jn.UID_BANNED:case jn.IP_BANNED:case jn.CHANNEL_BANNED:case jn.SERVER_ERROR:o=So.SERVER_ERROR;break;case jn.FALLBACK:o=So.FALLBACK;break;case jn.LICENSE_MISSING:case jn.LICENSE_EXPIRED:case jn.LICENSE_MINUTES_EXCEEDED:case jn.LICENSE_PERIOD_INVALID:case jn.LICENSE_MULTIPLE_SDK_SERVICE:case jn.LICENSE_ILLEGAL:case jn.TOKEN_EXPIRE:o=r;break;default:o=So.NETWORK_ERROR}D.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(o||"undefined -> "+So.NETWORK_ERROR)),this.joinInfo&&wt.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:r===jn.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:o}),this._disconnectedReason=r,r!==jn.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(Bt.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if(this.role==="audience"){const r=re("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;r&&(r.level||r.delay)&&(D.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(r.level,", delay: ").concat(r.delay)),this.setClientRole(this.role,r))}if(wt.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1){const r=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!r)return void D.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(r));Xn("EVENT_REPORT_DOMAIN",r[1]),Xn("EVENT_REPORT_BACKUP_DOMAIN",r[1]),Xn("LOG_UPLOAD_SERVER","".concat(r[1],":6444"))}}}),this.signal.on(_n.ON_UPLINK_STATS,r=>{this._statsCollector.updateUplinkStats(r)}),this.signal.on(Bt.REQUEST_RECOVER,(r,o,s)=>{if(!this.joinInfo)return s(new Oe(X.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));r&&(this.joinInfo.multiIP=r,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,bo(this,Qi.REQUEST_NEW_GATEWAY_LIST).then(o).catch(s)}),this.signal.on(Bt.REQUEST_JOIN_INFO,async(r,o,s)=>{var c;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void r(this.getJoinMessage({ortc:{}}));const u=Mr((c=this.joinInfo)===null||c===void 0?void 0:c.turnServer);if(re("NEW_TURN_MODE")&&u){let y=u.servers,S=u.serversFromGateway;const R=this.signal.currentURLIndex;y.length>0&&(y=[y[R%y.length]],u.servers=y),Array.isArray(S)&&S.length>0&&(S=[S[0]],u.serversFromGateway=S),D.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(R))}const{iceParameters:h,dtlsParameters:m,rtpCapabilities:_}=await bo(this,Qi.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:u});try{r(this.getJoinMessage({ortc:{iceParameters:h,dtlsParameters:m,rtpCapabilities:_,version:"2"}}))}catch(y){o(y)}}),this.signal.on(Bt.REQUEST_REJOIN_INFO,r=>{r(this.getRejoinMessage())}),this.signal.on(Bt.REPORT_JOIN_GATEWAY,(r,o)=>{if(!this.joinInfo)return;let s,c="";var u;r instanceof Oe?(s=((u=r.data)===null||u===void 0?void 0:u.desc)||r.code,c=r.message):s=r,wt.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:s,errorMsg:c,addr:o,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload})}),this.signal.on(Bt.IS_P2P_DISCONNECTED,r=>{r(fT(this,Qi.IS_P2P_DISCONNECTED))}),this.signal.on(Bt.DISCONNECT_P2P,()=>{this.emit(Qi.DISCONNECT_P2P)}),this.signal.on(Bt.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(Bt.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(Bt.JOIN_RESPONSE,r=>{const o=this.getCurrentGatewayAddress();this.emit(Qi.JOIN_RESPONSE,r,o)}),this.signal.on(Bt.PRE_CONNECT_PC,async()=>{if(this.joinInfo){this.updateTurnConfigFromSignal();const r=this.getCurrentGatewayAddress(),o=re("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(r&&o){const s=iH(r);this.emit(Qi.PRE_CONNECT_PC,{candidates:s,fingerprint:o})}}}),this.signal.on(Bt.RECOVER_NOTIFICATION,r=>{this.joinInfo&&typeof re("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat(re("AP_REQUEST_DETAIL"),";").concat(r))})}async tryUnsubBeforeResub(r,o){try{await this.signal.request(jt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:r,ortc:[o]},!0)}catch(s){throw D.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),s),s}}async tryUnsubDataChannelBeforeResub(r,o){try{await this.signal.request(jt.UNSUBSCRIBE,{stream_id:o.id},!0)}catch(s){throw D.warning("unsubscribe datachannel warning",s),s}}async tryUnpubBeforeRepub(r,o){try{await this.signal.request(jt.UNPUBLISH,{stream_id:r,ortc:o},!0)}catch(s){throw D.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),s),s}}async tryUnpubDataChannelBeforeRepub(r,o){try{await this.signal.request(jt.UNPUBLISH_DATASTREAM,{channnel_id:o.channelId},!0)}catch(s){throw D.warning("unpublish datastream warning: ",s),s}}async tryMassUnsubBeforeResub(r){const o={users:r.map(s=>({stream_id:s.stream_id,stream_type:s.stream_type}))};try{await this.signal.request(jt.UNSUBSCRIBE_STREAMS,o,!0)}catch(s){throw D.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),s),s}}async muteLocal(r,o){const s={action:r.find(c=>c.stream_type===zn.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:r,stream_id:o};try{await this.signal.request(jt.CONTROL,s,!0,!0)}catch(c){throw D.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),c),c}}async unmuteLocal(r,o){const s={action:r.find(c=>c.stream_type===zn.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:r,stream_id:o};try{await this.signal.request(jt.CONTROL,s,!0,!0)}catch(c){throw D.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),c),c}}async muteRemote(r,o){const s={action:r===gt.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:o};try{await this.signal.request(jt.CONTROL,s,!0,!0)}catch(c){throw D.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),c),c}}async unmuteRemote(r,o){const s={action:r===gt.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:o};try{await this.signal.request(jt.CONTROL,s,!0,!0)}catch(c){throw D.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),c),c}}uploadWRTCStats(r){this.signal.uploadWRTCStats(r)}upload(r,o){this.signal.upload(r,o)}getSignalRTT(){return this.signal.rtt}async restartICE(r){const o={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:r};try{return await this.signal.request(jt.RESTART_ICE,o,!0)}catch(s){throw D.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),s),s}}reconnect(r,o){this.state==="CONNECTED"&&this.signal.reconnect(r||void 0,o||So.P2P_FAILED)}getCurrentGatewayAddress(){var r,o;if(!re("GATEWAY_WSS_ADDRESS"))return re("USE_CANDIDATE_FROM_AP_DETAIL")&&(r=this.joinInfo)!==null&&r!==void 0&&r.apGatewayAddress?(D.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(o=this.joinInfo)!==null&&o!==void 0&&o.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(r){await this.signal.request(jt.SET_PARAMETER,{enablePublishAudioFilter:r})}}let pP=0,Gx=0;function _d(e,r,o,s){return new lt((c,u)=>{r.timeout=r.timeout||re("HTTP_CONNECT_TIMEOUT"),r.responseType=r.responseType||"json",r.data&&!o?(r.data=JSON.stringify(r.data),pP+=fh(r.data)):o&&(r.data.size?pP+=r.data.size:r.data instanceof FormData?pP+=QW(r.data):pP+=fh(JSON.stringify(r.data))),r.headers=r.headers||{},r.headers["Content-Type"]=r.headers["Content-Type"]||"application/json",r.method="POST",r.url=e,Hs.request(r).then(h=>{typeof h.data=="string"?Gx+=fh(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?Gx+=h.data.byteLength:Gx+=fh(JSON.stringify(h.data)),s&&c({data:h.data,headers:h.headers}),c(h.data)}).catch(h=>{Hs.isCancel(h)?u(new Oe(X.OPERATION_ABORTED,"cancel token canceled")):h.code==="ECONNABORTED"?u(new Oe(X.NETWORK_TIMEOUT,h.message)):h.response?u(new Oe(X.NETWORK_RESPONSE_ERROR,h.response.status)):u(new Oe(X.NETWORK_ERROR,h.message))})})}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var e;function r(je){var ot=0;return function(){return ot<je.length?{done:!1,value:je[ot++]}:{done:!0}}}var o=typeof Object.defineProperties=="function"?Object.defineProperty:function(je,ot,bt){return je==Array.prototype||je==Object.prototype||(je[ot]=bt.value),je},s,c=function(je){je=[typeof globalThis=="object"&&globalThis,je,typeof window=="object"&&window,typeof self=="object"&&self,typeof a=="object"&&a];for(var ot=0;ot<je.length;++ot){var bt=je[ot];if(bt&&bt.Math==Math)return bt}throw Error("Cannot find global object")}(this);function u(je,ot){if(ot)e:{var bt=c;je=je.split(".");for(var We=0;We<je.length-1;We++){var x=je[We];if(!(x in bt))break e;bt=bt[x]}(ot=ot(We=bt[je=je[je.length-1]]))!=We&&ot!=null&&o(bt,je,{configurable:!0,writable:!0,value:ot})}}function h(je){return(je={next:je})[Symbol.iterator]=function(){return this},je}function m(je){var ot=typeof Symbol<"u"&&Symbol.iterator&&je[Symbol.iterator];return ot?ot.call(je):{next:r(je)}}if(u("Symbol",function(je){function ot(x,ie){this.A=x,o(this,"description",{configurable:!0,writable:!0,value:ie})}if(je)return je;ot.prototype.toString=function(){return this.A};var bt="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",We=0;return function x(ie){if(this instanceof x)throw new TypeError("Symbol is not a constructor");return new ot(bt+(ie||"")+"_"+We++,ie)}}),u("Symbol.iterator",function(je){if(je)return je;je=Symbol("Symbol.iterator");for(var ot="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),bt=0;bt<ot.length;bt++){var We=c[ot[bt]];typeof We=="function"&&typeof We.prototype[je]!="function"&&o(We.prototype,je,{configurable:!0,writable:!0,value:function(){return h(r(this))}})}return je}),typeof Object.setPrototypeOf=="function")s=Object.setPrototypeOf;else{var _;e:{var y={};try{y.__proto__={a:!0},_=y.a;break e}catch{}_=!1}s=_?function(je,ot){if(je.__proto__=ot,je.__proto__!==ot)throw new TypeError(je+" is not extensible");return je}:null}var S=s;function R(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function P(je){if(je.m)throw new TypeError("Generator is already running");je.m=!0}function k(je,ot){return je.h=3,{value:ot}}function z(je){this.g=new R,this.G=je}function U(je,ot,bt,We){try{var x=ot.call(je.g.j,bt);if(!(x instanceof Object))throw new TypeError("Iterator result "+x+" is not an object");if(!x.done)return je.g.m=!1,x;var ie=x.value}catch(de){return je.g.j=null,je.g.s(de),V(je)}return je.g.j=null,We.call(je.g,ie),V(je)}function V(je){for(;je.g.h;)try{var ot=je.G(je.g);if(ot)return je.g.m=!1,{value:ot.value,done:!1}}catch(bt){je.g.v=void 0,je.g.s(bt)}if(je.g.m=!1,je.g.l){if(ot=je.g.l,je.g.l=null,ot.F)throw ot.D;return{value:ot.return,done:!0}}return{value:void 0,done:!0}}function q(je){this.next=function(ot){return je.o(ot)},this.throw=function(ot){return je.s(ot)},this.return=function(ot){return function(bt,We){P(bt.g);var x=bt.g.j;return x?U(bt,"return"in x?x.return:function(ie){return{value:ie,done:!0}},We,bt.g.return):(bt.g.return(We),V(bt))}(je,ot)},this[Symbol.iterator]=function(){return this}}function Y(je,ot){return ot=new q(new z(ot)),S&&je.prototype&&S(ot,je.prototype),ot}if(R.prototype.o=function(je){this.v=je},R.prototype.s=function(je){this.l={D:je,F:!0},this.h=this.C||this.u},R.prototype.return=function(je){this.l={return:je},this.h=this.u},z.prototype.o=function(je){return P(this.g),this.g.j?U(this,this.g.j.next,je,this.g.o):(this.g.o(je),V(this))},z.prototype.s=function(je){return P(this.g),this.g.j?U(this,this.g.j.throw,je,this.g.o):(this.g.s(je),V(this))},u("Array.prototype.entries",function(je){return je||function(){return function(ot,bt){ot instanceof String&&(ot+="");var We=0,x=!1,ie={next:function(){if(!x&&We<ot.length){var de=We++;return{value:bt(de,ot[de]),done:!1}}return x=!0,{done:!0,value:void 0}}};return ie[Symbol.iterator]=function(){return ie},ie}(this,function(ot,bt){return[ot,bt]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var ce=function(je,ot){for(var bt=0;bt<je.length;bt++)ot(je[bt])},_e=function(je){return je.replace(/\r?\n|\r/g,`\r
`)},Ee=function(je,ot,bt){return ot instanceof Blob?(bt=bt!==void 0?bt+"":typeof ot.name=="string"?ot.name:"blob",ot.name===bt&&Object.prototype.toString.call(ot)!=="[object Blob]"||(ot=new File([ot],bt)),[String(je),ot]):[String(je),String(ot)]},me=function(je,ot){if(je.length<ot)throw new TypeError(ot+" argument required, but only "+je.length+" present.")},ke=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,Ye=ke.FormData,ut=ke.XMLHttpRequest&&ke.XMLHttpRequest.prototype.send,pt=ke.Request&&ke.fetch,vn=ke.navigator&&ke.navigator.sendBeacon,Sn=ke.Element&&ke.Element.prototype,cr=ke.Symbol&&Symbol.toStringTag;cr&&(Blob.prototype[cr]||(Blob.prototype[cr]="Blob"),"File"in ke&&!File.prototype[cr]&&(File.prototype[cr]="File"));try{new File([],"")}catch{ke.File=function(ot,bt,We){return ot=new Blob(ot,We||{}),Object.defineProperties(ot,{name:{value:bt},lastModified:{value:+(We&&We.lastModified!==void 0?new Date(We.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),cr&&Object.defineProperty(ot,cr,{value:"File"}),ot}}var Zr=function(je){return je.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},Wr=function(je){this.i=[];var ot=this;je&&ce(je.elements,function(bt){if(bt.name&&!bt.disabled&&bt.type!=="submit"&&bt.type!=="button"&&!bt.matches("form fieldset[disabled] *"))if(bt.type==="file"){var We=bt.files&&bt.files.length?bt.files:[new File([],"",{type:"application/octet-stream"})];ce(We,function(x){ot.append(bt.name,x)})}else bt.type==="select-multiple"||bt.type==="select-one"?ce(bt.options,function(x){!x.disabled&&x.selected&&ot.append(bt.name,x.value)}):bt.type==="checkbox"||bt.type==="radio"?bt.checked&&ot.append(bt.name,bt.value):(We=bt.type==="textarea"?_e(bt.value):bt.value,ot.append(bt.name,We))})};if((e=Wr.prototype).append=function(je,ot,bt){me(arguments,2),this.i.push(Ee(je,ot,bt))},e.delete=function(je){me(arguments,1);var ot=[];je=String(je),ce(this.i,function(bt){bt[0]!==je&&ot.push(bt)}),this.i=ot},e.entries=function je(){var ot,bt=this;return Y(je,function(We){if(We.h==1&&(ot=0),We.h!=3)return ot<bt.i.length?We=k(We,bt.i[ot]):(We.h=0,We=void 0),We;ot++,We.h=2})},e.forEach=function(je,ot){me(arguments,1);for(var bt=m(this),We=bt.next();!We.done;We=bt.next()){var x=m(We.value);We=x.next().value,x=x.next().value,je.call(ot,x,We,this)}},e.get=function(je){me(arguments,1);var ot=this.i;je=String(je);for(var bt=0;bt<ot.length;bt++)if(ot[bt][0]===je)return ot[bt][1];return null},e.getAll=function(je){me(arguments,1);var ot=[];return je=String(je),ce(this.i,function(bt){bt[0]===je&&ot.push(bt[1])}),ot},e.has=function(je){me(arguments,1),je=String(je);for(var ot=0;ot<this.i.length;ot++)if(this.i[ot][0]===je)return!0;return!1},e.keys=function je(){var ot,bt,We,x,ie=this;return Y(je,function(de){if(de.h==1&&(ot=m(ie),bt=ot.next()),de.h!=3)return bt.done?void(de.h=0):(We=bt.value,x=m(We),k(de,x.next().value));bt=ot.next(),de.h=2})},e.set=function(je,ot,bt){me(arguments,2),je=String(je);var We=[],x=Ee(je,ot,bt),ie=!0;ce(this.i,function(de){de[0]===je?ie&&(ie=!We.push(x)):We.push(de)}),ie&&We.push(x),this.i=We},e.values=function je(){var ot,bt,We,x,ie=this;return Y(je,function(de){if(de.h==1&&(ot=m(ie),bt=ot.next()),de.h!=3)return bt.done?void(de.h=0):(We=bt.value,(x=m(We)).next(),k(de,x.next().value));bt=ot.next(),de.h=2})},Wr.prototype._asNative=function(){for(var je=new Ye,ot=m(this),bt=ot.next();!bt.done;bt=ot.next()){var We=m(bt.value);bt=We.next().value,We=We.next().value,je.append(bt,We)}return je},Wr.prototype._blob=function(){var je="----formdata-polyfill-"+Math.random(),ot=[],bt="--"+je+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(We,x){return typeof We=="string"?ot.push(bt+Zr(_e(x))+`"\r
\r
`+_e(We)+`\r
`):ot.push(bt+Zr(_e(x))+'"; filename="'+Zr(We.name)+`"\r
Content-Type: `+(We.type||"application/octet-stream")+`\r
\r
`,We,`\r
`)}),ot.push("--"+je+"--"),new Blob(ot,{type:"multipart/form-data; boundary="+je})},Wr.prototype[Symbol.iterator]=function(){return this.entries()},Wr.prototype.toString=function(){return"[object FormData]"},Sn&&!Sn.matches&&(Sn.matches=Sn.matchesSelector||Sn.mozMatchesSelector||Sn.msMatchesSelector||Sn.oMatchesSelector||Sn.webkitMatchesSelector||function(je){for(var ot=(je=(this.document||this.ownerDocument).querySelectorAll(je)).length;0<=--ot&&je.item(ot)!==this;);return-1<ot}),cr&&(Wr.prototype[cr]="FormData"),ut){var Js=ke.XMLHttpRequest.prototype.setRequestHeader;ke.XMLHttpRequest.prototype.setRequestHeader=function(je,ot){Js.call(this,je,ot),je.toLowerCase()==="content-type"&&(this.B=!0)},ke.XMLHttpRequest.prototype.send=function(je){je instanceof Wr?(je=je._blob(),this.B||this.setRequestHeader("Content-Type",je.type),ut.call(this,je)):ut.call(this,je)}}pt&&(ke.fetch=function(je,ot){return ot&&ot.body&&ot.body instanceof Wr&&(ot.body=ot.body._blob()),pt.call(this,je,ot)}),vn&&(ke.navigator.sendBeacon=function(je,ot){return ot instanceof Wr&&(ot=ot._asNative()),vn.call(this,je,ot)}),ke.FormData=Wr}})();const AT=()=>{const e=re("AREAS");return e.length===0&&e.push(Un.GLOBAL),qa(e).call(e,(r,o,s)=>{const c=_H(o);return c?s===0?c:"".concat(r,",").concat(c):r},"")},_H=e=>e===Un.OVERSEA?"".concat(ko.ASIA,",").concat(ko.EUROPE,",").concat(ko.AFRICA,",").concat(ko.NORTH_AMERICA,",").concat(ko.SOUTH_AMERICA,",").concat(ko.OCEANIA):ko[e],cme=e=>{const r={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return e.map(o=>{const s=sP[o],c=Object.keys(s);c&&c.map(u=>{u!=="CODE"&&(r[u]=r[u].concat(s[u]))})}),r},mP={GLOBAL:{ASIA:[Un.CHINA,Un.JAPAN,Un.INDIA,Un.KOREA,Un.HKMC],EUROPE:[],NORTH_AMERICA:[Un.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},gP=Object.keys(mP[Un.GLOBAL]),Hx=[Un.CHINA,Un.NORTH_AMERICA,Un.EUROPE,Un.ASIA,Un.JAPAN,Un.INDIA,Un.OCEANIA,Un.SOUTH_AMERICA,Un.AFRICA,Un.KOREA,Un.HKMC,Un.US],lme=function(e,r){let o=[];if(st(e).call(e,Un.GLOBAL)){const u=[Un.GLOBAL,Un.OVERSEA],h=Object.keys(sP);if(r===Un.GLOBAL)throw new Oe(X.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(r===Un.CHINA)o=[Un.OVERSEA];else if(c=r,st(gP).call(gP,c)){const m=(s=r,mP[Un.GLOBAL][s]||[]),_=[...u,r,...m];o=h.filter(y=>!st(_).call(_,y))}else if(function(m){let _=!1;return gP.forEach(y=>{var S;st(S=mP[Un.GLOBAL][y]).call(S,m)&&(_=!0)}),_}(r)){const m=function(y){let S;return gP.forEach(R=>{var P;st(P=mP[Un.GLOBAL][R]).call(P,y)&&(S=R)}),S}(r),_=[...u,m,r];o=h.filter(y=>!st(_).call(_,y))}else o=e;o=function(m){const _=[];return Hx.forEach(y=>{st(m).call(m,y)&&_.push(y)}),_.concat(m.filter(y=>!st(Hx).call(Hx,y)))}(o)}else o=e;var s,c;return o};function EH(e){var r,o;if(!e&&st(r=re("AREAS")).call(r,Un.EXTENSIONS))return D.debug("update area from ap : reset"),void $x(Epe,!0);if(!st(o=re("AREAS")).call(o,Un.GLOBAL)||!e)return;let s=sP.EXTENSIONS;s&&(s={CODE:_H(Un.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e,".agora.io"),"cds-ap-web-2-".concat(e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e,".agora.io"),"sua-ap-web-2-".concat(e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e,".agora.io"),"uap-ap-web-2-".concat(e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e,".agora.io")]},D.debug("update area from ap success: ".concat(e,",config is "),s),Xn("AREAS",[Un.EXTENSIONS],!0),Object.keys(s).map(c=>{c==="LOG_UPLOAD_SERVER"||c==="EVENT_REPORT_DOMAIN"||c==="EVENT_REPORT_BACKUP_DOMAIN"||c==="PROXY_SERVER_TYPE3"?Xn(c,s[c][0]):Xn(c,s[c])}))}function $x(e){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const o=wt.reportApiInvoke(null,{name:_i.SET_AREA,options:e,tag:xr.TRACER});try{let s=[];if(typeof e=="string"&&(s=[e]),Array.isArray(e)&&(e.forEach(u=>{if(!st(VG).call(VG,u))throw new Oe(X.INVALID_PARAMS,"invalid area code")}),s=e),Object.prototype.toString.call(e)==="[object Object]"){const{areaCode:u,excludedArea:h}=e;if(!u)throw new Oe(X.INVALID_PARAMS,"area code is needed");let m=u;typeof u=="string"&&(m=[u]),s=h?lme(m,h):m}if(!r){if(fd.AREAS){const u=new Oe(X.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return o.onError(u),void D.warning("setArea is prohibited because of config-distribute")}if(st(s).call(s,Un.GLOBAL)&&re("AREAS")===Un.EXTENSIONS){const u=new Oe(X.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return o.onError(u),void D.warning("setArea is prohibited because of ap extensions")}}Xn("AREAS",s,r);const c=cme(s);Object.keys(c).map(u=>{u==="LOG_UPLOAD_SERVER"||u==="EVENT_REPORT_DOMAIN"||u==="EVENT_REPORT_BACKUP_DOMAIN"||u==="PROXY_SERVER_TYPE3"?Xn(u,c[u][0]):Xn(u,c[u])}),D.debug("set area success:",s.join(","))}catch(s){throw o.onError(s),s}o.onSuccess()}function yH(e,r){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),o.push.apply(o,s)}return o}function yh(e){for(var r=1;r<arguments.length;r++){var o=arguments[r]!=null?arguments[r]:{};r%2?yH(Object(o),!0).forEach(function(s){$(e,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):yH(Object(o)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(o,s))})}return e}let Kx=1;function ume(e,r,o,s,c){Kx+=1;const u={sid:o.sid,command:"convergeAllocateEdge",uid:"666",appId:o.appId,ts:Math.floor(Date.now()/1e3),seq:Kx,requestId:Kx,version:gl,cname:o.cname},h={service_name:r,json_body:JSON.stringify(u)};let m,_,y=e[0];return hd(async()=>{m=Date.now();const S=await _d(y,{data:h,cancelToken:s,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(_=Date.now()-m,S.code!==0){const k=new Oe(X.UNEXPECTED_RESPONSE,"live streaming ap error, code"+S.code,{retry:!0,responseTime:_});throw D.error(k.toString()),k}const R=JSON.parse(S.json_body);if(R.code!==200){const k=new Oe(X.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(R.code,", reason: ").concat(R.reason),{code:R.code,responseTime:_});throw D.error(k.toString()),k}if(!R.servers||R.servers.length===0){const k=new Oe(X.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:R.code,responseTime:_});throw D.error(k.toString()),k}const P=function(k,z){return{addressList:k.servers.map(U=>"wss://".concat(U.address.replace(/\./g,"-"),".").concat(re("WORKER_DOMAIN"),":").concat(U.wss,"?serviceName=").concat(encodeURIComponent(z))),workerToken:k.workerToken,vid:k.vid}}(R,r);return re("LIVE_STREAMING_ADDRESS")&&(P.addressList=re("LIVE_STREAMING_ADDRESS")instanceof Array?re("LIVE_STREAMING_ADDRESS"):[re("LIVE_STREAMING_ADDRESS")]),yh(yh({},P),{},{responseTime:_})},(S,R)=>(wt.apworkerEvent(o.sid,{success:!0,sc:200,serviceName:r,responseDetail:JSON.stringify(S.addressList),firstSuccess:R===0,responseTime:_,serverIp:e[R%e.length]}),!1),(S,R)=>(wt.apworkerEvent(o.sid,{success:!1,sc:S.data&&S.data.code||200,serviceName:r,responseTime:_,serverIp:e[R%e.length]}),!!(S.code!==X.OPERATION_ABORTED&&S.code!==X.UNEXPECTED_RESPONSE||S.data&&S.data.retry)&&(y=e[(R+1)%e.length],!0)),c)}let qx=1;function vH(e,r,o,s){let{url:c,areaCode:u}=e;const{clientId:h,sid:m}=r,_=Date.now();let y;const S=r.role,[R,P]=Xx(r,u,[ci.CHOOSE_SERVER]);let k=ai.networkState;return hd(async()=>{k&&ai.networkState===tc.OFFLINE&&ai.onlineWaiter&&await lt.race([ai.onlineWaiter,io(s&&s.maxRetryTimeout||Ei.maxRetryTimeout)]),k=ai.networkState;const{data:z,headers:U}=await _d(c,{data:R,cancelToken:o,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);y=U.http3==="1"?1:-1,wt.reportResourceTiming(c,m),bH(z,c,r,_,[ci.CHOOSE_SERVER],y);const V=wT(z,ci.CHOOSE_SERVER);return Yx(V),Vx(V,c)},z=>(z&&wt.joinChooseServer(m,{role:S,lts:_,succ:!0,csAddr:c,opid:P,serverList:z.gatewayAddrs.map(U=>U.address),ec:null,cid:z.cid.toString(),uid:z.uid.toString(),csIp:z.csIp,unilbsServerIds:[ci.CHOOSE_SERVER].toString(),isHttp3:y,corssRegionTagReq:r.apRequestDetail,corssRegionTagRes:z.res.detail&&z.res.detail[38]}),!1),z=>z.code!==X.OPERATION_ABORTED&&(z.code===X.CAN_NOT_GET_GATEWAY_SERVER?z.data.retry:(wt.joinChooseServer(m,{role:S,lts:_,succ:!1,csAddr:c,serverList:null,opid:P,ec:z.code,csIp:z.data&&z.data.csIp,unilbsServerIds:[ci.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:k}),isHttp3:y,corssRegionTagReq:r.apRequestDetail}),D.warning("[".concat(h||"sid-".concat(m.slice(0,6)),"] Choose server network error, retry"),z),!0)),s)}function SH(e,r,o,s){let c,{url:u,areaCode:h,serviceIds:m}=e;const _=Date.now(),y=r.role,[S,R]=Xx(r,h,m);let P;return hd(async()=>{P&&ai.networkState===tc.OFFLINE&&ai.onlineWaiter&&await lt.race([ai.onlineWaiter,io(s&&s.maxRetryTimeout||Ei.maxRetryTimeout)]),P=ai.networkState;const{data:k,headers:z}=await _d(u,{data:S,cancelToken:o,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);c=z.http3==="1"?1:-1,wt.reportResourceTiming(u,r.sid),bH(k,u,r,_,m,c);const U=wT(k,ci.CHOOSE_SERVER),V=wT(k,r.cloudProxyServer==="proxy5"?ci.CLOUD_PROXY_5:r.cloudProxyServer==="proxy3"||r.cloudProxyServer==="proxy4"?ci.CLOUD_PROXY:ci.CLOUD_PROXY_FALLBACK);return Yx(U),{gatewayInfo:Vx(U,u),proxyInfo:V,url:u}},k=>(k.gatewayInfo&&wt.joinChooseServer(r.sid,{role:y,lts:_,succ:!0,csAddr:u,serverList:k.gatewayInfo.gatewayAddrs.map(z=>z.address),ec:null,opid:R,cid:k.gatewayInfo.cid.toString(),uid:k.gatewayInfo.uid.toString(),csIp:k.gatewayInfo.csIp,unilbsServerIds:m.toString(),isHttp3:c,corssRegionTagReq:r.apRequestDetail,corssRegionTagRes:k.gatewayInfo.res.detail&&k.gatewayInfo.res.detail[38]}),k.proxyInfo&&wt.joinWebProxyAP(r.sid,{lts:_,sucess:1,apServerAddr:u,turnServerAddrList:k.proxyInfo.addresses.map(z=>z.ip).join(","),errorCode:null,eventType:r.cloudProxyServer,unilbsServerIds:m.toString()}),!1),k=>k.code!==X.OPERATION_ABORTED&&(k.code===X.CAN_NOT_GET_GATEWAY_SERVER?k.data.retry:(wt.joinWebProxyAP(r.sid,{lts:_,sucess:0,apServerAddr:u,turnServerAddrList:null,errorCode:k.code,eventType:r.cloudProxyServer,unilbsServerIds:m.toString(),extend:JSON.stringify({networkState:P})}),D.warning("[".concat(r.clientId,"] multi unilbs network error, retry"),k),!0)),s)}const bH=(e,r,o,s,c,u)=>{const{sid:h,clientId:m,cloudProxyServer:_}=o,y=[],S=R=>{R.flag===4096?wt.joinChooseServer(h,{role:o.role,lts:s,succ:!1,csAddr:r,opid:e.opid,serverList:null,ec:R.error.message,csIp:R.error.data&&R.error.data.csIp,unilbsServerIds:c.toString(),isHttp3:u,corssRegionTagReq:o.apRequestDetail}):R.flag!==1048576&&R.flag!==4194304&&R.flag!==4194310||wt.joinWebProxyAP(h,{lts:s,sucess:0,apServerAddr:r,turnServerAddrList:null,errorCode:R.error.code,eventType:_,unilbsServerIds:c.toString()})};if(e.response_body.forEach(R=>{const P=R.buffer.code;if(R.uri===23&&P===0&&!R.buffer.edges_services)if(R.buffer.flag===4194310)D.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),R.buffer.edges_services=[];else{const k={error:new Oe(X.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:R.buffer.flag};y.push(k),S(k)}if(P!==0){const k=$v(P),z={error:new Oe(X.CAN_NOT_GET_GATEWAY_SERVER,k.desc,{desc:k.desc,retry:k.retry,csIp:e.detail[502]}),flag:R.buffer.flag};R.buffer.flag===4194310?D.warning(z.error.toString()):y.push(z),S(z)}}),y.length)throw D.warning("[".concat(m||"sid-".concat(h.slice(0,6)),"] multi unilbs ").concat(r," failed, ").concat(y.map(R=>"flag: ".concat(R.flag,", message: ").concat(R.error.message,", retry: ").concat(R.error.data.retry)).join(" | "))),new Oe(X.CAN_NOT_GET_GATEWAY_SERVER,y.map(R=>"flag: ".concat(R.flag,", message: ").concat(R.error.message)).join(" | "),{retry:!!y.find(R=>R.error.data.retry),csIp:e.detail[502],desc:[...new Set(y.map(R=>{var P;return R==null||(P=R.error)===null||P===void 0||(P=P.data)===null||P===void 0?void 0:P.desc}).filter(R=>!!R))]})},Yx=e=>{var r,o,s,c;if(e.addresses&&e.addresses.length===0&&e.code===0)throw new Oe(X.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if(re("AP_AREA")&&((s=e.detail)!==null&&s!==void 0&&s[23]&&typeof((c=e.detail)===null||c===void 0?void 0:c[23])=="string"?EH(e.detail[23].toLowerCase()):EH()),(r=e.detail)!==null&&r!==void 0&&r[19]&&typeof((o=e.detail)===null||o===void 0?void 0:o[19])=="string"){const h=e.detail[19],m=h==null?void 0:h.split(";");for(let _=0;_<m.length;_++){var u;const y=es(u=m[_]).call(u);e.addresses[_]&&m&&(e.addresses[_].fingerprint=y)}}if(re("GATEWAY_ADDRESS")&&re("GATEWAY_ADDRESS").length>0){D.debug("assign gateway address to",re("GATEWAY_ADDRESS"));const h=re("GATEWAY_ADDRESS").map(m=>{var _,y;const S=(_=(y=e.addresses.find(R=>R.ip===m.ip&&R.port===m.port))===null||y===void 0?void 0:y.fingerprint)!==null&&_!==void 0?_:"";return{ip:m.ip,port:m.port,ticket:e.addresses[0]&&e.addresses[0].ticket,fingerprint:S}});e.addresses=h}},dme=(e,r)=>{if(e.response_body&&e.response_body.length){const o=e.response_body[0];if(o.buffer.code!==0){const s=$v(o.buffer.code);throw new Oe(X.UPDATE_TICKET_FAILED,"[".concat(o.buffer.code,"]: ").concat(s.desc),{retry:s.retry})}return o.buffer.ticket}throw D.debug("update ticket request received ap response without response body:",r),new Oe(X.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},Xx=(e,r,o)=>{const s=Math.floor(Math.random()*1e12),c=e.role==="host"?"1":e.role==="audience"?"2":void 0,u={appid:e.appId,client_ts:Date.now(),opid:s,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:yh(yh(yh({6:e.stringUid,11:r,12:re("USE_NEW_TOKEN")?"1":void 0},c?{17:c}:{}),{},{22:r},e.apRequestDetail?{33:e.apRequestDetail}:{}),e.apRTM?{26:"RTM2"}:{}),key:e.token,service_ids:o,uid:e.uid||0}}]};u.request_bodies.forEach(m=>{e.multiIP&&e.multiIP.gateway_ip&&(m.buffer.detail[5]=JSON.stringify({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))});const h=new FormData;return h.append("request",JSON.stringify(u)),[h,s]},hme=(e,r)=>{const o=Math.floor(Math.random()*1e12),s={appid:e.appId,client_ts:Date.now(),opid:o,sid:e.sid,request_bodies:[{uri:28,buffer:{cname:e.cname,detail:{1:"",6:e.stringUid,12:"1"},token:e.token,service_ids:r,uid:e.uid||0,edges_services:e.apResponse.addresses.map(u=>({ip:u.ip,port:u.port}))}}]},c=new FormData;return c.append("request",JSON.stringify(s)),[c,o]};let Xv=0;function Jv(e){return lt.all(e.map(r=>r.then(o=>{throw o},o=>o))).then(r=>{throw r},r=>r)}const PT=async e=>{let{fragementLength:r,referenceList:o,asyncMapHandler:s,allFailedhandler:c,promisesCollector:u}=e,h=0;const m=r;let _,y=0;const S=async()=>{const R=(()=>{const P=h*m,k=P+m;return o.slice(P,k).map(s)})();u&&u.push(...R);try{_=await Jv(R)}catch(P){if(y+=m,h++,!(y>=o.length))return void await S();c(P)}R.forEach(P=>P.cancel())};return await S(),_},TH=async e=>{let{referenceList:r,asyncMapHandler:o,closeFn:s}=e;const c=r.length;let u=0;const h=async()=>{const m=o(r.shift());try{return await m}catch(_){if(u++,u>=c||s!=null&&s(_))throw _;return h()}};return h()};async function Jx(e,r,o,s){return{gatewayInfo:await async function(u,h,m,_){let y=null;const S=[],R=async()=>{const k=re("WEBCS_DOMAIN").slice(0,re("AJAX_REQUEST_CONCURRENT")).map(V=>({url:u.proxyServer?"https://".concat(u.proxyServer,"/ap/?url=").concat(V+"/api/v2/transpond/webrtc?v=2"):"https://".concat(V,"/api/v2/transpond/webrtc?v=2"),areaCode:AT()})),z=_.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:k.map(V=>V.url)}),U=await PT({fragementLength:re("FRAGEMENT_LENGTH"),referenceList:k,asyncMapHandler:V=>(D.debug("[".concat(u.clientId,"] Connect to choose_server:"),V.url),vH(V,u,h,m)),allFailedhandler:V=>{throw _.recordJoinChannelService({endTs:Date.now(),status:"error",errors:V},z),V[0]},promisesCollector:S});return _.recordJoinChannelService({endTs:Date.now(),status:"success"},z),U},P=async()=>{if(await io(1e3),y!==null)return y;const k=re("WEBCS_DOMAIN_BACKUP_LIST").map(V=>({url:u.proxyServer?"https://".concat(u.proxyServer,"/ap/?url=").concat(V+"/api/v2/transpond/webrtc?v=2"):"https://".concat(V,"/api/v2/transpond/webrtc?v=2"),areaCode:AT()})),z=_.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:k.map(V=>V.url)}),U=await PT({fragementLength:re("FRAGEMENT_LENGTH"),referenceList:k,asyncMapHandler:V=>(D.debug("[".concat(u.clientId,"] Connect to backup choose_server:"),V.url),vH(V,u,h,m)),allFailedhandler:V=>{throw _.recordJoinChannelService({endTs:Date.now(),status:"error",errors:V},z),V[0]},promisesCollector:S});return _.recordJoinChannelService({endTs:Date.now(),status:"success"},z),U};try{return y=await Jv([R(),P()]),S.length&&S.forEach(k=>k.cancel&&typeof k.cancel=="function"&&k.cancel()),y}catch(k){throw k[0]}}(e,r,o,s)}}async function wH(e,r,o,s,c){const u=e.cloudProxyServer;if(u==="disabled"){if(e.useLocalAccessPoint)return await Jx(e,r,o,c);if(re("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:P,proxyInfo:k}=await IH(e,r,o,c);if(e.turnServer&&e.turnServer.mode!=="auto")return{gatewayInfo:P};const z=k.map(U=>({turnServerURL:U.address,tcpport:U.tcpport||To.tcpport,udpport:U.udpport||To.udpport,username:U.username||To.username,password:U.password||To.password,forceturn:!1,security:!0}));if(c.useP2P){var h;const U=(h=e.uid)!==null&&h!==void 0?h:P.uid,V="glb:".concat(U.toString()),q=await GL(V),Y=k.map(ce=>({turnServerURL:ce.address,tcpport:ce.tcpport||To.tcpport,udpport:ce.udpport||To.udpport,username:V,password:q,forceturn:!1,security:!0}));z.push(...Y)}return e.turnServer={mode:"manual",servers:z},{gatewayInfo:P}}return await Jx(e,r,o,c)}const{proxyInfo:m,gatewayInfo:_}=await IH(e,r,o,c),y={gatewayInfo:_},S=m.map(P=>({turnServerURL:P.address,tcpport:u==="proxy3"?void 0:P.tcpport?P.tcpport:To.tcpport,udpport:u==="proxy4"?void 0:P.udpport?P.udpport:To.udpport,username:P.username||To.username,password:P.password||To.password,forceturn:u!=="proxy4",security:u==="proxy5"}));if(c.useP2P){var R;const P=(R=e.uid)!==null&&R!==void 0?R:_.uid,k="glb:".concat(P.toString()),z=await GL(k),U=m.map(V=>({turnServerURL:V.address,tcpport:u==="proxy3"?void 0:V.tcpport||To.tcpport,udpport:u==="proxy4"?void 0:V.udpport||To.udpport,username:k,password:z,forceturn:u!=="proxy4",security:u==="proxy5"}));S.push(...U)}return e.turnServer={mode:"manual",servers:S},D.debug("[".concat(e.clientId,"] set proxy server: ").concat(e.proxyServer,", mode: ").concat(u)),y}async function RH(e,r,o,s,c){const u=re("ACCOUNT_REGISTER").slice(0,re("AJAX_REQUEST_CONCURRENT"));let h=[];h=r.proxyServer?u.map(_=>"https://".concat(r.proxyServer,"/ap/?url=").concat(_+"/api/v1")):u.map(_=>"https://".concat(_,"/api/v1"));const m=c==null?void 0:c.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:h});try{const _=await async function(y,S,R,P,k){const z=Date.now(),U={sid:R.sid,opid:10,appid:R.appId,string_uid:S};let V=y[0];const q=await hd(()=>_d(V+"".concat(V.indexOf("?")===-1?"?":"&","action=stringuid"),{data:U,cancelToken:P,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(Y,ce)=>{if(Y.code===0){if(Y.uid<=0||Y.uid>=Math.pow(2,32))throw D.error("Invalid Uint Uid ".concat(S," => ").concat(Y.uid),Y),wt.reqUserAccount(U.sid,{lts:z,success:!1,serverAddr:V,stringUid:U.string_uid,uid:Y.uid,errorCode:X.INVALID_UINT_UID_FROM_STRING_UID,extend:U}),new Oe(X.INVALID_UINT_UID_FROM_STRING_UID);return wt.reqUserAccount(U.sid,{lts:z,success:!0,serverAddr:V,stringUid:U.string_uid,uid:Y.uid,errorCode:null,extend:U}),!1}const _e=$v(Y.code);return _e.retry&&(V=y[(ce+1)%y.length]),wt.reqUserAccount(U.sid,{lts:z,success:!1,serverAddr:V,stringUid:U.string_uid,uid:Y.uid,errorCode:_e.desc,extend:U}),_e.retry},(Y,ce)=>Y.code!==X.OPERATION_ABORTED&&(wt.reqUserAccount(U.sid,{lts:z,success:!1,serverAddr:V,stringUid:U.string_uid,uid:null,errorCode:Y.code,extend:U}),V=y[(ce+1)%y.length],!0),k);if(q.code!==0){const Y=$v(q.code);throw new Oe(X.UNEXPECTED_RESPONSE,Y.desc)}return q}(h,e,r,o,s);return c==null||c.recordJoinChannelService({status:"success",endTs:Date.now()},m),_.uid}catch(_){throw c==null||c.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[_]},m),_}}async function fme(e,r,o){const s=re("ACCOUNT_REGISTER");let c=[];c=r.proxyServer?s.map(u=>"https://".concat(r.proxyServer,"/ap/?url=").concat(u+"/api/v1")):s.map(u=>"https://".concat(u,"/api/v1"));try{return await TH({referenceList:c,asyncMapHandler:h=>async function(m,_,y,S){const R=Date.now(),P={sid:y.sid,opid:10,appid:y.appId,string_uid:_};try{const k=await _d(m+"".concat(m.indexOf("?")===-1?"?":"&","action=stringuid"),{data:P,cancelToken:S,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(k.code!==0){const z=$v(k.code);throw new Oe(X.UNEXPECTED_RESPONSE,"preload sua error:".concat(z.desc),z)}if(k.uid<=0||k.uid>=Math.pow(2,32))throw new Oe(X.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:R,url:m,req:P,uid:k.uid,elapse:Date.now()-R}}catch(k){throw k}}(h,e,r,o),closeFn:h=>h.code===X.OPERATION_ABORTED||h.code===X.UNEXPECTED_RESPONSE&&!h.data.retry})}catch(u){throw u}}async function pme(e,r,o){const s=re("CDS_AP").slice(0,re("AJAX_REQUEST_CONCURRENT")).map(_=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(_+"/api/v1"):"https://".concat(_,"/api/v1?action=config")),c=s.map(_=>function(y,S,R,P){const k=Rn(),z={flag:64,cipher_method:0,features:yh(yh(yh(yh(yh({install_id:tx(),device:k.name,system:k.os,system_general:navigator.userAgent,vendor:S.appId,version:gl,cname:S.cname,session_id:S.sid,proxyServer:S.proxyServer,sdk_type:ome.WEB_RTC,browser_name:k.name,browser_version:k.version,user_agent:navigator.userAgent,channel_name:S.cname},S.stringUid&&{string_uid:S.stringUid}),S.uid&&{uid:S.uid+""}),k.os&&{os_name:k.os}),k.osVersion&&{os_version:k.osVersion}),{},{detail:""})};return hd(()=>_d(y,{data:z,timeout:1e3,cancelToken:R,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,U=>U.code!==X.OPERATION_ABORTED,P)}(_,e,r,o));let u=null,h=null,m={};try{u=await Jv(c)}catch(_){if(_.code===X.OPERATION_ABORTED)throw _;h=_}if(c.forEach(_=>_.cancel()),wt.reportApiInvoke(e.sid,{name:_i.REQUEST_CONFIG_DISTRIBUTE,options:{error:h,res:u}}).onSuccess(),u&&u.test_tags)try{m=function(_){if(!_.test_tags)return{};const y=_.test_tags,S=Object.keys(y),R={};return S.forEach(P=>{var k;const z=es(k=P.slice(4)).call(k),U=JSON.parse(y[P]),V=U[1];R[z]={tag:U[0]||"",value:V}}),R}(u)}catch{}return m}async function CH(e,r){const o=re("WEBCS_DOMAIN").concat(re("WEBCS_DOMAIN_BACKUP_LIST")).map(s=>({url:"https://".concat(s,"/api/v2/transpond/webrtc?v=2"),areaCode:AT(),serviceIds:[ci.CHOOSE_SERVER,ci.CLOUD_PROXY_FALLBACK]}));try{return await TH({referenceList:o,asyncMapHandler:c=>async function(u,h,m){let _,{url:y,areaCode:S,serviceIds:R}=u;const P=Date.now(),[k,z]=Xx(h,S,R);let U=ai.networkState;try{U&&ai.networkState===tc.OFFLINE&&ai.onlineWaiter&&await lt.race([ai.onlineWaiter,io(Ei.maxRetryTimeout)]),U=ai.networkState;const{data:V,headers:q}=await _d(y,{data:k,cancelToken:m,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);_=q.http3==="1"?1:-1,(Ee=>{const me=[];if(Ee.response_body.forEach(ke=>{const Ye=ke.buffer.code;if(ke.uri===23&&Ye===0&&!ke.buffer.edges_services)if(ke.buffer.flag===4194310)ke.buffer.edges_services=[];else{const ut={error:new Oe(X.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:Ee.detail[502]}),flag:ke.buffer.flag};me.push(ut)}if(Ye!==0){const ut=$v(Ye),pt={error:new Oe(X.CAN_NOT_GET_GATEWAY_SERVER,ut.desc,{desc:ut.desc,retry:ut.retry,csIp:Ee.detail[502]}),flag:ke.buffer.flag};ke.buffer.flag===4194310?D.warning(pt.error.toString()):me.push(pt)}}),me.length)throw new Oe(X.CAN_NOT_GET_GATEWAY_SERVER,me.map(ke=>"flag: ".concat(ke.flag,", message: ").concat(ke.error.message)).join(" | "),{retry:!!me.find(ke=>ke.error.data.retry),csIp:Ee.detail[502],desc:[...new Set(me.map(ke=>{var Ye;return ke==null||(Ye=ke.error)===null||Ye===void 0||(Ye=Ye.data)===null||Ye===void 0?void 0:Ye.desc}).filter(ke=>!!ke))]})})(V);const ce=wT(V,ci.CHOOSE_SERVER),_e=wT(V,ci.CLOUD_PROXY_FALLBACK);return Yx(ce),{gatewayInfo:Vx(ce,y),proxyInfo:_e,opid:z,requestTime:P,url:y,isHttp3:_,elapse:Date.now()-P}}catch(V){throw V}}(c,e,r),closeFn:c=>c.code===X.OPERATION_ABORTED||c.code===X.CAN_NOT_GET_GATEWAY_SERVER&&!c.data.retry})}catch(s){throw s}}async function IH(e,r,o,s){const c=re("PROXY_SERVER_TYPE3"),u=(k,z,U)=>{let V=U||c;return Array.isArray(V)&&(V=z%2==0?c[1]:c[0]),"https://".concat(V,"/ap/?url=").concat(k)};let h=null;const m=[],_=async()=>{const k=re("WEBCS_DOMAIN").slice(0,re("AJAX_REQUEST_CONCURRENT")).map((V,q)=>{let Y;return Y=e.cloudProxyServer==="disabled"&&e.proxyServer?u("".concat(V,"/api/v2/transpond/webrtc?v=2"),q,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(V,"/api/v2/transpond/webrtc?v=2"):u("".concat(V,"/api/v2/transpond/webrtc?v=2"),q),{url:Y,areaCode:AT(),serviceIds:[ci.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?ci.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?ci.CLOUD_PROXY:ci.CLOUD_PROXY_FALLBACK]}}),z=s.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:k.map(V=>V.url)}),U=await PT({fragementLength:re("FRAGEMENT_LENGTH"),referenceList:k,asyncMapHandler:V=>(D.debug("[".concat(e.clientId,"] Connect to choose_server:"),V.url),SH(V,e,r,o)),allFailedhandler:V=>{throw s.recordJoinChannelService({endTs:Date.now(),status:"error",errors:V},z),V[0]},promisesCollector:m});return s.recordJoinChannelService({endTs:Date.now(),status:"success"},z),U},y=async()=>{if(await io(1e3),h!==null)return h;const k=re("WEBCS_DOMAIN_BACKUP_LIST").map((V,q)=>{let Y;return Y=e.cloudProxyServer==="disabled"&&e.proxyServer?u("".concat(V,"/api/v2/transpond/webrtc?v=2"),q,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(V,"/api/v2/transpond/webrtc?v=2"):u("".concat(V,"/api/v2/transpond/webrtc?v=2"),q),{url:Y,areaCode:AT(),serviceIds:[ci.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?ci.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?ci.CLOUD_PROXY:ci.CLOUD_PROXY_FALLBACK]}}),z=s.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:k.map(V=>V.url)}),U=await PT({fragementLength:re("FRAGEMENT_LENGTH"),referenceList:k,asyncMapHandler:V=>(D.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),V.url),SH(V,e,r,o)),allFailedhandler:V=>{throw s.recordJoinChannelService({endTs:Date.now(),status:"error",errors:V},z),V[0]},promisesCollector:m});return s.recordJoinChannelService({endTs:Date.now(),status:"success"},z),U};let S,R,P;try{({gatewayInfo:S,proxyInfo:R,url:P}=await Jv([_(),y()]))}catch(k){throw k[0]}if(m.length&&m.forEach(k=>k.cancel&&typeof k.cancel=="function"&&k.cancel()),!S||!R)throw new Oe(X.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(e.apUrl=P,e.cloudProxyServer!=="disabled"&&Array.isArray(c)&&P){const k=/^https?:\/\/(.+?)(\/.*)?$/.exec(P)[1];st(c).call(c,k)&&(e.proxyServer=k,D.setProxyServer(k),wt.setProxyServer(k))}return h={gatewayInfo:S,proxyInfo:await JG(R,S.uid)},h}async function mme(e,r,o){const s=re("UAP_AP").slice(0,re("AJAX_REQUEST_CONCURRENT")).map(u=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(u+"/api/v1?action=uap"):"https://".concat(u,"/api/v1?action=uap")),c=s.map(u=>function(h,m,_,y){const S={command:"convergeAllocateEdge",sid:m.sid,appId:m.appId,token:m.token,ts:Date.now(),version:gl,cname:m.cname,uid:m.uid.toString(),requestId:qx,seq:qx};qx+=1;const R={service_name:"tele_channel",json_body:JSON.stringify(S)};return hd(async()=>{const P=await _d(h,{data:R,cancelToken:_,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(P.code!==0){const z=new Oe(X.UNEXPECTED_RESPONSE,"cross channel ap error, code"+P.code,{retry:!0});throw D.error(z.toString()),z}const k=JSON.parse(P.json_body);if(k.code!==200){const z=new Oe(X.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(k.code,", reason: ").concat(k.reason));throw D.error(z.toString()),z}if(!k.servers||k.servers.length===0){const z=new Oe(X.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw D.error(z.toString()),z}return{vid:k.vid,workerToken:k.workerToken,addressList:(re("CHANNEL_MEDIA_RELAY_SERVERS")||k.servers).map(z=>"wss://".concat(z.address.replace(/\./g,"-"),".").concat(re("WORKER_DOMAIN"),":").concat(z.wss))}},void 0,P=>!!(P.code!==X.OPERATION_ABORTED&&P.code!==X.UNEXPECTED_RESPONSE||P.data&&P.data.retry),y)}(u,e,r,o));try{const u=await Jv(c);return c.forEach(h=>h.cancel()),u}catch(u){throw u[0]}}async function gme(e,r,o){let s=null;const c=[],u=async h=>{const m=re(h?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(_=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(_+"/api/v2/transpond/webrtc?v=2"):"https://".concat(_,"/api/v2/transpond/webrtc?v=2"));return h&&(await io(1e3),s!==null)?s:await PT({fragementLength:re("FRAGEMENT_LENGTH"),referenceList:m,asyncMapHandler:_=>(D.debug("[".concat(e.clientId,"] update ticket, Connect to ").concat(h?"backup":""," choose_server:"),_),function(y,S,R,P){const[k]=hme(S,[ci.CHOOSE_SERVER]);let z=ai.networkState;return hd(async()=>{z&&ai.networkState===tc.OFFLINE&&ai.onlineWaiter&&await lt.race([ai.onlineWaiter,io(P&&P.maxRetryTimeout||Ei.maxRetryTimeout)]),z=ai.networkState;const U=await _d(y,{data:k,cancelToken:R,headers:{"Content-Type":"multipart/form-data;"}},!0);return dme(U,y)},()=>!1,U=>U.code!==X.OPERATION_ABORTED&&(U.code===X.UPDATE_TICKET_FAILED?U.data.retry:(D.warning("[".concat(S.clientId,"] update ticket network error, retry"),U),!0)),P)}(_,e,r,o)),allFailedhandler:_=>{throw _[0]},promisesCollector:c})};try{return s=await Jv([u(!1),u(!0)]),c.length&&c.forEach(h=>h.cancel&&typeof h.cancel=="function"&&h.cancel()),s}catch(h){throw h[0]}}function AH(e,r){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),o.push.apply(o,s)}return o}function Qx(e){for(var r=1;r<arguments.length;r++){var o=arguments[r]!=null?arguments[r]:{};r%2?AH(Object(o),!0).forEach(function(s){$(e,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):AH(Object(o)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(o,s))})}return e}class _me extends Pr{get isSuccess(){return!!this.configs}constructor(r,o){super(),$(this,"configs",void 0),$(this,"store",void 0),$(this,"joinInfo",void 0),$(this,"cancelToken",void 0),$(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),$(this,"interval",void 0),$(this,"mutex",void 0),$(this,"mutableParamsRead",!1),$(this,"configCache",{}),$(this,"limit_bitrate",void 0),this.mutex=new Oo("config-distribute",r),this.store=o}startGetConfigDistribute(r,o){this.joinInfo=r,this.cancelToken=o,this.interval&&this.stopGetConfigDistribute(),re("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},re("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,wt.reportApiInvoke(null,{options:void 0,name:_i.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:xr.TRACER}).onSuccess(JSON.stringify(fd))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void D.debug("[config-distribute] get config distribute interrupted have no joininfo");let r;const o=await this.mutex.lock();try{r=await pme(this.joinInfo,this.cancelToken,this.retryConfig),D.debug("[config-distribute] get config distribute",JSON.stringify(r));const s=function(c){var u;const h=Xb(u=Object.keys(c).filter(y=>/^webrtc_ng_global_parameter/.test(y))).call(u);for(let y=0;y<h.length;y++)for(let S=h.length-1;S>y;S--){const R=h[S],P=c[R].value;if(typeof P.__priority=="number"){const k=P.__priority,z=h[S-1],U=c[z].value;if(typeof U.__priority=="number"){if(!(k>U.__priority))continue;{const V=R;h[S]=h[S-1],h[S-1]=V}}else{const V=R;h[S]=h[S-1],h[S-1]=V}}}const m=Date.now();let _={};return h.forEach(y=>{const S=c[y].value.__expires;S&&S<=m||(_[y]=c[y])}),_}(r);this.cacheGlobalParameterConfig(s),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=s}catch(s){const c=new Oe(X.NETWORK_RESPONSE_ERROR,s);D.warning("[config-distribute] ".concat(c.toString()))}finally{o()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(r){FG(r)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==r.id&&this.emit(ST.UPDATE_BITRATE_LIMIT,r):this.emit(ST.UPDATE_BITRATE_LIMIT,r))}getLowStreamConfigDistribute(){return this.limit_bitrate&&Qx({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(r){try{const o={},s=Object.keys(r),c=[];s.forEach(u=>{const h=r[u].value;o[u]=h;const m=h.__id;if(m&&this.configCache[u]&&this.configCache[u].__id===m)return;const _=h.__type,y=r[u].value,S=r[u].tag;let R=0;_?_===p8.REALTIME&&(R=1):Object.keys(y).some(P=>Object.prototype.hasOwnProperty.call(ox,P)||!Ax()&&Object.prototype.hasOwnProperty.call(VA,P)?(R=1,!0):void 0),c.push({tag:S,isApplied:R,feature:u,params:JSON.stringify(h)})}),c.forEach(u=>{let{tag:h,feature:m,params:_,isApplied:y}=u;this.store.sessionId&&wt.abTest(this.store.sessionId,{intSucc:1,isApplied:y,tag:h,feature:m,params:_,cid:this.store.cid,uid:this.store.intUid})}),this.configCache=o}catch(o){D.debug("handleABTestConfigDistribute error",o)}}cacheGlobalParameterConfig(r){const o=function(c){const u={};return Object.keys(c).forEach(h=>{const m=c[h].value,_=m.__expires,y=m.__type;Object.keys(m).forEach(S=>{S==="__id"||S==="__type"||S==="__priority"||S==="__expires"||Object.prototype.hasOwnProperty.call(u,S)||(u[S]=Qx(Qx({value:m[S]},_&&{expires:_}),y&&{type:y}))})}),u}(r);try{var s;const c=(s=o.LIMIT_BITRATE)===null||s===void 0?void 0:s.value;delete o.LIMIT_BITRATE,c&&FG(c)&&this.handleBitrateLimit(c),this.limit_bitrate=c,this.handleGlobalParameterConfig(o),this.handleABTestConfigDistribute(r),function(m){try{const _=Date.now();Object.keys(m).forEach(y=>{const{value:S,type:R,expires:P}=m[y];P&&P<=_||((R===p8.REALTIME||Object.prototype.hasOwnProperty.call(ox,y))&&(fd[y]=S,pr[y]=S,D.debug("Update realtime parameters from config distribute",y,S)),R||Ax()||!Object.prototype.hasOwnProperty.call(VA,y)||(fd[y]=S,pr[y]=S,D.debug("Update gateway parameters from config distribute",y,S)))})}catch(_){D.error("Error update config immediately: ".concat(m),_.message)}}(o);const u=JSON.stringify(o),h=window.btoa(u);window.localStorage.setItem("websdk_ng_global_parameter",h),D.debug("Caching global parameters ".concat(u))}catch(c){D.error("Error caching global parameters:",c.message)}}handleGlobalParameterConfig(r){try{const o=Date.now();Object.keys(r).forEach(s=>{if(s==="CLIENT_ROLE_OPTIONS"&&Object.prototype.hasOwnProperty.call(pr,s)){const{value:c,expires:u}=r[s];if(u&&u<=o)return;(function(h,m){try{return typeof h=="object"&&typeof m=="object"&&JSON.stringify(h)===JSON.stringify(m)}catch{return!1}})(pr[s],c)||(fd[s]=c,pr[s]=c,this.emit(ST.UPDATE_CLIENT_ROLE_OPTIONS,c),D.debug("Updating client role options: ".concat(JSON.stringify(c))))}})}catch(o){D.error("Error handling global parameter config:",o.message)}}}class Eme extends Pr{constructor(){super(...arguments),$(this,"resultStorage",new Map)}setLocalAudioStats(r,o,s){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",r,this.checkAudioInputLevel(s,o)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",r,this.checkSendAudioBitrate(s,o))}setLocalVideoStats(r,o,s){this.record("SEND_VIDEO_BITRATE_TOO_LOW",r,this.checkSendVideoBitrate(s,o)),this.record("FRAMERATE_INPUT_TOO_LOW",r,this.checkFramerateInput(s,o)),this.record("FRAMERATE_SENT_TOO_LOW",r,this.checkFramerateSent(s))}setRemoteAudioStats(r,o){const s=r.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",s,this.checkAudioOutputLevel(o))}setRemoteVideoStats(r,o){const s=r.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",s,this.checkVideoDecode(o))}record(r,o,s){if(re("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(r)||this.resultStorage.set(r,{result:[],isPrevNormal:!0});const c=this.resultStorage.get(r);if(c&&(c.result.push(s),c.result.length>=5)){var u;const h=st(u=c.result).call(u,!0);c.isPrevNormal&&!h&&this.emit("exception",PH[r],r,o),!c.isPrevNormal&&h&&this.emit("exception",PH[r]+2e3,r+"_RECOVER",o),c.isPrevNormal=h,c.result=[]}}checkAudioOutputLevel(r){return!(r.receiveBitrate>0&&r.receiveLevel===0)}checkAudioInputLevel(r,o){return o instanceof Ci&&!o.isActive||!!o.muted||r.sendVolumeLevel!==0}checkFramerateInput(r,o){let s=null;o._encoderConfig&&o._encoderConfig.frameRate&&(s=nc(o._encoderConfig.frameRate));const c=r.captureFrameRate;return!s||!c||!(s>10&&c<5||s<10&&s>=5&&c<=1)}checkFramerateSent(r){return!(r.captureFrameRate&&r.sendFrameRate&&r.captureFrameRate>5&&r.sendFrameRate<=1)}checkSendVideoBitrate(r,o){return!!o.muted||r.sendBitrate!==0}checkSendAudioBitrate(r,o){return o instanceof Ci&&!o.isActive||!!o.muted||r.sendBitrate!==0}checkVideoDecode(r){return r.receiveBitrate===0||r.decodeFrameRate!==0}}const PH={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},Do=new class{markSubscribeStart(e,r){performance.mark("agora-web-sdk/".concat(e,"/subscribe-").concat(r))}markPublishStart(e,r){performance.mark("agora-web-sdk/".concat(e,"/publish-").concat(r))}measureFromSubscribeStart(e,r){const o=performance.getEntriesByName("agora-web-sdk/".concat(e,"/subscribe-").concat(r));if(o.length>0){const s=o[o.length-1];return Math.round(performance.now()-s.startTime)}return 0}measureFromPublishStart(e,r){const o=performance.getEntriesByName("agora-web-sdk/".concat(e,"/publish-").concat(r));if(o.length>0){const s=o[o.length-1];return Math.round(performance.now()-s.startTime)}return 0}};function OH(e,r){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),o.push.apply(o,s)}return o}function V_(e){for(var r=1;r<arguments.length;r++){var o=arguments[r]!=null?arguments[r]:{};r%2?OH(Object(o),!0).forEach(function(s){$(e,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):OH(Object(o)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(o,s))})}return e}class OT{constructor(r){$(this,"store",void 0),$(this,"onStatsException",void 0),$(this,"onUploadPublishDuration",void 0),$(this,"onStatsChanged",void 0),$(this,"localStats",new Map),$(this,"remoteStats",new Map),$(this,"updateStatsInterval",void 0),$(this,"trafficStats",void 0),$(this,"trafficStatsPeerList",[]),$(this,"uplinkStats",void 0),$(this,"exceptionMonitor",void 0),$(this,"p2pChannel",void 0),$(this,"scalabilityMode",UA.L1T1),$(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=r,this.exceptionMonitor=new Eme,this.exceptionMonitor.on("exception",(o,s,c)=>{this.onStatsException&&this.onStatsException(o,s,c)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get($e.LocalAudioTrack)||V_({},ux)}getLocalVideoTrackStats(){return this.localStats.get($e.LocalVideoTrack)||V_({},dx)}getRemoteAudioTrackStats(r){const o=(u,h)=>{if(!this.trafficStats)return h;const m=this.trafficStats.peer_delay.find(_=>_.peer_uid===u);return m&&(h.publishDuration=m.B_ppad+(Date.now()-this.trafficStats.timestamp)),h},s={};if(r){var c;const u=(c=this.remoteStats.get(r))===null||c===void 0?void 0:c.audioStats;u&&(s[r]=o(r,u))}else Array.from(this.remoteStats.entries()).forEach(u=>{let[h,{audioStats:m}]=u;m&&(s[h]=o(h,m))});return s}getRemoteNetworkQualityStats(r){const o={};if(r){var s;const c=(s=this.remoteStats.get(r))===null||s===void 0?void 0:s.networkStats;c&&(o[r]=c)}else Array.from(this.remoteStats.entries()).forEach(c=>{let[u,{networkStats:h}]=c;h&&(o[u]=h)});return o}getRemoteVideoTrackStats(r){const o=(u,h)=>{if(!this.trafficStats)return h;const m=this.trafficStats.peer_delay.find(_=>_.peer_uid===u);return m&&(h.publishDuration=m.B_ppvd+(Date.now()-this.trafficStats.timestamp)),h},s={};if(r){var c;const u=(c=this.remoteStats.get(r))===null||c===void 0?void 0:c.videoStats;u&&(s[r]=o(r,u))}else Array.from(this.remoteStats.entries()).forEach(u=>{let[h,{videoStats:m}]=u;m&&(s[h]=o(h,m))});return s}getRTCStats(){let r=0,o=0,s=0,c=0;const u=this.localStats.get($e.LocalAudioTrack);u&&(r+=u.sendBytes,o+=u.sendBitrate);const h=this.localStats.get($e.LocalVideoTrack);h&&(r+=h.sendBytes,o+=h.sendBitrate);const m=this.localStats.get($e.LocalVideoLowTrack);m&&(r+=m.sendBytes,o+=m.sendBitrate),this.remoteStats.forEach(y=>{let{audioStats:S,videoStats:R}=y;S&&(s+=S.receiveBytes,c+=S.receiveBitrate),R&&(s+=R.receiveBytes,c+=R.receiveBitrate)});let _=1;return this.trafficStats&&(_+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:_,SendBitrate:o,SendBytes:r,RecvBytes:s,RecvBitrate:c,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(r){this.localStats.set(r,void 0)}removeLocalStats(r){r?this.localStats.delete(r):this.localStats.clear()}addRemoteStats(r){this.remoteStats.set(r,{})}removeRemoteStats(r){r?this.remoteStats.delete(r):this.remoteStats.clear()}addP2PChannel(r){this.p2pChannel=r}updateTrafficStats(r){r.peer_delay=r.peer_delay.filter(o=>o.B_ppad!==void 0||o.B_ppvd!==void 0),r.peer_delay.filter(o=>this.trafficStatsPeerList.indexOf(o.peer_uid)===-1).forEach(o=>{var s;const c=(s=this.p2pChannel)===null||s===void 0?void 0:s.getRemoteMedia(o.peer_uid),u=c!=null&&c.videoSSRC?Do.measureFromSubscribeStart(this.store.clientId,c.videoSSRC):0,h=c!=null&&c.audioSSRC?Do.measureFromSubscribeStart(this.store.clientId,c.audioSSRC):0;o.B_ppad!==void 0&&o.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(o.peer_uid,o.B_ppad,o.B_ppvd,u>h?u:h),this.trafficStatsPeerList.push(o.peer_uid))}),this.trafficStats=r}updateUplinkStats(r){this.uplinkStats&&this.uplinkStats.B_fir!==r.B_fir&&D.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(r.B_fir)),this.uplinkStats=r}static isRemoteVideoFreeze(r,o,s){if(!r)return!1;const c=!!s&&o.framesDecodeFreezeTime>s.framesDecodeFreezeTime,u=!s||o.framesDecodeCount>s.framesDecodeCount;return c||!u}static isRemoteAudioFreeze(r){return!!r&&r._isFreeze()}isLocalVideoFreeze(r){return!(!r.inputFrame||!r.sentFrame)&&r.inputFrame.frameRate>5&&r.sentFrame.frameRate<3}updateLocalStats(r){Array.from(this.localStats.entries()).forEach(o=>{let[s,c]=o;switch(s){case $e.LocalVideoTrack:case $e.LocalVideoLowTrack:{const h=c,m=V_({},dx),_=r.getStats(),y=r.getLocalMedia(s);if(_){const S=_.videoSend.find(R=>R.ssrc===(y==null?void 0:y.ssrcs[0].ssrcId));if(S){const R=r.getLocalVideoSize(),P=r.getEncoderConfig($e.LocalVideoTrack);S.codec!=="H264"&&S.codec!=="H265"&&S.codec!=="VP8"&&S.codec!=="VP9"&&S.codec!=="AV1X"&&S.codec!=="AV1"||(m.codecType=S.codec),m.sendBytes=S.bytes,m.sendBitrate=h?8*Math.max(0,m.sendBytes-h.sendBytes):0,S.inputFrame?(m.captureFrameRate=S.inputFrame.frameRate,m.captureResolutionHeight=S.inputFrame.height,m.captureResolutionWidth=S.inputFrame.width):R&&(m.captureResolutionWidth=R.width,m.captureResolutionHeight=R.height),S.sentFrame?(m.sendFrameRate=S.sentFrame.frameRate,m.sendResolutionHeight=S.sentFrame.height,m.sendResolutionWidth=S.sentFrame.width):R&&(m.sendResolutionWidth=R.width,m.sendResolutionHeight=R.height),S.avgEncodeMs&&(m.encodeDelay=S.avgEncodeMs),P&&P.bitrateMax&&(m.targetSendBitrate=1e3*P.bitrateMax),m.sendPackets=S.packets,m.sendPacketsLost=S.packetsLost,m.sendJitterMs=S.jitterMs,m.sendRttMs=S.rttMs,m.totalDuration=h?h.totalDuration+1:1,m.totalFreezeTime=h?h.totalFreezeTime:0,this.isLocalVideoFreeze(S)&&(m.totalFreezeTime+=1),S.scalabilityMode&&this.scalabilityMode!==S.scalabilityMode&&(D.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(S.scalabilityMode)),this.scalabilityMode=S.scalabilityMode)}this.trafficStats&&(m.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var u;this.localStats.set(s,m),((h==null?void 0:h.sendResolutionWidth)!==m.sendResolutionWidth||(h==null?void 0:h.sendResolutionHeight)!==m.sendResolutionHeight)&&((u=this.onStatsChanged)===null||u===void 0||u.call(this,"resolution",{width:m.sendResolutionWidth,height:m.sendResolutionHeight})),m&&y&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,y.track,m);break}case $e.LocalAudioTrack:{const h=c,m=V_({},ux),_=r.getStats(),y=r.getLocalMedia(s);if(_){const S=_.audioSend.find(R=>R.ssrc===(y==null?void 0:y.ssrcs[0].ssrcId));if(S){if(S.codec!=="opus"&&S.codec!=="aac"&&S.codec!=="PCMU"&&S.codec!=="PCMA"&&S.codec!=="G722"||(m.codecType=S.codec),S.inputLevel)m.sendVolumeLevel=Math.round(32767*S.inputLevel);else{const R=r.getLocalAudioVolume();R&&(m.sendVolumeLevel=Math.round(32767*R))}m.sendBytes=S.bytes,m.sendPackets=S.packets,m.sendPacketsLost=S.packetsLost,m.sendJitterMs=S.jitterMs,m.sendRttMs=S.rttMs,m.sendBitrate=h?8*Math.max(0,m.sendBytes-h.sendBytes):0}}this.trafficStats&&(m.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set($e.LocalAudioTrack,m),m&&y&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,y.track,m);break}}})}updateRemoteStats(r){Array.from(this.remoteStats.entries()).forEach(o=>{var s,c;let[u,{videoStats:h,audioStats:m,videoPcStats:_}]=o;const y=m,S=h,R=_,P=V_({},R8),k=V_({},C8),z=V_({},npe),{audioTrack:U,videoTrack:V,audioSSRC:q,videoSSRC:Y}=r.getRemoteMedia(u);let ce;ce=this.store.useP2P?r.getStats(!0):r.getStats();const _e=(s=ce)===null||s===void 0?void 0:s.audioRecv.find(Ye=>Ye.ssrc===q),Ee=(c=ce)===null||c===void 0?void 0:c.videoRecv.find(Ye=>Ye.ssrc===Y),me=this.trafficStats&&this.trafficStats.peer_delay.find(Ye=>Ye.peer_uid===u);if(_e&&(_e.codec!=="opus"&&_e.codec!=="aac"&&_e.codec!=="PCMU"&&_e.codec!=="PCMA"&&_e.codec!=="G722"||(P.codecType=_e.codec),_e.outputLevel?P.receiveLevel=Math.round(32767*_e.outputLevel):U&&(P.receiveLevel=Math.round(32767*U.getVolumeLevel())),P.receiveBytes=_e.bytes,P.receivePackets=_e.packets,P.receivePacketsLost=_e.packetsLost,P.receivePacketsDiscarded=_e.packetsDiscarded,P.packetLossRate=P.receivePacketsLost/(P.receivePackets+P.receivePacketsLost),P.receiveBitrate=y?8*Math.max(0,P.receiveBytes-y.receiveBytes):0,P.totalDuration=y?y.totalDuration+1:1,P.totalFreezeTime=y?y.totalFreezeTime:0,P.freezeRate=P.totalFreezeTime/P.totalDuration,P.receiveDelay=_e.jitterBufferMs,P.totalDuration>10&&OT.isRemoteAudioFreeze(U)&&(P.totalFreezeTime+=1)),Ee){var ke;Ee.codec!=="H264"&&Ee.codec!=="H265"&&Ee.codec!=="VP8"&&Ee.codec!=="VP9"&&Ee.codec!=="AV1X"&&Ee.codec!=="AV1"||(k.codecType=Ee.codec),k.receiveBytes=Ee.bytes,k.receiveBitrate=S?8*Math.max(0,k.receiveBytes-S.receiveBytes):0,k.decodeFrameRate=Ee.decodeFrameRate<0?0:Ee.decodeFrameRate,k.renderFrameRate=Ee.decodeFrameRate<0?0:Ee.decodeFrameRate,Ee.outputFrame&&(k.renderFrameRate=Ee.outputFrame.frameRate),Ee.receivedFrame?(k.receiveFrameRate=Ee.receivedFrame.frameRate,k.receiveResolutionHeight=Ee.receivedFrame.height,k.receiveResolutionWidth=Ee.receivedFrame.width):V&&(k.receiveResolutionHeight=V._videoHeight||0,k.receiveResolutionWidth=V._videoWidth||0),Ee.framesRateFirefox!==void 0&&(k.receiveFrameRate=Math.round(Ee.framesRateFirefox)),k.receivePackets=Ee.packets,k.receivePacketsLost=Ee.packetsLost,k.packetLossRate=k.receivePacketsLost/(k.receivePackets+k.receivePacketsLost);const Ye=S?S.totalFreezeTime:0,ut=S?S.totalDuration:0;k.totalDuration=S?S.totalDuration+1:1,k.totalFreezeTime=(ke=Ee.totalFreezesDuration)!==null&&ke!==void 0?ke:Ye||0,k.receiveDelay=Ee.jitterBufferMs||0;const pt=!!Y&&r.getRemoteVideoIsReady(Y);Ee.totalFreezesDuration===void 0&&V&&pt&&OT.isRemoteVideoFreeze(V,Ee,R)&&(k.totalFreezeTime+=1),k.freezeRate=Math.max(0,Math.min((k.totalFreezeTime-Ye)/(k.totalDuration-ut),1))}me&&(P.end2EndDelay=me.B_ad,k.end2EndDelay=me.B_vd,P.transportDelay=me.B_ed,k.transportDelay=me.B_ed,P.currentPacketLossRate=me.B_ealr4/100,k.currentPacketLossRate=me.B_evlr4/100,z.uplinkNetworkQuality=me.B_punq?me.B_punq:0,z.downlinkNetworkQuality=me.B_pdnq?me.B_pdnq:0),this.remoteStats.set(u,{audioStats:P,videoStats:k,videoPcStats:Ee,networkStats:z}),U&&this.exceptionMonitor.setRemoteAudioStats(U,P),V&&this.exceptionMonitor.setRemoteVideoStats(V,k)})}}class kH{constructor(){$(this,"destChannelMediaInfos",new Map),$(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(r){UG(r),this.srcChannelMediaInfo=r}addDestChannelInfo(r){UG(r),this.destChannelMediaInfos.set(r.channelName,r)}removeDestChannelInfo(r){rP(r),this.destChannelMediaInfos.delete(r)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function NH(e){if(!(e instanceof kH))return new Oe(X.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const r=e.getSrcChannelMediaInfo(),o=e.getDestChannelMediaInfo();if(!r)return new Oe(X.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(o.size===0)return new Oe(X.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class Lm{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(r,o){$(this,"uid",void 0),$(this,"_uintid",void 0),$(this,"_trust_in_room_",!0),$(this,"_trust_audio_enabled_state_",!0),$(this,"_trust_video_enabled_state_",!0),$(this,"_trust_audio_mute_state_",!0),$(this,"_trust_video_mute_state_",!0),$(this,"_audio_muted_",!1),$(this,"_video_muted_",!1),$(this,"_audio_enabled_",!0),$(this,"_video_enabled_",!0),$(this,"_audio_added_",!1),$(this,"_video_added_",!1),$(this,"_is_pre_created",!1),$(this,"_video_pre_subscribed",!1),$(this,"_audio_pre_subscribed",!1),$(this,"_trust_video_stream_added_state_",!0),$(this,"_trust_audio_stream_added_state_",!0),$(this,"_audioTrack",void 0),$(this,"_videoTrack",void 0),$(this,"_dataChannels",[]),$(this,"_audioSSRC",void 0),$(this,"_videoSSRC",void 0),$(this,"_audioOrtc",void 0),$(this,"_videoOrtc",void 0),$(this,"_cname",void 0),$(this,"_rtxSsrcId",void 0),$(this,"_videoMid",void 0),$(this,"_audioMid",void 0),this.uid=r,this._uintid=o}}function DH(e,r){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),o.push.apply(o,s)}return o}function LH(e){for(var r=1;r<arguments.length;r++){var o=arguments[r]!=null?arguments[r]:{};r%2?DH(Object(o),!0).forEach(function(s){$(e,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):DH(Object(o)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(o,s))})}return e}const kT="9",xH=4e4;function MH(e,r){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),o.push.apply(o,s)}return o}function Zf(e){for(var r=1;r<arguments.length;r++){var o=arguments[r]!=null?arguments[r]:{};r%2?MH(Object(o),!0).forEach(function(s){$(e,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):MH(Object(o)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(o,s))})}return e}var Qv=function(e){return e[e.DOWN=0]="DOWN",e[e.UP=1]="UP",e}(Qv||{});const _P=new Map;function UH(e,r,o,s){let{scale:c}=e;if(c===0&&s===Qv.UP||c>=r.length-1&&s===Qv.DOWN)return e;let u=Zf(Zf({},e),{},{scale:s===Qv.DOWN?++c:--c});switch(o){case"maintain-framerate":u=Zf(Zf({},u),r[c].motion);break;case"maintain-resolution":u=Zf(Zf({},u),r[c].detail);break;case"balanced":u=Zf(Zf({},u),r[c].balanced)}return u}function VH(e,r){if(r){const o={overUse:0,underUse:0,adaptationList:FH(r)};_P.set(e,o)}else _P.delete(e)}function FH(e){const r=Zf({},e),{bitrateMax:o,frameRate:s,scaleResolutionDownBy:c,bitrateMin:u}=r,{MIN_FRAME_RATE:h,MAX_THRESHOLD_FRAMERATE:m,MAX_SCALE:_,BITRATE_MIN_THRESHOLD:y,BITRATE_MAX_THRESHOLD:S,BWE_SCALE_UP_THRESHOLD:R,BWE_SCALE_DOWN_THRESHOLD:P,PERF_SCALE_DOWN_THRESHOLD:k,PERF_SCALE_UP_THRESHOLD:z,BALANCE_BITRATE_FACTOR:U,BALANCE_FRAMERATE_FACTOR:V,BALANCE_RESOLUTION_FACTOR:q,MOTION_RESOLUTION_FACTOR:Y,MOTION_BITRATE_FACTOR:ce,DETAIL_FRAMERATE_FACTOR:_e,DETAIL_BITRATE_FACTOR:Ee}=rx,me=Math.min(r.frameRate,m),ke=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(P,1)*o),bwe_up:o,fps_down:Math.round(Math.pow(k,1)*me),fps_up:s},balanced:{scaleResolutionDownBy:1,frameRate:s,bitrateMax:o,bitrateMin:u},motion:{scaleResolutionDownBy:1,frameRate:s,bitrateMax:o,bitrateMin:u},detail:{scaleResolutionDownBy:1,frameRate:s,bitrateMax:o,bitrateMin:u}}];for(let Ye=1;Ye<=_;Ye++){const ut={bwe_up:Math.round(Math.pow(R,Ye)*o),bwe_down:Math.round(Math.pow(P,Ye+1)*o),fps_up:Math.round(Math.pow(z,Ye)*me),fps_down:Math.round(Math.pow(k,Ye+1)*me)},pt={scaleResolutionDownBy:c/Math.pow(q,Ye),frameRate:Math.max(Math.round(Math.pow(V,Ye)*s),h),bitrateMax:Math.max(Math.round(Math.pow(U,Ye)*o),S),bitrateMin:Math.max(Math.round(Math.pow(U,Ye)*u),y)},vn={scaleResolutionDownBy:c/Math.pow(Y,Ye),frameRate:s,bitrateMax:Math.max(Math.round(Math.pow(ce,Ye)*o),S),bitrateMin:Math.max(Math.round(Math.pow(ce,Ye)*u),y)},Sn={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(_e,Ye)*s),h),bitrateMax:Math.max(Math.round(Math.pow(Ee,Ye)*o),S),bitrateMin:Math.max(Math.round(Math.pow(Ee,Ye)*u),y)};ke.push({scale:Ye,threshold:ut,balanced:pt,motion:vn,detail:Sn})}return ke}function yme(e,r,o,s,c,u){const h=_P.get(e)||{overUse:0,underUse:0,adaptationList:FH(c)},{adaptationList:m}=h;_P.set(e,h);const{OVERUSE_TIMES_THRESHOLD:_,UNDERUSE_TIMES_THRESHOLD:y}=rx,{scale:S}=s;let R,P;return typeof r=="number"&&r>0&&function(k,z,U,V){if(z>=U.length)return!1;let{threshold:{fps_down:q}}=U[z];return re("FORCE_AG_HIGH_FRAMERATE")&&V==="maintain-framerate"&&(q=U[0].threshold.fps_down),k<q}(r,S,m,u)&&(h.overUse++,P=mT.CPU,h.overUse>_)||typeof o=="number"&&o>0&&function(k,z,U){if(z>=U.length)return!1;const{threshold:{bwe_down:V}}=U[z];return k<V}(o,S,m)&&(h.overUse++,P=mT.BANDWIDTH,h.overUse>_)?(h.overUse=0,h.underUse=0,R=UH(s,m,u,Qv.DOWN),[R,P]):(typeof r=="number"&&r>0&&typeof o=="number"&&o>0&&function(k,z,U,V){if(z===0)return;let{threshold:{fps_up:q}}=U[z];return re("FORCE_AG_HIGH_FRAMERATE")&&V==="maintain-framerate"&&(q=U[1].threshold.fps_up),k>q}(r,S,m,u)&&function(k,z,U){if(z===0)return;const{threshold:{bwe_up:V}}=U[z];return k>V}(o,S,m)&&(h.underUse++,h.underUse>y&&(h.overUse=0,h.underUse=0,R=UH(s,m,u,Qv.UP),R.scale===0&&(P=mT.NONE))),[R,P])}function jH(e,r){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),o.push.apply(o,s)}return o}function Zx(e){for(var r=1;r<arguments.length;r++){var o=arguments[r]!=null?arguments[r]:{};r%2?jH(Object(o),!0).forEach(function(s){$(e,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):jH(Object(o)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(o,s))})}return e}function vme(e){var r;return!!re("ENABLE_AG_ADAPTATION")&&!!(e instanceof vx||st(r=e._hints).call(r,ar.CUSTOM_TRACK))&&(!!re("FORCE_SUPPORT_AG_ADAPTATION")||!!(function(o){const s=Rn();if(s.os!==Fi.IOS||!s.osVersion)return!1;const c=s.osVersion.split(".");return Number(c[0])>=o}(14)&&MW(17,4)||xW(14)&&UW(17,4,!0)))}const EP=new Map;function yP(e,r){const o=EP.get(e);if(o){const{timer:s}=o;window.clearTimeout(s),EP.delete(e)}r.qualityLimitationReason=mT.NONE,VH(e)}function Sme(e,r){var o;let s;switch(r){case $e.LocalAudioTrack:s=zn.Audio;break;case $e.LocalVideoTrack:s=st(o=e._hints).call(o,ar.SCREEN_TRACK)?zn.Screen:zn.High;break;case $e.LocalVideoLowTrack:s=zn.Low}return s}function eM(e){const r=kn();if(e.some(o=>o._bypassWebAudio))throw new Le(X.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!r.webAudioMediaStreamDest)throw new Le(X.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function tM(e,r){eM(e);const o=new Ci;return e.forEach(s=>o.addAudioTrack(s)),o}const bme=!kn().supportUnifiedPlan||re("CHROME_FORCE_PLAN_B")&&zf();function vP(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var o;return bme?(o={spec:r,store:e},Jf("PlanBConnection").create(o)):new vh(r,e)}function nM(e){return e&&(e.iceConnectionState==="disconnected"||e.iceConnectionState==="checking"||e.iceConnectionState==="failed")}function BH(e){try{if(e.iceServers)return!1;if(e.turnServer&&e.turnServer.mode!=="off"){if(hT(e.turnServer.servers))return!1;if(re("FORCE_TURN_TCP")||e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).some(r=>r.forceturn))return!0}return!1}catch{return!1}}var Tn;function WH(e,r){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),o.push.apply(o,s)}return o}function Ed(e){for(var r=1;r<arguments.length;r++){var o=arguments[r]!=null?arguments[r]:{};r%2?WH(Object(o),!0).forEach(function(s){$(e,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):WH(Object(o)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(o,s))})}return e}let vh=(Tn=class oE extends BG{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var r,o;return(r=(o=this.peerConnection.getReceivers()[0])===null||o===void 0||(o=o.transport)===null||o===void 0?void 0:o.state)!==null&&r!==void 0?r:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(r=>r.rtpMap&&r.rtpMap.encodingName.toLowerCase()||"").filter(r=>{var o;return st(o=Object.keys(FA)).call(o,r)}))]}constructor(r,o){super(r,o),$(this,"id",sr(5,"connection-")),$(this,"store",void 0),$(this,"peerConnection",void 0),$(this,"forceTurn",!1),$(this,"remoteSDP",void 0),$(this,"initialOffer",void 0),$(this,"transportEventReceiver",void 0),$(this,"statsFilter",void 0),$(this,"extension",{useXR:re("USE_XR")}),$(this,"localCapabilities",void 0),$(this,"remoteCodecs",void 0),$(this,"localCandidateCount",0),$(this,"allCandidatesReceived",!1),$(this,"isPreallocation",!1),$(this,"preSSRCMap",new Map),$(this,"dataStreamChannelMap",new Map),$(this,"establishPromise",void 0),$(this,"recoveredDataChannelIds",[]),$(this,"currentDataChannelId",1),$(this,"supportAV1RtpSpec",!1),$(this,"mutex",void 0),$(this,"qualityLimitationReason",mT.NONE),$(this,"isFirstConnected",!1),this.store=o,this.forceTurn=BH(r),this.mutex=new Oo("P2PConnection-mutex",o.clientId),this.peerConnection=new RTCPeerConnection(oE.resolvePCConfiguration(r),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=ex(this.peerConnection,re("STATS_UPDATE_INTERVAL"),void 0,Dr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}getPreMedia(r){const o=this.preSSRCMap.get(r);if(o!==void 0){const s=this.peerConnection.getTransceivers().find(c=>c.mid===o);if(s)return{transceiver:s,track:s.receiver.track,id:o}}}async updateRemoteRTPCapabilities(r,o){if(this.remoteCodecs=o,!this.remoteSDP)return void D.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(o));if(this.remoteSDP.updateRemoteCodec(r,o,this.store.codec)){const s=await this.peerConnection.createOffer(),c=this.logSDPExchange(s.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(s);const u=this.remoteSDP.toString();c==null||c(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}else D.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const s=await this.peerConnection.createOffer();if(!s.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const c=Nm(s.sdp),u=await aH({filterRTX:!re("USE_PUB_RTX")&&!re("USE_SUB_RTX"),filterVideoFec:re("FILTER_VIDEO_FEC"),filterAudioFec:re("FILTER_AUDIO_FEC"),filterVideoCodec:re("FILTER_VIDEO_CODEC")},this.extension);if(this.localCapabilities=hP(u),this.initialOffer=s,re("ENABLE_SVC")&&this.store.codec=="av1"){const m=await async function(){try{const _=new RTCPeerConnection;_.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:UA.L1T3}]});const y=await _.createOffer();if(!y.sdp)return void _.close();const S=Sa(y.sdp).mediaDescriptions[0];if(!S)return;const R=S.attributes.extmaps.find(P=>P.extensionName==="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension");return _.close(),R}catch{return}}();var r;m&&(this.supportAV1RtpSpec=!0,(r=u.send)===null||r===void 0||r.videoExtensions.push(m))}let h;return s.sdp&&dH(s.sdp)&&(h=Mr(u),(o=h).send&&(Kv(gt.VIDEO,o.send.videoExtensions),Kv(gt.AUDIO,o.send.audioExtensions)),o.recv&&(Kv(gt.VIDEO,o.recv.videoExtensions),Kv(gt.AUDIO,o.recv.audioExtensions)),o.sendrecv&&(Kv(gt.VIDEO,o.sendrecv.videoExtensions),Kv(gt.AUDIO,o.sendrecv.audioExtensions))),Ed(Ed({},c),{},{rtpCapabilities:h||u,offerSDP:s.sdp})}catch(s){throw new Le(X.GET_LOCAL_CONNECTION_PARAMS_FAILED,s.toString())}var o}async connect(r){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&dH(this.initialOffer.sdp)&&(o=r.rtpCapabilities,s=this.localCapabilities,o.send&&(lP(gt.VIDEO,o.send.videoExtensions,s.send.videoExtensions),lP(gt.AUDIO,o.send.audioExtensions,s.send.audioExtensions)),o.recv&&(lP(gt.VIDEO,o.recv.videoExtensions,s.recv.videoExtensions),lP(gt.AUDIO,o.recv.audioExtensions,s.recv.audioExtensions))),this.remoteSDP=new class{get localCapabilities(){return Mr(this._localCapabilities)}get rtpCapabilities(){return Mr(this._rtpCapabilities)}get candidates(){return Mr(this._candidates)}get iceParameters(){return Mr(this._iceParameters)}get dtlsParameters(){return Mr(this._dtlsParameters)}constructor(y){let S=arguments.length>1&&arguments[1]!==void 0&&arguments[1];$(this,"sessionDesc",void 0),$(this,"_localCapabilities",void 0),$(this,"_rtpCapabilities",void 0),$(this,"_candidates",void 0),$(this,"_originCandidates",void 0),$(this,"_iceParameters",void 0),$(this,"_isUseExtmapAllowMixed",void 0),$(this,"_dtlsParameters",void 0),$(this,"setup",void 0),$(this,"currentMidIndex",void 0),$(this,"cname",void 0),$(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=S,y=Mr(y);const{iceParameters:R,dtlsParameters:P,candidates:k,rtpCapabilities:z,setup:U,localCapabilities:V,cname:q}=y;this._rtpCapabilities=z,this._candidates=k,this._originCandidates=Mr(k),this._iceParameters=R,this._dtlsParameters=P,this._localCapabilities=V,this.setup=U,this.cname=q,this.sessionDesc=this.updateRemoteRTPCapabilities(z),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}preloadRemoteMedia(y){const S=this.candidates,R=this.dtlsParameters,P=this.iceParameters,k=this.rtpCapabilities.send;let z=this.sessionDesc.mediaDescriptions.length-1;for(let U=1;U<y;U++){const V=2*U+2e4,q=2*U+xH,{ssrcs:Y,ssrcGroups:ce}=U_([{ssrcId:V}],this.cname),{ssrcs:_e,ssrcGroups:Ee}=U_([{ssrcId:q,rtx:re("USE_SUB_RTX")?q+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:kT,protos:["UDP","TLS","RTP","SAVPF"],fmts:k.videoCodecs.map(me=>me.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:P.iceUfrag,icePwd:P.icePwd,unrecognized:[],candidates:S,extmaps:k.videoExtensions,fingerprints:R.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:_e,ssrcGroups:Ee,rtcpFeedbackWildcards:[],payloads:k.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++z)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:kT,protos:["UDP","TLS","RTP","SAVPF"],fmts:k.audioCodecs.map(me=>me.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:P.iceUfrag,icePwd:P.icePwd,unrecognized:[],candidates:S,extmaps:k.audioExtensions,fingerprints:R.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:Y,ssrcGroups:ce,rtcpFeedbackWildcards:[],payloads:k.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++z)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return Im(this.sessionDesc)}send(y,S,R,P){const{ssrcs:k,ssrcGroups:z}=U_(S,this.cname,re("SYNC_GROUP")?R:void 0),U=this.findPreloadMediaDesc(k);if(U){if(Dr()&&this.firefoxSsrcMidMap.set(k[0].ssrcId,U.attributes.mid),P&&(P.twcc||P.remb)){const V=this.sessionDesc.mediaDescriptions.indexOf(U);return this.sessionDesc.mediaDescriptions[V]=this.mungSendMediaDesc(U,P),{mid:U.attributes.mid,needExchangeSDP:!0}}return{mid:U.attributes.mid,needExchangeSDP:!1}}{const V=this.findAvailableMediaIndex(y,k);let q;return V===-1||V===1&&(vo()||function(){const Y=Rn();return!(Y.name!==Mn.CHROME||!Y.osVersion)&&Number(Y.version)<=90}()||re("ENABLE_ENCODED_TRANSFORM")&&Wf())||V===0&&re("USE_SUB_RTX")||VW()?(q=this.createOrRecycleSendMedia(y,k,z,"sendonly",P),this.updateBundleMids()):(q=Mr(this.sessionDesc.mediaDescriptions[V]),q.attributes.direction="sendonly",q.attributes.ssrcs=k,q.attributes.ssrcGroups=z,this.sessionDesc.mediaDescriptions[V]=this.mungSendMediaDesc(q,P)),Dr()&&this.firefoxSsrcMidMap.set(k[0].ssrcId,q.attributes.mid),{mid:q.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:y,needExchangeSDP:S}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:y.attributes.mid,needExchangeSDP:S}}batchSend(y){const S=y.map(k=>{let{kind:z,ssrcMsg:U,mslabel:V}=k;return this.send(z,U,V)}),R=[];let P=!1;return S.forEach(k=>{let{mid:z,needExchangeSDP:U}=k;U&&(P=!0),R.push(z)}),{mids:R,needExchangeSDP:P}}stopSending(y){const S=this.sessionDesc.mediaDescriptions.filter(R=>R.attributes.mid&&y.indexOf(R.attributes.mid)!==-1);if(S.length!==y.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");S.forEach(R=>{R.attributes.mid==="0"||Dr()||VW()?R.attributes.ssrcs=[]:(R.attributes.ssrcs=[],R.attributes.direction="inactive",R.media.port="0")}),this.updateBundleMids()}mute(y){const S=this.sessionDesc.mediaDescriptions.find(R=>R.attributes.mid===y);if(!S)throw new Error("mediaDescription not found with ".concat(y," in remote SDP when calling RemoteSDP.mute."));S.attributes.direction="inactive"}unmute(y){const S=this.sessionDesc.mediaDescriptions.find(R=>R.attributes.mid===y);if(!S)throw new Error("mediaDescription not found with ".concat(y," in remote SDP when calling RemoteSDP.unmute."));S.attributes.direction="sendonly"}muteRemote(y){const S=this.sessionDesc.mediaDescriptions.filter(R=>st(y).call(y,R.attributes.mid||""));if(S.length!==y.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");S.forEach(R=>{R.attributes.direction="inactive"})}unmuteRemote(y){const S=this.sessionDesc.mediaDescriptions.filter(R=>st(y).call(y,R.attributes.mid||""));if(S.length!==y.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");S.forEach(R=>{R.attributes.direction="recvonly"})}receive(y,S,R,P){y.forEach((k,z)=>{this.createOrRecycleRecvMedia(k,[],"recvonly",S,R,P[z])}),this.updateBundleMids()}stopReceiving(y){const S=this.sessionDesc.mediaDescriptions.filter(R=>y.indexOf(R.attributes.mid)!==-1);if(S.length!==y.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");S.forEach(R=>{R.media.port="0",R.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(y){const S=this.sessionDesc||Sa((R=this._isUseExtmapAllowMixed,`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite`.concat(R?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`)));var R;this._rtpCapabilities=y;const P=this.rtpCapabilities.send,k=this.localCapabilities.send;for(const z of S.mediaDescriptions){if(z.attributes.iceUfrag=this._iceParameters.iceUfrag,z.attributes.icePwd=this._iceParameters.icePwd,z.attributes.fingerprints=this._dtlsParameters.fingerprints,z.attributes.candidates=this._candidates,z.attributes.setup=this.setup,z.media.mediaType==="application"&&(z.attributes.sctpPort="5000"),z.media.mediaType==="video"){if(P.videoCodecs.length===0){const U=k.videoCodecs.filter(V=>{var q,Y;return(q=V.rtpMap)===null||q===void 0?void 0:st(Y=q.encodingName.toLowerCase()).call(Y,"vp8")})||[k.videoCodecs[0]];z.media.fmts=U.map(V=>V.payloadType.toString(10)),z.attributes.payloads=U,z.attributes.extmaps=[]}else if(z.media.fmts=P.videoCodecs.map(U=>U.payloadType.toString(10)),z.attributes.payloads=P.videoCodecs,z.attributes.extmaps=P.videoExtensions,re("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:U,ssrcGroups:V}=U_([{ssrcId:xH,rtx:re("USE_SUB_RTX")?40001:void 0}],this.cname);z.attributes.ssrcs=U,z.attributes.ssrcGroups=V}}if(z.media.mediaType==="audio"){if(P.audioCodecs.length===0){const U=k.audioCodecs.filter(V=>{var q,Y;return(q=V.rtpMap)===null||q===void 0?void 0:st(Y=q.encodingName.toLowerCase()).call(Y,"opus")})||[k.audioCodecs[0]];z.media.fmts=U.map(V=>V.payloadType.toString(10)),z.attributes.payloads=U,z.attributes.extmaps=[]}else if(z.media.fmts=P.audioCodecs.map(U=>U.payloadType.toString(10)),z.attributes.payloads=P.audioCodecs,z.attributes.extmaps=P.audioExtensions,Yv(z),re("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:U,ssrcGroups:V}=U_([{ssrcId:2e4}],this.cname);z.attributes.ssrcs=U,z.attributes.ssrcGroups=V}}}return this.sessionDesc=S,this.currentMidIndex=S.mediaDescriptions.length-1,this.sessionDesc}updateCandidates(y){const S=this._originCandidates.filter(P=>P.transport==="udp"),R=[];if(S.forEach(P=>{R.push(LH(LH({},P),{},{foundation:"tcpcandidate",priority:Number(P.priority)-1+"",transport:"tcp",port:Number(P.port)+90+""}))}),S.length!==0){switch(y){case No.TCP_RELAY:this._candidates=R;break;case No.UDP_TCP_RELAY:case No.RELAY:this._candidates=[...S,...R];break;default:this._candidates=S}for(const P of this.sessionDesc.mediaDescriptions)P.attributes.candidates=this.candidates}}restartICE(y){y=Mr(y),this._iceParameters=y,this.sessionDesc.mediaDescriptions.forEach(S=>{S.attributes.iceUfrag=y.iceUfrag,S.attributes.icePwd=y.icePwd})}predictReceivingMids(y){const S=[];for(let R=0;R<y;R++)S.push((this.currentMidIndex+R+1).toString(10));return S}findAvailableMediaIndex(y,S){return this.sessionDesc.mediaDescriptions.findIndex(R=>{const P=R.media.mediaType===y&&R.media.port!=="0"&&(R.attributes.direction==="sendonly"||R.attributes.direction==="sendrecv")&&R.attributes.ssrcs.length===0;if(Dr()){if(P){const k=this.firefoxSsrcMidMap.get(S[0].ssrcId);return!(k||R.attributes.mid!=="0"&&R.attributes.mid!=="1")||!(!k||k!==R.attributes.mid)}return!1}return P})}createOrRecycleDataChannel(){for(const R of this.sessionDesc.mediaDescriptions)if(R.media.mediaType==="application")return{mediaDesc:R,needExchangeSDP:!1};this.currentMidIndex+=1;const y="".concat(this.currentMidIndex),S={media:{mediaType:"application",port:kT,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(y),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(S),{mediaDesc:S,needExchangeSDP:!0}}createOrRecycleRecvMedia(y,S,R,P,k,z){const U=y._mediaStreamTrack.kind,V=this.rtpCapabilities.recv,q=CT(U,V,this.localCapabilities.send,U===gt.VIDEO?P:k),Y=U===gt.VIDEO?V.videoExtensions:V.audioExtensions;this.currentMidIndex+=1;const ce="".concat(this.currentMidIndex);let _e={media:{mediaType:U,port:kT,protos:["UDP","TLS","RTP","SAVPF"],fmts:q.map(me=>me.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:Y,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:S,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:q,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:R,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(ce)}};_e=this.mungRecvMediaDsec(_e,y,z);const Ee=this.findFirstClosedMedia(U);if(Ee){const me=this.sessionDesc.mediaDescriptions.indexOf(Ee);this.sessionDesc.mediaDescriptions[me]=_e}else this.sessionDesc.mediaDescriptions.push(_e);return _e}updateRemoteCodec(y,S,R){const P=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(_e=>_e.rtpMap&&_e.rtpMap.encodingName.toLowerCase()||"").filter(_e=>{var Ee;return st(Ee=Object.keys(FA)).call(Ee,_e)}))],k=new Set(S);if(P.every(_e=>k.has(_e)))return D.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(S)),!1;const z=this._rtpCapabilities.recv.videoCodecs.filter(_e=>S.some(Ee=>{var me;return st(me=_e.rtpMap&&_e.rtpMap.encodingName.toLowerCase()||"").call(me,Ee)}));if(z.length===0)return D.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(P," codecs: ").concat(S)),!1;const U=[...new Set(z.map(_e=>_e.rtpMap&&_e.rtpMap.encodingName.toLowerCase()||""))];let V;if(D.debug("updateRemoteCodec, from ".concat(P," to ").concat(U)),y.length===0)V=this.sessionDesc.mediaDescriptions.filter(_e=>_e.media.mediaType==="video"&&_e.attributes.direction==="recvonly");else if(V=this.sessionDesc.mediaDescriptions.filter(_e=>_e.attributes.mid&&st(y).call(y,_e.attributes.mid)&&_e.attributes.direction==="recvonly"),V.length!==y.length)return D.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(y,", codecs: ").concat(S)),!1;if(re("USE_PUB_RTX")||re("USE_SUB_RTX")){const _e=Wx(z,this.rtpCapabilities.recv.videoCodecs);z.push(..._e)}this._rtpCapabilities.recv.videoCodecs=z;const q=this.localCapabilities.send,Y=this.rtpCapabilities.recv,ce=CT(gt.VIDEO,Y,q,R);return V.forEach(_e=>{const Ee=ce.map(me=>me.payloadType.toString(10));D.debug("updateRemoteCodec mid: ".concat(_e.attributes.mid,", from"),_e.attributes.payloads,"to",ce),_e.attributes.payloads=ce,_e.media.fmts=Ee}),!0}createOrRecycleSendMedia(y,S,R,P,k){const z=this.rtpCapabilities.send,U=y===gt.VIDEO?z.videoCodecs:z.audioCodecs,V=y===gt.VIDEO?z.videoExtensions:z.audioExtensions;this.currentMidIndex+=1;const q="".concat(this.currentMidIndex);let Y={media:{mediaType:y,port:kT,protos:["UDP","TLS","RTP","SAVPF"],fmts:U.map(_e=>_e.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:V,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:S,ssrcGroups:R,rtcpFeedbackWildcards:[],payloads:U,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:P,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(q)}};Y=this.mungSendMediaDesc(Y,k);const ce=this.findFirstClosedMedia(y);if(ce){const _e=this.sessionDesc.mediaDescriptions.indexOf(ce);this.sessionDesc.mediaDescriptions[_e]=Y}else this.sessionDesc.mediaDescriptions.push(Y);return Y}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(y=>y.media.port!=="0").map(y=>y.attributes.mid)}mungRecvMediaDsec(y,S,R){const P=Mr(y);return jx(P),qv(P,S),Bx(P,S),oH(P),dP(P,R,this.localCapabilities.send),P}mungSendMediaDesc(y,S){const R=Mr(y);return dP(R,S,this.localCapabilities.recv),Yv(R),R}updateRecvMedia(y,S){const R=this.sessionDesc.mediaDescriptions.findIndex(P=>P.attributes.mid===y);if(R!==-1){const P=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[R],S);this.sessionDesc.mediaDescriptions[R]=P}}bumpMid(y){this.currentMidIndex+=y}findFirstClosedMedia(y){return this.sessionDesc.mediaDescriptions.find(S=>Dr()?S.media.port==="0"&&S.media.mediaType===y:S.media.port==="0")}findPreloadMediaDesc(y){return this.sessionDesc.mediaDescriptions.find(S=>{var R;return((R=S.attributes)===null||R===void 0||(R=R.ssrcs[0])===null||R===void 0?void 0:R.ssrcId)===y[0].ssrcId})}getSSRC(y){var S;return(S=this.sessionDesc.mediaDescriptions.find(R=>R.attributes.mid===y))===null||S===void 0?void 0:S.attributes.ssrcs}}(Ed(Ed({},r),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec),r.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const c=this.remoteSDP.toString(),u=lH(this.initialOffer.sdp,this.extension),h=this.logSDPExchange(u||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:u}),h==null||h(c),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c});const m=this.peerConnection.getTransceivers()[0];if(m!=null&&m.receiver&&this.tryBindTransportEvents(m.receiver),re("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia(re("PRELOAD_MEDIA_COUNT"));const y=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:y});const S=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(S)}const{preSSRCs:_}=r;if(Array.isArray(_)&&_.length>0){const{mids:y}=this.remoteSDP.batchSend(_.map(S=>({kind:S.kind,ssrcMsg:[{ssrcId:S.ssrcId,rtx:S.rtx}],mslabel:S.mslabel})));y.forEach((S,R)=>{this.preSSRCMap.set(_[R].ssrcId,S)}),await IT(this.peerConnection,this.remoteSDP,this.extension),D.debug("[".concat(this.store.clientId,"] [P2PConnection] pre-batchReceive exchange SDP."))}}catch(c){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(c.toString()))}var o,s}async updateRemoteConnect(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");const{rtpCapabilities:o}=r;this.remoteSDP.updateRemoteRTPCapabilities(o),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const{preSSRCs:s}=r;if(Array.isArray(s)&&s.length>0){const{mids:c}=this.remoteSDP.batchSend(s.map(u=>Object.assign({},{kind:u.kind,ssrcMsg:[{ssrcId:u.ssrcId,rtx:u.rtx}],mslabel:u.mslabel})));c.forEach((u,h)=>{this.preSSRCMap.set(s[h].ssrcId,u)})}await IT(this.peerConnection,this.remoteSDP,this.extension),D.debug("[P2PConnection] updateRemoteRTPCapabilities by exchanging SDP.")}catch(o){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(o.toString()))}}send(r,o,s){var c=this;return ml(function*(){const u=yield wn(c.mutex.lock("From P2PConnection.send"));try{if(!c.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const h=[],m=cP();r.forEach(V=>{const q=c.peerConnection.addTransceiver(V._mediaStreamTrack,Ed({direction:"sendonly"},V.trackMediaType==="video"&&c.supportAV1RtpSpec&&m?{sendEncodings:[{scalabilityMode:m}]}:{}));h.push(q),V._updateRtpTransceiver(q)}),Dr()&&re("SIMULCAST")===!0&&(yield wn(c.applySimulcastForFirefox(h,r)));const _=yield wn(c.peerConnection.createOffer()),y=c.remoteSDP.predictReceivingMids(r.length),S=c.mungSendOfferSDP(_.sdp,r,y),R=Sa(S),P=y.map(V=>{const q=R.mediaDescriptions.find(Y=>Y.attributes.mid===V);if(!q)throw new Error("Cannot extract ssrc from mediaDescription.");return nH(q,re("USE_PUB_RTX"))});let k;try{k=yield P}catch(V){k=[],c.remoteSDP.receive(r,o,s,k);const q=c.remoteSDP.toString();throw yield wn(c.peerConnection.setLocalDescription({type:"offer",sdp:S})),yield wn(c.peerConnection.setRemoteDescription({type:"answer",sdp:q})),yield wn(c.stopSending(y,!0)),V}c.remoteSDP.receive(r,o,s,k);const z=c.remoteSDP.toString(),U=c.logSDPExchange(S,"offer","local","send");return yield wn(c.peerConnection.setLocalDescription({type:"offer",sdp:S})),yield wn(c.applySimulcastEncodings(h,r)),yield wn(c.applySendEncodings(h,r)),U==null||U(z),yield wn(c.peerConnection.setRemoteDescription({type:"answer",sdp:z})),h.map((V,q)=>{const Y=y[q];return{localSSRC:P[q],id:Y,transceiver:V}})}catch(h){throw h instanceof Le?h:new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{u()}})()}async createDataChannels(r,o){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let s=this.dataStreamChannelMap.get(r);if(s&&s.readyState==="open")D.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const u=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof u!="number")throw new Error("create DataChannel error, because cannot get dc id");s=this.peerConnection.createDataChannel("datastream-channel",{id:u,negotiated:!0,ordered:!1,maxRetransmits:re("DATASTREAM_MAX_RETRANSMITS")}),s.binaryType="arraybuffer",this.dataStreamChannelMap.set(r,s)}o.forEach(u=>{u._updateOriginDataChannel(s)});const{needExchangeSDP:c}=this.remoteSDP.sendDataChannel();if(c){const u=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:u});const h=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(h),D.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else D.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(s){throw s instanceof Le?s:new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(s.toString()))}}async stopDataChannels(r){try{const o=this.dataStreamChannelMap.get(r);return o&&(o.id&&this.recoveredDataChannelIds.push(o.id),o.close()),void this.dataStreamChannelMap.delete(r)}catch(o){throw o instanceof Le?o:new Le(X.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(o.toString()))}}async stopSending(r,o){const s=o?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const c=this.peerConnection.getTransceivers().filter(_=>r.indexOf(_.mid)!==-1);if(c.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");c.map(_=>{var y;yP(this.id+_.mid,this),_.direction="inactive",(y=_.stop)===null||y===void 0||y.call(_)});const u=await this.peerConnection.createOffer(),h=this.logSDPExchange(u.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(u),this.remoteSDP.stopReceiving(r);const m=this.remoteSDP.toString();h==null||h(m),await this.peerConnection.setRemoteDescription({type:"answer",sdp:m})}catch(c){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(c.toString()))}finally{s&&s()}}async receive(r,o,s,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{mid:u,needExchangeSDP:h}=this.remoteSDP.send(r,o,s,c);h&&(await IT(this.peerConnection,this.remoteSDP,this.extension),D.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," by exchanging SDP.")));const m=this.peerConnection.getTransceivers().find(_=>_.mid===u);if(!m)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:m.receiver.track,id:u,transceiver:m}}catch(u){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async batchReceive(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:o,needExchangeSDP:s}=this.remoteSDP.batchSend(r);return s&&(await IT(this.peerConnection,this.remoteSDP,this.extension),D.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),o.map(c=>{const u=this.peerConnection.getTransceivers().find(h=>h.mid===c);if(!u)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:u.receiver.track,id:c,transceiver:u}})}catch(o){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(o.toString()))}}async stopReceiving(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");r.forEach(u=>{Array.from(this.preSSRCMap.entries()).some(h=>{let[m,_]=h;if(_===u)return this.preSSRCMap.delete(m),!0})}),this.remoteSDP.stopSending(r);const o=this.remoteSDP.toString(),s=this.logSDPExchange(o,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:o});const c=await this.peerConnection.createAnswer();s==null||s(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(o){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(o.toString()))}}async muteRemote(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(r," before remote SDP created."));this.remoteSDP.mute(r);const o=this.remoteSDP.toString(),s=this.logSDPExchange(o,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:o});const c=await this.peerConnection.createAnswer();s==null||s(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(o){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(o.toString()))}}async unmuteRemote(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(r," before remote SDP created."));this.remoteSDP.unmute(r);const o=this.remoteSDP.toString(),s=this.logSDPExchange(o,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:o});const c=await this.peerConnection.createAnswer();s==null||s(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(o){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(o.toString()))}}async muteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const o=this.peerConnection.getTransceivers().filter(h=>h.mid&&r.indexOf(h.mid)!==-1);if(o.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");o.map(h=>{h.direction="inactive"});const s=await this.peerConnection.createOffer(),c=this.logSDPExchange(s.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(s),this.remoteSDP.muteRemote(r);const u=this.remoteSDP.toString();c==null||c(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(o){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(o.toString()))}}async unmuteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const o=this.peerConnection.getTransceivers().filter(h=>h.mid&&r.indexOf(h.mid)!==-1);if(o.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");o.map(async(h,m)=>{h.direction="sendonly"});const s=await this.peerConnection.createOffer(),c=this.logSDPExchange(s.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(s),this.remoteSDP.unmuteRemote(r),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(r,this.remoteCodecs,this.store.codec);const u=this.remoteSDP.toString();c==null||c(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(o){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(o.toString()))}}restartICE(r){var o=this;return ml(function*(){const s=yield wn(o.mutex.lock("From P2PConnection.restartICE"));try{if(!o.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const c=kn().supportPCSetConfiguration,u=re("FORCE_TURN_TCP")||o.forceTurn;if(r===No.RELAY&&!c)return;if(c&&!u){const R=r===No.RELAY?"relay":"all",P=o.peerConnection.getConfiguration();P.iceTransportPolicy!==R&&(D.debug("[".concat(o.store.clientId,"] restartICE change iceTransportPolicy from [").concat(P.iceTransportPolicy,"] to [").concat(R,"]")),P.iceTransportPolicy=R,o.peerConnection.setConfiguration(P))}o.remoteSDP.updateCandidates(r);const h=yield wn(o.peerConnection.createOffer({iceRestart:!0}));if(!h.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const m=Nm(h.sdp),{remoteIceParameters:_}=yield m.iceParameters;o.remoteSDP.restartICE(_);const y=o.remoteSDP.toString(),S=o.logSDPExchange(h.sdp||"","offer","local","restartICE");o.store.descriptionStart(),yield wn(o.peerConnection.setLocalDescription(h)),S==null||S(y),yield wn(o.peerConnection.setRemoteDescription({type:"answer",sdp:y}))}catch(c){D.warning("[".concat(o.store.clientId,"] restart ICE failed, abort operation"),c)}finally{s()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const r=await this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates(No.TCP_RELAY),await IT(this.peerConnection,this.remoteSDP,this.extension)}catch(o){D.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),o)}finally{r()}}close(){var r;this.peerConnection.getTransceivers().forEach(o=>{yP(this.id+o.mid,this)}),this.preSSRCMap.clear(),this.peerConnection.close(),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return Ed(Ed({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}async updateEncoderConfig(r,o){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const s=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(s.sdp,[o],[r]);this.remoteSDP.updateRecvMedia(r,o);const u=this.remoteSDP.toString(),h=this.logSDPExchange(c,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),h==null||h(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(s){throw new Le(X.EXCHANGE_SDP_FAILED,s.toString())}}async updateSendParameters(r,o){const s=this.peerConnection.getTransceivers().filter(c=>c.mid===r);s.length===1&&(this.isVP8Simulcast(o)?Dr()||await this.applySimulcastEncodings(s,[o]):await this.applySendEncodings(s,[o]))}setStatsRemoteVideoIsReady(r,o){this.statsFilter.setVideoIsReady2(r,o)}async replaceTrack(r,o){const s=this.peerConnection.getTransceivers().find(c=>c.mid===o);s&&await s.sender.replaceTrack(r._mediaStreamTrack)}async getSelectedCandidatePair(){const r=this.peerConnection.getReceivers();if(r.length>0&&r[0].transport&&r[0].transport.iceTransport&&r[0].transport.iceTransport.getSelectedCandidatePair&&r[0].transport.iceTransport.getSelectedCandidatePair()){const o=r[0].transport.iceTransport,{local:s,remote:c}=o.getSelectedCandidatePair();return{local:Ed(Ed({},ph),{},{candidateType:s.type,protocol:s.protocol,address:s.address,port:s.port}),remote:Ed(Ed({},ph),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r;(r=this.onICEConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=r=>{if(r&&(r.errorCode||r.errorText)){var o;const s="code: ".concat(r.errorCode,", message: ").concat(r.errorText),c=r.port?"local: ".concat(r.port):"";D.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(s,"), url: ").concat(r.url||"",", host_candidate:").concat(c)),(o=this.onICECandidateError)===null||o===void 0||o.call(this,s)}},this.peerConnection.onicegatheringstatechange=r=>{r&&r.target&&"iceGatheringState"in r.target&&D.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(r.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=r=>{r.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,D.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,D.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},re("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r){const o={iceServers:[]};return r.iceServers?o.iceServers=r.iceServers:r.turnServer&&(hT(r.turnServer.servers)?o.iceServers=r.turnServer.servers:re("NEW_TURN_MODE")&&o.iceServers?(re("USE_TURN_SERVER_OF_GATEWAY")?r.turnServer.serversFromGateway&&o.iceServers.push(...oE.newTurnServerConfigToIceServers(r.turnServer.serversFromGateway)):o.iceServers.push(...oE.newTurnServerConfigToIceServers(r.turnServer.servers)),re("NEW_FORCE_TURN")&&(o.iceTransportPolicy="relay")):r.turnServer.mode!=="off"&&(o.iceServers&&o.iceServers.push(...oE.turnServerConfigToIceServers(r.turnServer.servers)),re("USE_TURN_SERVER_OF_GATEWAY")&&o.iceServers&&r.turnServer.serversFromGateway&&o.iceServers.push(...oE.turnServerConfigToIceServers(r.turnServer.serversFromGateway)),re("FORCE_TURN_TCP")?o.iceTransportPolicy="relay":r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(s=>{s.forceturn&&(o.iceTransportPolicy="relay")}))),re("ENABLE_ENCODED_TRANSFORM")&&kn().supportWebRTCEncodedTransform&&(o.encodedInsertableStreams=!0),o}static turnServerConfigToIceServers(r){const o=[];return r.forEach(s=>{s.security?s.tcpport&&o.push({username:s.username,credential:s.password,credentialType:"password",urls:"turns:".concat(Om(s.turnServerURL),":").concat(s.tcpport,"?transport=tcp")}):(s.udpport&&!re("FORCE_TURN_TCP")&&o.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.udpport,"?transport=udp")}),s.tcpport&&o.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.tcpport,"?transport=tcp")}))}),o}static newTurnServerConfigToIceServers(r){const o=[];return r.forEach(s=>{const c=re("NEW_TURN_MODE");c===1?o.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":3478?transport=udp")}):c===2?o.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":3478?transport=tcp")}):c===3?o.push({username:s.username,credential:s.password,credentialType:"password",urls:"turns:".concat(Om(s.turnServerURL),":443?transport=tcp")}):c===4&&(o.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":3478?transport=udp")}),o.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":3478?transport=tcp")}),o.push({username:s.username,credential:s.password,credentialType:"password",urls:"turns:".concat(Om(s.turnServerURL),":443?transport=tcp")}))}),o}tryBindTransportEvents(r){const o=r.transport;if(o){this.transportEventReceiver=r,o.onstatechange=()=>{var c;o!=null&&o.state&&((c=this.onDTLSTransportStateChange)===null||c===void 0||c.call(this,o.state))},o.onerror=c=>{var u;(u=this.onDTLSTransportError)===null||u===void 0||u.call(this,"error"in c?c.error:c)};const s=o.iceTransport;s&&(s.onstatechange=()=>{const c=o==null?void 0:o.iceTransport.state;var u;c&&((u=this.onICETransportStateChange)===null||u===void 0||u.call(this,c))},s.getSelectedCandidatePair&&(s.onselectedcandidatepairchange=()=>{if(s.getSelectedCandidatePair()){const{local:c,remote:u}=s.getSelectedCandidatePair();D.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:c.type,protocol:c.protocol}),", remote ").concat(JSON.stringify({candidateType:u.type,protocol:u.protocol,address:u.address,port:u.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(r,o){var s,c;if(o||(o=this.peerConnection.getSenders().find(V=>V.track===r._mediaStreamTrack)),!o)return D.warn("[".concat(r.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(r))return D.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!kn().supportSetRtpSenderParameters)return D.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const u={},h={};switch(r._optimizationMode){case"motion":u.degradationPreference="maintain-framerate";break;case"detail":u.degradationPreference="maintain-resolution";break;case"balanced":u.degradationPreference="balanced"}const m=function(U,V){return U.getTransceivers().find(q=>q.sender.track===V||q.receiver.track===V)}(this.peerConnection,r._mediaStreamTrack),_=ape(r);if(vme(r)&&m&&o&&_&&this.getLocalVideoStats&&st(s=["vp8","vp9"]).call(s,this.store.codec)){var y;const U=u.degradationPreference||(st(y=r._hints).call(y,ar.CUSTOM_TRACK)?re("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(V,q,Y,ce,_e,Ee){if(yP(V,Y),_e(q),ce!=="balanced"&&ce!=="maintain-framerate"&&ce!=="maintain-resolution")return;let me=-1;VH(V,q);const ke=window.setInterval(()=>{const ut=EP.get(V);if(!re("ENABLE_AG_ADAPTATION")||!ut)return yP(V,Y),void _e(q);const pt=Ee();if(pt.sendPackets>0&&pt.OutgoingAvailableBandwidth>0){if(me===-1)return void(me=Date.now());if(Date.now()-me<1e3)return;const vn=pt.sendFrameRate,Sn=pt.OutgoingAvailableBandwidth,[cr,Zr]=yme(V,vn,Sn,ut.adaptationConfig,q,ce);Zr&&(Y.qualityLimitationReason=Zr),cr&&ut.adaptationConfig.scale!==cr.scale&&(D.debug("[".concat(V,"] applyAdaptation: ").concat(Y.qualityLimitationReason,`
           sendFps `).concat(vn,", bwe ").concat(Sn,", switch from ").concat(ut.adaptationConfig.scale," to ").concat(cr.scale," ")),ut.adaptationConfig=Zx(Zx({},ut.adaptationConfig),cr),_e(cr))}},re("CHECK_LOCAL_STATS_INTERVAL")),Ye=Zx({},q);EP.set(V,{timer:ke,adaptationConfig:Ye,originConfig:q,adaptationFunc:_e}),D.debug("[".concat(V,"] start adaptation, originConfig: ").concat(JSON.stringify(q),", degradationPreference: ").concat(ce))})(this.id+m.mid,_,this,U,V=>{o&&this.updateAdaptation(o,V)},this.getLocalVideoStats.bind(this))}if(r._encoderConfig){var S;const{bitrateMax:U,frameRate:V,scaleResolutionDownBy:q}=r._encoderConfig;U&&(h.maxBitrate=1e3*U),(st(S=r._hints).call(S,ar.LOW_STREAM)||r.isUseScaleResolutionDownBy)&&(V&&(h.maxFramerate=nc(V)),q&&q>=1&&(h.scaleResolutionDownBy=q))}const{maxFramerate:R}=re("ENCODER_CONFIG_LIMIT");if(R&&typeof R=="number"&&(h.maxFramerate=h.maxFramerate?Math.min(h.maxFramerate,R):R),re("DSCP_TYPE")&&zf()){var P;const U=re("DSCP_TYPE");st(P=["very-low","low","medium","high"]).call(P,U)&&(h.networkPriority=U)}const k=o.getParameters(),z=(c=k.encodings)===null||c===void 0?void 0:c[0];Dr()&&!z&&(u.encodings=[h]),z&&Object.assign(z,h),Object.assign(k,u),D.debug("[".concat(r.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(k.encodings))),await o.setParameters(k),await async function(U,V,q){try{var Y;if(!kn().supportSetRtpSenderParameters||!function(ke){return ke==="vp9"||ke==="av1"}(U)||!re("ENABLE_SVC"))return;const ce={},_e={},Ee=V.getParameters(),me=(Y=Ee.encodings)===null||Y===void 0?void 0:Y[0];_e.scalabilityMode=cP(q),me&&Object.assign(me,_e),Object.assign(Ee,ce),await V.setParameters(Ee),D.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(Ee.encodings)))}catch(ce){D.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",ce)}}(this.store.codec,o,re("SVC_MODE"))}async updateAdaptation(r,o){var s,c;if(!r)return D.debug("[updateAdaptation] no rtpSender found");if(!kn().supportSetRtpSenderParameters)return D.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const u={},{bitrateMax:h,frameRate:m,scaleResolutionDownBy:_}=o;h&&(u.maxBitrate=1e3*h),m&&(u.maxFramerate=nc(m)),_&&_>=1&&st(s=["vp8","vp9"]).call(s,this.store.codec)&&(u.scaleResolutionDownBy=_);const y=r.getParameters(),S=(c=y.encodings)===null||c===void 0?void 0:c[0];S&&Object.assign(S,u),Object.assign(y,{});try{await r.setParameters(y),D.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(y.encodings)))}catch(R){!("transport"in r)||r.transport&&r.transport.state==="connected"?this.peerConnectionState!=="connected"?D.debug("[updateAdaptation] peerConnection not connected}"):D.debug("[updateAdaptation] updateRtpSenderEncodings failed",R):D.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(r,o){try{if(!kn().supportSetRtpSenderParameters||r.length!==o.length)return;for(let s=0;s<r.length;s++){const c=r[s],u=o[s];u instanceof mr&&!this.isVP8Simulcast(u)&&await this.updateRtpSenderEncodings(u,c.sender)}}catch{D.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(r,o,s){const c=Sa(r);return o.forEach((u,h)=>{const m=s[h],_=c.mediaDescriptions.find(y=>y.attributes.mid===m);_&&(qv(_,u),sH(_,u,this.store.codec))}),Im(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var o;(o=this.onFirstAudioReceived)===null||o===void 0||o.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var o;(o=this.onFirstVideoReceived)===null||o===void 0||o.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var o;(o=this.onFirstAudioDecoded)===null||o===void 0||o.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,o,s)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,r,o,s)},this.statsFilter.onSelectedLocalCandidateChanged=(r,o)=>{var s;(s=this.onSelectedLocalCandidateChanged)===null||s===void 0||s.call(this,r,o)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,o)=>{var s;(s=this.onSelectedRemoteCandidateChanged)===null||s===void 0||s.call(this,r,o)},this.statsFilter.onFirstVideoDecodedTimeout=r=>{var o;(o=this.onFirstVideoDecodedTimeout)===null||o===void 0||o.call(this,r)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(r,o){if(r.length===o.length)for(let _=0;_<r.length;_++){var s,c,u,h,m;const y=r[_],S=o[_];if(S instanceof mr&&!st(s=S._hints).call(s,ar.LOW_STREAM)&&(c=S._encoderConfig)!==null&&c!==void 0&&c.bitrateMax&&((u=S._encoderConfig)===null||u===void 0?void 0:u.bitrateMax)>200&&(h=S._scalabilityMode)!==null&&h!==void 0&&h.numSpatialLayers&&((m=S._scalabilityMode)===null||m===void 0?void 0:m.numSpatialLayers)>1&&this.store.codec==="vp8"){const R={},P={high:1e3*(S._encoderConfig.bitrateMax-50),medium:5e4};R.encodings=[{rid:"m",active:!0,maxBitrate:P.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:P.high}];const k=y.sender.getParameters();await y.sender.setParameters(Object.assign(k,R))}}}async applySimulcastEncodings(r,o){if(!Dr()&&r.length===o.length)for(let s=0;s<r.length;s++){const c=o[s];if(c instanceof mr&&this.isVP8Simulcast(c)){const u=r[s],h={},m={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};h.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];const _=u.sender.getParameters();await u.sender.setParameters(Object.assign(_,h))}}}isVP8Simulcast(r){var o,s,c,u,h;return!!(r instanceof mr&&re("SIMULCAST")&&this.store.codec==="vp8"&&!st(o=r._hints).call(o,ar.LOW_STREAM)&&(s=r._encoderConfig)!==null&&s!==void 0&&s.bitrateMax&&((c=r._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(u=r._scalabilityMode)!==null&&u!==void 0&&u.numSpatialLayers&&((h=r._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1)}logSDPExchange(r,o,s,c){if(re("SDP_LOGGING"))return D.upload("[".concat(this.store.clientId,"] exchanging ").concat(s," ").concat(o," SDP during P2PConnection.").concat(c,`
`),r),o==="offer"?u=>{this.logSDPExchange(u,"answer",s==="local"?"remote":"local",c)}:void 0}async getRemoteSSRC(r){if(!this.remoteSDP)return;const o=this.remoteSDP.getSSRC(r);return o&&o.length!==0?o[0].ssrcId:void 0}setConfiguration(r){if(kn().supportPCSetConfiguration){const o=oE.resolvePCConfiguration(r);this.peerConnection.setConfiguration(o)}}},vt(Tn.prototype,"updateRemoteRTPCapabilities",[Ks],Object.getOwnPropertyDescriptor(Tn.prototype,"updateRemoteRTPCapabilities"),Tn.prototype),vt(Tn.prototype,"connect",[Ks],Object.getOwnPropertyDescriptor(Tn.prototype,"connect"),Tn.prototype),vt(Tn.prototype,"updateRemoteConnect",[Ks],Object.getOwnPropertyDescriptor(Tn.prototype,"updateRemoteConnect"),Tn.prototype),vt(Tn.prototype,"createDataChannels",[Ks],Object.getOwnPropertyDescriptor(Tn.prototype,"createDataChannels"),Tn.prototype),vt(Tn.prototype,"receive",[Ks],Object.getOwnPropertyDescriptor(Tn.prototype,"receive"),Tn.prototype),vt(Tn.prototype,"batchReceive",[Ks],Object.getOwnPropertyDescriptor(Tn.prototype,"batchReceive"),Tn.prototype),vt(Tn.prototype,"stopReceiving",[Ks],Object.getOwnPropertyDescriptor(Tn.prototype,"stopReceiving"),Tn.prototype),vt(Tn.prototype,"muteRemote",[Ks],Object.getOwnPropertyDescriptor(Tn.prototype,"muteRemote"),Tn.prototype),vt(Tn.prototype,"unmuteRemote",[Ks],Object.getOwnPropertyDescriptor(Tn.prototype,"unmuteRemote"),Tn.prototype),vt(Tn.prototype,"muteLocal",[Ks],Object.getOwnPropertyDescriptor(Tn.prototype,"muteLocal"),Tn.prototype),vt(Tn.prototype,"unmuteLocal",[Ks],Object.getOwnPropertyDescriptor(Tn.prototype,"unmuteLocal"),Tn.prototype),vt(Tn.prototype,"close",[Ks],Object.getOwnPropertyDescriptor(Tn.prototype,"close"),Tn.prototype),vt(Tn.prototype,"updateEncoderConfig",[Ks],Object.getOwnPropertyDescriptor(Tn.prototype,"updateEncoderConfig"),Tn.prototype),vt(Tn.prototype,"updateSendParameters",[Ks],Object.getOwnPropertyDescriptor(Tn.prototype,"updateSendParameters"),Tn.prototype),vt(Tn.prototype,"replaceTrack",[Ks],Object.getOwnPropertyDescriptor(Tn.prototype,"replaceTrack"),Tn.prototype),vt(Tn.prototype,"updateAdaptation",[Ks],Object.getOwnPropertyDescriptor(Tn.prototype,"updateAdaptation"),Tn.prototype),vt(Tn.prototype,"getRemoteSSRC",[Ks],Object.getOwnPropertyDescriptor(Tn.prototype,"getRemoteSSRC"),Tn.prototype),Tn);function Ks(e,r,o){const s=e[r];if(typeof s!="function")throw new Error("Cannot use mutex on object property.");return o.value=async function(){const c=this.mutex,u=await c.lock("From P2PConnection.".concat(r));try{for(var h=arguments.length,m=new Array(h),_=0;_<h;_++)m[_]=arguments[_];return await s.apply(this,m)}finally{u()}},o}function rM(e,r){let o=document.createElement("video"),s=document.createElement("canvas");o.setAttribute("style","display:none"),s.setAttribute("style","display:none"),o.setAttribute("muted",""),o.muted=!0,o.setAttribute("autoplay",""),o.autoplay=!0,o.setAttribute("playsinline",""),s.width=nc(r.width),s.height=nc(r.height);const c=nc(r.framerate||15);document.body.append(o),document.body.append(s);let u=e._mediaStreamTrack;o.srcObject=new MediaStream([u]),o.play();const h=s.getContext("2d");if(!h)throw new Oe(X.UNEXPECTED_ERROR,"can not get canvas context");const m=kn(),_=s.captureStream(m.supportRequestFrame?0:c).getVideoTracks()[0];_.canvas||(_.canvas=s),s.startCapture=()=>{if(!o)return s.stopCapture&&s.stopCapture();if(o.paused&&o.play(),o.videoHeight>2&&o.videoWidth>2){const S=o.videoWidth,R=o.videoHeight/S,P=s.width*R;Math.abs(P-s.height)>=2&&(D.debug("adjust low stream resolution","".concat(s.width,"x").concat(s.height," -> ").concat(s.width,"x").concat(P)),s.height=P)}h.drawImage(o,0,0,s.width,s.height),_.requestFrame&&_.requestFrame(),u!==e._mediaStreamTrack&&(u=e._mediaStreamTrack,o.srcObject=new MediaStream([u]))},s.stopCapture=px(()=>s.startCapture&&s.startCapture(),c);const y=_.stop;return _.stop=()=>{y.call(_),o&&(o.remove(),o.srcObject=null,o=null),s&&(s.width=0,s.remove(),s.stopCapture&&s.stopCapture(),s.startCapture=void 0,s.stopCapture=void 0,s=null),D.debug("clean low stream renderer")},_}var SP=function(e){return e[e.HEIGHT=2033]="HEIGHT",e[e.FRAME_RATE=2034]="FRAME_RATE",e[e.WIDTH=2035]="WIDTH",e}(SP||{}),li=function(e){return e[e.FRAME_RATE=2002]="FRAME_RATE",e[e.WIDTH=2003]="WIDTH",e[e.HEIGHT=2004]="HEIGHT",e[e.PACKAGE_LOST=2005]="PACKAGE_LOST",e[e.AVG_ENCODE=2007]="AVG_ENCODE",e[e.NACKS=2009]="NACKS",e[e.PLIS=2010]="PLIS",e[e.FIRS=2011]="FIRS",e[e.BITRATE=2012]="BITRATE",e[e.PACKAGE_RATE=2031]="PACKAGE_RATE",e[e.ADAPTATION=2032]="ADAPTATION",e[e.ACTUAL_ENCODED=2060]="ACTUAL_ENCODED",e[e.BANDWIDTH=2061]="BANDWIDTH",e[e.RETRANSMIT=2062]="RETRANSMIT",e[e.TARGET_ENCODED=2064]="TARGET_ENCODED",e[e.TRANSMIT=2066]="TRANSMIT",e[e.FREEZE=2082]="FREEZE",e[e.DISABLED=2095]="DISABLED",e[e.PLAYER_STATUS=2128]="PLAYER_STATUS",e[e.QP_SUM=2143]="QP_SUM",e[e.BYTES_RETRANSMIT=2173]="BYTES_RETRANSMIT",e[e.PACKAGES_RETRANSMIT=2172]="PACKAGES_RETRANSMIT",e[e.HUGE_FRAME_SENT=2174]="HUGE_FRAME_SENT",e[e.KEY_FRAMES_ENCODED=2207]="KEY_FRAMES_ENCODED",e}(li||{}),F_=function(e){return e[e.BITRATE=2069]="BITRATE",e[e.PACKAGE_LOST=2070]="PACKAGE_LOST",e[e.PACKAGE_RATE=2071]="PACKAGE_RATE",e[e.HEIGHT=2073]="HEIGHT",e[e.FRAME_RATE=2075]="FRAME_RATE",e[e.WIDTH=2077]="WIDTH",e}(F_||{}),ui=function(e){return e[e.JITTER=-1]="JITTER",e[e.PACKAGE_LOST=2014]="PACKAGE_LOST",e[e.WIDTH=2018]="WIDTH",e[e.HEIGHT=2019]="HEIGHT",e[e.FRAME_RATE=2020]="FRAME_RATE",e[e.JITTER_BUFFER=2023]="JITTER_BUFFER",e[e.CURRENT_DELAY=2024]="CURRENT_DELAY",e[e.NACKS=2026]="NACKS",e[e.PLIS=2027]="PLIS",e[e.FIRS=2028]="FIRS",e[e.BITRATE=2029]="BITRATE",e[e.PACKAGE_RATE=2078]="PACKAGE_RATE",e[e.FREEZE=2084]="FREEZE",e[e.DISABLED=2101]="DISABLED",e[e.PLAYER_STATUS=2129]="PLAYER_STATUS",e[e.QP_SUM=2144]="QP_SUM",e[e.I_FRAME_DELAY=2149]="I_FRAME_DELAY",e[e.FRAMES_DROPPED=2181]="FRAMES_DROPPED",e[e.BYTES_RETRANSMIT=2175]="BYTES_RETRANSMIT",e[e.PACKAGES_RETRANSMIT=2176]="PACKAGES_RETRANSMIT",e[e.PACKAGES_DISCARDED=2198]="PACKAGES_DISCARDED",e[e.AVG_DECODE=2200]="AVG_DECODE",e[e.AVG_PROCESSING_DELAY=2202]="AVG_PROCESSING_DELAY",e[e.AVG_ASSEMBLY_TIME=2203]="AVG_ASSEMBLY_TIME",e[e.AVG_INTER_FRAME_DELAY=2204]="AVG_INTER_FRAME_DELAY",e[e.KEY_FRAMES_DECODED=2206]="KEY_FRAMES_DECODED",e}(ui||{}),j_=function(e){return e[e.FRAME_RATE_DECODE=2021]="FRAME_RATE_DECODE",e[e.FRAME_RATE_RENDER=2022]="FRAME_RATE_RENDER",e[e.FRAME_RATE_OUTPUT=2155]="FRAME_RATE_OUTPUT",e[e.FREEZE_TIME=2109]="FREEZE_TIME",e[e.FREEZE_TIME_RENDER=2147]="FREEZE_TIME_RENDER",e[e.FREEZE_DURATION=2156]="FREEZE_DURATION",e}(j_||{}),zH=function(e){return e[e.PCM_LEVEL=2104]="PCM_LEVEL",e}(zH||{}),Sh=function(e){return e[e.PACKAGE_LOST=-1]="PACKAGE_LOST",e[e.LEVEL=2038]="LEVEL",e[e.BITRATE=2039]="BITRATE",e[e.PACKAGE_RATE=2040]="PACKAGE_RATE",e[e.AEC_RETURN_LOSS=2041]="AEC_RETURN_LOSS",e[e.AEC_RETURN_LOSS_ENH=2042]="AEC_RETURN_LOSS_ENH",e[e.FREEZE=2081]="FREEZE",e[e.DISABLED=2096]="DISABLED",e[e.BYTES_RETRANSMIT=2179]="BYTES_RETRANSMIT",e[e.PACKAGES_RETRANSMIT=2180]="PACKAGES_RETRANSMIT",e}(Sh||{}),qs=function(e){return e[e.BITRATE=2044]="BITRATE",e[e.PACKAGE_LOST=2045]="PACKAGE_LOST",e[e.PACKAGE_RATE=2046]="PACKAGE_RATE",e[e.CURRENT_DELAY=2047]="CURRENT_DELAY",e[e.JITTER_BUFFER=2054]="JITTER_BUFFER",e[e.JITTER=2055]="JITTER",e[e.FREEZE=2083]="FREEZE",e[e.DISABLED=2102]="DISABLED",e[e.PCM_LEVEL=2105]="PCM_LEVEL",e[e.PLAYER_STATUS=2130]="PLAYER_STATUS",e[e.CONCEALED_SAMPLES=2148]="CONCEALED_SAMPLES",e[e.BYTES_RETRANSMIT=2178]="BYTES_RETRANSMIT",e[e.PACKAGES_RETRANSMIT=2177]="PACKAGES_RETRANSMIT",e[e.PACKAGES_DISCARDED=2199]="PACKAGES_DISCARDED",e[e.AVG_PROCESSING_DELAY=2201]="AVG_PROCESSING_DELAY",e[e.TOTAL_SAMPLES_RECEIVED=2224]="TOTAL_SAMPLES_RECEIVED",e}(qs||{}),GH=function(e){return e[e.FREEZE_TIME=-1]="FREEZE_TIME",e[e.LEVEL=2043]="LEVEL",e}(GH||{}),Ys=function(e){return e[e.RTT=2006]="RTT",e[e.CONN_TYPE=801]="CONN_TYPE",e[e.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",e}(Ys||{}),bP=function(e){return e[e.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",e}(bP||{});const B_=1e3,W_=6,TP=3,Tme=Math.max(W_,TP);function Ft(e,r,o){o!=null&&Number.isFinite(o)&&(e[r]=Math.round(Math.max(0,o)))}function HH(e){const r={[Ys.CONN_TYPE]:0,[Ys.RTT]:e.rtt,[Ys.STATS_UPDATE_INTERVAL]:e.updateInterval?Math.round(Math.max(0,e.updateInterval)):void 0};switch(e.selectedCandidatePair.localCandidate.candidateType){case"relay":{const o=e.selectedCandidatePair.localCandidate.relayProtocol;o==="udp"&&(r[Ys.CONN_TYPE]=1),o==="tcp"&&(r[Ys.CONN_TYPE]=3),o==="tls"&&(r[Ys.CONN_TYPE]=4);break}case"srflx":r[Ys.CONN_TYPE]=2;break;case"unknown":r[Ys.CONN_TYPE]=5;break;default:r[Ys.CONN_TYPE]=0}return r}function $H(e){let r=0;switch(e){case"none":r=0;break;case"cpu":r=1;break;case"bandwidth":r=2;break;case"other":r=3}return r}class KH extends Pr{constructor(r){super(),$(this,"store",void 0),$(this,"uploadWRTCStatsTimer",void 0),$(this,"uploadOutboundDenoiserStatsTimer",void 0),$(this,"uploadExtStatsTimer",void 0),$(this,"uploadExtUsageStatsTimer",void 0),$(this,"uploadInboundExtStatsTimer",void 0),$(this,"requestStats",void 0),$(this,"requestTransportStats",void 0),$(this,"requestLocalMedia",void 0),$(this,"requestRemoteMedia",void 0),$(this,"requestAllTracks",void 0),$(this,"requestVideoIsReady",void 0),$(this,"requestUploadStats",void 0),$(this,"requestUpload",void 0),$(this,"uploadOutboundStarted",!1),$(this,"uploadInboundStarted",!1),$(this,"uploadTransportStarted",!1),$(this,"uploadBaseStatsStarted",!1),$(this,"uploadExtensionUsageStarted",!1),$(this,"lastRecvStats",void 0),$(this,"lastSendStats",void 0),$(this,"lastRefRecvStats",void 0),$(this,"lastRefSendStats",void 0),$(this,"lastFullRecvStats",void 0),$(this,"lastFullSendStats",void 0),$(this,"needUploadRenderFreezeTime",!0),this.store=r}uploadWRTCStats(r){if(!this.requestStats||!this.requestUploadStats)return;const o=r%TP==0,s=r%W_==0;let c,u;if(this.uploadTransportStarted&&(c=this.requestStats(),this.store.useP2P&&(u=this.requestStats(!0))),!c&&this.uploadOutboundStarted&&(c=this.requestStats()),!u&&this.uploadInboundStarted&&(u=this.requestStats(!0)),c||u){var h;const m={};if(this.uploadTransportStarted&&c){const y=this.getTransportStats(c,u,o);y&&(m.misc=[y])}if(this.uploadOutboundStarted&&c){const y=this.getOutboundStats(c,s?this.lastFullSendStats:o?this.lastRefSendStats:this.lastSendStats,o,s);y&&(m.outbound=[y])}if(this.uploadInboundStarted&&u){const y=this.getInboundStats(u,s?this.lastFullRecvStats:o?this.lastRefRecvStats:this.lastRecvStats,o,s);y&&(m.inbound=y)}const _=(h=this.requestTransportStats)===null||h===void 0?void 0:h.call(this).connectState;_&&(Array.isArray(m.misc)?m.misc[0]&&m.misc[0].addition&&(m.misc[0].addition[bP.RTC_PEER_CONNECTION_STATE]=ZL[_]):m.misc=[{addition:{[bP.RTC_PEER_CONNECTION_STATE]:ZL[_]}}]),this.requestUploadStats(m)}this.lastRecvStats=u,this.lastSendStats=c,s&&(this.lastFullRecvStats=u,this.lastFullSendStats=c),o&&(this.lastRefRecvStats=u,this.lastRefSendStats=c)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0;let r=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var o,s;const c=(o=this.requestTransportStats)===null||o===void 0?void 0:o.call(this);return void(c&&((s=this.requestUploadStats)===null||s===void 0||s.call(this,{misc:[{addition:{[bP.RTC_PEER_CONNECTION_STATE]:ZL[c.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(r),++r===Tme+1&&(r=1)},B_)}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0)}getTransportStats(r,o,s){if(!this.requestStats)return;if(!s)return r.rtt==null?void 0:{addition:{[Ys.RTT]:r.rtt,[Ys.CONN_TYPE]:void 0,[Ys.STATS_UPDATE_INTERVAL]:r.updateInterval||void 0}};const c=HH(r);if(this.store.useP2P){if(o){const u=HH(o);c[Ys.CONN_TYPE]+=u[Ys.CONN_TYPE]<<3}c[Ys.CONN_TYPE]+=110}else c[Ys.CONN_TYPE]+=100;return{addition:c}}getOutboundStats(r,o,s,c){if(!this.requestUploadStats||!this.requestLocalMedia)return;const u=this.requestLocalMedia();if(!u||u.length===0)return;let h,m,_;return u.forEach(y=>{let[S,{track:R,ssrcs:P}]=y;switch(S){case $e.LocalVideoLowTrack:case $e.LocalVideoTrack:if(S===$e.LocalVideoTrack){const k=function(V,q,Y,ce,_e,Ee){const me=q.videoSend.find(pt=>pt.ssrc===V);if(!me)return;const ke={},{sentFrame:Ye,inputFrame:ut}=me;if(Ee&&(Ft(ke,li.QP_SUM,me.qpSumPerFrame),ut&&Ye)){const pt=ut.frameRate,vn=Ye.frameRate;ke[li.FREEZE]=function(Sn,cr){let Zr=!0;return Zr=!(Sn<=5)&&(Sn<=10?cr<3:Sn<=20?cr<4:cr<5),Zr}(pt,vn)?1:0}if(_e){switch(Ye&&(Ft(ke,li.HEIGHT,Ye.height),Ft(ke,li.WIDTH,Ye.width),Ft(ke,li.FRAME_RATE,Ye.frameRate)),ke[li.DISABLED]=ce._originMediaStreamTrack&&!ce._originMediaStreamTrack.enabled||ce._mediaStreamTrack&&!ce._mediaStreamTrack.enabled?1:0,me.adaptionChangeReason){case"none":ke[li.ADAPTATION]=0;break;case"cpu":ke[li.ADAPTATION]=1;break;case"bandwidth":ke[li.ADAPTATION]=2;break;case"other":ke[li.ADAPTATION]=3}let pt=0;me.adaptionChangeReason&&(pt+=$H(me.adaptionChangeReason)),q.qualityLimitationReason&&(pt+=$H(q.qualityLimitationReason)<<3),ke[li.ADAPTATION]=pt,ke[li.PLAYER_STATUS]=hx[ce._player?ce._player.videoElementStatus:"uninit"],Ft(ke,li.NACKS,me.nacksCount),Ft(ke,li.PLIS,me.plisCount),Ft(ke,li.FIRS,me.firsCount),Ft(ke,li.AVG_ENCODE,me.avgEncodeMs),Ft(ke,li.HUGE_FRAME_SENT,me.hugeFramesSent),Ft(ke,li.BYTES_RETRANSMIT,me.retransmittedBytesSent),Ft(ke,li.PACKAGES_RETRANSMIT,me.retransmittedPacketsSent),Ft(ke,li.KEY_FRAMES_ENCODED,me.keyFramesEncoded);const vn=Y&&Y.videoSend.find(Sn=>Sn.ssrc===V);if(vn){let Sn=_e?B_:B_*W_;vn.timestamp&&me.timestamp&&(Sn=me.timestamp-vn.timestamp),vn.packets!=null&&me.packets!=null&&Ft(ke,li.PACKAGE_RATE,1e3*(me.packets-vn.packets)/Sn),me.packetsLost!=null&&vn.packetsLost!=null&&Ft(ke,li.PACKAGE_LOST,me.packetsLost-vn.packetsLost),vn.bytes!=null&&me.bytes!=null&&Ft(ke,li.BITRATE,8*(me.bytes-vn.bytes)/Sn)}}return ke}(P[0].ssrcId,r,o,R,s,c),z=R&&function(V,q,Y,ce){const _e=q.videoSend.find(me=>me.ssrc===V);if(!_e)return null;const Ee={};if(ce){const me=_e.inputFrame,ke=me&&me.height||Y.videoHeight||0,Ye=me&&me.width||Y.videoWidth||0,ut=me&&me.frameRate||0;Ft(Ee,SP.HEIGHT,ke),Ft(Ee,SP.WIDTH,Ye),Ft(Ee,SP.FRAME_RATE,ut)}return Ee}(P[0].ssrcId,r,R,s),U=function(V,q){const Y={};return q&&(Ft(Y,li.RETRANSMIT,V.bitrate.retransmit),Ft(Y,li.TARGET_ENCODED,V.bitrate.targetEncoded),Ft(Y,li.ACTUAL_ENCODED,V.bitrate.actualEncoded),Ft(Y,li.TRANSMIT,V.bitrate.transmit),Ft(Y,li.BANDWIDTH,V.sendBandwidth)),Y}(r,s);m=Object.assign({},k,z,U)}else _=function(k,z,U,V){const q=z.videoSend.find(ce=>ce.ssrc===k);if(!q)return;const Y={};if(V){const ce=q.sentFrame;if(ce&&(Ft(Y,F_.HEIGHT,ce.height),Ft(Y,F_.WIDTH,ce.width),Ft(Y,F_.FRAME_RATE,ce.frameRate)),U){const _e=U.videoSend.find(Ee=>Ee.ssrc===k);if(_e){let Ee=B_*W_;_e.timestamp&&q.timestamp&&(Ee=q.timestamp-_e.timestamp),_e.packets!=null&&q.packets!=null&&Ft(Y,F_.PACKAGE_RATE,1e3*(q.packets-_e.packets)/Ee),q.packetsLost!=null&&_e.packetsLost!=null&&Ft(Y,F_.PACKAGE_LOST,q.packetsLost-_e.packetsLost),_e.bytes!=null&&q.bytes!=null&&Ft(Y,F_.BITRATE,8*(q.bytes-_e.bytes)/Ee)}}}return Y}(P[0].ssrcId,r,o,s);break;case $e.LocalAudioTrack:h=R&&function(k,z,U,V,q){const Y=z.audioSend.find(_e=>_e.ssrc===k);if(!Y)return;const ce={};if(q){ce[Sh.DISABLED]=V._originMediaStreamTrack&&!V._originMediaStreamTrack.enabled||V._mediaStreamTrack&&!V._mediaStreamTrack.enabled?1:0;const _e=100*V._source.getAccurateVolumeLevel(),Ee=Y.inputLevel;if(Ee!=null){const ke=Math.ceil(50*Math.log10(100*Ee+1));Ft(ce,Sh.LEVEL,ke)}Ft(ce,zH.PCM_LEVEL,_e),Ft(ce,Sh.AEC_RETURN_LOSS,Y.aecReturnLoss),Ft(ce,Sh.AEC_RETURN_LOSS_ENH,Y.aecReturnLossEnhancement),Ft(ce,Sh.BYTES_RETRANSMIT,Y.retransmittedBytesSent),Ft(ce,Sh.PACKAGES_RETRANSMIT,Y.retransmittedPacketsSent),ce[Sh.FREEZE]=0;const me=U&&U.audioSend.find(ke=>ke.ssrc===k);if(me){let ke=B_*W_;me.timestamp&&Y.timestamp&&(ke=Y.timestamp-me.timestamp),me.bytes!=null&&Y.bytes!=null&&Ft(ce,Sh.BITRATE,8*(Y.bytes-me.bytes)/ke),me.packets!=null&&Y.packets!=null&&Ft(ce,Sh.PACKAGE_RATE,1e3*(Y.packets-me.packets)/ke)}}return ce}(P[0].ssrcId,r,o,R,s)}}),{high:m,low:_,audio:h}}getInboundStats(r,o,s,c){if(!this.requestRemoteMedia)return;const u=this.requestRemoteMedia()||[],h=[];return u.forEach(m=>{let[_,y]=m;const S={peer:_.uid};if(y.has(gt.VIDEO)&&_.videoTrack){const R=_._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(_._videoSSRC)||!1,P=_.videoTrack?function(k,z,U,V,q,Y,ce,_e){const Ee=z.videoRecv.find(Sn=>Sn.ssrc===k);if(!Ee)return;const me={},{receivedFrame:ke,outputFrame:Ye,decodeFrameRate:ut}=Ee,pt=U&&U.videoRecv.find(Sn=>Sn.ssrc===k);if(Ft(me,j_.FRAME_RATE_DECODE,ut),Ee.framesRateFirefox&&Ft(me,ui.FRAME_RATE,Ee.framesRateFirefox),ke&&Ft(me,ui.FRAME_RATE,ke.frameRate),Ft(me,ui.FRAMES_DROPPED,Ee.framesDroppedCount),Ft(me,ui.BYTES_RETRANSMIT,Ee.retransmittedBytesReceived),Ft(me,ui.PACKAGES_RETRANSMIT,Ee.retransmittedPacketsReceived),Ft(me,ui.PACKAGES_DISCARDED,Ee.packetsDiscarded),Ft(me,ui.AVG_DECODE,Ee.avgDecodeMs),Ft(me,ui.AVG_PROCESSING_DELAY,Ee.avgProcessingDelayMs),Ft(me,ui.AVG_ASSEMBLY_TIME,Ee.avgFramesAssembledFromMultiplePacketsMs),Ft(me,ui.AVG_INTER_FRAME_DELAY,Ee.avgInterFrameDelayMs),Ft(me,ui.KEY_FRAMES_DECODED,Ee.keyFramesDecoded),pt){const Sn=z.timestamp-U.timestamp||B_*(_e?W_:ce?TP:1);Ee.packetsLost!=null&&pt.packetsLost!=null&&Ft(me,ui.PACKAGE_LOST,Ee.packetsLost-pt.packetsLost),pt.bytes!=null&&Ee.bytes!=null&&Ft(me,ui.BITRATE,8*(Ee.bytes-pt.bytes)/Sn),pt.packets!=null&&Ee.packets!=null&&Ft(me,ui.PACKAGE_RATE,1e3*(Ee.packets-pt.packets)/Sn)}if(_e&&(Ft(me,ui.QP_SUM,Ee.qpSumPerFrame),me[ui.FREEZE]=q&&OT.isRemoteVideoFreeze(V,Ee,pt)?1:0),ce){var vn;ke?(Ft(me,ui.HEIGHT,ke.height),Ft(me,ui.WIDTH,ke.width)):V&&(Ft(me,ui.HEIGHT,V._videoHeight||0),Ft(me,ui.WIDTH,V._videoWidth||0)),Ye&&Ft(me,j_.FRAME_RATE_OUTPUT,Ye.frameRate);const Sn=(vn=V._player)===null||vn===void 0?void 0:vn.rendFrameRate.toFixed(0);if(Sn&&Ft(me,j_.FRAME_RATE_RENDER,+Sn),Ft(me,ui.JITTER_BUFFER,Ee.jitterBufferMs),Ft(me,ui.CURRENT_DELAY,Ee.currentDelayMs),Ft(me,ui.FIRS,Ee.firsCount),Ft(me,ui.NACKS,Ee.nacksCount),Ft(me,ui.PLIS,Ee.plisCount),V){me[ui.DISABLED]=V._originMediaStreamTrack.enabled&&V._mediaStreamTrack.enabled?0:1;const cr=V._player;if(cr){const{freezeTimeCounterList:Zr,renderFreezeAccTime:Wr,videoElementStatus:Js}=cr;if(Zr&&Zr.length>0&&Ft(me,j_.FREEZE_TIME,Zr.splice(0,1)[0]),Y&&$f.visibility==="visible"&&Js===ts.PLAYING&&kn().supportRequestVideoFrameCallback){const je=Math.min(6e3,Wr);cr.renderFreezeAccTime=Math.max(0,Wr-je),Ft(me,j_.FREEZE_TIME_RENDER,je)}if(typeof Ee.totalFreezesDuration=="number"){const je=pt&&pt.totalFreezesDuration?Ee.totalFreezesDuration-pt.totalFreezesDuration:Ee.totalFreezesDuration;Ft(me,j_.FREEZE_DURATION,1e3*je)}}}if(me[ui.PLAYER_STATUS]=hx[V._player?V._player.videoElementStatus:"uninit"],pt&&Ee.totalInterFrameDelay!==void 0&&Ee.totalSquaredInterFrameDelay!==void 0&&pt.totalInterFrameDelay!==void 0&&pt.totalSquaredInterFrameDelay!==void 0){const cr=Ee.totalInterFrameDelay-pt.totalInterFrameDelay,Zr=Ee.totalSquaredInterFrameDelay-pt.totalSquaredInterFrameDelay,Wr=Ee.framesDecodeCount-pt.framesDecodeCount,Js=cr/Wr*1e3,je=Math.round(1e3*Math.sqrt((Zr-Math.pow(cr,2)/Wr)/Wr));!isNaN(je)&&Js+je>Math.max(3*Js,Js+150)&&(me[ui.I_FRAME_DELAY]=je)}}return me}(_._videoSSRC,r,o,_.videoTrack,R===!0,this.needUploadRenderFreezeTime,s,c):void 0;P&&(S.video=P)}if(y.has(gt.AUDIO)&&_.audioTrack){const R=_.audioTrack?function(P,k,z,U,V,q){const Y=k.audioRecv.find(me=>me.ssrc===P);if(!Y)return;const ce={},_e=z&&z.audioRecv.find(me=>me.ssrc===P);if(Ft(ce,qs.JITTER,Y.jitterMs),Ft(ce,qs.BYTES_RETRANSMIT,Y.retransmittedBytesReceived),Ft(ce,qs.PACKAGES_RETRANSMIT,Y.retransmittedPacketsReceived),Ft(ce,qs.PACKAGES_DISCARDED,Y.packetsDiscarded),Ft(ce,qs.AVG_PROCESSING_DELAY,Y.avgProcessingDelayMs),_e){const me=k.timestamp-z.timestamp||B_*(q?W_:V?TP:1);Y.packets!=null&&_e.packets!=null&&Ft(ce,qs.PACKAGE_RATE,1e3*(Y.packets-_e.packets)/me),V&&_e.bytes!=null&&Y.bytes!=null&&Ft(ce,qs.BITRATE,8*(Y.bytes-_e.bytes)/me),Y.packetsLost!=null&&_e.packetsLost!=null&&Ft(ce,qs.PACKAGE_LOST,Y.packetsLost-_e.packetsLost)}if(q){const{receivedFrames:me,droppedFrames:ke}=Y;me!=null&&ke!=null&&(ce[qs.FREEZE]=(Ee=me)===0||100*ke/Ee>20?1:0)}var Ee;if(V){const me=100*U._source.getAccurateVolumeLevel(),ke=Y.outputLevel;if(ke!=null){const Ye=Math.ceil(50*Math.log10(100*ke+1));Ft(ce,GH.LEVEL,Ye)}if(Ft(ce,qs.PCM_LEVEL,me),U&&(ce[qs.DISABLED]=U._originMediaStreamTrack.enabled&&U._mediaStreamTrack.enabled?0:1),Ft(ce,qs.JITTER_BUFFER,Y.jitterBufferMs),Ft(ce,qs.CURRENT_DELAY,Y.jitterBufferMs),ce[qs.PLAYER_STATUS]=hx[$s.getPlayerState(U.getTrackId())],_e){const Ye=Y.concealedSamples-_e.concealedSamples;Ye>0&&Ft(ce,qs.CONCEALED_SAMPLES,Ye);const ut=Y.totalSamplesReceived-_e.totalSamplesReceived;ut>0&&Ft(ce,qs.TOTAL_SAMPLES_RECEIVED,ut)}}return ce}(_._audioSSRC,r,o,_.audioTrack,s,c):void 0;R&&(S.audio=R)}(S.video||S.audio)&&h.push(S)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,h}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;const r=(this.requestAllTracks()||[]).find(o=>o instanceof $A);if(r&&r._external.getDenoiserStats){const o=r._external.getDenoiserStats();o&&this.requestUpload(vT.DENOISER_STATS,o)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(r=>{r.getProcessorStats().forEach(o=>{this.requestUpload&&this.requestUpload(o.type,o.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(r=>{let[o,s]=r;s.has(gt.VIDEO)&&o.videoTrack&&o.videoTrack.getProcessorStats().forEach(c=>{this.requestUpload&&this.requestUpload(c.type,c.stats)}),s.has(gt.AUDIO)&&o.audioTrack&&o.audioTrack.getProcessorStats().forEach(c=>{this.requestUpload&&this.requestUpload(c.type,c.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0))}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const r=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{const o=Date.now(),s={connectionInterval:re("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:o};let c=[];const u=this.requestAllTracks&&this.requestAllTracks()||[];for(const y of u)!y.muted&&y.enabled&&(c=c.concat(await y.getProcessorUsage()));const h=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[y,S]of h)S.has(gt.VIDEO)&&y.videoTrack&&(c=c.concat(await y.videoTrack.getProcessorUsage())),S.has(gt.AUDIO)&&y.audioTrack&&(c=c.concat(await y.audioTrack.getProcessorUsage()));if(c.length===0)return;s.details=function(y,S){const R={};for(const{id:U,value:V,level:q,direction:Y}of y){var P;const ce=(P=S.get(U))!==null&&P!==void 0?P:0,_e=V===2?ce+re("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:ce;var k,z;S.set(U,_e),R[U]?(V===2&&(R[U].value=V),q>R[U].level&&(R[U].level=q),Y==="remote"&&(R[U].remoteUidCount+=1),R[U].totalTs=(k=S.get(U))!==null&&k!==void 0?k:0):R[U]={value:V,level:q,remoteUidCount:Y==="local"?0:1,totalTs:(z=S.get(U))!==null&&z!==void 0?z:0}}return Object.keys(R).map(U=>{const{level:V,value:q,totalTs:Y}=R[U];return{id:U,level:V,value:q,totalTs:Y}})}(c,r);const m=Date.now(),_=m>o?m:o+1;this.requestUpload&&this.requestUpload(vT.EXTENSION_USAGE_STATS,{usageStats:s,sendTs:_})},re("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1}}const wme=re("ICE_RESTART_INTERVAL");let wP=new Map,Zv=new Map,xm=[No.UDP_TCP_RELAY,No.TCP_RELAY,No.RELAY],iM=re("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&kn().supportPCSetConfiguration;function qH(e){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const o=wP.get(e.id);o&&(window.clearTimeout(o),wP.delete(e.id));const s=Zv.get(e.id);r&&s&&s.index===xm.length-1&&(D.debug("[".concat(e.id,"] reset ICE restart policy")),Zv.delete(e.id))}function YH(e,r,o){if(wP.size===0&&Zv.size===0&&(Array.isArray(re("RESTART_SEQUENCE"))&&re("RESTART_SEQUENCE").length>0&&!function(m,_){if(m.length!==_.length)return!1;for(let y=0;y<m.length;y+=1){const S=m[y];if(m.filter(R=>R===S).length!==_.filter(R=>R===S).length)return!1}return!0}(xm,re("RESTART_SEQUENCE"))&&(xm=re("RESTART_SEQUENCE").filter(m=>{var _;if(st(_=Object.values(No)).call(_,m))return!0}),D.debug("use reconnection policy from config distribution, queues: ".concat(xm.join(" => ")))),iM=re("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&kn().supportPCSetConfiguration),xm.length===0)return void o();let s,{index:c=0,type:u}=Zv.get(e.id)||{};if(iM&&u===No.RELAY)return void o();let h=u&&c>=xm.length-1;if(iM)u=No.RELAY;else{if(h)return void o();u?(c++,u=xm[c]):(u=xm[0],c=0)}D.debug("[".concat(e.id,"] choose ICE restart policy: ").concat(u,", index: ").concat(c)),r(u),Zv.set(e.id,{index:c,type:u}),s=window.setTimeout(()=>YH(e,r,o),wme),wP.set(e.id,s)}var un;function XH(e,r){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),o.push.apply(o,s)}return o}function bh(e){for(var r=1;r<arguments.length;r++){var o=arguments[r]!=null?arguments[r]:{};r%2?XH(Object(o),!0).forEach(function(s){$(e,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):XH(Object(o)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(o,s))})}return e}function JH(e){var r,o,s,c=2;for(typeof Symbol<"u"&&(o=AL,s=Symbol.iterator);c--;){if(o&&(r=e[o])!=null)return r.call(e);if(s&&(r=e[s])!=null)return new RP(r.call(e));o="@@asyncIterator",s="@@iterator"}throw new TypeError("Object is not async iterable")}function RP(e){function r(o){if(Object(o)!==o)return lt.reject(new TypeError(o+" is not an object."));var s=o.done;return lt.resolve(o.value).then(function(c){return{value:c,done:s}})}return RP=function(o){this.s=o,this.n=o.next},RP.prototype={s:null,n:null,next:function(){return r(this.n.apply(this.s,arguments))},return:function(o){var s=this.s.return;return s===void 0?lt.resolve({value:o,done:!0}):r(s.apply(this.s,arguments))},throw:function(o){var s=this.s.return;return s===void 0?lt.reject(o):r(s.apply(this.s,arguments))}},new RP(e)}let NT=(un=class extends Pr{get state(){return this._state}set state(e){const r=this._state;this._state=e,this.emit(kt.StateChange,r,this._state)}constructor(e,r){super(),$(this,"isPlanB",void 0),$(this,"store",void 0),$(this,"statsUploader",void 0),$(this,"connection",void 0),$(this,"localTrackMap",new Map),$(this,"remoteUserMap",new Map),$(this,"localDataChannels",[]),$(this,"remoteDataChannelMap",new Map),$(this,"pendingLocalTracks",[]),$(this,"pendingRemoteTracks",[]),$(this,"pendingLocalDataChannels",[]),$(this,"pendingRemoteDataChannels",[]),$(this,"statsCollector",void 0),$(this,"shouldForwardP2PCreation",void 0),$(this,"iceFailedCount",0),$(this,"dtlsFailedCount",0),$(this,"mutex",void 0),$(this,"_state",Bn.Disconnected),$(this,"_pcStatsUploadType",re("NEW_ICE_RESTART")?Xf.FIRST_CONNECTION:Xf.OLD_FIRST_CONNECTION),$(this,"_isStartRestartIce",!1),$(this,"_restartTimer",void 0),$(this,"_isTryConnecting",!1),$(this,"_iceError",null),$(this,"_forceTurn",!1),$(this,"_isWaitPcToRePub",!1),$(this,"handleMuteLocalTrack",async(o,s,c)=>{const u=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==Bn.Connected)return void c(new Le(X.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const h=this.filterTobeMutedTracks(o);if(h.length===0)return void s();const m=h.find(y=>y[0]==="videoLowTrack");m&&m[1].track._originMediaStreamTrack.stop(),await this.connection.muteLocal(h.map(y=>{let[,{id:S}]=y;return S}));const _=this.createMuteMessage(h);await or(this,kt.RequestMuteLocal,_),s()}catch(h){c(h)}finally{u()}}),$(this,"handleUnmuteLocalTrack",async(o,s,c)=>{const u=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==Bn.Connected)return void c(new Le(X.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const h=this.filterTobeUnmutedTracks(o);if(h.length===0)return void s();const m=h.find(y=>y[0]==="videoLowTrack");if(m){const y=m[1];if(y.track._originMediaStreamTrack.stop(),!re("DISABLE_DUAL_STREAM_USE_ENCODING")&&kn().supportDualStreamEncoding){const S=o._mediaStreamTrack.clone();y.track._mediaStreamTrack=S,y.track._originMediaStreamTrack=S}else{const S=rM(o,fT(this,kt.RequestLowStreamParameter));y.track._mediaStreamTrack=S,y.track._originMediaStreamTrack=S}await new lt((S,R)=>{this.handleReplaceTrack(y.track,S,R,!0)})}await this.connection.unmuteLocal(h.map(y=>{let[,{id:S}]=y;return S}));const _=this.createUnmuteMessage(h);await or(this,kt.RequestUnmuteLocal,_),s()}catch(h){c(h)}finally{u()}}),$(this,"handleUpdateVideoEncoder",async(o,s,c,u)=>{let h;u||(h=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{const _=this.localTrackMap.get($e.LocalVideoTrack);if(!this.connection||!_||_.track!==o||this.state!==Bn.Connected)return void s();const{id:y,track:S}=_;await this.connection.updateSendParameters(y,S),await this.connection.updateEncoderConfig(y,S),this.emit(kt.UpdateVideoEncoder,S),s()}catch(_){c(_)}finally{var m;(m=h)===null||m===void 0||m()}}),$(this,"handleUpdateVideoSendParameters",async(o,s,c)=>{const u=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const h=this.localTrackMap.get($e.LocalVideoTrack);if(!this.connection||!h||h.track!==o||this.state!==Bn.Connected)return void s();const{id:m,track:_}=h;await this.connection.updateSendParameters(m,_),s()}catch(h){c(h)}finally{u()}}),$(this,"handleReplaceMixingTrack",async(o,s,c,u)=>{if(!this.connection||this.state!==Bn.Connected)return void s();const h=tM([o]);let m;D.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(h.getTrackId(),"]")),typeof u=="boolean"&&u||(m=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(o,h),s()}catch(y){c(y)}finally{var _;(_=m)===null||_===void 0||_()}}),$(this,"handleReplaceTrack",async(o,s,c,u)=>{let h;D.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(o.getTrackId(),"]")),typeof u=="boolean"&&u||(h=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var m;const y=Array.from(this.localTrackMap.entries()).find(S=>{let[,{track:R}]=S;return o===R});if(!this.connection||!y||this.state!==Bn.Connected)return void s();if(await((m=this.connection)===null||m===void 0?void 0:m.replaceTrack(o,y[1].id)),this.isPlanB){const S=y[1];S.id=o._mediaStreamTrack.id,this.localTrackMap.set(y[0],S)}if(y[0]===$e.LocalVideoTrack&&!re("DISABLE_DUAL_STREAM_USE_ENCODING")&&kn().supportDualStreamEncoding){const S=this.localTrackMap.get($e.LocalVideoLowTrack);if(S){const R=o._mediaStreamTrack.clone();S.track._originMediaStreamTrack.stop(),S.track._mediaStreamTrack=R,S.track._originMediaStreamTrack=R,await new lt((P,k)=>{this.handleReplaceTrack(S.track,P,k,!0)})}}s()}catch(y){c(y)}finally{var _;(_=h)===null||_===void 0||_()}}),$(this,"handleGetRTCStats",o=>{o(this.statsCollector.getRTCStats())}),$(this,"handleGetLocalVideoStats",o=>{o(this.statsCollector.getLocalVideoTrackStats())}),$(this,"handleGetLocalAudioStats",o=>{o(this.statsCollector.getLocalAudioTrackStats())}),$(this,"handleGetRemoteVideoStats",o=>this.statsCollector.getRemoteVideoTrackStats(o.uid)[o.uid]),$(this,"handleGetRemoteAudioStats",o=>this.statsCollector.getRemoteAudioTrackStats(o.uid)[o.uid]),this.store=e,this.statsCollector=r,this.statsCollector.addP2PChannel(this),this.statsUploader=new KH(this.store),this.bindStatsUploaderEvents(),this.mutex=new Oo("P2PChannel-mutex",this.store.clientId),this.isPlanB=!kn().supportUnifiedPlan||re("CHROME_FORCE_PLAN_B")&&zf(),this.shouldForwardP2PCreation=re("FORWARD_P2P_CREATION")&&kn().supportPCSetConfiguration&&jL(),this.shouldForwardP2PCreation&&(this.connection=vP(this.store),this.emit(kt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(e){var r;this.state=Bn.New,this._forceTurn=BH(e),D.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));const o=this.shouldForwardP2PCreation&&((r=this.connection)===null||r===void 0?void 0:r.peerConnectionState)==="closed";if(this.shouldForwardP2PCreation&&!o||(o&&this.connection&&(D.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=vP(this.store,e),this.emit(kt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new Le(X.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=re("NEW_ICE_RESTART")?Xf.FIRST_CONNECTION:Xf.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(e),this.connection.establishPromise}async connect(e){if(!this.connection)throw new Le(X.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");re("ENABLE_PREALLOC_PC")&&this.state===Bn.Connected?await this.connection.updateRemoteConnect(e):(this.store.peerConnectionStart(),await this.connection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Bn.Connected)}updateRemoteRTPCapabilities(e){const r=Array.from(this.localTrackMap.entries()).filter(c=>{var u;let[h]=c;return st(u=[$e.LocalVideoLowTrack,$e.LocalVideoTrack]).call(u,h)}),o=r.map(c=>{let[,{id:u}]=c;return u}),s=r.map(c=>{let[u]=c;return u});if(this.connection instanceof vh){if(wt.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(s),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(e)}),!st(e).call(e,this.store.codec)){const c=["vp9","vp8","h264"].find(u=>st(e).call(e,u));c&&(this.store.codec=c,D.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(c,".")))}this.connection.updateRemoteRTPCapabilities(o,e)}}async getEstablishParams(){var e;if(this.connection instanceof vh&&this.connection.peerConnectionState!=="closed"&&st(e=[Bn.New,Bn.Connected]).call(e,this.state))return this.connection.establishPromise}async publishDataChannel(e){if(!this.connection||this.state!==Bn.Connected){if(this.state===Bn.Disconnected)throw new Le(X.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return e.forEach(o=>{var s;st(s=this.pendingLocalDataChannels).call(s,o)||this.pendingLocalDataChannels.push(o)}),[]}const r=this.filterTobePublishedDataChannels(e);return r.length===0?[]:(r.forEach(o=>{const s=Date.now();this.store.publish(o.id.toString(),"datachannel",s)}),await this.connection.createDataChannels(this.store.uid,r),r.forEach(o=>{this.localDataChannels.push(o);const s=Date.now();this.store.publish(o.id+"","datachannel",void 0,s)}),e.map(o=>({streamId:o.id,ordered:o.ordered,maxRetransmits:o.maxRetransmits,metadata:o.metadata,channelId:o._originDataChannelId})))}publish(e,r,o){var s=this;return ml(function*(){const c=yield wn(s.mutex.lock("From P2PChannel.publish"));try{var u;const h=s.connection&&st(u=["disconnected","failed"]).call(u,s.connection.peerConnectionState);if(!s.connection||s.state!==Bn.Connected||h){if(s.state===Bn.Disconnected)throw new Le(X.UNEXPECTED_ERROR,"PeerConnection already disconnected.");s.throwIfTrackTypeNotMatch(e);const _=e.filter(y=>s.pendingLocalTracks.indexOf(y)===-1);return s.pendingLocalTracks=s.pendingLocalTracks.concat(_),void(h&&(s._isWaitPcToRePub=!0))}s.store.pubId=s.store.pubId+1,Do.markPublishStart(s.store.clientId,s.store.pubId);const m=s.filterTobePublishedTracks(e,r,o);if(m.length===0)return void(yield wn(s.tryToUnmuteAudio(e)));yield*yA(JH(s.doPublish(s.connection,m)))}finally{c()}})()}doPublish(e,r){var o=this;return ml(function*(){r.forEach(P=>{let{track:k,type:z}=P;const U=Date.now();o.store.publish(k.getTrackId(),z===$e.LocalAudioTrack?"audio":"video",U)}),o.bindLocalTrackEvents(r);const s=r.map(P=>{let{track:k}=P;return k}),c=yield wn(e.send(s,o.store.codec,o.store.audioCodec)),u=(yield wn(c.next())).value,h=o.createGatewayPublishMessage(r,u);let m;try{m=yield h}catch(P){throw c.throw(P),(P==null?void 0:P.code)===X.WS_ABORT&&r.forEach(k=>{let{track:z}=k;o.pendingLocalTracks.indexOf(z)===-1&&o.pendingLocalTracks.push(z)}),o.unbindLocalTrackEvents(r),P}const _=o.mapPubResToRemoteConfig(h,m,s),y=(yield wn(c.next(_))).value;if(o.state===Bn.Disconnected)throw new Le(X.UNEXPECTED_ERROR,"PeerConnection already disconnected.");re("ENABLE_VIDEO_SEI");const S=re("ENABLE_ENCODED_TRANSFORM"),R=re("ENABLE_AUDIO_METADATA");s.forEach(async P=>{const k=P.getRTCRtpTransceiver();if(!k||!S)return;const{interceptLocalVideoFrame:z,interceptLocalAudioFrame:U}=fP();P.trackMediaType===gt.VIDEO?await z(k.sender,P):P.trackMediaType===gt.AUDIO&&await U(k.sender,{metadata:R?()=>{const V=P.metadata.shift();return V&&V.value}:void 0})}),r.forEach(P=>{let{type:k}=P;o.statsCollector.addLocalStats(k)}),o.assignLocalTracks(r,y),o.statsUploader.startUploadOutboundStats(),r.forEach(P=>{let{track:k,type:z}=P;const U=Date.now();o.store.publish(k.getTrackId(),z===$e.LocalAudioTrack?"audio":"video",void 0,U)})})()}async updateVideoStreamParameter(e,r){const o=this.localTrackMap.get(r);if(!o||!this.connection)return;if(!(o.track instanceof mr))return D.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");const{track:s}=o,c=function(u,h){const m={};return u.height&&u.width&&(m.scaleResolutionDownBy=Fx(u,h)),m.maxFramerate=u.framerate?nc(u.framerate):void 0,m.maxBitrate=u.bitrate?1e3*u.bitrate:void 0,m}(e,s);if(s._encoderConfig||(s._encoderConfig={}),r!==$e.LocalVideoLowTrack||!re("DISABLE_DUAL_STREAM_USE_ENCODING")&&kn().supportDualStreamEncoding)c.scaleResolutionDownBy!=null&&(s._encoderConfig.scaleResolutionDownBy=c.scaleResolutionDownBy);else{const u=s._originMediaStreamTrack;if(!u.canvas)return D.warn("[".concat(s.getTrackId(),"] no canvas on track"));(function(h,m){const _=h.canvas;m.width&&(_.width=nc(m.width)),m.height&&(_.height=nc(m.height)),m.framerate&&(_.stopCapture&&_.stopCapture(),_.stopCapture=px(()=>{!_.startCapture&&_.stopCapture&&_.stopCapture(),_.startCapture&&_.startCapture()},nc(m.framerate)))})(u,e)}c.maxBitrate!=null&&(s._encoderConfig.bitrateMax=c.maxBitrate/1e3),c.maxFramerate!=null&&(s._encoderConfig.frameRate&&typeof s._encoderConfig.frameRate=="object"?s._encoderConfig.frameRate.max=c.maxFramerate:s._encoderConfig.frameRate={max:c.maxFramerate}),D.debug("[".concat(s.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(s._encoderConfig))),await this.connection.updateRtpSenderEncodings(s)}publishLowStream(e){var r=this;return ml(function*(){if(!r.connection||r.state!==Bn.Connected)return;const o=yield wn(r.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const c=r.localTrackMap.get($e.LocalVideoTrack);if(!c)throw new Le(X.UNEXPECTED_ERROR,"Could not find high stream");if(r.localTrackMap.has($e.LocalVideoLowTrack))throw new Le(X.UNEXPECTED_ERROR,"[".concat(r.store.clientId,"] Can't publish low stream when stream already publish"));const u=[{track:r.getLowVideoTrack(c.track,e),type:$e.LocalVideoLowTrack}];if(yield*yA(JH(r.doPublish(r.connection,u))),c.track.muted||!c.track.enabled){var s;const h=(s=r.localTrackMap.get($e.LocalVideoLowTrack))===null||s===void 0?void 0:s.id;h!==void 0&&(yield wn(r.connection.muteLocal([h])))}}finally{o()}})()}async republish(){this.pendingLocalTracks.length>0&&(D.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await bo(this,kt.RequestRePublish,this.pendingLocalTracks),this.emit(kt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(D.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await bo(this,kt.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(e){for(let r=this.pendingRemoteTracks.length-1;r>=0;r--){const{user:o,kind:s}=this.pendingRemoteTracks[r];(s!==gt.AUDIO||o._audio_added_&&o._audioSSRC)&&(s!==gt.VIDEO||o._video_added_&&o._videoSSRC)||this.pendingRemoteTracks.splice(r,1)}if(e)await bo(this,kt.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:r,kind:o}of this.pendingRemoteTracks)await this.subscribe(r,o,o===gt.VIDEO?r._videoSSRC:r._audioSSRC);this.pendingRemoteTracks.forEach(r=>{let{user:o}=r;this.emit(kt.MediaReconnectEnd,o.uid)}),this.pendingRemoteTracks=[]}async unpublish(e){if(!this.connection||this.state!==Bn.Connected)return void e.forEach(s=>{const c=this.pendingLocalTracks.indexOf(s);c!==-1&&this.pendingLocalTracks.splice(c,1)});const r=this.filterTobeUnpublishedTracks(e);if(r.length===0)return;const o=r.find(s=>s[0]==="videoLowTrack");return o&&o[1].track.close(),this.doUnpublish(this.connection,r)}async unpublishDataChannel(e){if(!this.connection||this.state!==Bn.Connected)return void e.forEach(o=>{const s=this.pendingLocalDataChannels.indexOf(o);s!==-1&&this.pendingLocalDataChannels.splice(s,1)});const r=this.filterTobeUnpublishedDataChannels(e);return r.length!==0?(r.forEach(o=>{const s=this.localDataChannels.indexOf(o);s!==-1&&this.localDataChannels.splice(s,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),r.map(o=>o.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==Bn.Connected)return;const e=this.localTrackMap.get($e.LocalVideoLowTrack);if(!e)return;e.track.close();const r=[[$e.LocalVideoLowTrack,e]];return this.doUnpublish(this.connection,r)}async doUnpublish(e,r){const o=this.createGatewayUnpublishMessage(r);return await e.stopSending(r.map(s=>{let[,{id:c}]=s;return c})),this.withdrawLocalTracks(r),this.unbindLocalTrackEvents(r.map(s=>{let[c,{track:u}]=s;return{type:c,track:u}})),r.forEach(s=>{let[c]=s;this.statsCollector.removeLocalStats(c)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),o}async subscribeDataChannel(e,r){if(!this.connection||this.state!==Bn.Connected)throw new Le(X.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const o=r.filter(s=>{var c;return!((c=this.remoteDataChannelMap.get(e))!==null&&c!==void 0&&c.get(s.id))});if(o.length!==0)return await this.connection.createDataChannels(e.uid,o),o.forEach(s=>{var c;this.remoteDataChannelMap.has(e)?(c=this.remoteDataChannelMap.get(e))===null||c===void 0||c.set(s.id,s):this.remoteDataChannelMap.set(e,new Map([[s.id,s]]));const u=this.pendingRemoteDataChannels.findIndex(h=>{let{user:m,id:_}=h;return m.uid===e.uid&&_===s.id});u!==-1&&this.pendingRemoteDataChannels.splice(u,1)}),o.map(s=>s.id)}async subscribe(e,r,o,s,c){var u;if(!this.connection||this.state!==Bn.Connected)throw new Le(X.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((u=this.remoteUserMap.get(e))!==null&&u!==void 0&&u.has(r))return;let h,m,_;const y=this.connection.getPreMedia(o);if(y)D.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(o,", no need to send sub to gateway.")),_=y.transceiver,h=y.track,m=y.id;else if(c){const P=c.find(z=>{let{stream_type:U}=z;return U===r});if(!P)throw new Le(X.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(r," for user: ").concat(e.uid," because subscribe answer from gateway does not contain stream_type: ").concat(r,"."));const k=await this.connection.receive(r,P.ssrcs,String(e._uintid),P.attributes);this.connection instanceof vh&&(_=k.transceiver),h=k.track,m=k.id}else{const P=await this.connection.receive(r,[{ssrcId:o,rtx:s}],String(e._uintid),void 0);this.connection instanceof vh&&(_=P.transceiver),h=P.track,m=P.id}if(r===gt.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(h):(e._audioTrack=new jv(h,e.uid,e._uintid,this.store),D.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),_&&e._audioTrack._updateRtpTransceiver(_),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(h):(e._videoTrack=new Fv(h,e.uid,e._uintid,this.store),D.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),_&&e._videoTrack._updateRtpTransceiver(_),this.bindRemoteTrackEvents(e,e._videoTrack)),_&&re("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:P,interceptRemoteAudioFrame:k}=fP();r==gt.VIDEO?await P(_.receiver,{onSei:re("ENABLE_VIDEO_SEI")&&(z=>{var U;return(U=e._videoTrack)===null||U===void 0?void 0:U._onSei(z)})}):r==gt.AUDIO&&await k(_.receiver,{enableTopn:!!re("ENABLE_AUDIO_TOPN"),enableMetadata:!!re("ENABLE_AUDIO_METADATA"),onMetadata:z=>{this.safeEmit(kt.AudioMetadata,z)}})}const S=this.remoteUserMap.get(e);S?S.set(r,m):this.remoteUserMap.set(e,new Map([[r,m]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats();const R=this.pendingRemoteTracks.findIndex(P=>{let{user:k,kind:z}=P;return k.uid===e.uid&&r===z});R!==-1&&(this.pendingRemoteTracks.splice(R,1),this.emit(kt.MediaReconnectEnd,e.uid))}async massSubscribe(e){return this.massSubscribeNoLock(e)}async massSubscribeNoLock(e){if(!this.connection||this.state!==Bn.Connected)throw new Le(X.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");e=e.filter(c=>{var u;let{user:h,mediaType:m}=c;return!((u=this.remoteUserMap.get(h))!==null&&u!==void 0&&u.has(m))});const r=[],o=new Map;e.forEach(c=>{if(!this.connection)return;const u=this.connection.getPreMedia(c.ssrcId);u?o.set(c.ssrcId,u):r.push(c)});const s=await this.connection.batchReceive(r.map(c=>{let{user:u,mediaType:h,ssrcId:m,rtxSsrcId:_}=c;return{kind:h,ssrcMsg:[{ssrcId:m,rtx:_}],mslabel:String(u._uintid)}}));r.forEach((c,u)=>{o.set(c.ssrcId,s[u])});for(const{user:c,mediaType:u,ssrcId:h}of e){const m=o.get(h);if(!m)return void D.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(c.uid," subscribe data,").concat(u,", ").concat(h));const{track:_,id:y,transceiver:S}=m;if(S&&re("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:k,interceptRemoteAudioFrame:z}=fP();u==gt.VIDEO?await k(S.receiver,{onSei:re("ENABLE_VIDEO_SEI")&&(U=>{var V;return(V=c._videoTrack)===null||V===void 0?void 0:V._onSei(U)})}):u==gt.AUDIO&&await z(S.receiver,{enableTopn:!!re("ENABLE_AUDIO_TOPN"),enableMetadata:!!re("ENABLE_AUDIO_METADATA"),onMetadata:U=>{this.safeEmit(kt.AudioMetadata,U)}})}if(u===gt.AUDIO?(c._audioTrack?c._audioTrack._updateOriginMediaStreamTrack(_):(c._audioTrack=new jv(_,c.uid,c._uintid,this.store),D.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(c._audioTrack.getTrackId()))),S&&c._audioTrack._updateRtpTransceiver(S),this.bindRemoteTrackEvents(c,c._audioTrack)):(c._videoTrack?c._videoTrack._updateOriginMediaStreamTrack(_):(c._videoTrack=new Fv(_,c.uid,c._uintid,this.store),D.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(c._videoTrack.getTrackId()))),S&&c._videoTrack._updateRtpTransceiver(S),this.bindRemoteTrackEvents(c,c._videoTrack)),re("ENABLE_VIDEO_SEI")&&S){const{interceptRemoteVideoFrame:k,interceptRemoteAudioFrame:z}=fP();u==gt.VIDEO?await k(S.receiver,{onSei:U=>{var V;(V=c._videoTrack)===null||V===void 0||V._onSei(U)}}):u==gt.AUDIO&&await z(S.receiver)}const R=this.remoteUserMap.get(c);R?R.set(u,y):this.remoteUserMap.set(c,new Map([[u,y]])),this.statsCollector.addRemoteStats(c.uid),this.statsUploader.startUploadInboundStats();const P=this.pendingRemoteTracks.findIndex(k=>{let{user:z,kind:U}=k;return z.uid===c.uid&&u===U});P!==-1&&(this.pendingRemoteTracks.splice(P,1),this.emit(kt.MediaReconnectEnd,c.uid))}}async unsubscribe(e,r,o){const s=this.pendingRemoteTracks.filter(h=>{let{user:m,kind:_}=h;return r!==void 0?m.uid===e.uid&&r===_:m.uid===e.uid});if(s.forEach(h=>{const m=this.pendingRemoteTracks.indexOf(h);this.pendingRemoteTracks.splice(m,1)}),this.connection&&this.state===Bn.Connected||o||s.forEach(h=>{let{kind:m}=h;var _;if(m===gt.AUDIO)(_=e._audioTrack)===null||_===void 0||_._destroy(),e._audioTrack=void 0;else if(m===gt.VIDEO){var y;(y=e._videoTrack)===null||y===void 0||y._destroy(),e._videoTrack=void 0}}),!this.connection||this.state!==Bn.Connected)return;const c=this.filterTobeUnSubscribedTracks(e,r);if(c.length===0)return;await this.connection.stopReceiving(c.map(h=>{let[,{id:m}]=h;return m}));const u=this.createUnsubscribeMessage(c);return this.withdrawRemoteTracks(c),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),c.forEach(h=>{let[m,{kind:_}]=h;var y,S;if(_===gt.VIDEO&&m._videoSSRC&&((y=this.connection)===null||y===void 0||y.setStatsRemoteVideoIsReady(m._videoSSRC,!1)),_===gt.VIDEO)this.unbindRemoteTrackEvents(m._videoTrack),o||((S=m._videoTrack)===null||S===void 0||S._destroy(),m._videoTrack=void 0);else if(_===gt.AUDIO){var R;this.unbindRemoteTrackEvents(m._audioTrack),!o&&((R=m._audioTrack)===null||R===void 0||R._destroy(),m._audioTrack=void 0)}}),u}async unsubscribeDataChannel(e,r){if(r.forEach(c=>{const u=this.pendingRemoteDataChannels.findIndex(h=>h.id===c.id);u!==-1&&this.pendingRemoteDataChannels.splice(u,1)}),!this.connection)return;const o=this.filterTobeUnSubscribedDataChannels(e,r);if(o.length===0)return;r.forEach(c=>{c._close()});const s=this.remoteDataChannelMap.get(e);return o.forEach(c=>{s&&s.delete(c.id)}),s&&s.size===0&&(this.remoteDataChannelMap.delete(e),await this.connection.stopDataChannels(e.uid)),o.map(c=>c.id)}async massUnsubscribe(e){return this.massUnsubscribeNoLock(e)}async massUnsubscribeNoLock(e){let r=[];for(const{user:c,mediaType:u}of e){const h=this.pendingRemoteTracks.filter(m=>{let{user:_,kind:y}=m;return u!==void 0?_.uid===c.uid&&u===y:_.uid===c.uid});h.forEach(m=>{const _=this.pendingRemoteTracks.indexOf(m);this.pendingRemoteTracks.splice(_,1)}),r=r.concat(h)}if(!this.connection||this.state!==Bn.Connected)return void r.forEach(c=>{let{user:u,kind:h}=c;var m;if(h===gt.AUDIO)(m=u._audioTrack)===null||m===void 0||m._destroy(),u._audioTrack=void 0;else if(h===gt.VIDEO){var _;(_=u._videoTrack)===null||_===void 0||_._destroy(),u._videoTrack=void 0}});const o=qa(e).call(e,(c,u)=>{let{user:h,mediaType:m}=u;const _=this.filterTobeUnSubscribedTracks(h,m);return c.concat(_)},[]);if(o.length===0)return;await this.connection.stopReceiving(o.map(c=>{let[,{id:u}]=c;return u}));const s=this.createUnsubscribeAllMessage(o);return this.withdrawRemoteTracks(o),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),o.forEach(c=>{let[u,{kind:h}]=c;var m,_;if(h===gt.VIDEO&&u._videoSSRC&&((m=this.connection)===null||m===void 0||m.setStatsRemoteVideoIsReady(u._videoSSRC,!1)),h===gt.VIDEO)this.unbindRemoteTrackEvents(u._videoTrack),(_=u._videoTrack)===null||_===void 0||_._destroy(),u._videoTrack=void 0;else if(h===gt.AUDIO){var y;this.unbindRemoteTrackEvents(u._audioTrack),(y=u._audioTrack)===null||y===void 0||y._destroy(),u._audioTrack=void 0}}),s}isPreSubScribe(e){return!this.connection||this.state!==Bn.Connected?!1:!!this.connection.getPreMedia(e)}async muteRemote(e,r){if(!this.connection)return;const o=this.remoteUserMap.get(e);if(!o)return void D.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid,"."));if(!o.get(r))return void D.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid," media type ").concat(r,"."));const s=r===gt.VIDEO?e._videoSSRC:e._audioSSRC;s!==void 0&&this.connection.setStatsRemoteVideoIsReady(s,!1)}async unmuteRemote(e,r){return this.unmuteRemoteNoLock(e,r)}async unmuteRemoteNoLock(e,r){if(!this.connection)return;const o=this.remoteUserMap.get(e);if(!o)return void D.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid,"."));o.get(r)||D.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(r,"."))}addAudioMetadata(e){const r=this.localTrackMap.get($e.LocalAudioTrack),o=r&&r.track;o&&o.metadata.push(e)}getAllTracks(e){const r=this.localTrackMap.get($e.LocalAudioTrack);if((r==null?void 0:r.track)instanceof Ci){const o=r.track;return Array.from(this.localTrackMap.entries()).filter(s=>{let[c]=s;return c!==$e.LocalAudioTrack}).filter(s=>{let[c]=s;return!(e&&c===$e.LocalVideoLowTrack)}).map(s=>{let[,{track:c}]=s;return c}).concat(o.trackList)}return Array.from(this.localTrackMap.entries()).filter(o=>{let[s]=o;return!(e&&s===$e.LocalVideoLowTrack)}).map(o=>{let[,{track:s}]=o;return s})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(e,r,o,s,c){if(e){const h=this.localTrackMap.get($e.LocalAudioTrack),m=s?this.localTrackMap.get($e.LocalVideoLowTrack):this.localTrackMap.get($e.LocalVideoTrack);wt.publish(this.store.sessionId,{eventElapse:Do.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:r,audioName:h==null?void 0:h.track.getTrackLabel(),videoName:m==null?void 0:m.track.getTrackLabel(),screenshare:(m==null?void 0:m.track._hints.indexOf(ar.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}else{var u;o||(o=[]);const h=o.find(_=>_ instanceof Br),m=s?(u=this.localTrackMap.get($e.LocalVideoTrack))===null||u===void 0?void 0:u.track:o.find(_=>_ instanceof mr);wt.publish(this.store.sessionId,{eventElapse:Do.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:r,audioName:h==null?void 0:h.getTrackLabel(),videoName:m==null?void 0:m.getTrackLabel(),screenshare:(m==null?void 0:m._hints.indexOf(ar.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}}reportSubscribeEvent(e,r,o,s){const c=s===gt.VIDEO?o._videoSSRC:o._audioSSRC;c&&wt.subscribe(this.store.sessionId,{succ:e,ec:r,video:s===gt.VIDEO,audio:s===gt.AUDIO,peerid:o.uid,subscribeRequestid:c,p2pid:this.store.p2pId,eventElapse:Do.measureFromSubscribeStart(this.store.clientId,c),preSsrc:this.isPreSubScribe(c)})}reset(){D.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new Oo("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=vP(this.store),this.emit(kt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get($e.LocalAudioTrack);if((e==null?void 0:e.track)instanceof Ci){if(e.track.trackList.length>0){const r=e.track;e.track.trackList.forEach(o=>{r.removeAudioTrack(o)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=Bn.Disconnected}getStats(){var e;return(e=this.connection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(e){var r;return((r=this.connection)===null||r===void 0?void 0:r.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get($e.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get($e.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const r=this.localTrackMap.get(e);return r&&r.track instanceof mr||r&&r.track instanceof Br?r.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,r){if(!e)return this.remoteUserMap.size>0;const o=this.remoteUserMap.get(e);return!!o&&(!r||o.has(r))}async hasRemoteMediaWithLock(e,r){if(!e)return this.remoteUserMap.size>0;const o=this.remoteUserMap.get(e);return!!o&&(!r||o.has(r))}getRemoteMedia(e){var r;const o=Array.from(Dc(r=this.remoteUserMap).call(r)).find(s=>s.uid===e);return o?{audioTrack:o.audioTrack,audioSSRC:o._audioSSRC,videoTrack:o.videoTrack,videoSSRC:o._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(o=>{let[s]=o;return{uid:s.uid,level:s.audioTrack?100*s.audioTrack._source.getAccurateVolumeLevel():0}});const r=this.localTrackMap.get($e.LocalAudioTrack);return r&&e.push({level:100*r.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=Xb(e).call(e,(o,s)=>o.level-s.level),e}async disconnectForReconnect(){this.connection&&(D.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=Bn.Reconnecting,re("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[r]=e;var o;r._videoTrack&&r._videoTrack._player&&((o=r._videoTrack._player.getVideoElement())===null||o===void 0||o.pause(),r._videoTrack._player.isKeepLastFrame=!0,r._videoTrack._originMediaStreamTrack.stop())}),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=vP(this.store),this.emit(kt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var r;let[o,{track:s}]=e;switch(o){case $e.LocalVideoTrack:st(r=s._hints).call(r,ar.LOW_STREAM)?s.close():this.pendingLocalTracks.push(s);break;case $e.LocalAudioTrack:s instanceof Ci?this.pendingLocalTracks=this.pendingLocalTracks.concat(s.trackList):this.pendingLocalTracks.push(s);case $e.LocalVideoLowTrack:}}),this.emit(kt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[r,o]=e;Array.from(Dc(o).call(o)).forEach(s=>{this.setPendingRemoteMedia(r,s)}),this.emit(kt.MediaReconnectStart,r.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(e=>{this.pendingLocalDataChannels.push(e)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(e=>{let[r,o]=e;Array.from(Dc(o).call(o)).forEach(s=>{this.setPendingRemoteDataChannel(r,s)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),D.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(e,r){for(const o of this.pendingRemoteDataChannels){const{user:s,id:c}=o;if((e instanceof Lm?e.uid:e)===s.uid&&c===r)return!0}return!1}setPendingRemoteDataChannel(e,r){this.hasPendingRemoteDataChannel(e,r)||this.pendingRemoteDataChannels.push({user:e,id:r})}hasPendingRemoteMedia(e,r){for(const o of this.pendingRemoteTracks){const{user:s,kind:c}=o;if((e instanceof Lm?e.uid:e)===s.uid&&r===c)return!0}return!1}setPendingRemoteMedia(e,r){this.hasPendingRemoteMedia(e,r)||this.pendingRemoteTracks.push({user:e,kind:r})}restartICE(e){var r=this;return ml(function*(){if(!r.connection||r.state!==Bn.Connected)return;const o=yield wn(r.mutex.lock("From P2PChannel.restartICE"));let s;try{s=yield wn(r.connection.restartICE(e));const u=yield wn(s.next());if(u.done)return;const h=u.value,m=yield h;switch(nM(r.connection)&&r.reportPCStats(Date.now(),!1,r._pcStatsUploadType),e){case No.UDP_TCP_RELAY:r._pcStatsUploadType=Xf.UDP_TCP_RESTART;break;case No.TCP_RELAY:r._pcStatsUploadType=Xf.TCP_RESTART;break;case No.RELAY:r._pcStatsUploadType=Xf.RELAY_RESTART;break;default:r._pcStatsUploadType=Xf.OLD_RESTART}r._isTryConnecting=!0,s.next(m)}catch(u){var c;(c=s)===null||c===void 0||c.throw(u)}finally{o()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats(),r=this.localTrackMap.get($e.LocalVideoTrack),o=this.localTrackMap.get($e.LocalAudioTrack),s=e.videoSend.find(k=>k.ssrc===(r==null?void 0:r.ssrcs[0].ssrcId)),c=e.audioSend.find(k=>k.ssrc===(o==null?void 0:o.ssrcs[0].ssrcId));if(!s||!c)return 1;const u=kc(this,kt.NeedSignalRTT),h=s?s.rttMs:void 0,m=c?c.rttMs:void 0,_=h&&m?(h+m)/2:h||m,y=(_&&u?(_+u)/2:_||u)||0,S=100*e.sendPacketLossRate*.7/50+.3*y/1500,R=S<.17?1:S<.36?2:S<.59?3:S<.1?4:5,P=r==null?void 0:r.track;if(P&&P._encoderConfig&&P._hints.indexOf(ar.SCREEN_TRACK)===-1){const k=P._encoderConfig.bitrateMax,z=e.bitrate.actualEncoded;if(k&&z){const U=(1e3*k-z)/(1e3*k);return kG[U<.15?0:U<.3?1:U<.45?2:U<.6?3:4][R]}}return R}getDownlinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats();let r=0;return Array.from(this.remoteUserMap.entries()).forEach(o=>{let[s]=o;const c=s._audioSSRC,u=s._videoSSRC,h=e.audioRecv.find(z=>z.ssrc===c),m=e.videoRecv.find(z=>z.ssrc===u);if(!h&&!m)return void(r+=1);const _=kc(this,kt.NeedSignalRTT),y=e.rtt,S=(y&&_?(y+_)/2:y||_)||0,R=h?h.jitterMs:void 0,P=e.recvPacketLossRate;let k=.7*P*100/50+.3*S/1500;R&&(k=.6*P*100/50+.2*S/1500+.2*R/400),r+=k<.1?1:k<.17?2:k<.36?3:k<.59?4:5}),this.remoteUserMap.size>0?Math.round(r/this.remoteUserMap.size):r}async muteLocalTrack(e){return new lt((r,o)=>{this.handleMuteLocalTrack(e,r,o)})}async replaceTrack(e,r){var o;if(D.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(e.getTrackId(),"] to [").concat(r.getTrackId(),"]")),!this.connection||this.state!==Bn.Connected)return;const s=Array.from(this.localTrackMap.entries()).find(u=>{let[,{track:h}]=u;return e===h});if(!s)return;const c=s[0];if(e!==r&&(this.unbindLocalTrackEvents([{track:e,type:c}]),this.bindLocalTrackEvents([{track:r,type:c}]),s[1].track=r),await((o=this.connection)===null||o===void 0?void 0:o.replaceTrack(r,s[1].id)),this.isPlanB){const u=s[1];u.id=r._mediaStreamTrack.id,this.localTrackMap.set(c,u)}if(c===$e.LocalVideoTrack&&!re("DISABLE_DUAL_STREAM_USE_ENCODING")&&kn().supportDualStreamEncoding){const u=this.localTrackMap.get($e.LocalVideoLowTrack);if(u){const h=e._mediaStreamTrack.clone();u.track._originMediaStreamTrack.stop(),u.track._mediaStreamTrack=h,u.track._originMediaStreamTrack=h,await new lt((m,_)=>{this.handleReplaceTrack(u.track,m,_,!0)})}}}filterTobePublishedTracks(e,r,o){const s=[],c=this.getAllTracks();e=Cv(e=e.filter(_=>c.indexOf(_)===-1));let u,h=!1;const m=this.localTrackMap.get($e.LocalAudioTrack);for(const _ of e){if(_ instanceof mr&&(this.localTrackMap.has($e.LocalVideoTrack)||h?new Le(X.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(s.push({track:_,type:$e.LocalVideoTrack}),h=!0),r)){const y=this.getLowVideoTrack(_,o);s.push({track:y,type:$e.LocalVideoLowTrack})}if(_ instanceof Br)if(m){const y=m.track;if(y instanceof Ci)eM([_]),y.addAudioTrack(_),this.bindLocalAudioTrackEvents(_,!0);else{const S=tM([y,_]);D.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(S.getTrackId(),"]")),this.replaceTrack(y,S)}}else u instanceof Ci?(eM([_]),u.addAudioTrack(_)):u||!_._useAudioElement&&kn().webAudioMediaStreamDest&&!_._bypassWebAudio?u=tM(u?[_,u]:[_]):u=_}return u&&(D.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(u.getTrackId(),"]")),s.push({track:u,type:$e.LocalAudioTrack})),s}filterTobeUnpublishedTracks(e){const r=[],o=this.getAllTracks();e=Cv(e=e.filter(s=>o.indexOf(s)!==-1));for(const s of e){if(s instanceof Br){const c=this.localTrackMap.get($e.LocalAudioTrack);if(!c)continue;c.track instanceof Ci?(c.track.removeAudioTrack(s),this.unbindLocalAudioTrackEvents(s),c.track.trackList.length===0&&(r.push([$e.LocalAudioTrack,c]),c.track.close())):r.push([$e.LocalAudioTrack,c])}if(s instanceof mr){const c=this.localTrackMap.get($e.LocalVideoTrack);if(!c)continue;r.push([$e.LocalVideoTrack,c]);const u=this.localTrackMap.get($e.LocalVideoLowTrack);u&&r.push([$e.LocalVideoLowTrack,u])}}return r}filterTobePublishedDataChannels(e){return e=(e=Cv(e)).filter(r=>this.localDataChannels.findIndex(o=>o.id===r.id)===-1)}filterTobeUnpublishedDataChannels(e){return e=(e=(e=Cv(e)).filter(r=>this.localDataChannels.indexOf(r)!==-1)).filter(r=>r._originDataChannel)}bindLocalTrackEvents(e){e.forEach(r=>{let{track:o,type:s}=r;switch(s){case $e.LocalVideoTrack:o.addListener(Et.GET_STATS,this.handleGetLocalVideoStats),o.addListener(Et.GET_RTC_STATS,this.handleGetRTCStats),o.addListener(Et.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),o.addListener(Et.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),o.addListener(Et.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),o.addListener(Et.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),o.addListener(Et.NEED_REPLACE_TRACK,this.handleReplaceTrack),o.addListener(Et.NEED_MUTE_TRACK,this.handleMuteLocalTrack),o.addListener(Et.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case $e.LocalAudioTrack:this.bindLocalAudioTrackEvents(o);case $e.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,r){e instanceof Ci?e.trackList.forEach(o=>{o.addListener(Et.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),o.addListener(Et.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),o.addListener(Et.GET_STATS,this.handleGetLocalAudioStats),o.addListener(Et.NEED_MUTE_TRACK,this.handleMuteLocalTrack),o.addListener(Et.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(Et.GET_STATS,this.handleGetLocalAudioStats),e.addListener(Et.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(Et.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(Et.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(Et.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),r||(e.addListener(Et.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.addListener(Et.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(r=>{let[o,{track:s}]=r;return{track:s,type:o}})),e.forEach(r=>{let{track:o,type:s}=r;switch(s){case $e.LocalVideoTrack:o.off(Et.GET_STATS,this.handleGetLocalVideoStats),o.off(Et.GET_RTC_STATS,this.handleGetRTCStats),o.off(Et.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),o.off(Et.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),o.off(Et.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),o.off(Et.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),o.off(Et.NEED_REPLACE_TRACK,this.handleReplaceTrack),o.off(Et.NEED_MUTE_TRACK,this.handleMuteLocalTrack),o.off(Et.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case $e.LocalAudioTrack:this.unbindLocalAudioTrackEvents(o);case $e.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof Ci?e.trackList.forEach(r=>{r.off(Et.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(Et.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(Et.GET_STATS,this.handleGetLocalAudioStats),r.off(Et.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(Et.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(Et.GET_STATS,this.handleGetLocalAudioStats),e.off(Et.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(Et.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(Et.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(Et.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),e.off(Et.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(Et.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,r){r instanceof Fv&&r.addListener(Et.GET_STATS,o=>{o(this.handleGetRemoteVideoStats(e))}),r instanceof jv&&r.addListener(Et.GET_STATS,o=>{o(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(Et.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[r,o]=e;o.has(gt.AUDIO)&&this.unbindRemoteTrackEvents(r._audioTrack),o.has(gt.VIDEO)&&this.unbindRemoteTrackEvents(r._videoTrack)})}createGatewayPublishMessage(e,r){return e.map((o,s)=>{var c;let u,h,{track:m,type:_}=o;switch(_){case $e.LocalAudioTrack:u=zn.Audio,h={dtx:m instanceof $A&&m._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case $e.LocalVideoTrack:u=st(c=m._hints).call(c,ar.SCREEN_TRACK)?zn.Screen:zn.High,h=bh(bh({},YG(m)),{},{codec:this.store.codec,svc_mode:cP()});break;case $e.LocalVideoLowTrack:u=zn.Low,h=bh(bh({},YG(m)),{},{codec:this.store.codec,svc_mode:cP()})}return{stream_type:u,attributes:h,ssrcs:r[s]}})}createGatewayUnpublishMessage(e){return e.map(r=>{var o;let s,[c,{track:u,ssrcs:h,id:m}]=r;switch(c){case $e.LocalVideoTrack:s=st(o=u._hints).call(o,ar.SCREEN_TRACK)?zn.Screen:zn.High;break;case $e.LocalAudioTrack:s=zn.Audio;break;case $e.LocalVideoLowTrack:s=zn.Low}return{stream_type:s,ssrcs:h,mid:m}})}assignLocalTracks(e,r){e.forEach((o,s)=>{let{track:c,type:u}=o;this.localTrackMap.set(u,{track:c,id:r[s].id,ssrcs:r[s].localSSRC})})}withdrawLocalTracks(e){e.forEach(r=>{let[o]=r;this.localTrackMap.delete(o)})}bindConnectionEvents(e){e.onConnectionStateChange=async r=>{if(D.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(r,")")),this.emit(kt.PeerConnectionStateChange,r),r==="connecting"&&e instanceof vh&&!Dr()&&re("FIRST_TCP_CANDIDATE")&&window.setTimeout(()=>{r==="connecting"&&e.extendCandidate()},re("FIRST_TCP_CANDIDATE_INTERVAL")),r!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),r==="connected"&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),e instanceof vh&&qH(e,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=Xf.DISCONNECTED_OR_FAILED,kc(this,kt.QueryClientConnectionState)==="CONNECTED"&&this._isWaitPcToRePub)){const o=this.pendingLocalTracks.map(c=>c.getTrackId()),s=this.pendingLocalDataChannels.map(c=>"dc_".concat(c.id));wt.reportApiInvoke(this.store.sessionId,{name:_i.REPUB_AFTER_PC_CONNECTED,options:o.concat(s),tag:xr.TRACER}).onSuccess(),this.republish()}if(re("NEW_ICE_RESTART")&&e instanceof vh&&!Dr()&&!this._forceTurn){if(st(WG).call(WG,r)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const o=c=>{nM(e)&&(D.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(c)),kc(this,kt.QueryClientConnectionState)==="CONNECTED"&&this.emit(kt.RequestRestartICE,c))},s=()=>{nM(e)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),D.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(kt.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout(()=>{YH(e,o,s)},800))}}else{if(r==="disconnected"&&e.iceConnectionState==="disconnected")return setTimeout(()=>{e.iceConnectionState==="disconnected"&&re("ICE_RESTART")&&kc(this,kt.QueryClientConnectionState)==="CONNECTED"&&this.emit(kt.RequestRestartICE)},800),void setTimeout(()=>{e.peerConnectionState==="disconnected"&&(D.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout(()=>this.emit(kt.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);r==="failed"&&(D.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout(()=>this.emit(kt.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},e.onICEConnectionStateChange=r=>{r!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),D.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(r,")")),wt.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:r,tag:xr.TRACER}).onSuccess(),this.emit(kt.IceConnectionStateChange,r)},e.onICETransportStateChange=r=>{D.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(r,")"))},e.onDTLSTransportStateChange=r=>{D.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(r,")"))},e.onDTLSTransportError=r=>{D.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(r,")"))},e.onFirstAudioDecoded=r=>{var o;const s=Array.from(Dc(o=this.remoteUserMap).call(o)).find(u=>u._audioSSRC===r);var c;s&&(this.store.subscribe(s.uid,"audio",void 0,void 0,void 0,Date.now()),(c=s.audioTrack)===null||c===void 0||c.emit(Lv.FIRST_FRAME_DECODED),wt.firstRemoteFrame(this.store.sessionId,ji.FIRST_AUDIO_DECODE,wr.FIRST_AUDIO_DECODE,{peer:s._uintid,subscribeElapse:Do.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=r=>{var o;const s=Array.from(Dc(o=this.remoteUserMap).call(o)).find(c=>c._audioSSRC===r);s&&wt.firstRemoteFrame(this.store.sessionId,ji.FIRST_AUDIO_RECEIVED,wr.FIRST_AUDIO_RECEIVED,{peer:s._uintid,subscribeElapse:Do.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(r,o,s)=>{this.reportVideoFirstFrameDecoded(r,o,s)},e.onFirstVideoReceived=r=>{var o;const s=Array.from(Dc(o=this.remoteUserMap).call(o)).find(c=>c._videoSSRC===r);s&&wt.firstRemoteFrame(this.store.sessionId,ji.FIRST_VIDEO_RECEIVED,wr.FIRST_VIDEO_RECEIVED,{peer:s._uintid,subscribeElapse:Do.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(r,o)=>{const s=r.candidateType==="relay",c=o.candidateType==="relay";o.candidateType!=="unknown"&&s===c||this.emit(kt.ConnectionTypeChange,s),D.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(km(o))," -> ").concat(JSON.stringify(km(r)),")"))},e.onSelectedRemoteCandidateChanged=(r,o)=>{D.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(km(o))," -> ").concat(JSON.stringify(km(r)),")"))},e.onFirstVideoDecodedTimeout=r=>{this.reportVideoFirstFrameDecoded(r,void 0,void 0,!0)},e.getLocalVideoStats=()=>{const r=this.statsCollector.getLocalVideoTrackStats(),o=this.statsCollector.getRTCStats();return bh(bh({},r),o)},e.onICECandidateError=r=>{this._iceError=r}}resetConnection(e){e instanceof vh&&function(r){Zv.delete(r.id),qH(r)}(e),e.close(),this.emit(kt.PeerConnectionStateChange,"closed"),function(r){r.onConnectionStateChange=void 0,r.onICEConnectionStateChange=void 0,r.onICETransportStateChange=void 0,r.onDTLSTransportStateChange=void 0,r.onDTLSTransportError=void 0,r.onFirstAudioDecoded=void 0,r.onFirstAudioReceived=void 0,r.onFirstVideoDecoded=void 0,r.onFirstVideoReceived=void 0,r.onSelectedLocalCandidateChanged=void 0,r.onSelectedRemoteCandidateChanged=void 0,r.onFirstVideoDecodedTimeout=void 0,r.getLocalVideoStats=void 0}(e),this._isWaitPcToRePub=!1}filterTobeMutedTracks(e){const r=[];if(this.getAllTracks().indexOf(e)===-1)return r;const o=this.localTrackMap.get($e.LocalAudioTrack);if(e instanceof Br&&(o==null?void 0:o.track)instanceof Ci)return o.track.isActive||r.push([$e.LocalAudioTrack,o]),r;const s=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return e===u});if(s&&(r.push(s),s[0]===$e.LocalVideoTrack)){const c=this.localTrackMap.get($e.LocalVideoLowTrack);c&&r.push([$e.LocalVideoLowTrack,c])}return r}filterTobeUnmutedTracks(e){const r=[],o=this.localTrackMap.get($e.LocalAudioTrack);if(e instanceof Br&&(o==null?void 0:o.track)instanceof Ci)return o.track.isActive&&r.push([$e.LocalAudioTrack,o]),r;const s=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return e===u});if(s)if(s[0]===$e.LocalVideoTrack){r.push(s);const c=this.localTrackMap.get($e.LocalVideoLowTrack);c&&r.push([$e.LocalVideoLowTrack,c])}else r.push(s);return r}createMuteMessage(e){return e.map(r=>{var o;let s,[c,{track:u,ssrcs:h,id:m}]=r;switch(c){case $e.LocalAudioTrack:s=zn.Audio;break;case $e.LocalVideoTrack:s=st(o=u._hints).call(o,ar.SCREEN_TRACK)?zn.Screen:zn.High;break;case $e.LocalVideoLowTrack:s=zn.Low}return{stream_type:s,ssrcs:h,mid:m}})}createUnmuteMessage(e){return e.map(r=>{var o;let s,[c,{track:u,ssrcs:h,id:m}]=r;switch(c){case $e.LocalAudioTrack:s=zn.Audio;break;case $e.LocalVideoTrack:s=st(o=u._hints).call(o,ar.SCREEN_TRACK)?zn.Screen:zn.High;break;case $e.LocalVideoLowTrack:s=zn.Low}return{stream_type:s,ssrcs:h,mid:m}})}filterTobeUnSubscribedTracks(e,r){const o=[],s=this.remoteUserMap.get(e);if(!s)return o;if(r){const c=s.get(r);if(!c)return o;o.push([e,{kind:r,id:c}])}else Array.from(s.entries()).forEach(c=>{let[u,h]=c;o.push([e,{kind:u,id:h}])});return o}filterTobeUnSubscribedDataChannels(e,r){const o=[];return r.forEach(s=>{var c;(c=this.remoteDataChannelMap.get(e))!==null&&c!==void 0&&c.has(s.id)&&o.push(s)}),o}createUnsubscribeMessage(e){const r=[];return e.forEach(o=>{let[s,{kind:c,id:u}]=o;switch(c){case gt.VIDEO:return void(s._videoSSRC&&r.push({stream_type:gt.VIDEO,ssrcId:s._videoSSRC}));case gt.AUDIO:return void(s._audioSSRC&&r.push({stream_type:gt.AUDIO,ssrcId:s._audioSSRC}))}}),r}createUnsubscribeAllMessage(e){const r=new Map;return e.forEach(o=>{let[s,{kind:c}]=o;if(r.has(s)){let u=r.get(s);c===gt.VIDEO?u|=Bi.Video:u|=Bi.Audio,r.set(s,u)}else c===gt.VIDEO?r.set(s,Bi.Video):r.set(s,Bi.Audio)}),{users:Array.from(r.entries()).map(o=>{let[s,c]=o;return{stream_id:s.uid,stream_type:c}})}}withdrawRemoteTracks(e){e.forEach(r=>{let[o,{kind:s}]=r;const c=this.remoteUserMap.get(o);c&&(c.delete(s),Array.from(c.entries()).length===0&&this.remoteUserMap.delete(o))})}async updateBitrateLimit(e){const r=this.localTrackMap.get($e.LocalVideoTrack),o=this.localTrackMap.get($e.LocalVideoLowTrack);r&&(await r.track.setBitrateLimit(e.uplink),await new lt((s,c)=>{this.handleUpdateVideoEncoder(r.track,s,c,!0)})),o&&e.low_stream_uplink&&(await o.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new lt((s,c)=>{this.handleUpdateVideoEncoder(o.track,s,c,!0)}))}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}mapPubResToRemoteConfig(e,r,o){return e.map((s,c)=>{var u;let{stream_type:h}=s;const m=(u=r.find(_=>{let{stream_type:y}=_;return h===y}))===null||u===void 0?void 0:u.attributes;if(m&&re("DISABLE_SCREEN_SHARE_REMB")){const _=o[c]._hints;(st(_).call(_,ar.SCREEN_TRACK)||st(_).call(_,ar.SCREEN_LOW_TRACK))&&(m.remb=!1,D.debug("disable remb for screen share, hints:",_))}return m})}async tryToUnmuteAudio(e){for(let o=0;o<e.length;o++)if(e[o]instanceof Br){var r;const s=this.filterTobeUnmutedTracks(e[o]);if(s.length===0)continue;await((r=this.connection)===null||r===void 0?void 0:r.unmuteLocal(s.map(u=>{let[,{id:h}]=u;return h})));const c=this.createUnmuteMessage(s);return void await or(this,kt.RequestUnmuteLocal,c)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var r;return!((r=this.connection)===null||r===void 0||!r.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,r)=>this.emit(kt.RequestUpload,e,r),this.statsUploader.requestUploadStats=e=>this.emit(kt.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var e;return{connectState:((e=this.connection)===null||e===void 0?void 0:e.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await io(qL(this.dtlsFailedCount,Ei)),this.emit(kt.RequestReconnect)}async reconnectP2P(){const e=Array.from(this.localTrackMap.entries()),r=this.createGatewayUnpublishMessage(e);Array.from(this.remoteUserMap.entries()),r.length>0&&await bo(this,kt.RequestUnpublishForReconnectPC,r),this.disconnectForReconnect(),this.emit(kt.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has($e.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof mr)}throwIfTrackTypeNotMatch(e){if(e.filter(r=>r instanceof mr).length>1)throw new Le(X.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(r=>r instanceof Br).length>1&&(e.some(r=>r instanceof Br&&r._bypassWebAudio)||!kn().webAudioMediaStreamDest))throw new Le(X.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const r of e){if(r instanceof mr&&this.pendingLocalTracks.some(o=>o instanceof mr))throw new Le(X.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(r instanceof Br&&this.pendingLocalTracks.some(o=>o instanceof Br)&&(!kn().webAudioMediaStreamDest||r._bypassWebAudio||this.pendingLocalTracks.some(o=>o instanceof Br&&o._bypassWebAudio)))throw new Le(X.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,r){var o;const s=!re("DISABLE_DUAL_STREAM_USE_ENCODING")&&kn().supportDualStreamEncoding,c=bh(bh({},{width:160,height:120,framerate:15,bitrate:50}),r);let u;u=s?e._mediaStreamTrack.clone():rM(e,c);const h=sr(8,"track-low-"),m=new mr(u,bh(bh({},s&&{scaleResolutionDownBy:Fx(c,e)}),{},{frameRate:c.framerate,bitrateMax:c.bitrate,bitrateMin:c.bitrate}),void 0,void 0,h);return m.on(O_.TRANSCEIVER_UPDATED,_=>{e._updateRtpTransceiver(_,Nv.LOW_STREAM)}),m._hints.push(ar.LOW_STREAM),st(o=e._hints).call(o,ar.SCREEN_TRACK)&&m._hints.push(ar.SCREEN_LOW_TRACK),e.on("sei-to-send",_=>{m.emit("sei-to-send",_)}),e.addListener(Et.NEED_CLOSE,()=>{m.close()}),m}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(e,r,o){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof vh){var c,u,h,m;const _=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:y,dtlsTransportState:S,peerConnectionState:R}=this.connection,{local:P,remote:k}=await this.connection.getSelectedCandidatePair();wt.pcStats(this.store.sessionId,{startTime:_,eventElapse:e-_||0,iceconnectionsate:y,dtlsstate:S,connectionstate:R,intSucc:r?1:2,error:this._iceError||s||"",selectedLocalCandidateProtocol:(c=P==null?void 0:P.protocol)!==null&&c!==void 0?c:"",selectedLocalCandidateType:(u=P.candidateType)!==null&&u!==void 0?u:"",selectedLocalCandidateAddress:"".concat(P.address,":").concat(P.port),selectedRemoteCandidateProtocol:(h=k.protocol)!==null&&h!==void 0?h:"",selectedRemoteCandidateType:(m=k.candidateType)!==null&&m!==void 0?m:"",selectedRemoteCandidateAddress:"".concat(k.address,":").concat(k.port),restartCnt:o,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameDecoded(e,r,o,s){var c;const u=Array.from(Dc(c=this.remoteUserMap).call(c)).find(h=>h._videoSSRC===e);if(u){s||this.store.subscribe(u.uid,"video",void 0,void 0,void 0,void 0,Date.now());const h=this.store.keyMetrics,m=h.subscribe.find(_=>_.userId===u.uid&&_.type==="video");wt.firstRemoteVideoDecode(this.store.sessionId,ji.FIRST_VIDEO_DECODE,wr.FIRST_VIDEO_DECODE,{peer:u._uintid,videowidth:r,videoheight:o,subscribeElapse:Do.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:h.requestAPEnd||0,apStart:h.requestAPStart||0,joinGwEnd:h.joinGatewayEnd||0,joinGwStart:h.joinGatewayStart||0,pcEnd:h.peerConnectionEnd||0,pcStart:h.peerConnectionStart||0,subscriberEnd:(m==null?void 0:m.subscribeEnd)||0,subscriberStart:(m==null?void 0:m.subscribeStart)||0,videoAddNotify:(m==null?void 0:m.streamAdded)||0,state:s?1:0,firstFrame:(m==null?void 0:m.firstFrame)||0})}}async remoteMediaSsrcChanged(e,r,o){if(!this.connection)return!1;const s=this.remoteUserMap.get(e);if(!s)return!1;const c=s.get(r);if(!c)return!1;const u=await this.connection.getRemoteSSRC(c);return u!==void 0&&u!==o}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[r,{track:o}]=e;r===$e.LocalVideoLowTrack?o._updateRtpTransceiver(void 0,Nv.LOW_STREAM):o._updateRtpTransceiver(void 0)})}},vt(un.prototype,"startP2PConnection",[rs],Object.getOwnPropertyDescriptor(un.prototype,"startP2PConnection"),un.prototype),vt(un.prototype,"connect",[rs],Object.getOwnPropertyDescriptor(un.prototype,"connect"),un.prototype),vt(un.prototype,"updateRemoteRTPCapabilities",[rs],Object.getOwnPropertyDescriptor(un.prototype,"updateRemoteRTPCapabilities"),un.prototype),vt(un.prototype,"publishDataChannel",[rs],Object.getOwnPropertyDescriptor(un.prototype,"publishDataChannel"),un.prototype),vt(un.prototype,"unpublish",[rs],Object.getOwnPropertyDescriptor(un.prototype,"unpublish"),un.prototype),vt(un.prototype,"unpublishDataChannel",[rs],Object.getOwnPropertyDescriptor(un.prototype,"unpublishDataChannel"),un.prototype),vt(un.prototype,"unpublishLowStream",[rs],Object.getOwnPropertyDescriptor(un.prototype,"unpublishLowStream"),un.prototype),vt(un.prototype,"subscribeDataChannel",[rs],Object.getOwnPropertyDescriptor(un.prototype,"subscribeDataChannel"),un.prototype),vt(un.prototype,"subscribe",[rs],Object.getOwnPropertyDescriptor(un.prototype,"subscribe"),un.prototype),vt(un.prototype,"massSubscribe",[rs],Object.getOwnPropertyDescriptor(un.prototype,"massSubscribe"),un.prototype),vt(un.prototype,"unsubscribe",[rs],Object.getOwnPropertyDescriptor(un.prototype,"unsubscribe"),un.prototype),vt(un.prototype,"unsubscribeDataChannel",[rs],Object.getOwnPropertyDescriptor(un.prototype,"unsubscribeDataChannel"),un.prototype),vt(un.prototype,"massUnsubscribe",[rs],Object.getOwnPropertyDescriptor(un.prototype,"massUnsubscribe"),un.prototype),vt(un.prototype,"muteRemote",[rs],Object.getOwnPropertyDescriptor(un.prototype,"muteRemote"),un.prototype),vt(un.prototype,"unmuteRemote",[rs],Object.getOwnPropertyDescriptor(un.prototype,"unmuteRemote"),un.prototype),vt(un.prototype,"hasRemoteMediaWithLock",[rs],Object.getOwnPropertyDescriptor(un.prototype,"hasRemoteMediaWithLock"),un.prototype),vt(un.prototype,"disconnectForReconnect",[rs],Object.getOwnPropertyDescriptor(un.prototype,"disconnectForReconnect"),un.prototype),vt(un.prototype,"updateBitrateLimit",[rs],Object.getOwnPropertyDescriptor(un.prototype,"updateBitrateLimit"),un.prototype),vt(un.prototype,"remoteMediaSsrcChanged",[rs],Object.getOwnPropertyDescriptor(un.prototype,"remoteMediaSsrcChanged"),un.prototype),un);function rs(e,r,o){const s=e[r];if(typeof s!="function")throw new Error("Cannot use mutex on object property.");return o.value=async function(){const c=this.mutex,u=await c.lock("From P2PChannel.".concat(r));try{for(var h=arguments.length,m=new Array(h),_=0;_<h;_++)m[_]=arguments[_];return await s.apply(this,m)}finally{u()}},o}function QH(e,r){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),o.push.apply(o,s)}return o}function ZH(e){for(var r=1;r<arguments.length;r++){var o=arguments[r]!=null?arguments[r]:{};r%2?QH(Object(o),!0).forEach(function(s){$(e,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):QH(Object(o)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(o,s))})}return e}const Rme=Date.now(),Cme=20,oM=new Map,CP=new Map;async function e9(e){const r=oM.get(e),o=Array.isArray(r)&&r[r.length-1],s=CP.get(e);if(!o)return void(s.isSyncing=!1);const c={uid:o.uid,payload:o.payload};s.firstRecvTs===0&&(s.firstRecvTs=o.recvTs,s.firstSendTs=o.sendTs);const u=o.sendTs-s.firstSendTs,h=u-(Date.now()-s.firstRecvTs);h>0&&(s.firstRecvTs=Date.now()-u);let m=o.mediaDelay+h;m<=0?(r.pop(),t9(o.context,c),m=0):m=Math.min(m,Cme),setTimeout(()=>r.length&&e9(e),m)}function t9(e,r){e.safeEmit(mn.STREAM_MESSAGE,r.uid,r.payload),e.onStreamMessage&&e.onStreamMessage(r)}function Ime(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,o=arguments.length>2?arguments[2]:void 0;if(!e.syncWithAudio)return t9(o,{uid:e.uid,payload:e.payload});const s="".concat(o.id,"-").concat(e.uid),c=oM.get(s)||[],u=c.findIndex(y=>e.sendTs>=y.sendTs),h=ZH(ZH({},e),{},{context:o,mediaDelay:r,recvTs:Date.now()});u===-1?c.push(h):c.splice(u,0,h),oM.set(s,c);let m=!1;var _;CP.has(s)?m=!((_=CP.get(s))===null||_===void 0||!_.isSyncing):CP.set(s,{isSyncing:m,firstRecvTs:0,firstSendTs:0}),m||e9(s)}const Ame=Rn().name;function n9(e,r){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),o.push.apply(o,s)}return o}function r9(e){for(var r=1;r<arguments.length;r++){var o=arguments[r]!=null?arguments[r]:{};r%2?n9(Object(o),!0).forEach(function(s){$(e,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):n9(Object(o)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(o,s))})}return e}const eS="websdk_ng_cache_parameter",Pme=re("MAX_PRELOAD_ASYNC_LENGTH"),Ome=1e4,z_=new Map,G_=[];let sM=null,aM=0,cM=0;const IP=new Map,kme=function(e,r){const o=[];let s=0;const c=async()=>{const u=o.shift();u&&await u(),o.length>0&&s<r?c():s--};return async function(){for(var u=arguments.length,h=new Array(u),m=0;m<u;m++)h[m]=arguments[m];return new lt(async(_,y)=>{o.push(async()=>{try{const S=await e(...h);_(S)}catch(S){y(S)}}),s<r&&(s++,c())})}}(i9,Pme),lM=Hs.CancelToken.source();async function i9(e,r,o,s,c,u){try{if(!re("ENABLE_PRELOAD"))return;if(!kn().supportWebCrypto)return void Rm(()=>{D.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!o&&o!==null)throw new Le(X.INVALID_PARAMS,"Invalid token: ".concat(o,". If you don not use token, set it to null"));o&&ro(o,"token",1,2047),ro(e,"appid",1,2047),rP(r),s&&iP(s);const h=A_();D.debug("preload channel ".concat(r,", uid is ").concat(s));const m={appId:e,cname:r,token:o||e,uid:typeof s!="string"?s:null,sid:h,proxyServer:c};let _,y;typeof s=="string"?(m.stringUid=s,[y,_]=await lt.all([fme(s,{sid:h,appId:e},lM.token),CH(r9(r9({},m),{},{token:o||e,uid:0}),lM.token)]),m.uid=y.uid,_.gatewayInfo.uid=m.uid,_.gatewayInfo.res.uid=m.uid):(u&&(m.stringUid=u),_=await CH(m,lM.token));const S={sid:h,appId:e,cname:r,token:o||e,uid:m.stringUid||s,intUid:m.uid||_.gatewayInfo.uid,stringUid:m.stringUid,ts:Date.now(),sua:y,ap:_};await async function(R){let P;try{R.uid&&s9({appId:R.appId,cname:R.cname,token:R.token,uid:R.uid,stringUid:R.stringUid});const k=u9(R),z=await async function(V,q){try{const Y=await window.crypto.subtle.importKey("raw",XW(q),"AES-GCM",!1,["encrypt"]),ce=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},Y,I_(window.btoa(JSON.stringify(V))));return Cm(new Uint8Array(ce))}catch{return}}(R,R.token||R.appId);if(!z)return;P=l9(eS);const U=P?JSON.parse(P):[];U.push({[k]:z}),U.length>re("AP_CACHE_NUM")&&U.shift(),AP(eS,JSON.stringify(U))}catch(k){D.warn("Error caching server parameters:",k.message),AP(eS,"")}}(S),aM++}catch(h){throw cM++,function(m){sM||(sM=window.setTimeout(()=>{let y="";IP.forEach((S,R)=>{y+="".concat(R,": ").concat(S," ;")}),wt.reportApiInvoke(null,{name:_i.PRELOAD,options:{success:aM,failed:cM,err:y}}).onError(m),aM=0,cM=0,IP.clear(),sM=null},Ome));const _=IP.get(m.code)||0;IP.set(m.code,_+1)}(h),h}}async function o9(e){try{if(re("AP_REQUEST_DETAIL")||re("ENABLE_ROLE_SELECT_EDGE"))return;const r=s9(e);if(!r||e.cloudProxyServer!=="disabled")return;const o=await async function(s,c){try{const u=await window.crypto.subtle.importKey("raw",XW(c),"AES-GCM",!1,["decrypt"]),h=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},u,I_(s));return JSON.parse(window.atob(Cm(new Uint8Array(h))))}catch{return}}(r,e.token||e.appId);if(!o||!function(s,c){return s.cname===c.cname&&s.appId===c.appId&&s.token===c.token?c.stringUid?s.stringUid===c.stringUid:typeof c.uid=="number"?s.uid===c.uid:s.uid==c.uid:!1}(o,e))return;if(o&&Date.now()-o.ts<re("AP_CACHE_LIFETIME"))return o}catch(r){D.warn("Error get preloadInfo",r.message)}}function s9(e){let r;try{if(r=l9(eS),!r)return;const o=JSON.parse(r),s=u9(e),c=function(h,m){for(let _=h.length-1;_>=0;_--)if(m(h[_]))return _;return-1}(o,h=>s in h);if(c===-1)return;const u=o.splice(c,1)[0];return AP(eS,JSON.stringify(o)),u[s]}catch(o){D.warn("Error delete preload info: ".concat(r),o.message),AP(eS,"")}}function uM(e){if(e){let r=z_.get(e);r&&(window.clearTimeout(r),r=null,z_.delete(e)),st(G_).call(G_,e)||e.cloudProxyServer!=="disabled"||G_.push(e)}if(z_.size<re("AP_CACHE_NUM")&&G_.length>0){const r=G_.shift();z_.set(r,window.setTimeout(async()=>{const{appId:o,cname:s,token:c,stringUid:u,uid:h,proxyServer:m}=r;try{await kme(o,s,c,h,m,u),z_.has(r)&&uM(r)}catch(_){D.warn("update preload failed",_.message),a9(r)}},re("AP_UPDATE_INTERVAL")))}}function a9(e){const r=G_.indexOf(e);r!==-1&&G_.splice(r,1);let o=z_.get(e);o&&(window.clearTimeout(o),o=null,z_.delete(e),uM())}function c9(e,r){const o=e.sua,s=e.ap;r&&o&&wt.reqUserAccount(e.sid,{lts:o.requestTime,elapse:o.elapse,success:!0,serverAddr:o.url,stringUid:r,uid:e.intUid,errorCode:null,extend:o.req}),wt.reportResourceTiming(e.ap.url,e.sid),wt.joinWebProxyAP(e.sid,{lts:s.requestTime,elapse:s.elapse,sucess:1,apServerAddr:s.url,turnServerAddrList:s.proxyInfo.addresses.map(c=>c.ip).join(","),eventType:"disabled",unilbsServerIds:[ci.CHOOSE_SERVER,ci.CLOUD_PROXY_FALLBACK].toString()}),wt.joinChooseServer(e.sid,{lts:s.requestTime,elapse:s.elapse,succ:!0,csAddr:s.url,opid:s.opid,serverList:s.gatewayInfo.gatewayAddrs.map(c=>c.address),ec:null,cid:s.gatewayInfo.cid.toString(),uid:s.gatewayInfo.uid.toString(),csIp:s.gatewayInfo.csIp,unilbsServerIds:[ci.CHOOSE_SERVER].toString(),isHttp3:s.isHttp3})}function l9(e){return window.atob(window.localStorage.getItem(e)||"")}function AP(e,r){window.localStorage.setItem(e,window.btoa(r))}function u9(e){let r="".concat(e.appId,"_").concat(e.cname);return typeof e.uid=="string"&&(r+="_s_".concat(e.uid)),typeof e.uid=="number"&&(r+="_".concat(e.uid)),e.token&&(r+="_".concat(e.token)),r8(r)}function Nme(e){let r=function(){const o=xme.pop();return o?(o.offset=o.limit=0,o):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(o,s){let c=o.appId;c!==void 0&&(di(s,10),Mm(s,c));let u=o.cid;u!==void 0&&(di(s,16),di(s,u));let h=o.cname;h!==void 0&&(di(s,26),Mm(s,h));let m=o.deviceId;m!==void 0&&(di(s,34),Mm(s,m));let _=o.elapse;_!==void 0&&(di(s,40),Um(s,_));let y=o.fileSize;y!==void 0&&(di(s,48),Um(s,tS(y)));let S=o.height;S!==void 0&&(di(s,56),Um(s,tS(S)));let R=o.jpg;R!==void 0&&(di(s,66),di(s,R.length),h9(s,R));let P=o.networkType;P!==void 0&&(di(s,72),Um(s,tS(P)));let k=o.osType;k!==void 0&&(di(s,80),Um(s,tS(k)));let z=o.requestId;z!==void 0&&(di(s,90),Mm(s,z));let U=o.sdkVersion;U!==void 0&&(di(s,98),Mm(s,U));let V=o.sequence;V!==void 0&&(di(s,104),Um(s,tS(V)));let q=o.sid;q!==void 0&&(di(s,114),Mm(s,q));let Y=o.timestamp;Y!==void 0&&(di(s,120),Um(s,Y));let ce=o.uid;ce!==void 0&&(di(s,128),di(s,ce));let _e=o.vid;_e!==void 0&&(di(s,136),di(s,_e));let Ee=o.width;Ee!==void 0&&(di(s,144),Um(s,tS(Ee)));let me=o.service;me!==void 0&&(di(s,152),di(s,me));let ke=o.callbackData;ke!==void 0&&(di(s,162),di(s,ke.length),h9(s,ke));let Ye=o.ticket;Ye!==void 0&&(di(s,170),Mm(s,Ye));let ut=o.vendorConfigs;ut!==void 0&&(di(s,178),Mm(s,ut))}(e,r),function(o){let s=o.bytes,c=o.limit;return s.length===c?s:s.subarray(0,c)}(r)}function Dme(e){return function(o){let s={};e:for(;!Mme(o);){let c=DT(o);switch(c>>>3){case 0:break e;case 1:s.code=DT(o);break;case 2:s.msg=f9(o,DT(o));break;case 3:s.requestId=f9(o,DT(o));break;case 4:s.timestamp=Ume(o,!1);break;default:Lme(o,7&c)}}return s}({bytes:r=e,offset:0,limit:r.length});var r}function Lme(e,r){switch(r){case 0:for(;128&pu(e););break;case 2:dM(e,DT(e));break;case 5:dM(e,4);break;case 1:dM(e,8);break;default:throw new Error("Unimplemented type: "+r)}}function tS(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let xme=[];function dM(e,r){if(e.offset+r>e.limit)throw new Error("Skip past limit");e.offset+=r}function Mme(e){return e.offset>=e.limit}function PP(e,r){let o=e.bytes,s=e.offset,c=e.limit,u=s+r;if(u>o.length){let h=new Uint8Array(2*u);h.set(o),e.bytes=h}return e.offset=u,u>c&&(e.limit=u),s}function d9(e,r){let o=e.offset;if(o+r>e.limit)throw new Error("Read past limit");return e.offset+=r,o}function h9(e,r){let o=PP(e,r.length);e.bytes.set(r,o)}function f9(e,r){let o=d9(e,r),s=String.fromCharCode,c=e.bytes,u="",h="";for(let m=0;m<r;m++){let _,y,S,R,P=c[m+o];(128&P)==0?h+=s(P):(224&P)==192?m+1>=r?h+=u:(_=c[m+o+1],(192&_)!=128?h+=u:(R=(31&P)<<6|63&_,R<128?h+=u:(h+=s(R),m++))):(240&P)==224?m+2>=r?h+=u:(_=c[m+o+1],y=c[m+o+2],(49344&(_|y<<8))!=32896?h+=u:(R=(15&P)<<12|(63&_)<<6|63&y,R<2048||R>=55296&&R<=57343?h+=u:(h+=s(R),m+=2))):(248&P)==240?m+3>=r?h+=u:(_=c[m+o+1],y=c[m+o+2],S=c[m+o+3],(12632256&(_|y<<8|S<<16))!=8421504?h+=u:(R=(7&P)<<18|(63&_)<<12|(63&y)<<6|63&S,R<65536||R>1114111?h+=u:(R-=65536,h+=s(55296+(R>>10),56320+(1023&R)),m+=3))):h+=u}return h}function Mm(e,r){let o=r.length,s=0;for(let h=0;h<o;h++){let m=r.charCodeAt(h);m>=55296&&m<=56319&&h+1<o&&(m=(m<<10)+r.charCodeAt(++h)-56613888),s+=m<128?1:m<2048?2:m<65536?3:4}di(e,s);let c=PP(e,s),u=e.bytes;for(let h=0;h<o;h++){let m=r.charCodeAt(h);m>=55296&&m<=56319&&h+1<o&&(m=(m<<10)+r.charCodeAt(++h)-56613888),m<128?u[c++]=m:(m<2048?u[c++]=m>>6&31|192:(m<65536?u[c++]=m>>12&15|224:(u[c++]=m>>18&7|240,u[c++]=m>>12&63|128),u[c++]=m>>6&63|128),u[c++]=63&m|128)}}function pu(e){return e.bytes[d9(e,1)]}function p9(e,r){let o=PP(e,1);e.bytes[o]=r}function DT(e){let r,o=0,s=0;do r=pu(e),o<32&&(s|=(127&r)<<o),o+=7;while(128&r);return s}function di(e,r){for(r>>>=0;r>=128;)p9(e,127&r|128),r>>>=7;p9(e,r)}function Ume(e,r){let o,s=0,c=0,u=0;return o=pu(e),s=127&o,128&o&&(o=pu(e),s|=(127&o)<<7,128&o&&(o=pu(e),s|=(127&o)<<14,128&o&&(o=pu(e),s|=(127&o)<<21,128&o&&(o=pu(e),c=127&o,128&o&&(o=pu(e),c|=(127&o)<<7,128&o&&(o=pu(e),c|=(127&o)<<14,128&o&&(o=pu(e),c|=(127&o)<<21,128&o&&(o=pu(e),u=127&o,128&o&&(o=pu(e),u|=(127&o)<<7))))))))),{low:s|c<<28,high:c>>>4|u<<24,unsigned:r}}function Um(e,r){let o=r.low>>>0,s=(r.low>>>28|r.high<<4)>>>0,c=r.high>>>24,u=c===0?s===0?o<16384?o<128?1:2:o<1<<21?3:4:s<16384?s<128?5:6:s<1<<21?7:8:c<128?9:10,h=PP(e,u),m=e.bytes;switch(u){case 10:m[h+9]=c>>>7&1;case 9:m[h+8]=u!==9?128|c:127&c;case 8:m[h+7]=u!==8?s>>>21|128:s>>>21&127;case 7:m[h+6]=u!==7?s>>>14|128:s>>>14&127;case 6:m[h+5]=u!==6?s>>>7|128:s>>>7&127;case 5:m[h+4]=u!==5?128|s:127&s;case 4:m[h+3]=u!==4?o>>>21|128:o>>>21&127;case 3:m[h+2]=u!==3?o>>>14|128:o>>>14&127;case 2:m[h+1]=u!==2?o>>>7|128:o>>>7&127;case 1:m[h]=u!==1?128|o:127&o}}const m9={},g9={},OP=4294967296,Vme=OP*OP,Fme=Vme/2;E9(0,!0);const _9=E9(0),jme=LT(0,-2147483648,!1),Bme=LT(-1,2147483647,!1);function E9(e,r){let o,s,c;return r?(c=0<=(e>>>=0)&&e<256)&&(s=g9[e],s)?s:(o=LT(e,0,!0),c&&(g9[e]=o),o):(c=-128<=(e|=0)&&e<128)&&(s=m9[e],s)?s:(o=LT(e,e<0?-1:0,!1),c&&(m9[e]=o),o)}function LT(e,r,o){return{low:0|e,high:0|r,unsigned:!!o}}function y9(e,r){if(isNaN(e))return _9;{if(e<=-9223372036854776e3)return jme;if(e+1>=Fme)return Bme}return e<0?_9:LT(e%OP|0,e/OP|0,r)}function v9(e,r){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),o.push.apply(o,s)}return o}class hM extends Pr{get connectionState(){return this._connectionState}set connectionState(r){if(this._connectionState===r)return;const o=this._connectionState;this._connectionState=r,this.emit(gd.CONNECTION_STATE_CHANGE,r,o)}get quality(){return this._quality}set quality(r){this._quality=r>1?1:r<.1?.1:r,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(r){var o;super(),$(this,"name","AgoraRTCImageModeration"),$(this,"_connectionState",yl.CONNECTING),$(this,"_sequence",0),$(this,"_moderationStartTime",void 0),$(this,"_workerConnection",void 0),$(this,"_workerMessageLengthLimit",void 0),$(this,"_qualityRatio",void 0),$(this,"_connectInfo",void 0),$(this,"_cancelTokenSource",Hs.CancelToken.source()),$(this,"_retryConfig",void 0),$(this,"_moderationInterval",void 0),$(this,"_moderationTimer",null),$(this,"_moderationMode",1),$(this,"_quality",1),$(this,"_qualityTimer",null),$(this,"_ticket",void 0),$(this,"_moderationIntervalMinimum",void 0),$(this,"_uploadFailedNum",0),$(this,"_uploadNum",0),$(this,"_uploadTimer",null),$(this,"_extraInfo",void 0),$(this,"_vendor",""),$(this,"_encoder",new TextEncoder),$(this,"_moderationId",void 0),$(this,"inspectImage",()=>{if(this.connectionState!==yl.CONNECTED)throw new Oe(X.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===yl.CONNECTED?this.requestToInspectImage():D.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=sr(5,"image-moderation-"),this._workerMessageLengthLimit=re("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=re("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(o=r.interval)!==null&&o!==void 0?o:1e3,r.extraInfo&&(this._extraInfo=this._encoder.encode(r.extraInfo)),r.vendor&&(this._vendor=r.vendor),this._qualityRatio=re("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new TT("worker-"+this._moderationId,Ei),this.on(gd.STATE_CHANGE,(s,c)=>{D.debug("[".concat(this._moderationId,"] Moderation operation :").concat(Gv[s]," ").concat(c||""))}),this.handleWorkerEvents()}async init(r,o){this.emit(gd.STATE_CHANGE,Gv.CONNECT_AP),this._connectInfo=r;const s=this._cancelTokenSource.token;return this._retryConfig=o,new lt((c,u)=>{this.on(gd.CONNECTION_STATE_CHANGE,(h,m)=>{h===yl.CONNECTED&&c()}),this.requestAP(r,s,o).then(h=>{this.connectWorker(h)}).catch(h=>{u(h)})})}updateConfig(r){var o;this._moderationInterval=(o=r.interval)!==null&&o!==void 0?o:1e3,r.extraInfo&&(this._extraInfo=this._encoder.encode(r.extraInfo)),r.vendor&&(this._vendor=r.vendor),D.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(r))),this.connectionState===yl.CONNECTED&&this.inspectImage()}async requestAP(r,o,s){const c=re("WEBCS_DOMAIN").map(_=>"https://".concat(_,"/api/v1")),u=await function(_,y,S,R){let{appId:P,areaCode:k,cname:z,sid:U,token:V,uid:q}=y;Xv++;const Y="moderation_plugin",ce={service_name:Y,json_body:JSON.stringify({appId:P,areaCode:k,cname:z,command:"allocateEdge",requestId:Xv,seq:Xv,sid:U,appToken:V,ts:Date.now(),uid:q+""})};let _e,Ee,me=_[0];return hd(async()=>{_e=Date.now();const ke=await _d(me,{data:ce,cancelToken:S,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(Ee=Date.now()-_e,ke.code!==0){const pt=new Oe(X.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+ke.code,{retry:!0,responseTime:Ee});throw D.error(pt.toString()),pt}const Ye=JSON.parse(ke.json_body);if(Ye.code!==200){const pt=new Oe(X.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(Ye.code,", reason: ").concat(Ye.reason),{code:Ye.code,responseTime:Ee});throw D.error(pt.toString()),pt}if(!Ye.servers||!Array.isArray(Ye.servers)||Ye.servers.length===0){const pt=new Oe(X.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:Ye.code,responseTime:Ee});throw D.error(pt.toString()),pt}if(!Ye.servers.some(pt=>!!pt.wss)){const pt=new Oe(X.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:Ye.code,responseTime:Ee});throw D.error(pt.toString()),pt}const ut=re("IMAGE_MODERATION_WORKER_HOST");return{addressList:Ye.servers.map(pt=>{let{address:vn,wss:Sn}=pt;if(vn&&Sn)return"wss://".concat(vn.replace(/\./g,"-"),".").concat(ut,":").concat(Sn,"/moderation")}).filter(pt=>!!pt),workerToken:Ye.workerToken,vid:Ye.vid,ticket:Ye.appTicket,responseTime:Ee}},(ke,Ye)=>(wt.apworkerEvent(U,{success:!0,sc:200,serviceName:Y,responseDetail:JSON.stringify(ke.addressList),firstSuccess:Ye===0,responseTime:Ee,serverIp:_[Ye%_.length]}),!1),(ke,Ye)=>(wt.apworkerEvent(U,{success:!1,sc:ke.data&&ke.data.code||200,serviceName:Y,responseTime:Ee,serverIp:_[Ye%_.length]}),!!(ke.code!==X.OPERATION_ABORTED&&ke.code!==X.UNEXPECTED_RESPONSE||ke.data&&ke.data.retry)&&(me=_[(Ye+1)%_.length],!0)),R)}(c,r,o,s);this.emit(gd.STATE_CHANGE,Gv.AP_CONNECTED);const{addressList:h,ticket:m}=u;return this._ticket=m,h}async connectWorker(r){this.emit(gd.STATE_CHANGE,Gv.CONNECT_WORKER),await this._workerConnection.init(r,1e4)}handleWorkerEvents(){this._workerConnection.on(qt.CONNECTED,async()=>{this.emit(gd.STATE_CHANGE,Gv.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=yl.CONNECTED}),this._workerConnection.on(qt.CLOSED,()=>{this.connectionState=yl.CLOSED}),this._workerConnection.on(qt.FAILED,()=>{this.connectionState=yl.CLOSED}),this._workerConnection.on(qt.RECONNECTING,()=>{this.connectionState=this.connectionState===yl.CONNECTED?yl.RECONNECTING:yl.CONNECTING}),this._workerConnection.on(qt.ON_MESSAGE,async r=>{if(r.data instanceof ArrayBuffer){const o=Dme(new Uint8Array(r.data));re("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&D.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(o)),this._uploadNum++,o.code===void 0||o.code===0||(this._uploadFailedNum++,D.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(o.code,", msg is ").concat(o.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{wt.reportApiInvoke(this._connectInfo.sid||null,{name:_i.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,o.code],tag:xr.TRACER}).onError(new Oe(X.IMAGE_MODERATION_UPLOAD_FAILED,o.msg)),this._uploadTimer=null},re("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else D.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(qt.WILL_RECONNECT,(r,o,s)=>{r==="recover"&&s(r),s("tryNext")}),this._workerConnection.on(qt.REQUEST_NEW_URLS,(r,o)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r).catch(o)})}static intToLong(r){return{low:r|=0,high:r>>31,unsigned:r>=0}}async requestToInspectImage(){const r=kc(this,gd.CLIENT_LOCAL_VIDEO_TRACK),o={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(r){if(!r.isPlaying)return void(re("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&D.debug("Only the track being played can be inspected"));this._sequence++;const s=await this.generateRequestData(r,o);this._workerConnection.sendMessage(s,!0,!0)}else re("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&D.debug("Only the track being published can be inspected")}async generateRequestData(r,o){let{appId:s,cname:c,cid:u,vid:h,sid:m,uid:_}=o;const y=Date.now(),S=await r.getCurrentFrameImage("image/jpeg",this.quality),R=await $8(S,s,c),P=this._sequence+"-"+u+"-"+_+"-"+y+"-"+sr(12,""),k={appId:s,cid:u,cname:c,deviceId:"",elapse:hM.intToLong(Number(y-this._moderationStartTime)),fileSize:S.buffer.byteLength,height:S.height,width:S.width,jpg:R,networkType:6,osType:7,requestId:P,sdkVersion:"4.23.2",sequence:this._sequence,sid:m,timestamp:y9(y),uid:_,vid:h,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete k.callbackData;const z=Nme(k);if(z.byteLength<this._workerMessageLengthLimit){if(re("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const U=function(V){for(var q=1;q<arguments.length;q++){var Y=arguments[q]!=null?arguments[q]:{};q%2?v9(Object(Y),!0).forEach(function(ce){$(V,ce,Y[ce])}):Object.getOwnPropertyDescriptors?Object.defineProperties(V,Object.getOwnPropertyDescriptors(Y)):v9(Object(Y)).forEach(function(ce){Object.defineProperty(V,ce,Object.getOwnPropertyDescriptor(Y,ce))})}return V}({},k);delete U.jpg,D.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(U))}return z}{const U=this.quality*this._qualityRatio;return this.quality=U,await this.generateRequestData(r,{appId:s,cname:c,cid:u,vid:h,sid:m,uid:_})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Hs.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=yl.CLOSED,this.emit(gd.STATE_CHANGE,Gv.CLOSED)}}function S9(e){if(er(e.interval,"interval",1e3,1/0),e&&e.extraInfo&&e.extraInfo.length>1024)throw new Oe(X.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(e&&e.vendor&&e.vendor.length>1024)throw new Oe(X.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const Wme={name:"ImageModeration",create:function(e){let{config:r}=e;return S9(r),new hM(r)}};var b9,T9,w9,R9,C9,I9,A9,P9,O9,k9,N9,D9,L9,x9,M9,U9,V9,F9,j9,B9,W9,z9,G9,H9,$9,K9,q9,Y9,X9,J9,Q9,Z9,e7,t7,n7,r7,i7,o7,s7,a7,c7,ft;function l7(e,r){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),o.push.apply(o,s)}return o}function mu(e){for(var r=1;r<arguments.length;r++){var o=arguments[r]!=null?arguments[r]:{};r%2?l7(Object(o),!0).forEach(function(s){$(e,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):l7(Object(o)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(o,s))})}return e}Oo.setLogger(D);let zme=(b9=Mt(),T9=Mt({argsMap:(e,r)=>{if(!Array.isArray(r)){if(!(r instanceof Mv))return[r];r=[r]}return r.map(o=>o?Object(o).toString():"null")}}),w9=Mt({argsMap:(e,r)=>(r||(r=[]),Array.isArray(r)||r.trackMediaType!==xv.DATA?(Array.isArray(r)||(r=[r]),r.map(o=>o.getTrackId())):[r.getChannelId()])}),R9=Mt({argsMap:(e,r,o,s)=>[typeof r=="object"?r.uid:r,o,s]}),C9=Mt({argsMap:(e,r,o)=>[r,o]}),I9=Mt({argsMap:(e,r)=>r.map(o=>{let{user:s,mediaType:c}=o;return[s==null?void 0:s.uid,c]})}),A9=Mt({argsMap:(e,r,o,s)=>[typeof r=="object"?r.uid:r,o,s]}),P9=Mt({argsMap:(e,r)=>r.map(o=>{let{user:s,mediaType:c}=o;return{uid:s==null?void 0:s.uid,mediaType:c}})}),O9=Mt(),k9=Mt(),N9=Mt(),D9=Mt(),L9=Mt(),x9=Mt(),M9=Mt(),U9=Mt(),V9=Mt(),F9=Mt(),j9=Mt(),B9=Mt(),W9=Mt(),z9=Mt(),G9=Mt(),H9=Mt({argsMap:(e,r)=>[r]}),$9=Mt(),K9=Mt(),q9=Mt(),Y9=Mt(),X9=Mt(),J9=Mt(),Q9=Mt(),Z9=Mt(),e7=Mt({argsMap:(e,r)=>(Array.isArray(r)||(r=[r]),[JSON.stringify(r)])}),t7=Mt(),n7=Mt(),r7=Mt(),i7=Mt(),o7=Mt(),s7=Mt(),a7=Mt({reportResult:!0}),c7=Mt(),ft=class extends Pr{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var e;return((e=this._config)===null||e===void 0?void 0:e.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(e,r){let o;if(super(),$(this,"store",void 0),$(this,"_uid",void 0),$(this,"_channelName",void 0),$(this,"_uintUid",void 0),$(this,"_users",[]),$(this,"_config",void 0),$(this,"_clientId",void 0),$(this,"_appId",void 0),$(this,"_sessionId",null),$(this,"_key",void 0),$(this,"_rtmConfig",{}),$(this,"_joinInfo",void 0),$(this,"_gateway",void 0),$(this,"_statsCollector",void 0),$(this,"_configDistribute",void 0),$(this,"_leaveMutex",void 0),$(this,"_publishMutex",void 0),$(this,"_renewTokenMutex",void 0),$(this,"_subscribeMutex",void 0),$(this,"_encryptionMode","none"),$(this,"_encryptionSecret",null),$(this,"_encryptionSalt",null),$(this,"_encryptDataStream",!1),$(this,"_encryptDataStreamKey",null),$(this,"_encryptDataStreamIv",null),$(this,"_proxyServer",void 0),$(this,"_turnServer",{servers:[],mode:"auto"}),$(this,"_cloudProxyServerMode","disabled"),$(this,"_isDualStreamEnabled",!1),$(this,"_defaultStreamFallbackType",void 0),$(this,"_lowStreamParameter",void 0),$(this,"_streamFallbackTypeCacheMap",new Map),$(this,"_remoteStreamTypeCacheMap",new Map),$(this,"_axiosCancelSource",Hs.CancelToken.source()),$(this,"_audioVolumeIndicationInterval",void 0),$(this,"_networkQualityInterval",void 0),$(this,"_userOfflineTimeout",void 0),$(this,"_streamRemovedTimeout",void 0),$(this,"_liveTranscodeStreamingClient",void 0),$(this,"_liveRawStreamingClient",void 0),$(this,"_channelMediaRelayClient",void 0),$(this,"_networkQualitySensitivity","normal"),$(this,"_p2pChannel",void 0),$(this,"_useLocalAccessPoint",!1),$(this,"_setLocalAPVersion",void 0),$(this,"_joinAndNotLeaveYet",!1),$(this,"_numberOfJoinCount",0),$(this,"_remoteDefaultVideoStreamType",void 0),$(this,"_inspect",void 0),$(this,"_moderation",void 0),$(this,"_license",void 0),$(this,"_pendingPublishedUsers",[]),$(this,"ntpAlignErrorCount",0),$(this,"remoteInboundOffset",0),$(this,"_peerConnectionState",void 0),$(this,"_handleLocalTrackEnable",(c,u,h)=>{this.publish(c,!1).then(u).catch(h)}),$(this,"_handleLocalTrackDisable",(c,u,h)=>{this.unpublish(c).then(u).catch(h)}),$(this,"_handleUserOnline",c=>{if(re("BLOCK_LOCAL_CLIENT")&&M_(c.uid,this.channelName))return void D.debug("[".concat(c.uid,"] will be ignored in local"));this.isStringUID&&typeof c.uid!="string"&&D.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const u=this._users.find(h=>h.uid===c.uid);if(u)u._trust_in_room_=!0,u._is_pre_created&&(u._is_pre_created=!1,this.safeEmit(mn.USER_JOINED,u));else{const h=new Lm(c.uid,c.uint_id||c.uid);this._users.push(h),D.debug("[".concat(this._clientId,"] user online"),c.uid),this.safeEmit(mn.USER_JOINED,h)}}),$(this,"_handleUserOffline",c=>{if(re("BLOCK_LOCAL_CLIENT")&&M_(c.uid,this.channelName))return;const u=this._users.find(h=>h.uid===c.uid);u&&(this._handleRemoveStream(c),this._handleRemoveDataChannels(c),u._audio_pre_subscribed||u._video_pre_subscribed?u._is_pre_created=!0:NA(this._users,u),this._remoteStreamTypeCacheMap.delete(u.uid),this._streamFallbackTypeCacheMap.delete(u.uid),D.debug("[".concat(this._clientId,"] user offline"),c.uid,"reason:",c.reason),this.safeEmit(mn.USER_LEAVED,u,c.reason))}),$(this,"_handleAddAudioOrVideoStream",(c,u,h,m,_,y,S)=>{if(re("BLOCK_LOCAL_CLIENT")&&M_(u,this.channelName))return;const R=this._users.find(k=>k.uid===u);if(!R)return void D.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));D.debug("[".concat(this._clientId,"] stream added with uid ").concat(u,", type ").concat(c)),this.store.subscribe(R.uid,c,void 0,void 0,void 0,Date.now());const P=c==="audio"?R.hasAudio:R.hasVideo;R._uintid||(R._uintid=_||u),c==="audio"?R._trust_audio_stream_added_state_=!0:R._trust_video_stream_added_state_=!0,c==="audio"?(R._audio_added_=!0,h!==void 0&&(R._audioSSRC=h),m!==void 0&&(R._cname=m),y&&(R._audioOrtc=y)):(R._video_added_=!0,h!==void 0&&(R._videoSSRC=h),m!==void 0&&(R._cname=m),S!==void 0&&(R._rtxSsrcId=S),y&&(R._videoOrtc=y)),(c==="audio"?R.hasAudio:R.hasVideo)&&!P&&(D.info("[".concat(this._clientId,"] remote user ").concat(R.uid," published ").concat(c)),this.safeEmit(mn.USER_PUBLISHED,R,c)),c==="video"?wt.onGatewayStream(this._sessionId,ji.ON_ADD_VIDEO_STREAM,wr.ON_ADD_VIDEO_STREAM,{peer:_||u,ssrc:R._videoSSRC}):wt.onGatewayStream(this._sessionId,ji.ON_ADD_AUDIO_STREAM,wr.ON_ADD_AUDIO_STREAM,{peer:_||u,ssrc:R._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(R,c,h).then(k=>{if(k&&(D.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(R.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof NT))return this._p2pChannel.unsubscribe(R,c,!0).then(()=>this._subscribe(R,c,!0).catch(z=>{D.error("[".concat(this._clientId,"] resubscribe error"),z.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(R,c)&&(D.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(R.uid," after reconnect.")),this._subscribe(R,c,!0).catch(k=>{D.error("[".concat(this._clientId,"] resubscribe error"),k.toString())}))}),$(this,"_handleRemoveStream",c=>{if(re("BLOCK_LOCAL_CLIENT")&&M_(c.uid,this.channelName))return;const u=this._users.find(m=>m.uid===c.uid);if(!u)return void D.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));D.debug("[".concat(this._clientId,"] stream removed with uid ").concat(c.uid));let h=()=>{};u.hasAudio&&u.hasVideo?h=()=>{D.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished audio track")),this.safeEmit(mn.USER_UNPUBLISHED,u,"audio"),D.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished video track")),this.safeEmit(mn.USER_UNPUBLISHED,u,"video")}:u.hasVideo?h=()=>{D.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished video track")),this.safeEmit(mn.USER_UNPUBLISHED,u,"video")}:u.hasAudio&&(h=()=>{D.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished audio track")),this.safeEmit(mn.USER_UNPUBLISHED,u,"audio")}),u._video_pre_subscribed||u._audio_pre_subscribed||(u._trust_audio_stream_added_state_=!0,u._trust_video_stream_added_state_=!0,u._audio_added_=!1,u._video_added_=!1,this._p2pChannel instanceof NT&&this._p2pChannel.unsubscribe(u).then(m=>{if(m)return this._gateway.unsubscribe(m,u.uid)}),u._audioSSRC=void 0,u._videoSSRC=void 0,u._audioOrtc=void 0,u._videoOrtc=void 0,u._rtxSsrcId=void 0),wt.onGatewayStream(this._sessionId,ji.ON_REMOVE_STREAM,wr.ON_REMOVE_STREAM,{peer:c.uint_id||c.uid}),h()}),$(this,"_handleSetStreamLocalEnable",(c,u,h)=>{if(re("BLOCK_LOCAL_CLIENT")&&M_(u,this.channelName))return;const m=this._users.find(S=>S.uid===u);if(!m)return void D.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));D.debug("[".concat(this._clientId,"] local ").concat(c," ").concat(h?"enabled":"disabled"," with uid ").concat(u));const _=c==="audio"?m.hasAudio:m.hasVideo;if(c==="audio"){m._trust_audio_enabled_state_=!0;const S=m._audio_enabled_;if(m._audio_enabled_=h,m._audio_enabled_===S)return;{const R=m._audio_enabled_?"enable-local-audio":"disable-local-audio";D.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(u,", msg: ").concat(R)),this.safeEmit(mn.USER_INFO_UPDATED,u,R)}}else{m._trust_video_enabled_state_=!0;const S=m._video_enabled_;if(m._video_enabled_=h,m._video_enabled_===S)return;{const R=m._video_enabled_?"enable-local-video":"disable-local-video";D.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(u,", msg: ").concat(R)),this.safeEmit(mn.USER_INFO_UPDATED,u,R)}}const y=c==="audio"?m.hasAudio:m.hasVideo;return _!==y?!_&&y?(D.info("[".concat(this._clientId,"] remote user ").concat(u," published ").concat(c)),void this.safeEmit(mn.USER_PUBLISHED,m,c)):(c==="video"&&m._videoTrack&&m._videoTrack._destroy(),c==="audio"&&m._audioTrack,this._p2pChannel.muteRemote(m,c),D.info("[".concat(this._clientId,"] remote user ").concat(u," unpublished ").concat(c)),void this.safeEmit(mn.USER_UNPUBLISHED,m,c)):void 0}),$(this,"_handleMuteStream",(c,u,h)=>{if(re("BLOCK_LOCAL_CLIENT")&&M_(c,this.channelName))return;D.debug("[".concat(this._clientId,"] receive mute message"),c,u,h);const m=this._users.find(S=>S.uid===c);if(!m)return void D.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(c));const _=u==="audio"?m.hasAudio:m.hasVideo;if(u==="audio"){m._trust_audio_mute_state_=!0;const S=m._audio_muted_;if(m._audio_muted_=h,m._audio_muted_===S)return;{const R=m._audio_muted_?"mute-audio":"unmute-audio";D.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(R)),this.safeEmit(mn.USER_INFO_UPDATED,c,R)}}else{m._trust_video_mute_state_=!0;const S=m._video_muted_;if(m._video_muted_=h,m._video_muted_===S)return;{const R=m._video_muted_?"mute-video":"unmute-video";D.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(R)),this.safeEmit(mn.USER_INFO_UPDATED,c,R)}}const y=u==="audio"?m.hasAudio:m.hasVideo;if(_!==y){if(!_&&y)return(u==="audio"?m._audioSSRC:m._videoSSRC)?(D.info("[".concat(this._clientId,"] remote user ").concat(c," published ").concat(u)),void this.safeEmit(mn.USER_PUBLISHED,m,u)):void D.warning("[".concat(this._clientId,"] remote user ").concat(c," receive ").concat(u," unmute message  before add stream message, ").concat(u," SSRC doesn't exist yet."));u==="video"&&m._videoTrack&&!m._video_pre_subscribed&&m._videoTrack._destroy(),u==="audio"&&m._audioTrack,this._p2pChannel.muteRemote(m,u),D.info("[".concat(this._clientId,"] remote user ").concat(c," unpublished ").concat(u)),this.safeEmit(mn.USER_UNPUBLISHED,m,u)}}),$(this,"_handleP2PLost",async c=>{D.debug("[".concat(this._clientId,"] receive p2p lost"),c),parseInt(c.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():D.warning("[".concat(this._clientId,"] P2PLost stream not found"),c)}),$(this,"_handleTokenWillExpire",()=>{D.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(mn.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),$(this,"_handleBeforeUnload",c=>{c.type==="beforeunload"&&c.returnValue!==void 0&&c.returnValue!==""||(this.leave(),D.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),$(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(mn.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const c={downlinkNetworkQuality:0,uplinkNetworkQuality:0};c.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),c.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(mn.NETWORK_QUALITY,c)}),$(this,"_handleP2PAddAudioOrVideoStream",(c,u,h,m)=>{const _=this._users.find(S=>S.uid===u);if(!_)return void D.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));D.debug("[".concat(this._clientId,"] stream added with uid ").concat(u,", type ").concat(c)),this.store.subscribe(_.uid,c,void 0,void 0,void 0,Date.now());const y=c==="audio"?_.hasAudio:_.hasVideo;c==="audio"?_._trust_audio_stream_added_state_=!0:_._trust_video_stream_added_state_=!0,c==="audio"?(_._audio_added_=!0,h!==void 0&&(_._audioSSRC=h),m!==void 0&&(_._audioMid=m)):(_._video_added_=!0,h!==void 0&&(_._videoSSRC=h),m!==void 0&&(_._videoMid=m)),(c==="audio"?_.hasAudio:_.hasVideo)&&!y&&(D.info("[".concat(this._clientId,"] remote user ").concat(_.uid," published ").concat(c)),this.safeEmit(mn.USER_PUBLISHED,_,c)),this._p2pChannel.hasPendingRemoteMedia(_,c)&&(D.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(_.uid," after reconnect.")),this._subscribe(_,c,!0).catch(S=>{D.error("[".concat(this._clientId,"] resubscribe error"),S.toString())}))}),this._config=e,this._clientId=r||sr(5,"client-"),this.store=new class{constructor(c,u,h,m){zt(this,"state",void 0),this.state={codec:c,audioCodec:u,mode:h,clientId:m,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:P_.Default,hasStartJoinChannel:!1,isABTestSuccess:!1}}dispatch(c){this.state=function(u,h){switch(h.type){case gn.SET_SESSION_ID:return mt(mt({},u),{},{sessionId:h.sessionId});case gn.SET_P2P_ID:return mt(mt({},u),{},{p2pId:h.p2pId});case gn.SET_UID:return mt(mt({},u),{},{uid:h.uid});case gn.SET_INT_UID:return mt(mt({},u),{},{intUid:h.intUid});case gn.SET_PUB_ID:return mt(mt({},u),{},{pubId:h.pubId});case gn.KEY_METRIC_CLIENT_CREATED:return mt(mt({},u),{},{keyMetrics:mt(mt({},u.keyMetrics),{},{clientCreated:h.metric})});case gn.KEY_METRIC_JOIN_START:return mt(mt({},u),{},{keyMetrics:mt(mt({},u.keyMetrics),{},{joinStart:h.metric})});case gn.AVOID_JOIN_START:return mt(mt({},u),{},{avoidJoinStart:h.avoidJoinStart});case gn.KEY_METRIC_JOIN_END:return mt(mt({},u),{},{keyMetrics:mt(mt({},u.keyMetrics),{},{joinEnd:h.metric})});case gn.KEY_METRIC_REQUEST_AP_START:return mt(mt({},u),{},{keyMetrics:mt(mt({},u.keyMetrics),{},{requestAPStart:h.metric})});case gn.KEY_METRIC_REQUEST_AP_END:return mt(mt({},u),{},{keyMetrics:mt(mt({},u.keyMetrics),{},{requestAPEnd:h.metric})});case gn.KEY_METRIC_JOIN_GATEWAY_START:return mt(mt({},u),{},{keyMetrics:mt(mt({},u.keyMetrics),{},{joinGatewayStart:h.metric})});case gn.KEY_METRIC_JOIN_GATEWAY_END:return mt(mt({},u),{},{keyMetrics:mt(mt({},u.keyMetrics),{},{joinGatewayEnd:h.metric})});case gn.KEY_METRIC_PEER_CONNECTION_START:return mt(mt({},u),{},{keyMetrics:mt(mt({},u.keyMetrics),{},{peerConnectionStart:h.metric})});case gn.KEY_METRIC_PEER_CONNECTION_END:return mt(mt({},u),{},{keyMetrics:mt(mt({},u.keyMetrics),{},{peerConnectionEnd:h.metric})});case gn.KEY_METRIC_DESCRIPTION_START:return mt(mt({},u),{},{keyMetrics:mt(mt({},u.keyMetrics),{},{descriptionStart:h.metric})});case gn.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return mt(mt({},u),{},{keyMetrics:mt(mt({},u.keyMetrics),{},{signalChannelOpen:h.metric})});case gn.KEY_METRIC_ICE_CONNECTION_END:return mt(mt({},u),{},{keyMetrics:mt(mt({},u.keyMetrics),{},{iceConnectionEnd:h.metric})});case gn.KEY_METRIC_PUBLISH:{const m=u.keyMetrics.publish,_=m.findIndex(y=>y.trackId===h.metric.trackId);return _!==-1?(m[_]=mt(mt({},m[_]),h.metric),mt(mt({},u),{},{keyMetrics:mt(mt({},u.keyMetrics),{},{publish:[...m]})})):mt(mt({},u),{},{keyMetrics:mt(mt({},u.keyMetrics),{},{publish:[...u.keyMetrics.publish,h.metric]})})}case gn.KEY_METRIC_SUBSCRIBE:{const m=u.keyMetrics.subscribe,_=m.findIndex(y=>y.userId===h.metric.userId&&y.type===h.metric.type);return _!==-1?(m[_]=mt(mt({},m[_]),h.metric),mt(mt({},u),{},{keyMetrics:mt(mt({},u.keyMetrics),{},{subscribe:[...m]})})):mt(mt({},u),{},{keyMetrics:mt(mt({},u.keyMetrics),{},{subscribe:[...u.keyMetrics.subscribe,h.metric]})})}case gn.SET_CLOUD_PROXY_SERVER_MODE:return u.cloudProxyServerMode=h.mode,u;case gn.RECORD_JOIN_CHANNEL_SERVICE:return typeof h.index!="number"?u.joinChannelServiceRecords=[...u.joinChannelServiceRecords,h.record]:(u.joinChannelServiceRecords[h.index]=mt(mt({},u.joinChannelServiceRecords[h.index]),h.record),u.joinChannelServiceRecords=[...u.joinChannelServiceRecords]),u;case gn.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return u.joinChannelServiceRecords=[],u;case gn.RESET_KEY_METRICS:return u.keyMetrics={publish:[],subscribe:[]},u;case gn.SET_USE_P2P:return mt(mt({},u),{},{useP2P:h.val});case gn.SET_TRANSPORT_TYPE:return mt(mt({},u),{},{p2pTransport:h.val});default:return u}}(this.state,c)}set sessionId(c){this.dispatch({type:gn.SET_SESSION_ID,sessionId:c})}get sessionId(){return this.state.sessionId}set cid(c){this.state.cid=c}get cid(){return this.state.cid}set codec(c){this.state.codec=c}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(c){this.dispatch({type:gn.SET_P2P_ID,p2pId:c})}get p2pId(){return this.state.p2pId}set dcId(c){this.dispatch({type:gn.SET_DC_ID,dcId:c})}get dcId(){return this.state.dcId}set uid(c){this.dispatch({type:gn.SET_UID,uid:c})}get uid(){return this.state.uid}set intUid(c){this.dispatch({type:gn.SET_INT_UID,intUid:c})}get intUid(){return this.state.intUid}set pubId(c){this.dispatch({type:gn.SET_PUB_ID,pubId:c})}get pubId(){return this.state.pubId}set cloudProxyServerMode(c){this.dispatch({type:gn.SET_CLOUD_PROXY_SERVER_MODE,mode:c})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(c){this.dispatch({type:gn.SET_USE_P2P,val:c})}get useP2P(){return this.state.useP2P}set p2pTransport(c){this.dispatch({type:gn.SET_TRANSPORT_TYPE,val:c})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(c){this.state.hasStartJoinChannel=c}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(c){this.state.isABTestSuccess=c}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:gn.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:gn.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:gn.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:gn.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:gn.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:gn.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:gn.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:gn.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:gn.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:gn.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:gn.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:gn.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(c,u,h,m){this.dispatch({type:gn.KEY_METRIC_PUBLISH,metric:mt(mt({trackId:c,type:u},h&&{publishStart:h}),m&&{publishEnd:m})})}subscribe(c,u,h,m,_,y,S){this.dispatch({type:gn.KEY_METRIC_SUBSCRIBE,metric:mt(mt(mt(mt(mt({userId:c,type:u},h&&{subscribeStart:h}),m&&{subscribeEnd:m}),_&&{firstFrame:_}),y&&{streamAdded:y}),S&&{firstDecoded:S})})}massSubscribe(c,u,h,m){c.forEach(_=>{this.dispatch({type:gn.KEY_METRIC_SUBSCRIBE,metric:mt(mt(mt({userId:_.userId,type:_.type},u&&{subscribeStart:u}),h&&{subscribeEnd:h}),m&&{firstFrame:m})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(c,u){c.service==="gateway"&&Array.isArray(c.urls)&&(c.urls=c.urls.map(h=>h.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof u!="number"?(this.dispatch({type:gn.RECORD_JOIN_CHANNEL_SERVICE,record:mt(mt({},c),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(u<0||u>=this.state.joinChannelServiceRecords.length||this.dispatch({type:gn.RECORD_JOIN_CHANNEL_SERVICE,record:c,index:u}),u)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:gn.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:gn.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(c){this.dispatch({type:gn.AVOID_JOIN_START,avoidJoinStart:c})}}(e.codec,e.audioCodec,e.mode,this._clientId),this._leaveMutex=new Oo("client-leave",this._clientId),this._publishMutex=new Oo("client-publish",this._clientId),this._renewTokenMutex=new Oo("client-renewtoken",this._clientId),this._subscribeMutex=new Oo("client-subscribe",this._clientId),this.store.clientCreated(),e.proxyServer&&this.setProxyServer(e.proxyServer,!0),e.turnServer&&this.setTurnServer(e.turnServer,!0),D.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(gl," build: ").concat(ix,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),e.clientRoleOptions)try{HL(e.clientRoleOptions),o=Object.assign({},e.clientRoleOptions)}catch(c){D.warning("[".concat(this._clientId,"] ").concat(c.toString()))}var s;this._statsCollector=new OT(this.store),this._statsCollector.onStatsException=(c,u,h)=>{D.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(c,", msg: ").concat(u,", uid: ").concat(h)),this.safeEmit(mn.EXCEPTION,{code:c,msg:u,uid:h})},this._statsCollector.onUploadPublishDuration=(c,u,h,m)=>{const _=this._users.find(y=>y.uid===c);_&&wt.peerPublishStatus(this._sessionId,{subscribeElapse:m,audioPublishDuration:u,videoPublishDuration:h,peer:_._uintid})},this.store.useP2P=e.mode==="p2p",this._gateway=new ame(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:e.websocketRetryConfig||Ei,httpRetryConfig:e.httpRetryConfig||Ei,forceWaitGatewayResponse:e.forceWaitGatewayResponse===void 0||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role,clientRoleOptions:o}),this._configDistribute=new _me(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(s={store:this.store,statsCollector:this._statsCollector},Jf("P2PChannel").create(s)),this._handleP2PEvents()):this._p2pChannel=new NT(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(e,r,o,s,c){let u=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],h=arguments.length>6&&arguments[6]!==void 0&&arguments[6];Xn("JOIN_GATEWAY_USE_443PORT_ONLY",u),Xn("JOIN_GATEWAY_USE_DUAL_DOMAIN",h);const m=this._gateway.signal.websocket;return m instanceof Ux&&(m.use443PortOnly=u,m.tryDoubleDomain=h),async function(_,y,S){IA.get(_)||IA.set(_,[]),AA.get(_)||AA.set(_,y),hh.get(_)||hh.set(_,0);const R=IA.get(_),P=AA.get(_);if(!R||!P)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(hh.get(_)===P){const q=aT();R.push(q),await q.promise}hh.set(_,hh.get(_)+1);for(var k=arguments.length,z=new Array(k>3?k-3:0),U=3;U<k;U++)z[U-3]=arguments[U];const V=await S(...z);return hh.set(_,hh.get(_)-1),hh.get(_)===P-1&&R.length>0&&(R[0].resolve(),R.shift()),hh.get(_)===0&&(IA.set(_,[]),AA.set(_,0),hh.set(_,0)),V}("client.join",re("JOIN_MAX_CONCURRENCY"),this.join.bind(this),e,r,o,s,c)}async join(e,r,o,s,c){const u=++this._numberOfJoinCount;this.store.joinStart(),s&&(this.store.uid=s);const h=(xA||xA||(xA=(window.location.protocol.split(":")[0]||"").toUpperCase(),xA))==="HTTPS",m=s8()?window.isSecureContext:"Browser Not Support";(!s8()&&!h||!window.isSecureContext)&&D.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser"),this.connectionState==="DISCONNECTED"&&(this.store.avoidJoinStart=Math.round(Date.now()),D.debug("[".concat(this._clientId,"] set avoidJoinStart to ").concat(this.store.avoidJoinStart))),wt.setAppId(e);try{if(!o&&o!==null)throw new Oe(X.INVALID_PARAMS,"Invalid token: ".concat(o,". If you don not use token, set it to null"));o&&ro(o,"token",1,2047),ro(e,"appid",1,2047),rP(r),s&&iP(s),c&&ro(c,"optionalInfo",1,2047)}catch(U){throw wt.reportApiInvoke(A_(),{name:_i.JOIN,options:[e,r,o,s],states:{isHttps:h,isSecureContext:m},tag:xr.TRACER}).onError(U),U}if(this._leaveMutex.isLocked&&(D.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),D.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const U=new Oe(X.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw wt.reportApiInvoke(A_(),{name:_i.JOIN,options:[e,r,o,s],states:{isHttps:h,isSecureContext:m},tag:xr.TRACER}).onError(U),U}this._gateway.state="CONNECTING";const _=await o9({appId:e,cname:r,uid:s,stringUid:typeof s=="string"?s:void 0,token:o||e,cloudProxyServer:this._cloudProxyServerMode});if(!this._joinAndNotLeaveYet)throw new Oe(X.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));const y=(_==null?void 0:_.sid)||A_();D.info("[".concat(this._clientId,"] start join channel ").concat(r,", join number: ").concat(u)),this._sessionId||(this._sessionId=y,this.store.sessionId=this._sessionId);const S=wt.reportApiInvoke(y,{id:this._clientId,name:_i.JOIN,options:[e,r,o,s],states:{isHttps:h,isSecureContext:m},tag:xr.TRACER}),R=mu(mu(mu({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:e,sid:this._sessionId,cname:r,uid:typeof s!="string"?s:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:o||e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:c,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!_},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:re("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(R.setLocalAPVersion=this._setLocalAPVersion),typeof s=="string"&&(R.stringUid=s,this._uintUid?(R.uid=this._uintUid,this._uintUid=void 0):R.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(R.aesmode=this._encryptionMode,R.aespassword=await(async U=>{const V=function(_e){const Ee=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),me=new Uint8Array(new ArrayBuffer(Ee.length));for(let ke=0;ke<Ee.length;ke+=1)me[ke]=Ee.charCodeAt(ke);return me}(),q=await window.crypto.subtle.importKey("spki",V,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),Y=zL(U),ce=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},q,Y);return function(_e){let Ee="";for(let me=0;me<_e.length;me+=1)Ee+=String.fromCharCode(_e[me]);return window.btoa(Ee)}(new Uint8Array(ce))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new Oe(X.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(R.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const U=new TextEncoder,V=re("USE_PURE_ENCRYPTION_MASTER_KEY")?U.encode(R.appId+this._encryptionSecret+this._encryptionSecret):U.encode(R.appId+R.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(q,Y,ce){const _e=await window.crypto.subtle.importKey("raw",Y,"PBKDF2",!1,["deriveBits","deriveKey"]),Ee=q==="aes-128-gcm2"?128:256,me=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:g8,hash:"SHA-256",salt:ce},_e,Ee+Ufe);return new Uint8Array(me).subarray(Ee/8)}(this._encryptionMode,V,I_(this._encryptionSalt)),this._encryptDataStreamKey=await async function(q,Y,ce){const _e=await window.crypto.subtle.importKey("raw",Y,"PBKDF2",!1,["deriveBits","deriveKey"]),Ee=q==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:g8,hash:"SHA-256",salt:ce},_e,{name:"AES-GCM",length:Ee},!0,["encrypt","decrypt"])}(this._encryptionMode,V,I_(this._encryptionSalt))}else m?D.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):D.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,D.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:r,appId:e,stringUid:R.stringUid});const P=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&P===this._sessionId&&wt.joinChannelTimeout(this._sessionId,5)},5e3);try{var k;let U;const V=R.cloudProxyServer;if(st(k=["proxy3","proxy4","proxy5"]).call(k,V)){const Ee=re("PROXY_SERVER_TYPE3");Array.isArray(Ee)?R.proxyServer=Ee[0]:R.proxyServer=Ee}if(wt.setProxyServer(R.proxyServer),D.setProxyServer(R.proxyServer),this.store.requestAPStart(),_){if(D.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(R.stringUid?", ".concat(R.stringUid," => ").concat(_.intUid):""," ")),R.stringUid&&!R.uid&&(R.uid=_.intUid),U={gatewayInfo:_.ap.gatewayInfo},re("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&R.turnServer.mode==="auto")if(_.ap.proxyInfo.addresses.length===0)D.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const Ee=(await JG(_.ap.proxyInfo,_.ap.gatewayInfo.uid)).map(me=>({turnServerURL:me.address,tcpport:me.tcpport||To.tcpport,udpport:me.udpport||To.udpport,username:me.username||To.username,password:me.password||To.password,forceturn:!1,security:!0}));R.turnServer={mode:"manual",servers:Ee}}c9(_,R.stringUid)}else{if(R.stringUid&&!R.uid){let Ee;[Ee,U]=await lt.all([RH(R.stringUid,R,this._axiosCancelSource.token,this._config.httpRetryConfig||Ei,this.store),wH(R,this._axiosCancelSource.token,this._config.httpRetryConfig||Ei,!0,this.store)]),D.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(R.stringUid," => ").concat(Ee)),R.uid=Ee,U.gatewayInfo.uid=Ee,U.gatewayInfo.res.uid=Ee}else U=await wH(R,this._axiosCancelSource.token,this._config.httpRetryConfig||Ei,!0,this.store);if(!this._joinAndNotLeaveYet)throw new Oe(X.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(R,this._axiosCancelSource.token),this._configDistribute.on(ST.UPDATE_BITRATE_LIMIT,Ee=>{this._p2pChannel.updateBitrateLimit(Ee)}),this._configDistribute.on(ST.UPDATE_CLIENT_ROLE_OPTIONS,Ee=>{this._setClientRoleOptions(Ee)})},0),this._key=o||e;const q=U.gatewayInfo,Y=R.uid?R.uid:q.uid;this._joinInfo=mu(mu({},R),{},{cid:q.cid,uid:Y,vid:q.vid,apResponse:q.res,apGatewayAddress:q.apGatewayAddress,uni_lbs_ip:q.uni_lbs_ip,gatewayAddrs:q.gatewayAddrs}),this.store.intUid=Y,this.store.cid=q.cid;const ce=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new Oe(X.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));S.onSuccess(ce),this._appId=e,this._channelName=R.cname,this._uid=ce,this.store.uid=ce,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(vo()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);const _e=R.stringUid?"string uid: ".concat(R.stringUid,",uid: ").concat(R.uid):"uid: ".concat(this._uid);return D.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(r,",").concat(_e)),setTimeout(()=>{D.startUpload()},5e3),this.store.joinEnd(),z=this,st(x_).call(x_,z)||x_.push(z),this._cloudProxyServerMode==="disabled"&&kn().supportWebCrypto&&re("ENABLE_PRELOAD")&&uM(this._joinInfo),ce}catch(U){const V=Array.isArray(U)?U[0]:U;throw V&&V.code===X.OPERATION_ABORTED?D.warning("[".concat(this._clientId,"] join number: ").concat(u,", Joining channel failed, rollback"),V):D.error("[".concat(this._clientId,"] join number: ").concat(u,", Joining channel failed, rollback"),V),V.code!==X.OPERATION_ABORTED&&this._numberOfJoinCount===u&&(this._gateway.state="DISCONNECTED",this._reset()),S.onError(V),V}var z}_joinGateway(){if(!this._joinInfo||!this._key)throw new Oe(X.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!re("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){D.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(vo()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(r){const o=x_.indexOf(r);o!==-1&&x_.splice(o,1)}(this),this._statsCollector.stopUpdateStats();const e=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return D.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void e();await this._gateway.leave(this.connectionState!=="CONNECTED",jn.LEAVE),D.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),e()}async publish(e){let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(e)){if(!(e instanceof Mv))return this._publishDataChannel(e);e=[e]}if(e.length===0)throw new Oe(X.INVALID_PARAMS,"param list is empty");const o=e;if(this._gateway.role==="audience")throw new Oe(X.INVALID_OPERATION,"audience can not publish stream");for(const c of o){if(!(c instanceof Mv))throw new Oe(X.INVALID_PARAMS,"parameter is not local track");if(!c._enabled&&r)throw new Oe(X.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(c.getTrackId()))}D.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(o.map(c=>"".concat(c.getTrackId()," "))));const s=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),r&&o.forEach(c=>{const u=this._configDistribute.getBitrateLimit();c instanceof mr&&u&&c.setBitrateLimit(u.uplink)});try{await this._publishHighStream(o),D.info("[".concat(this._clientId,"] Publish success, id ").concat(o.map(c=>"".concat(c.getTrackId()," "))))}catch(c){throw D.error("[".concat(this._clientId,"] publish error"),c.toString()),c}finally{s()}}async _publishDataChannel(e){er(e.id,"id",0,65535,!0),Gf(e.ordered,"ordered"),ro(e.metadata,"metadata",0,512),D.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(e.id));const r=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(c=>c.id===e.id)!==-1)throw new Oe(X.INVALID_PARAMS,"Invalid id: ".concat(e.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new Oe(X.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&re("FORCE_TURN")&&!re("TURN_ENABLE_TCP")&&!re("TURN_ENABLE_UDP"))throw new Oe(X.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const o=function(c){return mH(c,!1)}(e),s=await this._p2pChannel.publishDataChannel([o]);if(s.length>0){if(typeof o._originDataChannelId!="number")throw D.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new Oe(X.CREATE_DATACHANNEL_ERROR);try{await lt.all(s.map(c=>this._uid&&this._gateway.publishDataChannel(this._uid,c,!0))),await o._waitTillOpen()}catch(c){if(c.code!==X.DISCONNECT_P2P)throw c}}return D.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(o.id)),o}catch(o){throw D.error("[".concat(this._clientId,"] publish datachannels error"),o.toString()),o}finally{r()}}async unpublish(e){if(!this._joinInfo||this._uid===void 0)throw new Oe(X.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let r=[];if(e)if(Array.isArray(e))r=e;else{if(!(e instanceof Mv))return this._unpublishDataChannel([e]);r=[e]}else this.store.useP2P||await this._unpublishDataChannel(),r=this._p2pChannel.getAllTracks(!0);D.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(r.map(s=>"".concat(s.getTrackId()," "))," "));const o=await this._publishMutex.lock();try{if(this.store.useP2P){const s=await this._p2pChannel.unpublish(r);s&&await this._gateway.sendExtensionMessage(Qr.UNPUBLISH,{unpubMsg:s},!0)}else{const s=await this._p2pChannel.unpublish(r);s&&await this._gateway.unpublish(s,this._uid),D.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(r.map(c=>"".concat(c.getTrackId()))))}}catch(s){throw D.error("[".concat(this._clientId,"] unpublish error"),s.toString()),s}finally{o&&o()}}async _unpublishDataChannel(e){e!==void 0&&e.length!==0||(e=this._p2pChannel.getAllDataChannels()),D.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(e.map(o=>"".concat(o.id," "))," "));const r=await this._publishMutex.lock();try{const o=await this._p2pChannel.unpublishDataChannel(e);o&&await this._gateway.unpublishDataChannel(o),D.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(e.map(s=>"".concat(s.id))))}catch(o){throw D.error("[".concat(this._clientId,"] unpublish dataChannel error"),o.toString()),o}finally{r&&r()}}async subscribe(e,r,o){if(!(e instanceof Lm)){const s=this.remoteUsers.find(c=>c.uid===e);if(!s)throw new Oe(X.INVALID_REMOTE_USER,"user is not in the channel");e=s}return r==="datachannel"?this._subscribeDataChannel(e,o):this._subscribe(e,r)}async presubscribe(e,r){if(ki(r,"mediaType",["audio","video"]),this.store.useP2P)throw new Oe(X.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new Oe(X.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const o=r===gt.AUDIO,s=r===gt.VIDEO,c=await this._subscribeMutex.lock();try{const{ssrcId:u,ortc:h,rtxSsrcId:m,cname:_,uint_id:y}=await this._gateway.presubscribe(e,r,!0);if(u==null)throw new Oe(X.UNEXPECTED_RESPONSE,"no ssrc id");let S=this._users.find(P=>P.uid===e);S||(S=new Lm(e,y||e),S._is_pre_created=!0,this._users.push(S)),_&&(S._cname=_),S._uintid||(S._uintid=y||e),o&&(S._audioSSRC=u,S._audio_pre_subscribed=!0,h&&(S._audioOrtc=h)),s&&(S._videoSSRC=u,S._video_pre_subscribed=!0,h&&(S._videoOrtc=h),m!=null&&(S._rtxSsrcId=m)),D.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(u)),await this._p2pChannel.subscribe(S,r,u,m,h);const R=o?S._audioTrack:S._videoTrack;if(!R)throw new Oe(X.UNEXPECTED_ERROR,"can not find remote track in user");return o&&(S._trust_audio_stream_added_state_=!0,S._audio_added_=!0),s&&(S._trust_video_stream_added_state_=!0,S._video_added_=!0),R}catch(u){throw D.error("[".concat(this._clientId,"] presub user ").concat(e," error"),u),u}finally{c()}}async _subscribeDataChannel(e,r){var o;if(er(r,"channelId",0,65535,!0),!this._joinInfo)throw new Oe(X.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(m=>m===e))throw D.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),new Oe(X.INVALID_REMOTE_USER,"user is not in the channel");if(!e.hasAudio&&!e.hasVideo&&e._dataChannels.length===0)throw D.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),new Oe(X.INVALID_REMOTE_USER,"user is not published");const c=(o=e._dataChannels)===null||o===void 0?void 0:o.find(m=>m.id===r);if(!c)throw D.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, remote datachannel is not published")),new Oe(X.REMOTE_USER_IS_NOT_PUBLISHED);const u=await this._subscribeMutex.lock();D.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: datachannel"));try{const m=await this._p2pChannel.subscribeDataChannel(e,[c]);if(m&&st(m).call(m,c.id))try{var h;if(typeof c._originDataChannelId!="number")throw D.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, cannot get RTCDatachannel")),new Oe(X.CREATE_DATACHANNEL_ERROR);const _={id:c.id,datachannelId:c._originDataChannelId,ordered:c.ordered,maxRetransmits:c.maxRetransmits,metadata:(h=c.metadata)!==null&&h!==void 0?h:""};await this._gateway.subscribeDataChannel(e.uid,_,!0),await c._waitTillOpen()}catch(_){if((_==null?void 0:_.code)!==X.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(e,[c]),_;await this._p2pChannel.unsubscribeDataChannel(e,[c]),this._p2pChannel.setPendingRemoteDataChannel(e,c.id)}return D.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: datachannel")),c}finally{u()}}async _p2pSubscribe(e,r,o){if(ki(r,"mediaType",["audio","video"]),!this._joinInfo)throw new Oe(X.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(u=>u===e)){const u=new Oe(X.INVALID_REMOTE_USER,"user is not in the channel");throw D.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),u}if(!e.hasAudio&&!e.hasVideo){const u=new Oe(X.INVALID_REMOTE_USER,"user is not published");throw D.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),u}if(!o&&(r==="audio"&&!e.hasAudio||r==="video"&&!e.hasVideo)){const u=new Oe(X.REMOTE_USER_IS_NOT_PUBLISHED);throw D.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(r,", remote track is not published")),u}const c=await this._subscribeMutex.lock();D.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(r));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,r))await this._p2pChannel.unmuteRemote(e,r);else try{const h=r==="audio"?e._audioSSRC:e._videoSSRC,m=r==="audio"?e._audioMid:e._videoMid;this.store.subscribe(e.uid,r,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(e,r,h,m)}catch(h){throw h}D.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(r)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(h=>{D.warning("[".concat(this._clientId,"] auto set fallback failed"),h)});const u=r==="audio"?e._audioTrack:e._videoTrack;if(!u)throw new Oe(X.UNEXPECTED_ERROR,"can not find remote track in user object");return u}catch(u){throw D.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),u),u}finally{c()}}async _subscribe(e,r,o){if(this.store.useP2P)return this._p2pSubscribe(e,r);if(ki(r,"mediaType",["audio","video"]),!this._joinInfo)throw new Oe(X.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(y=>y===e)){const y=new Oe(X.INVALID_REMOTE_USER,"user is not in the channel");throw D.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),y}if(!e.hasAudio&&!e.hasVideo){const y=new Oe(X.INVALID_REMOTE_USER,"user is not published");throw D.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),y}if(!(o||(r!=="audio"||e.hasAudio&&e._audioSSRC!==void 0)&&(r!=="video"||e.hasVideo&&e._videoSSRC!==void 0))){const y=new Oe(X.REMOTE_USER_IS_NOT_PUBLISHED);throw D.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(r,", remote track is not published")),y}let c=r==="audio"?e._audioSSRC:e._videoSSRC,u=r==="audio"?e._audioOrtc:e._videoOrtc,h=r==="video"?e._rtxSsrcId:void 0,m={stream_type:r==="audio"?gt.AUDIO:gt.VIDEO,ssrcId:c};const _=await this._subscribeMutex.lock();D.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(r));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,r))await this._p2pChannel.unmuteRemote(e,r);else try{const S=r==="audio"?e._audioSSRC:e._videoSSRC;S!==void 0&&S!==c&&(c=S,u=r==="audio"?e._audioOrtc:e._videoOrtc,h=r==="video"?e._rtxSsrcId:void 0,m={stream_type:r==="audio"?gt.AUDIO:gt.VIDEO,ssrcId:c}),Do.markSubscribeStart(this.store.clientId,c),this.store.subscribe(e.uid,r,Date.now()),await this._p2pChannel.subscribe(e,r,c,h,u);try{this._p2pChannel.isPreSubScribe(c)||await this._gateway.subscribe(e.uid,m,!0)}catch(R){if((R==null?void 0:R.code)!==X.WS_ABORT)throw await this._p2pChannel.unsubscribe(e,r),R;await this._p2pChannel.unsubscribe(e,r,!0),this._p2pChannel.setPendingRemoteMedia(e,r)}this.store.subscribe(e.uid,r,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,e,r)}catch(S){throw this._p2pChannel.reportSubscribeEvent(!1,S==null?void 0:S.code,e,r),S}D.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(r)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(S=>{D.warning("[".concat(this._clientId,"] auto set fallback failed"),S)});const y=r==="audio"?e._audioTrack:e._videoTrack;if(!y)throw new Oe(X.UNEXPECTED_ERROR,"can not find remote track in user object");return y}catch(y){throw D.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),y),y}finally{_()}}async massSubscribe(e){if(Hf(e,"subscribeList"),!this._joinInfo)throw new Oe(X.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const r=Date.now(),o=new Map,s=await this._subscribeMutex.lock();D.info("[".concat(this._clientId,"]start massSubscribe user ").concat(e.map(m=>{let{user:_,mediaType:y}=m;return"user: ".concat(_==null?void 0:_.uid,", mediaType: ").concat(y)}).join("; ")));const c=(e=[...e]).map(m=>{let{user:_,mediaType:y}=m;return{user:_,mediaType:y}}),u=await this._p2pChannel.globalLock();try{var h;for(let _=e.length-1;_>=0;_--){const y=e[_],{user:S,mediaType:R}=y;if(ki(R,"mediaType",["audio","video"]),!S){const U=new Oe(X.INVALID_PARAMS,"user property does not exist in subscribeList item");throw D.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),U}if(!this._users.find(U=>U===S)){const U=new Oe(X.INVALID_REMOTE_USER,"user is not in the channel");D.error("[".concat(this._clientId,"] can not massSubscribe ").concat(S.uid,", this user is not in the channel")),c[_].error=U,e.splice(_,1);continue}if(R==="audio"&&(!S.hasAudio||S._audioSSRC===void 0)||R==="video"&&(!S.hasVideo||S._videoSSRC===void 0)){const U=new Oe(X.REMOTE_USER_IS_NOT_PUBLISHED);D.error("[".concat(this._clientId,"] can not subscribe ").concat(S.uid," with mediaType ").concat(R,", remote user is not published")),c[_].error=U,e.splice(_,1);continue}const k=Bi.Video|Bi.LwoVideo,z=o.get(S);if(z){if(R==="video"?z&k:z&Bi.Audio){e.splice(_,1),D.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(S.uid,", mediaType:").concat(R," twice"));continue}o.set(S,z|(R==="video"?k:Bi.Audio))}else o.set(S,R==="video"?k:Bi.Audio)}for(let _=e.length-1;_>=0;_--){const y=e[_],{user:S,mediaType:R}=y,P=Bi.Video|Bi.LwoVideo;if(this._p2pChannel.hasRemoteMedia(S,R)){await this._p2pChannel.unmuteRemoteNoLock(S,R);const k=o.get(S);o.set(S,R==="video"?k^P:k^Bi.Audio),e.splice(_,1)}}this.store.massSubscribe(e.map(_=>({userId:_.user.uid,type:_.mediaType})),r);let m=qa(h=Array.from(o.entries())).call(h,(_,y)=>{let[S,R]=y;if(R===0)return _;const P={stream_id:S.uid,stream_type:R};return R&Bi.Audio&&(P.audio_ssrc=S._audioSSRC),R&Bi.Video&&(P.video_ssrc=S._videoSSRC),_.push(P),_},[]);try{e.length>0&&await this._p2pChannel.massSubscribeNoLock(e.map(y=>{let{user:S,mediaType:R}=y;return{user:S,mediaType:R,ssrcId:R===gt.VIDEO?S._videoSSRC:S._audioSSRC,rtxSsrcId:R===gt.VIDEO?S._rtxSsrcId:void 0}}));const _=new Map;if(m=m.filter(y=>y.video_ssrc&&!this._p2pChannel.isPreSubScribe(y.video_ssrc)||y.audio_ssrc&&!this._p2pChannel.isPreSubScribe(y.audio_ssrc)||!y.video_ssrc&&!y.audio_ssrc),m.length>0){const y=await this._gateway.subscribeAll(m,!0);((y==null?void 0:y.users)||[]).forEach(S=>{let{stream_id:R,video_error_code:P,audio_error_code:k,error_code:z}=S;(P||k||z)&&_.set(R,{video_error_code:P,audio_error_code:k,error_code:z})})}if(Array.from(_.entries()).length>0){const y=[];Array.from(_.entries()).forEach(S=>{let[R,P]=S;const k=this.remoteUsers.find(z=>z.uid===R);if(k){let z;P.error_code||P.video_error_code&&P.audio_error_code?z=void 0:P.video_error_code?z=gt.VIDEO:P.audio_error_code&&(z=gt.AUDIO),y.push({user:k,mediaType:z})}}),y.length>0&&await this._p2pChannel.massUnsubscribeNoLock(y)}for(const y of c){const S=_.get(y.user.uid);if(S){const R=S.error_code||y.mediaType==="audio"&&S.audio_error_code||y.mediaType==="video"&&S.video_error_code;if(R){const P=bT(R);D.error("user:".concat(y.user.uid," mediaType:").concat(y.mediaType," has massSubscribe error ").concat(P.desc)),y.error=new Oe(X.SUBSCRIBE_FAILED,"code ".concat(R,": ").concat(P.desc))}}y.error||(y.mediaType==="video"?y.track=y.user.videoTrack:y.track=y.user.audioTrack)}return this.store.massSubscribe(c.filter(y=>!y.error).map(y=>({userId:y.user.uid,type:y.mediaType})),void 0,Date.now()),c.forEach(y=>{var S;wt.subscribe(this.store.sessionId,{succ:!!y.error,ec:((S=y.error)===null||S===void 0?void 0:S.code)||null,video:y.mediaType===gt.VIDEO,audio:y.mediaType===gt.AUDIO,peerid:y.user.uid,subscribeRequestid:y.mediaType===gt.VIDEO?y.user._videoSSRC:y.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-r),preSsrc:this._p2pChannel.isPreSubScribe(y.user._videoSSRC)},!0)}),D.info("[".concat(this._clientId,"] massSubscribe success ").concat(e.map(y=>{let{user:S,mediaType:R}=y;return"user: ".concat(S==null?void 0:S.uid,", mediaType: ").concat(R)}).join("; "))),c}catch(_){throw await this._p2pChannel.massUnsubscribeNoLock(e),_}}finally{u(),s()}}async unsubscribe(e,r,o){if(!(e instanceof Lm)){const u=this.remoteUsers.find(h=>h.uid===e);if(!u)throw new Oe(X.INVALID_REMOTE_USER,"user is not in the channel");e=u}if(r||this.store.useP2P){if(r==="datachannel")return this._unsubscribeDataChannel(e,o)}else await this._unsubscribeDataChannel(e,o);if(r&&ki(r,"mediaType",["audio","video"]),!this._joinInfo)throw new Oe(X.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(u=>u===e)){const u=new Oe(X.INVALID_REMOTE_USER,"user is not in the channel");throw D.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),u}D.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: ").concat(r));const c=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(e,r);else{const u=await this._p2pChannel.unsubscribe(e,r);u&&await this._gateway.unsubscribe(u,e.uid),r&&r!=="audio"||(e._audio_pre_subscribed=!1),r&&r!=="video"||(e._video_pre_subscribed=!1),e._is_pre_created&&NA(this._users,e),D.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(e.uid,", mediaType: ").concat(r))}}catch(u){if(u.code===X.DISCONNECT_P2P)return void D.warning("disconnecting p2p, abort unsubscribe request.");throw D.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),u.toString()),u}finally{c()}}async _unsubscribeDataChannel(e,r){if(r&&er(r,"id",0,65535,!0),!this._joinInfo)throw new Oe(X.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(c=>c===e)){const c=new Oe(X.INVALID_REMOTE_USER,"user is not in the channel");throw D.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),c}let s;if(typeof r=="number"){const c=e._dataChannels.find(u=>u.id===r);c&&(s=[c])}else s=e._dataChannels;if(s===void 0){const c=new Oe(X.REMOTE_USER_IS_NOT_PUBLISHED);throw D.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid," with channelId ").concat(r,", remote datachannel is not published")),c}D.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(s.map(c=>c.id)));try{const c=await this._p2pChannel.unsubscribeDataChannel(e,s);c&&await this._gateway.unsubscribeDataChannel(c,e.uid),D.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(c))}catch(c){if(c.code===X.DISCONNECT_P2P)return void D.warning("disconnecting p2p, abort unsubscribe request.");throw D.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),c.toString()),c}}async massUnsubscribe(e){if(Hf(e,"unsubscribeList"),!this._joinInfo)throw new Oe(X.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");D.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(e.map(o=>{let{user:s,mediaType:c}=o;return"user: ".concat(s==null?void 0:s.uid,", mediaType: ").concat(c,";")}).join())),e=[...e];const r=new Map;for(let o=e.length-1;o>=0;o--){const{user:s,mediaType:c}=e[o];if(!s){const m=new Oe(X.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw D.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),m}if(ki(c,"mediaType",["video","audio",void 0]),!this._users.find(m=>m===s)){D.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(s.uid,", user is not in the channel")),e.splice(o,1);continue}const h=Bi.Video|Bi.LwoVideo;if(r.has(s)){const m=r.get(s);let _;switch(c){case"video":_=m&h;break;case"audio":_=m&Bi.Audio;break;default:_=m&(Bi.Audio|h)}if(_){D.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(s.uid,",mediaType:").concat(c," twice.")),e.splice(o,1);continue}c?c==="audio"?r.set(s,m|Bi.Audio):c==="video"&&r.set(s,m|h):r.set(s,m|Bi.Audio|h)}else c?c==="audio"?r.set(s,Bi.Audio):c==="video"&&r.set(s,h):r.set(s,Bi.Audio|h)}try{const o=await this._p2pChannel.massUnsubscribe(e);o&&await this._gateway.massUnsubscribe(o),D.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(e.map(s=>{let{user:c,mediaType:u}=s;return"user: ".concat(c==null?void 0:c.uid,", mediaType: ").concat(u,";")}).join()))}catch(o){if(o.code===X.DISCONNECT_P2P)return void D.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw D.error("[".concat(this._clientId,"] massUnsubscribe error"),o.toString()),o}}async setLowStreamParameter(e){(function(o){if(!o)throw new Le(X.INVALID_PARAMS);Lr(o.width)||BL(o.width,"streamParameter.width"),Lr(o.height)||BL(o.height,"streamParameter.height"),Lr(o.framerate)||BL(o.framerate,"streamParameter.framerate"),Lr(o.bitrate)||er(o.bitrate,"streamParameter.bitrate")})(e),(!e.width&&e.height||e.width&&!e.height)&&D.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),D.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(e));const r=this._configDistribute.getLowStreamConfigDistribute();if(r&&r.bitrate&&e.bitrate&&r.bitrate<e.bitrate&&(e.bitrate=r.bitrate),this._lowStreamParameter=e,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(e,$e.LocalVideoLowTrack)}async enableDualStream(){if(!kn().supportDualStream)throw wt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new Oe(X.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new Oe(X.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(e){throw wt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),e}this._isDualStreamEnabled=!0,wt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),D.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new Oe(X.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia($e.LocalVideoLowTrack))try{const e=await this._p2pChannel.unpublishLowStream();e&&await this._gateway.unpublish(e,this._joinInfo.stringUid||this._joinInfo.uid)}catch(e){throw wt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),e}this._isDualStreamEnabled=!1,wt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),D.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(e,r){if(function(s){ki(s,"role",["audience","host"])}(e),r&&HL(r),this.mode==="rtc"||this.mode==="p2p")throw D.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new Oe(X.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(r&&r.level&&e==="host")throw new Oe(X.INVALID_OPERATION,"host mode can not set audience latency level");if(e==="audience"&&this._p2pChannel.hasLocalMedia())throw new Oe(X.INVALID_OPERATION,"can not set client role to audience when publishing stream");const o=this._config.role;this._joinInfo&&(this._joinInfo.role=e),e!==o&&re("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(e,r),this._config.role=e,this._gateway.reconnect("recover",So.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(e,r),this._config.role=e),D.info("[".concat(this._clientId,"] set client role to ").concat(e,", level: ").concat(r&&r.level))}async _setClientRoleOptions(e){if(this.mode==="rtc"||this.mode==="p2p"||this._config.role!=="audience"||this._p2pChannel.hasLocalMedia())return;let r=!1;try{e&&HL(e),await this._gateway.setClientRole(this._config.role,e),r=!0}catch{}finally{D.info("[".concat(this._clientId,"] set client role options ").concat(r?"succeed":"failed",", options is ").concat(e))}}getRemoteInboundOffset(){var e;const r=(e=this._p2pChannel.getStats())===null||e===void 0?void 0:e.audioSend[0];if(!r||!r.timestamp)return 0;const o=r.timestamp-Date.now();return Math.abs(o)>1e3+r.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?o:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(e,r){if(ro(e,"proxyServer"),!r){if(this.connectionState!=="DISCONNECTED")throw new Oe(X.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new Oe(X.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,wt.setProxyServer(this._proxyServer),D.setProxyServer(this._proxyServer),D.info("[".concat(this._clientId,"] Set proxy server ").concat(r?"by initialize call":""," success."))}setTurnServer(e,r){if(Array.isArray(e)||(e=[e]),!r){if(this.connectionState!=="DISCONNECTED")throw new Oe(X.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new Oe(X.INVALID_OPERATION,"You have already set the proxy")}if(hT(e))return this._turnServer={servers:e,mode:"original-manual"},void D.info("[".concat(this._clientId,"] Set original turnserver ").concat(r?"by initialize call":""," success: ").concat(e.map(o=>o.urls).join(","),"."));e.forEach(o=>qW(o)),this._turnServer={servers:e,mode:"manual"},D.info("[".concat(this._clientId,"] Set turnserver ").concat(r?"by initialize call":""," success."))}setLicense(e){if(this.connectionState!=="DISCONNECTED")throw new Oe(X.INVALID_OPERATION,"you should set license before join channel");if(ro(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new Oe(X.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,D.info("[".concat(this._clientId,"] set license success"),e)}startProxyServer(e){if(this.connectionState!=="DISCONNECTED")throw new Oe(X.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new Oe(X.INVALID_OPERATION,"You have already set the proxy");const r=[3,4,5];let o;switch(e===void 0&&(e=3),e){case 1:case 2:throw new Oe(X.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:o="proxy3";break;case 4:o="proxy4";break;case 5:o="proxy5";break;default:throw new Oe(X.INVALID_PARAMS,"proxy server mode must be ".concat(r.join("|")))}this._cloudProxyServerMode=o,this.store.cloudProxyServerMode=o,D.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new Oe(X.INVALID_OPERATION,"Stop proxy server after leave channel");wt.setProxyServer(),D.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",D.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(e){if(!e.accessPoints)throw new Oe(X.INVALID_PARAMS,"accessPoints is required.");Hf(e.accessPoints.serverList,"accessPoints.serverList"),ro(e.accessPoints.domain,"accessPoints.domain");const r=(P,k)=>{er(P,k,0,65535,!0)};let o=443;if(e.accessPoints.port&&(r(e.accessPoints.port,"accessPoints.port"),o=e.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new Oe(X.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");re("CLOSE_AFB_FOR_LOCAL_AP")&&(Xn("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),Xn("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const s=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,c=e.accessPoints.domain,u=e.accessPoints.serverList.map(P=>s.test(P)?"".concat(P.replace(/\./g,"-"),".").concat(c):P),h=u.map(P=>"".concat(P,":").concat(o));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,Xn("WEBCS_DOMAIN",h),Xn("WEBCS_DOMAIN_BACKUP_LIST",h),Xn("GATEWAY_DOMAINS",[c]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?(Hf(e.report.hostname,"report.hostname"),Xn("EVENT_REPORT_DOMAIN",e.report.hostname[0]),Xn("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):(Xn("EVENT_REPORT_DOMAIN",u[0]),Xn("EVENT_REPORT_BACKUP_DOMAIN",u[1]||u[0]));let m=6443;e.report&&e.report.port&&(r(e.report.port,"report.port"),m=e.report.port),Xn("STATS_COLLECTOR_PORT",m),e.report?Xn("ENABLE_EVENT_REPORT",!0):Xn("ENABLE_EVENT_REPORT",!1);let _="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?(Hf(e.log.hostname,"log.hostname"),_=e.log.hostname[0]):_=u[0];let y=6444;e.log&&e.log.port&&(r(e.log.port,"log.port"),y=e.log.port),Xn("LOG_UPLOAD_SERVER","".concat(_,":").concat(y));let S=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?(Hf(e.cds.hostname,"cds.hostname"),S=e.cds.hostname):S=u;let R=443;e.cds&&e.cds.port&&(r(e.cds.port,"cds.port"),R=e.cds.port),Xn("CDS_AP",S.map(P=>"".concat(P,":").concat(R))),e.cds?Xn("ENABLE_CONFIG_DISTRIBUTE",!0):Xn("ENABLE_CONFIG_DISTRIBUTE",!1),D.info("set local access point v2 success")}setLocalAccessPoints(e,r){if(Hf(e,"serverList"),ro(r,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new Oe(X.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const o=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map(s=>o.test(s)?"".concat(s.replace(/\./g,"-"),".").concat(r):s),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,Xn("WEBCS_DOMAIN",e),Xn("WEBCS_DOMAIN_BACKUP_LIST",e),Xn("GATEWAY_DOMAINS",[r]),Xn("EVENT_REPORT_DOMAIN",e[0]),Xn("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),Xn("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),D.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(e){if(ki(e,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=e,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(e),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(r){throw D.error("[".concat(this._clientId,"] set default remote video stream type error"),r.toString()),r}else D.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(e))}async setRemoteVideoStreamType(e,r){ki(r,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(e,r),setTimeout(()=>{const o=this._users.find(s=>s.uid===e);o&&o.videoTrack&&o.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(o){throw D.error("[".concat(this._clientId,"] set remote video stream type error"),o.toString()),o}D.info("[".concat(this._clientId,"] set remote ").concat(e," video stream type to ").concat(r)),this._remoteStreamTypeCacheMap.set(e,r)}async setStreamFallbackOption(e,r){ki(r,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(e,r)}catch(o){throw D.error("[".concat(this._clientId,"] set stream fallback option"),o.toString()),o}D.info("[".concat(this._clientId,"] set remote ").concat(e," stream fallback type to ").concat(r)),this._streamFallbackTypeCacheMap.set(e,r)}setEncryptionConfig(e,r,o,s){(function(u){ki(u,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(e),ro(r,"secret");const c=["aes-128-gcm2","aes-256-gcm2"];if(st(c).call(c,e)){if(!o||!(o instanceof Uint8Array&&o.length===32))throw new Oe(X.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(o)throw new Oe(X.INVALID_PARAMS,"current encrypt mode does not need salt");if(s){if(Gf(s,"encryptDataStream"),!st(c).call(c,e))throw new Oe(X.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(r)||D.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=e,this._encryptionSecret=r,o&&(this._encryptionSalt=Cm(o))}async renewToken(e){if(ro(e,"token",1,2047),!this._key||!this._joinInfo)throw new Oe(X.INVALID_OPERATION,"renewToken should not be called before user join");const r=this._key;this._key=e,this._joinInfo&&(this._joinInfo.token=e);const o=await this._renewTokenMutex.lock();try{if(re("USE_NEW_TOKEN")){D.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const s=await gme(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Ei);D.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:e,ticket:s})}else D.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:e});D.debug("[".concat(this._clientId,"] renewToken success"))}catch(s){throw this._key=r,this._joinInfo.token=r,D.error("[".concat(this._clientId,"] renewToken failed"),s.toString()),s}finally{o()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?D.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const e=this._p2pChannel.getAudioLevels();this.safeEmit(mn.VOLUME_INDICATOR,e)},re("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const e=this._statsCollector.getRTCStats(),r=this._gateway.getInChannelInfo();return e.Duration=Math.round(r.duration/1e3),e}async startLiveStreaming(e,r){if(!r){if(this.codec!=="h264")throw new Oe(X.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new Oe(X.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e))throw new Oe(X.LIVE_STREAMING_TASK_CONFLICT);const o=r?qf.TRANSCODE:qf.RAW;return this._createLiveStreamingClient(o).startLiveStreamingTask(e,o)}setLiveTranscoding(e){return this._createLiveStreamingClient(qf.TRANSCODE).setTranscodingConfig(e)}async stopLiveStreaming(e){const r=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(o=>o&&o.hasUrl(e));if(!r.length)throw new Oe(X.INVALID_PARAMS,"can not find live streaming url to stop");await lt.all(r.map(o=>o&&o.stopLiveStreamingTask(e)))}async startChannelMediaRelay(e){NH(e),await this._createChannelMediaRelayClient().startChannelMediaRelay(e)}async updateChannelMediaRelay(e){NH(e),await this._createChannelMediaRelayClient().updateChannelMediaRelay(e)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(e){this._p2pChannel instanceof NT&&this._p2pChannel.addAudioMetadata(e)}async sendStreamMessage(e){var r;let o=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new Oe(X.INVALID_OPERATION,"can not send data stream, not joined");if((typeof e=="string"||e instanceof Uint8Array)&&(e={payload:e}),typeof e.payload=="string"){const c=new TextEncoder;e.payload=c.encode(e.payload)}let s=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&st(r=["aes-128-gcm2","aes-256-gcm2"]).call(r,this._encryptionMode)&&(s=!0,e.payload=await async function(c,u,h){var m;const _=qa(m=Array.from(h)).call(m,(U,V)=>U+V,0),y={serverTs:0,seq:Vfe++,length:h.length,checkSum:_},S=new Uint8Array(n8(_,2)),R=new ArrayBuffer(Pv),P=new DataView(R);P.setUint32(0,y.serverTs),P.setUint16(4,y.seq),P.setUint16(6,y.length),P.setUint16(8,y.checkSum);const k=16-h.length%16;h=JW(h,new Uint8Array(k));const z=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:c,tagLength:m8,additionalData:S},u,h);return JW(new Uint8Array(R),new Uint8Array(z))}(this._encryptDataStreamIv,this._encryptDataStreamKey,e.payload)),new Blob([e.payload]).size>1024)throw new Oe(X.INVALID_PARAMS,s?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(jt.DATA_STREAM,{payload:Cm(e.payload),syncWithAudio:e.syncWithAudio,sendTs:Date.now()-Rme},!o)}sendMetadata(e){if(!this._joinInfo)throw new Oe(X.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new Oe(X.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(jt.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:Cm(e)})}async sendCustomReportMessage(e){if(Array.isArray(e)||(e=[e]),e.forEach(Kfe),!this._joinInfo)throw new Oe(X.INVALID_OPERATION,"can not send custom report, not joined");await wt.sendCustomReportMessage(this._joinInfo.sid,e)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(e,r){ki(r.spatialLayer,"spatialLayer",[0,1,2,3]),ki(r.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(e,r)}catch(o){throw D.error("[".concat(this._clientId,"] pick SVC layer failed"),o.toString()),o}}async setRTMConfig(e){const{apRTM:r=!1,rtmFlag:o}=e;if(Gf(r,"apRTM"),er(o,"rtmFlag",0),this._rtmConfig.apRTM=r,this._rtmConfig.rtmFlag=o,D.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(e)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=r,this._joinInfo.rtmFlag=o,this._gateway.setRTM2Flag(o)}_reset(){if(D.debug("[".concat(this._clientId,"] reset client")),function(e){const r=Wv.indexOf(e);r!==-1&&Wv.splice(r,1)}(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this._axiosCancelSource.cancel(),this._axiosCancelSource=Hs.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&a9(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&wt.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(e=>{e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy(),e._dataChannels&&(e._dataChannels.forEach(r=>r._close()),e._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new Oo("client-publish",this._clientId),this._subscribeMutex=new Oo("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(e,r){var o;const s=e||A_();e?D.debug("[".concat(this._clientId,"] new Session ").concat(s)):D.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(s));const c=e?"":this._sessionId||"";this._sessionId=s,this.store.sessionId=s,wt.addSid(s);const u={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:(r==null?void 0:r.stringUid)||((o=this._joinInfo)===null||o===void 0?void 0:o.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:c,clientRole:this.role==="audience"?2:1};wt.sessionInit(this._sessionId,mu({cname:r.channel,appid:r.appId},u)),this._joinInfo&&(this._joinInfo.sid=s),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=s)}async _publishHighStream(e){if(!this._joinInfo||this._uid===void 0)throw new Oe(X.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&re("FORCE_TURN")&&!re("TURN_ENABLE_TCP")&&!re("TURN_ENABLE_UDP"))throw new Oe(X.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");D.debug("[".concat(this._clientId,"] publish high stream"));try{const o=await this._p2pChannel.publish(e,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){const s=(await o.next()).value;if(s){try{await this._gateway.sendExtensionMessage(Qr.PUBLISH,s,!0)}catch(c){throw o.throw(c),c}await o.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const s=(await o.next()).value;if(s){var r;let c;try{c=await this._gateway.publish(this._uid,s,!0)}catch(u){if(u.code!==X.DISCONNECT_P2P)throw o.throw(u),u}await o.next(((r=c)===null||r===void 0?void 0:r.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const c of e)c instanceof mr&&c._encoderConfig&&this._gateway.setVideoProfile(c._encoderConfig).catch(u=>{D.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))}),!c.muted&&c.enabled||await this._p2pChannel.muteLocalTrack(c)}}catch(o){if(this._p2pChannel.reportPublishEvent(!1,o==null?void 0:o.code,e),(o==null?void 0:o.code)===X.WS_ABORT)return;throw o}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new Oe(X.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));D.debug("[".concat(this._clientId,"] publish low stream"));const e=this._configDistribute.getLowStreamConfigDistribute();e&&e.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&e.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=e.bitrate));try{const o=await this._p2pChannel.publishLowStream(this._lowStreamParameter),s=(await o.next()).value;if(s){var r;let c;try{c=await this._gateway.publish(this._uid,s,!0)}catch(u){if(u.code!==X.DISCONNECT_P2P)throw o.throw(u),u}o.next(((r=c)===null||r===void 0?void 0:r.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(o){if(this._p2pChannel.reportPublishEvent(!1,o==null?void 0:o.code,void 0,!0),(o==null?void 0:o.code)===X.WS_ABORT)return;throw o}}_createLiveStreamingClient(e){const r=()=>{if(!this._joinInfo||!this._appId)return new Oe(X.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const o=(s={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},Jf("LiveStreaming").create(s));var s;return o.onLiveStreamError=(c,u)=>{wt.reportApiInvoke(this._sessionId,{name:_i.ON_LIVE_STREAM_ERROR,options:[c,u],tag:xr.TRACER}).onSuccess(),this.safeEmit(mn.LIVE_STREAMING_ERROR,c,u)},o.onLiveStreamWarning=(c,u)=>{wt.reportApiInvoke(this._sessionId,{name:_i.ON_LIVE_STREAM_WARNING,options:[c,u],tag:xr.TRACER}).onSuccess(),this.safeEmit(mn.LIVE_STREAMING_WARNING,c,u)},o.on(xx.REQUEST_WORKER_MANAGER_LIST,(c,u,h)=>{if(!this._joinInfo)return h(new Oe(X.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(m,_,y,S){const R=re("UAP_AP").slice(0,re("AJAX_REQUEST_CONCURRENT")).map(P=>_.proxyServer?"https://".concat(_.proxyServer,"/ap/?url=").concat(P+"/api/v1?action=uap"):"https://".concat(P,"/api/v1?action=uap"));return await ume(R,m,_,y,S)})(c,this._joinInfo,this._axiosCancelSource.token,Ei).then(u).catch(h)}),o};return e===qf.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||r(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||r(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new Oe(X.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:r,sendResolutionHeight:o}=this.getLocalVideoStats(),s=(e={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:r,height:o}},Jf("ChannelMediaRelay").create(e));s.on("state",c=>{c===ba.RELAY_STATE_FAILURE&&s&&s.dispose(),this.safeEmit(mn.CHANNEL_MEDIA_RELAY_STATE,c)}),s.on("event",c=>{this.safeEmit(mn.CHANNEL_MEDIA_RELAY_EVENT,c)}),this._channelMediaRelayClient=s,this._statsCollector.onStatsChanged=(c,u)=>{var h;c==="resolution"&&((h=this._channelMediaRelayClient)===null||h===void 0||h.setVideoProfile(u))}}var e;return this._channelMediaRelayClient}_handleUpdateDataChannel(e,r){const{added:o,deleted:s}=e,c=[];if(r){const u=[];this._users.forEach(h=>{h._dataChannels.forEach(m=>{o.every(_=>_.uid!==h._uintid||_.stream_id!==m.id)&&u.push({uid:h._uintid,stream_id:m.id,ordered:m.ordered,max_retrans_times:m.maxRetransmits,metadata:m.metadata})})}),u.length>0&&this._handleUpdateDataChannel({added:[],deleted:u})}Array.isArray(o)&&o.length>0&&o.forEach(u=>{const{uid:h,stream_id:m,ordered:_,max_retrans_times:y,metadata:S}=u,R=this._users.find(P=>P._uintid===h);if(!R)return void D.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(D.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(h)),st(c).call(c,R)||c.push(R),R._uintid||(R._uintid=h),R._dataChannels.findIndex(P=>P.id===u.stream_id)===-1){const P={id:m,ordered:!!_,maxRetransmits:y,metadata:S},k=function(z){return mH(z,!0)}(P);R._dataChannels.push(k),D.info("[".concat(this._clientId,"] remote user ").concat(R.uid," published datachannel")),r||this.safeEmit(mn.USER_PUBLISHED,R,"datachannel",P)}this._p2pChannel.hasPendingRemoteDataChannel(R,u.stream_id)&&(D.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(R.uid," after reconnect.")),this._subscribeDataChannel(R,u.stream_id).catch(P=>{D.error("[".concat(this._clientId,"] resubscribe datachannel error"),P.toString())}))}),r&&(this.safeEmit(mn.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(s)&&s.length>0&&s.forEach(u=>{const{uid:h,stream_id:m}=u,_=this._users.find(S=>S._uintid===h);if(!_)return void D.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const y=_._dataChannels.find(S=>S.id===u.stream_id);y&&(D.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(h)),this._p2pChannel.unsubscribeDataChannel(_,[y]).then(S=>{if(_._dataChannels=_._dataChannels.filter(R=>R!==y),S)return this._gateway.unsubscribeDataChannel(S,_.uid)}),D.info("[".concat(this._clientId,"] remote user ").concat(h," unpublished datachannel ,id:").concat(y.id)),this.safeEmit(mn.USER_UNPUBLISHED,_,"datachannel",y._config))})}_handleRemoveDataChannels(e){const r=this._users.find(o=>o.uid===e.uid);if(r){if(r._dataChannels!==void 0&&r._dataChannels.length>0){D.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(e.uid));const o=()=>{D.info("[".concat(this._clientId,"] remote user ").concat(r.uid," unpublished datachannel")),r._dataChannels.forEach(s=>{this.safeEmit(mn.USER_UNPUBLISHED,r,"datachannel",s._config)})};this._p2pChannel.unsubscribeDataChannel(r,r._dataChannels).then(s=>{if(s)return this._gateway.unsubscribeDataChannel(s,r.uid)}),o()}}else D.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(Qi.UPDATE_GATEWAY_CONFIG,()=>{(function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(r){return void D.error("Error loading sdk config",r.message)}if(e)try{const r=JSON.parse(window.atob(e)),o=Date.now();Object.keys(r).forEach(s=>{const{value:c,type:u,expires:h}=r[s];h&&h<=o||u||Ax()||!Object.prototype.hasOwnProperty.call(VA,s)||(fd[s]=c,pr[s]=c,D.debug("Update gateway parameters from config distribute",s,c))})}catch(r){D.error("Error update config from local cache",r.message)}})()}),this._gateway.on(Qi.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(Qi.CONNECTION_STATE_CHANGE,(e,r,o)=>{var s;if(o===jn.FALLBACK)return;const c=()=>{this.safeEmit(mn.CONNECTION_STATE_CHANGE,e,r,o)};if(wt.reportApiInvoke(this._sessionId||((s=this._gateway.joinInfo)===null||s===void 0?void 0:s.sid)||null,{name:_i.CONNECTION_STATE_CHANGE,options:[e,r,o],tag:xr.TRACER}).onSuccess(JSON.stringify({cur:e,prev:r,reason:o})),D.info("[".concat(this._clientId,"] signal connection state change: ").concat(r," -> ").concat(e)),e==="DISCONNECTED")return this._reset(),void c();if(e==="RECONNECTING")this._users.forEach(h=>{h._trust_in_room_=!1,h._trust_audio_enabled_state_=!1,h._trust_video_enabled_state_=!1,h._trust_audio_mute_state_=!1,h._trust_video_mute_state_=!1,h._trust_audio_stream_added_state_=!1,h._trust_video_stream_added_state_=!1,h._is_pre_created||(h._audio_pre_subscribed||(h._audioSSRC=void 0,h._audioOrtc=void 0),h._video_pre_subscribed||(h._videoSSRC=void 0,h._videoOrtc=void 0,h._rtxSsrcId=void 0),h._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(e==="CONNECTED"){var u;this._streamFallbackTypeCacheMap.forEach((h,m)=>{this._gateway.setStreamFallbackOption(m,h).catch(_=>{D.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),_)})}),this._remoteStreamTypeCacheMap.forEach((h,m)=>{this._gateway.setRemoteVideoStreamType(m,h).catch(_=>{D.warning("[".concat(this._clientId,"] auto set remote stream type failed"),_)})}),this._remoteDefaultVideoStreamType!==void 0&&((u=this._joinInfo)===null||u===void 0?void 0:u.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{D.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(h=>{D.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(h))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(h=>!h._trust_in_room_).forEach(h=>{D.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(h.uid)),this._handleUserOffline({uid:h.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(h=>{h._trust_audio_mute_state_||(D.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(h.uid)),this._handleMuteStream(h.uid,gt.AUDIO,!1)),h._trust_video_mute_state_||(D.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(h.uid)),this._handleMuteStream(h.uid,gt.VIDEO,!1)),h._trust_audio_enabled_state_||(D.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(h.uid)),this._handleSetStreamLocalEnable("audio",h.uid,!0)),h._trust_video_enabled_state_||(D.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(h.uid)),this._handleSetStreamLocalEnable("video",h.uid,!0)),h._trust_video_stream_added_state_||(D.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(h.uid)),this._handleResetAddStream(h,"video")),h._trust_audio_stream_added_state_||(D.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(h.uid)),this._handleResetAddStream(h,"audio")),h._video_added_||h._audio_added_||(D.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(h.uid)),this._handleRemoveStream({uid:h.uid,uint_id:h._uintid}))}))},1e3))}c()}),this._gateway.on(Qi.REQUEST_NEW_GATEWAY_LIST,async(e,r)=>{if(!this._joinInfo)return r(new Oe(X.UNEXPECTED_ERROR,"can not recover, no join info"));try{let o;const s=await o9(mu(mu({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));s?(o=s.ap,c9(s),this._joinInfo.preload=!0):(o=await Jx(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Ei,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=o.gatewayInfo.res,this._joinInfo.gatewayAddrs=o.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=o.gatewayInfo.uni_lbs_ip);const c=[];o.gatewayInfo.gatewayAddrs.forEach(u=>{let{address:h}=u;const[m,_]=h.split(":");this._joinInfo&&this._joinInfo.proxyServer?c.push({proxy:this._joinInfo.proxyServer,host:m,port:_}):c.push({host:m,port:_})}),e(c)}catch(o){r(o)}}),this._gateway.on(Qi.NETWORK_QUALITY,e=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(mn.NETWORK_QUALITY,e)}),this._gateway.on(Qi.STREAM_TYPE_CHANGE,(e,r)=>{this.safeEmit(mn.STREAM_TYPE_CHANGED,e,r),wt.reportApiInvoke(this._sessionId,{name:_i.STREAM_TYPE_CHANGE,options:[e,r],tag:xr.TRACER}).onSuccess(JSON.stringify({uid:e,streamType:r}))}),this._gateway.on(Qi.IS_P2P_DISCONNECTED,e=>{this._p2pChannel.isP2PDisconnected()?e(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?e(!1):e(!0)}),this._gateway.on(Qi.REQUEST_P2P_CONNECTION_PARAMS,async(e,r,o)=>{try{let s=await this._p2pChannel.getEstablishParams();re("ENABLE_PREALLOC_PC")&&s||(s=await this._p2pChannel.startP2PConnection(e)),r(s)}catch(s){o(s)}}),this._gateway.on(Qi.JOIN_RESPONSE,(e,r)=>{if(this.store.useP2P)return;let o;e.attributes?o=e.attributes.userAttributes.preSubSsrcs:D.debug("no attributes in joinResponse");const s=rH(e.ortc,r,o);this._p2pChannel.connect(s)}),this._gateway.on(Qi.PRE_CONNECT_PC,async e=>{const{candidates:r,fingerprint:o}=e;if(this._joinInfo&&r.length>0&&!this._p2pChannel.isPlanB){var s;await this._p2pChannel.startP2PConnection({turnServer:this._joinInfo.turnServer});const{cert:c,cid:u}=this._joinInfo.apResponse;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(u,"_").concat(c),icePwd:"".concat(u,"_").concat(c)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(s=re("FINGERPRINT"))!==null&&s!==void 0?s:o}]},candidates:r,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}})}_handleGatewaySignalEvents(){this._gateway.signal.on(_n.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(_n.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(_n.ON_ADD_AUDIO_STREAM,e=>this._handleAddAudioOrVideoStream("audio",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc)),this._gateway.signal.on(_n.ON_ADD_VIDEO_STREAM,e=>this._handleAddAudioOrVideoStream("video",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc,e.rtxSsrcId)),this._gateway.signal.on(_n.ON_REMOTE_DATASTREAM_UPDATE,e=>{this._handleUpdateDataChannel(e)}),this._gateway.signal.on(_n.ON_REMOTE_FULL_DATASTREAM_INFO,e=>{this._handleUpdateDataChannel({added:e.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(_n.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(_n.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(_n.MUTE_AUDIO,e=>this._handleMuteStream(e.uid,gt.AUDIO,!0)),this._gateway.signal.on(_n.UNMUTE_AUDIO,e=>this._handleMuteStream(e.uid,gt.AUDIO,!1)),this._gateway.signal.on(_n.MUTE_VIDEO,e=>this._handleMuteStream(e.uid,gt.VIDEO,!0)),this._gateway.signal.on(_n.UNMUTE_VIDEO,e=>this._handleMuteStream(e.uid,gt.VIDEO,!1)),this._gateway.signal.on(_n.RECEIVE_METADATA,e=>{const r=I_(e.metadata);this.safeEmit(mn.RECEIVE_METADATA,e.uid,r)}),this._gateway.signal.on(_n.ON_DATA_STREAM,async e=>{var r;if(!e)return;let o=I_(e.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&st(r=["aes-128-gcm2","aes-256-gcm2"]).call(r,this._encryptionMode)){if(e.payload.length<Pv)throw new Oe(X.UNEXPECTED_RESPONSE,"payload length ".concat(e.payload.length," is less than header length ").concat(Pv));o=await async function(u,h,m){const _=m.subarray(0,Pv),y=_.slice(8,Pv),S=(y[0]<<8)+y[1],R=(_[6]<<8)+_[7],P=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:u,tagLength:m8,additionalData:new Uint8Array(n8(S,2))},h,m.subarray(Pv));return new Uint8Array(P).subarray(0,R)}(this._encryptDataStreamIv,this._encryptDataStreamKey,o)}let s=0;if(e.ordered||e.syncWithAudio){const c=this._p2pChannel.getStats(),u=this.remoteUsers.find(m=>m.uid===e.uid),h=c==null?void 0:c.audioRecv.find(m=>m.ssrc===(u==null?void 0:u._audioSSRC));s=h==null?void 0:h.jitterBufferMs}(s==null||Number.isNaN(s))&&(s=0),Ime(mu(mu({},e),{},{payload:o}),s,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(_n.ON_CRYPT_ERROR,()=>{Rm(()=>{D.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(mn.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(_n.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(_n.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{D.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,jn.TOKEN_EXPIRE),this.safeEmit(mn.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(_n.ON_STREAM_FALLBACK_UPDATE,e=>{D.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(e.stream_id,", attr: ").concat(e.stream_type)),this.safeEmit(mn.STREAM_FALLBACK,e.stream_id,e.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(_n.ON_PUBLISH_STREAM,e=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:e.proxy})),D.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(e))))}),this._gateway.signal.on(_n.ENABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!0)}),this._gateway.signal.on(_n.DISABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!1)}),this._gateway.signal.on(Bt.REQUEST_TIMEOUT,(e,r)=>{if(this._joinInfo)switch(e){case jt.PUBLISH:{if(!r)return;const c=r.ortc;if(c){var o,s;const u=c.some(_=>{let{stream_type:y}=_;return y===zn.Audio}),h=c.some(_=>{let{stream_type:y}=_;return y!==zn.Audio}),m=c.some(_=>{let{stream_type:y}=_;return y===zn.Screen||y===zn.ScreenLow});r.state==="offer"&&wt.publish(this._joinInfo.sid,{eventElapse:Do.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:X.TIMEOUT,audio:u,video:h,p2pid:r.p2p_id,publishRequestid:this.store.pubId,screenshare:m,audioName:u?(o=c.find(_=>{let{stream_type:y}=_;return y===zn.Audio}))===null||o===void 0||(o=o.ssrcs[0])===null||o===void 0?void 0:o.ssrcId.toString():void 0,videoName:h?(s=c.find(_=>{let{stream_type:y}=_;return y!==zn.Audio}))===null||s===void 0||(s=s.ssrcs[0])===null||s===void 0?void 0:s.ssrcId.toString():void 0})}break}case jt.SUBSCRIBE:r&&wt.subscribe(this._joinInfo.sid,{succ:!1,ec:X.TIMEOUT,audio:r.stream_type===gt.AUDIO,video:r.stream_type===gt.VIDEO,peerid:r.stream_id,subscribeRequestid:r.ssrcId,p2pid:this.store.p2pId,eventElapse:Do.measureFromSubscribeStart(this.store.clientId,r.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(r.ssrcId)})}}),this._gateway.signal.on(_n.ON_P2P_OK,e=>{this.uid,this._uid}),this._gateway.signal.on(_n.ON_PUBLISHED_USER_LIST,e=>{if(e==null||!e.users)return;re("BLOCK_LOCAL_CLIENT")&&(e.users=e.users.filter(s=>!M_(s.string_id||s.stream_id,this.channelName)));const r=[],o=[];for(const s of e.users){let c=this._users.find(S=>S._uintid===s.stream_id);c?c._trust_in_room_=!0:(c=new Lm(s.string_id||s.stream_id,s.stream_id),this._users.push(c),this.getListeners(mn.PUBLISHED_USER_LIST).length===0&&(D.debug("[".concat(this._clientId,"] user online"),s.stream_id),this.safeEmit(mn.USER_JOINED,c)));const u=Bi.Audio&s.stream_type,h=(Bi.Video|Bi.LwoVideo)&s.stream_type,m=(65280&s.stream_type)!=0,_=u&&c.hasAudio,y=h&&c.hasVideo;h&&(c._trust_video_stream_added_state_=!0,c._video_added_=!0,c._videoSSRC=s.video_ssrc,c._rtxSsrcId=s.video_rtx),u&&(c._trust_audio_stream_added_state_=!0,c._audio_added_=!0,c._audioSSRC=s.audio_ssrc),u&&!_&&this.getListeners(mn.PUBLISHED_USER_LIST).length===0&&(D.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published audio")),this.safeEmit(mn.USER_PUBLISHED,c,"audio")),h&&!y&&this.getListeners(mn.PUBLISHED_USER_LIST).length===0&&(D.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published video")),this.safeEmit(mn.USER_PUBLISHED,c,"video")),(u&&!_||h&&!y||m)&&r.push(c),h&&this._p2pChannel.hasPendingRemoteMedia(c,"video")&&o.push({user:c,mediaType:"video"}),u&&this._p2pChannel.hasPendingRemoteMedia(c,"audio")&&o.push({user:c,mediaType:"audio"})}o.length>0&&(D.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(o.map(s=>"user: ".concat(s.user.uid,", mediaType: ").concat(s.mediaType)).join("; ")," ")),this.massSubscribe(o).catch(s=>{D.error("[".concat(this._clientId,"] mass resubscribe error"),s.toString())})),this.getListeners(mn.PUBLISHED_USER_LIST).length>0?re("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=r:(D.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(r.map(s=>s.uid).join(", "))),this.safeEmit(mn.PUBLISHED_USER_LIST,r)):D.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(r.map(s=>s.uid).join(", ")))}),this._gateway.signal.on(_n.ON_RTP_CAPABILITY_CHANGE,e=>{const{video_codec:r}=e;this._p2pChannel instanceof NT&&this._p2pChannel.updateRemoteRTPCapabilities(r.map(o=>o.toLowerCase()).filter(o=>{var s;return st(s=Object.keys(FA)).call(s,o)}))})}_handleP2PEvents(){this._gateway.signal.on(_n.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(Qr.PUBLISH,(e,r,o)=>{const{uid:s}=e;e.forEach(c=>{const{kind:u,ssrcs:h,mid:m,isMuted:_}=c;this._handleP2PAddAudioOrVideoStream(u,s,h[0].ssrcId,m);const y=this._users.find(S=>S.uid===s);return y&&this.store.useP2P?this._p2pChannel.mockSubscribe(y,u,h[0].ssrcId,m).then(()=>{r()}).catch(o):r(),this._handleMuteStream(s,u,!!_)})}),this._gateway.signal.on(Qr.CALL,async(e,r,o)=>{if(this.store.useP2P)try{var s;r(await this._p2pChannel.startP2P({turnServer:(s=this._joinInfo)===null||s===void 0?void 0:s.turnServer},e))}catch(c){o(c)}}),this._gateway.signal.on(Bt.P2P_CONNECTION,async e=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(e)}),this._gateway.signal.on(Qr.UNPUBLISH,async(e,r,o)=>{if(this.store.useP2P){const{unpubMsg:s,uid:c}=e,u=this._users.find(h=>h.uid===c);if(!u)return D.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(c)),void r();try{s.forEach(async h=>{let{stream_type:m}=h;const _=m===zn.Audio?gt.AUDIO:gt.VIDEO;await this._p2pChannel.unsubscribe(u,_),this._handleMuteStream(c,_,!0)}),r()}catch(h){o(h)}}}),this._gateway.signal.on(Qr.CONTROL,async(e,r)=>{const{action:o}=e;switch(o){case Pm.MUTE_LOCAL_VIDEO:this._handleMuteStream(r,gt.VIDEO,!0);break;case Pm.MUTE_LOCAL_AUDIO:this._handleMuteStream(r,gt.AUDIO,!0);break;case Pm.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",r),this._handleMuteStream(r,gt.VIDEO,!1);break;case Pm.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",r),this._handleMuteStream(r,gt.AUDIO,!1)}}),this._gateway.signal.on(Qr.RESTART_ICE,async(e,r,o)=>{if(this.store.useP2P)try{const{direction:s,iceParameter:c}=e;s!==bs.SEND_ONLY||c?r(await this._p2pChannel.restartICE(s,c)):(this._p2pChannel.handleDisconnect(s),r())}catch(s){o(s)}}),this._gateway.signal.on(Qr.CANDIDATE,e=>{if(this.store.useP2P){const{candidate:r,direction:o}=e;this._p2pChannel.addRemoteCandidate(r,o)}}),this._p2pChannel.on(kt.RequestP2PRestartICE,async(e,r,o)=>{try{const{direction:s}=e;r(await this._gateway.sendExtensionMessage(Qr.RESTART_ICE,e,s===bs.SEND_ONLY))}catch(s){o(s)}}),this._p2pChannel.on(kt.LocalCandidate,e=>{this._gateway.sendExtensionMessage(Qr.CANDIDATE,JSON.stringify(e),!0)}),this._p2pChannel.on(kt.RequestP2PMuteLocal,async(e,r,o)=>{try{await this._gateway.sendExtensionMessage(Qr.CONTROL,e,!0),r()}catch(s){o(s)}}),this._p2pChannel.on(kt.RequestP2PUnmuteRemote,async(e,r,o)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(s){s.code===X.DISCONNECT_P2P?r():o(s)}else r()}),this._p2pChannel.on(kt.RequestP2PMuteRemote,async(e,r,o)=>{if(this._joinInfo)try{await this._gateway.muteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(s){s.code===X.DISCONNECT_P2P?r():o(s)}else r()}),this._p2pChannel.on(kt.StateChange,(e,r)=>{r===Bn.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(kt.PeerConnectionStateChange,e=>{const r=this._peerConnectionState;e!==r&&(this.safeEmit(mn.PEERCONNECTION_STATE_CHANGE,e,r),this._peerConnectionState=e)}),this._p2pChannel.on(kt.RequestMuteLocal,async(e,r,o)=>{if(this._joinInfo)try{await this._gateway.muteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(s){s.code===X.DISCONNECT_P2P?r():o(s)}else r()}),this._p2pChannel.on(kt.RequestUnmuteLocal,async(e,r,o)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(s){s.code===X.DISCONNECT_P2P?r():o(s)}else r()}),this._p2pChannel.on(kt.RequestRePublish,(e,r,o)=>{this.publish(e,!1).then(r).catch(o)}),this._p2pChannel.on(kt.RequestRePublishDataChannel,(e,r,o)=>{lt.all(e.map(async s=>{const c=await this._p2pChannel.publishDataChannel([s]);try{c.forEach(u=>{this._uid&&this._gateway.publishDataChannel(this._uid,u,!0)})}catch(u){if(u.code!==X.DISCONNECT_P2P)throw u}})).then(r).catch(o)}),this._p2pChannel.on(kt.RequestReSubscribe,async(e,r,o)=>{try{for(const{user:s,kind:c}of e)c===gt.VIDEO?await this.subscribe(s,"video"):await this.subscribe(s,"audio");r()}catch(s){o(s)}}),this._p2pChannel.on(kt.RequestUpload,(e,r)=>{this._gateway.upload(e,r)}),this._p2pChannel.on(kt.RequestUploadStats,e=>{this._gateway.uploadWRTCStats(e)}),this._p2pChannel.on(kt.MediaReconnectStart,e=>{this.safeEmit(mn.MEDIA_RECONNECT_START,e)}),this._p2pChannel.on(kt.MediaReconnectEnd,e=>{this.safeEmit(mn.MEDIA_RECONNECT_END,e)}),this._p2pChannel.on(kt.NeedSignalRTT,e=>{e(this._gateway.getSignalRTT())}),this._p2pChannel.on(kt.RequestRestartICE,async e=>{if(this.store.useP2P)return;const r=await this._p2pChannel.restartICE(e),o=await r.next();if(o.done)return;const s=o.value;let c;try{c=await this._gateway.restartICE({iceParameters:s})}catch(h){return void r.throw(h)}const{iceParameters:u}=function(h){const m=h.iceParameters;return{iceParameters:{iceUfrag:m.iceUfrag,icePwd:m.icePwd}}}(c);await r.next({remoteIceParameters:u})}),this._p2pChannel.on(kt.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(kt.RequestReconnectPC,async()=>{var e;const{iceParameters:r,dtlsParameters:o,rtpCapabilities:s}=await this._p2pChannel.startP2PConnection({turnServer:(e=this._joinInfo)===null||e===void 0?void 0:e.turnServer}),{gatewayEstablishParams:c,gatewayAddress:u}=await this._gateway.reconnectPC({iceParameters:r,dtlsParameters:o,rtpCapabilities:s}),h=rH(c,u);await this._p2pChannel.connect(h),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(kt.RequestUnpublishForReconnectPC,async(e,r,o)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(e,this._uid),r()):o()}),this._p2pChannel.on(kt.P2PLost,()=>{this.safeEmit(mn.P2P_LOST,this.store.uid)}),this._p2pChannel.on(kt.UpdateVideoEncoder,e=>{e._encoderConfig&&this._gateway.setVideoProfile(e._encoderConfig)}),this._p2pChannel.on(kt.ConnectionTypeChange,e=>{this.safeEmit(mn.IS_USING_CLOUD_PROXY,e)}),this._p2pChannel.on(kt.RequestLowStreamParameter,e=>{e(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(kt.QueryClientConnectionState,e=>{e(this.connectionState)}),this._p2pChannel.on(kt.AudioMetadata,e=>{this.safeEmit(mn.AUDIO_METADATA,e)})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(e){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new Oe(X.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new Oe(X.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{const o=(r={config:e},Jf("ContentInspect").create(r));this._inspect=o,this.handleVideoInspectEvents(o);const{appId:s,cname:c,sid:u,token:h,uid:m,cid:_,vid:y}=this._joinInfo;await o.init({appId:s,areaCode:"",cname:c,sid:u,token:h,uid:m,cid:_,vid:y?Number(y):0},Ei)}catch(o){throw Array.isArray(o)?o[0]:o}var r}handleVideoInspectEvents(e){e.on(Zi.CONNECTION_STATE_CHANGE,(r,o)=>{if(this.safeEmit(mn.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,r,o),o===du.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(mn.CONTENT_INSPECT_ERROR,new Oe(X.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}}),e.on(Zi.INSPECT_RESULT,(r,o)=>{var s;if((o==null?void 0:o.code)===X.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return D.debug("Stop inspect content because that has left channel"),this==null||(s=this._inspect)===null||s===void 0||s.close(),void(this._inspect=void 0);this.safeEmit(mn.CONTENT_INSPECT_RESULT,r,o)}),e.on(Zi.CLIENT_LOCAL_VIDEO_TRACK,r=>{r(this.localTracks.filter(o=>o.trackMediaType==="video")[0])})}async disableContentInspect(){if(!this._inspect)throw new Oe(X.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}async setImageModeration(e,r){if(Gf(e,"enabled"),e){if(!r)throw new Oe(X.INVALID_PARAMS,"config is required");if(S9(r),!this._joinInfo)throw new Oe(X.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(r);else{const s=(o={config:r},Jf("ImageModeration").create(o));this._moderation=s,this.handleImageModerationEvents(s);const{appId:c,cname:u,sid:h,token:m,uid:_,cid:y,vid:S}=this._joinInfo;await s.init({appId:c,areaCode:"",cname:u,sid:h,token:m,uid:_,cid:y,vid:S?Number(S):0},Ei)}}catch(s){throw Array.isArray(s)?s[0]:s}}else{var o;if(!this._moderation)throw new Oe(X.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(s){throw Array.isArray(s)?s[0]:s}}}handleImageModerationEvents(e){e.on(gd.CONNECTION_STATE_CHANGE,(r,o)=>{if(this.safeEmit(mn.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,r,o),r===yl.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new Oe(X.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");e.inspectImage()}}),e.on(gd.CLIENT_LOCAL_VIDEO_TRACK,r=>{r(this.localTracks.filter(o=>o.trackMediaType==="video")[0])})}setP2PTransport(e){if(function(r){ki(r,"transport",["default","auto","relay","sd-rtn"])}(e),this.mode!=="p2p")throw new Oe(X.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=e,D.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(e))}getJoinChannelServiceRecords(){return D.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(e){Gf(e,"enabled"),Xn("ENABLE_PUBLISH_AUDIO_FILTER",e),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(e)}_handleResetAddStream(e,r){switch(r){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}}},vt(ft.prototype,"leave",[b9],Object.getOwnPropertyDescriptor(ft.prototype,"leave"),ft.prototype),vt(ft.prototype,"publish",[T9],Object.getOwnPropertyDescriptor(ft.prototype,"publish"),ft.prototype),vt(ft.prototype,"unpublish",[w9],Object.getOwnPropertyDescriptor(ft.prototype,"unpublish"),ft.prototype),vt(ft.prototype,"subscribe",[R9],Object.getOwnPropertyDescriptor(ft.prototype,"subscribe"),ft.prototype),vt(ft.prototype,"presubscribe",[C9],Object.getOwnPropertyDescriptor(ft.prototype,"presubscribe"),ft.prototype),vt(ft.prototype,"massSubscribe",[I9],Object.getOwnPropertyDescriptor(ft.prototype,"massSubscribe"),ft.prototype),vt(ft.prototype,"unsubscribe",[A9],Object.getOwnPropertyDescriptor(ft.prototype,"unsubscribe"),ft.prototype),vt(ft.prototype,"massUnsubscribe",[P9],Object.getOwnPropertyDescriptor(ft.prototype,"massUnsubscribe"),ft.prototype),vt(ft.prototype,"setLowStreamParameter",[O9],Object.getOwnPropertyDescriptor(ft.prototype,"setLowStreamParameter"),ft.prototype),vt(ft.prototype,"enableDualStream",[k9],Object.getOwnPropertyDescriptor(ft.prototype,"enableDualStream"),ft.prototype),vt(ft.prototype,"disableDualStream",[N9],Object.getOwnPropertyDescriptor(ft.prototype,"disableDualStream"),ft.prototype),vt(ft.prototype,"setClientRole",[D9],Object.getOwnPropertyDescriptor(ft.prototype,"setClientRole"),ft.prototype),vt(ft.prototype,"_setClientRoleOptions",[L9],Object.getOwnPropertyDescriptor(ft.prototype,"_setClientRoleOptions"),ft.prototype),vt(ft.prototype,"setProxyServer",[x9],Object.getOwnPropertyDescriptor(ft.prototype,"setProxyServer"),ft.prototype),vt(ft.prototype,"setTurnServer",[M9],Object.getOwnPropertyDescriptor(ft.prototype,"setTurnServer"),ft.prototype),vt(ft.prototype,"setLicense",[U9],Object.getOwnPropertyDescriptor(ft.prototype,"setLicense"),ft.prototype),vt(ft.prototype,"startProxyServer",[V9],Object.getOwnPropertyDescriptor(ft.prototype,"startProxyServer"),ft.prototype),vt(ft.prototype,"stopProxyServer",[F9],Object.getOwnPropertyDescriptor(ft.prototype,"stopProxyServer"),ft.prototype),vt(ft.prototype,"setLocalAccessPointsV2",[j9],Object.getOwnPropertyDescriptor(ft.prototype,"setLocalAccessPointsV2"),ft.prototype),vt(ft.prototype,"setLocalAccessPoints",[B9],Object.getOwnPropertyDescriptor(ft.prototype,"setLocalAccessPoints"),ft.prototype),vt(ft.prototype,"setRemoteDefaultVideoStreamType",[W9],Object.getOwnPropertyDescriptor(ft.prototype,"setRemoteDefaultVideoStreamType"),ft.prototype),vt(ft.prototype,"setRemoteVideoStreamType",[z9],Object.getOwnPropertyDescriptor(ft.prototype,"setRemoteVideoStreamType"),ft.prototype),vt(ft.prototype,"setStreamFallbackOption",[G9],Object.getOwnPropertyDescriptor(ft.prototype,"setStreamFallbackOption"),ft.prototype),vt(ft.prototype,"setEncryptionConfig",[H9],Object.getOwnPropertyDescriptor(ft.prototype,"setEncryptionConfig"),ft.prototype),vt(ft.prototype,"renewToken",[$9],Object.getOwnPropertyDescriptor(ft.prototype,"renewToken"),ft.prototype),vt(ft.prototype,"enableAudioVolumeIndicator",[K9],Object.getOwnPropertyDescriptor(ft.prototype,"enableAudioVolumeIndicator"),ft.prototype),vt(ft.prototype,"startLiveStreaming",[q9],Object.getOwnPropertyDescriptor(ft.prototype,"startLiveStreaming"),ft.prototype),vt(ft.prototype,"setLiveTranscoding",[Y9],Object.getOwnPropertyDescriptor(ft.prototype,"setLiveTranscoding"),ft.prototype),vt(ft.prototype,"stopLiveStreaming",[X9],Object.getOwnPropertyDescriptor(ft.prototype,"stopLiveStreaming"),ft.prototype),vt(ft.prototype,"startChannelMediaRelay",[J9],Object.getOwnPropertyDescriptor(ft.prototype,"startChannelMediaRelay"),ft.prototype),vt(ft.prototype,"updateChannelMediaRelay",[Q9],Object.getOwnPropertyDescriptor(ft.prototype,"updateChannelMediaRelay"),ft.prototype),vt(ft.prototype,"stopChannelMediaRelay",[Z9],Object.getOwnPropertyDescriptor(ft.prototype,"stopChannelMediaRelay"),ft.prototype),vt(ft.prototype,"sendCustomReportMessage",[e7],Object.getOwnPropertyDescriptor(ft.prototype,"sendCustomReportMessage"),ft.prototype),vt(ft.prototype,"pickSVCLayer",[t7],Object.getOwnPropertyDescriptor(ft.prototype,"pickSVCLayer"),ft.prototype),vt(ft.prototype,"setRTMConfig",[n7],Object.getOwnPropertyDescriptor(ft.prototype,"setRTMConfig"),ft.prototype),vt(ft.prototype,"enableContentInspect",[r7],Object.getOwnPropertyDescriptor(ft.prototype,"enableContentInspect"),ft.prototype),vt(ft.prototype,"disableContentInspect",[i7],Object.getOwnPropertyDescriptor(ft.prototype,"disableContentInspect"),ft.prototype),vt(ft.prototype,"setImageModeration",[o7],Object.getOwnPropertyDescriptor(ft.prototype,"setImageModeration"),ft.prototype),vt(ft.prototype,"setP2PTransport",[s7],Object.getOwnPropertyDescriptor(ft.prototype,"setP2PTransport"),ft.prototype),vt(ft.prototype,"getJoinChannelServiceRecords",[a7],Object.getOwnPropertyDescriptor(ft.prototype,"getJoinChannelServiceRecords"),ft.prototype),vt(ft.prototype,"setPublishAudioFilterEnabled",[c7],Object.getOwnPropertyDescriptor(ft.prototype,"setPublishAudioFilterEnabled"),ft.prototype),ft);class xT{constructor(r,o){$(this,"id",0),$(this,"element",void 0),$(this,"peerPair",void 0),$(this,"context",void 0),$(this,"audioPlayerElement",void 0),$(this,"audioTrack",void 0),xT.count+=1,this.id=xT.count,this.element=r,this.context=o}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=r=>{const o=document.createElement("audio");o.srcObject=new MediaStream([r.track]),o.play(),this.audioPlayerElement=o}}async switchSdp(){if(!this.peerPair)return;const r=async(s,c)=>{const u=c==="offer"?await s.createOffer():await s.createAnswer();return await s.setLocalDescription(u),s.iceGatheringState==="complete"?s.localDescription:new lt(h=>{s.onicegatheringstatechange=()=>{s.iceGatheringState==="complete"&&h(s.localDescription)}})},o=async(s,c)=>await s.setRemoteDescription(c);try{const s=await r(this.peerPair[0],"offer");await o(this.peerPair[1],s);const c=await r(this.peerPair[1],"answer");await o(this.peerPair[0],c)}catch(s){throw new Oe(X.LOCAL_AEC_ERROR,s.toString()).print()}}async getTracksFromMediaElement(r){if(this.audioTrack)return this.audioTrack;let o;try{r instanceof HTMLVideoElement&&(r.captureStream?r.captureStream():r.mozCaptureStream()),o=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(r).connect(o)}catch(c){throw new Oe(X.LOCAL_AEC_ERROR,c.toString()).print()}if(!o)throw new Oe(X.LOCAL_AEC_ERROR,"no dest node when local aec").print();const s=o.stream.getAudioTracks()[0];return this.audioTrack=s,s}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const r=this.element,o=await this.getTracksFromMediaElement(r);this.peerPair&&this.peerPair[0].addTrack(o),await this.switchSdp()}close(){D.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(r=>{r.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var u7,kP;$(xT,"count",0);const Gme=window.AudioContext||window.webkitAudioContext,Hme=new(u7=Mt({report:wt}),vt((kP=class{constructor(){$(this,"units",[]),$(this,"context",void 0)}processExternalMediaAEC(e){if(!this._doesEnvironmentNeedAEC())return D.debug("the system does not need to process local aec"),-1;this.context||(this.context=new Gme);let r=this.units.find(o=>o&&o.getElement()===e);return r||(r=new xT(e,this.context),this.units.push(r)),r.startEchoCancellation(),D.debug("start processing local audio echo cancellation, id is",r.id),r.id}_doesEnvironmentNeedAEC(){return Rn().name!==Mn.SAFARI}}).prototype,"processExternalMediaAEC",[u7],Object.getOwnPropertyDescriptor(kP.prototype,"processExternalMediaAEC"),kP.prototype),kP);function d7(e,r){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),o.push.apply(o,s)}return o}function h7(e){for(var r=1;r<arguments.length;r++){var o=arguments[r]!=null?arguments[r]:{};r%2?d7(Object(o),!0).forEach(function(s){$(e,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):d7(Object(o)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(o,s))})}return e}const fM=window||document;function f7(e){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!fM)return;const o=yi._cspEventHandlerPointer;if(o&&r)return void console.error(o,r);const s=c=>{if(!(c&&c.blockedURI&&(yi.onSecurityPolicyViolation||yi.getListeners(Eh.SECURITY_POLICY_VIOLATION).length>0)))return;const u=c.blockedURI;re("CSP_DETECTED_HOSTNAME_LIST").some(h=>st(u).call(u,h))&&(yi.onSecurityPolicyViolation&&typeof yi.onSecurityPolicyViolation=="function"&&yi.onSecurityPolicyViolation(c),yi.getListeners(Eh.SECURITY_POLICY_VIOLATION).length>0&&yi.safeEmit(Eh.SECURITY_POLICY_VIOLATION,c))};o&&fM.removeEventListener("securitypolicyviolation",o),(r||e&&typeof e=="function"||yi.getListeners(Eh.SECURITY_POLICY_VIOLATION).length>0)&&fM.addEventListener("securitypolicyviolation",s),yi._cspEventHandlerPointer=s}var $me=N,Kme=X6,p7=RegExp.prototype,qme=function(e){return e===p7||$me(p7,e)?Kme(e):e.flags},is=l(qme);function nS(e){let r=e.length;for(;--r>=0;)e[r]=0}const pM=256,m7=286,MT=30,UT=15,mM=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),NP=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Yme=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),g7=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),ep=new Array(576);nS(ep);const VT=new Array(60);nS(VT);const FT=new Array(512);nS(FT);const jT=new Array(256);nS(jT);const gM=new Array(29);nS(gM);const DP=new Array(MT);function _M(e,r,o,s,c){this.static_tree=e,this.extra_bits=r,this.extra_base=o,this.elems=s,this.max_length=c,this.has_stree=e&&e.length}let _7,E7,y7;function EM(e,r){this.dyn_tree=e,this.max_code=0,this.stat_desc=r}nS(DP);const v7=e=>e<256?FT[e]:FT[256+(e>>>7)],BT=(e,r)=>{e.pending_buf[e.pending++]=255&r,e.pending_buf[e.pending++]=r>>>8&255},Bc=(e,r,o)=>{e.bi_valid>16-o?(e.bi_buf|=r<<e.bi_valid&65535,BT(e,e.bi_buf),e.bi_buf=r>>16-e.bi_valid,e.bi_valid+=o-16):(e.bi_buf|=r<<e.bi_valid&65535,e.bi_valid+=o)},Th=(e,r,o)=>{Bc(e,o[2*r],o[2*r+1])},S7=(e,r)=>{let o=0;do o|=1&e,e>>>=1,o<<=1;while(--r>0);return o>>>1},b7=(e,r,o)=>{const s=new Array(16);let c,u,h=0;for(c=1;c<=UT;c++)h=h+o[c-1]<<1,s[c]=h;for(u=0;u<=r;u++){let m=e[2*u+1];m!==0&&(e[2*u]=S7(s[m]++,m))}},T7=e=>{let r;for(r=0;r<m7;r++)e.dyn_ltree[2*r]=0;for(r=0;r<MT;r++)e.dyn_dtree[2*r]=0;for(r=0;r<19;r++)e.bl_tree[2*r]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},w7=e=>{e.bi_valid>8?BT(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},R7=(e,r,o,s)=>{const c=2*r,u=2*o;return e[c]<e[u]||e[c]===e[u]&&s[r]<=s[o]},yM=(e,r,o)=>{const s=e.heap[o];let c=o<<1;for(;c<=e.heap_len&&(c<e.heap_len&&R7(r,e.heap[c+1],e.heap[c],e.depth)&&c++,!R7(r,s,e.heap[c],e.depth));)e.heap[o]=e.heap[c],o=c,c<<=1;e.heap[o]=s},C7=(e,r,o)=>{let s,c,u,h,m=0;if(e.sym_next!==0)do s=255&e.pending_buf[e.sym_buf+m++],s+=(255&e.pending_buf[e.sym_buf+m++])<<8,c=e.pending_buf[e.sym_buf+m++],s===0?Th(e,c,r):(u=jT[c],Th(e,u+pM+1,r),h=mM[u],h!==0&&(c-=gM[u],Bc(e,c,h)),s--,u=v7(s),Th(e,u,o),h=NP[u],h!==0&&(s-=DP[u],Bc(e,s,h)));while(m<e.sym_next);Th(e,256,r)},vM=(e,r)=>{const o=r.dyn_tree,s=r.stat_desc.static_tree,c=r.stat_desc.has_stree,u=r.stat_desc.elems;let h,m,_,y=-1;for(e.heap_len=0,e.heap_max=573,h=0;h<u;h++)o[2*h]!==0?(e.heap[++e.heap_len]=y=h,e.depth[h]=0):o[2*h+1]=0;for(;e.heap_len<2;)_=e.heap[++e.heap_len]=y<2?++y:0,o[2*_]=1,e.depth[_]=0,e.opt_len--,c&&(e.static_len-=s[2*_+1]);for(r.max_code=y,h=e.heap_len>>1;h>=1;h--)yM(e,o,h);_=u;do h=e.heap[1],e.heap[1]=e.heap[e.heap_len--],yM(e,o,1),m=e.heap[1],e.heap[--e.heap_max]=h,e.heap[--e.heap_max]=m,o[2*_]=o[2*h]+o[2*m],e.depth[_]=(e.depth[h]>=e.depth[m]?e.depth[h]:e.depth[m])+1,o[2*h+1]=o[2*m+1]=_,e.heap[1]=_++,yM(e,o,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((S,R)=>{const P=R.dyn_tree,k=R.max_code,z=R.stat_desc.static_tree,U=R.stat_desc.has_stree,V=R.stat_desc.extra_bits,q=R.stat_desc.extra_base,Y=R.stat_desc.max_length;let ce,_e,Ee,me,ke,Ye,ut=0;for(me=0;me<=UT;me++)S.bl_count[me]=0;for(P[2*S.heap[S.heap_max]+1]=0,ce=S.heap_max+1;ce<573;ce++)_e=S.heap[ce],me=P[2*P[2*_e+1]+1]+1,me>Y&&(me=Y,ut++),P[2*_e+1]=me,_e>k||(S.bl_count[me]++,ke=0,_e>=q&&(ke=V[_e-q]),Ye=P[2*_e],S.opt_len+=Ye*(me+ke),U&&(S.static_len+=Ye*(z[2*_e+1]+ke)));if(ut!==0){do{for(me=Y-1;S.bl_count[me]===0;)me--;S.bl_count[me]--,S.bl_count[me+1]+=2,S.bl_count[Y]--,ut-=2}while(ut>0);for(me=Y;me!==0;me--)for(_e=S.bl_count[me];_e!==0;)Ee=S.heap[--ce],Ee>k||(P[2*Ee+1]!==me&&(S.opt_len+=(me-P[2*Ee+1])*P[2*Ee],P[2*Ee+1]=me),_e--)}})(e,r),b7(o,y,e.bl_count)},I7=(e,r,o)=>{let s,c,u=-1,h=r[1],m=0,_=7,y=4;for(h===0&&(_=138,y=3),r[2*(o+1)+1]=65535,s=0;s<=o;s++)c=h,h=r[2*(s+1)+1],++m<_&&c===h||(m<y?e.bl_tree[2*c]+=m:c!==0?(c!==u&&e.bl_tree[2*c]++,e.bl_tree[32]++):m<=10?e.bl_tree[34]++:e.bl_tree[36]++,m=0,u=c,h===0?(_=138,y=3):c===h?(_=6,y=3):(_=7,y=4))},A7=(e,r,o)=>{let s,c,u=-1,h=r[1],m=0,_=7,y=4;for(h===0&&(_=138,y=3),s=0;s<=o;s++)if(c=h,h=r[2*(s+1)+1],!(++m<_&&c===h)){if(m<y)do Th(e,c,e.bl_tree);while(--m!=0);else c!==0?(c!==u&&(Th(e,c,e.bl_tree),m--),Th(e,16,e.bl_tree),Bc(e,m-3,2)):m<=10?(Th(e,17,e.bl_tree),Bc(e,m-3,3)):(Th(e,18,e.bl_tree),Bc(e,m-11,7));m=0,u=c,h===0?(_=138,y=3):c===h?(_=6,y=3):(_=7,y=4)}};let P7=!1;const O7=(e,r,o,s)=>{Bc(e,0+(s?1:0),3),w7(e),BT(e,o),BT(e,~o),o&&e.pending_buf.set(e.window.subarray(r,r+o),e.pending),e.pending+=o};var Xme=e=>{P7||((()=>{let r,o,s,c,u;const h=new Array(16);for(s=0,c=0;c<28;c++)for(gM[c]=s,r=0;r<1<<mM[c];r++)jT[s++]=c;for(jT[s-1]=c,u=0,c=0;c<16;c++)for(DP[c]=u,r=0;r<1<<NP[c];r++)FT[u++]=c;for(u>>=7;c<MT;c++)for(DP[c]=u<<7,r=0;r<1<<NP[c]-7;r++)FT[256+u++]=c;for(o=0;o<=UT;o++)h[o]=0;for(r=0;r<=143;)ep[2*r+1]=8,r++,h[8]++;for(;r<=255;)ep[2*r+1]=9,r++,h[9]++;for(;r<=279;)ep[2*r+1]=7,r++,h[7]++;for(;r<=287;)ep[2*r+1]=8,r++,h[8]++;for(b7(ep,287,h),r=0;r<MT;r++)VT[2*r+1]=5,VT[2*r]=S7(r,5);_7=new _M(ep,mM,257,m7,UT),E7=new _M(VT,NP,0,MT,UT),y7=new _M(new Array(0),Yme,0,19,7)})(),P7=!0),e.l_desc=new EM(e.dyn_ltree,_7),e.d_desc=new EM(e.dyn_dtree,E7),e.bl_desc=new EM(e.bl_tree,y7),e.bi_buf=0,e.bi_valid=0,T7(e)},Jme=(e,r,o,s)=>{let c,u,h=0;e.level>0?(e.strm.data_type===2&&(e.strm.data_type=(m=>{let _,y=4093624447;for(_=0;_<=31;_++,y>>>=1)if(1&y&&m.dyn_ltree[2*_]!==0)return 0;if(m.dyn_ltree[18]!==0||m.dyn_ltree[20]!==0||m.dyn_ltree[26]!==0)return 1;for(_=32;_<pM;_++)if(m.dyn_ltree[2*_]!==0)return 1;return 0})(e)),vM(e,e.l_desc),vM(e,e.d_desc),h=(m=>{let _;for(I7(m,m.dyn_ltree,m.l_desc.max_code),I7(m,m.dyn_dtree,m.d_desc.max_code),vM(m,m.bl_desc),_=18;_>=3&&m.bl_tree[2*g7[_]+1]===0;_--);return m.opt_len+=3*(_+1)+5+5+4,_})(e),c=e.opt_len+3+7>>>3,u=e.static_len+3+7>>>3,u<=c&&(c=u)):c=u=o+5,o+4<=c&&r!==-1?O7(e,r,o,s):e.strategy===4||u===c?(Bc(e,2+(s?1:0),3),C7(e,ep,VT)):(Bc(e,4+(s?1:0),3),((m,_,y,S)=>{let R;for(Bc(m,_-257,5),Bc(m,y-1,5),Bc(m,S-4,4),R=0;R<S;R++)Bc(m,m.bl_tree[2*g7[R]+1],3);A7(m,m.dyn_ltree,_-1),A7(m,m.dyn_dtree,y-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,h+1),C7(e,e.dyn_ltree,e.dyn_dtree)),T7(e),s&&w7(e)},Qme=(e,r,o)=>(e.pending_buf[e.sym_buf+e.sym_next++]=r,e.pending_buf[e.sym_buf+e.sym_next++]=r>>8,e.pending_buf[e.sym_buf+e.sym_next++]=o,r===0?e.dyn_ltree[2*o]++:(e.matches++,r--,e.dyn_ltree[2*(jT[o]+pM+1)]++,e.dyn_dtree[2*v7(r)]++),e.sym_next===e.sym_end),Zme=e=>{Bc(e,2,3),Th(e,256,ep),(r=>{r.bi_valid===16?(BT(r,r.bi_buf),r.bi_buf=0,r.bi_valid=0):r.bi_valid>=8&&(r.pending_buf[r.pending++]=255&r.bi_buf,r.bi_buf>>=8,r.bi_valid-=8)})(e)},ege={_tr_init:Xme,_tr_stored_block:O7,_tr_flush_block:Jme,_tr_tally:Qme,_tr_align:Zme},WT=(e,r,o,s)=>{let c=65535&e|0,u=e>>>16&65535|0,h=0;for(;o!==0;){h=o>2e3?2e3:o,o-=h;do c=c+r[s++]|0,u=u+c|0;while(--h);c%=65521,u%=65521}return c|u<<16|0};const tge=new Uint32Array((()=>{let e,r=[];for(var o=0;o<256;o++){e=o;for(var s=0;s<8;s++)e=1&e?3988292384^e>>>1:e>>>1;r[o]=e}return r})());var ws=(e,r,o,s)=>{const c=tge,u=s+o;e^=-1;for(let h=s;h<u;h++)e=e>>>8^c[255&(e^r[h])];return-1^e},H_={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},LP={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:nge,_tr_stored_block:SM,_tr_flush_block:rge,_tr_tally:Vm,_tr_align:ige}=ege,{Z_NO_FLUSH:Fm,Z_PARTIAL_FLUSH:oge,Z_FULL_FLUSH:sge,Z_FINISH:gu,Z_BLOCK:k7,Z_OK:Xs,Z_STREAM_END:N7,Z_STREAM_ERROR:wh,Z_DATA_ERROR:age,Z_BUF_ERROR:bM,Z_DEFAULT_COMPRESSION:cge,Z_FILTERED:lge,Z_HUFFMAN_ONLY:xP,Z_RLE:uge,Z_FIXED:dge,Z_DEFAULT_STRATEGY:hge,Z_UNKNOWN:fge,Z_DEFLATED:MP}=LP,TM=286,pge=30,mge=19,gge=2*TM+1,_ge=15,$_=258,Rh=262,rS=42,K_=113,zT=666,q_=(e,r)=>(e.msg=H_[r],r),D7=e=>2*e-(e>4?9:0),jm=e=>{let r=e.length;for(;--r>=0;)e[r]=0},Ege=e=>{let r,o,s,c=e.w_size;r=e.hash_size,s=r;do o=e.head[--s],e.head[s]=o>=c?o-c:0;while(--r);r=c,s=r;do o=e.prev[--s],e.prev[s]=o>=c?o-c:0;while(--r)};let Bm=(e,r,o)=>(r<<e.hash_shift^o)&e.hash_mask;const Sl=e=>{const r=e.state;let o=r.pending;o>e.avail_out&&(o=e.avail_out),o!==0&&(e.output.set(r.pending_buf.subarray(r.pending_out,r.pending_out+o),e.next_out),e.next_out+=o,r.pending_out+=o,e.total_out+=o,e.avail_out-=o,r.pending-=o,r.pending===0&&(r.pending_out=0))},bl=(e,r)=>{rge(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,r),e.block_start=e.strstart,Sl(e.strm)},Hr=(e,r)=>{e.pending_buf[e.pending++]=r},GT=(e,r)=>{e.pending_buf[e.pending++]=r>>>8&255,e.pending_buf[e.pending++]=255&r},wM=(e,r,o,s)=>{let c=e.avail_in;return c>s&&(c=s),c===0?0:(e.avail_in-=c,r.set(e.input.subarray(e.next_in,e.next_in+c),o),e.state.wrap===1?e.adler=WT(e.adler,r,c,o):e.state.wrap===2&&(e.adler=ws(e.adler,r,c,o)),e.next_in+=c,e.total_in+=c,c)},L7=(e,r)=>{let o,s,c=e.max_chain_length,u=e.strstart,h=e.prev_length,m=e.nice_match;const _=e.strstart>e.w_size-Rh?e.strstart-(e.w_size-Rh):0,y=e.window,S=e.w_mask,R=e.prev,P=e.strstart+$_;let k=y[u+h-1],z=y[u+h];e.prev_length>=e.good_match&&(c>>=2),m>e.lookahead&&(m=e.lookahead);do if(o=r,y[o+h]===z&&y[o+h-1]===k&&y[o]===y[u]&&y[++o]===y[u+1]){u+=2,o++;do;while(y[++u]===y[++o]&&y[++u]===y[++o]&&y[++u]===y[++o]&&y[++u]===y[++o]&&y[++u]===y[++o]&&y[++u]===y[++o]&&y[++u]===y[++o]&&y[++u]===y[++o]&&u<P);if(s=$_-(P-u),u=P-$_,s>h){if(e.match_start=r,h=s,s>=m)break;k=y[u+h-1],z=y[u+h]}}while((r=R[r&S])>_&&--c!=0);return h<=e.lookahead?h:e.lookahead},iS=e=>{const r=e.w_size;let o,s,c;do{if(s=e.window_size-e.lookahead-e.strstart,e.strstart>=r+(r-Rh)&&(e.window.set(e.window.subarray(r,r+r-s),0),e.match_start-=r,e.strstart-=r,e.block_start-=r,e.insert>e.strstart&&(e.insert=e.strstart),Ege(e),s+=r),e.strm.avail_in===0)break;if(o=wM(e.strm,e.window,e.strstart+e.lookahead,s),e.lookahead+=o,e.lookahead+e.insert>=3)for(c=e.strstart-e.insert,e.ins_h=e.window[c],e.ins_h=Bm(e,e.ins_h,e.window[c+1]);e.insert&&(e.ins_h=Bm(e,e.ins_h,e.window[c+3-1]),e.prev[c&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=c,c++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<Rh&&e.strm.avail_in!==0)},x7=(e,r)=>{let o,s,c,u=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,h=0,m=e.strm.avail_in;do{if(o=65535,c=e.bi_valid+42>>3,e.strm.avail_out<c||(c=e.strm.avail_out-c,s=e.strstart-e.block_start,o>s+e.strm.avail_in&&(o=s+e.strm.avail_in),o>c&&(o=c),o<u&&(o===0&&r!==gu||r===Fm||o!==s+e.strm.avail_in)))break;h=r===gu&&o===s+e.strm.avail_in?1:0,SM(e,0,0,h),e.pending_buf[e.pending-4]=o,e.pending_buf[e.pending-3]=o>>8,e.pending_buf[e.pending-2]=~o,e.pending_buf[e.pending-1]=~o>>8,Sl(e.strm),s&&(s>o&&(s=o),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+s),e.strm.next_out),e.strm.next_out+=s,e.strm.avail_out-=s,e.strm.total_out+=s,e.block_start+=s,o-=s),o&&(wM(e.strm,e.strm.output,e.strm.next_out,o),e.strm.next_out+=o,e.strm.avail_out-=o,e.strm.total_out+=o)}while(h===0);return m-=e.strm.avail_in,m&&(m>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=m&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-m,e.strm.next_in),e.strstart),e.strstart+=m,e.insert+=m>e.w_size-e.insert?e.w_size-e.insert:m),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),h?4:r!==Fm&&r!==gu&&e.strm.avail_in===0&&e.strstart===e.block_start?2:(c=e.window_size-e.strstart,e.strm.avail_in>c&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,c+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),c>e.strm.avail_in&&(c=e.strm.avail_in),c&&(wM(e.strm,e.window,e.strstart,c),e.strstart+=c,e.insert+=c>e.w_size-e.insert?e.w_size-e.insert:c),e.high_water<e.strstart&&(e.high_water=e.strstart),c=e.bi_valid+42>>3,c=e.pending_buf_size-c>65535?65535:e.pending_buf_size-c,u=c>e.w_size?e.w_size:c,s=e.strstart-e.block_start,(s>=u||(s||r===gu)&&r!==Fm&&e.strm.avail_in===0&&s<=c)&&(o=s>c?c:s,h=r===gu&&e.strm.avail_in===0&&o===s?1:0,SM(e,e.block_start,o,h),e.block_start+=o,Sl(e.strm)),h?3:1)},RM=(e,r)=>{let o,s;for(;;){if(e.lookahead<Rh){if(iS(e),e.lookahead<Rh&&r===Fm)return 1;if(e.lookahead===0)break}if(o=0,e.lookahead>=3&&(e.ins_h=Bm(e,e.ins_h,e.window[e.strstart+3-1]),o=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),o!==0&&e.strstart-o<=e.w_size-Rh&&(e.match_length=L7(e,o)),e.match_length>=3)if(s=Vm(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do e.strstart++,e.ins_h=Bm(e,e.ins_h,e.window[e.strstart+3-1]),o=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!=0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=Bm(e,e.ins_h,e.window[e.strstart+1]);else s=Vm(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(s&&(bl(e,!1),e.strm.avail_out===0))return 1}return e.insert=e.strstart<2?e.strstart:2,r===gu?(bl(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(bl(e,!1),e.strm.avail_out===0)?1:2},oS=(e,r)=>{let o,s,c;for(;;){if(e.lookahead<Rh){if(iS(e),e.lookahead<Rh&&r===Fm)return 1;if(e.lookahead===0)break}if(o=0,e.lookahead>=3&&(e.ins_h=Bm(e,e.ins_h,e.window[e.strstart+3-1]),o=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,o!==0&&e.prev_length<e.max_lazy_match&&e.strstart-o<=e.w_size-Rh&&(e.match_length=L7(e,o),e.match_length<=5&&(e.strategy===lge||e.match_length===3&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){c=e.strstart+e.lookahead-3,s=Vm(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=c&&(e.ins_h=Bm(e,e.ins_h,e.window[e.strstart+3-1]),o=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!=0);if(e.match_available=0,e.match_length=2,e.strstart++,s&&(bl(e,!1),e.strm.avail_out===0))return 1}else if(e.match_available){if(s=Vm(e,0,e.window[e.strstart-1]),s&&bl(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(s=Vm(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,r===gu?(bl(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(bl(e,!1),e.strm.avail_out===0)?1:2};function Ch(e,r,o,s,c){this.good_length=e,this.max_lazy=r,this.nice_length=o,this.max_chain=s,this.func=c}const HT=[new Ch(0,0,0,0,x7),new Ch(4,4,8,4,RM),new Ch(4,5,16,8,RM),new Ch(4,6,32,32,RM),new Ch(4,4,16,16,oS),new Ch(8,16,32,32,oS),new Ch(8,16,128,128,oS),new Ch(8,32,128,256,oS),new Ch(32,128,258,1024,oS),new Ch(32,258,258,4096,oS)];function yge(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=MP,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*gge),this.dyn_dtree=new Uint16Array(2*(2*pge+1)),this.bl_tree=new Uint16Array(2*(2*mge+1)),jm(this.dyn_ltree),jm(this.dyn_dtree),jm(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(_ge+1),this.heap=new Uint16Array(2*TM+1),jm(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*TM+1),jm(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const $T=e=>{if(!e)return 1;const r=e.state;return!r||r.strm!==e||r.status!==rS&&r.status!==57&&r.status!==69&&r.status!==73&&r.status!==91&&r.status!==103&&r.status!==K_&&r.status!==zT?1:0},M7=e=>{if($T(e))return q_(e,wh);e.total_in=e.total_out=0,e.data_type=fge;const r=e.state;return r.pending=0,r.pending_out=0,r.wrap<0&&(r.wrap=-r.wrap),r.status=r.wrap===2?57:r.wrap?rS:K_,e.adler=r.wrap===2?0:1,r.last_flush=-2,nge(r),Xs},U7=e=>{const r=M7(e);return r===Xs&&(o=>{o.window_size=2*o.w_size,jm(o.head),o.max_lazy_match=HT[o.level].max_lazy,o.good_match=HT[o.level].good_length,o.nice_match=HT[o.level].nice_length,o.max_chain_length=HT[o.level].max_chain,o.strstart=0,o.block_start=0,o.lookahead=0,o.insert=0,o.match_length=o.prev_length=2,o.match_available=0,o.ins_h=0})(e.state),r},V7=(e,r,o,s,c,u)=>{if(!e)return wh;let h=1;if(r===cge&&(r=6),s<0?(h=0,s=-s):s>15&&(h=2,s-=16),c<1||c>9||o!==MP||s<8||s>15||r<0||r>9||u<0||u>dge||s===8&&h!==1)return q_(e,wh);s===8&&(s=9);const m=new yge;return e.state=m,m.strm=e,m.status=rS,m.wrap=h,m.gzhead=null,m.w_bits=s,m.w_size=1<<m.w_bits,m.w_mask=m.w_size-1,m.hash_bits=c+7,m.hash_size=1<<m.hash_bits,m.hash_mask=m.hash_size-1,m.hash_shift=~~((m.hash_bits+3-1)/3),m.window=new Uint8Array(2*m.w_size),m.head=new Uint16Array(m.hash_size),m.prev=new Uint16Array(m.w_size),m.lit_bufsize=1<<c+6,m.pending_buf_size=4*m.lit_bufsize,m.pending_buf=new Uint8Array(m.pending_buf_size),m.sym_buf=m.lit_bufsize,m.sym_end=3*(m.lit_bufsize-1),m.level=r,m.strategy=u,m.method=o,U7(e)};var vge=(e,r)=>{if($T(e)||r>k7||r<0)return e?q_(e,wh):wh;const o=e.state;if(!e.output||e.avail_in!==0&&!e.input||o.status===zT&&r!==gu)return q_(e,e.avail_out===0?bM:wh);const s=o.last_flush;if(o.last_flush=r,o.pending!==0){if(Sl(e),e.avail_out===0)return o.last_flush=-1,Xs}else if(e.avail_in===0&&D7(r)<=D7(s)&&r!==gu)return q_(e,bM);if(o.status===zT&&e.avail_in!==0)return q_(e,bM);if(o.status===rS&&o.wrap===0&&(o.status=K_),o.status===rS){let c=MP+(o.w_bits-8<<4)<<8,u=-1;if(u=o.strategy>=xP||o.level<2?0:o.level<6?1:o.level===6?2:3,c|=u<<6,o.strstart!==0&&(c|=32),c+=31-c%31,GT(o,c),o.strstart!==0&&(GT(o,e.adler>>>16),GT(o,65535&e.adler)),e.adler=1,o.status=K_,Sl(e),o.pending!==0)return o.last_flush=-1,Xs}if(o.status===57){if(e.adler=0,Hr(o,31),Hr(o,139),Hr(o,8),o.gzhead)Hr(o,(o.gzhead.text?1:0)+(o.gzhead.hcrc?2:0)+(o.gzhead.extra?4:0)+(o.gzhead.name?8:0)+(o.gzhead.comment?16:0)),Hr(o,255&o.gzhead.time),Hr(o,o.gzhead.time>>8&255),Hr(o,o.gzhead.time>>16&255),Hr(o,o.gzhead.time>>24&255),Hr(o,o.level===9?2:o.strategy>=xP||o.level<2?4:0),Hr(o,255&o.gzhead.os),o.gzhead.extra&&o.gzhead.extra.length&&(Hr(o,255&o.gzhead.extra.length),Hr(o,o.gzhead.extra.length>>8&255)),o.gzhead.hcrc&&(e.adler=ws(e.adler,o.pending_buf,o.pending,0)),o.gzindex=0,o.status=69;else if(Hr(o,0),Hr(o,0),Hr(o,0),Hr(o,0),Hr(o,0),Hr(o,o.level===9?2:o.strategy>=xP||o.level<2?4:0),Hr(o,3),o.status=K_,Sl(e),o.pending!==0)return o.last_flush=-1,Xs}if(o.status===69){if(o.gzhead.extra){let c=o.pending,u=(65535&o.gzhead.extra.length)-o.gzindex;for(;o.pending+u>o.pending_buf_size;){let m=o.pending_buf_size-o.pending;if(o.pending_buf.set(o.gzhead.extra.subarray(o.gzindex,o.gzindex+m),o.pending),o.pending=o.pending_buf_size,o.gzhead.hcrc&&o.pending>c&&(e.adler=ws(e.adler,o.pending_buf,o.pending-c,c)),o.gzindex+=m,Sl(e),o.pending!==0)return o.last_flush=-1,Xs;c=0,u-=m}let h=new Uint8Array(o.gzhead.extra);o.pending_buf.set(h.subarray(o.gzindex,o.gzindex+u),o.pending),o.pending+=u,o.gzhead.hcrc&&o.pending>c&&(e.adler=ws(e.adler,o.pending_buf,o.pending-c,c)),o.gzindex=0}o.status=73}if(o.status===73){if(o.gzhead.name){let c,u=o.pending;do{if(o.pending===o.pending_buf_size){if(o.gzhead.hcrc&&o.pending>u&&(e.adler=ws(e.adler,o.pending_buf,o.pending-u,u)),Sl(e),o.pending!==0)return o.last_flush=-1,Xs;u=0}c=o.gzindex<o.gzhead.name.length?255&o.gzhead.name.charCodeAt(o.gzindex++):0,Hr(o,c)}while(c!==0);o.gzhead.hcrc&&o.pending>u&&(e.adler=ws(e.adler,o.pending_buf,o.pending-u,u)),o.gzindex=0}o.status=91}if(o.status===91){if(o.gzhead.comment){let c,u=o.pending;do{if(o.pending===o.pending_buf_size){if(o.gzhead.hcrc&&o.pending>u&&(e.adler=ws(e.adler,o.pending_buf,o.pending-u,u)),Sl(e),o.pending!==0)return o.last_flush=-1,Xs;u=0}c=o.gzindex<o.gzhead.comment.length?255&o.gzhead.comment.charCodeAt(o.gzindex++):0,Hr(o,c)}while(c!==0);o.gzhead.hcrc&&o.pending>u&&(e.adler=ws(e.adler,o.pending_buf,o.pending-u,u))}o.status=103}if(o.status===103){if(o.gzhead.hcrc){if(o.pending+2>o.pending_buf_size&&(Sl(e),o.pending!==0))return o.last_flush=-1,Xs;Hr(o,255&e.adler),Hr(o,e.adler>>8&255),e.adler=0}if(o.status=K_,Sl(e),o.pending!==0)return o.last_flush=-1,Xs}if(e.avail_in!==0||o.lookahead!==0||r!==Fm&&o.status!==zT){let c=o.level===0?x7(o,r):o.strategy===xP?((u,h)=>{let m;for(;;){if(u.lookahead===0&&(iS(u),u.lookahead===0)){if(h===Fm)return 1;break}if(u.match_length=0,m=Vm(u,0,u.window[u.strstart]),u.lookahead--,u.strstart++,m&&(bl(u,!1),u.strm.avail_out===0))return 1}return u.insert=0,h===gu?(bl(u,!0),u.strm.avail_out===0?3:4):u.sym_next&&(bl(u,!1),u.strm.avail_out===0)?1:2})(o,r):o.strategy===uge?((u,h)=>{let m,_,y,S;const R=u.window;for(;;){if(u.lookahead<=$_){if(iS(u),u.lookahead<=$_&&h===Fm)return 1;if(u.lookahead===0)break}if(u.match_length=0,u.lookahead>=3&&u.strstart>0&&(y=u.strstart-1,_=R[y],_===R[++y]&&_===R[++y]&&_===R[++y])){S=u.strstart+$_;do;while(_===R[++y]&&_===R[++y]&&_===R[++y]&&_===R[++y]&&_===R[++y]&&_===R[++y]&&_===R[++y]&&_===R[++y]&&y<S);u.match_length=$_-(S-y),u.match_length>u.lookahead&&(u.match_length=u.lookahead)}if(u.match_length>=3?(m=Vm(u,1,u.match_length-3),u.lookahead-=u.match_length,u.strstart+=u.match_length,u.match_length=0):(m=Vm(u,0,u.window[u.strstart]),u.lookahead--,u.strstart++),m&&(bl(u,!1),u.strm.avail_out===0))return 1}return u.insert=0,h===gu?(bl(u,!0),u.strm.avail_out===0?3:4):u.sym_next&&(bl(u,!1),u.strm.avail_out===0)?1:2})(o,r):HT[o.level].func(o,r);if(c!==3&&c!==4||(o.status=zT),c===1||c===3)return e.avail_out===0&&(o.last_flush=-1),Xs;if(c===2&&(r===oge?ige(o):r!==k7&&(SM(o,0,0,!1),r===sge&&(jm(o.head),o.lookahead===0&&(o.strstart=0,o.block_start=0,o.insert=0))),Sl(e),e.avail_out===0))return o.last_flush=-1,Xs}return r!==gu?Xs:o.wrap<=0?N7:(o.wrap===2?(Hr(o,255&e.adler),Hr(o,e.adler>>8&255),Hr(o,e.adler>>16&255),Hr(o,e.adler>>24&255),Hr(o,255&e.total_in),Hr(o,e.total_in>>8&255),Hr(o,e.total_in>>16&255),Hr(o,e.total_in>>24&255)):(GT(o,e.adler>>>16),GT(o,65535&e.adler)),Sl(e),o.wrap>0&&(o.wrap=-o.wrap),o.pending!==0?Xs:N7)},Sge=(e,r)=>{let o=r.length;if($T(e))return wh;const s=e.state,c=s.wrap;if(c===2||c===1&&s.status!==rS||s.lookahead)return wh;if(c===1&&(e.adler=WT(e.adler,r,o,0)),s.wrap=0,o>=s.w_size){c===0&&(jm(s.head),s.strstart=0,s.block_start=0,s.insert=0);let _=new Uint8Array(s.w_size);_.set(r.subarray(o-s.w_size,o),0),r=_,o=s.w_size}const u=e.avail_in,h=e.next_in,m=e.input;for(e.avail_in=o,e.next_in=0,e.input=r,iS(s);s.lookahead>=3;){let _=s.strstart,y=s.lookahead-2;do s.ins_h=Bm(s,s.ins_h,s.window[_+3-1]),s.prev[_&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=_,_++;while(--y);s.strstart=_,s.lookahead=2,iS(s)}return s.strstart+=s.lookahead,s.block_start=s.strstart,s.insert=s.lookahead,s.lookahead=0,s.match_length=s.prev_length=2,s.match_available=0,e.next_in=h,e.input=m,e.avail_in=u,s.wrap=c,Xs},KT={deflateInit:(e,r)=>V7(e,r,MP,15,8,hge),deflateInit2:V7,deflateReset:U7,deflateResetKeep:M7,deflateSetHeader:(e,r)=>$T(e)||e.state.wrap!==2?wh:(e.state.gzhead=r,Xs),deflate:vge,deflateEnd:e=>{if($T(e))return wh;const r=e.state.status;return e.state=null,r===K_?q_(e,age):Xs},deflateSetDictionary:Sge,deflateInfo:"pako deflate (from Nodeca project)"};const bge=(e,r)=>Object.prototype.hasOwnProperty.call(e,r);var UP={assign:function(e){const r=Array.prototype.slice.call(arguments,1);for(;r.length;){const o=r.shift();if(o){if(typeof o!="object")throw new TypeError(o+"must be non-object");for(const s in o)bge(o,s)&&(e[s]=o[s])}}return e},flattenChunks:e=>{let r=0;for(let s=0,c=e.length;s<c;s++)r+=e[s].length;const o=new Uint8Array(r);for(let s=0,c=0,u=e.length;s<u;s++){let h=e[s];o.set(h,c),c+=h.length}return o}};let F7=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{F7=!1}const qT=new Uint8Array(256);for(let e=0;e<256;e++)qT[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;qT[254]=qT[254]=1;var YT={string2buf:e=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(e);let r,o,s,c,u,h=e.length,m=0;for(c=0;c<h;c++)o=e.charCodeAt(c),(64512&o)==55296&&c+1<h&&(s=e.charCodeAt(c+1),(64512&s)==56320&&(o=65536+(o-55296<<10)+(s-56320),c++)),m+=o<128?1:o<2048?2:o<65536?3:4;for(r=new Uint8Array(m),u=0,c=0;u<m;c++)o=e.charCodeAt(c),(64512&o)==55296&&c+1<h&&(s=e.charCodeAt(c+1),(64512&s)==56320&&(o=65536+(o-55296<<10)+(s-56320),c++)),o<128?r[u++]=o:o<2048?(r[u++]=192|o>>>6,r[u++]=128|63&o):o<65536?(r[u++]=224|o>>>12,r[u++]=128|o>>>6&63,r[u++]=128|63&o):(r[u++]=240|o>>>18,r[u++]=128|o>>>12&63,r[u++]=128|o>>>6&63,r[u++]=128|63&o);return r},buf2string:(e,r)=>{const o=r||e.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(e.subarray(0,r));let s,c;const u=new Array(2*o);for(c=0,s=0;s<o;){let h=e[s++];if(h<128){u[c++]=h;continue}let m=qT[h];if(m>4)u[c++]=65533,s+=m-1;else{for(h&=m===2?31:m===3?15:7;m>1&&s<o;)h=h<<6|63&e[s++],m--;m>1?u[c++]=65533:h<65536?u[c++]=h:(h-=65536,u[c++]=55296|h>>10&1023,u[c++]=56320|1023&h)}}return((h,m)=>{if(m<65534&&h.subarray&&F7)return String.fromCharCode.apply(null,h.length===m?h:h.subarray(0,m));let _="";for(let y=0;y<m;y++)_+=String.fromCharCode(h[y]);return _})(u,c)},utf8border:(e,r)=>{(r=r||e.length)>e.length&&(r=e.length);let o=r-1;for(;o>=0&&(192&e[o])==128;)o--;return o<0||o===0?r:o+qT[e[o]]>r?o:r}},j7=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const B7=Object.prototype.toString,{Z_NO_FLUSH:Tge,Z_SYNC_FLUSH:wge,Z_FULL_FLUSH:Rge,Z_FINISH:Cge,Z_OK:VP,Z_STREAM_END:Ige,Z_DEFAULT_COMPRESSION:Age,Z_DEFAULT_STRATEGY:Pge,Z_DEFLATED:Oge}=LP;function FP(e){this.options=UP.assign({level:Age,method:Oge,chunkSize:16384,windowBits:15,memLevel:8,strategy:Pge},e||{});let r=this.options;r.raw&&r.windowBits>0?r.windowBits=-r.windowBits:r.gzip&&r.windowBits>0&&r.windowBits<16&&(r.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new j7,this.strm.avail_out=0;let o=KT.deflateInit2(this.strm,r.level,r.method,r.windowBits,r.memLevel,r.strategy);if(o!==VP)throw new Error(H_[o]);if(r.header&&KT.deflateSetHeader(this.strm,r.header),r.dictionary){let s;if(s=typeof r.dictionary=="string"?YT.string2buf(r.dictionary):B7.call(r.dictionary)==="[object ArrayBuffer]"?new Uint8Array(r.dictionary):r.dictionary,o=KT.deflateSetDictionary(this.strm,s),o!==VP)throw new Error(H_[o]);this._dict_set=!0}}function kge(e,r){const o=new FP(r);if(o.push(e,!0),o.err)throw o.msg||H_[o.err];return o.result}FP.prototype.push=function(e,r){const o=this.strm,s=this.options.chunkSize;let c,u;if(this.ended)return!1;for(u=r===~~r?r:r===!0?Cge:Tge,typeof e=="string"?o.input=YT.string2buf(e):B7.call(e)==="[object ArrayBuffer]"?o.input=new Uint8Array(e):o.input=e,o.next_in=0,o.avail_in=o.input.length;;)if(o.avail_out===0&&(o.output=new Uint8Array(s),o.next_out=0,o.avail_out=s),(u===wge||u===Rge)&&o.avail_out<=6)this.onData(o.output.subarray(0,o.next_out)),o.avail_out=0;else{if(c=KT.deflate(o,u),c===Ige)return o.next_out>0&&this.onData(o.output.subarray(0,o.next_out)),c=KT.deflateEnd(this.strm),this.onEnd(c),this.ended=!0,c===VP;if(o.avail_out!==0){if(u>0&&o.next_out>0)this.onData(o.output.subarray(0,o.next_out)),o.avail_out=0;else if(o.avail_in===0)break}else this.onData(o.output)}return!0},FP.prototype.onData=function(e){this.chunks.push(e)},FP.prototype.onEnd=function(e){e===VP&&(this.result=UP.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Nge={deflate:kge};const jP=16209;var Dge=function(e,r){let o,s,c,u,h,m,_,y,S,R,P,k,z,U,V,q,Y,ce,_e,Ee,me,ke,Ye,ut;const pt=e.state;o=e.next_in,Ye=e.input,s=o+(e.avail_in-5),c=e.next_out,ut=e.output,u=c-(r-e.avail_out),h=c+(e.avail_out-257),m=pt.dmax,_=pt.wsize,y=pt.whave,S=pt.wnext,R=pt.window,P=pt.hold,k=pt.bits,z=pt.lencode,U=pt.distcode,V=(1<<pt.lenbits)-1,q=(1<<pt.distbits)-1;e:do{k<15&&(P+=Ye[o++]<<k,k+=8,P+=Ye[o++]<<k,k+=8),Y=z[P&V];t:for(;;){if(ce=Y>>>24,P>>>=ce,k-=ce,ce=Y>>>16&255,ce===0)ut[c++]=65535&Y;else{if(!(16&ce)){if((64&ce)==0){Y=z[(65535&Y)+(P&(1<<ce)-1)];continue t}if(32&ce){pt.mode=16191;break e}e.msg="invalid literal/length code",pt.mode=jP;break e}_e=65535&Y,ce&=15,ce&&(k<ce&&(P+=Ye[o++]<<k,k+=8),_e+=P&(1<<ce)-1,P>>>=ce,k-=ce),k<15&&(P+=Ye[o++]<<k,k+=8,P+=Ye[o++]<<k,k+=8),Y=U[P&q];n:for(;;){if(ce=Y>>>24,P>>>=ce,k-=ce,ce=Y>>>16&255,!(16&ce)){if((64&ce)==0){Y=U[(65535&Y)+(P&(1<<ce)-1)];continue n}e.msg="invalid distance code",pt.mode=jP;break e}if(Ee=65535&Y,ce&=15,k<ce&&(P+=Ye[o++]<<k,k+=8,k<ce&&(P+=Ye[o++]<<k,k+=8)),Ee+=P&(1<<ce)-1,Ee>m){e.msg="invalid distance too far back",pt.mode=jP;break e}if(P>>>=ce,k-=ce,ce=c-u,Ee>ce){if(ce=Ee-ce,ce>y&&pt.sane){e.msg="invalid distance too far back",pt.mode=jP;break e}if(me=0,ke=R,S===0){if(me+=_-ce,ce<_e){_e-=ce;do ut[c++]=R[me++];while(--ce);me=c-Ee,ke=ut}}else if(S<ce){if(me+=_+S-ce,ce-=S,ce<_e){_e-=ce;do ut[c++]=R[me++];while(--ce);if(me=0,S<_e){ce=S,_e-=ce;do ut[c++]=R[me++];while(--ce);me=c-Ee,ke=ut}}}else if(me+=S-ce,ce<_e){_e-=ce;do ut[c++]=R[me++];while(--ce);me=c-Ee,ke=ut}for(;_e>2;)ut[c++]=ke[me++],ut[c++]=ke[me++],ut[c++]=ke[me++],_e-=3;_e&&(ut[c++]=ke[me++],_e>1&&(ut[c++]=ke[me++]))}else{me=c-Ee;do ut[c++]=ut[me++],ut[c++]=ut[me++],ut[c++]=ut[me++],_e-=3;while(_e>2);_e&&(ut[c++]=ut[me++],_e>1&&(ut[c++]=ut[me++]))}break}}break}}while(o<s&&c<h);_e=k>>3,o-=_e,k-=_e<<3,P&=(1<<k)-1,e.next_in=o,e.next_out=c,e.avail_in=o<s?s-o+5:5-(o-s),e.avail_out=c<h?h-c+257:257-(c-h),pt.hold=P,pt.bits=k};const BP=15,Lge=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),xge=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Mge=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Uge=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var XT=(e,r,o,s,c,u,h,m)=>{const _=m.bits;let y,S,R,P,k,z,U=0,V=0,q=0,Y=0,ce=0,_e=0,Ee=0,me=0,ke=0,Ye=0,ut=null;const pt=new Uint16Array(16),vn=new Uint16Array(16);let Sn,cr,Zr,Wr=null;for(U=0;U<=BP;U++)pt[U]=0;for(V=0;V<s;V++)pt[r[o+V]]++;for(ce=_,Y=BP;Y>=1&&pt[Y]===0;Y--);if(ce>Y&&(ce=Y),Y===0)return c[u++]=20971520,c[u++]=20971520,m.bits=1,0;for(q=1;q<Y&&pt[q]===0;q++);for(ce<q&&(ce=q),me=1,U=1;U<=BP;U++)if(me<<=1,me-=pt[U],me<0)return-1;if(me>0&&(e===0||Y!==1))return-1;for(vn[1]=0,U=1;U<BP;U++)vn[U+1]=vn[U]+pt[U];for(V=0;V<s;V++)r[o+V]!==0&&(h[vn[r[o+V]]++]=V);if(e===0?(ut=Wr=h,z=20):e===1?(ut=Lge,Wr=xge,z=257):(ut=Mge,Wr=Uge,z=0),Ye=0,V=0,U=q,k=u,_e=ce,Ee=0,R=-1,ke=1<<ce,P=ke-1,e===1&&ke>852||e===2&&ke>592)return 1;for(;;){Sn=U-Ee,h[V]+1<z?(cr=0,Zr=h[V]):h[V]>=z?(cr=Wr[h[V]-z],Zr=ut[h[V]-z]):(cr=96,Zr=0),y=1<<U-Ee,S=1<<_e,q=S;do S-=y,c[k+(Ye>>Ee)+S]=Sn<<24|cr<<16|Zr|0;while(S!==0);for(y=1<<U-1;Ye&y;)y>>=1;if(y!==0?(Ye&=y-1,Ye+=y):Ye=0,V++,--pt[U]==0){if(U===Y)break;U=r[o+h[V]]}if(U>ce&&(Ye&P)!==R){for(Ee===0&&(Ee=ce),k+=q,_e=U-Ee,me=1<<_e;_e+Ee<Y&&(me-=pt[_e+Ee],!(me<=0));)_e++,me<<=1;if(ke+=1<<_e,e===1&&ke>852||e===2&&ke>592)return 1;R=Ye&P,c[R]=ce<<24|_e<<16|k-u|0}}return Ye!==0&&(c[k+Ye]=U-Ee<<24|64<<16|0),m.bits=ce,0};const{Z_FINISH:W7,Z_BLOCK:Vge,Z_TREES:WP,Z_OK:Y_,Z_STREAM_END:Fge,Z_NEED_DICT:jge,Z_STREAM_ERROR:_u,Z_DATA_ERROR:z7,Z_MEM_ERROR:G7,Z_BUF_ERROR:Bge,Z_DEFLATED:H7}=LP,zP=16180,GP=16190,tp=16191,CM=16192,IM=16194,HP=16199,$P=16200,AM=16206,eo=16209,$7=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function Wge(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const X_=e=>{if(!e)return 1;const r=e.state;return!r||r.strm!==e||r.mode<zP||r.mode>16211?1:0},K7=e=>{if(X_(e))return _u;const r=e.state;return e.total_in=e.total_out=r.total=0,e.msg="",r.wrap&&(e.adler=1&r.wrap),r.mode=zP,r.last=0,r.havedict=0,r.flags=-1,r.dmax=32768,r.head=null,r.hold=0,r.bits=0,r.lencode=r.lendyn=new Int32Array(852),r.distcode=r.distdyn=new Int32Array(592),r.sane=1,r.back=-1,Y_},q7=e=>{if(X_(e))return _u;const r=e.state;return r.wsize=0,r.whave=0,r.wnext=0,K7(e)},Y7=(e,r)=>{let o;if(X_(e))return _u;const s=e.state;return r<0?(o=0,r=-r):(o=5+(r>>4),r<48&&(r&=15)),r&&(r<8||r>15)?_u:(s.window!==null&&s.wbits!==r&&(s.window=null),s.wrap=o,s.wbits=r,q7(e))},X7=(e,r)=>{if(!e)return _u;const o=new Wge;e.state=o,o.strm=e,o.window=null,o.mode=zP;const s=Y7(e,r);return s!==Y_&&(e.state=null),s};let PM,OM,J7=!0;const zge=e=>{if(J7){PM=new Int32Array(512),OM=new Int32Array(32);let r=0;for(;r<144;)e.lens[r++]=8;for(;r<256;)e.lens[r++]=9;for(;r<280;)e.lens[r++]=7;for(;r<288;)e.lens[r++]=8;for(XT(1,e.lens,0,288,PM,0,e.work,{bits:9}),r=0;r<32;)e.lens[r++]=5;XT(2,e.lens,0,32,OM,0,e.work,{bits:5}),J7=!1}e.lencode=PM,e.lenbits=9,e.distcode=OM,e.distbits=5},Q7=(e,r,o,s)=>{let c;const u=e.state;return u.window===null&&(u.wsize=1<<u.wbits,u.wnext=0,u.whave=0,u.window=new Uint8Array(u.wsize)),s>=u.wsize?(u.window.set(r.subarray(o-u.wsize,o),0),u.wnext=0,u.whave=u.wsize):(c=u.wsize-u.wnext,c>s&&(c=s),u.window.set(r.subarray(o-s,o-s+c),u.wnext),(s-=c)?(u.window.set(r.subarray(o-s,o),0),u.wnext=s,u.whave=u.wsize):(u.wnext+=c,u.wnext===u.wsize&&(u.wnext=0),u.whave<u.wsize&&(u.whave+=c))),0};var Gge=(e,r)=>{let o,s,c,u,h,m,_,y,S,R,P,k,z,U,V,q,Y,ce,_e,Ee,me,ke,Ye=0;const ut=new Uint8Array(4);let pt,vn;const Sn=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(X_(e)||!e.output||!e.input&&e.avail_in!==0)return _u;o=e.state,o.mode===tp&&(o.mode=CM),h=e.next_out,c=e.output,_=e.avail_out,u=e.next_in,s=e.input,m=e.avail_in,y=o.hold,S=o.bits,R=m,P=_,ke=Y_;e:for(;;)switch(o.mode){case zP:if(o.wrap===0){o.mode=CM;break}for(;S<16;){if(m===0)break e;m--,y+=s[u++]<<S,S+=8}if(2&o.wrap&&y===35615){o.wbits===0&&(o.wbits=15),o.check=0,ut[0]=255&y,ut[1]=y>>>8&255,o.check=ws(o.check,ut,2,0),y=0,S=0,o.mode=16181;break}if(o.head&&(o.head.done=!1),!(1&o.wrap)||(((255&y)<<8)+(y>>8))%31){e.msg="incorrect header check",o.mode=eo;break}if((15&y)!==H7){e.msg="unknown compression method",o.mode=eo;break}if(y>>>=4,S-=4,me=8+(15&y),o.wbits===0&&(o.wbits=me),me>15||me>o.wbits){e.msg="invalid window size",o.mode=eo;break}o.dmax=1<<o.wbits,o.flags=0,e.adler=o.check=1,o.mode=512&y?16189:tp,y=0,S=0;break;case 16181:for(;S<16;){if(m===0)break e;m--,y+=s[u++]<<S,S+=8}if(o.flags=y,(255&is(o))!==H7){e.msg="unknown compression method",o.mode=eo;break}if(57344&is(o)){e.msg="unknown header flags set",o.mode=eo;break}o.head&&(o.head.text=y>>8&1),512&is(o)&&4&o.wrap&&(ut[0]=255&y,ut[1]=y>>>8&255,o.check=ws(o.check,ut,2,0)),y=0,S=0,o.mode=16182;case 16182:for(;S<32;){if(m===0)break e;m--,y+=s[u++]<<S,S+=8}o.head&&(o.head.time=y),512&is(o)&&4&o.wrap&&(ut[0]=255&y,ut[1]=y>>>8&255,ut[2]=y>>>16&255,ut[3]=y>>>24&255,o.check=ws(o.check,ut,4,0)),y=0,S=0,o.mode=16183;case 16183:for(;S<16;){if(m===0)break e;m--,y+=s[u++]<<S,S+=8}o.head&&(o.head.xflags=255&y,o.head.os=y>>8),512&is(o)&&4&o.wrap&&(ut[0]=255&y,ut[1]=y>>>8&255,o.check=ws(o.check,ut,2,0)),y=0,S=0,o.mode=16184;case 16184:if(1024&is(o)){for(;S<16;){if(m===0)break e;m--,y+=s[u++]<<S,S+=8}o.length=y,o.head&&(o.head.extra_len=y),512&is(o)&&4&o.wrap&&(ut[0]=255&y,ut[1]=y>>>8&255,o.check=ws(o.check,ut,2,0)),y=0,S=0}else o.head&&(o.head.extra=null);o.mode=16185;case 16185:if(1024&is(o)&&(k=o.length,k>m&&(k=m),k&&(o.head&&(me=o.head.extra_len-o.length,o.head.extra||(o.head.extra=new Uint8Array(o.head.extra_len)),o.head.extra.set(s.subarray(u,u+k),me)),512&is(o)&&4&o.wrap&&(o.check=ws(o.check,s,k,u)),m-=k,u+=k,o.length-=k),o.length))break e;o.length=0,o.mode=16186;case 16186:if(2048&is(o)){if(m===0)break e;k=0;do me=s[u+k++],o.head&&me&&o.length<65536&&(o.head.name+=String.fromCharCode(me));while(me&&k<m);if(512&is(o)&&4&o.wrap&&(o.check=ws(o.check,s,k,u)),m-=k,u+=k,me)break e}else o.head&&(o.head.name=null);o.length=0,o.mode=16187;case 16187:if(4096&is(o)){if(m===0)break e;k=0;do me=s[u+k++],o.head&&me&&o.length<65536&&(o.head.comment+=String.fromCharCode(me));while(me&&k<m);if(512&is(o)&&4&o.wrap&&(o.check=ws(o.check,s,k,u)),m-=k,u+=k,me)break e}else o.head&&(o.head.comment=null);o.mode=16188;case 16188:if(512&is(o)){for(;S<16;){if(m===0)break e;m--,y+=s[u++]<<S,S+=8}if(4&o.wrap&&y!==(65535&o.check)){e.msg="header crc mismatch",o.mode=eo;break}y=0,S=0}o.head&&(o.head.hcrc=is(o)>>9&1,o.head.done=!0),e.adler=o.check=0,o.mode=tp;break;case 16189:for(;S<32;){if(m===0)break e;m--,y+=s[u++]<<S,S+=8}e.adler=o.check=$7(y),y=0,S=0,o.mode=GP;case GP:if(o.havedict===0)return e.next_out=h,e.avail_out=_,e.next_in=u,e.avail_in=m,o.hold=y,o.bits=S,jge;e.adler=o.check=1,o.mode=tp;case tp:if(r===Vge||r===WP)break e;case CM:if(o.last){y>>>=7&S,S-=7&S,o.mode=AM;break}for(;S<3;){if(m===0)break e;m--,y+=s[u++]<<S,S+=8}switch(o.last=1&y,y>>>=1,S-=1,3&y){case 0:o.mode=16193;break;case 1:if(zge(o),o.mode=HP,r===WP){y>>>=2,S-=2;break e}break;case 2:o.mode=16196;break;case 3:e.msg="invalid block type",o.mode=eo}y>>>=2,S-=2;break;case 16193:for(y>>>=7&S,S-=7&S;S<32;){if(m===0)break e;m--,y+=s[u++]<<S,S+=8}if((65535&y)!=(y>>>16^65535)){e.msg="invalid stored block lengths",o.mode=eo;break}if(o.length=65535&y,y=0,S=0,o.mode=IM,r===WP)break e;case IM:o.mode=16195;case 16195:if(k=o.length,k){if(k>m&&(k=m),k>_&&(k=_),k===0)break e;c.set(s.subarray(u,u+k),h),m-=k,u+=k,_-=k,h+=k,o.length-=k;break}o.mode=tp;break;case 16196:for(;S<14;){if(m===0)break e;m--,y+=s[u++]<<S,S+=8}if(o.nlen=257+(31&y),y>>>=5,S-=5,o.ndist=1+(31&y),y>>>=5,S-=5,o.ncode=4+(15&y),y>>>=4,S-=4,o.nlen>286||o.ndist>30){e.msg="too many length or distance symbols",o.mode=eo;break}o.have=0,o.mode=16197;case 16197:for(;o.have<o.ncode;){for(;S<3;){if(m===0)break e;m--,y+=s[u++]<<S,S+=8}o.lens[Sn[o.have++]]=7&y,y>>>=3,S-=3}for(;o.have<19;)o.lens[Sn[o.have++]]=0;if(o.lencode=o.lendyn,o.lenbits=7,pt={bits:o.lenbits},ke=XT(0,o.lens,0,19,o.lencode,0,o.work,pt),o.lenbits=pt.bits,ke){e.msg="invalid code lengths set",o.mode=eo;break}o.have=0,o.mode=16198;case 16198:for(;o.have<o.nlen+o.ndist;){for(;Ye=o.lencode[y&(1<<o.lenbits)-1],V=Ye>>>24,q=Ye>>>16&255,Y=65535&Ye,!(V<=S);){if(m===0)break e;m--,y+=s[u++]<<S,S+=8}if(Y<16)y>>>=V,S-=V,o.lens[o.have++]=Y;else{if(Y===16){for(vn=V+2;S<vn;){if(m===0)break e;m--,y+=s[u++]<<S,S+=8}if(y>>>=V,S-=V,o.have===0){e.msg="invalid bit length repeat",o.mode=eo;break}me=o.lens[o.have-1],k=3+(3&y),y>>>=2,S-=2}else if(Y===17){for(vn=V+3;S<vn;){if(m===0)break e;m--,y+=s[u++]<<S,S+=8}y>>>=V,S-=V,me=0,k=3+(7&y),y>>>=3,S-=3}else{for(vn=V+7;S<vn;){if(m===0)break e;m--,y+=s[u++]<<S,S+=8}y>>>=V,S-=V,me=0,k=11+(127&y),y>>>=7,S-=7}if(o.have+k>o.nlen+o.ndist){e.msg="invalid bit length repeat",o.mode=eo;break}for(;k--;)o.lens[o.have++]=me}}if(o.mode===eo)break;if(o.lens[256]===0){e.msg="invalid code -- missing end-of-block",o.mode=eo;break}if(o.lenbits=9,pt={bits:o.lenbits},ke=XT(1,o.lens,0,o.nlen,o.lencode,0,o.work,pt),o.lenbits=pt.bits,ke){e.msg="invalid literal/lengths set",o.mode=eo;break}if(o.distbits=6,o.distcode=o.distdyn,pt={bits:o.distbits},ke=XT(2,o.lens,o.nlen,o.ndist,o.distcode,0,o.work,pt),o.distbits=pt.bits,ke){e.msg="invalid distances set",o.mode=eo;break}if(o.mode=HP,r===WP)break e;case HP:o.mode=$P;case $P:if(m>=6&&_>=258){e.next_out=h,e.avail_out=_,e.next_in=u,e.avail_in=m,o.hold=y,o.bits=S,Dge(e,P),h=e.next_out,c=e.output,_=e.avail_out,u=e.next_in,s=e.input,m=e.avail_in,y=o.hold,S=o.bits,o.mode===tp&&(o.back=-1);break}for(o.back=0;Ye=o.lencode[y&(1<<o.lenbits)-1],V=Ye>>>24,q=Ye>>>16&255,Y=65535&Ye,!(V<=S);){if(m===0)break e;m--,y+=s[u++]<<S,S+=8}if(q&&(240&q)==0){for(ce=V,_e=q,Ee=Y;Ye=o.lencode[Ee+((y&(1<<ce+_e)-1)>>ce)],V=Ye>>>24,q=Ye>>>16&255,Y=65535&Ye,!(ce+V<=S);){if(m===0)break e;m--,y+=s[u++]<<S,S+=8}y>>>=ce,S-=ce,o.back+=ce}if(y>>>=V,S-=V,o.back+=V,o.length=Y,q===0){o.mode=16205;break}if(32&q){o.back=-1,o.mode=tp;break}if(64&q){e.msg="invalid literal/length code",o.mode=eo;break}o.extra=15&q,o.mode=16201;case 16201:if(o.extra){for(vn=o.extra;S<vn;){if(m===0)break e;m--,y+=s[u++]<<S,S+=8}o.length+=y&(1<<o.extra)-1,y>>>=o.extra,S-=o.extra,o.back+=o.extra}o.was=o.length,o.mode=16202;case 16202:for(;Ye=o.distcode[y&(1<<o.distbits)-1],V=Ye>>>24,q=Ye>>>16&255,Y=65535&Ye,!(V<=S);){if(m===0)break e;m--,y+=s[u++]<<S,S+=8}if((240&q)==0){for(ce=V,_e=q,Ee=Y;Ye=o.distcode[Ee+((y&(1<<ce+_e)-1)>>ce)],V=Ye>>>24,q=Ye>>>16&255,Y=65535&Ye,!(ce+V<=S);){if(m===0)break e;m--,y+=s[u++]<<S,S+=8}y>>>=ce,S-=ce,o.back+=ce}if(y>>>=V,S-=V,o.back+=V,64&q){e.msg="invalid distance code",o.mode=eo;break}o.offset=Y,o.extra=15&q,o.mode=16203;case 16203:if(o.extra){for(vn=o.extra;S<vn;){if(m===0)break e;m--,y+=s[u++]<<S,S+=8}o.offset+=y&(1<<o.extra)-1,y>>>=o.extra,S-=o.extra,o.back+=o.extra}if(o.offset>o.dmax){e.msg="invalid distance too far back",o.mode=eo;break}o.mode=16204;case 16204:if(_===0)break e;if(k=P-_,o.offset>k){if(k=o.offset-k,k>o.whave&&o.sane){e.msg="invalid distance too far back",o.mode=eo;break}k>o.wnext?(k-=o.wnext,z=o.wsize-k):z=o.wnext-k,k>o.length&&(k=o.length),U=o.window}else U=c,z=h-o.offset,k=o.length;k>_&&(k=_),_-=k,o.length-=k;do c[h++]=U[z++];while(--k);o.length===0&&(o.mode=$P);break;case 16205:if(_===0)break e;c[h++]=o.length,_--,o.mode=$P;break;case AM:if(o.wrap){for(;S<32;){if(m===0)break e;m--,y|=s[u++]<<S,S+=8}if(P-=_,e.total_out+=P,o.total+=P,4&o.wrap&&P&&(e.adler=o.check=is(o)?ws(o.check,c,P,h-P):WT(o.check,c,P,h-P)),P=_,4&o.wrap&&(is(o)?y:$7(y))!==o.check){e.msg="incorrect data check",o.mode=eo;break}y=0,S=0}o.mode=16207;case 16207:if(o.wrap&&is(o)){for(;S<32;){if(m===0)break e;m--,y+=s[u++]<<S,S+=8}if(4&o.wrap&&y!==(4294967295&o.total)){e.msg="incorrect length check",o.mode=eo;break}y=0,S=0}o.mode=16208;case 16208:ke=Fge;break e;case eo:ke=z7;break e;case 16210:return G7;default:return _u}return e.next_out=h,e.avail_out=_,e.next_in=u,e.avail_in=m,o.hold=y,o.bits=S,(o.wsize||P!==e.avail_out&&o.mode<eo&&(o.mode<AM||r!==W7))&&Q7(e,e.output,e.next_out,P-e.avail_out),R-=e.avail_in,P-=e.avail_out,e.total_in+=R,e.total_out+=P,o.total+=P,4&o.wrap&&P&&(e.adler=o.check=is(o)?ws(o.check,c,P,e.next_out-P):WT(o.check,c,P,e.next_out-P)),e.data_type=o.bits+(o.last?64:0)+(o.mode===tp?128:0)+(o.mode===HP||o.mode===IM?256:0),(R===0&&P===0||r===W7)&&ke===Y_&&(ke=Bge),ke},np={inflateReset:q7,inflateReset2:Y7,inflateResetKeep:K7,inflateInit:e=>X7(e,15),inflateInit2:X7,inflate:Gge,inflateEnd:e=>{if(X_(e))return _u;let r=e.state;return r.window&&(r.window=null),e.state=null,Y_},inflateGetHeader:(e,r)=>{if(X_(e))return _u;const o=e.state;return(2&o.wrap)==0?_u:(o.head=r,r.done=!1,Y_)},inflateSetDictionary:(e,r)=>{const o=r.length;let s,c,u;return X_(e)?_u:(s=e.state,s.wrap!==0&&s.mode!==GP?_u:s.mode===GP&&(c=1,c=WT(c,r,o,0),c!==s.check)?z7:(u=Q7(e,r,o,o),u?(s.mode=16210,G7):(s.havedict=1,Y_)))},inflateInfo:"pako inflate (from Nodeca project)"},Hge=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const Z7=Object.prototype.toString,{Z_NO_FLUSH:$ge,Z_FINISH:Kge,Z_OK:JT,Z_STREAM_END:kM,Z_NEED_DICT:NM,Z_STREAM_ERROR:qge,Z_DATA_ERROR:e$,Z_MEM_ERROR:Yge}=LP;function KP(e){this.options=UP.assign({chunkSize:65536,windowBits:15,to:""},e||{});const r=this.options;r.raw&&r.windowBits>=0&&r.windowBits<16&&(r.windowBits=-r.windowBits,r.windowBits===0&&(r.windowBits=-15)),!(r.windowBits>=0&&r.windowBits<16)||e&&e.windowBits||(r.windowBits+=32),r.windowBits>15&&r.windowBits<48&&(15&r.windowBits)==0&&(r.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new j7,this.strm.avail_out=0;let o=np.inflateInit2(this.strm,r.windowBits);if(o!==JT)throw new Error(H_[o]);if(this.header=new Hge,np.inflateGetHeader(this.strm,this.header),r.dictionary&&(typeof r.dictionary=="string"?r.dictionary=YT.string2buf(r.dictionary):Z7.call(r.dictionary)==="[object ArrayBuffer]"&&(r.dictionary=new Uint8Array(r.dictionary)),r.raw&&(o=np.inflateSetDictionary(this.strm,r.dictionary),o!==JT)))throw new Error(H_[o])}function Xge(e,r){const o=new KP(r);if(o.push(e),o.err)throw o.msg||H_[o.err];return o.result}KP.prototype.push=function(e,r){const o=this.strm,s=this.options.chunkSize,c=this.options.dictionary;let u,h,m;if(this.ended)return!1;for(h=r===~~r?r:r===!0?Kge:$ge,Z7.call(e)==="[object ArrayBuffer]"?o.input=new Uint8Array(e):o.input=e,o.next_in=0,o.avail_in=o.input.length;;){for(o.avail_out===0&&(o.output=new Uint8Array(s),o.next_out=0,o.avail_out=s),u=np.inflate(o,h),u===NM&&c&&(u=np.inflateSetDictionary(o,c),u===JT?u=np.inflate(o,h):u===e$&&(u=NM));o.avail_in>0&&u===kM&&o.state.wrap>0&&e[o.next_in]!==0;)np.inflateReset(o),u=np.inflate(o,h);switch(u){case qge:case e$:case NM:case Yge:return this.onEnd(u),this.ended=!0,!1}if(m=o.avail_out,o.next_out&&(o.avail_out===0||u===kM))if(this.options.to==="string"){let _=YT.utf8border(o.output,o.next_out),y=o.next_out-_,S=YT.buf2string(o.output,_);o.next_out=y,o.avail_out=s-y,y&&o.output.set(o.output.subarray(_,_+y),0),this.onData(S)}else this.onData(o.output.length===o.next_out?o.output:o.output.subarray(0,o.next_out));if(u!==JT||m!==0){if(u===kM)return u=np.inflateEnd(this.strm),this.onEnd(u),this.ended=!0,!0;if(o.avail_in===0)break}}return!0},KP.prototype.onData=function(e){this.chunks.push(e)},KP.prototype.onEnd=function(e){e===JT&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=UP.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Jge={inflate:Xge};const{deflate:Qge}=Nge,{inflate:Zge}=Jge;var e_e=Qge,t_e=Zge,t$=function(e){return e[e.ONE_BYTE=0]="ONE_BYTE",e[e.TWO_BYTE=1]="TWO_BYTE",e}(t$||{});class n_e{constructor(){$(this,"_sequence",0),$(this,"_startTime",Date.now()),$(this,"isUseOneByte",!0)}get startTime(){const r=Date.now()-this._startTime;return r<Math.pow(2,16)?r:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(r){const o={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:r};if(r.byteLength>128){const m=new Uint8Array(4);m.set([1,0,0,0]);const _={id:0,length:4,data:m.buffer},y={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[_]};o.commonPacketHeader.extension=1,o.extension=y,o.payload=this.compress(r),o.commonPacketHeader.length=8+(o.extension.length+2)+o.payload.byteLength}else o.commonPacketHeader.length=8+o.payload.byteLength;re("SHOW_DATASTREAM2_LOG")&&D.debug("send data header: ".concat(JSON.stringify(o.commonPacketHeader)));const s=new ArrayBuffer(o.commonPacketHeader.length),c=new Uint8Array(s),u=new DataView(s);let h=0;if(u.setUint16(h,o.commonPacketHeader.extension<<15|o.commonPacketHeader.reserved<<14|o.commonPacketHeader.length,!0),h+=2,u.setUint32(h,o.commonPacketHeader.sequence,!0),h+=4,u.setUint16(h,o.commonStreamHeader,!0),h+=2,o.extension){const m=this.serializeExtension(o.extension);c.set(new Uint8Array(m),h),h+=m.byteLength}if(c.set(new Uint8Array(o.payload),h),h+=o.payload.byteLength,h!==o.commonPacketHeader.length)throw Error("serialize error!");return s}deserialize(r){if(r.byteLength<4)return new ArrayBuffer(0);const o=new DataView(r);let s=0;const c=o.getUint16(s,!0);s+=2;const u={length:16383&c,reserved:(16384&c)>>14,extension:(32768&c)>>15,sequence:o.getUint16(s+2,!0)<<16|o.getUint16(s,!0)};let h,m;if(s+=4,re("SHOW_DATASTREAM2_LOG")&&D.debug("receive data header: ".concat(JSON.stringify(u))),o.getUint16(s,!0),s+=2,u.extension){m=this.deserializeExtension(r.slice(s)),s+=2+m.length,h=r.slice(s);let _=!1;if(m.datas.length>0){const y=m.datas.find(S=>S.id===0);y&&(_=(1&new DataView(y.data).getUint32(0,!0))==1)}h=_?this.decompress(h):h}else h=r.slice(8);return h}serializeExtension(r){const{profile:o,length:s,datas:c}=r,u=new ArrayBuffer(s+2),h=new Uint8Array(u),m=new DataView(u);let _=0;if(m.setUint8(_++,o),m.setUint8(_++,s),c.forEach(y=>{o?(m.setUint8(_++,y.id),m.setUint8(_++,y.length),h.set(new Uint8Array(y.data),_),_+=y.data.byteLength):(m.setUint8(_++,y.id|y.length<<4),h.set(new Uint8Array(y.data),_),_+=y.data.byteLength)}),_!==s+2)throw Error("serialize extension error, is ".concat(_,"!==").concat(s+2));return u}deserializeExtension(r){const o=new DataView(r);let s=0;const c=o.getUint8(s);s++;const u=o.getUint8(s);s++;const h=c===t$.TWO_BYTE,m=[],_=new DataView(r,2);let y=0;for(;y<u;){let S=0,R=0,P=new ArrayBuffer(0);h?(S=_.getUint8(y),y++,R=_.getUint8(y),y++):(S=15&_.getUint8(y),R=_.getUint8(y)>>4,y++),R>0&&(P=_.buffer.slice(y+2,y+2+R),y+=P.byteLength),m.push({id:S,length:R,data:P})}if(y!==u)throw Error("parse error");return{profile:c,length:u,datas:m}}decompress(r){return t_e(new Uint8Array(r))}compress(r){return e_e(new Uint8Array(r))}}const r_e={name:"DataStream",create:(e,r)=>{const o=r?new upe(e):new dpe(e);return o.useDataStream(new n_e),o}};class i_e extends Pr{constructor(r,o,s){super(),$(this,"ws",void 0),$(this,"requestId",1),$(this,"heartBeatTimer",void 0),$(this,"joinInfo",void 0),$(this,"clientId",void 0),$(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),$(this,"onClose",c=>{this.emit("close"),this.dispose()}),$(this,"onMessage",c=>{const u=JSON.parse(c.data);if(!u||u.command!=="serverResponse"||!u.requestId)return u&&u.command==="serverStatus"&&u.serverStatus&&u.serverStatus.command?(this.emit("status",u.serverStatus),void this.emit(u.serverStatus.command,u.serverStatus)):void 0;this.emit("req_".concat(u.requestId),u)}),this.joinInfo=r,this.clientId=o,this.ws=new TT("cross-channel-".concat(this.clientId),s),this.ws.on(qt.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(qt.CONNECTED,this.onOpen),this.ws.on(qt.ON_MESSAGE,this.onMessage),this.ws.on(qt.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(r){const o=this.requestId++;return r.requestId=o,r.seq=o,this.ws.sendMessage(r),o}waitStatus(r){return new lt((o,s)=>{const c=window.setTimeout(()=>{s(new Oe(X.TIMEOUT,"wait status timeout, status: ".concat(r)))},5e3);this.once(r,u=>{window.clearTimeout(c),u.state&&u.state!==0?s(new Oe(X.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(r))):o(void 0)}),this.once("dispose",()=>{window.clearTimeout(c),s(new Oe(X.WS_ABORT))})})}async request(r){if(this.ws.state==="closed")throw new Oe(X.WS_DISCONNECT);const o=()=>new lt((h,m)=>{this.ws.once(qt.CLOSED,()=>m(new Oe(X.WS_ABORT))),this.ws.once(qt.CONNECTED,h)});this.ws.state!=="connected"&&await o();const s=this.sendMessage(r),c=new lt((h,m)=>{const _=()=>{m(new Oe(X.WS_ABORT))};this.ws.once(qt.RECONNECTING,_),this.ws.once(qt.CLOSED,_),this.once("req_".concat(s),h),io(3e3).then(()=>{this.removeAllListeners("req_".concat(s)),this.ws.off(qt.RECONNECTING,_),this.ws.off(qt.CLOSED,_),m(new Oe(X.TIMEOUT,"cross channel ws request timeout"))})}),u=await c;if(!u||u.code!==200)throw new Oe(X.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(u)));return u}async connect(r){this.ws.removeAllListeners(qt.REQUEST_NEW_URLS),this.ws.on(qt.REQUEST_NEW_URLS,o=>{o(r)}),await this.ws.init(r)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(r){const o=this.requestId++;return r.requestId=o,this.ws.sendMessage(r),o}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class o_e extends Pr{set state(r){r!==this._state&&(r!==ba.RELAY_STATE_FAILURE&&(this.errorCode=zv.RELAY_OK),this.emit("state",r,this.errorCode),this._state=r)}get state(){return this._state}constructor(r,o,s,c,u){super(),$(this,"joinInfo",void 0),$(this,"sid",void 0),$(this,"clientId",void 0),$(this,"cancelToken",Hs.CancelToken.source()),$(this,"workerToken",void 0),$(this,"requestId",0),$(this,"signal",void 0),$(this,"prevChannelMediaConfig",void 0),$(this,"httpRetryConfig",void 0),$(this,"_resolution",void 0),$(this,"_state",ba.RELAY_STATE_IDLE),$(this,"errorCode",zv.RELAY_OK),$(this,"onStatus",h=>{D.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(h))),h&&h.command&&(h.command==="onAudioPacketReceived"&&this.emit("event",Yf.PACKET_RECEIVED_AUDIO_FROM_SRC),h.command==="onVideoPacketReceived"&&this.emit("event",Yf.PACKET_RECEIVED_VIDEO_FROM_SRC),h.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=zv.SRC_TOKEN_EXPIRED,this.state=ba.RELAY_STATE_FAILURE),h.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=zv.DEST_TOKEN_EXPIRED,this.state=ba.RELAY_STATE_FAILURE))}),$(this,"onReconnect",async()=>{D.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",Yf.NETWORK_DISCONNECTED),this.state=ba.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(h=>{this.state!==ba.RELAY_STATE_IDLE&&(D.error("auto restart channel media relay failed",h.toString()),this.errorCode=zv.SERVER_CONNECTION_LOST,this.state=ba.RELAY_STATE_FAILURE)})}),this.joinInfo=r,this.clientId=o,this.sid=A_(),this.signal=new i_e(this.joinInfo,this.clientId,s),this.httpRetryConfig=c,this._resolution=u}async startChannelMediaRelay(r){if(this.state!==ba.RELAY_STATE_IDLE)throw new Oe(X.INVALID_OPERATION);this.state=ba.RELAY_STATE_CONNECTING,await this.connect(),D.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(r)}catch(o){throw o.data&&o.data.serverResponse&&o.data.serverResponse.command==="SetSourceChannel"?new Oe(X.CROSS_CHANNEL_FAILED_JOIN_SRC):o.data&&o.data.serverResponse&&o.serverResponse.command==="SetDestChannelStatus"?new Oe(X.CROSS_CHANNEL_FAILED_JOIN_DEST):o.data&&o.data.serverResponse&&o.serverResponse.command==="StartPacketTransfer"?new Oe(X.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):o}this.prevChannelMediaConfig=r}async updateChannelMediaRelay(r){if(this.state!==ba.RELAY_STATE_RUNNING)throw new Oe(X.INVALID_OPERATION);await this.sendUpdateMessage(r),this.prevChannelMediaConfig=r}async setVideoProfile(r){if(this._resolution=r,this.state!==ba.RELAY_STATE_RUNNING)throw new Oe(X.INVALID_OPERATION);const o=this.genMessage(Ts.SetVideoProfile);await this.signal.request(o),D.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),D.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=ba.RELAY_STATE_IDLE,this.dispose()}dispose(){D.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=Hs.CancelToken.source(),this.state=ba.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const r=await mme(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=r.workerToken,await this.signal.connect(r.addressList),this.emit("event",Yf.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(r){const o=this.genMessage(Ts.StopPacketTransfer);await this.signal.request(o),await this.signal.waitStatus("Normal Quit"),D.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const s=this.genMessage(Ts.SetSdkProfile,r);await this.signal.request(s),D.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const c=this.genMessage(Ts.SetSourceChannel,r);await this.signal.request(c),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",Yf.PACKET_JOINED_SRC_CHANNEL),D.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const u=this.genMessage(Ts.SetSourceUserId,r);await this.signal.request(u),D.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const h=this.genMessage(Ts.SetDestChannel,r);await this.signal.request(h),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",Yf.PACKET_JOINED_DEST_CHANNEL),D.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const m=this.genMessage(Ts.StartPacketTransfer,r);await this.signal.request(m),this.emit("event",Yf.PACKET_SENT_TO_DEST_CHANNEL),this.state=ba.RELAY_STATE_RUNNING,D.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(r){const o=this.genMessage(Ts.UpdateDestChannel,r);await this.signal.request(o),this.emit("event",Yf.PACKET_UPDATE_DEST_CHANNEL),D.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const r=this.genMessage(Ts.StopPacketTransfer);await this.signal.request(r),D.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(r,o){const s=[],c=[],u=[];this.requestId+=1;const h={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:gl,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};h.sdkVersion==="4.23.2"&&(h.sdkVersion="0.0.1");let m=null,_=null;switch(r){case Ts.SetSdkProfile:return h.clientRequest={command:"SetSdkProfile",type:"multi_channel"},h;case Ts.SetSourceChannel:if(_=o&&o.getSrcChannelMediaInfo(),!_)throw new Oe(X.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceChannel",uid:"0",channelName:_.channelName,token:_.token||this.joinInfo.appId},h;case Ts.SetSourceUserId:if(_=o&&o.getSrcChannelMediaInfo(),!_)throw new Oe(X.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceUserId",uid:_.uid+""},h;case Ts.SetDestChannel:if(m=o&&o.getDestChannelMediaInfo(),!m)throw new Oe(X.UNEXPECTED_ERROR,"can not find dest config");return m.forEach(y=>{s.push(y.channelName),c.push(y.uid+""),u.push(y.token||this.joinInfo.appId)}),h.clientRequest={command:"SetDestChannel",channelName:s,uid:c,token:u},h;case Ts.StartPacketTransfer:return h.clientRequest={command:"StartPacketTransfer"},h;case Ts.Reconnect:return h.clientRequest={command:"Reconnect"},h;case Ts.StopPacketTransfer:return h.clientRequest={command:"StopPacketTransfer"},h;case Ts.UpdateDestChannel:if(m=o&&o.getDestChannelMediaInfo(),!m)throw new Oe(X.UNEXPECTED_ERROR,"can not find dest config");return m.forEach(y=>{s.push(y.channelName),c.push(y.uid+""),u.push(y.token||this.joinInfo.appId)}),h.clientRequest={command:"UpdateDestChannel",channelName:s,uid:c,token:u},h;case Ts.SetVideoProfile:h.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return h}}const s_e={name:"ChannelMediaRelay",create:function(e){return new o_e(e.joinInfo,e.clientId,e.websocketRetryConfig||Ei,e.httpRetryConfig||Ei,e.resolution)}};function n$(e,r){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),o.push.apply(o,s)}return o}function QT(e){for(var r=1;r<arguments.length;r++){var o=arguments[r]!=null?arguments[r]:{};r%2?n$(Object(o),!0).forEach(function(s){$(e,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):n$(Object(o)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(o,s))})}return e}class a_e extends Pr{constructor(r,o,s,c){super(),$(this,"spec",void 0),$(this,"token",void 0),$(this,"websocket",void 0),$(this,"pingpongTimer",void 0),$(this,"reconnectMode","retry"),$(this,"serviceMode",void 0),$(this,"reqId",0),$(this,"commandReqId",0),$(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),$(this,"handleWebSocketMessage",u=>{if(!u.data)return;const h=JSON.parse(u.data);h.requestId?this.emit("@".concat(h.requestId,"-").concat(h.sid),h):(wt.workerEvent(this.spec.sid,{actionType:"status",serverCode:h.code,workerType:this.serviceMode===qf.TRANSCODE?1:2}),this.emit(Am.PUBLISH_STREAM_STATUS,h))}),this.spec=o,this.token=r,this.serviceMode=c,this.websocket=new TT("live-streaming",s),this.websocket.on(qt.CONNECTED,this.handleWebSocketOpen),this.websocket.on(qt.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(qt.REQUEST_NEW_URLS,(u,h)=>{bo(this,Am.REQUEST_NEW_ADDRESS).then(u).catch(h)}),this.websocket.on(qt.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(r){return this.websocket.init(r)}async request(r,o,s,c){this.reqId+=1,r==="request"&&(this.commandReqId+=1);const u=this.commandReqId,h=this.reqId;if(!h||!this.websocket)throw new Oe(X.UNEXPECTED_ERROR);const m=QT({command:r,sdkVersion:gl==="4.23.2"?"0.0.1":gl,seq:h,requestId:h,allocate:s,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},o);if(this.websocket.state==="closed")throw new Oe(X.WS_DISCONNECT);const _=()=>new lt((P,k)=>{this.websocket.once(qt.CLOSED,()=>k(new Oe(X.WS_ABORT))),this.websocket.once(qt.CONNECTED,P)});this.websocket.state!=="connected"&&await _(),m.clientRequest&&(m.clientRequest.workerToken=this.token);const y=new lt((P,k)=>{const z=()=>{k(new Oe(X.WS_ABORT))};this.websocket.once(qt.RECONNECTING,z),this.websocket.once(qt.CLOSED,z),this.once("@".concat(h,"-").concat(this.spec.sid),U=>{P(U)})});c&&wt.workerEvent(this.spec.sid,QT(QT({},c),{},{requestId:u,actionType:"request",payload:JSON.stringify(o.clientRequest),serverCode:0,code:0}));const S=Date.now();this.websocket.sendMessage(m);let R=null;try{R=await y}catch(P){if(this.websocket.state==="closed")throw P;return await _(),await this.request(r,o,s)}return c&&wt.workerEvent(this.spec.sid,QT(QT({},c),{},{requestId:u,actionType:"response",payload:JSON.stringify(R.serverResponse),serverCode:R.code,success:R.code===200,responseTime:Date.now()-S})),R.code!==200&&this.handleResponseError(R),R}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const r=gl==="4.23.2"?"0.0.1":gl;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:r,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(r){switch(r.code){case Ii.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void D.warning("live stream response already exists stream");case Ii.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case Ii.LIVE_STREAM_RESPONSE_BAD_STREAM:case Ii.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new Oe(X.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:r.code}).throw();case Ii.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(r.serverResponse.command==="UnpublishStream")return;throw new Oe(X.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Ii.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new Oe(X.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:r.code}).throw();case Ii.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const o=new Oe(X.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(Am.WARNING,o,r.serverResponse.url)}case Ii.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const o=new Oe(X.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(Am.WARNING,o,r.serverResponse.url)}case Ii.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new Oe(X.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Ii.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new Oe(X.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:r.code}).throw();case Ii.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const o=new Oe(X.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(Am.WARNING,o,r.serverResponse.url)}case Ii.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new Oe(X.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:r.code}).throw();case Ii.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new Oe(X.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case Ii.LIVE_STREAM_RESPONSE_WORKER_LOST:case Ii.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(r.serverResponse.command==="UnpublishStream")return;throw new Oe(X.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Ii.ERROR_FAIL_SEND_MESSAGE:if(r.serverResponse.command==="UnpublishStream")return;if(r.serverResponse.command==="UpdateTranscoding"||r.serverResponse.command==="ControlStream")return new Oe(X.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:r.code}).throw();throw new Oe(X.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Ii.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Ii.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Ii.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Ii.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new Oe(X.LIVE_STREAMING_CDN_ERROR,"",{code:r.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(LA)},6e3)}}function r$(e,r){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),o.push.apply(o,s)}return o}function Ta(e){for(var r=1;r<arguments.length;r++){var o=arguments[r]!=null?arguments[r]:{};r%2?r$(Object(o),!0).forEach(function(s){$(e,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):r$(Object(o)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(o,s))})}return e}class c_e extends Pr{constructor(r){let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Ei,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Ei;super(),$(this,"onLiveStreamWarning",void 0),$(this,"onLiveStreamError",void 0),$(this,"spec",void 0),$(this,"retryTimeout",1e4),$(this,"connection",void 0),$(this,"httpRetryConfig",void 0),$(this,"wsRetryConfig",void 0),$(this,"streamingTasks",new Map),$(this,"isStartingStreamingTask",!1),$(this,"taskMutex",new Oo("live-streaming")),$(this,"cancelToken",Hs.CancelToken.source()),$(this,"transcodingConfig",void 0),$(this,"uapResponse",void 0),$(this,"lastTaskId",1),$(this,"statusError",new Map),this.spec=r,this.httpRetryConfig=s,this.wsRetryConfig=o}async setTranscodingConfig(r){const o=Ta(Ta({},qpe),r);o.videoCodecProfile!==66&&o.videoCodecProfile!==77&&o.videoCodecProfile!==100&&(D.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(o.videoCodecProfile," -> 100")),o.videoCodecProfile=100),o.transcodingUsers||(o.transcodingUsers=o.userConfigs),o.transcodingUsers&&(o.transcodingUsers=o.transcodingUsers.map(h=>Ta(Ta(Ta({},Kpe),h),{},{zOrder:h.zOrder?h.zOrder+1:1}))),function(h){Lr(h.width)||er(h.width,"config.width",0,1e4),Lr(h.height)||er(h.height,"config.height",0,1e4),Lr(h.videoBitrate)||er(h.videoBitrate,"config.videoBitrate",1,1e6),Lr(h.videoFrameRate)||er(h.videoFrameRate,"config.videoFrameRate"),Lr(h.lowLatency)||Gf(h.lowLatency,"config.lowLatency"),Lr(h.audioSampleRate)||ki(h.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),Lr(h.audioBitrate)||er(h.audioBitrate,"config.audioBitrate",1,128),Lr(h.audioChannels)||ki(h.audioChannels,"config.audioChannels",[1,2,3,4,5]),Lr(h.videoGop)||er(h.videoGop,"config.videoGop"),Lr(h.videoCodecProfile)||ki(h.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),Lr(h.userCount)||er(h.userCount,"config.userCount",0,17),Lr(h.backgroundColor)||er(h.backgroundColor,"config.backgroundColor",0,16777215),Lr(h.userConfigExtraInfo)||ro(h.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),h.transcodingUsers&&!Lr(h.transcodingUsers)&&(Hf(h.transcodingUsers,"config.transcodingUsers"),h.transcodingUsers.forEach((m,_)=>{iP(m.uid),Lr(m.x)||er(m.x,"transcodingUser[".concat(_,"].x"),0,1e4),Lr(m.y)||er(m.y,"transcodingUser[".concat(_,"].y"),0,1e4),Lr(m.width)||er(m.width,"transcodingUser[".concat(_,"].width"),0,1e4),Lr(m.height)||er(m.height,"transcodingUser[".concat(_,"].height"),0,1e4),Lr(m.zOrder)||er(m.zOrder-1,"transcodingUser[".concat(_,"].zOrder"),0,100),Lr(m.alpha)||er(m.alpha,"transcodingUser[".concat(_,"].alpha"),0,1,!1)})),Lr(h.watermark)||Lx(h.watermark,"watermark"),Lr(h.backgroundImage)||Lx(h.backgroundImage,"backgroundImage"),h.images&&!Lr(h.images)&&(Hf(h.images,"config.images"),h.images.forEach((m,_)=>{Lx(m,"images[".concat(_,"]"))}))}(o);const s=[];o.images&&s.push(...o.images.map(h=>Ta(Ta(Ta({},Dx),h),{},{zOrder:255}))),o.backgroundImage&&(s.push(Ta(Ta(Ta({},Dx),o.backgroundImage),{},{zOrder:0})),delete o.backgroundImage),o.watermark&&(s.push(Ta(Ta(Ta({},Dx),o.watermark),{},{zOrder:255})),delete o.watermark),o.images=s,o.transcodingUsers&&(o.userConfigs=o.transcodingUsers.map(h=>Ta({},h)),o.userCount=o.transcodingUsers.length,delete o.transcodingUsers);const c=(o.userConfigs||[]).map(h=>typeof h.uid=="number"?lt.resolve(h.uid):RH(h.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await lt.all(c)).forEach((h,m)=>{o.userConfigs&&o.userConfigs[m]&&(o.userConfigs[m].uid=h)}),this.transcodingConfig=o,this.connection)try{var u;const h=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(Pc(u=this.streamingTasks).call(u)).map(m=>m.taskId).join("#")});D.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(h.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(h){if(!h.data||!h.data.retry)throw h;h.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(m=>{D.warning("[".concat(this.spec.clientId,"] live streaming receive error"),h.toString(),"try to republish",m.url),this.startLiveStreamingTask(m.url,m.mode,h).then(()=>{D.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(m.url," success"))}).catch(_=>{D.error("[".concat(this.spec.clientId,"] live streaming republish failed"),m.url,_.toString()),this.onLiveStreamError&&this.onLiveStreamError(m.url,_)})})}}async startLiveStreamingTask(r,o,s){if(!this.transcodingConfig&&o===qf.TRANSCODE)throw new Oe(X.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const c={command:"PublishStream",ts:Date.now(),url:r,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};D.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(r,", mode: ").concat(o));const u=await this.taskMutex.lock();if(!this.connection&&s)return void u();if(this.streamingTasks.get(r)&&!s)return u(),new Oe(X.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(o))}catch(m){throw u(),m}switch(o){case qf.TRANSCODE:c.transcodingConfig=Ta({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(c.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const h=this.lastTaskId++;try{const m=new lt((y,S)=>{io(this.retryTimeout).then(()=>{if(s)return S(s);const R=this.statusError.get(r);return R?(this.statusError.delete(r),S(R)):void 0})}),_=await lt.race([this.connection.request("request",{clientRequest:c},!0,{url:r,command:"PublishStream",workerType:o===qf.TRANSCODE?1:2,requestByUser:!s,tid:h.toString()}),m]);this.isStartingStreamingTask=!1,D.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(_.code)),this.streamingTasks.set(r,{clientRequest:c,mode:o,url:r,taskId:h}),u()}catch(m){if(u(),this.isStartingStreamingTask=!1,!m.data||!m.data.retry||s)throw m;return m.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(r,o,m)):await this.startLiveStreamingTask(r,o,m)}}stopLiveStreamingTask(r){return new lt((o,s)=>{const c=this.streamingTasks.get(r);if(!c||!this.connection)return new Oe(X.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const u=c.mode;c.abortTask=()=>{D.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(r),o()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:c.url}},!1,{url:r,command:"UnPublishStream",workerType:u===qf.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(h=>{D.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(h.code)),this.streamingTasks.delete(r),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),o()}).catch(s)})}resetAllTask(){var r;const o=Array.from(Pc(r=this.streamingTasks).call(r));this.terminate();for(const s of o)this.startLiveStreamingTask(s.url,s.mode).catch(c=>{this.onLiveStreamError&&this.onLiveStreamError(s.url,c)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=Hs.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(r){if(this.connection)throw new Oe(X.UNEXPECTED_ERROR,"live streaming connection has already connected");const o=await bo(this,xx.REQUEST_WORKER_MANAGER_LIST,r);return this.uapResponse=o,this.connection=new a_e(o.workerToken,this.spec,this.wsRetryConfig,r),this.connection.on(Am.WARNING,(s,c)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(c,s)),this.connection.on(Am.PUBLISH_STREAM_STATUS,s=>this.handlePublishStreamServer(s)),this.connection.on(Am.REQUEST_NEW_ADDRESS,(s,c)=>{if(!this.connection)return c(new Oe(X.UNEXPECTED_ERROR,"can not get new live streaming address list"));bo(this,xx.REQUEST_WORKER_MANAGER_LIST,r).then(u=>{this.uapResponse=u,s(u.addressList)}).catch(c)}),await this.connection.init(o.addressList),this.connection}handlePublishStreamServer(r){const o=r.serverStatus&&r.serverStatus.url||"empty_url",s=this.streamingTasks.get(o),c=r.reason;switch(r.code){case Ii.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Ii.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Ii.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Ii.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const h=new Oe(X.LIVE_STREAMING_CDN_ERROR,"",{code:r.code});if(s)return D.error(h.toString()),this.onLiveStreamError&&this.onLiveStreamError(o,h);if(!this.isStartingStreamingTask)return;this.statusError.set(o,h)}case Ii.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const h=new Oe(X.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,c);return this.onLiveStreamWarning&&this.onLiveStreamWarning(o,h)}case Ii.LIVE_STREAM_RESPONSE_WORKER_LOST:case Ii.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var u;if(!this.connection)return;this.connection.tryNextAddress();const h=Array.from(Pc(u=this.streamingTasks).call(u));for(const m of h)m.abortTask?m.abortTask():(D.warning("[".concat(this.spec.clientId,"] publish stream status code"),r.code,"try to republish",m.url),this.startLiveStreamingTask(m.url,m.mode,new Oe(X.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:r.code})).then(()=>{D.debug("[".concat(this.spec.clientId,"] republish live stream success"),m.url)}).catch(_=>{D.error(_.toString()),this.onLiveStreamError&&this.onLiveStreamError(m.url,_)}));return}}}hasUrl(r){return this.streamingTasks.has(r)}}const l_e={name:"LiveStreaming",create:function(e){return new c_e(e.joinInfo,e.websocketRetryConfig||Ei,e.httpRetryConfig||Ei)}};function u_e(e){let r=s$();return function(o,s){let c=o.appId;c!==void 0&&($n(s,10),Ih(s,c));let u=o.cid;u!==void 0&&($n(s,16),$n(s,u));let h=o.cname;h!==void 0&&($n(s,26),Ih(s,h));let m=o.deviceId;m!==void 0&&($n(s,34),Ih(s,m));let _=o.elapse;_!==void 0&&($n(s,40),Wm(s,_));let y=o.fileSize;y!==void 0&&($n(s,48),Wm(s,sS(y)));let S=o.height;S!==void 0&&($n(s,56),Wm(s,sS(S)));let R=o.jpg;R!==void 0&&($n(s,66),$n(s,R.length),function(Js,je){let ot=aS(Js,je.length);Js.bytes.set(je,ot)}(s,R));let P=o.networkType;P!==void 0&&($n(s,72),Wm(s,sS(P)));let k=o.osType;k!==void 0&&($n(s,80),Wm(s,sS(k)));let z=o.requestId;z!==void 0&&($n(s,90),Ih(s,z));let U=o.sdkVersion;U!==void 0&&($n(s,98),Ih(s,U));let V=o.sequence;V!==void 0&&($n(s,104),Wm(s,sS(V)));let q=o.sid;q!==void 0&&($n(s,114),Ih(s,q));let Y=o.timestamp;Y!==void 0&&($n(s,120),Wm(s,Y));let ce=o.uid;ce!==void 0&&($n(s,128),$n(s,ce));let _e=o.vid;_e!==void 0&&($n(s,136),$n(s,_e));let Ee=o.width;Ee!==void 0&&($n(s,144),Wm(s,sS(Ee)));let me=o.service;me!==void 0&&($n(s,152),$n(s,me));let ke=o.callbackData;ke!==void 0&&($n(s,162),Ih(s,ke));let Ye=o.jpgEncryption;Ye!==void 0&&($n(s,168),$n(s,Ye));let ut=o.requestType;ut!==void 0&&($n(s,176),$n(s,ut));let pt=o.scorePorn;pt!==void 0&&($n(s,185),UM(s,pt));let vn=o.scoreSexy;vn!==void 0&&($n(s,193),UM(s,vn));let Sn=o.scoreNeutral;Sn!==void 0&&($n(s,201),UM(s,Sn));let cr=o.scene;cr!==void 0&&($n(s,208),$n(s,cr));let Zr=o.ossFilePrefix;Zr!==void 0&&($n(s,218),Ih(s,Zr));let Wr=o.serviceVendor;if(Wr!==void 0)for(let Js of Wr){$n(s,226);let je=s$();f_e(Js,je),$n(s,je.limit),__e(s,je),g_e(je)}}(e,r),function(o){let s=o.bytes,c=o.limit;return s.length===c?s:s.subarray(0,c)}(r)}function d_e(e){return function(o){let s={};e:for(;!a$(o);){let c=Ah(o);switch(c>>>3){case 0:break e;case 1:s.code=Ah(o);break;case 2:s.msg=c$(o,Ah(o));break;case 3:{let u=p_e(o);s.data=h_e(o),o.limit=u;break}default:i$(o,7&c)}}return s}({bytes:r=e,offset:0,limit:r.length});var r}function h_e(e){let r={};e:for(;!a$(e);){let o=Ah(e);switch(o>>>3){case 0:break e;case 1:r.requestId=c$(e,Ah(e));break;case 2:r.requestType=Ah(e)>>>0;break;case 3:r.scorePorn=MM(e);break;case 4:r.scoreSexy=MM(e);break;case 5:r.scoreNeutral=MM(e);break;case 6:r.requestScene=Ah(e)>>>0;break;case 7:r.scene=Ah(e)>>>0;break;default:i$(e,7&o)}}return r}function f_e(e,r){let o=e.service;o!==void 0&&($n(r,8),$n(r,o));let s=e.vendor;s!==void 0&&($n(r,16),$n(r,s));let c=e.token;c!==void 0&&($n(r,26),Ih(r,c));let u=e.callbackUrl;u!==void 0&&($n(r,34),Ih(r,u))}function p_e(e){let r=Ah(e),o=e.limit;return e.limit=e.offset+r,o}function i$(e,r){switch(r){case 0:for(;128&l$(e););break;case 2:LM(e,Ah(e));break;case 5:LM(e,4);break;case 1:LM(e,8);break;default:throw new Error("Unimplemented type: "+r)}}let m_e=new Float32Array(1);new Uint8Array(m_e.buffer);let DM=new Float64Array(1),wa=new Uint8Array(DM.buffer);function sS(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let o$=[];function s$(){const e=o$.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function g_e(e){o$.push(e)}function LM(e,r){if(e.offset+r>e.limit)throw new Error("Skip past limit");e.offset+=r}function a$(e){return e.offset>=e.limit}function aS(e,r){let o=e.bytes,s=e.offset,c=e.limit,u=s+r;if(u>o.length){let h=new Uint8Array(2*u);h.set(o),e.bytes=h}return e.offset=u,u>c&&(e.limit=u),s}function xM(e,r){let o=e.offset;if(o+r>e.limit)throw new Error("Read past limit");return e.offset+=r,o}function c$(e,r){let o=xM(e,r),s=String.fromCharCode,c=e.bytes,u="",h="";for(let m=0;m<r;m++){let _,y,S,R,P=c[m+o];(128&P)==0?h+=s(P):(224&P)==192?m+1>=r?h+=u:(_=c[m+o+1],(192&_)!=128?h+=u:(R=(31&P)<<6|63&_,R<128?h+=u:(h+=s(R),m++))):(240&P)==224?m+2>=r?h+=u:(_=c[m+o+1],y=c[m+o+2],(49344&(_|y<<8))!=32896?h+=u:(R=(15&P)<<12|(63&_)<<6|63&y,R<2048||R>=55296&&R<=57343?h+=u:(h+=s(R),m+=2))):(248&P)==240?m+3>=r?h+=u:(_=c[m+o+1],y=c[m+o+2],S=c[m+o+3],(12632256&(_|y<<8|S<<16))!=8421504?h+=u:(R=(7&P)<<18|(63&_)<<12|(63&y)<<6|63&S,R<65536||R>1114111?h+=u:(R-=65536,h+=s(55296+(R>>10),56320+(1023&R)),m+=3))):h+=u}return h}function Ih(e,r){let o=r.length,s=0;for(let h=0;h<o;h++){let m=r.charCodeAt(h);m>=55296&&m<=56319&&h+1<o&&(m=(m<<10)+r.charCodeAt(++h)-56613888),s+=m<128?1:m<2048?2:m<65536?3:4}$n(e,s);let c=aS(e,s),u=e.bytes;for(let h=0;h<o;h++){let m=r.charCodeAt(h);m>=55296&&m<=56319&&h+1<o&&(m=(m<<10)+r.charCodeAt(++h)-56613888),m<128?u[c++]=m:(m<2048?u[c++]=m>>6&31|192:(m<65536?u[c++]=m>>12&15|224:(u[c++]=m>>18&7|240,u[c++]=m>>12&63|128),u[c++]=m>>6&63|128),u[c++]=63&m|128)}}function __e(e,r){let o=aS(e,r.limit),s=e.bytes,c=r.bytes;for(let u=0,h=r.limit;u<h;u++)s[u+o]=c[u]}function l$(e){return e.bytes[xM(e,1)]}function u$(e,r){let o=aS(e,1);e.bytes[o]=r}function MM(e){let r=xM(e,8),o=e.bytes;return wa[0]=o[r++],wa[1]=o[r++],wa[2]=o[r++],wa[3]=o[r++],wa[4]=o[r++],wa[5]=o[r++],wa[6]=o[r++],wa[7]=o[r++],DM[0]}function UM(e,r){let o=aS(e,8),s=e.bytes;DM[0]=r,s[o++]=wa[0],s[o++]=wa[1],s[o++]=wa[2],s[o++]=wa[3],s[o++]=wa[4],s[o++]=wa[5],s[o++]=wa[6],s[o++]=wa[7]}function Ah(e){let r,o=0,s=0;do r=l$(e),o<32&&(s|=(127&r)<<o),o+=7;while(128&r);return s}function $n(e,r){for(r>>>=0;r>=128;)u$(e,127&r|128),r>>>=7;u$(e,r)}function Wm(e,r){let o=r.low>>>0,s=(r.low>>>28|r.high<<4)>>>0,c=r.high>>>24,u=c===0?s===0?o<16384?o<128?1:2:o<1<<21?3:4:s<16384?s<128?5:6:s<1<<21?7:8:c<128?9:10,h=aS(e,u),m=e.bytes;switch(u){case 10:m[h+9]=c>>>7&1;case 9:m[h+8]=u!==9?128|c:127&c;case 8:m[h+7]=u!==8?s>>>21|128:s>>>21&127;case 7:m[h+6]=u!==7?s>>>14|128:s>>>14&127;case 6:m[h+5]=u!==6?s>>>7|128:s>>>7&127;case 5:m[h+4]=u!==5?128|s:127&s;case 4:m[h+3]=u!==4?o>>>21|128:o>>>21&127;case 3:m[h+2]=u!==3?o>>>14|128:o>>>14&127;case 2:m[h+1]=u!==2?o>>>7|128:o>>>7&127;case 1:m[h]=u!==1?128|o:127&o}}function d$(e,r){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),o.push.apply(o,s)}return o}const E_e=new Map([["moderation",1],["supervise",2]]);class y_e extends Pr{get connectionState(){return this._connectionState}set connectionState(r){if(this._connectionState===r)return;const o=this._connectionState;this._connectionState=r,this.emit(Zi.CONNECTION_STATE_CHANGE,o,r)}get inspectType(){return this._inspectType}set inspectType(r){var o;this._inspectMode=qa(o=r.map(s=>E_e.get(s)||0)).call(o,(s,c)=>s+c),this._inspectType=r}get quality(){return this._quality}set quality(r){this._quality=r>1?1:r<.1?.1:r,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(r){super(),$(this,"name","AgoraRTCVideoContentInspect"),$(this,"_connectionState",du.CONNECTING),$(this,"_innerConnectionState",void 0),$(this,"sequence",0),$(this,"inspectStartTime",void 0),$(this,"workerManagerConnection",void 0),$(this,"workerConnection",void 0),$(this,"workerMessageLengthLimit",void 0),$(this,"inspectIntervalMinimum",void 0),$(this,"qualityRatio",void 0),$(this,"_connectInfo",void 0),$(this,"_cancelTokenSource",Hs.CancelToken.source()),$(this,"_retryConfig",void 0),$(this,"wmSequence",0),$(this,"inspectInterval",void 0),$(this,"inspectTimer",null),$(this,"ossFilePrefix",void 0),$(this,"extraInfo",void 0),$(this,"_inspectType",void 0),$(this,"_inspectMode",void 0),$(this,"_quality",1),$(this,"qualityTimer",null),$(this,"_inspectId",void 0),$(this,"_needWorkUrlOnly",!1),$(this,"inspectImage",()=>{if(this.connectionState!==du.CONNECTED)throw new Oe(X.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===du.CONNECTED?this.requestToInspectImage():D.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=sr(5,"inspect-"),this.workerMessageLengthLimit=re("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=re("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=re("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=r.interval,this.ossFilePrefix=r.ossFilePrefix,this.extraInfo=r.extraInfo,this.inspectType=r.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new TT("worker-manager-"+this._inspectId,Ei),this.on(Zi.STATE_CHANGE,(o,s)=>{this._innerConnectionState=o,D.debug("[".concat(this._inspectId,"] Inspect operation :").concat(hu[o]," ").concat(s||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new TT("worker-"+this._inspectId,Ei),this.handleWorkerEvents()}async init(r,o){this.emit(Zi.STATE_CHANGE,hu.CONNECT_AP),this._connectInfo=r;const s=this._cancelTokenSource.token;return this._retryConfig=o,new lt((c,u)=>{this.on(Zi.CONNECTION_STATE_CHANGE,(h,m)=>{m===du.CONNECTED&&c()}),this.requestAP(r,s,o).then(h=>{this.connectWorkerManager(h)}).catch(h=>{u(h)})})}async requestAP(r,o,s){const c=re("WEBCS_DOMAIN").map(m=>"https://".concat(m,"/api/v1")),u=await function(m,_,y,S){let{appId:R,areaCode:P,cname:k,sid:z,token:U,uid:V}=_;Xv++;const q="image_moderation_api",Y={service_name:q,json_body:JSON.stringify({appId:R,areaCode:P,cname:k,command:"allocateEdge",requestId:Xv,seq:Xv,sid:z,token:U,ts:Date.now(),uid:V+""})};let ce,_e,Ee=m[0];return hd(async()=>{ce=Date.now();const me=await _d(Ee,{data:Y,cancelToken:y,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(_e=Date.now()-ce,me.code!==0){const pt=new Oe(X.UNEXPECTED_RESPONSE,"image inspect ap error, code"+me.code,{retry:!0,responseTime:_e});throw D.error(pt.toString()),pt}const ke=JSON.parse(me.json_body);if(ke.code!==200){const pt=new Oe(X.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(ke.code,", reason: ").concat(ke.reason),{code:ke.code,responseTime:_e});throw D.error(pt.toString()),pt}if(!ke.servers||!Array.isArray(ke.servers)||ke.servers.length===0){const pt=new Oe(X.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:ke.code,responseTime:_e});throw D.error(pt.toString()),pt}const Ye=re("VIDEO_INSPECT_WORKER_MANAGER_HOST"),ut=re("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:ke.servers.map(pt=>{let{address:vn,wss:Sn}=pt;if(vn&&Sn)return"wss://".concat(vn.replace(/\./g,"-"),".").concat(Ye,":").concat(ut||Sn)}).filter(pt=>!!pt),workerToken:ke.workerToken,vid:ke.vid,responseTime:_e}},(me,ke)=>(wt.apworkerEvent(z,{success:!0,sc:200,serviceName:q,responseDetail:JSON.stringify(me.addressList),firstSuccess:ke===0,responseTime:_e,serverIp:m[ke%m.length]}),!1),(me,ke)=>(wt.apworkerEvent(z,{success:!1,sc:me.data&&me.data.code||200,serviceName:q,responseTime:_e,serverIp:m[ke%m.length]}),!!(me.code!==X.OPERATION_ABORTED&&me.code!==X.UNEXPECTED_RESPONSE||me.data&&me.data.retry)&&(Ee=m[(ke+1)%m.length],!0)),S)}(c,r,o,s);this.emit(Zi.STATE_CHANGE,hu.AP_CONNECTED);const{addressList:h}=u;return this.wmSequence++,h}async connectWorkerManager(r){let o=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=o,this.emit(Zi.STATE_CHANGE,hu.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(r,1e4)}async connectWorker(r){await this.workerConnection.init([r])}handleWorkerManagerEvents(){this.workerManagerConnection.on(qt.CONNECTED,async()=>{this.emit(Zi.STATE_CHANGE,hu.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.23.2",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(qt.CLOSED,()=>{this._innerConnectionState<hu.GET_WORKER_MANAGER_RESPONSE&&D.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(qt.FAILED,()=>{this._innerConnectionState<hu.GET_WORKER_MANAGER_RESPONSE&&D.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(qt.RECONNECTING,()=>{this._innerConnectionState<hu.GET_WORKER_MANAGER_RESPONSE&&D.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(qt.ON_MESSAGE,async r=>{this.emit(Zi.STATE_CHANGE,hu.GET_WORKER_MANAGER_RESPONSE);const o=this.workerManagerConnection.url;this.workerManagerConnection.close();const s=JSON.parse(r.data);if(s.code!==200)throw D.error("[".concat(this._inspectId,"] Unexpected code ").concat(s.code," from worker manager")),new Oe(X.UNEXPECTED_RESPONSE,"response code of worker is unexpected",s);if(!(s.serverResponse&&s.serverResponse.portWss&&o))throw D.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(s))),new Oe(X.UNEXPECTED_RESPONSE,"response content of worker is unexpected",s);{const c=re("VIDEO_INSPECT_WORKER_PORT")||s.serverResponse.portWss,u=o.replace(/:\d+\/?$/,":".concat(c));this.emit(Zi.STATE_CHANGE,hu.CONNECT_WORKER,u),this._needWorkUrlOnly?this.emit(Zi.REQUEST_NEW_WORKER_URL,u):await this.connectWorker(u)}}),this.workerManagerConnection.on(qt.WILL_RECONNECT,(r,o,s)=>{s(r)}),this.workerManagerConnection.on(qt.REQUEST_NEW_URLS,(r,o)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r).catch(o)})}handleWorkerEvents(){this.workerConnection.on(qt.CONNECTED,async()=>{this.emit(Zi.STATE_CHANGE,hu.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=du.CONNECTED}),this.workerConnection.on(qt.ON_MESSAGE,async r=>{if(r.data instanceof ArrayBuffer){const s=d_e(new Uint8Array(r.data));if(re("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&D.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(s)),s.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(Zi.INSPECT_RESULT,void 0,void 0);if(s.data&&s.data.scorePorn&&s.data.scoreSexy&&s.data.scoreNeutral){var o;const c={porn:s.data.scorePorn,sexy:s.data.scoreSexy,neutral:s.data.scoreNeutral},u=qa(o=Object.keys(c)).call(o,(m,_)=>c[m]>c[_]?m:_,"porn"),h=Object.keys(c).find(m=>m===u);this.emit(Zi.INSPECT_RESULT,h)}else this.emit(Zi.INSPECT_RESULT,void 0,new Oe(X.UNEXPECTED_RESPONSE,s.code+"","There is an unexpected data on message"))}else this.emit(Zi.INSPECT_RESULT,void 0,new Oe(X.UNEXPECTED_RESPONSE,s.code+"",s.msg))}else D.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(Zi.INSPECT_RESULT,void 0,new Oe(X.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(qt.CLOSED,()=>{this.connectionState=du.CLOSED}),this.workerConnection.on(qt.FAILED,()=>{this.connectionState=du.CLOSED}),this.workerConnection.on(qt.RECONNECTING,()=>{this.connectionState=this.connectionState===du.CONNECTED?du.RECONNECTING:du.CONNECTING}),this.workerConnection.on(qt.WILL_RECONNECT,(r,o,s)=>{r==="recover"&&s(r),s("tryNext")}),this.workerConnection.on(qt.REQUEST_NEW_URLS,(r,o)=>{this.workerManagerConnection.close(),this.once(Zi.REQUEST_NEW_WORKER_URL,s=>{r([s])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(s=>{this.connectWorkerManager(s,!0)}).catch(s=>{o(s)})})}async requestToInspectImage(){this.sequence++;const r=kc(this,Zi.CLIENT_LOCAL_VIDEO_TRACK),o={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(r){if(!r.isPlaying)return void this.emit(Zi.INSPECT_RESULT,void 0,new Oe(X.INVALID_OPERATION,"Only the track being played can be inspected"));const s=await this.generateRequestData(r,o);this.workerConnection.sendMessage(s,!0,!0)}else this.emit(Zi.INSPECT_RESULT,void 0,new Oe(X.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(r,o){let{appId:s,cname:c,cid:u,vid:h,sid:m,uid:_}=o;const y=Date.now(),S=await r.getCurrentFrameImage("image/jpeg",this.quality),R=await $8(S,s,c),P=this.sequence+"-"+u+"-"+_+"-"+y+"-"+sr(12,""),k={appId:s,cid:u,cname:c,deviceId:"",elapse:(z=Number(y-this.inspectStartTime),{low:z|=0,high:z>>31,unsigned:z>=0}),fileSize:R.byteLength,jpgEncryption:2,height:S.height,width:S.width,jpg:R,networkType:6,osType:7,requestId:P,sdkVersion:"4.23.2",sequence:this.sequence,sid:m,timestamp:y9(y),uid:_,vid:h,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var z;this.extraInfo===void 0&&delete k.callbackData,this.ossFilePrefix===void 0&&delete k.ossFilePrefix;const U=u_e(k);if(U.byteLength<this.workerMessageLengthLimit){if(re("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const V=function(q){for(var Y=1;Y<arguments.length;Y++){var ce=arguments[Y]!=null?arguments[Y]:{};Y%2?d$(Object(ce),!0).forEach(function(_e){$(q,_e,ce[_e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(q,Object.getOwnPropertyDescriptors(ce)):d$(Object(ce)).forEach(function(_e){Object.defineProperty(q,_e,Object.getOwnPropertyDescriptor(ce,_e))})}return q}({},k);delete V.jpg,D.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(V))}return U}{const V=this.quality*this.qualityRatio;return this.quality=V,await this.generateRequestData(r,{appId:s,cname:c,cid:u,vid:h,sid:m,uid:_})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Hs.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=du.CLOSED,this.emit(Zi.STATE_CHANGE,hu.CLOSED)}}const v_e={name:"ContentInspect",create:function(e){let{config:r}=e;return function(o){if(!o)throw new Oe(X.INVALID_PARAMS,"inspectConfig is necessary.");if(!o.inspectType||!Array.isArray(o.inspectType))throw new Oe(X.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const s=[...new Set(o.inspectType)];s.forEach(c=>{var u;if(!st(u=["supervise","moderation"]).call(u,c))throw new Oe(X.INVALID_PARAMS,"".concat(c," is not a valid inspect type."))}),o.inspectType=s}if(o&&o.extraInfo&&o.extraInfo.length>1024)throw new Oe(X.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(r),new y_e(r)}};var h$=l(St.Object.getOwnPropertySymbols),S_e=xn,b_e=Fs.indexOf,T_e=_f,VM=se([].indexOf),f$=!!VM&&1/VM([1],1,-0)<0;S_e({target:"Array",proto:!0,forced:f$||!T_e("indexOf")},{indexOf:function(e){var r=arguments.length>1?arguments[1]:void 0;return f$?VM(this,e,r)||0:b_e(this,e,r)}});var w_e=Ka("Array").indexOf,R_e=N,C_e=w_e,FM=Array.prototype,I_e=function(e){var r=e.indexOf;return e===FM||R_e(FM,e)&&r===FM.indexOf?C_e:r},p$=l(I_e);function A_e(e,r){if(e==null)return{};var o,s,c=function(h,m){if(h==null)return{};var _,y,S={},R=LG(h);for(y=0;y<R.length;y++)_=R[y],p$(m).call(m,_)>=0||(S[_]=h[_]);return S}(e,r);if(h$){var u=h$(e);for(s=0;s<u.length;s++)o=u[s],p$(r).call(r,o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(c[o]=e[o])}return c}let m$=class{get localCapabilities(){return Mr(this._localCapabilities)}get rtpCapabilities(){return Mr(this._rtpCapabilities)}get candidates(){return Mr(this._candidates)}get iceParameters(){return Mr(this._iceParameters)}get dtlsParameters(){return Mr(this._dtlsParameters)}constructor(e){$(this,"sessionDesc",void 0),$(this,"_localCapabilities",void 0),$(this,"_rtpCapabilities",void 0),$(this,"_candidates",void 0),$(this,"_iceParameters",void 0),$(this,"_dtlsParameters",void 0),$(this,"setup",void 0),$(this,"currentMidIndex",void 0),$(this,"cname","o/i14u9pJrxRKAsu"),$(this,"firefoxSsrcMidMap",new Map),e=Mr(e);const{remoteIceParameters:r,remoteDtlsParameters:o,candidates:s,remoteRTPCapabilities:c,localCapabilities:u,direction:h,setup:m,videoCodec:_,audioCodec:y}=e;let S;this.setup=m,S=h===bs.RECEIVE_ONLY?Sa(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):Sa(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=c,this._candidates=s,this._iceParameters=r,this._dtlsParameters=o,this._localCapabilities=u;const R=h===bs.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,P=h===bs.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,k=h===bs.RECEIVE_ONLY?c.send.videoCodecs:CT(gt.VIDEO,R,P,_),z=h===bs.RECEIVE_ONLY?c.send.audioCodecs:CT(gt.AUDIO,R,P,y);for(const U of S.mediaDescriptions)U.attributes.iceUfrag=r.iceUfrag,U.attributes.icePwd=r.icePwd,U.attributes.fingerprints=o.fingerprints,U.attributes.candidates=s,U.attributes.setup=this.setup,U.media.mediaType==="application"&&(U.attributes.sctpPort="5000"),U.media.mediaType==="video"&&(U.media.fmts=k.map(V=>V.payloadType.toString(10)),U.attributes.payloads=k,U.attributes.extmaps=R.videoExtensions),U.media.mediaType==="audio"&&(U.media.fmts=z.map(V=>V.payloadType.toString(10)),U.attributes.payloads=z,U.attributes.extmaps=R.audioExtensions,Yv(U));this.sessionDesc=S,this.currentMidIndex=S.mediaDescriptions.length-1}toString(){return Im(this.sessionDesc)}hasMid(e){return Array.isArray(e)?e.every(r=>this.hasMid(r)):this.sessionDesc.mediaDescriptions.some(r=>r.attributes.mid===e)}send(e,r,o,s,c){o=o.replace(/ /g,"-");const{ssrcs:u,ssrcGroups:h}=U_(r,this.cname,re("SYNC_GROUP")?o:void 0),m=this.findPreloadMediaDesc(u);if(m){if(Dr()&&this.firefoxSsrcMidMap.set(u[0].ssrcId,m.attributes.mid),c&&(c.twcc||c.remb)){const _=this.sessionDesc.mediaDescriptions.indexOf(m);return this.sessionDesc.mediaDescriptions[_]=this.mungSendMediaDesc(m,c),{mid:m.attributes.mid,needExchangeSDP:!0}}return{mid:m.attributes.mid,needExchangeSDP:!1}}{const _=this.findAvailableMediaIndex(e,u,s);let y;return _===-1?(y=this.createOrRecycleSendMedia(e,u,h,"sendonly",s,c),this.updateBundleMids()):(y=Mr(this.sessionDesc.mediaDescriptions[_]),y.attributes.direction="sendonly",y.attributes.ssrcs=u,y.attributes.ssrcGroups=h,this.sessionDesc.mediaDescriptions[_]=this.mungSendMediaDesc(y,c)),Dr()&&this.firefoxSsrcMidMap.set(u[0].ssrcId,y.attributes.mid),{needExchangeSDP:!0,mid:y.attributes.mid}}}stopSending(e){const r=this.sessionDesc.mediaDescriptions.filter(o=>o.attributes.mid&&e.indexOf(o.attributes.mid)!==-1);if(r.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");r.forEach(o=>{o.attributes.ssrcs=[]}),this.updateBundleMids()}receive(e,r,o){const s=[];return e.forEach(c=>{const u=c._mediaStreamTrack.kind,h=this.findAvailableRecvMediaIndex(u);let m,_=!1;h===-1?(_=!0,m=this.createOrRecycleRecvMedia(c,[],"recvonly",r,o),this.updateBundleMids()):(m=Mr(this.sessionDesc.mediaDescriptions[h]),m.attributes.direction="recvonly"),s.push({mid:m.attributes.mid,needCreateTransceiver:_})}),s}stopReceiving(e){const r=this.sessionDesc.mediaDescriptions.filter(o=>e.indexOf(o.attributes.mid)!==-1);if(r.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");r.forEach(o=>{o.media.port="0",o.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(e){const{foundation:r,protocol:o,address:s,port:c,type:u,relatedAddress:h,relatedPort:m,priority:_}=new RTCIceCandidate(e),y={foundation:r??"",componentId:"1",transport:o??"",priority:_?_+"":"",connectionAddress:s??"",port:c?c+"":"",type:u?u+"":"",relAddr:h??"",relPort:m?m+"":"",extension:{}};this.candidates.some(S=>S.priority===y.priority&&S.connectionAddress===y.connectionAddress&&S.port===y.port)||(this._candidates.push(y),this.sessionDesc.mediaDescriptions.forEach(S=>{S.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(e,r,o,s,c){const u=e._mediaStreamTrack.kind,h=this.rtpCapabilities.recv,m=CT(u,h,this.localCapabilities.send,u===gt.AUDIO?c:s),_=u===gt.VIDEO?h.videoExtensions:h.audioExtensions,y="".concat(++this.currentMidIndex);let S={media:{mediaType:u,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:m.map(P=>P.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:_,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:m,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:o,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(y)}};S=this.mungRecvMediaDsec(S,e);const R=this.findFirstClosedMedia(u);if(R){const P=this.sessionDesc.mediaDescriptions.indexOf(R);this.sessionDesc.mediaDescriptions[P]=S}else this.sessionDesc.mediaDescriptions.push(S);return S}muteRemote(e){const r=this.sessionDesc.mediaDescriptions.filter(o=>st(e).call(e,o.attributes.mid||""));if(r.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");r.forEach(o=>{o.attributes.direction="inactive"})}unmuteRemote(e){const r=this.sessionDesc.mediaDescriptions.filter(o=>st(e).call(e,o.attributes.mid||""));if(r.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");r.forEach(o=>{o.attributes.direction="recvonly"})}findAvailableMediaIndex(e,r,o){return this.sessionDesc.mediaDescriptions.findIndex(s=>{const c=s.media.mediaType===e&&s.media.port!=="0"&&(s.attributes.direction==="sendonly"||s.attributes.direction==="sendrecv")&&s.attributes.ssrcs.length===0;if(Dr()){if(c){const u=this.firefoxSsrcMidMap.get(r[0].ssrcId);return!(u||s.attributes.mid!=="0"&&s.attributes.mid!=="1")||!(!u||u!==s.attributes.mid)}return!1}return c&&s.attributes.mid===o})}findAvailableRecvMediaIndex(e){return this.sessionDesc.mediaDescriptions.findIndex(r=>{const o=r.media.mediaType===e&&r.media.port!=="0"&&(r.attributes.direction==="recvonly"||r.attributes.direction==="sendrecv");return r.attributes.mid!=="0"&&r.attributes.mid!=="1"&&o})}predictReceivingMids(e){const r=[];for(let o=0;o<e;o++)r.push((this.currentMidIndex+o+1).toString(10));return r}restartICE(e){e=Mr(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(r=>{r.attributes.iceUfrag=e.iceUfrag,r.attributes.icePwd=e.icePwd})}createOrRecycleSendMedia(e,r,o,s,c,u){const h=this.rtpCapabilities.send,m=e===gt.VIDEO?h.videoCodecs:h.audioCodecs,_=e===gt.VIDEO?h.videoExtensions:h.audioExtensions;Dr()&&(c="".concat(++this.currentMidIndex));let y={media:{mediaType:e,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:m.map(R=>R.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:_,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r,ssrcGroups:o,rtcpFeedbackWildcards:[],payloads:m,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:s,rtcpMux:!0,rtcpRsize:!0,mid:c}};y=this.mungSendMediaDesc(y,u);const S=this.findFirstClosedMedia(e);if(S){const R=this.sessionDesc.mediaDescriptions.indexOf(S);this.sessionDesc.mediaDescriptions[R]=y}else this.sessionDesc.mediaDescriptions.push(y);return y}mungRecvMediaDsec(e,r,o){const s=Mr(e);return jx(s),qv(s,r),Bx(s,r),oH(s),dP(s,o,this.localCapabilities.send),s}mungSendMediaDesc(e,r){const o=Mr(e);return dP(o,r,this.localCapabilities.recv),Yv(o),o}updateRecvMedia(e,r){const o=this.sessionDesc.mediaDescriptions.findIndex(s=>s.attributes.mid===e);if(o!==-1){const s=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[o],r);this.sessionDesc.mediaDescriptions[o]=s}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>e.media.port!=="0").map(e=>e.attributes.mid)}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(r=>{var o;return((o=r.attributes)===null||o===void 0||(o=o.ssrcs[0])===null||o===void 0?void 0:o.ssrcId)===e[0].ssrcId})}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(r=>Dr()?r.media.port==="0"&&r.media.mediaType===e:r.media.port==="0")}};const P_e=["sdp"];var hr;function g$(e,r){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),o.push.apply(o,s)}return o}function zm(e){for(var r=1;r<arguments.length;r++){var o=arguments[r]!=null?arguments[r]:{};r%2?g$(Object(o),!0).forEach(function(s){$(e,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):g$(Object(o)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(o,s))})}return e}let _$=(hr=class SS extends jG{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var r,o;return(r=(o=this.peerConnection.getReceivers()[0])===null||o===void 0||(o=o.transport)===null||o===void 0?void 0:o.state)!==null&&r!==void 0?r:null}get localCodecs(){return[]}set isInRestartIce(r){this._isInRestartIce=r}get isInRestartIce(){return this._isInRestartIce}constructor(r,o,s){super(r,o),$(this,"direction",void 0),$(this,"name",void 0),$(this,"store",void 0),$(this,"spec",void 0),$(this,"peerConnection",void 0),$(this,"initialOffer",void 0),$(this,"transport",void 0),$(this,"statsFilter",void 0),$(this,"localCandidateCount",0),$(this,"_isInRestartIce",!1),$(this,"mutex",void 0),$(this,"onLocalCandidate",void 0),$(this,"remoteSDP",void 0),$(this,"pendingCandidates",[]),$(this,"localCapabilities",void 0),$(this,"isReady",!1),$(this,"restartCnt",0),$(this,"curTurnServerIndex",0),this.store=o,this.spec=r,this.mutex=new Oo("P2PConnection-mutex",o.clientId),this.peerConnection=new RTCPeerConnection(SS.resolvePCConfiguration(r,o.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=s??bs.SEND_ONLY,this.name=this.direction===bs.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=ex(this.peerConnection,re("STATS_UPDATE_INTERVAL"),void 0,Dr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(r){try{const o=await aH();if(this.localCapabilities=hP(o),r){const{sdp:s}=r,c=A_e(r,P_e),u=function(){const S={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},R=RT(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),P={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},k={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},z={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(fu(R,S,"videoExtensions",P,k,z),fu(R,S,"videoCodecs",P,k,z),fu(R,S,"audioExtensions",P,k,z),fu(R,S,"audioCodecs",P,k,z),re("RAISE_H264_BASELINE_PRIORITY")){const U=z.videoCodecs.findIndex(V=>V.rtpMap&&V.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&V.fmtp&&V.fmtp.parameters["profile-level-id"]==="42001f");if(U!==-1){const V=z.videoCodecs.findIndex(q=>q.rtpMap&&q.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(V<U){D.debug("raising H264 baseline profile priority");const q=z.videoCodecs[U];z.videoCodecs.splice(U,1),z.videoCodecs.splice(V,0,q)}V!==-1&&re("FILTER_SEND_H264_BASELINE")&&(P.videoCodecs=P.videoCodecs.filter(q=>!(q.rtpMap&&q.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&q.fmtp&&q.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:P,recv:k,sendrecv:z}}({},{},s);this.remoteSDP=new m$({remoteIceParameters:c.iceParameters,remoteDtlsParameters:c.dtlsParameters,candidates:[],remoteRTPCapabilities:u,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const h=await this.peerConnection.createAnswer();if(!h.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const m=Nm(h.sdp);await this.peerConnection.setLocalDescription(h);const _=await cH({},{},h.sdp);this.localCapabilities=hP(_);const y=this.peerConnection.getTransceivers()[0];return y!=null&&y.receiver&&y.receiver.transport&&this.tryBindTransportEvents(y.receiver.transport),zm(zm({},m),{},{sdp:h.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const s=await this.peerConnection.createOffer();if(!s.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const c=Nm(s.sdp);return this.initialOffer=s,zm(zm({},c),{},{sdp:s.sdp})}}catch(o){throw new Le(X.GET_LOCAL_CONNECTION_PARAMS_FAILED,o.toString())}}async connect(r){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:o,iceParameters:s,dtlsParameters:c}=r,u=await cH({},{},o);this.remoteSDP=new m$({remoteIceParameters:s,remoteDtlsParameters:c,candidates:[],remoteRTPCapabilities:u,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const h=this.peerConnection.getTransceivers()[0];h!=null&&h.sender&&h.sender.transport&&this.tryBindTransportEvents(h.sender.transport)}catch(o){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(o.toString()))}}async addRemoteCandidate(r){try{r&&this.pendingCandidates.push(r),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(o=>{this.peerConnection.addIceCandidate(o)}),this.pendingCandidates=[])}catch(o){throw new Le(X.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(o.toString()))}}send(r,o,s){var c=this;return ml(function*(){const u=yield wn(c.mutex.lock("From P2PConnection.send"));try{if(!c.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const h=[],m=c.remoteSDP.receive(r,o,s);r.forEach((V,q)=>{if(m[q].needCreateTransceiver){const Y=c.peerConnection.addTransceiver(V._mediaStreamTrack,{direction:"sendonly"});h.push(Y),V._updateRtpTransceiver(Y)}else{const Y=c.peerConnection.getTransceivers().find(ce=>ce.mid===m[q].mid);if(!Y)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(m[q].mid));h.push(Y),V._updateRtpTransceiver(Y)}}),Dr()&&re("SIMULCAST")===!0&&(yield wn(c.applySimulcastForFirefox(h,r)));const _=m.map(V=>V.mid),y=yield wn(c.peerConnection.createOffer()),S=c.mungSendOfferSDP(y.sdp,r,_),R=Sa(S),P=_.map(V=>{const q=R.mediaDescriptions.find(Y=>Y.attributes.mid===V);if(!q)throw new Error("Cannot extract ssrc from mediaDescription.");return nH(q,re("USE_PUB_RTX"))}),k=h.map((V,q)=>{const Y=_[q];return{localSSRC:P[q],id:Y}});yield wn(c.peerConnection.setLocalDescription({type:"offer",sdp:S}));try{yield k}catch(V){const q=c.remoteSDP.toString();throw yield wn(c.peerConnection.setLocalDescription({type:"offer",sdp:S})),yield wn(c.peerConnection.setRemoteDescription({type:"answer",sdp:q})),yield wn(c.stopSending(_,!0)),V}yield wn(c.applySimulcastEncodings(h,r)),yield wn(c.applySendEncodings(h,r));const z=c.remoteSDP.toString(),U=c.logSDPExchange(S,"offer","local","send");return U==null||U(z),yield wn(c.setRemoteDescription({type:"answer",sdp:z})),h.map((V,q)=>{const Y=_[q];return{localSSRC:P[q],id:Y}})}catch(h){throw h instanceof Le?h:new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{u()}})()}async stopSending(r,o){const s=o?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const c=this.peerConnection.getTransceivers().filter(_=>r.indexOf(_.mid)!==-1);if(c.length!==r.length)throw new Error("Transceivers' length (".concat(c.length,") doesn't match mids' length (").concat(r.length,") when trying to call P2PConnection.stopSending."));c.map(_=>{var y;_.direction="inactive",(y=_.stop)===null||y===void 0||y.call(_)});const u=await this.peerConnection.createOffer(),h=this.logSDPExchange(u.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(u),this.remoteSDP.stopReceiving(r);const m=this.remoteSDP.toString();h==null||h(m),await this.setRemoteDescription({type:"answer",sdp:m})}catch(c){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(c.toString()))}finally{s&&s()}}async receive(r,o,s,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{mid:u,needExchangeSDP:h}=this.remoteSDP.send(r,o,s,c);if(h){const _=this.remoteSDP.toString(),y=this.logSDPExchange(_,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:_});const S=await this.peerConnection.createAnswer(),R=this.mungReceiveAnswerSDP(S.sdp,u,r);y==null||y(R||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:R}),D.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," by exchanging SDP."))}else D.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," no need to exchange SDP."));const m=this.peerConnection.getTransceivers().find(_=>_.mid===u);if(!m||m.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:m.receiver.track,mid:m.mid,transceiver:m}}catch(u){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async mockReceive(r,o,s,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{mid:u,needExchangeSDP:h}=this.remoteSDP.send(r,o,s,c);if(h){const m=this.remoteSDP.toString(),_=this.logSDPExchange(m,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:m});const y=await this.peerConnection.createAnswer(),S=this.mungReceiveAnswerSDP(y.sdp,u,r);_==null||_(S||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:S}),D.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," by exchanging SDP."))}else D.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," no need to exchange SDP."))}catch(u){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async stopReceiving(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(r);const o=this.remoteSDP.toString(),s=this.logSDPExchange(o,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:o});const c=await this.peerConnection.createAnswer();s==null||s(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(o){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(o.toString()))}}async restartICE(r){try{if(this.store.p2pTransport===P_.Auto&&(this.store.p2pTransport=P_.SdRtn,kn().supportPCSetConfiguration&&this.peerConnection.setConfiguration(SS.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,kn().supportPCSetConfiguration&&this.peerConnection.setConfiguration(SS.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!r){this.restartCnt++,this.isReady=!1;const o=await this.peerConnection.createOffer({iceRestart:!0});if(!o.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:s}=Nm(o.sdp);return this.store.descriptionStart(),this.direction===bs.SEND_ONLY&&await this.peerConnection.setLocalDescription(o),s}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(r),this.store.descriptionStart(),this.direction===bs.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const o=await this.peerConnection.createAnswer();if(!o.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:s}=Nm(o.sdp);return await this.peerConnection.setLocalDescription(o),s}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(o){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(o.toString()))}}close(){var r;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}async updateEncoderConfig(r,o){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const s=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(s.sdp,[o],[r]);this.remoteSDP.updateRecvMedia(r,o);const u=this.remoteSDP.toString(),h=this.logSDPExchange(c,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),h==null||h(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(s){throw new Le(X.EXCHANGE_SDP_FAILED,s.toString())}}async updateSendParameters(r,o){const s=this.peerConnection.getTransceivers().filter(c=>c.mid===r);s.length===1&&(this.isVP8Simulcast(o)?Dr()||await this.applySimulcastEncodings(s,[o]):await this.applySendEncodings(s,[o]))}setStatsRemoteVideoIsReady(r,o){this.statsFilter.setVideoIsReady2(r,o)}async replaceTrack(r,o){const s=this.peerConnection.getTransceivers().find(c=>c.mid===o);s&&await s.sender.replaceTrack(r._mediaStreamTrack)}async getSelectedCandidatePair(){const r=this.peerConnection.getReceivers();if(r.length>0&&r[0].transport&&r[0].transport.iceTransport&&r[0].transport.iceTransport.getSelectedCandidatePair&&r[0].transport.iceTransport.getSelectedCandidatePair()){const o=r[0].transport.iceTransport,{local:s,remote:c}=o.getSelectedCandidatePair();return{local:zm(zm({},ph),{},{candidateType:s.type,protocol:s.protocol,address:s.address,port:s.port}),remote:zm(zm({},ph),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r,o;st(r=["connected","completed"]).call(r,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(o=this.onICEConnectionStateChange)===null||o===void 0||o.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=r=>{if(r.candidate){var o;r.candidate.candidate&&((o=this.onLocalCandidate)===null||o===void 0||o.call(this,r.candidate.toJSON())),this.localCandidateCount+=1}else D.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r,o){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const c={iceServers:[]};var u;return r.iceServers?c.iceServers=r.iceServers:r.turnServer&&r.turnServer.mode!=="off"&&(hT(r.turnServer.servers)?c.iceServers=r.turnServer.servers:(c.iceServers&&c.iceServers.push(...SS.turnServerConfigToIceServers(r.turnServer.servers,o,s)),re("USE_TURN_SERVER_OF_GATEWAY")&&c.iceServers&&r.turnServer.serversFromGateway&&c.iceServers.push(...SS.turnServerConfigToIceServers(r.turnServer.serversFromGateway,o,s)),st(u=[P_.Relay,P_.SdRtn]).call(u,o)&&(c.iceTransportPolicy="relay"),re("FORCE_TURN_TCP")?c.iceTransportPolicy="relay":r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(h=>{h.forceturn&&(c.iceTransportPolicy="relay")}))),re("ENABLE_ENCODED_TRANSFORM")&&kn().supportWebRTCEncodedTransform&&(c.encodedInsertableStreams=!0),D.debug("P2PConnection p2pTransport is ".concat(o)),c}static turnServerConfigToIceServers(r,o){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const c=[],u=r.filter(m=>m.tcpport);D.debug("P2PConnection turnServers is ".concat(u,", current index is ").concat(s));const h=u.length>s?u[s]:u[0];switch(o){case P_.SdRtn:const m=r.filter(y=>{var S;return st(S=y.username).call(S,"glb:")&&y.turnServerURL==y.turnServerURL}),_=m.length>s?m[s]:m[0];_&&(c.push({username:_.username,credential:_.password,credentialType:"password",urls:"turn:".concat(Om(_.turnServerURL),":").concat(_.tcpport,"?transport=udp")}),c.push({username:_.username,credential:_.password,credentialType:"password",urls:"turns:".concat(Om(_.turnServerURL),":").concat(_.tcpport,"?transport=tcp")}));break;case P_.Relay:h&&(c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(h.turnServerURL,":").concat(h.tcpport,"?transport=udp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat(Om(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}));break;default:h&&(c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(h.turnServerURL,":").concat(h.tcpport,"?transport=udp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat(Om(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"stun:".concat(h.turnServerURL,":").concat(h.tcpport)}))}return c}tryBindTransportEvents(r){if(r){this.transport=r,r.onstatechange=()=>{var s;r!=null&&r.state&&((s=this.onDTLSTransportStateChange)===null||s===void 0||s.call(this,r.state))},r.onerror=s=>{var c;(c=this.onDTLSTransportError)===null||c===void 0||c.call(this,"error"in s?s.error:s)};const o=r.iceTransport;o&&(o.onstatechange=()=>{const s=r==null?void 0:r.iceTransport.state;var c;s&&((c=this.onICETransportStateChange)===null||c===void 0||c.call(this,s))},o.getSelectedCandidatePair&&(o.onselectedcandidatepairchange=()=>{if(o.getSelectedCandidatePair()){const{local:s,remote:c}=o.getSelectedCandidatePair();D.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:s.type,protocol:s.protocol}),", remote ").concat(JSON.stringify({candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})," )"))}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(r,o){var s;if(o||(o=this.peerConnection.getSenders().find(S=>S.track===r._mediaStreamTrack)),!o)return D.warn("[".concat(r.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(r))return D.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!kn().supportSetRtpSenderParameters)return D.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const c={},u={};switch(r._optimizationMode){case"motion":c.degradationPreference="maintain-framerate";break;case"detail":c.degradationPreference="maintain-resolution";break;default:c.degradationPreference="balanced"}if(r._encoderConfig){var h;const{bitrateMax:S,frameRate:R,scaleResolutionDownBy:P}=r._encoderConfig;S&&(u.maxBitrate=1e3*S),st(h=r._hints).call(h,ar.LOW_STREAM)&&(R&&(u.maxFramerate=nc(R)),P&&P>=1&&(u.scaleResolutionDownBy=P))}if(re("DSCP_TYPE")&&zf()){var m;const S=re("DSCP_TYPE");st(m=["very-low","low","medium","high"]).call(m,S)&&(u.networkPriority=S)}const _=o.getParameters(),y=(s=_.encodings)===null||s===void 0?void 0:s[0];Dr()&&!y&&(c.encodings=[u]),y&&Object.assign(y,u),Object.assign(_,c),D.debug("[".concat(r.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(_.encodings))),await o.setParameters(_)}async applySendEncodings(r,o){try{if(!kn().supportSetRtpSenderParameters||r.length!==o.length)return;for(let s=0;s<r.length;s++){const c=r[s],u=o[s];u instanceof mr&&!this.isVP8Simulcast(u)&&await this.updateRtpSenderEncodings(u,c.sender)}}catch{D.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(r,o,s){const c=Sa(r);return o.forEach((u,h)=>{const m=s[h],_=c.mediaDescriptions.find(y=>y.attributes.mid===m);_&&(qv(_,u),sH(_,u,this.store.codec))}),Im(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var o;(o=this.onFirstAudioReceived)===null||o===void 0||o.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var o;(o=this.onFirstVideoReceived)===null||o===void 0||o.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var o;(o=this.onFirstAudioDecoded)===null||o===void 0||o.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,o,s)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,r,o,s)},this.statsFilter.onSelectedLocalCandidateChanged=(r,o)=>{var s;(s=this.onSelectedLocalCandidateChanged)===null||s===void 0||s.call(this,r,o)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,o)=>{var s;(s=this.onSelectedRemoteCandidateChanged)===null||s===void 0||s.call(this,r,o)},this.statsFilter.onFirstVideoDecodedTimeout=r=>{var o;(o=this.onFirstVideoDecodedTimeout)===null||o===void 0||o.call(this,r)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(r,o){if(r.length===o.length)for(let _=0;_<r.length;_++){var s,c,u,h,m;const y=r[_],S=o[_];if(S instanceof mr&&!st(s=S._hints).call(s,ar.LOW_STREAM)&&(c=S._encoderConfig)!==null&&c!==void 0&&c.bitrateMax&&((u=S._encoderConfig)===null||u===void 0?void 0:u.bitrateMax)>200&&(h=S._scalabilityMode)!==null&&h!==void 0&&h.numSpatialLayers&&((m=S._scalabilityMode)===null||m===void 0?void 0:m.numSpatialLayers)>1&&this.store.codec==="vp8"){const R={},P={high:1e3*(S._encoderConfig.bitrateMax-50),medium:5e4};R.encodings=[{rid:"m",active:!0,maxBitrate:P.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:P.high}];const k=y.sender.getParameters();await y.sender.setParameters(Object.assign(k,R))}}}async applySimulcastEncodings(r,o){if(!Dr()&&r.length===o.length)for(let s=0;s<r.length;s++){const c=o[s];if(c instanceof mr&&this.isVP8Simulcast(c)){const u=r[s],h={},m={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};h.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];const _=u.sender.getParameters();await u.sender.setParameters(Object.assign(_,h))}}}isVP8Simulcast(r){var o,s,c,u,h;return!!(r instanceof mr&&re("SIMULCAST")&&this.store.codec==="vp8"&&!st(o=r._hints).call(o,ar.LOW_STREAM)&&(s=r._encoderConfig)!==null&&s!==void 0&&s.bitrateMax&&((c=r._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(u=r._scalabilityMode)!==null&&u!==void 0&&u.numSpatialLayers&&((h=r._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1)}logSDPExchange(r,o,s,c){if(re("SDP_LOGGING"))return D.upload("[".concat(this.store.clientId,"] exchanging ").concat(s," ").concat(o," SDP during P2PConnection.").concat(c,`
`),r),o==="offer"?u=>{this.logSDPExchange(u,"answer",s==="local"?"remote":"local",c)}:void 0}async muteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const o=this.peerConnection.getTransceivers().filter(h=>h.mid&&r.indexOf(h.mid)!==-1);if(o.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");o.map(h=>{h.direction="inactive"});const s=await this.peerConnection.createOffer(),c=this.logSDPExchange(s.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(s),this.remoteSDP.muteRemote(r);const u=this.remoteSDP.toString();c==null||c(u),await this.setRemoteDescription({type:"answer",sdp:u})}catch(o){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(o.toString()))}}async unmuteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const o=this.peerConnection.getTransceivers().filter(h=>h.mid&&r.indexOf(h.mid)!==-1);if(o.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");o.map(async h=>{h.direction="sendonly"});const s=await this.peerConnection.createOffer(),c=this.logSDPExchange(s.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(s),this.remoteSDP.unmuteRemote(r);const u=this.remoteSDP.toString();c==null||c(u),await this.setRemoteDescription({type:"answer",sdp:u})}catch(o){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(o.toString()))}}async getRemoteSSRC(r,o){var s,c;if(o=(s=o)!==null&&s!==void 0?s:(c=this.currentRemoteDescription)===null||c===void 0?void 0:c.sdp){var u;const h=(u=Sa(o).mediaDescriptions.find(m=>m.attributes.mid===r))===null||u===void 0?void 0:u.attributes.ssrcs;return h==null?void 0:h[0].ssrcId}}async setRemoteDescription(r){var o;await this.peerConnection.setRemoteDescription(r),st(o=["connected","completed"]).call(o,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(r,o,s){const c=Sa(r),u=c.mediaDescriptions.find(h=>h.attributes.mid===o);return u&&s===gt.AUDIO&&u.media.mediaType==="audio"&&Yv(u),Im(c)}},vt(hr.prototype,"establish",[Eu],Object.getOwnPropertyDescriptor(hr.prototype,"establish"),hr.prototype),vt(hr.prototype,"connect",[Eu],Object.getOwnPropertyDescriptor(hr.prototype,"connect"),hr.prototype),vt(hr.prototype,"receive",[Eu],Object.getOwnPropertyDescriptor(hr.prototype,"receive"),hr.prototype),vt(hr.prototype,"mockReceive",[Eu],Object.getOwnPropertyDescriptor(hr.prototype,"mockReceive"),hr.prototype),vt(hr.prototype,"stopReceiving",[Eu],Object.getOwnPropertyDescriptor(hr.prototype,"stopReceiving"),hr.prototype),vt(hr.prototype,"restartICE",[Eu],Object.getOwnPropertyDescriptor(hr.prototype,"restartICE"),hr.prototype),vt(hr.prototype,"close",[Eu],Object.getOwnPropertyDescriptor(hr.prototype,"close"),hr.prototype),vt(hr.prototype,"updateEncoderConfig",[Eu],Object.getOwnPropertyDescriptor(hr.prototype,"updateEncoderConfig"),hr.prototype),vt(hr.prototype,"updateSendParameters",[Eu],Object.getOwnPropertyDescriptor(hr.prototype,"updateSendParameters"),hr.prototype),vt(hr.prototype,"replaceTrack",[Eu],Object.getOwnPropertyDescriptor(hr.prototype,"replaceTrack"),hr.prototype),vt(hr.prototype,"muteLocal",[Eu],Object.getOwnPropertyDescriptor(hr.prototype,"muteLocal"),hr.prototype),vt(hr.prototype,"unmuteLocal",[Eu],Object.getOwnPropertyDescriptor(hr.prototype,"unmuteLocal"),hr.prototype),hr);function Eu(e,r,o){const s=e[r];if(typeof s!="function")throw new Error("Cannot use mutex on object property.");return o.value=async function(){const c=this.mutex,u=await c.lock("From P2PConnection.".concat(r));try{for(var h=arguments.length,m=new Array(h),_=0;_<h;_++)m[_]=arguments[_];return await s.apply(this,m)}finally{u()}},o}let yd=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({});var E$,y$,v$,S$,b$,T$,w$,R$,C$,I$,A$,Cr;function P$(e,r){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),o.push.apply(o,s)}return o}function qP(e){for(var r=1;r<arguments.length;r++){var o=arguments[r]!=null?arguments[r]:{};r%2?P$(Object(o),!0).forEach(function(s){$(e,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):P$(Object(o)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(o,s))})}return e}let O_e=(E$=vd(yd.SEND_ONLY),y$=vd(yd.SEND_ONLY),v$=vd(),S$=vd(yd.RECEIVE_ONLY),b$=vd(yd.RECEIVE_ONLY),T$=vd(yd.RECEIVE_ONLY),w$=vd(yd.RECEIVE_ONLY),R$=vd(yd.RECEIVE_ONLY),C$=vd(yd.RECEIVE_ONLY),I$=vd(),A$=vd(yd.RECEIVE_ONLY),Cr=class extends Pr{get state(){return this._state}set state(e){const r=this._state;this._state=e,this.emit(kt.StateChange,r,this._state)}constructor(e,r){super(),$(this,"isPlanB",!1),$(this,"store",void 0),$(this,"statsUploader",void 0),$(this,"sendConnection",void 0),$(this,"recvConnection",void 0),$(this,"localTrackMap",new Map),$(this,"remoteUserMap",new Map),$(this,"localDataChannels",[]),$(this,"pendingLocalTracks",[]),$(this,"pendingRemoteTracks",[]),$(this,"statsCollector",void 0),$(this,"dtlsFailedCount",0),$(this,"sendMutex",void 0),$(this,"recvMutex",void 0),$(this,"_state",Bn.Disconnected),$(this,"_restartStates",["disconnected","failed"]),$(this,"reconnectInterval",void 0),$(this,"uploadUnplinkStarted",!1),$(this,"uploadDownlinkStarted",!1),$(this,"uplinkStateUploadInterval",void 0),$(this,"downlinkStatsUploadInterval",void 0),$(this,"handleMuteLocalTrack",async(o,s,c)=>{const u=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==Bn.Connected)return void c(new Le(X.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const _=this.filterTobeMutedTracks(o);if(_.length===0)return void s();const y=_.find(k=>k[0]==="videoLowTrack");y&&y[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(_.map(k=>{let[,{id:z}]=k;return z}));let S=!1;var h,m;o.trackMediaType==="video"?S=!((h=this.localTrackMap.get($e.LocalAudioTrack))===null||h===void 0||!h.track._muted):S=((m=this.localTrackMap.get($e.LocalVideoTrack))===null||m===void 0?void 0:m.id)===void 0;const R=this.createMuteMessage(_);await or(this,kt.RequestMuteLocal,R);const P=o.trackMediaType==="video"?Pm.MUTE_LOCAL_VIDEO:Pm.MUTE_LOCAL_AUDIO;await or(this,kt.RequestP2PMuteLocal,{action:P,message:R,isMuteAll:S}),s()}catch(_){c(_)}finally{u()}}),$(this,"handleUnmuteLocalTrack",async(o,s,c)=>{const u=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==Bn.Connected)return void c(new Le(X.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const h=this.filterTobeUnmutedTracks(o);if(h.length===0)return void s();await this.sendConnection.unmuteLocal(h.map(y=>{let[,{id:S}]=y;return S}));const m=this.createUnmuteMessage(h),_=o.trackMediaType==="video"?Pm.UNMUTE_LOCAL_VIDEO:Pm.UNMUTE_LOCAL_AUDIO;await or(this,kt.RequestP2PMuteLocal,{action:_,message:m}),s()}catch(h){c(h)}finally{u()}}),$(this,"handleUpdateVideoEncoder",async(o,s,c,u)=>{let h;typeof u=="boolean"&&u||(h=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{const _=this.localTrackMap.get($e.LocalVideoTrack);if(!this.sendConnection||!_||_.track!==o||this.state!==Bn.Connected)return void s();const{id:y,track:S}=_;y&&(await this.sendConnection.updateSendParameters(y,S),await this.sendConnection.updateEncoderConfig(y,S),this.emit(kt.UpdateVideoEncoder,S)),s()}catch(_){c(_)}finally{var m;(m=h)===null||m===void 0||m()}}),$(this,"handleUpdateVideoSendParameters",async(o,s,c)=>{const u=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const h=this.localTrackMap.get($e.LocalVideoTrack);if(!this.sendConnection||!h||h.track!==o||this.state!==Bn.Connected)return void s();const{id:m,track:_}=h;m&&await this.sendConnection.updateSendParameters(m,_),s()}catch(h){c(h)}finally{u()}}),$(this,"handleReplaceTrack",async(o,s,c,u)=>{let h;D.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(o.getTrackId(),"]")),typeof u=="boolean"&&u||(h=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var m;const y=Array.from(this.localTrackMap.entries()).find(S=>{let[,{track:R}]=S;return o===R});if(!this.sendConnection||!y||y[1].id===void 0||this.state!==Bn.Connected)return void s();if(await((m=this.sendConnection)===null||m===void 0?void 0:m.replaceTrack(o,y[1].id)),y[0]===$e.LocalVideoTrack&&kn().supportDualStreamEncoding){const S=this.localTrackMap.get($e.LocalVideoLowTrack);if(S){const R=o._mediaStreamTrack.clone();S.track._originMediaStreamTrack.stop(),S.track._mediaStreamTrack=R,S.track._originMediaStreamTrack=R,await new lt((P,k)=>{this.handleReplaceTrack(S.track,P,k,!0)})}}s()}catch(y){c(y)}finally{var _;(_=h)===null||_===void 0||_()}}),$(this,"handleGetLocalVideoStats",o=>{o(this.statsCollector.getLocalVideoTrackStats())}),$(this,"handleGetLocalAudioStats",o=>{o(this.statsCollector.getLocalAudioTrackStats())}),$(this,"handleGetRemoteVideoStats",o=>this.statsCollector.getRemoteVideoTrackStats(o.uid)[o.uid]),$(this,"handleGetRemoteAudioStats",o=>this.statsCollector.getRemoteAudioTrackStats(o.uid)[o.uid]),this.store=e,this.statsCollector=r,this.statsCollector.addP2PChannel(this),this.statsUploader=new KH(e),this.bindStatsUploaderEvents(),this.sendMutex=new Oo("P2PChannel2-send-mutex",e.clientId),this.recvMutex=new Oo("P2PChannel2-recv-mutex",e.clientId),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(o=>{o&&(o.iceConnectionState!=="disconnected"&&o.iceConnectionState!=="failed"||this.handleDisconnect(o.direction))})},re("ICE_RESTART_INTERVAL"))}async startP2PConnection(e,r){throw new Le(X.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(e){throw new Le(X.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(e,r){let o;try{if(r){this.recvConnection&&(D.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),o=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new _$(e,this.store,bs.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const s=await this.recvConnection.establish(r);return{iceParameters:s.iceParameters,dtlsParameters:s.dtlsParameters,sdp:s.sdp}}{this.state=Bn.New,this.sendConnection&&(D.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),o=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new _$(e,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const s=await this.sendConnection.establish();return{iceParameters:s.iceParameters,dtlsParameters:s.dtlsParameters,sdp:s.sdp}}}finally{o&&o()}}async p2pConnect(e){if(!this.sendConnection)throw new Le(X.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Bn.Connected}async addRemoteCandidate(e,r){if(r===bs.RECEIVE_ONLY){if(!this.sendConnection)throw new Le(X.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(e)}else{if(!this.recvConnection)throw new Le(X.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(e)}}publish(e,r,o){var s=this;return ml(function*(){const c=yield wn(s.sendMutex.lock("From P2PChannel.publish"));try{if(!s.sendConnection||s.state!==Bn.Connected){s.throwIfTrackTypeNotMatch(e);const y=e.filter(S=>s.pendingLocalTracks.indexOf(S)===-1);return void(s.pendingLocalTracks=s.pendingLocalTracks.concat(y))}s.store.pubId=s.store.pubId+1,Do.markPublishStart(s.store.clientId,s.store.pubId);const u=s.filterTobePublishedTracks(e,r,o);if(u.length===0)return void(yield wn(s.tryToUnmuteAudio(e)));u.forEach(y=>{let{track:S,type:R}=y;const P=Date.now();s.store.publish(S.getTrackId(),R===$e.LocalAudioTrack?"audio":"video",P)}),s.bindLocalTrackEvents(u);const h=yield wn(s.sendConnection.send(u.map(y=>{let{track:S}=y;return S}),s.store.codec,s.store.audioCodec)),m=(yield wn(h.next())).value,_=s.createGatewayPublishMessage(u,m);try{yield _}catch(y){throw h.throw(y),(y==null?void 0:y.code)===X.WS_ABORT&&u.forEach(S=>{let{track:R}=S;s.pendingLocalTracks.indexOf(R)===-1&&s.pendingLocalTracks.push(R)}),s.unbindLocalTrackEvents(u),y}yield wn(h.next()),u.forEach(y=>{let{type:S}=y;s.statsCollector.addLocalStats(S)}),s.statsUploader.startUploadOutboundStats(),s.assignLocalTracks(u,m),u.forEach(y=>{let{track:S,type:R}=y;const P=Date.now();s.store.publish(S.getTrackId(),R===$e.LocalAudioTrack?"audio":"video",void 0,P)}),s.startUploadUplinkState()}finally{c()}})()}async unpublish(e){if(!this.sendConnection||this.state!==Bn.Connected)return void(e.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(c=>!st(e).call(e,c)));const r=this.filterTobeUnpublishedTracks(e);if(r.length===0)return;const o=r.find(c=>c[0]==="videoLowTrack");o&&o[1].track.close();const s=this.createGatewayUnpublishMessage(r);if(await this.sendConnection.stopSending(r.map(c=>{let[,{id:u}]=c;return u})),this.withdrawLocalTracks(r),this.unbindLocalTrackEvents(r.map(c=>{let[u,{track:h}]=c;return{type:u,track:h}})),r.forEach(c=>{let[u]=c;this.statsCollector.removeLocalStats(u)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===Bn.Connected)return o&&o[1].track.close(),s;e.forEach(c=>{const u=this.pendingLocalTracks.indexOf(c);u!==-1&&this.pendingLocalTracks.splice(u,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const e=()=>{const r=[],o=[];Array.from(this.localTrackMap.entries()).forEach(s=>{let[c,{track:u,ssrcs:h}]=s;const m={stream_type:Sme(u,c),ssrcs:h};u._muted||!u._enabled?r.push(m):o.push(m)}),r.length>0&&r.forEach(s=>{or(this,kt.RequestMuteLocal,[s])}),o.length>0&&o.forEach(s=>{or(this,kt.RequestUnmuteLocal,[s])})};e(),this.uplinkStateUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(e){return ml(function*(){throw new Le(X.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(D.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await bo(this,kt.RequestRePublish,this.pendingLocalTracks),this.emit(kt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new Le(X.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(e,r,o,s){var c;if(!this.recvConnection)throw new Le(X.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((c=this.remoteUserMap.get(e))!==null&&c!==void 0&&c.has(r))return;const{track:u,mid:h,transceiver:m}=await this.recvConnection.receive(r,[{ssrcId:o}],String(e.uid),s);r===gt.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(u):(e._audioTrack=new jv(u,e.uid,e._uintid,this.store),D.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),m&&e._audioTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoSSRC=o,e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(u):(e._videoTrack=new Fv(u,e.uid,e._uintid,this.store),D.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),m&&e._videoTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(e,e._videoTrack));const _=this.remoteUserMap.get(e);_?_.set(r,h):this.remoteUserMap.set(e,new Map([[r,h]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const y=this.pendingRemoteTracks.findIndex(S=>{let{user:R,kind:P}=S;return R.uid===e.uid&&r===P});y!==-1&&(this.pendingRemoteTracks.splice(y,1),this.emit(kt.MediaReconnectEnd,e.uid))}async mockSubscribe(e,r,o,s){if(!this.recvConnection)throw new Le(X.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(r,[{ssrcId:o}],String(e.uid),s)}async unsubscribe(e,r,o){const s=this.pendingRemoteTracks.filter(u=>{let{user:h,kind:m}=u;return r!==void 0?h.uid===e.uid&&r===m:h.uid===e.uid});if(s.forEach(u=>{const h=this.pendingRemoteTracks.indexOf(u);this.pendingRemoteTracks.splice(h,1)}),this.recvConnection||o||s.forEach(u=>{let{kind:h}=u;var m;if(h===gt.AUDIO)(m=e._audioTrack)===null||m===void 0||m._destroy(),e._audioTrack=void 0;else if(h===gt.VIDEO){var _;(_=e._videoTrack)===null||_===void 0||_._destroy(),e._videoTrack=void 0}}),!this.recvConnection)return;const c=this.filterTobeUnSubscribedTracks(e,r);c.length!==0&&(await this.recvConnection.stopReceiving(c.map(u=>{let[,{id:h}]=u;return h})),this.withdrawRemoteTracks(c),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),c.forEach(u=>{let[h,{kind:m}]=u;var _,y;if(m===gt.VIDEO&&h._videoSSRC&&((_=this.recvConnection)===null||_===void 0||_.setStatsRemoteVideoIsReady(h._videoSSRC,!1)),m===gt.VIDEO)this.unbindRemoteTrackEvents(h._videoTrack),o||((y=h._videoTrack)===null||y===void 0||y._destroy(),h._videoTrack=void 0);else if(m===gt.AUDIO){var S;this.unbindRemoteTrackEvents(h._audioTrack),!o&&((S=h._audioTrack)===null||S===void 0||S._destroy(),h._audioTrack=void 0)}}),c.forEach(u=>{let[,{kind:h}]=u;or(this,kt.RequestP2PMuteRemote,h)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const e=()=>Array.from(this.remoteUserMap.entries()).forEach(r=>{let[,o]=r;[gt.VIDEO,gt.AUDIO].forEach(s=>{o.has(s)?or(this,kt.RequestP2PUnmuteRemote,s):or(this,kt.RequestP2PMuteRemote,s)})});e(),this.downlinkStatsUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(e){throw new Le(X.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(e){throw new Le(X.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(e){throw new Le(X.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(e){throw new Le(X.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(e,r){if(!this.recvConnection)return;const o=this.remoteUserMap.get(e);if(!o)return void D.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid,"."));if(!o.get(r))return void D.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid," media type ").concat(r,"."));const s=r===gt.VIDEO?e._videoSSRC:e._audioSSRC;s!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(s,!1)}async unmuteRemote(e,r){return this.unmuteRemoteNoLock(e,r)}async unmuteRemoteNoLock(e,r){if(!this.recvConnection)return;const o=this.remoteUserMap.get(e);if(!o)return void D.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid,"."));o.get(r)||D.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(r,"."))}getAllTracks(e){const r=this.localTrackMap.get($e.LocalAudioTrack);if((r==null?void 0:r.track)instanceof Ci){const o=r.track;return Array.from(this.localTrackMap.entries()).filter(s=>{let[c]=s;return c!==$e.LocalAudioTrack}).filter(s=>{let[c]=s;return!(e&&c===$e.LocalVideoLowTrack)}).map(s=>{let[,{track:c}]=s;return c}).concat(o.trackList)}return Array.from(this.localTrackMap.entries()).filter(o=>{let[s]=o;return!(e&&s===$e.LocalVideoLowTrack)}).map(o=>{let[,{track:s}]=o;return s})}reportPublishEvent(e,r,o,s,c){if(e){const h=this.localTrackMap.get($e.LocalAudioTrack),m=s?this.localTrackMap.get($e.LocalVideoLowTrack):this.localTrackMap.get($e.LocalVideoTrack);wt.publish(this.store.sessionId,{eventElapse:Do.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:r,audioName:h==null?void 0:h.track.getTrackLabel(),videoName:m==null?void 0:m.track.getTrackLabel(),screenshare:(m==null?void 0:m.track._hints.indexOf(ar.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}else{var u;o||(o=[]);const h=o.find(_=>_ instanceof Br),m=s?(u=this.localTrackMap.get($e.LocalVideoTrack))===null||u===void 0?void 0:u.track:o.find(_=>_ instanceof mr);wt.publish(this.store.sessionId,{eventElapse:Do.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:r,audioName:h==null?void 0:h.getTrackLabel(),videoName:m==null?void 0:m.getTrackLabel(),screenshare:(m==null?void 0:m._hints.indexOf(ar.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}}reportSubscribeEvent(e,r,o,s){const c=s===gt.VIDEO?o._videoSSRC:o._audioSSRC;c&&wt.subscribe(this.store.sessionId,{succ:e,ec:r,video:s===gt.VIDEO,audio:s===gt.AUDIO,peerid:o.uid,subscribeRequestid:s===gt.VIDEO?o._videoSSRC:o._audioSSRC,p2pid:this.store.p2pId,eventElapse:Do.measureFromSubscribeStart(this.store.clientId,c)})}reset(){D.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new Oo("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new Oo("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get($e.LocalAudioTrack);if((e==null?void 0:e.track)instanceof Ci){if(e.track.trackList.length>0){const r=e.track;e.track.trackList.forEach(o=>{r.removeAudioTrack(o)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=Bn.Disconnected}getStats(e){var r,o;return e?(o=this.recvConnection)===null||o===void 0?void 0:o.getStats():(r=this.sendConnection)===null||r===void 0?void 0:r.getStats()}getRemoteVideoIsReady(e){var r;return((r=this.recvConnection)===null||r===void 0?void 0:r.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get($e.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get($e.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const r=this.localTrackMap.get(e);return r&&r.track instanceof mr||r&&r.track instanceof Br?r.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,r){if(!e)return this.remoteUserMap.size>0;const o=this.remoteUserMap.get(e);return!!o&&(!r||o.has(r))}async hasRemoteMediaWithLock(e,r){if(!e)return this.remoteUserMap.size>0;const o=this.remoteUserMap.get(e);return!!o&&(!r||o.has(r))}getRemoteMedia(e){var r;const o=Array.from(Dc(r=this.remoteUserMap).call(r)).find(s=>s.uid===e);return o?{audioTrack:o.audioTrack,audioSSRC:o._audioSSRC,videoTrack:o.videoTrack,videoSSRC:o._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(o=>{let[s]=o;return{uid:s.uid,level:s.audioTrack?100*s.audioTrack._source.getAccurateVolumeLevel():0}});const r=this.localTrackMap.get($e.LocalAudioTrack);return r&&e.push({level:100*r.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=Xb(e).call(e,(o,s)=>o.level-s.level),e}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(D.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=Bn.Reconnecting,re("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[r]=e;var o;r._videoTrack&&r._videoTrack._player&&((o=r._videoTrack._player.getVideoElement())===null||o===void 0||o.pause(),r._videoTrack._player.isKeepLastFrame=!0,r._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var r;let[o,{track:s}]=e;switch(o){case $e.LocalVideoTrack:st(r=s._hints).call(r,ar.LOW_STREAM)?s.close():this.pendingLocalTracks.push(s);break;case $e.LocalAudioTrack:s instanceof Ci?this.pendingLocalTracks=this.pendingLocalTracks.concat(s.trackList):this.pendingLocalTracks.push(s);case $e.LocalVideoLowTrack:}}),this.emit(kt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[r,o]=e;Array.from(Dc(o).call(o)).forEach(s=>{this.setPendingRemoteMedia(r,s)}),this.emit(kt.MediaReconnectStart,r.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),D.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(e,r){for(const o of this.pendingRemoteTracks){const{user:s,kind:c}=o;if((e instanceof Lm?e.uid:e)===s.uid&&r===c)return!0}return!1}setPendingRemoteMedia(e,r){this.hasPendingRemoteMedia(e,r)||this.pendingRemoteTracks.push({user:e,kind:r})}async restartICE(e,r){let o,s;if(e===bs.SEND_ONLY){if(!this.sendConnection)throw new Le(X.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");o=await this.sendMutex.lock("From P2PChannel.restartICE"),s=this.sendConnection}else{if(!this.recvConnection)throw new Le(X.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");o=await this.recvMutex.lock("From P2PChannel.restartICE"),s=this.recvConnection}try{if(r){const c=await s.restartICE(r);return s.isInRestartIce=!1,c}{const c=await s.restartICE();if(c){const u=await bo(this,kt.RequestP2PRestartICE,{direction:bs.RECEIVE_ONLY,iceParameter:c});await s.restartICE(u),s.isInRestartIce=!1}}}finally{o()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const e=this.sendConnection.getStats(),r=this.localTrackMap.get($e.LocalVideoTrack),o=this.localTrackMap.get($e.LocalAudioTrack),s=e.videoSend.find(k=>{var z;return k.ssrc===(r==null||(z=r.ssrcs)===null||z===void 0?void 0:z[0].ssrcId)}),c=e.audioSend.find(k=>{var z;return k.ssrc===(o==null||(z=o.ssrcs)===null||z===void 0?void 0:z[0].ssrcId)});if(!s||!c)return 1;const u=kc(this,kt.NeedSignalRTT),h=s?s.rttMs:void 0,m=c?c.rttMs:void 0,_=h&&m?(h+m)/2:h||m,y=(_&&u?(_+u)/2:_||u)||0,S=100*e.sendPacketLossRate*.7/50+.3*y/1500,R=S<.17?1:S<.36?2:S<.59?3:S<.1?4:5,P=r==null?void 0:r.track;if(P&&P._encoderConfig&&P._hints.indexOf(ar.SCREEN_TRACK)===-1){const k=P._encoderConfig.bitrateMax,z=e.bitrate.actualEncoded;if(k&&z){const U=(1e3*k-z)/(1e3*k);return kG[U<.15?0:U<.3?1:U<.45?2:U<.6?3:4][R]}}return R}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const e=this.recvConnection.getStats();let r=0;return Array.from(this.remoteUserMap.entries()).forEach(o=>{let[s]=o;const c=s._audioSSRC,u=s._videoSSRC,h=e.audioRecv.find(z=>z.ssrc===c),m=e.videoRecv.find(z=>z.ssrc===u);if(!h&&!m)return void(r+=1);const _=kc(this,kt.NeedSignalRTT),y=e.rtt,S=(y&&_?(y+_)/2:y||_)||0,R=h?h.jitterMs:void 0,P=e.recvPacketLossRate;let k=.7*P*100/50+.3*S/1500;R&&(k=.6*P*100/50+.2*S/1500+.2*R/400),r+=k<.1?1:k<.17?2:k<.36?3:k<.59?4:5}),this.remoteUserMap.size>0?Math.round(r/this.remoteUserMap.size):r}async muteLocalTrack(e){return new lt((r,o)=>{this.handleMuteLocalTrack(e,r,o)})}filterTobePublishedTracks(e,r,o){const s=[],c=kn(),u=this.getAllTracks();e=Cv(e=e.filter(_=>u.indexOf(_)===-1));let h=!1,m=!1;for(const _ of e){if(_ instanceof mr&&(this.localTrackMap.has($e.LocalVideoTrack)||h?new Le(X.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(s.push({track:_,type:$e.LocalVideoTrack}),h=!0),r)){const y=this.getLowVideoTrack(_,o);s.push({track:y,type:$e.LocalVideoLowTrack})}if(_ instanceof Br){const y=this.localTrackMap.get($e.LocalAudioTrack);if(y){if(!(y.track instanceof Ci))throw new Le(X.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(_._bypassWebAudio)throw new Le(X.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");y.track.addAudioTrack(_),this.bindLocalAudioTrackEvents(_,!0)}else if(m){const S=s.find(R=>{let{type:P}=R;return P===$e.LocalAudioTrack});if(!(S.track instanceof Ci))throw new Le(X.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(_._bypassWebAudio)throw new Le(X.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");S.track.addAudioTrack(_)}else{if(!c.webAudioMediaStreamDest||_ instanceof Ci||_._bypassWebAudio)s.push({track:_,type:$e.LocalAudioTrack});else{const S=new Ci;S.addAudioTrack(_),s.push({track:S,type:$e.LocalAudioTrack})}m=!0}}}return s}filterTobeUnpublishedTracks(e){const r=[],o=this.getAllTracks();e=Cv(e=e.filter(s=>o.indexOf(s)!==-1));for(const s of e){if(s instanceof Br){const c=this.localTrackMap.get($e.LocalAudioTrack);if(!c)continue;c.track instanceof Ci?(c.track.removeAudioTrack(s),this.unbindLocalAudioTrackEvents(s),c.track.trackList.length===0&&(r.push([$e.LocalAudioTrack,c]),c.track.close())):r.push([$e.LocalAudioTrack,c])}if(s instanceof mr){const c=this.localTrackMap.get($e.LocalVideoTrack);if(!c)continue;r.push([$e.LocalVideoTrack,c]);const u=this.localTrackMap.get($e.LocalVideoLowTrack);u&&r.push([$e.LocalVideoLowTrack,u])}}return r}bindLocalTrackEvents(e){e.forEach(r=>{let{track:o,type:s}=r;switch(s){case $e.LocalVideoTrack:o.addListener(Et.GET_STATS,this.handleGetLocalVideoStats),o.addListener(Et.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),o.addListener(Et.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),o.addListener(Et.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),o.addListener(Et.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),o.addListener(Et.NEED_REPLACE_TRACK,this.handleReplaceTrack),o.addListener(Et.NEED_MUTE_TRACK,this.handleMuteLocalTrack),o.addListener(Et.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case $e.LocalAudioTrack:this.bindLocalAudioTrackEvents(o);case $e.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,r){e instanceof Ci?e.trackList.forEach(o=>{o.addListener(Et.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),o.addListener(Et.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),o.addListener(Et.GET_STATS,this.handleGetLocalAudioStats),o.addListener(Et.NEED_MUTE_TRACK,this.handleMuteLocalTrack),o.addListener(Et.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(Et.GET_STATS,this.handleGetLocalAudioStats),e.addListener(Et.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(Et.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(Et.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(Et.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),r||e.addListener(Et.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(r=>{let[o,{track:s}]=r;return{track:s,type:o}})),e.forEach(r=>{let{track:o,type:s}=r;switch(s){case $e.LocalVideoTrack:o.off(Et.GET_STATS,this.handleGetLocalVideoStats),o.off(Et.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),o.off(Et.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),o.off(Et.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),o.off(Et.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),o.off(Et.NEED_REPLACE_TRACK,this.handleReplaceTrack),o.off(Et.NEED_MUTE_TRACK,this.handleMuteLocalTrack),o.off(Et.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case $e.LocalAudioTrack:this.unbindLocalAudioTrackEvents(o);case $e.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof Ci?e.trackList.forEach(r=>{r.off(Et.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(Et.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(Et.GET_STATS,this.handleGetLocalAudioStats),r.off(Et.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(Et.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(Et.GET_STATS,this.handleGetLocalAudioStats),e.off(Et.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(Et.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(Et.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(Et.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(Et.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,r){r instanceof Fv&&r.addListener(Et.GET_STATS,o=>{o(this.handleGetRemoteVideoStats(e))}),r instanceof jv&&r.addListener(Et.GET_STATS,o=>{o(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(Et.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[r,o]=e;o.has(gt.AUDIO)&&this.unbindRemoteTrackEvents(r._audioTrack),o.has(gt.VIDEO)&&this.unbindRemoteTrackEvents(r._videoTrack)})}createGatewayPublishMessage(e,r){return e.map((o,s)=>{var c;let u,{track:h,type:m}=o;switch(m){case $e.LocalAudioTrack:u=zn.Audio;break;case $e.LocalVideoTrack:u=st(c=h._hints).call(c,ar.SCREEN_TRACK)?zn.Screen:zn.High;break;case $e.LocalVideoLowTrack:u=zn.Low}return{kind:m===$e.LocalAudioTrack?gt.AUDIO:gt.VIDEO,stream_type:u,mid:r[s].id,ssrcs:r[s].localSSRC,isMuted:h.muted||!h.enabled}})}createGatewayUnpublishMessage(e){return e.map(r=>{var o;let s,[c,{track:u,ssrcs:h,id:m}]=r;switch(c){case $e.LocalVideoTrack:s=st(o=u._hints).call(o,ar.SCREEN_TRACK)?zn.Screen:zn.High;break;case $e.LocalAudioTrack:s=zn.Audio;break;case $e.LocalVideoLowTrack:s=zn.Low}return{stream_type:s,ssrcs:h,mid:m}})}assignLocalTracks(e,r){e.forEach((o,s)=>{let{track:c,type:u}=o;this.localTrackMap.set(u,{track:c,id:r[s].id,ssrcs:r[s].localSSRC})})}withdrawLocalTracks(e){e.forEach(r=>{let[o]=r;this.localTrackMap.delete(o)})}bindConnectionEvents(e){e.onConnectionStateChange=async r=>{var o;D.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(e.name,".onConnectionStateChange(").concat(r,")")),this.emit(kt.PeerConnectionStateChange,r),r!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),r==="connected"&&(e.isInRestartIce=!1),st(o=this._restartStates).call(o,r)&&!e.isInRestartIce&&(r==="disconnected"&&await io(800),e.iceConnectionState!=="disconnected"&&e.iceConnectionState!=="failed"||this.handleDisconnect(e.direction))},e.onICEConnectionStateChange=r=>{r!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),D.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(r,")")),wt.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:r,tag:xr.TRACER}).onSuccess(),this.emit(kt.IceConnectionStateChange,r)},e.onICETransportStateChange=r=>{D.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(r,")"))},e.onDTLSTransportStateChange=r=>{D.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(r,")"))},e.onDTLSTransportError=r=>{D.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(r,")"))},e.onFirstAudioDecoded=r=>{var o;const s=Array.from(Dc(o=this.remoteUserMap).call(o)).find(u=>u._audioSSRC===r);var c;s&&(this.store.subscribe(s.uid,"audio",void 0,void 0,void 0,Date.now()),(c=s.audioTrack)===null||c===void 0||c.emit(Lv.FIRST_FRAME_DECODED),wt.firstRemoteFrame(this.store.sessionId,ji.FIRST_AUDIO_DECODE,wr.FIRST_AUDIO_DECODE,{peer:s._uintid,subscribeElapse:Do.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=r=>{var o;const s=Array.from(Dc(o=this.remoteUserMap).call(o)).find(c=>c._audioSSRC===r);s&&wt.firstRemoteFrame(this.store.sessionId,ji.FIRST_AUDIO_RECEIVED,wr.FIRST_AUDIO_RECEIVED,{peer:s._uintid,subscribeElapse:Do.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(r,o,s)=>{this.reportVideoFirstFrameDecoded(r,o,s)},e.onFirstVideoReceived=r=>{var o;const s=Array.from(Dc(o=this.remoteUserMap).call(o)).find(c=>c._videoSSRC===r);s&&wt.firstRemoteFrame(this.store.sessionId,ji.FIRST_VIDEO_RECEIVED,wr.FIRST_VIDEO_RECEIVED,{peer:s._uintid,subscribeElapse:Do.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(r,o)=>{const s=r.candidateType==="relay",c=o.candidateType==="relay";o.candidateType!=="unknown"&&s===c||this.emit(kt.ConnectionTypeChange,s),D.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(km(o))," -> ").concat(JSON.stringify(km(r)),")"))},e.onSelectedRemoteCandidateChanged=(r,o)=>{D.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(km(o))," -> ").concat(JSON.stringify(km(r)),")"))},e.onFirstVideoDecodedTimeout=r=>{this.reportVideoFirstFrameDecoded(r,void 0,void 0,!0)},e.onLocalCandidate=r=>{this.emit(kt.LocalCandidate,{candidate:r,direction:e.direction})}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.onLocalCandidate=void 0}async handleDisconnect(e){const r=e===bs.SEND_ONLY?this.sendConnection:this.recvConnection;r&&!r.isInRestartIce&&(r.isInRestartIce=!0,D.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(r.name,"] start use restartICE")),e===bs.SEND_ONLY?this.restartICE(e):bo(this,kt.RequestP2PRestartICE,{direction:bs.SEND_ONLY}))}filterTobeMutedTracks(e){const r=[];if(this.getAllTracks().indexOf(e)===-1)return r;const o=this.localTrackMap.get($e.LocalAudioTrack);if(e instanceof Br&&(o==null?void 0:o.track)instanceof Ci)return o.track.isActive||r.push([$e.LocalAudioTrack,o]),r;const s=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return e===u});if(s&&(r.push(s),s[0]===$e.LocalVideoTrack)){const c=this.localTrackMap.get($e.LocalVideoLowTrack);c&&r.push([$e.LocalVideoLowTrack,c])}return r}filterTobeUnmutedTracks(e){const r=[],o=this.localTrackMap.get($e.LocalAudioTrack);if(e instanceof Br&&(o==null?void 0:o.track)instanceof Ci)return o.track.isActive&&r.push([$e.LocalAudioTrack,o]),r;const s=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return e===u});if(s)if(s[0]===$e.LocalVideoTrack){r.push(s);const c=this.localTrackMap.get($e.LocalVideoLowTrack);c&&r.push([$e.LocalVideoLowTrack,c])}else r.push(s);return r}createMuteMessage(e){return e.map(r=>{var o;let s,[c,{track:u,ssrcs:h,id:m}]=r;switch(c){case $e.LocalAudioTrack:s=zn.Audio;break;case $e.LocalVideoTrack:s=st(o=u._hints).call(o,ar.SCREEN_TRACK)?zn.Screen:zn.High;break;case $e.LocalVideoLowTrack:s=zn.Low}return{stream_type:s,ssrcs:h,mid:m}})}createUnmuteMessage(e){return e.map(r=>{var o;let s,[c,{track:u,ssrcs:h,id:m}]=r;switch(c){case $e.LocalAudioTrack:s=zn.Audio;break;case $e.LocalVideoTrack:s=st(o=u._hints).call(o,ar.SCREEN_TRACK)?zn.Screen:zn.High;break;case $e.LocalVideoLowTrack:s=zn.Low}return{stream_type:s,ssrcs:h,mid:m}})}filterTobeUnSubscribedTracks(e,r){const o=[],s=this.remoteUserMap.get(e);if(!s)return o;if(r){const c=s.get(r);if(!c)return o;o.push([e,{kind:r,id:c}])}else Array.from(s.entries()).forEach(c=>{let[u,h]=c;o.push([e,{kind:u,id:h}])});return o}createUnsubscribeMessage(e){const r=[];return e.forEach(o=>{let[s,{kind:c,id:u}]=o;switch(c){case gt.VIDEO:return void(s._videoSSRC&&r.push({stream_type:gt.VIDEO,ssrcId:s._videoSSRC}));case gt.AUDIO:return void(s._audioSSRC&&r.push({stream_type:gt.AUDIO,ssrcId:s._audioSSRC}))}}),r}withdrawRemoteTracks(e){e.forEach(r=>{let[o,{kind:s}]=r;const c=this.remoteUserMap.get(o);c&&(c.delete(s),Array.from(c.entries()).length===0&&this.remoteUserMap.delete(o))})}async updateBitrateLimit(e){const r=this.localTrackMap.get($e.LocalVideoTrack),o=this.localTrackMap.get($e.LocalVideoLowTrack);r&&(await r.track.setBitrateLimit(e.uplink),await new lt((s,c)=>{this.handleUpdateVideoEncoder(r.track,s,c,!0)})),o&&e.low_stream_uplink&&(await o.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new lt((s,c)=>{this.handleUpdateVideoEncoder(o.track,s,c,!0)}))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const e=this.sendConnection.peerConnectionState,r=this.recvConnection.peerConnectionState;return e!=="connected"&&r!=="connected"}return!0}async tryToUnmuteAudio(e){for(let r=0;r<e.length;r++)if(e[r]instanceof Br){const o=this.filterTobeUnmutedTracks(e[r]);if(o.length===0)continue;const s=this.createUnmuteMessage(o);return void await or(this,kt.RequestUnmuteLocal,s)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=e=>this.getStats(e),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(e=>{let[,{ssrcs:r}]=e;return!!r}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var r;return!((r=this.recvConnection)===null||r===void 0||!r.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,r)=>this.emit(kt.RequestUpload,e,r),this.statsUploader.requestUploadStats=e=>this.emit(kt.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await io(qL(this.dtlsFailedCount,Ei)),this.emit(kt.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has($e.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof mr)}throwIfTrackTypeNotMatch(e){if(e.filter(r=>r instanceof mr).length>1)throw new Le(X.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(r=>r instanceof Br).length>1&&(e.some(r=>r instanceof Br&&r._bypassWebAudio)||!kn().webAudioMediaStreamDest))throw new Le(X.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const r of e){if(r instanceof mr&&this.pendingLocalTracks.some(o=>o instanceof mr))throw new Le(X.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(r instanceof Br&&this.pendingLocalTracks.some(o=>o instanceof Br)&&(!kn().webAudioMediaStreamDest||r._bypassWebAudio||this.pendingLocalTracks.some(o=>o instanceof Br&&o._bypassWebAudio)))throw new Le(X.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,r){const o=!re("DISABLE_DUAL_STREAM_USE_ENCODING")&&kn().supportDualStreamEncoding,s=qP(qP({},{width:160,height:120,framerate:15,bitrate:50}),r);let c;c=o?e._mediaStreamTrack.clone():rM(e,s);const u=sr(8,"track-low-"),h=new mr(c,qP(qP({},o&&{scaleResolutionDownBy:Fx(s,e)}),{},{frameRate:s.framerate,bitrateMax:s.bitrate,bitrateMin:s.bitrate}),void 0,void 0,u);return h.on(O_.TRANSCEIVER_UPDATED,m=>{e._updateRtpTransceiver(m,Nv.LOW_STREAM)}),h._hints.push(ar.LOW_STREAM),e.addListener(Et.NEED_CLOSE,()=>{h.close()}),h}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(e,r,o,s){var c;const u=Array.from(Dc(c=this.remoteUserMap).call(c)).find(h=>h._videoSSRC===e);if(u){s||this.store.subscribe(u.uid,"video",void 0,void 0,void 0,void 0,Date.now());const h=this.store.keyMetrics,m=h.subscribe.find(_=>_.userId===u.uid&&_.type==="video");wt.firstRemoteVideoDecode(this.store.sessionId,ji.FIRST_VIDEO_DECODE,wr.FIRST_VIDEO_DECODE,{peer:u._uintid,videowidth:r,videoheight:o,subscribeElapse:Do.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:h.requestAPEnd||0,apStart:h.requestAPStart||0,joinGwEnd:h.joinGatewayEnd||0,joinGwStart:h.joinGatewayStart||0,pcEnd:h.peerConnectionEnd||0,pcStart:h.peerConnectionStart||0,subscriberEnd:(m==null?void 0:m.subscribeEnd)||0,subscriberStart:(m==null?void 0:m.subscribeStart)||0,videoAddNotify:(m==null?void 0:m.streamAdded)||0,state:s?1:0})}}async remoteMediaSsrcChanged(e,r,o){if(!this.recvConnection)return!1;const s=this.remoteUserMap.get(e);if(!s)return!1;const c=s.get(r);if(!c)return!1;const u=await this.recvConnection.getRemoteSSRC(c);return u!==void 0&&u!==o}isPreSubScribe(e){return!1}async publishDataChannel(e){throw new Le(X.NOT_SUPPORTED)}async unpublishDataChannel(e){throw new Le(X.NOT_SUPPORTED)}async subscribeDataChannel(e,r){throw new Le(X.NOT_SUPPORTED)}async unsubscribeDataChannel(e,r){throw new Le(X.NOT_SUPPORTED)}hasPendingRemoteDataChannel(e,r){throw new Le(X.NOT_SUPPORTED)}setPendingRemoteDataChannel(e,r){throw new Le(X.NOT_SUPPORTED)}async preConnect(e){throw new Le(X.NOT_SUPPORTED)}getEstablishParams(){throw new Le(X.NOT_SUPPORTED)}async reSubscribe(e){throw new Le(X.NOT_SUPPORTED)}async updateVideoStreamParameter(e,r){throw new Le(X.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[r,{track:o}]=e;r===$e.LocalVideoLowTrack?o._updateRtpTransceiver(void 0,Nv.LOW_STREAM):o._updateRtpTransceiver(void 0)})}},vt(Cr.prototype,"p2pConnect",[E$],Object.getOwnPropertyDescriptor(Cr.prototype,"p2pConnect"),Cr.prototype),vt(Cr.prototype,"unpublish",[y$],Object.getOwnPropertyDescriptor(Cr.prototype,"unpublish"),Cr.prototype),vt(Cr.prototype,"unpublishLowStream",[v$],Object.getOwnPropertyDescriptor(Cr.prototype,"unpublishLowStream"),Cr.prototype),vt(Cr.prototype,"subscribe",[S$],Object.getOwnPropertyDescriptor(Cr.prototype,"subscribe"),Cr.prototype),vt(Cr.prototype,"mockSubscribe",[b$],Object.getOwnPropertyDescriptor(Cr.prototype,"mockSubscribe"),Cr.prototype),vt(Cr.prototype,"unsubscribe",[T$],Object.getOwnPropertyDescriptor(Cr.prototype,"unsubscribe"),Cr.prototype),vt(Cr.prototype,"muteRemote",[w$],Object.getOwnPropertyDescriptor(Cr.prototype,"muteRemote"),Cr.prototype),vt(Cr.prototype,"unmuteRemote",[R$],Object.getOwnPropertyDescriptor(Cr.prototype,"unmuteRemote"),Cr.prototype),vt(Cr.prototype,"hasRemoteMediaWithLock",[C$],Object.getOwnPropertyDescriptor(Cr.prototype,"hasRemoteMediaWithLock"),Cr.prototype),vt(Cr.prototype,"disconnectForReconnect",[I$],Object.getOwnPropertyDescriptor(Cr.prototype,"disconnectForReconnect"),Cr.prototype),vt(Cr.prototype,"remoteMediaSsrcChanged",[A$],Object.getOwnPropertyDescriptor(Cr.prototype,"remoteMediaSsrcChanged"),Cr.prototype),Cr);function vd(e){return function(r,o,s){const c=r[o];if(typeof c!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){for(var u=arguments.length,h=new Array(u),m=0;m<u;m++)h[m]=arguments[m];switch(e){case yd.SEND_ONLY:{const _=await this.sendMutex.lock("From P2PChannel2.".concat(o));try{return await c.apply(this,h)}finally{_()}}case yd.RECEIVE_ONLY:{const _=await this.recvMutex.lock("From P2PChannel2.".concat(o));try{return await c.apply(this,h)}finally{_()}}default:{const _=await this.sendMutex.lock("From P2PChannel2.".concat(o)),y=await this.recvMutex.lock("From P2PChannel2.".concat(o));try{return await c.apply(this,h)}finally{_(),y()}}}},s}}class J_ extends Pr{constructor(r,o){super(),$(this,"signal",void 0),$(this,"token",void 0),$(this,"tokenTimeout",void 0),$(this,"tokenInterval",void 0),$(this,"_sequence",0),$(this,"userMap",new Map),$(this,"encoder",new TextEncoder),this.signal=r,this.token=o;const s=()=>{this.signal.connectionState===lr.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(s,1e3):this.tokenInterval=window.setTimeout(s,3*re("P2P_TOKEN_INTERVAL"))};s()}async send(r,o,s,c,u){var h,m,_;if(this.userMap.size===0)return;const y=Array.from(Pc(h=this.userMap).call(h))[0].token;typeof o!="string"&&(o=JSON.stringify(o)),c=(m=c)!==null&&m!==void 0?m:sr(6,""),u=(_=u)!==null&&_!==void 0?_:this._sequence++;const S={_id:c,_type:r,_seq:u,_message:o,token:"".concat(this.token,"_").concat(y)};re("SHOW_P2P_LOG")&&D.debug("send message",S,"noNeedResponse : ".concat(s)),this.splitMessage(JSON.stringify(S)).forEach(P=>{this.signal.request(jt.DATA_STREAM,{payload:Cm(this.encoder.encode(P))})});const R=new lt((P,k)=>{const z=window.setTimeout(()=>{this.off("res-@".concat(c,"_ack"),U),this.off("res-@".concat(c),q),this.off(Hv.ABORT,V),D.debug("[external-signal] request timeout, type: ".concat(r,", requestId: ").concat(c)),this.userMap.size===0?k(new Le(X.INVALID_REMOTE_USER)):k(new Le(X.TIMEOUT))},re("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),U=()=>{z&&window.clearTimeout(z),this.off(Hv.ABORT,V),s&&P()},V=()=>{z&&window.clearTimeout(z),this.off("res-@".concat(c,"_ack"),U),this.off("res-@".concat(c),q),k(new Le(X.EXTERNAL_SIGNAL_ABORT,"type: ".concat(r,", requestId: ").concat(c)))};this.once(Hv.ABORT,V),this.once("res-@".concat(c,"_ack"),U);const q=(ce,_e)=>{Y=!0,z&&window.clearTimeout(z),this.off("res-@".concat(c,"_ack"),U),this.off(Hv.ABORT,V),ce==="success"?P(_e):k(new Le(X.P2P_MESSAGE_FAILED,"request ".concat(r," failed, requestId: ").concat(c)))};let Y=!1;s||(this.once("res-@".concat(c),q),io(re("SIGNAL_REQUEST_TIMEOUT")).then(()=>{Y||D.warning("external_signal request timeout, type: ".concat(r,", requestId: ").concat(c,", ").concat(S))}))});try{return await R}catch(P){if(P.code===X.TIMEOUT)return await this.send(r,o,s,c,u);throw P}}onMessage(r){var o;const{_uid:s}=r;let c,u=this.userMap.get(s);if(u)c=u.splitMessageMap;else{if(this.userMap.size>0||!("_type"in r)||r._type!==Qr.CHECK)return;const{token:y}=r;c=new Map,u={uid:s,isStart:!0,token:y,splitMessageMap:c,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(s,u),this.signal.emit(_n.ON_USER_ONLINE,{uid:s}),this.handleUserOnline()}if("id"in r&&"total"in r){var h;const{id:y,total:S}=r,R=(h=c.get(y))!==null&&h!==void 0?h:[];if(R.push(r),c.has(y)||c.set(y,R),R.length!==S)return;{const P=Xb(R).call(R,(k,z)=>k.index-z.index).map(k=>k.payload).join("");c.delete(y),(r=JSON.parse(P))._uid=s}}const{_type:m,token:_}=r;if(st(o=[Qr.ACK,Qr.CHECK]).call(o,m))return m===Qr.CHECK&&this.handleCheckToken(u,_),void this.receiveMessage(r);_==="".concat(u.token,"_").concat(this.token)?this.handleReceivedMessage(r):D.debug('Receive unexpected message", '.concat(_,", cur_token: ").concat(u.token,"_").concat(this.token),r)}check(){const r={_id:sr(6,""),token:this.token,_type:Qr.CHECK};re("SHOW_P2P_LOG")&&D.debug("send message",r),this.signal.request(jt.DATA_STREAM,{payload:Cm(this.encoder.encode(JSON.stringify(r)))})}ack(r){const o={_id:r,_type:Qr.ACK,token:this.token};re("SHOW_P2P_LOG")&&D.debug("send message",o),this.signal.request(jt.DATA_STREAM,{payload:Cm(this.encoder.encode(JSON.stringify(o)))})}response(r,o,s){this.send(Qr.RESPONSE,JSON.stringify({success:!s,message:o}),!0,r)}handleReceivedMessage(r){const o=()=>{this.userMap.forEach(y=>{const{receivedMessagesMap:S,nextExpectedSequenceNumber:R}=y;for(;S.has(R);){const P=S.get(R);S.delete(R),this.receiveMessage(P),y.nextExpectedSequenceNumber++}})};if(!r)return void o();const{_uid:s,_seq:c}=r,u=this.userMap.get(s),{receivedMessagesMap:h,isStart:m,nextExpectedSequenceNumber:_}=u;if(c<_)return this.ack(r._id),void D.debug("[external-signal] receive old message, seq: ".concat(c,", ").concat(r._message));h.set(c,r),m&&c===_&&(this.receiveMessage(r),h.delete(_),u.nextExpectedSequenceNumber++,o())}receiveMessage(r){const{_id:o,_type:s,_message:c,_uid:u}=r;if(re("SHOW_P2P_LOG")&&D.debug("receive message",r),o){let h;switch(r._type!==Qr.ACK&&(c&&(h=JSON.parse(c)),this.ack(r._id)),r._type){case Qr.CANDIDATE:case Qr.CONTROL:this.signal.emit(s,h,u);break;case Qr.PUBLISH:case Qr.UNPUBLISH:case Qr.RESTART_ICE:case Qr.CALL:h.uid=u,bo(this.signal,s,h).then(m=>{this.response(r._id,m)}).catch(()=>{this.response(r._id,void 0,!0)});break;case Qr.ACK:this.getListeners("res-@".concat(o,"_ack")).length>0&&this.emit("res-@".concat(o,"_ack"));break;case Qr.RESPONSE:{const{success:m,message:_}=h;this.emit("res-@".concat(o),m?"success":"failed",_);break}}}}splitMessage(r){if(r.length<J_.MAX_MESSAGE_SIZE)return[r];const o=[],{remoteToken:s}=JSON.parse(r),c=sr(6,"");let u=0,h=800;const m=Math.ceil(r.length/h);for(;r.length>0;){u++;const _={id:c,index:u,total:m,payload:r.slice(0,h),token:"".concat(this.token,"_").concat(s)};JSON.stringify(_).length>J_.MAX_MESSAGE_SIZE?h-=50:(o.push(_),r=r.slice(h))}return o.map(_=>JSON.stringify(_))}handleCheckToken(r,o){return r.token!==o?(D.debug("token changed, from ".concat(r.token," to ").concat(o)),this.reset(r.uid,o),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{D.debug("token timeout, ".concat(o)),this.reset(r.uid)},re("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const r=await bo(this.signal,Qr.CALL,void 0),o=await this.send(Qr.CALL,r);this.signal.emit(Bt.P2P_CONNECTION,o,!0)}async reset(r,o){const s=this.userMap.get(r);s&&(this.emit(Hv.ABORT),this.signal.emit(_n.ON_USER_OFFLINE,{uid:s.uid,reason:Ype.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),o||(D.debug("change local token from ".concat(o," to ").concat(o)),this.token=sr(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(Hv.ABORT)}}$(J_,"MAX_SIZE",1),$(J_,"MAX_MESSAGE_SIZE",1024);class k_e extends Pr{get connectionState(){return this._connectionState}set connectionState(r){r!==this._connectionState&&(this._connectionState=r,r===lr.CONNECTED?this.emit(Bt.WS_CONNECTED):r===lr.RECONNECTING?this.emit(Bt.WS_RECONNECTING,this._websocketReconnectReason):r===lr.CLOSED&&this.emit(Bt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(r,o){super(),$(this,"_disconnectedReason",void 0),$(this,"_websocketReconnectReason",void 0),$(this,"_connectionState",lr.CLOSED),$(this,"reconnectToken",void 0),$(this,"p2pToken",void 0),$(this,"websocket",void 0),$(this,"openConnectionTime",void 0),$(this,"clientId",void 0),$(this,"lastMsgTime",Date.now()),$(this,"uploadCache",[]),$(this,"uploadCacheInterval",void 0),$(this,"rttRolling",new o8(5)),$(this,"pingpongTimer",void 0),$(this,"pingpongTimeoutCount",0),$(this,"joinResponse",void 0),$(this,"multiIpOption",void 0),$(this,"initError",void 0),$(this,"spec",void 0),$(this,"store",void 0),$(this,"_external_signal",void 0),$(this,"onWebsocketMessage",s=>{if(s.data instanceof ArrayBuffer)return void this.emit(Bt.ON_BINARY_DATA,s.data);const c=JSON.parse(s.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){const u="res-@".concat(c._id);this.emit(u,c._result,c._message)}else if(Object.prototype.hasOwnProperty.call(c,"_type")){switch(c._type){case _n.ON_DATA_STREAM:return void this.handleDataStream(c._message);case _n.MUTE_AUDIO:case _n.MUTE_VIDEO:case _n.ON_P2P_LOST:case _n.ON_USER_ONLINE:return;case _n.ON_USER_OFFLINE:const{uid:u}=c._message;return D.debug("[".concat(this.clientId,"] user-offline uid: ").concat(u)),void this._external_signal.reset(u)}if(this.emit(c._type,c._message),c._type===_n.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===_n.ON_USER_BANNED)switch(c._message.error_code){case 14:this.close(jn.UID_BANNED);break;case 15:this.close(jn.IP_BANNED);break;case 16:this.close(jn.CHANNEL_BANNED)}if(c._type===_n.ON_USER_LICENSE_BANNED)switch(c._message.error_code){case Dt.ERR_LICENSE_MISSING:this.close(jn.LICENSE_MISSING);break;case Dt.ERR_LICENSE_EXPIRED:this.close(jn.LICENSE_EXPIRED);break;case Dt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(jn.LICENSE_MINUTES_EXCEEDED);break;case Dt.ERR_LICENSE_PERIOD_INVALID:this.close(jn.LICENSE_PERIOD_INVALID);break;case Dt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(jn.LICENSE_MULTIPLE_SDK_SERVICE);break;case Dt.ERR_LICENSE_ILLEGAL:this.close(jn.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=r.clientId,this.spec=r,this.store=o,this.websocket=new Ux("gateway-".concat(this.clientId),this.spec.retryConfig,!0,re("JOIN_GATEWAY_USE_DUAL_DOMAIN"),re("JOIN_GATEWAY_USE_443PORT_ONLY"),o),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===lr.CONNECTED&&this.reconnect("retry",So.OFFLINE)}),this.p2pToken=sr(6,""),this._external_signal=new J_(this,this.p2pToken)}async request(r,o,s,c){const u=sr(6,""),h={_id:u,_type:r,_message:o},m=this.websocket.connectionID,_=()=>new lt((z,U)=>{if(this.connectionState===lr.CONNECTED)return z();const V=()=>{this.off(Bt.WS_CLOSED,q),z()},q=()=>{this.off(Bt.WS_CONNECTED,V),U(new Le(X.WS_ABORT))};this.once(Bt.WS_CONNECTED,V),this.once(Bt.WS_CLOSED,q)});if(this.connectionState!==lr.CONNECTING&&this.connectionState!==lr.RECONNECTING||r===jt.JOIN||r===jt.REJOIN||await _(),this.websocket.sendMessage(h,!0),c)return;const y=new lt((z,U)=>{let V=!1;const q=(ce,_e)=>{V=!0,z({isSuccess:ce==="success",message:_e||{}}),this.off(Bt.WS_CLOSED,Y),this.off(Bt.WS_RECONNECTING,Y),this.emit(Bt.REQUEST_SUCCESS,r,o)};this.once("res-@".concat(u),q);const Y=()=>{U(new Le(X.WS_ABORT,"type: ".concat(r))),this.off(Bt.WS_CLOSED,Y),this.off(Bt.WS_RECONNECTING,Y),this.off("res-@".concat(u),q)};this.once(Bt.WS_CLOSED,Y),this.once(Bt.WS_RECONNECTING,Y),io(re("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==m||V||(D.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(r)),this.emit(Bt.REQUEST_TIMEOUT,r,o))})});let S=null;try{S=await y}catch(z){if(this.connectionState===lr.CLOSED||r===jt.LEAVE)throw new Le(X.WS_ABORT);return!this.spec.forceWaitGatewayResponse||s?z.throw():r===jt.JOIN||r===jt.REJOIN?null:(await _(),await this.request(r,o))}if(S.isSuccess)return S.message;const R=Number(S.message.error_code||S.message.code),P=bT(R),k=new Le(X.UNEXPECTED_RESPONSE,"".concat(P.desc,": ").concat(S.message.error_str),{code:R,data:S.message,desc:P.desc});return P.action==="success"?S.message:(D.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(r,", error_code: ").concat(R,", message: ").concat(P.desc,", action: ").concat(P.action)),R===Dt.ERR_TOO_MANY_BROADCASTERS?((r===jt.JOIN||r===jt.REJOIN)&&(this.initError=k,this.close()),k.throw()):P.action==="failed"?k.throw():P.action==="quit"?(this.initError=k,this.close(),k.throw()):(R===Dt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=S.message.option,D.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",So.MULTI_IP)):this.reconnect(P.action,So.SERVER_ERROR),r===jt.JOIN||r===jt.REJOIN?null:await this.request(r,o)))}waitMessage(r,o){return new lt(s=>{const c=u=>{(!o||o(u))&&(this.off(r,c),s(u))};this.on(r,c)})}uploadWRTCStats(r){if(!this.store.sessionId)return void D.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const o={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:r};this.upload(vT.WRTC_STATS,o)}upload(r,o){const s={_type:r,_message:o};try{this.websocket.sendMessage(s)}catch{const u=re("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(s),this.uploadCache.length>u&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==lr.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},re("UPLOAD_CACHE_INTERVAL")||2e3))}}send(r,o){const s={_type:r,_message:o};this.websocket.sendMessage(s)}async sendExtensionMessage(r,o,s){return await this._external_signal.send(r,o,s)}init(r){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new lt((o,s)=>{this.once(Bt.WS_CONNECTED,()=>o(this.joinResponse)),this.once(Bt.WS_CLOSED,()=>s(this.initError||new Le(X.WS_ABORT))),this.connectionState=lr.CONNECTING,this.websocket.init(r).catch(s)})}close(r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=r||jn.LEAVE,this.connectionState=lr.CLOSED,D.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=sr(6,""),this._external_signal.clear(),this._external_signal=new J_(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(Bt.ABORT_P2P_EXECUTION);const r=await bo(this,Bt.REQUEST_JOIN_INFO),o=await this.request(jt.JOIN,r);if(!o)return this.emit(Bt.REPORT_JOIN_GATEWAY,X.TIMEOUT,this.url||""),!1;this.joinResponse=o,this.emit(Bt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=lr.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(r,o){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(r,o)}handleDataStream(r){try{var o;const s=I_(r.payload),c=new TextDecoder().decode(s),u=JSON.parse(c);"total"in u&&"id"in u||st(o=Object.values(Qr)).call(o,u._type)?(u._uid=r.uid,this._external_signal.onMessage(u)):this.emit(_n.ON_DATA_STREAM,r)}catch{this.emit(_n.ON_DATA_STREAM,r)}}handleNotification(r){D.debug("[".concat(this.clientId,"] receive notification: "),r);const o=bT(r.code);if(o.action!=="success"){if(o.action!=="failed")return o.action==="quit"?(o.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(jn.UID_BANNED),void this.close()):void this.reconnect(o.action,So.SERVER_ERROR);D.error("[".concat(this.clientId,"] ignore error: "),o.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const r=re("PING_PONG_TIME_OUT"),o=Date.now();this.pingpongTimeoutCount>=r&&(D.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(o-this.lastMsgTime,"ms")),o-this.lastMsgTime>re("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",So.TIMEOUT):this.request(jt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const s=Date.now()-o;this.rttRolling.add(s),re("REPORT_STATS")&&this.send(jt.PING_BACK,{pingpongElapse:s})}).catch(s=>{})}handleWebsocketEvents(){this.websocket.on(qt.RECONNECT_CREATE_CONNECTION,r=>{this.emit(Bt.WS_RECONNECT_CREATE_CONNECTION,r)}),this.websocket.on(qt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(qt.CLOSED,()=>{this.connectionState=lr.CLOSED}),this.websocket.on(qt.FAILED,()=>{this._disconnectedReason=jn.NETWORK_ERROR,this.connectionState=lr.CLOSED}),this.websocket.on(qt.RECONNECTING,r=>{this._websocketReconnectReason=r,this.joinResponse=void 0,this.connectionState===lr.CONNECTED?this.connectionState=lr.RECONNECTING:this.connectionState=lr.CONNECTING}),this.websocket.on(qt.WILL_RECONNECT,(r,o,s)=>{r!=="retry"?(D.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(r)),this.reconnectToken=void 0):D.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),s(r)}),this.websocket.on(qt.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(r=>{if(this.emit(Bt.REPORT_JOIN_GATEWAY,r,this.url||""),r instanceof Le&&r.code===X.UNEXPECTED_RESPONSE&&r.data.code===Dt.ERR_NO_AUTHORIZED)return D.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",So.SERVER_ERROR);D.error("[".concat(this.clientId,"] join gateway request failed"),r.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",So.SERVER_ERROR):(this.initError=r,this.close())})}),this.websocket.on(qt.REQUEST_NEW_URLS,(r,o)=>{bo(this,Bt.REQUEST_RECOVER,this.multiIpOption).then(r).catch(o)}),this.websocket.on(qt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(_n.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}const N_e={name:"P2PChannel",create:function(e){let{store:r,statsCollector:o}=e;return new O_e(r,o)},createSubmodule:function(e){let{store:r,spec:o}=e;return new k_e(o,r)}};function O$(e,r){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),o.push.apply(o,s)}return o}function k$(e){for(var r=1;r<arguments.length;r++){var o=arguments[r]!=null?arguments[r]:{};r%2?O$(Object(o),!0).forEach(function(s){$(e,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):O$(Object(o)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(o,s))})}return e}class D_e{constructor(r){$(this,"sessionDesc",void 0),$(this,"localCapabilities",void 0),$(this,"rtpCapabilities",void 0),$(this,"candidates",void 0),$(this,"_originCandidates",void 0),$(this,"iceParameters",void 0),$(this,"dtlsParameters",void 0),$(this,"setup",void 0),$(this,"currentMidIndex",void 0),$(this,"cname",void 0),r=Mr(r);const{iceParameters:o,dtlsParameters:s,candidates:c,rtpCapabilities:u,setup:h,localCapabilities:m,sdkCodec:_,cname:y}=r,S=Sa(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=u,this.candidates=c,this._originCandidates=Mr(c),this.iceParameters=o,this.dtlsParameters=s,this.setup=h,this.localCapabilities=m,this.cname=y;for(let R=0;R<S.mediaDescriptions.length;R++){const P=S.mediaDescriptions[R];if(P.attributes.iceUfrag=o.iceUfrag,P.attributes.icePwd=o.icePwd,P.attributes.fingerprints=s.fingerprints,P.attributes.candidates=c,P.attributes.setup=h,P.media.mediaType==="video"){P.media.fmts=u.videoCodecs.map(z=>z.payloadType.toString(10));let k=u.videoCodecs.filter(z=>{var U,V;return(U=z.rtpMap)===null||U===void 0?void 0:st(V=U.encodingName.toLowerCase()).call(V,_)});k.length===0&&(k=u.videoCodecs),P.attributes.payloads=k,P.attributes.extmaps=u.videoExtensions}P.media.mediaType==="audio"&&(P.media.fmts=u.audioCodecs.map(k=>k.payloadType.toString(10)),P.attributes.payloads=u.audioCodecs,P.attributes.extmaps=u.audioExtensions),S.mediaDescriptions[R]=this.mungMediaDesc(P)}this.sessionDesc=S,this.currentMidIndex=S.mediaDescriptions.length-1}toString(){return Im(this.sessionDesc)}send(r,o,s){const{ssrcs:c,ssrcGroups:u}=U_(o,this.cname),h=this.sessionDesc.mediaDescriptions.find(y=>r===gt.VIDEO?y.media.mediaType==="video":y.media.mediaType==="audio"),m=c[0].attributes.label,_=c[0].attributes.mslabel;return h.attributes.ssrcs=h.attributes.ssrcs.concat(c),h.attributes.ssrcGroups=h.attributes.ssrcGroups.concat(u),{id:m,mslabel:_}}batchSend(r){return r.map(o=>{let{kind:s,ssrcMsg:c}=o;return this.send(s,c,void 0)})}stopSending(r){this.sessionDesc.mediaDescriptions.forEach(o=>{const s=[],c=[],u=[];o.attributes.ssrcs.forEach(h=>{st(r).call(r,h.attributes.label||"")?u.push(h):s.push(h)}),o.attributes.ssrcGroups.forEach(h=>{var m;st(m=u.map(_=>_.ssrcId)).call(m,h.ssrcIds[0])||c.push(h)}),o.attributes.ssrcs=s,o.attributes.ssrcGroups=c})}mute(r){const o=this.sessionDesc.mediaDescriptions.find(s=>s.attributes.mid===r);if(!o)throw new Error("mediaDescription not found with ".concat(r," in remote SDP when calling RemoteSDP.mute."));o.attributes.direction="inactive"}unmute(r){const o=this.sessionDesc.mediaDescriptions.find(s=>s.attributes.mid===r);if(!o)throw new Error("mediaDescription not found with ".concat(r," in remote SDP when calling RemoteSDP.unmute."));o.attributes.direction="sendonly"}receive(r,o,s){r.forEach((c,u)=>{const h=c._mediaStreamTrack,m=this.sessionDesc.mediaDescriptions.findIndex(y=>y.attributes.mid===h.kind),_=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[m],c);this.sessionDesc.mediaDescriptions[m]=_})}stopReceiving(r){}updateCandidates(r){const o=this._originCandidates.filter(c=>c.transport==="udp"),s=[];if(o.forEach(c=>{s.push(k$(k$({},c),{},{foundation:"tcpcandidate",priority:Number(c.priority)-1+"",transport:"tcp",port:Number(c.port)+90+""}))}),o.length!==0){switch(r){case No.TCP_RELAY:this.candidates=s;break;case No.UDP_TCP_RELAY:case No.RELAY:this.candidates=[...o,...s];break;default:this.candidates=o}for(const c of this.sessionDesc.mediaDescriptions)c.attributes.candidates=this.candidates}}restartICE(r){r=Mr(r),this.iceParameters=r,this.sessionDesc.mediaDescriptions.forEach(o=>{o.attributes.iceUfrag=r.iceUfrag,o.attributes.icePwd=r.icePwd})}predictReceivingMids(r){const o=[];for(let s=0;s<r;s++)o.push((this.currentMidIndex+s+1).toString(10));return o}mungRecvMediaDsec(r,o){const s=Mr(r);return qv(s,o),Bx(s,o),s}updateRecvMedia(r,o){const s=this.sessionDesc.mediaDescriptions.findIndex(c=>c.attributes.mid===r);if(s!==-1){const c=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[s],o);this.sessionDesc.mediaDescriptions[s]=c}}bumpMid(r){this.currentMidIndex+=r}updateTrackLabel(r,o,s){const c=this.sessionDesc.mediaDescriptions.find(h=>r===gt.VIDEO?h.attributes.mid==="video":h.attributes.mid==="audio");if(c){const h=c.attributes.ssrcs.find(m=>m.attributes.label===o);var u;h&&(h.attributes.label=s,(u=h.attributes.msid)===null||u===void 0||u.replace(o,s))}}mungMediaDesc(r){const o=Mr(r);return jx(o),function(s){const c=s.attributes.extmaps.find(u=>uP(u.extensionName));c&&s.attributes.extmaps.splice(s.attributes.extmaps.indexOf(c),1),s.attributes.payloads.forEach(u=>{const h=u.rtcpFeedbacks.findIndex(m=>m.type==="transport-cc");h!==-1&&u.rtcpFeedbacks.splice(h,1)})}(o),o}getSSRC(r){for(const o of this.sessionDesc.mediaDescriptions)for(const s of o.attributes.ssrcs)if(s.attributes.label===r)return[s]}}var rr;function N$(e,r){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),o.push.apply(o,s)}return o}function YP(e){for(var r=1;r<arguments.length;r++){var o=arguments[r]!=null?arguments[r]:{};r%2?N$(Object(o),!0).forEach(function(s){$(e,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):N$(Object(o)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(o,s))})}return e}let L_e=(rr=class Fw extends BG{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(r=>r.rtpMap&&r.rtpMap.encodingName.toLowerCase()||"").filter(r=>{var o;return st(o=Object.keys(FA)).call(o,r)}))]}constructor(r,o){super(r,o),$(this,"store",void 0),$(this,"peerConnection",void 0),$(this,"remoteSDP",void 0),$(this,"initialOffer",void 0),$(this,"statsFilter",void 0),$(this,"useRTX",!1),$(this,"localCapabilities",void 0),$(this,"localCandidateCount",0),$(this,"allCandidatesReceived",!1),$(this,"establishPromise",void 0),$(this,"mutex",void 0),this.store=o,this.mutex=new Oo("P2PConnection-mutex",o.clientId),this.peerConnection=new RTCPeerConnection(Fw.resolvePCConfiguration(r),{optional:[{googDscp:!0}]}),this.statsFilter=ex(this.peerConnection,re("STATS_UPDATE_INTERVAL"),void 0,Dr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const r=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!r.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const o=Nm(r.sdp),s=RT(r.sdp,{filterRTX:!this.useRTX,filterVideoFec:re("FILTER_VIDEO_FEC"),filterAudioFec:re("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=s,this.initialOffer=r,YP(YP({},o),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:s},offerSDP:r.sdp})}catch(r){throw new Le(X.GET_LOCAL_CONNECTION_PARAMS_FAILED,r.toString())}}async updateRemoteConnect(){}async connect(r){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new D_e(YP(YP({},r),{},{rtpCapabilities:r.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));const o=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}catch(o){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(o.toString()))}}async updateRemoteRTPCapabilities(r,o){throw new Le(X.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(r){}send(r,o){var s=this;return ml(function*(){const c=yield wn(s.mutex.lock());try{if(!s.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const u=r.map(P=>s.peerConnection.addTrack(P._mediaStreamTrack)),h=yield wn(s.peerConnection.createOffer()),m=Sa(h.sdp),_=r.map(P=>{const k=P._mediaStreamTrack,z=m.mediaDescriptions.find(U=>U.attributes.mid===k.kind);if(!z)throw new Error("Cannot extract ssrc from mediaDescription.");return function(U,V,q){const Y=U.attributes.ssrcs.filter(_e=>_e.attributes.label===V),ce=U.attributes.ssrcGroups;if(Y.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(ce&&Y.length>1){const _e=ce.find(Ee=>Ee.ssrcIds.indexOf(Y[0].ssrcId)!==-1);return _e?[{ssrcId:_e.ssrcIds[0],rtx:q?_e.ssrcIds[1]:void 0}]:[{ssrcId:Y[0].ssrcId}]}return[{ssrcId:Y[0].ssrcId}]}(z,k.id,s.useRTX)});let y;try{y=yield _}catch(P){throw u.forEach(k=>{vo()&&k.replaceTrack(null),s.peerConnection.removeTrack(k)}),P}const S=s.mungSendOfferSDP(h.sdp,r);s.remoteSDP.receive(r,o,y);const R=s.remoteSDP.toString();return yield wn(s.peerConnection.setLocalDescription({type:"offer",sdp:S})),yield wn(s.applySendEncodings(u,r)),yield wn(s.peerConnection.setRemoteDescription({type:"answer",sdp:R})),r.map((P,k)=>{const z=P._mediaStreamTrack.id;return{localSSRC:_[k],id:z}})}catch(u){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(u.toString()))}finally{c()}})()}async stopSending(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const o=this.peerConnection.getSenders().filter(u=>{var h;return r.indexOf(((h=u.track)===null||h===void 0?void 0:h.id)||"")!==-1});if(o.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");o.map(u=>{vo()&&u.replaceTrack(null),this.peerConnection.removeTrack(u)});const s=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(s),this.remoteSDP.stopReceiving(r);const c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(o){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(o.toString()))}}async receive(r,o,s,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{id:u,mslabel:h}=this.remoteSDP.send(r,o,c),m=new lt((S,R)=>{const P=setTimeout(()=>{R(new Error("Cannot receive track, id: ".concat(u)))},1e4),k=z=>{const U=Rn();if((U.name==="Safari"&&Number(U.version)===11||ys())&&z.track.id!==u&&z.streams[0].id===h){var V;const q=z.streams[0].getTracks()[0];return(V=this.remoteSDP)===null||V===void 0||V.updateTrackLabel(r,u,z.track.id),this.peerConnection.removeEventListener("track",k),clearTimeout(P),void S(q)}if(z.track.id===u)return this.peerConnection.removeEventListener("track",k),clearTimeout(P),void S(z.track)};this.peerConnection.addEventListener("track",k)}),_=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:_});const y=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(y),{track:await m,id:u}}catch(u){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async stopReceiving(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(r);const o=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:o});const s=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(s)}catch(o){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(o.toString()))}}async muteRemote(r){}async unmuteRemote(r){}async muteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const o=this.peerConnection.getSenders().filter(s=>{var c;return r.indexOf(((c=s.track)===null||c===void 0?void 0:c.id)||"")!==-1});if(o.length!==r.length)throw new Error("sender' length doesn't match mids' length.");o.map(s=>{if(vo()&&s.track)s.track.enabled=!1;else{const c=s.getParameters();c.encodings.forEach(u=>u.active=!1),s.setParameters(c)}})}catch(o){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(o.toString()))}}async unmuteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const o=this.peerConnection.getSenders().filter(u=>{var h;return r.indexOf(((h=u.track)===null||h===void 0?void 0:h.id)||"")!==-1});if(o.length!==r.length)throw new Error("Senders' length doesn't match mids' length.");o.map(async u=>{if(vo()&&u.track)u.track.enabled=!0;else{const h=u.getParameters();h.encodings.forEach(m=>m.active=!0),await u.setParameters(h)}});const s=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(s);const c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(o){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(o.toString()))}}restartICE(r){var o=this;return ml(function*(){const s=yield wn(o.mutex.lock("From P2PConnection.restartICE"));try{if(!o.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const c=kn().supportPCSetConfiguration;if(r===No.RELAY&&!c)return;if(c){const y=o.peerConnection.getConfiguration(),S=r===No.RELAY?"relay":"all";y.iceTransportPolicy!==S&&(D.debug("[".concat(o.store.clientId,"] restartICE change iceTransportPolicy from [").concat(y.iceTransportPolicy,"] to [").concat(S,"]")),y.iceTransportPolicy=S,o.peerConnection.setConfiguration(y))}r!==No.RELAY&&o.remoteSDP.updateCandidates(r);const u=yield wn(o.peerConnection.createOffer({iceRestart:!0}));if(!u.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const h=Nm(u.sdp),{remoteIceParameters:m}=yield h.iceParameters;o.remoteSDP.restartICE(m);const _=o.remoteSDP.toString();yield wn(o.peerConnection.setLocalDescription(u)),yield wn(o.peerConnection.setRemoteDescription({type:"answer",sdp:_}))}catch(c){D.warning("[".concat(o.store.clientId,"] restart ICE failed, abort operation"),c)}finally{s()}})()}close(){var r;this.peerConnection.close(),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}async updateEncoderConfig(r,o){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const s=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(s.sdp,[o]);this.remoteSDP.updateRecvMedia(o._mediaStreamTrack.kind,o);const u=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(s){throw new Le(X.EXCHANGE_SDP_FAILED,s.toString())}}async updateSendParameters(r,o){const s=this.peerConnection.getSenders().filter(c=>{var u;return((u=c.track)===null||u===void 0?void 0:u.id)===r});s.length===1&&await this.applySendEncodings(s,[o])}setStatsRemoteVideoIsReady(r,o){this.statsFilter.setVideoIsReady2(r,o)}async replaceTrack(r,o){const s=this.peerConnection.getSenders().find(c=>{var u;return((u=c.track)===null||u===void 0?void 0:u.id)===o});s&&await s.replaceTrack(r._mediaStreamTrack)}createDataChannels(r,o){throw new Le(X.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(r){throw new Le(X.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r;(r=this.onICEConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=r=>{r.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,D.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,D.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},re("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r){const o={iceServers:[],sdpSemantics:"plan-b"};return r.iceServers?o.iceServers=r.iceServers:r.turnServer&&r.turnServer.mode!=="off"&&(hT(r.turnServer.servers)?o.iceServers=r.turnServer.servers:(o.iceServers&&o.iceServers.push(...Fw.turnServerConfigToIceServers(r.turnServer.servers)),re("USE_TURN_SERVER_OF_GATEWAY")&&o.iceServers&&r.turnServer.serversFromGateway&&o.iceServers.push(...Fw.turnServerConfigToIceServers(r.turnServer.serversFromGateway)),r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(s=>{s.forceturn&&(o.iceTransportPolicy="relay")}))),o}static turnServerConfigToIceServers(r){const o=[];return r.forEach(s=>{s.security?s.tcpport&&o.push({username:s.username,credential:s.password,credentialType:"password",urls:"turns:".concat(s.turnServerURL,":").concat(s.tcpport,"?transport=tcp")}):(s.udpport&&o.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.udpport,"?transport=udp")}),s.tcpport&&o.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.tcpport,"?transport=tcp")}))}),o}async updateRtpSenderEncodings(r,o){var s;if(o||(o=this.peerConnection.getSenders().find(y=>{var S;return((S=y.track)===null||S===void 0?void 0:S.id)===r._mediaStreamTrack.id})),!o)return D.warn("[".concat(r.getTrackId(),"] no rtpSender found}"));if(!kn().supportSetRtpSenderParameters)return D.warn("Browser not support set rtp-sender parameters");const c={},u={};if(r instanceof mr)switch(r._optimizationMode){case"motion":c.degradationPreference="maintain-framerate";break;case"detail":c.degradationPreference="maintain-resolution";break;default:c.degradationPreference="balanced"}if(re("DSCP_TYPE")&&zf()){var h;const y=re("DSCP_TYPE");st(h=["very-low","low","medium","high"]).call(h,y)&&(u.networkPriority=y)}const m=o.getParameters(),_=(s=m.encodings)===null||s===void 0?void 0:s[0];_&&Object.assign(_,u),Object.assign(m,c),D.debug("[".concat(r.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(m.encodings))),await o.setParameters(m)}async applySendEncodings(r,o){try{if(!kn().supportSetRtpSenderParameters||r.length!==o.length)return;for(let s=0;s<r.length;s++){const c=r[s],u=o[s];c&&u&&await this.updateRtpSenderEncodings(u,c)}}catch{D.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(r,o){const s=Sa(r);return o.forEach((c,u)=>{const h=c._mediaStreamTrack,m=s.mediaDescriptions.find(_=>_.attributes.mid===h.kind);m&&qv(m,c)}),Im(s)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var o;(o=this.onFirstAudioReceived)===null||o===void 0||o.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var o;(o=this.onFirstVideoReceived)===null||o===void 0||o.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var o;(o=this.onFirstAudioDecoded)===null||o===void 0||o.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,o,s)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,r,o,s)},this.statsFilter.onSelectedLocalCandidateChanged=(r,o)=>{var s;(s=this.onSelectedLocalCandidateChanged)===null||s===void 0||s.call(this,r,o)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,o)=>{var s;(s=this.onSelectedRemoteCandidateChanged)===null||s===void 0||s.call(this,r,o)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const o=this.remoteSDP.batchSend(r).map((u,h)=>{let{id:m,mslabel:_}=u;const{kind:y}=r[h];return new lt((S,R)=>{const P=setTimeout(()=>{R(new Error("Cannot receive track, id: ".concat(m)))},1e4),k=z=>{const U=Rn();if(U.name==="Safari"&&Number(U.version)===11&&z.track.id!==m&&z.streams[0].id===_){var V;const q=z.streams[0].getTracks()[0];return(V=this.remoteSDP)===null||V===void 0||V.updateTrackLabel(y,m,z.track.id),this.peerConnection.removeEventListener("track",k),clearTimeout(P),void S({track:q,id:m})}if(z.track.id===m)return this.peerConnection.removeEventListener("track",k),clearTimeout(P),void S({track:z.track,id:m})};this.peerConnection.addEventListener("track",k)})}),s=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const c=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(c),await lt.all(o)}catch(o){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(o.toString()))}}async getRemoteSSRC(r){if(!this.remoteSDP)return;const o=this.remoteSDP.getSSRC(r);return o==null?void 0:o[0].ssrcId}setConfiguration(r){if(kn().supportPCSetConfiguration){const o=Fw.resolvePCConfiguration(r);this.peerConnection.setConfiguration(o)}}},vt(rr.prototype,"connect",[Tl],Object.getOwnPropertyDescriptor(rr.prototype,"connect"),rr.prototype),vt(rr.prototype,"stopSending",[Tl],Object.getOwnPropertyDescriptor(rr.prototype,"stopSending"),rr.prototype),vt(rr.prototype,"receive",[Tl],Object.getOwnPropertyDescriptor(rr.prototype,"receive"),rr.prototype),vt(rr.prototype,"stopReceiving",[Tl],Object.getOwnPropertyDescriptor(rr.prototype,"stopReceiving"),rr.prototype),vt(rr.prototype,"muteRemote",[Tl],Object.getOwnPropertyDescriptor(rr.prototype,"muteRemote"),rr.prototype),vt(rr.prototype,"unmuteRemote",[Tl],Object.getOwnPropertyDescriptor(rr.prototype,"unmuteRemote"),rr.prototype),vt(rr.prototype,"muteLocal",[Tl],Object.getOwnPropertyDescriptor(rr.prototype,"muteLocal"),rr.prototype),vt(rr.prototype,"unmuteLocal",[Tl],Object.getOwnPropertyDescriptor(rr.prototype,"unmuteLocal"),rr.prototype),vt(rr.prototype,"close",[Tl],Object.getOwnPropertyDescriptor(rr.prototype,"close"),rr.prototype),vt(rr.prototype,"updateEncoderConfig",[Tl],Object.getOwnPropertyDescriptor(rr.prototype,"updateEncoderConfig"),rr.prototype),vt(rr.prototype,"updateSendParameters",[Tl],Object.getOwnPropertyDescriptor(rr.prototype,"updateSendParameters"),rr.prototype),vt(rr.prototype,"replaceTrack",[Tl],Object.getOwnPropertyDescriptor(rr.prototype,"replaceTrack"),rr.prototype),vt(rr.prototype,"getRemoteSSRC",[Tl],Object.getOwnPropertyDescriptor(rr.prototype,"getRemoteSSRC"),rr.prototype),rr);function Tl(e,r,o){const s=e[r];if(typeof s!="function")throw new Error("Cannot use mutex on object property.");return o.value=async function(){const c=this.mutex,u=await c.lock("Locking from P2PConnection.".concat(r));try{for(var h=arguments.length,m=new Array(h),_=0;_<h;_++)m[_]=arguments[_];return await s.apply(this,m)}finally{u()}},o}const x_e={name:"PlanBConnection",create:function(e){let{store:r,spec:o}=e;return new L_e(o,r)}},M_e={interceptLocalAudioFrame:async function(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!kn().supportWebRTCEncodedTransform)return void D.warning("browser not support audio encoded transform");if(qA.has(e)||!e.track)return;const o={track:e.track};if(Wf()){if(!e.createEncodedStreams)return void D.warning("browser not support createEncodedStreams() API");let c=null;try{c=e.createEncodedStreams()}catch(h){return void D.error("create audio-encoded-streams error",h&&h.message)}const u=new TransformStream({transform(h,m){o.controller||(o.controller=m),e.track&&e.track.id!==o.track.id&&(D.debug("audio track changed: ".concat(o.track.id," => ").concat(e.track.id)),o.track.removeEventListener("ended",s),o.track=e.track,o.track.addEventListener("ended",s));const _=r.metadata&&r.metadata();_?function(y,S){const{chunk:R,controller:P}=S,k=re("ENABLE_AUDIO_PTS_METADATA")?Kf.AUDIO_64_BIT_PTS:Kf.METADATA;R.data=function(z,U,V){const q=V.byteLength,Y=q+wx+RG,ce=bx+Tx+Y,_e=new ArrayBuffer(z.byteLength+ce),Ee=new DataView(_e);Ee.setUint8(0,wG),Ee.setUint16(1,Y),Ee.setUint8(3,U),Ee.setUint16(4,q);for(let ke=0;ke<q;ke++)Ee.setUint8(6+ke,V[ke]);const me=new Uint8Array(Ee.buffer);return me.set(new Uint8Array(z),ce),me.buffer}(R.data,k,y),P.enqueue(R)}(_,{chunk:h,controller:m}):m.enqueue(h)}});c.readable.pipeThrough(u).pipeTo(c.writable)}else if(vo()){if(typeof RTCRtpScriptTransform>"u")return void D.warning("browser not support RTCRtpScriptTransform");const c=KA(),u=new MessageChannel;await new lt(m=>c.onmessage=_=>{_.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"audio-metadata-tx",port:u.port2},[u.port2]);e.transform=h,await new lt(m=>c.onmessage=_=>{_.data==="started"&&m(void 0)}),u.port1.onmessage=m=>{var _;if(m.data.transformed&&e.track&&((_=e.track)===null||_===void 0?void 0:_.id)!==o.track.id)D.debug("audio track changed: ".concat(o.track.id," => ").concat(e.track.id)),o.track.removeEventListener("ended",s),o.track=e.track,o.track.addEventListener("ended",s);else if(m.data.getMetadata){const y=r.metadata&&r.metadata();y&&u.port1.postMessage({metadata:y})}},o.worker=c}function s(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",s)}const c=qA.get(e);if(c){qA.delete(e);try{var u,h;(u=c.controller)===null||u===void 0||u.terminate(),(h=c.worker)===null||h===void 0||h.terminate()}catch(m){D.warning(m&&m.message)}}}qA.set(e,o),e.track.addEventListener("ended",s)},interceptRemoteAudioFrame:async function(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!kn().supportWebRTCEncodedTransform)return void D.warning("browser not support audio encoded transform");if(eP.has(e))return;const o={track:e.track,onMetadata:r.onMetadata};if(Wf()){if(!e.createEncodedStreams)return void D.warning("browser not support createEncodedStreams() API");ML(Mn.CHROME,87,116)||(r.enableTopn=!1);let c=null;try{c=e.createEncodedStreams()}catch(h){return void D.error("create audio-encoded-streams error",h&&h.message)}const u=new TransformStream({transform(h,m){o.controller||(o.controller=m),e.track&&e.track.id!==o.track.id&&(D.debug("audio track changed: ".concat(o.track.id," => ").concat(e.track.id)),o.track.removeEventListener("ended",s),o.track=e.track,o.track.addEventListener("ended",s)),r.enableTopn?function(_,y,S){var R;const P=CG(new DataView(y.data));if(!P)return S.enqueue(y);const k=_.track.id;gpe.set(k,_.track);const z=(R=P.tlv.find(_e=>_e.tag===Kf.AUDIO_LEVEL))===null||R===void 0?void 0:R.value;let U=0;typeof z=="number"&&(U=127-z);const V=Math.round(Math.pow(10,U/60)-1),{selected:q,speaker:Y}=function(_e,Ee){let me=Bv.get(_e);if(me||(me=function(ke){const Ye=new AG;return Bv.set(ke,Ye),pd||(pd=new ppe(re("TOPN_SILENCE_THRESHOLD")||500),pd.on("ActiveSpeakerChanged",ut=>{ut!=null&&(JA=ut)})),pd.addSpeakers([Ye]),Ye}(_e)),Bv.size<=PG)return{selected:!0,speaker:me};if(!pd)throw new Error("no active speaker detector");return pd.levelChanged(me.id,Ee),L_=pd.loudest.map(ke=>ke.id),JA&&!st(L_).call(L_,JA)&&L_.length>=PG&&L_.pop(),{selected:st(L_).call(L_,me.id)||me.id===JA,speaker:me}}(_,V),ce=function(_e,Ee,me){const ke=md.get(_e)||new mpe(_e,Ee);return ke.score=me,md.set(_e,ke),function(Ye){if(QA.set(Ye,!0),!ZA)return void(ZA=Date.now());const ut=Date.now();ut-ZA>1e3&&(QA.get(Ye)?QA.set(Ye,!1):(OG(Ye),QA.delete(Ye)),ZA=ut)}(_e),ke}(k,_.track,Y.energyScore);ce.addSample(q),ce.active&&(y.data=P.frame.buffer,S.enqueue(y))}(e,h,m):r.enableMetadata?function(_,y,S){const R=CG(new DataView(_.data));if(!R)return y.enqueue(_);const P=R.tlv.find(k=>k.tag===Kf.METADATA||k.tag===Kf.AUDIO_64_BIT_PTS);P&&S&&P.value instanceof Uint8Array&&S(P.value),_.data=R.frame.buffer,y.enqueue(_)}(h,m,r.onMetadata):m.enqueue(h)}});c.readable.pipeThrough(u).pipeTo(c.writable)}else if(vo()){if(typeof RTCRtpScriptTransform>"u")return void D.warning("browser not support RTCRtpScriptTransform");const c=KA(),u=new MessageChannel;await new lt(m=>c.onmessage=_=>{_.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"audio-metadata-rx",port:u.port2},[u.port2]);e.transform=h,await new lt(m=>c.onmessage=_=>{_.data==="started"&&m(void 0)}),u.port1.onmessage=m=>{var _;m.data.transformed&&e.track&&((_=e.track)===null||_===void 0?void 0:_.id)!==o.track.id?(D.debug("audio track changed: ".concat(o.track.id," => ").concat(e.track.id)),o.track.removeEventListener("ended",s),o.track=e.track,o.track.addEventListener("ended",s)):m.data.metadata&&o.onMetadata&&o.onMetadata(m.data.metadata)},o.worker=c}function s(){e.track.removeEventListener("ended",s),function(c){const u=eP.get(c);if(u){(function(_){const y=Bv.get(_);y&&(Bv.delete(_),pd&&(pd.removeSpeakers([y]),Bv.size===0&&(pd.destroy(),pd=null)))})(c),OG(c.track.id),eP.delete(c);try{var h,m;(h=u.controller)===null||h===void 0||h.terminate(),(m=u.worker)===null||m===void 0||m.terminate()}catch(_){D.warning(_&&_.message)}}}(e)}eP.set(e,o),e.track.addEventListener("ended",s)},interceptLocalVideoFrame:async function(e,r){if(!kn().supportWebRTCEncodedTransform)return void D.warning("browser not support video encoded transform");if(tP.has(e)||!e.track)return;const o={track:e.track};if(Wf()){if(!e.createEncodedStreams)return void D.warning("browser not support createEncodedStreams() API");let c=null;try{c=e.createEncodedStreams()}catch(m){return void D.error("create video-encoded-streams error",m&&m.message)}const u=[];r.on("sei-to-send",m=>{u.push(m)});const h=new TransformStream({transform(m,_){o.controller||(o.controller=_),e.track&&e.track.id!==o.track.id&&(D.debug("video track changed: ".concat(o.track.id," => ").concat(e.track.id)),o.track.removeEventListener("ended",s),o.track=e.track,o.track.addEventListener("ended",s));const y=u.shift();y&&(m.data=function(S,R){const P=function(Y){const ce=Y.length;let _e=[],Ee=0;for(;Ee<ce;)Ee+2<ce&&Y[Ee]===0&&Y[Ee+1]===0&&(Y[Ee+2]===0||Y[Ee+2]===1||Y[Ee+2]===2||Y[Ee+2]===3)?(_e.push(Y[Ee],Y[Ee+1],3,Y[Ee+2]),Ee+=3):(_e.push(Y[Ee]),Ee++);return new Uint8Array(_e)}(R),k=P.length,z=Math.floor(k/255),U=k%255,V=new Uint8Array(6+z+1+k+S.byteLength);V[0]=0,V[1]=0,V[2]=0,V[3]=1,V[4]=6,V[5]=101;let q=0;for(;q<z;)V[6+q]=255,q++;return V[6+q]=U,q++,V.set(P,6+q),V.set(new Uint8Array(S),6+q+k),V.buffer}(m.data,y)),_.enqueue(m)}});c.readable.pipeThrough(h).pipeTo(c.writable)}else{if(!vo())return;{if(typeof RTCRtpScriptTransform>"u")return void D.warning("browser not support RTCRtpScriptTransform");const c=KA(),u=new MessageChannel;await new lt(m=>c.onmessage=_=>{_.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"sei-tx",port:u.port2},[u.port2]);e.transform=h,await new lt(m=>c.onmessage=_=>{_.data==="started"&&m(void 0)}),r.on("sei-to-send",m=>{u.port1.postMessage({sei:m})}),u.port1.onmessage=m=>{var _;m.data.transformed&&e.track&&((_=e.track)===null||_===void 0?void 0:_.id)!==o.track.id&&(D.debug("video track changed: ".concat(o.track.id," => ").concat(e.track.id)),o.track.removeEventListener("ended",s),o.track=e.track,o.track.addEventListener("ended",s))},o.worker=c}}function s(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",s)}const c=tP.get(e);if(c){tP.delete(e);try{var u,h;(u=c.controller)===null||u===void 0||u.terminate(),(h=c.worker)===null||h===void 0||h.terminate()}catch(m){D.warning(m&&m.message)}}}tP.set(e,o),e.track.addEventListener("ended",s)},interceptRemoteVideoFrame:async function(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!kn().supportWebRTCEncodedTransform)return void D.warning("browser not support video encoded transform");if(!e.track)return;if(yT.has(e)){const c=yT.get(e);return void(c&&(c.onSei=r.onSei))}const o={track:e.track,onSei:r.onSei};if(Wf()){if(!e.createEncodedStreams)return void D.warning("browser not support createEncodedStreams() API");let c=null;try{c=e.createEncodedStreams()}catch(h){return void D.error("create video-encoded-streams error",h&&h.message)}const u=new TransformStream({transform(h,m){o.controller||(o.controller=m),e.track&&e.track.id!==o.track.id&&(D.debug("video track changed: ".concat(o.track.id," => ").concat(e.track.id)),o.track.removeEventListener("ended",s),o.track=e.track,o.track.addEventListener("ended",s));const _=function(y){const S=new DataView(y.data);let R=0;for(;R+4<y.data.byteLength;){if(S.getUint8(R+0)===0&&S.getUint8(R+1)===0&&S.getUint8(R+2)===0&&S.getUint8(R+3)===1&&S.getUint8(R+4)===6){let P=R+6,k=0,z=0;for(;(z=S.getUint8(P++))===255;)k+=255;k+=z;const U=_pe(y.data,P,k);return new Uint8Array(U)}R++}return null}(h);_&&o.onSei&&o.onSei(_),m.enqueue(h)}});c.readable.pipeThrough(u).pipeTo(c.writable)}else if(vo()){if(typeof RTCRtpScriptTransform>"u")return void D.warning("browser not support RTCRtpScriptTransform");const c=KA(),u=new MessageChannel;await new lt(m=>c.onmessage=_=>{_.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"sei-rx",port:u.port2},[u.port2]);e.transform=h,await new lt(m=>c.onmessage=_=>{_.data==="started"&&m(void 0)}),u.port1.onmessage=m=>{var _;m.data.transformed&&e.track&&((_=e.track)===null||_===void 0?void 0:_.id)!==o.track.id?(D.debug("video track changed: ".concat(o.track.id," => ").concat(e.track.id)),o.track.removeEventListener("ended",s),o.track=e.track,o.track.addEventListener("ended",s)):m.data.sei&&o.onSei&&o.onSei(m.data.sei)},o.worker=c}function s(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",s)}(function(c){const u=yT.get(c);if(u){yT.delete(c);try{var h,m;(h=u.controller)===null||h===void 0||h.terminate(),(m=u.worker)===null||m===void 0||m.terminate()}catch(_){D.warning(_&&_.message)}}})(e)}yT.set(e,o),e.track.addEventListener("ended",s)}},U_e={name:"InterceptFrame",create:()=>M_e};tx(),Xn("PROCESS_ID","process-".concat(sr(8,""),"-").concat(sr(4,""),"-").concat(sr(4,""),"-").concat(sr(4,""),"-").concat(sr(12,""))),function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(r){return void D.error("Error loading sdk config",r.message)}if(e)try{const r=JSON.parse(window.atob(e)),o=Date.now();D.debug("Loading global parameters from cache",r),Object.keys(r).forEach(s=>{if(Object.prototype.hasOwnProperty.call(pr,s)){const{value:c,expires:u}=r[s];if(u&&u<=o)return;fd[s]=c,pr[s]=c}})}catch(r){D.error("Error loading mutableParamsCache: ".concat(e),r.message)}}(),Array.isArray(fd.AREAS)&&fd.AREAS.length>0&&$x(fd.AREAS,!0);const D$=(e,r,o)=>{D.debug("setParameter key:".concat(e,", value:").concat(JSON.stringify(r))),Xn(e,r,o)};Dm(s_e,!1),Dm(l_e,!1),Dm(Wme,!1),Dm(v_e,!1),Dm(r_e,!1),Dm(N_e,!1),Dm(x_e,!1),Dm(U_e,!1);const yi=function(e){const r=new Pr,o=e,s={getListeners:r.getListeners.bind(r),on:(c,u)=>(function(h,m){h===Eh.SECURITY_POLICY_VIOLATION&&f7(m,!0)}(c,u),r.on.bind(r)(c,u)),addListener:r.addListener.bind(r),once:r.once.bind(r),off:r.off.bind(r),removeAllListeners:r.removeAllListeners.bind(r),emit:r.emit.bind(r),safeEmit:r.safeEmit.bind(r)};return h7(h7({},o),s)}({__TRACK_LIST__:kv,VERSION:gl,BUILD:ix,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:D$,getParameter:re,getSupportedCodec:async function(){let e={audio:[],video:[]};try{let r=new RTCPeerConnection;const o=await async function(s){let c;return kn().supportUnifiedPlan?(s.addTransceiver("video",{direction:"recvonly"}),s.addTransceiver("audio",{direction:"recvonly"}),c=(await s.createOffer()).sdp):c=(await s.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,c}(r);if(!o)return e;r.close(),r=null,e=function(s){const c={video:[],audio:[]};return s.match(/ VP8/i)&&c.video.push("VP8"),s.match(/ VP9/i)&&c.video.push("VP9"),s.match(/ AV1/i)&&c.video.push("AV1"),s.match(/ H264/i)&&c.video.push("H264"),s.match(/ H265/i)&&c.video.push("H265"),s.match(/ opus/i)&&c.audio.push("OPUS"),s.match(/ PCMU/i)&&c.audio.push("PCMU"),s.match(/ PCMA/i)&&c.audio.push("PCMA"),s.match(/ G722/i)&&c.audio.push("G722"),c}(o)}catch(r){throw new Oe(X.CREATE_OFFER_FAILED,r.toString&&r.toString()).print()}return e},checkSystemRequirements:function(){const e=wt.reportApiInvoke(null,{name:_i.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:xr.TRACER});let r=!1;try{const u=window.RTCPeerConnection,h=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,m=window.WebSocket;r=!!(u&&h&&m),r&&jL()&&LW(75)&&new u().close()}catch(u){return D.error("check system requirement failed: ",u),!1}let o=!1;const s=Rn();s.name===Mn.CHROME&&Number(s.version)>=58&&(dd.engine.name!=="WebKit"||function(){const u=Rn();if(OA()){if(u.os===Fi.MAC_OS)return!0;if(u.os===Fi.IOS){const h=dd.os.version&&dd.os.version.split(".");if(h&&Number(h[0])===14&&h[1]&&Number(h[1])>=3||h&&Number(h[0])>14)return!0}}return!1}())&&(o=!0),(s.name===Mn.FIREFOX&&Number(s.version)>=56||s.name===Mn.OPERA&&Number(s.version)>=45||s.name===Mn.SAFARI&&Number(s.version)>=11||s.name==="WebKit"&&(ys()||au())&&s.osVersion&&Number(s.osVersion.split(".")[0])>=11||jW()||Rn().name===Mn.QQ)&&(o=!0),D.debug("checkSystemRequirements, api:",r,"browser",o);const c=r&&o;return e.onSuccess(c),c},getDevices:function(e){return Vc.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return Vc.getRecordingDevices(e)},getCameras:function(e){return Vc.getCamerasDevices(e)},getElectronScreenSources:L8,getPlaybackDevices:function(e){return Vc.getSpeakers(e)},createClient:function(){var e;let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const o=sr(5,"client-"),s=wt.reportApiInvoke(null,{id:o,name:_i.CREATE_CLIENT,options:[r],tag:xr.TRACER});try{(function(c){ki(c.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),ki(c.mode,"config.mode",["rtc","live","p2p"]),c.audioCodec!==void 0&&ki(c.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),c.proxyServer!==void 0&&ro(c.proxyServer,"config.proxyServer",1,1e4),c.turnServer!==void 0&&qW(c.turnServer),c.httpRetryConfig!==void 0&&KW(c.httpRetryConfig),c.websocketRetryConfig!==void 0&&KW(c.websocketRetryConfig)})(r)}catch(c){throw s.onError(c),c}return(MW(16,0)||UW(16,0,!0))&&(r.codec==="vp9"&&(r.codec="vp8",D.debug("browser not support vp9, force use vp8")),Xn("UNSUPPORTED_VIDEO_CODEC",["vp9"])),r.audioCodec===void 0&&(r.audioCodec="opus"),s.onSuccess(),new zme(mu(mu({forceWaitGatewayResponse:!0},r),{},{role:st(e=["rtc","p2p"]).call(e,r.mode)?"host":r.role||"audience"}),o)},createCameraVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const r=re("CAMERA_CAPTURE_CONFIG"),o=sr(8,"track-cam-"),s=wt.reportApiInvoke(null,{id:o,tag:xr.TRACER,name:_i.CREATE_CAM_VIDEO_TRACK,options:[Rr({},e),r]});r&&(e.encoderConfig=r);const c=HA(e);let u=null;D.info("start create camera video track with config",JSON.stringify(e),"trackId",o);try{u=(await Uc({video:c},o)).getVideoTracks()[0]||null}catch(m){throw s.onError(m),m}if(!u){const m=new Le(X.UNEXPECTED_ERROR,"can not find track in media stream");return s.onError(m),m.throw(D)}e.optimizationMode&&Sx(o,u,e,mh(e.encoderConfig));const h=new vx(u,e,c,e.scalabiltyMode?BA(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,o);return s.onSuccess(h.getTrackId()),D.info("create camera video success, trackId:",o),h},createCustomVideoTrack:function(e){const r=sr(8,"track-cus-"),o=wt.reportApiInvoke(null,{id:r,tag:xr.TRACER,name:_i.CREATE_CUSTOM_VIDEO_TRACK,options:[e]}),s=new mr(e.mediaStreamTrack,{width:e.width,height:e.height,frameRate:e.frameRate,bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?BA(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,r,[ar.CUSTOM_TRACK]);return o.onSuccess(s.getTrackId()),D.info("create custom video track success with config",e,"trackId",s.getTrackId()),s},createScreenVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const o=typeof r=="object"?function(P){return G8(P)}(r):void 0;o&&(r="auto");const s=sr(8,"track-scr-v-"),c=wt.reportApiInvoke(null,{id:s,tag:xr.TRACER,name:_i.CREATE_SCREEN_VIDEO_TRACK,options:[Rr({},e),r]});e.encoderConfig?typeof e.encoderConfig=="string"||e.encoderConfig.width&&e.encoderConfig.height||(e.encoderConfig.width={max:1920},e.encoderConfig.height={max:1080}):e.encoderConfig="1080p_2";const u=function(P){const k={};P.screenSourceType&&(k.mediaSource=P.screenSourceType),P.extensionId&&Wf()&&(k.extensionId=P.extensionId);const{displaySurface:z,selfBrowserSurface:U,surfaceSwitching:V,systemAudio:q,preferCurrentTab:Y}=P;(cT(107)||UL(107)||VL(93))&&(z&&(ki(z,"displaySurface",["browser","window","monitor"]),k.displaySurface=z),U?(ki(U,"selfBrowserSurface",["exclude","include"]),k.selfBrowserSurface=U):k.selfBrowserSurface="include",V&&(ki(V,"surfaceSwitching",["exclude","include"]),k.surfaceSwitching=V)),(cT(105)||UL(105)||VL(91))&&q&&(ki(q,"systemAudio",["exclude","include"]),k.systemAudio=q),(cT(94)||UL(94)||VL(80))&&Y&&(k.preferCurrentTab=!0),P.electronScreenSourceId&&(k.sourceId=P.electronScreenSourceId);const ce=P.encoderConfig?lx(P.encoderConfig):null;return k.mandatory={chromeMediaSource:"desktop",maxWidth:ce?ce.width:void 0,maxHeight:ce?ce.height:void 0},ce&&(ce.frameRate&&(typeof ce.frameRate=="number"?(k.mandatory.maxFrameRate=ce.frameRate,k.mandatory.minFrameRate=ce.frameRate):(k.mandatory.maxFrameRate=ce.frameRate.max||ce.frameRate.ideal||ce.frameRate.exact||void 0,k.mandatory.minFrameRate=ce.frameRate.min||ce.frameRate.ideal||ce.frameRate.exact||void 0),k.frameRate=ce.frameRate),ce.width&&(k.width=ce.width),ce.height&&(k.height=ce.height)),k}(e);let h=null,m=null;const _=kn();if(!_.supportShareAudio&&r==="enable"){const P=new Le(X.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return c.onError(P),P.throw(D)}D.info("start create screen video track with config",e,"withAudio",r,"trackId",s);const y=_.supportShareAudio&&r!=="disable";try{const P=await Uc({screen:u,screenAudio:y?o||!0:void 0},s);h=P.getVideoTracks()[0]||null,m=P.getAudioTracks()[0]||null}catch(P){throw c.onError(P),P}if(!h){const P=new Le(X.UNEXPECTED_ERROR,"can not find track in media stream");return c.onError(P),P.throw(D)}if(!m&&r==="enable"){h&&h.stop();const P=new Le(X.SHARE_AUDIO_NOT_ALLOWED);return c.onError(P),P.throw(D)}e.optimizationMode||(e.optimizationMode="detail"),e.optimizationMode&&(Sx(s,h,e,e.encoderConfig&&lx(e.encoderConfig)||void 0),e.encoderConfig&&typeof e.encoderConfig!="string"&&(e.encoderConfig.bitrateMin=e.encoderConfig.bitrateMax));const S=new mr(h,e.encoderConfig?lx(e.encoderConfig):{},e.scalabiltyMode?BA(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,s,[ar.SCREEN_TRACK]);if(!m)return c.onSuccess(S.getTrackId()),D.info("create screen video track success","video:",S.getTrackId()),S;const R=new Br(m,void 0,sr(8,"track-scr-a-"),!1);return c.onSuccess([S.getTrackId(),R.getTrackId()]),D.info("create screen video track success","video:",S.getTrackId(),"audio:",R.getTrackId()),[S,R]},createMicrophoneAndCameraTracks:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const o=re("CAMERA_CAPTURE_CONFIG"),s=sr(8,"track-mic-"),c=sr(8,"track-cam-"),u=wt.reportApiInvoke(null,{id:"".concat(s,"-").concat(c),tag:xr.TRACER,name:_i.CREATE_MIC_AND_CAM_TRACKS,options:[e,r,o]});o&&(r.encoderConfig=o);const h=HA(r),m=H8(e);let _=null,y=null;D.info("start create camera video track(".concat(c,") and microphone audio track(").concat(s,") with config, audio: ").concat(JSON.stringify(e),", video: ").concat(JSON.stringify(r)));try{const P=await Uc({audio:m,video:h},"".concat(s,"-").concat(c));_=P.getAudioTracks()[0],y=P.getVideoTracks()[0]}catch(P){throw u.onError(P),P}if(!_||!y){const P=new Le(X.UNEXPECTED_ERROR,"can not find tracks in media stream");return u.onError(P),P.throw(D)}r.optimizationMode&&Sx(c,y,r,mh(r.encoderConfig));const S=new $A(_,e,m,s),R=new vx(y,r,h,r.scalabiltyMode?BA(r.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},r.optimizationMode,c);return u.onSuccess([S.getTrackId(),R.getTrackId()]),D.info("create camera video track(".concat(c,") and microphone audio track(").concat(s,") success")),[S,R]},createMicrophoneAudioTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const r=sr(8,"track-mic-"),o=wt.reportApiInvoke(null,{id:r,tag:xr.TRACER,name:_i.CREATE_MIC_AUDIO_TRACK,options:[e]}),s=H8(e);let c=null;D.info("start create microphone audio track with config",JSON.stringify(e),"trackId",r);try{c=(await Uc({audio:s},r)).getAudioTracks()[0]||null}catch(h){throw o.onError(h),h}if(!c){const h=new Le(X.UNEXPECTED_ERROR,"can not find track in media stream");return o.onError(h),h.throw(D)}const u=new $A(c,e,s,r);return o.onSuccess(u.getTrackId()),D.info("create microphone audio track success, trackId:",r),u},createCustomAudioTrack:function(e){const r=sr(8,"track-cus-"),o=wt.reportApiInvoke(null,{id:r,tag:xr.TRACER,name:_i.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),s=new Br(e.mediaStreamTrack,e.encoderConfig?WA(e.encoderConfig):{},r,!1);return D.info("create custom audio track success with config",e,"trackId",s.getTrackId()),o.onSuccess(s.getTrackId()),s},createBufferSourceAudioTrack:async function(e){var r;const{cacheOnlineFile:o,encoderConfig:s}=e;let{source:c}=e;const u={source:c instanceof AudioBuffer?"AudioBuffer":c instanceof File?(r=File.name)!==null&&r!==void 0?r:"File":c,cacheOnlineFile:o,encoderConfig:s},h=sr(8,"track-buf-"),m=wt.reportApiInvoke(null,{id:h,tag:xr.TRACER,name:_i.CREATE_BUFFER_AUDIO_TRACK,options:[u]});if(re("DISABLE_WEBAUDIO"))throw new Le(X.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");D.info("start create buffer source audio track with config",JSON.stringify(u),"trackId",h);const _=c;if(!(c instanceof AudioBuffer))try{c=await async function(R,P){let k=null;if(typeof R=="string"){const U=kz.get(R);if(U)return D.debug("use cached audio resource: ",R),U;try{k=(await hd(()=>Hs.get(R,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(V){throw new Le(X.FETCH_AUDIO_FILE_FAILED,V.toString())}}else k=await new lt((V,q)=>{const Y=new FileReader;Y.onload=ce=>{ce.target?V(ce.target.result):q(new Le(X.READ_LOCAL_AUDIO_FILE_ERROR))},Y.onerror=()=>{q(new Le(X.READ_LOCAL_AUDIO_FILE_ERROR))},Y.readAsArrayBuffer(R)});const z=await function(U){const V=Uv();return new lt((q,Y)=>{V.decodeAudioData(U,ce=>{q(ce)},ce=>{Y(new Le(X.DECODE_AUDIO_FILE_FAILED,ce.toString()))})})}(k);return typeof R=="string"&&P&&kz.set(R,z),z}(c,o)}catch(R){return m.onError(R),R.throw(D)}const y=new lpe(c),S=new cpe(_,y,s?WA(s):{},h);return D.info("create buffer source audio track success, trackId:",h),m.onSuccess(S.getTrackId()),S},setAppType:function(e){if(D.debug("setAppType: ".concat(e)),!(Number.isInteger(e)&&e>=0))throw D.debug("Invalid appType"),new Oe(X.INVALID_PARAMS,"invalid app type",e);Xn("APP_TYPE",Math.floor(e))},setLogLevel:function(e){D.setLogLevel(e)},enableLogUpload:function(){re("USE_NEW_LOG")?Xn("UPLOAD_LOG",!0):D.enableLogUpload()},disableLogUpload:function(){re("USE_NEW_LOG")?Xn("UPLOAD_LOG",!1):D.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new kH},checkAudioTrackIsActive:async function(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const o=wt.reportApiInvoke(null,{tag:xr.TRACER,name:_i.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[r]});if(!(e instanceof Br||e instanceof jv)){const _=new Oe(X.INVALID_TRACK,"the parameter is not a audio track");return o.onError(_),_.throw()}r&&r<1e3&&(r=1e3);const s=e instanceof Br?e.getTrackLabel():"remote_track",c=e.getVolumeLevel();let u=c,h=c;const m=Date.now();return new lt(_=>{const y=setInterval(()=>{const S=e.getVolumeLevel();u=S>u?S:u,h=S<h?S:h;const R=u-h>1e-4,P=Date.now()-m;if(R||P>r){clearInterval(y);const k=R,z={duration:P,deviceLabel:s,maxVolumeLevel:u,result:k};D.info("[track-".concat(e.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(z))),o.onSuccess(z),_(k)}},200)})},checkVideoTrackIsActive:async function(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const o=wt.reportApiInvoke(null,{tag:xr.TRACER,name:_i.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[r]});if(!(e instanceof mr||e instanceof Fv)){const R=new Oe(X.INVALID_TRACK,"the parameter is not a video track");return o.onError(R),R.throw()}r&&r<1e3&&(r=1e3);const s=e instanceof mr?e.getTrackLabel():"remote_track",c=e.getMediaStreamTrack(!0),u=document.createElement("video");u.style.width="1px",u.style.height="1px",u.setAttribute("muted",""),u.muted=!0,u.setAttribute("playsinline",""),u.controls=!1,(vo()||OA())&&(u.style.opacity="0.01",u.style.position="fixed",u.style.left="0",u.style.top="0",document.body.appendChild(u)),u.srcObject=new MediaStream([c]),u.play();const h=document.createElement("canvas");h.width=160,h.height=120;let m=0,_=0;try{const R=Date.now();m=await function(P,k,z,U){let V,q=0,Y=null;return new lt((ce,_e)=>{function Ee(){q>U&&V&&(V(),ce(q));const me=z.getContext("2d");if(!me){const ut=new Oe(X.UNEXPECTED_ERROR,"can not get canvas 2d context.");return D.error(ut.toString()),void _e(ut)}me.drawImage(P,0,0,160,120);const ke=me.getImageData(0,0,z.width,z.height),Ye=Math.floor(ke.data.length/3);if(Y){for(let ut=0;ut<Ye;ut+=3)if(ke.data[ut]!==Y[ut])return q+=1,void(Y=ke.data);Y=ke.data}else Y=ke.data}setTimeout(()=>{V&&(V(),ce(q))},k),V=px(()=>{Ee()},30)})}(u,r,h,4),_=Date.now()-R}catch(R){throw o.onError(R),R}Ame===Mn.SAFARI&&(u.pause(),u.remove()),u.srcObject=null;const y=m>4,S={duration:_,changedPicNum:m,deviceLabel:s,result:y};return D.info("[track-".concat(e.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(S))),o.onSuccess(S),y},setArea:$x,audioElementPlayCenter:$s,resumeAudioContext:function(){$s.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(e){Hme.processExternalMediaAEC(e)},registerExtensions:function(e){const r=re("PLUGIN_INFO")||[];e.forEach(o=>{"name"in o&&!st(r).call(r,o.name)&&r.push(o.name);const s=o;s.__registered__=!0,s.logger.hookLog=D.extLog,s.reporter.hookApiInvoke=wt.extApiInvoke,s.parameters&&Object.keys(s.parameters).forEach(c=>{s.parameters[c]=re(c)})}),D$("PLUGIN_INFO",r)},ChannelMediaRelayError:zv,ChannelMediaRelayEvent:Yf,ChannelMediaRelayState:ba,RemoteStreamFallbackType:tpe,RemoteStreamType:epe,ConnectionDisconnectedReason:jn,AudienceLatencyLevelType:kfe,AREAS:Un,preload:async function(e,r,o,s){return i9(e,r,o,s)}});return Object.defineProperties(yi,{onAudioAutoplayFailed:{get:()=>Fc.onAudioAutoplayFailed,set:e=>{Fc.onAudioAutoplayFailed=e}},onAutoplayFailed:{get:()=>Fc.onAutoplayFailed,set:e=>{Fc.onAutoplayFailed=e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>yi._onSecurityPolicyViolation,set(e){yi._onSecurityPolicyViolation=e,f7(e)}},__CLIENT_LIST__:{get:()=>re("SHOW_GLOBAL_CLIENT_LIST")?x_:[]}}),Vc.on(k_.CAMERA_DEVICE_CHANGED,e=>{D.info("camera device changed",JSON.stringify(e)),yi.onCameraChanged&&yi.onCameraChanged(e),yi.safeEmit(Eh.CAMERA_CHANGED,e)}),Vc.on(k_.RECORDING_DEVICE_CHANGED,e=>{D.info("microphone device changed",JSON.stringify(e)),yi.onMicrophoneChanged&&yi.onMicrophoneChanged(e),yi.safeEmit(Eh.MICROPHONE_CHANGED,e)}),Vc.on(k_.PLAYOUT_DEVICE_CHANGED,e=>{D.debug("playout device changed",JSON.stringify(e)),yi.onPlaybackDeviceChanged&&yi.onPlaybackDeviceChanged(e),yi.safeEmit(Eh.PLAYBACK_DEVICE_CHANGED,e)}),$s.onAutoplayFailed=()=>{D.info("detect audio element autoplay failed"),Fc.onAudioAutoplayFailed&&Fc.onAudioAutoplayFailed()},Jn.on("autoplay-failed",()=>{D.info("detect webaudio autoplay failed"),Fc.onAudioAutoplayFailed&&Fc.onAudioAutoplayFailed(),yi.safeEmit(Eh.AUTOPLAY_FAILED)}),Jn.on(so.STATE_CHANGE,(e,r)=>{D.info("audio context state changed: ".concat(r," => ").concat(e)),yi.onAudioContextStateChanged&&yi.onAudioContextStateChanged(e,r),yi.safeEmit(Eh.AUDIO_CONTEXT_STATE_CHANGED,e,r)}),ai.on(Rv.NETWORK_STATE_CHANGE,(e,r)=>{D.info("[network-indicator] network state changed, ".concat(r," => ").concat(e))}),window&&(window.__ARTC__=yi),yi})}(hk)),hk.exports}var U6e=M6e();const UR=b0(U6e),V6e={BASE_URL:"./",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_AGORA_APP_ID:"a2a7f4eb05284449b1063eb71d8301dc"},Koe="a2a7f4eb05284449b1063eb71d8301dc";console.log("AgoraProvider: DEFAULT_AGORA_APP_ID:",Koe);console.log("AgoraProvider: import.meta.env:",V6e);const F6e=UR.createClient({mode:"rtc",codec:"vp8"});let yw=null;const qoe=L.createContext(null),Yoe=({children:n,appId:t=Koe,channel:i=null,token:a=null,uid:l=null,enabled:d=!0,startMuted:p=!0,onClientReady:E=()=>{}})=>{console.log("AgoraProvider: appId prop:",t);const[v,b]=L.useState(!1),[w,A]=L.useState(!1),[N,F]=L.useState([]),[j,B]=L.useState(null),[H,ee]=L.useState(null),[K,te]=L.useState(null),[le,oe]=L.useState(!1),[ge,Z]=L.useState(!1),[Q,ne]=L.useState(!1),[se,fe]=L.useState(null),[he,ue]=L.useState(!1),Me=Dd(),He=L.useRef(F6e),rt=L.useRef({appId:t,channel:i,uid:l,enabled:d}),we=L.useRef(!1),Ce=L.useRef(null);L.useRef(null),L.useEffect(()=>{rt.current={appId:t,channel:i,uid:l,enabled:d},console.log("AgoraProvider: Updated props ref:",{appId:t,channel:i,uid:l,enabled:d})},[t,i,l,d]),L.useEffect(()=>{console.log("AgoraProvider: Props changed:",{appId:t,channel:i,uid:l,enabled:d}),typeof window<"u"&&!window.agoraClient&&(window.agoraClient={isVoiceEnabled:!1,isJoined:!1,client:He.current},console.log("AgoraProvider: Initialized window.agoraClient"))},[t,i,l,d]),L.useEffect(()=>{console.log("AgoraProvider: Setting current channel:",i),ee(i)},[i]),L.useEffect(()=>{if(!He.current)return;const nt=dt=>{console.log(`Connection state changed to: ${dt}`),dt==="DISCONNECTED"?(b(!1),console.log("Disconnected from Agora")):dt==="CONNECTED"&&(b(!0),B(null))};return He.current.on("connection-state-change",nt),()=>{He.current.off("connection-state-change",nt)}},[]),L.useEffect(()=>{if(!i||!d){console.log("AgoraProvider: Skipping initialization - channel or enabled is falsy",{channel:i,enabled:d});return}console.log("AgoraProvider: Initial setup for channel",i,"with UID",l);const nt=async(Ut,ln)=>{console.log("AgoraProvider: User published:",Ut.uid,ln);try{await He.current.subscribe(Ut,ln),console.log("AgoraProvider: Subscribed to user:",Ut.uid,"mediaType:",ln),ln==="audio"&&(Ut.audioTrack.play(),console.log("AgoraProvider: Playing audio track for user:",Ut.uid)),F(Ln=>Ln.some(Xt=>Xt.uid===Ut.uid)?Ln:[...Ln,Ut])}catch(Ln){console.error("AgoraProvider: Error subscribing to user:",Ln)}},dt=(Ut,ln)=>{console.log("AgoraProvider: User unpublished:",Ut.uid,ln),ln==="audio"&&Ut.audioTrack&&(Ut.audioTrack.stop(),console.log("AgoraProvider: Stopped audio track for user:",Ut.uid))},Xe=Ut=>{console.log("AgoraProvider: User joined:",Ut.uid),F(ln=>ln.some(Ln=>Ln.uid===Ut.uid)?ln:[...ln,Ut])},It=Ut=>{console.log("AgoraProvider: User left:",Ut.uid),F(ln=>ln.filter(Ln=>Ln.uid!==Ut.uid))};He.current.on("user-published",nt),He.current.on("user-unpublished",dt),He.current.on("user-joined",Xe),He.current.on("user-left",It);const hn=async()=>{if(we.current){console.log("AgoraProvider: Already initializing, skipping duplicate initialization");return}we.current=!0;try{if(v&&Ce.current===i){console.log("AgoraProvider: Already joined to channel",i),oe(!0),E(He.current);return}if(He.current.connectionState==="CONNECTING"||He.current.connectionState==="CONNECTED")if(console.log("AgoraProvider: Client already in connecting/connected state:",He.current.connectionState),Ce.current&&Ce.current!==i){console.log("AgoraProvider: Connected to different channel, leaving first");try{await be()}catch(Ut){console.error("AgoraProvider: Error leaving channel:",Ut)}}else{console.log("AgoraProvider: Client already connected or connecting, setting joined state to true"),b(!0),oe(!0),Ce.current=i,yw=i,E(He.current);return}console.log("AgoraProvider: Joining channel",i,"current joined channel:",Ce.current),await Ne(),console.log("AgoraProvider: Join channel completed")}catch(Ut){console.error("AgoraProvider: Error during initialization:",Ut)}finally{we.current=!1}};return console.log("AgoraProvider: Running initialization"),hn(),()=>{console.log("AgoraProvider: Cleaning up event listeners"),He.current.off("user-published",nt),He.current.off("user-unpublished",dt),He.current.off("user-joined",Xe),He.current.off("user-left",It)}},[i,d,l,E,v]);const ye=async()=>{if(!d||K)return K;console.log("Initializing microphone");try{const nt=await UR.createMicrophoneAudioTrack();return await nt.setMuted(p),te(nt),console.log("Microphone initialized successfully"),nt}catch(nt){return console.error("Error initializing microphone:",nt),B("Failed to initialize microphone. Please check your permissions."),null}};L.useEffect(()=>{(async()=>{if(i)try{const It=await fg(i);It&&It.voiceDisabled?(console.log("AgoraProvider: Voice is disabled for this space"),ue(!0),v&&await be()):ue(!1)}catch(Xe){console.error("AgoraProvider: Error checking if voice is disabled:",Xe)}})();const dt=Xe=>{Xe.detail&&typeof Xe.detail.voiceDisabled=="boolean"&&(console.log("AgoraProvider: Voice setting changed:",Xe.detail.voiceDisabled),ue(Xe.detail.voiceDisabled),Xe.detail.voiceDisabled&&v?be():!Xe.detail.voiceDisabled&&!v&&d&&i&&Ne())};return window.addEventListener("SpaceVoiceSettingChanged",dt),()=>{window.removeEventListener("SpaceVoiceSettingChanged",dt)}},[i,v,d]);const Ne=async()=>{if(!d)return console.log("AgoraProvider: Agora is disabled, not joining channel"),!1;if(he)return console.log("AgoraProvider: Voice is disabled for this space, not joining channel"),B("Voice chat is disabled for this space"),!1;if(!i)return console.error("AgoraProvider: No channel specified"),B("No channel specified"),!1;if(console.log("AgoraProvider: joinChannel called for channel",i,"with UID",l),console.log("AgoraProvider: Current state:",{isJoined:v,isJoining:ge,connectionState:He.current.connectionState,joinedChannel:Ce.current}),v&&Ce.current===i)return console.log("AgoraProvider: Already joined to channel:",i),!0;if(ge)return console.log("AgoraProvider: Already in the process of joining"),!1;if(He.current.connectionState==="CONNECTED")if(Ce.current&&Ce.current!==i){console.log("AgoraProvider: Connected to different channel, leaving first");try{await be()}catch(nt){console.error("AgoraProvider: Error leaving channel:",nt)}}else return console.log("AgoraProvider: Client already connected, setting joined state to true"),b(!0),oe(!0),Ce.current=i,yw=i,E(He.current),!0;if(He.current.connectionState==="CONNECTING")return console.log("AgoraProvider: Client already connecting, waiting for connection"),Z(!0),new Promise(nt=>{const dt=setInterval(()=>{He.current.connectionState==="CONNECTED"&&(clearInterval(dt),b(!0),Z(!1),oe(!0),Ce.current=i,yw=i,E(He.current),nt(!0))},500);setTimeout(()=>{clearInterval(dt),console.log("AgoraProvider: Connection timeout, considering join failed"),Z(!1),nt(!1)},1e4)});try{if(console.log("AgoraProvider: Joining channel:",i,"with UID:",l||"random"),console.log("AgoraProvider: Using appId:",t,"Type:",typeof t,"Length:",t.length),!t||t.trim()===""){const dt="AgoraProvider: App ID is empty or invalid";return console.error(dt),B(dt),Z(!1),!1}Z(!0);const nt=l||Math.floor(Math.random()*1e6);return await He.current.join(t,i,a,nt),console.log("AgoraProvider: Joined channel successfully with UID:",He.current.uid),b(!0),Z(!1),oe(!0),Ce.current=i,yw=i,E(He.current),!0}catch(nt){return console.error("AgoraProvider: Error joining channel:",nt),B(`Error joining channel: ${nt.toString()}`),Z(!1),!1}},be=async()=>{if(v)try{K&&await He.current.unpublish(K),await He.current.leave(),yw=null,Ce.current=null,console.log("Left channel successfully"),b(!1),F([])}catch(nt){console.error("Error leaving channel:",nt),B(nt.message||"Failed to leave channel")}};L.useEffect(()=>()=>{K&&K.close()},[]),L.useEffect(()=>{d&&i&&(!v||Ce.current!==i)&&Ne()},[d,i,v]);const Se=()=>{if(!K)return!1;try{return K.isActive&&!K.muted}catch(nt){return console.error("Error checking microphone status:",nt),!1}};L.useEffect(()=>{const nt=()=>{const Xe=Se();Xe!==w&&(console.log("Syncing microphone state:",{actualStatus:Xe,currentState:w}),A(Xe),window.dispatchEvent(new CustomEvent("VoiceToggled",{detail:{enabled:Xe}})),window.agoraClient&&(window.agoraClient.isVoiceEnabled=Xe,window.agoraClient.microphoneTrack=K))};K&&nt();const dt=setInterval(nt,1e3);return()=>{clearInterval(dt)}},[K,w]);const Ae=async()=>{var nt;if(he)return console.log("AgoraProvider: Voice is disabled for this space, cannot toggle"),Me({title:"Voice Chat Disabled",description:"Voice chat has been disabled for this space by the owner.",status:"info",duration:3e3,isClosable:!0}),!1;try{const dt=w!==void 0?w:K?!K.muted:!1;if(console.log("AgoraProvider: Toggling voice, current state:",{isVoiceEnabled:w,currentState:dt,hasMicTrack:!!K,trackMuted:K==null?void 0:K.muted}),!K&&(console.log("AgoraProvider: No microphone track, initializing..."),!await ye()))return console.error("AgoraProvider: Failed to initialize microphone"),dt;const Xe=!dt;if(console.log("AgoraProvider: New voice state will be:",Xe),dt){if(K)try{console.log("AgoraProvider: Muting microphone track"),await K.setMuted(!0),K.muted||(console.warn("AgoraProvider: Track not muted after setMuted(true), trying again"),await K.setEnabled(!1)),console.log("AgoraProvider: Microphone track muted successfully, muted state:",K.muted)}catch(It){return console.error("Error muting track:",It),dt}}else if(K)try{He.current&&v&&!((nt=He.current.localTracks)!=null&&nt.includes(K))&&(console.log("AgoraProvider: Publishing microphone track"),await He.current.publish(K),console.log("AgoraProvider: Microphone track published successfully")),console.log("AgoraProvider: Unmuting microphone track"),await K.setMuted(!1),K.muted&&(console.warn("AgoraProvider: Track still muted after setMuted(false), trying again"),await K.setEnabled(!0)),console.log("AgoraProvider: Microphone track unmuted successfully, muted state:",K.muted)}catch(It){return console.error("Error unmuting track:",It),dt}return A(Xe),Xe}catch(dt){return console.error("AgoraProvider: Error toggling voice:",dt),w}},Ue=async nt=>{try{te(nt),console.log("Microphone track updated successfully")}catch(dt){throw console.error("Error updating microphone track:",dt),dt}},ze=async()=>{if(!He.current||!i)return console.error("AgoraProvider: Voice chat not connected"),!1;try{if(Q)return console.log("AgoraProvider: Stopping screen share"),se&&(Array.isArray(se)?(await He.current.unpublish(se),se.forEach(nt=>nt.close())):(await He.current.unpublish(se),se.close()),fe(null)),ne(!1),console.log("AgoraProvider: Screen sharing stopped"),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isScreenSharing=!1,window.agoraClient.screenTrack=null,window.dispatchEvent(new CustomEvent("ScreenShareToggled",{detail:{enabled:!1}}))),!1;console.log("AgoraProvider: Starting screen share");try{const nt=await UR.createScreenVideoTrack({encoderConfig:"1080p_1",optimizationMode:"detail"});return console.log("AgoraProvider: Screen track created:",nt),nt.on("track-ended",()=>{console.log("AgoraProvider: Screen sharing ended by browser UI"),He.current.unpublish(nt),nt.close(),fe(null),ne(!1),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isScreenSharing=!1,window.agoraClient.screenTrack=null,window.dispatchEvent(new CustomEvent("ScreenShareToggled",{detail:{enabled:!1}})))}),await He.current.publish(nt),fe(nt),ne(!0),console.log("AgoraProvider: Screen sharing started"),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isScreenSharing=!0,window.agoraClient.screenTrack=nt,window.dispatchEvent(new CustomEvent("ScreenShareToggled",{detail:{enabled:!0}}))),!0}catch(nt){return console.error("AgoraProvider: Error creating screen track:",nt),ne(!1),fe(null),!1}}catch(nt){return console.error("AgoraProvider: Error toggling screen share:",nt),ne(!1),fe(null),!1}};L.useEffect(()=>{if(console.log("AgoraProvider: Initializing window.agoraClient"),typeof window<"u"){window.agoraClient={isVoiceEnabled:!1,isJoined:!1,client:He.current,isScreenSharing:!1,screenTrack:null};const nt=Xe=>{console.log("AgoraProvider: Received ToggleScreenShare event"),ze().then(It=>{Xe.detail&&Xe.detail.callback&&Xe.detail.callback(!0,It)}).catch(It=>{console.error("AgoraProvider: Error handling ToggleScreenShare event:",It),Xe.detail&&Xe.detail.callback&&Xe.detail.callback(!1,Q)})},dt=Xe=>{console.log("AgoraProvider: Received JoinVoiceChat event"),Ne().then(It=>{Xe.detail&&Xe.detail.callback&&Xe.detail.callback(It)}).catch(It=>{console.error("AgoraProvider: Error handling JoinVoiceChat event:",It),Xe.detail&&Xe.detail.callback&&Xe.detail.callback(!1)})};return window.addEventListener("ToggleScreenShare",nt),window.addEventListener("JoinVoiceChat",dt),()=>{window.removeEventListener("ToggleScreenShare",nt),window.removeEventListener("JoinVoiceChat",dt),typeof window<"u"&&window.agoraClient&&(console.log("AgoraProvider: Cleaning up window.agoraClient"),window.agoraClient=null)}}return()=>{typeof window<"u"&&window.agoraClient&&(console.log("AgoraProvider: Cleaning up window.agoraClient"),window.agoraClient=null)}},[]),L.useEffect(()=>{console.log("AgoraProvider: Voice enabled state changed:",w),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isVoiceEnabled=w,window.agoraClient.microphoneTrack=K,window.agoraClient.client=He.current,window.dispatchEvent(new CustomEvent("VoiceToggled",{detail:{enabled:w}})),console.log("AgoraProvider: Updated window.agoraClient and dispatched event:",{isVoiceEnabled:w}))},[w,K]);const et={client:He.current,isJoined:v,isVoiceEnabled:w,users:N,error:j,channel:H,appId:t,toggleVoice:Ae,leaveChannel:be,joinChannel:Ne,microphoneTrack:K,isReady:le,createMicrophoneTrack:Ue,isScreenSharing:Q,screenTrack:se,toggleScreenShare:ze,voiceDisabled:he};return C.jsx(qoe.Provider,{value:et,children:n})},Xoe=()=>{const n=L.useContext(qoe);if(!n)throw new Error("useAgoraContext must be used within an AgoraProvider");return n};Yoe.propTypes={children:gr.node.isRequired,appId:gr.string.isRequired,channel:gr.string.isRequired,token:gr.string,uid:gr.oneOfType([gr.string,gr.number])};const j6e=()=>{var we,Ce;const{client:n,isVoiceEnabled:t,isJoined:i,users:a,error:l,microphoneTrack:d,isReady:p,channel:E,appId:v,toggleVoice:b,joinChannel:w,leaveChannel:A,createMicrophoneTrack:N,isScreenSharing:F,screenTrack:j,toggleScreenShare:B,voiceDisabled:H}=Xoe(),[ee,K]=L.useState(t!==void 0?t:((we=window.agoraClient)==null?void 0:we.isVoiceEnabled)||!1),[te,le]=L.useState(F!==void 0?F:((Ce=window.agoraClient)==null?void 0:Ce.isScreenSharing)||!1),[oe,ge]=L.useState(H!==void 0?H:!1),[Z,Q]=L.useState(!0);L.useEffect(()=>{var ye;t!==void 0?K(t):((ye=window.agoraClient)==null?void 0:ye.isVoiceEnabled)!==void 0?K(window.agoraClient.isVoiceEnabled):d&&K(!d.muted)},[t,d]),L.useEffect(()=>{var ye;F!==void 0?le(F):((ye=window.agoraClient)==null?void 0:ye.isScreenSharing)!==void 0&&le(window.agoraClient.isScreenSharing)},[F]),L.useEffect(()=>{H!==void 0&&ge(H)},[H]);const ne=L.useRef({isVoiceEnabled:ee,isScreenSharing:te,isJoined:i,users:a,error:l,isReady:p,channel:E,appId:v,voiceDisabled:oe});L.useEffect(()=>{ne.current={isVoiceEnabled:ee,isScreenSharing:te,isJoined:i,users:a,error:l,isReady:p,channel:E,appId:v,voiceDisabled:oe}},[ee,te,i,a,l,p,E,v,oe]),L.useEffect(()=>{const ye=setTimeout(()=>{Q(!1)},5e3);return()=>clearTimeout(ye)},[]),L.useEffect(()=>{p&&Q(!1)},[p]),L.useEffect(()=>{console.log("useVoiceChat context:",{contextIsVoiceEnabled:t,localVoiceEnabled:ee,contextIsScreenSharing:F,localScreenSharing:te,isJoined:i,users:a.length,error:l,isReady:p,channel:E,appId:v,hasMicrophoneTrack:!!d,trackMuted:d==null?void 0:d.muted,hasScreenTrack:!!j})},[t,ee,F,te,i,a,l,p,E,v,d,j]);const se=async()=>{try{console.log("useVoiceChat: Toggling voice from:",ee);const ye=await b();if(console.log("useVoiceChat: Toggle result:",ye),ye!==void 0)K(ye);else{const Ne=!ee;K(Ne),window.agoraClient&&(window.agoraClient.isVoiceEnabled=Ne)}return ye!==void 0?ye:!ee}catch(ye){return console.error("useVoiceChat: Error toggling voice:",ye),ee}},fe=async()=>{try{console.log("useVoiceChat: Toggling screen share from:",te);const ye=await B();if(console.log("useVoiceChat: Screen share toggle result:",ye),ye!==void 0)le(ye);else{const Ne=!te;le(Ne),window.agoraClient&&(window.agoraClient.isScreenSharing=Ne)}return ye!==void 0?ye:!te}catch(ye){return console.error("useVoiceChat: Error toggling screen share:",ye),te}},he=async()=>{ee&&d&&await se()},ue=async()=>{!ee&&d&&await se()},Me=ye=>a.some(Ne=>{var be;return Ne.uid===ye&&((be=Ne.audioTrack)==null?void 0:be.isPlaying)}),He=L.useCallback(()=>{if(!d||!ee)return 0;try{return d.getVolumeLevel()}catch(ye){return console.error("Error getting volume level:",ye),0}},[d,ee]);return{isVoiceEnabled:ee,isScreenSharing:te,isJoined:i,users:a,error:l,toggleVoice:se,toggleScreenShare:fe,mute:he,unmute:ue,isUserSpeaking:Me,getVolumeLevel:He,microphoneTrack:d,screenTrack:j,isLoading:Z,channel:E,appId:v,joinChannel:w,leaveChannel:A,client:n,setMicrophoneDevice:async ye=>{try{if(!ye){console.error("No device ID provided");return}if(!n||!i){console.error("Client not initialized or not joined to a channel");return}d&&(ee&&await n.unpublish(d),await d.close());const Ne=await UR.createMicrophoneAudioTrack({microphoneId:ye,encoderConfig:"music_standard"});N&&await N(Ne),ee&&await n.publish(Ne),console.log("Microphone device changed successfully")}catch(Ne){throw console.error("Error changing microphone device:",Ne),Ne}},voiceDisabled:oe}},B6e=({size:n="md",tooltipPlacement:t="top",defaultMuted:i=!0,joinOnClick:a=!0,className:l="voice-button"})=>{const{isVoiceEnabled:d,toggleVoice:p,isJoined:E,joinChannel:v,channel:b,client:w,voiceDisabled:A}=j6e(),[N,F]=L.useState(!1),[j,B]=L.useState(!1);L.useEffect(()=>{const K=()=>{Te.log("VoiceButton: Player instantiated, showing button"),B(!0)};return window.addEventListener("PlayerInstantiated",K),window.isPlayerInstantiated&&(Te.log("VoiceButton: Player was already instantiated"),B(!0)),()=>{window.removeEventListener("PlayerInstantiated",K)}},[]),L.useEffect(()=>{console.log("VoiceButton: State:",{isVoiceEnabled:d,isJoined:E,channel:b,hasClient:!!w,clientState:w==null?void 0:w.connectionState,windowAgoraClient:window.agoraClient,isPlayerReady:j,voiceDisabled:A})},[d,E,b,w,j,A]);const H=async()=>{if(!(N||A)){F(!0),console.log("VoiceButton: Handling click, current state:",{isVoiceEnabled:d,isJoined:E});try{if(!E&&a)try{console.log("VoiceButton: Not joined, attempting to join channel"),await v(),console.log("VoiceButton: Joined channel successfully")}catch(te){te.message&&te.message.includes("already in connecting/connected state")?console.log("VoiceButton: Already connected to channel"):console.error("VoiceButton: Error joining channel:",te)}console.log("VoiceButton: Toggling voice state from:",d);const K=await p();console.log("VoiceButton: Voice toggled, new state:",K)}catch(K){console.error("VoiceButton: Error toggling voice:",K)}finally{F(!1)}}},ee=()=>A?"Voice chat is disabled for this space":j?N?"Processing...":E?d?"Turn microphone off":"Turn microphone on":"Connecting to voice chat...":"Waiting for player to be ready...";return!j||A?null:C.jsx(cg,{label:ee(),placement:t,hasArrow:!0,children:C.jsxs(Rt,{position:"relative",cursor:"pointer",onClick:H,children:[C.jsx(Ou,{size:n,borderRadius:"full",bg:d?"green.500":"red.500",icon:d?C.jsx(KV,{color:"white"}):C.jsx($V,{color:"white"}),borderWidth:"1px",borderColor:"whiteAlpha.300",className:l,"data-testid":"voice-button"}),N&&C.jsx(Rt,{position:"absolute",top:"0",left:"0",right:"0",bottom:"0",display:"flex",alignItems:"center",justifyContent:"center",bg:"rgba(0, 0, 0, 0.6)",borderRadius:"full",children:C.jsx(Lp,{size:"sm",color:"white"})})]})})},W6e=ni.createContext({user:null}),z6e=({userNickname:n})=>{const{client:t,channel:i,screenTrack:a,isScreenSharing:l,toggleScreenShare:d}=Xoe(),[p,E]=L.useState([]),[v,b]=L.useState(!1),[w,A]=L.useState(!0);L.useRef({});const N=L.useRef(null);L.useRef(null);const{user:F}=L.useContext(W6e)||{user:null},[j,B]=L.useState({}),H=L.useRef(a),[ee,K]=L.useState(null),{isOpen:te,onOpen:le,onClose:oe}=Cp(),[ge,Z]=L.useState(!1),Q=L.useRef(null),ne=L.useRef(null);L.useEffect(()=>{H.current=a},[a]),L.useEffect(()=>{if(!t||!i){b(!1);return}const Me=setTimeout(()=>{A(!1)},5e3);console.log("Setting up screen share display with existing client:",t),console.log("Current channel:",i);const He=t.connectionState;if(console.log("Current connection state:",He),He==="CONNECTED")b(!0),A(!1);else{b(!1);const rt=we=>{console.log("Connection state changed:",we),we==="CONNECTED"?(b(!0),A(!1)):b(!1)};return t.on("connection-state-change",rt),()=>{t.off("connection-state-change",rt),clearTimeout(Me)}}return()=>{clearTimeout(Me)}},[t,i]),L.useEffect(()=>{const Me=async()=>{const He={...j};let rt=!1;for(const we of p){if(j[we.uid])continue;let Ce=null,ye=we.uid;if(typeof ye=="string"&&(ye.includes("-")?(Ce=ye.split("-")[0],ye=ye.split("-")[1]):ye.includes("_")&&(Ce=ye.split("_")[0],ye=ye.split("_")[1])),ye)try{console.log("Trying to fetch nickname for user ID:",ye);const Ne=await rf(ye);Ne&&Ne.Nickname?(console.log("Found nickname in Firebase for user ID:",ye,"Nickname:",Ne.Nickname),He[we.uid]=Ne.Nickname,rt=!0):Ce?(console.log("Using extracted name for user ID:",ye,"Name:",Ce),He[we.uid]=Ce,rt=!0):(He[we.uid]="User",rt=!0)}catch(Ne){console.error("Error fetching user profile:",Ne),Ce?(He[we.uid]=Ce,rt=!0):(He[we.uid]="User",rt=!0)}else Ce?(He[we.uid]=Ce,rt=!0):(He[we.uid]="User",rt=!0)}rt&&B(He)};p.length>0&&Me()},[p,j]),L.useEffect(()=>{if(!t||!i||!v)return;console.log("Setting up screen share event handlers");const Me=async(we,Ce)=>{if(console.log("User published:",we.uid,Ce,we),Ce==="video"){console.log("Remote video track detected:",we.uid);try{await t.subscribe(we,Ce),console.log("Subscribed to remote video track:",we.uid),E(ye=>ye.some(Ne=>Ne.uid===we.uid)?ye:[...ye,we])}catch(ye){console.error("Error subscribing to remote video track:",ye)}}},He=(we,Ce)=>{if(console.log("User unpublished:",we.uid,Ce),Ce==="video"){if(console.log("Remote video track unpublished:",we.uid),we.videoTrack)try{we.videoTrack.stop()}catch(ye){console.error("Error stopping video track:",ye)}if(E(ye=>ye.filter(Ne=>Ne.uid!==we.uid)),l&&H.current&&N.current)try{console.log("Ensuring local screen track is still playing after remote user unpublished"),H.current.play(N.current)}catch(ye){console.error("Error replaying local screen track:",ye)}}},rt=we=>{console.log("User left:",we.uid);const Ce=p.find(ye=>ye.uid===we.uid);if(Ce&&Ce.videoTrack)try{Ce.videoTrack.stop()}catch(ye){console.error("Error stopping video track:",ye)}if(E(ye=>ye.filter(Ne=>Ne.uid!==we.uid)),l&&H.current&&N.current)try{console.log("Ensuring local screen track is still playing after remote user left"),H.current.play(N.current)}catch(ye){console.error("Error replaying local screen track:",ye)}};return t.on("user-published",Me),t.on("user-unpublished",He),t.on("user-left",rt),()=>{t.off("user-published",Me),t.off("user-unpublished",He),t.off("user-left",rt)}},[t,i,v,p,l]),L.useEffect(()=>{if(console.log("Remote screens changed:",p.length,p),p.forEach(Me=>{if(Me.videoTrack)try{console.log("Playing video track for:",Me.uid),Me.videoTrack.play(`video-container-${Me.uid}`)}catch(He){console.error("Error playing video track:",He)}}),l&&H.current&&N.current)try{console.log("Ensuring local screen track is still playing after remote screens changed"),H.current.play(N.current)}catch(Me){console.error("Error replaying local screen track:",Me)}},[p,l]),L.useEffect(()=>{if(console.log("Local screen sharing state changed:",l,a),l&&a&&N.current)try{console.log("Playing local screen track"),a.play(N.current)}catch(Me){console.error("Error playing local screen track:",Me)}},[l,a]),L.useEffect(()=>()=>{if(p.forEach(Me=>{if(Me.videoTrack)try{Me.videoTrack.stop()}catch(He){console.error("Error stopping video track on unmount:",He)}}),a)try{a.stop()}catch(Me){console.error("Error stopping local screen track on unmount:",Me)}},[p,a]);const se=()=>{console.log("Stopping local screen share"),d()},fe=Me=>(console.log("Getting display name for UID:",Me,"type:",typeof Me),l&&F&&(Me===F.uid||Me===(t==null?void 0:t.uid))?n||"You":j[Me]?j[Me]:typeof Me=="string"?Me.includes("-")?Me.split("-")[0]:Me.includes("_")?Me.split("_")[0]:Me:"User"),he=Me=>{console.log("Opening modal for remote screen",Me),K(Me),le()},ue=()=>{console.log("Opening modal for local screen"),K({isLocal:!0}),le()};return L.useEffect(()=>{te&&ee?(console.log("Modal opened, activeScreen:",ee),setTimeout(()=>{if(ee.isLocal&&H.current)try{console.log("Playing local screen in modal"),H.current.play("modal-screen-container"),Z(!0)}catch(Me){console.error("Error playing local screen in modal:",Me)}else if(ee.videoTrack)try{console.log("Playing remote screen in modal"),ee.videoTrack.play("modal-screen-container"),Z(!0)}catch(Me){console.error("Error playing remote screen in modal:",Me)}},500)):te||(Z(!1),K(null),setTimeout(()=>{if(l&&H.current)try{H.current.play("local-screen-container")}catch(Me){console.error("Error playing local screen in small container:",Me)}p.forEach(Me=>{if(Me.videoTrack)try{Me.videoTrack.play(`video-container-${Me.uid}`)}catch(He){console.error(`Error playing remote screen ${Me.uid} in small container:`,He)}})},500))},[te,ee,l,p]),!v||w&&p.length===0&&!l||p.length===0&&!l?null:C.jsxs(C.Fragment,{children:[!te&&C.jsxs(Rt,{position:"fixed",top:"20px",left:"20px",zIndex:1e4,overflow:"visible",ref:Q,children:[l&&a&&C.jsxs(Rt,{position:"relative",mb:4,borderRadius:"md",overflow:"hidden",boxShadow:"xl",bg:"black",width:"200px",height:"120px",cursor:"pointer",transition:"all 0.2s",_hover:{filter:"brightness(0.8)",transform:"scale(1.05)"},onClick:ue,children:[C.jsx(Rt,{id:"local-screen-container",width:"100%",height:"100%",position:"relative"}),C.jsx(Rt,{position:"absolute",bottom:2,left:2,color:"white",fontSize:"xs",bg:"rgba(0,0,0,0.5)",px:2,py:1,borderRadius:"md",zIndex:5,children:n?`${n}'s Screen`:"Your Screen"})]}),p.map(Me=>{const He=j[Me.uid]||fe(Me.uid);return C.jsxs(Rt,{position:"relative",mb:4,borderRadius:"md",overflow:"hidden",boxShadow:"xl",bg:"black",width:"200px",height:"120px",cursor:"pointer",transition:"all 0.2s",_hover:{filter:"brightness(0.8)",transform:"scale(1.05)"},onClick:()=>he(Me),children:[C.jsx(Rt,{id:`video-container-${Me.uid}`,width:"100%",height:"100%",position:"relative"}),C.jsx(Rt,{position:"absolute",bottom:2,left:2,color:"white",fontSize:"xs",bg:"rgba(0,0,0,0.5)",px:2,py:1,borderRadius:"md",zIndex:5,children:`${He}'s Screen`})]},Me.uid)})]}),te&&C.jsx(Rt,{position:"fixed",top:"0",left:"0",width:"100vw",height:"100vh",bg:"rgba(0,0,0,0.8)",zIndex:1e4,display:"flex",justifyContent:"center",alignItems:"center",onClick:oe,children:C.jsxs(Rt,{width:"80vw",height:"80vh",bg:"black",borderRadius:"md",overflow:"hidden",position:"relative",onClick:Me=>Me.stopPropagation(),children:[!ge&&C.jsxs(Rt,{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:"white",textAlign:"center",children:[C.jsx(Lp,{size:"xl"}),C.jsx(ht,{mt:4,children:"Loading screen share..."})]}),C.jsx(Rt,{id:"modal-screen-container",width:"100%",height:"100%",position:"relative",ref:ne}),C.jsx(Rt,{position:"absolute",top:2,right:2,color:"white",bg:"rgba(0,0,0,0.5)",borderRadius:"full",width:"30px",height:"30px",display:"flex",justifyContent:"center",alignItems:"center",cursor:"pointer",onClick:oe,children:""}),C.jsx(Rt,{position:"absolute",bottom:4,left:4,color:"white",fontSize:"sm",bg:"rgba(0,0,0,0.5)",px:3,py:2,borderRadius:"md",children:ee!=null&&ee.isLocal?n?`${n}'s Screen`:"Your Screen":`${j[ee==null?void 0:ee.uid]||fe(ee==null?void 0:ee.uid)}'s Screen`}),(ee==null?void 0:ee.isLocal)&&C.jsx(Rt,{position:"absolute",bottom:4,right:4,children:C.jsx(bi,{colorScheme:"red",size:"sm",onClick:se,children:"Stop Sharing"})})]})})]})},G6e=({onClose:n})=>{const t=Dd(),[i,a]=L.useState(!1),[l,d]=L.useState(!1);L.useEffect(()=>{const v=()=>{window.agoraClient&&d(!!window.agoraClient.isScreenSharing)};v();const b=setInterval(v,1e3),w=()=>{v()};return window.addEventListener("ScreenShareToggled",w),()=>{clearInterval(b),window.removeEventListener("ScreenShareToggled",w)}},[]);const p=async v=>{if(v.preventDefault(),v.stopPropagation(),n&&n(),!window.agoraClient||!window.agoraClient.client){t({title:"Screen sharing not available",description:"Voice chat must be connected to use screen sharing",status:"warning",duration:3e3,isClosable:!0});return}try{if(a(!0),window.agoraClient.isJoined)E();else{console.log("ScreenShareMenuOption: Not joined to voice chat, joining automatically");const b=new CustomEvent("JoinVoiceChat",{detail:{callback:w=>{if(!w){console.error("ScreenShareMenuOption: Failed to join voice chat"),t({title:"Connection failed",description:"Could not connect to voice chat",status:"error",duration:3e3,isClosable:!0}),a(!1);return}E()}}});window.dispatchEvent(b)}}catch(b){console.error("Error in screen share handler:",b),a(!1),t({title:"Screen sharing error",description:b.message||"Failed to toggle screen sharing",status:"error",duration:5e3,isClosable:!0})}},E=async()=>{try{const v=new CustomEvent("ToggleScreenShare",{detail:{callback:(b,w)=>{a(!1),b?(d(w),t(w?{title:"Screen sharing started",status:"success",duration:3e3,isClosable:!0}:{title:"Screen sharing stopped",status:"info",duration:3e3,isClosable:!0})):t({title:"Screen sharing error",description:"Failed to toggle screen sharing",status:"error",duration:5e3,isClosable:!0})}}});window.dispatchEvent(v)}catch(v){console.error("Error toggling screen share:",v),a(!1),t({title:"Screen sharing error",description:v.message||"Failed to toggle screen sharing",status:"error",duration:5e3,isClosable:!0})}};return C.jsx(ht,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:p,color:l?"red.300":"white",children:i?"Connecting...":l?"Stop Screen Sharing":"Share Screen"})};function H6e({open:n,onClose:t}){const[i,a]=L.useState(0);return C.jsxs(xa,{isOpen:n,onClose:t,size:"md",isCentered:!0,children:[C.jsx(Va,{backdropFilter:"blur(4px)"}),C.jsxs(Ma,{bg:"rgba(23, 25, 35, 0.95)",color:"white",borderRadius:"md",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.5)",maxW:"600px",h:"350px",overflow:"hidden",children:[C.jsx(Ll,{borderBottom:"1px solid",borderColor:"whiteAlpha.200",py:2,fontSize:"md",fontWeight:"600",children:"Controls"}),C.jsx(cc,{size:"sm",color:"whiteAlpha.700",_hover:{color:"white",bg:"whiteAlpha.100"}}),C.jsx(Ua,{p:0,display:"flex",children:C.jsxs(ZR,{orientation:"vertical",variant:"unstyled",index:i,onChange:a,display:"flex",flexGrow:1,children:[C.jsxs(eC,{bg:"rgba(0, 0, 0, 0.2)",w:"80px",py:4,borderRight:"1px solid",borderColor:"whiteAlpha.200",children:[C.jsxs(Kc,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[C.jsx(Wn,{as:y6e,mb:1}),C.jsx(ht,{fontSize:"xs",children:"Movement"})]}),C.jsxs(Kc,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[C.jsx(Wn,{as:v6e,mb:1}),C.jsx(ht,{fontSize:"xs",children:"Camera"})]}),C.jsxs(Kc,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[C.jsx(Wn,{as:_6e,mb:1}),C.jsx(ht,{fontSize:"xs",children:"Actions"})]}),C.jsxs(Kc,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[C.jsx(Wn,{as:E6e,mb:1}),C.jsx(ht,{fontSize:"xs",children:"Tips"})]})]}),C.jsxs(LN,{flexGrow:1,display:"flex",flexDirection:"column",children:[C.jsxs(wu,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[C.jsx(ht,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Movement Controls"}),C.jsxs(Ai,{wrap:"wrap",gap:3,children:[C.jsx(Rl,{keyLabel:"W",description:"Move Forward"}),C.jsx(Rl,{keyLabel:"A",description:"Move Left"}),C.jsx(Rl,{keyLabel:"S",description:"Move Backward"}),C.jsx(Rl,{keyLabel:"D",description:"Move Right"}),C.jsx(Rl,{keyLabel:"Shift",description:"Run"}),C.jsx(Rl,{keyLabel:"Space",description:"Jump / Double Jump"})]})]}),C.jsxs(wu,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[C.jsx(ht,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Camera Controls"}),C.jsxs(Ai,{wrap:"wrap",gap:3,children:[C.jsx(Rl,{keyLabel:"Mouse",description:"Look Around"}),C.jsx(Rl,{keyLabel:"Click + Drag",description:"Rotate Camera"}),C.jsx(Rl,{keyLabel:"Scroll",description:"Zoom In/Out"})]})]}),C.jsxs(wu,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[C.jsx(ht,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Action Controls"}),C.jsxs(Ai,{wrap:"wrap",gap:3,children:[C.jsx(Rl,{keyLabel:"E",description:"Interact"}),C.jsx(Rl,{keyLabel:"F",description:"Emote Menu"}),C.jsx(Rl,{keyLabel:"T",description:"Chat"}),C.jsx(Rl,{keyLabel:"M",description:"Mute Mic"})]})]}),C.jsxs(wu,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[C.jsx(ht,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Tips & Tricks"}),C.jsxs(ri,{align:"stretch",spacing:2,children:[C.jsx(ht,{fontSize:"xs",children:" Double-tap Shift to auto-run"}),C.jsx(ht,{fontSize:"xs",children:" Press ESC to access settings"}),C.jsx(ht,{fontSize:"xs",children:" Click on players to view their profile"}),C.jsx(ht,{fontSize:"xs",children:" Use the minimap to navigate"})]})]})]})]})})]})]})}const Rl=({keyLabel:n,description:t})=>C.jsx(Rt,{bg:"whiteAlpha.100",borderRadius:"md",p:2,minW:"120px",maxW:"180px",children:C.jsxs(Ni,{spacing:2,children:[C.jsx(Rt,{bg:"whiteAlpha.200",borderRadius:"md",px:2,py:1,fontSize:"xs",fontWeight:"bold",minW:"30px",textAlign:"center",children:n}),C.jsx(ht,{fontSize:"xs",children:t})]})}),$6e=()=>{const[n,t]=L.useState([]),[i,a]=L.useState(""),[l,d]=L.useState(0),[p,E]=L.useState(100),[v,b]=L.useState(100),[w,A]=L.useState(!0),[N,F]=L.useState(!0),[j,B]=L.useState(!1);L.useEffect(()=>{(async()=>{try{await navigator.mediaDevices.getUserMedia({audio:!0});const oe=await UR.getMicrophones();t(oe),oe.length>0&&a(oe[0].deviceId)}catch(oe){console.error("Error getting audio devices:",oe)}})()},[]),L.useEffect(()=>{const le=setInterval(()=>{d(j?Math.random()*50:0)},100);return()=>clearInterval(le)},[j]);const H=le=>{const oe=le.target.value;a(oe),console.log("Microphone changed to:",oe)},ee=le=>{E(le),console.log("Microphone volume set to:",le)},K=le=>{b(le),console.log("Speaker volume set to:",le)},te=()=>{B(!j)};return C.jsxs(ri,{spacing:6,align:"stretch",children:[C.jsxs(Si,{children:[C.jsxs(ta,{children:["Microphone",C.jsx(pp,{ml:2,colorScheme:j?"green":"red",children:j?"Enabled":"Muted"})]}),C.jsxs(wne,{value:i,onChange:H,bg:"gray.700",borderColor:"gray.600",_hover:{borderColor:"gray.500"},children:[n.map(le=>C.jsx("option",{value:le.deviceId,children:le.label||`Microphone ${le.deviceId.slice(0,5)}...`},le.deviceId)),n.length===0&&C.jsx("option",{value:"",children:"No microphones found"})]})]}),C.jsxs(Rt,{children:[C.jsx(ht,{mb:2,children:"Microphone Level"}),C.jsx(h0,{value:l,colorScheme:"green",size:"sm",borderRadius:"md",hasStripe:l>20,isAnimated:l>20})]}),C.jsxs(Si,{children:[C.jsxs(ta,{children:["Microphone Volume: ",p,"%"]}),C.jsxs(aV,{value:p,onChange:ee,min:0,max:100,step:1,colorScheme:"blue",children:[C.jsx(lV,{bg:"gray.700",children:C.jsx(uV,{})}),C.jsx(cV,{boxSize:6})]})]}),C.jsxs(Si,{children:[C.jsxs(ta,{children:["Speaker Volume: ",v,"%"]}),C.jsxs(aV,{value:v,onChange:K,min:0,max:100,step:1,colorScheme:"blue",children:[C.jsx(lV,{bg:"gray.700",children:C.jsx(uV,{})}),C.jsx(cV,{boxSize:6})]})]}),C.jsxs(Si,{display:"flex",alignItems:"center",children:[C.jsx(ta,{mb:"0",children:"Microphone Enabled"}),C.jsx(ag,{isChecked:j,onChange:te,colorScheme:"green",size:"lg"})]}),C.jsxs(Si,{display:"flex",alignItems:"center",children:[C.jsx(ta,{mb:"0",children:"Echo Cancellation"}),C.jsx(ag,{isChecked:w,onChange:()=>A(!w),colorScheme:"green",size:"lg"})]}),C.jsxs(Si,{display:"flex",alignItems:"center",children:[C.jsx(ta,{mb:"0",children:"Noise Suppression"}),C.jsx(ag,{isChecked:N,onChange:()=>F(!N),colorScheme:"green",size:"lg"})]}),C.jsxs(o0,{status:"info",borderRadius:"md",children:[C.jsx(s0,{}),"Note: These settings will be applied when you join a voice chat."]})]})};function K6e({open:n,onClose:t,containerRef:i}){return C.jsx(Ml,{containerRef:i,children:C.jsxs(xa,{isOpen:n,onClose:t,size:"lg",isCentered:!0,children:[C.jsx(Va,{}),C.jsxs(Ma,{bg:"gray.900",color:"white",borderRadius:"lg",children:[C.jsx(Ll,{children:"Settings"}),C.jsx(cc,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",_hover:{bg:"gray.600"},_focus:{boxShadow:"none"}}),C.jsx(Ua,{children:C.jsxs(ZR,{variant:"enclosed",children:[C.jsxs(eC,{mb:4,children:[C.jsx(Kc,{_selected:{color:"white",borderBottom:"2px solid white"},children:"Audio"}),C.jsx(Kc,{_selected:{color:"white",borderBottom:"2px solid white"},children:"Graphics"})]}),C.jsxs(LN,{children:[C.jsx(wu,{children:C.jsx(Rt,{p:4,bg:"gray.800",borderRadius:"md",children:C.jsx($6e,{})})}),C.jsx(wu,{children:C.jsx(Rt,{p:4,bg:"gray.800",borderRadius:"md",children:"Graphics settings content goes here."})})]})]})})]})]})})}function q6e(n){return Vr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"8",r:"7"}},{tag:"polyline",attr:{points:"8.21 13.89 7 23 12 20 17 23 15.79 13.88"}}]})(n)}function Y6e(n){return Vr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"}},{tag:"circle",attr:{cx:"12",cy:"13",r:"4"}}]})(n)}function JS(n){return Vr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"rect",attr:{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}},{tag:"circle",attr:{cx:"8.5",cy:"8.5",r:"1.5"}},{tag:"polyline",attr:{points:"21 15 16 10 5 21"}}]})(n)}function Joe(n){return Vr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"10"}},{tag:"line",attr:{x1:"12",y1:"16",x2:"12",y2:"12"}},{tag:"line",attr:{x1:"12",y1:"8",x2:"12.01",y2:"8"}}]})(n)}function X6e(n){return Vr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"}},{tag:"path",attr:{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"}}]})(n)}function J6e(n){return Vr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"3"}},{tag:"path",attr:{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"}}]})(n)}function Q6e(n){return Vr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"}}]})(n)}function oR(n){return Vr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"3 6 5 6 21 6"}},{tag:"path",attr:{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}},{tag:"line",attr:{x1:"10",y1:"11",x2:"10",y2:"17"}},{tag:"line",attr:{x1:"14",y1:"11",x2:"14",y2:"17"}}]})(n)}function YV(n){return Vr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}},{tag:"polyline",attr:{points:"17 8 12 3 7 8"}},{tag:"line",attr:{x1:"12",y1:"3",x2:"12",y2:"15"}}]})(n)}function zJ(n){return Vr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}},{tag:"circle",attr:{cx:"9",cy:"7",r:"4"}},{tag:"path",attr:{d:"M23 21v-2a4 4 0 0 0-3-3.87"}},{tag:"path",attr:{d:"M16 3.13a4 4 0 0 1 0 7.75"}}]})(n)}function AO(n){return Vr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"23 7 16 12 23 17 23 7"}},{tag:"rect",attr:{x:"1",y:"5",width:"15",height:"14",rx:"2",ry:"2"}}]})(n)}function Z6e(n){return Vr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5"}},{tag:"path",attr:{d:"M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"}}]})(n)}const eWe=({isOpen:n,onClose:t})=>{const{spaceID:i}=el(),[a,l]=L.useState(0),[d,p]=L.useState(""),[E,v]=L.useState(""),[b,w]=L.useState(!1),[A,N]=L.useState(null),[F,j]=L.useState(null),[B,H]=L.useState(!1),[ee,K]=L.useState(0),[te,le]=L.useState(null),oe=L.useRef(null),[ge,Z]=L.useState(null),[Q,ne]=L.useState(null),[se,fe]=L.useState(!1),[he,ue]=L.useState(0),[Me,He]=L.useState(null),rt=L.useRef(null),[we,Ce]=L.useState([]),[ye,Ne]=L.useState([]),[be,Se]=L.useState(!1),[Ae,Ue]=L.useState(!1),[ze,et]=L.useState(!0),[nt,dt]=L.useState(!1),Xe=Dd();L.useEffect(()=>{n&&i&&It()},[n,i]);const It=async()=>{try{const Ge=await fg(i);Ge.logoUrl&&le(Ge.logoUrl),Ge.backgroundUrl&&He(Ge.backgroundUrl),Ge.voiceDisabled!==void 0&&Ue(Ge.voiceDisabled),Ge.accessibleToAllUsers!==void 0&&et(Ge.accessibleToAllUsers),p(Ge.name||""),v(Ge.description||""),hn(Ge)}catch(Ge){Te.error("Error fetching space data:",Ge),Xe({title:"Error",description:"Failed to load space data",status:"error",duration:3e3,isClosable:!0})}},hn=async Ge=>{if(i&&n){Se(!0);try{const Ot=UV(),Jt=`space_${i}_owners`,fn=FV(xR(Ot,"users"),cJ("groups","array-contains",Jt)),an=await Jk(fn),ir=[];for(const fi of an.docs){const Ti=fi.data(),ur=await rf(fi.id);ir.push({uid:fi.id,email:Ti.email,displayName:Ti.displayName||ur.Nickname||"Unknown User",photoURL:Ti.photoURL||ur.photoURL,firstName:ur.firstName,lastName:ur.lastName})}Ce(ir);const ia=`space_${i}_hosts`,Vt=FV(xR(Ot,"users"),cJ("groups","array-contains",ia)),on=await Jk(Vt),Pi=[];for(const fi of on.docs){const Ti=fi.data(),ur=await rf(fi.id);Pi.push({uid:fi.id,email:Ti.email,displayName:Ti.displayName||ur.Nickname||"Unknown User",photoURL:Ti.photoURL||ur.photoURL,firstName:ur.firstName,lastName:ur.lastName})}Ne(Pi)}catch(Ot){Te.error("Error fetching space users:",Ot),Xe({title:"Error",description:"Failed to load space users",status:"error",duration:3e3,isClosable:!0})}finally{Se(!1)}}};L.useEffect(()=>{i&&n&&a===3&&hn()},[i,n,a]);const Ut=Ge=>{const Ot=Ge.target.files[0];if(Ot){if(!Ot.type.startsWith("image/")){Xe({title:"Invalid file type",description:"Please select an image file",status:"error",duration:5e3,isClosable:!0});return}N(Ot);const Jt=new FileReader;Jt.onloadend=()=>{j(Jt.result)},Jt.readAsDataURL(Ot)}},ln=Ge=>{const Ot=Ge.target.files[0];if(Ot){if(!Ot.type.startsWith("image/")){Xe({title:"Invalid file type",description:"Please select an image file",status:"error",duration:5e3,isClosable:!0});return}Z(Ot);const Jt=new FileReader;Jt.onloadend=()=>{ne(Jt.result)},Jt.readAsDataURL(Ot)}},Ln=async()=>{if(!A){Xe({title:"No file selected",description:"Please select a file to upload",status:"warning",duration:5e3,isClosable:!0});return}try{H(!0);const Ge=setInterval(()=>{K(Jt=>{const fn=Jt+10;return fn>=90?90:fn})},300),Ot=await l5e(i,A);clearInterval(Ge),K(100),le(Ot),Xe({title:"Upload successful",description:"Space logo has been updated",status:"success",duration:5e3,isClosable:!0}),setTimeout(()=>{N(null),j(null),K(0),H(!1)},1e3),window.dispatchEvent(new CustomEvent("SpaceLogoUpdated",{detail:{logoUrl:Ot}}))}catch(Ge){console.error("Error uploading logo:",Ge),Xe({title:"Upload failed",description:Ge.message||"An error occurred during upload",status:"error",duration:5e3,isClosable:!0}),H(!1),K(0)}},Xt=async()=>{if(!ge){Xe({title:"No file selected",description:"Please select a file to upload",status:"warning",duration:5e3,isClosable:!0});return}try{fe(!0);const Ge=setInterval(()=>{ue(Jt=>{const fn=Jt+10;return fn>=90?90:fn})},300),Ot=await d5e(i,ge);clearInterval(Ge),ue(100),He(Ot),Xe({title:"Upload successful",description:"Space background has been updated",status:"success",duration:5e3,isClosable:!0}),setTimeout(()=>{Z(null),ne(null),ue(0),fe(!1)},1e3),window.dispatchEvent(new CustomEvent("SpaceBackgroundUpdated",{detail:{backgroundUrl:Ot}}))}catch(Ge){console.error("Error uploading background:",Ge),Xe({title:"Upload failed",description:Ge.message||"An error occurred during upload",status:"error",duration:5e3,isClosable:!0}),fe(!1),ue(0)}},Yn=async()=>{if(te)try{H(!0),await u5e(i),le(null),Xe({title:"Logo removed",description:"Space logo has been removed",status:"info",duration:5e3,isClosable:!0}),H(!1),window.dispatchEvent(new CustomEvent("SpaceLogoUpdated",{detail:{logoUrl:null}}))}catch(Ge){console.error("Error deleting logo:",Ge),Xe({title:"Deletion failed",description:Ge.message||"An error occurred during deletion",status:"error",duration:5e3,isClosable:!0}),H(!1)}},Kt=async()=>{if(Me)try{fe(!0),await h5e(i),He(null),Xe({title:"Background removed",description:"Space background has been removed",status:"info",duration:5e3,isClosable:!0}),fe(!1),window.dispatchEvent(new CustomEvent("SpaceBackgroundUpdated",{detail:{backgroundUrl:null}}))}catch(Ge){console.error("Error deleting background:",Ge),Xe({title:"Deletion failed",description:Ge.message||"An error occurred during deletion",status:"error",duration:5e3,isClosable:!0}),fe(!1)}},Re=()=>{oe.current&&oe.current.click()},Fe=()=>{rt.current&&rt.current.click()},Ke=async()=>{dt(!0);try{await f5e(i,{voiceDisabled:!Ae}),Ue(!Ae),Xe({title:"Settings Updated",description:`Voice chat has been ${Ae?"enabled":"disabled"} for this space.`,status:"success",duration:3e3,isClosable:!0})}catch(Ge){Te.error("Error updating voice settings:",Ge),Xe({title:"Error",description:"Failed to update voice settings",status:"error",duration:3e3,isClosable:!0})}finally{dt(!1)}},yt=async()=>{dt(!0);try{await p5e(i,!ze),et(!ze),Xe({title:"Settings Updated",description:`Space is now ${ze?"not accessible":"accessible"} to all users.`,status:"success",duration:3e3,isClosable:!0})}catch(Ge){Te.error("Error updating accessibility settings:",Ge),Xe({title:"Error",description:"Failed to update accessibility settings",status:"error",duration:3e3,isClosable:!0})}finally{dt(!1)}},St=async()=>{if(i){w(!0);try{const Ge=UV(),Ot=Cs(Ge,"spaces",i);await Du(Ot,{name:d,description:E}),Xe({title:"Success",description:"Space details updated successfully",status:"success",duration:3e3,isClosable:!0}),window.dispatchEvent(new CustomEvent("SpaceDetailsUpdated",{detail:{name:d,description:E}}))}catch(Ge){Te.error("Error updating space details:",Ge),Xe({title:"Error",description:"Failed to update space details",status:"error",duration:3e3,isClosable:!0})}finally{w(!1)}}};return C.jsxs(xa,{isOpen:n,onClose:t,size:"lg",isCentered:!0,children:[C.jsx(Va,{backdropFilter:"blur(4px)"}),C.jsxs(Ma,{bg:"rgba(23, 25, 35, 0.95)",color:"white",borderRadius:"md",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.5)",maxW:"800px",h:"500px",overflow:"hidden",children:[C.jsx(Ll,{borderBottom:"1px solid",borderColor:"whiteAlpha.200",py:2,fontSize:"md",fontWeight:"600",children:"Manage Space"}),C.jsx(cc,{size:"sm",color:"whiteAlpha.700",_hover:{color:"white",bg:"whiteAlpha.100"}}),C.jsx(Ua,{p:0,display:"flex",children:C.jsxs(ZR,{orientation:"vertical",variant:"unstyled",index:a,onChange:l,display:"flex",flexGrow:1,children:[C.jsxs(eC,{bg:"rgba(0, 0, 0, 0.2)",w:"80px",py:4,borderRight:"1px solid",borderColor:"whiteAlpha.200",children:[C.jsxs(Kc,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[C.jsx(Wn,{as:Joe,mb:1}),C.jsx(ht,{fontSize:"xs",children:"Details"})]}),C.jsxs(Kc,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[C.jsx(Wn,{as:JS,mb:1}),C.jsx(ht,{fontSize:"xs",children:"Logo"})]}),C.jsxs(Kc,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[C.jsx(Wn,{as:Y6e,mb:1}),C.jsx(ht,{fontSize:"xs",children:"Background"})]}),C.jsxs(Kc,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[C.jsx(Wn,{as:J6e,mb:1}),C.jsx(ht,{fontSize:"xs",children:"Settings"})]}),C.jsxs(Kc,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[C.jsx(Wn,{as:zJ,mb:1}),C.jsx(ht,{fontSize:"xs",children:"Users"})]})]}),C.jsxs(LN,{flexGrow:1,display:"flex",flexDirection:"column",overflowY:"auto",children:[C.jsxs(wu,{p:4,display:"flex",flexDirection:"column",children:[C.jsx(ht,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Space Details"}),C.jsx(ht,{fontSize:"xs",mb:4,children:"Edit the name and description of your space."}),C.jsxs(ri,{spacing:4,align:"stretch",children:[C.jsxs(Si,{children:[C.jsx(ta,{fontSize:"xs",children:"Space Name"}),C.jsx(ao,{value:d,onChange:Ge=>p(Ge.target.value),placeholder:"Enter space name",size:"sm",bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},_focus:{borderColor:"blue.300",boxShadow:"0 0 0 1px #63B3ED"},color:"white"})]}),C.jsxs(Si,{children:[C.jsx(ta,{fontSize:"xs",children:"Description"}),C.jsx(Pne,{value:E,onChange:Ge=>v(Ge.target.value),placeholder:"Enter space description",size:"sm",bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},_focus:{borderColor:"blue.300",boxShadow:"0 0 0 1px #63B3ED"},rows:5,resize:"vertical"}),C.jsx(KO,{fontSize:"xs",color:"whiteAlpha.700",children:"Provide a clear description of your space for users."})]}),C.jsx(bi,{colorScheme:"blue",size:"sm",onClick:St,isLoading:b,loadingText:"Saving...",alignSelf:"flex-start",mt:2,children:"Save Details"})]})]}),C.jsxs(wu,{p:4,display:"flex",flexDirection:"column",children:[C.jsx(ht,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Space Logo"}),C.jsx(ht,{fontSize:"xs",mb:4,children:"Upload a logo for your space. This will be displayed during loading."}),(te||F)&&C.jsxs(Ai,{direction:{base:"column",md:"row"},gap:4,mb:4,children:[te&&C.jsxs(Rt,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[C.jsx(ht,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Current Logo"}),C.jsx(Bh,{src:te,alt:"Space Logo",maxH:"120px",mx:"auto",objectFit:"contain"}),C.jsx(bi,{mt:3,colorScheme:"red",leftIcon:C.jsx(Wn,{as:oR}),onClick:Yn,isLoading:B,loadingText:"Removing...",size:"xs",variant:"ghost",children:"Remove Logo"})]}),F&&C.jsxs(Rt,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[C.jsx(ht,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Preview"}),C.jsx(Bh,{src:F,alt:"Preview",maxH:"120px",mx:"auto",objectFit:"contain"})]})]}),C.jsxs(Si,{children:[C.jsx(ta,{fontSize:"xs",children:"Upload New Logo"}),C.jsx(ao,{type:"file",accept:"image/*",onChange:Ut,ref:oe,display:"none"}),B&&C.jsxs(Rt,{mt:3,mb:3,children:[C.jsxs(ht,{fontSize:"xs",mb:1,children:["Uploading... ",ee,"%"]}),C.jsx(h0,{value:ee,size:"xs",colorScheme:"blue",borderRadius:"full"})]}),C.jsxs(Ni,{mt:3,spacing:3,children:[C.jsx(bi,{colorScheme:"blue",leftIcon:C.jsx(Wn,{as:JS}),onClick:Re,isDisabled:B,size:"sm",variant:"outline",children:"Browse"}),C.jsx(bi,{colorScheme:"green",leftIcon:C.jsx(Wn,{as:YV}),onClick:Ln,isLoading:B,loadingText:"Uploading...",isDisabled:!A||B,size:"sm",children:"Upload"})]}),C.jsx(KO,{fontSize:"xs",color:"whiteAlpha.700",mt:2,children:"Recommended: PNG format with transparent background. Max height: 400px."})]})]}),C.jsxs(wu,{p:4,display:"flex",flexDirection:"column",children:[C.jsx(ht,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Loading Background"}),C.jsx(ht,{fontSize:"xs",mb:4,children:"Upload a background image for your space. This will be displayed during loading."}),(Me||Q)&&C.jsxs(Ai,{direction:{base:"column",md:"row"},gap:4,mb:4,children:[Me&&C.jsxs(Rt,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[C.jsx(ht,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Current Background"}),C.jsx(Bh,{src:Me,alt:"Space Background",maxH:"120px",mx:"auto",objectFit:"contain"}),C.jsx(bi,{mt:3,colorScheme:"red",leftIcon:C.jsx(Wn,{as:oR}),onClick:Kt,isLoading:se,loadingText:"Removing...",size:"xs",variant:"ghost",children:"Remove Background"})]}),Q&&C.jsxs(Rt,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[C.jsx(ht,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Preview"}),C.jsx(Bh,{src:Q,alt:"Preview",maxH:"120px",mx:"auto",objectFit:"contain"})]})]}),C.jsxs(Si,{children:[C.jsx(ta,{fontSize:"xs",children:"Upload New Background"}),C.jsx(ao,{type:"file",accept:"image/*",onChange:ln,ref:rt,display:"none"}),se&&C.jsxs(Rt,{mt:3,mb:3,children:[C.jsxs(ht,{fontSize:"xs",mb:1,children:["Uploading... ",he,"%"]}),C.jsx(h0,{value:he,size:"xs",colorScheme:"blue",borderRadius:"full"})]}),C.jsxs(Ni,{mt:3,spacing:3,children:[C.jsx(bi,{colorScheme:"blue",leftIcon:C.jsx(Wn,{as:JS}),onClick:Fe,isDisabled:se,size:"sm",variant:"outline",children:"Browse"}),C.jsx(bi,{colorScheme:"green",leftIcon:C.jsx(Wn,{as:YV}),onClick:Xt,isLoading:se,loadingText:"Uploading...",isDisabled:!ge||se,size:"sm",children:"Upload"})]}),C.jsx(KO,{fontSize:"xs",color:"whiteAlpha.700",mt:2,children:"Recommended: High-quality image (1920x1080 or higher) that works well with the frosted glass overlay."})]})]}),C.jsxs(wu,{p:4,display:"flex",flexDirection:"column",children:[C.jsx(ht,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Space Settings"}),C.jsx(ht,{fontSize:"xs",mb:4,children:"Configure settings for your space."}),C.jsxs(ri,{spacing:4,align:"stretch",children:[C.jsx(Rt,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",children:C.jsxs(Ni,{justify:"space-between",align:"center",children:[C.jsxs(Rt,{children:[C.jsxs(Ni,{mb:1,spacing:2,children:[C.jsxs(Rt,{position:"relative",w:"16px",h:"16px",children:[C.jsx(Wn,{as:Z6e,color:Ae?"red.400":"green.400"}),Ae&&C.jsx(Rt,{position:"absolute",top:"50%",left:"0",right:"0",height:"2px",bg:"red.400",transform:"rotate(45deg)",transformOrigin:"center"})]}),C.jsx(ht,{fontSize:"sm",fontWeight:"600",children:"Voice Chat"})]}),C.jsx(ht,{fontSize:"xs",color:"whiteAlpha.800",children:Ae?"Voice chat is currently disabled for all users in this space.":"Voice chat is currently enabled for all users in this space."})]}),C.jsx(ag,{isChecked:!Ae,onChange:Ke,colorScheme:"green",size:"md",isDisabled:nt})]})}),C.jsx(Rt,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",children:C.jsxs(Ni,{justify:"space-between",align:"center",children:[C.jsxs(Rt,{children:[C.jsxs(Ni,{mb:1,spacing:2,children:[C.jsx(Rt,{position:"relative",w:"16px",h:"16px",children:C.jsx(Wn,{as:zJ,color:ze?"green.400":"red.400"})}),C.jsx(ht,{fontSize:"sm",fontWeight:"600",children:"Public Access"})]}),C.jsx(ht,{fontSize:"xs",color:"whiteAlpha.800",children:ze?"This space is accessible to all users in the 'users' group.":"This space is only accessible to specific users."}),C.jsx(ht,{fontSize:"xs",color:"blue.300",mt:1,children:"Note: Space owners and hosts will always have access regardless of this setting."})]}),C.jsx(ag,{isChecked:ze,onChange:yt,colorScheme:"green",size:"md",isDisabled:nt})]})}),C.jsxs(o0,{status:"info",variant:"subtle",bg:"whiteAlpha.100",borderRadius:"md",borderWidth:"1px",borderColor:"blue.800",children:[C.jsx(s0,{color:"blue.300"}),C.jsxs(Rt,{children:[C.jsx(Rk,{fontSize:"xs",fontWeight:"medium",children:"Coming Soon"}),C.jsx(Ck,{fontSize:"xs",children:"Additional space configuration options will be available in a future update."})]})]})]})]}),C.jsxs(wu,{p:4,display:"flex",flexDirection:"column",children:[C.jsx(ht,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Manage Users"}),C.jsx(ht,{fontSize:"xs",mb:4,children:"View and manage the owners and hosts of this space."}),be?C.jsx(Ai,{justify:"center",align:"center",h:"200px",children:C.jsx(Lp,{color:"blue.300"})}):C.jsxs(ri,{spacing:4,align:"stretch",children:[C.jsxs(Rt,{children:[C.jsxs(Ni,{mb:2,children:[C.jsx(Wn,{as:q6e,color:"green.400"}),C.jsx(ht,{fontSize:"sm",fontWeight:"600",children:"Owners"}),C.jsx(pp,{colorScheme:"green",ml:2,children:we.length})]}),C.jsx(Rt,{borderWidth:"1px",borderRadius:"md",p:2,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",maxH:"120px",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"4px"},"&::-webkit-scrollbar-track":{background:"rgba(0,0,0,0.1)"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"2px"}},children:we.length===0?C.jsx(ht,{fontSize:"xs",color:"whiteAlpha.600",children:"No owners found"}):C.jsx(ri,{spacing:1,align:"stretch",children:we.map(Ge=>C.jsxs(Ni,{spacing:2,p:1,borderRadius:"md",_hover:{bg:"whiteAlpha.100"},children:[C.jsx(Ou,{size:"xs",src:Ge.photoURL,name:Ge.displayName}),C.jsxs(Rt,{children:[C.jsx(ht,{fontSize:"xs",children:Ge.displayName}),C.jsx(ht,{fontSize:"xs",color:"whiteAlpha.600",children:Ge.firstName&&Ge.lastName?`${Ge.firstName} ${Ge.lastName}`:"Full name not available"})]}),C.jsx(Pk,{}),C.jsx(pp,{colorScheme:"green",variant:"solid",fontSize:"2xs",children:"Owner"})]},Ge.uid))})})]}),C.jsxs(Rt,{children:[C.jsxs(Ni,{mb:2,children:[C.jsx(Wn,{as:Q6e,color:"purple.400"}),C.jsx(ht,{fontSize:"sm",fontWeight:"600",children:"Hosts"}),C.jsx(pp,{colorScheme:"purple",ml:2,children:ye.length})]}),C.jsx(Rt,{borderWidth:"1px",borderRadius:"md",p:2,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",maxH:"120px",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"4px"},"&::-webkit-scrollbar-track":{background:"rgba(0,0,0,0.1)"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"2px"}},children:ye.length===0?C.jsx(ht,{fontSize:"xs",color:"whiteAlpha.600",children:"No hosts found"}):C.jsx(ri,{spacing:1,align:"stretch",children:ye.map(Ge=>C.jsxs(Ni,{spacing:2,p:1,borderRadius:"md",_hover:{bg:"whiteAlpha.100"},children:[C.jsx(Ou,{size:"xs",src:Ge.photoURL,name:Ge.displayName}),C.jsxs(Rt,{children:[C.jsx(ht,{fontSize:"xs",children:Ge.displayName}),C.jsx(ht,{fontSize:"xs",color:"whiteAlpha.600",children:Ge.firstName&&Ge.lastName?`${Ge.firstName} ${Ge.lastName}`:"Full name not available"})]}),C.jsx(Pk,{}),C.jsx(pp,{colorScheme:"purple",variant:"solid",fontSize:"2xs",children:"Host"})]},Ge.uid))})})]}),C.jsx(Tp,{borderColor:"whiteAlpha.200"}),C.jsxs(o0,{status:"info",variant:"subtle",bg:"whiteAlpha.100",borderRadius:"md",borderWidth:"1px",borderColor:"blue.800",py:2,fontSize:"xs",children:[C.jsx(s0,{color:"blue.300",boxSize:4}),C.jsxs(Rt,{children:[C.jsx(Rk,{fontSize:"xs",fontWeight:"medium",children:"Coming Soon"}),C.jsx(Ck,{fontSize:"xs",children:"User management features like adding/removing hosts and owners will be available in a future update."})]})]})]})]})]})]})})]})]})},tWe=({onTogglePlayerList:n,spaceID:t})=>{const{fullscreenRef:i}=Ld(),[a,l]=L.useState(!0),[d,p]=L.useState(!1),[E,v]=L.useState(!1),[b,w]=L.useState(!1),[A,N]=L.useState(!1),[F,j]=L.useState(!1),[B,H]=L.useState(null),[ee,K]=L.useState(!1),[te,le]=L.useState(!1),[oe,ge]=L.useState(!1),[Z,Q]=L.useState(!1),ne=Dd(),{user:se}=L.useContext(ja),fe=(se==null?void 0:se.Nickname)||"Unknown",[he,ue]=L.useState(!1),Me=async()=>{if(se!=null&&se.uid&&t)try{const Se=await rf(se.uid);let Ae=!1,Ue=!1;if(Se.groups){const et=`space_${t}_owners`,nt=`space_${t}_hosts`;Ae=Se.groups.includes(et),Ue=Se.groups.includes(nt)}const ze=await ooe(se.uid,"disruptiveAdmin");if(Q(ze),H({rpmURL:Se.rpmURL?Se.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null}),le(Ae||ze),ge(Ue),!Ae&&!ze&&ee){K(!1);const et=new CustomEvent("editModeChanged",{detail:{enabled:!1}});window.dispatchEvent(et),ne({title:"Edit Mode Disabled",description:"You don't have permission to edit this space.",status:"warning",duration:5e3,isClosable:!0,position:"top"})}}catch(Se){console.error("Error fetching profile data:",Se),le(!1),ge(!1),Q(!1)}else le(!1),ge(!1),Q(!1)};L.useEffect(()=>{Me()},[se==null?void 0:se.uid,t,ee]),L.useEffect(()=>{const Se=()=>{l(!0)};return window.addEventListener("PlayerInstantiated",Se),()=>{window.removeEventListener("PlayerInstantiated",Se)}},[]),L.useEffect(()=>{(async()=>{try{window.agoraClient&&typeof window.agoraClient.voiceDisabled=="boolean"&&ue(window.agoraClient.voiceDisabled)}catch(Ue){console.error("Error checking if voice is disabled:",Ue)}})();const Ae=Ue=>{Ue.detail&&typeof Ue.detail.voiceDisabled=="boolean"&&(console.log("Voice setting changed:",Ue.detail.voiceDisabled),ue(Ue.detail.voiceDisabled))};return window.addEventListener("SpaceVoiceSettingChanged",Ae),()=>{window.removeEventListener("SpaceVoiceSettingChanged",Ae)}},[]);const He=()=>v(!E),rt=()=>w(!b),we=()=>{j(!F),Ne()},Ce=()=>{N(!1),Me()},ye=Se=>{Se.stopPropagation(),typeof n=="function"&&(Te.log("CanvasMainMenu: Toggling player list"),n())},Ne=()=>{p(!1)},be=Se=>{if(Se.stopPropagation(),!te){ne({title:"Permission Denied",description:"You don't have permission to edit this space. Only space owners can use Edit Mode.",status:"error",duration:5e3,isClosable:!0,position:"top"});return}const Ae=!ee;K(Ae);const Ue=new CustomEvent("editModeChanged",{detail:{enabled:Ae}});window.dispatchEvent(Ue),ne({title:Ae?"Edit Mode Enabled":"Edit Mode Disabled",description:Ae?"You can now make changes to the scene.":"Scene editing is now disabled.",status:Ae?"info":"success",duration:3e3,isClosable:!0,position:"top"})};return C.jsxs(C.Fragment,{children:[C.jsxs(RN,{isOpen:d,onClose:()=>p(!1),children:[C.jsx(CN,{as:ka,icon:C.jsx(y5e,{}),"aria-label":"Main menu",variant:"ghost",color:"white",bg:d?"whiteAlpha.400":"whiteAlpha.200",_hover:{bg:d?"whiteAlpha.500":"whiteAlpha.300"},size:"md",onClick:()=>p(!d)}),C.jsx(Ml,{containerRef:i,children:C.jsx(IN,{bg:"rgba(0,0,0,0.4)",backdropFilter:"blur(10px)",border:"none",boxShadow:"lg",color:"white",width:"300px",p:4,borderRadius:"xl",zIndex:9999,transform:"none !important",children:C.jsxs(ri,{align:"stretch",spacing:4,children:[C.jsxs(Ni,{children:[C.jsx(Ou,{size:"md",src:B==null?void 0:B.rpmURL,bg:"white",name:" ",borderWidth:"1px",borderColor:"whiteAlpha.300"}),C.jsxs(ri,{align:"start",spacing:0,children:[C.jsxs(Ni,{children:[C.jsx(ht,{fontWeight:"bold",children:fe}),te&&!Z&&C.jsx(cg,{label:"Owner",placement:"top",hasArrow:!0,zIndex:1e4,openDelay:300,gutter:8,portalProps:{containerRef:i},children:C.jsx(Rt,{display:"inline-block",children:C.jsx(Wn,{as:HV,color:"green.400",boxSize:3})})}),!te&&oe&&!Z&&C.jsx(cg,{label:"Host",placement:"top",hasArrow:!0,zIndex:1e4,openDelay:300,gutter:8,portalProps:{containerRef:i},children:C.jsx(Rt,{display:"inline-block",children:C.jsx(Wn,{as:qV,color:"purple.400",boxSize:3})})}),Z&&C.jsx(cg,{label:"Admin",placement:"top",hasArrow:!0,zIndex:1e4,openDelay:300,gutter:8,portalProps:{containerRef:i},children:C.jsx(Rt,{display:"inline-block",children:C.jsx(Wn,{as:b6e,color:"blue.400",boxSize:3})})})]}),C.jsx(ht,{fontSize:"sm",color:"whiteAlpha.800",children:"Spaces Metaverse"})]})]}),C.jsxs(Ni,{spacing:4,justify:"center",children:[C.jsx(ka,{icon:C.jsx(w6e,{}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"People",_hover:{bg:"whiteAlpha.200"},onClick:ye}),te&&C.jsx(ka,{icon:C.jsx(m6e,{}),variant:"ghost",colorScheme:ee?"green":"whiteAlpha",size:"sm","aria-label":"Edit Mode",_hover:{bg:"whiteAlpha.200"},onClick:be}),C.jsx(ka,{icon:C.jsx(Rt,{w:"4",h:"4"}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"Action 3",_hover:{bg:"whiteAlpha.200"}}),C.jsx(ka,{icon:C.jsx(Rt,{w:"4",h:"4"}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"Action 4",_hover:{bg:"whiteAlpha.200"}})]}),C.jsx(Tp,{borderColor:"whiteAlpha.300"}),C.jsxs(ri,{align:"stretch",spacing:2,children:[te&&C.jsxs(Ni,{p:2,borderRadius:"md",_hover:{bg:"whiteAlpha.200"},onClick:Se=>Se.stopPropagation(),justify:"space-between",children:[C.jsx(ht,{fontSize:"md",children:"Edit Mode"}),C.jsx(ag,{id:"edit-mode-toggle",isChecked:ee,onChange:be,colorScheme:"green",sx:{"& .chakra-switch__track":{bg:ee?"green.500":"black"}}})]}),te&&C.jsx(ht,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:we,children:"Manage Space"}),se&&t&&!he&&C.jsx(G6e,{onClose:Ne}),C.jsx(ht,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:He,children:"Settings"}),C.jsx(ht,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:rt,children:"Controls"}),C.jsx(ht,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",children:"Help"}),C.jsx(ht,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",color:"red.300",children:"Leave"})]})]})})})]}),b&&C.jsx(H6e,{open:b,onClose:rt}),E&&C.jsx(K6e,{open:E,onClose:He}),A&&C.jsx(Goe,{open:A,onClose:Ce}),C.jsx(eWe,{isOpen:F,onClose:we})]})},nWe=({isOpen:n,onClose:t,mediaScreenId:i,onImageChange:a})=>{const{spaceID:l}=el(),d=kg(),p=Dd(),E=L.useRef(null),v=L.useRef(null),b=L.useRef(),[w,A]=L.useState(null),[N,F]=L.useState(""),[j,B]=L.useState(!1),[H,ee]=L.useState(0),[K,te]=L.useState(null),[le,oe]=L.useState(!0),[ge,Z]=L.useState(!1),[Q,ne]=L.useState(!1),[se,fe]=L.useState(0),[he,ue]=L.useState("image"),[Me,He]=L.useState(""),[rt,we]=L.useState(!1);L.useEffect(()=>{(async()=>{if(n&&i&&l){oe(!0);try{const It=await Ep(l,i);if(It&&(It.imageUrl||It.videoUrl)){te(It);const hn=It.mediaType==="video";ue(hn?"video":"image"),we(It.displayAsVideo||!1),hn&&It.videoUrl&&(He(It.videoUrl),fe(1))}else te(null)}catch(It){Te.error("Error fetching existing image:",It),te(null)}finally{oe(!1)}}})()},[n,i,l]),L.useEffect(()=>{n||(A(null),F(""),ee(0),He(""))},[n]);const Ce=L.useCallback(Xe=>{Xe.preventDefault(),Xe.stopPropagation(),ne(!0)},[]),ye=L.useCallback(Xe=>{Xe.preventDefault(),Xe.stopPropagation(),ne(!1)},[]),Ne=L.useCallback(Xe=>{Xe.preventDefault(),Xe.stopPropagation()},[]),be=L.useCallback(Xe=>{if(Xe.preventDefault(),Xe.stopPropagation(),ne(!1),Xe.dataTransfer.files&&Xe.dataTransfer.files.length>0){const It=Xe.dataTransfer.files[0];Se(It)}},[]);L.useEffect(()=>{const Xe=v.current;if(Xe)return Xe.addEventListener("dragenter",Ce),Xe.addEventListener("dragleave",ye),Xe.addEventListener("dragover",Ne),Xe.addEventListener("drop",be),()=>{Xe.removeEventListener("dragenter",Ce),Xe.removeEventListener("dragleave",ye),Xe.removeEventListener("dragover",Ne),Xe.removeEventListener("drop",be)}},[Ce,ye,Ne,be]);const Se=Xe=>{if(!Xe)return;if(!Xe.type.startsWith("image/")){p({title:"Invalid file type",description:"Please select an image file (PNG, JPEG, etc.)",status:"error",duration:5e3,isClosable:!0});return}A(Xe);const It=new FileReader;It.onloadend=()=>{F(It.result)},It.readAsDataURL(Xe)},Ae=Xe=>{const It=Xe.target.files[0];Se(It)},Ue=async Xe=>{const It=Xe.target.checked;if(we(It),K)try{await s6e(l,i,It),It?d("SetMediaScreenImage",{mediaScreenId:i,imageUrl:null,videoUrl:K.videoUrl||null,mediaType:K.mediaType||"image",displayAsVideo:!0}):d("SetMediaScreenImage",{mediaScreenId:i,imageUrl:K.imageUrl||null,videoUrl:K.videoUrl||null,mediaType:K.mediaType||"image",displayAsVideo:!1}),te({...K,displayAsVideo:It}),p({title:"Display mode updated",description:`The media screen will now be displayed as ${It?"video":"image"}`,status:"success",duration:3e3,isClosable:!0}),Te.log(`Updated display mode for media screen ${i} to ${It?"video":"image"}`),a&&a({type:"update",mediaScreenId:i,displayAsVideo:It})}catch(hn){Te.error("Error updating display mode:",hn),p({title:"Update failed",description:hn.message||"An error occurred while updating the display mode",status:"error",duration:5e3,isClosable:!0}),we(!It)}},ze=async()=>{if(he==="image"&&!w){p({title:"No file selected",description:"Please select an image to upload",status:"warning",duration:5e3,isClosable:!0});return}if(he==="video"&&!Me){p({title:"No video URL",description:"Please enter a video URL",status:"warning",duration:5e3,isClosable:!0});return}try{B(!0);const Xe=setInterval(()=>{ee(ln=>{const Ln=ln+10;return Ln>=90?90:Ln})},300);let It;he==="image"?It=await FJ(l,i,w,{mediaType:he,displayAsVideo:rt}):(It=Me,await FJ(l,i,null,{mediaType:"video",directUrl:Me,displayAsVideo:rt})),clearInterval(Xe),ee(100);let hn=null,Ut=null;he==="image"?(hn=rt?null:It,Ut=(K==null?void 0:K.videoUrl)||null):(hn=!rt&&(K!=null&&K.imageUrl)?K.imageUrl:null,Ut=It),d("SetMediaScreenImage",{mediaScreenId:i,imageUrl:hn,videoUrl:Ut,mediaType:he,displayAsVideo:rt}),Te.log(`Uploaded and sent ${he} for media screen ${i} (display as video: ${rt})`),a&&a({type:"upload",mediaScreenId:i,imageUrl:he==="image"?It:K==null?void 0:K.imageUrl,videoUrl:he==="video"?It:K==null?void 0:K.videoUrl,mediaType:he,displayAsVideo:rt}),p({title:"Upload successful",description:`The ${he} has been uploaded and applied to the media screen`,status:"success",duration:5e3,isClosable:!0}),setTimeout(()=>{A(null),F(""),B(!1),ee(0),t()},1e3)}catch(Xe){Te.error(`Error uploading ${he}:`,Xe),p({title:"Upload failed",description:Xe.message||`An error occurred while uploading the ${he}`,status:"error",duration:5e3,isClosable:!0}),B(!1),ee(0)}},et=async()=>{Z(!1);try{B(!0),await o6e(l,i),d("SetMediaScreenImage",{mediaScreenId:i,imageUrl:he==="image"?null:(K==null?void 0:K.imageUrl)||null,videoUrl:he==="video"?null:(K==null?void 0:K.videoUrl)||null,mediaType:null,displayAsVideo:!1}),Te.log(`Deleted ${he} for media screen ${i}`),a&&a({type:"delete",mediaScreenId:i}),p({title:`${he==="image"?"Image":"Video"} deleted`,description:`The ${he} has been removed from the media screen`,status:"success",duration:5e3,isClosable:!0}),te(null),B(!1),He(""),we(!1),setTimeout(()=>{t()},500)}catch(Xe){Te.error(`Error deleting ${he}:`,Xe),p({title:"Deletion failed",description:Xe.message||`An error occurred while deleting the ${he}`,status:"error",duration:5e3,isClosable:!0}),B(!1)}},nt=()=>{j||(A(null),F(""),ee(0),t())},dt=Xe=>{fe(Xe),ue(Xe===0?"image":"video")};return C.jsxs(C.Fragment,{children:[C.jsxs(xa,{isOpen:n,onClose:nt,size:"xl",children:[C.jsx(Va,{backdropFilter:"blur(10px)"}),C.jsxs(Ma,{bg:"gray.800",color:"white",maxW:"900px",children:[C.jsx(Ll,{children:"Media Screen Content"}),C.jsx(cc,{isDisabled:j}),C.jsxs(Rt,{px:6,pb:2,children:[C.jsxs(Ai,{justify:"space-between",align:"center",bg:"gray.700",p:4,borderRadius:"md",mb:4,children:[C.jsxs(Ni,{spacing:4,children:[C.jsx(ht,{fontWeight:"medium",children:"Display as:"}),C.jsxs(Ni,{spacing:2,children:[C.jsx(Wn,{as:JS,color:rt?"gray.400":"green.300"}),C.jsx(ag,{colorScheme:"purple",size:"md",isChecked:rt,onChange:Ue}),C.jsx(Wn,{as:AO,color:rt?"purple.300":"gray.400"})]})]}),C.jsx(pp,{colorScheme:rt?"purple":"green",fontSize:"sm",px:2,py:1,borderRadius:"md",children:rt?"Video Output":"Image Output"})]}),C.jsxs(ht,{fontSize:"sm",color:"gray.400",mb:1,children:["Media Screen ID: ",C.jsx("strong",{children:i})]}),C.jsx(ht,{fontSize:"xs",color:"gray.500",mb:2,children:"The toggle above controls how the content will be displayed in the 3D space, regardless of the content type you upload."}),C.jsx(Tp,{mb:4})]}),C.jsx(Ua,{children:C.jsxs(Ai,{children:[C.jsx(ZR,{orientation:"vertical",variant:"solid-rounded",colorScheme:"blue",index:se,onChange:dt,h:"100%",minW:"120px",mr:4,children:C.jsxs(eC,{children:[C.jsxs(Kc,{_selected:{color:"white",bg:"blue.500"},mb:2,py:6,justifyContent:"flex-start",children:[C.jsx(Wn,{as:JS,mr:2})," Image"]}),C.jsxs(Kc,{_selected:{color:"white",bg:"blue.500"},py:6,justifyContent:"flex-start",children:[C.jsx(Wn,{as:AO,mr:2})," Video"]})]})}),C.jsx(Rt,{flex:"1",children:le?C.jsx(Ai,{justify:"center",align:"center",h:"150px",children:C.jsx(Lp,{size:"xl",color:"blue.400"})}):C.jsxs(C.Fragment,{children:[C.jsx(Rt,{children:se===0?C.jsxs(ri,{spacing:4,align:"stretch",children:[K&&K.imageUrl&&he==="image"&&C.jsxs(Rt,{children:[C.jsx(ht,{fontWeight:"semibold",mb:2,children:"Current Image:"}),C.jsxs(Ai,{children:[C.jsx(Rt,{borderWidth:"1px",borderRadius:"md",overflow:"hidden",mb:2,maxW:"200px",mr:4,children:C.jsx(Bh,{src:K.imageUrl,alt:"Current image",maxHeight:"150px",width:"100%",objectFit:"contain"})}),C.jsxs(ri,{align:"flex-start",spacing:2,children:[C.jsxs(ht,{fontSize:"xs",color:"gray.400",children:["Uploaded: ",new Date(K.uploadedAt).toLocaleString()]}),C.jsxs(ht,{fontSize:"xs",color:"gray.400",children:["Display Mode: ",K.displayAsVideo?"Video":"Image"]}),C.jsx(bi,{size:"sm",colorScheme:"red",variant:"outline",leftIcon:C.jsx(Wn,{as:oR}),onClick:()=>Z(!0),isDisabled:j,children:"Delete"})]})]}),C.jsx(Tp,{my:4})]}),C.jsx(ht,{fontWeight:"semibold",mb:2,children:K&&K.imageUrl&&he==="image"?"Replace with new image:":"Upload new image:"}),C.jsxs(Rt,{ref:v,borderWidth:"2px",borderRadius:"md",borderStyle:"dashed",borderColor:Q?"blue.400":"gray.500",bg:Q?"blue.900":"gray.700",p:6,textAlign:"center",transition:"all 0.2s",_hover:{borderColor:"blue.400",bg:"gray.600"},cursor:"pointer",onClick:()=>E.current.click(),children:[N?C.jsx(Rt,{borderRadius:"md",overflow:"hidden",maxH:"200px",children:C.jsx(Bh,{src:N,alt:"Preview",maxHeight:"200px",width:"100%",objectFit:"contain"})}):C.jsxs(ri,{spacing:2,children:[C.jsx(Wn,{as:YV,boxSize:"24px",color:"gray.400"}),C.jsx(ht,{children:"Drag and drop an image here, or click to browse"}),C.jsx(ht,{fontSize:"xs",color:"gray.400",children:"Supports PNG, JPG, JPEG, GIF"})]}),C.jsx(ao,{type:"file",accept:"image/*",onChange:Ae,ref:E,display:"none"})]}),w&&C.jsxs(ht,{fontSize:"sm",children:["Selected file: ",w.name," (",Math.round(w.size/1024)," KB)"]})]}):C.jsxs(ri,{spacing:4,align:"stretch",children:[K&&K.videoUrl&&he==="video"&&C.jsxs(Rt,{children:[C.jsx(ht,{fontWeight:"semibold",mb:2,children:"Current Video URL:"}),C.jsxs(Ai,{children:[C.jsx(Rt,{borderWidth:"1px",borderRadius:"md",p:3,mb:2,flex:"1",mr:4,bg:"gray.700",children:C.jsx(ht,{fontSize:"sm",wordBreak:"break-all",children:K.videoUrl})}),C.jsxs(ri,{align:"flex-start",spacing:2,children:[C.jsxs(ht,{fontSize:"xs",color:"gray.400",children:["Added: ",new Date(K.uploadedAt).toLocaleString()]}),C.jsxs(ht,{fontSize:"xs",color:"gray.400",children:["Display Mode: ",K.displayAsVideo?"Video":"Image"]}),C.jsx(bi,{size:"sm",colorScheme:"red",variant:"outline",leftIcon:C.jsx(Wn,{as:oR}),onClick:()=>Z(!0),isDisabled:j,children:"Delete"})]})]}),C.jsx(Tp,{my:4})]}),C.jsx(ht,{fontWeight:"semibold",mb:2,children:K&&K.videoUrl&&he==="video"?"Replace with new video:":"Add video URL:"}),C.jsx(Rt,{p:3,bg:"blue.900",borderRadius:"md",mb:4,borderLeftWidth:"4px",borderLeftColor:"blue.400",children:C.jsxs(Ni,{children:[C.jsx(Wn,{as:Joe,color:"blue.300"}),C.jsx(ht,{fontSize:"sm",fontWeight:"medium",children:'After entering a URL, click the "Save Video URL" button at the bottom to save your changes.'})]})}),C.jsxs(Si,{children:[C.jsx(ta,{fontSize:"sm",children:"Video URL"}),C.jsx(ao,{placeholder:"Enter video URL (YouTube, Vimeo, etc.)",value:Me,onChange:Xe=>He(Xe.target.value),bg:"gray.700",borderColor:"gray.600",_hover:{borderColor:"blue.400"},_focus:{borderColor:"blue.400",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},size:"lg"}),C.jsx(ht,{fontSize:"xs",color:"gray.400",mt:1,children:"Enter a URL from YouTube, Vimeo, or other video hosting services"})]}),C.jsxs(Rt,{mt:4,p:4,bg:"gray.700",borderRadius:"md",children:[C.jsxs(Ni,{children:[C.jsx(Wn,{as:AO,color:"blue.300"}),C.jsx(ht,{fontWeight:"medium",children:"Video Support"})]}),C.jsx(ht,{fontSize:"sm",mt:2,color:"gray.300",children:"Video playback will be implemented in a future update. For now, you can add the URL which will be stored with the media screen."}),C.jsx(ht,{fontSize:"sm",mt:2,color:"yellow.300",fontWeight:"medium",children:'Important: Click the "Upload" button at the bottom to save your video URL.'})]}),Me&&C.jsxs(Rt,{mt:4,p:4,bg:"gray.900",borderRadius:"md",borderWidth:"1px",borderColor:"blue.500",children:[C.jsxs(Ni,{mb:2,children:[C.jsx(Wn,{as:X6e,color:"blue.300"}),C.jsx(ht,{fontWeight:"medium",children:"URL Preview"})]}),C.jsx(ht,{fontSize:"sm",wordBreak:"break-all",color:"gray.300",children:Me}),C.jsx(ht,{fontSize:"xs",color:"gray.400",mt:2,children:"This URL will be saved when you click the Upload button below"})]})]})}),j&&C.jsxs(Rt,{mt:4,children:[C.jsxs(ht,{mb:2,children:["Uploading: ",H,"%"]}),C.jsx(h0,{value:H,colorScheme:"blue",size:"sm",borderRadius:"md"})]})]})})]})}),C.jsxs(PE,{children:[C.jsx(bi,{variant:"ghost",mr:3,onClick:nt,isDisabled:j,children:"Cancel"}),C.jsx(bi,{colorScheme:"blue",onClick:ze,isLoading:j,loadingText:"Uploading",isDisabled:he==="image"&&!w||he==="video"&&!Me||j||le,leftIcon:C.jsx(Wn,{as:he==="image"?JS:AO}),size:"lg",px:6,children:he==="image"?"Upload Image":"Save Video URL"})]})]})]}),C.jsx(Hxe,{isOpen:ge,leastDestructiveRef:b,onClose:()=>Z(!1),children:C.jsx(Va,{children:C.jsxs($xe,{bg:"gray.800",color:"white",children:[C.jsxs(Ll,{fontSize:"lg",fontWeight:"bold",children:["Delete ",he==="video"?"Video":"Image"]}),C.jsxs(Ua,{children:["Are you sure you want to delete this ",he,"? This will revert the media screen to its blank state."]}),C.jsxs(PE,{children:[C.jsx(bi,{ref:b,onClick:()=>Z(!1),children:"Cancel"}),C.jsx(bi,{colorScheme:"red",onClick:et,ml:3,leftIcon:C.jsx(Wn,{as:oR}),children:"Delete"})]})]})})})]})},rWe=n=>{const[t,i]=L.useState(null),[a,l]=L.useState(""),[d,p]=L.useState(null),[E,v]=L.useState(!1),b=Vp(),{spaceID:w}=el(),A=L.useCallback(j=>{var B,H;try{if(!j)return null;if(j.includes("youtube.com")||j.includes("youtu.be")){let ee="";return j.includes("youtube.com/watch")?ee=new URLSearchParams(new URL(j).search).get("v"):j.includes("youtu.be/")&&(ee=j.split("youtu.be/")[1].split("?")[0]),ee?`https://www.youtube.com/embed/${ee}?autoplay=1`:j}if(j.includes("vimeo.com")){if(j.includes("player.vimeo.com/video"))return j;const ee=(H=(B=j.split("vimeo.com/")[1])==null?void 0:B.split("?")[0])==null?void 0:H.split("/")[0];return ee?`https://player.vimeo.com/video/${ee}?autoplay=1`:j}return j}catch(ee){return Te.error("Error converting to embed URL:",ee),j}},[]),N=L.useCallback(()=>{setTimeout(()=>{v(!1),Te.log("Video processing state reset")},100)},[]);L.useEffect(()=>{let j=!0,B=null;const ee=b("PlayMediaScreenVideo",async K=>{try{console.log("[DEBUG] PlayMediaScreenVideo event received:",K,"isEditMode:",n),console.log("PlayMediaScreenVideo event received:",K);const{mediaScreenId:te,videoUrl:le}=K||{};if(!te){Te.error("Media screen ID is missing in Unity event data."),N();return}if(n){console.log(`[DEBUG] Edit mode is active for screen ${te}, setting ID but not playing video`),Te.log("Edit mode is active, setting media screen ID but not playing video"),p(te);return}if(v(!0),B=setTimeout(()=>{j&&(Te.warn("Video processing timeout reached, resetting state"),v(!1))},5e3),le){if(console.log(`Using direct video URL from event: ${le}`),j)try{const oe=A(le);console.log(`Setting video URL to: ${oe} (original: ${le})`),i(oe),l(`Media Screen ${te}`),p(te),Te.log("Media screen video URL set directly from event:",oe)}catch(oe){Te.error("Error setting video URL from direct URL:",oe)}finally{N(),clearTimeout(B)}return}console.log(`Fetching media screen data for ID: ${te}`);try{const oe=await Ep(w,te);if(console.log("Media screen data from Firestore:",oe),!oe||!oe.videoUrl){Te.error("No video URL found for media screen:",te),N(),clearTimeout(B);return}if(!oe.displayAsVideo){Te.log("Media screen is not set to display as video:",te),console.log("displayAsVideo flag is false for this media screen"),N(),clearTimeout(B);return}if(j)try{const ge=A(oe.videoUrl);console.log(`Setting video URL to: ${ge} (original: ${oe.videoUrl})`),i(ge),l(oe.title||`Media Screen ${te}`),p(te),Te.log("Media screen video URL set to:",ge)}catch(ge){Te.error("Error setting video URL from Firestore:",ge)}finally{N(),clearTimeout(B)}}catch(oe){Te.error(`Error fetching media screen data for ${te}:`,oe),N(),clearTimeout(B)}}catch(te){Te.error("Error handling media screen video play:",te),console.error("Error handling media screen video play:",te),N(),clearTimeout(B)}});return()=>{j=!1,B&&clearTimeout(B),ee()}},[b,w,n,A,N]);const F=L.useCallback(()=>{i(null),l(""),p(null),v(!1),Te.log("Video player state reset")},[]);return[t,a,d,F,E]},iWe=()=>{const{spaceID:n}=el(),t=kg(),i=Vp(),[a,l]=L.useState(!1);L.useEffect(()=>{if(window.isPlayerInstantiated){Te.log("useMediaScreenThumbnails: Unity already ready (via window flag)"),l(!0);return}const b=()=>{Te.log("useMediaScreenThumbnails: Unity is now ready (PlayerInstantiated event)"),l(!0)};return window.addEventListener("PlayerInstantiated",b),()=>{window.removeEventListener("PlayerInstantiated",b)}},[]);const d=L.useCallback(async b=>{try{return b.includes("vimeo.com")?await p(b):b.includes("youtube.com")||b.includes("youtu.be")?await E(b):"https://via.placeholder.com/640x360?text=Video"}catch(w){return Te.error(`Error fetching thumbnail for ${b}:`,w),"https://via.placeholder.com/640x360?text=Error"}},[]),p=async b=>{try{const w=`https://vimeo.com/api/oembed.json?url=${encodeURIComponent(b)}`,A=await fetch(w);if(!A.ok)throw new Error(`Failed to fetch Vimeo thumbnail: ${A.statusText}`);const N=await A.json(),F=N.thumbnail_url.replace(/_\d+x\d+/,""),j=["640x360","295x166"];let B=null;for(let H of j){const ee=`https://i.vimeocdn.com/filter/overlay?src0=${encodeURIComponent(`${F}_${H}`)}&src1=http://f.vimeocdn.com/p/images/crawler_play.png`;try{if((await fetch(ee,{method:"HEAD"})).ok){B=ee;break}}catch(K){Te.warn(`Failed to validate thumbnail URL: ${ee}`,K)}}return B||N.thumbnail_url}catch(w){return Te.error(`Error fetching Vimeo thumbnail: ${w.message}`),"https://via.placeholder.com/640x360?text=Vimeo+Video"}},E=async b=>{let w="";if(b.includes("youtube.com/watch")?w=new URLSearchParams(new URL(b).search).get("v"):b.includes("youtu.be/")&&(w=b.split("youtu.be/")[1].split("?")[0]),!w)throw new Error("Could not extract YouTube video ID");const A=`https://img.youtube.com/vi/${w}/maxresdefault.jpg`;try{if((await fetch(A,{method:"HEAD"})).ok)return A}catch(N){Te.warn(`Failed to validate maxresdefault thumbnail for YouTube video ${w}`,N)}return`https://img.youtube.com/vi/${w}/hqdefault.jpg`},v=L.useCallback(async b=>{try{if(!n||!b)return;Te.log(`Refreshing thumbnail for media screen ${b}`);const w=await Ep(n,b);if(!w){Te.log(`No media screen found with ID ${b}`);return}if(Te.log("Media screen data:",w),!w.displayAsVideo||!w.videoUrl){Te.log(`Media screen ${b} is not set to display as video or has no video URL`);return}const A=await d(w.videoUrl);t("SetMediaScreenThumbnail",{mediaScreenId:b,thumbnailUrl:A}),Te.log(`Sent refreshed thumbnail for media screen ${b}: ${A}`)}catch(w){Te.error(`Error refreshing thumbnail for media screen ${b}:`,w)}},[n,d,t]);L.useEffect(()=>{if(!a){Te.log("useMediaScreenThumbnails: Waiting for Unity to be ready before setting up thumbnail listeners");return}Te.log("useMediaScreenThumbnails: Unity is ready, now setting up thumbnail listeners");const w=i("SetMediaScreenThumbnail",async A=>{try{const{mediaScreenId:N,thumbnailUrl:F}=A;F==="refresh"&&N&&(console.log(`Received request to refresh thumbnail for media screen ${N}`),await v(N))}catch(N){console.error("Error handling SetMediaScreenThumbnail event:",N)}});return()=>{w()}},[i,v,a]),L.useEffect(()=>{if(!a){Te.log("useMediaScreenThumbnails: Waiting for Unity to be ready before fetching thumbnails");return}Te.log("useMediaScreenThumbnails: Unity is ready, now fetching thumbnails");const b=async()=>{try{if(!n)throw new Error("spaceID is not defined.");Te.log("Fetching media screens for thumbnails...");const A=await F4(n);Te.log("All media screens:",A);const N=A.filter(B=>B.displayAsVideo&&B.videoUrl);if(Te.log("Media screens set to display as videos:",N),N.length===0){Te.log("No media screens set to display as videos found.");return}Te.log(`Found ${N.length} media screens set to display as videos.`);const F=N.map(async B=>{try{const H=await d(B.videoUrl);return Te.log(`Fetched thumbnail for ${B.id}: ${H}`),{mediaScreenId:B.id,thumbnailUrl:H}}catch(H){return Te.error(`Error processing thumbnail for media screen ${B.id}:`,H),{mediaScreenId:B.id,thumbnailUrl:"https://via.placeholder.com/640x360?text=Error"}}}),j=await Promise.all(F);Te.log("Fetched Media Screen Thumbnails",j),j.forEach(({mediaScreenId:B,thumbnailUrl:H})=>{t("SetMediaScreenThumbnail",{mediaScreenId:B,thumbnailUrl:H}),Te.log(`Sent thumbnail to Unity for media screen ${B}: ${H}`)})}catch(A){Te.error("Error fetching media screen thumbnails:",A)}};b();const w=setInterval(b,5*60*1e3);return()=>{clearInterval(w)}},[t,n,d,a])},GJ={iframeContainer:{position:"relative",paddingBottom:"56.25%",height:0,overflow:"hidden",width:"100%",pointerEvents:"auto !important"},iframe:{position:"absolute",top:0,left:0,width:"100%",height:"100%",border:"none",pointerEvents:"auto !important",zIndex:1e4}},oWe=()=>C.jsx("style",{dangerouslySetInnerHTML:{__html:`
        /* Disable pointer events on Unity elements when modal is open */
        body.unity-input-disabled #unity-container,
        body.unity-input-disabled #unity-canvas {
          pointer-events: none !important;
        }
        
        /* Make sure the modal is above Unity */
        .chakra-modal__overlay {
          z-index: 1001 !important;
          pointer-events: auto !important;
        }
        
        .chakra-modal__content {
          z-index: 1002 !important;
          pointer-events: auto !important;
        }
        
        /* Make sure the iframe is visible and interactive */
        .video-iframe {
          z-index: 1003 !important;
          pointer-events: auto !important;
        }
        
        /* Make sure the close button is accessible */
        .chakra-modal__close-btn {
          z-index: 1004 !important;
        }
        
        /* Ensure the iframe container allows clicks */
        .iframe-container {
          pointer-events: auto !important;
        }
        
        /* Remove the full-screen blocker */
      `}}),sWe=({videoUrl:n,videoTitle:t,mediaScreenId:i,isOpen:a,onClose:l})=>{const{fullscreenRef:d}=Ld();return d1(a,`video-modal-${i}`),L.useEffect(()=>{if(a){const p=b=>{b.target.classList&&b.target.classList.contains("chakra-modal__overlay")&&(b.stopPropagation(),b.preventDefault())};document.addEventListener("mousemove",p,!0),document.addEventListener("mousedown",p,!0),document.addEventListener("mouseup",p,!0),document.addEventListener("click",p,!0),document.addEventListener("wheel",p,!0);const E=document.getElementById("unity-canvas"),v=document.getElementById("unity-container");if(E&&(E.style.pointerEvents="none"),v&&(v.style.pointerEvents="none"),document.body.classList.add("unity-input-disabled"),window.unityInstance)try{window.unityInstance.SendMessage("WebGLInputManager","Disable"),window.unityInstance.SendMessage("CameraController","DisableInput","VideoModal")}catch(b){console.error("Error disabling Unity input:",b)}return()=>{if(document.removeEventListener("mousemove",p,!0),document.removeEventListener("mousedown",p,!0),document.removeEventListener("mouseup",p,!0),document.removeEventListener("click",p,!0),document.removeEventListener("wheel",p,!0),E&&(E.style.pointerEvents="auto"),v&&(v.style.pointerEvents="auto"),document.body.classList.remove("unity-input-disabled"),window.unityInstance)try{window.unityInstance.SendMessage("WebGLInputManager","Enable"),window.unityInstance.SendMessage("CameraController","EnableInput","VideoModal")}catch(b){console.error("Error re-enabling Unity input:",b)}}}},[a]),C.jsxs(C.Fragment,{children:[C.jsx(oWe,{}),C.jsxs(xa,{isOpen:a,onClose:l,size:"xl",isCentered:!0,portalProps:{containerRef:d},closeOnOverlayClick:!0,closeOnEsc:!0,id:`video-modal-${i}`,children:[C.jsx(Va,{bg:"rgba(0, 0, 0, 0.8)",onClick:p=>{p.target===p.currentTarget&&(l(),p.stopPropagation(),p.preventDefault())},onMouseMove:p=>{p.target===p.currentTarget&&(p.stopPropagation(),p.preventDefault())},onMouseDown:p=>{p.target===p.currentTarget&&(p.stopPropagation(),p.preventDefault())},onMouseUp:p=>{p.target===p.currentTarget&&(p.stopPropagation(),p.preventDefault())},onWheel:p=>{p.target===p.currentTarget&&(p.stopPropagation(),p.preventDefault())},style:{pointerEvents:"auto"}}),C.jsxs(Ma,{bg:"gray.900",color:"white",borderRadius:"lg",overflow:"hidden",maxWidth:"80vw",maxHeight:"80vh",className:"video-modal-content",children:[C.jsx(cc,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",zIndex:"10004",_hover:{bg:"gray.600"},position:"absolute",top:"10px",right:"10px"}),C.jsx(Ua,{p:0,width:"100%",children:n?C.jsx(Rt,{className:"iframe-container",style:GJ.iframeContainer,children:C.jsx("iframe",{className:"video-iframe",src:n,style:GJ.iframe,allow:"autoplay; fullscreen",allowFullScreen:!0,title:t||"Video Player"})}):C.jsxs(Ai,{direction:"column",align:"center",justify:"center",h:"400px",children:[C.jsx(Lp,{size:"xl",mb:4}),C.jsx(ht,{children:"Unable to load video"}),C.jsx(ht,{fontSize:"sm",color:"gray.400",mt:2,children:"No video URL provided"})]})})]})]})]})},Lo=(...n)=>{},aWe=()=>{const{isOpen:n,onOpen:t,onClose:i}=Cp(),[a,l]=L.useState(null),[d,p]=L.useState("image"),E=L.useRef(null);d1(n,"image-viewer-modal");const v=L.useCallback(A=>{A.stopPropagation()},[]);return L.useEffect(()=>{if(n&&E.current){const A=E.current;A.addEventListener("mousemove",v),A.addEventListener("mousedown",v),A.addEventListener("mouseup",v),A.addEventListener("wheel",v);const N=document.getElementById("unity-canvas");return N&&(N.style.pointerEvents="none"),()=>{A.removeEventListener("mousemove",v),A.removeEventListener("mousedown",v),A.removeEventListener("mouseup",v),A.removeEventListener("wheel",v),N&&(N.style.pointerEvents="auto")}}},[n,v]),{isOpen:n,currentImageUrl:a,currentMediaType:d,openImageViewer:(A,N="image")=>{console.log(`[DEBUG] Opening image viewer with URL: ${A} and original media type: ${N}`);const F=typeof A=="string"&&(A.match(/\.(jpeg|jpg|gif|png|webp)($|\?)/i)||A.includes("firebasestorage")&&!A.includes("video")),j=F?"image":N;console.log(`[DEBUG] Detected URL as ${F?"image":"non-image"}, using media type: ${j}`),l(A),p(j),t()},closeImageViewer:()=>{i(),setTimeout(()=>{l(null),p("image")},300)},modalContentRef:E,preventPropagation:v}},cWe=()=>C.jsx("style",{dangerouslySetInnerHTML:{__html:`
        body.unity-input-disabled #unity-container,
        body.unity-input-disabled #unity-canvas {
          pointer-events: none !important;
        }
        
        .image-viewer-modal-content {
          pointer-events: auto !important;
        }
        
        .chakra-modal__overlay {
          pointer-events: auto !important;
        }
      `}}),uU=n=>{if(!n)return null;try{if(n.includes("firebasestorage.googleapis.com")){const t=new URL(n),i=t.searchParams.get("alt"),a=t.searchParams.get("token");return t.search="",i&&t.searchParams.set("alt",i),a&&t.searchParams.set("token",a),Lo(`Cleaned Firebase URL from ${n} to ${t.toString()}`),t.toString()}return n}catch(t){return console.error("Error cleaning Firebase URL:",t),n}},lWe=()=>{const{spaceID:n}=el(),[t,i]=L.useState(!1),[a,l]=L.useState([]),[d,p]=L.useState(null),{isOpen:E,onOpen:v,onClose:b}=Cp(),[w,A]=L.useState({}),[N,F]=L.useState(0);L.useRef(null);const j=kg(),{fullscreenRef:B}=Ld(),H=Vp(),[ee,K]=L.useState(!1),{isOpen:te,currentImageUrl:le,currentMediaType:oe,openImageViewer:ge,closeImageViewer:Z,modalContentRef:Q,preventPropagation:ne}=aWe(),[se,fe,he,ue,Me]=rWe(t),{isOpen:He,onOpen:rt,onClose:we}=Cp();iWe(),Foe(),L.useEffect(()=>{if(window.isPlayerInstantiated){K(!0);return}const Se=()=>{K(!0)};return window.addEventListener("PlayerInstantiated",Se),()=>{window.removeEventListener("PlayerInstantiated",Se)}},[]);const Ce=L.useCallback(Se=>{if(Array.isArray(a)&&a.length>0){const Ae=a.find(Ue=>Ue.mediaScreenId===Se);if(Ae){const Ue=Ae.imageUrl,ze=Ae.videoUrl;return{screen:Ae,imageUrl:Ue,videoUrl:ze,mediaType:Ae.mediaType||"image",displayAsVideo:Ae.displayAsVideo||!1}}}else console.warn("mediaScreens is not an array or is empty:",a);if(le){let Ae=null;return Array.isArray(a)&&(Ae=a.find(Ue=>Ue.mediaScreenId===Se)),{screen:Ae||{mediaScreenId:Se},imageUrl:le,videoUrl:null,mediaType:(Ae==null?void 0:Ae.mediaType)||"image",displayAsVideo:(Ae==null?void 0:Ae.displayAsVideo)||!1}}return n&&Se&&Ep(n,Se).then(Ae=>{Ae&&l(Ue=>Array.isArray(Ue)&&Ue.some(et=>et.mediaScreenId===Se)?Ue.map(et=>et.mediaScreenId===Se?{...et,imageUrl:Ae.imageUrl,videoUrl:Ae.videoUrl,mediaType:Ae.mediaType||"image",displayAsVideo:Ae.displayAsVideo||!1,hasImage:!!Ae.imageUrl,source:"firestore-fetch",lastUpdated:new Date().toISOString()}:et):[...Array.isArray(Ue)?Ue:[],{mediaScreenId:Se,imageUrl:Ae.imageUrl,videoUrl:Ae.videoUrl,mediaType:Ae.mediaType||"image",displayAsVideo:Ae.displayAsVideo||!1,hasImage:!!Ae.imageUrl,source:"firestore-fetch",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}])}).catch(Ae=>{console.error(`Error fetching media screen data for ${Se}:`,Ae)}),console.warn("No screen data found for:",Se),null},[a,le,n,l]),ye=L.useCallback(Se=>{if(console.log(`[DEBUG] Processing click on screen: ${Se}, isEditMode: ${t}`),p(Se),t)console.log(`[DEBUG] Opening upload modal for screen: ${Se} in edit mode`),v();else{const Ae=Ce(Se);if(Ae){if(console.log(`[DEBUG] Screen data for ${Se}:`,Ae),Lo("Screen data details:",{mediaScreenId:Se,imageUrl:Ae.imageUrl,videoUrl:Ae.videoUrl,mediaType:Ae.mediaType,displayAsVideo:Ae.displayAsVideo}),He&&he===Se)return;if(Ae.displayAsVideo&&Ae.videoUrl)Lo(`Opening video player for: ${Ae.videoUrl}`),j("PlayMediaScreenVideo",{mediaScreenId:Se,videoUrl:Ae.videoUrl});else if(Ae.imageUrl){Lo(`Opening viewer modal with ${Ae.mediaType}: ${Ae.imageUrl}`);const ze=uU(Ae.imageUrl);ge(ze,Ae.mediaType||"image")}else n&&Ep(n,Se).then(ze=>{if(ze){if(ze.displayAsVideo&&ze.videoUrl)Lo(`Opening video player for: ${ze.videoUrl}`),j("PlayMediaScreenVideo",{mediaScreenId:Se,videoUrl:ze.videoUrl});else if(ze.imageUrl){Lo(`Opening viewer modal with image: ${ze.imageUrl}`);const et=uU(ze.imageUrl);ge(et,ze.mediaType||"image")}l(et=>Array.isArray(et)&&et.some(dt=>dt.mediaScreenId===Se)?et.map(dt=>dt.mediaScreenId===Se?{...dt,...ze,mediaScreenId:Se,source:"firestore-click",lastUpdated:new Date().toISOString()}:dt):[...Array.isArray(et)?et:[],{...ze,mediaScreenId:Se,source:"firestore-click",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}])}}).catch(ze=>{console.error(`Error fetching media screen data for ${Se}:`,ze)})}else n&&Ep(n,Se).then(Ue=>{if(Ue){if(Ue.displayAsVideo&&Ue.videoUrl)Lo(`Opening video player for: ${Ue.videoUrl}`),j("PlayMediaScreenVideo",{mediaScreenId:Se,videoUrl:Ue.videoUrl});else if(Ue.imageUrl){Lo(`Opening viewer modal with image: ${Ue.imageUrl}`);const ze=uU(Ue.imageUrl);ge(ze,Ue.mediaType||"image")}l(ze=>Array.isArray(ze)&&ze.some(nt=>nt.mediaScreenId===Se)?ze.map(nt=>nt.mediaScreenId===Se?{...nt,...Ue,mediaScreenId:Se,source:"firestore-click",lastUpdated:new Date().toISOString()}:nt):[...Array.isArray(ze)?ze:[],{...Ue,mediaScreenId:Se,source:"firestore-click",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}])}}).catch(Ue=>{console.error(`Error fetching media screen data for ${Se}:`,Ue)})}},[t,v,Ce,He,he,j,ge,n]);L.useEffect(()=>{if(!ee)return;const Se=async()=>{if(n)try{const Ue=await F4(n),ze={};Ue.forEach(et=>{et.id&&et.imageUrl&&(ze[et.id]=et.imageUrl)}),l(et=>et.map(nt=>{const dt=!!ze[nt.mediaScreenId],Xe=ze[nt.mediaScreenId],It=nt.mediaType||"image";return{...nt,hasImage:dt,imageUrl:Xe,mediaType:It}}))}catch(Ue){console.error("Error fetching media screen images:",Ue)}};Se();let Ae=null;return t&&(Ae=setInterval(Se,5e3)),()=>{Ae&&clearInterval(Ae)}},[n,t,N,ee]);const Ne=Se=>{l(Ae=>Ae.map(Ue=>{if(Ue.mediaScreenId===Se.mediaScreenId){if(Se.type==="upload")return{...Ue,hasImage:!0,imageUrl:Se.imageUrl,mediaType:Se.mediaType||"image"};if(Se.type==="delete")return{...Ue,hasImage:!1,imageUrl:null,mediaType:null}}return Ue})),Se.type==="delete"?(setTimeout(()=>{l(Ae=>Ae.filter(Ue=>Ue.mediaScreenId!==Se.mediaScreenId))},100),setTimeout(()=>{l(Ae=>Ae.filter(Ue=>Ue.mediaScreenId!==Se.mediaScreenId))},1500)):setTimeout(()=>{l(Ae=>Ae.some(ze=>ze.mediaScreenId===Se.mediaScreenId)?Ae.map(ze=>ze.mediaScreenId===Se.mediaScreenId?{...ze,imageUrl:Se.imageUrl,hasImage:!0,mediaType:Se.mediaType||"image"}:ze):[...Ae,{mediaScreenId:Se.mediaScreenId,imageUrl:Se.imageUrl,hasImage:!0,mediaType:Se.mediaType||"image",source:"delayed-update",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}])},1e3)};L.useEffect(()=>{const Se=Ae=>{const Ue=Ae.detail.enabled;i(Ue),Ue?j("SetMediaScreenEditMode",{enabled:!0,showUploadIcon:!0}):j("SetMediaScreenEditMode",{enabled:!1,showUploadIcon:!1})};return window.addEventListener("editModeChanged",Se),()=>{window.removeEventListener("editModeChanged",Se)}},[j]),L.useEffect(()=>(window.JsSendMediaScreenClick=function(Se){console.log("Unity: MediaScreenClick received with data:",Se);try{const Ae=JSON.parse(Se),Ue=new CustomEvent("MediaScreenClick",{detail:JSON.stringify(Ae)});window.dispatchEvent(Ue)}catch(Ae){console.error("Error processing MediaScreenClick data:",Ae)}},window.handleMediaScreenClick=function(Se){console.log("Direct call to handleMediaScreenClick with ID:",Se),ye(Se)},window.TestJavaScriptFromUnity=function(Se){console.log("Unity called TestJavaScriptFromUnity with:",Se),alert("Unity called JavaScript: "+Se)},()=>{delete window.JsSendMediaScreenClick,delete window.handleMediaScreenClick,delete window.TestJavaScriptFromUnity}),[ye]),L.useEffect(()=>{const Se=ze=>{try{const et=JSON.parse(ze.detail);Te.log(`MediaScreen registered: ${et.mediaScreenId}`),Lo("MediaScreen registered from Unity:",et),l(dt=>dt.some(It=>It.mediaScreenId===et.mediaScreenId)?dt.map(It=>It.mediaScreenId===et.mediaScreenId?{...It,...et,source:"event",lastUpdated:new Date().toISOString()}:It):[...dt,{...et,source:"event",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}]),t&&j("SetMediaScreenEditMode",{mediaScreenId:et.mediaScreenId,enabled:!0,showUploadIcon:!0});const nt=et.mediaScreenId;nt&&Ep(n,nt).then(dt=>{dt&&(Lo(`Media screen data for ${nt}:`,dt),dt.displayAsVideo&&dt.videoUrl&&(Lo(`Media screen ${nt} should display as video, sending null imageUrl`),j("SetMediaScreenImage",{mediaScreenId:nt,imageUrl:null,displayAsVideo:!0})))}).catch(dt=>{console.error(`Error fetching media screen data for ${nt}:`,dt)})}catch(et){console.error("Error handling MediaScreen registration:",et)}},Ae=ze=>{try{Lo("MediaScreenClick event received:",ze);let et;if(typeof ze=="string")et=ze,Lo("MediaScreenClick: Direct call with ID:",et);else{Lo("MediaScreenClick: Event from Unity:",ze),Lo("MediaScreenClick: Event detail:",ze.detail);try{et=JSON.parse(ze.detail).mediaScreenId,Lo("MediaScreenClick: Parsed mediaScreenId:",et)}catch(nt){if(console.error("MediaScreenClick: Error parsing event detail:",nt),ze.detail&&ze.detail.mediaScreenId)et=ze.detail.mediaScreenId,Lo("MediaScreenClick: Using direct mediaScreenId from detail:",et);else throw new Error("Could not extract mediaScreenId from event")}}Te.log(`MediaScreen clicked: ${et}`),Lo("MediaScreen clicked:",et),ye(et)}catch(et){console.error("Error handling MediaScreen click:",et)}},Ue=ze=>{if(ze.detail&&ze.detail.eventName==="RegisterMediaScreen")Se({detail:ze.detail.eventData});else if(ze.detail&&ze.detail.eventName==="MediaScreenClick")Ae({detail:ze.detail.eventData});else if(ze.detail&&ze.detail.eventName==="SetMediaScreenImage")try{const et=JSON.parse(ze.detail.eventData);et.mediaScreenId&&(Lo("SetMediaScreenImage event received:",et),l(nt=>Array.isArray(nt)&&nt.some(Xe=>Xe.mediaScreenId===et.mediaScreenId)?nt.map(Xe=>Xe.mediaScreenId===et.mediaScreenId?{...Xe,imageUrl:et.imageUrl,hasImage:!!et.imageUrl,displayAsVideo:et.displayAsVideo||!1,lastUpdated:new Date().toISOString()}:Xe):[...Array.isArray(nt)?nt:[],{mediaScreenId:et.mediaScreenId,imageUrl:et.imageUrl,hasImage:!!et.imageUrl,displayAsVideo:et.displayAsVideo||!1,source:"set-media-screen-image",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}]))}catch(et){console.error("Error handling SetMediaScreenImage event:",et)}};return window.addEventListener("RegisterMediaScreen",Se),window.addEventListener("MediaScreenClick",Ae),window.addEventListener("reactUnityEvent",Ue),()=>{window.removeEventListener("RegisterMediaScreen",Se),window.removeEventListener("MediaScreenClick",Ae),window.removeEventListener("reactUnityEvent",Ue)}},[t,v,j,a,te,He,ge,ye,n]),L.useEffect(()=>{const Se=Ae=>{try{Lo("Direct MediaScreenClick event received:",Ae);let Ue;if(Ae.detail)try{Ue=JSON.parse(Ae.detail).mediaScreenId}catch(ze){console.error("Error parsing MediaScreenClick event detail:",ze);return}if(!Ue){console.error("No mediaScreenId found in MediaScreenClick event");return}Lo(`Direct handler: Processing click for media screen ${Ue}`),ye(Ue)}catch(Ue){console.error("Error in direct MediaScreenClick handler:",Ue)}};return window.addEventListener("MediaScreenClick",Se),()=>{window.removeEventListener("MediaScreenClick",Se)}},[ye]),L.useEffect(()=>{se&&rt()},[se,rt]);const be=()=>{ue(),we()};return L.useEffect(()=>{const Ae=H("RegisterMediaScreen",Ue=>{try{if(Te.log("Direct RegisterMediaScreen event received with data:",Ue),!Ue||!Ue.mediaScreenId){Te.warn("RegisterMediaScreen event received with invalid data");return}const ze=Ue.mediaScreenId;Te.log(`Media screen registered directly: ${ze}`),l(et=>et.some(dt=>dt.mediaScreenId===ze)?et.map(dt=>dt.mediaScreenId===ze?{...dt,...Ue,source:"direct-event",lastUpdated:new Date().toISOString()}:dt):[...et,{...Ue,source:"direct-event",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}]),t&&j("SetMediaScreenEditMode",{mediaScreenId:ze,enabled:!0,showUploadIcon:!0})}catch(ze){console.error("Error handling direct RegisterMediaScreen event:",ze)}});return()=>{Ae()}},[H,t,j]),L.useEffect(()=>{const Ae=H("MediaScreenClick",Ue=>{try{if(Te.log("Direct MediaScreenClick event received with data:",Ue),!Ue||!Ue.mediaScreenId){Te.warn("MediaScreenClick event received with invalid data");return}const ze=Ue.mediaScreenId;Te.log(`Media screen clicked directly: ${ze}`),ye(ze)}catch(ze){console.error("Error handling direct MediaScreenClick event:",ze)}});return()=>{Ae()}},[H,ye]),L.useEffect(()=>{t&&he&&(console.log(`[DEBUG] Detected currentVideoMediaScreenId change in edit mode: ${he}`),p(he),v(),ue())},[t,he,v,ue]),C.jsxs(C.Fragment,{children:[C.jsx(nWe,{isOpen:E,onClose:b,mediaScreenId:d,onImageChange:Ne}),C.jsx(cWe,{}),C.jsx(Ml,{containerRef:B,children:C.jsxs(xa,{isOpen:te,onClose:Z,size:"lg",isCentered:!0,portalProps:{containerRef:B},id:"image-viewer-modal",blockScrollOnMount:!0,children:[C.jsx(Va,{bg:"rgba(0, 0, 0, 0.8)",onClick:ne,onMouseMove:ne,onMouseDown:ne,onMouseUp:ne,onWheel:ne}),C.jsxs(Ma,{ref:Q,bg:"gray.900",color:"white",borderRadius:"lg",overflow:"hidden",maxWidth:"80vw",maxHeight:"80vh",display:"flex",justifyContent:"center",alignItems:"center",position:"relative",zIndex:"10000",className:"image-viewer-modal-content",onClick:ne,onMouseMove:ne,onMouseDown:ne,onMouseUp:ne,onWheel:ne,children:[C.jsx(cc,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",zIndex:"modal",_hover:{bg:"gray.600"},_focus:{boxShadow:"none"},position:"absolute",top:"10px",right:"10px"}),C.jsx(Ua,{p:0,width:"100%",onClick:ne,onMouseMove:ne,onMouseDown:ne,onMouseUp:ne,onWheel:ne,children:le?C.jsx(Rt,{position:"relative",width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",onClick:ne,onMouseMove:ne,onMouseDown:ne,onMouseUp:ne,onWheel:ne,children:oe==="image"?C.jsx(Bh,{src:le,maxWidth:"100%",maxHeight:"80vh",objectFit:"contain",alt:"Media Screen Image",onLoad:()=>console.log("Image loaded successfully:",le),onError:Se=>console.error("Error loading image:",Se,le),onClick:ne}):C.jsxs(Rt,{width:"100%",textAlign:"center",onClick:ne,onMouseMove:ne,onMouseDown:ne,onMouseUp:ne,onWheel:ne,children:[C.jsx(ht,{mb:4,fontSize:"lg",children:"Video URL:"}),C.jsx(ht,{p:3,bg:"gray.800",borderRadius:"md",fontSize:"sm",wordBreak:"break-all",maxWidth:"100%",children:le}),C.jsx(ht,{mt:4,fontSize:"sm",color:"gray.400",children:"Video playback will be implemented in a future update"})]})}):C.jsx(Ai,{direction:"column",align:"center",justify:"center",h:"400px",onClick:ne,onMouseMove:ne,onMouseDown:ne,onMouseUp:ne,onWheel:ne,children:C.jsx(ht,{children:"No image available"})})})]})]})}),C.jsx(sWe,{videoUrl:se,videoTitle:fe,mediaScreenId:he,isOpen:He,onClose:be})]})},Qoe=({backgroundUrl:n=null,containerRef:t})=>{const[i,a]=L.useState(!1),[l,d]=L.useState(n),p=L.useRef(null),E=L.useRef(null);return L.useEffect(()=>{const v=b=>{const{backgroundUrl:w}=b.detail;d(w),p.current&&(w?(p.current.style.backgroundImage=`url('${w}')`,p.current.style.display="block",E.current&&(E.current.style.display="block")):(p.current.style.display="none",E.current&&(E.current.style.display="none")))};return window.addEventListener("SpaceBackgroundUpdated",v),()=>{window.removeEventListener("SpaceBackgroundUpdated",v)}},[]),L.useEffect(()=>{d(n),p.current&&n!==l&&(p.current.style.backgroundImage=`url('${n}')`)},[n]),L.useEffect(()=>{if(!t||!t.current)return;const v=document.createElement("div");p.current=v,Object.assign(v.style,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",backgroundImage:l?`url('${l}')`:"none",backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",zIndex:"20",transition:"opacity 1.5s ease-in-out",pointerEvents:"none",display:l?"block":"none"});const b=document.createElement("div");E.current=b,Object.assign(b.style,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",backdropFilter:"blur(5px)",backgroundColor:"rgba(255, 255, 255, 0.08)",zIndex:"21",transition:"opacity 1.5s ease-in-out",pointerEvents:"none",display:l?"block":"none"}),t.current.appendChild(v),t.current.appendChild(b);const w=()=>{console.log("PersistentBackground: Player instantiated event received"),a(!0),v.style.opacity="0",b.style.opacity="0",setTimeout(()=>{t.current&&t.current.contains(v)&&t.current.removeChild(v),t.current&&t.current.contains(b)&&t.current.removeChild(b)},1500)};if(window.isPlayerInstantiated)console.log("PersistentBackground: Player was already instantiated"),w();else{Od.subscribe(Pd.playerInstantiated,w);const A=()=>w();window.addEventListener("PlayerInstantiated",A);const N=setTimeout(()=>{console.log("PersistentBackground: Forcing background removal after timeout"),w()},3e4);return()=>{Od.unsubscribe(Pd.playerInstantiated,w),window.removeEventListener("PlayerInstantiated",A),clearTimeout(N),t.current&&t.current.contains(v)&&t.current.removeChild(v),t.current&&t.current.contains(b)&&t.current.removeChild(b)}}},[l,t]),null};Qoe.propTypes={backgroundUrl:gr.string,containerRef:gr.shape({current:gr.instanceOf(Element)})};const Zoe=({containerRef:n})=>{const{spaceID:t}=el(),[i,a]=L.useState(!1),[l,d]=L.useState(!1),[p,E]=L.useState(0),[v,b]=L.useState("Initialising World"),[w,A]=L.useState(null),N=L.useRef(null),F=L.useRef(null),j=L.useRef(null),B=L.useRef(null);L.useEffect(()=>(Te.log("PersistentLoader: Component mounted with spaceID:",t),Te.log("PersistentLoader: Container ref:",n),()=>{Te.log("PersistentLoader: Component unmounting")}),[]);const{error:H}=el(),[ee,K]=L.useState(!1);return L.useEffect(()=>{H&&(Te.error("PersistentLoader: Unity error detected:",H),K(!0),setTimeout(()=>{if(N.current){const te=N.current.querySelector("div:first-child");te&&(te.textContent="Reconnecting...")}},3e3))},[H]),L.useEffect(()=>{(async()=>{if(t){Te.log(`PersistentLoader: Fetching logo for space ${t}`);try{const le=await fg(t);le&&le.logoUrl?(Te.log(`PersistentLoader: Found logo URL: ${le.logoUrl}`),A(le.logoUrl)):Te.log(`PersistentLoader: No logo URL found for space ${t}`)}catch(le){Te.error("PersistentLoader: Error fetching space logo:",le)}}else Te.warn("PersistentLoader: No spaceID provided, cannot fetch logo")})()},[t]),L.useEffect(()=>{const te=le=>{const{logoUrl:oe}=le.detail;Te.log(`PersistentLoader: Logo update event received with URL: ${oe}`),A(oe),F.current?oe?(Te.log("PersistentLoader: Updating logo element with new URL"),F.current.src=oe,j.current.style.display="flex"):(Te.log("PersistentLoader: Hiding logo element (no URL)"),j.current.style.display="none"):Te.warn("PersistentLoader: Logo ref is null during update")};return Te.log("PersistentLoader: Adding SpaceLogoUpdated event listener"),window.addEventListener("SpaceLogoUpdated",te),()=>{Te.log("PersistentLoader: Removing SpaceLogoUpdated event listener"),window.removeEventListener("SpaceLogoUpdated",te)}},[]),L.useEffect(()=>{if(!n||!n.current){Te.error("PersistentLoader: Container ref is null or has no current property");return}Te.log("PersistentLoader: Creating loader elements");const te=document.createElement("div");if(N.current=te,Object.assign(te.style,{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, calc(-50% + 50px))",width:"300px",padding:"16px",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",zIndex:"50",transition:"opacity 1.5s ease-in-out",pointerEvents:"none",color:"white",fontFamily:"Arial, sans-serif",backgroundColor:"rgba(0, 0, 0, 0.8)",borderRadius:"8px",boxShadow:"0 0 20px rgba(0, 0, 0, 0.7)"}),w){Te.log(`PersistentLoader: Creating logo element with URL: ${w}`);const He=document.createElement("div");j.current=He,Object.assign(He.style,{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, calc(-50% - 40px))",display:"flex",justifyContent:"center",alignItems:"center",zIndex:"50",transition:"opacity 1.5s ease-in-out",pointerEvents:"none",padding:"8px",width:"280px"});const rt=document.createElement("img");F.current=rt,rt.src=w,rt.alt="Space Logo",rt.style.maxHeight="100px",rt.style.maxWidth="100%",rt.style.objectFit="contain",rt.style.filter="drop-shadow(0 0 8px rgba(0, 0, 0, 0.7))",He.appendChild(rt),n.current.appendChild(He),Te.log("PersistentLoader: Logo container added to main container")}else Te.log("PersistentLoader: No logo URL available, skipping logo creation");const le=document.createElement("style");le.textContent=`
      @keyframes progress-pulse {
        0% { box-shadow: 0 0 5px rgba(255, 255, 255, 0.5); }
        50% { box-shadow: 0 0 15px rgba(255, 255, 255, 0.8); }
        100% { box-shadow: 0 0 5px rgba(255, 255, 255, 0.5); }
      }
      
      @keyframes progress-glow {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
      }
    `,document.head.appendChild(le),Te.log("PersistentLoader: Animation styles added to document head");const oe=document.createElement("div");oe.style.fontSize="16px",oe.style.fontWeight="bold",oe.style.textAlign="center",oe.style.marginBottom="16px",oe.style.color="#ffffff",oe.textContent="Initialising World";const ge=document.createElement("div");ge.style.width="100%",ge.style.height="12px",ge.style.backgroundColor="rgba(255, 255, 255, 0.2)",ge.style.borderRadius="6px",ge.style.overflow="hidden",ge.style.position="relative",ge.style.boxShadow="0 0 10px rgba(0, 0, 0, 0.5) inset";const Z=document.createElement("div");Z.style.height="100%",Z.style.width="0%",Z.style.background="linear-gradient(90deg, #4facfe 0%, #00f2fe 100%)",Z.style.backgroundSize="200% 200%",Z.style.animation="progress-glow 2s ease infinite",Z.style.transition="width 0.5s ease-out",Z.style.borderRadius="6px",Z.style.boxShadow="0 0 10px rgba(255, 255, 255, 0.5)",ge.appendChild(Z);const Q=document.createElement("div");Q.style.marginTop="8px",Q.style.fontSize="14px",Q.style.fontWeight="bold",Q.style.color="#ffffff",Q.textContent="0%",te.appendChild(oe),te.appendChild(ge),te.appendChild(Q),n.current.appendChild(te),Te.log("PersistentLoader: Loader element added to container");const ne=He=>{E(He),Z.style.width=`${Math.round(He*100)}%`,Q.textContent=`${Math.round(He*100)}%`,Te.log(`PersistentLoader: Progress updated to ${Math.round(He*100)}%`)},se=He=>{b(He),oe.textContent=He,Te.log(`PersistentLoader: Loading stage updated to "${He}"`)},fe=[{stage:"Initialising World",progress:.33},{stage:"Loading Assets",progress:.66},{stage:"Loading User",progress:1}];ee&&(fe[0].stage="Connecting to Space",fe[1].stage="Reconnecting...",fe[2].stage="Please Wait"),se(fe[0].stage),ne(.05);const he=He=>{const rt=He.detail.progress;Te.log(`PersistentLoader: Progress event received with value: ${rt}`),ne(rt),rt<.33?se(fe[0].stage):rt<.66?se(fe[1].stage):se(fe[2].stage)},ue=()=>{Te.log("PersistentLoader: First scene loaded event received"),a(!0),se(fe[1].stage),ne(.66)},Me=()=>{if(Te.log("PersistentLoader: Player instantiated event received"),B.current&&(clearInterval(B.current),Te.log("PersistentLoader: Progress interval cleared")),d(!0),se(fe[2].stage),ne(1),ee){Te.log("PersistentLoader: Keeping loader visible due to Unity error");return}te.style.opacity="0",j.current&&(j.current.style.opacity="0"),setTimeout(()=>{n.current&&n.current.contains(te)?(n.current.removeChild(te),Te.log("PersistentLoader: Loader element removed after fade")):Te.warn("PersistentLoader: Could not remove loader element (not found in container)"),j.current&&n.current&&n.current.contains(j.current)?(n.current.removeChild(j.current),Te.log("PersistentLoader: Logo container removed after fade")):j.current&&Te.warn("PersistentLoader: Could not remove logo container (not found in container)")},1500)};if(window.isPlayerInstantiated)Te.log("PersistentLoader: Player was already instantiated"),Me();else{Te.log("PersistentLoader: Subscribing to playerInstantiated event"),Od.subscribe(Pd.playerInstantiated,Me);const He=()=>Me();Te.log("PersistentLoader: Adding PlayerInstantiated event listener"),window.addEventListener("PlayerInstantiated",He),Te.log("PersistentLoader: Adding firstSceneLoaded event listener"),Od.subscribe(Pd.firstSceneLoaded,ue),Te.log("PersistentLoader: Adding UnityProgress event listener"),window.addEventListener("UnityProgress",he),B.current=setInterval(()=>{l||E(we=>{const Ce=Math.min(we+.01,.95);return Z.style.width=`${Math.round(Ce*100)}%`,Q.textContent=`${Math.round(Ce*100)}%`,Ce<.33&&v!==fe[0].stage?se(fe[0].stage):Ce>=.33&&Ce<.66&&v!==fe[1].stage?se(fe[1].stage):Ce>=.66&&v!==fe[2].stage&&se(fe[2].stage),Ce})},500);const rt=setTimeout(()=>{Te.log("PersistentLoader: Forcing loader removal after timeout"),Me()},6e4);return()=>{Te.log("PersistentLoader: Cleaning up event listeners"),Od.unsubscribe(Pd.playerInstantiated,Me),window.removeEventListener("PlayerInstantiated",He),Od.unsubscribe(Pd.firstSceneLoaded,ue),window.removeEventListener("UnityProgress",he),clearInterval(B.current),clearTimeout(rt),n.current&&n.current.contains(te)&&(n.current.removeChild(te),Te.log("PersistentLoader: Loader element removed during cleanup")),j.current&&n.current&&n.current.contains(j.current)&&(n.current.removeChild(j.current),Te.log("PersistentLoader: Logo container removed during cleanup"))}}},[w,n]),null};Zoe.propTypes={containerRef:gr.shape({current:gr.instanceOf(Element)})};const uWe="a2a7f4eb05284449b1063eb71d8301dc",dU=()=>document.querySelector("canvas")||document.getElementById("unity-canvas"),j4=L.forwardRef(({settings:n},t)=>{const{unityProvider:i,isLoaded:a,error:l}=el(),d=e6e();n6e();const p=kg(),E=c6e(d),{user:v}=L.useContext(ja),[b,w]=L.useState(!1),[A,N]=L.useState(window.devicePixelRatio),[F,j]=i6e();Voe().find(Ne=>Ne.isLocalPlayer);const[H,ee]=L.useState(!0),[K,te]=L.useState(!0),[le,oe]=L.useState(!1),[ge,Z]=L.useState(!1),[Q,ne]=L.useState(!1);L.useEffect(()=>{Q?(console.log("WebGLRenderer: Modal opened, disabling Unity keyboard capture"),Ad(!0)):(console.log("WebGLRenderer: Modal closed, enabling Unity keyboard capture"),a&&!ge&&Ad(!1).then(()=>{setTimeout(()=>{cE(!0)},100)}))},[Q,a,ge]);const se=n.spaceID||"default",fe=L.useMemo(()=>{const Se=new URLSearchParams(window.location.search).get("sessionId")||se;return console.log("WebGLRenderer: Using session ID:",Se),Se},[se]),[he,ue]=L.useState(null);L.useEffect(()=>{v!=null&&v.uid&&rf(v.uid).then(Ne=>{ue(Ne),console.log("WebGLRenderer: User profile loaded:",(Ne==null?void 0:Ne.Nickname)||"Unknown")}).catch(Ne=>{console.error("Error fetching user profile:",Ne)})},[v==null?void 0:v.uid]),L.useEffect(()=>{if(l||!v){Te.log("WebGLRenderer: User not logged in or Unity error, showing sign-in modal");const Ne=setTimeout(()=>{Z(!0),ne(!0)},1e3);return()=>clearTimeout(Ne)}else Z(!1)},[l,v]),L.useEffect(()=>{console.log("WebGLRenderer: Setting up player instantiation listener");const Ne=()=>{console.log("WebGLRenderer: Player instantiated event received"),te(!0),window.dispatchEvent(new CustomEvent("PlayerInstantiated")),window.isPlayerInstantiated=!0};window.isPlayerInstantiated&&(console.log("WebGLRenderer: Player was already instantiated from previous mount"),te(!0)),Od.subscribe(Pd.playerInstantiated,Ne);const be=setTimeout(()=>{K||(console.log("WebGLRenderer: Forcing player instantiation after timeout"),te(!0),window.isPlayerInstantiated=!0,window.dispatchEvent(new CustomEvent("PlayerInstantiated")))},5e3);return()=>{Od.unsubscribe(Pd.playerInstantiated,Ne),clearTimeout(be)}},[K]),L.useEffect(()=>{const Ne=()=>{console.log("WebGLRenderer: Modal opened"),ne(!0)},be=()=>{console.log("WebGLRenderer: Modal closed"),ne(!1)};return window.addEventListener("modal-opened",Ne),window.addEventListener("modal-closed",be),()=>{window.removeEventListener("modal-opened",Ne),window.removeEventListener("modal-closed",be)}},[]),L.useEffect(()=>{ne(F!==null)},[F]),L.useEffect(()=>{a||d?setTimeout(()=>{w(!0),Te.log("WebGLRenderer: Unity is ready to receive messages.")},5e3):Te.warn("WebGLRenderer: Unity is NOT ready yet.")},[a,d]),L.useEffect(()=>{a&&i&&setTimeout(()=>{if(window.unityInstance)try{console.log("WebGLRenderer: Disabling Unity keyboard capture on initialization"),window.unityInstance.SendMessage("WebGLInput","SetCaptureAllKeyboardInput",!1)}catch(Ne){console.error("WebGLRenderer: Error disabling Unity keyboard capture:",Ne)}},1e3)},[a,i]),L.useEffect(()=>{const Ne=document.getElementById("webgl-root");return Ne?(console.log("WebGLRenderer: Found webgl-root element, ensuring it is visible"),Ne.style.display="block",Ne.getAttribute("data-space-id")!==se&&(Ne.setAttribute("data-space-id",se),console.log(`WebGLRenderer: Set data-space-id attribute to ${se}`))):console.error("WebGLRenderer: Could not find webgl-root element"),()=>{}},[se]),L.useEffect(()=>{const Ne=()=>{const Ae=dU();Ae?(console.log("WebGLRenderer: Configuring Unity canvas for keyboard input"),Ae.tabIndex=1,Ae.style.outline="none",Ae.addEventListener("click",()=>{console.log("WebGLRenderer: Unity canvas clicked, enabling keyboard capture"),Q||cE(!0)}),console.log("WebGLRenderer: Unity canvas configured with tabIndex=1")):console.warn("WebGLRenderer: Could not find Unity canvas to configure")};Ne();const be=setTimeout(Ne,1e3),Se=()=>{console.log("WebGLRenderer: Received unityReady event, configuring canvas"),Ne()};return window.addEventListener("unityReady",Se),()=>{clearTimeout(be),window.removeEventListener("unityReady",Se)}},[a,Q]);const Me=L.useCallback(()=>{console.log("WebGLRenderer: Unity canvas clicked, enabling keyboard capture"),Q||cE(!0)},[Q]);L.useEffect(()=>{if(a&&i){const Ne=dU();if(Ne)return console.log("WebGLRenderer: Adding click handler to Unity canvas"),Ne.addEventListener("click",Me),()=>{Ne.removeEventListener("click",Me)}}},[a,i,Me]),L.useEffect(()=>{if(a&&i){console.log("WebGLRenderer: Setting up global click handler for focus management");const Ne=be=>{if(Q){console.log("WebGLRenderer: Modal is open, not refocusing Unity on click");return}if(be.target.tagName==="INPUT"||be.target.tagName==="TEXTAREA"||be.target.tagName==="SELECT"||be.target.tagName==="BUTTON"){console.log("WebGLRenderer: Clicked on form element, not refocusing Unity");return}if(be.target.closest(".chakra-modal__content")||be.target.closest('[role="dialog"]')||be.target.closest('[role="menu"]')||be.target.closest(".chakra-popover__content")||be.target.closest('[role="tooltip"]')){console.log("WebGLRenderer: Clicked inside modal/dialog content, not refocusing Unity");return}const Se=dU();if(Se&&(be.target===Se||Se.contains(be.target)))return;if(be.target.closest(".webgl-overlay")||be.target.closest(".game-ui")||be.target.closest(".player-list")||be.target.closest(".unity-ui-overlay")){console.log("WebGLRenderer: Clicked on UI overlay that should allow keyboard events"),setTimeout(()=>{Q||cE(!0)},50);return}console.log("WebGLRenderer: Clicked outside forms/modals/special UI, refocusing Unity canvas"),setTimeout(()=>{Se&&!Q&&((Se.tabIndex===void 0||Se.tabIndex<0)&&(Se.tabIndex=1),Se.focus(),cE(!0))},50)};return document.addEventListener("click",Ne,!0),()=>{document.removeEventListener("click",Ne,!0)}}},[a,i,Q]),L.useEffect(()=>{const Ne=be=>{Te.log("WebGLRenderer: Received 'sendUserToUnity' event"),p("FirebaseUserFromReact",be)};return Od.subscribe(Pd.sendUserToUnity,Ne),()=>Od.unsubscribe(Pd.sendUserToUnity,Ne)},[p]);const{setFullscreenRef:He,fullscreenRef:rt}=Ld();L.useEffect(()=>{He(t.current)},[t,He]);const we=()=>{ee(!H)},Ce=v&&n.enableVoiceChat;console.log("WebGLRenderer: Render with state:",{user:!!v,userId:v==null?void 0:v.uid,isPlayerInstantiated:K,showVoiceChat:Ce,sessionId:fe}),L.useEffect(()=>{const Ne=be=>{oe(be.detail.enabled)};return window.addEventListener("editModeChanged",Ne),()=>{window.removeEventListener("editModeChanged",Ne)}},[]),Foe(),r6e();const ye=L.useRef(null);return C.jsxs(Rt,{className:"webgl-renderer",children:[n.urlLoadingBackground&&C.jsx(Qoe,{backgroundUrl:n.urlLoadingBackground,containerRef:ye}),!ge&&C.jsx(Zoe,{containerRef:ye}),ge&&C.jsx(Rt,{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:"100",width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",children:C.jsx(f1,{mode:"button",label:"Sign In",initialIsOpen:!0,buttonProps:{size:"lg",colorScheme:"blue"}})}),C.jsx(mF,{containerRef:rt.current?rt:document.body,children:C.jsxs("div",{ref:t,style:{width:"100%",height:"100%",aspectRatio:"auto",position:"absolute"},children:[C.jsxs(Rt,{position:"absolute",zIndex:"10",top:4,right:4,display:"flex",alignItems:"center",gap:2,children:[n.showAuthButton&&C.jsx(u6e,{}),Ce&&C.jsxs(Yoe,{appId:uWe,channel:fe,uid:v==null?void 0:v.uid,enabled:!0,children:[C.jsx(B6e,{size:"md",defaultMuted:!0,joinOnClick:!0}),C.jsx(z6e,{userNickname:he==null?void 0:he.Nickname})]}),C.jsx(A6e,{}),C.jsx(Rt,{position:"relative",zIndex:"9999",children:C.jsx(tWe,{onTogglePlayerList:we,spaceID:se})})]}),C.jsxs(Rt,{ref:ye,position:"relative",overflow:"hidden",width:"100%",height:"100%",bgRepeat:"no-repeat",bgSize:"cover",bgPosition:"center",bgColor:"#666666",children:[C.jsx(Rt,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",backdropFilter:"blur(8px)",backgroundColor:"rgba(255, 255, 255, 0.1)",zIndex:"0"}),C.jsx(Rt,{...E,width:"100%",height:"100%",position:"absolute",zIndex:"1",children:i?C.jsx(Uoe.Unity,{unityProvider:i,style:{width:"100%",height:"100%"},devicePixelRatio:A,tabIndex:1}):C.jsx(Rt,{width:"100%",height:"100%"})}),C.jsx(Rt,{position:"absolute",zIndex:"6",width:"100%",height:"100%",style:{display:"none"},children:C.jsx(l6e,{})})]}),C.jsx(Rt,{...E,position:"absolute",zIndex:"2",top:4,left:4,display:"flex",alignItems:"flex-start",gap:3,height:"50px",children:n.showDisruptiveLogo&&C.jsx(Bh,{src:n.urlDisruptiveLogo,width:"100px",alt:"Disruptive Logo"})}),C.jsx(Rt,{...E,position:"absolute",zIndex:"2",bottom:4,left:4,display:"flex",alignItems:"flex-start",gap:3}),C.jsxs(Rt,{...E,position:"absolute",zIndex:"2",bottom:4,right:4,display:"flex",alignItems:"flex-start",gap:3,children:[n.showHelpButton&&C.jsx(d6e,{}),C.jsx(k6e,{})]}),C.jsx(N6e,{}),C.jsx(D6e,{isOpen:F!==null,onClose:()=>{console.log(" Closing nameplate modal"),j()},playerName:(F==null?void 0:F.playerName)||"Unknown Player",playerId:(F==null?void 0:F.playerId)||"Unknown ID"}),C.jsx(L6e,{isVisible:H,onToggleVisibility:ee,spaceID:se}),C.jsx(lWe,{})]})})]})});j4.displayName="WebGLRenderer";j4.propTypes={settings:gr.shape({urlLoadingBackground:gr.string,showAuthButton:gr.bool,showDisruptiveLogo:gr.bool,urlDisruptiveLogo:gr.string,showHelpButton:gr.bool,enableVoiceChat:gr.bool,spaceID:gr.string})};const B4=({spaceID:n,overrideSettings:t})=>{const i=L.useRef(null),[a,l]=L.useState(!0),[d,p]=L.useState({spaceID:n,loaderUrl:"",dataUrl:"",frameworkUrl:"",codeUrl:""}),[E,v]=L.useState({urlDisruptiveLogo:"gs://disruptive-metaverse.appspot.com/common/images/Disruptive-logo-white-p-500.png",urlLoadingBackground:"",showDisruptiveLogo:null,showAuthButton:null,showHelpButton:null,enableVoiceChat:!0,spaceID:n});return L.useEffect(()=>{(async()=>{try{const w=await fg(n);if(w){p(F=>({...F,spaceID:n,loaderUrl:w.loaderUrl,dataUrl:w.dataUrl,frameworkUrl:w.frameworkUrl,codeUrl:w.codeUrl}));const A=await lk(E.urlDisruptiveLogo);let N="";if(w.backgroundUrl)N=w.backgroundUrl;else if(w.backgroundGsUrl)try{N=await lk(w.backgroundGsUrl)}catch(F){Te.warn("WebGLLoader: Error fetching background from GS URL:",F)}else if(w.gsUrlLoadingBackground)try{N=await lk(w.gsUrlLoadingBackground)}catch(F){Te.warn("WebGLLoader: Error fetching background from legacy GS URL:",F)}v(F=>({...F,urlLoadingBackground:N,showAuthButton:w.showAuthButton!==void 0?w.showAuthButton:!0,showDisruptiveLogo:w.showDisruptiveLogo!==void 0?w.showDisruptiveLogo:!0,showHelpButton:w.showHelpButton!==void 0?w.showHelpButton:!0,enableVoiceChat:w.enableVoiceChat!==void 0?w.enableVoiceChat:!0,urlDisruptiveLogo:A,spaceID:n,...t||{}})),l(!1)}else Te.error(`WebGLLoader: No configuration found for spaceID: ${n}`)}catch(w){Te.error("WebGLLoader: Error fetching space data:",w)}finally{l(!1)}})()},[n,E.urlDisruptiveLogo,t]),L.useEffect(()=>{a||(Te.log("WebGLLoader: Unity config from Firebase",d),Te.log("WebGLLoader: Space settings from Firebase",E))},[a]),C.jsx(C.Fragment,{children:a?C.jsx("div",{className:"flex justify-center items-center h-full mt-12",children:"Getting space data..."}):C.jsx(Z5e,{...d,children:C.jsx(j4,{ref:i,settings:E})})})};B4.propTypes={spaceID:gr.string.isRequired,overrideSettings:gr.object};function HJ(){const n=document.getElementById("webgl-root");if(n){const t=n.getAttribute("data-space-id"),i=n.getAttribute("data-theme")||"default",a=()=>{const[l,d]=L.useState(null);return L.useEffect(()=>{wR(i).then(d)},[]),l?C.jsx(bN,{theme:l,children:C.jsx(l1,{children:C.jsx(k4,{children:C.jsx(B4,{spaceID:t})})})}):C.jsx("div",{children:"Loading theme..."})};try{rN.createRoot(n).render(C.jsx(a,{}))}catch(l){console.warn("Error initializing WebGL:",l)}}}typeof window<"u"&&(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",HJ):HJ());const dWe=(n,t)=>{try{const i=xR(Yo,`spaces/${n}/chatMessages`),a=new Date,l=FV(i,U3e("timestamp","asc"),V3e(a));return Zie(l,d=>{const p=[];d.docChanges().forEach(E=>{if(E.type==="added"){const v=E.doc.data();console.log("Firestore document data:",v),p.push({id:E.doc.id,...v})}}),p.length>0&&t(p)})}catch(i){throw Te.error("Error subscribing to space chat messages:",i),i}};function xd(n){const t=Object.prototype.toString.call(n);return n instanceof Date||typeof n=="object"&&t==="[object Date]"?new n.constructor(+n):typeof n=="number"||t==="[object Number]"||typeof n=="string"||t==="[object String]"?new Date(n):new Date(NaN)}function VE(n,t){return n instanceof Date?new n.constructor(t):new Date(t)}const ese=6048e5,hWe=864e5;let fWe={};function p1(){return fWe}function VR(n,t){var E,v,b,w;const i=p1(),a=(t==null?void 0:t.weekStartsOn)??((v=(E=t==null?void 0:t.locale)==null?void 0:E.options)==null?void 0:v.weekStartsOn)??i.weekStartsOn??((w=(b=i.locale)==null?void 0:b.options)==null?void 0:w.weekStartsOn)??0,l=xd(n),d=l.getDay(),p=(d<a?7:0)+d-a;return l.setDate(l.getDate()-p),l.setHours(0,0,0,0),l}function nN(n){return VR(n,{weekStartsOn:1})}function tse(n){const t=xd(n),i=t.getFullYear(),a=VE(n,0);a.setFullYear(i+1,0,4),a.setHours(0,0,0,0);const l=nN(a),d=VE(n,0);d.setFullYear(i,0,4),d.setHours(0,0,0,0);const p=nN(d);return t.getTime()>=l.getTime()?i+1:t.getTime()>=p.getTime()?i:i-1}function $J(n){const t=xd(n);return t.setHours(0,0,0,0),t}function KJ(n){const t=xd(n),i=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()));return i.setUTCFullYear(t.getFullYear()),+n-+i}function pWe(n,t){const i=$J(n),a=$J(t),l=+i-KJ(i),d=+a-KJ(a);return Math.round((l-d)/hWe)}function mWe(n){const t=tse(n),i=VE(n,0);return i.setFullYear(t,0,4),i.setHours(0,0,0,0),nN(i)}function gWe(n){return n instanceof Date||typeof n=="object"&&Object.prototype.toString.call(n)==="[object Date]"}function _We(n){if(!gWe(n)&&typeof n!="number")return!1;const t=xd(n);return!isNaN(Number(t))}function EWe(n){const t=xd(n),i=VE(n,0);return i.setFullYear(t.getFullYear(),0,1),i.setHours(0,0,0,0),i}const yWe={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},vWe=(n,t,i)=>{let a;const l=yWe[n];return typeof l=="string"?a=l:t===1?a=l.one:a=l.other.replace("{{count}}",t.toString()),i!=null&&i.addSuffix?i.comparison&&i.comparison>0?"in "+a:a+" ago":a};function hU(n){return(t={})=>{const i=t.width?String(t.width):n.defaultWidth;return n.formats[i]||n.formats[n.defaultWidth]}}const SWe={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},bWe={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},TWe={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},wWe={date:hU({formats:SWe,defaultWidth:"full"}),time:hU({formats:bWe,defaultWidth:"full"}),dateTime:hU({formats:TWe,defaultWidth:"full"})},RWe={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},CWe=(n,t,i,a)=>RWe[n];function vw(n){return(t,i)=>{const a=i!=null&&i.context?String(i.context):"standalone";let l;if(a==="formatting"&&n.formattingValues){const p=n.defaultFormattingWidth||n.defaultWidth,E=i!=null&&i.width?String(i.width):p;l=n.formattingValues[E]||n.formattingValues[p]}else{const p=n.defaultWidth,E=i!=null&&i.width?String(i.width):n.defaultWidth;l=n.values[E]||n.values[p]}const d=n.argumentCallback?n.argumentCallback(t):t;return l[d]}}const IWe={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},AWe={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},PWe={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},OWe={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},kWe={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},NWe={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},DWe=(n,t)=>{const i=Number(n),a=i%100;if(a>20||a<10)switch(a%10){case 1:return i+"st";case 2:return i+"nd";case 3:return i+"rd"}return i+"th"},LWe={ordinalNumber:DWe,era:vw({values:IWe,defaultWidth:"wide"}),quarter:vw({values:AWe,defaultWidth:"wide",argumentCallback:n=>n-1}),month:vw({values:PWe,defaultWidth:"wide"}),day:vw({values:OWe,defaultWidth:"wide"}),dayPeriod:vw({values:kWe,defaultWidth:"wide",formattingValues:NWe,defaultFormattingWidth:"wide"})};function Sw(n){return(t,i={})=>{const a=i.width,l=a&&n.matchPatterns[a]||n.matchPatterns[n.defaultMatchWidth],d=t.match(l);if(!d)return null;const p=d[0],E=a&&n.parsePatterns[a]||n.parsePatterns[n.defaultParseWidth],v=Array.isArray(E)?MWe(E,A=>A.test(p)):xWe(E,A=>A.test(p));let b;b=n.valueCallback?n.valueCallback(v):v,b=i.valueCallback?i.valueCallback(b):b;const w=t.slice(p.length);return{value:b,rest:w}}}function xWe(n,t){for(const i in n)if(Object.prototype.hasOwnProperty.call(n,i)&&t(n[i]))return i}function MWe(n,t){for(let i=0;i<n.length;i++)if(t(n[i]))return i}function UWe(n){return(t,i={})=>{const a=t.match(n.matchPattern);if(!a)return null;const l=a[0],d=t.match(n.parsePattern);if(!d)return null;let p=n.valueCallback?n.valueCallback(d[0]):d[0];p=i.valueCallback?i.valueCallback(p):p;const E=t.slice(l.length);return{value:p,rest:E}}}const VWe=/^(\d+)(th|st|nd|rd)?/i,FWe=/\d+/i,jWe={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},BWe={any:[/^b/i,/^(a|c)/i]},WWe={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},zWe={any:[/1/i,/2/i,/3/i,/4/i]},GWe={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},HWe={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},$We={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},KWe={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},qWe={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},YWe={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},XWe={ordinalNumber:UWe({matchPattern:VWe,parsePattern:FWe,valueCallback:n=>parseInt(n,10)}),era:Sw({matchPatterns:jWe,defaultMatchWidth:"wide",parsePatterns:BWe,defaultParseWidth:"any"}),quarter:Sw({matchPatterns:WWe,defaultMatchWidth:"wide",parsePatterns:zWe,defaultParseWidth:"any",valueCallback:n=>n+1}),month:Sw({matchPatterns:GWe,defaultMatchWidth:"wide",parsePatterns:HWe,defaultParseWidth:"any"}),day:Sw({matchPatterns:$We,defaultMatchWidth:"wide",parsePatterns:KWe,defaultParseWidth:"any"}),dayPeriod:Sw({matchPatterns:qWe,defaultMatchWidth:"any",parsePatterns:YWe,defaultParseWidth:"any"})},JWe={code:"en-US",formatDistance:vWe,formatLong:wWe,formatRelative:CWe,localize:LWe,match:XWe,options:{weekStartsOn:0,firstWeekContainsDate:1}};function QWe(n){const t=xd(n);return pWe(t,EWe(t))+1}function ZWe(n){const t=xd(n),i=+nN(t)-+mWe(t);return Math.round(i/ese)+1}function nse(n,t){var w,A,N,F;const i=xd(n),a=i.getFullYear(),l=p1(),d=(t==null?void 0:t.firstWeekContainsDate)??((A=(w=t==null?void 0:t.locale)==null?void 0:w.options)==null?void 0:A.firstWeekContainsDate)??l.firstWeekContainsDate??((F=(N=l.locale)==null?void 0:N.options)==null?void 0:F.firstWeekContainsDate)??1,p=VE(n,0);p.setFullYear(a+1,0,d),p.setHours(0,0,0,0);const E=VR(p,t),v=VE(n,0);v.setFullYear(a,0,d),v.setHours(0,0,0,0);const b=VR(v,t);return i.getTime()>=E.getTime()?a+1:i.getTime()>=b.getTime()?a:a-1}function e8e(n,t){var E,v,b,w;const i=p1(),a=(t==null?void 0:t.firstWeekContainsDate)??((v=(E=t==null?void 0:t.locale)==null?void 0:E.options)==null?void 0:v.firstWeekContainsDate)??i.firstWeekContainsDate??((w=(b=i.locale)==null?void 0:b.options)==null?void 0:w.firstWeekContainsDate)??1,l=nse(n,t),d=VE(n,0);return d.setFullYear(l,0,a),d.setHours(0,0,0,0),VR(d,t)}function t8e(n,t){const i=xd(n),a=+VR(i,t)-+e8e(i,t);return Math.round(a/ese)+1}function hi(n,t){const i=n<0?"-":"",a=Math.abs(n).toString().padStart(t,"0");return i+a}const Ym={y(n,t){const i=n.getFullYear(),a=i>0?i:1-i;return hi(t==="yy"?a%100:a,t.length)},M(n,t){const i=n.getMonth();return t==="M"?String(i+1):hi(i+1,2)},d(n,t){return hi(n.getDate(),t.length)},a(n,t){const i=n.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return i.toUpperCase();case"aaa":return i;case"aaaaa":return i[0];case"aaaa":default:return i==="am"?"a.m.":"p.m."}},h(n,t){return hi(n.getHours()%12||12,t.length)},H(n,t){return hi(n.getHours(),t.length)},m(n,t){return hi(n.getMinutes(),t.length)},s(n,t){return hi(n.getSeconds(),t.length)},S(n,t){const i=t.length,a=n.getMilliseconds(),l=Math.trunc(a*Math.pow(10,i-3));return hi(l,t.length)}},gS={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},qJ={G:function(n,t,i){const a=n.getFullYear()>0?1:0;switch(t){case"G":case"GG":case"GGG":return i.era(a,{width:"abbreviated"});case"GGGGG":return i.era(a,{width:"narrow"});case"GGGG":default:return i.era(a,{width:"wide"})}},y:function(n,t,i){if(t==="yo"){const a=n.getFullYear(),l=a>0?a:1-a;return i.ordinalNumber(l,{unit:"year"})}return Ym.y(n,t)},Y:function(n,t,i,a){const l=nse(n,a),d=l>0?l:1-l;if(t==="YY"){const p=d%100;return hi(p,2)}return t==="Yo"?i.ordinalNumber(d,{unit:"year"}):hi(d,t.length)},R:function(n,t){const i=tse(n);return hi(i,t.length)},u:function(n,t){const i=n.getFullYear();return hi(i,t.length)},Q:function(n,t,i){const a=Math.ceil((n.getMonth()+1)/3);switch(t){case"Q":return String(a);case"QQ":return hi(a,2);case"Qo":return i.ordinalNumber(a,{unit:"quarter"});case"QQQ":return i.quarter(a,{width:"abbreviated",context:"formatting"});case"QQQQQ":return i.quarter(a,{width:"narrow",context:"formatting"});case"QQQQ":default:return i.quarter(a,{width:"wide",context:"formatting"})}},q:function(n,t,i){const a=Math.ceil((n.getMonth()+1)/3);switch(t){case"q":return String(a);case"qq":return hi(a,2);case"qo":return i.ordinalNumber(a,{unit:"quarter"});case"qqq":return i.quarter(a,{width:"abbreviated",context:"standalone"});case"qqqqq":return i.quarter(a,{width:"narrow",context:"standalone"});case"qqqq":default:return i.quarter(a,{width:"wide",context:"standalone"})}},M:function(n,t,i){const a=n.getMonth();switch(t){case"M":case"MM":return Ym.M(n,t);case"Mo":return i.ordinalNumber(a+1,{unit:"month"});case"MMM":return i.month(a,{width:"abbreviated",context:"formatting"});case"MMMMM":return i.month(a,{width:"narrow",context:"formatting"});case"MMMM":default:return i.month(a,{width:"wide",context:"formatting"})}},L:function(n,t,i){const a=n.getMonth();switch(t){case"L":return String(a+1);case"LL":return hi(a+1,2);case"Lo":return i.ordinalNumber(a+1,{unit:"month"});case"LLL":return i.month(a,{width:"abbreviated",context:"standalone"});case"LLLLL":return i.month(a,{width:"narrow",context:"standalone"});case"LLLL":default:return i.month(a,{width:"wide",context:"standalone"})}},w:function(n,t,i,a){const l=t8e(n,a);return t==="wo"?i.ordinalNumber(l,{unit:"week"}):hi(l,t.length)},I:function(n,t,i){const a=ZWe(n);return t==="Io"?i.ordinalNumber(a,{unit:"week"}):hi(a,t.length)},d:function(n,t,i){return t==="do"?i.ordinalNumber(n.getDate(),{unit:"date"}):Ym.d(n,t)},D:function(n,t,i){const a=QWe(n);return t==="Do"?i.ordinalNumber(a,{unit:"dayOfYear"}):hi(a,t.length)},E:function(n,t,i){const a=n.getDay();switch(t){case"E":case"EE":case"EEE":return i.day(a,{width:"abbreviated",context:"formatting"});case"EEEEE":return i.day(a,{width:"narrow",context:"formatting"});case"EEEEEE":return i.day(a,{width:"short",context:"formatting"});case"EEEE":default:return i.day(a,{width:"wide",context:"formatting"})}},e:function(n,t,i,a){const l=n.getDay(),d=(l-a.weekStartsOn+8)%7||7;switch(t){case"e":return String(d);case"ee":return hi(d,2);case"eo":return i.ordinalNumber(d,{unit:"day"});case"eee":return i.day(l,{width:"abbreviated",context:"formatting"});case"eeeee":return i.day(l,{width:"narrow",context:"formatting"});case"eeeeee":return i.day(l,{width:"short",context:"formatting"});case"eeee":default:return i.day(l,{width:"wide",context:"formatting"})}},c:function(n,t,i,a){const l=n.getDay(),d=(l-a.weekStartsOn+8)%7||7;switch(t){case"c":return String(d);case"cc":return hi(d,t.length);case"co":return i.ordinalNumber(d,{unit:"day"});case"ccc":return i.day(l,{width:"abbreviated",context:"standalone"});case"ccccc":return i.day(l,{width:"narrow",context:"standalone"});case"cccccc":return i.day(l,{width:"short",context:"standalone"});case"cccc":default:return i.day(l,{width:"wide",context:"standalone"})}},i:function(n,t,i){const a=n.getDay(),l=a===0?7:a;switch(t){case"i":return String(l);case"ii":return hi(l,t.length);case"io":return i.ordinalNumber(l,{unit:"day"});case"iii":return i.day(a,{width:"abbreviated",context:"formatting"});case"iiiii":return i.day(a,{width:"narrow",context:"formatting"});case"iiiiii":return i.day(a,{width:"short",context:"formatting"});case"iiii":default:return i.day(a,{width:"wide",context:"formatting"})}},a:function(n,t,i){const l=n.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return i.dayPeriod(l,{width:"abbreviated",context:"formatting"});case"aaa":return i.dayPeriod(l,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return i.dayPeriod(l,{width:"narrow",context:"formatting"});case"aaaa":default:return i.dayPeriod(l,{width:"wide",context:"formatting"})}},b:function(n,t,i){const a=n.getHours();let l;switch(a===12?l=gS.noon:a===0?l=gS.midnight:l=a/12>=1?"pm":"am",t){case"b":case"bb":return i.dayPeriod(l,{width:"abbreviated",context:"formatting"});case"bbb":return i.dayPeriod(l,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return i.dayPeriod(l,{width:"narrow",context:"formatting"});case"bbbb":default:return i.dayPeriod(l,{width:"wide",context:"formatting"})}},B:function(n,t,i){const a=n.getHours();let l;switch(a>=17?l=gS.evening:a>=12?l=gS.afternoon:a>=4?l=gS.morning:l=gS.night,t){case"B":case"BB":case"BBB":return i.dayPeriod(l,{width:"abbreviated",context:"formatting"});case"BBBBB":return i.dayPeriod(l,{width:"narrow",context:"formatting"});case"BBBB":default:return i.dayPeriod(l,{width:"wide",context:"formatting"})}},h:function(n,t,i){if(t==="ho"){let a=n.getHours()%12;return a===0&&(a=12),i.ordinalNumber(a,{unit:"hour"})}return Ym.h(n,t)},H:function(n,t,i){return t==="Ho"?i.ordinalNumber(n.getHours(),{unit:"hour"}):Ym.H(n,t)},K:function(n,t,i){const a=n.getHours()%12;return t==="Ko"?i.ordinalNumber(a,{unit:"hour"}):hi(a,t.length)},k:function(n,t,i){let a=n.getHours();return a===0&&(a=24),t==="ko"?i.ordinalNumber(a,{unit:"hour"}):hi(a,t.length)},m:function(n,t,i){return t==="mo"?i.ordinalNumber(n.getMinutes(),{unit:"minute"}):Ym.m(n,t)},s:function(n,t,i){return t==="so"?i.ordinalNumber(n.getSeconds(),{unit:"second"}):Ym.s(n,t)},S:function(n,t){return Ym.S(n,t)},X:function(n,t,i){const a=n.getTimezoneOffset();if(a===0)return"Z";switch(t){case"X":return XJ(a);case"XXXX":case"XX":return sE(a);case"XXXXX":case"XXX":default:return sE(a,":")}},x:function(n,t,i){const a=n.getTimezoneOffset();switch(t){case"x":return XJ(a);case"xxxx":case"xx":return sE(a);case"xxxxx":case"xxx":default:return sE(a,":")}},O:function(n,t,i){const a=n.getTimezoneOffset();switch(t){case"O":case"OO":case"OOO":return"GMT"+YJ(a,":");case"OOOO":default:return"GMT"+sE(a,":")}},z:function(n,t,i){const a=n.getTimezoneOffset();switch(t){case"z":case"zz":case"zzz":return"GMT"+YJ(a,":");case"zzzz":default:return"GMT"+sE(a,":")}},t:function(n,t,i){const a=Math.trunc(n.getTime()/1e3);return hi(a,t.length)},T:function(n,t,i){const a=n.getTime();return hi(a,t.length)}};function YJ(n,t=""){const i=n>0?"-":"+",a=Math.abs(n),l=Math.trunc(a/60),d=a%60;return d===0?i+String(l):i+String(l)+t+hi(d,2)}function XJ(n,t){return n%60===0?(n>0?"-":"+")+hi(Math.abs(n)/60,2):sE(n,t)}function sE(n,t=""){const i=n>0?"-":"+",a=Math.abs(n),l=hi(Math.trunc(a/60),2),d=hi(a%60,2);return i+l+t+d}const JJ=(n,t)=>{switch(n){case"P":return t.date({width:"short"});case"PP":return t.date({width:"medium"});case"PPP":return t.date({width:"long"});case"PPPP":default:return t.date({width:"full"})}},rse=(n,t)=>{switch(n){case"p":return t.time({width:"short"});case"pp":return t.time({width:"medium"});case"ppp":return t.time({width:"long"});case"pppp":default:return t.time({width:"full"})}},n8e=(n,t)=>{const i=n.match(/(P+)(p+)?/)||[],a=i[1],l=i[2];if(!l)return JJ(n,t);let d;switch(a){case"P":d=t.dateTime({width:"short"});break;case"PP":d=t.dateTime({width:"medium"});break;case"PPP":d=t.dateTime({width:"long"});break;case"PPPP":default:d=t.dateTime({width:"full"});break}return d.replace("{{date}}",JJ(a,t)).replace("{{time}}",rse(l,t))},r8e={p:rse,P:n8e},i8e=/^D+$/,o8e=/^Y+$/,s8e=["D","DD","YY","YYYY"];function a8e(n){return i8e.test(n)}function c8e(n){return o8e.test(n)}function l8e(n,t,i){const a=u8e(n,t,i);if(console.warn(a),s8e.includes(n))throw new RangeError(a)}function u8e(n,t,i){const a=n[0]==="Y"?"years":"days of the month";return`Use \`${n.toLowerCase()}\` instead of \`${n}\` (in \`${t}\`) for formatting ${a} to the input \`${i}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const d8e=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,h8e=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,f8e=/^'([^]*?)'?$/,p8e=/''/g,m8e=/[a-zA-Z]/;function g8e(n,t,i){var w,A,N,F;const a=p1(),l=a.locale??JWe,d=a.firstWeekContainsDate??((A=(w=a.locale)==null?void 0:w.options)==null?void 0:A.firstWeekContainsDate)??1,p=a.weekStartsOn??((F=(N=a.locale)==null?void 0:N.options)==null?void 0:F.weekStartsOn)??0,E=xd(n);if(!_We(E))throw new RangeError("Invalid time value");let v=t.match(h8e).map(j=>{const B=j[0];if(B==="p"||B==="P"){const H=r8e[B];return H(j,l.formatLong)}return j}).join("").match(d8e).map(j=>{if(j==="''")return{isToken:!1,value:"'"};const B=j[0];if(B==="'")return{isToken:!1,value:_8e(j)};if(qJ[B])return{isToken:!0,value:j};if(B.match(m8e))throw new RangeError("Format string contains an unescaped latin alphabet character `"+B+"`");return{isToken:!1,value:j}});l.localize.preprocessor&&(v=l.localize.preprocessor(E,v));const b={firstWeekContainsDate:d,weekStartsOn:p,locale:l};return v.map(j=>{if(!j.isToken)return j.value;const B=j.value;(c8e(B)||a8e(B))&&l8e(B,t,String(n));const H=qJ[B[0]];return H(E,B,l.localize,b)}).join("")}function _8e(n){const t=n.match(f8e);return t?t[1].replace(p8e,"'"):n}const E8e=of(Rt),ise=({name:n,timestamp:t,text:i,isCurrentUser:a})=>{console.log("Message props:",{name:n,timestamp:t,text:i,isCurrentUser:a});const l=t&&t.toDate?g8e(t.toDate(),"HH:mm"):"Invalid date";return C.jsxs(E8e,{display:"flex",flexDirection:"column",alignItems:a?"flex-end":"flex-start",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},children:[C.jsxs(Rt,{w:"auto",maxW:"80%",bg:a?"secondary.500":"primary.200",color:a?"white":"black",p:"10px",borderRadius:"10px",alignSelf:a?"flex-end":"flex-start",wordBreak:"break-word",children:[C.jsx(ht,{fontWeight:"bold",children:n}),C.jsx(ht,{children:i})]}),C.jsx(ht,{color:"copy.light",fontSize:"xs",mt:"4px",mx:"6px",mb:"10px",textAlign:a?"right":"left",children:l})]})};ise.propTypes={name:gr.string.isRequired,timestamp:gr.object,text:gr.string.isRequired,isCurrentUser:gr.bool.isRequired};const y8e=({spaceID:n})=>{const[t,i]=L.useState([]),{user:a}=L.useContext(ja),l=L.useRef(null);return L.useEffect(()=>{const d=dWe(n,p=>{console.log("New messages received:",p),i(E=>[...E,...p]),Te.log("Messages updated:",p)});return()=>d()},[n]),L.useEffect(()=>{l.current&&l.current.scrollIntoView({behavior:"smooth"})},[t]),C.jsxs(Rt,{className:"messages-container",display:"flex",flexDirection:"column",my:"10px",overflowY:"auto",maxHeight:"80vh",children:[t.map(d=>{const p=d.uid===(a==null?void 0:a.uid);return C.jsx(ise,{name:d.user,timestamp:d.timestamp,text:d.text,isCurrentUser:p},d.id)}),C.jsx("div",{ref:l})]})},v8e=({spaceID:n})=>{},ose=({spaceID:n})=>{const{user:t}=L.useContext(ja);return t?C.jsxs(Rt,{children:[C.jsx(Rt,{height:"400px",overflowY:"auto",border:"1px solid #ccc",backgroundColor:"tertiaryAlpha.600",padding:"10px",children:C.jsx(y8e,{spaceID:n})}),C.jsx(Rt,{mt:"8px",children:C.jsx(v8e,{spaceID:n})})]}):(console.log("No user found, returning login message"),C.jsx(Rt,{children:C.jsx(ht,{children:"Please log in to view the chat."})}))},PO=document.getElementById("chat-root");if(PO){const n=PO.getAttribute("data-space-id"),t=PO.getAttribute("data-theme")||"default",i=()=>{const[a,l]=L.useState(null);return L.useEffect(()=>{wR(t).then(l)},[]),a?C.jsx(bN,{theme:a,children:C.jsx(l1,{children:C.jsx(ose,{spaceID:n})})}):C.jsx("div",{children:"Loading theme..."})};rN.createRoot(PO).render(C.jsx(i,{}))}else console.error("Root element 'chat-root' not found.");class S8e extends L.Component{constructor(t){super(t),this.state={hasError:!1}}static getDerivedStateFromError(t){return{hasError:!0}}componentDidCatch(t,i){console.error("WebGL Error:",t,i)}render(){return this.state.hasError?C.jsx(Rt,{p:4,bg:"red.100",color:"red.900",borderRadius:"md",children:C.jsx(ht,{children:"WebGL component error. Please refresh the page."})}):this.props.children}}const OO=document.getElementById("root");if(OO){const n=OO.getAttribute("data-space-id"),t=OO.getAttribute("data-theme")||"default",i=()=>{const[a,l]=L.useState(null);return L.useEffect(()=>{wR(t).then(l);const d=()=>{document.hidden||wR(t).then(l)};return document.addEventListener("visibilitychange",d),()=>{document.removeEventListener("visibilitychange",d)}},[]),a?C.jsx(bN,{theme:a,children:C.jsx(l1,{children:C.jsx(k4,{children:C.jsxs(ri,{spacing:4,align:"stretch",children:[C.jsxs(Ai,{justify:"space-between",align:"center",p:4,bg:"gray.700",m:0,position:"relative",zIndex:"100",children:[C.jsx(ht,{fontSize:"xl",fontWeight:"bold",color:"white",children:"LOGO"}),C.jsx(Rt,{zIndex:"100",position:"relative",children:C.jsx(Loe,{})})]}),C.jsx(qU,{maxW:"container.xl",p:0,zIndex:"1",children:C.jsx(tte,{ratio:16/9,bg:"blue.100",m:0,children:C.jsx(Rt,{id:"webgl-root","data-space-id":n,w:"100%",m:0,children:C.jsx(S8e,{children:C.jsx(B4,{spaceID:n})})})})}),C.jsx(qU,{maxW:"container.xl",p:0,children:C.jsx(ose,{spaceID:n})})]})})})}):C.jsx("div",{children:"Loading theme..."})};rN.createRoot(OO).render(C.jsx(i,{}))}else console.error("Root element 'root' not found.");export{aEe as a,Ove as b,xi as c,Ive as d,T8e as e,b8e as f,yve as g,Cu as i,jh as m,ARe as t};
