function Pme(r,t){for(var o=0;o<t.length;o++){const a=t[o];if(typeof a!="string"&&!Array.isArray(a)){for(const l in a)if(l!=="default"&&!(l in r)){const d=Object.getOwnPropertyDescriptor(a,l);d&&Object.defineProperty(r,l,d.get?d:{enumerable:!0,get:()=>a[l]})}}}return Object.freeze(Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}))}var N_=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function TS(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var Mx={exports:{}},Z0={},Ux={exports:{}},dr={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var lK;function Nme(){if(lK)return dr;lK=1;var r=Symbol.for("react.element"),t=Symbol.for("react.portal"),o=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),l=Symbol.for("react.profiler"),d=Symbol.for("react.provider"),m=Symbol.for("react.context"),v=Symbol.for("react.forward_ref"),y=Symbol.for("react.suspense"),b=Symbol.for("react.memo"),R=Symbol.for("react.lazy"),O=Symbol.iterator;function N(Ee){return Ee===null||typeof Ee!="object"?null:(Ee=O&&Ee[O]||Ee["@@iterator"],typeof Ee=="function"?Ee:null)}var F={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},H=Object.assign,G={};function z(Ee,Ye,yt){this.props=Ee,this.context=Ye,this.refs=G,this.updater=yt||F}z.prototype.isReactComponent={},z.prototype.setState=function(Ee,Ye){if(typeof Ee!="object"&&typeof Ee!="function"&&Ee!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,Ee,Ye,"setState")},z.prototype.forceUpdate=function(Ee){this.updater.enqueueForceUpdate(this,Ee,"forceUpdate")};function ne(){}ne.prototype=z.prototype;function J(Ee,Ye,yt){this.props=Ee,this.context=Ye,this.refs=G,this.updater=yt||F}var oe=J.prototype=new ne;oe.constructor=J,H(oe,z.prototype),oe.isPureReactComponent=!0;var se=Array.isArray,ae=Object.prototype.hasOwnProperty,ye={current:null},Q={key:!0,ref:!0,__self:!0,__source:!0};function te(Ee,Ye,yt){var at,Fe={},et=null,_t=null;if(Ye!=null)for(at in Ye.ref!==void 0&&(_t=Ye.ref),Ye.key!==void 0&&(et=""+Ye.key),Ye)ae.call(Ye,at)&&!Q.hasOwnProperty(at)&&(Fe[at]=Ye[at]);var Dt=arguments.length-2;if(Dt===1)Fe.children=yt;else if(1<Dt){for(var Ht=Array(Dt),Wt=0;Wt<Dt;Wt++)Ht[Wt]=arguments[Wt+2];Fe.children=Ht}if(Ee&&Ee.defaultProps)for(at in Dt=Ee.defaultProps,Dt)Fe[at]===void 0&&(Fe[at]=Dt[at]);return{$$typeof:r,type:Ee,key:et,ref:_t,props:Fe,_owner:ye.current}}function re(Ee,Ye){return{$$typeof:r,type:Ee.type,key:Ye,ref:Ee.ref,props:Ee.props,_owner:Ee._owner}}function le(Ee){return typeof Ee=="object"&&Ee!==null&&Ee.$$typeof===r}function ve(Ee){var Ye={"=":"=0",":":"=2"};return"$"+Ee.replace(/[=:]/g,function(yt){return Ye[yt]})}var fe=/\/+/g;function de(Ee,Ye){return typeof Ee=="object"&&Ee!==null&&Ee.key!=null?ve(""+Ee.key):Ye.toString(36)}function lt(Ee,Ye,yt,at,Fe){var et=typeof Ee;(et==="undefined"||et==="boolean")&&(Ee=null);var _t=!1;if(Ee===null)_t=!0;else switch(et){case"string":case"number":_t=!0;break;case"object":switch(Ee.$$typeof){case r:case t:_t=!0}}if(_t)return _t=Ee,Fe=Fe(_t),Ee=at===""?"."+de(_t,0):at,se(Fe)?(yt="",Ee!=null&&(yt=Ee.replace(fe,"$&/")+"/"),lt(Fe,Ye,yt,"",function(Wt){return Wt})):Fe!=null&&(le(Fe)&&(Fe=re(Fe,yt+(!Fe.key||_t&&_t.key===Fe.key?"":(""+Fe.key).replace(fe,"$&/")+"/")+Ee)),Ye.push(Fe)),1;if(_t=0,at=at===""?".":at+":",se(Ee))for(var Dt=0;Dt<Ee.length;Dt++){et=Ee[Dt];var Ht=at+de(et,Dt);_t+=lt(et,Ye,yt,Ht,Fe)}else if(Ht=N(Ee),typeof Ht=="function")for(Ee=Ht.call(Ee),Dt=0;!(et=Ee.next()).done;)et=et.value,Ht=at+de(et,Dt++),_t+=lt(et,Ye,yt,Ht,Fe);else if(et==="object")throw Ye=String(Ee),Error("Objects are not valid as a React child (found: "+(Ye==="[object Object]"?"object with keys {"+Object.keys(Ee).join(", ")+"}":Ye)+"). If you meant to render a collection of children, use an array instead.");return _t}function ft(Ee,Ye,yt){if(Ee==null)return Ee;var at=[],Fe=0;return lt(Ee,at,"","",function(et){return Ye.call(yt,et,Fe++)}),at}function Xe(Ee){if(Ee._status===-1){var Ye=Ee._result;Ye=Ye(),Ye.then(function(yt){(Ee._status===0||Ee._status===-1)&&(Ee._status=1,Ee._result=yt)},function(yt){(Ee._status===0||Ee._status===-1)&&(Ee._status=2,Ee._result=yt)}),Ee._status===-1&&(Ee._status=0,Ee._result=Ye)}if(Ee._status===1)return Ee._result.default;throw Ee._result}var Le={current:null},Ke={transition:null},nt={ReactCurrentDispatcher:Le,ReactCurrentBatchConfig:Ke,ReactCurrentOwner:ye};return dr.Children={map:ft,forEach:function(Ee,Ye,yt){ft(Ee,function(){Ye.apply(this,arguments)},yt)},count:function(Ee){var Ye=0;return ft(Ee,function(){Ye++}),Ye},toArray:function(Ee){return ft(Ee,function(Ye){return Ye})||[]},only:function(Ee){if(!le(Ee))throw Error("React.Children.only expected to receive a single React element child.");return Ee}},dr.Component=z,dr.Fragment=o,dr.Profiler=l,dr.PureComponent=J,dr.StrictMode=a,dr.Suspense=y,dr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=nt,dr.cloneElement=function(Ee,Ye,yt){if(Ee==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+Ee+".");var at=H({},Ee.props),Fe=Ee.key,et=Ee.ref,_t=Ee._owner;if(Ye!=null){if(Ye.ref!==void 0&&(et=Ye.ref,_t=ye.current),Ye.key!==void 0&&(Fe=""+Ye.key),Ee.type&&Ee.type.defaultProps)var Dt=Ee.type.defaultProps;for(Ht in Ye)ae.call(Ye,Ht)&&!Q.hasOwnProperty(Ht)&&(at[Ht]=Ye[Ht]===void 0&&Dt!==void 0?Dt[Ht]:Ye[Ht])}var Ht=arguments.length-2;if(Ht===1)at.children=yt;else if(1<Ht){Dt=Array(Ht);for(var Wt=0;Wt<Ht;Wt++)Dt[Wt]=arguments[Wt+2];at.children=Dt}return{$$typeof:r,type:Ee.type,key:Fe,ref:et,props:at,_owner:_t}},dr.createContext=function(Ee){return Ee={$$typeof:m,_currentValue:Ee,_currentValue2:Ee,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},Ee.Provider={$$typeof:d,_context:Ee},Ee.Consumer=Ee},dr.createElement=te,dr.createFactory=function(Ee){var Ye=te.bind(null,Ee);return Ye.type=Ee,Ye},dr.createRef=function(){return{current:null}},dr.forwardRef=function(Ee){return{$$typeof:v,render:Ee}},dr.isValidElement=le,dr.lazy=function(Ee){return{$$typeof:R,_payload:{_status:-1,_result:Ee},_init:Xe}},dr.memo=function(Ee,Ye){return{$$typeof:b,type:Ee,compare:Ye===void 0?null:Ye}},dr.startTransition=function(Ee){var Ye=Ke.transition;Ke.transition={};try{Ee()}finally{Ke.transition=Ye}},dr.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")},dr.useCallback=function(Ee,Ye){return Le.current.useCallback(Ee,Ye)},dr.useContext=function(Ee){return Le.current.useContext(Ee)},dr.useDebugValue=function(){},dr.useDeferredValue=function(Ee){return Le.current.useDeferredValue(Ee)},dr.useEffect=function(Ee,Ye){return Le.current.useEffect(Ee,Ye)},dr.useId=function(){return Le.current.useId()},dr.useImperativeHandle=function(Ee,Ye,yt){return Le.current.useImperativeHandle(Ee,Ye,yt)},dr.useInsertionEffect=function(Ee,Ye){return Le.current.useInsertionEffect(Ee,Ye)},dr.useLayoutEffect=function(Ee,Ye){return Le.current.useLayoutEffect(Ee,Ye)},dr.useMemo=function(Ee,Ye){return Le.current.useMemo(Ee,Ye)},dr.useReducer=function(Ee,Ye,yt){return Le.current.useReducer(Ee,Ye,yt)},dr.useRef=function(Ee){return Le.current.useRef(Ee)},dr.useState=function(Ee){return Le.current.useState(Ee)},dr.useSyncExternalStore=function(Ee,Ye,yt){return Le.current.useSyncExternalStore(Ee,Ye,yt)},dr.useTransition=function(){return Le.current.useTransition()},dr.version="18.2.0",dr}var uK;function iu(){return uK||(uK=1,Ux.exports=Nme()),Ux.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var dK;function kme(){if(dK)return Z0;dK=1;var r=iu(),t=Symbol.for("react.element"),o=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,l=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,d={key:!0,ref:!0,__self:!0,__source:!0};function m(v,y,b){var R,O={},N=null,F=null;b!==void 0&&(N=""+b),y.key!==void 0&&(N=""+y.key),y.ref!==void 0&&(F=y.ref);for(R in y)a.call(y,R)&&!d.hasOwnProperty(R)&&(O[R]=y[R]);if(v&&v.defaultProps)for(R in y=v.defaultProps,y)O[R]===void 0&&(O[R]=y[R]);return{$$typeof:t,type:v,key:N,ref:F,props:O,_owner:l.current}}return Z0.Fragment=o,Z0.jsx=m,Z0.jsxs=m,Z0}var hK;function Dme(){return hK||(hK=1,Mx.exports=kme()),Mx.exports}var D=Dme(),V=iu();const Gi=TS(V),fK=Pme({__proto__:null,default:Gi},[V]);var aO={},Vx={exports:{}},Cc={},Fx={exports:{}},jx={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var pK;function Lme(){return pK||(pK=1,function(r){function t(Ke,nt){var Ee=Ke.length;Ke.push(nt);e:for(;0<Ee;){var Ye=Ee-1>>>1,yt=Ke[Ye];if(0<l(yt,nt))Ke[Ye]=nt,Ke[Ee]=yt,Ee=Ye;else break e}}function o(Ke){return Ke.length===0?null:Ke[0]}function a(Ke){if(Ke.length===0)return null;var nt=Ke[0],Ee=Ke.pop();if(Ee!==nt){Ke[0]=Ee;e:for(var Ye=0,yt=Ke.length,at=yt>>>1;Ye<at;){var Fe=2*(Ye+1)-1,et=Ke[Fe],_t=Fe+1,Dt=Ke[_t];if(0>l(et,Ee))_t<yt&&0>l(Dt,et)?(Ke[Ye]=Dt,Ke[_t]=Ee,Ye=_t):(Ke[Ye]=et,Ke[Fe]=Ee,Ye=Fe);else if(_t<yt&&0>l(Dt,Ee))Ke[Ye]=Dt,Ke[_t]=Ee,Ye=_t;else break e}}return nt}function l(Ke,nt){var Ee=Ke.sortIndex-nt.sortIndex;return Ee!==0?Ee:Ke.id-nt.id}if(typeof performance=="object"&&typeof performance.now=="function"){var d=performance;r.unstable_now=function(){return d.now()}}else{var m=Date,v=m.now();r.unstable_now=function(){return m.now()-v}}var y=[],b=[],R=1,O=null,N=3,F=!1,H=!1,G=!1,z=typeof setTimeout=="function"?setTimeout:null,ne=typeof clearTimeout=="function"?clearTimeout:null,J=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function oe(Ke){for(var nt=o(b);nt!==null;){if(nt.callback===null)a(b);else if(nt.startTime<=Ke)a(b),nt.sortIndex=nt.expirationTime,t(y,nt);else break;nt=o(b)}}function se(Ke){if(G=!1,oe(Ke),!H)if(o(y)!==null)H=!0,Xe(ae);else{var nt=o(b);nt!==null&&Le(se,nt.startTime-Ke)}}function ae(Ke,nt){H=!1,G&&(G=!1,ne(te),te=-1),F=!0;var Ee=N;try{for(oe(nt),O=o(y);O!==null&&(!(O.expirationTime>nt)||Ke&&!ve());){var Ye=O.callback;if(typeof Ye=="function"){O.callback=null,N=O.priorityLevel;var yt=Ye(O.expirationTime<=nt);nt=r.unstable_now(),typeof yt=="function"?O.callback=yt:O===o(y)&&a(y),oe(nt)}else a(y);O=o(y)}if(O!==null)var at=!0;else{var Fe=o(b);Fe!==null&&Le(se,Fe.startTime-nt),at=!1}return at}finally{O=null,N=Ee,F=!1}}var ye=!1,Q=null,te=-1,re=5,le=-1;function ve(){return!(r.unstable_now()-le<re)}function fe(){if(Q!==null){var Ke=r.unstable_now();le=Ke;var nt=!0;try{nt=Q(!0,Ke)}finally{nt?de():(ye=!1,Q=null)}}else ye=!1}var de;if(typeof J=="function")de=function(){J(fe)};else if(typeof MessageChannel<"u"){var lt=new MessageChannel,ft=lt.port2;lt.port1.onmessage=fe,de=function(){ft.postMessage(null)}}else de=function(){z(fe,0)};function Xe(Ke){Q=Ke,ye||(ye=!0,de())}function Le(Ke,nt){te=z(function(){Ke(r.unstable_now())},nt)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(Ke){Ke.callback=null},r.unstable_continueExecution=function(){H||F||(H=!0,Xe(ae))},r.unstable_forceFrameRate=function(Ke){0>Ke||125<Ke?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):re=0<Ke?Math.floor(1e3/Ke):5},r.unstable_getCurrentPriorityLevel=function(){return N},r.unstable_getFirstCallbackNode=function(){return o(y)},r.unstable_next=function(Ke){switch(N){case 1:case 2:case 3:var nt=3;break;default:nt=N}var Ee=N;N=nt;try{return Ke()}finally{N=Ee}},r.unstable_pauseExecution=function(){},r.unstable_requestPaint=function(){},r.unstable_runWithPriority=function(Ke,nt){switch(Ke){case 1:case 2:case 3:case 4:case 5:break;default:Ke=3}var Ee=N;N=Ke;try{return nt()}finally{N=Ee}},r.unstable_scheduleCallback=function(Ke,nt,Ee){var Ye=r.unstable_now();switch(typeof Ee=="object"&&Ee!==null?(Ee=Ee.delay,Ee=typeof Ee=="number"&&0<Ee?Ye+Ee:Ye):Ee=Ye,Ke){case 1:var yt=-1;break;case 2:yt=250;break;case 5:yt=1073741823;break;case 4:yt=1e4;break;default:yt=5e3}return yt=Ee+yt,Ke={id:R++,callback:nt,priorityLevel:Ke,startTime:Ee,expirationTime:yt,sortIndex:-1},Ee>Ye?(Ke.sortIndex=Ee,t(b,Ke),o(y)===null&&Ke===o(b)&&(G?(ne(te),te=-1):G=!0,Le(se,Ee-Ye))):(Ke.sortIndex=yt,t(y,Ke),H||F||(H=!0,Xe(ae))),Ke},r.unstable_shouldYield=ve,r.unstable_wrapCallback=function(Ke){var nt=N;return function(){var Ee=N;N=nt;try{return Ke.apply(this,arguments)}finally{N=Ee}}}}(jx)),jx}var mK;function xme(){return mK||(mK=1,Fx.exports=Lme()),Fx.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var gK;function Mme(){if(gK)return Cc;gK=1;var r=iu(),t=xme();function o(f){for(var g="https://reactjs.org/docs/error-decoder.html?invariant="+f,T=1;T<arguments.length;T++)g+="&args[]="+encodeURIComponent(arguments[T]);return"Minified React error #"+f+"; visit "+g+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var a=new Set,l={};function d(f,g){m(f,g),m(f+"Capture",g)}function m(f,g){for(l[f]=g,f=0;f<g.length;f++)a.add(g[f])}var v=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),y=Object.prototype.hasOwnProperty,b=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,R={},O={};function N(f){return y.call(O,f)?!0:y.call(R,f)?!1:b.test(f)?O[f]=!0:(R[f]=!0,!1)}function F(f,g,T,A){if(T!==null&&T.type===0)return!1;switch(typeof g){case"function":case"symbol":return!0;case"boolean":return A?!1:T!==null?!T.acceptsBooleans:(f=f.toLowerCase().slice(0,5),f!=="data-"&&f!=="aria-");default:return!1}}function H(f,g,T,A){if(g===null||typeof g>"u"||F(f,g,T,A))return!0;if(A)return!1;if(T!==null)switch(T.type){case 3:return!g;case 4:return g===!1;case 5:return isNaN(g);case 6:return isNaN(g)||1>g}return!1}function G(f,g,T,A,x,W,ie){this.acceptsBooleans=g===2||g===3||g===4,this.attributeName=A,this.attributeNamespace=x,this.mustUseProperty=T,this.propertyName=f,this.type=g,this.sanitizeURL=W,this.removeEmptyString=ie}var z={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(f){z[f]=new G(f,0,!1,f,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(f){var g=f[0];z[g]=new G(g,1,!1,f[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(f){z[f]=new G(f,2,!1,f.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(f){z[f]=new G(f,2,!1,f,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(f){z[f]=new G(f,3,!1,f.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(f){z[f]=new G(f,3,!0,f,null,!1,!1)}),["capture","download"].forEach(function(f){z[f]=new G(f,4,!1,f,null,!1,!1)}),["cols","rows","size","span"].forEach(function(f){z[f]=new G(f,6,!1,f,null,!1,!1)}),["rowSpan","start"].forEach(function(f){z[f]=new G(f,5,!1,f.toLowerCase(),null,!1,!1)});var ne=/[\-:]([a-z])/g;function J(f){return f[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(f){var g=f.replace(ne,J);z[g]=new G(g,1,!1,f,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(f){var g=f.replace(ne,J);z[g]=new G(g,1,!1,f,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(f){var g=f.replace(ne,J);z[g]=new G(g,1,!1,f,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(f){z[f]=new G(f,1,!1,f.toLowerCase(),null,!1,!1)}),z.xlinkHref=new G("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(f){z[f]=new G(f,1,!1,f.toLowerCase(),null,!0,!0)});function oe(f,g,T,A){var x=z.hasOwnProperty(g)?z[g]:null;(x!==null?x.type!==0:A||!(2<g.length)||g[0]!=="o"&&g[0]!=="O"||g[1]!=="n"&&g[1]!=="N")&&(H(g,T,x,A)&&(T=null),A||x===null?N(g)&&(T===null?f.removeAttribute(g):f.setAttribute(g,""+T)):x.mustUseProperty?f[x.propertyName]=T===null?x.type===3?!1:"":T:(g=x.attributeName,A=x.attributeNamespace,T===null?f.removeAttribute(g):(x=x.type,T=x===3||x===4&&T===!0?"":""+T,A?f.setAttributeNS(A,g,T):f.setAttribute(g,T))))}var se=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,ae=Symbol.for("react.element"),ye=Symbol.for("react.portal"),Q=Symbol.for("react.fragment"),te=Symbol.for("react.strict_mode"),re=Symbol.for("react.profiler"),le=Symbol.for("react.provider"),ve=Symbol.for("react.context"),fe=Symbol.for("react.forward_ref"),de=Symbol.for("react.suspense"),lt=Symbol.for("react.suspense_list"),ft=Symbol.for("react.memo"),Xe=Symbol.for("react.lazy"),Le=Symbol.for("react.offscreen"),Ke=Symbol.iterator;function nt(f){return f===null||typeof f!="object"?null:(f=Ke&&f[Ke]||f["@@iterator"],typeof f=="function"?f:null)}var Ee=Object.assign,Ye;function yt(f){if(Ye===void 0)try{throw Error()}catch(T){var g=T.stack.trim().match(/\n( *(at )?)/);Ye=g&&g[1]||""}return`
`+Ye+f}var at=!1;function Fe(f,g){if(!f||at)return"";at=!0;var T=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(g)if(g=function(){throw Error()},Object.defineProperty(g.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(g,[])}catch(ze){var A=ze}Reflect.construct(f,[],g)}else{try{g.call()}catch(ze){A=ze}f.call(g.prototype)}else{try{throw Error()}catch(ze){A=ze}f()}}catch(ze){if(ze&&A&&typeof ze.stack=="string"){for(var x=ze.stack.split(`
`),W=A.stack.split(`
`),ie=x.length-1,Se=W.length-1;1<=ie&&0<=Se&&x[ie]!==W[Se];)Se--;for(;1<=ie&&0<=Se;ie--,Se--)if(x[ie]!==W[Se]){if(ie!==1||Se!==1)do if(ie--,Se--,0>Se||x[ie]!==W[Se]){var Ae=`
`+x[ie].replace(" at new "," at ");return f.displayName&&Ae.includes("<anonymous>")&&(Ae=Ae.replace("<anonymous>",f.displayName)),Ae}while(1<=ie&&0<=Se);break}}}finally{at=!1,Error.prepareStackTrace=T}return(f=f?f.displayName||f.name:"")?yt(f):""}function et(f){switch(f.tag){case 5:return yt(f.type);case 16:return yt("Lazy");case 13:return yt("Suspense");case 19:return yt("SuspenseList");case 0:case 2:case 15:return f=Fe(f.type,!1),f;case 11:return f=Fe(f.type.render,!1),f;case 1:return f=Fe(f.type,!0),f;default:return""}}function _t(f){if(f==null)return null;if(typeof f=="function")return f.displayName||f.name||null;if(typeof f=="string")return f;switch(f){case Q:return"Fragment";case ye:return"Portal";case re:return"Profiler";case te:return"StrictMode";case de:return"Suspense";case lt:return"SuspenseList"}if(typeof f=="object")switch(f.$$typeof){case ve:return(f.displayName||"Context")+".Consumer";case le:return(f._context.displayName||"Context")+".Provider";case fe:var g=f.render;return f=f.displayName,f||(f=g.displayName||g.name||"",f=f!==""?"ForwardRef("+f+")":"ForwardRef"),f;case ft:return g=f.displayName||null,g!==null?g:_t(f.type)||"Memo";case Xe:g=f._payload,f=f._init;try{return _t(f(g))}catch{}}return null}function Dt(f){var g=f.type;switch(f.tag){case 24:return"Cache";case 9:return(g.displayName||"Context")+".Consumer";case 10:return(g._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return f=g.render,f=f.displayName||f.name||"",g.displayName||(f!==""?"ForwardRef("+f+")":"ForwardRef");case 7:return"Fragment";case 5:return g;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return _t(g);case 8:return g===te?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof g=="function")return g.displayName||g.name||null;if(typeof g=="string")return g}return null}function Ht(f){switch(typeof f){case"boolean":case"number":case"string":case"undefined":return f;case"object":return f;default:return""}}function Wt(f){var g=f.type;return(f=f.nodeName)&&f.toLowerCase()==="input"&&(g==="checkbox"||g==="radio")}function Fn(f){var g=Wt(f)?"checked":"value",T=Object.getOwnPropertyDescriptor(f.constructor.prototype,g),A=""+f[g];if(!f.hasOwnProperty(g)&&typeof T<"u"&&typeof T.get=="function"&&typeof T.set=="function"){var x=T.get,W=T.set;return Object.defineProperty(f,g,{configurable:!0,get:function(){return x.call(this)},set:function(ie){A=""+ie,W.call(this,ie)}}),Object.defineProperty(f,g,{enumerable:T.enumerable}),{getValue:function(){return A},setValue:function(ie){A=""+ie},stopTracking:function(){f._valueTracker=null,delete f[g]}}}}function xn(f){f._valueTracker||(f._valueTracker=Fn(f))}function hn(f){if(!f)return!1;var g=f._valueTracker;if(!g)return!0;var T=g.getValue(),A="";return f&&(A=Wt(f)?f.checked?"true":"false":f.value),f=A,f!==T?(g.setValue(f),!0):!1}function gr(f){if(f=f||(typeof document<"u"?document:void 0),typeof f>"u")return null;try{return f.activeElement||f.body}catch{return f.body}}function Ar(f,g){var T=g.checked;return Ee({},g,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:T??f._wrapperState.initialChecked})}function bt(f,g){var T=g.defaultValue==null?"":g.defaultValue,A=g.checked!=null?g.checked:g.defaultChecked;T=Ht(g.value!=null?g.value:T),f._wrapperState={initialChecked:A,initialValue:T,controlled:g.type==="checkbox"||g.type==="radio"?g.checked!=null:g.value!=null}}function bn(f,g){g=g.checked,g!=null&&oe(f,"checked",g,!1)}function wn(f,g){bn(f,g);var T=Ht(g.value),A=g.type;if(T!=null)A==="number"?(T===0&&f.value===""||f.value!=T)&&(f.value=""+T):f.value!==""+T&&(f.value=""+T);else if(A==="submit"||A==="reset"){f.removeAttribute("value");return}g.hasOwnProperty("value")?De(f,g.type,T):g.hasOwnProperty("defaultValue")&&De(f,g.type,Ht(g.defaultValue)),g.checked==null&&g.defaultChecked!=null&&(f.defaultChecked=!!g.defaultChecked)}function we(f,g,T){if(g.hasOwnProperty("value")||g.hasOwnProperty("defaultValue")){var A=g.type;if(!(A!=="submit"&&A!=="reset"||g.value!==void 0&&g.value!==null))return;g=""+f._wrapperState.initialValue,T||g===f.value||(f.value=g),f.defaultValue=g}T=f.name,T!==""&&(f.name=""),f.defaultChecked=!!f._wrapperState.initialChecked,T!==""&&(f.name=T)}function De(f,g,T){(g!=="number"||gr(f.ownerDocument)!==f)&&(T==null?f.defaultValue=""+f._wrapperState.initialValue:f.defaultValue!==""+T&&(f.defaultValue=""+T))}var We=Array.isArray;function mt(f,g,T,A){if(f=f.options,g){g={};for(var x=0;x<T.length;x++)g["$"+T[x]]=!0;for(T=0;T<f.length;T++)x=g.hasOwnProperty("$"+f[T].value),f[T].selected!==x&&(f[T].selected=x),x&&A&&(f[T].defaultSelected=!0)}else{for(T=""+Ht(T),g=null,x=0;x<f.length;x++){if(f[x].value===T){f[x].selected=!0,A&&(f[x].defaultSelected=!0);return}g!==null||f[x].disabled||(g=f[x])}g!==null&&(g.selected=!0)}}function gt(f,g){if(g.dangerouslySetInnerHTML!=null)throw Error(o(91));return Ee({},g,{value:void 0,defaultValue:void 0,children:""+f._wrapperState.initialValue})}function ht(f,g){var T=g.value;if(T==null){if(T=g.children,g=g.defaultValue,T!=null){if(g!=null)throw Error(o(92));if(We(T)){if(1<T.length)throw Error(o(93));T=T[0]}g=T}g==null&&(g=""),T=g}f._wrapperState={initialValue:Ht(T)}}function Mt(f,g){var T=Ht(g.value),A=Ht(g.defaultValue);T!=null&&(T=""+T,T!==f.value&&(f.value=T),g.defaultValue==null&&f.defaultValue!==T&&(f.defaultValue=T)),A!=null&&(f.defaultValue=""+A)}function jn(f){var g=f.textContent;g===f._wrapperState.initialValue&&g!==""&&g!==null&&(f.value=g)}function On(f){switch(f){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function nn(f,g){return f==null||f==="http://www.w3.org/1999/xhtml"?On(g):f==="http://www.w3.org/2000/svg"&&g==="foreignObject"?"http://www.w3.org/1999/xhtml":f}var _r,Ra=function(f){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(g,T,A,x){MSApp.execUnsafeLocalFunction(function(){return f(g,T,A,x)})}:f}(function(f,g){if(f.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in f)f.innerHTML=g;else{for(_r=_r||document.createElement("div"),_r.innerHTML="<svg>"+g.valueOf().toString()+"</svg>",g=_r.firstChild;f.firstChild;)f.removeChild(f.firstChild);for(;g.firstChild;)f.appendChild(g.firstChild)}});function _o(f,g){if(g){var T=f.firstChild;if(T&&T===f.lastChild&&T.nodeType===3){T.nodeValue=g;return}}f.textContent=g}var ns={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Lt=["Webkit","ms","Moz","O"];Object.keys(ns).forEach(function(f){Lt.forEach(function(g){g=g+f.charAt(0).toUpperCase()+f.substring(1),ns[g]=ns[f]})});function fn(f,g,T){return g==null||typeof g=="boolean"||g===""?"":T||typeof g!="number"||g===0||ns.hasOwnProperty(f)&&ns[f]?(""+g).trim():g+"px"}function rs(f,g){f=f.style;for(var T in g)if(g.hasOwnProperty(T)){var A=T.indexOf("--")===0,x=fn(T,g[T],A);T==="float"&&(T="cssFloat"),A?f.setProperty(T,x):f[T]=x}}var or=Ee({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function $i(f,g){if(g){if(or[f]&&(g.children!=null||g.dangerouslySetInnerHTML!=null))throw Error(o(137,f));if(g.dangerouslySetInnerHTML!=null){if(g.children!=null)throw Error(o(60));if(typeof g.dangerouslySetInnerHTML!="object"||!("__html"in g.dangerouslySetInnerHTML))throw Error(o(61))}if(g.style!=null&&typeof g.style!="object")throw Error(o(62))}}function Mc(f,g){if(f.indexOf("-")===-1)return typeof g.is=="string";switch(f){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var $a=null;function _s(f){return f=f.target||f.srcElement||window,f.correspondingUseElement&&(f=f.correspondingUseElement),f.nodeType===3?f.parentNode:f}var qa=null,Ui=null,Po=null;function Ys(f){if(f=gp(f)){if(typeof qa!="function")throw Error(o(280));var g=f.stateNode;g&&(g=_p(g),qa(f.stateNode,f.type,g))}}function Ya(f){Ui?Po?Po.push(f):Po=[f]:Ui=f}function Uc(){if(Ui){var f=Ui,g=Po;if(Po=Ui=null,Ys(f),g)for(f=0;f<g.length;f++)Ys(g[f])}}function lu(f,g){return f(g)}function Xa(){}var Vc=!1;function vs(f,g,T){if(Vc)return f(g,T);Vc=!0;try{return lu(f,g,T)}finally{Vc=!1,(Ui!==null||Po!==null)&&(Xa(),Uc())}}function Ci(f,g){var T=f.stateNode;if(T===null)return null;var A=_p(T);if(A===null)return null;T=A[g];e:switch(g){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(A=!A.disabled)||(f=f.type,A=!(f==="button"||f==="input"||f==="select"||f==="textarea")),f=!A;break e;default:f=!1}if(f)return null;if(T&&typeof T!="function")throw Error(o(231,g,typeof T));return T}var ro=!1;if(v)try{var Ca={};Object.defineProperty(Ca,"passive",{get:function(){ro=!0}}),window.addEventListener("test",Ca,Ca),window.removeEventListener("test",Ca,Ca)}catch{ro=!1}function uu(f,g,T,A,x,W,ie,Se,Ae){var ze=Array.prototype.slice.call(arguments,3);try{g.apply(T,ze)}catch(Et){this.onError(Et)}}var Ja=!1,Xs=null,Js=!1,sd=null,Hm={onError:function(f){Ja=!0,Xs=f}};function du(f,g,T,A,x,W,ie,Se,Ae){Ja=!1,Xs=null,uu.apply(Hm,arguments)}function Nh(f,g,T,A,x,W,ie,Se,Ae){if(du.apply(this,arguments),Ja){if(Ja){var ze=Xs;Ja=!1,Xs=null}else throw Error(o(198));Js||(Js=!0,sd=ze)}}function No(f){var g=f,T=f;if(f.alternate)for(;g.return;)g=g.return;else{f=g;do g=f,(g.flags&4098)!==0&&(T=g.return),f=g.return;while(f)}return g.tag===3?T:null}function hu(f){if(f.tag===13){var g=f.memoizedState;if(g===null&&(f=f.alternate,f!==null&&(g=f.memoizedState)),g!==null)return g.dehydrated}return null}function Qs(f){if(No(f)!==f)throw Error(o(188))}function ad(f){var g=f.alternate;if(!g){if(g=No(f),g===null)throw Error(o(188));return g!==f?null:f}for(var T=f,A=g;;){var x=T.return;if(x===null)break;var W=x.alternate;if(W===null){if(A=x.return,A!==null){T=A;continue}break}if(x.child===W.child){for(W=x.child;W;){if(W===T)return Qs(x),f;if(W===A)return Qs(x),g;W=W.sibling}throw Error(o(188))}if(T.return!==A.return)T=x,A=W;else{for(var ie=!1,Se=x.child;Se;){if(Se===T){ie=!0,T=x,A=W;break}if(Se===A){ie=!0,A=x,T=W;break}Se=Se.sibling}if(!ie){for(Se=W.child;Se;){if(Se===T){ie=!0,T=W,A=x;break}if(Se===A){ie=!0,A=W,T=x;break}Se=Se.sibling}if(!ie)throw Error(o(189))}}if(T.alternate!==A)throw Error(o(190))}if(T.tag!==3)throw Error(o(188));return T.stateNode.current===T?f:g}function cd(f){return f=ad(f),f!==null?Ia(f):null}function Ia(f){if(f.tag===5||f.tag===6)return f;for(f=f.child;f!==null;){var g=Ia(f);if(g!==null)return g;f=f.sibling}return null}var ld=t.unstable_scheduleCallback,fu=t.unstable_cancelCallback,Es=t.unstable_shouldYield,ud=t.unstable_requestPaint,Ur=t.unstable_now,ui=t.unstable_getCurrentPriorityLevel,Qa=t.unstable_ImmediatePriority,Fc=t.unstable_UserBlockingPriority,Zs=t.unstable_NormalPriority,kh=t.unstable_LowPriority,dd=t.unstable_IdlePriority,_l=null,is=null;function tp(f){if(is&&typeof is.onCommitFiberRoot=="function")try{is.onCommitFiberRoot(_l,f,void 0,(f.current.flags&128)===128)}catch{}}var Wo=Math.clz32?Math.clz32:hd,Dh=Math.log,jc=Math.LN2;function hd(f){return f>>>=0,f===0?32:31-(Dh(f)/jc|0)|0}var fd=64,sr=4194304;function vl(f){switch(f&-f){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return f&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return f&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return f}}function El(f,g){var T=f.pendingLanes;if(T===0)return 0;var A=0,x=f.suspendedLanes,W=f.pingedLanes,ie=T&268435455;if(ie!==0){var Se=ie&~x;Se!==0?A=vl(Se):(W&=ie,W!==0&&(A=vl(W)))}else ie=T&~x,ie!==0?A=vl(ie):W!==0&&(A=vl(W));if(A===0)return 0;if(g!==0&&g!==A&&(g&x)===0&&(x=A&-A,W=g&-g,x>=W||x===16&&(W&4194240)!==0))return g;if((A&4)!==0&&(A|=T&16),g=f.entangledLanes,g!==0)for(f=f.entanglements,g&=A;0<g;)T=31-Wo(g),x=1<<T,A|=f[T],g&=~x;return A}function pu(f,g){switch(f){case 1:case 2:case 4:return g+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return g+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Aa(f,g){for(var T=f.suspendedLanes,A=f.pingedLanes,x=f.expirationTimes,W=f.pendingLanes;0<W;){var ie=31-Wo(W),Se=1<<ie,Ae=x[ie];Ae===-1?((Se&T)===0||(Se&A)!==0)&&(x[ie]=pu(Se,g)):Ae<=g&&(f.expiredLanes|=Se),W&=~Se}}function ys(f){return f=f.pendingLanes&-1073741825,f!==0?f:f&1073741824?1073741824:0}function mu(){var f=fd;return fd<<=1,(fd&4194240)===0&&(fd=64),f}function Bc(f){for(var g=[],T=0;31>T;T++)g.push(f);return g}function yl(f,g,T){f.pendingLanes|=g,g!==536870912&&(f.suspendedLanes=0,f.pingedLanes=0),f=f.eventTimes,g=31-Wo(g),f[g]=T}function Wr(f,g){var T=f.pendingLanes&~g;f.pendingLanes=g,f.suspendedLanes=0,f.pingedLanes=0,f.expiredLanes&=g,f.mutableReadLanes&=g,f.entangledLanes&=g,g=f.entanglements;var A=f.eventTimes;for(f=f.expirationTimes;0<T;){var x=31-Wo(T),W=1<<x;g[x]=0,A[x]=-1,f[x]=-1,T&=~W}}function Oa(f,g){var T=f.entangledLanes|=g;for(f=f.entanglements;T;){var A=31-Wo(T),x=1<<A;x&g|f[A]&g&&(f[A]|=g),T&=~x}}var Jn=0;function Za(f){return f&=-f,1<f?4<f?(f&268435455)!==0?16:536870912:4:1}var np,Sl,pd,Lh,rp,xh=!1,Ss=[],qi=null,Ts=null,bs=null,Tl=new Map,ws=new Map,Rs=[],ip="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function ec(f,g){switch(f){case"focusin":case"focusout":qi=null;break;case"dragenter":case"dragleave":Ts=null;break;case"mouseover":case"mouseout":bs=null;break;case"pointerover":case"pointerout":Tl.delete(g.pointerId);break;case"gotpointercapture":case"lostpointercapture":ws.delete(g.pointerId)}}function io(f,g,T,A,x,W){return f===null||f.nativeEvent!==W?(f={blockedOn:g,domEventName:T,eventSystemFlags:A,nativeEvent:W,targetContainers:[x]},g!==null&&(g=gp(g),g!==null&&Sl(g)),f):(f.eventSystemFlags|=A,g=f.targetContainers,x!==null&&g.indexOf(x)===-1&&g.push(x),f)}function gu(f,g,T,A,x){switch(g){case"focusin":return qi=io(qi,f,g,T,A,x),!0;case"dragenter":return Ts=io(Ts,f,g,T,A,x),!0;case"mouseover":return bs=io(bs,f,g,T,A,x),!0;case"pointerover":var W=x.pointerId;return Tl.set(W,io(Tl.get(W)||null,f,g,T,A,x)),!0;case"gotpointercapture":return W=x.pointerId,ws.set(W,io(ws.get(W)||null,f,g,T,A,x)),!0}return!1}function Mh(f){var g=zh(f.target);if(g!==null){var T=No(g);if(T!==null){if(g=T.tag,g===13){if(g=hu(T),g!==null){f.blockedOn=g,rp(f.priority,function(){pd(T)});return}}else if(g===3&&T.stateNode.current.memoizedState.isDehydrated){f.blockedOn=T.tag===3?T.stateNode.containerInfo:null;return}}}f.blockedOn=null}function Wc(f){if(f.blockedOn!==null)return!1;for(var g=f.targetContainers;0<g.length;){var T=hr(f.domEventName,f.eventSystemFlags,g[0],f.nativeEvent);if(T===null){T=f.nativeEvent;var A=new T.constructor(T.type,T);$a=A,T.target.dispatchEvent(A),$a=null}else return g=gp(T),g!==null&&Sl(g),f.blockedOn=T,!1;g.shift()}return!0}function bl(f,g,T){Wc(f)&&T.delete(g)}function op(){xh=!1,qi!==null&&Wc(qi)&&(qi=null),Ts!==null&&Wc(Ts)&&(Ts=null),bs!==null&&Wc(bs)&&(bs=null),Tl.forEach(bl),ws.forEach(bl)}function ea(f,g){f.blockedOn===g&&(f.blockedOn=null,xh||(xh=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,op)))}function ta(f){function g(x){return ea(x,f)}if(0<Ss.length){ea(Ss[0],f);for(var T=1;T<Ss.length;T++){var A=Ss[T];A.blockedOn===f&&(A.blockedOn=null)}}for(qi!==null&&ea(qi,f),Ts!==null&&ea(Ts,f),bs!==null&&ea(bs,f),Tl.forEach(g),ws.forEach(g),T=0;T<Rs.length;T++)A=Rs[T],A.blockedOn===f&&(A.blockedOn=null);for(;0<Rs.length&&(T=Rs[0],T.blockedOn===null);)Mh(T),T.blockedOn===null&&Rs.shift()}var Gc=se.ReactCurrentBatchConfig,_e=!0;function Ce(f,g,T,A){var x=Jn,W=Gc.transition;Gc.transition=null;try{Jn=1,Bt(f,g,T,A)}finally{Jn=x,Gc.transition=W}}function Ge(f,g,T,A){var x=Jn,W=Gc.transition;Gc.transition=null;try{Jn=4,Bt(f,g,T,A)}finally{Jn=x,Gc.transition=W}}function Bt(f,g,T,A){if(_e){var x=hr(f,g,T,A);if(x===null)yv(f,g,A,Wn,T),ec(f,A);else if(gu(x,f,g,T,A))A.stopPropagation();else if(ec(f,A),g&4&&-1<ip.indexOf(f)){for(;x!==null;){var W=gp(x);if(W!==null&&np(W),W=hr(f,g,T,A),W===null&&yv(f,g,A,Wn,T),W===x)break;x=W}x!==null&&A.stopPropagation()}else yv(f,g,A,null,T)}}var Wn=null;function hr(f,g,T,A){if(Wn=null,f=_s(A),f=zh(f),f!==null)if(g=No(f),g===null)f=null;else if(T=g.tag,T===13){if(f=hu(g),f!==null)return f;f=null}else if(T===3){if(g.stateNode.current.memoizedState.isDehydrated)return g.tag===3?g.stateNode.containerInfo:null;f=null}else g!==f&&(f=null);return Wn=f,null}function Vr(f){switch(f){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(ui()){case Qa:return 1;case Fc:return 4;case Zs:case kh:return 16;case dd:return 536870912;default:return 16}default:return 16}}var Qt=null,Or=null,di=null;function vo(){if(di)return di;var f,g=Or,T=g.length,A,x="value"in Qt?Qt.value:Qt.textContent,W=x.length;for(f=0;f<T&&g[f]===x[f];f++);var ie=T-f;for(A=1;A<=ie&&g[T-A]===x[W-A];A++);return di=x.slice(f,1<A?1-A:void 0)}function Cs(f){var g=f.keyCode;return"charCode"in f?(f=f.charCode,f===0&&g===13&&(f=13)):f=g,f===10&&(f=13),32<=f||f===13?f:0}function Is(){return!0}function _u(){return!1}function Vi(f){function g(T,A,x,W,ie){this._reactName=T,this._targetInst=x,this.type=A,this.nativeEvent=W,this.target=ie,this.currentTarget=null;for(var Se in f)f.hasOwnProperty(Se)&&(T=f[Se],this[Se]=T?T(W):W[Se]);return this.isDefaultPrevented=(W.defaultPrevented!=null?W.defaultPrevented:W.returnValue===!1)?Is:_u,this.isPropagationStopped=_u,this}return Ee(g.prototype,{preventDefault:function(){this.defaultPrevented=!0;var T=this.nativeEvent;T&&(T.preventDefault?T.preventDefault():typeof T.returnValue!="unknown"&&(T.returnValue=!1),this.isDefaultPrevented=Is)},stopPropagation:function(){var T=this.nativeEvent;T&&(T.stopPropagation?T.stopPropagation():typeof T.cancelBubble!="unknown"&&(T.cancelBubble=!0),this.isPropagationStopped=Is)},persist:function(){},isPersistent:Is}),g}var zc={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(f){return f.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},md=Vi(zc),tc=Ee({},zc,{view:0,detail:0}),Km=Vi(tc),sp,vu,As,wl=Ee({},tc,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:nc,button:0,buttons:0,relatedTarget:function(f){return f.relatedTarget===void 0?f.fromElement===f.srcElement?f.toElement:f.fromElement:f.relatedTarget},movementX:function(f){return"movementX"in f?f.movementX:(f!==As&&(As&&f.type==="mousemove"?(sp=f.screenX-As.screenX,vu=f.screenY-As.screenY):vu=sp=0,As=f),sp)},movementY:function(f){return"movementY"in f?f.movementY:vu}}),ap=Vi(wl),$m=Ee({},wl,{dataTransfer:0}),hv=Vi($m),cp=Ee({},tc,{relatedTarget:0}),lp=Vi(cp),Eu=Ee({},zc,{animationName:0,elapsedTime:0,pseudoElement:0}),yu=Vi(Eu),Su=Ee({},zc,{clipboardData:function(f){return"clipboardData"in f?f.clipboardData:window.clipboardData}}),qm=Vi(Su),fv=Ee({},zc,{data:0}),Pn=Vi(fv),up={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Os={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},pv={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function mv(f){var g=this.nativeEvent;return g.getModifierState?g.getModifierState(f):(f=pv[f])?!!g[f]:!1}function nc(){return mv}var C=Ee({},tc,{key:function(f){if(f.key){var g=up[f.key]||f.key;if(g!=="Unidentified")return g}return f.type==="keypress"?(f=Cs(f),f===13?"Enter":String.fromCharCode(f)):f.type==="keydown"||f.type==="keyup"?Os[f.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:nc,charCode:function(f){return f.type==="keypress"?Cs(f):0},keyCode:function(f){return f.type==="keydown"||f.type==="keyup"?f.keyCode:0},which:function(f){return f.type==="keypress"?Cs(f):f.type==="keydown"||f.type==="keyup"?f.keyCode:0}}),j=Vi(C),X=Ee({},wl,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),he=Vi(X),Me=Ee({},tc,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:nc}),qe=Vi(Me),At=Ee({},zc,{propertyName:0,elapsedTime:0,pseudoElement:0}),Gr=Vi(At),ti=Ee({},wl,{deltaX:function(f){return"deltaX"in f?f.deltaX:"wheelDeltaX"in f?-f.wheelDeltaX:0},deltaY:function(f){return"deltaY"in f?f.deltaY:"wheelDeltaY"in f?-f.wheelDeltaY:"wheelDelta"in f?-f.wheelDelta:0},deltaZ:0,deltaMode:0}),fr=Vi(ti),ko=[9,13,27,32],oo=v&&"CompositionEvent"in window,Pa=null;v&&"documentMode"in document&&(Pa=document.documentMode);var Ps=v&&"TextEvent"in window&&!Pa,Uh=v&&(!oo||Pa&&8<Pa&&11>=Pa),dp=" ",Na=!1;function gR(f,g){switch(f){case"keyup":return ko.indexOf(g.keyCode)!==-1;case"keydown":return g.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function _R(f){return f=f.detail,typeof f=="object"&&"data"in f?f.data:null}var hp=!1;function lk(f,g){switch(f){case"compositionend":return _R(g);case"keypress":return g.which!==32?null:(Na=!0,dp);case"textInput":return f=g.data,f===dp&&Na?null:f;default:return null}}function vR(f,g){if(hp)return f==="compositionend"||!oo&&gR(f,g)?(f=vo(),di=Or=Qt=null,hp=!1,f):null;switch(f){case"paste":return null;case"keypress":if(!(g.ctrlKey||g.altKey||g.metaKey)||g.ctrlKey&&g.altKey){if(g.char&&1<g.char.length)return g.char;if(g.which)return String.fromCharCode(g.which)}return null;case"compositionend":return Uh&&g.locale!=="ko"?null:g.data;default:return null}}var uk={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function ER(f){var g=f&&f.nodeName&&f.nodeName.toLowerCase();return g==="input"?!!uk[f.type]:g==="textarea"}function xS(f,g,T,A){Ya(A),g=Sv(g,"onChange"),0<g.length&&(T=new md("onChange","change",null,T,A),f.push({event:T,listeners:g}))}var Vh=null,Ym=null;function dk(f){WS(f,0)}function Fh(f){var g=Hh(f);if(hn(g))return f}function hk(f,g){if(f==="change")return g}var yR=!1;if(v){var MS;if(v){var rc="oninput"in document;if(!rc){var SR=document.createElement("div");SR.setAttribute("oninput","return;"),rc=typeof SR.oninput=="function"}MS=rc}else MS=!1;yR=MS&&(!document.documentMode||9<document.documentMode)}function TR(){Vh&&(Vh.detachEvent("onpropertychange",na),Ym=Vh=null)}function na(f){if(f.propertyName==="value"&&Fh(Ym)){var g=[];xS(g,Ym,f,_s(f)),vs(dk,g)}}function fk(f,g,T){f==="focusin"?(TR(),Vh=g,Ym=T,Vh.attachEvent("onpropertychange",na)):f==="focusout"&&TR()}function pk(f){if(f==="selectionchange"||f==="keyup"||f==="keydown")return Fh(Ym)}function mk(f,g){if(f==="click")return Fh(g)}function gk(f,g){if(f==="input"||f==="change")return Fh(g)}function bR(f,g){return f===g&&(f!==0||1/f===1/g)||f!==f&&g!==g}var Hc=typeof Object.is=="function"?Object.is:bR;function Xm(f,g){if(Hc(f,g))return!0;if(typeof f!="object"||f===null||typeof g!="object"||g===null)return!1;var T=Object.keys(f),A=Object.keys(g);if(T.length!==A.length)return!1;for(A=0;A<T.length;A++){var x=T[A];if(!y.call(g,x)||!Hc(f[x],g[x]))return!1}return!0}function wR(f){for(;f&&f.firstChild;)f=f.firstChild;return f}function US(f,g){var T=wR(f);f=0;for(var A;T;){if(T.nodeType===3){if(A=f+T.textContent.length,f<=g&&A>=g)return{node:T,offset:g-f};f=A}e:{for(;T;){if(T.nextSibling){T=T.nextSibling;break e}T=T.parentNode}T=void 0}T=wR(T)}}function RR(f,g){return f&&g?f===g?!0:f&&f.nodeType===3?!1:g&&g.nodeType===3?RR(f,g.parentNode):"contains"in f?f.contains(g):f.compareDocumentPosition?!!(f.compareDocumentPosition(g)&16):!1:!1}function CR(){for(var f=window,g=gr();g instanceof f.HTMLIFrameElement;){try{var T=typeof g.contentWindow.location.href=="string"}catch{T=!1}if(T)f=g.contentWindow;else break;g=gr(f.document)}return g}function Jm(f){var g=f&&f.nodeName&&f.nodeName.toLowerCase();return g&&(g==="input"&&(f.type==="text"||f.type==="search"||f.type==="tel"||f.type==="url"||f.type==="password")||g==="textarea"||f.contentEditable==="true")}function VS(f){var g=CR(),T=f.focusedElem,A=f.selectionRange;if(g!==T&&T&&T.ownerDocument&&RR(T.ownerDocument.documentElement,T)){if(A!==null&&Jm(T)){if(g=A.start,f=A.end,f===void 0&&(f=g),"selectionStart"in T)T.selectionStart=g,T.selectionEnd=Math.min(f,T.value.length);else if(f=(g=T.ownerDocument||document)&&g.defaultView||window,f.getSelection){f=f.getSelection();var x=T.textContent.length,W=Math.min(A.start,x);A=A.end===void 0?W:Math.min(A.end,x),!f.extend&&W>A&&(x=A,A=W,W=x),x=US(T,W);var ie=US(T,A);x&&ie&&(f.rangeCount!==1||f.anchorNode!==x.node||f.anchorOffset!==x.offset||f.focusNode!==ie.node||f.focusOffset!==ie.offset)&&(g=g.createRange(),g.setStart(x.node,x.offset),f.removeAllRanges(),W>A?(f.addRange(g),f.extend(ie.node,ie.offset)):(g.setEnd(ie.node,ie.offset),f.addRange(g)))}}for(g=[],f=T;f=f.parentNode;)f.nodeType===1&&g.push({element:f,left:f.scrollLeft,top:f.scrollTop});for(typeof T.focus=="function"&&T.focus(),T=0;T<g.length;T++)f=g[T],f.element.scrollLeft=f.left,f.element.scrollTop=f.top}}var _k=v&&"documentMode"in document&&11>=document.documentMode,$e=null,FS=null,Qm=null,jS=!1;function IR(f,g,T){var A=T.window===T?T.document:T.nodeType===9?T:T.ownerDocument;jS||$e==null||$e!==gr(A)||(A=$e,"selectionStart"in A&&Jm(A)?A={start:A.selectionStart,end:A.selectionEnd}:(A=(A.ownerDocument&&A.ownerDocument.defaultView||window).getSelection(),A={anchorNode:A.anchorNode,anchorOffset:A.anchorOffset,focusNode:A.focusNode,focusOffset:A.focusOffset}),Qm&&Xm(Qm,A)||(Qm=A,A=Sv(FS,"onSelect"),0<A.length&&(g=new md("onSelect","select",null,g,T),f.push({event:g,listeners:A}),g.target=$e)))}function gv(f,g){var T={};return T[f.toLowerCase()]=g.toLowerCase(),T["Webkit"+f]="webkit"+g,T["Moz"+f]="moz"+g,T}var fp={animationend:gv("Animation","AnimationEnd"),animationiteration:gv("Animation","AnimationIteration"),animationstart:gv("Animation","AnimationStart"),transitionend:gv("Transition","TransitionEnd")},BS={},AR={};v&&(AR=document.createElement("div").style,"AnimationEvent"in window||(delete fp.animationend.animation,delete fp.animationiteration.animation,delete fp.animationstart.animation),"TransitionEvent"in window||delete fp.transitionend.transition);function jh(f){if(BS[f])return BS[f];if(!fp[f])return f;var g=fp[f],T;for(T in g)if(g.hasOwnProperty(T)&&T in AR)return BS[f]=g[T];return f}var Bh=jh("animationend"),OR=jh("animationiteration"),PR=jh("animationstart"),NR=jh("transitionend"),kR=new Map,_v="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function gd(f,g){kR.set(f,g),d(g,[f])}for(var vv=0;vv<_v.length;vv++){var ka=_v[vv],vk=ka.toLowerCase(),Zm=ka[0].toUpperCase()+ka.slice(1);gd(vk,"on"+Zm)}gd(Bh,"onAnimationEnd"),gd(OR,"onAnimationIteration"),gd(PR,"onAnimationStart"),gd("dblclick","onDoubleClick"),gd("focusin","onFocus"),gd("focusout","onBlur"),gd(NR,"onTransitionEnd"),m("onMouseEnter",["mouseout","mouseover"]),m("onMouseLeave",["mouseout","mouseover"]),m("onPointerEnter",["pointerout","pointerover"]),m("onPointerLeave",["pointerout","pointerover"]),d("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),d("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),d("onBeforeInput",["compositionend","keypress","textInput","paste"]),d("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),d("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),d("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var eg="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Ek=new Set("cancel close invalid load scroll toggle".split(" ").concat(eg));function DR(f,g,T){var A=f.type||"unknown-event";f.currentTarget=T,Nh(A,g,void 0,f),f.currentTarget=null}function WS(f,g){g=(g&4)!==0;for(var T=0;T<f.length;T++){var A=f[T],x=A.event;A=A.listeners;e:{var W=void 0;if(g)for(var ie=A.length-1;0<=ie;ie--){var Se=A[ie],Ae=Se.instance,ze=Se.currentTarget;if(Se=Se.listener,Ae!==W&&x.isPropagationStopped())break e;DR(x,Se,ze),W=Ae}else for(ie=0;ie<A.length;ie++){if(Se=A[ie],Ae=Se.instance,ze=Se.currentTarget,Se=Se.listener,Ae!==W&&x.isPropagationStopped())break e;DR(x,Se,ze),W=Ae}}}if(Js)throw f=sd,Js=!1,sd=null,f}function vi(f,g){var T=g[ig];T===void 0&&(T=g[ig]=new Set);var A=f+"__bubble";T.has(A)||(LR(g,f,2,!1),T.add(A))}function GS(f,g,T){var A=0;g&&(A|=4),LR(T,f,A,g)}var Ev="_reactListening"+Math.random().toString(36).slice(2);function Wh(f){if(!f[Ev]){f[Ev]=!0,a.forEach(function(T){T!=="selectionchange"&&(Ek.has(T)||GS(T,!1,f),GS(T,!0,f))});var g=f.nodeType===9?f:f.ownerDocument;g===null||g[Ev]||(g[Ev]=!0,GS("selectionchange",!1,g))}}function LR(f,g,T,A){switch(Vr(g)){case 1:var x=Ce;break;case 4:x=Ge;break;default:x=Bt}T=x.bind(null,g,T,f),x=void 0,!ro||g!=="touchstart"&&g!=="touchmove"&&g!=="wheel"||(x=!0),A?x!==void 0?f.addEventListener(g,T,{capture:!0,passive:x}):f.addEventListener(g,T,!0):x!==void 0?f.addEventListener(g,T,{passive:x}):f.addEventListener(g,T,!1)}function yv(f,g,T,A,x){var W=A;if((g&1)===0&&(g&2)===0&&A!==null)e:for(;;){if(A===null)return;var ie=A.tag;if(ie===3||ie===4){var Se=A.stateNode.containerInfo;if(Se===x||Se.nodeType===8&&Se.parentNode===x)break;if(ie===4)for(ie=A.return;ie!==null;){var Ae=ie.tag;if((Ae===3||Ae===4)&&(Ae=ie.stateNode.containerInfo,Ae===x||Ae.nodeType===8&&Ae.parentNode===x))return;ie=ie.return}for(;Se!==null;){if(ie=zh(Se),ie===null)return;if(Ae=ie.tag,Ae===5||Ae===6){A=W=ie;continue e}Se=Se.parentNode}}A=A.return}vs(function(){var ze=W,Et=_s(T),St=[];e:{var vt=kR.get(f);if(vt!==void 0){var Ft=md,Kt=f;switch(f){case"keypress":if(Cs(T)===0)break e;case"keydown":case"keyup":Ft=j;break;case"focusin":Kt="focus",Ft=lp;break;case"focusout":Kt="blur",Ft=lp;break;case"beforeblur":case"afterblur":Ft=lp;break;case"click":if(T.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Ft=ap;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Ft=hv;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Ft=qe;break;case Bh:case OR:case PR:Ft=yu;break;case NR:Ft=Gr;break;case"scroll":Ft=Km;break;case"wheel":Ft=fr;break;case"copy":case"cut":case"paste":Ft=qm;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Ft=he}var Yt=(g&4)!==0,Yi=!Yt&&f==="scroll",Ue=Yt?vt!==null?vt+"Capture":null:vt;Yt=[];for(var Oe=ze,Be;Oe!==null;){Be=Oe;var wt=Be.stateNode;if(Be.tag===5&&wt!==null&&(Be=wt,Ue!==null&&(wt=Ci(Oe,Ue),wt!=null&&Yt.push(pp(Oe,wt,Be)))),Yi)break;Oe=Oe.return}0<Yt.length&&(vt=new Ft(vt,Kt,null,T,Et),St.push({event:vt,listeners:Yt}))}}if((g&7)===0){e:{if(vt=f==="mouseover"||f==="pointerover",Ft=f==="mouseout"||f==="pointerout",vt&&T!==$a&&(Kt=T.relatedTarget||T.fromElement)&&(zh(Kt)||Kt[ic]))break e;if((Ft||vt)&&(vt=Et.window===Et?Et:(vt=Et.ownerDocument)?vt.defaultView||vt.parentWindow:window,Ft?(Kt=T.relatedTarget||T.toElement,Ft=ze,Kt=Kt?zh(Kt):null,Kt!==null&&(Yi=No(Kt),Kt!==Yi||Kt.tag!==5&&Kt.tag!==6)&&(Kt=null)):(Ft=null,Kt=ze),Ft!==Kt)){if(Yt=ap,wt="onMouseLeave",Ue="onMouseEnter",Oe="mouse",(f==="pointerout"||f==="pointerover")&&(Yt=he,wt="onPointerLeave",Ue="onPointerEnter",Oe="pointer"),Yi=Ft==null?vt:Hh(Ft),Be=Kt==null?vt:Hh(Kt),vt=new Yt(wt,Oe+"leave",Ft,T,Et),vt.target=Yi,vt.relatedTarget=Be,wt=null,zh(Et)===ze&&(Yt=new Yt(Ue,Oe+"enter",Kt,T,Et),Yt.target=Be,Yt.relatedTarget=Yi,wt=Yt),Yi=wt,Ft&&Kt)t:{for(Yt=Ft,Ue=Kt,Oe=0,Be=Yt;Be;Be=Gh(Be))Oe++;for(Be=0,wt=Ue;wt;wt=Gh(wt))Be++;for(;0<Oe-Be;)Yt=Gh(Yt),Oe--;for(;0<Be-Oe;)Ue=Gh(Ue),Be--;for(;Oe--;){if(Yt===Ue||Ue!==null&&Yt===Ue.alternate)break t;Yt=Gh(Yt),Ue=Gh(Ue)}Yt=null}else Yt=null;Ft!==null&&tg(St,vt,Ft,Yt,!1),Kt!==null&&Yi!==null&&tg(St,Yi,Kt,Yt,!0)}}e:{if(vt=ze?Hh(ze):window,Ft=vt.nodeName&&vt.nodeName.toLowerCase(),Ft==="select"||Ft==="input"&&vt.type==="file")var Jt=hk;else if(ER(vt))if(yR)Jt=gk;else{Jt=pk;var ln=fk}else(Ft=vt.nodeName)&&Ft.toLowerCase()==="input"&&(vt.type==="checkbox"||vt.type==="radio")&&(Jt=mk);if(Jt&&(Jt=Jt(f,ze))){xS(St,Jt,T,Et);break e}ln&&ln(f,vt,ze),f==="focusout"&&(ln=vt._wrapperState)&&ln.controlled&&vt.type==="number"&&De(vt,"number",vt.value)}switch(ln=ze?Hh(ze):window,f){case"focusin":(ER(ln)||ln.contentEditable==="true")&&($e=ln,FS=ze,Qm=null);break;case"focusout":Qm=FS=$e=null;break;case"mousedown":jS=!0;break;case"contextmenu":case"mouseup":case"dragend":jS=!1,IR(St,T,Et);break;case"selectionchange":if(_k)break;case"keydown":case"keyup":IR(St,T,Et)}var rn;if(oo)e:{switch(f){case"compositionstart":var Rn="onCompositionStart";break e;case"compositionend":Rn="onCompositionEnd";break e;case"compositionupdate":Rn="onCompositionUpdate";break e}Rn=void 0}else hp?gR(f,T)&&(Rn="onCompositionEnd"):f==="keydown"&&T.keyCode===229&&(Rn="onCompositionStart");Rn&&(Uh&&T.locale!=="ko"&&(hp||Rn!=="onCompositionStart"?Rn==="onCompositionEnd"&&hp&&(rn=vo()):(Qt=Et,Or="value"in Qt?Qt.value:Qt.textContent,hp=!0)),ln=Sv(ze,Rn),0<ln.length&&(Rn=new Pn(Rn,f,null,T,Et),St.push({event:Rn,listeners:ln}),rn?Rn.data=rn:(rn=_R(T),rn!==null&&(Rn.data=rn)))),(rn=Ps?lk(f,T):vR(f,T))&&(ze=Sv(ze,"onBeforeInput"),0<ze.length&&(Et=new Pn("onBeforeInput","beforeinput",null,T,Et),St.push({event:Et,listeners:ze}),Et.data=rn))}WS(St,g)})}function pp(f,g,T){return{instance:f,listener:g,currentTarget:T}}function Sv(f,g){for(var T=g+"Capture",A=[];f!==null;){var x=f,W=x.stateNode;x.tag===5&&W!==null&&(x=W,W=Ci(f,T),W!=null&&A.unshift(pp(f,W,x)),W=Ci(f,g),W!=null&&A.push(pp(f,W,x))),f=f.return}return A}function Gh(f){if(f===null)return null;do f=f.return;while(f&&f.tag!==5);return f||null}function tg(f,g,T,A,x){for(var W=g._reactName,ie=[];T!==null&&T!==A;){var Se=T,Ae=Se.alternate,ze=Se.stateNode;if(Ae!==null&&Ae===A)break;Se.tag===5&&ze!==null&&(Se=ze,x?(Ae=Ci(T,W),Ae!=null&&ie.unshift(pp(T,Ae,Se))):x||(Ae=Ci(T,W),Ae!=null&&ie.push(pp(T,Ae,Se)))),T=T.return}ie.length!==0&&f.push({event:g,listeners:ie})}var yk=/\r\n?/g,Sk=/\u0000|\uFFFD/g;function xR(f){return(typeof f=="string"?f:""+f).replace(yk,`
`).replace(Sk,"")}function Tv(f,g,T){if(g=xR(g),xR(f)!==g&&T)throw Error(o(425))}function bv(){}var wv=null,ng=null;function zS(f,g){return f==="textarea"||f==="noscript"||typeof g.children=="string"||typeof g.children=="number"||typeof g.dangerouslySetInnerHTML=="object"&&g.dangerouslySetInnerHTML!==null&&g.dangerouslySetInnerHTML.__html!=null}var rg=typeof setTimeout=="function"?setTimeout:void 0,Tk=typeof clearTimeout=="function"?clearTimeout:void 0,MR=typeof Promise=="function"?Promise:void 0,bk=typeof queueMicrotask=="function"?queueMicrotask:typeof MR<"u"?function(f){return MR.resolve(null).then(f).catch(wk)}:rg;function wk(f){setTimeout(function(){throw f})}function HS(f,g){var T=g,A=0;do{var x=T.nextSibling;if(f.removeChild(T),x&&x.nodeType===8)if(T=x.data,T==="/$"){if(A===0){f.removeChild(x),ta(g);return}A--}else T!=="$"&&T!=="$?"&&T!=="$!"||A++;T=x}while(T);ta(g)}function _d(f){for(;f!=null;f=f.nextSibling){var g=f.nodeType;if(g===1||g===3)break;if(g===8){if(g=f.data,g==="$"||g==="$!"||g==="$?")break;if(g==="/$")return null}}return f}function UR(f){f=f.previousSibling;for(var g=0;f;){if(f.nodeType===8){var T=f.data;if(T==="$"||T==="$!"||T==="$?"){if(g===0)return f;g--}else T==="/$"&&g++}f=f.previousSibling}return null}var mp=Math.random().toString(36).slice(2),Rl="__reactFiber$"+mp,vd="__reactProps$"+mp,ic="__reactContainer$"+mp,ig="__reactEvents$"+mp,Rk="__reactListeners$"+mp,Ck="__reactHandles$"+mp;function zh(f){var g=f[Rl];if(g)return g;for(var T=f.parentNode;T;){if(g=T[ic]||T[Rl]){if(T=g.alternate,g.child!==null||T!==null&&T.child!==null)for(f=UR(f);f!==null;){if(T=f[Rl])return T;f=UR(f)}return g}f=T,T=f.parentNode}return null}function gp(f){return f=f[Rl]||f[ic],!f||f.tag!==5&&f.tag!==6&&f.tag!==13&&f.tag!==3?null:f}function Hh(f){if(f.tag===5||f.tag===6)return f.stateNode;throw Error(o(33))}function _p(f){return f[vd]||null}var KS=[],vp=-1;function oc(f){return{current:f}}function Ei(f){0>vp||(f.current=KS[vp],KS[vp]=null,vp--)}function hi(f,g){vp++,KS[vp]=f.current,f.current=g}var Ed={},os=oc(Ed),ra=oc(!1),Kh=Ed;function $h(f,g){var T=f.type.contextTypes;if(!T)return Ed;var A=f.stateNode;if(A&&A.__reactInternalMemoizedUnmaskedChildContext===g)return A.__reactInternalMemoizedMaskedChildContext;var x={},W;for(W in T)x[W]=g[W];return A&&(f=f.stateNode,f.__reactInternalMemoizedUnmaskedChildContext=g,f.__reactInternalMemoizedMaskedChildContext=x),x}function ia(f){return f=f.childContextTypes,f!=null}function Rv(){Ei(ra),Ei(os)}function VR(f,g,T){if(os.current!==Ed)throw Error(o(168));hi(os,g),hi(ra,T)}function Cv(f,g,T){var A=f.stateNode;if(g=g.childContextTypes,typeof A.getChildContext!="function")return T;A=A.getChildContext();for(var x in A)if(!(x in g))throw Error(o(108,Dt(f)||"Unknown",x));return Ee({},T,A)}function Iv(f){return f=(f=f.stateNode)&&f.__reactInternalMemoizedMergedChildContext||Ed,Kh=os.current,hi(os,f),hi(ra,ra.current),!0}function FR(f,g,T){var A=f.stateNode;if(!A)throw Error(o(169));T?(f=Cv(f,g,Kh),A.__reactInternalMemoizedMergedChildContext=f,Ei(ra),Ei(os),hi(os,f)):Ei(ra),hi(ra,T)}var sc=null,Av=!1,$S=!1;function jR(f){sc===null?sc=[f]:sc.push(f)}function Ik(f){Av=!0,jR(f)}function yd(){if(!$S&&sc!==null){$S=!0;var f=0,g=Jn;try{var T=sc;for(Jn=1;f<T.length;f++){var A=T[f];do A=A(!0);while(A!==null)}sc=null,Av=!1}catch(x){throw sc!==null&&(sc=sc.slice(f+1)),ld(Qa,yd),x}finally{Jn=g,$S=!1}}return null}var Ep=[],Tu=0,og=null,Ov=0,ac=[],Da=0,qh=null,bu=1,wu="";function Ru(f,g){Ep[Tu++]=Ov,Ep[Tu++]=og,og=f,Ov=g}function Pv(f,g,T){ac[Da++]=bu,ac[Da++]=wu,ac[Da++]=qh,qh=f;var A=bu;f=wu;var x=32-Wo(A)-1;A&=~(1<<x),T+=1;var W=32-Wo(g)+x;if(30<W){var ie=x-x%5;W=(A&(1<<ie)-1).toString(32),A>>=ie,x-=ie,bu=1<<32-Wo(g)+x|T<<x|A,wu=W+f}else bu=1<<W|T<<x|A,wu=f}function Nv(f){f.return!==null&&(Ru(f,1),Pv(f,1,0))}function sg(f){for(;f===og;)og=Ep[--Tu],Ep[Tu]=null,Ov=Ep[--Tu],Ep[Tu]=null;for(;f===qh;)qh=ac[--Da],ac[Da]=null,wu=ac[--Da],ac[Da]=null,bu=ac[--Da],ac[Da]=null}var oa=null,sa=null,ni=!1,Ns=null;function BR(f,g){var T=Ko(5,null,null,0);T.elementType="DELETED",T.stateNode=g,T.return=f,g=f.deletions,g===null?(f.deletions=[T],f.flags|=16):g.push(T)}function WR(f,g){switch(f.tag){case 5:var T=f.type;return g=g.nodeType!==1||T.toLowerCase()!==g.nodeName.toLowerCase()?null:g,g!==null?(f.stateNode=g,oa=f,sa=_d(g.firstChild),!0):!1;case 6:return g=f.pendingProps===""||g.nodeType!==3?null:g,g!==null?(f.stateNode=g,oa=f,sa=null,!0):!1;case 13:return g=g.nodeType!==8?null:g,g!==null?(T=qh!==null?{id:bu,overflow:wu}:null,f.memoizedState={dehydrated:g,treeContext:T,retryLane:1073741824},T=Ko(18,null,null,0),T.stateNode=g,T.return=f,f.child=T,oa=f,sa=null,!0):!1;default:return!1}}function kv(f){return(f.mode&1)!==0&&(f.flags&128)===0}function qS(f){if(ni){var g=sa;if(g){var T=g;if(!WR(f,g)){if(kv(f))throw Error(o(418));g=_d(T.nextSibling);var A=oa;g&&WR(f,g)?BR(A,T):(f.flags=f.flags&-4097|2,ni=!1,oa=f)}}else{if(kv(f))throw Error(o(418));f.flags=f.flags&-4097|2,ni=!1,oa=f}}}function GR(f){for(f=f.return;f!==null&&f.tag!==5&&f.tag!==3&&f.tag!==13;)f=f.return;oa=f}function ag(f){if(f!==oa)return!1;if(!ni)return GR(f),ni=!0,!1;var g;if((g=f.tag!==3)&&!(g=f.tag!==5)&&(g=f.type,g=g!=="head"&&g!=="body"&&!zS(f.type,f.memoizedProps)),g&&(g=sa)){if(kv(f))throw zR(),Error(o(418));for(;g;)BR(f,g),g=_d(g.nextSibling)}if(GR(f),f.tag===13){if(f=f.memoizedState,f=f!==null?f.dehydrated:null,!f)throw Error(o(317));e:{for(f=f.nextSibling,g=0;f;){if(f.nodeType===8){var T=f.data;if(T==="/$"){if(g===0){sa=_d(f.nextSibling);break e}g--}else T!=="$"&&T!=="$!"&&T!=="$?"||g++}f=f.nextSibling}sa=null}}else sa=oa?_d(f.stateNode.nextSibling):null;return!0}function zR(){for(var f=sa;f;)f=_d(f.nextSibling)}function yp(){sa=oa=null,ni=!1}function YS(f){Ns===null?Ns=[f]:Ns.push(f)}var Ak=se.ReactCurrentBatchConfig;function Kc(f,g){if(f&&f.defaultProps){g=Ee({},g),f=f.defaultProps;for(var T in f)g[T]===void 0&&(g[T]=f[T]);return g}return g}var Dv=oc(null),cg=null,cc=null,XS=null;function JS(){XS=cc=cg=null}function QS(f){var g=Dv.current;Ei(Dv),f._currentValue=g}function Lv(f,g,T){for(;f!==null;){var A=f.alternate;if((f.childLanes&g)!==g?(f.childLanes|=g,A!==null&&(A.childLanes|=g)):A!==null&&(A.childLanes&g)!==g&&(A.childLanes|=g),f===T)break;f=f.return}}function Sp(f,g){cg=f,XS=cc=null,f=f.dependencies,f!==null&&f.firstContext!==null&&((f.lanes&g)!==0&&(aa=!0),f.firstContext=null)}function La(f){var g=f._currentValue;if(XS!==f)if(f={context:f,memoizedValue:g,next:null},cc===null){if(cg===null)throw Error(o(308));cc=f,cg.dependencies={lanes:0,firstContext:f}}else cc=cc.next=f;return g}var Yh=null;function ZS(f){Yh===null?Yh=[f]:Yh.push(f)}function HR(f,g,T,A){var x=g.interleaved;return x===null?(T.next=T,ZS(g)):(T.next=x.next,x.next=T),g.interleaved=T,lc(f,A)}function lc(f,g){f.lanes|=g;var T=f.alternate;for(T!==null&&(T.lanes|=g),T=f,f=f.return;f!==null;)f.childLanes|=g,T=f.alternate,T!==null&&(T.childLanes|=g),T=f,f=f.return;return T.tag===3?T.stateNode:null}var Sd=!1;function eT(f){f.updateQueue={baseState:f.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function KR(f,g){f=f.updateQueue,g.updateQueue===f&&(g.updateQueue={baseState:f.baseState,firstBaseUpdate:f.firstBaseUpdate,lastBaseUpdate:f.lastBaseUpdate,shared:f.shared,effects:f.effects})}function Cu(f,g){return{eventTime:f,lane:g,tag:0,payload:null,callback:null,next:null}}function Td(f,g,T){var A=f.updateQueue;if(A===null)return null;if(A=A.shared,(vr&2)!==0){var x=A.pending;return x===null?g.next=g:(g.next=x.next,x.next=g),A.pending=g,lc(f,T)}return x=A.interleaved,x===null?(g.next=g,ZS(A)):(g.next=x.next,x.next=g),A.interleaved=g,lc(f,T)}function xv(f,g,T){if(g=g.updateQueue,g!==null&&(g=g.shared,(T&4194240)!==0)){var A=g.lanes;A&=f.pendingLanes,T|=A,g.lanes=T,Oa(f,T)}}function Mv(f,g){var T=f.updateQueue,A=f.alternate;if(A!==null&&(A=A.updateQueue,T===A)){var x=null,W=null;if(T=T.firstBaseUpdate,T!==null){do{var ie={eventTime:T.eventTime,lane:T.lane,tag:T.tag,payload:T.payload,callback:T.callback,next:null};W===null?x=W=ie:W=W.next=ie,T=T.next}while(T!==null);W===null?x=W=g:W=W.next=g}else x=W=g;T={baseState:A.baseState,firstBaseUpdate:x,lastBaseUpdate:W,shared:A.shared,effects:A.effects},f.updateQueue=T;return}f=T.lastBaseUpdate,f===null?T.firstBaseUpdate=g:f.next=g,T.lastBaseUpdate=g}function Uv(f,g,T,A){var x=f.updateQueue;Sd=!1;var W=x.firstBaseUpdate,ie=x.lastBaseUpdate,Se=x.shared.pending;if(Se!==null){x.shared.pending=null;var Ae=Se,ze=Ae.next;Ae.next=null,ie===null?W=ze:ie.next=ze,ie=Ae;var Et=f.alternate;Et!==null&&(Et=Et.updateQueue,Se=Et.lastBaseUpdate,Se!==ie&&(Se===null?Et.firstBaseUpdate=ze:Se.next=ze,Et.lastBaseUpdate=Ae))}if(W!==null){var St=x.baseState;ie=0,Et=ze=Ae=null,Se=W;do{var vt=Se.lane,Ft=Se.eventTime;if((A&vt)===vt){Et!==null&&(Et=Et.next={eventTime:Ft,lane:0,tag:Se.tag,payload:Se.payload,callback:Se.callback,next:null});e:{var Kt=f,Yt=Se;switch(vt=g,Ft=T,Yt.tag){case 1:if(Kt=Yt.payload,typeof Kt=="function"){St=Kt.call(Ft,St,vt);break e}St=Kt;break e;case 3:Kt.flags=Kt.flags&-65537|128;case 0:if(Kt=Yt.payload,vt=typeof Kt=="function"?Kt.call(Ft,St,vt):Kt,vt==null)break e;St=Ee({},St,vt);break e;case 2:Sd=!0}}Se.callback!==null&&Se.lane!==0&&(f.flags|=64,vt=x.effects,vt===null?x.effects=[Se]:vt.push(Se))}else Ft={eventTime:Ft,lane:vt,tag:Se.tag,payload:Se.payload,callback:Se.callback,next:null},Et===null?(ze=Et=Ft,Ae=St):Et=Et.next=Ft,ie|=vt;if(Se=Se.next,Se===null){if(Se=x.shared.pending,Se===null)break;vt=Se,Se=vt.next,vt.next=null,x.lastBaseUpdate=vt,x.shared.pending=null}}while(!0);if(Et===null&&(Ae=St),x.baseState=Ae,x.firstBaseUpdate=ze,x.lastBaseUpdate=Et,g=x.shared.interleaved,g!==null){x=g;do ie|=x.lane,x=x.next;while(x!==g)}else W===null&&(x.shared.lanes=0);nf|=ie,f.lanes=ie,f.memoizedState=St}}function tT(f,g,T){if(f=g.effects,g.effects=null,f!==null)for(g=0;g<f.length;g++){var A=f[g],x=A.callback;if(x!==null){if(A.callback=null,A=T,typeof x!="function")throw Error(o(191,x));x.call(A)}}}var $R=new r.Component().refs;function Vv(f,g,T,A){g=f.memoizedState,T=T(A,g),T=T==null?g:Ee({},g,T),f.memoizedState=T,f.lanes===0&&(f.updateQueue.baseState=T)}var Fv={isMounted:function(f){return(f=f._reactInternals)?No(f)===f:!1},enqueueSetState:function(f,g,T){f=f._reactInternals;var A=So(),x=Nu(f),W=Cu(A,x);W.payload=g,T!=null&&(W.callback=T),g=Td(f,W,x),g!==null&&(Ma(g,f,x,A),xv(g,f,x))},enqueueReplaceState:function(f,g,T){f=f._reactInternals;var A=So(),x=Nu(f),W=Cu(A,x);W.tag=1,W.payload=g,T!=null&&(W.callback=T),g=Td(f,W,x),g!==null&&(Ma(g,f,x,A),xv(g,f,x))},enqueueForceUpdate:function(f,g){f=f._reactInternals;var T=So(),A=Nu(f),x=Cu(T,A);x.tag=2,g!=null&&(x.callback=g),g=Td(f,x,A),g!==null&&(Ma(g,f,A,T),xv(g,f,A))}};function qR(f,g,T,A,x,W,ie){return f=f.stateNode,typeof f.shouldComponentUpdate=="function"?f.shouldComponentUpdate(A,W,ie):g.prototype&&g.prototype.isPureReactComponent?!Xm(T,A)||!Xm(x,W):!0}function YR(f,g,T){var A=!1,x=Ed,W=g.contextType;return typeof W=="object"&&W!==null?W=La(W):(x=ia(g)?Kh:os.current,A=g.contextTypes,W=(A=A!=null)?$h(f,x):Ed),g=new g(T,W),f.memoizedState=g.state!==null&&g.state!==void 0?g.state:null,g.updater=Fv,f.stateNode=g,g._reactInternals=f,A&&(f=f.stateNode,f.__reactInternalMemoizedUnmaskedChildContext=x,f.__reactInternalMemoizedMaskedChildContext=W),g}function XR(f,g,T,A){f=g.state,typeof g.componentWillReceiveProps=="function"&&g.componentWillReceiveProps(T,A),typeof g.UNSAFE_componentWillReceiveProps=="function"&&g.UNSAFE_componentWillReceiveProps(T,A),g.state!==f&&Fv.enqueueReplaceState(g,g.state,null)}function nT(f,g,T,A){var x=f.stateNode;x.props=T,x.state=f.memoizedState,x.refs=$R,eT(f);var W=g.contextType;typeof W=="object"&&W!==null?x.context=La(W):(W=ia(g)?Kh:os.current,x.context=$h(f,W)),x.state=f.memoizedState,W=g.getDerivedStateFromProps,typeof W=="function"&&(Vv(f,g,W,T),x.state=f.memoizedState),typeof g.getDerivedStateFromProps=="function"||typeof x.getSnapshotBeforeUpdate=="function"||typeof x.UNSAFE_componentWillMount!="function"&&typeof x.componentWillMount!="function"||(g=x.state,typeof x.componentWillMount=="function"&&x.componentWillMount(),typeof x.UNSAFE_componentWillMount=="function"&&x.UNSAFE_componentWillMount(),g!==x.state&&Fv.enqueueReplaceState(x,x.state,null),Uv(f,T,x,A),x.state=f.memoizedState),typeof x.componentDidMount=="function"&&(f.flags|=4194308)}function lg(f,g,T){if(f=T.ref,f!==null&&typeof f!="function"&&typeof f!="object"){if(T._owner){if(T=T._owner,T){if(T.tag!==1)throw Error(o(309));var A=T.stateNode}if(!A)throw Error(o(147,f));var x=A,W=""+f;return g!==null&&g.ref!==null&&typeof g.ref=="function"&&g.ref._stringRef===W?g.ref:(g=function(ie){var Se=x.refs;Se===$R&&(Se=x.refs={}),ie===null?delete Se[W]:Se[W]=ie},g._stringRef=W,g)}if(typeof f!="string")throw Error(o(284));if(!T._owner)throw Error(o(290,f))}return f}function ug(f,g){throw f=Object.prototype.toString.call(g),Error(o(31,f==="[object Object]"?"object with keys {"+Object.keys(g).join(", ")+"}":f))}function JR(f){var g=f._init;return g(f._payload)}function QR(f){function g(Ue,Oe){if(f){var Be=Ue.deletions;Be===null?(Ue.deletions=[Oe],Ue.flags|=16):Be.push(Oe)}}function T(Ue,Oe){if(!f)return null;for(;Oe!==null;)g(Ue,Oe),Oe=Oe.sibling;return null}function A(Ue,Oe){for(Ue=new Map;Oe!==null;)Oe.key!==null?Ue.set(Oe.key,Oe):Ue.set(Oe.index,Oe),Oe=Oe.sibling;return Ue}function x(Ue,Oe){return Ue=Nd(Ue,Oe),Ue.index=0,Ue.sibling=null,Ue}function W(Ue,Oe,Be){return Ue.index=Be,f?(Be=Ue.alternate,Be!==null?(Be=Be.index,Be<Oe?(Ue.flags|=2,Oe):Be):(Ue.flags|=2,Oe)):(Ue.flags|=1048576,Oe)}function ie(Ue){return f&&Ue.alternate===null&&(Ue.flags|=2),Ue}function Se(Ue,Oe,Be,wt){return Oe===null||Oe.tag!==6?(Oe=MT(Be,Ue.mode,wt),Oe.return=Ue,Oe):(Oe=x(Oe,Be),Oe.return=Ue,Oe)}function Ae(Ue,Oe,Be,wt){var Jt=Be.type;return Jt===Q?Et(Ue,Oe,Be.props.children,wt,Be.key):Oe!==null&&(Oe.elementType===Jt||typeof Jt=="object"&&Jt!==null&&Jt.$$typeof===Xe&&JR(Jt)===Oe.type)?(wt=x(Oe,Be.props),wt.ref=lg(Ue,Oe,Be),wt.return=Ue,wt):(wt=iE(Be.type,Be.key,Be.props,null,Ue.mode,wt),wt.ref=lg(Ue,Oe,Be),wt.return=Ue,wt)}function ze(Ue,Oe,Be,wt){return Oe===null||Oe.tag!==4||Oe.stateNode.containerInfo!==Be.containerInfo||Oe.stateNode.implementation!==Be.implementation?(Oe=UT(Be,Ue.mode,wt),Oe.return=Ue,Oe):(Oe=x(Oe,Be.children||[]),Oe.return=Ue,Oe)}function Et(Ue,Oe,Be,wt,Jt){return Oe===null||Oe.tag!==7?(Oe=Xc(Be,Ue.mode,wt,Jt),Oe.return=Ue,Oe):(Oe=x(Oe,Be),Oe.return=Ue,Oe)}function St(Ue,Oe,Be){if(typeof Oe=="string"&&Oe!==""||typeof Oe=="number")return Oe=MT(""+Oe,Ue.mode,Be),Oe.return=Ue,Oe;if(typeof Oe=="object"&&Oe!==null){switch(Oe.$$typeof){case ae:return Be=iE(Oe.type,Oe.key,Oe.props,null,Ue.mode,Be),Be.ref=lg(Ue,null,Oe),Be.return=Ue,Be;case ye:return Oe=UT(Oe,Ue.mode,Be),Oe.return=Ue,Oe;case Xe:var wt=Oe._init;return St(Ue,wt(Oe._payload),Be)}if(We(Oe)||nt(Oe))return Oe=Xc(Oe,Ue.mode,Be,null),Oe.return=Ue,Oe;ug(Ue,Oe)}return null}function vt(Ue,Oe,Be,wt){var Jt=Oe!==null?Oe.key:null;if(typeof Be=="string"&&Be!==""||typeof Be=="number")return Jt!==null?null:Se(Ue,Oe,""+Be,wt);if(typeof Be=="object"&&Be!==null){switch(Be.$$typeof){case ae:return Be.key===Jt?Ae(Ue,Oe,Be,wt):null;case ye:return Be.key===Jt?ze(Ue,Oe,Be,wt):null;case Xe:return Jt=Be._init,vt(Ue,Oe,Jt(Be._payload),wt)}if(We(Be)||nt(Be))return Jt!==null?null:Et(Ue,Oe,Be,wt,null);ug(Ue,Be)}return null}function Ft(Ue,Oe,Be,wt,Jt){if(typeof wt=="string"&&wt!==""||typeof wt=="number")return Ue=Ue.get(Be)||null,Se(Oe,Ue,""+wt,Jt);if(typeof wt=="object"&&wt!==null){switch(wt.$$typeof){case ae:return Ue=Ue.get(wt.key===null?Be:wt.key)||null,Ae(Oe,Ue,wt,Jt);case ye:return Ue=Ue.get(wt.key===null?Be:wt.key)||null,ze(Oe,Ue,wt,Jt);case Xe:var ln=wt._init;return Ft(Ue,Oe,Be,ln(wt._payload),Jt)}if(We(wt)||nt(wt))return Ue=Ue.get(Be)||null,Et(Oe,Ue,wt,Jt,null);ug(Oe,wt)}return null}function Kt(Ue,Oe,Be,wt){for(var Jt=null,ln=null,rn=Oe,Rn=Oe=0,ao=null;rn!==null&&Rn<Be.length;Rn++){rn.index>Rn?(ao=rn,rn=null):ao=rn.sibling;var wr=vt(Ue,rn,Be[Rn],wt);if(wr===null){rn===null&&(rn=ao);break}f&&rn&&wr.alternate===null&&g(Ue,rn),Oe=W(wr,Oe,Rn),ln===null?Jt=wr:ln.sibling=wr,ln=wr,rn=ao}if(Rn===Be.length)return T(Ue,rn),ni&&Ru(Ue,Rn),Jt;if(rn===null){for(;Rn<Be.length;Rn++)rn=St(Ue,Be[Rn],wt),rn!==null&&(Oe=W(rn,Oe,Rn),ln===null?Jt=rn:ln.sibling=rn,ln=rn);return ni&&Ru(Ue,Rn),Jt}for(rn=A(Ue,rn);Rn<Be.length;Rn++)ao=Ft(rn,Ue,Rn,Be[Rn],wt),ao!==null&&(f&&ao.alternate!==null&&rn.delete(ao.key===null?Rn:ao.key),Oe=W(ao,Oe,Rn),ln===null?Jt=ao:ln.sibling=ao,ln=ao);return f&&rn.forEach(function(kd){return g(Ue,kd)}),ni&&Ru(Ue,Rn),Jt}function Yt(Ue,Oe,Be,wt){var Jt=nt(Be);if(typeof Jt!="function")throw Error(o(150));if(Be=Jt.call(Be),Be==null)throw Error(o(151));for(var ln=Jt=null,rn=Oe,Rn=Oe=0,ao=null,wr=Be.next();rn!==null&&!wr.done;Rn++,wr=Be.next()){rn.index>Rn?(ao=rn,rn=null):ao=rn.sibling;var kd=vt(Ue,rn,wr.value,wt);if(kd===null){rn===null&&(rn=ao);break}f&&rn&&kd.alternate===null&&g(Ue,rn),Oe=W(kd,Oe,Rn),ln===null?Jt=kd:ln.sibling=kd,ln=kd,rn=ao}if(wr.done)return T(Ue,rn),ni&&Ru(Ue,Rn),Jt;if(rn===null){for(;!wr.done;Rn++,wr=Be.next())wr=St(Ue,wr.value,wt),wr!==null&&(Oe=W(wr,Oe,Rn),ln===null?Jt=wr:ln.sibling=wr,ln=wr);return ni&&Ru(Ue,Rn),Jt}for(rn=A(Ue,rn);!wr.done;Rn++,wr=Be.next())wr=Ft(rn,Ue,Rn,wr.value,wt),wr!==null&&(f&&wr.alternate!==null&&rn.delete(wr.key===null?Rn:wr.key),Oe=W(wr,Oe,Rn),ln===null?Jt=wr:ln.sibling=wr,ln=wr);return f&&rn.forEach(function(WC){return g(Ue,WC)}),ni&&Ru(Ue,Rn),Jt}function Yi(Ue,Oe,Be,wt){if(typeof Be=="object"&&Be!==null&&Be.type===Q&&Be.key===null&&(Be=Be.props.children),typeof Be=="object"&&Be!==null){switch(Be.$$typeof){case ae:e:{for(var Jt=Be.key,ln=Oe;ln!==null;){if(ln.key===Jt){if(Jt=Be.type,Jt===Q){if(ln.tag===7){T(Ue,ln.sibling),Oe=x(ln,Be.props.children),Oe.return=Ue,Ue=Oe;break e}}else if(ln.elementType===Jt||typeof Jt=="object"&&Jt!==null&&Jt.$$typeof===Xe&&JR(Jt)===ln.type){T(Ue,ln.sibling),Oe=x(ln,Be.props),Oe.ref=lg(Ue,ln,Be),Oe.return=Ue,Ue=Oe;break e}T(Ue,ln);break}else g(Ue,ln);ln=ln.sibling}Be.type===Q?(Oe=Xc(Be.props.children,Ue.mode,wt,Be.key),Oe.return=Ue,Ue=Oe):(wt=iE(Be.type,Be.key,Be.props,null,Ue.mode,wt),wt.ref=lg(Ue,Oe,Be),wt.return=Ue,Ue=wt)}return ie(Ue);case ye:e:{for(ln=Be.key;Oe!==null;){if(Oe.key===ln)if(Oe.tag===4&&Oe.stateNode.containerInfo===Be.containerInfo&&Oe.stateNode.implementation===Be.implementation){T(Ue,Oe.sibling),Oe=x(Oe,Be.children||[]),Oe.return=Ue,Ue=Oe;break e}else{T(Ue,Oe);break}else g(Ue,Oe);Oe=Oe.sibling}Oe=UT(Be,Ue.mode,wt),Oe.return=Ue,Ue=Oe}return ie(Ue);case Xe:return ln=Be._init,Yi(Ue,Oe,ln(Be._payload),wt)}if(We(Be))return Kt(Ue,Oe,Be,wt);if(nt(Be))return Yt(Ue,Oe,Be,wt);ug(Ue,Be)}return typeof Be=="string"&&Be!==""||typeof Be=="number"?(Be=""+Be,Oe!==null&&Oe.tag===6?(T(Ue,Oe.sibling),Oe=x(Oe,Be),Oe.return=Ue,Ue=Oe):(T(Ue,Oe),Oe=MT(Be,Ue.mode,wt),Oe.return=Ue,Ue=Oe),ie(Ue)):T(Ue,Oe)}return Yi}var Xh=QR(!0),ZR=QR(!1),bd={},$c=oc(bd),Iu=oc(bd),dg=oc(bd);function Jh(f){if(f===bd)throw Error(o(174));return f}function rT(f,g){switch(hi(dg,g),hi(Iu,f),hi($c,bd),f=g.nodeType,f){case 9:case 11:g=(g=g.documentElement)?g.namespaceURI:nn(null,"");break;default:f=f===8?g.parentNode:g,g=f.namespaceURI||null,f=f.tagName,g=nn(g,f)}Ei($c),hi($c,g)}function Tp(){Ei($c),Ei(Iu),Ei(dg)}function hg(f){Jh(dg.current);var g=Jh($c.current),T=nn(g,f.type);g!==T&&(hi(Iu,f),hi($c,T))}function iT(f){Iu.current===f&&(Ei($c),Ei(Iu))}var Ti=oc(0);function bp(f){for(var g=f;g!==null;){if(g.tag===13){var T=g.memoizedState;if(T!==null&&(T=T.dehydrated,T===null||T.data==="$?"||T.data==="$!"))return g}else if(g.tag===19&&g.memoizedProps.revealOrder!==void 0){if((g.flags&128)!==0)return g}else if(g.child!==null){g.child.return=g,g=g.child;continue}if(g===f)break;for(;g.sibling===null;){if(g.return===null||g.return===f)return null;g=g.return}g.sibling.return=g.return,g=g.sibling}return null}var fg=[];function oT(){for(var f=0;f<fg.length;f++)fg[f]._workInProgressVersionPrimary=null;fg.length=0}var jv=se.ReactCurrentDispatcher,sT=se.ReactCurrentBatchConfig,Qh=0,Ii=null,Fi=null,Do=null,Au=!1,Zh=!1,wd=0,pg=0;function Eo(){throw Error(o(321))}function aT(f,g){if(g===null)return!1;for(var T=0;T<g.length&&T<f.length;T++)if(!Hc(f[T],g[T]))return!1;return!0}function Bv(f,g,T,A,x,W){if(Qh=W,Ii=g,g.memoizedState=null,g.updateQueue=null,g.lanes=0,jv.current=f===null||f.memoizedState===null?Nk:kk,f=T(A,x),Zh){W=0;do{if(Zh=!1,wd=0,25<=W)throw Error(o(301));W+=1,Do=Fi=null,g.updateQueue=null,jv.current=Dk,f=T(A,x)}while(Zh)}if(jv.current=zv,g=Fi!==null&&Fi.next!==null,Qh=0,Do=Fi=Ii=null,Au=!1,g)throw Error(o(300));return f}function cT(){var f=wd!==0;return wd=0,f}function qc(){var f={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Do===null?Ii.memoizedState=Do=f:Do=Do.next=f,Do}function uc(){if(Fi===null){var f=Ii.alternate;f=f!==null?f.memoizedState:null}else f=Fi.next;var g=Do===null?Ii.memoizedState:Do.next;if(g!==null)Do=g,Fi=f;else{if(f===null)throw Error(o(310));Fi=f,f={memoizedState:Fi.memoizedState,baseState:Fi.baseState,baseQueue:Fi.baseQueue,queue:Fi.queue,next:null},Do===null?Ii.memoizedState=Do=f:Do=Do.next=f}return Do}function mg(f,g){return typeof g=="function"?g(f):g}function gg(f){var g=uc(),T=g.queue;if(T===null)throw Error(o(311));T.lastRenderedReducer=f;var A=Fi,x=A.baseQueue,W=T.pending;if(W!==null){if(x!==null){var ie=x.next;x.next=W.next,W.next=ie}A.baseQueue=x=W,T.pending=null}if(x!==null){W=x.next,A=A.baseState;var Se=ie=null,Ae=null,ze=W;do{var Et=ze.lane;if((Qh&Et)===Et)Ae!==null&&(Ae=Ae.next={lane:0,action:ze.action,hasEagerState:ze.hasEagerState,eagerState:ze.eagerState,next:null}),A=ze.hasEagerState?ze.eagerState:f(A,ze.action);else{var St={lane:Et,action:ze.action,hasEagerState:ze.hasEagerState,eagerState:ze.eagerState,next:null};Ae===null?(Se=Ae=St,ie=A):Ae=Ae.next=St,Ii.lanes|=Et,nf|=Et}ze=ze.next}while(ze!==null&&ze!==W);Ae===null?ie=A:Ae.next=Se,Hc(A,g.memoizedState)||(aa=!0),g.memoizedState=A,g.baseState=ie,g.baseQueue=Ae,T.lastRenderedState=A}if(f=T.interleaved,f!==null){x=f;do W=x.lane,Ii.lanes|=W,nf|=W,x=x.next;while(x!==f)}else x===null&&(T.lanes=0);return[g.memoizedState,T.dispatch]}function _g(f){var g=uc(),T=g.queue;if(T===null)throw Error(o(311));T.lastRenderedReducer=f;var A=T.dispatch,x=T.pending,W=g.memoizedState;if(x!==null){T.pending=null;var ie=x=x.next;do W=f(W,ie.action),ie=ie.next;while(ie!==x);Hc(W,g.memoizedState)||(aa=!0),g.memoizedState=W,g.baseQueue===null&&(g.baseState=W),T.lastRenderedState=W}return[W,A]}function eC(){}function tC(f,g){var T=Ii,A=uc(),x=g(),W=!Hc(A.memoizedState,x);if(W&&(A.memoizedState=x,aa=!0),A=A.queue,Gv(nC.bind(null,T,A,f),[f]),A.getSnapshot!==g||W||Do!==null&&Do.memoizedState.tag&1){if(T.flags|=2048,wp(9,Wv.bind(null,T,A,x,g),void 0,null),so===null)throw Error(o(349));(Qh&30)!==0||lT(T,g,x)}return x}function lT(f,g,T){f.flags|=16384,f={getSnapshot:g,value:T},g=Ii.updateQueue,g===null?(g={lastEffect:null,stores:null},Ii.updateQueue=g,g.stores=[f]):(T=g.stores,T===null?g.stores=[f]:T.push(f))}function Wv(f,g,T,A){g.value=T,g.getSnapshot=A,Yc(g)&&ef(f)}function nC(f,g,T){return T(function(){Yc(g)&&ef(f)})}function Yc(f){var g=f.getSnapshot;f=f.value;try{var T=g();return!Hc(f,T)}catch{return!0}}function ef(f){var g=lc(f,1);g!==null&&Ma(g,f,1,-1)}function Rd(f){var g=qc();return typeof f=="function"&&(f=f()),g.memoizedState=g.baseState=f,f={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:mg,lastRenderedState:f},g.queue=f,f=f.dispatch=pT.bind(null,Ii,f),[g.memoizedState,f]}function wp(f,g,T,A){return f={tag:f,create:g,destroy:T,deps:A,next:null},g=Ii.updateQueue,g===null?(g={lastEffect:null,stores:null},Ii.updateQueue=g,g.lastEffect=f.next=f):(T=g.lastEffect,T===null?g.lastEffect=f.next=f:(A=T.next,T.next=f,f.next=A,g.lastEffect=f)),f}function uT(){return uc().memoizedState}function Cl(f,g,T,A){var x=qc();Ii.flags|=f,x.memoizedState=wp(1|g,T,void 0,A===void 0?null:A)}function Rp(f,g,T,A){var x=uc();A=A===void 0?null:A;var W=void 0;if(Fi!==null){var ie=Fi.memoizedState;if(W=ie.destroy,A!==null&&aT(A,ie.deps)){x.memoizedState=wp(g,T,W,A);return}}Ii.flags|=f,x.memoizedState=wp(1|g,T,W,A)}function rC(f,g){return Cl(8390656,8,f,g)}function Gv(f,g){return Rp(2048,8,f,g)}function iC(f,g){return Rp(4,2,f,g)}function dT(f,g){return Rp(4,4,f,g)}function hT(f,g){if(typeof g=="function")return f=f(),g(f),function(){g(null)};if(g!=null)return f=f(),g.current=f,function(){g.current=null}}function oC(f,g,T){return T=T!=null?T.concat([f]):null,Rp(4,4,hT.bind(null,g,f),T)}function Il(){}function sC(f,g){var T=uc();g=g===void 0?null:g;var A=T.memoizedState;return A!==null&&g!==null&&aT(g,A[1])?A[0]:(T.memoizedState=[f,g],f)}function aC(f,g){var T=uc();g=g===void 0?null:g;var A=T.memoizedState;return A!==null&&g!==null&&aT(g,A[1])?A[0]:(f=f(),T.memoizedState=[f,g],f)}function cC(f,g,T){return(Qh&21)===0?(f.baseState&&(f.baseState=!1,aa=!0),f.memoizedState=T):(Hc(T,g)||(T=mu(),Ii.lanes|=T,nf|=T,f.baseState=!0),g)}function Ok(f,g){var T=Jn;Jn=T!==0&&4>T?T:4,f(!0);var A=sT.transition;sT.transition={};try{f(!1),g()}finally{Jn=T,sT.transition=A}}function fT(){return uc().memoizedState}function Pk(f,g,T){var A=Nu(f);if(T={lane:A,action:T,hasEagerState:!1,eagerState:null,next:null},mT(f))lC(g,T);else if(T=HR(f,g,T,A),T!==null){var x=So();Ma(T,f,A,x),gT(T,g,A)}}function pT(f,g,T){var A=Nu(f),x={lane:A,action:T,hasEagerState:!1,eagerState:null,next:null};if(mT(f))lC(g,x);else{var W=f.alternate;if(f.lanes===0&&(W===null||W.lanes===0)&&(W=g.lastRenderedReducer,W!==null))try{var ie=g.lastRenderedState,Se=W(ie,T);if(x.hasEagerState=!0,x.eagerState=Se,Hc(Se,ie)){var Ae=g.interleaved;Ae===null?(x.next=x,ZS(g)):(x.next=Ae.next,Ae.next=x),g.interleaved=x;return}}catch{}finally{}T=HR(f,g,x,A),T!==null&&(x=So(),Ma(T,f,A,x),gT(T,g,A))}}function mT(f){var g=f.alternate;return f===Ii||g!==null&&g===Ii}function lC(f,g){Zh=Au=!0;var T=f.pending;T===null?g.next=g:(g.next=T.next,T.next=g),f.pending=g}function gT(f,g,T){if((T&4194240)!==0){var A=g.lanes;A&=f.pendingLanes,T|=A,g.lanes=T,Oa(f,T)}}var zv={readContext:La,useCallback:Eo,useContext:Eo,useEffect:Eo,useImperativeHandle:Eo,useInsertionEffect:Eo,useLayoutEffect:Eo,useMemo:Eo,useReducer:Eo,useRef:Eo,useState:Eo,useDebugValue:Eo,useDeferredValue:Eo,useTransition:Eo,useMutableSource:Eo,useSyncExternalStore:Eo,useId:Eo,unstable_isNewReconciler:!1},Nk={readContext:La,useCallback:function(f,g){return qc().memoizedState=[f,g===void 0?null:g],f},useContext:La,useEffect:rC,useImperativeHandle:function(f,g,T){return T=T!=null?T.concat([f]):null,Cl(4194308,4,hT.bind(null,g,f),T)},useLayoutEffect:function(f,g){return Cl(4194308,4,f,g)},useInsertionEffect:function(f,g){return Cl(4,2,f,g)},useMemo:function(f,g){var T=qc();return g=g===void 0?null:g,f=f(),T.memoizedState=[f,g],f},useReducer:function(f,g,T){var A=qc();return g=T!==void 0?T(g):g,A.memoizedState=A.baseState=g,f={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:f,lastRenderedState:g},A.queue=f,f=f.dispatch=Pk.bind(null,Ii,f),[A.memoizedState,f]},useRef:function(f){var g=qc();return f={current:f},g.memoizedState=f},useState:Rd,useDebugValue:Il,useDeferredValue:function(f){return qc().memoizedState=f},useTransition:function(){var f=Rd(!1),g=f[0];return f=Ok.bind(null,f[1]),qc().memoizedState=f,[g,f]},useMutableSource:function(){},useSyncExternalStore:function(f,g,T){var A=Ii,x=qc();if(ni){if(T===void 0)throw Error(o(407));T=T()}else{if(T=g(),so===null)throw Error(o(349));(Qh&30)!==0||lT(A,g,T)}x.memoizedState=T;var W={value:T,getSnapshot:g};return x.queue=W,rC(nC.bind(null,A,W,f),[f]),A.flags|=2048,wp(9,Wv.bind(null,A,W,T,g),void 0,null),T},useId:function(){var f=qc(),g=so.identifierPrefix;if(ni){var T=wu,A=bu;T=(A&~(1<<32-Wo(A)-1)).toString(32)+T,g=":"+g+"R"+T,T=wd++,0<T&&(g+="H"+T.toString(32)),g+=":"}else T=pg++,g=":"+g+"r"+T.toString(32)+":";return f.memoizedState=g},unstable_isNewReconciler:!1},kk={readContext:La,useCallback:sC,useContext:La,useEffect:Gv,useImperativeHandle:oC,useInsertionEffect:iC,useLayoutEffect:dT,useMemo:aC,useReducer:gg,useRef:uT,useState:function(){return gg(mg)},useDebugValue:Il,useDeferredValue:function(f){var g=uc();return cC(g,Fi.memoizedState,f)},useTransition:function(){var f=gg(mg)[0],g=uc().memoizedState;return[f,g]},useMutableSource:eC,useSyncExternalStore:tC,useId:fT,unstable_isNewReconciler:!1},Dk={readContext:La,useCallback:sC,useContext:La,useEffect:Gv,useImperativeHandle:oC,useInsertionEffect:iC,useLayoutEffect:dT,useMemo:aC,useReducer:_g,useRef:uT,useState:function(){return _g(mg)},useDebugValue:Il,useDeferredValue:function(f){var g=uc();return Fi===null?g.memoizedState=f:cC(g,Fi.memoizedState,f)},useTransition:function(){var f=_g(mg)[0],g=uc().memoizedState;return[f,g]},useMutableSource:eC,useSyncExternalStore:tC,useId:fT,unstable_isNewReconciler:!1};function Cp(f,g){try{var T="",A=g;do T+=et(A),A=A.return;while(A);var x=T}catch(W){x=`
Error generating stack: `+W.message+`
`+W.stack}return{value:f,source:g,stack:x,digest:null}}function _T(f,g,T){return{value:f,source:null,stack:T??null,digest:g??null}}function vT(f,g){try{console.error(g.value)}catch(T){setTimeout(function(){throw T})}}var uC=typeof WeakMap=="function"?WeakMap:Map;function Ou(f,g,T){T=Cu(-1,T),T.tag=3,T.payload={element:null};var A=g.value;return T.callback=function(){Qv||(Qv=!0,NT=A),vT(f,g)},T}function dC(f,g,T){T=Cu(-1,T),T.tag=3;var A=f.type.getDerivedStateFromError;if(typeof A=="function"){var x=g.value;T.payload=function(){return A(x)},T.callback=function(){vT(f,g)}}var W=f.stateNode;return W!==null&&typeof W.componentDidCatch=="function"&&(T.callback=function(){vT(f,g),typeof A!="function"&&(Ol===null?Ol=new Set([this]):Ol.add(this));var ie=g.stack;this.componentDidCatch(g.value,{componentStack:ie!==null?ie:""})}),T}function hC(f,g,T){var A=f.pingCache;if(A===null){A=f.pingCache=new uC;var x=new Set;A.set(g,x)}else x=A.get(g),x===void 0&&(x=new Set,A.set(g,x));x.has(T)||(x.add(T),f=MC.bind(null,f,g,T),g.then(f,f))}function fC(f){do{var g;if((g=f.tag===13)&&(g=f.memoizedState,g=g!==null?g.dehydrated!==null:!0),g)return f;f=f.return}while(f!==null);return null}function pC(f,g,T,A,x){return(f.mode&1)===0?(f===g?f.flags|=65536:(f.flags|=128,T.flags|=131072,T.flags&=-52805,T.tag===1&&(T.alternate===null?T.tag=17:(g=Cu(-1,1),g.tag=2,Td(T,g,1))),T.lanes|=1),f):(f.flags|=65536,f.lanes=x,f)}var Lk=se.ReactCurrentOwner,aa=!1;function Go(f,g,T,A){g.child=f===null?ZR(g,null,T,A):Xh(g,f.child,T,A)}function mC(f,g,T,A,x){T=T.render;var W=g.ref;return Sp(g,x),A=Bv(f,g,T,A,W,x),T=cT(),f!==null&&!aa?(g.updateQueue=f.updateQueue,g.flags&=-2053,f.lanes&=~x,Al(f,g,x)):(ni&&T&&Nv(g),g.flags|=1,Go(f,g,A,x),g.child)}function gC(f,g,T,A,x){if(f===null){var W=T.type;return typeof W=="function"&&!Lu(W)&&W.defaultProps===void 0&&T.compare===null&&T.defaultProps===void 0?(g.tag=15,g.type=W,_C(f,g,W,A,x)):(f=iE(T.type,null,A,g,g.mode,x),f.ref=g.ref,f.return=g,g.child=f)}if(W=f.child,(f.lanes&x)===0){var ie=W.memoizedProps;if(T=T.compare,T=T!==null?T:Xm,T(ie,A)&&f.ref===g.ref)return Al(f,g,x)}return g.flags|=1,f=Nd(W,A),f.ref=g.ref,f.return=g,g.child=f}function _C(f,g,T,A,x){if(f!==null){var W=f.memoizedProps;if(Xm(W,A)&&f.ref===g.ref)if(aa=!1,g.pendingProps=A=W,(f.lanes&x)!==0)(f.flags&131072)!==0&&(aa=!0);else return g.lanes=f.lanes,Al(f,g,x)}return ET(f,g,T,A,x)}function vC(f,g,T){var A=g.pendingProps,x=A.children,W=f!==null?f.memoizedState:null;if(A.mode==="hidden")if((g.mode&1)===0)g.memoizedState={baseLanes:0,cachePool:null,transitions:null},hi(tf,xo),xo|=T;else{if((T&1073741824)===0)return f=W!==null?W.baseLanes|T:T,g.lanes=g.childLanes=1073741824,g.memoizedState={baseLanes:f,cachePool:null,transitions:null},g.updateQueue=null,hi(tf,xo),xo|=f,null;g.memoizedState={baseLanes:0,cachePool:null,transitions:null},A=W!==null?W.baseLanes:T,hi(tf,xo),xo|=A}else W!==null?(A=W.baseLanes|T,g.memoizedState=null):A=T,hi(tf,xo),xo|=A;return Go(f,g,x,T),g.child}function EC(f,g){var T=g.ref;(f===null&&T!==null||f!==null&&f.ref!==T)&&(g.flags|=512,g.flags|=2097152)}function ET(f,g,T,A,x){var W=ia(T)?Kh:os.current;return W=$h(g,W),Sp(g,x),T=Bv(f,g,T,A,W,x),A=cT(),f!==null&&!aa?(g.updateQueue=f.updateQueue,g.flags&=-2053,f.lanes&=~x,Al(f,g,x)):(ni&&A&&Nv(g),g.flags|=1,Go(f,g,T,x),g.child)}function yT(f,g,T,A,x){if(ia(T)){var W=!0;Iv(g)}else W=!1;if(Sp(g,x),g.stateNode===null)Sg(f,g),YR(g,T,A),nT(g,T,A,x),A=!0;else if(f===null){var ie=g.stateNode,Se=g.memoizedProps;ie.props=Se;var Ae=ie.context,ze=T.contextType;typeof ze=="object"&&ze!==null?ze=La(ze):(ze=ia(T)?Kh:os.current,ze=$h(g,ze));var Et=T.getDerivedStateFromProps,St=typeof Et=="function"||typeof ie.getSnapshotBeforeUpdate=="function";St||typeof ie.UNSAFE_componentWillReceiveProps!="function"&&typeof ie.componentWillReceiveProps!="function"||(Se!==A||Ae!==ze)&&XR(g,ie,A,ze),Sd=!1;var vt=g.memoizedState;ie.state=vt,Uv(g,A,ie,x),Ae=g.memoizedState,Se!==A||vt!==Ae||ra.current||Sd?(typeof Et=="function"&&(Vv(g,T,Et,A),Ae=g.memoizedState),(Se=Sd||qR(g,T,Se,A,vt,Ae,ze))?(St||typeof ie.UNSAFE_componentWillMount!="function"&&typeof ie.componentWillMount!="function"||(typeof ie.componentWillMount=="function"&&ie.componentWillMount(),typeof ie.UNSAFE_componentWillMount=="function"&&ie.UNSAFE_componentWillMount()),typeof ie.componentDidMount=="function"&&(g.flags|=4194308)):(typeof ie.componentDidMount=="function"&&(g.flags|=4194308),g.memoizedProps=A,g.memoizedState=Ae),ie.props=A,ie.state=Ae,ie.context=ze,A=Se):(typeof ie.componentDidMount=="function"&&(g.flags|=4194308),A=!1)}else{ie=g.stateNode,KR(f,g),Se=g.memoizedProps,ze=g.type===g.elementType?Se:Kc(g.type,Se),ie.props=ze,St=g.pendingProps,vt=ie.context,Ae=T.contextType,typeof Ae=="object"&&Ae!==null?Ae=La(Ae):(Ae=ia(T)?Kh:os.current,Ae=$h(g,Ae));var Ft=T.getDerivedStateFromProps;(Et=typeof Ft=="function"||typeof ie.getSnapshotBeforeUpdate=="function")||typeof ie.UNSAFE_componentWillReceiveProps!="function"&&typeof ie.componentWillReceiveProps!="function"||(Se!==St||vt!==Ae)&&XR(g,ie,A,Ae),Sd=!1,vt=g.memoizedState,ie.state=vt,Uv(g,A,ie,x);var Kt=g.memoizedState;Se!==St||vt!==Kt||ra.current||Sd?(typeof Ft=="function"&&(Vv(g,T,Ft,A),Kt=g.memoizedState),(ze=Sd||qR(g,T,ze,A,vt,Kt,Ae)||!1)?(Et||typeof ie.UNSAFE_componentWillUpdate!="function"&&typeof ie.componentWillUpdate!="function"||(typeof ie.componentWillUpdate=="function"&&ie.componentWillUpdate(A,Kt,Ae),typeof ie.UNSAFE_componentWillUpdate=="function"&&ie.UNSAFE_componentWillUpdate(A,Kt,Ae)),typeof ie.componentDidUpdate=="function"&&(g.flags|=4),typeof ie.getSnapshotBeforeUpdate=="function"&&(g.flags|=1024)):(typeof ie.componentDidUpdate!="function"||Se===f.memoizedProps&&vt===f.memoizedState||(g.flags|=4),typeof ie.getSnapshotBeforeUpdate!="function"||Se===f.memoizedProps&&vt===f.memoizedState||(g.flags|=1024),g.memoizedProps=A,g.memoizedState=Kt),ie.props=A,ie.state=Kt,ie.context=Ae,A=ze):(typeof ie.componentDidUpdate!="function"||Se===f.memoizedProps&&vt===f.memoizedState||(g.flags|=4),typeof ie.getSnapshotBeforeUpdate!="function"||Se===f.memoizedProps&&vt===f.memoizedState||(g.flags|=1024),A=!1)}return Hv(f,g,T,A,W,x)}function Hv(f,g,T,A,x,W){EC(f,g);var ie=(g.flags&128)!==0;if(!A&&!ie)return x&&FR(g,T,!1),Al(f,g,W);A=g.stateNode,Lk.current=g;var Se=ie&&typeof T.getDerivedStateFromError!="function"?null:A.render();return g.flags|=1,f!==null&&ie?(g.child=Xh(g,f.child,null,W),g.child=Xh(g,null,Se,W)):Go(f,g,Se,W),g.memoizedState=A.state,x&&FR(g,T,!0),g.child}function yC(f){var g=f.stateNode;g.pendingContext?VR(f,g.pendingContext,g.pendingContext!==g.context):g.context&&VR(f,g.context,!1),rT(f,g.containerInfo)}function SC(f,g,T,A,x){return yp(),YS(x),g.flags|=256,Go(f,g,T,A),g.child}var Ip={dehydrated:null,treeContext:null,retryLane:0};function vg(f){return{baseLanes:f,cachePool:null,transitions:null}}function ST(f,g,T){var A=g.pendingProps,x=Ti.current,W=!1,ie=(g.flags&128)!==0,Se;if((Se=ie)||(Se=f!==null&&f.memoizedState===null?!1:(x&2)!==0),Se?(W=!0,g.flags&=-129):(f===null||f.memoizedState!==null)&&(x|=1),hi(Ti,x&1),f===null)return qS(g),f=g.memoizedState,f!==null&&(f=f.dehydrated,f!==null)?((g.mode&1)===0?g.lanes=1:f.data==="$!"?g.lanes=8:g.lanes=1073741824,null):(ie=A.children,f=A.fallback,W?(A=g.mode,W=g.child,ie={mode:"hidden",children:ie},(A&1)===0&&W!==null?(W.childLanes=0,W.pendingProps=ie):W=oE(ie,A,0,null),f=Xc(f,A,T,null),W.return=g,f.return=g,W.sibling=f,g.child=W,g.child.memoizedState=vg(T),g.memoizedState=Ip,f):Ap(g,ie));if(x=f.memoizedState,x!==null&&(Se=x.dehydrated,Se!==null))return xk(f,g,ie,A,Se,x,T);if(W){W=A.fallback,ie=g.mode,x=f.child,Se=x.sibling;var Ae={mode:"hidden",children:A.children};return(ie&1)===0&&g.child!==x?(A=g.child,A.childLanes=0,A.pendingProps=Ae,g.deletions=null):(A=Nd(x,Ae),A.subtreeFlags=x.subtreeFlags&14680064),Se!==null?W=Nd(Se,W):(W=Xc(W,ie,T,null),W.flags|=2),W.return=g,A.return=g,A.sibling=W,g.child=A,A=W,W=g.child,ie=f.child.memoizedState,ie=ie===null?vg(T):{baseLanes:ie.baseLanes|T,cachePool:null,transitions:ie.transitions},W.memoizedState=ie,W.childLanes=f.childLanes&~T,g.memoizedState=Ip,A}return W=f.child,f=W.sibling,A=Nd(W,{mode:"visible",children:A.children}),(g.mode&1)===0&&(A.lanes=T),A.return=g,A.sibling=null,f!==null&&(T=g.deletions,T===null?(g.deletions=[f],g.flags|=16):T.push(f)),g.child=A,g.memoizedState=null,A}function Ap(f,g){return g=oE({mode:"visible",children:g},f.mode,0,null),g.return=f,f.child=g}function Eg(f,g,T,A){return A!==null&&YS(A),Xh(g,f.child,null,T),f=Ap(g,g.pendingProps.children),f.flags|=2,g.memoizedState=null,f}function xk(f,g,T,A,x,W,ie){if(T)return g.flags&256?(g.flags&=-257,A=_T(Error(o(422))),Eg(f,g,ie,A)):g.memoizedState!==null?(g.child=f.child,g.flags|=128,null):(W=A.fallback,x=g.mode,A=oE({mode:"visible",children:A.children},x,0,null),W=Xc(W,x,ie,null),W.flags|=2,A.return=g,W.return=g,A.sibling=W,g.child=A,(g.mode&1)!==0&&Xh(g,f.child,null,ie),g.child.memoizedState=vg(ie),g.memoizedState=Ip,W);if((g.mode&1)===0)return Eg(f,g,ie,null);if(x.data==="$!"){if(A=x.nextSibling&&x.nextSibling.dataset,A)var Se=A.dgst;return A=Se,W=Error(o(419)),A=_T(W,A,void 0),Eg(f,g,ie,A)}if(Se=(ie&f.childLanes)!==0,aa||Se){if(A=so,A!==null){switch(ie&-ie){case 4:x=2;break;case 16:x=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:x=32;break;case 536870912:x=268435456;break;default:x=0}x=(x&(A.suspendedLanes|ie))!==0?0:x,x!==0&&x!==W.retryLane&&(W.retryLane=x,lc(f,x),Ma(A,f,x,-1))}return Du(),A=_T(Error(o(421))),Eg(f,g,ie,A)}return x.data==="$?"?(g.flags|=128,g.child=f.child,g=UC.bind(null,f),x._reactRetry=g,null):(f=W.treeContext,sa=_d(x.nextSibling),oa=g,ni=!0,Ns=null,f!==null&&(ac[Da++]=bu,ac[Da++]=wu,ac[Da++]=qh,bu=f.id,wu=f.overflow,qh=g),g=Ap(g,A.children),g.flags|=4096,g)}function TT(f,g,T){f.lanes|=g;var A=f.alternate;A!==null&&(A.lanes|=g),Lv(f.return,g,T)}function yg(f,g,T,A,x){var W=f.memoizedState;W===null?f.memoizedState={isBackwards:g,rendering:null,renderingStartTime:0,last:A,tail:T,tailMode:x}:(W.isBackwards=g,W.rendering=null,W.renderingStartTime=0,W.last=A,W.tail=T,W.tailMode=x)}function TC(f,g,T){var A=g.pendingProps,x=A.revealOrder,W=A.tail;if(Go(f,g,A.children,T),A=Ti.current,(A&2)!==0)A=A&1|2,g.flags|=128;else{if(f!==null&&(f.flags&128)!==0)e:for(f=g.child;f!==null;){if(f.tag===13)f.memoizedState!==null&&TT(f,T,g);else if(f.tag===19)TT(f,T,g);else if(f.child!==null){f.child.return=f,f=f.child;continue}if(f===g)break e;for(;f.sibling===null;){if(f.return===null||f.return===g)break e;f=f.return}f.sibling.return=f.return,f=f.sibling}A&=1}if(hi(Ti,A),(g.mode&1)===0)g.memoizedState=null;else switch(x){case"forwards":for(T=g.child,x=null;T!==null;)f=T.alternate,f!==null&&bp(f)===null&&(x=T),T=T.sibling;T=x,T===null?(x=g.child,g.child=null):(x=T.sibling,T.sibling=null),yg(g,!1,x,T,W);break;case"backwards":for(T=null,x=g.child,g.child=null;x!==null;){if(f=x.alternate,f!==null&&bp(f)===null){g.child=x;break}f=x.sibling,x.sibling=T,T=x,x=f}yg(g,!0,T,null,W);break;case"together":yg(g,!1,null,null,void 0);break;default:g.memoizedState=null}return g.child}function Sg(f,g){(g.mode&1)===0&&f!==null&&(f.alternate=null,g.alternate=null,g.flags|=2)}function Al(f,g,T){if(f!==null&&(g.dependencies=f.dependencies),nf|=g.lanes,(T&g.childLanes)===0)return null;if(f!==null&&g.child!==f.child)throw Error(o(153));if(g.child!==null){for(f=g.child,T=Nd(f,f.pendingProps),g.child=T,T.return=g;f.sibling!==null;)f=f.sibling,T=T.sibling=Nd(f,f.pendingProps),T.return=g;T.sibling=null}return g.child}function Mk(f,g,T){switch(g.tag){case 3:yC(g),yp();break;case 5:hg(g);break;case 1:ia(g.type)&&Iv(g);break;case 4:rT(g,g.stateNode.containerInfo);break;case 10:var A=g.type._context,x=g.memoizedProps.value;hi(Dv,A._currentValue),A._currentValue=x;break;case 13:if(A=g.memoizedState,A!==null)return A.dehydrated!==null?(hi(Ti,Ti.current&1),g.flags|=128,null):(T&g.child.childLanes)!==0?ST(f,g,T):(hi(Ti,Ti.current&1),f=Al(f,g,T),f!==null?f.sibling:null);hi(Ti,Ti.current&1);break;case 19:if(A=(T&g.childLanes)!==0,(f.flags&128)!==0){if(A)return TC(f,g,T);g.flags|=128}if(x=g.memoizedState,x!==null&&(x.rendering=null,x.tail=null,x.lastEffect=null),hi(Ti,Ti.current),A)break;return null;case 22:case 23:return g.lanes=0,vC(f,g,T)}return Al(f,g,T)}var bT,Kv,bC,wC;bT=function(f,g){for(var T=g.child;T!==null;){if(T.tag===5||T.tag===6)f.appendChild(T.stateNode);else if(T.tag!==4&&T.child!==null){T.child.return=T,T=T.child;continue}if(T===g)break;for(;T.sibling===null;){if(T.return===null||T.return===g)return;T=T.return}T.sibling.return=T.return,T=T.sibling}},Kv=function(){},bC=function(f,g,T,A){var x=f.memoizedProps;if(x!==A){f=g.stateNode,Jh($c.current);var W=null;switch(T){case"input":x=Ar(f,x),A=Ar(f,A),W=[];break;case"select":x=Ee({},x,{value:void 0}),A=Ee({},A,{value:void 0}),W=[];break;case"textarea":x=gt(f,x),A=gt(f,A),W=[];break;default:typeof x.onClick!="function"&&typeof A.onClick=="function"&&(f.onclick=bv)}$i(T,A);var ie;T=null;for(ze in x)if(!A.hasOwnProperty(ze)&&x.hasOwnProperty(ze)&&x[ze]!=null)if(ze==="style"){var Se=x[ze];for(ie in Se)Se.hasOwnProperty(ie)&&(T||(T={}),T[ie]="")}else ze!=="dangerouslySetInnerHTML"&&ze!=="children"&&ze!=="suppressContentEditableWarning"&&ze!=="suppressHydrationWarning"&&ze!=="autoFocus"&&(l.hasOwnProperty(ze)?W||(W=[]):(W=W||[]).push(ze,null));for(ze in A){var Ae=A[ze];if(Se=x!=null?x[ze]:void 0,A.hasOwnProperty(ze)&&Ae!==Se&&(Ae!=null||Se!=null))if(ze==="style")if(Se){for(ie in Se)!Se.hasOwnProperty(ie)||Ae&&Ae.hasOwnProperty(ie)||(T||(T={}),T[ie]="");for(ie in Ae)Ae.hasOwnProperty(ie)&&Se[ie]!==Ae[ie]&&(T||(T={}),T[ie]=Ae[ie])}else T||(W||(W=[]),W.push(ze,T)),T=Ae;else ze==="dangerouslySetInnerHTML"?(Ae=Ae?Ae.__html:void 0,Se=Se?Se.__html:void 0,Ae!=null&&Se!==Ae&&(W=W||[]).push(ze,Ae)):ze==="children"?typeof Ae!="string"&&typeof Ae!="number"||(W=W||[]).push(ze,""+Ae):ze!=="suppressContentEditableWarning"&&ze!=="suppressHydrationWarning"&&(l.hasOwnProperty(ze)?(Ae!=null&&ze==="onScroll"&&vi("scroll",f),W||Se===Ae||(W=[])):(W=W||[]).push(ze,Ae))}T&&(W=W||[]).push("style",T);var ze=W;(g.updateQueue=ze)&&(g.flags|=4)}},wC=function(f,g,T,A){T!==A&&(g.flags|=4)};function Tg(f,g){if(!ni)switch(f.tailMode){case"hidden":g=f.tail;for(var T=null;g!==null;)g.alternate!==null&&(T=g),g=g.sibling;T===null?f.tail=null:T.sibling=null;break;case"collapsed":T=f.tail;for(var A=null;T!==null;)T.alternate!==null&&(A=T),T=T.sibling;A===null?g||f.tail===null?f.tail=null:f.tail.sibling=null:A.sibling=null}}function yo(f){var g=f.alternate!==null&&f.alternate.child===f.child,T=0,A=0;if(g)for(var x=f.child;x!==null;)T|=x.lanes|x.childLanes,A|=x.subtreeFlags&14680064,A|=x.flags&14680064,x.return=f,x=x.sibling;else for(x=f.child;x!==null;)T|=x.lanes|x.childLanes,A|=x.subtreeFlags,A|=x.flags,x.return=f,x=x.sibling;return f.subtreeFlags|=A,f.childLanes=T,g}function Uk(f,g,T){var A=g.pendingProps;switch(sg(g),g.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return yo(g),null;case 1:return ia(g.type)&&Rv(),yo(g),null;case 3:return A=g.stateNode,Tp(),Ei(ra),Ei(os),oT(),A.pendingContext&&(A.context=A.pendingContext,A.pendingContext=null),(f===null||f.child===null)&&(ag(g)?g.flags|=4:f===null||f.memoizedState.isDehydrated&&(g.flags&256)===0||(g.flags|=1024,Ns!==null&&(Mp(Ns),Ns=null))),Kv(f,g),yo(g),null;case 5:iT(g);var x=Jh(dg.current);if(T=g.type,f!==null&&g.stateNode!=null)bC(f,g,T,A,x),f.ref!==g.ref&&(g.flags|=512,g.flags|=2097152);else{if(!A){if(g.stateNode===null)throw Error(o(166));return yo(g),null}if(f=Jh($c.current),ag(g)){A=g.stateNode,T=g.type;var W=g.memoizedProps;switch(A[Rl]=g,A[vd]=W,f=(g.mode&1)!==0,T){case"dialog":vi("cancel",A),vi("close",A);break;case"iframe":case"object":case"embed":vi("load",A);break;case"video":case"audio":for(x=0;x<eg.length;x++)vi(eg[x],A);break;case"source":vi("error",A);break;case"img":case"image":case"link":vi("error",A),vi("load",A);break;case"details":vi("toggle",A);break;case"input":bt(A,W),vi("invalid",A);break;case"select":A._wrapperState={wasMultiple:!!W.multiple},vi("invalid",A);break;case"textarea":ht(A,W),vi("invalid",A)}$i(T,W),x=null;for(var ie in W)if(W.hasOwnProperty(ie)){var Se=W[ie];ie==="children"?typeof Se=="string"?A.textContent!==Se&&(W.suppressHydrationWarning!==!0&&Tv(A.textContent,Se,f),x=["children",Se]):typeof Se=="number"&&A.textContent!==""+Se&&(W.suppressHydrationWarning!==!0&&Tv(A.textContent,Se,f),x=["children",""+Se]):l.hasOwnProperty(ie)&&Se!=null&&ie==="onScroll"&&vi("scroll",A)}switch(T){case"input":xn(A),we(A,W,!0);break;case"textarea":xn(A),jn(A);break;case"select":case"option":break;default:typeof W.onClick=="function"&&(A.onclick=bv)}A=x,g.updateQueue=A,A!==null&&(g.flags|=4)}else{ie=x.nodeType===9?x:x.ownerDocument,f==="http://www.w3.org/1999/xhtml"&&(f=On(T)),f==="http://www.w3.org/1999/xhtml"?T==="script"?(f=ie.createElement("div"),f.innerHTML="<script><\/script>",f=f.removeChild(f.firstChild)):typeof A.is=="string"?f=ie.createElement(T,{is:A.is}):(f=ie.createElement(T),T==="select"&&(ie=f,A.multiple?ie.multiple=!0:A.size&&(ie.size=A.size))):f=ie.createElementNS(f,T),f[Rl]=g,f[vd]=A,bT(f,g,!1,!1),g.stateNode=f;e:{switch(ie=Mc(T,A),T){case"dialog":vi("cancel",f),vi("close",f),x=A;break;case"iframe":case"object":case"embed":vi("load",f),x=A;break;case"video":case"audio":for(x=0;x<eg.length;x++)vi(eg[x],f);x=A;break;case"source":vi("error",f),x=A;break;case"img":case"image":case"link":vi("error",f),vi("load",f),x=A;break;case"details":vi("toggle",f),x=A;break;case"input":bt(f,A),x=Ar(f,A),vi("invalid",f);break;case"option":x=A;break;case"select":f._wrapperState={wasMultiple:!!A.multiple},x=Ee({},A,{value:void 0}),vi("invalid",f);break;case"textarea":ht(f,A),x=gt(f,A),vi("invalid",f);break;default:x=A}$i(T,x),Se=x;for(W in Se)if(Se.hasOwnProperty(W)){var Ae=Se[W];W==="style"?rs(f,Ae):W==="dangerouslySetInnerHTML"?(Ae=Ae?Ae.__html:void 0,Ae!=null&&Ra(f,Ae)):W==="children"?typeof Ae=="string"?(T!=="textarea"||Ae!=="")&&_o(f,Ae):typeof Ae=="number"&&_o(f,""+Ae):W!=="suppressContentEditableWarning"&&W!=="suppressHydrationWarning"&&W!=="autoFocus"&&(l.hasOwnProperty(W)?Ae!=null&&W==="onScroll"&&vi("scroll",f):Ae!=null&&oe(f,W,Ae,ie))}switch(T){case"input":xn(f),we(f,A,!1);break;case"textarea":xn(f),jn(f);break;case"option":A.value!=null&&f.setAttribute("value",""+Ht(A.value));break;case"select":f.multiple=!!A.multiple,W=A.value,W!=null?mt(f,!!A.multiple,W,!1):A.defaultValue!=null&&mt(f,!!A.multiple,A.defaultValue,!0);break;default:typeof x.onClick=="function"&&(f.onclick=bv)}switch(T){case"button":case"input":case"select":case"textarea":A=!!A.autoFocus;break e;case"img":A=!0;break e;default:A=!1}}A&&(g.flags|=4)}g.ref!==null&&(g.flags|=512,g.flags|=2097152)}return yo(g),null;case 6:if(f&&g.stateNode!=null)wC(f,g,f.memoizedProps,A);else{if(typeof A!="string"&&g.stateNode===null)throw Error(o(166));if(T=Jh(dg.current),Jh($c.current),ag(g)){if(A=g.stateNode,T=g.memoizedProps,A[Rl]=g,(W=A.nodeValue!==T)&&(f=oa,f!==null))switch(f.tag){case 3:Tv(A.nodeValue,T,(f.mode&1)!==0);break;case 5:f.memoizedProps.suppressHydrationWarning!==!0&&Tv(A.nodeValue,T,(f.mode&1)!==0)}W&&(g.flags|=4)}else A=(T.nodeType===9?T:T.ownerDocument).createTextNode(A),A[Rl]=g,g.stateNode=A}return yo(g),null;case 13:if(Ei(Ti),A=g.memoizedState,f===null||f.memoizedState!==null&&f.memoizedState.dehydrated!==null){if(ni&&sa!==null&&(g.mode&1)!==0&&(g.flags&128)===0)zR(),yp(),g.flags|=98560,W=!1;else if(W=ag(g),A!==null&&A.dehydrated!==null){if(f===null){if(!W)throw Error(o(318));if(W=g.memoizedState,W=W!==null?W.dehydrated:null,!W)throw Error(o(317));W[Rl]=g}else yp(),(g.flags&128)===0&&(g.memoizedState=null),g.flags|=4;yo(g),W=!1}else Ns!==null&&(Mp(Ns),Ns=null),W=!0;if(!W)return g.flags&65536?g:null}return(g.flags&128)!==0?(g.lanes=T,g):(A=A!==null,A!==(f!==null&&f.memoizedState!==null)&&A&&(g.child.flags|=8192,(g.mode&1)!==0&&(f===null||(Ti.current&1)!==0?Pr===0&&(Pr=3):Du())),g.updateQueue!==null&&(g.flags|=4),yo(g),null);case 4:return Tp(),Kv(f,g),f===null&&Wh(g.stateNode.containerInfo),yo(g),null;case 10:return QS(g.type._context),yo(g),null;case 17:return ia(g.type)&&Rv(),yo(g),null;case 19:if(Ei(Ti),W=g.memoizedState,W===null)return yo(g),null;if(A=(g.flags&128)!==0,ie=W.rendering,ie===null)if(A)Tg(W,!1);else{if(Pr!==0||f!==null&&(f.flags&128)!==0)for(f=g.child;f!==null;){if(ie=bp(f),ie!==null){for(g.flags|=128,Tg(W,!1),A=ie.updateQueue,A!==null&&(g.updateQueue=A,g.flags|=4),g.subtreeFlags=0,A=T,T=g.child;T!==null;)W=T,f=A,W.flags&=14680066,ie=W.alternate,ie===null?(W.childLanes=0,W.lanes=f,W.child=null,W.subtreeFlags=0,W.memoizedProps=null,W.memoizedState=null,W.updateQueue=null,W.dependencies=null,W.stateNode=null):(W.childLanes=ie.childLanes,W.lanes=ie.lanes,W.child=ie.child,W.subtreeFlags=0,W.deletions=null,W.memoizedProps=ie.memoizedProps,W.memoizedState=ie.memoizedState,W.updateQueue=ie.updateQueue,W.type=ie.type,f=ie.dependencies,W.dependencies=f===null?null:{lanes:f.lanes,firstContext:f.firstContext}),T=T.sibling;return hi(Ti,Ti.current&1|2),g.child}f=f.sibling}W.tail!==null&&Ur()>rf&&(g.flags|=128,A=!0,Tg(W,!1),g.lanes=4194304)}else{if(!A)if(f=bp(ie),f!==null){if(g.flags|=128,A=!0,T=f.updateQueue,T!==null&&(g.updateQueue=T,g.flags|=4),Tg(W,!0),W.tail===null&&W.tailMode==="hidden"&&!ie.alternate&&!ni)return yo(g),null}else 2*Ur()-W.renderingStartTime>rf&&T!==1073741824&&(g.flags|=128,A=!0,Tg(W,!1),g.lanes=4194304);W.isBackwards?(ie.sibling=g.child,g.child=ie):(T=W.last,T!==null?T.sibling=ie:g.child=ie,W.last=ie)}return W.tail!==null?(g=W.tail,W.rendering=g,W.tail=g.sibling,W.renderingStartTime=Ur(),g.sibling=null,T=Ti.current,hi(Ti,A?T&1|2:T&1),g):(yo(g),null);case 22:case 23:return rE(),A=g.memoizedState!==null,f!==null&&f.memoizedState!==null!==A&&(g.flags|=8192),A&&(g.mode&1)!==0?(xo&1073741824)!==0&&(yo(g),g.subtreeFlags&6&&(g.flags|=8192)):yo(g),null;case 24:return null;case 25:return null}throw Error(o(156,g.tag))}function Vk(f,g){switch(sg(g),g.tag){case 1:return ia(g.type)&&Rv(),f=g.flags,f&65536?(g.flags=f&-65537|128,g):null;case 3:return Tp(),Ei(ra),Ei(os),oT(),f=g.flags,(f&65536)!==0&&(f&128)===0?(g.flags=f&-65537|128,g):null;case 5:return iT(g),null;case 13:if(Ei(Ti),f=g.memoizedState,f!==null&&f.dehydrated!==null){if(g.alternate===null)throw Error(o(340));yp()}return f=g.flags,f&65536?(g.flags=f&-65537|128,g):null;case 19:return Ei(Ti),null;case 4:return Tp(),null;case 10:return QS(g.type._context),null;case 22:case 23:return rE(),null;case 24:return null;default:return null}}var $v=!1,zo=!1,Fk=typeof WeakSet=="function"?WeakSet:Set,$t=null;function Cd(f,g){var T=f.ref;if(T!==null)if(typeof T=="function")try{T(null)}catch(A){Oi(f,g,A)}else T.current=null}function wT(f,g,T){try{T()}catch(A){Oi(f,g,A)}}var qv=!1;function jk(f,g){if(wv=_e,f=CR(),Jm(f)){if("selectionStart"in f)var T={start:f.selectionStart,end:f.selectionEnd};else e:{T=(T=f.ownerDocument)&&T.defaultView||window;var A=T.getSelection&&T.getSelection();if(A&&A.rangeCount!==0){T=A.anchorNode;var x=A.anchorOffset,W=A.focusNode;A=A.focusOffset;try{T.nodeType,W.nodeType}catch{T=null;break e}var ie=0,Se=-1,Ae=-1,ze=0,Et=0,St=f,vt=null;t:for(;;){for(var Ft;St!==T||x!==0&&St.nodeType!==3||(Se=ie+x),St!==W||A!==0&&St.nodeType!==3||(Ae=ie+A),St.nodeType===3&&(ie+=St.nodeValue.length),(Ft=St.firstChild)!==null;)vt=St,St=Ft;for(;;){if(St===f)break t;if(vt===T&&++ze===x&&(Se=ie),vt===W&&++Et===A&&(Ae=ie),(Ft=St.nextSibling)!==null)break;St=vt,vt=St.parentNode}St=Ft}T=Se===-1||Ae===-1?null:{start:Se,end:Ae}}else T=null}T=T||{start:0,end:0}}else T=null;for(ng={focusedElem:f,selectionRange:T},_e=!1,$t=g;$t!==null;)if(g=$t,f=g.child,(g.subtreeFlags&1028)!==0&&f!==null)f.return=g,$t=f;else for(;$t!==null;){g=$t;try{var Kt=g.alternate;if((g.flags&1024)!==0)switch(g.tag){case 0:case 11:case 15:break;case 1:if(Kt!==null){var Yt=Kt.memoizedProps,Yi=Kt.memoizedState,Ue=g.stateNode,Oe=Ue.getSnapshotBeforeUpdate(g.elementType===g.type?Yt:Kc(g.type,Yt),Yi);Ue.__reactInternalSnapshotBeforeUpdate=Oe}break;case 3:var Be=g.stateNode.containerInfo;Be.nodeType===1?Be.textContent="":Be.nodeType===9&&Be.documentElement&&Be.removeChild(Be.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(o(163))}}catch(wt){Oi(g,g.return,wt)}if(f=g.sibling,f!==null){f.return=g.return,$t=f;break}$t=g.return}return Kt=qv,qv=!1,Kt}function Op(f,g,T){var A=g.updateQueue;if(A=A!==null?A.lastEffect:null,A!==null){var x=A=A.next;do{if((x.tag&f)===f){var W=x.destroy;x.destroy=void 0,W!==void 0&&wT(g,T,W)}x=x.next}while(x!==A)}}function Yv(f,g){if(g=g.updateQueue,g=g!==null?g.lastEffect:null,g!==null){var T=g=g.next;do{if((T.tag&f)===f){var A=T.create;T.destroy=A()}T=T.next}while(T!==g)}}function RT(f){var g=f.ref;if(g!==null){var T=f.stateNode;switch(f.tag){case 5:f=T;break;default:f=T}typeof g=="function"?g(f):g.current=f}}function CT(f){var g=f.alternate;g!==null&&(f.alternate=null,CT(g)),f.child=null,f.deletions=null,f.sibling=null,f.tag===5&&(g=f.stateNode,g!==null&&(delete g[Rl],delete g[vd],delete g[ig],delete g[Rk],delete g[Ck])),f.stateNode=null,f.return=null,f.dependencies=null,f.memoizedProps=null,f.memoizedState=null,f.pendingProps=null,f.stateNode=null,f.updateQueue=null}function RC(f){return f.tag===5||f.tag===3||f.tag===4}function CC(f){e:for(;;){for(;f.sibling===null;){if(f.return===null||RC(f.return))return null;f=f.return}for(f.sibling.return=f.return,f=f.sibling;f.tag!==5&&f.tag!==6&&f.tag!==18;){if(f.flags&2||f.child===null||f.tag===4)continue e;f.child.return=f,f=f.child}if(!(f.flags&2))return f.stateNode}}function Xv(f,g,T){var A=f.tag;if(A===5||A===6)f=f.stateNode,g?T.nodeType===8?T.parentNode.insertBefore(f,g):T.insertBefore(f,g):(T.nodeType===8?(g=T.parentNode,g.insertBefore(f,T)):(g=T,g.appendChild(f)),T=T._reactRootContainer,T!=null||g.onclick!==null||(g.onclick=bv));else if(A!==4&&(f=f.child,f!==null))for(Xv(f,g,T),f=f.sibling;f!==null;)Xv(f,g,T),f=f.sibling}function IT(f,g,T){var A=f.tag;if(A===5||A===6)f=f.stateNode,g?T.insertBefore(f,g):T.appendChild(f);else if(A!==4&&(f=f.child,f!==null))for(IT(f,g,T),f=f.sibling;f!==null;)IT(f,g,T),f=f.sibling}var Lo=null,xa=!1;function Id(f,g,T){for(T=T.child;T!==null;)IC(f,g,T),T=T.sibling}function IC(f,g,T){if(is&&typeof is.onCommitFiberUnmount=="function")try{is.onCommitFiberUnmount(_l,T)}catch{}switch(T.tag){case 5:zo||Cd(T,g);case 6:var A=Lo,x=xa;Lo=null,Id(f,g,T),Lo=A,xa=x,Lo!==null&&(xa?(f=Lo,T=T.stateNode,f.nodeType===8?f.parentNode.removeChild(T):f.removeChild(T)):Lo.removeChild(T.stateNode));break;case 18:Lo!==null&&(xa?(f=Lo,T=T.stateNode,f.nodeType===8?HS(f.parentNode,T):f.nodeType===1&&HS(f,T),ta(f)):HS(Lo,T.stateNode));break;case 4:A=Lo,x=xa,Lo=T.stateNode.containerInfo,xa=!0,Id(f,g,T),Lo=A,xa=x;break;case 0:case 11:case 14:case 15:if(!zo&&(A=T.updateQueue,A!==null&&(A=A.lastEffect,A!==null))){x=A=A.next;do{var W=x,ie=W.destroy;W=W.tag,ie!==void 0&&((W&2)!==0||(W&4)!==0)&&wT(T,g,ie),x=x.next}while(x!==A)}Id(f,g,T);break;case 1:if(!zo&&(Cd(T,g),A=T.stateNode,typeof A.componentWillUnmount=="function"))try{A.props=T.memoizedProps,A.state=T.memoizedState,A.componentWillUnmount()}catch(Se){Oi(T,g,Se)}Id(f,g,T);break;case 21:Id(f,g,T);break;case 22:T.mode&1?(zo=(A=zo)||T.memoizedState!==null,Id(f,g,T),zo=A):Id(f,g,T);break;default:Id(f,g,T)}}function Pp(f){var g=f.updateQueue;if(g!==null){f.updateQueue=null;var T=f.stateNode;T===null&&(T=f.stateNode=new Fk),g.forEach(function(A){var x=xT.bind(null,f,A);T.has(A)||(T.add(A),A.then(x,x))})}}function dc(f,g){var T=g.deletions;if(T!==null)for(var A=0;A<T.length;A++){var x=T[A];try{var W=f,ie=g,Se=ie;e:for(;Se!==null;){switch(Se.tag){case 5:Lo=Se.stateNode,xa=!1;break e;case 3:Lo=Se.stateNode.containerInfo,xa=!0;break e;case 4:Lo=Se.stateNode.containerInfo,xa=!0;break e}Se=Se.return}if(Lo===null)throw Error(o(160));IC(W,ie,x),Lo=null,xa=!1;var Ae=x.alternate;Ae!==null&&(Ae.return=null),x.return=null}catch(ze){Oi(x,g,ze)}}if(g.subtreeFlags&12854)for(g=g.child;g!==null;)Np(g,f),g=g.sibling}function Np(f,g){var T=f.alternate,A=f.flags;switch(f.tag){case 0:case 11:case 14:case 15:if(dc(g,f),ks(f),A&4){try{Op(3,f,f.return),Yv(3,f)}catch(Yt){Oi(f,f.return,Yt)}try{Op(5,f,f.return)}catch(Yt){Oi(f,f.return,Yt)}}break;case 1:dc(g,f),ks(f),A&512&&T!==null&&Cd(T,T.return);break;case 5:if(dc(g,f),ks(f),A&512&&T!==null&&Cd(T,T.return),f.flags&32){var x=f.stateNode;try{_o(x,"")}catch(Yt){Oi(f,f.return,Yt)}}if(A&4&&(x=f.stateNode,x!=null)){var W=f.memoizedProps,ie=T!==null?T.memoizedProps:W,Se=f.type,Ae=f.updateQueue;if(f.updateQueue=null,Ae!==null)try{Se==="input"&&W.type==="radio"&&W.name!=null&&bn(x,W),Mc(Se,ie);var ze=Mc(Se,W);for(ie=0;ie<Ae.length;ie+=2){var Et=Ae[ie],St=Ae[ie+1];Et==="style"?rs(x,St):Et==="dangerouslySetInnerHTML"?Ra(x,St):Et==="children"?_o(x,St):oe(x,Et,St,ze)}switch(Se){case"input":wn(x,W);break;case"textarea":Mt(x,W);break;case"select":var vt=x._wrapperState.wasMultiple;x._wrapperState.wasMultiple=!!W.multiple;var Ft=W.value;Ft!=null?mt(x,!!W.multiple,Ft,!1):vt!==!!W.multiple&&(W.defaultValue!=null?mt(x,!!W.multiple,W.defaultValue,!0):mt(x,!!W.multiple,W.multiple?[]:"",!1))}x[vd]=W}catch(Yt){Oi(f,f.return,Yt)}}break;case 6:if(dc(g,f),ks(f),A&4){if(f.stateNode===null)throw Error(o(162));x=f.stateNode,W=f.memoizedProps;try{x.nodeValue=W}catch(Yt){Oi(f,f.return,Yt)}}break;case 3:if(dc(g,f),ks(f),A&4&&T!==null&&T.memoizedState.isDehydrated)try{ta(g.containerInfo)}catch(Yt){Oi(f,f.return,Yt)}break;case 4:dc(g,f),ks(f);break;case 13:dc(g,f),ks(f),x=f.child,x.flags&8192&&(W=x.memoizedState!==null,x.stateNode.isHidden=W,!W||x.alternate!==null&&x.alternate.memoizedState!==null||(PT=Ur())),A&4&&Pp(f);break;case 22:if(Et=T!==null&&T.memoizedState!==null,f.mode&1?(zo=(ze=zo)||Et,dc(g,f),zo=ze):dc(g,f),ks(f),A&8192){if(ze=f.memoizedState!==null,(f.stateNode.isHidden=ze)&&!Et&&(f.mode&1)!==0)for($t=f,Et=f.child;Et!==null;){for(St=$t=Et;$t!==null;){switch(vt=$t,Ft=vt.child,vt.tag){case 0:case 11:case 14:case 15:Op(4,vt,vt.return);break;case 1:Cd(vt,vt.return);var Kt=vt.stateNode;if(typeof Kt.componentWillUnmount=="function"){A=vt,T=vt.return;try{g=A,Kt.props=g.memoizedProps,Kt.state=g.memoizedState,Kt.componentWillUnmount()}catch(Yt){Oi(A,T,Yt)}}break;case 5:Cd(vt,vt.return);break;case 22:if(vt.memoizedState!==null){OC(St);continue}}Ft!==null?(Ft.return=vt,$t=Ft):OC(St)}Et=Et.sibling}e:for(Et=null,St=f;;){if(St.tag===5){if(Et===null){Et=St;try{x=St.stateNode,ze?(W=x.style,typeof W.setProperty=="function"?W.setProperty("display","none","important"):W.display="none"):(Se=St.stateNode,Ae=St.memoizedProps.style,ie=Ae!=null&&Ae.hasOwnProperty("display")?Ae.display:null,Se.style.display=fn("display",ie))}catch(Yt){Oi(f,f.return,Yt)}}}else if(St.tag===6){if(Et===null)try{St.stateNode.nodeValue=ze?"":St.memoizedProps}catch(Yt){Oi(f,f.return,Yt)}}else if((St.tag!==22&&St.tag!==23||St.memoizedState===null||St===f)&&St.child!==null){St.child.return=St,St=St.child;continue}if(St===f)break e;for(;St.sibling===null;){if(St.return===null||St.return===f)break e;Et===St&&(Et=null),St=St.return}Et===St&&(Et=null),St.sibling.return=St.return,St=St.sibling}}break;case 19:dc(g,f),ks(f),A&4&&Pp(f);break;case 21:break;default:dc(g,f),ks(f)}}function ks(f){var g=f.flags;if(g&2){try{e:{for(var T=f.return;T!==null;){if(RC(T)){var A=T;break e}T=T.return}throw Error(o(160))}switch(A.tag){case 5:var x=A.stateNode;A.flags&32&&(_o(x,""),A.flags&=-33);var W=CC(f);IT(f,W,x);break;case 3:case 4:var ie=A.stateNode.containerInfo,Se=CC(f);Xv(f,Se,ie);break;default:throw Error(o(161))}}catch(Ae){Oi(f,f.return,Ae)}f.flags&=-3}g&4096&&(f.flags&=-4097)}function AC(f,g,T){$t=f,Jv(f)}function Jv(f,g,T){for(var A=(f.mode&1)!==0;$t!==null;){var x=$t,W=x.child;if(x.tag===22&&A){var ie=x.memoizedState!==null||$v;if(!ie){var Se=x.alternate,Ae=Se!==null&&Se.memoizedState!==null||zo;Se=$v;var ze=zo;if($v=ie,(zo=Ae)&&!ze)for($t=x;$t!==null;)ie=$t,Ae=ie.child,ie.tag===22&&ie.memoizedState!==null?PC(x):Ae!==null?(Ae.return=ie,$t=Ae):PC(x);for(;W!==null;)$t=W,Jv(W),W=W.sibling;$t=x,$v=Se,zo=ze}bg(f)}else(x.subtreeFlags&8772)!==0&&W!==null?(W.return=x,$t=W):bg(f)}}function bg(f){for(;$t!==null;){var g=$t;if((g.flags&8772)!==0){var T=g.alternate;try{if((g.flags&8772)!==0)switch(g.tag){case 0:case 11:case 15:zo||Yv(5,g);break;case 1:var A=g.stateNode;if(g.flags&4&&!zo)if(T===null)A.componentDidMount();else{var x=g.elementType===g.type?T.memoizedProps:Kc(g.type,T.memoizedProps);A.componentDidUpdate(x,T.memoizedState,A.__reactInternalSnapshotBeforeUpdate)}var W=g.updateQueue;W!==null&&tT(g,W,A);break;case 3:var ie=g.updateQueue;if(ie!==null){if(T=null,g.child!==null)switch(g.child.tag){case 5:T=g.child.stateNode;break;case 1:T=g.child.stateNode}tT(g,ie,T)}break;case 5:var Se=g.stateNode;if(T===null&&g.flags&4){T=Se;var Ae=g.memoizedProps;switch(g.type){case"button":case"input":case"select":case"textarea":Ae.autoFocus&&T.focus();break;case"img":Ae.src&&(T.src=Ae.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(g.memoizedState===null){var ze=g.alternate;if(ze!==null){var Et=ze.memoizedState;if(Et!==null){var St=Et.dehydrated;St!==null&&ta(St)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(o(163))}zo||g.flags&512&&RT(g)}catch(vt){Oi(g,g.return,vt)}}if(g===f){$t=null;break}if(T=g.sibling,T!==null){T.return=g.return,$t=T;break}$t=g.return}}function OC(f){for(;$t!==null;){var g=$t;if(g===f){$t=null;break}var T=g.sibling;if(T!==null){T.return=g.return,$t=T;break}$t=g.return}}function PC(f){for(;$t!==null;){var g=$t;try{switch(g.tag){case 0:case 11:case 15:var T=g.return;try{Yv(4,g)}catch(Ae){Oi(g,T,Ae)}break;case 1:var A=g.stateNode;if(typeof A.componentDidMount=="function"){var x=g.return;try{A.componentDidMount()}catch(Ae){Oi(g,x,Ae)}}var W=g.return;try{RT(g)}catch(Ae){Oi(g,W,Ae)}break;case 5:var ie=g.return;try{RT(g)}catch(Ae){Oi(g,ie,Ae)}}}catch(Ae){Oi(g,g.return,Ae)}if(g===f){$t=null;break}var Se=g.sibling;if(Se!==null){Se.return=g.return,$t=Se;break}$t=g.return}}var Bk=Math.ceil,wg=se.ReactCurrentDispatcher,AT=se.ReactCurrentOwner,hc=se.ReactCurrentBatchConfig,vr=0,so=null,Ai=null,Ho=0,xo=0,tf=oc(0),Pr=0,Rg=null,nf=0,Cg=0,OT=0,kp=null,Ds=null,PT=0,rf=1/0,Pu=null,Qv=!1,NT=null,Ol=null,Dp=!1,Ad=null,Lp=0,Ig=0,Zv=null,eE=-1,xp=0;function So(){return(vr&6)!==0?Ur():eE!==-1?eE:eE=Ur()}function Nu(f){return(f.mode&1)===0?1:(vr&2)!==0&&Ho!==0?Ho&-Ho:Ak.transition!==null?(xp===0&&(xp=mu()),xp):(f=Jn,f!==0||(f=window.event,f=f===void 0?16:Vr(f.type)),f)}function Ma(f,g,T,A){if(50<Ig)throw Ig=0,Zv=null,Error(o(185));yl(f,T,A),((vr&2)===0||f!==so)&&(f===so&&((vr&2)===0&&(Cg|=T),Pr===4&&Ua(f,Ho)),ss(f,A),T===1&&vr===0&&(g.mode&1)===0&&(rf=Ur()+500,Av&&yd()))}function ss(f,g){var T=f.callbackNode;Aa(f,g);var A=El(f,f===so?Ho:0);if(A===0)T!==null&&fu(T),f.callbackNode=null,f.callbackPriority=0;else if(g=A&-A,f.callbackPriority!==g){if(T!=null&&fu(T),g===1)f.tag===0?Ik(nE.bind(null,f)):jR(nE.bind(null,f)),bk(function(){(vr&6)===0&&yd()}),T=null;else{switch(Za(A)){case 1:T=Qa;break;case 4:T=Fc;break;case 16:T=Zs;break;case 536870912:T=dd;break;default:T=Zs}T=kg(T,kT.bind(null,f))}f.callbackPriority=g,f.callbackNode=T}}function kT(f,g){if(eE=-1,xp=0,(vr&6)!==0)throw Error(o(327));var T=f.callbackNode;if(Pd()&&f.callbackNode!==T)return null;var A=El(f,f===so?Ho:0);if(A===0)return null;if((A&30)!==0||(A&f.expiredLanes)!==0||g)g=Og(f,A);else{g=A;var x=vr;vr|=2;var W=DC();(so!==f||Ho!==g)&&(Pu=null,rf=Ur()+500,Od(f,g));do try{DT();break}catch(Se){kC(f,Se)}while(!0);JS(),wg.current=W,vr=x,Ai!==null?g=0:(so=null,Ho=0,g=Pr)}if(g!==0){if(g===2&&(x=ys(f),x!==0&&(A=x,g=tE(f,x))),g===1)throw T=Rg,Od(f,0),Ua(f,A),ss(f,Ur()),T;if(g===6)Ua(f,A);else{if(x=f.current.alternate,(A&30)===0&&!NC(x)&&(g=Og(f,A),g===2&&(W=ys(f),W!==0&&(A=W,g=tE(f,W))),g===1))throw T=Rg,Od(f,0),Ua(f,A),ss(f,Ur()),T;switch(f.finishedWork=x,f.finishedLanes=A,g){case 0:case 1:throw Error(o(345));case 2:of(f,Ds,Pu);break;case 3:if(Ua(f,A),(A&130023424)===A&&(g=PT+500-Ur(),10<g)){if(El(f,0)!==0)break;if(x=f.suspendedLanes,(x&A)!==A){So(),f.pingedLanes|=f.suspendedLanes&x;break}f.timeoutHandle=rg(of.bind(null,f,Ds,Pu),g);break}of(f,Ds,Pu);break;case 4:if(Ua(f,A),(A&4194240)===A)break;for(g=f.eventTimes,x=-1;0<A;){var ie=31-Wo(A);W=1<<ie,ie=g[ie],ie>x&&(x=ie),A&=~W}if(A=x,A=Ur()-A,A=(120>A?120:480>A?480:1080>A?1080:1920>A?1920:3e3>A?3e3:4320>A?4320:1960*Bk(A/1960))-A,10<A){f.timeoutHandle=rg(of.bind(null,f,Ds,Pu),A);break}of(f,Ds,Pu);break;case 5:of(f,Ds,Pu);break;default:throw Error(o(329))}}}return ss(f,Ur()),f.callbackNode===T?kT.bind(null,f):null}function tE(f,g){var T=kp;return f.current.memoizedState.isDehydrated&&(Od(f,g).flags|=256),f=Og(f,g),f!==2&&(g=Ds,Ds=T,g!==null&&Mp(g)),f}function Mp(f){Ds===null?Ds=f:Ds.push.apply(Ds,f)}function NC(f){for(var g=f;;){if(g.flags&16384){var T=g.updateQueue;if(T!==null&&(T=T.stores,T!==null))for(var A=0;A<T.length;A++){var x=T[A],W=x.getSnapshot;x=x.value;try{if(!Hc(W(),x))return!1}catch{return!1}}}if(T=g.child,g.subtreeFlags&16384&&T!==null)T.return=g,g=T;else{if(g===f)break;for(;g.sibling===null;){if(g.return===null||g.return===f)return!0;g=g.return}g.sibling.return=g.return,g=g.sibling}}return!0}function Ua(f,g){for(g&=~OT,g&=~Cg,f.suspendedLanes|=g,f.pingedLanes&=~g,f=f.expirationTimes;0<g;){var T=31-Wo(g),A=1<<T;f[T]=-1,g&=~A}}function nE(f){if((vr&6)!==0)throw Error(o(327));Pd();var g=El(f,0);if((g&1)===0)return ss(f,Ur()),null;var T=Og(f,g);if(f.tag!==0&&T===2){var A=ys(f);A!==0&&(g=A,T=tE(f,A))}if(T===1)throw T=Rg,Od(f,0),Ua(f,g),ss(f,Ur()),T;if(T===6)throw Error(o(345));return f.finishedWork=f.current.alternate,f.finishedLanes=g,of(f,Ds,Pu),ss(f,Ur()),null}function Ag(f,g){var T=vr;vr|=1;try{return f(g)}finally{vr=T,vr===0&&(rf=Ur()+500,Av&&yd())}}function ku(f){Ad!==null&&Ad.tag===0&&(vr&6)===0&&Pd();var g=vr;vr|=1;var T=hc.transition,A=Jn;try{if(hc.transition=null,Jn=1,f)return f()}finally{Jn=A,hc.transition=T,vr=g,(vr&6)===0&&yd()}}function rE(){xo=tf.current,Ei(tf)}function Od(f,g){f.finishedWork=null,f.finishedLanes=0;var T=f.timeoutHandle;if(T!==-1&&(f.timeoutHandle=-1,Tk(T)),Ai!==null)for(T=Ai.return;T!==null;){var A=T;switch(sg(A),A.tag){case 1:A=A.type.childContextTypes,A!=null&&Rv();break;case 3:Tp(),Ei(ra),Ei(os),oT();break;case 5:iT(A);break;case 4:Tp();break;case 13:Ei(Ti);break;case 19:Ei(Ti);break;case 10:QS(A.type._context);break;case 22:case 23:rE()}T=T.return}if(so=f,Ai=f=Nd(f.current,null),Ho=xo=g,Pr=0,Rg=null,OT=Cg=nf=0,Ds=kp=null,Yh!==null){for(g=0;g<Yh.length;g++)if(T=Yh[g],A=T.interleaved,A!==null){T.interleaved=null;var x=A.next,W=T.pending;if(W!==null){var ie=W.next;W.next=x,A.next=ie}T.pending=A}Yh=null}return f}function kC(f,g){do{var T=Ai;try{if(JS(),jv.current=zv,Au){for(var A=Ii.memoizedState;A!==null;){var x=A.queue;x!==null&&(x.pending=null),A=A.next}Au=!1}if(Qh=0,Do=Fi=Ii=null,Zh=!1,wd=0,AT.current=null,T===null||T.return===null){Pr=1,Rg=g,Ai=null;break}e:{var W=f,ie=T.return,Se=T,Ae=g;if(g=Ho,Se.flags|=32768,Ae!==null&&typeof Ae=="object"&&typeof Ae.then=="function"){var ze=Ae,Et=Se,St=Et.tag;if((Et.mode&1)===0&&(St===0||St===11||St===15)){var vt=Et.alternate;vt?(Et.updateQueue=vt.updateQueue,Et.memoizedState=vt.memoizedState,Et.lanes=vt.lanes):(Et.updateQueue=null,Et.memoizedState=null)}var Ft=fC(ie);if(Ft!==null){Ft.flags&=-257,pC(Ft,ie,Se,W,g),Ft.mode&1&&hC(W,ze,g),g=Ft,Ae=ze;var Kt=g.updateQueue;if(Kt===null){var Yt=new Set;Yt.add(Ae),g.updateQueue=Yt}else Kt.add(Ae);break e}else{if((g&1)===0){hC(W,ze,g),Du();break e}Ae=Error(o(426))}}else if(ni&&Se.mode&1){var Yi=fC(ie);if(Yi!==null){(Yi.flags&65536)===0&&(Yi.flags|=256),pC(Yi,ie,Se,W,g),YS(Cp(Ae,Se));break e}}W=Ae=Cp(Ae,Se),Pr!==4&&(Pr=2),kp===null?kp=[W]:kp.push(W),W=ie;do{switch(W.tag){case 3:W.flags|=65536,g&=-g,W.lanes|=g;var Ue=Ou(W,Ae,g);Mv(W,Ue);break e;case 1:Se=Ae;var Oe=W.type,Be=W.stateNode;if((W.flags&128)===0&&(typeof Oe.getDerivedStateFromError=="function"||Be!==null&&typeof Be.componentDidCatch=="function"&&(Ol===null||!Ol.has(Be)))){W.flags|=65536,g&=-g,W.lanes|=g;var wt=dC(W,Se,g);Mv(W,wt);break e}}W=W.return}while(W!==null)}xC(T)}catch(Jt){g=Jt,Ai===T&&T!==null&&(Ai=T=T.return);continue}break}while(!0)}function DC(){var f=wg.current;return wg.current=zv,f===null?zv:f}function Du(){(Pr===0||Pr===3||Pr===2)&&(Pr=4),so===null||(nf&268435455)===0&&(Cg&268435455)===0||Ua(so,Ho)}function Og(f,g){var T=vr;vr|=2;var A=DC();(so!==f||Ho!==g)&&(Pu=null,Od(f,g));do try{Wk();break}catch(x){kC(f,x)}while(!0);if(JS(),vr=T,wg.current=A,Ai!==null)throw Error(o(261));return so=null,Ho=0,Pr}function Wk(){for(;Ai!==null;)LC(Ai)}function DT(){for(;Ai!==null&&!Es();)LC(Ai)}function LC(f){var g=Ng(f.alternate,f,xo);f.memoizedProps=f.pendingProps,g===null?xC(f):Ai=g,AT.current=null}function xC(f){var g=f;do{var T=g.alternate;if(f=g.return,(g.flags&32768)===0){if(T=Uk(T,g,xo),T!==null){Ai=T;return}}else{if(T=Vk(T,g),T!==null){T.flags&=32767,Ai=T;return}if(f!==null)f.flags|=32768,f.subtreeFlags=0,f.deletions=null;else{Pr=6,Ai=null;return}}if(g=g.sibling,g!==null){Ai=g;return}Ai=g=f}while(g!==null);Pr===0&&(Pr=5)}function of(f,g,T){var A=Jn,x=hc.transition;try{hc.transition=null,Jn=1,Gk(f,g,T,A)}finally{hc.transition=x,Jn=A}return null}function Gk(f,g,T,A){do Pd();while(Ad!==null);if((vr&6)!==0)throw Error(o(327));T=f.finishedWork;var x=f.finishedLanes;if(T===null)return null;if(f.finishedWork=null,f.finishedLanes=0,T===f.current)throw Error(o(177));f.callbackNode=null,f.callbackPriority=0;var W=T.lanes|T.childLanes;if(Wr(f,W),f===so&&(Ai=so=null,Ho=0),(T.subtreeFlags&2064)===0&&(T.flags&2064)===0||Dp||(Dp=!0,kg(Zs,function(){return Pd(),null})),W=(T.flags&15990)!==0,(T.subtreeFlags&15990)!==0||W){W=hc.transition,hc.transition=null;var ie=Jn;Jn=1;var Se=vr;vr|=4,AT.current=null,jk(f,T),Np(T,f),VS(ng),_e=!!wv,ng=wv=null,f.current=T,AC(T),ud(),vr=Se,Jn=ie,hc.transition=W}else f.current=T;if(Dp&&(Dp=!1,Ad=f,Lp=x),W=f.pendingLanes,W===0&&(Ol=null),tp(T.stateNode),ss(f,Ur()),g!==null)for(A=f.onRecoverableError,T=0;T<g.length;T++)x=g[T],A(x.value,{componentStack:x.stack,digest:x.digest});if(Qv)throw Qv=!1,f=NT,NT=null,f;return(Lp&1)!==0&&f.tag!==0&&Pd(),W=f.pendingLanes,(W&1)!==0?f===Zv?Ig++:(Ig=0,Zv=f):Ig=0,yd(),null}function Pd(){if(Ad!==null){var f=Za(Lp),g=hc.transition,T=Jn;try{if(hc.transition=null,Jn=16>f?16:f,Ad===null)var A=!1;else{if(f=Ad,Ad=null,Lp=0,(vr&6)!==0)throw Error(o(331));var x=vr;for(vr|=4,$t=f.current;$t!==null;){var W=$t,ie=W.child;if(($t.flags&16)!==0){var Se=W.deletions;if(Se!==null){for(var Ae=0;Ae<Se.length;Ae++){var ze=Se[Ae];for($t=ze;$t!==null;){var Et=$t;switch(Et.tag){case 0:case 11:case 15:Op(8,Et,W)}var St=Et.child;if(St!==null)St.return=Et,$t=St;else for(;$t!==null;){Et=$t;var vt=Et.sibling,Ft=Et.return;if(CT(Et),Et===ze){$t=null;break}if(vt!==null){vt.return=Ft,$t=vt;break}$t=Ft}}}var Kt=W.alternate;if(Kt!==null){var Yt=Kt.child;if(Yt!==null){Kt.child=null;do{var Yi=Yt.sibling;Yt.sibling=null,Yt=Yi}while(Yt!==null)}}$t=W}}if((W.subtreeFlags&2064)!==0&&ie!==null)ie.return=W,$t=ie;else e:for(;$t!==null;){if(W=$t,(W.flags&2048)!==0)switch(W.tag){case 0:case 11:case 15:Op(9,W,W.return)}var Ue=W.sibling;if(Ue!==null){Ue.return=W.return,$t=Ue;break e}$t=W.return}}var Oe=f.current;for($t=Oe;$t!==null;){ie=$t;var Be=ie.child;if((ie.subtreeFlags&2064)!==0&&Be!==null)Be.return=ie,$t=Be;else e:for(ie=Oe;$t!==null;){if(Se=$t,(Se.flags&2048)!==0)try{switch(Se.tag){case 0:case 11:case 15:Yv(9,Se)}}catch(Jt){Oi(Se,Se.return,Jt)}if(Se===ie){$t=null;break e}var wt=Se.sibling;if(wt!==null){wt.return=Se.return,$t=wt;break e}$t=Se.return}}if(vr=x,yd(),is&&typeof is.onPostCommitFiberRoot=="function")try{is.onPostCommitFiberRoot(_l,f)}catch{}A=!0}return A}finally{Jn=T,hc.transition=g}}return!1}function LT(f,g,T){g=Cp(T,g),g=Ou(f,g,1),f=Td(f,g,1),g=So(),f!==null&&(yl(f,1,g),ss(f,g))}function Oi(f,g,T){if(f.tag===3)LT(f,f,T);else for(;g!==null;){if(g.tag===3){LT(g,f,T);break}else if(g.tag===1){var A=g.stateNode;if(typeof g.type.getDerivedStateFromError=="function"||typeof A.componentDidCatch=="function"&&(Ol===null||!Ol.has(A))){f=Cp(T,f),f=dC(g,f,1),g=Td(g,f,1),f=So(),g!==null&&(yl(g,1,f),ss(g,f));break}}g=g.return}}function MC(f,g,T){var A=f.pingCache;A!==null&&A.delete(g),g=So(),f.pingedLanes|=f.suspendedLanes&T,so===f&&(Ho&T)===T&&(Pr===4||Pr===3&&(Ho&130023424)===Ho&&500>Ur()-PT?Od(f,0):OT|=T),ss(f,g)}function Pg(f,g){g===0&&((f.mode&1)===0?g=1:(g=sr,sr<<=1,(sr&130023424)===0&&(sr=4194304)));var T=So();f=lc(f,g),f!==null&&(yl(f,g,T),ss(f,T))}function UC(f){var g=f.memoizedState,T=0;g!==null&&(T=g.retryLane),Pg(f,T)}function xT(f,g){var T=0;switch(f.tag){case 13:var A=f.stateNode,x=f.memoizedState;x!==null&&(T=x.retryLane);break;case 19:A=f.stateNode;break;default:throw Error(o(314))}A!==null&&A.delete(g),Pg(f,T)}var Ng;Ng=function(f,g,T){if(f!==null)if(f.memoizedProps!==g.pendingProps||ra.current)aa=!0;else{if((f.lanes&T)===0&&(g.flags&128)===0)return aa=!1,Mk(f,g,T);aa=(f.flags&131072)!==0}else aa=!1,ni&&(g.flags&1048576)!==0&&Pv(g,Ov,g.index);switch(g.lanes=0,g.tag){case 2:var A=g.type;Sg(f,g),f=g.pendingProps;var x=$h(g,os.current);Sp(g,T),x=Bv(null,g,A,f,x,T);var W=cT();return g.flags|=1,typeof x=="object"&&x!==null&&typeof x.render=="function"&&x.$$typeof===void 0?(g.tag=1,g.memoizedState=null,g.updateQueue=null,ia(A)?(W=!0,Iv(g)):W=!1,g.memoizedState=x.state!==null&&x.state!==void 0?x.state:null,eT(g),x.updater=Fv,g.stateNode=x,x._reactInternals=g,nT(g,A,f,T),g=Hv(null,g,A,!0,W,T)):(g.tag=0,ni&&W&&Nv(g),Go(null,g,x,T),g=g.child),g;case 16:A=g.elementType;e:{switch(Sg(f,g),f=g.pendingProps,x=A._init,A=x(A._payload),g.type=A,x=g.tag=FC(A),f=Kc(A,f),x){case 0:g=ET(null,g,A,f,T);break e;case 1:g=yT(null,g,A,f,T);break e;case 11:g=mC(null,g,A,f,T);break e;case 14:g=gC(null,g,A,Kc(A.type,f),T);break e}throw Error(o(306,A,""))}return g;case 0:return A=g.type,x=g.pendingProps,x=g.elementType===A?x:Kc(A,x),ET(f,g,A,x,T);case 1:return A=g.type,x=g.pendingProps,x=g.elementType===A?x:Kc(A,x),yT(f,g,A,x,T);case 3:e:{if(yC(g),f===null)throw Error(o(387));A=g.pendingProps,W=g.memoizedState,x=W.element,KR(f,g),Uv(g,A,null,T);var ie=g.memoizedState;if(A=ie.element,W.isDehydrated)if(W={element:A,isDehydrated:!1,cache:ie.cache,pendingSuspenseBoundaries:ie.pendingSuspenseBoundaries,transitions:ie.transitions},g.updateQueue.baseState=W,g.memoizedState=W,g.flags&256){x=Cp(Error(o(423)),g),g=SC(f,g,A,T,x);break e}else if(A!==x){x=Cp(Error(o(424)),g),g=SC(f,g,A,T,x);break e}else for(sa=_d(g.stateNode.containerInfo.firstChild),oa=g,ni=!0,Ns=null,T=ZR(g,null,A,T),g.child=T;T;)T.flags=T.flags&-3|4096,T=T.sibling;else{if(yp(),A===x){g=Al(f,g,T);break e}Go(f,g,A,T)}g=g.child}return g;case 5:return hg(g),f===null&&qS(g),A=g.type,x=g.pendingProps,W=f!==null?f.memoizedProps:null,ie=x.children,zS(A,x)?ie=null:W!==null&&zS(A,W)&&(g.flags|=32),EC(f,g),Go(f,g,ie,T),g.child;case 6:return f===null&&qS(g),null;case 13:return ST(f,g,T);case 4:return rT(g,g.stateNode.containerInfo),A=g.pendingProps,f===null?g.child=Xh(g,null,A,T):Go(f,g,A,T),g.child;case 11:return A=g.type,x=g.pendingProps,x=g.elementType===A?x:Kc(A,x),mC(f,g,A,x,T);case 7:return Go(f,g,g.pendingProps,T),g.child;case 8:return Go(f,g,g.pendingProps.children,T),g.child;case 12:return Go(f,g,g.pendingProps.children,T),g.child;case 10:e:{if(A=g.type._context,x=g.pendingProps,W=g.memoizedProps,ie=x.value,hi(Dv,A._currentValue),A._currentValue=ie,W!==null)if(Hc(W.value,ie)){if(W.children===x.children&&!ra.current){g=Al(f,g,T);break e}}else for(W=g.child,W!==null&&(W.return=g);W!==null;){var Se=W.dependencies;if(Se!==null){ie=W.child;for(var Ae=Se.firstContext;Ae!==null;){if(Ae.context===A){if(W.tag===1){Ae=Cu(-1,T&-T),Ae.tag=2;var ze=W.updateQueue;if(ze!==null){ze=ze.shared;var Et=ze.pending;Et===null?Ae.next=Ae:(Ae.next=Et.next,Et.next=Ae),ze.pending=Ae}}W.lanes|=T,Ae=W.alternate,Ae!==null&&(Ae.lanes|=T),Lv(W.return,T,g),Se.lanes|=T;break}Ae=Ae.next}}else if(W.tag===10)ie=W.type===g.type?null:W.child;else if(W.tag===18){if(ie=W.return,ie===null)throw Error(o(341));ie.lanes|=T,Se=ie.alternate,Se!==null&&(Se.lanes|=T),Lv(ie,T,g),ie=W.sibling}else ie=W.child;if(ie!==null)ie.return=W;else for(ie=W;ie!==null;){if(ie===g){ie=null;break}if(W=ie.sibling,W!==null){W.return=ie.return,ie=W;break}ie=ie.return}W=ie}Go(f,g,x.children,T),g=g.child}return g;case 9:return x=g.type,A=g.pendingProps.children,Sp(g,T),x=La(x),A=A(x),g.flags|=1,Go(f,g,A,T),g.child;case 14:return A=g.type,x=Kc(A,g.pendingProps),x=Kc(A.type,x),gC(f,g,A,x,T);case 15:return _C(f,g,g.type,g.pendingProps,T);case 17:return A=g.type,x=g.pendingProps,x=g.elementType===A?x:Kc(A,x),Sg(f,g),g.tag=1,ia(A)?(f=!0,Iv(g)):f=!1,Sp(g,T),YR(g,A,x),nT(g,A,x,T),Hv(null,g,A,!0,f,T);case 19:return TC(f,g,T);case 22:return vC(f,g,T)}throw Error(o(156,g.tag))};function kg(f,g){return ld(f,g)}function VC(f,g,T,A){this.tag=f,this.key=T,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=g,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=A,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ko(f,g,T,A){return new VC(f,g,T,A)}function Lu(f){return f=f.prototype,!(!f||!f.isReactComponent)}function FC(f){if(typeof f=="function")return Lu(f)?1:0;if(f!=null){if(f=f.$$typeof,f===fe)return 11;if(f===ft)return 14}return 2}function Nd(f,g){var T=f.alternate;return T===null?(T=Ko(f.tag,g,f.key,f.mode),T.elementType=f.elementType,T.type=f.type,T.stateNode=f.stateNode,T.alternate=f,f.alternate=T):(T.pendingProps=g,T.type=f.type,T.flags=0,T.subtreeFlags=0,T.deletions=null),T.flags=f.flags&14680064,T.childLanes=f.childLanes,T.lanes=f.lanes,T.child=f.child,T.memoizedProps=f.memoizedProps,T.memoizedState=f.memoizedState,T.updateQueue=f.updateQueue,g=f.dependencies,T.dependencies=g===null?null:{lanes:g.lanes,firstContext:g.firstContext},T.sibling=f.sibling,T.index=f.index,T.ref=f.ref,T}function iE(f,g,T,A,x,W){var ie=2;if(A=f,typeof f=="function")Lu(f)&&(ie=1);else if(typeof f=="string")ie=5;else e:switch(f){case Q:return Xc(T.children,x,W,g);case te:ie=8,x|=8;break;case re:return f=Ko(12,T,g,x|2),f.elementType=re,f.lanes=W,f;case de:return f=Ko(13,T,g,x),f.elementType=de,f.lanes=W,f;case lt:return f=Ko(19,T,g,x),f.elementType=lt,f.lanes=W,f;case Le:return oE(T,x,W,g);default:if(typeof f=="object"&&f!==null)switch(f.$$typeof){case le:ie=10;break e;case ve:ie=9;break e;case fe:ie=11;break e;case ft:ie=14;break e;case Xe:ie=16,A=null;break e}throw Error(o(130,f==null?f:typeof f,""))}return g=Ko(ie,T,g,x),g.elementType=f,g.type=A,g.lanes=W,g}function Xc(f,g,T,A){return f=Ko(7,f,A,g),f.lanes=T,f}function oE(f,g,T,A){return f=Ko(22,f,A,g),f.elementType=Le,f.lanes=T,f.stateNode={isHidden:!1},f}function MT(f,g,T){return f=Ko(6,f,null,g),f.lanes=T,f}function UT(f,g,T){return g=Ko(4,f.children!==null?f.children:[],f.key,g),g.lanes=T,g.stateNode={containerInfo:f.containerInfo,pendingChildren:null,implementation:f.implementation},g}function zk(f,g,T,A,x){this.tag=g,this.containerInfo=f,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Bc(0),this.expirationTimes=Bc(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Bc(0),this.identifierPrefix=A,this.onRecoverableError=x,this.mutableSourceEagerHydrationData=null}function VT(f,g,T,A,x,W,ie,Se,Ae){return f=new zk(f,g,T,Se,Ae),g===1?(g=1,W===!0&&(g|=8)):g=0,W=Ko(3,null,null,g),f.current=W,W.stateNode=f,W.memoizedState={element:A,isDehydrated:T,cache:null,transitions:null,pendingSuspenseBoundaries:null},eT(W),f}function Hk(f,g,T){var A=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:ye,key:A==null?null:""+A,children:f,containerInfo:g,implementation:T}}function sE(f){if(!f)return Ed;f=f._reactInternals;e:{if(No(f)!==f||f.tag!==1)throw Error(o(170));var g=f;do{switch(g.tag){case 3:g=g.stateNode.context;break e;case 1:if(ia(g.type)){g=g.stateNode.__reactInternalMemoizedMergedChildContext;break e}}g=g.return}while(g!==null);throw Error(o(171))}if(f.tag===1){var T=f.type;if(ia(T))return Cv(f,T,g)}return g}function FT(f,g,T,A,x,W,ie,Se,Ae){return f=VT(T,A,!0,f,x,W,ie,Se,Ae),f.context=sE(null),T=f.current,A=So(),x=Nu(T),W=Cu(A,x),W.callback=g??null,Td(T,W,x),f.current.lanes=x,yl(f,x,A),ss(f,A),f}function aE(f,g,T,A){var x=g.current,W=So(),ie=Nu(x);return T=sE(T),g.context===null?g.context=T:g.pendingContext=T,g=Cu(W,ie),g.payload={element:f},A=A===void 0?null:A,A!==null&&(g.callback=A),f=Td(x,g,ie),f!==null&&(Ma(f,x,ie,W),xv(f,x,ie)),ie}function Dg(f){if(f=f.current,!f.child)return null;switch(f.child.tag){case 5:return f.child.stateNode;default:return f.child.stateNode}}function jC(f,g){if(f=f.memoizedState,f!==null&&f.dehydrated!==null){var T=f.retryLane;f.retryLane=T!==0&&T<g?T:g}}function sf(f,g){jC(f,g),(f=f.alternate)&&jC(f,g)}function Pl(){return null}var jT=typeof reportError=="function"?reportError:function(f){console.error(f)};function BT(f){this._internalRoot=f}cE.prototype.render=BT.prototype.render=function(f){var g=this._internalRoot;if(g===null)throw Error(o(409));aE(f,g,null,null)},cE.prototype.unmount=BT.prototype.unmount=function(){var f=this._internalRoot;if(f!==null){this._internalRoot=null;var g=f.containerInfo;ku(function(){aE(null,f,null,null)}),g[ic]=null}};function cE(f){this._internalRoot=f}cE.prototype.unstable_scheduleHydration=function(f){if(f){var g=Lh();f={blockedOn:null,target:f,priority:g};for(var T=0;T<Rs.length&&g!==0&&g<Rs[T].priority;T++);Rs.splice(T,0,f),T===0&&Mh(f)}};function Lg(f){return!(!f||f.nodeType!==1&&f.nodeType!==9&&f.nodeType!==11)}function xg(f){return!(!f||f.nodeType!==1&&f.nodeType!==9&&f.nodeType!==11&&(f.nodeType!==8||f.nodeValue!==" react-mount-point-unstable "))}function BC(){}function lE(f,g,T,A,x){if(x){if(typeof A=="function"){var W=A;A=function(){var ze=Dg(ie);W.call(ze)}}var ie=FT(g,A,f,0,null,!1,!1,"",BC);return f._reactRootContainer=ie,f[ic]=ie.current,Wh(f.nodeType===8?f.parentNode:f),ku(),ie}for(;x=f.lastChild;)f.removeChild(x);if(typeof A=="function"){var Se=A;A=function(){var ze=Dg(Ae);Se.call(ze)}}var Ae=VT(f,0,!1,null,null,!1,!1,"",BC);return f._reactRootContainer=Ae,f[ic]=Ae.current,Wh(f.nodeType===8?f.parentNode:f),ku(function(){aE(g,Ae,T,A)}),Ae}function Jc(f,g,T,A,x){var W=T._reactRootContainer;if(W){var ie=W;if(typeof x=="function"){var Se=x;x=function(){var Ae=Dg(ie);Se.call(Ae)}}aE(g,ie,f,x)}else ie=lE(T,g,f,x,A);return Dg(ie)}np=function(f){switch(f.tag){case 3:var g=f.stateNode;if(g.current.memoizedState.isDehydrated){var T=vl(g.pendingLanes);T!==0&&(Oa(g,T|1),ss(g,Ur()),(vr&6)===0&&(rf=Ur()+500,yd()))}break;case 13:ku(function(){var A=lc(f,1);if(A!==null){var x=So();Ma(A,f,1,x)}}),sf(f,1)}},Sl=function(f){if(f.tag===13){var g=lc(f,134217728);if(g!==null){var T=So();Ma(g,f,134217728,T)}sf(f,134217728)}},pd=function(f){if(f.tag===13){var g=Nu(f),T=lc(f,g);if(T!==null){var A=So();Ma(T,f,g,A)}sf(f,g)}},Lh=function(){return Jn},rp=function(f,g){var T=Jn;try{return Jn=f,g()}finally{Jn=T}},qa=function(f,g,T){switch(g){case"input":if(wn(f,T),g=T.name,T.type==="radio"&&g!=null){for(T=f;T.parentNode;)T=T.parentNode;for(T=T.querySelectorAll("input[name="+JSON.stringify(""+g)+'][type="radio"]'),g=0;g<T.length;g++){var A=T[g];if(A!==f&&A.form===f.form){var x=_p(A);if(!x)throw Error(o(90));hn(A),wn(A,x)}}}break;case"textarea":Mt(f,T);break;case"select":g=T.value,g!=null&&mt(f,!!T.multiple,g,!1)}},lu=Ag,Xa=ku;var Mg={usingClientEntryPoint:!1,Events:[gp,Hh,_p,Ya,Uc,Ag]},Ug={findFiberByHostInstance:zh,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},Kk={bundleType:Ug.bundleType,version:Ug.version,rendererPackageName:Ug.rendererPackageName,rendererConfig:Ug.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:se.ReactCurrentDispatcher,findHostInstanceByFiber:function(f){return f=cd(f),f===null?null:f.stateNode},findFiberByHostInstance:Ug.findFiberByHostInstance||Pl,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var uE=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!uE.isDisabled&&uE.supportsFiber)try{_l=uE.inject(Kk),is=uE}catch{}}return Cc.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Mg,Cc.createPortal=function(f,g){var T=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Lg(g))throw Error(o(200));return Hk(f,g,null,T)},Cc.createRoot=function(f,g){if(!Lg(f))throw Error(o(299));var T=!1,A="",x=jT;return g!=null&&(g.unstable_strictMode===!0&&(T=!0),g.identifierPrefix!==void 0&&(A=g.identifierPrefix),g.onRecoverableError!==void 0&&(x=g.onRecoverableError)),g=VT(f,1,!1,null,null,T,!1,A,x),f[ic]=g.current,Wh(f.nodeType===8?f.parentNode:f),new BT(g)},Cc.findDOMNode=function(f){if(f==null)return null;if(f.nodeType===1)return f;var g=f._reactInternals;if(g===void 0)throw typeof f.render=="function"?Error(o(188)):(f=Object.keys(f).join(","),Error(o(268,f)));return f=cd(g),f=f===null?null:f.stateNode,f},Cc.flushSync=function(f){return ku(f)},Cc.hydrate=function(f,g,T){if(!xg(g))throw Error(o(200));return Jc(null,f,g,!0,T)},Cc.hydrateRoot=function(f,g,T){if(!Lg(f))throw Error(o(405));var A=T!=null&&T.hydratedSources||null,x=!1,W="",ie=jT;if(T!=null&&(T.unstable_strictMode===!0&&(x=!0),T.identifierPrefix!==void 0&&(W=T.identifierPrefix),T.onRecoverableError!==void 0&&(ie=T.onRecoverableError)),g=FT(g,null,f,1,T??null,x,!1,W,ie),f[ic]=g.current,Wh(f),A)for(f=0;f<A.length;f++)T=A[f],x=T._getVersion,x=x(T._source),g.mutableSourceEagerHydrationData==null?g.mutableSourceEagerHydrationData=[T,x]:g.mutableSourceEagerHydrationData.push(T,x);return new cE(g)},Cc.render=function(f,g,T){if(!xg(g))throw Error(o(200));return Jc(null,f,g,!1,T)},Cc.unmountComponentAtNode=function(f){if(!xg(f))throw Error(o(40));return f._reactRootContainer?(ku(function(){Jc(null,null,f,!1,function(){f._reactRootContainer=null,f[ic]=null})}),!0):!1},Cc.unstable_batchedUpdates=Ag,Cc.unstable_renderSubtreeIntoContainer=function(f,g,T,A){if(!xg(T))throw Error(o(200));if(f==null||f._reactInternals===void 0)throw Error(o(38));return Jc(f,g,T,!1,A)},Cc.version="18.2.0-next-9e3b772b8-20220608",Cc}var _K;function TX(){if(_K)return Vx.exports;_K=1;function r(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r)}catch(t){console.error(t)}}return r(),Vx.exports=Mme(),Vx.exports}var vK;function Ume(){if(vK)return aO;vK=1;var r=TX();return aO.createRoot=r.createRoot,aO.hydrateRoot=r.hydrateRoot,aO}var Vme=Ume();const oN=TS(Vme);function Fme(r){if(r.sheet)return r.sheet;for(var t=0;t<document.styleSheets.length;t++)if(document.styleSheets[t].ownerNode===r)return document.styleSheets[t]}function jme(r){var t=document.createElement("style");return t.setAttribute("data-emotion",r.key),r.nonce!==void 0&&t.setAttribute("nonce",r.nonce),t.appendChild(document.createTextNode("")),t.setAttribute("data-s",""),t}var Bme=function(){function r(o){var a=this;this._insertTag=function(l){var d;a.tags.length===0?a.insertionPoint?d=a.insertionPoint.nextSibling:a.prepend?d=a.container.firstChild:d=a.before:d=a.tags[a.tags.length-1].nextSibling,a.container.insertBefore(l,d),a.tags.push(l)},this.isSpeedy=o.speedy===void 0?!0:o.speedy,this.tags=[],this.ctr=0,this.nonce=o.nonce,this.key=o.key,this.container=o.container,this.prepend=o.prepend,this.insertionPoint=o.insertionPoint,this.before=null}var t=r.prototype;return t.hydrate=function(a){a.forEach(this._insertTag)},t.insert=function(a){this.ctr%(this.isSpeedy?65e3:1)===0&&this._insertTag(jme(this));var l=this.tags[this.tags.length-1];if(this.isSpeedy){var d=Fme(l);try{d.insertRule(a,d.cssRules.length)}catch{}}else l.appendChild(document.createTextNode(a));this.ctr++},t.flush=function(){this.tags.forEach(function(a){return a.parentNode&&a.parentNode.removeChild(a)}),this.tags=[],this.ctr=0},r}(),ga="-ms-",yP="-moz-",Kr="-webkit-",bX="comm",FU="rule",jU="decl",Wme="@import",wX="@keyframes",Gme="@layer",zme=Math.abs,sN=String.fromCharCode,Hme=Object.assign;function Kme(r,t){return Hs(r,0)^45?(((t<<2^Hs(r,0))<<2^Hs(r,1))<<2^Hs(r,2))<<2^Hs(r,3):0}function RX(r){return r.trim()}function $me(r,t){return(r=t.exec(r))?r[0]:r}function $r(r,t,o){return r.replace(t,o)}function u2(r,t){return r.indexOf(t)}function Hs(r,t){return r.charCodeAt(t)|0}function tw(r,t,o){return r.slice(t,o)}function nh(r){return r.length}function BU(r){return r.length}function cO(r,t){return t.push(r),r}function qme(r,t){return r.map(t).join("")}var aN=1,rS=1,CX=0,Lc=0,Vo=0,bS="";function cN(r,t,o,a,l,d,m){return{value:r,root:t,parent:o,type:a,props:l,children:d,line:aN,column:rS,length:m,return:""}}function eb(r,t){return Hme(cN("",null,null,"",null,null,0),r,{length:-r.length},t)}function Yme(){return Vo}function Xme(){return Vo=Lc>0?Hs(bS,--Lc):0,rS--,Vo===10&&(rS=1,aN--),Vo}function fl(){return Vo=Lc<CX?Hs(bS,Lc++):0,rS++,Vo===10&&(rS=1,aN++),Vo}function lh(){return Hs(bS,Lc)}function jO(){return Lc}function xw(r,t){return tw(bS,r,t)}function nw(r){switch(r){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function IX(r){return aN=rS=1,CX=nh(bS=r),Lc=0,[]}function AX(r){return bS="",r}function BO(r){return RX(xw(Lc-1,d2(r===91?r+2:r===40?r+1:r)))}function Jme(r){for(;(Vo=lh())&&Vo<33;)fl();return nw(r)>2||nw(Vo)>3?"":" "}function Qme(r,t){for(;--t&&fl()&&!(Vo<48||Vo>102||Vo>57&&Vo<65||Vo>70&&Vo<97););return xw(r,jO()+(t<6&&lh()==32&&fl()==32))}function d2(r){for(;fl();)switch(Vo){case r:return Lc;case 34:case 39:r!==34&&r!==39&&d2(Vo);break;case 40:r===41&&d2(r);break;case 92:fl();break}return Lc}function Zme(r,t){for(;fl()&&r+Vo!==57;)if(r+Vo===84&&lh()===47)break;return"/*"+xw(t,Lc-1)+"*"+sN(r===47?r:fl())}function ege(r){for(;!nw(lh());)fl();return xw(r,Lc)}function tge(r){return AX(WO("",null,null,null,[""],r=IX(r),0,[0],r))}function WO(r,t,o,a,l,d,m,v,y){for(var b=0,R=0,O=m,N=0,F=0,H=0,G=1,z=1,ne=1,J=0,oe="",se=l,ae=d,ye=a,Q=oe;z;)switch(H=J,J=fl()){case 40:if(H!=108&&Hs(Q,O-1)==58){u2(Q+=$r(BO(J),"&","&\f"),"&\f")!=-1&&(ne=-1);break}case 34:case 39:case 91:Q+=BO(J);break;case 9:case 10:case 13:case 32:Q+=Jme(H);break;case 92:Q+=Qme(jO()-1,7);continue;case 47:switch(lh()){case 42:case 47:cO(nge(Zme(fl(),jO()),t,o),y);break;default:Q+="/"}break;case 123*G:v[b++]=nh(Q)*ne;case 125*G:case 59:case 0:switch(J){case 0:case 125:z=0;case 59+R:ne==-1&&(Q=$r(Q,/\f/g,"")),F>0&&nh(Q)-O&&cO(F>32?yK(Q+";",a,o,O-1):yK($r(Q," ","")+";",a,o,O-2),y);break;case 59:Q+=";";default:if(cO(ye=EK(Q,t,o,b,R,l,v,oe,se=[],ae=[],O),d),J===123)if(R===0)WO(Q,t,ye,ye,se,d,O,v,ae);else switch(N===99&&Hs(Q,3)===110?100:N){case 100:case 108:case 109:case 115:WO(r,ye,ye,a&&cO(EK(r,ye,ye,0,0,l,v,oe,l,se=[],O),ae),l,ae,O,v,a?se:ae);break;default:WO(Q,ye,ye,ye,[""],ae,0,v,ae)}}b=R=F=0,G=ne=1,oe=Q="",O=m;break;case 58:O=1+nh(Q),F=H;default:if(G<1){if(J==123)--G;else if(J==125&&G++==0&&Xme()==125)continue}switch(Q+=sN(J),J*G){case 38:ne=R>0?1:(Q+="\f",-1);break;case 44:v[b++]=(nh(Q)-1)*ne,ne=1;break;case 64:lh()===45&&(Q+=BO(fl())),N=lh(),R=O=nh(oe=Q+=ege(jO())),J++;break;case 45:H===45&&nh(Q)==2&&(G=0)}}return d}function EK(r,t,o,a,l,d,m,v,y,b,R){for(var O=l-1,N=l===0?d:[""],F=BU(N),H=0,G=0,z=0;H<a;++H)for(var ne=0,J=tw(r,O+1,O=zme(G=m[H])),oe=r;ne<F;++ne)(oe=RX(G>0?N[ne]+" "+J:$r(J,/&\f/g,N[ne])))&&(y[z++]=oe);return cN(r,t,o,l===0?FU:v,y,b,R)}function nge(r,t,o){return cN(r,t,o,bX,sN(Yme()),tw(r,2,-2),0)}function yK(r,t,o,a){return cN(r,t,o,jU,tw(r,0,a),tw(r,a+1,-1),a)}function Wy(r,t){for(var o="",a=BU(r),l=0;l<a;l++)o+=t(r[l],l,r,t)||"";return o}function rge(r,t,o,a){switch(r.type){case Gme:if(r.children.length)break;case Wme:case jU:return r.return=r.return||r.value;case bX:return"";case wX:return r.return=r.value+"{"+Wy(r.children,a)+"}";case FU:r.value=r.props.join(",")}return nh(o=Wy(r.children,a))?r.return=r.value+"{"+o+"}":""}function ige(r){var t=BU(r);return function(o,a,l,d){for(var m="",v=0;v<t;v++)m+=r[v](o,a,l,d)||"";return m}}function oge(r){return function(t){t.root||(t=t.return)&&r(t)}}var SK=function(t){var o=new WeakMap;return function(a){if(o.has(a))return o.get(a);var l=t(a);return o.set(a,l),l}};function OX(r){var t=Object.create(null);return function(o){return t[o]===void 0&&(t[o]=r(o)),t[o]}}var sge=function(t,o,a){for(var l=0,d=0;l=d,d=lh(),l===38&&d===12&&(o[a]=1),!nw(d);)fl();return xw(t,Lc)},age=function(t,o){var a=-1,l=44;do switch(nw(l)){case 0:l===38&&lh()===12&&(o[a]=1),t[a]+=sge(Lc-1,o,a);break;case 2:t[a]+=BO(l);break;case 4:if(l===44){t[++a]=lh()===58?"&\f":"",o[a]=t[a].length;break}default:t[a]+=sN(l)}while(l=fl());return t},cge=function(t,o){return AX(age(IX(t),o))},TK=new WeakMap,lge=function(t){if(!(t.type!=="rule"||!t.parent||t.length<1)){for(var o=t.value,a=t.parent,l=t.column===a.column&&t.line===a.line;a.type!=="rule";)if(a=a.parent,!a)return;if(!(t.props.length===1&&o.charCodeAt(0)!==58&&!TK.get(a))&&!l){TK.set(t,!0);for(var d=[],m=cge(o,d),v=a.props,y=0,b=0;y<m.length;y++)for(var R=0;R<v.length;R++,b++)t.props[b]=d[y]?m[y].replace(/&\f/g,v[R]):v[R]+" "+m[y]}}},uge=function(t){if(t.type==="decl"){var o=t.value;o.charCodeAt(0)===108&&o.charCodeAt(2)===98&&(t.return="",t.value="")}};function PX(r,t){switch(Kme(r,t)){case 5103:return Kr+"print-"+r+r;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return Kr+r+r;case 5349:case 4246:case 4810:case 6968:case 2756:return Kr+r+yP+r+ga+r+r;case 6828:case 4268:return Kr+r+ga+r+r;case 6165:return Kr+r+ga+"flex-"+r+r;case 5187:return Kr+r+$r(r,/(\w+).+(:[^]+)/,Kr+"box-$1$2"+ga+"flex-$1$2")+r;case 5443:return Kr+r+ga+"flex-item-"+$r(r,/flex-|-self/,"")+r;case 4675:return Kr+r+ga+"flex-line-pack"+$r(r,/align-content|flex-|-self/,"")+r;case 5548:return Kr+r+ga+$r(r,"shrink","negative")+r;case 5292:return Kr+r+ga+$r(r,"basis","preferred-size")+r;case 6060:return Kr+"box-"+$r(r,"-grow","")+Kr+r+ga+$r(r,"grow","positive")+r;case 4554:return Kr+$r(r,/([^-])(transform)/g,"$1"+Kr+"$2")+r;case 6187:return $r($r($r(r,/(zoom-|grab)/,Kr+"$1"),/(image-set)/,Kr+"$1"),r,"")+r;case 5495:case 3959:return $r(r,/(image-set\([^]*)/,Kr+"$1$`$1");case 4968:return $r($r(r,/(.+:)(flex-)?(.*)/,Kr+"box-pack:$3"+ga+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+Kr+r+r;case 4095:case 3583:case 4068:case 2532:return $r(r,/(.+)-inline(.+)/,Kr+"$1$2")+r;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(nh(r)-1-t>6)switch(Hs(r,t+1)){case 109:if(Hs(r,t+4)!==45)break;case 102:return $r(r,/(.+:)(.+)-([^]+)/,"$1"+Kr+"$2-$3$1"+yP+(Hs(r,t+3)==108?"$3":"$2-$3"))+r;case 115:return~u2(r,"stretch")?PX($r(r,"stretch","fill-available"),t)+r:r}break;case 4949:if(Hs(r,t+1)!==115)break;case 6444:switch(Hs(r,nh(r)-3-(~u2(r,"!important")&&10))){case 107:return $r(r,":",":"+Kr)+r;case 101:return $r(r,/(.+:)([^;!]+)(;|!.+)?/,"$1"+Kr+(Hs(r,14)===45?"inline-":"")+"box$3$1"+Kr+"$2$3$1"+ga+"$2box$3")+r}break;case 5936:switch(Hs(r,t+11)){case 114:return Kr+r+ga+$r(r,/[svh]\w+-[tblr]{2}/,"tb")+r;case 108:return Kr+r+ga+$r(r,/[svh]\w+-[tblr]{2}/,"tb-rl")+r;case 45:return Kr+r+ga+$r(r,/[svh]\w+-[tblr]{2}/,"lr")+r}return Kr+r+ga+r+r}return r}var dge=function(t,o,a,l){if(t.length>-1&&!t.return)switch(t.type){case jU:t.return=PX(t.value,t.length);break;case wX:return Wy([eb(t,{value:$r(t.value,"@","@"+Kr)})],l);case FU:if(t.length)return qme(t.props,function(d){switch($me(d,/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":return Wy([eb(t,{props:[$r(d,/:(read-\w+)/,":"+yP+"$1")]})],l);case"::placeholder":return Wy([eb(t,{props:[$r(d,/:(plac\w+)/,":"+Kr+"input-$1")]}),eb(t,{props:[$r(d,/:(plac\w+)/,":"+yP+"$1")]}),eb(t,{props:[$r(d,/:(plac\w+)/,ga+"input-$1")]})],l)}return""})}},hge=[dge],fge=function(t){var o=t.key;if(o==="css"){var a=document.querySelectorAll("style[data-emotion]:not([data-s])");Array.prototype.forEach.call(a,function(G){var z=G.getAttribute("data-emotion");z.indexOf(" ")!==-1&&(document.head.appendChild(G),G.setAttribute("data-s",""))})}var l=t.stylisPlugins||hge,d={},m,v=[];m=t.container||document.head,Array.prototype.forEach.call(document.querySelectorAll('style[data-emotion^="'+o+' "]'),function(G){for(var z=G.getAttribute("data-emotion").split(" "),ne=1;ne<z.length;ne++)d[z[ne]]=!0;v.push(G)});var y,b=[lge,uge];{var R,O=[rge,oge(function(G){R.insert(G)})],N=ige(b.concat(l,O)),F=function(z){return Wy(tge(z),N)};y=function(z,ne,J,oe){R=J,F(z?z+"{"+ne.styles+"}":ne.styles),oe&&(H.inserted[ne.name]=!0)}}var H={key:o,sheet:new Bme({key:o,container:m,nonce:t.nonce,speedy:t.speedy,prepend:t.prepend,insertionPoint:t.insertionPoint}),nonce:t.nonce,inserted:d,registered:{},insert:y};return H.sheet.hydrate(v),H};function K_(){return K_=Object.assign?Object.assign.bind():function(r){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var a in o)Object.prototype.hasOwnProperty.call(o,a)&&(r[a]=o[a])}return r},K_.apply(this,arguments)}var Bx={exports:{}},ei={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var bK;function pge(){if(bK)return ei;bK=1;var r=typeof Symbol=="function"&&Symbol.for,t=r?Symbol.for("react.element"):60103,o=r?Symbol.for("react.portal"):60106,a=r?Symbol.for("react.fragment"):60107,l=r?Symbol.for("react.strict_mode"):60108,d=r?Symbol.for("react.profiler"):60114,m=r?Symbol.for("react.provider"):60109,v=r?Symbol.for("react.context"):60110,y=r?Symbol.for("react.async_mode"):60111,b=r?Symbol.for("react.concurrent_mode"):60111,R=r?Symbol.for("react.forward_ref"):60112,O=r?Symbol.for("react.suspense"):60113,N=r?Symbol.for("react.suspense_list"):60120,F=r?Symbol.for("react.memo"):60115,H=r?Symbol.for("react.lazy"):60116,G=r?Symbol.for("react.block"):60121,z=r?Symbol.for("react.fundamental"):60117,ne=r?Symbol.for("react.responder"):60118,J=r?Symbol.for("react.scope"):60119;function oe(ae){if(typeof ae=="object"&&ae!==null){var ye=ae.$$typeof;switch(ye){case t:switch(ae=ae.type,ae){case y:case b:case a:case d:case l:case O:return ae;default:switch(ae=ae&&ae.$$typeof,ae){case v:case R:case H:case F:case m:return ae;default:return ye}}case o:return ye}}}function se(ae){return oe(ae)===b}return ei.AsyncMode=y,ei.ConcurrentMode=b,ei.ContextConsumer=v,ei.ContextProvider=m,ei.Element=t,ei.ForwardRef=R,ei.Fragment=a,ei.Lazy=H,ei.Memo=F,ei.Portal=o,ei.Profiler=d,ei.StrictMode=l,ei.Suspense=O,ei.isAsyncMode=function(ae){return se(ae)||oe(ae)===y},ei.isConcurrentMode=se,ei.isContextConsumer=function(ae){return oe(ae)===v},ei.isContextProvider=function(ae){return oe(ae)===m},ei.isElement=function(ae){return typeof ae=="object"&&ae!==null&&ae.$$typeof===t},ei.isForwardRef=function(ae){return oe(ae)===R},ei.isFragment=function(ae){return oe(ae)===a},ei.isLazy=function(ae){return oe(ae)===H},ei.isMemo=function(ae){return oe(ae)===F},ei.isPortal=function(ae){return oe(ae)===o},ei.isProfiler=function(ae){return oe(ae)===d},ei.isStrictMode=function(ae){return oe(ae)===l},ei.isSuspense=function(ae){return oe(ae)===O},ei.isValidElementType=function(ae){return typeof ae=="string"||typeof ae=="function"||ae===a||ae===b||ae===d||ae===l||ae===O||ae===N||typeof ae=="object"&&ae!==null&&(ae.$$typeof===H||ae.$$typeof===F||ae.$$typeof===m||ae.$$typeof===v||ae.$$typeof===R||ae.$$typeof===z||ae.$$typeof===ne||ae.$$typeof===J||ae.$$typeof===G)},ei.typeOf=oe,ei}var wK;function mge(){return wK||(wK=1,Bx.exports=pge()),Bx.exports}var Wx,RK;function gge(){if(RK)return Wx;RK=1;var r=mge(),t={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},o={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},a={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},l={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},d={};d[r.ForwardRef]=a,d[r.Memo]=l;function m(H){return r.isMemo(H)?l:d[H.$$typeof]||t}var v=Object.defineProperty,y=Object.getOwnPropertyNames,b=Object.getOwnPropertySymbols,R=Object.getOwnPropertyDescriptor,O=Object.getPrototypeOf,N=Object.prototype;function F(H,G,z){if(typeof G!="string"){if(N){var ne=O(G);ne&&ne!==N&&F(H,ne,z)}var J=y(G);b&&(J=J.concat(b(G)));for(var oe=m(H),se=m(G),ae=0;ae<J.length;++ae){var ye=J[ae];if(!o[ye]&&!(z&&z[ye])&&!(se&&se[ye])&&!(oe&&oe[ye])){var Q=R(G,ye);try{v(H,ye,Q)}catch{}}}}return H}return Wx=F,Wx}gge();var _ge=!0;function vge(r,t,o){var a="";return o.split(" ").forEach(function(l){r[l]!==void 0?t.push(r[l]+";"):a+=l+" "}),a}var NX=function(t,o,a){var l=t.key+"-"+o.name;(a===!1||_ge===!1)&&t.registered[l]===void 0&&(t.registered[l]=o.styles)},kX=function(t,o,a){NX(t,o,a);var l=t.key+"-"+o.name;if(t.inserted[o.name]===void 0){var d=o;do t.insert(o===d?"."+l:"",d,t.sheet,!0),d=d.next;while(d!==void 0)}};function Ege(r){for(var t=0,o,a=0,l=r.length;l>=4;++a,l-=4)o=r.charCodeAt(a)&255|(r.charCodeAt(++a)&255)<<8|(r.charCodeAt(++a)&255)<<16|(r.charCodeAt(++a)&255)<<24,o=(o&65535)*1540483477+((o>>>16)*59797<<16),o^=o>>>24,t=(o&65535)*1540483477+((o>>>16)*59797<<16)^(t&65535)*1540483477+((t>>>16)*59797<<16);switch(l){case 3:t^=(r.charCodeAt(a+2)&255)<<16;case 2:t^=(r.charCodeAt(a+1)&255)<<8;case 1:t^=r.charCodeAt(a)&255,t=(t&65535)*1540483477+((t>>>16)*59797<<16)}return t^=t>>>13,t=(t&65535)*1540483477+((t>>>16)*59797<<16),((t^t>>>15)>>>0).toString(36)}var yge={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},Sge=/[A-Z]|^ms/g,Tge=/_EMO_([^_]+?)_([^]*?)_EMO_/g,DX=function(t){return t.charCodeAt(1)===45},CK=function(t){return t!=null&&typeof t!="boolean"},Gx=OX(function(r){return DX(r)?r:r.replace(Sge,"-$&").toLowerCase()}),IK=function(t,o){switch(t){case"animation":case"animationName":if(typeof o=="string")return o.replace(Tge,function(a,l,d){return rh={name:l,styles:d,next:rh},l})}return yge[t]!==1&&!DX(t)&&typeof o=="number"&&o!==0?o+"px":o};function rw(r,t,o){if(o==null)return"";if(o.__emotion_styles!==void 0)return o;switch(typeof o){case"boolean":return"";case"object":{if(o.anim===1)return rh={name:o.name,styles:o.styles,next:rh},o.name;if(o.styles!==void 0){var a=o.next;if(a!==void 0)for(;a!==void 0;)rh={name:a.name,styles:a.styles,next:rh},a=a.next;var l=o.styles+";";return l}return bge(r,t,o)}case"function":{if(r!==void 0){var d=rh,m=o(r);return rh=d,rw(r,t,m)}break}}if(t==null)return o;var v=t[o];return v!==void 0?v:o}function bge(r,t,o){var a="";if(Array.isArray(o))for(var l=0;l<o.length;l++)a+=rw(r,t,o[l])+";";else for(var d in o){var m=o[d];if(typeof m!="object")t!=null&&t[m]!==void 0?a+=d+"{"+t[m]+"}":CK(m)&&(a+=Gx(d)+":"+IK(d,m)+";");else if(Array.isArray(m)&&typeof m[0]=="string"&&(t==null||t[m[0]]===void 0))for(var v=0;v<m.length;v++)CK(m[v])&&(a+=Gx(d)+":"+IK(d,m[v])+";");else{var y=rw(r,t,m);switch(d){case"animation":case"animationName":{a+=Gx(d)+":"+y+";";break}default:a+=d+"{"+y+"}"}}}return a}var AK=/label:\s*([^\s;\n{]+)\s*(;|$)/g,rh,WU=function(t,o,a){if(t.length===1&&typeof t[0]=="object"&&t[0]!==null&&t[0].styles!==void 0)return t[0];var l=!0,d="";rh=void 0;var m=t[0];m==null||m.raw===void 0?(l=!1,d+=rw(a,o,m)):d+=m[0];for(var v=1;v<t.length;v++)d+=rw(a,o,t[v]),l&&(d+=m[v]);AK.lastIndex=0;for(var y="",b;(b=AK.exec(d))!==null;)y+="-"+b[1];var R=Ege(d)+y;return{name:R,styles:d,next:rh}},wge=function(t){return t()},LX=fK.useInsertionEffect?fK.useInsertionEffect:!1,Rge=LX||wge,OK=LX||V.useLayoutEffect,xX=V.createContext(typeof HTMLElement<"u"?fge({key:"css"}):null);xX.Provider;var MX=function(t){return V.forwardRef(function(o,a){var l=V.useContext(xX);return t(o,l,a)})},iw=V.createContext({}),Cge=function(t,o){if(typeof o=="function"){var a=o(t);return a}return K_({},t,o)},Ige=SK(function(r){return SK(function(t){return Cge(r,t)})}),Age=function(t){var o=V.useContext(iw);return t.theme!==o&&(o=Ige(o)(t.theme)),V.createElement(iw.Provider,{value:o},t.children)},lN=MX(function(r,t){var o=r.styles,a=WU([o],void 0,V.useContext(iw)),l=V.useRef();return OK(function(){var d=t.key+"-global",m=new t.sheet.constructor({key:d,nonce:t.sheet.nonce,container:t.sheet.container,speedy:t.sheet.isSpeedy}),v=!1,y=document.querySelector('style[data-emotion="'+d+" "+a.name+'"]');return t.sheet.tags.length&&(m.before=t.sheet.tags[0]),y!==null&&(v=!0,y.setAttribute("data-emotion",d),m.hydrate([y])),l.current=[m,v],function(){m.flush()}},[t]),OK(function(){var d=l.current,m=d[0],v=d[1];if(v){d[1]=!1;return}if(a.next!==void 0&&kX(t,a.next,!0),m.tags.length){var y=m.tags[m.tags.length-1].nextElementSibling;m.before=y,m.flush()}t.insert("",a,m,!1)},[t,a.name]),null});function Oge(){for(var r=arguments.length,t=new Array(r),o=0;o<r;o++)t[o]=arguments[o];return WU(t)}var Mw=function(){var t=Oge.apply(void 0,arguments),o="animation-"+t.name;return{name:o,styles:"@keyframes "+o+"{"+t.styles+"}",anim:1,toString:function(){return"_EMO_"+this.name+"_"+this.styles+"_EMO_"}}},UX=String.raw,VX=UX`
  :root,
  :host {
    --chakra-vh: 100vh;
  }

  @supports (height: -webkit-fill-available) {
    :root,
    :host {
      --chakra-vh: -webkit-fill-available;
    }
  }

  @supports (height: -moz-fill-available) {
    :root,
    :host {
      --chakra-vh: -moz-fill-available;
    }
  }

  @supports (height: 100dvh) {
    :root,
    :host {
      --chakra-vh: 100dvh;
    }
  }
`,Pge=()=>D.jsx(lN,{styles:VX}),Nge=({scope:r=""})=>D.jsx(lN,{styles:UX`
      html {
        line-height: 1.5;
        -webkit-text-size-adjust: 100%;
        font-family: system-ui, sans-serif;
        -webkit-font-smoothing: antialiased;
        text-rendering: optimizeLegibility;
        -moz-osx-font-smoothing: grayscale;
        touch-action: manipulation;
      }

      body {
        position: relative;
        min-height: 100%;
        margin: 0;
        font-feature-settings: "kern";
      }

      ${r} :where(*, *::before, *::after) {
        border-width: 0;
        border-style: solid;
        box-sizing: border-box;
        word-wrap: break-word;
      }

      main {
        display: block;
      }

      ${r} hr {
        border-top-width: 1px;
        box-sizing: content-box;
        height: 0;
        overflow: visible;
      }

      ${r} :where(pre, code, kbd,samp) {
        font-family: SFMono-Regular, Menlo, Monaco, Consolas, monospace;
        font-size: 1em;
      }

      ${r} a {
        background-color: transparent;
        color: inherit;
        text-decoration: inherit;
      }

      ${r} abbr[title] {
        border-bottom: none;
        text-decoration: underline;
        -webkit-text-decoration: underline dotted;
        text-decoration: underline dotted;
      }

      ${r} :where(b, strong) {
        font-weight: bold;
      }

      ${r} small {
        font-size: 80%;
      }

      ${r} :where(sub,sup) {
        font-size: 75%;
        line-height: 0;
        position: relative;
        vertical-align: baseline;
      }

      ${r} sub {
        bottom: -0.25em;
      }

      ${r} sup {
        top: -0.5em;
      }

      ${r} img {
        border-style: none;
      }

      ${r} :where(button, input, optgroup, select, textarea) {
        font-family: inherit;
        font-size: 100%;
        line-height: 1.15;
        margin: 0;
      }

      ${r} :where(button, input) {
        overflow: visible;
      }

      ${r} :where(button, select) {
        text-transform: none;
      }

      ${r} :where(
          button::-moz-focus-inner,
          [type="button"]::-moz-focus-inner,
          [type="reset"]::-moz-focus-inner,
          [type="submit"]::-moz-focus-inner
        ) {
        border-style: none;
        padding: 0;
      }

      ${r} fieldset {
        padding: 0.35em 0.75em 0.625em;
      }

      ${r} legend {
        box-sizing: border-box;
        color: inherit;
        display: table;
        max-width: 100%;
        padding: 0;
        white-space: normal;
      }

      ${r} progress {
        vertical-align: baseline;
      }

      ${r} textarea {
        overflow: auto;
      }

      ${r} :where([type="checkbox"], [type="radio"]) {
        box-sizing: border-box;
        padding: 0;
      }

      ${r} input[type="number"]::-webkit-inner-spin-button,
      ${r} input[type="number"]::-webkit-outer-spin-button {
        -webkit-appearance: none !important;
      }

      ${r} input[type="number"] {
        -moz-appearance: textfield;
      }

      ${r} input[type="search"] {
        -webkit-appearance: textfield;
        outline-offset: -2px;
      }

      ${r} input[type="search"]::-webkit-search-decoration {
        -webkit-appearance: none !important;
      }

      ${r} ::-webkit-file-upload-button {
        -webkit-appearance: button;
        font: inherit;
      }

      ${r} details {
        display: block;
      }

      ${r} summary {
        display: list-item;
      }

      template {
        display: none;
      }

      [hidden] {
        display: none !important;
      }

      ${r} :where(
          blockquote,
          dl,
          dd,
          h1,
          h2,
          h3,
          h4,
          h5,
          h6,
          hr,
          figure,
          p,
          pre
        ) {
        margin: 0;
      }

      ${r} button {
        background: transparent;
        padding: 0;
      }

      ${r} fieldset {
        margin: 0;
        padding: 0;
      }

      ${r} :where(ol, ul) {
        margin: 0;
        padding: 0;
      }

      ${r} textarea {
        resize: vertical;
      }

      ${r} :where(button, [role="button"]) {
        cursor: pointer;
      }

      ${r} button::-moz-focus-inner {
        border: 0 !important;
      }

      ${r} table {
        border-collapse: collapse;
      }

      ${r} :where(h1, h2, h3, h4, h5, h6) {
        font-size: inherit;
        font-weight: inherit;
      }

      ${r} :where(button, input, optgroup, select, textarea) {
        padding: 0;
        line-height: inherit;
        color: inherit;
      }

      ${r} :where(img, svg, video, canvas, audio, iframe, embed, object) {
        display: block;
      }

      ${r} :where(img, video) {
        max-width: 100%;
        height: auto;
      }

      [data-js-focus-visible]
        :focus:not([data-focus-visible-added]):not(
          [data-focus-visible-disabled]
        ) {
        outline: none;
        box-shadow: none;
      }

      ${r} select::-ms-expand {
        display: none;
      }

      ${VX}
    `});function kge(r,t){return`${r} returned \`undefined\`. Seems you forgot to wrap component within ${t}`}function Hi(r={}){const{name:t,strict:o=!0,hookName:a="useContext",providerName:l="Provider",errorMessage:d,defaultValue:m}=r,v=V.createContext(m);v.displayName=t;function y(){var b;const R=V.useContext(v);if(!R&&o){const O=new Error(d??kge(a,l));throw O.name="ContextError",(b=Error.captureStackTrace)==null||b.call(Error,O,y),O}return R}return[v.Provider,y,v]}var[Dge,Lge]=Hi({strict:!1,name:"PortalManagerContext"});function GU(r){const{children:t,zIndex:o}=r;return D.jsx(Dge,{value:{zIndex:o},children:t})}GU.displayName="PortalManager";var Ff=globalThis!=null&&globalThis.document?V.useLayoutEffect:V.useEffect,FX=TX(),[jX,xge]=Hi({strict:!1,name:"PortalContext"}),zU="chakra-portal",Mge=".chakra-portal",Uge=r=>D.jsx("div",{className:"chakra-portal-zIndex",style:{position:"absolute",zIndex:r.zIndex,top:0,left:0,right:0},children:r.children}),Vge=r=>{const{appendToParentPortal:t,children:o}=r,[a,l]=V.useState(null),d=V.useRef(null),[,m]=V.useState({});V.useEffect(()=>m({}),[]);const v=xge(),y=Lge();Ff(()=>{if(!a)return;const R=a.ownerDocument,O=t?v??R.body:R.body;if(!O)return;d.current=R.createElement("div"),d.current.className=zU,O.appendChild(d.current),m({});const N=d.current;return()=>{O.contains(N)&&O.removeChild(N)}},[a]);const b=y!=null&&y.zIndex?D.jsx(Uge,{zIndex:y==null?void 0:y.zIndex,children:o}):o;return d.current?FX.createPortal(D.jsx(jX,{value:d.current,children:b}),d.current):D.jsx("span",{ref:R=>{R&&l(R)}})},Fge=r=>{const{children:t,containerRef:o,appendToParentPortal:a}=r,l=o.current,d=l??(typeof window<"u"?document.body:void 0),m=V.useMemo(()=>{const y=l==null?void 0:l.ownerDocument.createElement("div");return y&&(y.className=zU),y},[l]),[,v]=V.useState({});return Ff(()=>v({}),[]),Ff(()=>{if(!(!m||!d))return d.appendChild(m),()=>{d.removeChild(m)}},[m,d]),d&&m?FX.createPortal(D.jsx(jX,{value:a?m:null,children:t}),m):null};function au(r){const t={appendToParentPortal:!0,...r},{containerRef:o,...a}=t;return o?D.jsx(Fge,{containerRef:o,...a}):D.jsx(Vge,{...a})}au.className=zU;au.selector=Mge;au.displayName="Portal";function wS(){const r=V.useContext(iw);if(!r)throw Error("useTheme: `theme` is undefined. Seems you forgot to wrap your app in `<ChakraProvider />` or `<ThemeProvider />`");return r}var HU=V.createContext({});HU.displayName="ColorModeContext";function uN(){const r=V.useContext(HU);if(r===void 0)throw new Error("useColorMode must be used within a ColorModeProvider");return r}function jge(r,t){const{colorMode:o}=uN();return o==="dark"?t:r}var lO={light:"chakra-ui-light",dark:"chakra-ui-dark"};function Bge(r={}){const{preventTransition:t=!0}=r,o={setDataset:a=>{const l=t?o.preventTransition():void 0;document.documentElement.dataset.theme=a,document.documentElement.style.colorScheme=a,l==null||l()},setClassName(a){document.body.classList.add(a?lO.dark:lO.light),document.body.classList.remove(a?lO.light:lO.dark)},query(){return window.matchMedia("(prefers-color-scheme: dark)")},getSystemTheme(a){var l;return((l=o.query().matches)!=null?l:a==="dark")?"dark":"light"},addListener(a){const l=o.query(),d=m=>{a(m.matches?"dark":"light")};return typeof l.addListener=="function"?l.addListener(d):l.addEventListener("change",d),()=>{typeof l.removeListener=="function"?l.removeListener(d):l.removeEventListener("change",d)}},preventTransition(){const a=document.createElement("style");return a.appendChild(document.createTextNode("*{-webkit-transition:none!important;-moz-transition:none!important;-o-transition:none!important;-ms-transition:none!important;transition:none!important}")),document.head.appendChild(a),()=>{window.getComputedStyle(document.body),requestAnimationFrame(()=>{requestAnimationFrame(()=>{document.head.removeChild(a)})})}}};return o}var Wge="chakra-ui-color-mode";function Gge(r){return{ssr:!1,type:"localStorage",get(t){if(!(globalThis!=null&&globalThis.document))return t;let o;try{o=localStorage.getItem(r)||t}catch{}return o||t},set(t){try{localStorage.setItem(r,t)}catch{}}}}var zge=Gge(Wge),PK=()=>{};function NK(r,t){return r.type==="cookie"&&r.ssr?r.get(t):t}function BX(r){const{value:t,children:o,options:{useSystemColorMode:a,initialColorMode:l,disableTransitionOnChange:d}={},colorModeManager:m=zge}=r,v=l==="dark"?"dark":"light",[y,b]=V.useState(()=>NK(m,v)),[R,O]=V.useState(()=>NK(m)),{getSystemTheme:N,setClassName:F,setDataset:H,addListener:G}=V.useMemo(()=>Bge({preventTransition:d}),[d]),z=l==="system"&&!y?R:y,ne=V.useCallback(se=>{const ae=se==="system"?N():se;b(ae),F(ae==="dark"),H(ae),m.set(ae)},[m,N,F,H]);Ff(()=>{l==="system"&&O(N())},[]),V.useEffect(()=>{const se=m.get();if(se){ne(se);return}if(l==="system"){ne("system");return}ne(v)},[m,v,l,ne]);const J=V.useCallback(()=>{ne(z==="dark"?"light":"dark")},[z,ne]);V.useEffect(()=>{if(a)return G(ne)},[a,G,ne]);const oe=V.useMemo(()=>({colorMode:t??z,toggleColorMode:t?PK:J,setColorMode:t?PK:ne,forced:t!==void 0}),[z,J,ne,t]);return D.jsx(HU.Provider,{value:oe,children:o})}BX.displayName="ColorModeProvider";function WX(){const r=uN(),t=wS();return{...r,theme:t}}function Hge(r,t,o){var a,l;if(t==null)return t;const d=m=>{var v,y;return(y=(v=r.__cssMap)==null?void 0:v[m])==null?void 0:y.value};return(l=(a=d(t))!=null?a:d(o))!=null?l:o}function Kge(r,t,o){const a=Array.isArray(t)?t:[t],l=Array.isArray(o)?o:[o];return d=>{const m=l.filter(Boolean),v=a.map((y,b)=>{var R;const O=`${r}.${y}`;return Hge(d,O,(R=m[b])!=null?R:y)});return Array.isArray(t)?v:v[0]}}var In=(...r)=>r.filter(Boolean).join(" ");function nd(r){const t=typeof r;return r!=null&&(t==="object"||t==="function")&&!Array.isArray(r)}function tu(r,...t){return $ge(r)?r(...t):r}var $ge=r=>typeof r=="function",cr=r=>r?"":void 0,zx=r=>r?!0:void 0;function rr(...r){return function(o){r.some(a=>(a==null||a(o),o==null?void 0:o.defaultPrevented))}}function GX(...r){return function(o){r.forEach(a=>{a==null||a(o)})}}var yb={exports:{}};yb.exports;var kK;function qge(){return kK||(kK=1,function(r,t){var o=200,a="__lodash_hash_undefined__",l=800,d=16,m=9007199254740991,v="[object Arguments]",y="[object Array]",b="[object AsyncFunction]",R="[object Boolean]",O="[object Date]",N="[object Error]",F="[object Function]",H="[object GeneratorFunction]",G="[object Map]",z="[object Number]",ne="[object Null]",J="[object Object]",oe="[object Proxy]",se="[object RegExp]",ae="[object Set]",ye="[object String]",Q="[object Undefined]",te="[object WeakMap]",re="[object ArrayBuffer]",le="[object DataView]",ve="[object Float32Array]",fe="[object Float64Array]",de="[object Int8Array]",lt="[object Int16Array]",ft="[object Int32Array]",Xe="[object Uint8Array]",Le="[object Uint8ClampedArray]",Ke="[object Uint16Array]",nt="[object Uint32Array]",Ee=/[\\^$.*+?()[\]{}|]/g,Ye=/^\[object .+?Constructor\]$/,yt=/^(?:0|[1-9]\d*)$/,at={};at[ve]=at[fe]=at[de]=at[lt]=at[ft]=at[Xe]=at[Le]=at[Ke]=at[nt]=!0,at[v]=at[y]=at[re]=at[R]=at[le]=at[O]=at[N]=at[F]=at[G]=at[z]=at[J]=at[se]=at[ae]=at[ye]=at[te]=!1;var Fe=typeof N_=="object"&&N_&&N_.Object===Object&&N_,et=typeof self=="object"&&self&&self.Object===Object&&self,_t=Fe||et||Function("return this")(),Dt=t&&!t.nodeType&&t,Ht=Dt&&!0&&r&&!r.nodeType&&r,Wt=Ht&&Ht.exports===Dt,Fn=Wt&&Fe.process,xn=function(){try{var _e=Ht&&Ht.require&&Ht.require("util").types;return _e||Fn&&Fn.binding&&Fn.binding("util")}catch{}}(),hn=xn&&xn.isTypedArray;function gr(_e,Ce,Ge){switch(Ge.length){case 0:return _e.call(Ce);case 1:return _e.call(Ce,Ge[0]);case 2:return _e.call(Ce,Ge[0],Ge[1]);case 3:return _e.call(Ce,Ge[0],Ge[1],Ge[2])}return _e.apply(Ce,Ge)}function Ar(_e,Ce){for(var Ge=-1,Bt=Array(_e);++Ge<_e;)Bt[Ge]=Ce(Ge);return Bt}function bt(_e){return function(Ce){return _e(Ce)}}function bn(_e,Ce){return _e==null?void 0:_e[Ce]}function wn(_e,Ce){return function(Ge){return _e(Ce(Ge))}}var we=Array.prototype,De=Function.prototype,We=Object.prototype,mt=_t["__core-js_shared__"],gt=De.toString,ht=We.hasOwnProperty,Mt=function(){var _e=/[^.]+$/.exec(mt&&mt.keys&&mt.keys.IE_PROTO||"");return _e?"Symbol(src)_1."+_e:""}(),jn=We.toString,On=gt.call(Object),nn=RegExp("^"+gt.call(ht).replace(Ee,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),_r=Wt?_t.Buffer:void 0,Ra=_t.Symbol,_o=_t.Uint8Array;_r&&_r.allocUnsafe;var ns=wn(Object.getPrototypeOf,Object),Lt=Object.create,fn=We.propertyIsEnumerable,rs=we.splice,or=Ra?Ra.toStringTag:void 0,$i=function(){try{var _e=Aa(Object,"defineProperty");return _e({},"",{}),_e}catch{}}(),Mc=_r?_r.isBuffer:void 0,$a=Math.max,_s=Date.now,qa=Aa(_t,"Map"),Ui=Aa(Object,"create"),Po=function(){function _e(){}return function(Ce){if(!ec(Ce))return{};if(Lt)return Lt(Ce);_e.prototype=Ce;var Ge=new _e;return _e.prototype=void 0,Ge}}();function Ys(_e){var Ce=-1,Ge=_e==null?0:_e.length;for(this.clear();++Ce<Ge;){var Bt=_e[Ce];this.set(Bt[0],Bt[1])}}function Ya(){this.__data__=Ui?Ui(null):{},this.size=0}function Uc(_e){var Ce=this.has(_e)&&delete this.__data__[_e];return this.size-=Ce?1:0,Ce}function lu(_e){var Ce=this.__data__;if(Ui){var Ge=Ce[_e];return Ge===a?void 0:Ge}return ht.call(Ce,_e)?Ce[_e]:void 0}function Xa(_e){var Ce=this.__data__;return Ui?Ce[_e]!==void 0:ht.call(Ce,_e)}function Vc(_e,Ce){var Ge=this.__data__;return this.size+=this.has(_e)?0:1,Ge[_e]=Ui&&Ce===void 0?a:Ce,this}Ys.prototype.clear=Ya,Ys.prototype.delete=Uc,Ys.prototype.get=lu,Ys.prototype.has=Xa,Ys.prototype.set=Vc;function vs(_e){var Ce=-1,Ge=_e==null?0:_e.length;for(this.clear();++Ce<Ge;){var Bt=_e[Ce];this.set(Bt[0],Bt[1])}}function Ci(){this.__data__=[],this.size=0}function ro(_e){var Ce=this.__data__,Ge=ud(Ce,_e);if(Ge<0)return!1;var Bt=Ce.length-1;return Ge==Bt?Ce.pop():rs.call(Ce,Ge,1),--this.size,!0}function Ca(_e){var Ce=this.__data__,Ge=ud(Ce,_e);return Ge<0?void 0:Ce[Ge][1]}function uu(_e){return ud(this.__data__,_e)>-1}function Ja(_e,Ce){var Ge=this.__data__,Bt=ud(Ge,_e);return Bt<0?(++this.size,Ge.push([_e,Ce])):Ge[Bt][1]=Ce,this}vs.prototype.clear=Ci,vs.prototype.delete=ro,vs.prototype.get=Ca,vs.prototype.has=uu,vs.prototype.set=Ja;function Xs(_e){var Ce=-1,Ge=_e==null?0:_e.length;for(this.clear();++Ce<Ge;){var Bt=_e[Ce];this.set(Bt[0],Bt[1])}}function Js(){this.size=0,this.__data__={hash:new Ys,map:new(qa||vs),string:new Ys}}function sd(_e){var Ce=pu(this,_e).delete(_e);return this.size-=Ce?1:0,Ce}function Hm(_e){return pu(this,_e).get(_e)}function du(_e){return pu(this,_e).has(_e)}function Nh(_e,Ce){var Ge=pu(this,_e),Bt=Ge.size;return Ge.set(_e,Ce),this.size+=Ge.size==Bt?0:1,this}Xs.prototype.clear=Js,Xs.prototype.delete=sd,Xs.prototype.get=Hm,Xs.prototype.has=du,Xs.prototype.set=Nh;function No(_e){var Ce=this.__data__=new vs(_e);this.size=Ce.size}function hu(){this.__data__=new vs,this.size=0}function Qs(_e){var Ce=this.__data__,Ge=Ce.delete(_e);return this.size=Ce.size,Ge}function ad(_e){return this.__data__.get(_e)}function cd(_e){return this.__data__.has(_e)}function Ia(_e,Ce){var Ge=this.__data__;if(Ge instanceof vs){var Bt=Ge.__data__;if(!qa||Bt.length<o-1)return Bt.push([_e,Ce]),this.size=++Ge.size,this;Ge=this.__data__=new Xs(Bt)}return Ge.set(_e,Ce),this.size=Ge.size,this}No.prototype.clear=hu,No.prototype.delete=Qs,No.prototype.get=ad,No.prototype.has=cd,No.prototype.set=Ia;function ld(_e,Ce){var Ge=Ts(_e),Bt=!Ge&&qi(_e),Wn=!Ge&&!Bt&&ws(_e),hr=!Ge&&!Bt&&!Wn&&Mh(_e),Vr=Ge||Bt||Wn||hr,Qt=Vr?Ar(_e.length,String):[],Or=Qt.length;for(var di in _e)Vr&&(di=="length"||Wn&&(di=="offset"||di=="parent")||hr&&(di=="buffer"||di=="byteLength"||di=="byteOffset")||Bc(di,Or))||Qt.push(di);return Qt}function fu(_e,Ce,Ge){(Ge!==void 0&&!Ss(_e[Ce],Ge)||Ge===void 0&&!(Ce in _e))&&Ur(_e,Ce,Ge)}function Es(_e,Ce,Ge){var Bt=_e[Ce];(!(ht.call(_e,Ce)&&Ss(Bt,Ge))||Ge===void 0&&!(Ce in _e))&&Ur(_e,Ce,Ge)}function ud(_e,Ce){for(var Ge=_e.length;Ge--;)if(Ss(_e[Ge][0],Ce))return Ge;return-1}function Ur(_e,Ce,Ge){Ce=="__proto__"&&$i?$i(_e,Ce,{configurable:!0,enumerable:!0,value:Ge,writable:!0}):_e[Ce]=Ge}var ui=El();function Qa(_e){return _e==null?_e===void 0?Q:ne:or&&or in Object(_e)?ys(_e):np(_e)}function Fc(_e){return io(_e)&&Qa(_e)==v}function Zs(_e){if(!ec(_e)||Oa(_e))return!1;var Ce=Rs(_e)?nn:Ye;return Ce.test(xh(_e))}function kh(_e){return io(_e)&&ip(_e.length)&&!!at[Qa(_e)]}function dd(_e){if(!ec(_e))return Za(_e);var Ce=Jn(_e),Ge=[];for(var Bt in _e)Bt=="constructor"&&(Ce||!ht.call(_e,Bt))||Ge.push(Bt);return Ge}function _l(_e,Ce,Ge,Bt,Wn){_e!==Ce&&ui(Ce,function(hr,Vr){if(Wn||(Wn=new No),ec(hr))is(_e,Ce,Vr,Ge,_l,Bt,Wn);else{var Qt=Bt?Bt(pd(_e,Vr),hr,Vr+"",_e,Ce,Wn):void 0;Qt===void 0&&(Qt=hr),fu(_e,Vr,Qt)}},bl)}function is(_e,Ce,Ge,Bt,Wn,hr,Vr){var Qt=pd(_e,Ge),Or=pd(Ce,Ge),di=Vr.get(Or);if(di){fu(_e,Ge,di);return}var vo=hr?hr(Qt,Or,Ge+"",_e,Ce,Vr):void 0,Cs=vo===void 0;if(Cs){var Is=Ts(Or),_u=!Is&&ws(Or),Vi=!Is&&!_u&&Mh(Or);vo=Or,Is||_u||Vi?Ts(Qt)?vo=Qt:Tl(Qt)?vo=fd(Qt):_u?(Cs=!1,vo=Dh(Or)):Vi?(Cs=!1,vo=hd(Or)):vo=[]:gu(Or)||qi(Or)?(vo=Qt,qi(Qt)?vo=Wc(Qt):(!ec(Qt)||Rs(Qt))&&(vo=mu(Or))):Cs=!1}Cs&&(Vr.set(Or,vo),Wn(vo,Or,Bt,hr,Vr),Vr.delete(Or)),fu(_e,Ge,vo)}function tp(_e,Ce){return Lh(Sl(_e,Ce,ta),_e+"")}var Wo=$i?function(_e,Ce){return $i(_e,"toString",{configurable:!0,enumerable:!1,value:ea(Ce),writable:!0})}:ta;function Dh(_e,Ce){return _e.slice()}function jc(_e){var Ce=new _e.constructor(_e.byteLength);return new _o(Ce).set(new _o(_e)),Ce}function hd(_e,Ce){var Ge=jc(_e.buffer);return new _e.constructor(Ge,_e.byteOffset,_e.length)}function fd(_e,Ce){var Ge=-1,Bt=_e.length;for(Ce||(Ce=Array(Bt));++Ge<Bt;)Ce[Ge]=_e[Ge];return Ce}function sr(_e,Ce,Ge,Bt){var Wn=!Ge;Ge||(Ge={});for(var hr=-1,Vr=Ce.length;++hr<Vr;){var Qt=Ce[hr],Or=void 0;Or===void 0&&(Or=_e[Qt]),Wn?Ur(Ge,Qt,Or):Es(Ge,Qt,Or)}return Ge}function vl(_e){return tp(function(Ce,Ge){var Bt=-1,Wn=Ge.length,hr=Wn>1?Ge[Wn-1]:void 0,Vr=Wn>2?Ge[2]:void 0;for(hr=_e.length>3&&typeof hr=="function"?(Wn--,hr):void 0,Vr&&yl(Ge[0],Ge[1],Vr)&&(hr=Wn<3?void 0:hr,Wn=1),Ce=Object(Ce);++Bt<Wn;){var Qt=Ge[Bt];Qt&&_e(Ce,Qt,Bt,hr)}return Ce})}function El(_e){return function(Ce,Ge,Bt){for(var Wn=-1,hr=Object(Ce),Vr=Bt(Ce),Qt=Vr.length;Qt--;){var Or=Vr[++Wn];if(Ge(hr[Or],Or,hr)===!1)break}return Ce}}function pu(_e,Ce){var Ge=_e.__data__;return Wr(Ce)?Ge[typeof Ce=="string"?"string":"hash"]:Ge.map}function Aa(_e,Ce){var Ge=bn(_e,Ce);return Zs(Ge)?Ge:void 0}function ys(_e){var Ce=ht.call(_e,or),Ge=_e[or];try{_e[or]=void 0;var Bt=!0}catch{}var Wn=jn.call(_e);return Bt&&(Ce?_e[or]=Ge:delete _e[or]),Wn}function mu(_e){return typeof _e.constructor=="function"&&!Jn(_e)?Po(ns(_e)):{}}function Bc(_e,Ce){var Ge=typeof _e;return Ce=Ce??m,!!Ce&&(Ge=="number"||Ge!="symbol"&&yt.test(_e))&&_e>-1&&_e%1==0&&_e<Ce}function yl(_e,Ce,Ge){if(!ec(Ge))return!1;var Bt=typeof Ce;return(Bt=="number"?bs(Ge)&&Bc(Ce,Ge.length):Bt=="string"&&Ce in Ge)?Ss(Ge[Ce],_e):!1}function Wr(_e){var Ce=typeof _e;return Ce=="string"||Ce=="number"||Ce=="symbol"||Ce=="boolean"?_e!=="__proto__":_e===null}function Oa(_e){return!!Mt&&Mt in _e}function Jn(_e){var Ce=_e&&_e.constructor,Ge=typeof Ce=="function"&&Ce.prototype||We;return _e===Ge}function Za(_e){var Ce=[];if(_e!=null)for(var Ge in Object(_e))Ce.push(Ge);return Ce}function np(_e){return jn.call(_e)}function Sl(_e,Ce,Ge){return Ce=$a(Ce===void 0?_e.length-1:Ce,0),function(){for(var Bt=arguments,Wn=-1,hr=$a(Bt.length-Ce,0),Vr=Array(hr);++Wn<hr;)Vr[Wn]=Bt[Ce+Wn];Wn=-1;for(var Qt=Array(Ce+1);++Wn<Ce;)Qt[Wn]=Bt[Wn];return Qt[Ce]=Ge(Vr),gr(_e,this,Qt)}}function pd(_e,Ce){if(!(Ce==="constructor"&&typeof _e[Ce]=="function")&&Ce!="__proto__")return _e[Ce]}var Lh=rp(Wo);function rp(_e){var Ce=0,Ge=0;return function(){var Bt=_s(),Wn=d-(Bt-Ge);if(Ge=Bt,Wn>0){if(++Ce>=l)return arguments[0]}else Ce=0;return _e.apply(void 0,arguments)}}function xh(_e){if(_e!=null){try{return gt.call(_e)}catch{}try{return _e+""}catch{}}return""}function Ss(_e,Ce){return _e===Ce||_e!==_e&&Ce!==Ce}var qi=Fc(function(){return arguments}())?Fc:function(_e){return io(_e)&&ht.call(_e,"callee")&&!fn.call(_e,"callee")},Ts=Array.isArray;function bs(_e){return _e!=null&&ip(_e.length)&&!Rs(_e)}function Tl(_e){return io(_e)&&bs(_e)}var ws=Mc||Gc;function Rs(_e){if(!ec(_e))return!1;var Ce=Qa(_e);return Ce==F||Ce==H||Ce==b||Ce==oe}function ip(_e){return typeof _e=="number"&&_e>-1&&_e%1==0&&_e<=m}function ec(_e){var Ce=typeof _e;return _e!=null&&(Ce=="object"||Ce=="function")}function io(_e){return _e!=null&&typeof _e=="object"}function gu(_e){if(!io(_e)||Qa(_e)!=J)return!1;var Ce=ns(_e);if(Ce===null)return!0;var Ge=ht.call(Ce,"constructor")&&Ce.constructor;return typeof Ge=="function"&&Ge instanceof Ge&&gt.call(Ge)==On}var Mh=hn?bt(hn):kh;function Wc(_e){return sr(_e,bl(_e))}function bl(_e){return bs(_e)?ld(_e):dd(_e)}var op=vl(function(_e,Ce,Ge,Bt){_l(_e,Ce,Ge,Bt)});function ea(_e){return function(){return _e}}function ta(_e){return _e}function Gc(){return!1}r.exports=op}(yb,yb.exports)),yb.exports}var Yge=qge();const sh=TS(Yge);var Xge=r=>/!(important)?$/.test(r),DK=r=>typeof r=="string"?r.replace(/!(important)?$/,"").trim():r,Jge=(r,t)=>o=>{const a=String(t),l=Xge(a),d=DK(a),m=r?`${r}.${d}`:d;let v=nd(o.__cssMap)&&m in o.__cssMap?o.__cssMap[m].varRef:t;return v=DK(v),l?`${v} !important`:v};function KU(r){const{scale:t,transform:o,compose:a}=r;return(d,m)=>{var v;const y=Jge(t,d)(m);let b=(v=o==null?void 0:o(y,m))!=null?v:y;return a&&(b=a(b,m)),b}}var uO=(...r)=>t=>r.reduce((o,a)=>a(o),t);function Yl(r,t){return o=>{const a={property:o,scale:r};return a.transform=KU({scale:r,transform:t}),a}}var Qge=({rtl:r,ltr:t})=>o=>o.direction==="rtl"?r:t;function Zge(r){const{property:t,scale:o,transform:a}=r;return{scale:o,property:Qge(t),transform:o?KU({scale:o,compose:a}):a}}var zX=["rotate(var(--chakra-rotate, 0))","scaleX(var(--chakra-scale-x, 1))","scaleY(var(--chakra-scale-y, 1))","skewX(var(--chakra-skew-x, 0))","skewY(var(--chakra-skew-y, 0))"];function e_e(){return["translateX(var(--chakra-translate-x, 0))","translateY(var(--chakra-translate-y, 0))",...zX].join(" ")}function t_e(){return["translate3d(var(--chakra-translate-x, 0), var(--chakra-translate-y, 0), 0)",...zX].join(" ")}var n_e={"--chakra-blur":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-brightness":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-contrast":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-grayscale":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-hue-rotate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-invert":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-saturate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-sepia":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-drop-shadow":"var(--chakra-empty,/*!*/ /*!*/)",filter:["var(--chakra-blur)","var(--chakra-brightness)","var(--chakra-contrast)","var(--chakra-grayscale)","var(--chakra-hue-rotate)","var(--chakra-invert)","var(--chakra-saturate)","var(--chakra-sepia)","var(--chakra-drop-shadow)"].join(" ")},r_e={backdropFilter:["var(--chakra-backdrop-blur)","var(--chakra-backdrop-brightness)","var(--chakra-backdrop-contrast)","var(--chakra-backdrop-grayscale)","var(--chakra-backdrop-hue-rotate)","var(--chakra-backdrop-invert)","var(--chakra-backdrop-opacity)","var(--chakra-backdrop-saturate)","var(--chakra-backdrop-sepia)"].join(" "),"--chakra-backdrop-blur":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-brightness":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-contrast":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-grayscale":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-hue-rotate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-invert":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-opacity":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-saturate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-sepia":"var(--chakra-empty,/*!*/ /*!*/)"};function i_e(r){return{"--chakra-ring-offset-shadow":"var(--chakra-ring-inset) 0 0 0 var(--chakra-ring-offset-width) var(--chakra-ring-offset-color)","--chakra-ring-shadow":"var(--chakra-ring-inset) 0 0 0 calc(var(--chakra-ring-width) + var(--chakra-ring-offset-width)) var(--chakra-ring-color)","--chakra-ring-width":r,boxShadow:["var(--chakra-ring-offset-shadow)","var(--chakra-ring-shadow)","var(--chakra-shadow, 0 0 #0000)"].join(", ")}}var o_e={"row-reverse":{space:"--chakra-space-x-reverse",divide:"--chakra-divide-x-reverse"},"column-reverse":{space:"--chakra-space-y-reverse",divide:"--chakra-divide-y-reverse"}},h2={"to-t":"to top","to-tr":"to top right","to-r":"to right","to-br":"to bottom right","to-b":"to bottom","to-bl":"to bottom left","to-l":"to left","to-tl":"to top left"},s_e=new Set(Object.values(h2)),f2=new Set(["none","-moz-initial","inherit","initial","revert","unset"]),a_e=r=>r.trim();function c_e(r,t){if(r==null||f2.has(r))return r;if(!(p2(r)||f2.has(r)))return`url('${r}')`;const l=/(^[a-z-A-Z]+)\((.*)\)/g.exec(r),d=l==null?void 0:l[1],m=l==null?void 0:l[2];if(!d||!m)return r;const v=d.includes("-gradient")?d:`${d}-gradient`,[y,...b]=m.split(",").map(a_e).filter(Boolean);if((b==null?void 0:b.length)===0)return r;const R=y in h2?h2[y]:y;b.unshift(R);const O=b.map(N=>{if(s_e.has(N))return N;const F=N.indexOf(" "),[H,G]=F!==-1?[N.substr(0,F),N.substr(F+1)]:[N],z=p2(G)?G:G&&G.split(" "),ne=`colors.${H}`,J=ne in t.__cssMap?t.__cssMap[ne].varRef:H;return z?[J,...Array.isArray(z)?z:[z]].join(" "):J});return`${v}(${O.join(", ")})`}var p2=r=>typeof r=="string"&&r.includes("(")&&r.includes(")"),l_e=(r,t)=>c_e(r,t??{});function u_e(r){return/^var\(--.+\)$/.test(r)}var d_e=r=>{const t=parseFloat(r.toString()),o=r.toString().replace(String(t),"");return{unitless:!o,value:t,unit:o}},eh=r=>t=>`${r}(${t})`,Tr={filter(r){return r!=="auto"?r:n_e},backdropFilter(r){return r!=="auto"?r:r_e},ring(r){return i_e(Tr.px(r))},bgClip(r){return r==="text"?{color:"transparent",backgroundClip:"text"}:{backgroundClip:r}},transform(r){return r==="auto"?e_e():r==="auto-gpu"?t_e():r},vh(r){return r==="$100vh"?"var(--chakra-vh)":r},px(r){if(r==null)return r;const{unitless:t}=d_e(r);return t||typeof r=="number"?`${r}px`:r},fraction(r){return typeof r!="number"||r>1?r:`${r*100}%`},float(r,t){const o={left:"right",right:"left"};return t.direction==="rtl"?o[r]:r},degree(r){if(u_e(r)||r==null)return r;const t=typeof r=="string"&&!r.endsWith("deg");return typeof r=="number"||t?`${r}deg`:r},gradient:l_e,blur:eh("blur"),opacity:eh("opacity"),brightness:eh("brightness"),contrast:eh("contrast"),dropShadow:eh("drop-shadow"),grayscale:eh("grayscale"),hueRotate:r=>eh("hue-rotate")(Tr.degree(r)),invert:eh("invert"),saturate:eh("saturate"),sepia:eh("sepia"),bgImage(r){return r==null||p2(r)||f2.has(r)?r:`url(${r})`},outline(r){const t=String(r)==="0"||String(r)==="none";return r!==null&&t?{outline:"2px solid transparent",outlineOffset:"2px"}:{outline:r}},flexDirection(r){var t;const{space:o,divide:a}=(t=o_e[r])!=null?t:{},l={flexDirection:r};return o&&(l[o]=1),a&&(l[a]=1),l}},Ne={borderWidths:Yl("borderWidths"),borderStyles:Yl("borderStyles"),colors:Yl("colors"),borders:Yl("borders"),gradients:Yl("gradients",Tr.gradient),radii:Yl("radii",Tr.px),space:Yl("space",uO(Tr.vh,Tr.px)),spaceT:Yl("space",uO(Tr.vh,Tr.px)),degreeT(r){return{property:r,transform:Tr.degree}},prop(r,t,o){return{property:r,scale:t,...t&&{transform:KU({scale:t,transform:o})}}},propT(r,t){return{property:r,transform:t}},sizes:Yl("sizes",uO(Tr.vh,Tr.px)),sizesT:Yl("sizes",uO(Tr.vh,Tr.fraction)),shadows:Yl("shadows"),logical:Zge,blur:Yl("blur",Tr.blur)},GO={background:Ne.colors("background"),backgroundColor:Ne.colors("backgroundColor"),backgroundImage:Ne.gradients("backgroundImage"),backgroundSize:!0,backgroundPosition:!0,backgroundRepeat:!0,backgroundAttachment:!0,backgroundClip:{transform:Tr.bgClip},bgSize:Ne.prop("backgroundSize"),bgPosition:Ne.prop("backgroundPosition"),bg:Ne.colors("background"),bgColor:Ne.colors("backgroundColor"),bgPos:Ne.prop("backgroundPosition"),bgRepeat:Ne.prop("backgroundRepeat"),bgAttachment:Ne.prop("backgroundAttachment"),bgGradient:Ne.gradients("backgroundImage"),bgClip:{transform:Tr.bgClip}};Object.assign(GO,{bgImage:GO.backgroundImage,bgImg:GO.backgroundImage});var Hr={border:Ne.borders("border"),borderWidth:Ne.borderWidths("borderWidth"),borderStyle:Ne.borderStyles("borderStyle"),borderColor:Ne.colors("borderColor"),borderRadius:Ne.radii("borderRadius"),borderTop:Ne.borders("borderTop"),borderBlockStart:Ne.borders("borderBlockStart"),borderTopLeftRadius:Ne.radii("borderTopLeftRadius"),borderStartStartRadius:Ne.logical({scale:"radii",property:{ltr:"borderTopLeftRadius",rtl:"borderTopRightRadius"}}),borderEndStartRadius:Ne.logical({scale:"radii",property:{ltr:"borderBottomLeftRadius",rtl:"borderBottomRightRadius"}}),borderTopRightRadius:Ne.radii("borderTopRightRadius"),borderStartEndRadius:Ne.logical({scale:"radii",property:{ltr:"borderTopRightRadius",rtl:"borderTopLeftRadius"}}),borderEndEndRadius:Ne.logical({scale:"radii",property:{ltr:"borderBottomRightRadius",rtl:"borderBottomLeftRadius"}}),borderRight:Ne.borders("borderRight"),borderInlineEnd:Ne.borders("borderInlineEnd"),borderBottom:Ne.borders("borderBottom"),borderBlockEnd:Ne.borders("borderBlockEnd"),borderBottomLeftRadius:Ne.radii("borderBottomLeftRadius"),borderBottomRightRadius:Ne.radii("borderBottomRightRadius"),borderLeft:Ne.borders("borderLeft"),borderInlineStart:{property:"borderInlineStart",scale:"borders"},borderInlineStartRadius:Ne.logical({scale:"radii",property:{ltr:["borderTopLeftRadius","borderBottomLeftRadius"],rtl:["borderTopRightRadius","borderBottomRightRadius"]}}),borderInlineEndRadius:Ne.logical({scale:"radii",property:{ltr:["borderTopRightRadius","borderBottomRightRadius"],rtl:["borderTopLeftRadius","borderBottomLeftRadius"]}}),borderX:Ne.borders(["borderLeft","borderRight"]),borderInline:Ne.borders("borderInline"),borderY:Ne.borders(["borderTop","borderBottom"]),borderBlock:Ne.borders("borderBlock"),borderTopWidth:Ne.borderWidths("borderTopWidth"),borderBlockStartWidth:Ne.borderWidths("borderBlockStartWidth"),borderTopColor:Ne.colors("borderTopColor"),borderBlockStartColor:Ne.colors("borderBlockStartColor"),borderTopStyle:Ne.borderStyles("borderTopStyle"),borderBlockStartStyle:Ne.borderStyles("borderBlockStartStyle"),borderBottomWidth:Ne.borderWidths("borderBottomWidth"),borderBlockEndWidth:Ne.borderWidths("borderBlockEndWidth"),borderBottomColor:Ne.colors("borderBottomColor"),borderBlockEndColor:Ne.colors("borderBlockEndColor"),borderBottomStyle:Ne.borderStyles("borderBottomStyle"),borderBlockEndStyle:Ne.borderStyles("borderBlockEndStyle"),borderLeftWidth:Ne.borderWidths("borderLeftWidth"),borderInlineStartWidth:Ne.borderWidths("borderInlineStartWidth"),borderLeftColor:Ne.colors("borderLeftColor"),borderInlineStartColor:Ne.colors("borderInlineStartColor"),borderLeftStyle:Ne.borderStyles("borderLeftStyle"),borderInlineStartStyle:Ne.borderStyles("borderInlineStartStyle"),borderRightWidth:Ne.borderWidths("borderRightWidth"),borderInlineEndWidth:Ne.borderWidths("borderInlineEndWidth"),borderRightColor:Ne.colors("borderRightColor"),borderInlineEndColor:Ne.colors("borderInlineEndColor"),borderRightStyle:Ne.borderStyles("borderRightStyle"),borderInlineEndStyle:Ne.borderStyles("borderInlineEndStyle"),borderTopRadius:Ne.radii(["borderTopLeftRadius","borderTopRightRadius"]),borderBottomRadius:Ne.radii(["borderBottomLeftRadius","borderBottomRightRadius"]),borderLeftRadius:Ne.radii(["borderTopLeftRadius","borderBottomLeftRadius"]),borderRightRadius:Ne.radii(["borderTopRightRadius","borderBottomRightRadius"])};Object.assign(Hr,{rounded:Hr.borderRadius,roundedTop:Hr.borderTopRadius,roundedTopLeft:Hr.borderTopLeftRadius,roundedTopRight:Hr.borderTopRightRadius,roundedTopStart:Hr.borderStartStartRadius,roundedTopEnd:Hr.borderStartEndRadius,roundedBottom:Hr.borderBottomRadius,roundedBottomLeft:Hr.borderBottomLeftRadius,roundedBottomRight:Hr.borderBottomRightRadius,roundedBottomStart:Hr.borderEndStartRadius,roundedBottomEnd:Hr.borderEndEndRadius,roundedLeft:Hr.borderLeftRadius,roundedRight:Hr.borderRightRadius,roundedStart:Hr.borderInlineStartRadius,roundedEnd:Hr.borderInlineEndRadius,borderStart:Hr.borderInlineStart,borderEnd:Hr.borderInlineEnd,borderTopStartRadius:Hr.borderStartStartRadius,borderTopEndRadius:Hr.borderStartEndRadius,borderBottomStartRadius:Hr.borderEndStartRadius,borderBottomEndRadius:Hr.borderEndEndRadius,borderStartRadius:Hr.borderInlineStartRadius,borderEndRadius:Hr.borderInlineEndRadius,borderStartWidth:Hr.borderInlineStartWidth,borderEndWidth:Hr.borderInlineEndWidth,borderStartColor:Hr.borderInlineStartColor,borderEndColor:Hr.borderInlineEndColor,borderStartStyle:Hr.borderInlineStartStyle,borderEndStyle:Hr.borderInlineEndStyle});var h_e={color:Ne.colors("color"),textColor:Ne.colors("color"),fill:Ne.colors("fill"),stroke:Ne.colors("stroke")},m2={boxShadow:Ne.shadows("boxShadow"),mixBlendMode:!0,blendMode:Ne.prop("mixBlendMode"),backgroundBlendMode:!0,bgBlendMode:Ne.prop("backgroundBlendMode"),opacity:!0};Object.assign(m2,{shadow:m2.boxShadow});var f_e={filter:{transform:Tr.filter},blur:Ne.blur("--chakra-blur"),brightness:Ne.propT("--chakra-brightness",Tr.brightness),contrast:Ne.propT("--chakra-contrast",Tr.contrast),hueRotate:Ne.propT("--chakra-hue-rotate",Tr.hueRotate),invert:Ne.propT("--chakra-invert",Tr.invert),saturate:Ne.propT("--chakra-saturate",Tr.saturate),dropShadow:Ne.propT("--chakra-drop-shadow",Tr.dropShadow),backdropFilter:{transform:Tr.backdropFilter},backdropBlur:Ne.blur("--chakra-backdrop-blur"),backdropBrightness:Ne.propT("--chakra-backdrop-brightness",Tr.brightness),backdropContrast:Ne.propT("--chakra-backdrop-contrast",Tr.contrast),backdropHueRotate:Ne.propT("--chakra-backdrop-hue-rotate",Tr.hueRotate),backdropInvert:Ne.propT("--chakra-backdrop-invert",Tr.invert),backdropSaturate:Ne.propT("--chakra-backdrop-saturate",Tr.saturate)},SP={alignItems:!0,alignContent:!0,justifyItems:!0,justifyContent:!0,flexWrap:!0,flexDirection:{transform:Tr.flexDirection},flex:!0,flexFlow:!0,flexGrow:!0,flexShrink:!0,flexBasis:Ne.sizes("flexBasis"),justifySelf:!0,alignSelf:!0,order:!0,placeItems:!0,placeContent:!0,placeSelf:!0,gap:Ne.space("gap"),rowGap:Ne.space("rowGap"),columnGap:Ne.space("columnGap")};Object.assign(SP,{flexDir:SP.flexDirection});var HX={gridGap:Ne.space("gridGap"),gridColumnGap:Ne.space("gridColumnGap"),gridRowGap:Ne.space("gridRowGap"),gridColumn:!0,gridRow:!0,gridAutoFlow:!0,gridAutoColumns:!0,gridColumnStart:!0,gridColumnEnd:!0,gridRowStart:!0,gridRowEnd:!0,gridAutoRows:!0,gridTemplate:!0,gridTemplateColumns:!0,gridTemplateRows:!0,gridTemplateAreas:!0,gridArea:!0},p_e={appearance:!0,cursor:!0,resize:!0,userSelect:!0,pointerEvents:!0,outline:{transform:Tr.outline},outlineOffset:!0,outlineColor:Ne.colors("outlineColor")},Ql={width:Ne.sizesT("width"),inlineSize:Ne.sizesT("inlineSize"),height:Ne.sizes("height"),blockSize:Ne.sizes("blockSize"),boxSize:Ne.sizes(["width","height"]),minWidth:Ne.sizes("minWidth"),minInlineSize:Ne.sizes("minInlineSize"),minHeight:Ne.sizes("minHeight"),minBlockSize:Ne.sizes("minBlockSize"),maxWidth:Ne.sizes("maxWidth"),maxInlineSize:Ne.sizes("maxInlineSize"),maxHeight:Ne.sizes("maxHeight"),maxBlockSize:Ne.sizes("maxBlockSize"),overflow:!0,overflowX:!0,overflowY:!0,overscrollBehavior:!0,overscrollBehaviorX:!0,overscrollBehaviorY:!0,display:!0,aspectRatio:!0,hideFrom:{scale:"breakpoints",transform:(r,t)=>{var o,a,l;return{[`@media screen and (min-width: ${(l=(a=(o=t.__breakpoints)==null?void 0:o.get(r))==null?void 0:a.minW)!=null?l:r})`]:{display:"none"}}}},hideBelow:{scale:"breakpoints",transform:(r,t)=>{var o,a,l;return{[`@media screen and (max-width: ${(l=(a=(o=t.__breakpoints)==null?void 0:o.get(r))==null?void 0:a._minW)!=null?l:r})`]:{display:"none"}}}},verticalAlign:!0,boxSizing:!0,boxDecorationBreak:!0,float:Ne.propT("float",Tr.float),objectFit:!0,objectPosition:!0,visibility:!0,isolation:!0};Object.assign(Ql,{w:Ql.width,h:Ql.height,minW:Ql.minWidth,maxW:Ql.maxWidth,minH:Ql.minHeight,maxH:Ql.maxHeight,overscroll:Ql.overscrollBehavior,overscrollX:Ql.overscrollBehaviorX,overscrollY:Ql.overscrollBehaviorY});var m_e={listStyleType:!0,listStylePosition:!0,listStylePos:Ne.prop("listStylePosition"),listStyleImage:!0,listStyleImg:Ne.prop("listStyleImage")};function g_e(r,t,o,a){const l=typeof t=="string"?t.split("."):[t];for(a=0;a<l.length&&r;a+=1)r=r[l[a]];return r===void 0?o:r}var __e=r=>{const t=new WeakMap;return(a,l,d,m)=>{if(typeof a>"u")return r(a,l,d);t.has(a)||t.set(a,new Map);const v=t.get(a);if(v.has(l))return v.get(l);const y=r(a,l,d,m);return v.set(l,y),y}},v_e=__e(g_e),E_e={border:"0px",clip:"rect(0, 0, 0, 0)",width:"1px",height:"1px",margin:"-1px",padding:"0px",overflow:"hidden",whiteSpace:"nowrap",position:"absolute"},y_e={position:"static",width:"auto",height:"auto",clip:"auto",padding:"0",margin:"0",overflow:"visible",whiteSpace:"normal"},Hx=(r,t,o)=>{const a={},l=v_e(r,t,{});for(const d in l)d in o&&o[d]!=null||(a[d]=l[d]);return a},S_e={srOnly:{transform(r){return r===!0?E_e:r==="focusable"?y_e:{}}},layerStyle:{processResult:!0,transform:(r,t,o)=>Hx(t,`layerStyles.${r}`,o)},textStyle:{processResult:!0,transform:(r,t,o)=>Hx(t,`textStyles.${r}`,o)},apply:{processResult:!0,transform:(r,t,o)=>Hx(t,r,o)}},Vb={position:!0,pos:Ne.prop("position"),zIndex:Ne.prop("zIndex","zIndices"),inset:Ne.spaceT("inset"),insetX:Ne.spaceT(["left","right"]),insetInline:Ne.spaceT("insetInline"),insetY:Ne.spaceT(["top","bottom"]),insetBlock:Ne.spaceT("insetBlock"),top:Ne.spaceT("top"),insetBlockStart:Ne.spaceT("insetBlockStart"),bottom:Ne.spaceT("bottom"),insetBlockEnd:Ne.spaceT("insetBlockEnd"),left:Ne.spaceT("left"),insetInlineStart:Ne.logical({scale:"space",property:{ltr:"left",rtl:"right"}}),right:Ne.spaceT("right"),insetInlineEnd:Ne.logical({scale:"space",property:{ltr:"right",rtl:"left"}})};Object.assign(Vb,{insetStart:Vb.insetInlineStart,insetEnd:Vb.insetInlineEnd});var T_e={ring:{transform:Tr.ring},ringColor:Ne.colors("--chakra-ring-color"),ringOffset:Ne.prop("--chakra-ring-offset-width"),ringOffsetColor:Ne.colors("--chakra-ring-offset-color"),ringInset:Ne.prop("--chakra-ring-inset")},xi={margin:Ne.spaceT("margin"),marginTop:Ne.spaceT("marginTop"),marginBlockStart:Ne.spaceT("marginBlockStart"),marginRight:Ne.spaceT("marginRight"),marginInlineEnd:Ne.spaceT("marginInlineEnd"),marginBottom:Ne.spaceT("marginBottom"),marginBlockEnd:Ne.spaceT("marginBlockEnd"),marginLeft:Ne.spaceT("marginLeft"),marginInlineStart:Ne.spaceT("marginInlineStart"),marginX:Ne.spaceT(["marginInlineStart","marginInlineEnd"]),marginInline:Ne.spaceT("marginInline"),marginY:Ne.spaceT(["marginTop","marginBottom"]),marginBlock:Ne.spaceT("marginBlock"),padding:Ne.space("padding"),paddingTop:Ne.space("paddingTop"),paddingBlockStart:Ne.space("paddingBlockStart"),paddingRight:Ne.space("paddingRight"),paddingBottom:Ne.space("paddingBottom"),paddingBlockEnd:Ne.space("paddingBlockEnd"),paddingLeft:Ne.space("paddingLeft"),paddingInlineStart:Ne.space("paddingInlineStart"),paddingInlineEnd:Ne.space("paddingInlineEnd"),paddingX:Ne.space(["paddingInlineStart","paddingInlineEnd"]),paddingInline:Ne.space("paddingInline"),paddingY:Ne.space(["paddingTop","paddingBottom"]),paddingBlock:Ne.space("paddingBlock")};Object.assign(xi,{m:xi.margin,mt:xi.marginTop,mr:xi.marginRight,me:xi.marginInlineEnd,marginEnd:xi.marginInlineEnd,mb:xi.marginBottom,ml:xi.marginLeft,ms:xi.marginInlineStart,marginStart:xi.marginInlineStart,mx:xi.marginX,my:xi.marginY,p:xi.padding,pt:xi.paddingTop,py:xi.paddingY,px:xi.paddingX,pb:xi.paddingBottom,pl:xi.paddingLeft,ps:xi.paddingInlineStart,paddingStart:xi.paddingInlineStart,pr:xi.paddingRight,pe:xi.paddingInlineEnd,paddingEnd:xi.paddingInlineEnd});var b_e={textDecorationColor:Ne.colors("textDecorationColor"),textDecoration:!0,textDecor:{property:"textDecoration"},textDecorationLine:!0,textDecorationStyle:!0,textDecorationThickness:!0,textUnderlineOffset:!0,textShadow:Ne.shadows("textShadow")},w_e={clipPath:!0,transform:Ne.propT("transform",Tr.transform),transformOrigin:!0,translateX:Ne.spaceT("--chakra-translate-x"),translateY:Ne.spaceT("--chakra-translate-y"),skewX:Ne.degreeT("--chakra-skew-x"),skewY:Ne.degreeT("--chakra-skew-y"),scaleX:Ne.prop("--chakra-scale-x"),scaleY:Ne.prop("--chakra-scale-y"),scale:Ne.prop(["--chakra-scale-x","--chakra-scale-y"]),rotate:Ne.degreeT("--chakra-rotate")},R_e={transition:!0,transitionDelay:!0,animation:!0,willChange:!0,transitionDuration:Ne.prop("transitionDuration","transition.duration"),transitionProperty:Ne.prop("transitionProperty","transition.property"),transitionTimingFunction:Ne.prop("transitionTimingFunction","transition.easing")},C_e={fontFamily:Ne.prop("fontFamily","fonts"),fontSize:Ne.prop("fontSize","fontSizes",Tr.px),fontWeight:Ne.prop("fontWeight","fontWeights"),lineHeight:Ne.prop("lineHeight","lineHeights"),letterSpacing:Ne.prop("letterSpacing","letterSpacings"),textAlign:!0,fontStyle:!0,textIndent:!0,wordBreak:!0,overflowWrap:!0,textOverflow:!0,textTransform:!0,whiteSpace:!0,isTruncated:{transform(r){if(r===!0)return{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}},noOfLines:{static:{overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitBoxOrient:"vertical",WebkitLineClamp:"var(--chakra-line-clamp)"},property:"--chakra-line-clamp"}},I_e={scrollBehavior:!0,scrollSnapAlign:!0,scrollSnapStop:!0,scrollSnapType:!0,scrollMargin:Ne.spaceT("scrollMargin"),scrollMarginTop:Ne.spaceT("scrollMarginTop"),scrollMarginBottom:Ne.spaceT("scrollMarginBottom"),scrollMarginLeft:Ne.spaceT("scrollMarginLeft"),scrollMarginRight:Ne.spaceT("scrollMarginRight"),scrollMarginX:Ne.spaceT(["scrollMarginLeft","scrollMarginRight"]),scrollMarginY:Ne.spaceT(["scrollMarginTop","scrollMarginBottom"]),scrollPadding:Ne.spaceT("scrollPadding"),scrollPaddingTop:Ne.spaceT("scrollPaddingTop"),scrollPaddingBottom:Ne.spaceT("scrollPaddingBottom"),scrollPaddingLeft:Ne.spaceT("scrollPaddingLeft"),scrollPaddingRight:Ne.spaceT("scrollPaddingRight"),scrollPaddingX:Ne.spaceT(["scrollPaddingLeft","scrollPaddingRight"]),scrollPaddingY:Ne.spaceT(["scrollPaddingTop","scrollPaddingBottom"])};function KX(r){return nd(r)&&r.reference?r.reference:String(r)}var dN=(r,...t)=>t.map(KX).join(` ${r} `).replace(/calc/g,""),LK=(...r)=>`calc(${dN("+",...r)})`,xK=(...r)=>`calc(${dN("-",...r)})`,g2=(...r)=>`calc(${dN("*",...r)})`,MK=(...r)=>`calc(${dN("/",...r)})`,UK=r=>{const t=KX(r);return t!=null&&!Number.isNaN(parseFloat(t))?String(t).startsWith("-")?String(t).slice(1):`-${t}`:g2(t,-1)},O_=Object.assign(r=>({add:(...t)=>O_(LK(r,...t)),subtract:(...t)=>O_(xK(r,...t)),multiply:(...t)=>O_(g2(r,...t)),divide:(...t)=>O_(MK(r,...t)),negate:()=>O_(UK(r)),toString:()=>r.toString()}),{add:LK,subtract:xK,multiply:g2,divide:MK,negate:UK});function A_e(r,t="-"){return r.replace(/\s+/g,t)}function O_e(r){const t=A_e(r.toString());return N_e(P_e(t))}function P_e(r){return r.includes("\\.")?r:!Number.isInteger(parseFloat(r.toString()))?r.replace(".","\\."):r}function N_e(r){return r.replace(/[!-,/:-@[-^`{-~]/g,"\\$&")}function k_e(r,t=""){return[t,r].filter(Boolean).join("-")}function D_e(r,t){return`var(${r}${t?`, ${t}`:""})`}function L_e(r,t=""){return O_e(`--${k_e(r,t)}`)}function Tn(r,t,o){const a=L_e(r,o);return{variable:a,reference:D_e(a,t)}}function x_e(r,t){const o={};for(const a of t){if(Array.isArray(a)){const[l,d]=a;o[l]=Tn(`${r}-${l}`,d);continue}o[a]=Tn(`${r}-${a}`)}return o}function M_e(r){const t=r==null?0:r.length;return t?r[t-1]:void 0}function U_e(r){const t=parseFloat(r.toString()),o=r.toString().replace(String(t),"");return{unitless:!o,value:t,unit:o}}function _2(r){if(r==null)return r;const{unitless:t}=U_e(r);return t||typeof r=="number"?`${r}px`:r}var $X=(r,t)=>parseInt(r[1],10)>parseInt(t[1],10)?1:-1,$U=r=>Object.fromEntries(Object.entries(r).sort($X));function VK(r){const t=$U(r);return Object.assign(Object.values(t),t)}function V_e(r){const t=Object.keys($U(r));return new Set(t)}function FK(r){var t;if(!r)return r;r=(t=_2(r))!=null?t:r;const o=-.02;return typeof r=="number"?`${r+o}`:r.replace(/(\d+\.?\d*)/u,a=>`${parseFloat(a)+o}`)}function Sb(r,t){const o=["@media screen"];return r&&o.push("and",`(min-width: ${_2(r)})`),t&&o.push("and",`(max-width: ${_2(t)})`),o.join(" ")}function F_e(r){var t;if(!r)return null;r.base=(t=r.base)!=null?t:"0px";const o=VK(r),a=Object.entries(r).sort($X).map(([m,v],y,b)=>{var R;let[,O]=(R=b[y+1])!=null?R:[];return O=parseFloat(O)>0?FK(O):void 0,{_minW:FK(v),breakpoint:m,minW:v,maxW:O,maxWQuery:Sb(null,O),minWQuery:Sb(v),minMaxQuery:Sb(v,O)}}),l=V_e(r),d=Array.from(l.values());return{keys:l,normalized:o,isResponsive(m){const v=Object.keys(m);return v.length>0&&v.every(y=>l.has(y))},asObject:$U(r),asArray:VK(r),details:a,get(m){return a.find(v=>v.breakpoint===m)},media:[null,...o.map(m=>Sb(m)).slice(1)],toArrayValue(m){if(!nd(m))throw new Error("toArrayValue: value must be an object");const v=d.map(y=>{var b;return(b=m[y])!=null?b:null});for(;M_e(v)===null;)v.pop();return v},toObjectValue(m){if(!Array.isArray(m))throw new Error("toObjectValue: value must be an array");return m.reduce((v,y,b)=>{const R=d[b];return R!=null&&y!=null&&(v[R]=y),v},{})}}}var Bs={hover:(r,t)=>`${r}:hover ${t}, ${r}[data-hover] ${t}`,focus:(r,t)=>`${r}:focus ${t}, ${r}[data-focus] ${t}`,focusVisible:(r,t)=>`${r}:focus-visible ${t}`,focusWithin:(r,t)=>`${r}:focus-within ${t}`,active:(r,t)=>`${r}:active ${t}, ${r}[data-active] ${t}`,disabled:(r,t)=>`${r}:disabled ${t}, ${r}[data-disabled] ${t}`,invalid:(r,t)=>`${r}:invalid ${t}, ${r}[data-invalid] ${t}`,checked:(r,t)=>`${r}:checked ${t}, ${r}[data-checked] ${t}`,placeholderShown:(r,t)=>`${r}:placeholder-shown ${t}`},cm=r=>qX(t=>r(t,"&"),"[role=group]","[data-group]",".group"),Cf=r=>qX(t=>r(t,"~ &"),"[data-peer]",".peer"),qX=(r,...t)=>t.map(r).join(", "),hN={_hover:"&:hover, &[data-hover]",_active:"&:active, &[data-active]",_focus:"&:focus, &[data-focus]",_highlighted:"&[data-highlighted]",_focusWithin:"&:focus-within",_focusVisible:"&:focus-visible, &[data-focus-visible]",_disabled:"&:disabled, &[disabled], &[aria-disabled=true], &[data-disabled]",_readOnly:"&[aria-readonly=true], &[readonly], &[data-readonly]",_before:"&::before",_after:"&::after",_empty:"&:empty",_expanded:"&[aria-expanded=true], &[data-expanded]",_checked:"&[aria-checked=true], &[data-checked]",_grabbed:"&[aria-grabbed=true], &[data-grabbed]",_pressed:"&[aria-pressed=true], &[data-pressed]",_invalid:"&[aria-invalid=true], &[data-invalid]",_valid:"&[data-valid], &[data-state=valid]",_loading:"&[data-loading], &[aria-busy=true]",_selected:"&[aria-selected=true], &[data-selected]",_hidden:"&[hidden], &[data-hidden]",_autofill:"&:-webkit-autofill",_even:"&:nth-of-type(even)",_odd:"&:nth-of-type(odd)",_first:"&:first-of-type",_firstLetter:"&::first-letter",_last:"&:last-of-type",_notFirst:"&:not(:first-of-type)",_notLast:"&:not(:last-of-type)",_visited:"&:visited",_activeLink:"&[aria-current=page]",_activeStep:"&[aria-current=step]",_indeterminate:"&:indeterminate, &[aria-checked=mixed], &[data-indeterminate]",_groupHover:cm(Bs.hover),_peerHover:Cf(Bs.hover),_groupFocus:cm(Bs.focus),_peerFocus:Cf(Bs.focus),_groupFocusVisible:cm(Bs.focusVisible),_peerFocusVisible:Cf(Bs.focusVisible),_groupActive:cm(Bs.active),_peerActive:Cf(Bs.active),_groupDisabled:cm(Bs.disabled),_peerDisabled:Cf(Bs.disabled),_groupInvalid:cm(Bs.invalid),_peerInvalid:Cf(Bs.invalid),_groupChecked:cm(Bs.checked),_peerChecked:Cf(Bs.checked),_groupFocusWithin:cm(Bs.focusWithin),_peerFocusWithin:Cf(Bs.focusWithin),_peerPlaceholderShown:Cf(Bs.placeholderShown),_placeholder:"&::placeholder",_placeholderShown:"&:placeholder-shown",_fullScreen:"&:fullscreen",_selection:"&::selection",_rtl:"[dir=rtl] &, &[dir=rtl]",_ltr:"[dir=ltr] &, &[dir=ltr]",_mediaDark:"@media (prefers-color-scheme: dark)",_mediaReduceMotion:"@media (prefers-reduced-motion: reduce)",_dark:".chakra-ui-dark &:not([data-theme]),[data-theme=dark] &:not([data-theme]),&[data-theme=dark]",_light:".chakra-ui-light &:not([data-theme]),[data-theme=light] &:not([data-theme]),&[data-theme=light]",_horizontal:"&[data-orientation=horizontal]",_vertical:"&[data-orientation=vertical]"},YX=Object.keys(hN);function jK(r,t){return Tn(String(r).replace(/\./g,"-"),void 0,t)}function j_e(r,t){let o={};const a={};for(const[l,d]of Object.entries(r)){const{isSemantic:m,value:v}=d,{variable:y,reference:b}=jK(l,t==null?void 0:t.cssVarPrefix);if(!m){if(l.startsWith("space")){const N=l.split("."),[F,...H]=N,G=`${F}.-${H.join(".")}`,z=O_.negate(v),ne=O_.negate(b);a[G]={value:z,var:y,varRef:ne}}o[y]=v,a[l]={value:v,var:y,varRef:b};continue}const R=N=>{const H=[String(l).split(".")[0],N].join(".");if(!r[H])return N;const{reference:z}=jK(H,t==null?void 0:t.cssVarPrefix);return z},O=nd(v)?v:{default:v};o=sh(o,Object.entries(O).reduce((N,[F,H])=>{var G,z;if(!H)return N;const ne=R(`${H}`);if(F==="default")return N[y]=ne,N;const J=(z=(G=hN)==null?void 0:G[F])!=null?z:F;return N[J]={[y]:ne},N},{})),a[l]={value:b,var:y,varRef:b}}return{cssVars:o,cssMap:a}}function B_e(r,t=[]){const o=Object.assign({},r);for(const a of t)a in o&&delete o[a];return o}function W_e(r,t){const o={};for(const a of t)a in r&&(o[a]=r[a]);return o}function G_e(r){return typeof r=="object"&&r!=null&&!Array.isArray(r)}function BK(r,t,o={}){const{stop:a,getKey:l}=o;function d(m,v=[]){var y;if(G_e(m)||Array.isArray(m)){const b={};for(const[R,O]of Object.entries(m)){const N=(y=l==null?void 0:l(R))!=null?y:R,F=[...v,N];if(a!=null&&a(m,F))return t(m,v);b[N]=d(O,F)}return b}return t(m,v)}return d(r)}var z_e=["colors","borders","borderWidths","borderStyles","fonts","fontSizes","fontWeights","gradients","letterSpacings","lineHeights","radii","space","shadows","sizes","zIndices","transition","blur","breakpoints"];function H_e(r){return W_e(r,z_e)}function K_e(r){return r.semanticTokens}function $_e(r){const{__cssMap:t,__cssVars:o,__breakpoints:a,...l}=r;return l}var q_e=r=>YX.includes(r)||r==="default";function Y_e({tokens:r,semanticTokens:t}){const o={};return BK(r,(a,l)=>{a!=null&&(o[l.join(".")]={isSemantic:!1,value:a})}),BK(t,(a,l)=>{a!=null&&(o[l.join(".")]={isSemantic:!0,value:a})},{stop:a=>Object.keys(a).every(q_e)}),o}function X_e(r){var t;const o=$_e(r),a=H_e(o),l=K_e(o),d=Y_e({tokens:a,semanticTokens:l}),m=(t=o.config)==null?void 0:t.cssVarPrefix,{cssMap:v,cssVars:y}=j_e(d,{cssVarPrefix:m});return Object.assign(o,{__cssVars:{...{"--chakra-ring-inset":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-ring-offset-width":"0px","--chakra-ring-offset-color":"#fff","--chakra-ring-color":"rgba(66, 153, 225, 0.6)","--chakra-ring-offset-shadow":"0 0 #0000","--chakra-ring-shadow":"0 0 #0000","--chakra-space-x-reverse":"0","--chakra-space-y-reverse":"0"},...y},__cssMap:v,__breakpoints:F_e(o.breakpoints)}),o}var qU=sh({},GO,Hr,h_e,SP,Ql,f_e,T_e,p_e,HX,S_e,Vb,m2,xi,I_e,C_e,b_e,w_e,m_e,R_e),J_e=Object.assign({},xi,Ql,SP,HX,Vb),Q_e=Object.keys(J_e),Z_e=[...Object.keys(qU),...YX],eve={...qU,...hN},tve=r=>r in eve,nve=r=>t=>{if(!t.__breakpoints)return r;const{isResponsive:o,toArrayValue:a,media:l}=t.__breakpoints,d={};for(const m in r){let v=tu(r[m],t);if(v==null)continue;if(v=nd(v)&&o(v)?a(v):v,!Array.isArray(v)){d[m]=v;continue}const y=v.slice(0,l.length).length;for(let b=0;b<y;b+=1){const R=l==null?void 0:l[b];if(!R){d[m]=v[b];continue}d[R]=d[R]||{},v[b]!=null&&(d[R][m]=v[b])}}return d};function rve(r){const t=[];let o="",a=!1;for(let l=0;l<r.length;l++){const d=r[l];d==="("?(a=!0,o+=d):d===")"?(a=!1,o+=d):d===","&&!a?(t.push(o),o=""):o+=d}return o=o.trim(),o&&t.push(o),t}function ive(r){return/^var\(--.+\)$/.test(r)}var ove=(r,t)=>r.startsWith("--")&&typeof t=="string"&&!ive(t),sve=(r,t)=>{var o,a;if(t==null)return t;const l=y=>{var b,R;return(R=(b=r.__cssMap)==null?void 0:b[y])==null?void 0:R.varRef},d=y=>{var b;return(b=l(y))!=null?b:y},[m,v]=rve(t);return t=(a=(o=l(m))!=null?o:d(v))!=null?a:d(t),t};function ave(r){const{configs:t={},pseudos:o={},theme:a}=r,l=(d,m=!1)=>{var v,y,b;const R=tu(d,a),O=nve(R)(a);let N={};for(let F in O){const H=O[F];let G=tu(H,a);F in o&&(F=o[F]),ove(F,G)&&(G=sve(a,G));let z=t[F];if(z===!0&&(z={property:F}),nd(G)){N[F]=(v=N[F])!=null?v:{},N[F]=sh({},N[F],l(G,!0));continue}let ne=(b=(y=z==null?void 0:z.transform)==null?void 0:y.call(z,G,a,R))!=null?b:G;ne=z!=null&&z.processResult?l(ne,!0):ne;const J=tu(z==null?void 0:z.property,a);if(!m&&(z!=null&&z.static)){const oe=tu(z.static,a);N=sh({},N,oe)}if(J&&Array.isArray(J)){for(const oe of J)N[oe]=ne;continue}if(J){J==="&"&&nd(ne)?N=sh({},N,ne):N[J]=ne;continue}if(nd(ne)){N=sh({},N,ne);continue}N[F]=ne}return N};return l}var XX=r=>t=>ave({theme:t,pseudos:hN,configs:qU})(r);function I5e(r){return r}function A5e(r){return r}function Ri(r){return{definePartsStyle(t){return t},defineMultiStyleConfig(t){return{parts:r,...t}}}}function cve(r,t){if(Array.isArray(r))return r;if(nd(r))return t(r);if(r!=null)return[r]}function lve(r,t){for(let o=t+1;o<r.length;o++)if(r[o]!=null)return o;return-1}function uve(r){const t=r.__breakpoints;return function(a,l,d,m){var v,y;if(!t)return;const b={},R=cve(d,t.toArrayValue);if(!R)return b;const O=R.length,N=O===1,F=!!a.parts;for(let H=0;H<O;H++){const G=t.details[H],z=t.details[lve(R,H)],ne=Sb(G.minW,z==null?void 0:z._minW),J=tu((v=a[l])==null?void 0:v[R[H]],m);if(J){if(F){(y=a.parts)==null||y.forEach(oe=>{sh(b,{[oe]:N?J[oe]:{[ne]:J[oe]}})});continue}if(!F){N?sh(b,J):b[ne]=J;continue}b[ne]=J}}return b}}function dve(r){return t=>{var o;const{variant:a,size:l,theme:d}=t,m=uve(d);return sh({},tu((o=r.baseStyle)!=null?o:{},t),m(r,"sizes",l,t),m(r,"variants",a,t))}}function hve(r,t,o){var a,l,d;return(d=(l=(a=r.__cssMap)==null?void 0:a[`${t}.${o}`])==null?void 0:l.varRef)!=null?d:o}function Ki(r){return B_e(r,["styleConfig","size","variant","colorScheme"])}var fve={common:"background-color, border-color, color, fill, stroke, opacity, box-shadow, transform",colors:"background-color, border-color, color, fill, stroke",dimensions:"width, height",position:"left, right, top, bottom",background:"background-color, background-image, background-position"},pve={"ease-in":"cubic-bezier(0.4, 0, 1, 1)","ease-out":"cubic-bezier(0, 0, 0.2, 1)","ease-in-out":"cubic-bezier(0.4, 0, 0.2, 1)"},mve={"ultra-fast":"50ms",faster:"100ms",fast:"150ms",normal:"200ms",slow:"300ms",slower:"400ms","ultra-slow":"500ms"},gve={property:fve,easing:pve,duration:mve},_ve=gve,vve={hide:-1,auto:"auto",base:0,docked:10,dropdown:1e3,sticky:1100,banner:1200,overlay:1300,modal:1400,popover:1500,skipLink:1600,toast:1700,tooltip:1800},Eve=vve,yve={none:0,"1px":"1px solid","2px":"2px solid","4px":"4px solid","8px":"8px solid"},Sve=yve,Tve={base:"0em",sm:"30em",md:"48em",lg:"62em",xl:"80em","2xl":"96em"},bve=Tve,wve={transparent:"transparent",current:"currentColor",black:"#000000",white:"#FFFFFF",whiteAlpha:{50:"rgba(255, 255, 255, 0.04)",100:"rgba(255, 255, 255, 0.06)",200:"rgba(255, 255, 255, 0.08)",300:"rgba(255, 255, 255, 0.16)",400:"rgba(255, 255, 255, 0.24)",500:"rgba(255, 255, 255, 0.36)",600:"rgba(255, 255, 255, 0.48)",700:"rgba(255, 255, 255, 0.64)",800:"rgba(255, 255, 255, 0.80)",900:"rgba(255, 255, 255, 0.92)"},blackAlpha:{50:"rgba(0, 0, 0, 0.04)",100:"rgba(0, 0, 0, 0.06)",200:"rgba(0, 0, 0, 0.08)",300:"rgba(0, 0, 0, 0.16)",400:"rgba(0, 0, 0, 0.24)",500:"rgba(0, 0, 0, 0.36)",600:"rgba(0, 0, 0, 0.48)",700:"rgba(0, 0, 0, 0.64)",800:"rgba(0, 0, 0, 0.80)",900:"rgba(0, 0, 0, 0.92)"},gray:{50:"#F7FAFC",100:"#EDF2F7",200:"#E2E8F0",300:"#CBD5E0",400:"#A0AEC0",500:"#718096",600:"#4A5568",700:"#2D3748",800:"#1A202C",900:"#171923"},red:{50:"#FFF5F5",100:"#FED7D7",200:"#FEB2B2",300:"#FC8181",400:"#F56565",500:"#E53E3E",600:"#C53030",700:"#9B2C2C",800:"#822727",900:"#63171B"},orange:{50:"#FFFAF0",100:"#FEEBC8",200:"#FBD38D",300:"#F6AD55",400:"#ED8936",500:"#DD6B20",600:"#C05621",700:"#9C4221",800:"#7B341E",900:"#652B19"},yellow:{50:"#FFFFF0",100:"#FEFCBF",200:"#FAF089",300:"#F6E05E",400:"#ECC94B",500:"#D69E2E",600:"#B7791F",700:"#975A16",800:"#744210",900:"#5F370E"},green:{50:"#F0FFF4",100:"#C6F6D5",200:"#9AE6B4",300:"#68D391",400:"#48BB78",500:"#38A169",600:"#2F855A",700:"#276749",800:"#22543D",900:"#1C4532"},teal:{50:"#E6FFFA",100:"#B2F5EA",200:"#81E6D9",300:"#4FD1C5",400:"#38B2AC",500:"#319795",600:"#2C7A7B",700:"#285E61",800:"#234E52",900:"#1D4044"},blue:{50:"#ebf8ff",100:"#bee3f8",200:"#90cdf4",300:"#63b3ed",400:"#4299e1",500:"#3182ce",600:"#2b6cb0",700:"#2c5282",800:"#2a4365",900:"#1A365D"},cyan:{50:"#EDFDFD",100:"#C4F1F9",200:"#9DECF9",300:"#76E4F7",400:"#0BC5EA",500:"#00B5D8",600:"#00A3C4",700:"#0987A0",800:"#086F83",900:"#065666"},purple:{50:"#FAF5FF",100:"#E9D8FD",200:"#D6BCFA",300:"#B794F4",400:"#9F7AEA",500:"#805AD5",600:"#6B46C1",700:"#553C9A",800:"#44337A",900:"#322659"},pink:{50:"#FFF5F7",100:"#FED7E2",200:"#FBB6CE",300:"#F687B3",400:"#ED64A6",500:"#D53F8C",600:"#B83280",700:"#97266D",800:"#702459",900:"#521B41"},linkedin:{50:"#E8F4F9",100:"#CFEDFB",200:"#9BDAF3",300:"#68C7EC",400:"#34B3E4",500:"#00A0DC",600:"#008CC9",700:"#0077B5",800:"#005E93",900:"#004471"},facebook:{50:"#E8F4F9",100:"#D9DEE9",200:"#B7C2DA",300:"#6482C0",400:"#4267B2",500:"#385898",600:"#314E89",700:"#29487D",800:"#223B67",900:"#1E355B"},messenger:{50:"#D0E6FF",100:"#B9DAFF",200:"#A2CDFF",300:"#7AB8FF",400:"#2E90FF",500:"#0078FF",600:"#0063D1",700:"#0052AC",800:"#003C7E",900:"#002C5C"},whatsapp:{50:"#dffeec",100:"#b9f5d0",200:"#90edb3",300:"#65e495",400:"#3cdd78",500:"#22c35e",600:"#179848",700:"#0c6c33",800:"#01421c",900:"#001803"},twitter:{50:"#E5F4FD",100:"#C8E9FB",200:"#A8DCFA",300:"#83CDF7",400:"#57BBF5",500:"#1DA1F2",600:"#1A94DA",700:"#1681BF",800:"#136B9E",900:"#0D4D71"},telegram:{50:"#E3F2F9",100:"#C5E4F3",200:"#A2D4EC",300:"#7AC1E4",400:"#47A9DA",500:"#0088CC",600:"#007AB8",700:"#006BA1",800:"#005885",900:"#003F5E"}},Rve=wve,Cve={none:"0",sm:"0.125rem",base:"0.25rem",md:"0.375rem",lg:"0.5rem",xl:"0.75rem","2xl":"1rem","3xl":"1.5rem",full:"9999px"},Ive=Cve,Ave={xs:"0 0 0 1px rgba(0, 0, 0, 0.05)",sm:"0 1px 2px 0 rgba(0, 0, 0, 0.05)",base:"0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06)",md:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)",lg:"0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)",xl:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)","2xl":"0 25px 50px -12px rgba(0, 0, 0, 0.25)",outline:"0 0 0 3px rgba(66, 153, 225, 0.6)",inner:"inset 0 2px 4px 0 rgba(0,0,0,0.06)",none:"none","dark-lg":"rgba(0, 0, 0, 0.1) 0px 0px 0px 1px, rgba(0, 0, 0, 0.2) 0px 5px 10px, rgba(0, 0, 0, 0.4) 0px 15px 40px"},Ove=Ave,Pve={none:0,sm:"4px",base:"8px",md:"12px",lg:"16px",xl:"24px","2xl":"40px","3xl":"64px"},Nve=Pve,kve={letterSpacings:{tighter:"-0.05em",tight:"-0.025em",normal:"0",wide:"0.025em",wider:"0.05em",widest:"0.1em"},lineHeights:{normal:"normal",none:1,shorter:1.25,short:1.375,base:1.5,tall:1.625,taller:"2",3:".75rem",4:"1rem",5:"1.25rem",6:"1.5rem",7:"1.75rem",8:"2rem",9:"2.25rem",10:"2.5rem"},fontWeights:{hairline:100,thin:200,light:300,normal:400,medium:500,semibold:600,bold:700,extrabold:800,black:900},fonts:{heading:'-apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',body:'-apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',mono:'SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace'},fontSizes:{"3xs":"0.45rem","2xs":"0.625rem",xs:"0.75rem",sm:"0.875rem",md:"1rem",lg:"1.125rem",xl:"1.25rem","2xl":"1.5rem","3xl":"1.875rem","4xl":"2.25rem","5xl":"3rem","6xl":"3.75rem","7xl":"4.5rem","8xl":"6rem","9xl":"8rem"}},JX=kve,QX={px:"1px",.5:"0.125rem",1:"0.25rem",1.5:"0.375rem",2:"0.5rem",2.5:"0.625rem",3:"0.75rem",3.5:"0.875rem",4:"1rem",5:"1.25rem",6:"1.5rem",7:"1.75rem",8:"2rem",9:"2.25rem",10:"2.5rem",12:"3rem",14:"3.5rem",16:"4rem",20:"5rem",24:"6rem",28:"7rem",32:"8rem",36:"9rem",40:"10rem",44:"11rem",48:"12rem",52:"13rem",56:"14rem",60:"15rem",64:"16rem",72:"18rem",80:"20rem",96:"24rem"},Dve={max:"max-content",min:"min-content",full:"100%","3xs":"14rem","2xs":"16rem",xs:"20rem",sm:"24rem",md:"28rem",lg:"32rem",xl:"36rem","2xl":"42rem","3xl":"48rem","4xl":"56rem","5xl":"64rem","6xl":"72rem","7xl":"80rem","8xl":"90rem",prose:"60ch"},Lve={sm:"640px",md:"768px",lg:"1024px",xl:"1280px"},xve={...QX,...Dve,container:Lve},ZX=xve,Mve={breakpoints:bve,zIndices:Eve,radii:Ive,blur:Nve,colors:Rve,...JX,sizes:ZX,shadows:Ove,space:QX,borders:Sve,transition:_ve},{defineMultiStyleConfig:Uve,definePartsStyle:Tb}=Ri(["stepper","step","title","description","indicator","separator","icon","number"]),kf=Tn("stepper-indicator-size"),Oy=Tn("stepper-icon-size"),Py=Tn("stepper-title-font-size"),bb=Tn("stepper-description-font-size"),tb=Tn("stepper-accent-color"),Vve=Tb(({colorScheme:r})=>({stepper:{display:"flex",justifyContent:"space-between",gap:"4","&[data-orientation=vertical]":{flexDirection:"column",alignItems:"flex-start"},"&[data-orientation=horizontal]":{flexDirection:"row",alignItems:"center"},[tb.variable]:`colors.${r}.500`,_dark:{[tb.variable]:`colors.${r}.200`}},title:{fontSize:Py.reference,fontWeight:"medium"},description:{fontSize:bb.reference,color:"chakra-subtle-text"},number:{fontSize:Py.reference},step:{flexShrink:0,position:"relative",display:"flex",gap:"2","&[data-orientation=horizontal]":{alignItems:"center"},flex:"1","&:last-of-type:not([data-stretch])":{flex:"initial"}},icon:{flexShrink:0,width:Oy.reference,height:Oy.reference},indicator:{flexShrink:0,borderRadius:"full",width:kf.reference,height:kf.reference,display:"flex",justifyContent:"center",alignItems:"center","&[data-status=active]":{borderWidth:"2px",borderColor:tb.reference},"&[data-status=complete]":{bg:tb.reference,color:"chakra-inverse-text"},"&[data-status=incomplete]":{borderWidth:"2px"}},separator:{bg:"chakra-border-color",flex:"1","&[data-status=complete]":{bg:tb.reference},"&[data-orientation=horizontal]":{width:"100%",height:"2px",marginStart:"2"},"&[data-orientation=vertical]":{width:"2px",position:"absolute",height:"100%",maxHeight:`calc(100% - ${kf.reference} - 8px)`,top:`calc(${kf.reference} + 4px)`,insetStart:`calc(${kf.reference} / 2 - 1px)`}}})),Fve=Uve({baseStyle:Vve,sizes:{xs:Tb({stepper:{[kf.variable]:"sizes.4",[Oy.variable]:"sizes.3",[Py.variable]:"fontSizes.xs",[bb.variable]:"fontSizes.xs"}}),sm:Tb({stepper:{[kf.variable]:"sizes.6",[Oy.variable]:"sizes.4",[Py.variable]:"fontSizes.sm",[bb.variable]:"fontSizes.xs"}}),md:Tb({stepper:{[kf.variable]:"sizes.8",[Oy.variable]:"sizes.5",[Py.variable]:"fontSizes.md",[bb.variable]:"fontSizes.sm"}}),lg:Tb({stepper:{[kf.variable]:"sizes.10",[Oy.variable]:"sizes.6",[Py.variable]:"fontSizes.lg",[bb.variable]:"fontSizes.md"}})},defaultProps:{size:"md",colorScheme:"blue"}});function Yr(r,t={}){let o=!1;function a(){if(!o){o=!0;return}throw new Error("[anatomy] .part(...) should only be called once. Did you mean to use .extend(...) ?")}function l(...R){a();for(const O of R)t[O]=y(O);return Yr(r,t)}function d(...R){for(const O of R)O in t||(t[O]=y(O));return Yr(r,t)}function m(){return Object.fromEntries(Object.entries(t).map(([O,N])=>[O,N.selector]))}function v(){return Object.fromEntries(Object.entries(t).map(([O,N])=>[O,N.className]))}function y(R){const F=`chakra-${(["container","root"].includes(R??"")?[r]:[r,R]).filter(Boolean).join("__")}`;return{className:F,selector:`.${F}`,toString:()=>R}}return{parts:l,toPart:y,extend:d,selectors:m,classnames:v,get keys(){return Object.keys(t)},__type:{}}}var jve=Yr("accordion").parts("root","container","button","panel").extend("icon"),Bve=Yr("alert").parts("title","description","container").extend("icon","spinner"),Wve=Yr("avatar").parts("label","badge","container").extend("excessLabel","group"),Gve=Yr("breadcrumb").parts("link","item","container").extend("separator");Yr("button").parts();var zve=Yr("checkbox").parts("control","icon","container").extend("label");Yr("progress").parts("track","filledTrack").extend("label");var Hve=Yr("drawer").parts("overlay","dialogContainer","dialog").extend("header","closeButton","body","footer"),Kve=Yr("editable").parts("preview","input","textarea"),$ve=Yr("form").parts("container","requiredIndicator","helperText"),qve=Yr("formError").parts("text","icon"),Yve=Yr("input").parts("addon","field","element","group"),Xve=Yr("list").parts("container","item","icon"),Jve=Yr("menu").parts("button","list","item").extend("groupTitle","icon","command","divider"),Qve=Yr("modal").parts("overlay","dialogContainer","dialog").extend("header","closeButton","body","footer"),Zve=Yr("numberinput").parts("root","field","stepperGroup","stepper");Yr("pininput").parts("field");var eEe=Yr("popover").parts("content","header","body","footer").extend("popper","arrow","closeButton"),tEe=Yr("progress").parts("label","filledTrack","track"),nEe=Yr("radio").parts("container","control","label"),rEe=Yr("select").parts("field","icon"),iEe=Yr("slider").parts("container","track","thumb","filledTrack","mark"),oEe=Yr("stat").parts("container","label","helpText","number","icon"),sEe=Yr("switch").parts("container","track","thumb","label"),aEe=Yr("table").parts("table","thead","tbody","tr","th","td","tfoot","caption"),cEe=Yr("tabs").parts("root","tab","tablist","tabpanel","tabpanels","indicator"),lEe=Yr("tag").parts("container","label","closeButton"),uEe=Yr("card").parts("container","header","body","footer");Yr("stepper").parts("stepper","step","title","description","indicator","separator","icon","number");function k_(r,t,o){return Math.min(Math.max(r,o),t)}class dEe extends Error{constructor(t){super(`Failed to parse color: "${t}"`)}}var wb=dEe;function YU(r){if(typeof r!="string")throw new wb(r);if(r.trim().toLowerCase()==="transparent")return[0,0,0,0];let t=r.trim();t=EEe.test(r)?pEe(r):r;const o=mEe.exec(t);if(o){const m=Array.from(o).slice(1);return[...m.slice(0,3).map(v=>parseInt(ow(v,2),16)),parseInt(ow(m[3]||"f",2),16)/255]}const a=gEe.exec(t);if(a){const m=Array.from(a).slice(1);return[...m.slice(0,3).map(v=>parseInt(v,16)),parseInt(m[3]||"ff",16)/255]}const l=_Ee.exec(t);if(l){const m=Array.from(l).slice(1);return[...m.slice(0,3).map(v=>parseInt(v,10)),parseFloat(m[3]||"1")]}const d=vEe.exec(t);if(d){const[m,v,y,b]=Array.from(d).slice(1).map(parseFloat);if(k_(0,100,v)!==v)throw new wb(r);if(k_(0,100,y)!==y)throw new wb(r);return[...yEe(m,v,y),Number.isNaN(b)?1:b]}throw new wb(r)}function hEe(r){let t=5381,o=r.length;for(;o;)t=t*33^r.charCodeAt(--o);return(t>>>0)%2341}const WK=r=>parseInt(r.replace(/_/g,""),36),fEe="1q29ehhb 1n09sgk7 1kl1ekf_ _yl4zsno 16z9eiv3 1p29lhp8 _bd9zg04 17u0____ _iw9zhe5 _to73___ _r45e31e _7l6g016 _jh8ouiv _zn3qba8 1jy4zshs 11u87k0u 1ro9yvyo 1aj3xael 1gz9zjz0 _3w8l4xo 1bf1ekf_ _ke3v___ _4rrkb__ 13j776yz _646mbhl _nrjr4__ _le6mbhl 1n37ehkb _m75f91n _qj3bzfz 1939yygw 11i5z6x8 _1k5f8xs 1509441m 15t5lwgf _ae2th1n _tg1ugcv 1lp1ugcv 16e14up_ _h55rw7n _ny9yavn _7a11xb_ 1ih442g9 _pv442g9 1mv16xof 14e6y7tu 1oo9zkds 17d1cisi _4v9y70f _y98m8kc 1019pq0v 12o9zda8 _348j4f4 1et50i2o _8epa8__ _ts6senj 1o350i2o 1mi9eiuo 1259yrp0 1ln80gnw _632xcoy 1cn9zldc _f29edu4 1n490c8q _9f9ziet 1b94vk74 _m49zkct 1kz6s73a 1eu9dtog _q58s1rz 1dy9sjiq __u89jo3 _aj5nkwg _ld89jo3 13h9z6wx _qa9z2ii _l119xgq _bs5arju 1hj4nwk9 1qt4nwk9 1ge6wau6 14j9zlcw 11p1edc_ _ms1zcxe _439shk6 _jt9y70f _754zsow 1la40eju _oq5p___ _x279qkz 1fa5r3rv _yd2d9ip _424tcku _8y1di2_ _zi2uabw _yy7rn9h 12yz980_ __39ljp6 1b59zg0x _n39zfzp 1fy9zest _b33k___ _hp9wq92 1il50hz4 _io472ub _lj9z3eo 19z9ykg0 _8t8iu3a 12b9bl4a 1ak5yw0o _896v4ku _tb8k8lv _s59zi6t _c09ze0p 1lg80oqn 1id9z8wb _238nba5 1kq6wgdi _154zssg _tn3zk49 _da9y6tc 1sg7cv4f _r12jvtt 1gq5fmkz 1cs9rvci _lp9jn1c _xw1tdnb 13f9zje6 16f6973h _vo7ir40 _bt5arjf _rc45e4t _hr4e100 10v4e100 _hc9zke2 _w91egv_ _sj2r1kk 13c87yx8 _vqpds__ _ni8ggk8 _tj9yqfb 1ia2j4r4 _7x9b10u 1fc9ld4j 1eq9zldr _5j9lhpx _ez9zl6o _md61fzm".split(" ").reduce((r,t)=>{const o=WK(t.substring(0,3)),a=WK(t.substring(3)).toString(16);let l="";for(let d=0;d<6-a.length;d++)l+="0";return r[o]=`${l}${a}`,r},{});function pEe(r){const t=r.toLowerCase().trim(),o=fEe[hEe(t)];if(!o)throw new wb(r);return`#${o}`}const ow=(r,t)=>Array.from(Array(t)).map(()=>r).join(""),mEe=new RegExp(`^#${ow("([a-f0-9])",3)}([a-f0-9])?$`,"i"),gEe=new RegExp(`^#${ow("([a-f0-9]{2})",3)}([a-f0-9]{2})?$`,"i"),_Ee=new RegExp(`^rgba?\\(\\s*(\\d+)\\s*${ow(",\\s*(\\d+)\\s*",2)}(?:,\\s*([\\d.]+))?\\s*\\)$`,"i"),vEe=/^hsla?\(\s*([\d.]+)\s*,\s*([\d.]+)%\s*,\s*([\d.]+)%(?:\s*,\s*([\d.]+))?\s*\)$/i,EEe=/^[a-z]+$/i,GK=r=>Math.round(r*255),yEe=(r,t,o)=>{let a=o/100;if(t===0)return[a,a,a].map(GK);const l=(r%360+360)%360/60,d=(1-Math.abs(2*a-1))*(t/100),m=d*(1-Math.abs(l%2-1));let v=0,y=0,b=0;l>=0&&l<1?(v=d,y=m):l>=1&&l<2?(v=m,y=d):l>=2&&l<3?(y=d,b=m):l>=3&&l<4?(y=m,b=d):l>=4&&l<5?(v=m,b=d):l>=5&&l<6&&(v=d,b=m);const R=a-d/2,O=v+R,N=y+R,F=b+R;return[O,N,F].map(GK)};function SEe(r,t,o,a){return`rgba(${k_(0,255,r).toFixed()}, ${k_(0,255,t).toFixed()}, ${k_(0,255,o).toFixed()}, ${parseFloat(k_(0,1,a).toFixed(3))})`}function TEe(r,t){const[o,a,l,d]=YU(r);return SEe(o,a,l,d-t)}function bEe(r){const[t,o,a,l]=YU(r);let d=m=>{const v=k_(0,255,m).toString(16);return v.length===1?`0${v}`:v};return`#${d(t)}${d(o)}${d(a)}${l<1?d(Math.round(l*255)):""}`}function wEe(r,t,o,a,l){for(t=t.split?t.split("."):t,a=0;a<t.length;a++)r=r?r[t[a]]:l;return r===l?o:r}var REe=r=>Object.keys(r).length===0,Ha=(r,t,o)=>{const a=wEe(r,`colors.${t}`,t);try{return bEe(a),a}catch{return o??"#000000"}},CEe=r=>{const[t,o,a]=YU(r);return(t*299+o*587+a*114)/1e3},IEe=r=>t=>{const o=Ha(t,r);return CEe(o)<128?"dark":"light"},AEe=r=>t=>IEe(r)(t)==="dark",iS=(r,t)=>o=>{const a=Ha(o,r);return TEe(a,1-t)};function zK(r="1rem",t="rgba(255, 255, 255, 0.15)"){return{backgroundImage:`linear-gradient(
    45deg,
    ${t} 25%,
    transparent 25%,
    transparent 50%,
    ${t} 50%,
    ${t} 75%,
    transparent 75%,
    transparent
  )`,backgroundSize:`${r} ${r}`}}var OEe=()=>`#${Math.floor(Math.random()*16777215).toString(16).padEnd(6,"0")}`;function PEe(r){const t=OEe();return!r||REe(r)?t:r.string&&r.colors?kEe(r.string,r.colors):r.string&&!r.colors?NEe(r.string):r.colors&&!r.string?DEe(r.colors):t}function NEe(r){let t=0;if(r.length===0)return t.toString();for(let a=0;a<r.length;a+=1)t=r.charCodeAt(a)+((t<<5)-t),t=t&t;let o="#";for(let a=0;a<3;a+=1){const l=t>>a*8&255;o+=`00${l.toString(16)}`.substr(-2)}return o}function kEe(r,t){let o=0;if(r.length===0)return t[0];for(let a=0;a<r.length;a+=1)o=r.charCodeAt(a)+((o<<5)-o),o=o&o;return o=(o%t.length+t.length)%t.length,t[o]}function DEe(r){return r[Math.floor(Math.random()*r.length)]}function Sn(r,t){return o=>o.colorMode==="dark"?t:r}function XU(r){const{orientation:t,vertical:o,horizontal:a}=r;return t?t==="vertical"?o:a:{}}function eJ(r){return nd(r)&&r.reference?r.reference:String(r)}var fN=(r,...t)=>t.map(eJ).join(` ${r} `).replace(/calc/g,""),HK=(...r)=>`calc(${fN("+",...r)})`,KK=(...r)=>`calc(${fN("-",...r)})`,v2=(...r)=>`calc(${fN("*",...r)})`,$K=(...r)=>`calc(${fN("/",...r)})`,qK=r=>{const t=eJ(r);return t!=null&&!Number.isNaN(parseFloat(t))?String(t).startsWith("-")?String(t).slice(1):`-${t}`:v2(t,-1)},Df=Object.assign(r=>({add:(...t)=>Df(HK(r,...t)),subtract:(...t)=>Df(KK(r,...t)),multiply:(...t)=>Df(v2(r,...t)),divide:(...t)=>Df($K(r,...t)),negate:()=>Df(qK(r)),toString:()=>r.toString()}),{add:HK,subtract:KK,multiply:v2,divide:$K,negate:qK});function LEe(r){return!Number.isInteger(parseFloat(r.toString()))}function xEe(r,t="-"){return r.replace(/\s+/g,t)}function tJ(r){const t=xEe(r.toString());return t.includes("\\.")?r:LEe(r)?t.replace(".","\\."):r}function MEe(r,t=""){return[t,tJ(r)].filter(Boolean).join("-")}function UEe(r,t){return`var(${tJ(r)}${t?`, ${t}`:""})`}function VEe(r,t=""){return`--${MEe(r,t)}`}function ts(r,t){const o=VEe(r,void 0);return{variable:o,reference:UEe(o,FEe(void 0))}}function FEe(r){return r==null?void 0:r.reference}var{defineMultiStyleConfig:jEe,definePartsStyle:zO}=Ri(sEe.keys),Fb=ts("switch-track-width"),M_=ts("switch-track-height"),Kx=ts("switch-track-diff"),BEe=Df.subtract(Fb,M_),E2=ts("switch-thumb-x"),nb=ts("switch-bg"),WEe=r=>{const{colorScheme:t}=r;return{borderRadius:"full",p:"0.5",width:[Fb.reference],height:[M_.reference],transitionProperty:"common",transitionDuration:"fast",[nb.variable]:"colors.gray.300",_dark:{[nb.variable]:"colors.whiteAlpha.400"},_focusVisible:{boxShadow:"outline"},_disabled:{opacity:.4,cursor:"not-allowed"},_checked:{[nb.variable]:`colors.${t}.500`,_dark:{[nb.variable]:`colors.${t}.200`}},bg:nb.reference}},GEe={bg:"white",transitionProperty:"transform",transitionDuration:"normal",borderRadius:"inherit",width:[M_.reference],height:[M_.reference],_checked:{transform:`translateX(${E2.reference})`}},zEe=zO(r=>({container:{[Kx.variable]:BEe,[E2.variable]:Kx.reference,_rtl:{[E2.variable]:Df(Kx).negate().toString()}},track:WEe(r),thumb:GEe})),HEe={sm:zO({container:{[Fb.variable]:"1.375rem",[M_.variable]:"sizes.3"}}),md:zO({container:{[Fb.variable]:"1.875rem",[M_.variable]:"sizes.4"}}),lg:zO({container:{[Fb.variable]:"2.875rem",[M_.variable]:"sizes.6"}})},KEe=jEe({baseStyle:zEe,sizes:HEe,defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:$Ee,definePartsStyle:Gy}=Ri(aEe.keys),qEe=Gy({table:{fontVariantNumeric:"lining-nums tabular-nums",borderCollapse:"collapse",width:"full"},th:{fontFamily:"heading",fontWeight:"bold",textTransform:"uppercase",letterSpacing:"wider",textAlign:"start"},td:{textAlign:"start"},caption:{mt:4,fontFamily:"heading",textAlign:"center",fontWeight:"medium"}}),TP={"&[data-is-numeric=true]":{textAlign:"end"}},YEe=Gy(r=>{const{colorScheme:t}=r;return{th:{color:Sn("gray.600","gray.400")(r),borderBottom:"1px",borderColor:Sn(`${t}.100`,`${t}.700`)(r),...TP},td:{borderBottom:"1px",borderColor:Sn(`${t}.100`,`${t}.700`)(r),...TP},caption:{color:Sn("gray.600","gray.100")(r)},tfoot:{tr:{"&:last-of-type":{th:{borderBottomWidth:0}}}}}}),XEe=Gy(r=>{const{colorScheme:t}=r;return{th:{color:Sn("gray.600","gray.400")(r),borderBottom:"1px",borderColor:Sn(`${t}.100`,`${t}.700`)(r),...TP},td:{borderBottom:"1px",borderColor:Sn(`${t}.100`,`${t}.700`)(r),...TP},caption:{color:Sn("gray.600","gray.100")(r)},tbody:{tr:{"&:nth-of-type(odd)":{"th, td":{borderBottomWidth:"1px",borderColor:Sn(`${t}.100`,`${t}.700`)(r)},td:{background:Sn(`${t}.100`,`${t}.700`)(r)}}}},tfoot:{tr:{"&:last-of-type":{th:{borderBottomWidth:0}}}}}}),JEe={simple:YEe,striped:XEe,unstyled:{}},QEe={sm:Gy({th:{px:"4",py:"1",lineHeight:"4",fontSize:"xs"},td:{px:"4",py:"2",fontSize:"sm",lineHeight:"4"},caption:{px:"4",py:"2",fontSize:"xs"}}),md:Gy({th:{px:"6",py:"3",lineHeight:"4",fontSize:"xs"},td:{px:"6",py:"4",lineHeight:"5"},caption:{px:"6",py:"2",fontSize:"sm"}}),lg:Gy({th:{px:"8",py:"4",lineHeight:"5",fontSize:"sm"},td:{px:"8",py:"5",lineHeight:"6"},caption:{px:"6",py:"2",fontSize:"md"}})},ZEe=$Ee({baseStyle:qEe,variants:JEe,sizes:QEe,defaultProps:{variant:"simple",size:"md",colorScheme:"gray"}}),Ac=Tn("tabs-color"),ed=Tn("tabs-bg"),dO=Tn("tabs-border-color"),{defineMultiStyleConfig:eye,definePartsStyle:uh}=Ri(cEe.keys),tye=r=>{const{orientation:t}=r;return{display:t==="vertical"?"flex":"block"}},nye=r=>{const{isFitted:t}=r;return{flex:t?1:void 0,transitionProperty:"common",transitionDuration:"normal",_focusVisible:{zIndex:1,boxShadow:"outline"},_disabled:{cursor:"not-allowed",opacity:.4}}},rye=r=>{const{align:t="start",orientation:o}=r;return{justifyContent:{end:"flex-end",center:"center",start:"flex-start"}[t],flexDirection:o==="vertical"?"column":"row"}},iye={p:4},oye=uh(r=>({root:tye(r),tab:nye(r),tablist:rye(r),tabpanel:iye})),sye={sm:uh({tab:{py:1,px:4,fontSize:"sm"}}),md:uh({tab:{fontSize:"md",py:2,px:4}}),lg:uh({tab:{fontSize:"lg",py:3,px:4}})},aye=uh(r=>{const{colorScheme:t,orientation:o}=r,a=o==="vertical",l=a?"borderStart":"borderBottom",d=a?"marginStart":"marginBottom";return{tablist:{[l]:"2px solid",borderColor:"inherit"},tab:{[l]:"2px solid",borderColor:"transparent",[d]:"-2px",_selected:{[Ac.variable]:`colors.${t}.600`,_dark:{[Ac.variable]:`colors.${t}.300`},borderColor:"currentColor"},_active:{[ed.variable]:"colors.gray.200",_dark:{[ed.variable]:"colors.whiteAlpha.300"}},_disabled:{_active:{bg:"none"}},color:Ac.reference,bg:ed.reference}}}),cye=uh(r=>{const{colorScheme:t}=r;return{tab:{borderTopRadius:"md",border:"1px solid",borderColor:"transparent",mb:"-1px",[dO.variable]:"transparent",_selected:{[Ac.variable]:`colors.${t}.600`,[dO.variable]:"colors.white",_dark:{[Ac.variable]:`colors.${t}.300`,[dO.variable]:"colors.gray.800"},borderColor:"inherit",borderBottomColor:dO.reference},color:Ac.reference},tablist:{mb:"-1px",borderBottom:"1px solid",borderColor:"inherit"}}}),lye=uh(r=>{const{colorScheme:t}=r;return{tab:{border:"1px solid",borderColor:"inherit",[ed.variable]:"colors.gray.50",_dark:{[ed.variable]:"colors.whiteAlpha.50"},mb:"-1px",_notLast:{marginEnd:"-1px"},_selected:{[ed.variable]:"colors.white",[Ac.variable]:`colors.${t}.600`,_dark:{[ed.variable]:"colors.gray.800",[Ac.variable]:`colors.${t}.300`},borderColor:"inherit",borderTopColor:"currentColor",borderBottomColor:"transparent"},color:Ac.reference,bg:ed.reference},tablist:{mb:"-1px",borderBottom:"1px solid",borderColor:"inherit"}}}),uye=uh(r=>{const{colorScheme:t,theme:o}=r;return{tab:{borderRadius:"full",fontWeight:"semibold",color:"gray.600",_selected:{color:Ha(o,`${t}.700`),bg:Ha(o,`${t}.100`)}}}}),dye=uh(r=>{const{colorScheme:t}=r;return{tab:{borderRadius:"full",fontWeight:"semibold",[Ac.variable]:"colors.gray.600",_dark:{[Ac.variable]:"inherit"},_selected:{[Ac.variable]:"colors.white",[ed.variable]:`colors.${t}.600`,_dark:{[Ac.variable]:"colors.gray.800",[ed.variable]:`colors.${t}.300`}},color:Ac.reference,bg:ed.reference}}}),hye=uh({}),fye={line:aye,enclosed:cye,"enclosed-colored":lye,"soft-rounded":uye,"solid-rounded":dye,unstyled:hye},pye=eye({baseStyle:oye,sizes:sye,variants:fye,defaultProps:{size:"md",variant:"line",colorScheme:"blue"}}),Oo=x_e("badge",["bg","color","shadow"]),mye={px:1,textTransform:"uppercase",fontSize:"xs",borderRadius:"sm",fontWeight:"bold",bg:Oo.bg.reference,color:Oo.color.reference,boxShadow:Oo.shadow.reference},gye=r=>{const{colorScheme:t,theme:o}=r,a=iS(`${t}.500`,.6)(o);return{[Oo.bg.variable]:`colors.${t}.500`,[Oo.color.variable]:"colors.white",_dark:{[Oo.bg.variable]:a,[Oo.color.variable]:"colors.whiteAlpha.800"}}},_ye=r=>{const{colorScheme:t,theme:o}=r,a=iS(`${t}.200`,.16)(o);return{[Oo.bg.variable]:`colors.${t}.100`,[Oo.color.variable]:`colors.${t}.800`,_dark:{[Oo.bg.variable]:a,[Oo.color.variable]:`colors.${t}.200`}}},vye=r=>{const{colorScheme:t,theme:o}=r,a=iS(`${t}.200`,.8)(o);return{[Oo.color.variable]:`colors.${t}.500`,_dark:{[Oo.color.variable]:a},[Oo.shadow.variable]:`inset 0 0 0px 1px ${Oo.color.reference}`}},Eye={solid:gye,subtle:_ye,outline:vye},jb={baseStyle:mye,variants:Eye,defaultProps:{variant:"subtle",colorScheme:"gray"}},{defineMultiStyleConfig:yye,definePartsStyle:U_}=Ri(lEe.keys),YK=Tn("tag-bg"),XK=Tn("tag-color"),$x=Tn("tag-shadow"),HO=Tn("tag-min-height"),KO=Tn("tag-min-width"),$O=Tn("tag-font-size"),qO=Tn("tag-padding-inline"),Sye={fontWeight:"medium",lineHeight:1.2,outline:0,[XK.variable]:Oo.color.reference,[YK.variable]:Oo.bg.reference,[$x.variable]:Oo.shadow.reference,color:XK.reference,bg:YK.reference,boxShadow:$x.reference,borderRadius:"md",minH:HO.reference,minW:KO.reference,fontSize:$O.reference,px:qO.reference,_focusVisible:{[$x.variable]:"shadows.outline"}},Tye={lineHeight:1.2,overflow:"visible"},bye={fontSize:"lg",w:"5",h:"5",transitionProperty:"common",transitionDuration:"normal",borderRadius:"full",marginStart:"1.5",marginEnd:"-1",opacity:.5,_disabled:{opacity:.4},_focusVisible:{boxShadow:"outline",bg:"rgba(0, 0, 0, 0.14)"},_hover:{opacity:.8},_active:{opacity:1}},wye=U_({container:Sye,label:Tye,closeButton:bye}),Rye={sm:U_({container:{[HO.variable]:"sizes.5",[KO.variable]:"sizes.5",[$O.variable]:"fontSizes.xs",[qO.variable]:"space.2"},closeButton:{marginEnd:"-2px",marginStart:"0.35rem"}}),md:U_({container:{[HO.variable]:"sizes.6",[KO.variable]:"sizes.6",[$O.variable]:"fontSizes.sm",[qO.variable]:"space.2"}}),lg:U_({container:{[HO.variable]:"sizes.8",[KO.variable]:"sizes.8",[$O.variable]:"fontSizes.md",[qO.variable]:"space.3"}})},Cye={subtle:U_(r=>{var t;return{container:(t=jb.variants)==null?void 0:t.subtle(r)}}),solid:U_(r=>{var t;return{container:(t=jb.variants)==null?void 0:t.solid(r)}}),outline:U_(r=>{var t;return{container:(t=jb.variants)==null?void 0:t.outline(r)}})},Iye=yye({variants:Cye,baseStyle:wye,sizes:Rye,defaultProps:{size:"md",variant:"subtle",colorScheme:"gray"}}),{definePartsStyle:Lf,defineMultiStyleConfig:Aye}=Ri(Yve.keys),Ny=Tn("input-height"),ky=Tn("input-font-size"),Dy=Tn("input-padding"),Ly=Tn("input-border-radius"),Oye=Lf({addon:{height:Ny.reference,fontSize:ky.reference,px:Dy.reference,borderRadius:Ly.reference},field:{width:"100%",height:Ny.reference,fontSize:ky.reference,px:Dy.reference,borderRadius:Ly.reference,minWidth:0,outline:0,position:"relative",appearance:"none",transitionProperty:"common",transitionDuration:"normal",_disabled:{opacity:.4,cursor:"not-allowed"}}}),lm={lg:{[ky.variable]:"fontSizes.lg",[Dy.variable]:"space.4",[Ly.variable]:"radii.md",[Ny.variable]:"sizes.12"},md:{[ky.variable]:"fontSizes.md",[Dy.variable]:"space.4",[Ly.variable]:"radii.md",[Ny.variable]:"sizes.10"},sm:{[ky.variable]:"fontSizes.sm",[Dy.variable]:"space.3",[Ly.variable]:"radii.sm",[Ny.variable]:"sizes.8"},xs:{[ky.variable]:"fontSizes.xs",[Dy.variable]:"space.2",[Ly.variable]:"radii.sm",[Ny.variable]:"sizes.6"}},Pye={lg:Lf({field:lm.lg,group:lm.lg}),md:Lf({field:lm.md,group:lm.md}),sm:Lf({field:lm.sm,group:lm.sm}),xs:Lf({field:lm.xs,group:lm.xs})};function JU(r){const{focusBorderColor:t,errorBorderColor:o}=r;return{focusBorderColor:t||Sn("blue.500","blue.300")(r),errorBorderColor:o||Sn("red.500","red.300")(r)}}var Nye=Lf(r=>{const{theme:t}=r,{focusBorderColor:o,errorBorderColor:a}=JU(r);return{field:{border:"1px solid",borderColor:"inherit",bg:"inherit",_hover:{borderColor:Sn("gray.300","whiteAlpha.400")(r)},_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:Ha(t,a),boxShadow:`0 0 0 1px ${Ha(t,a)}`},_focusVisible:{zIndex:1,borderColor:Ha(t,o),boxShadow:`0 0 0 1px ${Ha(t,o)}`}},addon:{border:"1px solid",borderColor:Sn("inherit","whiteAlpha.50")(r),bg:Sn("gray.100","whiteAlpha.300")(r)}}}),kye=Lf(r=>{const{theme:t}=r,{focusBorderColor:o,errorBorderColor:a}=JU(r);return{field:{border:"2px solid",borderColor:"transparent",bg:Sn("gray.100","whiteAlpha.50")(r),_hover:{bg:Sn("gray.200","whiteAlpha.100")(r)},_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:Ha(t,a)},_focusVisible:{bg:"transparent",borderColor:Ha(t,o)}},addon:{border:"2px solid",borderColor:"transparent",bg:Sn("gray.100","whiteAlpha.50")(r)}}}),Dye=Lf(r=>{const{theme:t}=r,{focusBorderColor:o,errorBorderColor:a}=JU(r);return{field:{borderBottom:"1px solid",borderColor:"inherit",borderRadius:"0",px:"0",bg:"transparent",_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:Ha(t,a),boxShadow:`0px 1px 0px 0px ${Ha(t,a)}`},_focusVisible:{borderColor:Ha(t,o),boxShadow:`0px 1px 0px 0px ${Ha(t,o)}`}},addon:{borderBottom:"2px solid",borderColor:"inherit",borderRadius:"0",px:"0",bg:"transparent"}}}),Lye=Lf({field:{bg:"transparent",px:"0",height:"auto"},addon:{bg:"transparent",px:"0",height:"auto"}}),xye={outline:Nye,filled:kye,flushed:Dye,unstyled:Lye},qr=Aye({baseStyle:Oye,sizes:Pye,variants:xye,defaultProps:{size:"md",variant:"outline"}}),JK,Mye={...(JK=qr.baseStyle)==null?void 0:JK.field,paddingY:"2",minHeight:"20",lineHeight:"short",verticalAlign:"top"},QK,ZK,Uye={outline:r=>{var t,o;return(o=(t=qr.variants)==null?void 0:t.outline(r).field)!=null?o:{}},flushed:r=>{var t,o;return(o=(t=qr.variants)==null?void 0:t.flushed(r).field)!=null?o:{}},filled:r=>{var t,o;return(o=(t=qr.variants)==null?void 0:t.filled(r).field)!=null?o:{}},unstyled:(ZK=(QK=qr.variants)==null?void 0:QK.unstyled.field)!=null?ZK:{}},e$,t$,n$,r$,i$,o$,s$,a$,Vye={xs:(t$=(e$=qr.sizes)==null?void 0:e$.xs.field)!=null?t$:{},sm:(r$=(n$=qr.sizes)==null?void 0:n$.sm.field)!=null?r$:{},md:(o$=(i$=qr.sizes)==null?void 0:i$.md.field)!=null?o$:{},lg:(a$=(s$=qr.sizes)==null?void 0:s$.lg.field)!=null?a$:{}},Fye={baseStyle:Mye,sizes:Vye,variants:Uye,defaultProps:{size:"md",variant:"outline"}},hO=ts("tooltip-bg"),qx=ts("tooltip-fg"),jye=ts("popper-arrow-bg"),Bye={bg:hO.reference,color:qx.reference,[hO.variable]:"colors.gray.700",[qx.variable]:"colors.whiteAlpha.900",_dark:{[hO.variable]:"colors.gray.300",[qx.variable]:"colors.gray.900"},[jye.variable]:hO.reference,px:"2",py:"0.5",borderRadius:"sm",fontWeight:"medium",fontSize:"sm",boxShadow:"md",maxW:"xs",zIndex:"tooltip"},Wye={baseStyle:Bye},{defineMultiStyleConfig:Gye,definePartsStyle:Rb}=Ri(tEe.keys),zye=r=>{const{colorScheme:t,theme:o,isIndeterminate:a,hasStripe:l}=r,d=Sn(zK(),zK("1rem","rgba(0,0,0,0.1)"))(r),m=Sn(`${t}.500`,`${t}.200`)(r),v=`linear-gradient(
    to right,
    transparent 0%,
    ${Ha(o,m)} 50%,
    transparent 100%
  )`;return{...!a&&l&&d,...a?{bgImage:v}:{bgColor:m}}},Hye={lineHeight:"1",fontSize:"0.25em",fontWeight:"bold",color:"white"},Kye=r=>({bg:Sn("gray.100","whiteAlpha.300")(r)}),$ye=r=>({transitionProperty:"common",transitionDuration:"slow",...zye(r)}),qye=Rb(r=>({label:Hye,filledTrack:$ye(r),track:Kye(r)})),Yye={xs:Rb({track:{h:"1"}}),sm:Rb({track:{h:"2"}}),md:Rb({track:{h:"3"}}),lg:Rb({track:{h:"4"}})},Xye=Gye({sizes:Yye,baseStyle:qye,defaultProps:{size:"md",colorScheme:"blue"}}),Jye=r=>typeof r=="function";function Ka(r,...t){return Jye(r)?r(...t):r}var{definePartsStyle:YO,defineMultiStyleConfig:Qye}=Ri(zve.keys),Bb=Tn("checkbox-size"),Zye=r=>{const{colorScheme:t}=r;return{w:Bb.reference,h:Bb.reference,transitionProperty:"box-shadow",transitionDuration:"normal",border:"2px solid",borderRadius:"sm",borderColor:"inherit",color:"white",_checked:{bg:Sn(`${t}.500`,`${t}.200`)(r),borderColor:Sn(`${t}.500`,`${t}.200`)(r),color:Sn("white","gray.900")(r),_hover:{bg:Sn(`${t}.600`,`${t}.300`)(r),borderColor:Sn(`${t}.600`,`${t}.300`)(r)},_disabled:{borderColor:Sn("gray.200","transparent")(r),bg:Sn("gray.200","whiteAlpha.300")(r),color:Sn("gray.500","whiteAlpha.500")(r)}},_indeterminate:{bg:Sn(`${t}.500`,`${t}.200`)(r),borderColor:Sn(`${t}.500`,`${t}.200`)(r),color:Sn("white","gray.900")(r)},_disabled:{bg:Sn("gray.100","whiteAlpha.100")(r),borderColor:Sn("gray.100","transparent")(r)},_focusVisible:{boxShadow:"outline"},_invalid:{borderColor:Sn("red.500","red.300")(r)}}},eSe={_disabled:{cursor:"not-allowed"}},tSe={userSelect:"none",_disabled:{opacity:.4}},nSe={transitionProperty:"transform",transitionDuration:"normal"},rSe=YO(r=>({icon:nSe,container:eSe,control:Ka(Zye,r),label:tSe})),iSe={sm:YO({control:{[Bb.variable]:"sizes.3"},label:{fontSize:"sm"},icon:{fontSize:"3xs"}}),md:YO({control:{[Bb.variable]:"sizes.4"},label:{fontSize:"md"},icon:{fontSize:"2xs"}}),lg:YO({control:{[Bb.variable]:"sizes.5"},label:{fontSize:"lg"},icon:{fontSize:"2xs"}})},bP=Qye({baseStyle:rSe,sizes:iSe,defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:oSe,definePartsStyle:XO}=Ri(nEe.keys),sSe=r=>{var t;const o=(t=Ka(bP.baseStyle,r))==null?void 0:t.control;return{...o,borderRadius:"full",_checked:{...o==null?void 0:o._checked,_before:{content:'""',display:"inline-block",pos:"relative",w:"50%",h:"50%",borderRadius:"50%",bg:"currentColor"}}}},aSe=XO(r=>{var t,o,a,l;return{label:(o=(t=bP).baseStyle)==null?void 0:o.call(t,r).label,container:(l=(a=bP).baseStyle)==null?void 0:l.call(a,r).container,control:sSe(r)}}),cSe={md:XO({control:{w:"4",h:"4"},label:{fontSize:"md"}}),lg:XO({control:{w:"5",h:"5"},label:{fontSize:"lg"}}),sm:XO({control:{width:"3",height:"3"},label:{fontSize:"sm"}})},lSe=oSe({baseStyle:aSe,sizes:cSe,defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:uSe,definePartsStyle:dSe}=Ri(rEe.keys),fO=Tn("select-bg"),c$,hSe={...(c$=qr.baseStyle)==null?void 0:c$.field,appearance:"none",paddingBottom:"1px",lineHeight:"normal",bg:fO.reference,[fO.variable]:"colors.white",_dark:{[fO.variable]:"colors.gray.700"},"> option, > optgroup":{bg:fO.reference}},fSe={width:"6",height:"100%",insetEnd:"2",position:"relative",color:"currentColor",fontSize:"xl",_disabled:{opacity:.5}},pSe=dSe({field:hSe,icon:fSe}),pO={paddingInlineEnd:"8"},l$,u$,d$,h$,f$,p$,m$,g$,mSe={lg:{...(l$=qr.sizes)==null?void 0:l$.lg,field:{...(u$=qr.sizes)==null?void 0:u$.lg.field,...pO}},md:{...(d$=qr.sizes)==null?void 0:d$.md,field:{...(h$=qr.sizes)==null?void 0:h$.md.field,...pO}},sm:{...(f$=qr.sizes)==null?void 0:f$.sm,field:{...(p$=qr.sizes)==null?void 0:p$.sm.field,...pO}},xs:{...(m$=qr.sizes)==null?void 0:m$.xs,field:{...(g$=qr.sizes)==null?void 0:g$.xs.field,...pO},icon:{insetEnd:"1"}}},gSe=uSe({baseStyle:pSe,sizes:mSe,variants:qr.variants,defaultProps:qr.defaultProps}),Yx=Tn("skeleton-start-color"),Xx=Tn("skeleton-end-color"),_Se={[Yx.variable]:"colors.gray.100",[Xx.variable]:"colors.gray.400",_dark:{[Yx.variable]:"colors.gray.800",[Xx.variable]:"colors.gray.600"},background:Yx.reference,borderColor:Xx.reference,opacity:.7,borderRadius:"sm"},vSe={baseStyle:_Se},Jx=Tn("skip-link-bg"),ESe={borderRadius:"md",fontWeight:"semibold",_focusVisible:{boxShadow:"outline",padding:"4",position:"fixed",top:"6",insetStart:"6",[Jx.variable]:"colors.white",_dark:{[Jx.variable]:"colors.gray.700"},bg:Jx.reference}},ySe={baseStyle:ESe},{defineMultiStyleConfig:SSe,definePartsStyle:pN}=Ri(iEe.keys),sw=Tn("slider-thumb-size"),aw=Tn("slider-track-size"),mm=Tn("slider-bg"),TSe=r=>{const{orientation:t}=r;return{display:"inline-block",position:"relative",cursor:"pointer",_disabled:{opacity:.6,cursor:"default",pointerEvents:"none"},...XU({orientation:t,vertical:{h:"100%"},horizontal:{w:"100%"}})}},bSe=r=>({...XU({orientation:r.orientation,horizontal:{h:aw.reference},vertical:{w:aw.reference}}),overflow:"hidden",borderRadius:"sm",[mm.variable]:"colors.gray.200",_dark:{[mm.variable]:"colors.whiteAlpha.200"},_disabled:{[mm.variable]:"colors.gray.300",_dark:{[mm.variable]:"colors.whiteAlpha.300"}},bg:mm.reference}),wSe=r=>{const{orientation:t}=r;return{...XU({orientation:t,vertical:{left:"50%",transform:"translateX(-50%)",_active:{transform:"translateX(-50%) scale(1.15)"}},horizontal:{top:"50%",transform:"translateY(-50%)",_active:{transform:"translateY(-50%) scale(1.15)"}}}),w:sw.reference,h:sw.reference,display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",outline:0,zIndex:1,borderRadius:"full",bg:"white",boxShadow:"base",border:"1px solid",borderColor:"transparent",transitionProperty:"transform",transitionDuration:"normal",_focusVisible:{boxShadow:"outline"},_disabled:{bg:"gray.300"}}},RSe=r=>{const{colorScheme:t}=r;return{width:"inherit",height:"inherit",[mm.variable]:`colors.${t}.500`,_dark:{[mm.variable]:`colors.${t}.200`},bg:mm.reference}},CSe=pN(r=>({container:TSe(r),track:bSe(r),thumb:wSe(r),filledTrack:RSe(r)})),ISe=pN({container:{[sw.variable]:"sizes.4",[aw.variable]:"sizes.1"}}),ASe=pN({container:{[sw.variable]:"sizes.3.5",[aw.variable]:"sizes.1"}}),OSe=pN({container:{[sw.variable]:"sizes.2.5",[aw.variable]:"sizes.0.5"}}),PSe={lg:ISe,md:ASe,sm:OSe},NSe=SSe({baseStyle:CSe,sizes:PSe,defaultProps:{size:"md",colorScheme:"blue"}}),P_=ts("spinner-size"),kSe={width:[P_.reference],height:[P_.reference]},DSe={xs:{[P_.variable]:"sizes.3"},sm:{[P_.variable]:"sizes.4"},md:{[P_.variable]:"sizes.6"},lg:{[P_.variable]:"sizes.8"},xl:{[P_.variable]:"sizes.12"}},LSe={baseStyle:kSe,sizes:DSe,defaultProps:{size:"md"}},{defineMultiStyleConfig:xSe,definePartsStyle:nJ}=Ri(oEe.keys),MSe={fontWeight:"medium"},USe={opacity:.8,marginBottom:"2"},VSe={verticalAlign:"baseline",fontWeight:"semibold"},FSe={marginEnd:1,w:"3.5",h:"3.5",verticalAlign:"middle"},jSe=nJ({container:{},label:MSe,helpText:USe,number:VSe,icon:FSe}),BSe={md:nJ({label:{fontSize:"sm"},helpText:{fontSize:"sm"},number:{fontSize:"2xl"}})},WSe=xSe({baseStyle:jSe,sizes:BSe,defaultProps:{size:"md"}}),Qx=Tn("kbd-bg"),GSe={[Qx.variable]:"colors.gray.100",_dark:{[Qx.variable]:"colors.whiteAlpha.100"},bg:Qx.reference,borderRadius:"md",borderWidth:"1px",borderBottomWidth:"3px",fontSize:"0.8em",fontWeight:"bold",lineHeight:"normal",px:"0.4em",whiteSpace:"nowrap"},zSe={baseStyle:GSe},HSe={transitionProperty:"common",transitionDuration:"fast",transitionTimingFunction:"ease-out",cursor:"pointer",textDecoration:"none",outline:"none",color:"inherit",_hover:{textDecoration:"underline"},_focusVisible:{boxShadow:"outline"}},KSe={baseStyle:HSe},{defineMultiStyleConfig:$Se,definePartsStyle:qSe}=Ri(Xve.keys),YSe={marginEnd:"2",display:"inline",verticalAlign:"text-bottom"},XSe=qSe({icon:YSe}),JSe=$Se({baseStyle:XSe}),{defineMultiStyleConfig:QSe,definePartsStyle:ZSe}=Ri(Jve.keys),th=Tn("menu-bg"),Zx=Tn("menu-shadow"),eTe={[th.variable]:"#fff",[Zx.variable]:"shadows.sm",_dark:{[th.variable]:"colors.gray.700",[Zx.variable]:"shadows.dark-lg"},color:"inherit",minW:"3xs",py:"2",zIndex:1,borderRadius:"md",borderWidth:"1px",bg:th.reference,boxShadow:Zx.reference},tTe={py:"1.5",px:"3",transitionProperty:"background",transitionDuration:"ultra-fast",transitionTimingFunction:"ease-in",_focus:{[th.variable]:"colors.gray.100",_dark:{[th.variable]:"colors.whiteAlpha.100"}},_active:{[th.variable]:"colors.gray.200",_dark:{[th.variable]:"colors.whiteAlpha.200"}},_expanded:{[th.variable]:"colors.gray.100",_dark:{[th.variable]:"colors.whiteAlpha.100"}},_disabled:{opacity:.4,cursor:"not-allowed"},bg:th.reference},nTe={mx:4,my:2,fontWeight:"semibold",fontSize:"sm"},rTe={display:"inline-flex",alignItems:"center",justifyContent:"center",flexShrink:0},iTe={opacity:.6},oTe={border:0,borderBottom:"1px solid",borderColor:"inherit",my:"2",opacity:.6},sTe={transitionProperty:"common",transitionDuration:"normal"},aTe=ZSe({button:sTe,list:eTe,item:tTe,groupTitle:nTe,icon:rTe,command:iTe,divider:oTe}),cTe=QSe({baseStyle:aTe}),{defineMultiStyleConfig:lTe,definePartsStyle:y2}=Ri(Qve.keys),eM=Tn("modal-bg"),tM=Tn("modal-shadow"),uTe={bg:"blackAlpha.600",zIndex:"modal"},dTe=r=>{const{isCentered:t,scrollBehavior:o}=r;return{display:"flex",zIndex:"modal",justifyContent:"center",alignItems:t?"center":"flex-start",overflow:o==="inside"?"hidden":"auto",overscrollBehaviorY:"none"}},hTe=r=>{const{isCentered:t,scrollBehavior:o}=r;return{borderRadius:"md",color:"inherit",my:t?"auto":"16",mx:t?"auto":void 0,zIndex:"modal",maxH:o==="inside"?"calc(100% - 7.5rem)":void 0,[eM.variable]:"colors.white",[tM.variable]:"shadows.lg",_dark:{[eM.variable]:"colors.gray.700",[tM.variable]:"shadows.dark-lg"},bg:eM.reference,boxShadow:tM.reference}},fTe={px:"6",py:"4",fontSize:"xl",fontWeight:"semibold"},pTe={position:"absolute",top:"2",insetEnd:"3"},mTe=r=>{const{scrollBehavior:t}=r;return{px:"6",py:"2",flex:"1",overflow:t==="inside"?"auto":void 0}},gTe={px:"6",py:"4"},_Te=y2(r=>({overlay:uTe,dialogContainer:Ka(dTe,r),dialog:Ka(hTe,r),header:fTe,closeButton:pTe,body:Ka(mTe,r),footer:gTe}));function Ju(r){return y2(r==="full"?{dialog:{maxW:"100vw",minH:"$100vh",my:"0",borderRadius:"0"}}:{dialog:{maxW:r}})}var vTe={xs:Ju("xs"),sm:Ju("sm"),md:Ju("md"),lg:Ju("lg"),xl:Ju("xl"),"2xl":Ju("2xl"),"3xl":Ju("3xl"),"4xl":Ju("4xl"),"5xl":Ju("5xl"),"6xl":Ju("6xl"),full:Ju("full")},ETe=lTe({baseStyle:_Te,sizes:vTe,defaultProps:{size:"md"}}),{defineMultiStyleConfig:yTe,definePartsStyle:rJ}=Ri(Zve.keys),QU=ts("number-input-stepper-width"),iJ=ts("number-input-input-padding"),STe=Df(QU).add("0.5rem").toString(),nM=ts("number-input-bg"),rM=ts("number-input-color"),iM=ts("number-input-border-color"),TTe={[QU.variable]:"sizes.6",[iJ.variable]:STe},bTe=r=>{var t,o;return(o=(t=Ka(qr.baseStyle,r))==null?void 0:t.field)!=null?o:{}},wTe={width:QU.reference},RTe={borderStart:"1px solid",borderStartColor:iM.reference,color:rM.reference,bg:nM.reference,[rM.variable]:"colors.chakra-body-text",[iM.variable]:"colors.chakra-border-color",_dark:{[rM.variable]:"colors.whiteAlpha.800",[iM.variable]:"colors.whiteAlpha.300"},_active:{[nM.variable]:"colors.gray.200",_dark:{[nM.variable]:"colors.whiteAlpha.300"}},_disabled:{opacity:.4,cursor:"not-allowed"}},CTe=rJ(r=>{var t;return{root:TTe,field:(t=Ka(bTe,r))!=null?t:{},stepperGroup:wTe,stepper:RTe}});function mO(r){var t,o,a;const l=(t=qr.sizes)==null?void 0:t[r],d={lg:"md",md:"md",sm:"sm",xs:"sm"},m=(a=(o=l.field)==null?void 0:o.fontSize)!=null?a:"md",v=JX.fontSizes[m];return rJ({field:{...l.field,paddingInlineEnd:iJ.reference,verticalAlign:"top"},stepper:{fontSize:Df(v).multiply(.75).toString(),_first:{borderTopEndRadius:d[r]},_last:{borderBottomEndRadius:d[r],mt:"-1px",borderTopWidth:1}}})}var ITe={xs:mO("xs"),sm:mO("sm"),md:mO("md"),lg:mO("lg")},ATe=yTe({baseStyle:CTe,sizes:ITe,variants:qr.variants,defaultProps:qr.defaultProps}),_$,OTe={...(_$=qr.baseStyle)==null?void 0:_$.field,textAlign:"center"},PTe={lg:{fontSize:"lg",w:12,h:12,borderRadius:"md"},md:{fontSize:"md",w:10,h:10,borderRadius:"md"},sm:{fontSize:"sm",w:8,h:8,borderRadius:"sm"},xs:{fontSize:"xs",w:6,h:6,borderRadius:"sm"}},v$,E$,NTe={outline:r=>{var t,o,a;return(a=(o=Ka((t=qr.variants)==null?void 0:t.outline,r))==null?void 0:o.field)!=null?a:{}},flushed:r=>{var t,o,a;return(a=(o=Ka((t=qr.variants)==null?void 0:t.flushed,r))==null?void 0:o.field)!=null?a:{}},filled:r=>{var t,o,a;return(a=(o=Ka((t=qr.variants)==null?void 0:t.filled,r))==null?void 0:o.field)!=null?a:{}},unstyled:(E$=(v$=qr.variants)==null?void 0:v$.unstyled.field)!=null?E$:{}},kTe={baseStyle:OTe,sizes:PTe,variants:NTe,defaultProps:qr.defaultProps},{defineMultiStyleConfig:DTe,definePartsStyle:LTe}=Ri(eEe.keys),gO=ts("popper-bg"),xTe=ts("popper-arrow-bg"),y$=ts("popper-arrow-shadow-color"),MTe={zIndex:10},UTe={[gO.variable]:"colors.white",bg:gO.reference,[xTe.variable]:gO.reference,[y$.variable]:"colors.gray.200",_dark:{[gO.variable]:"colors.gray.700",[y$.variable]:"colors.whiteAlpha.300"},width:"xs",border:"1px solid",borderColor:"inherit",borderRadius:"md",boxShadow:"sm",zIndex:"inherit",_focusVisible:{outline:0,boxShadow:"outline"}},VTe={px:3,py:2,borderBottomWidth:"1px"},FTe={px:3,py:2},jTe={px:3,py:2,borderTopWidth:"1px"},BTe={position:"absolute",borderRadius:"md",top:1,insetEnd:2,padding:2},WTe=LTe({popper:MTe,content:UTe,header:VTe,body:FTe,footer:jTe,closeButton:BTe}),GTe=DTe({baseStyle:WTe}),{definePartsStyle:S2,defineMultiStyleConfig:zTe}=Ri(Hve.keys),oM=Tn("drawer-bg"),sM=Tn("drawer-box-shadow");function py(r){return S2(r==="full"?{dialog:{maxW:"100vw",h:"100vh"}}:{dialog:{maxW:r}})}var HTe={bg:"blackAlpha.600",zIndex:"modal"},KTe={display:"flex",zIndex:"modal",justifyContent:"center"},$Te=r=>{const{isFullHeight:t}=r;return{...t&&{height:"100vh"},zIndex:"modal",maxH:"100vh",color:"inherit",[oM.variable]:"colors.white",[sM.variable]:"shadows.lg",_dark:{[oM.variable]:"colors.gray.700",[sM.variable]:"shadows.dark-lg"},bg:oM.reference,boxShadow:sM.reference}},qTe={px:"6",py:"4",fontSize:"xl",fontWeight:"semibold"},YTe={position:"absolute",top:"2",insetEnd:"3"},XTe={px:"6",py:"2",flex:"1",overflow:"auto"},JTe={px:"6",py:"4"},QTe=S2(r=>({overlay:HTe,dialogContainer:KTe,dialog:Ka($Te,r),header:qTe,closeButton:YTe,body:XTe,footer:JTe})),ZTe={xs:py("xs"),sm:py("md"),md:py("lg"),lg:py("2xl"),xl:py("4xl"),full:py("full")},e0e=zTe({baseStyle:QTe,sizes:ZTe,defaultProps:{size:"xs"}}),{definePartsStyle:t0e,defineMultiStyleConfig:n0e}=Ri(Kve.keys),r0e={borderRadius:"md",py:"1",transitionProperty:"common",transitionDuration:"normal"},i0e={borderRadius:"md",py:"1",transitionProperty:"common",transitionDuration:"normal",width:"full",_focusVisible:{boxShadow:"outline"},_placeholder:{opacity:.6}},o0e={borderRadius:"md",py:"1",transitionProperty:"common",transitionDuration:"normal",width:"full",_focusVisible:{boxShadow:"outline"},_placeholder:{opacity:.6}},s0e=t0e({preview:r0e,input:i0e,textarea:o0e}),a0e=n0e({baseStyle:s0e}),{definePartsStyle:c0e,defineMultiStyleConfig:l0e}=Ri($ve.keys),zy=Tn("form-control-color"),u0e={marginStart:"1",[zy.variable]:"colors.red.500",_dark:{[zy.variable]:"colors.red.300"},color:zy.reference},d0e={mt:"2",[zy.variable]:"colors.gray.600",_dark:{[zy.variable]:"colors.whiteAlpha.600"},color:zy.reference,lineHeight:"normal",fontSize:"sm"},h0e=c0e({container:{width:"100%",position:"relative"},requiredIndicator:u0e,helperText:d0e}),f0e=l0e({baseStyle:h0e}),{definePartsStyle:p0e,defineMultiStyleConfig:m0e}=Ri(qve.keys),Hy=Tn("form-error-color"),g0e={[Hy.variable]:"colors.red.500",_dark:{[Hy.variable]:"colors.red.300"},color:Hy.reference,mt:"2",fontSize:"sm",lineHeight:"normal"},_0e={marginEnd:"0.5em",[Hy.variable]:"colors.red.500",_dark:{[Hy.variable]:"colors.red.300"},color:Hy.reference},v0e=p0e({text:g0e,icon:_0e}),E0e=m0e({baseStyle:v0e}),y0e={fontSize:"md",marginEnd:"3",mb:"2",fontWeight:"medium",transitionProperty:"common",transitionDuration:"normal",opacity:1,_disabled:{opacity:.4}},S0e={baseStyle:y0e},T0e={fontFamily:"heading",fontWeight:"bold"},b0e={"4xl":{fontSize:["6xl",null,"7xl"],lineHeight:1},"3xl":{fontSize:["5xl",null,"6xl"],lineHeight:1},"2xl":{fontSize:["4xl",null,"5xl"],lineHeight:[1.2,null,1]},xl:{fontSize:["3xl",null,"4xl"],lineHeight:[1.33,null,1.2]},lg:{fontSize:["2xl",null,"3xl"],lineHeight:[1.33,null,1.2]},md:{fontSize:"xl",lineHeight:1.2},sm:{fontSize:"md",lineHeight:1.2},xs:{fontSize:"sm",lineHeight:1.2}},w0e={baseStyle:T0e,sizes:b0e,defaultProps:{size:"xl"}},{defineMultiStyleConfig:R0e,definePartsStyle:C0e}=Ri(Gve.keys),aM=Tn("breadcrumb-link-decor"),I0e={transitionProperty:"common",transitionDuration:"fast",transitionTimingFunction:"ease-out",outline:"none",color:"inherit",textDecoration:aM.reference,[aM.variable]:"none","&:not([aria-current=page])":{cursor:"pointer",_hover:{[aM.variable]:"underline"},_focusVisible:{boxShadow:"outline"}}},A0e=C0e({link:I0e}),O0e=R0e({baseStyle:A0e}),P0e={lineHeight:"1.2",borderRadius:"md",fontWeight:"semibold",transitionProperty:"common",transitionDuration:"normal",_focusVisible:{boxShadow:"outline"},_disabled:{opacity:.4,cursor:"not-allowed",boxShadow:"none"},_hover:{_disabled:{bg:"initial"}}},oJ=r=>{const{colorScheme:t,theme:o}=r;if(t==="gray")return{color:Sn("gray.800","whiteAlpha.900")(r),_hover:{bg:Sn("gray.100","whiteAlpha.200")(r)},_active:{bg:Sn("gray.200","whiteAlpha.300")(r)}};const a=iS(`${t}.200`,.12)(o),l=iS(`${t}.200`,.24)(o);return{color:Sn(`${t}.600`,`${t}.200`)(r),bg:"transparent",_hover:{bg:Sn(`${t}.50`,a)(r)},_active:{bg:Sn(`${t}.100`,l)(r)}}},N0e=r=>{const{colorScheme:t}=r,o=Sn("gray.200","whiteAlpha.300")(r);return{border:"1px solid",borderColor:t==="gray"?o:"currentColor",".chakra-button__group[data-attached][data-orientation=horizontal] > &:not(:last-of-type)":{marginEnd:"-1px"},".chakra-button__group[data-attached][data-orientation=vertical] > &:not(:last-of-type)":{marginBottom:"-1px"},...Ka(oJ,r)}},k0e={yellow:{bg:"yellow.400",color:"black",hoverBg:"yellow.500",activeBg:"yellow.600"},cyan:{bg:"cyan.400",color:"black",hoverBg:"cyan.500",activeBg:"cyan.600"}},D0e=r=>{var t;const{colorScheme:o}=r;if(o==="gray"){const y=Sn("gray.100","whiteAlpha.200")(r);return{bg:y,color:Sn("gray.800","whiteAlpha.900")(r),_hover:{bg:Sn("gray.200","whiteAlpha.300")(r),_disabled:{bg:y}},_active:{bg:Sn("gray.300","whiteAlpha.400")(r)}}}const{bg:a=`${o}.500`,color:l="white",hoverBg:d=`${o}.600`,activeBg:m=`${o}.700`}=(t=k0e[o])!=null?t:{},v=Sn(a,`${o}.200`)(r);return{bg:v,color:Sn(l,"gray.800")(r),_hover:{bg:Sn(d,`${o}.300`)(r),_disabled:{bg:v}},_active:{bg:Sn(m,`${o}.400`)(r)}}},L0e=r=>{const{colorScheme:t}=r;return{padding:0,height:"auto",lineHeight:"normal",verticalAlign:"baseline",color:Sn(`${t}.500`,`${t}.200`)(r),_hover:{textDecoration:"underline",_disabled:{textDecoration:"none"}},_active:{color:Sn(`${t}.700`,`${t}.500`)(r)}}},x0e={bg:"none",color:"inherit",display:"inline",lineHeight:"inherit",m:"0",p:"0"},M0e={ghost:oJ,outline:N0e,solid:D0e,link:L0e,unstyled:x0e},U0e={lg:{h:"12",minW:"12",fontSize:"lg",px:"6"},md:{h:"10",minW:"10",fontSize:"md",px:"4"},sm:{h:"8",minW:"8",fontSize:"sm",px:"3"},xs:{h:"6",minW:"6",fontSize:"xs",px:"2"}},V0e={baseStyle:P0e,variants:M0e,sizes:U0e,defaultProps:{variant:"solid",size:"md",colorScheme:"gray"}},{definePartsStyle:V_,defineMultiStyleConfig:F0e}=Ri(uEe.keys),wP=Tn("card-bg"),jf=Tn("card-padding"),sJ=Tn("card-shadow"),JO=Tn("card-radius"),aJ=Tn("card-border-width","0"),cJ=Tn("card-border-color"),j0e=V_({container:{[wP.variable]:"colors.chakra-body-bg",backgroundColor:wP.reference,boxShadow:sJ.reference,borderRadius:JO.reference,color:"chakra-body-text",borderWidth:aJ.reference,borderColor:cJ.reference},body:{padding:jf.reference,flex:"1 1 0%"},header:{padding:jf.reference},footer:{padding:jf.reference}}),B0e={sm:V_({container:{[JO.variable]:"radii.base",[jf.variable]:"space.3"}}),md:V_({container:{[JO.variable]:"radii.md",[jf.variable]:"space.5"}}),lg:V_({container:{[JO.variable]:"radii.xl",[jf.variable]:"space.7"}})},W0e={elevated:V_({container:{[sJ.variable]:"shadows.base",_dark:{[wP.variable]:"colors.gray.700"}}}),outline:V_({container:{[aJ.variable]:"1px",[cJ.variable]:"colors.chakra-border-color"}}),filled:V_({container:{[wP.variable]:"colors.chakra-subtle-bg"}}),unstyled:{body:{[jf.variable]:0},header:{[jf.variable]:0},footer:{[jf.variable]:0}}},G0e=F0e({baseStyle:j0e,variants:W0e,sizes:B0e,defaultProps:{variant:"elevated",size:"md"}}),Wb=ts("close-button-size"),rb=ts("close-button-bg"),z0e={w:[Wb.reference],h:[Wb.reference],borderRadius:"md",transitionProperty:"common",transitionDuration:"normal",_disabled:{opacity:.4,cursor:"not-allowed",boxShadow:"none"},_hover:{[rb.variable]:"colors.blackAlpha.100",_dark:{[rb.variable]:"colors.whiteAlpha.100"}},_active:{[rb.variable]:"colors.blackAlpha.200",_dark:{[rb.variable]:"colors.whiteAlpha.200"}},_focusVisible:{boxShadow:"outline"},bg:rb.reference},H0e={lg:{[Wb.variable]:"sizes.10",fontSize:"md"},md:{[Wb.variable]:"sizes.8",fontSize:"xs"},sm:{[Wb.variable]:"sizes.6",fontSize:"2xs"}},K0e={baseStyle:z0e,sizes:H0e,defaultProps:{size:"md"}},{variants:$0e,defaultProps:q0e}=jb,Y0e={fontFamily:"mono",fontSize:"sm",px:"0.2em",borderRadius:"sm",bg:Oo.bg.reference,color:Oo.color.reference,boxShadow:Oo.shadow.reference},X0e={baseStyle:Y0e,variants:$0e,defaultProps:q0e},J0e={w:"100%",mx:"auto",maxW:"prose",px:"4"},Q0e={baseStyle:J0e},Z0e={opacity:.6,borderColor:"inherit"},ebe={borderStyle:"solid"},tbe={borderStyle:"dashed"},nbe={solid:ebe,dashed:tbe},rbe={baseStyle:Z0e,variants:nbe,defaultProps:{variant:"solid"}},{definePartsStyle:ibe,defineMultiStyleConfig:obe}=Ri(jve.keys),sbe={borderTopWidth:"1px",borderColor:"inherit",_last:{borderBottomWidth:"1px"}},abe={transitionProperty:"common",transitionDuration:"normal",fontSize:"md",_focusVisible:{boxShadow:"outline"},_hover:{bg:"blackAlpha.50"},_disabled:{opacity:.4,cursor:"not-allowed"},px:"4",py:"2"},cbe={pt:"2",px:"4",pb:"5"},lbe={fontSize:"1.25em"},ube=ibe({container:sbe,button:abe,panel:cbe,icon:lbe}),dbe=obe({baseStyle:ube}),{definePartsStyle:Uw,defineMultiStyleConfig:hbe}=Ri(Bve.keys),pl=Tn("alert-fg"),Kf=Tn("alert-bg"),fbe=Uw({container:{bg:Kf.reference,px:"4",py:"3"},title:{fontWeight:"bold",lineHeight:"6",marginEnd:"2"},description:{lineHeight:"6"},icon:{color:pl.reference,flexShrink:0,marginEnd:"3",w:"5",h:"6"},spinner:{color:pl.reference,flexShrink:0,marginEnd:"3",w:"5",h:"5"}});function ZU(r){const{theme:t,colorScheme:o}=r,a=iS(`${o}.200`,.16)(t);return{light:`colors.${o}.100`,dark:a}}var pbe=Uw(r=>{const{colorScheme:t}=r,o=ZU(r);return{container:{[pl.variable]:`colors.${t}.600`,[Kf.variable]:o.light,_dark:{[pl.variable]:`colors.${t}.200`,[Kf.variable]:o.dark}}}}),mbe=Uw(r=>{const{colorScheme:t}=r,o=ZU(r);return{container:{[pl.variable]:`colors.${t}.600`,[Kf.variable]:o.light,_dark:{[pl.variable]:`colors.${t}.200`,[Kf.variable]:o.dark},paddingStart:"3",borderStartWidth:"4px",borderStartColor:pl.reference}}}),gbe=Uw(r=>{const{colorScheme:t}=r,o=ZU(r);return{container:{[pl.variable]:`colors.${t}.600`,[Kf.variable]:o.light,_dark:{[pl.variable]:`colors.${t}.200`,[Kf.variable]:o.dark},pt:"2",borderTopWidth:"4px",borderTopColor:pl.reference}}}),_be=Uw(r=>{const{colorScheme:t}=r;return{container:{[pl.variable]:"colors.white",[Kf.variable]:`colors.${t}.600`,_dark:{[pl.variable]:"colors.gray.900",[Kf.variable]:`colors.${t}.200`},color:pl.reference}}}),vbe={subtle:pbe,"left-accent":mbe,"top-accent":gbe,solid:_be},Ebe=hbe({baseStyle:fbe,variants:vbe,defaultProps:{variant:"subtle",colorScheme:"blue"}}),{definePartsStyle:lJ,defineMultiStyleConfig:ybe}=Ri(Wve.keys),Ky=Tn("avatar-border-color"),Gb=Tn("avatar-bg"),cw=Tn("avatar-font-size"),oS=Tn("avatar-size"),Sbe={borderRadius:"full",border:"0.2em solid",borderColor:Ky.reference,[Ky.variable]:"white",_dark:{[Ky.variable]:"colors.gray.800"}},Tbe={bg:Gb.reference,fontSize:cw.reference,width:oS.reference,height:oS.reference,lineHeight:"1",[Gb.variable]:"colors.gray.200",_dark:{[Gb.variable]:"colors.whiteAlpha.400"}},bbe=r=>{const{name:t,theme:o}=r,a=t?PEe({string:t}):"colors.gray.400",l=AEe(a)(o);let d="white";return l||(d="gray.800"),{bg:Gb.reference,fontSize:cw.reference,color:d,borderColor:Ky.reference,verticalAlign:"top",width:oS.reference,height:oS.reference,"&:not([data-loaded])":{[Gb.variable]:a},[Ky.variable]:"colors.white",_dark:{[Ky.variable]:"colors.gray.800"}}},wbe={fontSize:cw.reference,lineHeight:"1"},Rbe=lJ(r=>({badge:Ka(Sbe,r),excessLabel:Ka(Tbe,r),container:Ka(bbe,r),label:wbe}));function um(r){const t=r!=="100%"?ZX[r]:void 0;return lJ({container:{[oS.variable]:t??r,[cw.variable]:`calc(${t??r} / 2.5)`},excessLabel:{[oS.variable]:t??r,[cw.variable]:`calc(${t??r} / 2.5)`}})}var Cbe={"2xs":um(4),xs:um(6),sm:um(8),md:um(12),lg:um(16),xl:um(24),"2xl":um(32),full:um("100%")},Ibe=ybe({baseStyle:Rbe,sizes:Cbe,defaultProps:{size:"md"}}),Abe={Accordion:dbe,Alert:Ebe,Avatar:Ibe,Badge:jb,Breadcrumb:O0e,Button:V0e,Checkbox:bP,CloseButton:K0e,Code:X0e,Container:Q0e,Divider:rbe,Drawer:e0e,Editable:a0e,Form:f0e,FormError:E0e,FormLabel:S0e,Heading:w0e,Input:qr,Kbd:zSe,Link:KSe,List:JSe,Menu:cTe,Modal:ETe,NumberInput:ATe,PinInput:kTe,Popover:GTe,Progress:Xye,Radio:lSe,Select:gSe,Skeleton:vSe,SkipLink:ySe,Slider:NSe,Spinner:LSe,Stat:WSe,Switch:KEe,Table:ZEe,Tabs:pye,Tag:Iye,Textarea:Fye,Tooltip:Wye,Card:G0e,Stepper:Fve},Obe={colors:{"chakra-body-text":{_light:"gray.800",_dark:"whiteAlpha.900"},"chakra-body-bg":{_light:"white",_dark:"gray.800"},"chakra-border-color":{_light:"gray.200",_dark:"whiteAlpha.300"},"chakra-inverse-text":{_light:"white",_dark:"gray.800"},"chakra-subtle-bg":{_light:"gray.100",_dark:"gray.700"},"chakra-subtle-text":{_light:"gray.600",_dark:"gray.400"},"chakra-placeholder-color":{_light:"gray.500",_dark:"whiteAlpha.400"}}},Pbe={global:{body:{fontFamily:"body",color:"chakra-body-text",bg:"chakra-body-bg",transitionProperty:"background-color",transitionDuration:"normal",lineHeight:"base"},"*::placeholder":{color:"chakra-placeholder-color"},"*, *::before, &::after":{borderColor:"chakra-border-color"}}},Nbe="ltr",kbe={useSystemColorMode:!1,initialColorMode:"light",cssVarPrefix:"chakra"},Dbe={semanticTokens:Obe,direction:Nbe,...Mve,components:Abe,styles:Pbe,config:kbe};function Lbe(){return!!(typeof window<"u"&&window.document&&window.document.createElement)}var xbe=Lbe();function Mbe(r,t){const o={};return Object.keys(r).forEach(a=>{t.includes(a)||(o[a]=r[a])}),o}function Ube(r,t,o,a){const l=typeof t=="string"?t.split("."):[t];for(a=0;a<l.length&&r;a+=1)r=r[l[a]];return r===void 0?o:r}var Vbe=r=>{const t=new WeakMap;return(a,l,d,m)=>{if(typeof a>"u")return r(a,l,d);t.has(a)||t.set(a,new Map);const v=t.get(a);if(v.has(l))return v.get(l);const y=r(a,l,d,m);return v.set(l,y),y}},uJ=Vbe(Ube);function dJ(r,t){const o={};return Object.keys(r).forEach(a=>{const l=r[a];t(l,a,r)&&(o[a]=l)}),o}var hJ=r=>dJ(r,t=>t!=null);function Fbe(r){return typeof r=="function"}function fJ(r,...t){return Fbe(r)?r(...t):r}function jbe(...r){return function(o){r.some(a=>(a==null||a(o),o==null?void 0:o.defaultPrevented))}}const pJ=1/60*1e3,Bbe=typeof performance<"u"?()=>performance.now():()=>Date.now(),mJ=typeof window<"u"?r=>window.requestAnimationFrame(r):r=>setTimeout(()=>r(Bbe()),pJ);function Wbe(r){let t=[],o=[],a=0,l=!1,d=!1;const m=new WeakSet,v={schedule:(y,b=!1,R=!1)=>{const O=R&&l,N=O?t:o;return b&&m.add(y),N.indexOf(y)===-1&&(N.push(y),O&&l&&(a=t.length)),y},cancel:y=>{const b=o.indexOf(y);b!==-1&&o.splice(b,1),m.delete(y)},process:y=>{if(l){d=!0;return}if(l=!0,[t,o]=[o,t],o.length=0,a=t.length,a)for(let b=0;b<a;b++){const R=t[b];R(y),m.has(R)&&(v.schedule(R),r())}l=!1,d&&(d=!1,v.process(y))}};return v}const Gbe=40;let T2=!0,lw=!1,b2=!1;const $y={delta:0,timestamp:0},Vw=["read","update","preRender","render","postRender"],mN=Vw.reduce((r,t)=>(r[t]=Wbe(()=>lw=!0),r),{}),zbe=Vw.reduce((r,t)=>{const o=mN[t];return r[t]=(a,l=!1,d=!1)=>(lw||$be(),o.schedule(a,l,d)),r},{}),Hbe=Vw.reduce((r,t)=>(r[t]=mN[t].cancel,r),{});Vw.reduce((r,t)=>(r[t]=()=>mN[t].process($y),r),{});const Kbe=r=>mN[r].process($y),gJ=r=>{lw=!1,$y.delta=T2?pJ:Math.max(Math.min(r-$y.timestamp,Gbe),1),$y.timestamp=r,b2=!0,Vw.forEach(Kbe),b2=!1,lw&&(T2=!1,mJ(gJ))},$be=()=>{lw=!0,T2=!0,b2||mJ(gJ)},S$=()=>$y;var cM,T$;function qbe(){if(T$)return cM;T$=1;var r=typeof Element<"u",t=typeof Map=="function",o=typeof Set=="function",a=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function l(d,m){if(d===m)return!0;if(d&&m&&typeof d=="object"&&typeof m=="object"){if(d.constructor!==m.constructor)return!1;var v,y,b;if(Array.isArray(d)){if(v=d.length,v!=m.length)return!1;for(y=v;y--!==0;)if(!l(d[y],m[y]))return!1;return!0}var R;if(t&&d instanceof Map&&m instanceof Map){if(d.size!==m.size)return!1;for(R=d.entries();!(y=R.next()).done;)if(!m.has(y.value[0]))return!1;for(R=d.entries();!(y=R.next()).done;)if(!l(y.value[1],m.get(y.value[0])))return!1;return!0}if(o&&d instanceof Set&&m instanceof Set){if(d.size!==m.size)return!1;for(R=d.entries();!(y=R.next()).done;)if(!m.has(y.value[0]))return!1;return!0}if(a&&ArrayBuffer.isView(d)&&ArrayBuffer.isView(m)){if(v=d.length,v!=m.length)return!1;for(y=v;y--!==0;)if(d[y]!==m[y])return!1;return!0}if(d.constructor===RegExp)return d.source===m.source&&d.flags===m.flags;if(d.valueOf!==Object.prototype.valueOf&&typeof d.valueOf=="function"&&typeof m.valueOf=="function")return d.valueOf()===m.valueOf();if(d.toString!==Object.prototype.toString&&typeof d.toString=="function"&&typeof m.toString=="function")return d.toString()===m.toString();if(b=Object.keys(d),v=b.length,v!==Object.keys(m).length)return!1;for(y=v;y--!==0;)if(!Object.prototype.hasOwnProperty.call(m,b[y]))return!1;if(r&&d instanceof Element)return!1;for(y=v;y--!==0;)if(!((b[y]==="_owner"||b[y]==="__v"||b[y]==="__o")&&d.$$typeof)&&!l(d[b[y]],m[b[y]]))return!1;return!0}return d!==d&&m!==m}return cM=function(m,v){try{return l(m,v)}catch(y){if((y.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw y}},cM}var Ybe=qbe();const Xbe=TS(Ybe);function _J(r,t={}){var o;const{styleConfig:a,...l}=t,{theme:d,colorMode:m}=WX(),v=r?uJ(d,`components.${r}`):void 0,y=a||v,b=sh({theme:d,colorMode:m},(o=y==null?void 0:y.defaultProps)!=null?o:{},hJ(Mbe(l,["children"]))),R=V.useRef({});if(y){const N=dve(y)(b);Xbe(R.current,N)||(R.current=N)}return R.current}function cu(r,t={}){return _J(r,t)}function xc(r,t={}){return _J(r,t)}var Jbe=new Set([...Z_e,"textStyle","layerStyle","apply","noOfLines","focusBorderColor","errorBorderColor","as","__css","css","sx"]),Qbe=new Set(["htmlWidth","htmlHeight","htmlSize","htmlTranslate"]);function Zbe(r){return Qbe.has(r)||!Jbe.has(r)}function ewe(r,...t){if(r==null)throw new TypeError("Cannot convert undefined or null to object");const o={...r};for(const a of t)if(a!=null)for(const l in a)Object.prototype.hasOwnProperty.call(a,l)&&(l in o&&delete o[l],o[l]=a[l]);return o}function vJ(r){const t=Object.assign({},r);for(let o in t)t[o]===void 0&&delete t[o];return t}var twe=/^((children|dangerouslySetInnerHTML|key|ref|autoFocus|defaultValue|defaultChecked|innerHTML|suppressContentEditableWarning|suppressHydrationWarning|valueLink|abbr|accept|acceptCharset|accessKey|action|allow|allowUserMedia|allowPaymentRequest|allowFullScreen|allowTransparency|alt|async|autoComplete|autoPlay|capture|cellPadding|cellSpacing|challenge|charSet|checked|cite|classID|className|cols|colSpan|content|contentEditable|contextMenu|controls|controlsList|coords|crossOrigin|data|dateTime|decoding|default|defer|dir|disabled|disablePictureInPicture|disableRemotePlayback|download|draggable|encType|enterKeyHint|form|formAction|formEncType|formMethod|formNoValidate|formTarget|frameBorder|headers|height|hidden|high|href|hrefLang|htmlFor|httpEquiv|id|inputMode|integrity|is|keyParams|keyType|kind|label|lang|list|loading|loop|low|marginHeight|marginWidth|max|maxLength|media|mediaGroup|method|min|minLength|multiple|muted|name|nonce|noValidate|open|optimum|pattern|placeholder|playsInline|poster|preload|profile|radioGroup|readOnly|referrerPolicy|rel|required|reversed|role|rows|rowSpan|sandbox|scope|scoped|scrolling|seamless|selected|shape|size|sizes|slot|span|spellCheck|src|srcDoc|srcLang|srcSet|start|step|style|summary|tabIndex|target|title|translate|type|useMap|value|width|wmode|wrap|about|datatype|inlist|prefix|property|resource|typeof|vocab|autoCapitalize|autoCorrect|autoSave|color|incremental|fallback|inert|itemProp|itemScope|itemType|itemID|itemRef|on|option|results|security|unselectable|accentHeight|accumulate|additive|alignmentBaseline|allowReorder|alphabetic|amplitude|arabicForm|ascent|attributeName|attributeType|autoReverse|azimuth|baseFrequency|baselineShift|baseProfile|bbox|begin|bias|by|calcMode|capHeight|clip|clipPathUnits|clipPath|clipRule|colorInterpolation|colorInterpolationFilters|colorProfile|colorRendering|contentScriptType|contentStyleType|cursor|cx|cy|d|decelerate|descent|diffuseConstant|direction|display|divisor|dominantBaseline|dur|dx|dy|edgeMode|elevation|enableBackground|end|exponent|externalResourcesRequired|fill|fillOpacity|fillRule|filter|filterRes|filterUnits|floodColor|floodOpacity|focusable|fontFamily|fontSize|fontSizeAdjust|fontStretch|fontStyle|fontVariant|fontWeight|format|from|fr|fx|fy|g1|g2|glyphName|glyphOrientationHorizontal|glyphOrientationVertical|glyphRef|gradientTransform|gradientUnits|hanging|horizAdvX|horizOriginX|ideographic|imageRendering|in|in2|intercept|k|k1|k2|k3|k4|kernelMatrix|kernelUnitLength|kerning|keyPoints|keySplines|keyTimes|lengthAdjust|letterSpacing|lightingColor|limitingConeAngle|local|markerEnd|markerMid|markerStart|markerHeight|markerUnits|markerWidth|mask|maskContentUnits|maskUnits|mathematical|mode|numOctaves|offset|opacity|operator|order|orient|orientation|origin|overflow|overlinePosition|overlineThickness|panose1|paintOrder|pathLength|patternContentUnits|patternTransform|patternUnits|pointerEvents|points|pointsAtX|pointsAtY|pointsAtZ|preserveAlpha|preserveAspectRatio|primitiveUnits|r|radius|refX|refY|renderingIntent|repeatCount|repeatDur|requiredExtensions|requiredFeatures|restart|result|rotate|rx|ry|scale|seed|shapeRendering|slope|spacing|specularConstant|specularExponent|speed|spreadMethod|startOffset|stdDeviation|stemh|stemv|stitchTiles|stopColor|stopOpacity|strikethroughPosition|strikethroughThickness|string|stroke|strokeDasharray|strokeDashoffset|strokeLinecap|strokeLinejoin|strokeMiterlimit|strokeOpacity|strokeWidth|surfaceScale|systemLanguage|tableValues|targetX|targetY|textAnchor|textDecoration|textRendering|textLength|to|transform|u1|u2|underlinePosition|underlineThickness|unicode|unicodeBidi|unicodeRange|unitsPerEm|vAlphabetic|vHanging|vIdeographic|vMathematical|values|vectorEffect|version|vertAdvY|vertOriginX|vertOriginY|viewBox|viewTarget|visibility|widths|wordSpacing|writingMode|x|xHeight|x1|x2|xChannelSelector|xlinkActuate|xlinkArcrole|xlinkHref|xlinkRole|xlinkShow|xlinkTitle|xlinkType|xmlBase|xmlns|xmlnsXlink|xmlLang|xmlSpace|y|y1|y2|yChannelSelector|z|zoomAndPan|for|class|autofocus)|(([Dd][Aa][Tt][Aa]|[Aa][Rr][Ii][Aa]|x)-.*))$/,nwe=OX(function(r){return twe.test(r)||r.charCodeAt(0)===111&&r.charCodeAt(1)===110&&r.charCodeAt(2)<91}),rwe=nwe,iwe=function(t){return t!=="theme"},b$=function(t){return typeof t=="string"&&t.charCodeAt(0)>96?rwe:iwe},w$=function(t,o,a){var l;if(o){var d=o.shouldForwardProp;l=t.__emotion_forwardProp&&d?function(m){return t.__emotion_forwardProp(m)&&d(m)}:d}return typeof l!="function"&&a&&(l=t.__emotion_forwardProp),l},owe=function(t){var o=t.cache,a=t.serialized,l=t.isStringTag;return NX(o,a,l),Rge(function(){return kX(o,a,l)}),null},swe=function r(t,o){var a=t.__emotion_real===t,l=a&&t.__emotion_base||t,d,m;o!==void 0&&(d=o.label,m=o.target);var v=w$(t,o,a),y=v||b$(l),b=!y("as");return function(){var R=arguments,O=a&&t.__emotion_styles!==void 0?t.__emotion_styles.slice(0):[];if(d!==void 0&&O.push("label:"+d+";"),R[0]==null||R[0].raw===void 0)O.push.apply(O,R);else{O.push(R[0][0]);for(var N=R.length,F=1;F<N;F++)O.push(R[F],R[0][F])}var H=MX(function(G,z,ne){var J=b&&G.as||l,oe="",se=[],ae=G;if(G.theme==null){ae={};for(var ye in G)ae[ye]=G[ye];ae.theme=V.useContext(iw)}typeof G.className=="string"?oe=vge(z.registered,se,G.className):G.className!=null&&(oe=G.className+" ");var Q=WU(O.concat(se),z.registered,ae);oe+=z.key+"-"+Q.name,m!==void 0&&(oe+=" "+m);var te=b&&v===void 0?b$(J):y,re={};for(var le in G)b&&le==="as"||te(le)&&(re[le]=G[le]);return re.className=oe,re.ref=ne,V.createElement(V.Fragment,null,V.createElement(owe,{cache:z,serialized:Q,isStringTag:typeof J=="string"}),V.createElement(J,re))});return H.displayName=d!==void 0?d:"Styled("+(typeof l=="string"?l:l.displayName||l.name||"Component")+")",H.defaultProps=t.defaultProps,H.__emotion_real=H,H.__emotion_base=l,H.__emotion_styles=O,H.__emotion_forwardProp=v,Object.defineProperty(H,"toString",{value:function(){return"."+m}}),H.withComponent=function(G,z){return r(G,K_({},o,z,{shouldForwardProp:w$(H,z,!0)})).apply(void 0,O)},H}},awe=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","marquee","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"],RP=swe.bind();awe.forEach(function(r){RP[r]=RP(r)});var R$,cwe=(R$=RP.default)!=null?R$:RP,lwe=({baseStyle:r})=>t=>{const{theme:o,css:a,__css:l,sx:d,...m}=t,v=dJ(m,(O,N)=>tve(N)),y=fJ(r,t),b=ewe({},l,y,hJ(v),d),R=XX(b)(t.theme);return a?[R,a]:R};function lM(r,t){const{baseStyle:o,...a}=t??{};a.shouldForwardProp||(a.shouldForwardProp=Zbe);const l=lwe({baseStyle:o}),d=cwe(r,a)(l);return Gi.forwardRef(function(y,b){const{colorMode:R,forced:O}=uN();return Gi.createElement(d,{ref:b,"data-theme":O?R:void 0,...y})})}function uwe(){const r=new Map;return new Proxy(lM,{apply(t,o,a){return lM(...a)},get(t,o){return r.has(o)||r.set(o,lM(o)),r.get(o)}})}var Pt=uwe();function zt(r){return V.forwardRef(r)}function dwe(r={}){const{strict:t=!0,errorMessage:o="useContext: `context` is undefined. Seems you forgot to wrap component within the Provider",name:a}=r,l=V.createContext(void 0);l.displayName=a;function d(){var m;const v=V.useContext(l);if(!v&&t){const y=new Error(o);throw y.name="ContextError",(m=Error.captureStackTrace)==null||m.call(Error,y,d),y}return v}return[l.Provider,d,l]}function hwe(r){const{cssVarsRoot:t,theme:o,children:a}=r,l=V.useMemo(()=>X_e(o),[o]);return D.jsxs(Age,{theme:l,children:[D.jsx(fwe,{root:t}),a]})}function fwe({root:r=":host, :root"}){const t=[r,"[data-theme]"].join(",");return D.jsx(lN,{styles:o=>({[t]:o.__cssVars})})}dwe({name:"StylesContext",errorMessage:"useStyles: `styles` is undefined. Seems you forgot to wrap the components in `<StylesProvider />` "});function pwe(){const{colorMode:r}=uN();return D.jsx(lN,{styles:t=>{const o=uJ(t,"styles.global"),a=fJ(o,{theme:t,colorMode:r});return a?XX(a)(t):void 0}})}var EJ=V.createContext({getDocument(){return document},getWindow(){return window}});EJ.displayName="EnvironmentContext";function yJ(r){const{children:t,environment:o,disabled:a}=r,l=V.useRef(null),d=V.useMemo(()=>o||{getDocument:()=>{var v,y;return(y=(v=l.current)==null?void 0:v.ownerDocument)!=null?y:document},getWindow:()=>{var v,y;return(y=(v=l.current)==null?void 0:v.ownerDocument.defaultView)!=null?y:window}},[o]),m=!a||!o;return D.jsxs(EJ.Provider,{value:d,children:[t,m&&D.jsx("span",{id:"__chakra_env",hidden:!0,ref:l})]})}yJ.displayName="EnvironmentProvider";var mwe=r=>{const{children:t,colorModeManager:o,portalZIndex:a,resetScope:l,resetCSS:d=!0,theme:m={},environment:v,cssVarsRoot:y,disableEnvironment:b,disableGlobalStyle:R}=r,O=D.jsx(yJ,{environment:v,disabled:b,children:t});return D.jsx(hwe,{theme:m,cssVarsRoot:y,children:D.jsxs(BX,{colorModeManager:o,options:m.config,children:[d?D.jsx(Nge,{scope:l}):D.jsx(Pge,{}),!R&&D.jsx(pwe,{}),a?D.jsx(GU,{zIndex:a,children:O}):O]})})},gwe=(r,t)=>r.find(o=>o.id===t);function C$(r,t){const o=SJ(r,t),a=o?r[o].findIndex(l=>l.id===t):-1;return{position:o,index:a}}function SJ(r,t){for(const[o,a]of Object.entries(r))if(gwe(a,t))return o}function _we(r){const t=r.includes("right"),o=r.includes("left");let a="center";return t&&(a="flex-end"),o&&(a="flex-start"),{display:"flex",flexDirection:"column",alignItems:a}}function vwe(r){const o=r==="top"||r==="bottom"?"0 auto":void 0,a=r.includes("top")?"env(safe-area-inset-top, 0px)":void 0,l=r.includes("bottom")?"env(safe-area-inset-bottom, 0px)":void 0,d=r.includes("left")?void 0:"env(safe-area-inset-right, 0px)",m=r.includes("right")?void 0:"env(safe-area-inset-left, 0px)";return{position:"fixed",zIndex:"var(--toast-z-index, 5500)",pointerEvents:"none",display:"flex",flexDirection:"column",margin:o,top:a,bottom:l,right:d,left:m}}function Pc(r,t=[]){const o=V.useRef(r);return V.useEffect(()=>{o.current=r}),V.useCallback((...a)=>{var l;return(l=o.current)==null?void 0:l.call(o,...a)},t)}function Ewe(r,t){const o=Pc(r);V.useEffect(()=>{if(t==null)return;let a=null;return a=window.setTimeout(()=>{o()},t),()=>{a&&window.clearTimeout(a)}},[t,o])}function Am(r,t){const o=V.useRef(!1),a=V.useRef(!1);V.useEffect(()=>{if(o.current&&a.current)return r();a.current=!0},t),V.useEffect(()=>(o.current=!0,()=>{o.current=!1}),[])}const eV=V.createContext({transformPagePoint:r=>r,isStatic:!1,reducedMotion:"never"}),gN=V.createContext({}),Fw=V.createContext(null),tV=typeof document<"u",nV=tV?V.useLayoutEffect:V.useEffect,TJ=V.createContext({strict:!1}),rV=r=>r.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),ywe="framerAppearId",bJ="data-"+rV(ywe),Swe={useManualTiming:!1};class I${constructor(){this.order=[],this.scheduled=new Set}add(t){if(!this.scheduled.has(t))return this.scheduled.add(t),this.order.push(t),!0}remove(t){const o=this.order.indexOf(t);o!==-1&&(this.order.splice(o,1),this.scheduled.delete(t))}clear(){this.order.length=0,this.scheduled.clear()}}function Twe(r){let t=new I$,o=new I$,a=0,l=!1,d=!1;const m=new WeakSet,v={schedule:(y,b=!1,R=!1)=>{const O=R&&l,N=O?t:o;return b&&m.add(y),N.add(y)&&O&&l&&(a=t.order.length),y},cancel:y=>{o.remove(y),m.delete(y)},process:y=>{if(l){d=!0;return}if(l=!0,[t,o]=[o,t],o.clear(),a=t.order.length,a)for(let b=0;b<a;b++){const R=t.order[b];m.has(R)&&(v.schedule(R),r()),R(y)}l=!1,d&&(d=!1,v.process(y))}};return v}const _O=["read","resolveKeyframes","update","preRender","render","postRender"],bwe=40;function wJ(r,t){let o=!1,a=!0;const l={delta:0,timestamp:0,isProcessing:!1},d=_O.reduce((O,N)=>(O[N]=Twe(()=>o=!0),O),{}),m=O=>{d[O].process(l)},v=()=>{const O=performance.now();o=!1,l.delta=a?1e3/60:Math.max(Math.min(O-l.timestamp,bwe),1),l.timestamp=O,l.isProcessing=!0,_O.forEach(m),l.isProcessing=!1,o&&t&&(a=!1,r(v))},y=()=>{o=!0,a=!0,l.isProcessing||r(v)};return{schedule:_O.reduce((O,N)=>{const F=d[N];return O[N]=(H,G=!1,z=!1)=>(o||y(),F.schedule(H,G,z)),O},{}),cancel:O=>_O.forEach(N=>d[N].cancel(O)),state:l,steps:d}}const{schedule:iV}=wJ(queueMicrotask,!1);function wwe(r,t,o,a){const{visualElement:l}=V.useContext(gN),d=V.useContext(TJ),m=V.useContext(Fw),v=V.useContext(eV).reducedMotion,y=V.useRef();a=a||d.renderer,!y.current&&a&&(y.current=a(r,{visualState:t,parent:l,props:o,presenceContext:m,blockInitialAnimation:m?m.initial===!1:!1,reducedMotionConfig:v}));const b=y.current;V.useInsertionEffect(()=>{b&&b.update(o,m)});const R=V.useRef(!!(o[bJ]&&!window.HandoffComplete));return nV(()=>{b&&(iV.render(b.render),R.current&&b.animationState&&b.animationState.animateChanges())}),V.useEffect(()=>{b&&(b.updateFeatures(),!R.current&&b.animationState&&b.animationState.animateChanges(),R.current&&(R.current=!1,window.HandoffComplete=!0))}),b}function xy(r){return r&&typeof r=="object"&&Object.prototype.hasOwnProperty.call(r,"current")}function Rwe(r,t,o){return V.useCallback(a=>{a&&r.mount&&r.mount(a),t&&(a?t.mount(a):t.unmount()),o&&(typeof o=="function"?o(a):xy(o)&&(o.current=a))},[t])}function uw(r){return typeof r=="string"||Array.isArray(r)}function _N(r){return r!==null&&typeof r=="object"&&typeof r.start=="function"}const oV=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],sV=["initial",...oV];function vN(r){return _N(r.animate)||sV.some(t=>uw(r[t]))}function RJ(r){return!!(vN(r)||r.variants)}function Cwe(r,t){if(vN(r)){const{initial:o,animate:a}=r;return{initial:o===!1||uw(o)?o:void 0,animate:uw(a)?a:void 0}}return r.inherit!==!1?t:{}}function Iwe(r){const{initial:t,animate:o}=Cwe(r,V.useContext(gN));return V.useMemo(()=>({initial:t,animate:o}),[A$(t),A$(o)])}function A$(r){return Array.isArray(r)?r.join(" "):r}const O$={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},dw={};for(const r in O$)dw[r]={isEnabled:t=>O$[r].some(o=>!!t[o])};function Awe(r){for(const t in r)dw[t]={...dw[t],...r[t]}}const aV=V.createContext({}),CJ=V.createContext({}),Owe=Symbol.for("motionComponentSymbol");function Pwe({preloadedFeatures:r,createVisualElement:t,useRender:o,useVisualState:a,Component:l}){r&&Awe(r);function d(v,y){let b;const R={...V.useContext(eV),...v,layoutId:Nwe(v)},{isStatic:O}=R,N=Iwe(v),F=a(v,O);if(!O&&tV){N.visualElement=wwe(l,F,R,t);const H=V.useContext(CJ),G=V.useContext(TJ).strict;N.visualElement&&(b=N.visualElement.loadFeatures(R,G,r,H))}return D.jsxs(gN.Provider,{value:N,children:[b&&N.visualElement?D.jsx(b,{visualElement:N.visualElement,...R}):null,o(l,v,Rwe(F,N.visualElement,y),F,O,N.visualElement)]})}const m=V.forwardRef(d);return m[Owe]=l,m}function Nwe({layoutId:r}){const t=V.useContext(aV).id;return t&&r!==void 0?t+"-"+r:r}function kwe(r){function t(a,l={}){return Pwe(r(a,l))}if(typeof Proxy>"u")return t;const o=new Map;return new Proxy(t,{get:(a,l)=>(o.has(l)||o.set(l,t(l)),o.get(l))})}const Dwe=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function cV(r){return typeof r!="string"||r.includes("-")?!1:!!(Dwe.indexOf(r)>-1||/[A-Z]/u.test(r))}const CP={};function Lwe(r){Object.assign(CP,r)}const jw=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],sv=new Set(jw);function IJ(r,{layout:t,layoutId:o}){return sv.has(r)||r.startsWith("origin")||(t||o!==void 0)&&(!!CP[r]||r==="opacity")}const ya=r=>!!(r&&r.getVelocity),xwe={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},Mwe=jw.length;function Uwe(r,{enableHardwareAcceleration:t=!0,allowTransformNone:o=!0},a,l){let d="";for(let m=0;m<Mwe;m++){const v=jw[m];if(r[v]!==void 0){const y=xwe[v]||v;d+=`${y}(${r[v]}) `}}return t&&!r.z&&(d+="translateZ(0)"),d=d.trim(),l?d=l(r,a?"":d):o&&a&&(d="none"),d}const AJ=r=>t=>typeof t=="string"&&t.startsWith(r),OJ=AJ("--"),Vwe=AJ("var(--"),lV=r=>Vwe(r)?Fwe.test(r.split("/*")[0].trim()):!1,Fwe=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,jwe=(r,t)=>t&&typeof r=="number"?t.transform(r):r,Om=(r,t,o)=>o>t?t:o<r?r:o,RS={test:r=>typeof r=="number",parse:parseFloat,transform:r=>r},zb={...RS,transform:r=>Om(0,1,r)},vO={...RS,default:1},Hb=r=>Math.round(r*1e5)/1e5,uV=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu,Bwe=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu,Wwe=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu;function Bw(r){return typeof r=="string"}const Ww=r=>({test:t=>Bw(t)&&t.endsWith(r)&&t.split(" ").length===1,parse:parseFloat,transform:t=>`${t}${r}`}),fm=Ww("deg"),dh=Ww("%"),An=Ww("px"),Gwe=Ww("vh"),zwe=Ww("vw"),P$={...dh,parse:r=>dh.parse(r)/100,transform:r=>dh.transform(r*100)},N$={...RS,transform:Math.round},PJ={borderWidth:An,borderTopWidth:An,borderRightWidth:An,borderBottomWidth:An,borderLeftWidth:An,borderRadius:An,radius:An,borderTopLeftRadius:An,borderTopRightRadius:An,borderBottomRightRadius:An,borderBottomLeftRadius:An,width:An,maxWidth:An,height:An,maxHeight:An,size:An,top:An,right:An,bottom:An,left:An,padding:An,paddingTop:An,paddingRight:An,paddingBottom:An,paddingLeft:An,margin:An,marginTop:An,marginRight:An,marginBottom:An,marginLeft:An,rotate:fm,rotateX:fm,rotateY:fm,rotateZ:fm,scale:vO,scaleX:vO,scaleY:vO,scaleZ:vO,skew:fm,skewX:fm,skewY:fm,distance:An,translateX:An,translateY:An,translateZ:An,x:An,y:An,z:An,perspective:An,transformPerspective:An,opacity:zb,originX:P$,originY:P$,originZ:An,zIndex:N$,backgroundPositionX:An,backgroundPositionY:An,fillOpacity:zb,strokeOpacity:zb,numOctaves:N$};function dV(r,t,o,a){const{style:l,vars:d,transform:m,transformOrigin:v}=r;let y=!1,b=!1,R=!0;for(const O in t){const N=t[O];if(OJ(O)){d[O]=N;continue}const F=PJ[O],H=jwe(N,F);if(sv.has(O)){if(y=!0,m[O]=H,!R)continue;N!==(F.default||0)&&(R=!1)}else O.startsWith("origin")?(b=!0,v[O]=H):l[O]=H}if(t.transform||(y||a?l.transform=Uwe(r.transform,o,R,a):l.transform&&(l.transform="none")),b){const{originX:O="50%",originY:N="50%",originZ:F=0}=v;l.transformOrigin=`${O} ${N} ${F}`}}const hV=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function NJ(r,t,o){for(const a in t)!ya(t[a])&&!IJ(a,o)&&(r[a]=t[a])}function Hwe({transformTemplate:r},t,o){return V.useMemo(()=>{const a=hV();return dV(a,t,{enableHardwareAcceleration:!o},r),Object.assign({},a.vars,a.style)},[t])}function Kwe(r,t,o){const a=r.style||{},l={};return NJ(l,a,r),Object.assign(l,Hwe(r,t,o)),l}function $we(r,t,o){const a={},l=Kwe(r,t,o);return r.drag&&r.dragListener!==!1&&(a.draggable=!1,l.userSelect=l.WebkitUserSelect=l.WebkitTouchCallout="none",l.touchAction=r.drag===!0?"none":`pan-${r.drag==="x"?"y":"x"}`),r.tabIndex===void 0&&(r.onTap||r.onTapStart||r.whileTap)&&(a.tabIndex=0),a.style=l,a}const qwe=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function IP(r){return r.startsWith("while")||r.startsWith("drag")&&r!=="draggable"||r.startsWith("layout")||r.startsWith("onTap")||r.startsWith("onPan")||r.startsWith("onLayout")||qwe.has(r)}let kJ=r=>!IP(r);function Ywe(r){r&&(kJ=t=>t.startsWith("on")?!IP(t):r(t))}try{Ywe(require("@emotion/is-prop-valid").default)}catch{}function Xwe(r,t,o){const a={};for(const l in r)l==="values"&&typeof r.values=="object"||(kJ(l)||o===!0&&IP(l)||!t&&!IP(l)||r.draggable&&l.startsWith("onDrag"))&&(a[l]=r[l]);return a}function k$(r,t,o){return typeof r=="string"?r:An.transform(t+o*r)}function Jwe(r,t,o){const a=k$(t,r.x,r.width),l=k$(o,r.y,r.height);return`${a} ${l}`}const Qwe={offset:"stroke-dashoffset",array:"stroke-dasharray"},Zwe={offset:"strokeDashoffset",array:"strokeDasharray"};function eRe(r,t,o=1,a=0,l=!0){r.pathLength=1;const d=l?Qwe:Zwe;r[d.offset]=An.transform(-a);const m=An.transform(t),v=An.transform(o);r[d.array]=`${m} ${v}`}function fV(r,{attrX:t,attrY:o,attrScale:a,originX:l,originY:d,pathLength:m,pathSpacing:v=1,pathOffset:y=0,...b},R,O,N){if(dV(r,b,R,N),O){r.style.viewBox&&(r.attrs.viewBox=r.style.viewBox);return}r.attrs=r.style,r.style={};const{attrs:F,style:H,dimensions:G}=r;F.transform&&(G&&(H.transform=F.transform),delete F.transform),G&&(l!==void 0||d!==void 0||H.transform)&&(H.transformOrigin=Jwe(G,l!==void 0?l:.5,d!==void 0?d:.5)),t!==void 0&&(F.x=t),o!==void 0&&(F.y=o),a!==void 0&&(F.scale=a),m!==void 0&&eRe(F,m,v,y,!1)}const DJ=()=>({...hV(),attrs:{}}),pV=r=>typeof r=="string"&&r.toLowerCase()==="svg";function tRe(r,t,o,a){const l=V.useMemo(()=>{const d=DJ();return fV(d,t,{enableHardwareAcceleration:!1},pV(a),r.transformTemplate),{...d.attrs,style:{...d.style}}},[t]);if(r.style){const d={};NJ(d,r.style,r),l.style={...d,...l.style}}return l}function nRe(r=!1){return(o,a,l,{latestValues:d},m)=>{const y=(cV(o)?tRe:$we)(a,d,m,o),b=Xwe(a,typeof o=="string",r),R=o!==V.Fragment?{...b,...y,ref:l}:{},{children:O}=a,N=V.useMemo(()=>ya(O)?O.get():O,[O]);return V.createElement(o,{...R,children:N})}}function LJ(r,{style:t,vars:o},a,l){Object.assign(r.style,t,l&&l.getProjectionStyles(a));for(const d in o)r.style.setProperty(d,o[d])}const xJ=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function MJ(r,t,o,a){LJ(r,t,void 0,a);for(const l in t.attrs)r.setAttribute(xJ.has(l)?l:rV(l),t.attrs[l])}function mV(r,t,o){var a;const{style:l}=r,d={};for(const m in l)(ya(l[m])||t.style&&ya(t.style[m])||IJ(m,r)||((a=o==null?void 0:o.getValue(m))===null||a===void 0?void 0:a.liveStyle)!==void 0)&&(d[m]=l[m]);return d}function UJ(r,t,o){const a=mV(r,t,o);for(const l in r)if(ya(r[l])||ya(t[l])){const d=jw.indexOf(l)!==-1?"attr"+l.charAt(0).toUpperCase()+l.substring(1):l;a[d]=r[l]}return a}function D$(r){const t=[{},{}];return r==null||r.values.forEach((o,a)=>{t[0][a]=o.get(),t[1][a]=o.getVelocity()}),t}function gV(r,t,o,a){if(typeof t=="function"){const[l,d]=D$(a);t=t(o!==void 0?o:r.custom,l,d)}if(typeof t=="string"&&(t=r.variants&&r.variants[t]),typeof t=="function"){const[l,d]=D$(a);t=t(o!==void 0?o:r.custom,l,d)}return t}function VJ(r){const t=V.useRef(null);return t.current===null&&(t.current=r()),t.current}const w2=r=>Array.isArray(r),rRe=r=>!!(r&&typeof r=="object"&&r.mix&&r.toValue),iRe=r=>w2(r)?r[r.length-1]||0:r;function QO(r){const t=ya(r)?r.get():r;return rRe(t)?t.toValue():t}function oRe({scrapeMotionValuesFromProps:r,createRenderState:t,onMount:o},a,l,d){const m={latestValues:sRe(a,l,d,r),renderState:t()};return o&&(m.mount=v=>o(a,v,m)),m}const FJ=r=>(t,o)=>{const a=V.useContext(gN),l=V.useContext(Fw),d=()=>oRe(r,t,a,l);return o?d():VJ(d)};function sRe(r,t,o,a){const l={},d=a(r,{});for(const N in d)l[N]=QO(d[N]);let{initial:m,animate:v}=r;const y=vN(r),b=RJ(r);t&&b&&!y&&r.inherit!==!1&&(m===void 0&&(m=t.initial),v===void 0&&(v=t.animate));let R=o?o.initial===!1:!1;R=R||m===!1;const O=R?v:m;return O&&typeof O!="boolean"&&!_N(O)&&(Array.isArray(O)?O:[O]).forEach(F=>{const H=gV(r,F);if(!H)return;const{transitionEnd:G,transition:z,...ne}=H;for(const J in ne){let oe=ne[J];if(Array.isArray(oe)){const se=R?oe.length-1:0;oe=oe[se]}oe!==null&&(l[J]=oe)}for(const J in G)l[J]=G[J]}),l}const Sa=r=>r,{schedule:_i,cancel:Pm,state:Ws,steps:uM}=wJ(typeof requestAnimationFrame<"u"?requestAnimationFrame:Sa,!0),aRe={useVisualState:FJ({scrapeMotionValuesFromProps:UJ,createRenderState:DJ,onMount:(r,t,{renderState:o,latestValues:a})=>{_i.read(()=>{try{o.dimensions=typeof t.getBBox=="function"?t.getBBox():t.getBoundingClientRect()}catch{o.dimensions={x:0,y:0,width:0,height:0}}}),_i.render(()=>{fV(o,a,{enableHardwareAcceleration:!1},pV(t.tagName),r.transformTemplate),MJ(t,o)})}})},cRe={useVisualState:FJ({scrapeMotionValuesFromProps:mV,createRenderState:hV})};function lRe(r,{forwardMotionProps:t=!1},o,a){return{...cV(r)?aRe:cRe,preloadedFeatures:o,useRender:nRe(t),createVisualElement:a,Component:r}}function xf(r,t,o,a={passive:!0}){return r.addEventListener(t,o,a),()=>r.removeEventListener(t,o)}const jJ=r=>r.pointerType==="mouse"?typeof r.button!="number"||r.button<=0:r.isPrimary!==!1;function EN(r,t="page"){return{point:{x:r[`${t}X`],y:r[`${t}Y`]}}}const uRe=r=>t=>jJ(t)&&r(t,EN(t));function Bf(r,t,o,a){return xf(r,t,uRe(o),a)}const dRe=(r,t)=>o=>t(r(o)),Wf=(...r)=>r.reduce(dRe);function BJ(r){let t=null;return()=>{const o=()=>{t=null};return t===null?(t=r,o):!1}}const L$=BJ("dragHorizontal"),x$=BJ("dragVertical");function WJ(r){let t=!1;if(r==="y")t=x$();else if(r==="x")t=L$();else{const o=L$(),a=x$();o&&a?t=()=>{o(),a()}:(o&&o(),a&&a())}return t}function GJ(){const r=WJ(!0);return r?(r(),!1):!0}class Vm{constructor(t){this.isMounted=!1,this.node=t}update(){}}function M$(r,t){const o=t?"pointerenter":"pointerleave",a=t?"onHoverStart":"onHoverEnd",l=(d,m)=>{if(d.pointerType==="touch"||GJ())return;const v=r.getProps();r.animationState&&v.whileHover&&r.animationState.setActive("whileHover",t);const y=v[a];y&&_i.postRender(()=>y(d,m))};return Bf(r.current,o,l,{passive:!r.getProps()[a]})}class hRe extends Vm{mount(){this.unmount=Wf(M$(this.node,!0),M$(this.node,!1))}unmount(){}}class fRe extends Vm{constructor(){super(...arguments),this.isActive=!1}onFocus(){let t=!1;try{t=this.node.current.matches(":focus-visible")}catch{t=!0}!t||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=Wf(xf(this.node.current,"focus",()=>this.onFocus()),xf(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}const zJ=(r,t)=>t?r===t?!0:zJ(r,t.parentElement):!1;function dM(r,t){if(!t)return;const o=new PointerEvent("pointer"+r);t(o,EN(o))}class pRe extends Vm{constructor(){super(...arguments),this.removeStartListeners=Sa,this.removeEndListeners=Sa,this.removeAccessibleListeners=Sa,this.startPointerPress=(t,o)=>{if(this.isPressing)return;this.removeEndListeners();const a=this.node.getProps(),d=Bf(window,"pointerup",(v,y)=>{if(!this.checkPressEnd())return;const{onTap:b,onTapCancel:R,globalTapTarget:O}=this.node.getProps(),N=!O&&!zJ(this.node.current,v.target)?R:b;N&&_i.update(()=>N(v,y))},{passive:!(a.onTap||a.onPointerUp)}),m=Bf(window,"pointercancel",(v,y)=>this.cancelPress(v,y),{passive:!(a.onTapCancel||a.onPointerCancel)});this.removeEndListeners=Wf(d,m),this.startPress(t,o)},this.startAccessiblePress=()=>{const t=d=>{if(d.key!=="Enter"||this.isPressing)return;const m=v=>{v.key!=="Enter"||!this.checkPressEnd()||dM("up",(y,b)=>{const{onTap:R}=this.node.getProps();R&&_i.postRender(()=>R(y,b))})};this.removeEndListeners(),this.removeEndListeners=xf(this.node.current,"keyup",m),dM("down",(v,y)=>{this.startPress(v,y)})},o=xf(this.node.current,"keydown",t),a=()=>{this.isPressing&&dM("cancel",(d,m)=>this.cancelPress(d,m))},l=xf(this.node.current,"blur",a);this.removeAccessibleListeners=Wf(o,l)}}startPress(t,o){this.isPressing=!0;const{onTapStart:a,whileTap:l}=this.node.getProps();l&&this.node.animationState&&this.node.animationState.setActive("whileTap",!0),a&&_i.postRender(()=>a(t,o))}checkPressEnd(){return this.removeEndListeners(),this.isPressing=!1,this.node.getProps().whileTap&&this.node.animationState&&this.node.animationState.setActive("whileTap",!1),!GJ()}cancelPress(t,o){if(!this.checkPressEnd())return;const{onTapCancel:a}=this.node.getProps();a&&_i.postRender(()=>a(t,o))}mount(){const t=this.node.getProps(),o=Bf(t.globalTapTarget?window:this.node.current,"pointerdown",this.startPointerPress,{passive:!(t.onTapStart||t.onPointerStart)}),a=xf(this.node.current,"focus",this.startAccessiblePress);this.removeStartListeners=Wf(o,a)}unmount(){this.removeStartListeners(),this.removeEndListeners(),this.removeAccessibleListeners()}}const R2=new WeakMap,hM=new WeakMap,mRe=r=>{const t=R2.get(r.target);t&&t(r)},gRe=r=>{r.forEach(mRe)};function _Re({root:r,...t}){const o=r||document;hM.has(o)||hM.set(o,{});const a=hM.get(o),l=JSON.stringify(t);return a[l]||(a[l]=new IntersectionObserver(gRe,{root:r,...t})),a[l]}function vRe(r,t,o){const a=_Re(t);return R2.set(r,o),a.observe(r),()=>{R2.delete(r),a.unobserve(r)}}const ERe={some:0,all:1};class yRe extends Vm{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:t={}}=this.node.getProps(),{root:o,margin:a,amount:l="some",once:d}=t,m={root:o?o.current:void 0,rootMargin:a,threshold:typeof l=="number"?l:ERe[l]},v=y=>{const{isIntersecting:b}=y;if(this.isInView===b||(this.isInView=b,d&&!b&&this.hasEnteredView))return;b&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",b);const{onViewportEnter:R,onViewportLeave:O}=this.node.getProps(),N=b?R:O;N&&N(y)};return vRe(this.node.current,m,v)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:t,prevProps:o}=this.node;["amount","margin","root"].some(SRe(t,o))&&this.startObserver()}unmount(){}}function SRe({viewport:r={}},{viewport:t={}}={}){return o=>r[o]!==t[o]}const TRe={inView:{Feature:yRe},tap:{Feature:pRe},focus:{Feature:fRe},hover:{Feature:hRe}};function HJ(r,t){if(!Array.isArray(t))return!1;const o=t.length;if(o!==r.length)return!1;for(let a=0;a<o;a++)if(t[a]!==r[a])return!1;return!0}function yN(r,t,o){const a=r.getProps();return gV(a,t,o!==void 0?o:a.custom,r)}const Tm=r=>r*1e3,Gf=r=>r/1e3,bRe={type:"spring",stiffness:500,damping:25,restSpeed:10},wRe=r=>({type:"spring",stiffness:550,damping:r===0?2*Math.sqrt(550):30,restSpeed:10}),RRe={type:"keyframes",duration:.8},CRe={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},IRe=(r,{keyframes:t})=>t.length>2?RRe:sv.has(r)?r.startsWith("scale")?wRe(t[1]):bRe:CRe;function ARe({when:r,delay:t,delayChildren:o,staggerChildren:a,staggerDirection:l,repeat:d,repeatType:m,repeatDelay:v,from:y,elapsed:b,...R}){return!!Object.keys(R).length}function _V(r,t){return r[t]||r.default||r}const ORe=r=>r!==null;function SN(r,{repeat:t,repeatType:o="loop"},a){const l=r.filter(ORe),d=t&&o!=="loop"&&t%2===1?0:l.length-1;return!d||a===void 0?l[d]:a}let ZO;function PRe(){ZO=void 0}const bm={now:()=>(ZO===void 0&&bm.set(Ws.isProcessing||Swe.useManualTiming?Ws.timestamp:performance.now()),ZO),set:r=>{ZO=r,queueMicrotask(PRe)}},KJ=r=>/^0[^.\s]+$/u.test(r);function NRe(r){return typeof r=="number"?r===0:r!==null?r==="none"||r==="0"||KJ(r):!0}let $J=Sa;const qJ=r=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(r),kRe=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function DRe(r){const t=kRe.exec(r);if(!t)return[,];const[,o,a,l]=t;return[`--${o??a}`,l]}function YJ(r,t,o=1){const[a,l]=DRe(r);if(!a)return;const d=window.getComputedStyle(t).getPropertyValue(a);if(d){const m=d.trim();return qJ(m)?parseFloat(m):m}return lV(l)?YJ(l,t,o+1):l}const LRe=new Set(["width","height","top","left","right","bottom","x","y","translateX","translateY"]),U$=r=>r===RS||r===An,V$=(r,t)=>parseFloat(r.split(", ")[t]),F$=(r,t)=>(o,{transform:a})=>{if(a==="none"||!a)return 0;const l=a.match(/^matrix3d\((.+)\)$/u);if(l)return V$(l[1],t);{const d=a.match(/^matrix\((.+)\)$/u);return d?V$(d[1],r):0}},xRe=new Set(["x","y","z"]),MRe=jw.filter(r=>!xRe.has(r));function URe(r){const t=[];return MRe.forEach(o=>{const a=r.getValue(o);a!==void 0&&(t.push([o,a.get()]),a.set(o.startsWith("scale")?1:0))}),t}const sS={width:({x:r},{paddingLeft:t="0",paddingRight:o="0"})=>r.max-r.min-parseFloat(t)-parseFloat(o),height:({y:r},{paddingTop:t="0",paddingBottom:o="0"})=>r.max-r.min-parseFloat(t)-parseFloat(o),top:(r,{top:t})=>parseFloat(t),left:(r,{left:t})=>parseFloat(t),bottom:({y:r},{top:t})=>parseFloat(t)+(r.max-r.min),right:({x:r},{left:t})=>parseFloat(t)+(r.max-r.min),x:F$(4,13),y:F$(5,14)};sS.translateX=sS.x;sS.translateY=sS.y;const XJ=r=>t=>t.test(r),VRe={test:r=>r==="auto",parse:r=>r},JJ=[RS,An,dh,fm,zwe,Gwe,VRe],j$=r=>JJ.find(XJ(r)),F_=new Set;let C2=!1,I2=!1;function QJ(){if(I2){const r=Array.from(F_).filter(a=>a.needsMeasurement),t=new Set(r.map(a=>a.element)),o=new Map;t.forEach(a=>{const l=URe(a);l.length&&(o.set(a,l),a.render())}),r.forEach(a=>a.measureInitialState()),t.forEach(a=>{a.render();const l=o.get(a);l&&l.forEach(([d,m])=>{var v;(v=a.getValue(d))===null||v===void 0||v.set(m)})}),r.forEach(a=>a.measureEndState()),r.forEach(a=>{a.suspendedScrollY!==void 0&&window.scrollTo(0,a.suspendedScrollY)})}I2=!1,C2=!1,F_.forEach(r=>r.complete()),F_.clear()}function ZJ(){F_.forEach(r=>{r.readKeyframes(),r.needsMeasurement&&(I2=!0)})}function FRe(){ZJ(),QJ()}class vV{constructor(t,o,a,l,d,m=!1){this.isComplete=!1,this.isAsync=!1,this.needsMeasurement=!1,this.isScheduled=!1,this.unresolvedKeyframes=[...t],this.onComplete=o,this.name=a,this.motionValue=l,this.element=d,this.isAsync=m}scheduleResolve(){this.isScheduled=!0,this.isAsync?(F_.add(this),C2||(C2=!0,_i.read(ZJ),_i.resolveKeyframes(QJ))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:t,name:o,element:a,motionValue:l}=this;for(let d=0;d<t.length;d++)if(t[d]===null)if(d===0){const m=l==null?void 0:l.get(),v=t[t.length-1];if(m!==void 0)t[0]=m;else if(a&&o){const y=a.readValue(o,v);y!=null&&(t[0]=y)}t[0]===void 0&&(t[0]=v),l&&m===void 0&&l.set(t[0])}else t[d]=t[d-1]}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(){this.isComplete=!0,this.onComplete(this.unresolvedKeyframes,this.finalKeyframe),F_.delete(this)}cancel(){this.isComplete||(this.isScheduled=!1,F_.delete(this))}resume(){this.isComplete||this.scheduleResolve()}}const EV=(r,t)=>o=>!!(Bw(o)&&Wwe.test(o)&&o.startsWith(r)||t&&Object.prototype.hasOwnProperty.call(o,t)),eQ=(r,t,o)=>a=>{if(!Bw(a))return a;const[l,d,m,v]=a.match(uV);return{[r]:parseFloat(l),[t]:parseFloat(d),[o]:parseFloat(m),alpha:v!==void 0?parseFloat(v):1}},jRe=r=>Om(0,255,r),fM={...RS,transform:r=>Math.round(jRe(r))},D_={test:EV("rgb","red"),parse:eQ("red","green","blue"),transform:({red:r,green:t,blue:o,alpha:a=1})=>"rgba("+fM.transform(r)+", "+fM.transform(t)+", "+fM.transform(o)+", "+Hb(zb.transform(a))+")"};function BRe(r){let t="",o="",a="",l="";return r.length>5?(t=r.substring(1,3),o=r.substring(3,5),a=r.substring(5,7),l=r.substring(7,9)):(t=r.substring(1,2),o=r.substring(2,3),a=r.substring(3,4),l=r.substring(4,5),t+=t,o+=o,a+=a,l+=l),{red:parseInt(t,16),green:parseInt(o,16),blue:parseInt(a,16),alpha:l?parseInt(l,16)/255:1}}const A2={test:EV("#"),parse:BRe,transform:D_.transform},My={test:EV("hsl","hue"),parse:eQ("hue","saturation","lightness"),transform:({hue:r,saturation:t,lightness:o,alpha:a=1})=>"hsla("+Math.round(r)+", "+dh.transform(Hb(t))+", "+dh.transform(Hb(o))+", "+Hb(zb.transform(a))+")"},_a={test:r=>D_.test(r)||A2.test(r)||My.test(r),parse:r=>D_.test(r)?D_.parse(r):My.test(r)?My.parse(r):A2.parse(r),transform:r=>Bw(r)?r:r.hasOwnProperty("red")?D_.transform(r):My.transform(r)};function WRe(r){var t,o;return isNaN(r)&&Bw(r)&&(((t=r.match(uV))===null||t===void 0?void 0:t.length)||0)+(((o=r.match(Bwe))===null||o===void 0?void 0:o.length)||0)>0}const tQ="number",nQ="color",GRe="var",zRe="var(",B$="${}",HRe=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function hw(r){const t=r.toString(),o=[],a={color:[],number:[],var:[]},l=[];let d=0;const v=t.replace(HRe,y=>(_a.test(y)?(a.color.push(d),l.push(nQ),o.push(_a.parse(y))):y.startsWith(zRe)?(a.var.push(d),l.push(GRe),o.push(y)):(a.number.push(d),l.push(tQ),o.push(parseFloat(y))),++d,B$)).split(B$);return{values:o,split:v,indexes:a,types:l}}function rQ(r){return hw(r).values}function iQ(r){const{split:t,types:o}=hw(r),a=t.length;return l=>{let d="";for(let m=0;m<a;m++)if(d+=t[m],l[m]!==void 0){const v=o[m];v===tQ?d+=Hb(l[m]):v===nQ?d+=_a.transform(l[m]):d+=l[m]}return d}}const KRe=r=>typeof r=="number"?0:r;function $Re(r){const t=rQ(r);return iQ(r)(t.map(KRe))}const Nm={test:WRe,parse:rQ,createTransformer:iQ,getAnimatableNone:$Re},qRe=new Set(["brightness","contrast","saturate","opacity"]);function YRe(r){const[t,o]=r.slice(0,-1).split("(");if(t==="drop-shadow")return r;const[a]=o.match(uV)||[];if(!a)return r;const l=o.replace(a,"");let d=qRe.has(t)?1:0;return a!==o&&(d*=100),t+"("+d+l+")"}const XRe=/\b([a-z-]*)\(.*?\)/gu,O2={...Nm,getAnimatableNone:r=>{const t=r.match(XRe);return t?t.map(YRe).join(" "):r}},JRe={...PJ,color:_a,backgroundColor:_a,outlineColor:_a,fill:_a,stroke:_a,borderColor:_a,borderTopColor:_a,borderRightColor:_a,borderBottomColor:_a,borderLeftColor:_a,filter:O2,WebkitFilter:O2},yV=r=>JRe[r];function oQ(r,t){let o=yV(r);return o!==O2&&(o=Nm),o.getAnimatableNone?o.getAnimatableNone(t):void 0}const QRe=new Set(["auto","none","0"]);function ZRe(r,t,o){let a=0,l;for(;a<r.length&&!l;){const d=r[a];typeof d=="string"&&!QRe.has(d)&&hw(d).values.length&&(l=r[a]),a++}if(l&&o)for(const d of t)r[d]=oQ(o,l)}class sQ extends vV{constructor(t,o,a,l){super(t,o,a,l,l==null?void 0:l.owner,!0)}readKeyframes(){const{unresolvedKeyframes:t,element:o,name:a}=this;if(!o.current)return;super.readKeyframes();for(let y=0;y<t.length;y++){const b=t[y];if(typeof b=="string"&&lV(b)){const R=YJ(b,o.current);R!==void 0&&(t[y]=R),y===t.length-1&&(this.finalKeyframe=b)}}if(this.resolveNoneKeyframes(),!LRe.has(a)||t.length!==2)return;const[l,d]=t,m=j$(l),v=j$(d);if(m!==v)if(U$(m)&&U$(v))for(let y=0;y<t.length;y++){const b=t[y];typeof b=="string"&&(t[y]=parseFloat(b))}else this.needsMeasurement=!0}resolveNoneKeyframes(){const{unresolvedKeyframes:t,name:o}=this,a=[];for(let l=0;l<t.length;l++)NRe(t[l])&&a.push(l);a.length&&ZRe(t,a,o)}measureInitialState(){const{element:t,unresolvedKeyframes:o,name:a}=this;if(!t.current)return;a==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=sS[a](t.measureViewportBox(),window.getComputedStyle(t.current)),o[0]=this.measuredOrigin;const l=o[o.length-1];l!==void 0&&t.getValue(a,l).jump(l,!1)}measureEndState(){var t;const{element:o,name:a,unresolvedKeyframes:l}=this;if(!o.current)return;const d=o.getValue(a);d&&d.jump(this.measuredOrigin,!1);const m=l.length-1,v=l[m];l[m]=sS[a](o.measureViewportBox(),window.getComputedStyle(o.current)),v!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=v),!((t=this.removedTransforms)===null||t===void 0)&&t.length&&this.removedTransforms.forEach(([y,b])=>{o.getValue(y).set(b)}),this.resolveNoneKeyframes()}}function eCe(r){let t;return()=>(t===void 0&&(t=r()),t)}const W$=(r,t)=>t==="zIndex"?!1:!!(typeof r=="number"||Array.isArray(r)||typeof r=="string"&&(Nm.test(r)||r==="0")&&!r.startsWith("url("));function tCe(r){const t=r[0];if(r.length===1)return!0;for(let o=0;o<r.length;o++)if(r[o]!==t)return!0}function nCe(r,t,o,a){const l=r[0];if(l===null)return!1;if(t==="display"||t==="visibility")return!0;const d=r[r.length-1],m=W$(l,t),v=W$(d,t);return!m||!v?!1:tCe(r)||o==="spring"&&a}class aQ{constructor({autoplay:t=!0,delay:o=0,type:a="keyframes",repeat:l=0,repeatDelay:d=0,repeatType:m="loop",...v}){this.isStopped=!1,this.hasAttemptedResolve=!1,this.options={autoplay:t,delay:o,type:a,repeat:l,repeatDelay:d,repeatType:m,...v},this.updateFinishedPromise()}get resolved(){return!this._resolved&&!this.hasAttemptedResolve&&FRe(),this._resolved}onKeyframesResolved(t,o){this.hasAttemptedResolve=!0;const{name:a,type:l,velocity:d,delay:m,onComplete:v,onUpdate:y,isGenerator:b}=this.options;if(!b&&!nCe(t,a,l,d))if(m)this.options.duration=0;else{y==null||y(SN(t,this.options,o)),v==null||v(),this.resolveFinishedPromise();return}const R=this.initPlayback(t,o);R!==!1&&(this._resolved={keyframes:t,finalKeyframe:o,...R},this.onPostResolved())}onPostResolved(){}then(t,o){return this.currentFinishedPromise.then(t,o)}updateFinishedPromise(){this.currentFinishedPromise=new Promise(t=>{this.resolveFinishedPromise=t})}}function cQ(r,t){return t?r*(1e3/t):0}const rCe=5;function lQ(r,t,o){const a=Math.max(t-rCe,0);return cQ(o-r(a),t-a)}const G$=.001,iCe=.01,oCe=10,sCe=.05,aCe=1;function cCe({duration:r=800,bounce:t=.25,velocity:o=0,mass:a=1}){let l,d,m=1-t;m=Om(sCe,aCe,m),r=Om(iCe,oCe,Gf(r)),m<1?(l=b=>{const R=b*m,O=R*r,N=R-o,F=P2(b,m),H=Math.exp(-O);return G$-N/F*H},d=b=>{const O=b*m*r,N=O*o+o,F=Math.pow(m,2)*Math.pow(b,2)*r,H=Math.exp(-O),G=P2(Math.pow(b,2),m);return(-l(b)+G$>0?-1:1)*((N-F)*H)/G}):(l=b=>{const R=Math.exp(-b*r),O=(b-o)*r+1;return-.001+R*O},d=b=>{const R=Math.exp(-b*r),O=(o-b)*(r*r);return R*O});const v=5/r,y=uCe(l,d,v);if(r=Tm(r),isNaN(y))return{stiffness:100,damping:10,duration:r};{const b=Math.pow(y,2)*a;return{stiffness:b,damping:m*2*Math.sqrt(a*b),duration:r}}}const lCe=12;function uCe(r,t,o){let a=o;for(let l=1;l<lCe;l++)a=a-r(a)/t(a);return a}function P2(r,t){return r*Math.sqrt(1-t*t)}const dCe=["duration","bounce"],hCe=["stiffness","damping","mass"];function z$(r,t){return t.some(o=>r[o]!==void 0)}function fCe(r){let t={velocity:0,stiffness:100,damping:10,mass:1,isResolvedFromDuration:!1,...r};if(!z$(r,hCe)&&z$(r,dCe)){const o=cCe(r);t={...t,...o,mass:1},t.isResolvedFromDuration=!0}return t}function uQ({keyframes:r,restDelta:t,restSpeed:o,...a}){const l=r[0],d=r[r.length-1],m={done:!1,value:l},{stiffness:v,damping:y,mass:b,duration:R,velocity:O,isResolvedFromDuration:N}=fCe({...a,velocity:-Gf(a.velocity||0)}),F=O||0,H=y/(2*Math.sqrt(v*b)),G=d-l,z=Gf(Math.sqrt(v/b)),ne=Math.abs(G)<5;o||(o=ne?.01:2),t||(t=ne?.005:.5);let J;if(H<1){const oe=P2(z,H);J=se=>{const ae=Math.exp(-H*z*se);return d-ae*((F+H*z*G)/oe*Math.sin(oe*se)+G*Math.cos(oe*se))}}else if(H===1)J=oe=>d-Math.exp(-z*oe)*(G+(F+z*G)*oe);else{const oe=z*Math.sqrt(H*H-1);J=se=>{const ae=Math.exp(-H*z*se),ye=Math.min(oe*se,300);return d-ae*((F+H*z*G)*Math.sinh(ye)+oe*G*Math.cosh(ye))/oe}}return{calculatedDuration:N&&R||null,next:oe=>{const se=J(oe);if(N)m.done=oe>=R;else{let ae=F;oe!==0&&(H<1?ae=lQ(J,oe,se):ae=0);const ye=Math.abs(ae)<=o,Q=Math.abs(d-se)<=t;m.done=ye&&Q}return m.value=m.done?d:se,m}}}function H$({keyframes:r,velocity:t=0,power:o=.8,timeConstant:a=325,bounceDamping:l=10,bounceStiffness:d=500,modifyTarget:m,min:v,max:y,restDelta:b=.5,restSpeed:R}){const O=r[0],N={done:!1,value:O},F=te=>v!==void 0&&te<v||y!==void 0&&te>y,H=te=>v===void 0?y:y===void 0||Math.abs(v-te)<Math.abs(y-te)?v:y;let G=o*t;const z=O+G,ne=m===void 0?z:m(z);ne!==z&&(G=ne-O);const J=te=>-G*Math.exp(-te/a),oe=te=>ne+J(te),se=te=>{const re=J(te),le=oe(te);N.done=Math.abs(re)<=b,N.value=N.done?ne:le};let ae,ye;const Q=te=>{F(N.value)&&(ae=te,ye=uQ({keyframes:[N.value,H(N.value)],velocity:lQ(oe,te,N.value),damping:l,stiffness:d,restDelta:b,restSpeed:R}))};return Q(0),{calculatedDuration:null,next:te=>{let re=!1;return!ye&&ae===void 0&&(re=!0,se(te),Q(te)),ae!==void 0&&te>=ae?ye.next(te-ae):(!re&&se(te),N)}}}const dQ=(r,t,o)=>(((1-3*o+3*t)*r+(3*o-6*t))*r+3*t)*r,pCe=1e-7,mCe=12;function gCe(r,t,o,a,l){let d,m,v=0;do m=t+(o-t)/2,d=dQ(m,a,l)-r,d>0?o=m:t=m;while(Math.abs(d)>pCe&&++v<mCe);return m}function Gw(r,t,o,a){if(r===t&&o===a)return Sa;const l=d=>gCe(d,0,1,r,o);return d=>d===0||d===1?d:dQ(l(d),t,a)}const _Ce=Gw(.42,0,1,1),vCe=Gw(0,0,.58,1),hQ=Gw(.42,0,.58,1),ECe=r=>Array.isArray(r)&&typeof r[0]!="number",fQ=r=>t=>t<=.5?r(2*t)/2:(2-r(2*(1-t)))/2,pQ=r=>t=>1-r(1-t),SV=r=>1-Math.sin(Math.acos(r)),mQ=pQ(SV),yCe=fQ(SV),gQ=Gw(.33,1.53,.69,.99),TV=pQ(gQ),SCe=fQ(TV),TCe=r=>(r*=2)<1?.5*TV(r):.5*(2-Math.pow(2,-10*(r-1))),bCe={linear:Sa,easeIn:_Ce,easeInOut:hQ,easeOut:vCe,circIn:SV,circInOut:yCe,circOut:mQ,backIn:TV,backInOut:SCe,backOut:gQ,anticipate:TCe},K$=r=>{if(Array.isArray(r)){$J(r.length===4);const[t,o,a,l]=r;return Gw(t,o,a,l)}else if(typeof r=="string")return bCe[r];return r},fw=(r,t,o)=>{const a=t-r;return a===0?1:(o-r)/a},eo=(r,t,o)=>r+(t-r)*o;function pM(r,t,o){return o<0&&(o+=1),o>1&&(o-=1),o<1/6?r+(t-r)*6*o:o<1/2?t:o<2/3?r+(t-r)*(2/3-o)*6:r}function wCe({hue:r,saturation:t,lightness:o,alpha:a}){r/=360,t/=100,o/=100;let l=0,d=0,m=0;if(!t)l=d=m=o;else{const v=o<.5?o*(1+t):o+t-o*t,y=2*o-v;l=pM(y,v,r+1/3),d=pM(y,v,r),m=pM(y,v,r-1/3)}return{red:Math.round(l*255),green:Math.round(d*255),blue:Math.round(m*255),alpha:a}}const mM=(r,t,o)=>{const a=r*r,l=o*(t*t-a)+a;return l<0?0:Math.sqrt(l)},RCe=[A2,D_,My],CCe=r=>RCe.find(t=>t.test(r));function $$(r){const t=CCe(r);let o=t.parse(r);return t===My&&(o=wCe(o)),o}const q$=(r,t)=>{const o=$$(r),a=$$(t),l={...o};return d=>(l.red=mM(o.red,a.red,d),l.green=mM(o.green,a.green,d),l.blue=mM(o.blue,a.blue,d),l.alpha=eo(o.alpha,a.alpha,d),D_.transform(l))},N2=new Set(["none","hidden"]);function ICe(r,t){return N2.has(r)?o=>o<=0?r:t:o=>o>=1?t:r}function k2(r,t){return o=>o>0?t:r}function ACe(r,t){return o=>eo(r,t,o)}function bV(r){return typeof r=="number"?ACe:typeof r=="string"?lV(r)?k2:_a.test(r)?q$:NCe:Array.isArray(r)?_Q:typeof r=="object"?_a.test(r)?q$:OCe:k2}function _Q(r,t){const o=[...r],a=o.length,l=r.map((d,m)=>bV(d)(d,t[m]));return d=>{for(let m=0;m<a;m++)o[m]=l[m](d);return o}}function OCe(r,t){const o={...r,...t},a={};for(const l in o)r[l]!==void 0&&t[l]!==void 0&&(a[l]=bV(r[l])(r[l],t[l]));return l=>{for(const d in a)o[d]=a[d](l);return o}}function PCe(r,t){var o;const a=[],l={color:0,var:0,number:0};for(let d=0;d<t.values.length;d++){const m=t.types[d],v=r.indexes[m][l[m]],y=(o=r.values[v])!==null&&o!==void 0?o:0;a[d]=y,l[m]++}return a}const NCe=(r,t)=>{const o=Nm.createTransformer(t),a=hw(r),l=hw(t);return a.indexes.var.length===l.indexes.var.length&&a.indexes.color.length===l.indexes.color.length&&a.indexes.number.length>=l.indexes.number.length?N2.has(r)&&!l.values.length||N2.has(t)&&!a.values.length?ICe(r,t):Wf(_Q(PCe(a,l),l.values),o):k2(r,t)};function vQ(r,t,o){return typeof r=="number"&&typeof t=="number"&&typeof o=="number"?eo(r,t,o):bV(r)(r,t)}function kCe(r,t,o){const a=[],l=o||vQ,d=r.length-1;for(let m=0;m<d;m++){let v=l(r[m],r[m+1]);if(t){const y=Array.isArray(t)?t[m]||Sa:t;v=Wf(y,v)}a.push(v)}return a}function DCe(r,t,{clamp:o=!0,ease:a,mixer:l}={}){const d=r.length;if($J(d===t.length),d===1)return()=>t[0];if(d===2&&r[0]===r[1])return()=>t[1];r[0]>r[d-1]&&(r=[...r].reverse(),t=[...t].reverse());const m=kCe(t,a,l),v=m.length,y=b=>{let R=0;if(v>1)for(;R<r.length-2&&!(b<r[R+1]);R++);const O=fw(r[R],r[R+1],b);return m[R](O)};return o?b=>y(Om(r[0],r[d-1],b)):y}function LCe(r,t){const o=r[r.length-1];for(let a=1;a<=t;a++){const l=fw(0,t,a);r.push(eo(o,1,l))}}function xCe(r){const t=[0];return LCe(t,r.length-1),t}function MCe(r,t){return r.map(o=>o*t)}function UCe(r,t){return r.map(()=>t||hQ).splice(0,r.length-1)}function AP({duration:r=300,keyframes:t,times:o,ease:a="easeInOut"}){const l=ECe(a)?a.map(K$):K$(a),d={done:!1,value:t[0]},m=MCe(o&&o.length===t.length?o:xCe(t),r),v=DCe(m,t,{ease:Array.isArray(l)?l:UCe(t,l)});return{calculatedDuration:r,next:y=>(d.value=v(y),d.done=y>=r,d)}}const Y$=2e4;function VCe(r){let t=0;const o=50;let a=r.next(t);for(;!a.done&&t<Y$;)t+=o,a=r.next(t);return t>=Y$?1/0:t}const FCe=r=>{const t=({timestamp:o})=>r(o);return{start:()=>_i.update(t,!0),stop:()=>Pm(t),now:()=>Ws.isProcessing?Ws.timestamp:bm.now()}},jCe={decay:H$,inertia:H$,tween:AP,keyframes:AP,spring:uQ},BCe=r=>r/100;class wV extends aQ{constructor({KeyframeResolver:t=vV,...o}){super(o),this.holdTime=null,this.startTime=null,this.cancelTime=null,this.currentTime=0,this.playbackSpeed=1,this.pendingPlayState="running",this.state="idle",this.stop=()=>{if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.teardown();const{onStop:v}=this.options;v&&v()};const{name:a,motionValue:l,keyframes:d}=this.options,m=(v,y)=>this.onKeyframesResolved(v,y);a&&l&&l.owner?this.resolver=l.owner.resolveKeyframes(d,m,a,l):this.resolver=new t(d,m,a,l),this.resolver.scheduleResolve()}initPlayback(t){const{type:o="keyframes",repeat:a=0,repeatDelay:l=0,repeatType:d,velocity:m=0}=this.options,v=jCe[o]||AP;let y,b;v!==AP&&typeof t[0]!="number"&&(y=Wf(BCe,vQ(t[0],t[1])),t=[0,100]);const R=v({...this.options,keyframes:t});d==="mirror"&&(b=v({...this.options,keyframes:[...t].reverse(),velocity:-m})),R.calculatedDuration===null&&(R.calculatedDuration=VCe(R));const{calculatedDuration:O}=R,N=O+l,F=N*(a+1)-l;return{generator:R,mirroredGenerator:b,mapPercentToKeyframes:y,calculatedDuration:O,resolvedDuration:N,totalDuration:F}}onPostResolved(){const{autoplay:t=!0}=this.options;this.play(),this.pendingPlayState==="paused"||!t?this.pause():this.state=this.pendingPlayState}tick(t,o=!1){const{resolved:a}=this;if(!a){const{keyframes:te}=this.options;return{done:!0,value:te[te.length-1]}}const{finalKeyframe:l,generator:d,mirroredGenerator:m,mapPercentToKeyframes:v,keyframes:y,calculatedDuration:b,totalDuration:R,resolvedDuration:O}=a;if(this.startTime===null)return d.next(0);const{delay:N,repeat:F,repeatType:H,repeatDelay:G,onUpdate:z}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,t):this.speed<0&&(this.startTime=Math.min(t-R/this.speed,this.startTime)),o?this.currentTime=t:this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=Math.round(t-this.startTime)*this.speed;const ne=this.currentTime-N*(this.speed>=0?1:-1),J=this.speed>=0?ne<0:ne>R;this.currentTime=Math.max(ne,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=R);let oe=this.currentTime,se=d;if(F){const te=Math.min(this.currentTime,R)/O;let re=Math.floor(te),le=te%1;!le&&te>=1&&(le=1),le===1&&re--,re=Math.min(re,F+1),!!(re%2)&&(H==="reverse"?(le=1-le,G&&(le-=G/O)):H==="mirror"&&(se=m)),oe=Om(0,1,le)*O}const ae=J?{done:!1,value:y[0]}:se.next(oe);v&&(ae.value=v(ae.value));let{done:ye}=ae;!J&&b!==null&&(ye=this.speed>=0?this.currentTime>=R:this.currentTime<=0);const Q=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&ye);return Q&&l!==void 0&&(ae.value=SN(y,this.options,l)),z&&z(ae.value),Q&&this.finish(),ae}get duration(){const{resolved:t}=this;return t?Gf(t.calculatedDuration):0}get time(){return Gf(this.currentTime)}set time(t){t=Tm(t),this.currentTime=t,this.holdTime!==null||this.speed===0?this.holdTime=t:this.driver&&(this.startTime=this.driver.now()-t/this.speed)}get speed(){return this.playbackSpeed}set speed(t){const o=this.playbackSpeed!==t;this.playbackSpeed=t,o&&(this.time=Gf(this.currentTime))}play(){if(this.resolver.isScheduled||this.resolver.resume(),!this._resolved){this.pendingPlayState="running";return}if(this.isStopped)return;const{driver:t=FCe,onPlay:o}=this.options;this.driver||(this.driver=t(l=>this.tick(l))),o&&o();const a=this.driver.now();this.holdTime!==null?this.startTime=a-this.holdTime:(!this.startTime||this.state==="finished")&&(this.startTime=a),this.state==="finished"&&this.updateFinishedPromise(),this.cancelTime=this.startTime,this.holdTime=null,this.state="running",this.driver.start()}pause(){var t;if(!this._resolved){this.pendingPlayState="paused";return}this.state="paused",this.holdTime=(t=this.currentTime)!==null&&t!==void 0?t:0}complete(){this.state!=="running"&&this.play(),this.pendingPlayState=this.state="finished",this.holdTime=null}finish(){this.teardown(),this.state="finished";const{onComplete:t}=this.options;t&&t()}cancel(){this.cancelTime!==null&&this.tick(this.cancelTime),this.teardown(),this.updateFinishedPromise()}teardown(){this.state="idle",this.stopDriver(),this.resolveFinishedPromise(),this.updateFinishedPromise(),this.startTime=this.cancelTime=null,this.resolver.cancel()}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(t){return this.startTime=0,this.tick(t,!0)}}const EQ=r=>Array.isArray(r)&&typeof r[0]=="number";function yQ(r){return!!(!r||typeof r=="string"&&r in RV||EQ(r)||Array.isArray(r)&&r.every(yQ))}const Cb=([r,t,o,a])=>`cubic-bezier(${r}, ${t}, ${o}, ${a})`,RV={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:Cb([0,.65,.55,1]),circOut:Cb([.55,0,1,.45]),backIn:Cb([.31,.01,.66,-.59]),backOut:Cb([.33,1.53,.69,.99])};function WCe(r){return SQ(r)||RV.easeOut}function SQ(r){if(r)return EQ(r)?Cb(r):Array.isArray(r)?r.map(WCe):RV[r]}function GCe(r,t,o,{delay:a=0,duration:l=300,repeat:d=0,repeatType:m="loop",ease:v,times:y}={}){const b={[t]:o};y&&(b.offset=y);const R=SQ(v);return Array.isArray(R)&&(b.easing=R),r.animate(b,{delay:a,duration:l,easing:Array.isArray(R)?"linear":R,fill:"both",iterations:d+1,direction:m==="reverse"?"alternate":"normal"})}const zCe=eCe(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),HCe=new Set(["opacity","clipPath","filter","transform"]),OP=10,KCe=2e4;function $Ce(r){return r.type==="spring"||r.name==="backgroundColor"||!yQ(r.ease)}function qCe(r,t){const o=new wV({...t,keyframes:r,repeat:0,delay:0,isGenerator:!0});let a={done:!1,value:r[0]};const l=[];let d=0;for(;!a.done&&d<KCe;)a=o.sample(d),l.push(a.value),d+=OP;return{times:void 0,keyframes:l,duration:d-OP,ease:"linear"}}class X$ extends aQ{constructor(t){super(t);const{name:o,motionValue:a,keyframes:l}=this.options;this.resolver=new sQ(l,(d,m)=>this.onKeyframesResolved(d,m),o,a),this.resolver.scheduleResolve()}initPlayback(t,o){var a;let{duration:l=300,times:d,ease:m,type:v,motionValue:y,name:b}=this.options;if(!(!((a=y.owner)===null||a===void 0)&&a.current))return!1;if($Ce(this.options)){const{onComplete:O,onUpdate:N,motionValue:F,...H}=this.options,G=qCe(t,H);t=G.keyframes,t.length===1&&(t[1]=t[0]),l=G.duration,d=G.times,m=G.ease,v="keyframes"}const R=GCe(y.owner.current,b,t,{...this.options,duration:l,times:d,ease:m});return R.startTime=bm.now(),this.pendingTimeline?(R.timeline=this.pendingTimeline,this.pendingTimeline=void 0):R.onfinish=()=>{const{onComplete:O}=this.options;y.set(SN(t,this.options,o)),O&&O(),this.cancel(),this.resolveFinishedPromise()},{animation:R,duration:l,times:d,type:v,ease:m,keyframes:t}}get duration(){const{resolved:t}=this;if(!t)return 0;const{duration:o}=t;return Gf(o)}get time(){const{resolved:t}=this;if(!t)return 0;const{animation:o}=t;return Gf(o.currentTime||0)}set time(t){const{resolved:o}=this;if(!o)return;const{animation:a}=o;a.currentTime=Tm(t)}get speed(){const{resolved:t}=this;if(!t)return 1;const{animation:o}=t;return o.playbackRate}set speed(t){const{resolved:o}=this;if(!o)return;const{animation:a}=o;a.playbackRate=t}get state(){const{resolved:t}=this;if(!t)return"idle";const{animation:o}=t;return o.playState}attachTimeline(t){if(!this._resolved)this.pendingTimeline=t;else{const{resolved:o}=this;if(!o)return Sa;const{animation:a}=o;a.timeline=t,a.onfinish=null}return Sa}play(){if(this.isStopped)return;const{resolved:t}=this;if(!t)return;const{animation:o}=t;o.playState==="finished"&&this.updateFinishedPromise(),o.play()}pause(){const{resolved:t}=this;if(!t)return;const{animation:o}=t;o.pause()}stop(){if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;const{resolved:t}=this;if(!t)return;const{animation:o,keyframes:a,duration:l,type:d,ease:m,times:v}=t;if(!(o.playState==="idle"||o.playState==="finished")){if(this.time){const{motionValue:y,onUpdate:b,onComplete:R,...O}=this.options,N=new wV({...O,keyframes:a,duration:l,type:d,ease:m,times:v,isGenerator:!0}),F=Tm(this.time);y.setWithVelocity(N.sample(F-OP).value,N.sample(F).value,OP)}this.cancel()}}complete(){const{resolved:t}=this;t&&t.animation.finish()}cancel(){const{resolved:t}=this;t&&t.animation.cancel()}static supports(t){const{motionValue:o,name:a,repeatDelay:l,repeatType:d,damping:m,type:v}=t;return zCe()&&a&&HCe.has(a)&&o&&o.owner&&o.owner.current instanceof HTMLElement&&!o.owner.getProps().onUpdate&&!l&&d!=="mirror"&&m!==0&&v!=="inertia"}}const CV=(r,t,o,a={},l,d)=>m=>{const v=_V(a,r)||{},y=v.delay||a.delay||0;let{elapsed:b=0}=a;b=b-Tm(y);let R={keyframes:Array.isArray(o)?o:[null,o],ease:"easeOut",velocity:t.getVelocity(),...v,delay:-b,onUpdate:N=>{t.set(N),v.onUpdate&&v.onUpdate(N)},onComplete:()=>{m(),v.onComplete&&v.onComplete()},name:r,motionValue:t,element:d?void 0:l};ARe(v)||(R={...R,...IRe(r,R)}),R.duration&&(R.duration=Tm(R.duration)),R.repeatDelay&&(R.repeatDelay=Tm(R.repeatDelay)),R.from!==void 0&&(R.keyframes[0]=R.from);let O=!1;if((R.type===!1||R.duration===0&&!R.repeatDelay)&&(R.duration=0,R.delay===0&&(O=!0)),O&&!d&&t.get()!==void 0){const N=SN(R.keyframes,v);if(N!==void 0){_i.update(()=>{R.onUpdate(N),R.onComplete()});return}}return!d&&X$.supports(R)?new X$(R):new wV(R)};function PP(r){return!!(ya(r)&&r.add)}function IV(r,t){r.indexOf(t)===-1&&r.push(t)}function AV(r,t){const o=r.indexOf(t);o>-1&&r.splice(o,1)}class OV{constructor(){this.subscriptions=[]}add(t){return IV(this.subscriptions,t),()=>AV(this.subscriptions,t)}notify(t,o,a){const l=this.subscriptions.length;if(l)if(l===1)this.subscriptions[0](t,o,a);else for(let d=0;d<l;d++){const m=this.subscriptions[d];m&&m(t,o,a)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const J$=30,YCe=r=>!isNaN(parseFloat(r));class XCe{constructor(t,o={}){this.version="11.2.6",this.canTrackVelocity=null,this.events={},this.updateAndNotify=(a,l=!0)=>{const d=bm.now();this.updatedAt!==d&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(a),this.current!==this.prev&&this.events.change&&this.events.change.notify(this.current),l&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.hasAnimated=!1,this.setCurrent(t),this.owner=o.owner}setCurrent(t){this.current=t,this.updatedAt=bm.now(),this.canTrackVelocity===null&&t!==void 0&&(this.canTrackVelocity=YCe(this.current))}setPrevFrameValue(t=this.current){this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt}onChange(t){return this.on("change",t)}on(t,o){this.events[t]||(this.events[t]=new OV);const a=this.events[t].add(o);return t==="change"?()=>{a(),_i.read(()=>{this.events.change.getSize()||this.stop()})}:a}clearListeners(){for(const t in this.events)this.events[t].clear()}attach(t,o){this.passiveEffect=t,this.stopPassiveEffect=o}set(t,o=!0){!o||!this.passiveEffect?this.updateAndNotify(t,o):this.passiveEffect(t,this.updateAndNotify)}setWithVelocity(t,o,a){this.set(o),this.prev=void 0,this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt-a}jump(t,o=!0){this.updateAndNotify(t),this.prev=t,this.prevUpdatedAt=this.prevFrameValue=void 0,o&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const t=bm.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||t-this.updatedAt>J$)return 0;const o=Math.min(this.updatedAt-this.prevUpdatedAt,J$);return cQ(parseFloat(this.current)-parseFloat(this.prevFrameValue),o)}start(t){return this.stop(),new Promise(o=>{this.hasAnimated=!0,this.animation=t(o),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function pw(r,t){return new XCe(r,t)}function JCe(r,t,o){r.hasValue(t)?r.getValue(t).set(o):r.addValue(t,pw(o))}function QCe(r,t){const o=yN(r,t);let{transitionEnd:a={},transition:l={},...d}=o||{};d={...d,...a};for(const m in d){const v=iRe(d[m]);JCe(r,m,v)}}function ZCe({protectedKeys:r,needsAnimating:t},o){const a=r.hasOwnProperty(o)&&t[o]!==!0;return t[o]=!1,a}function TQ(r,t,{delay:o=0,transitionOverride:a,type:l}={}){var d;let{transition:m=r.getDefaultTransition(),transitionEnd:v,...y}=t;const b=r.getValue("willChange");a&&(m=a);const R=[],O=l&&r.animationState&&r.animationState.getState()[l];for(const N in y){const F=r.getValue(N,(d=r.latestValues[N])!==null&&d!==void 0?d:null),H=y[N];if(H===void 0||O&&ZCe(O,N))continue;const G={delay:o,elapsed:0,..._V(m||{},N)};let z=!1;if(window.HandoffAppearAnimations){const oe=r.getProps()[bJ];if(oe){const se=window.HandoffAppearAnimations(oe,N,F,_i);se!==null&&(G.elapsed=se,z=!0)}}F.start(CV(N,F,H,r.shouldReduceMotion&&sv.has(N)?{type:!1}:G,r,z));const ne=F.animation;ne&&(PP(b)&&(b.add(N),ne.then(()=>b.remove(N))),R.push(ne))}return v&&Promise.all(R).then(()=>{_i.update(()=>{v&&QCe(r,v)})}),R}function D2(r,t,o={}){var a;const l=yN(r,t,o.type==="exit"?(a=r.presenceContext)===null||a===void 0?void 0:a.custom:void 0);let{transition:d=r.getDefaultTransition()||{}}=l||{};o.transitionOverride&&(d=o.transitionOverride);const m=l?()=>Promise.all(TQ(r,l,o)):()=>Promise.resolve(),v=r.variantChildren&&r.variantChildren.size?(b=0)=>{const{delayChildren:R=0,staggerChildren:O,staggerDirection:N}=d;return eIe(r,t,R+b,O,N,o)}:()=>Promise.resolve(),{when:y}=d;if(y){const[b,R]=y==="beforeChildren"?[m,v]:[v,m];return b().then(()=>R())}else return Promise.all([m(),v(o.delay)])}function eIe(r,t,o=0,a=0,l=1,d){const m=[],v=(r.variantChildren.size-1)*a,y=l===1?(b=0)=>b*a:(b=0)=>v-b*a;return Array.from(r.variantChildren).sort(tIe).forEach((b,R)=>{b.notify("AnimationStart",t),m.push(D2(b,t,{...d,delay:o+y(R)}).then(()=>b.notify("AnimationComplete",t)))}),Promise.all(m)}function tIe(r,t){return r.sortNodePosition(t)}function nIe(r,t,o={}){r.notify("AnimationStart",t);let a;if(Array.isArray(t)){const l=t.map(d=>D2(r,d,o));a=Promise.all(l)}else if(typeof t=="string")a=D2(r,t,o);else{const l=typeof t=="function"?yN(r,t,o.custom):t;a=Promise.all(TQ(r,l,o))}return a.then(()=>{_i.postRender(()=>{r.notify("AnimationComplete",t)})})}const rIe=[...oV].reverse(),iIe=oV.length;function oIe(r){return t=>Promise.all(t.map(({animation:o,options:a})=>nIe(r,o,a)))}function sIe(r){let t=oIe(r);const o=cIe();let a=!0;const l=y=>(b,R)=>{var O;const N=yN(r,R,y==="exit"?(O=r.presenceContext)===null||O===void 0?void 0:O.custom:void 0);if(N){const{transition:F,transitionEnd:H,...G}=N;b={...b,...G,...H}}return b};function d(y){t=y(r)}function m(y){const b=r.getProps(),R=r.getVariantContext(!0)||{},O=[],N=new Set;let F={},H=1/0;for(let z=0;z<iIe;z++){const ne=rIe[z],J=o[ne],oe=b[ne]!==void 0?b[ne]:R[ne],se=uw(oe),ae=ne===y?J.isActive:null;ae===!1&&(H=z);let ye=oe===R[ne]&&oe!==b[ne]&&se;if(ye&&a&&r.manuallyAnimateOnMount&&(ye=!1),J.protectedKeys={...F},!J.isActive&&ae===null||!oe&&!J.prevProp||_N(oe)||typeof oe=="boolean")continue;let te=aIe(J.prevProp,oe)||ne===y&&J.isActive&&!ye&&se||z>H&&se,re=!1;const le=Array.isArray(oe)?oe:[oe];let ve=le.reduce(l(ne),{});ae===!1&&(ve={});const{prevResolvedValues:fe={}}=J,de={...fe,...ve},lt=ft=>{te=!0,N.has(ft)&&(re=!0,N.delete(ft)),J.needsAnimating[ft]=!0;const Xe=r.getValue(ft);Xe&&(Xe.liveStyle=!1)};for(const ft in de){const Xe=ve[ft],Le=fe[ft];if(F.hasOwnProperty(ft))continue;let Ke=!1;w2(Xe)&&w2(Le)?Ke=!HJ(Xe,Le):Ke=Xe!==Le,Ke?Xe!=null?lt(ft):N.add(ft):Xe!==void 0&&N.has(ft)?lt(ft):J.protectedKeys[ft]=!0}J.prevProp=oe,J.prevResolvedValues=ve,J.isActive&&(F={...F,...ve}),a&&r.blockInitialAnimation&&(te=!1),te&&(!ye||re)&&O.push(...le.map(ft=>({animation:ft,options:{type:ne}})))}if(N.size){const z={};N.forEach(ne=>{const J=r.getBaseTarget(ne),oe=r.getValue(ne);oe&&(oe.liveStyle=!0),z[ne]=J??null}),O.push({animation:z})}let G=!!O.length;return a&&(b.initial===!1||b.initial===b.animate)&&!r.manuallyAnimateOnMount&&(G=!1),a=!1,G?t(O):Promise.resolve()}function v(y,b){var R;if(o[y].isActive===b)return Promise.resolve();(R=r.variantChildren)===null||R===void 0||R.forEach(N=>{var F;return(F=N.animationState)===null||F===void 0?void 0:F.setActive(y,b)}),o[y].isActive=b;const O=m(y);for(const N in o)o[N].protectedKeys={};return O}return{animateChanges:m,setActive:v,setAnimateFunction:d,getState:()=>o}}function aIe(r,t){return typeof t=="string"?t!==r:Array.isArray(t)?!HJ(t,r):!1}function S_(r=!1){return{isActive:r,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function cIe(){return{animate:S_(!0),whileInView:S_(),whileHover:S_(),whileTap:S_(),whileDrag:S_(),whileFocus:S_(),exit:S_()}}class lIe extends Vm{constructor(t){super(t),t.animationState||(t.animationState=sIe(t))}updateAnimationControlsSubscription(){const{animate:t}=this.node.getProps();this.unmount(),_N(t)&&(this.unmount=t.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:t}=this.node.getProps(),{animate:o}=this.node.prevProps||{};t!==o&&this.updateAnimationControlsSubscription()}unmount(){}}let uIe=0;class dIe extends Vm{constructor(){super(...arguments),this.id=uIe++}update(){if(!this.node.presenceContext)return;const{isPresent:t,onExitComplete:o}=this.node.presenceContext,{isPresent:a}=this.node.prevPresenceContext||{};if(!this.node.animationState||t===a)return;const l=this.node.animationState.setActive("exit",!t);o&&!t&&l.then(()=>o(this.id))}mount(){const{register:t}=this.node.presenceContext||{};t&&(this.unmount=t(this.id))}unmount(){}}const hIe={animation:{Feature:lIe},exit:{Feature:dIe}},Q$=(r,t)=>Math.abs(r-t);function fIe(r,t){const o=Q$(r.x,t.x),a=Q$(r.y,t.y);return Math.sqrt(o**2+a**2)}class bQ{constructor(t,o,{transformPagePoint:a,contextWindow:l,dragSnapToOrigin:d=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const O=_M(this.lastMoveEventInfo,this.history),N=this.startEvent!==null,F=fIe(O.offset,{x:0,y:0})>=3;if(!N&&!F)return;const{point:H}=O,{timestamp:G}=Ws;this.history.push({...H,timestamp:G});const{onStart:z,onMove:ne}=this.handlers;N||(z&&z(this.lastMoveEvent,O),this.startEvent=this.lastMoveEvent),ne&&ne(this.lastMoveEvent,O)},this.handlePointerMove=(O,N)=>{this.lastMoveEvent=O,this.lastMoveEventInfo=gM(N,this.transformPagePoint),_i.update(this.updatePoint,!0)},this.handlePointerUp=(O,N)=>{this.end();const{onEnd:F,onSessionEnd:H,resumeAnimation:G}=this.handlers;if(this.dragSnapToOrigin&&G&&G(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const z=_M(O.type==="pointercancel"?this.lastMoveEventInfo:gM(N,this.transformPagePoint),this.history);this.startEvent&&F&&F(O,z),H&&H(O,z)},!jJ(t))return;this.dragSnapToOrigin=d,this.handlers=o,this.transformPagePoint=a,this.contextWindow=l||window;const m=EN(t),v=gM(m,this.transformPagePoint),{point:y}=v,{timestamp:b}=Ws;this.history=[{...y,timestamp:b}];const{onSessionStart:R}=o;R&&R(t,_M(v,this.history)),this.removeListeners=Wf(Bf(this.contextWindow,"pointermove",this.handlePointerMove),Bf(this.contextWindow,"pointerup",this.handlePointerUp),Bf(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(t){this.handlers=t}end(){this.removeListeners&&this.removeListeners(),Pm(this.updatePoint)}}function gM(r,t){return t?{point:t(r.point)}:r}function Z$(r,t){return{x:r.x-t.x,y:r.y-t.y}}function _M({point:r},t){return{point:r,delta:Z$(r,wQ(t)),offset:Z$(r,pIe(t)),velocity:mIe(t,.1)}}function pIe(r){return r[0]}function wQ(r){return r[r.length-1]}function mIe(r,t){if(r.length<2)return{x:0,y:0};let o=r.length-1,a=null;const l=wQ(r);for(;o>=0&&(a=r[o],!(l.timestamp-a.timestamp>Tm(t)));)o--;if(!a)return{x:0,y:0};const d=Gf(l.timestamp-a.timestamp);if(d===0)return{x:0,y:0};const m={x:(l.x-a.x)/d,y:(l.y-a.y)/d};return m.x===1/0&&(m.x=0),m.y===1/0&&(m.y=0),m}function ml(r){return r.max-r.min}function L2(r,t=0,o=.01){return Math.abs(r-t)<=o}function eq(r,t,o,a=.5){r.origin=a,r.originPoint=eo(t.min,t.max,r.origin),r.scale=ml(o)/ml(t),(L2(r.scale,1,1e-4)||isNaN(r.scale))&&(r.scale=1),r.translate=eo(o.min,o.max,r.origin)-r.originPoint,(L2(r.translate)||isNaN(r.translate))&&(r.translate=0)}function Kb(r,t,o,a){eq(r.x,t.x,o.x,a?a.originX:void 0),eq(r.y,t.y,o.y,a?a.originY:void 0)}function tq(r,t,o){r.min=o.min+t.min,r.max=r.min+ml(t)}function gIe(r,t,o){tq(r.x,t.x,o.x),tq(r.y,t.y,o.y)}function nq(r,t,o){r.min=t.min-o.min,r.max=r.min+ml(t)}function $b(r,t,o){nq(r.x,t.x,o.x),nq(r.y,t.y,o.y)}function _Ie(r,{min:t,max:o},a){return t!==void 0&&r<t?r=a?eo(t,r,a.min):Math.max(r,t):o!==void 0&&r>o&&(r=a?eo(o,r,a.max):Math.min(r,o)),r}function rq(r,t,o){return{min:t!==void 0?r.min+t:void 0,max:o!==void 0?r.max+o-(r.max-r.min):void 0}}function vIe(r,{top:t,left:o,bottom:a,right:l}){return{x:rq(r.x,o,l),y:rq(r.y,t,a)}}function iq(r,t){let o=t.min-r.min,a=t.max-r.max;return t.max-t.min<r.max-r.min&&([o,a]=[a,o]),{min:o,max:a}}function EIe(r,t){return{x:iq(r.x,t.x),y:iq(r.y,t.y)}}function yIe(r,t){let o=.5;const a=ml(r),l=ml(t);return l>a?o=fw(t.min,t.max-a,r.min):a>l&&(o=fw(r.min,r.max-l,t.min)),Om(0,1,o)}function SIe(r,t){const o={};return t.min!==void 0&&(o.min=t.min-r.min),t.max!==void 0&&(o.max=t.max-r.min),o}const x2=.35;function TIe(r=x2){return r===!1?r=0:r===!0&&(r=x2),{x:oq(r,"left","right"),y:oq(r,"top","bottom")}}function oq(r,t,o){return{min:sq(r,t),max:sq(r,o)}}function sq(r,t){return typeof r=="number"?r:r[t]||0}const aq=()=>({translate:0,scale:1,origin:0,originPoint:0}),Uy=()=>({x:aq(),y:aq()}),cq=()=>({min:0,max:0}),Co=()=>({x:cq(),y:cq()});function Zl(r){return[r("x"),r("y")]}function RQ({top:r,left:t,right:o,bottom:a}){return{x:{min:t,max:o},y:{min:r,max:a}}}function bIe({x:r,y:t}){return{top:t.min,right:r.max,bottom:t.max,left:r.min}}function wIe(r,t){if(!t)return r;const o=t({x:r.left,y:r.top}),a=t({x:r.right,y:r.bottom});return{top:o.y,left:o.x,bottom:a.y,right:a.x}}function vM(r){return r===void 0||r===1}function M2({scale:r,scaleX:t,scaleY:o}){return!vM(r)||!vM(t)||!vM(o)}function b_(r){return M2(r)||CQ(r)||r.z||r.rotate||r.rotateX||r.rotateY||r.skewX||r.skewY}function CQ(r){return lq(r.x)||lq(r.y)}function lq(r){return r&&r!=="0%"}function NP(r,t,o){const a=r-o,l=t*a;return o+l}function uq(r,t,o,a,l){return l!==void 0&&(r=NP(r,l,a)),NP(r,o,a)+t}function U2(r,t=0,o=1,a,l){r.min=uq(r.min,t,o,a,l),r.max=uq(r.max,t,o,a,l)}function IQ(r,{x:t,y:o}){U2(r.x,t.translate,t.scale,t.originPoint),U2(r.y,o.translate,o.scale,o.originPoint)}function RIe(r,t,o,a=!1){const l=o.length;if(!l)return;t.x=t.y=1;let d,m;for(let v=0;v<l;v++){d=o[v],m=d.projectionDelta;const y=d.instance;y&&y.style&&y.style.display==="contents"||(a&&d.options.layoutScroll&&d.scroll&&d!==d.root&&Vy(r,{x:-d.scroll.offset.x,y:-d.scroll.offset.y}),m&&(t.x*=m.x.scale,t.y*=m.y.scale,IQ(r,m)),a&&b_(d.latestValues)&&Vy(r,d.latestValues))}t.x=dq(t.x),t.y=dq(t.y)}function dq(r){return Number.isInteger(r)||r>1.0000000000001||r<.999999999999?r:1}function pm(r,t){r.min=r.min+t,r.max=r.max+t}function hq(r,t,[o,a,l]){const d=t[l]!==void 0?t[l]:.5,m=eo(r.min,r.max,d);U2(r,t[o],t[a],m,t.scale)}const CIe=["x","scaleX","originX"],IIe=["y","scaleY","originY"];function Vy(r,t){hq(r.x,t,CIe),hq(r.y,t,IIe)}function AQ(r,t){return RQ(wIe(r.getBoundingClientRect(),t))}function AIe(r,t,o){const a=AQ(r,o),{scroll:l}=t;return l&&(pm(a.x,l.offset.x),pm(a.y,l.offset.y)),a}const OQ=({current:r})=>r?r.ownerDocument.defaultView:null,OIe=new WeakMap;class PIe{constructor(t){this.openGlobalLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=Co(),this.visualElement=t}start(t,{snapToCursor:o=!1}={}){const{presenceContext:a}=this.visualElement;if(a&&a.isPresent===!1)return;const l=R=>{const{dragSnapToOrigin:O}=this.getProps();O?this.pauseAnimation():this.stopAnimation(),o&&this.snapToCursor(EN(R,"page").point)},d=(R,O)=>{const{drag:N,dragPropagation:F,onDragStart:H}=this.getProps();if(N&&!F&&(this.openGlobalLock&&this.openGlobalLock(),this.openGlobalLock=WJ(N),!this.openGlobalLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Zl(z=>{let ne=this.getAxisMotionValue(z).get()||0;if(dh.test(ne)){const{projection:J}=this.visualElement;if(J&&J.layout){const oe=J.layout.layoutBox[z];oe&&(ne=ml(oe)*(parseFloat(ne)/100))}}this.originPoint[z]=ne}),H&&_i.postRender(()=>H(R,O));const{animationState:G}=this.visualElement;G&&G.setActive("whileDrag",!0)},m=(R,O)=>{const{dragPropagation:N,dragDirectionLock:F,onDirectionLock:H,onDrag:G}=this.getProps();if(!N&&!this.openGlobalLock)return;const{offset:z}=O;if(F&&this.currentDirection===null){this.currentDirection=NIe(z),this.currentDirection!==null&&H&&H(this.currentDirection);return}this.updateAxis("x",O.point,z),this.updateAxis("y",O.point,z),this.visualElement.render(),G&&G(R,O)},v=(R,O)=>this.stop(R,O),y=()=>Zl(R=>{var O;return this.getAnimationState(R)==="paused"&&((O=this.getAxisMotionValue(R).animation)===null||O===void 0?void 0:O.play())}),{dragSnapToOrigin:b}=this.getProps();this.panSession=new bQ(t,{onSessionStart:l,onStart:d,onMove:m,onSessionEnd:v,resumeAnimation:y},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:b,contextWindow:OQ(this.visualElement)})}stop(t,o){const a=this.isDragging;if(this.cancel(),!a)return;const{velocity:l}=o;this.startAnimation(l);const{onDragEnd:d}=this.getProps();d&&_i.postRender(()=>d(t,o))}cancel(){this.isDragging=!1;const{projection:t,animationState:o}=this.visualElement;t&&(t.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:a}=this.getProps();!a&&this.openGlobalLock&&(this.openGlobalLock(),this.openGlobalLock=null),o&&o.setActive("whileDrag",!1)}updateAxis(t,o,a){const{drag:l}=this.getProps();if(!a||!EO(t,l,this.currentDirection))return;const d=this.getAxisMotionValue(t);let m=this.originPoint[t]+a[t];this.constraints&&this.constraints[t]&&(m=_Ie(m,this.constraints[t],this.elastic[t])),d.set(m)}resolveConstraints(){var t;const{dragConstraints:o,dragElastic:a}=this.getProps(),l=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(t=this.visualElement.projection)===null||t===void 0?void 0:t.layout,d=this.constraints;o&&xy(o)?this.constraints||(this.constraints=this.resolveRefConstraints()):o&&l?this.constraints=vIe(l.layoutBox,o):this.constraints=!1,this.elastic=TIe(a),d!==this.constraints&&l&&this.constraints&&!this.hasMutatedConstraints&&Zl(m=>{this.constraints!==!1&&this.getAxisMotionValue(m)&&(this.constraints[m]=SIe(l.layoutBox[m],this.constraints[m]))})}resolveRefConstraints(){const{dragConstraints:t,onMeasureDragConstraints:o}=this.getProps();if(!t||!xy(t))return!1;const a=t.current,{projection:l}=this.visualElement;if(!l||!l.layout)return!1;const d=AIe(a,l.root,this.visualElement.getTransformPagePoint());let m=EIe(l.layout.layoutBox,d);if(o){const v=o(bIe(m));this.hasMutatedConstraints=!!v,v&&(m=RQ(v))}return m}startAnimation(t){const{drag:o,dragMomentum:a,dragElastic:l,dragTransition:d,dragSnapToOrigin:m,onDragTransitionEnd:v}=this.getProps(),y=this.constraints||{},b=Zl(R=>{if(!EO(R,o,this.currentDirection))return;let O=y&&y[R]||{};m&&(O={min:0,max:0});const N=l?200:1e6,F=l?40:1e7,H={type:"inertia",velocity:a?t[R]:0,bounceStiffness:N,bounceDamping:F,timeConstant:750,restDelta:1,restSpeed:10,...d,...O};return this.startAxisValueAnimation(R,H)});return Promise.all(b).then(v)}startAxisValueAnimation(t,o){const a=this.getAxisMotionValue(t);return a.start(CV(t,a,0,o,this.visualElement))}stopAnimation(){Zl(t=>this.getAxisMotionValue(t).stop())}pauseAnimation(){Zl(t=>{var o;return(o=this.getAxisMotionValue(t).animation)===null||o===void 0?void 0:o.pause()})}getAnimationState(t){var o;return(o=this.getAxisMotionValue(t).animation)===null||o===void 0?void 0:o.state}getAxisMotionValue(t){const o=`_drag${t.toUpperCase()}`,a=this.visualElement.getProps(),l=a[o];return l||this.visualElement.getValue(t,(a.initial?a.initial[t]:void 0)||0)}snapToCursor(t){Zl(o=>{const{drag:a}=this.getProps();if(!EO(o,a,this.currentDirection))return;const{projection:l}=this.visualElement,d=this.getAxisMotionValue(o);if(l&&l.layout){const{min:m,max:v}=l.layout.layoutBox[o];d.set(t[o]-eo(m,v,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:t,dragConstraints:o}=this.getProps(),{projection:a}=this.visualElement;if(!xy(o)||!a||!this.constraints)return;this.stopAnimation();const l={x:0,y:0};Zl(m=>{const v=this.getAxisMotionValue(m);if(v&&this.constraints!==!1){const y=v.get();l[m]=yIe({min:y,max:y},this.constraints[m])}});const{transformTemplate:d}=this.visualElement.getProps();this.visualElement.current.style.transform=d?d({},""):"none",a.root&&a.root.updateScroll(),a.updateLayout(),this.resolveConstraints(),Zl(m=>{if(!EO(m,t,null))return;const v=this.getAxisMotionValue(m),{min:y,max:b}=this.constraints[m];v.set(eo(y,b,l[m]))})}addListeners(){if(!this.visualElement.current)return;OIe.set(this.visualElement,this);const t=this.visualElement.current,o=Bf(t,"pointerdown",y=>{const{drag:b,dragListener:R=!0}=this.getProps();b&&R&&this.start(y)}),a=()=>{const{dragConstraints:y}=this.getProps();xy(y)&&(this.constraints=this.resolveRefConstraints())},{projection:l}=this.visualElement,d=l.addEventListener("measure",a);l&&!l.layout&&(l.root&&l.root.updateScroll(),l.updateLayout()),a();const m=xf(window,"resize",()=>this.scalePositionWithinConstraints()),v=l.addEventListener("didUpdate",({delta:y,hasLayoutChanged:b})=>{this.isDragging&&b&&(Zl(R=>{const O=this.getAxisMotionValue(R);O&&(this.originPoint[R]+=y[R].translate,O.set(O.get()+y[R].translate))}),this.visualElement.render())});return()=>{m(),o(),d(),v&&v()}}getProps(){const t=this.visualElement.getProps(),{drag:o=!1,dragDirectionLock:a=!1,dragPropagation:l=!1,dragConstraints:d=!1,dragElastic:m=x2,dragMomentum:v=!0}=t;return{...t,drag:o,dragDirectionLock:a,dragPropagation:l,dragConstraints:d,dragElastic:m,dragMomentum:v}}}function EO(r,t,o){return(t===!0||t===r)&&(o===null||o===r)}function NIe(r,t=10){let o=null;return Math.abs(r.y)>t?o="y":Math.abs(r.x)>t&&(o="x"),o}class kIe extends Vm{constructor(t){super(t),this.removeGroupControls=Sa,this.removeListeners=Sa,this.controls=new PIe(t)}mount(){const{dragControls:t}=this.node.getProps();t&&(this.removeGroupControls=t.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||Sa}unmount(){this.removeGroupControls(),this.removeListeners()}}const fq=r=>(t,o)=>{r&&_i.postRender(()=>r(t,o))};class DIe extends Vm{constructor(){super(...arguments),this.removePointerDownListener=Sa}onPointerDown(t){this.session=new bQ(t,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:OQ(this.node)})}createPanHandlers(){const{onPanSessionStart:t,onPanStart:o,onPan:a,onPanEnd:l}=this.node.getProps();return{onSessionStart:fq(t),onStart:fq(o),onMove:a,onEnd:(d,m)=>{delete this.session,l&&_i.postRender(()=>l(d,m))}}}mount(){this.removePointerDownListener=Bf(this.node.current,"pointerdown",t=>this.onPointerDown(t))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}function PQ(){const r=V.useContext(Fw);if(r===null)return[!0,null];const{isPresent:t,onExitComplete:o,register:a}=r,l=V.useId();return V.useEffect(()=>a(l),[]),!t&&o?[!1,()=>o&&o(l)]:[!0]}function LIe(){return xIe(V.useContext(Fw))}function xIe(r){return r===null?!0:r.isPresent}const eP={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function pq(r,t){return t.max===t.min?0:r/(t.max-t.min)*100}const ib={correct:(r,t)=>{if(!t.target)return r;if(typeof r=="string")if(An.test(r))r=parseFloat(r);else return r;const o=pq(r,t.target.x),a=pq(r,t.target.y);return`${o}% ${a}%`}},MIe={correct:(r,{treeScale:t,projectionDelta:o})=>{const a=r,l=Nm.parse(r);if(l.length>5)return a;const d=Nm.createTransformer(r),m=typeof l[0]!="number"?1:0,v=o.x.scale*t.x,y=o.y.scale*t.y;l[0+m]/=v,l[1+m]/=y;const b=eo(v,y,.5);return typeof l[2+m]=="number"&&(l[2+m]/=b),typeof l[3+m]=="number"&&(l[3+m]/=b),d(l)}};class UIe extends V.Component{componentDidMount(){const{visualElement:t,layoutGroup:o,switchLayoutGroup:a,layoutId:l}=this.props,{projection:d}=t;Lwe(VIe),d&&(o.group&&o.group.add(d),a&&a.register&&l&&a.register(d),d.root.didUpdate(),d.addEventListener("animationComplete",()=>{this.safeToRemove()}),d.setOptions({...d.options,onExitComplete:()=>this.safeToRemove()})),eP.hasEverUpdated=!0}getSnapshotBeforeUpdate(t){const{layoutDependency:o,visualElement:a,drag:l,isPresent:d}=this.props,m=a.projection;return m&&(m.isPresent=d,l||t.layoutDependency!==o||o===void 0?m.willUpdate():this.safeToRemove(),t.isPresent!==d&&(d?m.promote():m.relegate()||_i.postRender(()=>{const v=m.getStack();(!v||!v.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:t}=this.props.visualElement;t&&(t.root.didUpdate(),iV.postRender(()=>{!t.currentAnimation&&t.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:t,layoutGroup:o,switchLayoutGroup:a}=this.props,{projection:l}=t;l&&(l.scheduleCheckAfterUnmount(),o&&o.group&&o.group.remove(l),a&&a.deregister&&a.deregister(l))}safeToRemove(){const{safeToRemove:t}=this.props;t&&t()}render(){return null}}function NQ(r){const[t,o]=PQ(),a=V.useContext(aV);return D.jsx(UIe,{...r,layoutGroup:a,switchLayoutGroup:V.useContext(CJ),isPresent:t,safeToRemove:o})}const VIe={borderRadius:{...ib,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:ib,borderTopRightRadius:ib,borderBottomLeftRadius:ib,borderBottomRightRadius:ib,boxShadow:MIe},kQ=["TopLeft","TopRight","BottomLeft","BottomRight"],FIe=kQ.length,mq=r=>typeof r=="string"?parseFloat(r):r,gq=r=>typeof r=="number"||An.test(r);function jIe(r,t,o,a,l,d){l?(r.opacity=eo(0,o.opacity!==void 0?o.opacity:1,BIe(a)),r.opacityExit=eo(t.opacity!==void 0?t.opacity:1,0,WIe(a))):d&&(r.opacity=eo(t.opacity!==void 0?t.opacity:1,o.opacity!==void 0?o.opacity:1,a));for(let m=0;m<FIe;m++){const v=`border${kQ[m]}Radius`;let y=_q(t,v),b=_q(o,v);if(y===void 0&&b===void 0)continue;y||(y=0),b||(b=0),y===0||b===0||gq(y)===gq(b)?(r[v]=Math.max(eo(mq(y),mq(b),a),0),(dh.test(b)||dh.test(y))&&(r[v]+="%")):r[v]=b}(t.rotate||o.rotate)&&(r.rotate=eo(t.rotate||0,o.rotate||0,a))}function _q(r,t){return r[t]!==void 0?r[t]:r.borderRadius}const BIe=DQ(0,.5,mQ),WIe=DQ(.5,.95,Sa);function DQ(r,t,o){return a=>a<r?0:a>t?1:o(fw(r,t,a))}function vq(r,t){r.min=t.min,r.max=t.max}function Xl(r,t){vq(r.x,t.x),vq(r.y,t.y)}function Eq(r,t,o,a,l){return r-=t,r=NP(r,1/o,a),l!==void 0&&(r=NP(r,1/l,a)),r}function GIe(r,t=0,o=1,a=.5,l,d=r,m=r){if(dh.test(t)&&(t=parseFloat(t),t=eo(m.min,m.max,t/100)-m.min),typeof t!="number")return;let v=eo(d.min,d.max,a);r===d&&(v-=t),r.min=Eq(r.min,t,o,v,l),r.max=Eq(r.max,t,o,v,l)}function yq(r,t,[o,a,l],d,m){GIe(r,t[o],t[a],t[l],t.scale,d,m)}const zIe=["x","scaleX","originX"],HIe=["y","scaleY","originY"];function Sq(r,t,o,a){yq(r.x,t,zIe,o?o.x:void 0,a?a.x:void 0),yq(r.y,t,HIe,o?o.y:void 0,a?a.y:void 0)}function Tq(r){return r.translate===0&&r.scale===1}function LQ(r){return Tq(r.x)&&Tq(r.y)}function KIe(r,t){return r.x.min===t.x.min&&r.x.max===t.x.max&&r.y.min===t.y.min&&r.y.max===t.y.max}function xQ(r,t){return Math.round(r.x.min)===Math.round(t.x.min)&&Math.round(r.x.max)===Math.round(t.x.max)&&Math.round(r.y.min)===Math.round(t.y.min)&&Math.round(r.y.max)===Math.round(t.y.max)}function bq(r){return ml(r.x)/ml(r.y)}class $Ie{constructor(){this.members=[]}add(t){IV(this.members,t),t.scheduleRender()}remove(t){if(AV(this.members,t),t===this.prevLead&&(this.prevLead=void 0),t===this.lead){const o=this.members[this.members.length-1];o&&this.promote(o)}}relegate(t){const o=this.members.findIndex(l=>t===l);if(o===0)return!1;let a;for(let l=o;l>=0;l--){const d=this.members[l];if(d.isPresent!==!1){a=d;break}}return a?(this.promote(a),!0):!1}promote(t,o){const a=this.lead;if(t!==a&&(this.prevLead=a,this.lead=t,t.show(),a)){a.instance&&a.scheduleRender(),t.scheduleRender(),t.resumeFrom=a,o&&(t.resumeFrom.preserveOpacity=!0),a.snapshot&&(t.snapshot=a.snapshot,t.snapshot.latestValues=a.animationValues||a.latestValues),t.root&&t.root.isUpdating&&(t.isLayoutDirty=!0);const{crossfade:l}=t.options;l===!1&&a.hide()}}exitAnimationComplete(){this.members.forEach(t=>{const{options:o,resumingFrom:a}=t;o.onExitComplete&&o.onExitComplete(),a&&a.options.onExitComplete&&a.options.onExitComplete()})}scheduleRender(){this.members.forEach(t=>{t.instance&&t.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function wq(r,t,o){let a="";const l=r.x.translate/t.x,d=r.y.translate/t.y,m=(o==null?void 0:o.z)||0;if((l||d||m)&&(a=`translate3d(${l}px, ${d}px, ${m}px) `),(t.x!==1||t.y!==1)&&(a+=`scale(${1/t.x}, ${1/t.y}) `),o){const{transformPerspective:b,rotate:R,rotateX:O,rotateY:N,skewX:F,skewY:H}=o;b&&(a=`perspective(${b}px) ${a}`),R&&(a+=`rotate(${R}deg) `),O&&(a+=`rotateX(${O}deg) `),N&&(a+=`rotateY(${N}deg) `),F&&(a+=`skewX(${F}deg) `),H&&(a+=`skewY(${H}deg) `)}const v=r.x.scale*t.x,y=r.y.scale*t.y;return(v!==1||y!==1)&&(a+=`scale(${v}, ${y})`),a||"none"}const qIe=(r,t)=>r.depth-t.depth;class YIe{constructor(){this.children=[],this.isDirty=!1}add(t){IV(this.children,t),this.isDirty=!0}remove(t){AV(this.children,t),this.isDirty=!0}forEach(t){this.isDirty&&this.children.sort(qIe),this.isDirty=!1,this.children.forEach(t)}}function XIe(r,t){const o=bm.now(),a=({timestamp:l})=>{const d=l-o;d>=t&&(Pm(a),r(d-t))};return _i.read(a,!0),()=>Pm(a)}function JIe(r){window.MotionDebug&&window.MotionDebug.record(r)}function QIe(r){return r instanceof SVGElement&&r.tagName!=="svg"}function ZIe(r,t,o){const a=ya(r)?r:pw(r);return a.start(CV("",a,t,o)),a.animation}const EM=["","X","Y","Z"],eAe={visibility:"hidden"},Rq=1e3;let tAe=0;const w_={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0};function yM(r,t,o,a){const{latestValues:l}=t;l[r]&&(o[r]=l[r],t.setStaticValue(r,0),a&&(a[r]=0))}function MQ({attachResizeListener:r,defaultParent:t,measureScroll:o,checkIsScrollRoot:a,resetTransform:l}){return class{constructor(m={},v=t==null?void 0:t()){this.id=tAe++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,w_.totalNodes=w_.resolvedTargetDeltas=w_.recalculatedProjection=0,this.nodes.forEach(iAe),this.nodes.forEach(lAe),this.nodes.forEach(uAe),this.nodes.forEach(oAe),JIe(w_)},this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=m,this.root=v?v.root||v:this,this.path=v?[...v.path,v]:[],this.parent=v,this.depth=v?v.depth+1:0;for(let y=0;y<this.path.length;y++)this.path[y].shouldResetTransform=!0;this.root===this&&(this.nodes=new YIe)}addEventListener(m,v){return this.eventHandlers.has(m)||this.eventHandlers.set(m,new OV),this.eventHandlers.get(m).add(v)}notifyListeners(m,...v){const y=this.eventHandlers.get(m);y&&y.notify(...v)}hasListeners(m){return this.eventHandlers.has(m)}mount(m,v=this.root.hasTreeAnimated){if(this.instance)return;this.isSVG=QIe(m),this.instance=m;const{layoutId:y,layout:b,visualElement:R}=this.options;if(R&&!R.current&&R.mount(m),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),v&&(b||y)&&(this.isLayoutDirty=!0),r){let O;const N=()=>this.root.updateBlockedByResize=!1;r(m,()=>{this.root.updateBlockedByResize=!0,O&&O(),O=XIe(N,250),eP.hasAnimatedSinceResize&&(eP.hasAnimatedSinceResize=!1,this.nodes.forEach(Iq))})}y&&this.root.registerSharedNode(y,this),this.options.animate!==!1&&R&&(y||b)&&this.addEventListener("didUpdate",({delta:O,hasLayoutChanged:N,hasRelativeTargetChanged:F,layout:H})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const G=this.options.transition||R.getDefaultTransition()||mAe,{onLayoutAnimationStart:z,onLayoutAnimationComplete:ne}=R.getProps(),J=!this.targetLayout||!xQ(this.targetLayout,H)||F,oe=!N&&F;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||oe||N&&(J||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(O,oe);const se={..._V(G,"layout"),onPlay:z,onComplete:ne};(R.shouldReduceMotion||this.options.layoutRoot)&&(se.delay=0,se.type=!1),this.startAnimation(se)}else N||Iq(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=H})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const m=this.getStack();m&&m.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,Pm(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,window.HandoffCancelAllAnimations&&window.HandoffCancelAllAnimations(),this.nodes&&this.nodes.forEach(dAe),this.animationId++)}getTransformTemplate(){const{visualElement:m}=this.options;return m&&m.getProps().transformTemplate}willUpdate(m=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let R=0;R<this.path.length;R++){const O=this.path[R];O.shouldResetTransform=!0,O.updateScroll("snapshot"),O.options.layoutRoot&&O.willUpdate(!1)}const{layoutId:v,layout:y}=this.options;if(v===void 0&&!y)return;const b=this.getTransformTemplate();this.prevTransformTemplateValue=b?b(this.latestValues,""):void 0,this.updateSnapshot(),m&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(Cq);return}this.isUpdating||this.nodes.forEach(aAe),this.isUpdating=!1,this.nodes.forEach(cAe),this.nodes.forEach(nAe),this.nodes.forEach(rAe),this.clearAllSnapshots();const v=bm.now();Ws.delta=Om(0,1e3/60,v-Ws.timestamp),Ws.timestamp=v,Ws.isProcessing=!0,uM.update.process(Ws),uM.preRender.process(Ws),uM.render.process(Ws),Ws.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,iV.read(()=>this.update()))}clearAllSnapshots(){this.nodes.forEach(sAe),this.sharedNodes.forEach(hAe)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,_i.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){_i.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure())}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let y=0;y<this.path.length;y++)this.path[y].updateScroll();const m=this.layout;this.layout=this.measure(!1),this.layoutCorrected=Co(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:v}=this.options;v&&v.notify("LayoutMeasure",this.layout.layoutBox,m?m.layoutBox:void 0)}updateScroll(m="measure"){let v=!!(this.options.layoutScroll&&this.instance);this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===m&&(v=!1),v&&(this.scroll={animationId:this.root.animationId,phase:m,isRoot:a(this.instance),offset:o(this.instance)})}resetTransform(){if(!l)return;const m=this.isLayoutDirty||this.shouldResetTransform,v=this.projectionDelta&&!LQ(this.projectionDelta),y=this.getTransformTemplate(),b=y?y(this.latestValues,""):void 0,R=b!==this.prevTransformTemplateValue;m&&(v||b_(this.latestValues)||R)&&(l(this.instance,b),this.shouldResetTransform=!1,this.scheduleRender())}measure(m=!0){const v=this.measurePageBox();let y=this.removeElementScroll(v);return m&&(y=this.removeTransform(y)),gAe(y),{animationId:this.root.animationId,measuredBox:v,layoutBox:y,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:m}=this.options;if(!m)return Co();const v=m.measureViewportBox(),{scroll:y}=this.root;return y&&(pm(v.x,y.offset.x),pm(v.y,y.offset.y)),v}removeElementScroll(m){const v=Co();Xl(v,m);for(let y=0;y<this.path.length;y++){const b=this.path[y],{scroll:R,options:O}=b;if(b!==this.root&&R&&O.layoutScroll){if(R.isRoot){Xl(v,m);const{scroll:N}=this.root;N&&(pm(v.x,-N.offset.x),pm(v.y,-N.offset.y))}pm(v.x,R.offset.x),pm(v.y,R.offset.y)}}return v}applyTransform(m,v=!1){const y=Co();Xl(y,m);for(let b=0;b<this.path.length;b++){const R=this.path[b];!v&&R.options.layoutScroll&&R.scroll&&R!==R.root&&Vy(y,{x:-R.scroll.offset.x,y:-R.scroll.offset.y}),b_(R.latestValues)&&Vy(y,R.latestValues)}return b_(this.latestValues)&&Vy(y,this.latestValues),y}removeTransform(m){const v=Co();Xl(v,m);for(let y=0;y<this.path.length;y++){const b=this.path[y];if(!b.instance||!b_(b.latestValues))continue;M2(b.latestValues)&&b.updateSnapshot();const R=Co(),O=b.measurePageBox();Xl(R,O),Sq(v,b.latestValues,b.snapshot?b.snapshot.layoutBox:void 0,R)}return b_(this.latestValues)&&Sq(v,this.latestValues),v}setTargetDelta(m){this.targetDelta=m,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(m){this.options={...this.options,...m,crossfade:m.crossfade!==void 0?m.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Ws.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(m=!1){var v;const y=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=y.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=y.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=y.isSharedProjectionDirty);const b=!!this.resumingFrom||this!==y;if(!(m||b&&this.isSharedProjectionDirty||this.isProjectionDirty||!((v=this.parent)===null||v===void 0)&&v.isProjectionDirty||this.attemptToResolveRelativeTarget))return;const{layout:O,layoutId:N}=this.options;if(!(!this.layout||!(O||N))){if(this.resolvedRelativeTargetAt=Ws.timestamp,!this.targetDelta&&!this.relativeTarget){const F=this.getClosestProjectingParent();F&&F.layout&&this.animationProgress!==1?(this.relativeParent=F,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Co(),this.relativeTargetOrigin=Co(),$b(this.relativeTargetOrigin,this.layout.layoutBox,F.layout.layoutBox),Xl(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)){if(this.target||(this.target=Co(),this.targetWithTransforms=Co()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),gIe(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Xl(this.target,this.layout.layoutBox),IQ(this.target,this.targetDelta)):Xl(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const F=this.getClosestProjectingParent();F&&!!F.resumingFrom==!!this.resumingFrom&&!F.options.layoutScroll&&F.target&&this.animationProgress!==1?(this.relativeParent=F,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Co(),this.relativeTargetOrigin=Co(),$b(this.relativeTargetOrigin,this.target,F.target),Xl(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}w_.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(!(!this.parent||M2(this.parent.latestValues)||CQ(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var m;const v=this.getLead(),y=!!this.resumingFrom||this!==v;let b=!0;if((this.isProjectionDirty||!((m=this.parent)===null||m===void 0)&&m.isProjectionDirty)&&(b=!1),y&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(b=!1),this.resolvedRelativeTargetAt===Ws.timestamp&&(b=!1),b)return;const{layout:R,layoutId:O}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(R||O))return;Xl(this.layoutCorrected,this.layout.layoutBox);const N=this.treeScale.x,F=this.treeScale.y;RIe(this.layoutCorrected,this.treeScale,this.path,y),v.layout&&!v.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(v.target=v.layout.layoutBox,v.targetWithTransforms=Co());const{target:H}=v;if(!H){this.projectionTransform&&(this.projectionDelta=Uy(),this.projectionTransform="none",this.scheduleRender());return}this.projectionDelta||(this.projectionDelta=Uy(),this.projectionDeltaWithTransform=Uy());const G=this.projectionTransform;Kb(this.projectionDelta,this.layoutCorrected,H,this.latestValues),this.projectionTransform=wq(this.projectionDelta,this.treeScale),(this.projectionTransform!==G||this.treeScale.x!==N||this.treeScale.y!==F)&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",H)),w_.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(m=!0){if(this.options.scheduleRender&&this.options.scheduleRender(),m){const v=this.getStack();v&&v.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}setAnimationOrigin(m,v=!1){const y=this.snapshot,b=y?y.latestValues:{},R={...this.latestValues},O=Uy();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!v;const N=Co(),F=y?y.source:void 0,H=this.layout?this.layout.source:void 0,G=F!==H,z=this.getStack(),ne=!z||z.members.length<=1,J=!!(G&&!ne&&this.options.crossfade===!0&&!this.path.some(pAe));this.animationProgress=0;let oe;this.mixTargetDelta=se=>{const ae=se/1e3;Aq(O.x,m.x,ae),Aq(O.y,m.y,ae),this.setTargetDelta(O),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&($b(N,this.layout.layoutBox,this.relativeParent.layout.layoutBox),fAe(this.relativeTarget,this.relativeTargetOrigin,N,ae),oe&&KIe(this.relativeTarget,oe)&&(this.isProjectionDirty=!1),oe||(oe=Co()),Xl(oe,this.relativeTarget)),G&&(this.animationValues=R,jIe(R,b,this.latestValues,ae,J,ne)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=ae},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(m){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(Pm(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=_i.update(()=>{eP.hasAnimatedSinceResize=!0,this.currentAnimation=ZIe(0,Rq,{...m,onUpdate:v=>{this.mixTargetDelta(v),m.onUpdate&&m.onUpdate(v)},onComplete:()=>{m.onComplete&&m.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const m=this.getStack();m&&m.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(Rq),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const m=this.getLead();let{targetWithTransforms:v,target:y,layout:b,latestValues:R}=m;if(!(!v||!y||!b)){if(this!==m&&this.layout&&b&&UQ(this.options.animationType,this.layout.layoutBox,b.layoutBox)){y=this.target||Co();const O=ml(this.layout.layoutBox.x);y.x.min=m.target.x.min,y.x.max=y.x.min+O;const N=ml(this.layout.layoutBox.y);y.y.min=m.target.y.min,y.y.max=y.y.min+N}Xl(v,y),Vy(v,R),Kb(this.projectionDeltaWithTransform,this.layoutCorrected,v,R)}}registerSharedNode(m,v){this.sharedNodes.has(m)||this.sharedNodes.set(m,new $Ie),this.sharedNodes.get(m).add(v);const b=v.options.initialPromotionConfig;v.promote({transition:b?b.transition:void 0,preserveFollowOpacity:b&&b.shouldPreserveFollowOpacity?b.shouldPreserveFollowOpacity(v):void 0})}isLead(){const m=this.getStack();return m?m.lead===this:!0}getLead(){var m;const{layoutId:v}=this.options;return v?((m=this.getStack())===null||m===void 0?void 0:m.lead)||this:this}getPrevLead(){var m;const{layoutId:v}=this.options;return v?(m=this.getStack())===null||m===void 0?void 0:m.prevLead:void 0}getStack(){const{layoutId:m}=this.options;if(m)return this.root.sharedNodes.get(m)}promote({needsReset:m,transition:v,preserveFollowOpacity:y}={}){const b=this.getStack();b&&b.promote(this,y),m&&(this.projectionDelta=void 0,this.needsReset=!0),v&&this.setOptions({transition:v})}relegate(){const m=this.getStack();return m?m.relegate(this):!1}resetSkewAndRotation(){const{visualElement:m}=this.options;if(!m)return;let v=!1;const{latestValues:y}=m;if((y.z||y.rotate||y.rotateX||y.rotateY||y.rotateZ||y.skewX||y.skewY)&&(v=!0),!v)return;const b={};y.z&&yM("z",m,b,this.animationValues);for(let R=0;R<EM.length;R++)yM(`rotate${EM[R]}`,m,b,this.animationValues),yM(`skew${EM[R]}`,m,b,this.animationValues);m.render();for(const R in b)m.setStaticValue(R,b[R]),this.animationValues&&(this.animationValues[R]=b[R]);m.scheduleRender()}getProjectionStyles(m){var v,y;if(!this.instance||this.isSVG)return;if(!this.isVisible)return eAe;const b={visibility:""},R=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,b.opacity="",b.pointerEvents=QO(m==null?void 0:m.pointerEvents)||"",b.transform=R?R(this.latestValues,""):"none",b;const O=this.getLead();if(!this.projectionDelta||!this.layout||!O.target){const G={};return this.options.layoutId&&(G.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,G.pointerEvents=QO(m==null?void 0:m.pointerEvents)||""),this.hasProjected&&!b_(this.latestValues)&&(G.transform=R?R({},""):"none",this.hasProjected=!1),G}const N=O.animationValues||O.latestValues;this.applyTransformsToTarget(),b.transform=wq(this.projectionDeltaWithTransform,this.treeScale,N),R&&(b.transform=R(N,b.transform));const{x:F,y:H}=this.projectionDelta;b.transformOrigin=`${F.origin*100}% ${H.origin*100}% 0`,O.animationValues?b.opacity=O===this?(y=(v=N.opacity)!==null&&v!==void 0?v:this.latestValues.opacity)!==null&&y!==void 0?y:1:this.preserveOpacity?this.latestValues.opacity:N.opacityExit:b.opacity=O===this?N.opacity!==void 0?N.opacity:"":N.opacityExit!==void 0?N.opacityExit:0;for(const G in CP){if(N[G]===void 0)continue;const{correct:z,applyTo:ne}=CP[G],J=b.transform==="none"?N[G]:z(N[G],O);if(ne){const oe=ne.length;for(let se=0;se<oe;se++)b[ne[se]]=J}else b[G]=J}return this.options.layoutId&&(b.pointerEvents=O===this?QO(m==null?void 0:m.pointerEvents)||"":"none"),b}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(m=>{var v;return(v=m.currentAnimation)===null||v===void 0?void 0:v.stop()}),this.root.nodes.forEach(Cq),this.root.sharedNodes.clear()}}}function nAe(r){r.updateLayout()}function rAe(r){var t;const o=((t=r.resumeFrom)===null||t===void 0?void 0:t.snapshot)||r.snapshot;if(r.isLead()&&r.layout&&o&&r.hasListeners("didUpdate")){const{layoutBox:a,measuredBox:l}=r.layout,{animationType:d}=r.options,m=o.source!==r.layout.source;d==="size"?Zl(O=>{const N=m?o.measuredBox[O]:o.layoutBox[O],F=ml(N);N.min=a[O].min,N.max=N.min+F}):UQ(d,o.layoutBox,a)&&Zl(O=>{const N=m?o.measuredBox[O]:o.layoutBox[O],F=ml(a[O]);N.max=N.min+F,r.relativeTarget&&!r.currentAnimation&&(r.isProjectionDirty=!0,r.relativeTarget[O].max=r.relativeTarget[O].min+F)});const v=Uy();Kb(v,a,o.layoutBox);const y=Uy();m?Kb(y,r.applyTransform(l,!0),o.measuredBox):Kb(y,a,o.layoutBox);const b=!LQ(v);let R=!1;if(!r.resumeFrom){const O=r.getClosestProjectingParent();if(O&&!O.resumeFrom){const{snapshot:N,layout:F}=O;if(N&&F){const H=Co();$b(H,o.layoutBox,N.layoutBox);const G=Co();$b(G,a,F.layoutBox),xQ(H,G)||(R=!0),O.options.layoutRoot&&(r.relativeTarget=G,r.relativeTargetOrigin=H,r.relativeParent=O)}}}r.notifyListeners("didUpdate",{layout:a,snapshot:o,delta:y,layoutDelta:v,hasLayoutChanged:b,hasRelativeTargetChanged:R})}else if(r.isLead()){const{onExitComplete:a}=r.options;a&&a()}r.options.transition=void 0}function iAe(r){w_.totalNodes++,r.parent&&(r.isProjecting()||(r.isProjectionDirty=r.parent.isProjectionDirty),r.isSharedProjectionDirty||(r.isSharedProjectionDirty=!!(r.isProjectionDirty||r.parent.isProjectionDirty||r.parent.isSharedProjectionDirty)),r.isTransformDirty||(r.isTransformDirty=r.parent.isTransformDirty))}function oAe(r){r.isProjectionDirty=r.isSharedProjectionDirty=r.isTransformDirty=!1}function sAe(r){r.clearSnapshot()}function Cq(r){r.clearMeasurements()}function aAe(r){r.isLayoutDirty=!1}function cAe(r){const{visualElement:t}=r.options;t&&t.getProps().onBeforeLayoutMeasure&&t.notify("BeforeLayoutMeasure"),r.resetTransform()}function Iq(r){r.finishAnimation(),r.targetDelta=r.relativeTarget=r.target=void 0,r.isProjectionDirty=!0}function lAe(r){r.resolveTargetDelta()}function uAe(r){r.calcProjection()}function dAe(r){r.resetSkewAndRotation()}function hAe(r){r.removeLeadSnapshot()}function Aq(r,t,o){r.translate=eo(t.translate,0,o),r.scale=eo(t.scale,1,o),r.origin=t.origin,r.originPoint=t.originPoint}function Oq(r,t,o,a){r.min=eo(t.min,o.min,a),r.max=eo(t.max,o.max,a)}function fAe(r,t,o,a){Oq(r.x,t.x,o.x,a),Oq(r.y,t.y,o.y,a)}function pAe(r){return r.animationValues&&r.animationValues.opacityExit!==void 0}const mAe={duration:.45,ease:[.4,0,.1,1]},Pq=r=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(r),Nq=Pq("applewebkit/")&&!Pq("chrome/")?Math.round:Sa;function kq(r){r.min=Nq(r.min),r.max=Nq(r.max)}function gAe(r){kq(r.x),kq(r.y)}function UQ(r,t,o){return r==="position"||r==="preserve-aspect"&&!L2(bq(t),bq(o),.2)}const _Ae=MQ({attachResizeListener:(r,t)=>xf(r,"resize",t),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),SM={current:void 0},VQ=MQ({measureScroll:r=>({x:r.scrollLeft,y:r.scrollTop}),defaultParent:()=>{if(!SM.current){const r=new _Ae({});r.mount(window),r.setOptions({layoutScroll:!0}),SM.current=r}return SM.current},resetTransform:(r,t)=>{r.style.transform=t!==void 0?t:"none"},checkIsScrollRoot:r=>window.getComputedStyle(r).position==="fixed"}),vAe={pan:{Feature:DIe},drag:{Feature:kIe,ProjectionNode:VQ,MeasureLayout:NQ}},V2={current:null},FQ={current:!1};function EAe(){if(FQ.current=!0,!!tV)if(window.matchMedia){const r=window.matchMedia("(prefers-reduced-motion)"),t=()=>V2.current=r.matches;r.addListener(t),t()}else V2.current=!1}function yAe(r,t,o){const{willChange:a}=t;for(const l in t){const d=t[l],m=o[l];if(ya(d))r.addValue(l,d),PP(a)&&a.add(l);else if(ya(m))r.addValue(l,pw(d,{owner:r})),PP(a)&&a.remove(l);else if(m!==d)if(r.hasValue(l)){const v=r.getValue(l);v.liveStyle===!0?v.jump(d):v.hasAnimated||v.set(d)}else{const v=r.getStaticValue(l);r.addValue(l,pw(v!==void 0?v:d,{owner:r}))}}for(const l in o)t[l]===void 0&&r.removeValue(l);return t}const Dq=new WeakMap,SAe=[...JJ,_a,Nm],TAe=r=>SAe.find(XJ(r)),jQ=Object.keys(dw),bAe=jQ.length,Lq=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"],wAe=sV.length;function BQ(r){if(r)return r.options.allowProjection!==!1?r.projection:BQ(r.parent)}class RAe{scrapeMotionValuesFromProps(t,o,a){return{}}constructor({parent:t,props:o,presenceContext:a,reducedMotionConfig:l,blockInitialAnimation:d,visualState:m},v={}){this.resolveKeyframes=(N,F,H,G)=>new this.KeyframeResolver(N,F,H,G,this),this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=vV,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.scheduleRender=()=>_i.render(this.render,!1,!0);const{latestValues:y,renderState:b}=m;this.latestValues=y,this.baseTarget={...y},this.initialValues=o.initial?{...y}:{},this.renderState=b,this.parent=t,this.props=o,this.presenceContext=a,this.depth=t?t.depth+1:0,this.reducedMotionConfig=l,this.options=v,this.blockInitialAnimation=!!d,this.isControllingVariants=vN(o),this.isVariantNode=RJ(o),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(t&&t.current);const{willChange:R,...O}=this.scrapeMotionValuesFromProps(o,{},this);for(const N in O){const F=O[N];y[N]!==void 0&&ya(F)&&(F.set(y[N],!1),PP(R)&&R.add(N))}}mount(t){this.current=t,Dq.set(t,this),this.projection&&!this.projection.instance&&this.projection.mount(t),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((o,a)=>this.bindToMotionValue(a,o)),FQ.current||EAe(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:V2.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){var t;Dq.delete(this.current),this.projection&&this.projection.unmount(),Pm(this.notifyUpdate),Pm(this.render),this.valueSubscriptions.forEach(o=>o()),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const o in this.events)this.events[o].clear();for(const o in this.features)(t=this.features[o])===null||t===void 0||t.unmount();this.current=null}bindToMotionValue(t,o){const a=sv.has(t),l=o.on("change",m=>{this.latestValues[t]=m,this.props.onUpdate&&_i.preRender(this.notifyUpdate),a&&this.projection&&(this.projection.isTransformDirty=!0)}),d=o.on("renderRequest",this.scheduleRender);this.valueSubscriptions.set(t,()=>{l(),d(),o.owner&&o.stop()})}sortNodePosition(t){return!this.current||!this.sortInstanceNodePosition||this.type!==t.type?0:this.sortInstanceNodePosition(this.current,t.current)}loadFeatures({children:t,...o},a,l,d){let m,v;for(let y=0;y<bAe;y++){const b=jQ[y],{isEnabled:R,Feature:O,ProjectionNode:N,MeasureLayout:F}=dw[b];N&&(m=N),R(o)&&(!this.features[b]&&O&&(this.features[b]=new O(this)),F&&(v=F))}if((this.type==="html"||this.type==="svg")&&!this.projection&&m){const{layoutId:y,layout:b,drag:R,dragConstraints:O,layoutScroll:N,layoutRoot:F}=o;this.projection=new m(this.latestValues,o["data-framer-portal-id"]?void 0:BQ(this.parent)),this.projection.setOptions({layoutId:y,layout:b,alwaysMeasureLayout:!!R||O&&xy(O),visualElement:this,scheduleRender:()=>this.scheduleRender(),animationType:typeof b=="string"?b:"both",initialPromotionConfig:d,layoutScroll:N,layoutRoot:F})}return v}updateFeatures(){for(const t in this.features){const o=this.features[t];o.isMounted?o.update():(o.mount(),o.isMounted=!0)}}triggerBuild(){this.build(this.renderState,this.latestValues,this.options,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):Co()}getStaticValue(t){return this.latestValues[t]}setStaticValue(t,o){this.latestValues[t]=o}update(t,o){(t.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=t,this.prevPresenceContext=this.presenceContext,this.presenceContext=o;for(let a=0;a<Lq.length;a++){const l=Lq[a];this.propEventSubscriptions[l]&&(this.propEventSubscriptions[l](),delete this.propEventSubscriptions[l]);const d="on"+l,m=t[d];m&&(this.propEventSubscriptions[l]=this.on(l,m))}this.prevMotionValues=yAe(this,this.scrapeMotionValuesFromProps(t,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(t){return this.props.variants?this.props.variants[t]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}getVariantContext(t=!1){if(t)return this.parent?this.parent.getVariantContext():void 0;if(!this.isControllingVariants){const a=this.parent?this.parent.getVariantContext()||{}:{};return this.props.initial!==void 0&&(a.initial=this.props.initial),a}const o={};for(let a=0;a<wAe;a++){const l=sV[a],d=this.props[l];(uw(d)||d===!1)&&(o[l]=d)}return o}addVariantChild(t){const o=this.getClosestVariantNode();if(o)return o.variantChildren&&o.variantChildren.add(t),()=>o.variantChildren.delete(t)}addValue(t,o){const a=this.values.get(t);o!==a&&(a&&this.removeValue(t),this.bindToMotionValue(t,o),this.values.set(t,o),this.latestValues[t]=o.get())}removeValue(t){this.values.delete(t);const o=this.valueSubscriptions.get(t);o&&(o(),this.valueSubscriptions.delete(t)),delete this.latestValues[t],this.removeValueFromRenderState(t,this.renderState)}hasValue(t){return this.values.has(t)}getValue(t,o){if(this.props.values&&this.props.values[t])return this.props.values[t];let a=this.values.get(t);return a===void 0&&o!==void 0&&(a=pw(o===null?void 0:o,{owner:this}),this.addValue(t,a)),a}readValue(t,o){var a;let l=this.latestValues[t]!==void 0||!this.current?this.latestValues[t]:(a=this.getBaseTargetFromProps(this.props,t))!==null&&a!==void 0?a:this.readValueFromInstance(this.current,t,this.options);return l!=null&&(typeof l=="string"&&(qJ(l)||KJ(l))?l=parseFloat(l):!TAe(l)&&Nm.test(o)&&(l=oQ(t,o)),this.setBaseTarget(t,ya(l)?l.get():l)),ya(l)?l.get():l}setBaseTarget(t,o){this.baseTarget[t]=o}getBaseTarget(t){var o;const{initial:a}=this.props;let l;if(typeof a=="string"||typeof a=="object"){const m=gV(this.props,a,(o=this.presenceContext)===null||o===void 0?void 0:o.custom);m&&(l=m[t])}if(a&&l!==void 0)return l;const d=this.getBaseTargetFromProps(this.props,t);return d!==void 0&&!ya(d)?d:this.initialValues[t]!==void 0&&l===void 0?void 0:this.baseTarget[t]}on(t,o){return this.events[t]||(this.events[t]=new OV),this.events[t].add(o)}notify(t,...o){this.events[t]&&this.events[t].notify(...o)}}class WQ extends RAe{constructor(){super(...arguments),this.KeyframeResolver=sQ}sortInstanceNodePosition(t,o){return t.compareDocumentPosition(o)&2?1:-1}getBaseTargetFromProps(t,o){return t.style?t.style[o]:void 0}removeValueFromRenderState(t,{vars:o,style:a}){delete o[t],delete a[t]}}function CAe(r){return window.getComputedStyle(r)}class IAe extends WQ{constructor(){super(...arguments),this.type="html"}readValueFromInstance(t,o){if(sv.has(o)){const a=yV(o);return a&&a.default||0}else{const a=CAe(t),l=(OJ(o)?a.getPropertyValue(o):a[o])||0;return typeof l=="string"?l.trim():l}}measureInstanceViewportBox(t,{transformPagePoint:o}){return AQ(t,o)}build(t,o,a,l){dV(t,o,a,l.transformTemplate)}scrapeMotionValuesFromProps(t,o,a){return mV(t,o,a)}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:t}=this.props;ya(t)&&(this.childSubscription=t.on("change",o=>{this.current&&(this.current.textContent=`${o}`)}))}renderInstance(t,o,a,l){LJ(t,o,a,l)}}class AAe extends WQ{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1}getBaseTargetFromProps(t,o){return t[o]}readValueFromInstance(t,o){if(sv.has(o)){const a=yV(o);return a&&a.default||0}return o=xJ.has(o)?o:rV(o),t.getAttribute(o)}measureInstanceViewportBox(){return Co()}scrapeMotionValuesFromProps(t,o,a){return UJ(t,o,a)}build(t,o,a,l){fV(t,o,a,this.isSVGTag,l.transformTemplate)}renderInstance(t,o,a,l){MJ(t,o,a,l)}mount(t){this.isSVGTag=pV(t.tagName),super.mount(t)}}const OAe=(r,t)=>cV(r)?new AAe(t,{enableHardwareAcceleration:!1}):new IAe(t,{allowProjection:r!==V.Fragment,enableHardwareAcceleration:!0}),PAe={layout:{ProjectionNode:VQ,MeasureLayout:NQ}},NAe={...hIe,...TRe,...vAe,...PAe},bh=kwe((r,t)=>lRe(r,t,NAe,OAe));function GQ(){const r=V.useRef(!1);return nV(()=>(r.current=!0,()=>{r.current=!1}),[]),r}function kAe(){const r=GQ(),[t,o]=V.useState(0),a=V.useCallback(()=>{r.current&&o(t+1)},[t]);return[V.useCallback(()=>_i.postRender(a),[a]),t]}class DAe extends V.Component{getSnapshotBeforeUpdate(t){const o=this.props.childRef.current;if(o&&t.isPresent&&!this.props.isPresent){const a=this.props.sizeRef.current;a.height=o.offsetHeight||0,a.width=o.offsetWidth||0,a.top=o.offsetTop,a.left=o.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function LAe({children:r,isPresent:t}){const o=V.useId(),a=V.useRef(null),l=V.useRef({width:0,height:0,top:0,left:0}),{nonce:d}=V.useContext(eV);return V.useInsertionEffect(()=>{const{width:m,height:v,top:y,left:b}=l.current;if(t||!a.current||!m||!v)return;a.current.dataset.motionPopId=o;const R=document.createElement("style");return d&&(R.nonce=d),document.head.appendChild(R),R.sheet&&R.sheet.insertRule(`
          [data-motion-pop-id="${o}"] {
            position: absolute !important;
            width: ${m}px !important;
            height: ${v}px !important;
            top: ${y}px !important;
            left: ${b}px !important;
          }
        `),()=>{document.head.removeChild(R)}},[t]),D.jsx(DAe,{isPresent:t,childRef:a,sizeRef:l,children:V.cloneElement(r,{ref:a})})}const TM=({children:r,initial:t,isPresent:o,onExitComplete:a,custom:l,presenceAffectsLayout:d,mode:m})=>{const v=VJ(xAe),y=V.useId(),b=V.useMemo(()=>({id:y,initial:t,isPresent:o,custom:l,onExitComplete:R=>{v.set(R,!0);for(const O of v.values())if(!O)return;a&&a()},register:R=>(v.set(R,!1),()=>v.delete(R))}),d?[Math.random()]:[o]);return V.useMemo(()=>{v.forEach((R,O)=>v.set(O,!1))},[o]),V.useEffect(()=>{!o&&!v.size&&a&&a()},[o]),m==="popLayout"&&(r=D.jsx(LAe,{isPresent:o,children:r})),D.jsx(Fw.Provider,{value:b,children:r})};function xAe(){return new Map}function MAe(r){return V.useEffect(()=>()=>r(),[])}const R_=r=>r.key||"";function UAe(r,t){r.forEach(o=>{const a=R_(o);t.set(a,o)})}function VAe(r){const t=[];return V.Children.forEach(r,o=>{V.isValidElement(o)&&t.push(o)}),t}const CS=({children:r,custom:t,initial:o=!0,onExitComplete:a,exitBeforeEnter:l,presenceAffectsLayout:d=!0,mode:m="sync"})=>{const v=V.useContext(aV).forceRender||kAe()[0],y=GQ(),b=VAe(r);let R=b;const O=V.useRef(new Map).current,N=V.useRef(R),F=V.useRef(new Map).current,H=V.useRef(!0);if(nV(()=>{H.current=!1,UAe(b,F),N.current=R}),MAe(()=>{H.current=!0,F.clear(),O.clear()}),H.current)return D.jsx(D.Fragment,{children:R.map(J=>D.jsx(TM,{isPresent:!0,initial:o?void 0:!1,presenceAffectsLayout:d,mode:m,children:J},R_(J)))});R=[...R];const G=N.current.map(R_),z=b.map(R_),ne=G.length;for(let J=0;J<ne;J++){const oe=G[J];z.indexOf(oe)===-1&&!O.has(oe)&&O.set(oe,void 0)}return m==="wait"&&O.size&&(R=[]),O.forEach((J,oe)=>{if(z.indexOf(oe)!==-1)return;const se=F.get(oe);if(!se)return;const ae=G.indexOf(oe);let ye=J;if(!ye){const Q=()=>{O.delete(oe);const te=Array.from(F.keys()).filter(re=>!z.includes(re));if(te.forEach(re=>F.delete(re)),N.current=b.filter(re=>{const le=R_(re);return le===oe||te.includes(le)}),!O.size){if(y.current===!1)return;v(),a&&a()}};ye=D.jsx(TM,{isPresent:!1,onExitComplete:Q,custom:t,presenceAffectsLayout:d,mode:m,children:se},R_(se)),O.set(oe,ye)}R.splice(ae,0,ye)}),R=R.map(J=>{const oe=J.key;return O.has(oe)?J:D.jsx(TM,{isPresent:!0,presenceAffectsLayout:d,mode:m,children:J},R_(J))}),D.jsx(D.Fragment,{children:O.size?R:R.map(J=>V.cloneElement(J))})};var FAe={initial:r=>{const{position:t}=r,o=["top","bottom"].includes(t)?"y":"x";let a=["top-right","bottom-right"].includes(t)?1:-1;return t==="bottom"&&(a=1),{opacity:0,[o]:a*24}},animate:{opacity:1,y:0,x:0,scale:1,transition:{duration:.4,ease:[.4,0,.2,1]}},exit:{opacity:0,scale:.85,transition:{duration:.2,ease:[.4,0,1,1]}}},zQ=V.memo(r=>{const{id:t,message:o,onCloseComplete:a,onRequestRemove:l,requestClose:d=!1,position:m="bottom",duration:v=5e3,containerStyle:y,motionVariants:b=FAe,toastSpacing:R="0.5rem"}=r,[O,N]=V.useState(v),F=LIe();Am(()=>{F||a==null||a()},[F]),Am(()=>{N(v)},[v]);const H=()=>N(null),G=()=>N(v),z=()=>{F&&l()};V.useEffect(()=>{F&&d&&l()},[F,d,l]),Ewe(z,O);const ne=V.useMemo(()=>({pointerEvents:"auto",maxWidth:560,minWidth:300,margin:R,...y}),[y,R]),J=V.useMemo(()=>_we(m),[m]);return D.jsx(bh.div,{layout:!0,className:"chakra-toast",variants:b,initial:"initial",animate:"animate",exit:"exit",onHoverStart:H,onHoverEnd:G,custom:{position:m},style:J,children:D.jsx(Pt.div,{role:"status","aria-atomic":"true",className:"chakra-toast__inner",__css:ne,children:tu(o,{id:t,onClose:z})})})});zQ.displayName="ToastComponent";function jAe(r,t){var o;const a=r??"bottom",d={"top-start":{ltr:"top-left",rtl:"top-right"},"top-end":{ltr:"top-right",rtl:"top-left"},"bottom-start":{ltr:"bottom-left",rtl:"bottom-right"},"bottom-end":{ltr:"bottom-right",rtl:"bottom-left"}}[a];return(o=d==null?void 0:d[t])!=null?o:a}var xq={path:D.jsxs("g",{stroke:"currentColor",strokeWidth:"1.5",children:[D.jsx("path",{strokeLinecap:"round",fill:"none",d:"M9,9a3,3,0,1,1,4,2.829,1.5,1.5,0,0,0-1,1.415V14.25"}),D.jsx("path",{fill:"currentColor",strokeLinecap:"round",d:"M12,17.25a.375.375,0,1,0,.375.375A.375.375,0,0,0,12,17.25h0"}),D.jsx("circle",{fill:"none",strokeMiterlimit:"10",cx:"12",cy:"12",r:"11.25"})]}),viewBox:"0 0 24 24"},Fm=zt((r,t)=>{const{as:o,viewBox:a,color:l="currentColor",focusable:d=!1,children:m,className:v,__css:y,...b}=r,R=In("chakra-icon",v),O=cu("Icon",r),N={w:"1em",h:"1em",display:"inline-block",lineHeight:"1em",flexShrink:0,color:l,...y,...O},F={ref:t,focusable:d,className:R,__css:N},H=a??xq.viewBox;if(o&&typeof o!="string")return D.jsx(Pt.svg,{as:o,...F,...b});const G=m??xq.path;return D.jsx(Pt.svg,{verticalAlign:"middle",viewBox:H,...F,...b,children:G})});Fm.displayName="Icon";function IS(r){const{viewBox:t="0 0 24 24",d:o,displayName:a,defaultProps:l={}}=r,d=V.Children.toArray(r.path),m=zt((v,y)=>D.jsx(Fm,{ref:y,viewBox:t,...l,...v,children:d.length?d:D.jsx("path",{fill:"currentColor",d:o})}));return m.displayName=a,m}function BAe(r){return D.jsx(Fm,{viewBox:"0 0 24 24",...r,children:D.jsx("path",{fill:"currentColor",d:"M12,0A12,12,0,1,0,24,12,12.014,12.014,0,0,0,12,0Zm6.927,8.2-6.845,9.289a1.011,1.011,0,0,1-1.43.188L5.764,13.769a1,1,0,1,1,1.25-1.562l4.076,3.261,6.227-8.451A1,1,0,1,1,18.927,8.2Z"})})}function WAe(r){return D.jsx(Fm,{viewBox:"0 0 24 24",...r,children:D.jsx("path",{fill:"currentColor",d:"M12,0A12,12,0,1,0,24,12,12.013,12.013,0,0,0,12,0Zm.25,5a1.5,1.5,0,1,1-1.5,1.5A1.5,1.5,0,0,1,12.25,5ZM14.5,18.5h-4a1,1,0,0,1,0-2h.75a.25.25,0,0,0,.25-.25v-4.5a.25.25,0,0,0-.25-.25H10.5a1,1,0,0,1,0-2h1a2,2,0,0,1,2,2v4.75a.25.25,0,0,0,.25.25h.75a1,1,0,1,1,0,2Z"})})}function Mq(r){return D.jsx(Fm,{viewBox:"0 0 24 24",...r,children:D.jsx("path",{fill:"currentColor",d:"M11.983,0a12.206,12.206,0,0,0-8.51,3.653A11.8,11.8,0,0,0,0,12.207,11.779,11.779,0,0,0,11.8,24h.214A12.111,12.111,0,0,0,24,11.791h0A11.766,11.766,0,0,0,11.983,0ZM10.5,16.542a1.476,1.476,0,0,1,1.449-1.53h.027a1.527,1.527,0,0,1,1.523,1.47,1.475,1.475,0,0,1-1.449,1.53h-.027A1.529,1.529,0,0,1,10.5,16.542ZM11,12.5v-6a1,1,0,0,1,2,0v6a1,1,0,1,1-2,0Z"})})}var GAe=Mw({"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}}),zw=zt((r,t)=>{const o=cu("Spinner",r),{label:a="Loading...",thickness:l="2px",speed:d="0.45s",emptyColor:m="transparent",className:v,...y}=Ki(r),b=In("chakra-spinner",v),R={display:"inline-block",borderColor:"currentColor",borderStyle:"solid",borderRadius:"99999px",borderWidth:l,borderBottomColor:m,borderLeftColor:m,animation:`${GAe} ${d} linear infinite`,...o};return D.jsx(Pt.div,{ref:t,__css:R,className:b,...y,children:a&&D.jsx(Pt.span,{srOnly:!0,children:a})})});zw.displayName="Spinner";var[zAe,PV]=Hi({name:"AlertContext",hookName:"useAlertContext",providerName:"<Alert />"}),[HAe,NV]=Hi({name:"AlertStylesContext",hookName:"useAlertStyles",providerName:"<Alert />"}),HQ={info:{icon:WAe,colorScheme:"blue"},warning:{icon:Mq,colorScheme:"orange"},success:{icon:BAe,colorScheme:"green"},error:{icon:Mq,colorScheme:"red"},loading:{icon:zw,colorScheme:"blue"}};function KAe(r){return HQ[r].colorScheme}function $Ae(r){return HQ[r].icon}var KQ=zt(function(t,o){const a=NV(),{status:l}=PV(),d={display:"inline",...a.description};return D.jsx(Pt.div,{ref:o,"data-status":l,...t,className:In("chakra-alert__desc",t.className),__css:d})});KQ.displayName="AlertDescription";function TN(r){const{status:t}=PV(),o=$Ae(t),a=NV(),l=t==="loading"?a.spinner:a.icon;return D.jsx(Pt.span,{display:"inherit","data-status":t,...r,className:In("chakra-alert__icon",r.className),__css:l,children:r.children||D.jsx(o,{h:"100%",w:"100%"})})}TN.displayName="AlertIcon";var $Q=zt(function(t,o){const a=NV(),{status:l}=PV();return D.jsx(Pt.div,{ref:o,"data-status":l,...t,className:In("chakra-alert__title",t.className),__css:a.title})});$Q.displayName="AlertTitle";var bN=zt(function(t,o){var a;const{status:l="info",addRole:d=!0,...m}=Ki(t),v=(a=t.colorScheme)!=null?a:KAe(l),y=xc("Alert",{...t,colorScheme:v}),b={width:"100%",display:"flex",alignItems:"center",position:"relative",overflow:"hidden",...y.container};return D.jsx(zAe,{value:{status:l},children:D.jsx(HAe,{value:y,children:D.jsx(Pt.div,{"data-status":l,role:d?"alert":void 0,ref:o,...m,className:In("chakra-alert",t.className),__css:b})})})});bN.displayName="Alert";function qAe(r){return D.jsx(Fm,{focusable:"false","aria-hidden":!0,...r,children:D.jsx("path",{fill:"currentColor",d:"M.439,21.44a1.5,1.5,0,0,0,2.122,2.121L11.823,14.3a.25.25,0,0,1,.354,0l9.262,9.263a1.5,1.5,0,1,0,2.122-2.121L14.3,12.177a.25.25,0,0,1,0-.354l9.263-9.262A1.5,1.5,0,0,0,21.439.44L12.177,9.7a.25.25,0,0,1-.354,0L2.561.44A1.5,1.5,0,0,0,.439,2.561L9.7,11.823a.25.25,0,0,1,0,.354Z"})})}var mw=zt(function(t,o){const a=cu("CloseButton",t),{children:l,isDisabled:d,__css:m,...v}=Ki(t),y={outline:0,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0};return D.jsx(Pt.button,{type:"button","aria-label":"Close",ref:o,disabled:d,__css:{...y,...a,...m},...v,children:l||D.jsx(qAe,{width:"1em",height:"1em"})})});mw.displayName="CloseButton";var YAe={top:[],"top-left":[],"top-right":[],"bottom-left":[],bottom:[],"bottom-right":[]},ih=XAe(YAe);function XAe(r){let t=r;const o=new Set,a=l=>{t=l(t),o.forEach(d=>d())};return{getState:()=>t,subscribe:l=>(o.add(l),()=>{a(()=>r),o.delete(l)}),removeToast:(l,d)=>{a(m=>({...m,[d]:m[d].filter(v=>v.id!=l)}))},notify:(l,d)=>{const m=JAe(l,d),{position:v,id:y}=m;return a(b=>{var R,O;const F=v.includes("top")?[m,...(R=b[v])!=null?R:[]]:[...(O=b[v])!=null?O:[],m];return{...b,[v]:F}}),y},update:(l,d)=>{l&&a(m=>{const v={...m},{position:y,index:b}=C$(v,l);return y&&b!==-1&&(v[y][b]={...v[y][b],...d,message:qQ(d)}),v})},closeAll:({positions:l}={})=>{a(d=>(l??["bottom","bottom-right","bottom-left","top","top-left","top-right"]).reduce((y,b)=>(y[b]=d[b].map(R=>({...R,requestClose:!0})),y),{...d}))},close:l=>{a(d=>{const m=SJ(d,l);return m?{...d,[m]:d[m].map(v=>v.id==l?{...v,requestClose:!0}:v)}:d})},isActive:l=>!!C$(ih.getState(),l).position}}var Uq=0;function JAe(r,t={}){var o,a;Uq+=1;const l=(o=t.id)!=null?o:Uq,d=(a=t.position)!=null?a:"bottom";return{id:l,message:r,position:d,duration:t.duration,onCloseComplete:t.onCloseComplete,onRequestRemove:()=>ih.removeToast(String(l),d),status:t.status,requestClose:!1,containerStyle:t.containerStyle}}var QAe=r=>{const{status:t,variant:o="solid",id:a,title:l,isClosable:d,onClose:m,description:v,colorScheme:y,icon:b}=r,R=a?{root:`toast-${a}`,title:`toast-${a}-title`,description:`toast-${a}-description`}:void 0;return D.jsxs(bN,{addRole:!1,status:t,variant:o,id:R==null?void 0:R.root,alignItems:"start",borderRadius:"md",boxShadow:"lg",paddingEnd:8,textAlign:"start",width:"auto",colorScheme:y,children:[D.jsx(TN,{children:b}),D.jsxs(Pt.div,{flex:"1",maxWidth:"100%",children:[l&&D.jsx($Q,{id:R==null?void 0:R.title,children:l}),v&&D.jsx(KQ,{id:R==null?void 0:R.description,display:"block",children:v})]}),d&&D.jsx(mw,{size:"sm",onClick:m,position:"absolute",insetEnd:1,top:1})]})};function qQ(r={}){const{render:t,toastComponent:o=QAe}=r;return l=>typeof t=="function"?t({...l,...r}):D.jsx(o,{...l,...r})}function ZAe(r,t){const o=l=>{var d;return{...t,...l,position:jAe((d=l==null?void 0:l.position)!=null?d:t==null?void 0:t.position,r)}},a=l=>{const d=o(l),m=qQ(d);return ih.notify(m,d)};return a.update=(l,d)=>{ih.update(l,o(d))},a.promise=(l,d)=>{const m=a({...d.loading,status:"loading",duration:null});l.then(v=>a.update(m,{status:"success",duration:5e3,...tu(d.success,v)})).catch(v=>a.update(m,{status:"error",duration:5e3,...tu(d.error,v)}))},a.closeAll=ih.closeAll,a.close=ih.close,a.isActive=ih.isActive,a}var[eOe,tOe]=Hi({name:"ToastOptionsContext",strict:!1}),nOe=r=>{const t=V.useSyncExternalStore(ih.subscribe,ih.getState,ih.getState),{motionVariants:o,component:a=zQ,portalProps:l}=r,m=Object.keys(t).map(v=>{const y=t[v];return D.jsx("div",{role:"region","aria-live":"polite","aria-label":`Notifications-${v}`,id:`chakra-toast-manager-${v}`,style:vwe(v),children:D.jsx(CS,{initial:!1,children:y.map(b=>D.jsx(a,{motionVariants:o,...b},b.id))})},v)});return D.jsx(au,{...l,children:m})};function Hw(r){const{theme:t}=WX(),o=tOe();return V.useMemo(()=>ZAe(t.direction,{...o,...r}),[r,t.direction,o])}var rOe=r=>function({children:o,theme:a=r,toastOptions:l,...d}){return D.jsxs(mwe,{theme:a,...d,children:[D.jsx(eOe,{value:l==null?void 0:l.defaultOptions,children:o}),D.jsx(nOe,{...l})]})},wN=rOe(Dbe),iOe=Object.defineProperty,oOe=(r,t,o)=>t in r?iOe(r,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):r[t]=o,mo=(r,t,o)=>(oOe(r,typeof t!="symbol"?t+"":t,o),o);function Vq(r){return r.sort((t,o)=>{const a=t.compareDocumentPosition(o);if(a&Node.DOCUMENT_POSITION_FOLLOWING||a&Node.DOCUMENT_POSITION_CONTAINED_BY)return-1;if(a&Node.DOCUMENT_POSITION_PRECEDING||a&Node.DOCUMENT_POSITION_CONTAINS)return 1;if(a&Node.DOCUMENT_POSITION_DISCONNECTED||a&Node.DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC)throw Error("Cannot sort the given nodes.");return 0})}var sOe=r=>typeof r=="object"&&"nodeType"in r&&r.nodeType===Node.ELEMENT_NODE;function Fq(r,t,o){let a=r+1;return o&&a>=t&&(a=0),a}function jq(r,t,o){let a=r-1;return o&&a<0&&(a=t),a}var F2=typeof window<"u"?V.useLayoutEffect:V.useEffect,kP=r=>r,aOe=class{constructor(){mo(this,"descendants",new Map),mo(this,"register",r=>{if(r!=null)return sOe(r)?this.registerNode(r):t=>{this.registerNode(t,r)}}),mo(this,"unregister",r=>{this.descendants.delete(r);const t=Vq(Array.from(this.descendants.keys()));this.assignIndex(t)}),mo(this,"destroy",()=>{this.descendants.clear()}),mo(this,"assignIndex",r=>{this.descendants.forEach(t=>{const o=r.indexOf(t.node);t.index=o,t.node.dataset.index=t.index.toString()})}),mo(this,"count",()=>this.descendants.size),mo(this,"enabledCount",()=>this.enabledValues().length),mo(this,"values",()=>Array.from(this.descendants.values()).sort((t,o)=>t.index-o.index)),mo(this,"enabledValues",()=>this.values().filter(r=>!r.disabled)),mo(this,"item",r=>{if(this.count()!==0)return this.values()[r]}),mo(this,"enabledItem",r=>{if(this.enabledCount()!==0)return this.enabledValues()[r]}),mo(this,"first",()=>this.item(0)),mo(this,"firstEnabled",()=>this.enabledItem(0)),mo(this,"last",()=>this.item(this.descendants.size-1)),mo(this,"lastEnabled",()=>{const r=this.enabledValues().length-1;return this.enabledItem(r)}),mo(this,"indexOf",r=>{var t,o;return r&&(o=(t=this.descendants.get(r))==null?void 0:t.index)!=null?o:-1}),mo(this,"enabledIndexOf",r=>r==null?-1:this.enabledValues().findIndex(t=>t.node.isSameNode(r))),mo(this,"next",(r,t=!0)=>{const o=Fq(r,this.count(),t);return this.item(o)}),mo(this,"nextEnabled",(r,t=!0)=>{const o=this.item(r);if(!o)return;const a=this.enabledIndexOf(o.node),l=Fq(a,this.enabledCount(),t);return this.enabledItem(l)}),mo(this,"prev",(r,t=!0)=>{const o=jq(r,this.count()-1,t);return this.item(o)}),mo(this,"prevEnabled",(r,t=!0)=>{const o=this.item(r);if(!o)return;const a=this.enabledIndexOf(o.node),l=jq(a,this.enabledCount()-1,t);return this.enabledItem(l)}),mo(this,"registerNode",(r,t)=>{if(!r||this.descendants.has(r))return;const o=Array.from(this.descendants.keys()).concat(r),a=Vq(o);t!=null&&t.disabled&&(t.disabled=!!t.disabled);const l={node:r,index:-1,...t};this.descendants.set(r,l),this.assignIndex(a)})}};function cOe(r,t){if(r!=null){if(typeof r=="function"){r(t);return}try{r.current=t}catch{throw new Error(`Cannot assign value '${t}' to ref '${r}'`)}}}function zi(...r){return t=>{r.forEach(o=>{cOe(o,t)})}}function lOe(...r){return V.useMemo(()=>zi(...r),r)}function uOe(){const r=V.useRef(new aOe);return F2(()=>()=>r.current.destroy()),r.current}var[dOe,YQ]=Hi({name:"DescendantsProvider",errorMessage:"useDescendantsContext must be used within DescendantsProvider"});function hOe(r){const t=YQ(),[o,a]=V.useState(-1),l=V.useRef(null);F2(()=>()=>{l.current&&t.unregister(l.current)},[]),F2(()=>{if(!l.current)return;const m=Number(l.current.dataset.index);o!=m&&!Number.isNaN(m)&&a(m)});const d=kP(r?t.register(r):t.register);return{descendants:t,index:o,enabledIndex:t.enabledIndexOf(l.current),register:zi(d,l)}}function XQ(){return[kP(dOe),()=>kP(YQ()),()=>uOe(),l=>hOe(l)]}function JQ(r){const{value:t,defaultValue:o,onChange:a,shouldUpdate:l=(N,F)=>N!==F}=r,d=Pc(a),m=Pc(l),[v,y]=V.useState(o),b=t!==void 0,R=b?t:v,O=Pc(N=>{const H=typeof N=="function"?N(R):N;m(R,H)&&(b||y(H),d(H))},[b,d,R,m]);return[R,O]}var Bq={easeIn:[.4,0,1,1],easeOut:[0,0,.2,1]},j_={enter:{duration:.2,ease:Bq.easeOut},exit:{duration:.1,ease:Bq.easeIn}},B_={enter:(r,t)=>({...r,delay:typeof t=="number"?t:t==null?void 0:t.enter}),exit:(r,t)=>({...r,delay:typeof t=="number"?t:t==null?void 0:t.exit})},fOe={enter:({transition:r,transitionEnd:t,delay:o}={})=>{var a;return{opacity:1,transition:(a=r==null?void 0:r.enter)!=null?a:B_.enter(j_.enter,o),transitionEnd:t==null?void 0:t.enter}},exit:({transition:r,transitionEnd:t,delay:o}={})=>{var a;return{opacity:0,transition:(a=r==null?void 0:r.exit)!=null?a:B_.exit(j_.exit,o),transitionEnd:t==null?void 0:t.exit}}},QQ={initial:"exit",animate:"enter",exit:"exit",variants:fOe},pOe=V.forwardRef(function(t,o){const{unmountOnExit:a,in:l,className:d,transition:m,transitionEnd:v,delay:y,...b}=t,R=l||a?"enter":"exit",O=a?l&&a:!0,N={transition:m,transitionEnd:v,delay:y};return D.jsx(CS,{custom:N,children:O&&D.jsx(bh.div,{ref:o,className:In("chakra-fade",d),custom:N,...QQ,animate:R,...b})})});pOe.displayName="Fade";var mOe={exit:({reverse:r,initialScale:t,transition:o,transitionEnd:a,delay:l})=>{var d;return{opacity:0,...r?{scale:t,transitionEnd:a==null?void 0:a.exit}:{transitionEnd:{scale:t,...a==null?void 0:a.exit}},transition:(d=o==null?void 0:o.exit)!=null?d:B_.exit(j_.exit,l)}},enter:({transitionEnd:r,transition:t,delay:o})=>{var a;return{opacity:1,scale:1,transition:(a=t==null?void 0:t.enter)!=null?a:B_.enter(j_.enter,o),transitionEnd:r==null?void 0:r.enter}}},ZQ={initial:"exit",animate:"enter",exit:"exit",variants:mOe},gOe=V.forwardRef(function(t,o){const{unmountOnExit:a,in:l,reverse:d=!0,initialScale:m=.95,className:v,transition:y,transitionEnd:b,delay:R,...O}=t,N=a?l&&a:!0,F=l||a?"enter":"exit",H={initialScale:m,reverse:d,transition:y,transitionEnd:b,delay:R};return D.jsx(CS,{custom:H,children:N&&D.jsx(bh.div,{ref:o,className:In("chakra-offset-slide",v),...ZQ,animate:F,custom:H,...O})})});gOe.displayName="ScaleFade";var _Oe={initial:({offsetX:r,offsetY:t,transition:o,transitionEnd:a,delay:l})=>{var d;return{opacity:0,x:r,y:t,transition:(d=o==null?void 0:o.exit)!=null?d:B_.exit(j_.exit,l),transitionEnd:a==null?void 0:a.exit}},enter:({transition:r,transitionEnd:t,delay:o})=>{var a;return{opacity:1,x:0,y:0,transition:(a=r==null?void 0:r.enter)!=null?a:B_.enter(j_.enter,o),transitionEnd:t==null?void 0:t.enter}},exit:({offsetY:r,offsetX:t,transition:o,transitionEnd:a,reverse:l,delay:d})=>{var m;const v={x:t,y:r};return{opacity:0,transition:(m=o==null?void 0:o.exit)!=null?m:B_.exit(j_.exit,d),...l?{...v,transitionEnd:a==null?void 0:a.exit}:{transitionEnd:{...v,...a==null?void 0:a.exit}}}}},Ib={initial:"initial",animate:"enter",exit:"exit",variants:_Oe},vOe=V.forwardRef(function(t,o){const{unmountOnExit:a,in:l,reverse:d=!0,className:m,offsetX:v=0,offsetY:y=8,transition:b,transitionEnd:R,delay:O,...N}=t,F=a?l&&a:!0,H=l||a?"enter":"exit",G={offsetX:v,offsetY:y,reverse:d,transition:b,transitionEnd:R,delay:O};return D.jsx(CS,{custom:G,children:F&&D.jsx(bh.div,{ref:o,className:In("chakra-offset-slide",m),custom:G,...Ib,animate:H,...N})})});vOe.displayName="SlideFade";var[EOe,yOe]=Hi({name:"AvatarStylesContext",hookName:"useAvatarStyles",providerName:"<Avatar/>"});function SOe(r){var t;const o=r.split(" "),a=(t=o[0])!=null?t:"",l=o.length>1?o[o.length-1]:"";return a&&l?`${a.charAt(0)}${l.charAt(0)}`:a.charAt(0)}function eZ(r){const{name:t,getInitials:o,...a}=r,l=yOe();return D.jsx(Pt.div,{role:"img","aria-label":t,...a,__css:l.label,children:t?o==null?void 0:o(t):null})}eZ.displayName="AvatarName";var tZ=r=>D.jsxs(Pt.svg,{viewBox:"0 0 128 128",color:"#fff",width:"100%",height:"100%",className:"chakra-avatar__svg",...r,children:[D.jsx("path",{fill:"currentColor",d:"M103,102.1388 C93.094,111.92 79.3504,118 64.1638,118 C48.8056,118 34.9294,111.768 25,101.7892 L25,95.2 C25,86.8096 31.981,80 40.6,80 L87.4,80 C96.019,80 103,86.8096 103,95.2 L103,102.1388 Z"}),D.jsx("path",{fill:"currentColor",d:"M63.9961647,24 C51.2938136,24 41,34.2938136 41,46.9961647 C41,59.7061864 51.2938136,70 63.9961647,70 C76.6985159,70 87,59.7061864 87,46.9961647 C87,34.2938136 76.6985159,24 63.9961647,24"})]}),j2=zt(function(t,o){const{htmlWidth:a,htmlHeight:l,alt:d,...m}=t;return D.jsx("img",{width:a,height:l,ref:o,alt:d,...m})});j2.displayName="NativeImage";function nZ(r){const{loading:t,src:o,srcSet:a,onLoad:l,onError:d,crossOrigin:m,sizes:v,ignoreFallback:y}=r,[b,R]=V.useState("pending");V.useEffect(()=>{R(o?"loading":"pending")},[o]);const O=V.useRef(),N=V.useCallback(()=>{if(!o)return;F();const H=new Image;H.src=o,m&&(H.crossOrigin=m),a&&(H.srcset=a),v&&(H.sizes=v),t&&(H.loading=t),H.onload=G=>{F(),R("loaded"),l==null||l(G)},H.onerror=G=>{F(),R("failed"),d==null||d(G)},O.current=H},[o,m,a,v,l,d,t]),F=()=>{O.current&&(O.current.onload=null,O.current.onerror=null,O.current=null)};return Ff(()=>{if(!y)return b==="loading"&&N(),()=>{F()}},[b,N,y]),y?"loaded":b}var TOe=(r,t)=>r!=="loaded"&&t==="beforeLoadOrError"||r==="failed"&&t==="onError";function bOe(r,t=[]){const o=Object.assign({},r);for(const a of t)a in o&&delete o[a];return o}var kV=zt(function(t,o){const{fallbackSrc:a,fallback:l,src:d,srcSet:m,align:v,fit:y,loading:b,ignoreFallback:R,crossOrigin:O,fallbackStrategy:N="beforeLoadOrError",referrerPolicy:F,...H}=t,G=a!==void 0||l!==void 0,z=b!=null||R||!G,ne=nZ({...t,crossOrigin:O,ignoreFallback:z}),J=TOe(ne,N),oe={ref:o,objectFit:y,objectPosition:v,...z?H:bOe(H,["onError","onLoad"])};return J?l||D.jsx(Pt.img,{as:j2,className:"chakra-image__placeholder",src:a,...oe}):D.jsx(Pt.img,{as:j2,src:d,srcSet:m,crossOrigin:O,loading:b,referrerPolicy:F,className:"chakra-image",...oe})});kV.displayName="Image";function rZ(r){const{src:t,srcSet:o,onError:a,onLoad:l,getInitials:d,name:m,borderRadius:v,loading:y,iconLabel:b,icon:R=D.jsx(tZ,{}),ignoreFallback:O,referrerPolicy:N,crossOrigin:F}=r,G=nZ({src:t,onError:a,crossOrigin:F,ignoreFallback:O})==="loaded";return!t||!G?m?D.jsx(eZ,{className:"chakra-avatar__initials",getInitials:d,name:m}):V.cloneElement(R,{role:"img","aria-label":b}):D.jsx(Pt.img,{src:t,srcSet:o,alt:m,onLoad:l,referrerPolicy:N,crossOrigin:F??void 0,className:"chakra-avatar__img",loading:y,__css:{width:"100%",height:"100%",objectFit:"cover",borderRadius:v}})}rZ.displayName="AvatarImage";var wOe={display:"inline-flex",alignItems:"center",justifyContent:"center",textAlign:"center",textTransform:"uppercase",fontWeight:"medium",position:"relative",flexShrink:0},Eh=zt((r,t)=>{const o=xc("Avatar",r),[a,l]=V.useState(!1),{src:d,srcSet:m,name:v,showBorder:y,borderRadius:b="full",onError:R,onLoad:O,getInitials:N=SOe,icon:F=D.jsx(tZ,{}),iconLabel:H=" avatar",loading:G,children:z,borderColor:ne,ignoreFallback:J,crossOrigin:oe,referrerPolicy:se,...ae}=Ki(r),ye={borderRadius:b,borderWidth:y?"2px":void 0,...wOe,...o.container};return ne&&(ye.borderColor=ne),D.jsx(Pt.span,{ref:t,...ae,className:In("chakra-avatar",r.className),"data-loaded":cr(a),__css:ye,children:D.jsxs(EOe,{value:o,children:[D.jsx(rZ,{src:d,srcSet:m,loading:G,onLoad:rr(O,()=>{l(!0)}),onError:R,getInitials:N,name:v,borderRadius:b,icon:F,iconLabel:H,ignoreFallback:J,crossOrigin:oe,referrerPolicy:se}),z]})})});Eh.displayName="Avatar";function DV(r){return V.Children.toArray(r).filter(t=>V.isValidElement(t))}var[P5e,ROe]=Hi({strict:!1,name:"ButtonGroupContext"});function COe(r){const[t,o]=V.useState(!r);return{ref:V.useCallback(d=>{d&&o(d.tagName==="BUTTON")},[]),type:t?"button":void 0}}function B2(r){const{children:t,className:o,...a}=r,l=V.isValidElement(t)?V.cloneElement(t,{"aria-hidden":!0,focusable:!1}):t,d=In("chakra-button__icon",o);return D.jsx(Pt.span,{display:"inline-flex",alignSelf:"center",flexShrink:0,...a,className:d,children:l})}B2.displayName="ButtonIcon";function W2(r){const{label:t,placement:o,spacing:a="0.5rem",children:l=D.jsx(zw,{color:"currentColor",width:"1em",height:"1em"}),className:d,__css:m,...v}=r,y=In("chakra-button__spinner",d),b=o==="start"?"marginEnd":"marginStart",R=V.useMemo(()=>({display:"flex",alignItems:"center",position:t?"relative":"absolute",[b]:t?a:0,fontSize:"1em",lineHeight:"normal",...m}),[m,t,b,a]);return D.jsx(Pt.div,{className:y,...v,__css:R,children:l})}W2.displayName="ButtonSpinner";var Nc=zt((r,t)=>{const o=ROe(),a=cu("Button",{...o,...r}),{isDisabled:l=o==null?void 0:o.isDisabled,isLoading:d,isActive:m,children:v,leftIcon:y,rightIcon:b,loadingText:R,iconSpacing:O="0.5rem",type:N,spinner:F,spinnerPlacement:H="start",className:G,as:z,...ne}=Ki(r),J=V.useMemo(()=>{const ye={...a==null?void 0:a._focus,zIndex:1};return{display:"inline-flex",appearance:"none",alignItems:"center",justifyContent:"center",userSelect:"none",position:"relative",whiteSpace:"nowrap",verticalAlign:"middle",outline:"none",...a,...!!o&&{_focus:ye}}},[a,o]),{ref:oe,type:se}=COe(z),ae={rightIcon:b,leftIcon:y,iconSpacing:O,children:v};return D.jsxs(Pt.button,{ref:lOe(t,oe),as:z,type:N??se,"data-active":cr(m),"data-loading":cr(d),__css:J,className:In("chakra-button",G),...ne,disabled:l||d,children:[d&&H==="start"&&D.jsx(W2,{className:"chakra-button__spinner--start",label:R,placement:"start",spacing:O,children:F}),d?R||D.jsx(Pt.span,{opacity:0,children:D.jsx(Wq,{...ae})}):D.jsx(Wq,{...ae}),d&&H==="end"&&D.jsx(W2,{className:"chakra-button__spinner--end",label:R,placement:"end",spacing:O,children:F})]})});Nc.displayName="Button";function Wq(r){const{leftIcon:t,rightIcon:o,children:a,iconSpacing:l}=r;return D.jsxs(D.Fragment,{children:[t&&D.jsx(B2,{marginEnd:l,children:t}),a,o&&D.jsx(B2,{marginStart:l,children:o})]})}var ul=zt((r,t)=>{const{icon:o,children:a,isRound:l,"aria-label":d,...m}=r,v=o||a,y=V.isValidElement(v)?V.cloneElement(v,{"aria-hidden":!0,focusable:!1}):null;return D.jsx(Nc,{padding:"0",borderRadius:l?"full":void 0,ref:t,"aria-label":d,...m,children:y})});ul.displayName="IconButton";var[IOe,iZ]=Hi({name:"FormControlStylesContext",errorMessage:`useFormControlStyles returned is 'undefined'. Seems you forgot to wrap the components in "<FormControl />" `}),[AOe,AS]=Hi({strict:!1,name:"FormControlContext"});function OOe(r){const{id:t,isRequired:o,isInvalid:a,isDisabled:l,isReadOnly:d,...m}=r,v=V.useId(),y=t||`field-${v}`,b=`${y}-label`,R=`${y}-feedback`,O=`${y}-helptext`,[N,F]=V.useState(!1),[H,G]=V.useState(!1),[z,ne]=V.useState(!1),J=V.useCallback((Q={},te=null)=>({id:O,...Q,ref:zi(te,re=>{re&&G(!0)})}),[O]),oe=V.useCallback((Q={},te=null)=>({...Q,ref:te,"data-focus":cr(z),"data-disabled":cr(l),"data-invalid":cr(a),"data-readonly":cr(d),id:Q.id!==void 0?Q.id:b,htmlFor:Q.htmlFor!==void 0?Q.htmlFor:y}),[y,l,z,a,d,b]),se=V.useCallback((Q={},te=null)=>({id:R,...Q,ref:zi(te,re=>{re&&F(!0)}),"aria-live":"polite"}),[R]),ae=V.useCallback((Q={},te=null)=>({...Q,...m,ref:te,role:"group","data-focus":cr(z),"data-disabled":cr(l),"data-invalid":cr(a),"data-readonly":cr(d)}),[m,l,z,a,d]),ye=V.useCallback((Q={},te=null)=>({...Q,ref:te,role:"presentation","aria-hidden":!0,children:Q.children||"*"}),[]);return{isRequired:!!o,isInvalid:!!a,isReadOnly:!!d,isDisabled:!!l,isFocused:!!z,onFocus:()=>ne(!0),onBlur:()=>ne(!1),hasFeedbackText:N,setHasFeedbackText:F,hasHelpText:H,setHasHelpText:G,id:y,labelId:b,feedbackId:R,helpTextId:O,htmlProps:m,getHelpTextProps:J,getErrorMessageProps:se,getRootProps:ae,getLabelProps:oe,getRequiredIndicatorProps:ye}}var go=zt(function(t,o){const a=xc("Form",t),l=Ki(t),{getRootProps:d,htmlProps:m,...v}=OOe(l),y=In("chakra-form-control",t.className);return D.jsx(AOe,{value:v,children:D.jsx(IOe,{value:a,children:D.jsx(Pt.div,{...d({},o),className:y,__css:a.container})})})});go.displayName="FormControl";var POe=zt(function(t,o){const a=AS(),l=iZ(),d=In("chakra-form__helper-text",t.className);return D.jsx(Pt.div,{...a==null?void 0:a.getHelpTextProps(t,o),__css:l.helperText,className:d})});POe.displayName="FormHelperText";var[NOe,kOe]=Hi({name:"FormErrorStylesContext",errorMessage:`useFormErrorStyles returned is 'undefined'. Seems you forgot to wrap the components in "<FormError />" `}),Pf=zt((r,t)=>{const o=xc("FormError",r),a=Ki(r),l=AS();return l!=null&&l.isInvalid?D.jsx(NOe,{value:o,children:D.jsx(Pt.div,{...l==null?void 0:l.getErrorMessageProps(a,t),className:In("chakra-form__error-message",r.className),__css:{display:"flex",alignItems:"center",...o.text}})}):null});Pf.displayName="FormErrorMessage";var DOe=zt((r,t)=>{const o=kOe(),a=AS();if(!(a!=null&&a.isInvalid))return null;const l=In("chakra-form__error-icon",r.className);return D.jsx(Fm,{ref:t,"aria-hidden":!0,...r,__css:o.icon,className:l,children:D.jsx("path",{fill:"currentColor",d:"M11.983,0a12.206,12.206,0,0,0-8.51,3.653A11.8,11.8,0,0,0,0,12.207,11.779,11.779,0,0,0,11.8,24h.214A12.111,12.111,0,0,0,24,11.791h0A11.766,11.766,0,0,0,11.983,0ZM10.5,16.542a1.476,1.476,0,0,1,1.449-1.53h.027a1.527,1.527,0,0,1,1.523,1.47,1.475,1.475,0,0,1-1.449,1.53h-.027A1.529,1.529,0,0,1,10.5,16.542ZM11,12.5v-6a1,1,0,0,1,2,0v6a1,1,0,1,1-2,0Z"})})});DOe.displayName="FormErrorIcon";var eu=zt(function(t,o){var a;const l=cu("FormLabel",t),d=Ki(t),{className:m,children:v,requiredIndicator:y=D.jsx(oZ,{}),optionalIndicator:b=null,...R}=d,O=AS(),N=(a=O==null?void 0:O.getLabelProps(R,o))!=null?a:{ref:o,...R};return D.jsxs(Pt.label,{...N,className:In("chakra-form__label",d.className),__css:{display:"block",textAlign:"start",...l},children:[v,O!=null&&O.isRequired?y:b]})});eu.displayName="FormLabel";var oZ=zt(function(t,o){const a=AS(),l=iZ();if(!(a!=null&&a.isRequired))return null;const d=In("chakra-form__required-indicator",t.className);return D.jsx(Pt.span,{...a==null?void 0:a.getRequiredIndicatorProps(t,o),__css:l.requiredIndicator,className:d})});oZ.displayName="RequiredIndicator";function sZ(r){const{isDisabled:t,isInvalid:o,isReadOnly:a,isRequired:l,...d}=aZ(r);return{...d,disabled:t,readOnly:a,required:l,"aria-invalid":zx(o),"aria-required":zx(l),"aria-readonly":zx(a)}}function aZ(r){var t,o,a;const l=AS(),{id:d,disabled:m,readOnly:v,required:y,isRequired:b,isInvalid:R,isReadOnly:O,isDisabled:N,onFocus:F,onBlur:H,...G}=r,z=r["aria-describedby"]?[r["aria-describedby"]]:[];return l!=null&&l.hasFeedbackText&&(l!=null&&l.isInvalid)&&z.push(l.feedbackId),l!=null&&l.hasHelpText&&z.push(l.helpTextId),{...G,"aria-describedby":z.join(" ")||void 0,id:d??(l==null?void 0:l.id),isDisabled:(t=m??N)!=null?t:l==null?void 0:l.isDisabled,isReadOnly:(o=v??O)!=null?o:l==null?void 0:l.isReadOnly,isRequired:(a=y??b)!=null?a:l==null?void 0:l.isRequired,isInvalid:R??(l==null?void 0:l.isInvalid),onFocus:rr(l==null?void 0:l.onFocus,F),onBlur:rr(l==null?void 0:l.onBlur,H)}}var LOe={border:"0",clip:"rect(0, 0, 0, 0)",height:"1px",width:"1px",margin:"-1px",padding:"0",overflow:"hidden",whiteSpace:"nowrap",position:"absolute"},xOe=()=>typeof document<"u",Gq=!1,Kw=null,$_=!1,G2=!1,z2=new Set;function LV(r,t){z2.forEach(o=>o(r,t))}var MOe=typeof window<"u"&&window.navigator!=null?/^Mac/.test(window.navigator.platform):!1;function UOe(r){return!(r.metaKey||!MOe&&r.altKey||r.ctrlKey||r.key==="Control"||r.key==="Shift"||r.key==="Meta")}function zq(r){$_=!0,UOe(r)&&(Kw="keyboard",LV("keyboard",r))}function my(r){if(Kw="pointer",r.type==="mousedown"||r.type==="pointerdown"){$_=!0;const t=r.composedPath?r.composedPath()[0]:r.target;let o=!1;try{o=t.matches(":focus-visible")}catch{}if(o)return;LV("pointer",r)}}function VOe(r){return r.mozInputSource===0&&r.isTrusted?!0:r.detail===0&&!r.pointerType}function FOe(r){VOe(r)&&($_=!0,Kw="virtual")}function jOe(r){r.target===window||r.target===document||(!$_&&!G2&&(Kw="virtual",LV("virtual",r)),$_=!1,G2=!1)}function BOe(){$_=!1,G2=!0}function Hq(){return Kw!=="pointer"}function WOe(){if(!xOe()||Gq)return;const{focus:r}=HTMLElement.prototype;HTMLElement.prototype.focus=function(...o){$_=!0,r.apply(this,o)},document.addEventListener("keydown",zq,!0),document.addEventListener("keyup",zq,!0),document.addEventListener("click",FOe,!0),window.addEventListener("focus",jOe,!0),window.addEventListener("blur",BOe,!1),typeof PointerEvent<"u"?(document.addEventListener("pointerdown",my,!0),document.addEventListener("pointermove",my,!0),document.addEventListener("pointerup",my,!0)):(document.addEventListener("mousedown",my,!0),document.addEventListener("mousemove",my,!0),document.addEventListener("mouseup",my,!0)),Gq=!0}function GOe(r){WOe(),r(Hq());const t=()=>r(Hq());return z2.add(t),()=>{z2.delete(t)}}function zOe(r,t=[]){const o=Object.assign({},r);for(const a of t)a in o&&delete o[a];return o}function HOe(r={}){const t=aZ(r),{isDisabled:o,isReadOnly:a,isRequired:l,isInvalid:d,id:m,onBlur:v,onFocus:y,"aria-describedby":b}=t,{defaultChecked:R,isChecked:O,isFocusable:N,onChange:F,isIndeterminate:H,name:G,value:z,tabIndex:ne=void 0,"aria-label":J,"aria-labelledby":oe,"aria-invalid":se,...ae}=r,ye=zOe(ae,["isDisabled","isReadOnly","isRequired","isInvalid","id","onBlur","onFocus","aria-describedby"]),Q=Pc(F),te=Pc(v),re=Pc(y),[le,ve]=V.useState(!1),[fe,de]=V.useState(!1),[lt,ft]=V.useState(!1),[Xe,Le]=V.useState(!1);V.useEffect(()=>GOe(ve),[]);const Ke=V.useRef(null),[nt,Ee]=V.useState(!0),[Ye,yt]=V.useState(!!R),at=O!==void 0,Fe=at?O:Ye,et=V.useCallback(bt=>{if(a||o){bt.preventDefault();return}at||yt(Fe?bt.target.checked:H?!0:bt.target.checked),Q==null||Q(bt)},[a,o,Fe,at,H,Q]);Ff(()=>{Ke.current&&(Ke.current.indeterminate=!!H)},[H]),Am(()=>{o&&de(!1)},[o,de]),Ff(()=>{const bt=Ke.current;if(!(bt!=null&&bt.form))return;const bn=()=>{yt(!!R)};return bt.form.addEventListener("reset",bn),()=>{var wn;return(wn=bt.form)==null?void 0:wn.removeEventListener("reset",bn)}},[]);const _t=o&&!N,Dt=V.useCallback(bt=>{bt.key===" "&&Le(!0)},[Le]),Ht=V.useCallback(bt=>{bt.key===" "&&Le(!1)},[Le]);Ff(()=>{if(!Ke.current)return;Ke.current.checked!==Fe&&yt(Ke.current.checked)},[Ke.current]);const Wt=V.useCallback((bt={},bn=null)=>{const wn=we=>{fe&&we.preventDefault(),Le(!0)};return{...bt,ref:bn,"data-active":cr(Xe),"data-hover":cr(lt),"data-checked":cr(Fe),"data-focus":cr(fe),"data-focus-visible":cr(fe&&le),"data-indeterminate":cr(H),"data-disabled":cr(o),"data-invalid":cr(d),"data-readonly":cr(a),"aria-hidden":!0,onMouseDown:rr(bt.onMouseDown,wn),onMouseUp:rr(bt.onMouseUp,()=>Le(!1)),onMouseEnter:rr(bt.onMouseEnter,()=>ft(!0)),onMouseLeave:rr(bt.onMouseLeave,()=>ft(!1))}},[Xe,Fe,o,fe,le,lt,H,d,a]),Fn=V.useCallback((bt={},bn=null)=>({...bt,ref:bn,"data-active":cr(Xe),"data-hover":cr(lt),"data-checked":cr(Fe),"data-focus":cr(fe),"data-focus-visible":cr(fe&&le),"data-indeterminate":cr(H),"data-disabled":cr(o),"data-invalid":cr(d),"data-readonly":cr(a)}),[Xe,Fe,o,fe,le,lt,H,d,a]),xn=V.useCallback((bt={},bn=null)=>({...ye,...bt,ref:zi(bn,wn=>{wn&&Ee(wn.tagName==="LABEL")}),onClick:rr(bt.onClick,()=>{var wn;nt||((wn=Ke.current)==null||wn.click(),requestAnimationFrame(()=>{var we;(we=Ke.current)==null||we.focus({preventScroll:!0})}))}),"data-disabled":cr(o),"data-checked":cr(Fe),"data-invalid":cr(d)}),[ye,o,Fe,d,nt]),hn=V.useCallback((bt={},bn=null)=>({...bt,ref:zi(Ke,bn),type:"checkbox",name:G,value:z,id:m,tabIndex:ne,onChange:rr(bt.onChange,et),onBlur:rr(bt.onBlur,te,()=>de(!1)),onFocus:rr(bt.onFocus,re,()=>de(!0)),onKeyDown:rr(bt.onKeyDown,Dt),onKeyUp:rr(bt.onKeyUp,Ht),required:l,checked:Fe,disabled:_t,readOnly:a,"aria-label":J,"aria-labelledby":oe,"aria-invalid":se?!!se:d,"aria-describedby":b,"aria-disabled":o,style:LOe}),[G,z,m,et,te,re,Dt,Ht,l,Fe,_t,a,J,oe,se,d,b,o,ne]),gr=V.useCallback((bt={},bn=null)=>({...bt,ref:bn,onMouseDown:rr(bt.onMouseDown,KOe),"data-disabled":cr(o),"data-checked":cr(Fe),"data-invalid":cr(d)}),[Fe,o,d]);return{state:{isInvalid:d,isFocused:fe,isChecked:Fe,isActive:Xe,isHovered:lt,isIndeterminate:H,isDisabled:o,isReadOnly:a,isRequired:l},getRootProps:xn,getCheckboxProps:Wt,getIndicatorProps:Fn,getInputProps:hn,getLabelProps:gr,htmlProps:ye}}function KOe(r){r.preventDefault(),r.stopPropagation()}function $Oe(r){const t=parseFloat(r);return typeof t!="number"||Number.isNaN(t)?0:t}function qOe(r,t){let o=$Oe(r);const a=10**(t??10);return o=Math.round(o*a)/a,t?o.toFixed(t):o.toString()}function YOe(r){if(!Number.isFinite(r))return 0;let t=1,o=0;for(;Math.round(r*t)/t!==r;)t*=10,o+=1;return o}function Kq(r,t,o){return(r-t)*100/(o-t)}function XOe(r,t,o){return(o-t)*r+t}function $q(r,t,o){const a=Math.round((r-t)/o)*o+t,l=YOe(o);return qOe(a,l)}function bM(r,t,o){return r==null?r:(o<t&&console.warn("clamp: max cannot be less than min"),Math.min(Math.max(r,t),o))}function qy(r,t,o,a){const l=Pc(o);return V.useEffect(()=>{const d=typeof r=="function"?r():r??document;if(!(!o||!d))return d.addEventListener(t,l,a),()=>{d.removeEventListener(t,l,a)}},[t,r,a,l,o]),()=>{const d=typeof r=="function"?r():r??document;d==null||d.removeEventListener(t,l,a)}}function JOe(r){return"current"in r}var cZ=()=>typeof window<"u";function QOe(){var r;const t=navigator.userAgentData;return(r=t==null?void 0:t.platform)!=null?r:navigator.platform}var ZOe=r=>cZ()&&r.test(navigator.vendor),ePe=r=>cZ()&&r.test(QOe()),tPe=()=>ePe(/mac|iphone|ipad|ipod/i),nPe=()=>tPe()&&ZOe(/apple/i);function rPe(r){const{ref:t,elements:o,enabled:a}=r,l=()=>{var d,m;return(m=(d=t.current)==null?void 0:d.ownerDocument)!=null?m:document};qy(l,"pointerdown",d=>{if(!nPe()||!a)return;const m=d.target,y=(o??[t]).some(b=>{const R=JOe(b)?b.current:b;return(R==null?void 0:R.contains(m))||R===m});l().activeElement!==m&&y&&(d.preventDefault(),m.focus())})}function iPe(r,t){if(r==null)return{};var o={},a=Object.keys(r),l,d;for(d=0;d<a.length;d++)l=a[d],!(t.indexOf(l)>=0)&&(o[l]=r[l]);return o}var wM={exports:{}},RM,qq;function oPe(){if(qq)return RM;qq=1;var r="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return RM=r,RM}var CM,Yq;function sPe(){if(Yq)return CM;Yq=1;var r=oPe();function t(){}function o(){}return o.resetWarningCache=t,CM=function(){function a(m,v,y,b,R,O){if(O!==r){var N=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw N.name="Invariant Violation",N}}a.isRequired=a;function l(){return a}var d={array:a,bigint:a,bool:a,func:a,number:a,object:a,string:a,symbol:a,any:a,arrayOf:l,element:a,elementType:a,instanceOf:l,node:a,objectOf:l,oneOf:l,oneOfType:l,shape:l,exact:l,checkPropTypes:o,resetWarningCache:t};return d.PropTypes=d,d},CM}var Xq;function aPe(){return Xq||(Xq=1,wM.exports=sPe()()),wM.exports}var cPe=aPe();const Mr=TS(cPe);var H2="data-focus-lock",lZ="data-focus-lock-disabled",lPe="data-no-focus-lock",uPe="data-autofocus-inside",dPe="data-no-autofocus";function IM(r,t){return typeof r=="function"?r(t):r&&(r.current=t),r}function hPe(r,t){var o=V.useState(function(){return{value:r,callback:t,facade:{get current(){return o.value},set current(a){var l=o.value;l!==a&&(o.value=a,o.callback(a,l))}}}})[0];return o.callback=t,o.facade}var fPe=typeof window<"u"?V.useLayoutEffect:V.useEffect,Jq=new WeakMap;function uZ(r,t){var o=hPe(null,function(a){return r.forEach(function(l){return IM(l,a)})});return fPe(function(){var a=Jq.get(o);if(a){var l=new Set(a),d=new Set(r),m=o.current;l.forEach(function(v){d.has(v)||IM(v,null)}),d.forEach(function(v){l.has(v)||IM(v,m)})}Jq.set(o,r)},[r]),o}var AM={width:"1px",height:"0px",padding:0,overflow:"hidden",position:"fixed",top:"1px",left:"1px"},oh=function(){return oh=Object.assign||function(t){for(var o,a=1,l=arguments.length;a<l;a++){o=arguments[a];for(var d in o)Object.prototype.hasOwnProperty.call(o,d)&&(t[d]=o[d])}return t},oh.apply(this,arguments)};function $w(r,t){var o={};for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&t.indexOf(a)<0&&(o[a]=r[a]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,a=Object.getOwnPropertySymbols(r);l<a.length;l++)t.indexOf(a[l])<0&&Object.prototype.propertyIsEnumerable.call(r,a[l])&&(o[a[l]]=r[a[l]]);return o}function pPe(r,t,o){if(o||arguments.length===2)for(var a=0,l=t.length,d;a<l;a++)(d||!(a in t))&&(d||(d=Array.prototype.slice.call(t,0,a)),d[a]=t[a]);return r.concat(d||Array.prototype.slice.call(t))}function dZ(r){return r}function hZ(r,t){t===void 0&&(t=dZ);var o=[],a=!1,l={read:function(){if(a)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return o.length?o[o.length-1]:r},useMedium:function(d){var m=t(d,a);return o.push(m),function(){o=o.filter(function(v){return v!==m})}},assignSyncMedium:function(d){for(a=!0;o.length;){var m=o;o=[],m.forEach(d)}o={push:function(v){return d(v)},filter:function(){return o}}},assignMedium:function(d){a=!0;var m=[];if(o.length){var v=o;o=[],v.forEach(d),m=o}var y=function(){var R=m;m=[],R.forEach(d)},b=function(){return Promise.resolve().then(y)};b(),o={push:function(R){m.push(R),b()},filter:function(R){return m=m.filter(R),o}}}};return l}function xV(r,t){return t===void 0&&(t=dZ),hZ(r,t)}function fZ(r){r===void 0&&(r={});var t=hZ(null);return t.options=oh({async:!0,ssr:!1},r),t}var pZ=function(r){var t=r.sideCar,o=$w(r,["sideCar"]);if(!t)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var a=t.read();if(!a)throw new Error("Sidecar medium not found");return V.createElement(a,oh({},o))};pZ.isSideCarExport=!0;function mPe(r,t){return r.useMedium(t),pZ}var mZ=xV({},function(r){var t=r.target,o=r.currentTarget;return{target:t,currentTarget:o}}),gZ=xV(),gPe=xV(),_Pe=fZ({async:!0,ssr:typeof document<"u"}),vPe=V.createContext(void 0),EPe=[],MV=V.forwardRef(function(t,o){var a,l=V.useState(),d=l[0],m=l[1],v=V.useRef(),y=V.useRef(!1),b=V.useRef(null),R=V.useState({}),O=R[1],N=t.children,F=t.disabled,H=F===void 0?!1:F,G=t.noFocusGuards,z=G===void 0?!1:G,ne=t.persistentFocus,J=ne===void 0?!1:ne,oe=t.crossFrame,se=oe===void 0?!0:oe,ae=t.autoFocus,ye=ae===void 0?!0:ae;t.allowTextSelection;var Q=t.group,te=t.className,re=t.whiteList,le=t.hasPositiveIndices,ve=t.shards,fe=ve===void 0?EPe:ve,de=t.as,lt=de===void 0?"div":de,ft=t.lockProps,Xe=ft===void 0?{}:ft,Le=t.sideCar,Ke=t.returnFocus,nt=Ke===void 0?!1:Ke,Ee=t.focusOptions,Ye=t.onActivation,yt=t.onDeactivation,at=V.useState({}),Fe=at[0],et=V.useCallback(function(bn){var wn=bn.captureFocusRestore;if(!b.current){var we,De=(we=document)==null?void 0:we.activeElement;b.current=De,De!==document.body&&(b.current=wn(De))}v.current&&Ye&&Ye(v.current),y.current=!0,O()},[Ye]),_t=V.useCallback(function(){y.current=!1,yt&&yt(v.current),O()},[yt]),Dt=V.useCallback(function(bn){var wn=b.current;if(wn){var we=(typeof wn=="function"?wn():wn)||document.body,De=typeof nt=="function"?nt(we):nt;if(De){var We=typeof De=="object"?De:void 0;b.current=null,bn?Promise.resolve().then(function(){return we.focus(We)}):we.focus(We)}}},[nt]),Ht=V.useCallback(function(bn){y.current&&mZ.useMedium(bn)},[]),Wt=gZ.useMedium,Fn=V.useCallback(function(bn){v.current!==bn&&(v.current=bn,m(bn))},[]),xn=K_((a={},a[lZ]=H&&"disabled",a[H2]=Q,a),Xe),hn=z!==!0,gr=hn&&z!=="tail",Ar=uZ([o,Fn]),bt=V.useMemo(function(){return{observed:v,shards:fe,enabled:!H,active:y.current}},[H,y.current,fe,d]);return V.createElement(V.Fragment,null,hn&&[V.createElement("div",{key:"guard-first","data-focus-guard":!0,tabIndex:H?-1:0,style:AM}),le?V.createElement("div",{key:"guard-nearest","data-focus-guard":!0,tabIndex:H?-1:1,style:AM}):null],!H&&V.createElement(Le,{id:Fe,sideCar:_Pe,observed:d,disabled:H,persistentFocus:J,crossFrame:se,autoFocus:ye,whiteList:re,shards:fe,onActivation:et,onDeactivation:_t,returnFocus:Dt,focusOptions:Ee}),V.createElement(lt,K_({ref:Ar},xn,{className:te,onBlur:Wt,onFocus:Ht}),V.createElement(vPe.Provider,{value:bt},N)),gr&&V.createElement("div",{"data-focus-guard":!0,tabIndex:H?-1:0,style:AM}))});MV.propTypes={};function K2(r,t){return K2=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,l){return a.__proto__=l,a},K2(r,t)}function yPe(r,t){r.prototype=Object.create(t.prototype),r.prototype.constructor=r,K2(r,t)}function gw(r){"@babel/helpers - typeof";return gw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},gw(r)}function SPe(r,t){if(gw(r)!="object"||!r)return r;var o=r[Symbol.toPrimitive];if(o!==void 0){var a=o.call(r,t);if(gw(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(r)}function TPe(r){var t=SPe(r,"string");return gw(t)=="symbol"?t:t+""}function bPe(r,t,o){return t=TPe(t),t in r?Object.defineProperty(r,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):r[t]=o,r}function wPe(r,t){function o(a){return a.displayName||a.name||"Component"}return function(l){var d=[],m;function v(){m=r(d.map(function(b){return b.props})),t(m)}var y=function(b){yPe(R,b);function R(){return b.apply(this,arguments)||this}R.peek=function(){return m};var O=R.prototype;return O.componentDidMount=function(){d.push(this),v()},O.componentDidUpdate=function(){v()},O.componentWillUnmount=function(){var F=d.indexOf(this);d.splice(F,1),v()},O.render=function(){return Gi.createElement(l,this.props)},R}(V.PureComponent);return bPe(y,"displayName","SideEffect("+o(l)+")"),y}}var wh=function(r){for(var t=Array(r.length),o=0;o<r.length;++o)t[o]=r[o];return t},q_=function(r){return Array.isArray(r)?r:[r]},_Z=function(r){return Array.isArray(r)?r[0]:r},RPe=function(r){if(r.nodeType!==Node.ELEMENT_NODE)return!1;var t=window.getComputedStyle(r,null);return!t||!t.getPropertyValue?!1:t.getPropertyValue("display")==="none"||t.getPropertyValue("visibility")==="hidden"},vZ=function(r){return r.parentNode&&r.parentNode.nodeType===Node.DOCUMENT_FRAGMENT_NODE?r.parentNode.host:r.parentNode},EZ=function(r){return r===document||r&&r.nodeType===Node.DOCUMENT_NODE},CPe=function(r){return r.hasAttribute("inert")},IPe=function(r,t){return!r||EZ(r)||!RPe(r)&&!CPe(r)&&t(vZ(r))},yZ=function(r,t){var o=r.get(t);if(o!==void 0)return o;var a=IPe(t,yZ.bind(void 0,r));return r.set(t,a),a},APe=function(r,t){return r&&!EZ(r)?NPe(r)?t(vZ(r)):!1:!0},SZ=function(r,t){var o=r.get(t);if(o!==void 0)return o;var a=APe(t,SZ.bind(void 0,r));return r.set(t,a),a},TZ=function(r){return r.dataset},OPe=function(r){return r.tagName==="BUTTON"},bZ=function(r){return r.tagName==="INPUT"},wZ=function(r){return bZ(r)&&r.type==="radio"},PPe=function(r){return!((bZ(r)||OPe(r))&&(r.type==="hidden"||r.disabled))},NPe=function(r){var t=r.getAttribute(dPe);return![!0,"true",""].includes(t)},UV=function(r){var t;return!!(r&&(!((t=TZ(r))===null||t===void 0)&&t.focusGuard))},$2=function(r){return!UV(r)},kPe=function(r){return!!r},DPe=function(r,t){var o=Math.max(0,r.tabIndex),a=Math.max(0,t.tabIndex),l=o-a,d=r.index-t.index;if(l){if(!o)return 1;if(!a)return-1}return l||d},LPe=function(r){return r.tabIndex<0&&!r.hasAttribute("tabindex")?0:r.tabIndex},VV=function(r,t,o){return wh(r).map(function(a,l){var d=LPe(a);return{node:a,index:l,tabIndex:o&&d===-1?(a.dataset||{}).focusGuard?0:-1:d}}).filter(function(a){return!t||a.tabIndex>=0}).sort(DPe)},xPe=["button:enabled","select:enabled","textarea:enabled","input:enabled","a[href]","area[href]","summary","iframe","object","embed","audio[controls]","video[controls]","[tabindex]","[contenteditable]","[autofocus]"],FV=xPe.join(","),MPe="".concat(FV,", [data-focus-guard]"),RZ=function(r,t){return wh((r.shadowRoot||r).children).reduce(function(o,a){return o.concat(a.matches(t?MPe:FV)?[a]:[],RZ(a))},[])},UPe=function(r,t){var o;return r instanceof HTMLIFrameElement&&(!((o=r.contentDocument)===null||o===void 0)&&o.body)?aS([r.contentDocument.body],t):[r]},aS=function(r,t){return r.reduce(function(o,a){var l,d=RZ(a,t),m=(l=[]).concat.apply(l,d.map(function(v){return UPe(v,t)}));return o.concat(m,a.parentNode?wh(a.parentNode.querySelectorAll(FV)).filter(function(v){return v===a}):[])},[])},VPe=function(r){var t=r.querySelectorAll("[".concat(uPe,"]"));return wh(t).map(function(o){return aS([o])}).reduce(function(o,a){return o.concat(a)},[])},jV=function(r,t){return wh(r).filter(function(o){return yZ(t,o)}).filter(function(o){return PPe(o)})},Qq=function(r,t){return t===void 0&&(t=new Map),wh(r).filter(function(o){return SZ(t,o)})},BV=function(r,t,o){return VV(jV(aS(r,o),t),!0,o)},DP=function(r,t){return VV(jV(aS(r),t),!1)},FPe=function(r,t){return jV(VPe(r),t)},W_=function(r,t){return r.shadowRoot?W_(r.shadowRoot,t):Object.getPrototypeOf(r).contains!==void 0&&Object.getPrototypeOf(r).contains.call(r,t)?!0:wh(r.children).some(function(o){var a;if(o instanceof HTMLIFrameElement){var l=(a=o.contentDocument)===null||a===void 0?void 0:a.body;return l?W_(l,t):!1}return W_(o,t)})},jPe=function(r){for(var t=new Set,o=r.length,a=0;a<o;a+=1)for(var l=a+1;l<o;l+=1){var d=r[a].compareDocumentPosition(r[l]);(d&Node.DOCUMENT_POSITION_CONTAINED_BY)>0&&t.add(l),(d&Node.DOCUMENT_POSITION_CONTAINS)>0&&t.add(a)}return r.filter(function(m,v){return!t.has(v)})},CZ=function(r){return r.parentNode?CZ(r.parentNode):r},WV=function(r){var t=q_(r);return t.filter(Boolean).reduce(function(o,a){var l=a.getAttribute(H2);return o.push.apply(o,l?jPe(wh(CZ(a).querySelectorAll("[".concat(H2,'="').concat(l,'"]:not([').concat(lZ,'="disabled"])')))):[a]),o},[])},BPe=function(r){try{return r()}catch{return}},_w=function(r){if(r===void 0&&(r=document),!(!r||!r.activeElement)){var t=r.activeElement;return t.shadowRoot?_w(t.shadowRoot):t instanceof HTMLIFrameElement&&BPe(function(){return t.contentWindow.document})?_w(t.contentWindow.document):t}},WPe=function(r,t){return r===t},GPe=function(r,t){return!!wh(r.querySelectorAll("iframe")).some(function(o){return WPe(o,t)})},IZ=function(r,t){return t===void 0&&(t=_w(_Z(r).ownerDocument)),!t||t.dataset&&t.dataset.focusGuard?!1:WV(r).some(function(o){return W_(o,t)||GPe(o,t)})},zPe=function(r){r===void 0&&(r=document);var t=_w(r);return t?wh(r.querySelectorAll("[".concat(lPe,"]"))).some(function(o){return W_(o,t)}):!1},HPe=function(r,t){return t.filter(wZ).filter(function(o){return o.name===r.name}).filter(function(o){return o.checked})[0]||r},GV=function(r,t){return wZ(r)&&r.name?HPe(r,t):r},KPe=function(r){var t=new Set;return r.forEach(function(o){return t.add(GV(o,r))}),r.filter(function(o){return t.has(o)})},Zq=function(r){return r[0]&&r.length>1?GV(r[0],r):r[0]},e7=function(r,t){return r.indexOf(GV(t,r))},q2="NEW_FOCUS",$Pe=function(r,t,o,a,l){var d=r.length,m=r[0],v=r[d-1],y=UV(a);if(!(a&&r.indexOf(a)>=0)){var b=a!==void 0?o.indexOf(a):-1,R=l?o.indexOf(l):b,O=l?r.indexOf(l):-1;if(b===-1)return O!==-1?O:q2;if(O===-1)return q2;var N=b-R,F=o.indexOf(m),H=o.indexOf(v),G=KPe(o),z=a!==void 0?G.indexOf(a):-1,ne=z-(l?G.indexOf(l):b);if(!N&&O>=0||t.length===0)return O;var J=e7(r,t[0]),oe=e7(r,t[t.length-1]);if(b<=F&&y&&Math.abs(N)>1)return oe;if(b>=H&&y&&Math.abs(N)>1)return J;if(N&&Math.abs(ne)>1)return O;if(b<=F)return oe;if(b>H)return J;if(N)return Math.abs(N)>1?O:(d+O+N)%d}},qPe=function(r){return function(t){var o,a=(o=TZ(t))===null||o===void 0?void 0:o.autofocus;return t.autofocus||a!==void 0&&a!=="false"||r.indexOf(t)>=0}},t7=function(r,t,o){var a=r.map(function(d){var m=d.node;return m}),l=Qq(a.filter(qPe(o)));return l&&l.length?Zq(l):Zq(Qq(t))},Y2=function(r,t){return t===void 0&&(t=[]),t.push(r),r.parentNode&&Y2(r.parentNode.host||r.parentNode,t),t},OM=function(r,t){for(var o=Y2(r),a=Y2(t),l=0;l<o.length;l+=1){var d=o[l];if(a.indexOf(d)>=0)return d}return!1},AZ=function(r,t,o){var a=q_(r),l=q_(t),d=a[0],m=!1;return l.filter(Boolean).forEach(function(v){m=OM(m||v,v)||m,o.filter(Boolean).forEach(function(y){var b=OM(d,y);b&&(!m||W_(b,m)?m=b:m=OM(b,m))})}),m},n7=function(r,t){return r.reduce(function(o,a){return o.concat(FPe(a,t))},[])},YPe=function(r,t){var o=new Map;return t.forEach(function(a){return o.set(a.node,a)}),r.map(function(a){return o.get(a)}).filter(kPe)},XPe=function(r,t){var o=_w(q_(r).length>0?document:_Z(r).ownerDocument),a=WV(r).filter($2),l=AZ(o||r,r,a),d=new Map,m=DP(a,d),v=m.filter(function(H){var G=H.node;return $2(G)});if(v[0]){var y=DP([l],d).map(function(H){var G=H.node;return G}),b=YPe(y,v),R=b.map(function(H){var G=H.node;return G}),O=b.filter(function(H){var G=H.tabIndex;return G>=0}).map(function(H){var G=H.node;return G}),N=$Pe(R,O,y,o,t);if(N===q2){var F=t7(m,O,n7(a,d))||t7(m,R,n7(a,d));if(F)return{node:F};console.warn("focus-lock: cannot find any node to move focus into");return}return N===void 0?N:b[N]}},JPe=function(r){var t=WV(r).filter($2),o=AZ(r,r,t),a=VV(aS([o],!0),!0,!0),l=aS(t,!1);return a.map(function(d){var m=d.node,v=d.index;return{node:m,index:v,lockItem:l.indexOf(m)>=0,guard:UV(m)}})},zV=function(r,t){r&&("focus"in r&&r.focus(t),"contentWindow"in r&&r.contentWindow&&r.contentWindow.focus())},PM=0,NM=!1,OZ=function(r,t,o){o===void 0&&(o={});var a=XPe(r,t);if(!NM&&a){if(PM>2){console.error("FocusLock: focus-fighting detected. Only one focus management system could be active. See https://github.com/theKashey/focus-lock/#focus-fighting"),NM=!0,setTimeout(function(){NM=!1},1);return}PM++,zV(a.node,o.focusOptions),PM--}};function ob(r){if(!r)return null;if(typeof WeakRef>"u")return function(){return r||null};var t=r?new WeakRef(r):null;return function(){return(t==null?void 0:t.deref())||null}}var QPe=function(r){if(!r)return null;for(var t=[],o=r;o&&o!==document.body;)t.push({current:ob(o),parent:ob(o.parentElement),left:ob(o.previousElementSibling),right:ob(o.nextElementSibling)}),o=o.parentElement;return{element:ob(r),stack:t,ownerDocument:r.ownerDocument}},ZPe=function(r){var t,o,a,l,d;if(r)for(var m=r.stack,v=r.ownerDocument,y=new Map,b=0,R=m;b<R.length;b++){var O=R[b],N=(t=O.parent)===null||t===void 0?void 0:t.call(O);if(N&&v.contains(N)){for(var F=(o=O.left)===null||o===void 0?void 0:o.call(O),H=O.current(),G=N.contains(H)?H:void 0,z=(a=O.right)===null||a===void 0?void 0:a.call(O),ne=BV([N],y),J=(d=(l=G??(F==null?void 0:F.nextElementSibling))!==null&&l!==void 0?l:z)!==null&&d!==void 0?d:F;J;){for(var oe=0,se=ne;oe<se.length;oe++){var ae=se[oe];if(J!=null&&J.contains(ae.node))return ae.node}J=J.nextElementSibling}if(ne.length)return ne[0].node}}},eNe=function(r){var t=QPe(r);return function(){return ZPe(t)}},tNe=function(r,t,o){if(!r||!t)return console.error("no element or scope given"),{};var a=q_(t);if(a.every(function(m){return!W_(m,r)}))return console.error("Active element is not contained in the scope"),{};var l=o?BV(a,new Map):DP(a,new Map),d=l.findIndex(function(m){var v=m.node;return v===r});if(d!==-1)return{prev:l[d-1],next:l[d+1],first:l[0],last:l[l.length-1]}},nNe=function(r,t){var o=t?BV(q_(r),new Map):DP(q_(r),new Map);return{first:o[0],last:o[o.length-1]}},rNe=function(r){return Object.assign({scope:document.body,cycle:!0,onlyTabbable:!0},r)},PZ=function(r,t,o){t===void 0&&(t={});var a=rNe(t),l=tNe(r,a.scope,a.onlyTabbable);if(l){var d=o(l,a.cycle);d&&zV(d.node,a.focusOptions)}},iNe=function(r,t){t===void 0&&(t={}),PZ(r,t,function(o,a){var l=o.next,d=o.first;return l||a&&d})},oNe=function(r,t){t===void 0&&(t={}),PZ(r,t,function(o,a){var l=o.prev,d=o.last;return l||a&&d})},NZ=function(r,t,o){var a,l=nNe(r,(a=t.onlyTabbable)!==null&&a!==void 0?a:!0),d=l[o];d&&zV(d.node,t.focusOptions)},sNe=function(r,t){t===void 0&&(t={}),NZ(r,t,"first")},aNe=function(r,t){t===void 0&&(t={}),NZ(r,t,"last")};function HV(r){setTimeout(r,1)}var cNe=function(t){return t&&"current"in t?t.current:t},lNe=function(){return document&&document.activeElement===document.body},uNe=function(){return lNe()||zPe()},Yy=null,Fy=null,Xy=null,vw=!1,dNe=function(){return!0},hNe=function(t){return(Yy.whiteList||dNe)(t)},fNe=function(t,o){Xy={observerNode:t,portaledElement:o}},pNe=function(t){return Xy&&Xy.portaledElement===t};function r7(r,t,o,a){var l=null,d=r;do{var m=a[d];if(m.guard)m.node.dataset.focusAutoGuard&&(l=m);else if(m.lockItem){if(d!==r)return;l=null}else break}while((d+=o)!==t);l&&(l.node.tabIndex=0)}var mNe=function(t){return t?!!vw:vw==="meanwhile"},gNe=function r(t,o,a){return o&&(o.host===t&&(!o.activeElement||a.contains(o.activeElement))||o.parentNode&&r(t,o.parentNode,a))},_Ne=function(t,o){return o.some(function(a){return gNe(t,a,a)})},LP=function(){var t=!1;if(Yy){var o=Yy,a=o.observed,l=o.persistentFocus,d=o.autoFocus,m=o.shards,v=o.crossFrame,y=o.focusOptions,b=a||Xy&&Xy.portaledElement,R=document&&document.activeElement;if(b){var O=[b].concat(m.map(cNe).filter(Boolean));if((!R||hNe(R))&&(l||mNe(v)||!uNe()||!Fy&&d)&&(b&&!(IZ(O)||R&&_Ne(R,O)||pNe(R))&&(document&&!Fy&&R&&!d?(R.blur&&R.blur(),document.body.focus()):(t=OZ(O,Fy,{focusOptions:y}),Xy={})),vw=!1,Fy=document&&document.activeElement),document&&R!==document.activeElement&&document.querySelector("[data-focus-auto-guard]")){var N=document&&document.activeElement,F=JPe(O),H=F.map(function(G){var z=G.node;return z}).indexOf(N);H>-1&&(F.filter(function(G){var z=G.guard,ne=G.node;return z&&ne.dataset.focusAutoGuard}).forEach(function(G){var z=G.node;return z.removeAttribute("tabIndex")}),r7(H,F.length,1,F),r7(H,-1,-1,F))}}}return t},kZ=function(t){LP()&&t&&(t.stopPropagation(),t.preventDefault())},KV=function(){return HV(LP)},vNe=function(t){var o=t.target,a=t.currentTarget;a.contains(o)||fNe(a,o)},ENe=function(){return null},DZ=function(){vw="just",HV(function(){vw="meanwhile"})},yNe=function(){document.addEventListener("focusin",kZ),document.addEventListener("focusout",KV),window.addEventListener("blur",DZ)},SNe=function(){document.removeEventListener("focusin",kZ),document.removeEventListener("focusout",KV),window.removeEventListener("blur",DZ)};function TNe(r){return r.filter(function(t){var o=t.disabled;return!o})}var LZ={moveFocusInside:OZ,focusInside:IZ,focusNextElement:iNe,focusPrevElement:oNe,focusFirstElement:sNe,focusLastElement:aNe,captureFocusRestore:eNe};function bNe(r){var t=r.slice(-1)[0];t&&!Yy&&yNe();var o=Yy,a=o&&t&&t.id===o.id;Yy=t,o&&!a&&(o.onDeactivation(),r.filter(function(l){var d=l.id;return d===o.id}).length||o.returnFocus(!t)),t?(Fy=null,(!a||o.observed!==t.observed)&&t.onActivation(LZ),LP(),HV(LP)):(SNe(),Fy=null)}mZ.assignSyncMedium(vNe);gZ.assignMedium(KV);gPe.assignMedium(function(r){return r(LZ)});const wNe=wPe(TNe,bNe)(ENe);var X2=V.forwardRef(function(t,o){return V.createElement(MV,K_({sideCar:wNe,ref:o},t))}),xZ=MV.propTypes||{};xZ.sideCar;iPe(xZ,["sideCar"]);X2.propTypes={};function MZ(r){return r!=null&&typeof r=="object"&&"nodeType"in r&&r.nodeType===Node.ELEMENT_NODE}function $V(r){var t;if(!MZ(r))return!1;const o=(t=r.ownerDocument.defaultView)!=null?t:window;return r instanceof o.HTMLElement}function RNe(r){var t,o;return(o=(t=UZ(r))==null?void 0:t.defaultView)!=null?o:window}function UZ(r){return MZ(r)?r.ownerDocument:document}function CNe(r){return UZ(r).activeElement}function INe(r){const t=r.ownerDocument.defaultView||window,{overflow:o,overflowX:a,overflowY:l}=t.getComputedStyle(r);return/auto|scroll|overlay|hidden/.test(o+l+a)}function ANe(r){return r.localName==="html"?r:r.assignedSlot||r.parentElement||r.ownerDocument.documentElement}function VZ(r){return["html","body","#document"].includes(r.localName)?r.ownerDocument.body:$V(r)&&INe(r)?r:VZ(ANe(r))}var FZ=r=>r.hasAttribute("tabindex"),ONe=r=>FZ(r)&&r.tabIndex===-1;function PNe(r){return!!r.getAttribute("disabled")||!!r.getAttribute("aria-disabled")}function jZ(r){return r.parentElement&&jZ(r.parentElement)?!0:r.hidden}function NNe(r){const t=r.getAttribute("contenteditable");return t!=="false"&&t!=null}function BZ(r){if(!$V(r)||jZ(r)||PNe(r))return!1;const{localName:t}=r;if(["input","select","textarea","button"].indexOf(t)>=0)return!0;const a={a:()=>r.hasAttribute("href"),audio:()=>r.hasAttribute("controls"),video:()=>r.hasAttribute("controls")};return t in a?a[t]():NNe(r)?!0:FZ(r)}function kNe(r){return r?$V(r)&&BZ(r)&&!ONe(r):!1}var DNe=["input:not(:disabled):not([disabled])","select:not(:disabled):not([disabled])","textarea:not(:disabled):not([disabled])","embed","iframe","object","a[href]","area[href]","button:not(:disabled):not([disabled])","[tabindex]","audio[controls]","video[controls]","*[tabindex]:not([aria-disabled])","*[contenteditable]"],LNe=DNe.join(),xNe=r=>r.offsetWidth>0&&r.offsetHeight>0;function WZ(r){const t=Array.from(r.querySelectorAll(LNe));return t.unshift(r),t.filter(o=>BZ(o)&&xNe(o))}var i7,MNe=(i7=X2.default)!=null?i7:X2,GZ=r=>{const{initialFocusRef:t,finalFocusRef:o,contentRef:a,restoreFocus:l,children:d,isDisabled:m,autoFocus:v,persistentFocus:y,lockFocusAcrossFrames:b}=r,R=V.useCallback(()=>{t!=null&&t.current?t.current.focus():a!=null&&a.current&&WZ(a.current).length===0&&requestAnimationFrame(()=>{var H;(H=a.current)==null||H.focus()})},[t,a]),O=V.useCallback(()=>{var F;(F=o==null?void 0:o.current)==null||F.focus()},[o]),N=l&&!o;return D.jsx(MNe,{crossFrame:b,persistentFocus:y,autoFocus:v,disabled:m,onActivation:R,onDeactivation:O,returnFocus:N,children:d})};GZ.displayName="FocusLock";var UNe=xbe?V.useLayoutEffect:V.useEffect;function o7(r,t=[]){const o=V.useRef(r);return UNe(()=>{o.current=r}),V.useCallback((...a)=>{var l;return(l=o.current)==null?void 0:l.call(o,...a)},t)}function VNe(r,t){const o=V.useId();return V.useMemo(()=>r||[t,o].filter(Boolean).join("-"),[r,t,o])}function FNe(r,t){const o=r!==void 0;return[o,o&&typeof r<"u"?r:t]}function zZ(r={}){const{onClose:t,onOpen:o,isOpen:a,id:l}=r,d=o7(o),m=o7(t),[v,y]=V.useState(r.defaultIsOpen||!1),[b,R]=FNe(a,v),O=VNe(l,"disclosure"),N=V.useCallback(()=>{b||y(!1),m==null||m()},[b,m]),F=V.useCallback(()=>{b||y(!0),d==null||d()},[b,d]),H=V.useCallback(()=>{(R?N:F)()},[R,F,N]);return{isOpen:!!R,onOpen:F,onClose:N,onToggle:H,isControlled:b,getButtonProps:(G={})=>({...G,"aria-expanded":R,"aria-controls":O,onClick:jbe(G.onClick,H)}),getDisclosureProps:(G={})=>({...G,hidden:!R,id:O})}}var[jNe,BNe]=Hi({name:"InputGroupStylesContext",errorMessage:`useInputGroupStyles returned is 'undefined'. Seems you forgot to wrap the components in "<InputGroup />" `}),J2=zt(function(t,o){const a=xc("Input",t),{children:l,className:d,...m}=Ki(t),v=In("chakra-input__group",d),y={},b=DV(l),R=a.field;b.forEach(N=>{var F,H;a&&(R&&N.type.id==="InputLeftElement"&&(y.paddingStart=(F=R.height)!=null?F:R.h),R&&N.type.id==="InputRightElement"&&(y.paddingEnd=(H=R.height)!=null?H:R.h),N.type.id==="InputRightAddon"&&(y.borderEndRadius=0),N.type.id==="InputLeftAddon"&&(y.borderStartRadius=0))});const O=b.map(N=>{var F,H;const G=vJ({size:((F=N.props)==null?void 0:F.size)||t.size,variant:((H=N.props)==null?void 0:H.variant)||t.variant});return N.type.id!=="Input"?V.cloneElement(N,G):V.cloneElement(N,Object.assign(G,y,N.props))});return D.jsx(Pt.div,{className:v,ref:o,__css:{width:"100%",display:"flex",position:"relative",isolation:"isolate",...a.group},"data-group":!0,...m,children:D.jsx(jNe,{value:a,children:O})})});J2.displayName="InputGroup";var WNe=Pt("div",{baseStyle:{display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",top:"0",zIndex:2}}),RN=zt(function(t,o){var a,l;const{placement:d="left",...m}=t,v=BNe(),y=v.field,R={[d==="left"?"insetStart":"insetEnd"]:"0",width:(a=y==null?void 0:y.height)!=null?a:y==null?void 0:y.h,height:(l=y==null?void 0:y.height)!=null?l:y==null?void 0:y.h,fontSize:y==null?void 0:y.fontSize,...v.element};return D.jsx(WNe,{ref:o,__css:R,...m})});RN.id="InputElement";RN.displayName="InputElement";var xP=zt(function(t,o){const{className:a,...l}=t,d=In("chakra-input__left-element",a);return D.jsx(RN,{ref:o,placement:"left",className:d,...l})});xP.id="InputLeftElement";xP.displayName="InputLeftElement";var HZ=zt(function(t,o){const{className:a,...l}=t,d=In("chakra-input__right-element",a);return D.jsx(RN,{ref:o,placement:"right",className:d,...l})});HZ.id="InputRightElement";HZ.displayName="InputRightElement";var Gs=zt(function(t,o){const{htmlSize:a,...l}=t,d=xc("Input",l),m=Ki(l),v=sZ(m),y=In("chakra-input",t.className);return D.jsx(Pt.input,{size:a,...v,__css:d.field,ref:o,className:y})});Gs.displayName="Input";Gs.id="Input";var yh=zt(function(t,o){const a=cu("Link",t),{className:l,isExternal:d,...m}=Ki(t);return D.jsx(Pt.a,{target:d?"_blank":void 0,rel:d?"noopener":void 0,ref:o,className:In("chakra-link",l),...m,__css:a})});yh.displayName="Link";var KZ=zt(function(t,o){const{templateAreas:a,gap:l,rowGap:d,columnGap:m,column:v,row:y,autoFlow:b,autoRows:R,templateRows:O,autoColumns:N,templateColumns:F,...H}=t,G={display:"grid",gridTemplateAreas:a,gridGap:l,gridRowGap:d,gridColumnGap:m,gridAutoColumns:N,gridColumn:v,gridRow:y,gridAutoFlow:b,gridAutoRows:R,gridTemplateRows:O,gridTemplateColumns:F};return D.jsx(Pt.div,{ref:o,__css:G,...H})});KZ.displayName="Grid";function CN(r,t){return Array.isArray(r)?r.map(o=>o===null?null:t(o)):nd(r)?Object.keys(r).reduce((o,a)=>(o[a]=t(r[a]),o),{}):r!=null?t(r):null}var $Z=zt(function(t,o){const{columns:a,spacingX:l,spacingY:d,spacing:m,minChildWidth:v,...y}=t,b=wS(),R=v?zNe(v,b):HNe(a);return D.jsx(KZ,{ref:o,gap:m,columnGap:l,rowGap:d,templateColumns:R,...y})});$Z.displayName="SimpleGrid";function GNe(r){return typeof r=="number"?`${r}px`:r}function zNe(r,t){return CN(r,o=>{const a=Kge("sizes",o,GNe(o))(t);return o===null?null:`repeat(auto-fit, minmax(${a}, 1fr))`})}function HNe(r){return CN(r,t=>t===null?null:`repeat(${t}, minmax(0, 1fr))`)}var qZ=Pt("div",{baseStyle:{flex:1,justifySelf:"stretch",alignSelf:"stretch"}});qZ.displayName="Spacer";var pn=zt(function(t,o){const a=cu("Text",t),{className:l,align:d,decoration:m,casing:v,...y}=Ki(t),b=vJ({textAlign:t.align,textDecoration:t.decoration,textTransform:t.casing});return D.jsx(Pt.p,{ref:o,className:In("chakra-text",t.className),...b,...y,__css:a})});pn.displayName="Text";var YZ=r=>D.jsx(Pt.div,{className:"chakra-stack__item",...r,__css:{display:"inline-block",flex:"0 0 auto",minWidth:0,...r.__css}});YZ.displayName="StackItem";function KNe(r){const{spacing:t,direction:o}=r,a={column:{my:t,mx:0,borderLeftWidth:0,borderBottomWidth:"1px"},"column-reverse":{my:t,mx:0,borderLeftWidth:0,borderBottomWidth:"1px"},row:{mx:t,my:0,borderLeftWidth:"1px",borderBottomWidth:0},"row-reverse":{mx:t,my:0,borderLeftWidth:"1px",borderBottomWidth:0}};return{"&":CN(o,l=>a[l])}}var qV=zt((r,t)=>{const{isInline:o,direction:a,align:l,justify:d,spacing:m="0.5rem",wrap:v,children:y,divider:b,className:R,shouldWrapChildren:O,...N}=r,F=o?"row":a??"column",H=V.useMemo(()=>KNe({spacing:m,direction:F}),[m,F]),G=!!b,z=!O&&!G,ne=V.useMemo(()=>{const oe=DV(y);return z?oe:oe.map((se,ae)=>{const ye=typeof se.key<"u"?se.key:ae,Q=ae+1===oe.length,re=O?D.jsx(YZ,{children:se},ye):se;if(!G)return re;const le=V.cloneElement(b,{__css:H}),ve=Q?null:le;return D.jsxs(V.Fragment,{children:[re,ve]},ye)})},[b,H,G,z,O,y]),J=In("chakra-stack",R);return D.jsx(Pt.div,{ref:t,display:"flex",alignItems:l,justifyContent:d,flexDirection:F,flexWrap:v,gap:G?void 0:m,className:J,...N,children:ne})});qV.displayName="Stack";var Bo=zt((r,t)=>D.jsx(qV,{align:"center",...r,direction:"column",ref:t}));Bo.displayName="VStack";var cS=zt((r,t)=>D.jsx(qV,{align:"center",...r,direction:"row",ref:t}));cS.displayName="HStack";var YV=zt(function(t,o){const a=cu("Heading",t),{className:l,...d}=Ki(t);return D.jsx(Pt.h2,{ref:o,className:In("chakra-heading",t.className),...d,__css:a})});YV.displayName="Heading";var Xt=Pt("div");Xt.displayName="Box";var XZ=zt(function(t,o){const{size:a,centerContent:l=!0,...d}=t,m=l?{display:"flex",alignItems:"center",justifyContent:"center"}:{};return D.jsx(Xt,{ref:o,boxSize:a,__css:{...m,flexShrink:0,flexGrow:0},...d})});XZ.displayName="Square";var $Ne=zt(function(t,o){const{size:a,...l}=t;return D.jsx(XZ,{size:a,ref:o,borderRadius:"9999px",...l})});$Ne.displayName="Circle";var JZ=zt(function(r,t){const{ratio:o=4/3,children:a,className:l,...d}=r,m=V.Children.only(a),v=In("chakra-aspect-ratio",l);return D.jsx(Pt.div,{ref:t,position:"relative",className:v,_before:{height:0,content:'""',display:"block",paddingBottom:CN(o,y=>`${1/y*100}%`)},__css:{"& > *:not(style)":{overflow:"hidden",position:"absolute",top:"0",right:"0",bottom:"0",left:"0",display:"flex",justifyContent:"center",alignItems:"center",width:"100%",height:"100%"},"& > img, & > video":{objectFit:"cover"}},...d,children:m})});JZ.displayName="AspectRatio";var QZ=zt(function(t,o){const a=cu("Badge",t),{className:l,...d}=Ki(t);return D.jsx(Pt.span,{ref:o,className:In("chakra-badge",t.className),...d,__css:{display:"inline-block",whiteSpace:"nowrap",verticalAlign:"middle",...a}})});QZ.displayName="Badge";var ZZ=Pt("div",{baseStyle:{display:"flex",alignItems:"center",justifyContent:"center"}});ZZ.displayName="Center";var qNe={horizontal:{insetStart:"50%",transform:"translateX(-50%)"},vertical:{top:"50%",transform:"translateY(-50%)"},both:{insetStart:"50%",top:"50%",transform:"translate(-50%, -50%)"}};zt(function(t,o){const{axis:a="both",...l}=t;return D.jsx(Pt.div,{ref:o,__css:qNe[a],...l,position:"absolute"})});var tP=zt(function(t,o){const{className:a,centerContent:l,...d}=Ki(t),m=cu("Container",t);return D.jsx(Pt.div,{ref:o,className:In("chakra-container",a),...d,__css:{...m,...l&&{display:"flex",flexDirection:"column",alignItems:"center"}}})});tP.displayName="Container";var Ew=zt(function(t,o){const{borderLeftWidth:a,borderBottomWidth:l,borderTopWidth:d,borderRightWidth:m,borderWidth:v,borderStyle:y,borderColor:b,...R}=cu("Divider",t),{className:O,orientation:N="horizontal",__css:F,...H}=Ki(t),G={vertical:{borderLeftWidth:a||m||v||"1px",height:"100%"},horizontal:{borderBottomWidth:l||d||v||"1px",width:"100%"}};return D.jsx(Pt.hr,{ref:o,"aria-orientation":N,...H,__css:{...R,border:"0",borderColor:b,borderStyle:y,...G[N],...F},className:In("chakra-divider",O)})});Ew.displayName="Divider";var Ic=zt(function(t,o){const{direction:a,align:l,justify:d,wrap:m,basis:v,grow:y,shrink:b,...R}=t,O={display:"flex",flexDirection:a,alignItems:l,justifyContent:d,flexWrap:m,flexBasis:v,flexGrow:y,flexShrink:b};return D.jsx(Pt.div,{ref:o,__css:O,...R})});Ic.displayName="Flex";function YNe(r){const{key:t}=r;return t.length===1||t.length>1&&/[^a-zA-Z0-9]/.test(t)}function XNe(r={}){const{timeout:t=300,preventDefault:o=()=>!0}=r,[a,l]=V.useState([]),d=V.useRef(),m=()=>{d.current&&(clearTimeout(d.current),d.current=null)},v=()=>{m(),d.current=setTimeout(()=>{l([]),d.current=null},t)};V.useEffect(()=>m,[]);function y(b){return R=>{if(R.key==="Backspace"){const O=[...a];O.pop(),l(O);return}if(YNe(R)){const O=a.concat(R.key);o(R)&&(R.preventDefault(),R.stopPropagation()),l(O),b(O.join("")),v()}}}return y}function JNe(r,t,o,a){if(t==null)return a;if(!a)return r.find(m=>o(m).toLowerCase().startsWith(t.toLowerCase()));const l=r.filter(d=>o(d).toLowerCase().startsWith(t.toLowerCase()));if(l.length>0){let d;return l.includes(a)?(d=l.indexOf(a)+1,d===l.length&&(d=0),l[d]):(d=r.indexOf(l[0]),r[d])}return a}function QNe(){const r=V.useRef(new Map),t=r.current,o=V.useCallback((l,d,m,v)=>{r.current.set(m,{type:d,el:l,options:v}),l.addEventListener(d,m,v)},[]),a=V.useCallback((l,d,m,v)=>{l.removeEventListener(d,m,v),r.current.delete(m)},[]);return V.useEffect(()=>()=>{t.forEach((l,d)=>{a(l.el,l.type,d,l.options)})},[a,t]),{add:o,remove:a}}function kM(r){const t=r.target,{tagName:o,isContentEditable:a}=t;return o!=="INPUT"&&o!=="TEXTAREA"&&a!==!0}function eee(r={}){const{ref:t,isDisabled:o,isFocusable:a,clickOnEnter:l=!0,clickOnSpace:d=!0,onMouseDown:m,onMouseUp:v,onClick:y,onKeyDown:b,onKeyUp:R,tabIndex:O,onMouseOver:N,onMouseLeave:F,...H}=r,[G,z]=V.useState(!0),[ne,J]=V.useState(!1),oe=QNe(),se=Le=>{Le&&Le.tagName!=="BUTTON"&&z(!1)},ae=G?O:O||0,ye=o&&!a,Q=V.useCallback(Le=>{if(o){Le.stopPropagation(),Le.preventDefault();return}Le.currentTarget.focus(),y==null||y(Le)},[o,y]),te=V.useCallback(Le=>{ne&&kM(Le)&&(Le.preventDefault(),Le.stopPropagation(),J(!1),oe.remove(document,"keyup",te,!1))},[ne,oe]),re=V.useCallback(Le=>{if(b==null||b(Le),o||Le.defaultPrevented||Le.metaKey||!kM(Le.nativeEvent)||G)return;const Ke=l&&Le.key==="Enter";d&&Le.key===" "&&(Le.preventDefault(),J(!0)),Ke&&(Le.preventDefault(),Le.currentTarget.click()),oe.add(document,"keyup",te,!1)},[o,G,b,l,d,oe,te]),le=V.useCallback(Le=>{if(R==null||R(Le),o||Le.defaultPrevented||Le.metaKey||!kM(Le.nativeEvent)||G)return;d&&Le.key===" "&&(Le.preventDefault(),J(!1),Le.currentTarget.click())},[d,G,o,R]),ve=V.useCallback(Le=>{Le.button===0&&(J(!1),oe.remove(document,"mouseup",ve,!1))},[oe]),fe=V.useCallback(Le=>{if(Le.button!==0)return;if(o){Le.stopPropagation(),Le.preventDefault();return}G||J(!0),Le.currentTarget.focus({preventScroll:!0}),oe.add(document,"mouseup",ve,!1),m==null||m(Le)},[o,G,m,oe,ve]),de=V.useCallback(Le=>{Le.button===0&&(G||J(!1),v==null||v(Le))},[v,G]),lt=V.useCallback(Le=>{if(o){Le.preventDefault();return}N==null||N(Le)},[o,N]),ft=V.useCallback(Le=>{ne&&(Le.preventDefault(),J(!1)),F==null||F(Le)},[ne,F]),Xe=zi(t,se);return G?{...H,ref:Xe,type:"button","aria-disabled":ye?void 0:o,disabled:ye,onClick:Q,onMouseDown:m,onMouseUp:v,onKeyUp:R,onKeyDown:b,onMouseOver:N,onMouseLeave:F}:{...H,ref:Xe,role:"button","data-active":cr(ne),"aria-disabled":o?"true":void 0,tabIndex:ye?void 0:ae,onClick:Q,onMouseDown:fe,onMouseUp:de,onKeyUp:le,onKeyDown:re,onMouseOver:lt,onMouseLeave:ft}}function ZNe(r){const t=r.current;if(!t)return!1;const o=CNe(t);return!o||t.contains(o)?!1:!!kNe(o)}function tee(r,t){const{shouldFocus:o,visible:a,focusRef:l}=t,d=o&&!a;Am(()=>{if(!d||ZNe(r))return;const m=(l==null?void 0:l.current)||r.current;let v;if(m)return v=requestAnimationFrame(()=>{m.focus({preventScroll:!0})}),()=>{cancelAnimationFrame(v)}},[d,r,l])}var eke={preventScroll:!0,shouldFocus:!1};function tke(r,t=eke){const{focusRef:o,preventScroll:a,shouldFocus:l,visible:d}=t,m=nke(r)?r.current:r,v=l&&d,y=V.useRef(v),b=V.useRef(d);Ff(()=>{!b.current&&d&&(y.current=v),b.current=d},[d,v]);const R=V.useCallback(()=>{if(!(!d||!m||!y.current)&&(y.current=!1,!m.contains(document.activeElement)))if(o!=null&&o.current)requestAnimationFrame(()=>{var O;(O=o.current)==null||O.focus({preventScroll:a})});else{const O=WZ(m);O.length>0&&requestAnimationFrame(()=>{O[0].focus({preventScroll:a})})}},[d,a,m,o]);Am(()=>{R()},[R]),qy(m,"transitionend",R)}function nke(r){return"current"in r}var gy=(r,t)=>({var:r,varRef:t?`var(${r}, ${t})`:`var(${r})`}),Fo={arrowShadowColor:gy("--popper-arrow-shadow-color"),arrowSize:gy("--popper-arrow-size","8px"),arrowSizeHalf:gy("--popper-arrow-size-half"),arrowBg:gy("--popper-arrow-bg"),transformOrigin:gy("--popper-transform-origin"),arrowOffset:gy("--popper-arrow-offset")};function rke(r){if(r.includes("top"))return"1px 1px 0px 0 var(--popper-arrow-shadow-color)";if(r.includes("bottom"))return"-1px -1px 0px 0 var(--popper-arrow-shadow-color)";if(r.includes("right"))return"-1px 1px 0px 0 var(--popper-arrow-shadow-color)";if(r.includes("left"))return"1px -1px 0px 0 var(--popper-arrow-shadow-color)"}var ike={top:"bottom center","top-start":"bottom left","top-end":"bottom right",bottom:"top center","bottom-start":"top left","bottom-end":"top right",left:"right center","left-start":"right top","left-end":"right bottom",right:"left center","right-start":"left top","right-end":"left bottom"},oke=r=>ike[r],s7={scroll:!0,resize:!0};function ske(r){let t;return typeof r=="object"?t={enabled:!0,options:{...s7,...r}}:t={enabled:r,options:s7},t}var ake={name:"matchWidth",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:({state:r})=>{r.styles.popper.width=`${r.rects.reference.width}px`},effect:({state:r})=>()=>{const t=r.elements.reference;r.elements.popper.style.width=`${t.offsetWidth}px`}},cke={name:"transformOrigin",enabled:!0,phase:"write",fn:({state:r})=>{a7(r)},effect:({state:r})=>()=>{a7(r)}},a7=r=>{r.elements.popper.style.setProperty(Fo.transformOrigin.var,oke(r.placement))},lke={name:"positionArrow",enabled:!0,phase:"afterWrite",fn:({state:r})=>{uke(r)}},uke=r=>{var t;if(!r.placement)return;const o=dke(r.placement);if((t=r.elements)!=null&&t.arrow&&o){Object.assign(r.elements.arrow.style,{[o.property]:o.value,width:Fo.arrowSize.varRef,height:Fo.arrowSize.varRef,zIndex:-1});const a={[Fo.arrowSizeHalf.var]:`calc(${Fo.arrowSize.varRef} / 2 - 1px)`,[Fo.arrowOffset.var]:`calc(${Fo.arrowSizeHalf.varRef} * -1)`};for(const l in a)r.elements.arrow.style.setProperty(l,a[l])}},dke=r=>{if(r.startsWith("top"))return{property:"bottom",value:Fo.arrowOffset.varRef};if(r.startsWith("bottom"))return{property:"top",value:Fo.arrowOffset.varRef};if(r.startsWith("left"))return{property:"right",value:Fo.arrowOffset.varRef};if(r.startsWith("right"))return{property:"left",value:Fo.arrowOffset.varRef}},hke={name:"innerArrow",enabled:!0,phase:"main",requires:["arrow"],fn:({state:r})=>{c7(r)},effect:({state:r})=>()=>{c7(r)}},c7=r=>{if(!r.elements.arrow)return;const t=r.elements.arrow.querySelector("[data-popper-arrow-inner]");if(!t)return;const o=rke(r.placement);o&&t.style.setProperty("--popper-arrow-default-shadow",o),Object.assign(t.style,{transform:"rotate(45deg)",background:Fo.arrowBg.varRef,top:0,left:0,width:"100%",height:"100%",position:"absolute",zIndex:"inherit",boxShadow:"var(--popper-arrow-shadow, var(--popper-arrow-default-shadow))"})},fke={"start-start":{ltr:"left-start",rtl:"right-start"},"start-end":{ltr:"left-end",rtl:"right-end"},"end-start":{ltr:"right-start",rtl:"left-start"},"end-end":{ltr:"right-end",rtl:"left-end"},start:{ltr:"left",rtl:"right"},end:{ltr:"right",rtl:"left"}},pke={"auto-start":"auto-end","auto-end":"auto-start","top-start":"top-end","top-end":"top-start","bottom-start":"bottom-end","bottom-end":"bottom-start"};function mke(r,t="ltr"){var o,a;const l=((o=fke[r])==null?void 0:o[t])||r;return t==="ltr"?l:(a=pke[r])!=null?a:l}var kc="top",ou="bottom",su="right",Dc="left",XV="auto",qw=[kc,ou,su,Dc],lS="start",yw="end",gke="clippingParents",nee="viewport",sb="popper",_ke="reference",l7=qw.reduce(function(r,t){return r.concat([t+"-"+lS,t+"-"+yw])},[]),ree=[].concat(qw,[XV]).reduce(function(r,t){return r.concat([t,t+"-"+lS,t+"-"+yw])},[]),vke="beforeRead",Eke="read",yke="afterRead",Ske="beforeMain",Tke="main",bke="afterMain",wke="beforeWrite",Rke="write",Cke="afterWrite",Ike=[vke,Eke,yke,Ske,Tke,bke,wke,Rke,Cke];function Sh(r){return r?(r.nodeName||"").toLowerCase():null}function gl(r){if(r==null)return window;if(r.toString()!=="[object Window]"){var t=r.ownerDocument;return t&&t.defaultView||window}return r}function Y_(r){var t=gl(r).Element;return r instanceof t||r instanceof Element}function nu(r){var t=gl(r).HTMLElement;return r instanceof t||r instanceof HTMLElement}function JV(r){if(typeof ShadowRoot>"u")return!1;var t=gl(r).ShadowRoot;return r instanceof t||r instanceof ShadowRoot}function Ake(r){var t=r.state;Object.keys(t.elements).forEach(function(o){var a=t.styles[o]||{},l=t.attributes[o]||{},d=t.elements[o];!nu(d)||!Sh(d)||(Object.assign(d.style,a),Object.keys(l).forEach(function(m){var v=l[m];v===!1?d.removeAttribute(m):d.setAttribute(m,v===!0?"":v)}))})}function Oke(r){var t=r.state,o={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(t.elements.popper.style,o.popper),t.styles=o,t.elements.arrow&&Object.assign(t.elements.arrow.style,o.arrow),function(){Object.keys(t.elements).forEach(function(a){var l=t.elements[a],d=t.attributes[a]||{},m=Object.keys(t.styles.hasOwnProperty(a)?t.styles[a]:o[a]),v=m.reduce(function(y,b){return y[b]="",y},{});!nu(l)||!Sh(l)||(Object.assign(l.style,v),Object.keys(d).forEach(function(y){l.removeAttribute(y)}))})}}const Pke={name:"applyStyles",enabled:!0,phase:"write",fn:Ake,effect:Oke,requires:["computeStyles"]};function hh(r){return r.split("-")[0]}var G_=Math.max,MP=Math.min,uS=Math.round;function Q2(){var r=navigator.userAgentData;return r!=null&&r.brands&&Array.isArray(r.brands)?r.brands.map(function(t){return t.brand+"/"+t.version}).join(" "):navigator.userAgent}function iee(){return!/^((?!chrome|android).)*safari/i.test(Q2())}function dS(r,t,o){t===void 0&&(t=!1),o===void 0&&(o=!1);var a=r.getBoundingClientRect(),l=1,d=1;t&&nu(r)&&(l=r.offsetWidth>0&&uS(a.width)/r.offsetWidth||1,d=r.offsetHeight>0&&uS(a.height)/r.offsetHeight||1);var m=Y_(r)?gl(r):window,v=m.visualViewport,y=!iee()&&o,b=(a.left+(y&&v?v.offsetLeft:0))/l,R=(a.top+(y&&v?v.offsetTop:0))/d,O=a.width/l,N=a.height/d;return{width:O,height:N,top:R,right:b+O,bottom:R+N,left:b,x:b,y:R}}function QV(r){var t=dS(r),o=r.offsetWidth,a=r.offsetHeight;return Math.abs(t.width-o)<=1&&(o=t.width),Math.abs(t.height-a)<=1&&(a=t.height),{x:r.offsetLeft,y:r.offsetTop,width:o,height:a}}function oee(r,t){var o=t.getRootNode&&t.getRootNode();if(r.contains(t))return!0;if(o&&JV(o)){var a=t;do{if(a&&r.isSameNode(a))return!0;a=a.parentNode||a.host}while(a)}return!1}function $f(r){return gl(r).getComputedStyle(r)}function Nke(r){return["table","td","th"].indexOf(Sh(r))>=0}function jm(r){return((Y_(r)?r.ownerDocument:r.document)||window.document).documentElement}function IN(r){return Sh(r)==="html"?r:r.assignedSlot||r.parentNode||(JV(r)?r.host:null)||jm(r)}function u7(r){return!nu(r)||$f(r).position==="fixed"?null:r.offsetParent}function kke(r){var t=/firefox/i.test(Q2()),o=/Trident/i.test(Q2());if(o&&nu(r)){var a=$f(r);if(a.position==="fixed")return null}var l=IN(r);for(JV(l)&&(l=l.host);nu(l)&&["html","body"].indexOf(Sh(l))<0;){var d=$f(l);if(d.transform!=="none"||d.perspective!=="none"||d.contain==="paint"||["transform","perspective"].indexOf(d.willChange)!==-1||t&&d.willChange==="filter"||t&&d.filter&&d.filter!=="none")return l;l=l.parentNode}return null}function Yw(r){for(var t=gl(r),o=u7(r);o&&Nke(o)&&$f(o).position==="static";)o=u7(o);return o&&(Sh(o)==="html"||Sh(o)==="body"&&$f(o).position==="static")?t:o||kke(r)||t}function ZV(r){return["top","bottom"].indexOf(r)>=0?"x":"y"}function qb(r,t,o){return G_(r,MP(t,o))}function Dke(r,t,o){var a=qb(r,t,o);return a>o?o:a}function see(){return{top:0,right:0,bottom:0,left:0}}function aee(r){return Object.assign({},see(),r)}function cee(r,t){return t.reduce(function(o,a){return o[a]=r,o},{})}var Lke=function(t,o){return t=typeof t=="function"?t(Object.assign({},o.rects,{placement:o.placement})):t,aee(typeof t!="number"?t:cee(t,qw))};function xke(r){var t,o=r.state,a=r.name,l=r.options,d=o.elements.arrow,m=o.modifiersData.popperOffsets,v=hh(o.placement),y=ZV(v),b=[Dc,su].indexOf(v)>=0,R=b?"height":"width";if(!(!d||!m)){var O=Lke(l.padding,o),N=QV(d),F=y==="y"?kc:Dc,H=y==="y"?ou:su,G=o.rects.reference[R]+o.rects.reference[y]-m[y]-o.rects.popper[R],z=m[y]-o.rects.reference[y],ne=Yw(d),J=ne?y==="y"?ne.clientHeight||0:ne.clientWidth||0:0,oe=G/2-z/2,se=O[F],ae=J-N[R]-O[H],ye=J/2-N[R]/2+oe,Q=qb(se,ye,ae),te=y;o.modifiersData[a]=(t={},t[te]=Q,t.centerOffset=Q-ye,t)}}function Mke(r){var t=r.state,o=r.options,a=o.element,l=a===void 0?"[data-popper-arrow]":a;l!=null&&(typeof l=="string"&&(l=t.elements.popper.querySelector(l),!l)||oee(t.elements.popper,l)&&(t.elements.arrow=l))}const Uke={name:"arrow",enabled:!0,phase:"main",fn:xke,effect:Mke,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function hS(r){return r.split("-")[1]}var Vke={top:"auto",right:"auto",bottom:"auto",left:"auto"};function Fke(r,t){var o=r.x,a=r.y,l=t.devicePixelRatio||1;return{x:uS(o*l)/l||0,y:uS(a*l)/l||0}}function d7(r){var t,o=r.popper,a=r.popperRect,l=r.placement,d=r.variation,m=r.offsets,v=r.position,y=r.gpuAcceleration,b=r.adaptive,R=r.roundOffsets,O=r.isFixed,N=m.x,F=N===void 0?0:N,H=m.y,G=H===void 0?0:H,z=typeof R=="function"?R({x:F,y:G}):{x:F,y:G};F=z.x,G=z.y;var ne=m.hasOwnProperty("x"),J=m.hasOwnProperty("y"),oe=Dc,se=kc,ae=window;if(b){var ye=Yw(o),Q="clientHeight",te="clientWidth";if(ye===gl(o)&&(ye=jm(o),$f(ye).position!=="static"&&v==="absolute"&&(Q="scrollHeight",te="scrollWidth")),ye=ye,l===kc||(l===Dc||l===su)&&d===yw){se=ou;var re=O&&ye===ae&&ae.visualViewport?ae.visualViewport.height:ye[Q];G-=re-a.height,G*=y?1:-1}if(l===Dc||(l===kc||l===ou)&&d===yw){oe=su;var le=O&&ye===ae&&ae.visualViewport?ae.visualViewport.width:ye[te];F-=le-a.width,F*=y?1:-1}}var ve=Object.assign({position:v},b&&Vke),fe=R===!0?Fke({x:F,y:G},gl(o)):{x:F,y:G};if(F=fe.x,G=fe.y,y){var de;return Object.assign({},ve,(de={},de[se]=J?"0":"",de[oe]=ne?"0":"",de.transform=(ae.devicePixelRatio||1)<=1?"translate("+F+"px, "+G+"px)":"translate3d("+F+"px, "+G+"px, 0)",de))}return Object.assign({},ve,(t={},t[se]=J?G+"px":"",t[oe]=ne?F+"px":"",t.transform="",t))}function jke(r){var t=r.state,o=r.options,a=o.gpuAcceleration,l=a===void 0?!0:a,d=o.adaptive,m=d===void 0?!0:d,v=o.roundOffsets,y=v===void 0?!0:v,b={placement:hh(t.placement),variation:hS(t.placement),popper:t.elements.popper,popperRect:t.rects.popper,gpuAcceleration:l,isFixed:t.options.strategy==="fixed"};t.modifiersData.popperOffsets!=null&&(t.styles.popper=Object.assign({},t.styles.popper,d7(Object.assign({},b,{offsets:t.modifiersData.popperOffsets,position:t.options.strategy,adaptive:m,roundOffsets:y})))),t.modifiersData.arrow!=null&&(t.styles.arrow=Object.assign({},t.styles.arrow,d7(Object.assign({},b,{offsets:t.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:y})))),t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-placement":t.placement})}const Bke={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:jke,data:{}};var yO={passive:!0};function Wke(r){var t=r.state,o=r.instance,a=r.options,l=a.scroll,d=l===void 0?!0:l,m=a.resize,v=m===void 0?!0:m,y=gl(t.elements.popper),b=[].concat(t.scrollParents.reference,t.scrollParents.popper);return d&&b.forEach(function(R){R.addEventListener("scroll",o.update,yO)}),v&&y.addEventListener("resize",o.update,yO),function(){d&&b.forEach(function(R){R.removeEventListener("scroll",o.update,yO)}),v&&y.removeEventListener("resize",o.update,yO)}}const Gke={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:Wke,data:{}};var zke={left:"right",right:"left",bottom:"top",top:"bottom"};function nP(r){return r.replace(/left|right|bottom|top/g,function(t){return zke[t]})}var Hke={start:"end",end:"start"};function h7(r){return r.replace(/start|end/g,function(t){return Hke[t]})}function eF(r){var t=gl(r),o=t.pageXOffset,a=t.pageYOffset;return{scrollLeft:o,scrollTop:a}}function tF(r){return dS(jm(r)).left+eF(r).scrollLeft}function Kke(r,t){var o=gl(r),a=jm(r),l=o.visualViewport,d=a.clientWidth,m=a.clientHeight,v=0,y=0;if(l){d=l.width,m=l.height;var b=iee();(b||!b&&t==="fixed")&&(v=l.offsetLeft,y=l.offsetTop)}return{width:d,height:m,x:v+tF(r),y}}function $ke(r){var t,o=jm(r),a=eF(r),l=(t=r.ownerDocument)==null?void 0:t.body,d=G_(o.scrollWidth,o.clientWidth,l?l.scrollWidth:0,l?l.clientWidth:0),m=G_(o.scrollHeight,o.clientHeight,l?l.scrollHeight:0,l?l.clientHeight:0),v=-a.scrollLeft+tF(r),y=-a.scrollTop;return $f(l||o).direction==="rtl"&&(v+=G_(o.clientWidth,l?l.clientWidth:0)-d),{width:d,height:m,x:v,y}}function nF(r){var t=$f(r),o=t.overflow,a=t.overflowX,l=t.overflowY;return/auto|scroll|overlay|hidden/.test(o+l+a)}function lee(r){return["html","body","#document"].indexOf(Sh(r))>=0?r.ownerDocument.body:nu(r)&&nF(r)?r:lee(IN(r))}function Yb(r,t){var o;t===void 0&&(t=[]);var a=lee(r),l=a===((o=r.ownerDocument)==null?void 0:o.body),d=gl(a),m=l?[d].concat(d.visualViewport||[],nF(a)?a:[]):a,v=t.concat(m);return l?v:v.concat(Yb(IN(m)))}function Z2(r){return Object.assign({},r,{left:r.x,top:r.y,right:r.x+r.width,bottom:r.y+r.height})}function qke(r,t){var o=dS(r,!1,t==="fixed");return o.top=o.top+r.clientTop,o.left=o.left+r.clientLeft,o.bottom=o.top+r.clientHeight,o.right=o.left+r.clientWidth,o.width=r.clientWidth,o.height=r.clientHeight,o.x=o.left,o.y=o.top,o}function f7(r,t,o){return t===nee?Z2(Kke(r,o)):Y_(t)?qke(t,o):Z2($ke(jm(r)))}function Yke(r){var t=Yb(IN(r)),o=["absolute","fixed"].indexOf($f(r).position)>=0,a=o&&nu(r)?Yw(r):r;return Y_(a)?t.filter(function(l){return Y_(l)&&oee(l,a)&&Sh(l)!=="body"}):[]}function Xke(r,t,o,a){var l=t==="clippingParents"?Yke(r):[].concat(t),d=[].concat(l,[o]),m=d[0],v=d.reduce(function(y,b){var R=f7(r,b,a);return y.top=G_(R.top,y.top),y.right=MP(R.right,y.right),y.bottom=MP(R.bottom,y.bottom),y.left=G_(R.left,y.left),y},f7(r,m,a));return v.width=v.right-v.left,v.height=v.bottom-v.top,v.x=v.left,v.y=v.top,v}function uee(r){var t=r.reference,o=r.element,a=r.placement,l=a?hh(a):null,d=a?hS(a):null,m=t.x+t.width/2-o.width/2,v=t.y+t.height/2-o.height/2,y;switch(l){case kc:y={x:m,y:t.y-o.height};break;case ou:y={x:m,y:t.y+t.height};break;case su:y={x:t.x+t.width,y:v};break;case Dc:y={x:t.x-o.width,y:v};break;default:y={x:t.x,y:t.y}}var b=l?ZV(l):null;if(b!=null){var R=b==="y"?"height":"width";switch(d){case lS:y[b]=y[b]-(t[R]/2-o[R]/2);break;case yw:y[b]=y[b]+(t[R]/2-o[R]/2);break}}return y}function Sw(r,t){t===void 0&&(t={});var o=t,a=o.placement,l=a===void 0?r.placement:a,d=o.strategy,m=d===void 0?r.strategy:d,v=o.boundary,y=v===void 0?gke:v,b=o.rootBoundary,R=b===void 0?nee:b,O=o.elementContext,N=O===void 0?sb:O,F=o.altBoundary,H=F===void 0?!1:F,G=o.padding,z=G===void 0?0:G,ne=aee(typeof z!="number"?z:cee(z,qw)),J=N===sb?_ke:sb,oe=r.rects.popper,se=r.elements[H?J:N],ae=Xke(Y_(se)?se:se.contextElement||jm(r.elements.popper),y,R,m),ye=dS(r.elements.reference),Q=uee({reference:ye,element:oe,placement:l}),te=Z2(Object.assign({},oe,Q)),re=N===sb?te:ye,le={top:ae.top-re.top+ne.top,bottom:re.bottom-ae.bottom+ne.bottom,left:ae.left-re.left+ne.left,right:re.right-ae.right+ne.right},ve=r.modifiersData.offset;if(N===sb&&ve){var fe=ve[l];Object.keys(le).forEach(function(de){var lt=[su,ou].indexOf(de)>=0?1:-1,ft=[kc,ou].indexOf(de)>=0?"y":"x";le[de]+=fe[ft]*lt})}return le}function Jke(r,t){t===void 0&&(t={});var o=t,a=o.placement,l=o.boundary,d=o.rootBoundary,m=o.padding,v=o.flipVariations,y=o.allowedAutoPlacements,b=y===void 0?ree:y,R=hS(a),O=R?v?l7:l7.filter(function(H){return hS(H)===R}):qw,N=O.filter(function(H){return b.indexOf(H)>=0});N.length===0&&(N=O);var F=N.reduce(function(H,G){return H[G]=Sw(r,{placement:G,boundary:l,rootBoundary:d,padding:m})[hh(G)],H},{});return Object.keys(F).sort(function(H,G){return F[H]-F[G]})}function Qke(r){if(hh(r)===XV)return[];var t=nP(r);return[h7(r),t,h7(t)]}function Zke(r){var t=r.state,o=r.options,a=r.name;if(!t.modifiersData[a]._skip){for(var l=o.mainAxis,d=l===void 0?!0:l,m=o.altAxis,v=m===void 0?!0:m,y=o.fallbackPlacements,b=o.padding,R=o.boundary,O=o.rootBoundary,N=o.altBoundary,F=o.flipVariations,H=F===void 0?!0:F,G=o.allowedAutoPlacements,z=t.options.placement,ne=hh(z),J=ne===z,oe=y||(J||!H?[nP(z)]:Qke(z)),se=[z].concat(oe).reduce(function(Fe,et){return Fe.concat(hh(et)===XV?Jke(t,{placement:et,boundary:R,rootBoundary:O,padding:b,flipVariations:H,allowedAutoPlacements:G}):et)},[]),ae=t.rects.reference,ye=t.rects.popper,Q=new Map,te=!0,re=se[0],le=0;le<se.length;le++){var ve=se[le],fe=hh(ve),de=hS(ve)===lS,lt=[kc,ou].indexOf(fe)>=0,ft=lt?"width":"height",Xe=Sw(t,{placement:ve,boundary:R,rootBoundary:O,altBoundary:N,padding:b}),Le=lt?de?su:Dc:de?ou:kc;ae[ft]>ye[ft]&&(Le=nP(Le));var Ke=nP(Le),nt=[];if(d&&nt.push(Xe[fe]<=0),v&&nt.push(Xe[Le]<=0,Xe[Ke]<=0),nt.every(function(Fe){return Fe})){re=ve,te=!1;break}Q.set(ve,nt)}if(te)for(var Ee=H?3:1,Ye=function(et){var _t=se.find(function(Dt){var Ht=Q.get(Dt);if(Ht)return Ht.slice(0,et).every(function(Wt){return Wt})});if(_t)return re=_t,"break"},yt=Ee;yt>0;yt--){var at=Ye(yt);if(at==="break")break}t.placement!==re&&(t.modifiersData[a]._skip=!0,t.placement=re,t.reset=!0)}}const eDe={name:"flip",enabled:!0,phase:"main",fn:Zke,requiresIfExists:["offset"],data:{_skip:!1}};function p7(r,t,o){return o===void 0&&(o={x:0,y:0}),{top:r.top-t.height-o.y,right:r.right-t.width+o.x,bottom:r.bottom-t.height+o.y,left:r.left-t.width-o.x}}function m7(r){return[kc,su,ou,Dc].some(function(t){return r[t]>=0})}function tDe(r){var t=r.state,o=r.name,a=t.rects.reference,l=t.rects.popper,d=t.modifiersData.preventOverflow,m=Sw(t,{elementContext:"reference"}),v=Sw(t,{altBoundary:!0}),y=p7(m,a),b=p7(v,l,d),R=m7(y),O=m7(b);t.modifiersData[o]={referenceClippingOffsets:y,popperEscapeOffsets:b,isReferenceHidden:R,hasPopperEscaped:O},t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-reference-hidden":R,"data-popper-escaped":O})}const nDe={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:tDe};function rDe(r,t,o){var a=hh(r),l=[Dc,kc].indexOf(a)>=0?-1:1,d=typeof o=="function"?o(Object.assign({},t,{placement:r})):o,m=d[0],v=d[1];return m=m||0,v=(v||0)*l,[Dc,su].indexOf(a)>=0?{x:v,y:m}:{x:m,y:v}}function iDe(r){var t=r.state,o=r.options,a=r.name,l=o.offset,d=l===void 0?[0,0]:l,m=ree.reduce(function(R,O){return R[O]=rDe(O,t.rects,d),R},{}),v=m[t.placement],y=v.x,b=v.y;t.modifiersData.popperOffsets!=null&&(t.modifiersData.popperOffsets.x+=y,t.modifiersData.popperOffsets.y+=b),t.modifiersData[a]=m}const oDe={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:iDe};function sDe(r){var t=r.state,o=r.name;t.modifiersData[o]=uee({reference:t.rects.reference,element:t.rects.popper,placement:t.placement})}const aDe={name:"popperOffsets",enabled:!0,phase:"read",fn:sDe,data:{}};function cDe(r){return r==="x"?"y":"x"}function lDe(r){var t=r.state,o=r.options,a=r.name,l=o.mainAxis,d=l===void 0?!0:l,m=o.altAxis,v=m===void 0?!1:m,y=o.boundary,b=o.rootBoundary,R=o.altBoundary,O=o.padding,N=o.tether,F=N===void 0?!0:N,H=o.tetherOffset,G=H===void 0?0:H,z=Sw(t,{boundary:y,rootBoundary:b,padding:O,altBoundary:R}),ne=hh(t.placement),J=hS(t.placement),oe=!J,se=ZV(ne),ae=cDe(se),ye=t.modifiersData.popperOffsets,Q=t.rects.reference,te=t.rects.popper,re=typeof G=="function"?G(Object.assign({},t.rects,{placement:t.placement})):G,le=typeof re=="number"?{mainAxis:re,altAxis:re}:Object.assign({mainAxis:0,altAxis:0},re),ve=t.modifiersData.offset?t.modifiersData.offset[t.placement]:null,fe={x:0,y:0};if(ye){if(d){var de,lt=se==="y"?kc:Dc,ft=se==="y"?ou:su,Xe=se==="y"?"height":"width",Le=ye[se],Ke=Le+z[lt],nt=Le-z[ft],Ee=F?-te[Xe]/2:0,Ye=J===lS?Q[Xe]:te[Xe],yt=J===lS?-te[Xe]:-Q[Xe],at=t.elements.arrow,Fe=F&&at?QV(at):{width:0,height:0},et=t.modifiersData["arrow#persistent"]?t.modifiersData["arrow#persistent"].padding:see(),_t=et[lt],Dt=et[ft],Ht=qb(0,Q[Xe],Fe[Xe]),Wt=oe?Q[Xe]/2-Ee-Ht-_t-le.mainAxis:Ye-Ht-_t-le.mainAxis,Fn=oe?-Q[Xe]/2+Ee+Ht+Dt+le.mainAxis:yt+Ht+Dt+le.mainAxis,xn=t.elements.arrow&&Yw(t.elements.arrow),hn=xn?se==="y"?xn.clientTop||0:xn.clientLeft||0:0,gr=(de=ve==null?void 0:ve[se])!=null?de:0,Ar=Le+Wt-gr-hn,bt=Le+Fn-gr,bn=qb(F?MP(Ke,Ar):Ke,Le,F?G_(nt,bt):nt);ye[se]=bn,fe[se]=bn-Le}if(v){var wn,we=se==="x"?kc:Dc,De=se==="x"?ou:su,We=ye[ae],mt=ae==="y"?"height":"width",gt=We+z[we],ht=We-z[De],Mt=[kc,Dc].indexOf(ne)!==-1,jn=(wn=ve==null?void 0:ve[ae])!=null?wn:0,On=Mt?gt:We-Q[mt]-te[mt]-jn+le.altAxis,nn=Mt?We+Q[mt]+te[mt]-jn-le.altAxis:ht,_r=F&&Mt?Dke(On,We,nn):qb(F?On:gt,We,F?nn:ht);ye[ae]=_r,fe[ae]=_r-We}t.modifiersData[a]=fe}}const uDe={name:"preventOverflow",enabled:!0,phase:"main",fn:lDe,requiresIfExists:["offset"]};function dDe(r){return{scrollLeft:r.scrollLeft,scrollTop:r.scrollTop}}function hDe(r){return r===gl(r)||!nu(r)?eF(r):dDe(r)}function fDe(r){var t=r.getBoundingClientRect(),o=uS(t.width)/r.offsetWidth||1,a=uS(t.height)/r.offsetHeight||1;return o!==1||a!==1}function pDe(r,t,o){o===void 0&&(o=!1);var a=nu(t),l=nu(t)&&fDe(t),d=jm(t),m=dS(r,l,o),v={scrollLeft:0,scrollTop:0},y={x:0,y:0};return(a||!a&&!o)&&((Sh(t)!=="body"||nF(d))&&(v=hDe(t)),nu(t)?(y=dS(t,!0),y.x+=t.clientLeft,y.y+=t.clientTop):d&&(y.x=tF(d))),{x:m.left+v.scrollLeft-y.x,y:m.top+v.scrollTop-y.y,width:m.width,height:m.height}}function mDe(r){var t=new Map,o=new Set,a=[];r.forEach(function(d){t.set(d.name,d)});function l(d){o.add(d.name);var m=[].concat(d.requires||[],d.requiresIfExists||[]);m.forEach(function(v){if(!o.has(v)){var y=t.get(v);y&&l(y)}}),a.push(d)}return r.forEach(function(d){o.has(d.name)||l(d)}),a}function gDe(r){var t=mDe(r);return Ike.reduce(function(o,a){return o.concat(t.filter(function(l){return l.phase===a}))},[])}function _De(r){var t;return function(){return t||(t=new Promise(function(o){Promise.resolve().then(function(){t=void 0,o(r())})})),t}}function vDe(r){var t=r.reduce(function(o,a){var l=o[a.name];return o[a.name]=l?Object.assign({},l,a,{options:Object.assign({},l.options,a.options),data:Object.assign({},l.data,a.data)}):a,o},{});return Object.keys(t).map(function(o){return t[o]})}var g7={placement:"bottom",modifiers:[],strategy:"absolute"};function _7(){for(var r=arguments.length,t=new Array(r),o=0;o<r;o++)t[o]=arguments[o];return!t.some(function(a){return!(a&&typeof a.getBoundingClientRect=="function")})}function EDe(r){r===void 0&&(r={});var t=r,o=t.defaultModifiers,a=o===void 0?[]:o,l=t.defaultOptions,d=l===void 0?g7:l;return function(v,y,b){b===void 0&&(b=d);var R={placement:"bottom",orderedModifiers:[],options:Object.assign({},g7,d),modifiersData:{},elements:{reference:v,popper:y},attributes:{},styles:{}},O=[],N=!1,F={state:R,setOptions:function(ne){var J=typeof ne=="function"?ne(R.options):ne;G(),R.options=Object.assign({},d,R.options,J),R.scrollParents={reference:Y_(v)?Yb(v):v.contextElement?Yb(v.contextElement):[],popper:Yb(y)};var oe=gDe(vDe([].concat(a,R.options.modifiers)));return R.orderedModifiers=oe.filter(function(se){return se.enabled}),H(),F.update()},forceUpdate:function(){if(!N){var ne=R.elements,J=ne.reference,oe=ne.popper;if(_7(J,oe)){R.rects={reference:pDe(J,Yw(oe),R.options.strategy==="fixed"),popper:QV(oe)},R.reset=!1,R.placement=R.options.placement,R.orderedModifiers.forEach(function(le){return R.modifiersData[le.name]=Object.assign({},le.data)});for(var se=0;se<R.orderedModifiers.length;se++){if(R.reset===!0){R.reset=!1,se=-1;continue}var ae=R.orderedModifiers[se],ye=ae.fn,Q=ae.options,te=Q===void 0?{}:Q,re=ae.name;typeof ye=="function"&&(R=ye({state:R,options:te,name:re,instance:F})||R)}}}},update:_De(function(){return new Promise(function(z){F.forceUpdate(),z(R)})}),destroy:function(){G(),N=!0}};if(!_7(v,y))return F;F.setOptions(b).then(function(z){!N&&b.onFirstUpdate&&b.onFirstUpdate(z)});function H(){R.orderedModifiers.forEach(function(z){var ne=z.name,J=z.options,oe=J===void 0?{}:J,se=z.effect;if(typeof se=="function"){var ae=se({state:R,name:ne,instance:F,options:oe}),ye=function(){};O.push(ae||ye)}})}function G(){O.forEach(function(z){return z()}),O=[]}return F}}var yDe=[Gke,aDe,Bke,Pke,oDe,eDe,uDe,Uke,nDe],SDe=EDe({defaultModifiers:yDe});function rF(r={}){const{enabled:t=!0,modifiers:o,placement:a="bottom",strategy:l="absolute",arrowPadding:d=8,eventListeners:m=!0,offset:v,gutter:y=8,flip:b=!0,boundary:R="clippingParents",preventOverflow:O=!0,matchWidth:N,direction:F="ltr"}=r,H=V.useRef(null),G=V.useRef(null),z=V.useRef(null),ne=mke(a,F),J=V.useRef(()=>{}),oe=V.useCallback(()=>{var le;!t||!H.current||!G.current||((le=J.current)==null||le.call(J),z.current=SDe(H.current,G.current,{placement:ne,modifiers:[hke,lke,cke,{...ake,enabled:!!N},{name:"eventListeners",...ske(m)},{name:"arrow",options:{padding:d}},{name:"offset",options:{offset:v??[0,y]}},{name:"flip",enabled:!!b,options:{padding:8}},{name:"preventOverflow",enabled:!!O,options:{boundary:R}},...o??[]],strategy:l}),z.current.forceUpdate(),J.current=z.current.destroy)},[ne,t,o,N,m,d,v,y,b,O,R,l]);V.useEffect(()=>()=>{var le;!H.current&&!G.current&&((le=z.current)==null||le.destroy(),z.current=null)},[]);const se=V.useCallback(le=>{H.current=le,oe()},[oe]),ae=V.useCallback((le={},ve=null)=>({...le,ref:zi(se,ve)}),[se]),ye=V.useCallback(le=>{G.current=le,oe()},[oe]),Q=V.useCallback((le={},ve=null)=>({...le,ref:zi(ye,ve),style:{...le.style,position:l,minWidth:N?void 0:"max-content",inset:"0 auto auto 0"}}),[l,ye,N]),te=V.useCallback((le={},ve=null)=>{const{size:fe,shadowColor:de,bg:lt,style:ft,...Xe}=le;return{...Xe,ref:ve,"data-popper-arrow":"",style:TDe(le)}},[]),re=V.useCallback((le={},ve=null)=>({...le,ref:ve,"data-popper-arrow-inner":""}),[]);return{update(){var le;(le=z.current)==null||le.update()},forceUpdate(){var le;(le=z.current)==null||le.forceUpdate()},transformOrigin:Fo.transformOrigin.varRef,referenceRef:se,popperRef:ye,getPopperProps:Q,getArrowProps:te,getArrowInnerProps:re,getReferenceProps:ae}}function TDe(r){const{size:t,shadowColor:o,bg:a,style:l}=r,d={...l,position:"absolute"};return t&&(d["--popper-arrow-size"]=t),o&&(d["--popper-arrow-shadow-color"]=o),a&&(d["--popper-arrow-bg"]=a),d}function iF(r={}){const{onClose:t,onOpen:o,isOpen:a,id:l}=r,d=Pc(o),m=Pc(t),[v,y]=V.useState(r.defaultIsOpen||!1),b=a!==void 0?a:v,R=a!==void 0,O=V.useId(),N=l??`disclosure-${O}`,F=V.useCallback(()=>{R||y(!1),m==null||m()},[R,m]),H=V.useCallback(()=>{R||y(!0),d==null||d()},[R,d]),G=V.useCallback(()=>{b?F():H()},[b,H,F]);function z(J={}){return{...J,"aria-expanded":b,"aria-controls":N,onClick(oe){var se;(se=J.onClick)==null||se.call(J,oe),G()}}}function ne(J={}){return{...J,hidden:!b,id:N}}return{isOpen:b,onOpen:H,onClose:F,onToggle:G,isControlled:R,getButtonProps:z,getDisclosureProps:ne}}function bDe(r){const{ref:t,handler:o,enabled:a=!0}=r,l=Pc(o),m=V.useRef({isPointerDown:!1,ignoreEmulatedMouseEvents:!1}).current;V.useEffect(()=>{if(!a)return;const v=O=>{DM(O,t)&&(m.isPointerDown=!0)},y=O=>{if(m.ignoreEmulatedMouseEvents){m.ignoreEmulatedMouseEvents=!1;return}m.isPointerDown&&o&&DM(O,t)&&(m.isPointerDown=!1,l(O))},b=O=>{m.ignoreEmulatedMouseEvents=!0,o&&m.isPointerDown&&DM(O,t)&&(m.isPointerDown=!1,l(O))},R=dee(t.current);return R.addEventListener("mousedown",v,!0),R.addEventListener("mouseup",y,!0),R.addEventListener("touchstart",v,!0),R.addEventListener("touchend",b,!0),()=>{R.removeEventListener("mousedown",v,!0),R.removeEventListener("mouseup",y,!0),R.removeEventListener("touchstart",v,!0),R.removeEventListener("touchend",b,!0)}},[o,t,l,m,a])}function DM(r,t){var o;const a=r.target;return a&&!dee(a).contains(a)?!1:!((o=t.current)!=null&&o.contains(a))}function dee(r){var t;return(t=r==null?void 0:r.ownerDocument)!=null?t:document}function hee(r){const{isOpen:t,ref:o}=r,[a,l]=V.useState(t),[d,m]=V.useState(!1);return V.useEffect(()=>{d||(l(t),m(!0))},[t,d,a]),qy(()=>o.current,"animationend",()=>{l(t)}),{present:!(t?!1:!a),onComplete(){var y;const b=RNe(o.current),R=new b.CustomEvent("animationend",{bubbles:!0});(y=o.current)==null||y.dispatchEvent(R)}}}function oF(r){const{wasSelected:t,enabled:o,isSelected:a,mode:l="unmount"}=r;return!!(!o||a||l==="keepMounted"&&t)}var[wDe,RDe,CDe,IDe]=XQ(),[ADe,Xw]=Hi({strict:!1,name:"MenuContext"});function ODe(r,...t){const o=V.useId(),a=r||o;return V.useMemo(()=>t.map(l=>`${l}-${a}`),[a,t])}function fee(r){var t;return(t=r==null?void 0:r.ownerDocument)!=null?t:document}function v7(r){return fee(r).activeElement===r}function PDe(r={}){const{id:t,closeOnSelect:o=!0,closeOnBlur:a=!0,initialFocusRef:l,autoSelect:d=!0,isLazy:m,isOpen:v,defaultIsOpen:y,onClose:b,onOpen:R,placement:O="bottom-start",lazyBehavior:N="unmount",direction:F,computePositionOnMount:H=!1,...G}=r,z=V.useRef(null),ne=V.useRef(null),J=CDe(),oe=V.useCallback(()=>{requestAnimationFrame(()=>{var at;(at=z.current)==null||at.focus({preventScroll:!1})})},[]),se=V.useCallback(()=>{const at=setTimeout(()=>{var Fe;if(l)(Fe=l.current)==null||Fe.focus();else{const et=J.firstEnabled();et&&de(et.index)}});Ke.current.add(at)},[J,l]),ae=V.useCallback(()=>{const at=setTimeout(()=>{const Fe=J.lastEnabled();Fe&&de(Fe.index)});Ke.current.add(at)},[J]),ye=V.useCallback(()=>{R==null||R(),d?se():oe()},[d,se,oe,R]),{isOpen:Q,onOpen:te,onClose:re,onToggle:le}=iF({isOpen:v,defaultIsOpen:y,onClose:b,onOpen:ye});bDe({enabled:Q&&a,ref:z,handler:at=>{var Fe;(Fe=ne.current)!=null&&Fe.contains(at.target)||re()}});const ve=rF({...G,enabled:Q||H,placement:O,direction:F}),[fe,de]=V.useState(-1);Am(()=>{Q||de(-1)},[Q]),tee(z,{focusRef:ne,visible:Q,shouldFocus:!0});const lt=hee({isOpen:Q,ref:z}),[ft,Xe]=ODe(t,"menu-button","menu-list"),Le=V.useCallback(()=>{te(),oe()},[te,oe]),Ke=V.useRef(new Set([]));V.useEffect(()=>{const at=Ke.current;return()=>{at.forEach(Fe=>clearTimeout(Fe)),at.clear()}},[]);const nt=V.useCallback(()=>{te(),se()},[se,te]),Ee=V.useCallback(()=>{te(),ae()},[te,ae]),Ye=V.useCallback(()=>{var at,Fe;const et=fee(z.current),_t=(at=z.current)==null?void 0:at.contains(et.activeElement);if(!(Q&&!_t))return;const Ht=(Fe=J.item(fe))==null?void 0:Fe.node;Ht==null||Ht.focus({preventScroll:!0})},[Q,fe,J]),yt=V.useRef(null);return{openAndFocusMenu:Le,openAndFocusFirstItem:nt,openAndFocusLastItem:Ee,onTransitionEnd:Ye,unstable__animationState:lt,descendants:J,popper:ve,buttonId:ft,menuId:Xe,forceUpdate:ve.forceUpdate,orientation:"vertical",isOpen:Q,onToggle:le,onOpen:te,onClose:re,menuRef:z,buttonRef:ne,focusedIndex:fe,closeOnSelect:o,closeOnBlur:a,autoSelect:d,setFocusedIndex:de,isLazy:m,lazyBehavior:N,initialFocusRef:l,rafId:yt}}function NDe(r={},t=null){const o=Xw(),{onToggle:a,popper:l,openAndFocusFirstItem:d,openAndFocusLastItem:m}=o,v=V.useCallback(y=>{const b=y.key,O={Enter:d,ArrowDown:d,ArrowUp:m}[b];O&&(y.preventDefault(),y.stopPropagation(),O(y))},[d,m]);return{...r,ref:zi(o.buttonRef,t,l.referenceRef),id:o.buttonId,"data-active":cr(o.isOpen),"aria-expanded":o.isOpen,"aria-haspopup":"menu","aria-controls":o.menuId,onClick:rr(r.onClick,a),onKeyDown:rr(r.onKeyDown,v)}}function eU(r){var t;return xDe(r)&&!!((t=r==null?void 0:r.getAttribute("role"))!=null&&t.startsWith("menuitem"))}function kDe(r={},t=null){const o=Xw();if(!o)throw new Error("useMenuContext: context is undefined. Seems you forgot to wrap component within <Menu>");const{focusedIndex:a,setFocusedIndex:l,menuRef:d,isOpen:m,onClose:v,menuId:y,isLazy:b,lazyBehavior:R,unstable__animationState:O}=o,N=RDe(),F=XNe({preventDefault:ne=>ne.key!==" "&&eU(ne.target)}),H=V.useCallback(ne=>{if(!ne.currentTarget.contains(ne.target))return;const J=ne.key,se={Tab:ye=>ye.preventDefault(),Escape:v,ArrowDown:()=>{const ye=N.nextEnabled(a);ye&&l(ye.index)},ArrowUp:()=>{const ye=N.prevEnabled(a);ye&&l(ye.index)}}[J];if(se){ne.preventDefault(),se(ne);return}const ae=F(ye=>{const Q=JNe(N.values(),ye,te=>{var re,le;return(le=(re=te==null?void 0:te.node)==null?void 0:re.textContent)!=null?le:""},N.item(a));if(Q){const te=N.indexOf(Q.node);l(te)}});eU(ne.target)&&ae(ne)},[N,a,F,v,l]),G=V.useRef(!1);m&&(G.current=!0);const z=oF({wasSelected:G.current,enabled:b,mode:R,isSelected:O.present});return{...r,ref:zi(d,t),children:z?r.children:null,tabIndex:-1,role:"menu",id:y,style:{...r.style,transformOrigin:"var(--popper-transform-origin)"},"aria-orientation":"vertical",onKeyDown:rr(r.onKeyDown,H)}}function DDe(r={}){const{popper:t,isOpen:o}=Xw();return t.getPopperProps({...r,style:{visibility:o?"visible":"hidden",...r.style}})}function LDe(r={},t=null){const{onMouseEnter:o,onMouseMove:a,onMouseLeave:l,onClick:d,onFocus:m,isDisabled:v,isFocusable:y,closeOnSelect:b,type:R,...O}=r,N=Xw(),{setFocusedIndex:F,focusedIndex:H,closeOnSelect:G,onClose:z,menuRef:ne,isOpen:J,menuId:oe,rafId:se}=N,ae=V.useRef(null),ye=`${oe}-menuitem-${V.useId()}`,{index:Q,register:te}=IDe({disabled:v&&!y}),re=V.useCallback(Le=>{o==null||o(Le),!v&&F(Q)},[F,Q,v,o]),le=V.useCallback(Le=>{a==null||a(Le),ae.current&&!v7(ae.current)&&re(Le)},[re,a]),ve=V.useCallback(Le=>{l==null||l(Le),!v&&F(-1)},[F,v,l]),fe=V.useCallback(Le=>{d==null||d(Le),eU(Le.currentTarget)&&(b??G)&&z()},[z,d,G,b]),de=V.useCallback(Le=>{m==null||m(Le),F(Q)},[F,m,Q]),lt=Q===H,ft=v&&!y;Am(()=>{if(J)return lt&&!ft&&ae.current?(se.current&&cancelAnimationFrame(se.current),se.current=requestAnimationFrame(()=>{var Le;(Le=ae.current)==null||Le.focus({preventScroll:!0}),se.current=null})):ne.current&&!v7(ne.current)&&ne.current.focus({preventScroll:!0}),()=>{se.current&&cancelAnimationFrame(se.current)}},[lt,ft,ne,J]);const Xe=eee({onClick:fe,onFocus:de,onMouseEnter:re,onMouseMove:le,onMouseLeave:ve,ref:zi(te,ae,t),isDisabled:v,isFocusable:y});return{...O,...Xe,type:R??Xe.type,id:ye,role:"menuitem",tabIndex:lt?0:-1}}function xDe(r){var t;if(!MDe(r))return!1;const o=(t=r.ownerDocument.defaultView)!=null?t:window;return r instanceof o.HTMLElement}function MDe(r){return r!=null&&typeof r=="object"&&"nodeType"in r&&r.nodeType===Node.ELEMENT_NODE}var[UDe,Jw]=Hi({name:"MenuStylesContext",errorMessage:`useMenuStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Menu />" `}),sF=r=>{const{children:t}=r,o=xc("Menu",r),a=Ki(r),{direction:l}=wS(),{descendants:d,...m}=PDe({...a,direction:l}),v=V.useMemo(()=>m,[m]),{isOpen:y,onClose:b,forceUpdate:R}=v;return D.jsx(wDe,{value:d,children:D.jsx(ADe,{value:v,children:D.jsx(UDe,{value:o,children:tu(t,{isOpen:y,onClose:b,forceUpdate:R})})})})};sF.displayName="Menu";var pee=zt((r,t)=>{const o=Jw();return D.jsx(Pt.span,{ref:t,...r,__css:o.command,className:"chakra-menu__command"})});pee.displayName="MenuCommand";var VDe=zt((r,t)=>{const{type:o,...a}=r,l=Jw(),d=a.as||o?o??void 0:"button",m=V.useMemo(()=>({textDecoration:"none",color:"inherit",userSelect:"none",display:"flex",width:"100%",alignItems:"center",textAlign:"start",flex:"0 0 auto",outline:0,...l.item}),[l.item]);return D.jsx(Pt.button,{ref:t,type:d,...a,__css:m})}),mee=r=>{const{className:t,children:o,...a}=r,l=Jw(),d=V.Children.only(o),m=V.isValidElement(d)?V.cloneElement(d,{focusable:"false","aria-hidden":!0,className:In("chakra-menu__icon",d.props.className)}):null,v=In("chakra-menu__icon-wrapper",t);return D.jsx(Pt.span,{className:v,...a,__css:l.icon,children:m})};mee.displayName="MenuIcon";var Ab=zt((r,t)=>{const{icon:o,iconSpacing:a="0.75rem",command:l,commandSpacing:d="0.75rem",children:m,...v}=r,y=LDe(v,t),R=o||l?D.jsx("span",{style:{pointerEvents:"none",flex:1},children:m}):m;return D.jsxs(VDe,{...y,className:In("chakra-menu__menuitem",y.className),children:[o&&D.jsx(mee,{fontSize:"0.8em",marginEnd:a,children:o}),R,l&&D.jsx(pee,{marginStart:d,children:l})]})});Ab.displayName="MenuItem";var FDe={enter:{visibility:"visible",opacity:1,scale:1,transition:{duration:.2,ease:[.4,0,.2,1]}},exit:{transitionEnd:{visibility:"hidden"},opacity:0,scale:.8,transition:{duration:.1,easings:"easeOut"}}},jDe=Pt(bh.div),aF=zt(function(t,o){var a,l;const{rootProps:d,motionProps:m,...v}=t,{isOpen:y,onTransitionEnd:b,unstable__animationState:R}=Xw(),O=kDe(v,o),N=DDe(d),F=Jw();return D.jsx(Pt.div,{...N,__css:{zIndex:(l=t.zIndex)!=null?l:(a=F.list)==null?void 0:a.zIndex},children:D.jsx(jDe,{variants:FDe,initial:!1,animate:y?"enter":"exit",__css:{outline:0,...F.list},...m,className:In("chakra-menu__menu-list",O.className),...O,onUpdate:b,onAnimationComplete:GX(R.onComplete,O.onAnimationComplete)})})});aF.displayName="MenuList";var BDe=zt((r,t)=>{const o=Jw();return D.jsx(Pt.button,{ref:t,...r,__css:{display:"inline-flex",appearance:"none",alignItems:"center",outline:0,...o.button}})}),cF=zt((r,t)=>{const{children:o,as:a,...l}=r,d=NDe(l,t),m=a||BDe;return D.jsx(m,{...d,className:In("chakra-menu__menu-button",r.className),children:D.jsx(Pt.span,{__css:{pointerEvents:"none",flex:"1 1 auto",minW:0},children:r.children})})});cF.displayName="MenuButton";var WDe={slideInBottom:{...Ib,custom:{offsetY:16,reverse:!0}},slideInRight:{...Ib,custom:{offsetX:16,reverse:!0}},slideInTop:{...Ib,custom:{offsetY:-16,reverse:!0}},slideInLeft:{...Ib,custom:{offsetX:-16,reverse:!0}},scale:{...ZQ,custom:{initialScale:.95,reverse:!0}},none:{}},GDe=Pt(bh.section),zDe=r=>WDe[r||"none"],gee=V.forwardRef((r,t)=>{const{preset:o,motionProps:a=zDe(o),...l}=r;return D.jsx(GDe,{ref:t,...a,...l})});gee.displayName="ModalTransition";var HDe=Object.defineProperty,KDe=(r,t,o)=>t in r?HDe(r,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):r[t]=o,$De=(r,t,o)=>(KDe(r,t+"",o),o),qDe=class{constructor(){$De(this,"modals"),this.modals=new Map}add(r){return this.modals.set(r,this.modals.size+1),this.modals.size}remove(r){this.modals.delete(r)}isTopModal(r){return r?this.modals.get(r)===this.modals.size:!1}},tU=new qDe;function _ee(r,t){const[o,a]=V.useState(0);return V.useEffect(()=>{const l=r.current;if(l){if(t){const d=tU.add(l);a(d)}return()=>{tU.remove(l),a(0)}}},[t,r]),o}var YDe=function(r){if(typeof document>"u")return null;var t=Array.isArray(r)?r[0]:r;return t.ownerDocument.body},_y=new WeakMap,SO=new WeakMap,TO={},LM=0,vee=function(r){return r&&(r.host||vee(r.parentNode))},XDe=function(r,t){return t.map(function(o){if(r.contains(o))return o;var a=vee(o);return a&&r.contains(a)?a:(console.error("aria-hidden",o,"in not contained inside",r,". Doing nothing"),null)}).filter(function(o){return!!o})},JDe=function(r,t,o,a){var l=XDe(t,Array.isArray(r)?r:[r]);TO[o]||(TO[o]=new WeakMap);var d=TO[o],m=[],v=new Set,y=new Set(l),b=function(O){!O||v.has(O)||(v.add(O),b(O.parentNode))};l.forEach(b);var R=function(O){!O||y.has(O)||Array.prototype.forEach.call(O.children,function(N){if(v.has(N))R(N);else try{var F=N.getAttribute(a),H=F!==null&&F!=="false",G=(_y.get(N)||0)+1,z=(d.get(N)||0)+1;_y.set(N,G),d.set(N,z),m.push(N),G===1&&H&&SO.set(N,!0),z===1&&N.setAttribute(o,"true"),H||N.setAttribute(a,"true")}catch(ne){console.error("aria-hidden: cannot operate on ",N,ne)}})};return R(t),v.clear(),LM++,function(){m.forEach(function(O){var N=_y.get(O)-1,F=d.get(O)-1;_y.set(O,N),d.set(O,F),N||(SO.has(O)||O.removeAttribute(a),SO.delete(O)),F||O.removeAttribute(o)}),LM--,LM||(_y=new WeakMap,_y=new WeakMap,SO=new WeakMap,TO={})}},QDe=function(r,t,o){o===void 0&&(o="data-aria-hidden");var a=Array.from(Array.isArray(r)?r:[r]),l=YDe(r);return l?(a.push.apply(a,Array.from(l.querySelectorAll("[aria-live]"))),JDe(a,l,o,"aria-hidden")):function(){return null}};function ZDe(r){const{isOpen:t,onClose:o,id:a,closeOnOverlayClick:l=!0,closeOnEsc:d=!0,useInert:m=!0,onOverlayClick:v,onEsc:y}=r,b=V.useRef(null),R=V.useRef(null),[O,N,F]=t1e(a,"chakra-modal","chakra-modal--header","chakra-modal--body");e1e(b,t&&m);const H=_ee(b,t),G=V.useRef(null),z=V.useCallback(re=>{G.current=re.target},[]),ne=V.useCallback(re=>{re.key==="Escape"&&(re.stopPropagation(),d&&(o==null||o()),y==null||y())},[d,o,y]),[J,oe]=V.useState(!1),[se,ae]=V.useState(!1),ye=V.useCallback((re={},le=null)=>({role:"dialog",...re,ref:zi(le,b),id:O,tabIndex:-1,"aria-modal":!0,"aria-labelledby":J?N:void 0,"aria-describedby":se?F:void 0,onClick:rr(re.onClick,ve=>ve.stopPropagation())}),[F,se,O,N,J]),Q=V.useCallback(re=>{re.stopPropagation(),G.current===re.target&&tU.isTopModal(b.current)&&(l&&(o==null||o()),v==null||v())},[o,l,v]),te=V.useCallback((re={},le=null)=>({...re,ref:zi(le,R),onClick:rr(re.onClick,Q),onKeyDown:rr(re.onKeyDown,ne),onMouseDown:rr(re.onMouseDown,z)}),[ne,z,Q]);return{isOpen:t,onClose:o,headerId:N,bodyId:F,setBodyMounted:ae,setHeaderMounted:oe,dialogRef:b,overlayRef:R,getDialogProps:ye,getDialogContainerProps:te,index:H}}function e1e(r,t){const o=r.current;V.useEffect(()=>{if(!(!r.current||!t))return QDe(r.current)},[t,r,o])}function t1e(r,...t){const o=V.useId(),a=r||o;return V.useMemo(()=>t.map(l=>`${l}-${a}`),[a,t])}var[n1e,OS]=Hi({name:"ModalStylesContext",errorMessage:`useModalStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Modal />" `}),[r1e,X_]=Hi({strict:!0,name:"ModalContext",errorMessage:"useModalContext: `context` is undefined. Seems you forgot to wrap modal components in `<Modal />`"}),Rh=r=>{const t={scrollBehavior:"outside",autoFocus:!0,trapFocus:!0,returnFocusOnClose:!0,blockScrollOnMount:!0,allowPinchZoom:!1,motionPreset:"scale",lockFocusAcrossFrames:!0,...r},{portalProps:o,children:a,autoFocus:l,trapFocus:d,initialFocusRef:m,finalFocusRef:v,returnFocusOnClose:y,blockScrollOnMount:b,allowPinchZoom:R,preserveScrollBarGap:O,motionPreset:N,lockFocusAcrossFrames:F,onCloseComplete:H}=t,G=xc("Modal",t),ne={...ZDe(t),autoFocus:l,trapFocus:d,initialFocusRef:m,finalFocusRef:v,returnFocusOnClose:y,blockScrollOnMount:b,allowPinchZoom:R,preserveScrollBarGap:O,motionPreset:N,lockFocusAcrossFrames:F};return D.jsx(r1e,{value:ne,children:D.jsx(n1e,{value:G,children:D.jsx(CS,{onExitComplete:H,children:ne.isOpen&&D.jsx(au,{...o,children:a})})})})};Rh.displayName="Modal";var rP="right-scroll-bar-position",iP="width-before-scroll-bar",i1e="with-scroll-bars-hidden",o1e="--removed-body-scroll-bar-size",Eee=fZ(),xM=function(){},AN=V.forwardRef(function(r,t){var o=V.useRef(null),a=V.useState({onScrollCapture:xM,onWheelCapture:xM,onTouchMoveCapture:xM}),l=a[0],d=a[1],m=r.forwardProps,v=r.children,y=r.className,b=r.removeScrollBar,R=r.enabled,O=r.shards,N=r.sideCar,F=r.noIsolation,H=r.inert,G=r.allowPinchZoom,z=r.as,ne=z===void 0?"div":z,J=r.gapMode,oe=$w(r,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),se=N,ae=uZ([o,t]),ye=oh(oh({},oe),l);return V.createElement(V.Fragment,null,R&&V.createElement(se,{sideCar:Eee,removeScrollBar:b,shards:O,noIsolation:F,inert:H,setCallbacks:d,allowPinchZoom:!!G,lockRef:o,gapMode:J}),m?V.cloneElement(V.Children.only(v),oh(oh({},ye),{ref:ae})):V.createElement(ne,oh({},ye,{className:y,ref:ae}),v))});AN.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};AN.classNames={fullWidth:iP,zeroRight:rP};var s1e=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function a1e(){if(!document)return null;var r=document.createElement("style");r.type="text/css";var t=s1e();return t&&r.setAttribute("nonce",t),r}function c1e(r,t){r.styleSheet?r.styleSheet.cssText=t:r.appendChild(document.createTextNode(t))}function l1e(r){var t=document.head||document.getElementsByTagName("head")[0];t.appendChild(r)}var u1e=function(){var r=0,t=null;return{add:function(o){r==0&&(t=a1e())&&(c1e(t,o),l1e(t)),r++},remove:function(){r--,!r&&t&&(t.parentNode&&t.parentNode.removeChild(t),t=null)}}},d1e=function(){var r=u1e();return function(t,o){V.useEffect(function(){return r.add(t),function(){r.remove()}},[t&&o])}},yee=function(){var r=d1e(),t=function(o){var a=o.styles,l=o.dynamic;return r(a,l),null};return t},h1e={left:0,top:0,right:0,gap:0},MM=function(r){return parseInt(r||"",10)||0},f1e=function(r){var t=window.getComputedStyle(document.body),o=t[r==="padding"?"paddingLeft":"marginLeft"],a=t[r==="padding"?"paddingTop":"marginTop"],l=t[r==="padding"?"paddingRight":"marginRight"];return[MM(o),MM(a),MM(l)]},p1e=function(r){if(r===void 0&&(r="margin"),typeof window>"u")return h1e;var t=f1e(r),o=document.documentElement.clientWidth,a=window.innerWidth;return{left:t[0],top:t[1],right:t[2],gap:Math.max(0,a-o+t[2]-t[0])}},m1e=yee(),Jy="data-scroll-locked",g1e=function(r,t,o,a){var l=r.left,d=r.top,m=r.right,v=r.gap;return o===void 0&&(o="margin"),`
  .`.concat(i1e,` {
   overflow: hidden `).concat(a,`;
   padding-right: `).concat(v,"px ").concat(a,`;
  }
  body[`).concat(Jy,`] {
    overflow: hidden `).concat(a,`;
    overscroll-behavior: contain;
    `).concat([t&&"position: relative ".concat(a,";"),o==="margin"&&`
    padding-left: `.concat(l,`px;
    padding-top: `).concat(d,`px;
    padding-right: `).concat(m,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(v,"px ").concat(a,`;
    `),o==="padding"&&"padding-right: ".concat(v,"px ").concat(a,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(rP,` {
    right: `).concat(v,"px ").concat(a,`;
  }
  
  .`).concat(iP,` {
    margin-right: `).concat(v,"px ").concat(a,`;
  }
  
  .`).concat(rP," .").concat(rP,` {
    right: 0 `).concat(a,`;
  }
  
  .`).concat(iP," .").concat(iP,` {
    margin-right: 0 `).concat(a,`;
  }
  
  body[`).concat(Jy,`] {
    `).concat(o1e,": ").concat(v,`px;
  }
`)},E7=function(){var r=parseInt(document.body.getAttribute(Jy)||"0",10);return isFinite(r)?r:0},_1e=function(){V.useEffect(function(){return document.body.setAttribute(Jy,(E7()+1).toString()),function(){var r=E7()-1;r<=0?document.body.removeAttribute(Jy):document.body.setAttribute(Jy,r.toString())}},[])},v1e=function(r){var t=r.noRelative,o=r.noImportant,a=r.gapMode,l=a===void 0?"margin":a;_1e();var d=V.useMemo(function(){return p1e(l)},[l]);return V.createElement(m1e,{styles:g1e(d,!t,l,o?"":"!important")})},nU=!1;if(typeof window<"u")try{var bO=Object.defineProperty({},"passive",{get:function(){return nU=!0,!0}});window.addEventListener("test",bO,bO),window.removeEventListener("test",bO,bO)}catch{nU=!1}var vy=nU?{passive:!1}:!1,E1e=function(r){return r.tagName==="TEXTAREA"},See=function(r,t){var o=window.getComputedStyle(r);return o[t]!=="hidden"&&!(o.overflowY===o.overflowX&&!E1e(r)&&o[t]==="visible")},y1e=function(r){return See(r,"overflowY")},S1e=function(r){return See(r,"overflowX")},y7=function(r,t){var o=t.ownerDocument,a=t;do{typeof ShadowRoot<"u"&&a instanceof ShadowRoot&&(a=a.host);var l=Tee(r,a);if(l){var d=bee(r,a),m=d[1],v=d[2];if(m>v)return!0}a=a.parentNode}while(a&&a!==o.body);return!1},T1e=function(r){var t=r.scrollTop,o=r.scrollHeight,a=r.clientHeight;return[t,o,a]},b1e=function(r){var t=r.scrollLeft,o=r.scrollWidth,a=r.clientWidth;return[t,o,a]},Tee=function(r,t){return r==="v"?y1e(t):S1e(t)},bee=function(r,t){return r==="v"?T1e(t):b1e(t)},w1e=function(r,t){return r==="h"&&t==="rtl"?-1:1},R1e=function(r,t,o,a,l){var d=w1e(r,window.getComputedStyle(t).direction),m=d*a,v=o.target,y=t.contains(v),b=!1,R=m>0,O=0,N=0;do{var F=bee(r,v),H=F[0],G=F[1],z=F[2],ne=G-z-d*H;(H||ne)&&Tee(r,v)&&(O+=ne,N+=H),v instanceof ShadowRoot?v=v.host:v=v.parentNode}while(!y&&v!==document.body||y&&(t.contains(v)||t===v));return(R&&Math.abs(O)<1||!R&&Math.abs(N)<1)&&(b=!0),b},wO=function(r){return"changedTouches"in r?[r.changedTouches[0].clientX,r.changedTouches[0].clientY]:[0,0]},S7=function(r){return[r.deltaX,r.deltaY]},T7=function(r){return r&&"current"in r?r.current:r},C1e=function(r,t){return r[0]===t[0]&&r[1]===t[1]},I1e=function(r){return`
  .block-interactivity-`.concat(r,` {pointer-events: none;}
  .allow-interactivity-`).concat(r,` {pointer-events: all;}
`)},A1e=0,Ey=[];function O1e(r){var t=V.useRef([]),o=V.useRef([0,0]),a=V.useRef(),l=V.useState(A1e++)[0],d=V.useState(yee)[0],m=V.useRef(r);V.useEffect(function(){m.current=r},[r]),V.useEffect(function(){if(r.inert){document.body.classList.add("block-interactivity-".concat(l));var G=pPe([r.lockRef.current],(r.shards||[]).map(T7),!0).filter(Boolean);return G.forEach(function(z){return z.classList.add("allow-interactivity-".concat(l))}),function(){document.body.classList.remove("block-interactivity-".concat(l)),G.forEach(function(z){return z.classList.remove("allow-interactivity-".concat(l))})}}},[r.inert,r.lockRef.current,r.shards]);var v=V.useCallback(function(G,z){if("touches"in G&&G.touches.length===2)return!m.current.allowPinchZoom;var ne=wO(G),J=o.current,oe="deltaX"in G?G.deltaX:J[0]-ne[0],se="deltaY"in G?G.deltaY:J[1]-ne[1],ae,ye=G.target,Q=Math.abs(oe)>Math.abs(se)?"h":"v";if("touches"in G&&Q==="h"&&ye.type==="range")return!1;var te=y7(Q,ye);if(!te)return!0;if(te?ae=Q:(ae=Q==="v"?"h":"v",te=y7(Q,ye)),!te)return!1;if(!a.current&&"changedTouches"in G&&(oe||se)&&(a.current=ae),!ae)return!0;var re=a.current||ae;return R1e(re,z,G,re==="h"?oe:se)},[]),y=V.useCallback(function(G){var z=G;if(!(!Ey.length||Ey[Ey.length-1]!==d)){var ne="deltaY"in z?S7(z):wO(z),J=t.current.filter(function(ae){return ae.name===z.type&&(ae.target===z.target||z.target===ae.shadowParent)&&C1e(ae.delta,ne)})[0];if(J&&J.should){z.cancelable&&z.preventDefault();return}if(!J){var oe=(m.current.shards||[]).map(T7).filter(Boolean).filter(function(ae){return ae.contains(z.target)}),se=oe.length>0?v(z,oe[0]):!m.current.noIsolation;se&&z.cancelable&&z.preventDefault()}}},[]),b=V.useCallback(function(G,z,ne,J){var oe={name:G,delta:z,target:ne,should:J,shadowParent:P1e(ne)};t.current.push(oe),setTimeout(function(){t.current=t.current.filter(function(se){return se!==oe})},1)},[]),R=V.useCallback(function(G){o.current=wO(G),a.current=void 0},[]),O=V.useCallback(function(G){b(G.type,S7(G),G.target,v(G,r.lockRef.current))},[]),N=V.useCallback(function(G){b(G.type,wO(G),G.target,v(G,r.lockRef.current))},[]);V.useEffect(function(){return Ey.push(d),r.setCallbacks({onScrollCapture:O,onWheelCapture:O,onTouchMoveCapture:N}),document.addEventListener("wheel",y,vy),document.addEventListener("touchmove",y,vy),document.addEventListener("touchstart",R,vy),function(){Ey=Ey.filter(function(G){return G!==d}),document.removeEventListener("wheel",y,vy),document.removeEventListener("touchmove",y,vy),document.removeEventListener("touchstart",R,vy)}},[]);var F=r.removeScrollBar,H=r.inert;return V.createElement(V.Fragment,null,H?V.createElement(d,{styles:I1e(l)}):null,F?V.createElement(v1e,{gapMode:r.gapMode}):null)}function P1e(r){for(var t=null;r!==null;)r instanceof ShadowRoot&&(t=r.host,r=r.host),r=r.parentNode;return t}const N1e=mPe(Eee,O1e);var wee=V.forwardRef(function(r,t){return V.createElement(AN,oh({},r,{ref:t,sideCar:N1e}))});wee.classNames=AN.classNames;function k1e(r){const{autoFocus:t,trapFocus:o,dialogRef:a,initialFocusRef:l,blockScrollOnMount:d,allowPinchZoom:m,finalFocusRef:v,returnFocusOnClose:y,preserveScrollBarGap:b,lockFocusAcrossFrames:R,isOpen:O}=X_(),[N,F]=PQ();V.useEffect(()=>{!N&&F&&setTimeout(F)},[N,F]);const H=_ee(a,O);return D.jsx(GZ,{autoFocus:t,isDisabled:!o,initialFocusRef:l,finalFocusRef:v,restoreFocus:y,contentRef:a,lockFocusAcrossFrames:R,children:D.jsx(wee,{removeScrollBar:!b,allowPinchZoom:m,enabled:H===1&&d,forwardProps:!0,children:r.children})})}var Ch=zt((r,t)=>{const{className:o,children:a,containerProps:l,motionProps:d,...m}=r,{getDialogProps:v,getDialogContainerProps:y}=X_(),b=v(m,t),R=y(l),O=In("chakra-modal__content",o),N=OS(),F={display:"flex",flexDirection:"column",position:"relative",width:"100%",outline:0,...N.dialog},H={display:"flex",width:"100vw",height:"$100vh",position:"fixed",left:0,top:0,...N.dialogContainer},{motionPreset:G}=X_();return D.jsx(k1e,{children:D.jsx(Pt.div,{...R,className:"chakra-modal__content-container",tabIndex:-1,__css:H,children:D.jsx(gee,{preset:G,motionProps:d,className:O,...b,__css:F,children:a})})})});Ch.displayName="ModalContent";var ON=zt((r,t)=>{const{className:o,...a}=r,l=In("chakra-modal__footer",o),m={display:"flex",alignItems:"center",justifyContent:"flex-end",...OS().footer};return D.jsx(Pt.footer,{ref:t,...a,__css:m,className:l})});ON.displayName="ModalFooter";var Qf=zt((r,t)=>{const{className:o,...a}=r,{headerId:l,setHeaderMounted:d}=X_();V.useEffect(()=>(d(!0),()=>d(!1)),[d]);const m=In("chakra-modal__header",o),y={flex:0,...OS().header};return D.jsx(Pt.header,{ref:t,className:m,id:l,...a,__css:y})});Qf.displayName="ModalHeader";var D1e=Pt(bh.div),Ih=zt((r,t)=>{const{className:o,transition:a,motionProps:l,...d}=r,m=In("chakra-modal__overlay",o),y={pos:"fixed",left:"0",top:"0",w:"100vw",h:"100vh",...OS().overlay},{motionPreset:b}=X_(),O=l||(b==="none"?{}:QQ);return D.jsx(D1e,{...O,__css:y,ref:t,className:m,...d})});Ih.displayName="ModalOverlay";var Ah=zt((r,t)=>{const{className:o,...a}=r,{bodyId:l,setBodyMounted:d}=X_();V.useEffect(()=>(d(!0),()=>d(!1)),[d]);const m=In("chakra-modal__body",o),v=OS();return D.jsx(Pt.div,{ref:t,className:m,id:l,...a,__css:v.body})});Ah.displayName="ModalBody";var Oh=zt((r,t)=>{const{onClick:o,className:a,...l}=r,{onClose:d}=X_(),m=In("chakra-modal__close-btn",a),v=OS();return D.jsx(mw,{ref:t,__css:v.closeButton,className:m,onClick:rr(o,y=>{y.stopPropagation(),d()}),...l})});Oh.displayName="ModalCloseButton";var[L1e,PN]=Hi({name:"PopoverContext",errorMessage:"usePopoverContext: `context` is undefined. Seems you forgot to wrap all popover components within `<Popover />`"}),[x1e,Ree]=Hi({name:"PopoverStylesContext",errorMessage:`usePopoverStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Popover />" `});function Cee(r){const t=V.Children.only(r.children),{getTriggerProps:o}=PN();return V.cloneElement(t,o(t.props,t.ref))}Cee.displayName="PopoverTrigger";var yy={click:"click",hover:"hover"};function M1e(r={}){const{closeOnBlur:t=!0,closeOnEsc:o=!0,initialFocusRef:a,id:l,returnFocusOnClose:d=!0,autoFocus:m=!0,arrowSize:v,arrowShadowColor:y,trigger:b=yy.click,openDelay:R=200,closeDelay:O=200,isLazy:N,lazyBehavior:F="unmount",computePositionOnMount:H,...G}=r,{isOpen:z,onClose:ne,onOpen:J,onToggle:oe}=iF(r),se=V.useRef(null),ae=V.useRef(null),ye=V.useRef(null),Q=V.useRef(!1),te=V.useRef(!1);z&&(te.current=!0);const[re,le]=V.useState(!1),[ve,fe]=V.useState(!1),de=V.useId(),lt=l??de,[ft,Xe,Le,Ke]=["popover-trigger","popover-content","popover-header","popover-body"].map(bt=>`${bt}-${lt}`),{referenceRef:nt,getArrowProps:Ee,getPopperProps:Ye,getArrowInnerProps:yt,forceUpdate:at}=rF({...G,enabled:z||!!H}),Fe=hee({isOpen:z,ref:ye});rPe({enabled:z,ref:ae}),tee(ye,{focusRef:ae,visible:z,shouldFocus:d&&b===yy.click}),tke(ye,{focusRef:a,visible:z,shouldFocus:m&&b===yy.click});const et=oF({wasSelected:te.current,enabled:N,mode:F,isSelected:Fe.present}),_t=V.useCallback((bt={},bn=null)=>{const wn={...bt,style:{...bt.style,transformOrigin:Fo.transformOrigin.varRef,[Fo.arrowSize.var]:v?`${v}px`:void 0,[Fo.arrowShadowColor.var]:y},ref:zi(ye,bn),children:et?bt.children:null,id:Xe,tabIndex:-1,role:"dialog",onKeyDown:rr(bt.onKeyDown,we=>{o&&we.key==="Escape"&&ne()}),onBlur:rr(bt.onBlur,we=>{const De=b7(we),We=UM(ye.current,De),mt=UM(ae.current,De);z&&t&&(!We&&!mt)&&ne()}),"aria-labelledby":re?Le:void 0,"aria-describedby":ve?Ke:void 0};return b===yy.hover&&(wn.role="tooltip",wn.onMouseEnter=rr(bt.onMouseEnter,()=>{Q.current=!0}),wn.onMouseLeave=rr(bt.onMouseLeave,we=>{we.nativeEvent.relatedTarget!==null&&(Q.current=!1,setTimeout(()=>ne(),O))})),wn},[et,Xe,re,Le,ve,Ke,b,o,ne,z,t,O,y,v]),Dt=V.useCallback((bt={},bn=null)=>Ye({...bt,style:{visibility:z?"visible":"hidden",...bt.style}},bn),[z,Ye]),Ht=V.useCallback((bt,bn=null)=>({...bt,ref:zi(bn,se,nt)}),[se,nt]),Wt=V.useRef(),Fn=V.useRef(),xn=V.useCallback(bt=>{se.current==null&&nt(bt)},[nt]),hn=V.useCallback((bt={},bn=null)=>{const wn={...bt,ref:zi(ae,bn,xn),id:ft,"aria-haspopup":"dialog","aria-expanded":z,"aria-controls":Xe};return b===yy.click&&(wn.onClick=rr(bt.onClick,oe)),b===yy.hover&&(wn.onFocus=rr(bt.onFocus,()=>{Wt.current===void 0&&J()}),wn.onBlur=rr(bt.onBlur,we=>{const De=b7(we),We=!UM(ye.current,De);z&&t&&We&&ne()}),wn.onKeyDown=rr(bt.onKeyDown,we=>{we.key==="Escape"&&ne()}),wn.onMouseEnter=rr(bt.onMouseEnter,()=>{Q.current=!0,Wt.current=window.setTimeout(()=>J(),R)}),wn.onMouseLeave=rr(bt.onMouseLeave,()=>{Q.current=!1,Wt.current&&(clearTimeout(Wt.current),Wt.current=void 0),Fn.current=window.setTimeout(()=>{Q.current===!1&&ne()},O)})),wn},[ft,z,Xe,b,xn,oe,J,t,ne,R,O]);V.useEffect(()=>()=>{Wt.current&&clearTimeout(Wt.current),Fn.current&&clearTimeout(Fn.current)},[]);const gr=V.useCallback((bt={},bn=null)=>({...bt,id:Le,ref:zi(bn,wn=>{le(!!wn)})}),[Le]),Ar=V.useCallback((bt={},bn=null)=>({...bt,id:Ke,ref:zi(bn,wn=>{fe(!!wn)})}),[Ke]);return{forceUpdate:at,isOpen:z,onAnimationComplete:Fe.onComplete,onClose:ne,getAnchorProps:Ht,getArrowProps:Ee,getArrowInnerProps:yt,getPopoverPositionerProps:Dt,getPopoverProps:_t,getTriggerProps:hn,getHeaderProps:gr,getBodyProps:Ar}}function UM(r,t){return r===t||(r==null?void 0:r.contains(t))}function b7(r){var t;const o=r.currentTarget.ownerDocument.activeElement;return(t=r.relatedTarget)!=null?t:o}function Iee(r){const t=xc("Popover",r),{children:o,...a}=Ki(r),l=wS(),d=M1e({...a,direction:l.direction});return D.jsx(L1e,{value:d,children:D.jsx(x1e,{value:t,children:tu(o,{isOpen:d.isOpen,onClose:d.onClose,forceUpdate:d.forceUpdate})})})}Iee.displayName="Popover";var Aee=zt(function(t,o){const{getBodyProps:a}=PN(),l=Ree();return D.jsx(Pt.div,{...a(t,o),className:In("chakra-popover__body",t.className),__css:l.body})});Aee.displayName="PopoverBody";function U1e(r){if(r)return{enter:{...r.enter,visibility:"visible"},exit:{...r.exit,transitionEnd:{visibility:"hidden"}}}}var V1e={exit:{opacity:0,scale:.95,transition:{duration:.1,ease:[.4,0,1,1]}},enter:{scale:1,opacity:1,transition:{duration:.15,ease:[0,0,.2,1]}}},F1e=Pt(bh.section),Oee=zt(function(t,o){const{variants:a=V1e,...l}=t,{isOpen:d}=PN();return D.jsx(F1e,{ref:o,variants:U1e(a),initial:!1,animate:d?"enter":"exit",...l})});Oee.displayName="PopoverTransition";var Pee=zt(function(t,o){const{rootProps:a,motionProps:l,...d}=t,{getPopoverProps:m,getPopoverPositionerProps:v,onAnimationComplete:y}=PN(),b=Ree(),R={position:"relative",display:"flex",flexDirection:"column",...b.content};return D.jsx(Pt.div,{...v(a),__css:b.popper,className:"chakra-popover__popper",children:D.jsx(Oee,{...l,...m(d,o),onAnimationComplete:GX(y,d.onAnimationComplete),className:In("chakra-popover__content",t.className),__css:R})})});Pee.displayName="PopoverContent";function j1e(r,t,o){return(r-t)*100/(o-t)}Mw({"0%":{strokeDasharray:"1, 400",strokeDashoffset:"0"},"50%":{strokeDasharray:"400, 400",strokeDashoffset:"-100"},"100%":{strokeDasharray:"400, 400",strokeDashoffset:"-260"}});Mw({"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}});var B1e=Mw({"0%":{left:"-40%"},"100%":{left:"100%"}}),W1e=Mw({from:{backgroundPosition:"1rem 0"},to:{backgroundPosition:"0 0"}});function G1e(r){const{value:t=0,min:o,max:a,valueText:l,getValueText:d,isIndeterminate:m,role:v="progressbar"}=r,y=j1e(t,o,a);return{bind:{"data-indeterminate":m?"":void 0,"aria-valuemax":a,"aria-valuemin":o,"aria-valuenow":m?void 0:t,"aria-valuetext":(()=>{if(t!=null)return typeof d=="function"?d(t,y):l})(),role:v},percent:y,value:t}}var[z1e,H1e]=Hi({name:"ProgressStylesContext",errorMessage:`useProgressStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Progress />" `}),K1e=zt((r,t)=>{const{min:o,max:a,value:l,isIndeterminate:d,role:m,...v}=r,y=G1e({value:l,min:o,max:a,isIndeterminate:d,role:m}),R={height:"100%",...H1e().filledTrack};return D.jsx(Pt.div,{ref:t,style:{width:`${y.percent}%`,...v.style},...y.bind,...v,__css:R})}),lF=zt((r,t)=>{var o;const{value:a,min:l=0,max:d=100,hasStripe:m,isAnimated:v,children:y,borderRadius:b,isIndeterminate:R,"aria-label":O,"aria-labelledby":N,"aria-valuetext":F,title:H,role:G,...z}=Ki(r),ne=xc("Progress",r),J=b??((o=ne.track)==null?void 0:o.borderRadius),oe={animation:`${W1e} 1s linear infinite`},ye={...!R&&m&&v&&oe,...R&&{position:"absolute",willChange:"left",minWidth:"50%",animation:`${B1e} 1s ease infinite normal none running`}},Q={overflow:"hidden",position:"relative",...ne.track};return D.jsx(Pt.div,{ref:t,borderRadius:J,__css:Q,...z,children:D.jsxs(z1e,{value:ne,children:[D.jsx(K1e,{"aria-label":O,"aria-labelledby":N,"aria-valuetext":F,min:l,max:d,value:a,isIndeterminate:R,css:ye,borderRadius:J,title:H,role:G}),y]})})});lF.displayName="Progress";var Nee=zt(function(t,o){const{children:a,placeholder:l,className:d,...m}=t;return D.jsxs(Pt.select,{...m,ref:o,className:In("chakra-select",d),children:[l&&D.jsx("option",{value:"",children:l}),a]})});Nee.displayName="SelectField";function $1e(r,t){const o={},a={};for(const[l,d]of Object.entries(r))t.includes(l)?o[l]=d:a[l]=d;return[o,a]}var kee=zt((r,t)=>{var o;const a=xc("Select",r),{rootProps:l,placeholder:d,icon:m,color:v,height:y,h:b,minH:R,minHeight:O,iconColor:N,iconSize:F,...H}=Ki(r),[G,z]=$1e(H,Q_e),ne=sZ(z),J={width:"100%",height:"fit-content",position:"relative",color:v},oe={paddingEnd:"2rem",...a.field,_focus:{zIndex:"unset",...(o=a.field)==null?void 0:o._focus}};return D.jsxs(Pt.div,{className:"chakra-select__wrapper",__css:J,...G,...l,children:[D.jsx(Nee,{ref:t,height:b??y,minH:R??O,placeholder:d,...ne,__css:oe,children:r.children}),D.jsx(Dee,{"data-disabled":cr(ne.disabled),...(N||v)&&{color:N||v},__css:a.icon,...F&&{fontSize:F},children:m})]})});kee.displayName="Select";var q1e=r=>D.jsx("svg",{viewBox:"0 0 24 24",...r,children:D.jsx("path",{fill:"currentColor",d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"})}),Y1e=Pt("div",{baseStyle:{position:"absolute",display:"inline-flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",top:"50%",transform:"translateY(-50%)"}}),Dee=r=>{const{children:t=D.jsx(q1e,{}),...o}=r,a=V.cloneElement(t,{role:"presentation",className:"chakra-select__icon",focusable:!1,"aria-hidden":!0,style:{width:"1em",height:"1em",color:"currentColor"}});return D.jsx(Y1e,{...o,className:"chakra-select__icon-wrapper",children:V.isValidElement(t)?a:null})};Dee.displayName="SelectIcon";var Sy=r=>r?"":void 0,VM=r=>r?!0:void 0,Qw=(...r)=>r.filter(Boolean).join(" ");function FM(...r){return function(o){r.some(a=>(a==null||a(o),o==null?void 0:o.defaultPrevented))}}function RO(r){const{orientation:t,vertical:o,horizontal:a}=r;return t==="vertical"?o:a}var oP={width:0,height:0},CO=r=>r||oP;function X1e(r){const{orientation:t,thumbPercents:o,thumbRects:a,isReversed:l}=r,d=G=>{var z;const ne=(z=a[G])!=null?z:oP;return{position:"absolute",userSelect:"none",WebkitUserSelect:"none",MozUserSelect:"none",msUserSelect:"none",touchAction:"none",...RO({orientation:t,vertical:{bottom:`calc(${o[G]}% - ${ne.height/2}px)`},horizontal:{left:`calc(${o[G]}% - ${ne.width/2}px)`}})}},m=t==="vertical"?a.reduce((G,z)=>CO(G).height>CO(z).height?G:z,oP):a.reduce((G,z)=>CO(G).width>CO(z).width?G:z,oP),v={position:"relative",touchAction:"none",WebkitTapHighlightColor:"rgba(0,0,0,0)",userSelect:"none",outline:0,...RO({orientation:t,vertical:m?{paddingLeft:m.width/2,paddingRight:m.width/2}:{},horizontal:m?{paddingTop:m.height/2,paddingBottom:m.height/2}:{}})},y={position:"absolute",...RO({orientation:t,vertical:{left:"50%",transform:"translateX(-50%)",height:"100%"},horizontal:{top:"50%",transform:"translateY(-50%)",width:"100%"}})},b=o.length===1,R=[0,l?100-o[0]:o[0]],O=b?R:o;let N=O[0];!b&&l&&(N=100-N);const F=Math.abs(O[O.length-1]-O[0]),H={...y,...RO({orientation:t,vertical:l?{height:`${F}%`,top:`${N}%`}:{height:`${F}%`,bottom:`${N}%`},horizontal:l?{width:`${F}%`,right:`${N}%`}:{width:`${F}%`,left:`${N}%`}})};return{trackStyle:y,innerTrackStyle:H,rootStyle:v,getThumbStyle:d}}function J1e(r){const{isReversed:t,direction:o,orientation:a}=r;return o==="ltr"||a==="vertical"?t:!t}function Q1e(r,t,o,a){return r.addEventListener(t,o,a),()=>{r.removeEventListener(t,o,a)}}function Z1e(r){const t=tLe(r);return typeof t.PointerEvent<"u"&&r instanceof t.PointerEvent?r.pointerType==="mouse":r instanceof t.MouseEvent}function Lee(r){return!!r.touches}function eLe(r){return Lee(r)&&r.touches.length>1}function tLe(r){var t;return(t=r.view)!=null?t:window}function nLe(r,t="page"){const o=r.touches[0]||r.changedTouches[0];return{x:o[`${t}X`],y:o[`${t}Y`]}}function rLe(r,t="page"){return{x:r[`${t}X`],y:r[`${t}Y`]}}function xee(r,t="page"){return Lee(r)?nLe(r,t):rLe(r,t)}function iLe(r){return t=>{const o=Z1e(t);(!o||o&&t.button===0)&&r(t)}}function oLe(r,t=!1){function o(l){r(l,{point:xee(l)})}return t?iLe(o):o}function sP(r,t,o,a){return Q1e(r,t,oLe(o,t==="pointerdown"),a)}var sLe=Object.defineProperty,aLe=(r,t,o)=>t in r?sLe(r,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):r[t]=o,Qu=(r,t,o)=>(aLe(r,typeof t!="symbol"?t+"":t,o),o),cLe=class{constructor(r,t,o){Qu(this,"history",[]),Qu(this,"startEvent",null),Qu(this,"lastEvent",null),Qu(this,"lastEventInfo",null),Qu(this,"handlers",{}),Qu(this,"removeListeners",()=>{}),Qu(this,"threshold",3),Qu(this,"win"),Qu(this,"updatePoint",()=>{if(!(this.lastEvent&&this.lastEventInfo))return;const v=jM(this.lastEventInfo,this.history),y=this.startEvent!==null,b=hLe(v.offset,{x:0,y:0})>=this.threshold;if(!y&&!b)return;const{timestamp:R}=S$();this.history.push({...v.point,timestamp:R});const{onStart:O,onMove:N}=this.handlers;y||(O==null||O(this.lastEvent,v),this.startEvent=this.lastEvent),N==null||N(this.lastEvent,v)}),Qu(this,"onPointerMove",(v,y)=>{this.lastEvent=v,this.lastEventInfo=y,zbe.update(this.updatePoint,!0)}),Qu(this,"onPointerUp",(v,y)=>{const b=jM(y,this.history),{onEnd:R,onSessionEnd:O}=this.handlers;O==null||O(v,b),this.end(),!(!R||!this.startEvent)&&(R==null||R(v,b))});var a;if(this.win=(a=r.view)!=null?a:window,eLe(r))return;this.handlers=t,o&&(this.threshold=o),r.stopPropagation(),r.preventDefault();const l={point:xee(r)},{timestamp:d}=S$();this.history=[{...l.point,timestamp:d}];const{onSessionStart:m}=t;m==null||m(r,jM(l,this.history)),this.removeListeners=dLe(sP(this.win,"pointermove",this.onPointerMove),sP(this.win,"pointerup",this.onPointerUp),sP(this.win,"pointercancel",this.onPointerUp))}updateHandlers(r){this.handlers=r}end(){var r;(r=this.removeListeners)==null||r.call(this),Hbe.update(this.updatePoint)}};function w7(r,t){return{x:r.x-t.x,y:r.y-t.y}}function jM(r,t){return{point:r.point,delta:w7(r.point,t[t.length-1]),offset:w7(r.point,t[0]),velocity:uLe(t,.1)}}var lLe=r=>r*1e3;function uLe(r,t){if(r.length<2)return{x:0,y:0};let o=r.length-1,a=null;const l=r[r.length-1];for(;o>=0&&(a=r[o],!(l.timestamp-a.timestamp>lLe(t)));)o--;if(!a)return{x:0,y:0};const d=(l.timestamp-a.timestamp)/1e3;if(d===0)return{x:0,y:0};const m={x:(l.x-a.x)/d,y:(l.y-a.y)/d};return m.x===1/0&&(m.x=0),m.y===1/0&&(m.y=0),m}function dLe(...r){return t=>r.reduce((o,a)=>a(o),t)}function BM(r,t){return Math.abs(r-t)}function R7(r){return"x"in r&&"y"in r}function hLe(r,t){if(typeof r=="number"&&typeof t=="number")return BM(r,t);if(R7(r)&&R7(t)){const o=BM(r.x,t.x),a=BM(r.y,t.y);return Math.sqrt(o**2+a**2)}return 0}function Mee(r){const t=V.useRef(null);return t.current=r,t}function fLe(r,t){const{onPan:o,onPanStart:a,onPanEnd:l,onPanSessionStart:d,onPanSessionEnd:m,threshold:v}=t,y=!!(o||a||l||d||m),b=V.useRef(null),R=Mee({onSessionStart:d,onSessionEnd:m,onStart:a,onMove:o,onEnd(O,N){b.current=null,l==null||l(O,N)}});V.useEffect(()=>{var O;(O=b.current)==null||O.updateHandlers(R.current)}),V.useEffect(()=>{const O=r.current;if(!O||!y)return;function N(F){b.current=new cLe(F,R.current,v)}return sP(O,"pointerdown",N)},[r,y,R,v]),V.useEffect(()=>()=>{var O;(O=b.current)==null||O.end(),b.current=null},[])}function pLe(r,t){if(!r){t(void 0);return}t({width:r.offsetWidth,height:r.offsetHeight});const o=r.ownerDocument.defaultView??window,a=new o.ResizeObserver(l=>{if(!Array.isArray(l)||!l.length)return;const[d]=l;let m,v;if("borderBoxSize"in d){const y=d.borderBoxSize,b=Array.isArray(y)?y[0]:y;m=b.inlineSize,v=b.blockSize}else m=r.offsetWidth,v=r.offsetHeight;t({width:m,height:v})});return a.observe(r,{box:"border-box"}),()=>a.unobserve(r)}var mLe=globalThis!=null&&globalThis.document?V.useLayoutEffect:V.useEffect;function gLe(r,t){var o,a;if(!r||!r.parentElement)return;const l=(a=(o=r.ownerDocument)==null?void 0:o.defaultView)!=null?a:window,d=new l.MutationObserver(()=>{t()});return d.observe(r.parentElement,{childList:!0}),()=>{d.disconnect()}}function _Le({getNodes:r,observeMutation:t=!0}){const[o,a]=V.useState([]),[l,d]=V.useState(0);return mLe(()=>{const m=r(),v=m.map((y,b)=>pLe(y,R=>{a(O=>[...O.slice(0,b),R,...O.slice(b+1)])}));if(t){const y=m[0];v.push(gLe(y,()=>{d(b=>b+1)}))}return()=>{v.forEach(y=>{y==null||y()})}},[l]),o}function vLe(r){return typeof r=="object"&&r!==null&&"current"in r}function ELe(r){const[t]=_Le({observeMutation:!1,getNodes(){return[vLe(r)?r.current:r]}});return t}function yLe(r){var t;const{min:o=0,max:a=100,onChange:l,value:d,defaultValue:m,isReversed:v,direction:y="ltr",orientation:b="horizontal",id:R,isDisabled:O,isReadOnly:N,onChangeStart:F,onChangeEnd:H,step:G=1,getAriaValueText:z,"aria-valuetext":ne,"aria-label":J,"aria-labelledby":oe,name:se,focusThumbOnChange:ae=!0,...ye}=r,Q=Pc(F),te=Pc(H),re=Pc(z),le=J1e({isReversed:v,direction:y,orientation:b}),[ve,fe]=JQ({value:d,defaultValue:m??TLe(o,a),onChange:l}),[de,lt]=V.useState(!1),[ft,Xe]=V.useState(!1),Le=!(O||N),Ke=(a-o)/10,nt=G||(a-o)/100,Ee=bM(ve,o,a),Ye=a-Ee+o,at=Kq(le?Ye:Ee,o,a),Fe=b==="vertical",et=Mee({min:o,max:a,step:G,isDisabled:O,value:Ee,isInteractive:Le,isReversed:le,isVertical:Fe,eventSource:null,focusThumbOnChange:ae,orientation:b}),_t=V.useRef(null),Dt=V.useRef(null),Ht=V.useRef(null),Wt=V.useId(),Fn=R??Wt,[xn,hn]=[`slider-thumb-${Fn}`,`slider-track-${Fn}`],gr=V.useCallback(Lt=>{var fn,rs;if(!_t.current)return;const or=et.current;or.eventSource="pointer";const $i=_t.current.getBoundingClientRect(),{clientX:Mc,clientY:$a}=(rs=(fn=Lt.touches)==null?void 0:fn[0])!=null?rs:Lt,_s=Fe?$i.bottom-$a:Mc-$i.left,qa=Fe?$i.height:$i.width;let Ui=_s/qa;le&&(Ui=1-Ui);let Po=XOe(Ui,or.min,or.max);return or.step&&(Po=parseFloat($q(Po,or.min,or.step))),Po=bM(Po,or.min,or.max),Po},[Fe,le,et]),Ar=V.useCallback(Lt=>{const fn=et.current;fn.isInteractive&&(Lt=parseFloat($q(Lt,fn.min,nt)),Lt=bM(Lt,fn.min,fn.max),fe(Lt))},[nt,fe,et]),bt=V.useMemo(()=>({stepUp(Lt=nt){const fn=le?Ee-Lt:Ee+Lt;Ar(fn)},stepDown(Lt=nt){const fn=le?Ee+Lt:Ee-Lt;Ar(fn)},reset(){Ar(m||0)},stepTo(Lt){Ar(Lt)}}),[Ar,le,Ee,nt,m]),bn=V.useCallback(Lt=>{const fn=et.current,or={ArrowRight:()=>bt.stepUp(),ArrowUp:()=>bt.stepUp(),ArrowLeft:()=>bt.stepDown(),ArrowDown:()=>bt.stepDown(),PageUp:()=>bt.stepUp(Ke),PageDown:()=>bt.stepDown(Ke),Home:()=>Ar(fn.min),End:()=>Ar(fn.max)}[Lt.key];or&&(Lt.preventDefault(),Lt.stopPropagation(),or(Lt),fn.eventSource="keyboard")},[bt,Ar,Ke,et]),wn=(t=re==null?void 0:re(Ee))!=null?t:ne,we=ELe(Dt),{getThumbStyle:De,rootStyle:We,trackStyle:mt,innerTrackStyle:gt}=V.useMemo(()=>{const Lt=et.current,fn=we??{width:0,height:0};return X1e({isReversed:le,orientation:Lt.orientation,thumbRects:[fn],thumbPercents:[at]})},[le,we,at,et]),ht=V.useCallback(()=>{et.current.focusThumbOnChange&&setTimeout(()=>{var fn;return(fn=Dt.current)==null?void 0:fn.focus()})},[et]);Am(()=>{const Lt=et.current;ht(),Lt.eventSource==="keyboard"&&(te==null||te(Lt.value))},[Ee,te]);function Mt(Lt){const fn=gr(Lt);fn!=null&&fn!==et.current.value&&fe(fn)}fLe(Ht,{onPanSessionStart(Lt){const fn=et.current;fn.isInteractive&&(lt(!0),ht(),Mt(Lt),Q==null||Q(fn.value))},onPanSessionEnd(){const Lt=et.current;Lt.isInteractive&&(lt(!1),te==null||te(Lt.value))},onPan(Lt){et.current.isInteractive&&Mt(Lt)}});const jn=V.useCallback((Lt={},fn=null)=>({...Lt,...ye,ref:zi(fn,Ht),tabIndex:-1,"aria-disabled":VM(O),"data-focused":Sy(ft),style:{...Lt.style,...We}}),[ye,O,ft,We]),On=V.useCallback((Lt={},fn=null)=>({...Lt,ref:zi(fn,_t),id:hn,"data-disabled":Sy(O),style:{...Lt.style,...mt}}),[O,hn,mt]),nn=V.useCallback((Lt={},fn=null)=>({...Lt,ref:fn,style:{...Lt.style,...gt}}),[gt]),_r=V.useCallback((Lt={},fn=null)=>({...Lt,ref:zi(fn,Dt),role:"slider",tabIndex:Le?0:void 0,id:xn,"data-active":Sy(de),"aria-valuetext":wn,"aria-valuemin":o,"aria-valuemax":a,"aria-valuenow":Ee,"aria-orientation":b,"aria-disabled":VM(O),"aria-readonly":VM(N),"aria-label":J,"aria-labelledby":J?void 0:oe,style:{...Lt.style,...De(0)},onKeyDown:FM(Lt.onKeyDown,bn),onFocus:FM(Lt.onFocus,()=>Xe(!0)),onBlur:FM(Lt.onBlur,()=>Xe(!1))}),[Le,xn,de,wn,o,a,Ee,b,O,N,J,oe,De,bn]),Ra=V.useCallback((Lt,fn=null)=>{const rs=!(Lt.value<o||Lt.value>a),or=Ee>=Lt.value,$i=Kq(Lt.value,o,a),Mc={position:"absolute",pointerEvents:"none",...SLe({orientation:b,vertical:{bottom:le?`${100-$i}%`:`${$i}%`},horizontal:{left:le?`${100-$i}%`:`${$i}%`}})};return{...Lt,ref:fn,role:"presentation","aria-hidden":!0,"data-disabled":Sy(O),"data-invalid":Sy(!rs),"data-highlighted":Sy(or),style:{...Lt.style,...Mc}}},[O,le,a,o,b,Ee]),_o=V.useCallback((Lt={},fn=null)=>({...Lt,ref:fn,type:"hidden",value:Ee,name:se}),[se,Ee]);return{state:{value:Ee,isFocused:ft,isDragging:de},actions:bt,getRootProps:jn,getTrackProps:On,getInnerTrackProps:nn,getThumbProps:_r,getMarkerProps:Ra,getInputProps:_o}}function SLe(r){const{orientation:t,vertical:o,horizontal:a}=r;return t==="vertical"?o:a}function TLe(r,t){return t<r?r:r+(t-r)/2}var[bLe,NN]=Hi({name:"SliderContext",hookName:"useSliderContext",providerName:"<Slider />"}),[wLe,kN]=Hi({name:"SliderStylesContext",hookName:"useSliderStyles",providerName:"<Slider />"}),rU=zt((r,t)=>{var o;const a={...r,orientation:(o=r==null?void 0:r.orientation)!=null?o:"horizontal"},l=xc("Slider",a),d=Ki(a),{direction:m}=wS();d.direction=m;const{getInputProps:v,getRootProps:y,...b}=yLe(d),R=y(),O=v({},t);return D.jsx(bLe,{value:b,children:D.jsx(wLe,{value:l,children:D.jsxs(Pt.div,{...R,className:Qw("chakra-slider",a.className),__css:l.container,children:[a.children,D.jsx("input",{...O})]})})})});rU.displayName="Slider";var iU=zt((r,t)=>{const{getThumbProps:o}=NN(),a=kN(),l=o(r,t);return D.jsx(Pt.div,{...l,className:Qw("chakra-slider__thumb",r.className),__css:a.thumb})});iU.displayName="SliderThumb";var oU=zt((r,t)=>{const{getTrackProps:o}=NN(),a=kN(),l=o(r,t);return D.jsx(Pt.div,{...l,className:Qw("chakra-slider__track",r.className),__css:a.track})});oU.displayName="SliderTrack";var sU=zt((r,t)=>{const{getInnerTrackProps:o}=NN(),a=kN(),l=o(r,t);return D.jsx(Pt.div,{...l,className:Qw("chakra-slider__filled-track",r.className),__css:a.filledTrack})});sU.displayName="SliderFilledTrack";var RLe=zt((r,t)=>{const{getMarkerProps:o}=NN(),a=kN(),l=o(r,t);return D.jsx(Pt.div,{...l,className:Qw("chakra-slider__marker",r.className),__css:a.mark})});RLe.displayName="SliderMark";var aP=zt(function(t,o){const a=xc("Switch",t),{spacing:l="0.5rem",children:d,...m}=Ki(t),{getIndicatorProps:v,getInputProps:y,getCheckboxProps:b,getRootProps:R,getLabelProps:O}=HOe(m),N=V.useMemo(()=>({display:"inline-block",position:"relative",verticalAlign:"middle",lineHeight:0,...a.container}),[a.container]),F=V.useMemo(()=>({display:"inline-flex",flexShrink:0,justifyContent:"flex-start",boxSizing:"content-box",cursor:"pointer",...a.track}),[a.track]),H=V.useMemo(()=>({userSelect:"none",marginStart:l,...a.label}),[l,a.label]);return D.jsxs(Pt.label,{...R(),className:In("chakra-switch",t.className),__css:N,children:[D.jsx("input",{className:"chakra-switch__input",...y({},o)}),D.jsx(Pt.span,{...b(),className:"chakra-switch__track",__css:F,children:D.jsx(Pt.span,{__css:a.thumb,className:"chakra-switch__thumb",...v()})}),d&&D.jsx(Pt.span,{className:"chakra-switch__label",...O(),__css:H,children:d})]})});aP.displayName="Switch";var[CLe,ILe,ALe,OLe]=XQ();function PLe(r){var t;const{defaultIndex:o,onChange:a,index:l,isManual:d,isLazy:m,lazyBehavior:v="unmount",orientation:y="horizontal",direction:b="ltr",...R}=r,[O,N]=V.useState(o??0),[F,H]=JQ({defaultValue:o??0,value:l,onChange:a});V.useEffect(()=>{l!=null&&N(l)},[l]);const G=ALe(),z=V.useId();return{id:`tabs-${(t=r.id)!=null?t:z}`,selectedIndex:F,focusedIndex:O,setSelectedIndex:H,setFocusedIndex:N,isManual:d,isLazy:m,lazyBehavior:v,orientation:y,descendants:G,direction:b,htmlProps:R}}var[NLe,DN]=Hi({name:"TabsContext",errorMessage:"useTabsContext: `context` is undefined. Seems you forgot to wrap all tabs components within <Tabs />"});function kLe(r){const{focusedIndex:t,orientation:o,direction:a}=DN(),l=ILe(),d=V.useCallback(m=>{const v=()=>{var J;const oe=l.nextEnabled(t);oe&&((J=oe.node)==null||J.focus())},y=()=>{var J;const oe=l.prevEnabled(t);oe&&((J=oe.node)==null||J.focus())},b=()=>{var J;const oe=l.firstEnabled();oe&&((J=oe.node)==null||J.focus())},R=()=>{var J;const oe=l.lastEnabled();oe&&((J=oe.node)==null||J.focus())},O=o==="horizontal",N=o==="vertical",F=m.key,H=a==="ltr"?"ArrowLeft":"ArrowRight",G=a==="ltr"?"ArrowRight":"ArrowLeft",ne={[H]:()=>O&&y(),[G]:()=>O&&v(),ArrowDown:()=>N&&v(),ArrowUp:()=>N&&y(),Home:b,End:R}[F];ne&&(m.preventDefault(),ne(m))},[l,t,o,a]);return{...r,role:"tablist","aria-orientation":o,onKeyDown:rr(r.onKeyDown,d)}}function DLe(r){const{isDisabled:t=!1,isFocusable:o=!1,...a}=r,{setSelectedIndex:l,isManual:d,id:m,setFocusedIndex:v,selectedIndex:y}=DN(),{index:b,register:R}=OLe({disabled:t&&!o}),O=b===y,N=()=>{l(b)},F=()=>{v(b),!d&&!(t&&o)&&l(b)};return{...eee({...a,ref:zi(R,r.ref),isDisabled:t,isFocusable:o,onClick:rr(r.onClick,N)}),id:Uee(m,b),role:"tab",tabIndex:O?0:-1,type:"button","aria-selected":O,"aria-controls":Vee(m,b),onFocus:t?void 0:rr(r.onFocus,F)}}var[LLe,xLe]=Hi({});function MLe(r){const t=DN(),{id:o,selectedIndex:a}=t,d=DV(r.children).map((m,v)=>V.createElement(LLe,{key:v,value:{isSelected:v===a,id:Vee(o,v),tabId:Uee(o,v),selectedIndex:a}},m));return{...r,children:d}}function ULe(r){const{children:t,...o}=r,{isLazy:a,lazyBehavior:l}=DN(),{isSelected:d,id:m,tabId:v}=xLe(),y=V.useRef(!1);d&&(y.current=!0);const b=oF({wasSelected:y.current,isSelected:d,enabled:a,mode:l});return{tabIndex:0,...o,children:b?t:null,role:"tabpanel","aria-labelledby":v,hidden:!d,id:m}}function Uee(r,t){return`${r}--tab-${t}`}function Vee(r,t){return`${r}--tabpanel-${t}`}var[VLe,LN]=Hi({name:"TabsStylesContext",errorMessage:`useTabsStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Tabs />" `}),Fee=zt(function(t,o){const a=xc("Tabs",t),{children:l,className:d,...m}=Ki(t),{htmlProps:v,descendants:y,...b}=PLe(m),R=V.useMemo(()=>b,[b]),{isFitted:O,...N}=v,F={position:"relative",...a.root};return D.jsx(CLe,{value:y,children:D.jsx(NLe,{value:R,children:D.jsx(VLe,{value:a,children:D.jsx(Pt.div,{className:In("chakra-tabs",d),ref:o,...N,__css:F,children:l})})})})});Fee.displayName="Tabs";var jee=zt(function(t,o){const a=kLe({...t,ref:o}),d={display:"flex",...LN().tablist};return D.jsx(Pt.div,{...a,className:In("chakra-tabs__tablist",t.className),__css:d})});jee.displayName="TabList";var aU=zt(function(t,o){const a=ULe({...t,ref:o}),l=LN();return D.jsx(Pt.div,{outline:"0",...a,className:In("chakra-tabs__tab-panel",t.className),__css:l.tabpanel})});aU.displayName="TabPanel";var Bee=zt(function(t,o){const a=MLe(t),l=LN();return D.jsx(Pt.div,{...a,width:"100%",ref:o,className:In("chakra-tabs__tab-panels",t.className),__css:l.tabpanels})});Bee.displayName="TabPanels";var cU=zt(function(t,o){const a=LN(),l=DLe({...t,ref:o}),d={outline:"0",display:"flex",alignItems:"center",justifyContent:"center",...a.tab};return D.jsx(Pt.button,{...l,className:In("chakra-tabs__tab",t.className),__css:d})});cU.displayName="Tab";var FLe={exit:{scale:.85,opacity:0,transition:{opacity:{duration:.15,easings:"easeInOut"},scale:{duration:.2,easings:"easeInOut"}}},enter:{scale:1,opacity:1,transition:{opacity:{easings:"easeOut",duration:.2},scale:{duration:.2,ease:[.175,.885,.4,1.1]}}}},lU=r=>{var t;return((t=r.current)==null?void 0:t.ownerDocument)||document},cP=r=>{var t,o;return((o=(t=r.current)==null?void 0:t.ownerDocument)==null?void 0:o.defaultView)||window};function jLe(r={}){const{openDelay:t=0,closeDelay:o=0,closeOnClick:a=!0,closeOnMouseDown:l,closeOnScroll:d,closeOnPointerDown:m=l,closeOnEsc:v=!0,onOpen:y,onClose:b,placement:R,id:O,isOpen:N,defaultIsOpen:F,arrowSize:H=10,arrowShadowColor:G,arrowPadding:z,modifiers:ne,isDisabled:J,gutter:oe,offset:se,direction:ae,...ye}=r,{isOpen:Q,onOpen:te,onClose:re}=iF({isOpen:N,defaultIsOpen:F,onOpen:y,onClose:b}),{referenceRef:le,getPopperProps:ve,getArrowInnerProps:fe,getArrowProps:de}=rF({enabled:Q,placement:R,arrowPadding:z,modifiers:ne,gutter:oe,offset:se,direction:ae}),lt=V.useId(),Xe=`tooltip-${O??lt}`,Le=V.useRef(null),Ke=V.useRef(),nt=V.useCallback(()=>{Ke.current&&(clearTimeout(Ke.current),Ke.current=void 0)},[]),Ee=V.useRef(),Ye=V.useCallback(()=>{Ee.current&&(clearTimeout(Ee.current),Ee.current=void 0)},[]),yt=V.useCallback(()=>{Ye(),re()},[re,Ye]),at=BLe(Le,yt),Fe=V.useCallback(()=>{if(!J&&!Ke.current){Q&&at();const hn=cP(Le);Ke.current=hn.setTimeout(te,t)}},[at,J,Q,te,t]),et=V.useCallback(()=>{nt();const hn=cP(Le);Ee.current=hn.setTimeout(yt,o)},[o,yt,nt]),_t=V.useCallback(()=>{Q&&a&&et()},[a,et,Q]),Dt=V.useCallback(()=>{Q&&m&&et()},[m,et,Q]),Ht=V.useCallback(hn=>{Q&&hn.key==="Escape"&&et()},[Q,et]);qy(()=>lU(Le),"keydown",v?Ht:void 0),qy(()=>{if(!d)return null;const hn=Le.current;if(!hn)return null;const gr=VZ(hn);return gr.localName==="body"?cP(Le):gr},"scroll",()=>{Q&&d&&yt()},{passive:!0,capture:!0}),V.useEffect(()=>{J&&(nt(),Q&&re())},[J,Q,re,nt]),V.useEffect(()=>()=>{nt(),Ye()},[nt,Ye]),qy(()=>Le.current,"pointerleave",et);const Wt=V.useCallback((hn={},gr=null)=>({...hn,ref:zi(Le,gr,le),onPointerEnter:rr(hn.onPointerEnter,bt=>{bt.pointerType!=="touch"&&Fe()}),onClick:rr(hn.onClick,_t),onPointerDown:rr(hn.onPointerDown,Dt),onFocus:rr(hn.onFocus,Fe),onBlur:rr(hn.onBlur,et),"aria-describedby":Q?Xe:void 0}),[Fe,et,Dt,Q,Xe,_t,le]),Fn=V.useCallback((hn={},gr=null)=>ve({...hn,style:{...hn.style,[Fo.arrowSize.var]:H?`${H}px`:void 0,[Fo.arrowShadowColor.var]:G}},gr),[ve,H,G]),xn=V.useCallback((hn={},gr=null)=>{const Ar={...hn.style,position:"relative",transformOrigin:Fo.transformOrigin.varRef};return{ref:gr,...ye,...hn,id:Xe,role:"tooltip",style:Ar}},[ye,Xe]);return{isOpen:Q,show:Fe,hide:et,getTriggerProps:Wt,getTooltipProps:xn,getTooltipPositionerProps:Fn,getArrowProps:de,getArrowInnerProps:fe}}var WM="chakra-ui:close-tooltip";function BLe(r,t){return V.useEffect(()=>{const o=lU(r);return o.addEventListener(WM,t),()=>o.removeEventListener(WM,t)},[t,r]),()=>{const o=lU(r),a=cP(r);o.dispatchEvent(new a.CustomEvent(WM))}}function WLe(r,t=[]){const o=Object.assign({},r);for(const a of t)a in o&&delete o[a];return o}function GLe(r,t){const o={};for(const a of t)a in r&&(o[a]=r[a]);return o}var zLe=Pt(bh.div),Zw=zt((r,t)=>{var o,a;const l=cu("Tooltip",r),d=Ki(r),m=wS(),{children:v,label:y,shouldWrapChildren:b,"aria-label":R,hasArrow:O,bg:N,portalProps:F,background:H,backgroundColor:G,bgColor:z,motionProps:ne,...J}=d,oe=(a=(o=H??G)!=null?o:N)!=null?a:z;if(oe){l.bg=oe;const ve=hve(m,"colors",oe);l[Fo.arrowBg.var]=ve}const se=jLe({...J,direction:m.direction}),ae=typeof v=="string"||b;let ye;if(ae)ye=D.jsx(Pt.span,{display:"inline-block",tabIndex:0,...se.getTriggerProps(),children:v});else{const ve=V.Children.only(v);ye=V.cloneElement(ve,se.getTriggerProps(ve.props,ve.ref))}const Q=!!R,te=se.getTooltipProps({},t),re=Q?WLe(te,["role","id"]):te,le=GLe(te,["role","id"]);return y?D.jsxs(D.Fragment,{children:[ye,D.jsx(CS,{children:se.isOpen&&D.jsx(au,{...F,children:D.jsx(Pt.div,{...se.getTooltipPositionerProps(),__css:{zIndex:l.zIndex,pointerEvents:"none"},children:D.jsxs(zLe,{variants:FLe,initial:"exit",animate:"enter",exit:"exit",...ne,...re,__css:l,children:[y,Q&&D.jsx(Pt.span,{srOnly:!0,...le,children:R}),O&&D.jsx(Pt.div,{"data-popper-arrow":!0,className:"chakra-tooltip__arrow-wrapper",children:D.jsx(Pt.div,{"data-popper-arrow-inner":!0,className:"chakra-tooltip__arrow",__css:{bg:l.bg}})})]})})})})]}):D.jsx(D.Fragment,{children:v})});Zw.displayName="Tooltip";const HLe="modulepreload",KLe=function(r,t){return new URL(r,t).href},C7={},GM=function(t,o,a){let l=Promise.resolve();if(o&&o.length>0){const m=document.getElementsByTagName("link"),v=document.querySelector("meta[property=csp-nonce]"),y=(v==null?void 0:v.nonce)||(v==null?void 0:v.getAttribute("nonce"));l=Promise.allSettled(o.map(b=>{if(b=KLe(b,a),b in C7)return;C7[b]=!0;const R=b.endsWith(".css"),O=R?'[rel="stylesheet"]':"";if(!!a)for(let H=m.length-1;H>=0;H--){const G=m[H];if(G.href===b&&(!R||G.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${b}"]${O}`))return;const F=document.createElement("link");if(F.rel=R?"stylesheet":HLe,R||(F.as="script"),F.crossOrigin="",F.href=b,y&&F.setAttribute("nonce",y),document.head.appendChild(F),R)return new Promise((H,G)=>{F.addEventListener("load",H),F.addEventListener("error",()=>G(new Error(`Unable to preload CSS for ${b}`)))})}))}function d(m){const v=new Event("vite:preloadError",{cancelable:!0});if(v.payload=m,window.dispatchEvent(v),!v.defaultPrevented)throw m}return l.then(m=>{for(const v of m||[])v.status==="rejected"&&d(v.reason);return t().catch(d)})},IO=()=>{const r=new Date,t=r.getHours().toString().padStart(2,"0"),o=r.getMinutes().toString().padStart(2,"0"),a=r.getSeconds().toString().padStart(2,"0"),l=r.getMilliseconds().toString().padStart(3,"0");return`${t}:${o}:${a}.${l}`},Ct={log:(...r)=>{{const t=r.map((o,a)=>a===0&&typeof o=="string"?`
${o}`:o);console.log(`[LOG] [${IO()}] `,...t)}},error:(...r)=>{{const t=r.map((o,a)=>a===0&&typeof o=="string"?`
${o}`:o);console.error(`[ERROR] [${IO()}] `,...t)}},warn:(...r)=>{{const t=r.map((o,a)=>a===0&&typeof o=="string"?`
${o}`:o);console.warn(`[WARN] [${IO()}]`,...t)}},trace:r=>{console.trace(`[TRACE] [${IO()}] ${r}`)}};async function Tw(r){let t;try{switch(r){case"default":t=await GM(()=>import("./index.v0.1.5.js"),[],import.meta.url);break;default:t=await GM(()=>import("./index.v0.1.5.js"),[],import.meta.url)}return t.default}catch(o){return Ct.error("Failed to load theme:",o),t=await GM(()=>import("./index.v0.1.5.js"),[],import.meta.url),t.default}}var I7={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wee=function(r){const t=[];let o=0;for(let a=0;a<r.length;a++){let l=r.charCodeAt(a);l<128?t[o++]=l:l<2048?(t[o++]=l>>6|192,t[o++]=l&63|128):(l&64512)===55296&&a+1<r.length&&(r.charCodeAt(a+1)&64512)===56320?(l=65536+((l&1023)<<10)+(r.charCodeAt(++a)&1023),t[o++]=l>>18|240,t[o++]=l>>12&63|128,t[o++]=l>>6&63|128,t[o++]=l&63|128):(t[o++]=l>>12|224,t[o++]=l>>6&63|128,t[o++]=l&63|128)}return t},$Le=function(r){const t=[];let o=0,a=0;for(;o<r.length;){const l=r[o++];if(l<128)t[a++]=String.fromCharCode(l);else if(l>191&&l<224){const d=r[o++];t[a++]=String.fromCharCode((l&31)<<6|d&63)}else if(l>239&&l<365){const d=r[o++],m=r[o++],v=r[o++],y=((l&7)<<18|(d&63)<<12|(m&63)<<6|v&63)-65536;t[a++]=String.fromCharCode(55296+(y>>10)),t[a++]=String.fromCharCode(56320+(y&1023))}else{const d=r[o++],m=r[o++];t[a++]=String.fromCharCode((l&15)<<12|(d&63)<<6|m&63)}}return t.join("")},Gee={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(r,t){if(!Array.isArray(r))throw Error("encodeByteArray takes an array as a parameter");this.init_();const o=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,a=[];for(let l=0;l<r.length;l+=3){const d=r[l],m=l+1<r.length,v=m?r[l+1]:0,y=l+2<r.length,b=y?r[l+2]:0,R=d>>2,O=(d&3)<<4|v>>4;let N=(v&15)<<2|b>>6,F=b&63;y||(F=64,m||(N=64)),a.push(o[R],o[O],o[N],o[F])}return a.join("")},encodeString(r,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(r):this.encodeByteArray(Wee(r),t)},decodeString(r,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(r):$Le(this.decodeStringToByteArray(r,t))},decodeStringToByteArray(r,t){this.init_();const o=t?this.charToByteMapWebSafe_:this.charToByteMap_,a=[];for(let l=0;l<r.length;){const d=o[r.charAt(l++)],v=l<r.length?o[r.charAt(l)]:0;++l;const b=l<r.length?o[r.charAt(l)]:64;++l;const O=l<r.length?o[r.charAt(l)]:64;if(++l,d==null||v==null||b==null||O==null)throw new qLe;const N=d<<2|v>>4;if(a.push(N),b!==64){const F=v<<4&240|b>>2;if(a.push(F),O!==64){const H=b<<6&192|O;a.push(H)}}}return a},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let r=0;r<this.ENCODED_VALS.length;r++)this.byteToCharMap_[r]=this.ENCODED_VALS.charAt(r),this.charToByteMap_[this.byteToCharMap_[r]]=r,this.byteToCharMapWebSafe_[r]=this.ENCODED_VALS_WEBSAFE.charAt(r),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[r]]=r,r>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(r)]=r,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(r)]=r)}}};class qLe extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const YLe=function(r){const t=Wee(r);return Gee.encodeByteArray(t,!0)},UP=function(r){return YLe(r).replace(/\./g,"")},zee=function(r){try{return Gee.decodeString(r,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function XLe(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JLe=()=>XLe().__FIREBASE_DEFAULTS__,QLe=()=>{if(typeof process>"u"||typeof I7>"u")return;const r=I7.__FIREBASE_DEFAULTS__;if(r)return JSON.parse(r)},ZLe=()=>{if(typeof document>"u")return;let r;try{r=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const t=r&&zee(r[1]);return t&&JSON.parse(t)},xN=()=>{try{return JLe()||QLe()||ZLe()}catch(r){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${r}`);return}},Hee=r=>{var t,o;return(o=(t=xN())===null||t===void 0?void 0:t.emulatorHosts)===null||o===void 0?void 0:o[r]},Kee=r=>{const t=Hee(r);if(!t)return;const o=t.lastIndexOf(":");if(o<=0||o+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const a=parseInt(t.substring(o+1),10);return t[0]==="["?[t.substring(1,o-1),a]:[t.substring(0,o),a]},$ee=()=>{var r;return(r=xN())===null||r===void 0?void 0:r.config},qee=r=>{var t;return(t=xN())===null||t===void 0?void 0:t[`_${r}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class exe{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((t,o)=>{this.resolve=t,this.reject=o})}wrapCallback(t){return(o,a)=>{o?this.reject(o):this.resolve(a),typeof t=="function"&&(this.promise.catch(()=>{}),t.length===1?t(o):t(o,a))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yee(r,t){if(r.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const o={alg:"none",type:"JWT"},a=t||"demo-project",l=r.iat||0,d=r.sub||r.user_id;if(!d)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const m=Object.assign({iss:`https://securetoken.google.com/${a}`,aud:a,iat:l,exp:l+3600,auth_time:l,sub:d,user_id:d,firebase:{sign_in_provider:"custom",identities:{}}},r);return[UP(JSON.stringify(o)),UP(JSON.stringify(m)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ba(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function txe(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(ba())}function nxe(){var r;const t=(r=xN())===null||r===void 0?void 0:r.forceEnvironment;if(t==="node")return!0;if(t==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function rxe(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function ixe(){const r=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof r=="object"&&r.id!==void 0}function oxe(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function sxe(){const r=ba();return r.indexOf("MSIE ")>=0||r.indexOf("Trident/")>=0}function axe(){return!nxe()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function cxe(){try{return typeof indexedDB=="object"}catch{return!1}}function lxe(){return new Promise((r,t)=>{try{let o=!0;const a="validate-browser-context-for-indexeddb-analytics-module",l=self.indexedDB.open(a);l.onsuccess=()=>{l.result.close(),o||self.indexedDB.deleteDatabase(a),r(!0)},l.onupgradeneeded=()=>{o=!1},l.onerror=()=>{var d;t(((d=l.error)===null||d===void 0?void 0:d.message)||"")}}catch(o){t(o)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uxe="FirebaseError";class Ph extends Error{constructor(t,o,a){super(o),this.code=t,this.customData=a,this.name=uxe,Object.setPrototypeOf(this,Ph.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,eR.prototype.create)}}class eR{constructor(t,o,a){this.service=t,this.serviceName=o,this.errors=a}create(t,...o){const a=o[0]||{},l=`${this.service}/${t}`,d=this.errors[t],m=d?dxe(d,a):"Error",v=`${this.serviceName}: ${m} (${l}).`;return new Ph(l,v,a)}}function dxe(r,t){return r.replace(hxe,(o,a)=>{const l=t[a];return l!=null?String(l):`<${a}?>`})}const hxe=/\{\$([^}]+)}/g;function fxe(r){for(const t in r)if(Object.prototype.hasOwnProperty.call(r,t))return!1;return!0}function VP(r,t){if(r===t)return!0;const o=Object.keys(r),a=Object.keys(t);for(const l of o){if(!a.includes(l))return!1;const d=r[l],m=t[l];if(A7(d)&&A7(m)){if(!VP(d,m))return!1}else if(d!==m)return!1}for(const l of a)if(!o.includes(l))return!1;return!0}function A7(r){return r!==null&&typeof r=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tR(r){const t=[];for(const[o,a]of Object.entries(r))Array.isArray(a)?a.forEach(l=>{t.push(encodeURIComponent(o)+"="+encodeURIComponent(l))}):t.push(encodeURIComponent(o)+"="+encodeURIComponent(a));return t.length?"&"+t.join("&"):""}function Ob(r){const t={};return r.replace(/^\?/,"").split("&").forEach(a=>{if(a){const[l,d]=a.split("=");t[decodeURIComponent(l)]=decodeURIComponent(d)}}),t}function Pb(r){const t=r.indexOf("?");if(!t)return"";const o=r.indexOf("#",t);return r.substring(t,o>0?o:void 0)}function pxe(r,t){const o=new mxe(r,t);return o.subscribe.bind(o)}class mxe{constructor(t,o){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=o,this.task.then(()=>{t(this)}).catch(a=>{this.error(a)})}next(t){this.forEachObserver(o=>{o.next(t)})}error(t){this.forEachObserver(o=>{o.error(t)}),this.close(t)}complete(){this.forEachObserver(t=>{t.complete()}),this.close()}subscribe(t,o,a){let l;if(t===void 0&&o===void 0&&a===void 0)throw new Error("Missing Observer.");gxe(t,["next","error","complete"])?l=t:l={next:t,error:o,complete:a},l.next===void 0&&(l.next=zM),l.error===void 0&&(l.error=zM),l.complete===void 0&&(l.complete=zM);const d=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?l.error(this.finalError):l.complete()}catch{}}),this.observers.push(l),d}unsubscribeOne(t){this.observers===void 0||this.observers[t]===void 0||(delete this.observers[t],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(t){if(!this.finalized)for(let o=0;o<this.observers.length;o++)this.sendOne(o,t)}sendOne(t,o){this.task.then(()=>{if(this.observers!==void 0&&this.observers[t]!==void 0)try{o(this.observers[t])}catch(a){typeof console<"u"&&console.error&&console.error(a)}})}close(t){this.finalized||(this.finalized=!0,t!==void 0&&(this.finalError=t),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function gxe(r,t){if(typeof r!="object"||r===null)return!1;for(const o of t)if(o in r&&typeof r[o]=="function")return!0;return!1}function zM(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function to(r){return r&&r._delegate?r._delegate:r}let km=class{constructor(t,o,a){this.name=t,this.instanceFactory=o,this.type=a,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const C_="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _xe{constructor(t,o){this.name=t,this.container=o,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const o=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(o)){const a=new exe;if(this.instancesDeferred.set(o,a),this.isInitialized(o)||this.shouldAutoInitialize())try{const l=this.getOrInitializeService({instanceIdentifier:o});l&&a.resolve(l)}catch{}}return this.instancesDeferred.get(o).promise}getImmediate(t){var o;const a=this.normalizeInstanceIdentifier(t==null?void 0:t.identifier),l=(o=t==null?void 0:t.optional)!==null&&o!==void 0?o:!1;if(this.isInitialized(a)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:a})}catch(d){if(l)return null;throw d}else{if(l)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,!!this.shouldAutoInitialize()){if(Exe(t))try{this.getOrInitializeService({instanceIdentifier:C_})}catch{}for(const[o,a]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(o);try{const d=this.getOrInitializeService({instanceIdentifier:l});a.resolve(d)}catch{}}}}clearInstance(t=C_){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter(o=>"INTERNAL"in o).map(o=>o.INTERNAL.delete()),...t.filter(o=>"_delete"in o).map(o=>o._delete())])}isComponentSet(){return this.component!=null}isInitialized(t=C_){return this.instances.has(t)}getOptions(t=C_){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:o={}}=t,a=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(a))throw Error(`${this.name}(${a}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const l=this.getOrInitializeService({instanceIdentifier:a,options:o});for(const[d,m]of this.instancesDeferred.entries()){const v=this.normalizeInstanceIdentifier(d);a===v&&m.resolve(l)}return l}onInit(t,o){var a;const l=this.normalizeInstanceIdentifier(o),d=(a=this.onInitCallbacks.get(l))!==null&&a!==void 0?a:new Set;d.add(t),this.onInitCallbacks.set(l,d);const m=this.instances.get(l);return m&&t(m,l),()=>{d.delete(t)}}invokeOnInitCallbacks(t,o){const a=this.onInitCallbacks.get(o);if(a)for(const l of a)try{l(t,o)}catch{}}getOrInitializeService({instanceIdentifier:t,options:o={}}){let a=this.instances.get(t);if(!a&&this.component&&(a=this.component.instanceFactory(this.container,{instanceIdentifier:vxe(t),options:o}),this.instances.set(t,a),this.instancesOptions.set(t,o),this.invokeOnInitCallbacks(a,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,a)}catch{}return a||null}normalizeInstanceIdentifier(t=C_){return this.component?this.component.multipleInstances?t:C_:t}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function vxe(r){return r===C_?void 0:r}function Exe(r){return r.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yxe{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const o=this.getProvider(t.name);if(o.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);o.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const o=new _xe(t,this);return this.providers.set(t,o),o}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var br;(function(r){r[r.DEBUG=0]="DEBUG",r[r.VERBOSE=1]="VERBOSE",r[r.INFO=2]="INFO",r[r.WARN=3]="WARN",r[r.ERROR=4]="ERROR",r[r.SILENT=5]="SILENT"})(br||(br={}));const Sxe={debug:br.DEBUG,verbose:br.VERBOSE,info:br.INFO,warn:br.WARN,error:br.ERROR,silent:br.SILENT},Txe=br.INFO,bxe={[br.DEBUG]:"log",[br.VERBOSE]:"log",[br.INFO]:"info",[br.WARN]:"warn",[br.ERROR]:"error"},wxe=(r,t,...o)=>{if(t<r.logLevel)return;const a=new Date().toISOString(),l=bxe[t];if(l)console[l](`[${a}]  ${r.name}:`,...o);else throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class uF{constructor(t){this.name=t,this._logLevel=Txe,this._logHandler=wxe,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in br))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel=typeof t=="string"?Sxe[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if(typeof t!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,br.DEBUG,...t),this._logHandler(this,br.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,br.VERBOSE,...t),this._logHandler(this,br.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,br.INFO,...t),this._logHandler(this,br.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,br.WARN,...t),this._logHandler(this,br.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,br.ERROR,...t),this._logHandler(this,br.ERROR,...t)}}const Rxe=(r,t)=>t.some(o=>r instanceof o);let O7,P7;function Cxe(){return O7||(O7=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Ixe(){return P7||(P7=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Xee=new WeakMap,uU=new WeakMap,Jee=new WeakMap,HM=new WeakMap,dF=new WeakMap;function Axe(r){const t=new Promise((o,a)=>{const l=()=>{r.removeEventListener("success",d),r.removeEventListener("error",m)},d=()=>{o(wm(r.result)),l()},m=()=>{a(r.error),l()};r.addEventListener("success",d),r.addEventListener("error",m)});return t.then(o=>{o instanceof IDBCursor&&Xee.set(o,r)}).catch(()=>{}),dF.set(t,r),t}function Oxe(r){if(uU.has(r))return;const t=new Promise((o,a)=>{const l=()=>{r.removeEventListener("complete",d),r.removeEventListener("error",m),r.removeEventListener("abort",m)},d=()=>{o(),l()},m=()=>{a(r.error||new DOMException("AbortError","AbortError")),l()};r.addEventListener("complete",d),r.addEventListener("error",m),r.addEventListener("abort",m)});uU.set(r,t)}let dU={get(r,t,o){if(r instanceof IDBTransaction){if(t==="done")return uU.get(r);if(t==="objectStoreNames")return r.objectStoreNames||Jee.get(r);if(t==="store")return o.objectStoreNames[1]?void 0:o.objectStore(o.objectStoreNames[0])}return wm(r[t])},set(r,t,o){return r[t]=o,!0},has(r,t){return r instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in r}};function Pxe(r){dU=r(dU)}function Nxe(r){return r===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...o){const a=r.call(KM(this),t,...o);return Jee.set(a,t.sort?t.sort():[t]),wm(a)}:Ixe().includes(r)?function(...t){return r.apply(KM(this),t),wm(Xee.get(this))}:function(...t){return wm(r.apply(KM(this),t))}}function kxe(r){return typeof r=="function"?Nxe(r):(r instanceof IDBTransaction&&Oxe(r),Rxe(r,Cxe())?new Proxy(r,dU):r)}function wm(r){if(r instanceof IDBRequest)return Axe(r);if(HM.has(r))return HM.get(r);const t=kxe(r);return t!==r&&(HM.set(r,t),dF.set(t,r)),t}const KM=r=>dF.get(r);function Dxe(r,t,{blocked:o,upgrade:a,blocking:l,terminated:d}={}){const m=indexedDB.open(r,t),v=wm(m);return a&&m.addEventListener("upgradeneeded",y=>{a(wm(m.result),y.oldVersion,y.newVersion,wm(m.transaction),y)}),o&&m.addEventListener("blocked",y=>o(y.oldVersion,y.newVersion,y)),v.then(y=>{d&&y.addEventListener("close",()=>d()),l&&y.addEventListener("versionchange",b=>l(b.oldVersion,b.newVersion,b))}).catch(()=>{}),v}const Lxe=["get","getKey","getAll","getAllKeys","count"],xxe=["put","add","delete","clear"],$M=new Map;function N7(r,t){if(!(r instanceof IDBDatabase&&!(t in r)&&typeof t=="string"))return;if($M.get(t))return $M.get(t);const o=t.replace(/FromIndex$/,""),a=t!==o,l=xxe.includes(o);if(!(o in(a?IDBIndex:IDBObjectStore).prototype)||!(l||Lxe.includes(o)))return;const d=async function(m,...v){const y=this.transaction(m,l?"readwrite":"readonly");let b=y.store;return a&&(b=b.index(v.shift())),(await Promise.all([b[o](...v),l&&y.done]))[0]};return $M.set(t,d),d}Pxe(r=>({...r,get:(t,o,a)=>N7(t,o)||r.get(t,o,a),has:(t,o)=>!!N7(t,o)||r.has(t,o)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mxe{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(o=>{if(Uxe(o)){const a=o.getImmediate();return`${a.library}/${a.version}`}else return null}).filter(o=>o).join(" ")}}function Uxe(r){const t=r.getComponent();return(t==null?void 0:t.type)==="VERSION"}const hU="@firebase/app",k7="0.10.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qf=new uF("@firebase/app"),Vxe="@firebase/app-compat",Fxe="@firebase/analytics-compat",jxe="@firebase/analytics",Bxe="@firebase/app-check-compat",Wxe="@firebase/app-check",Gxe="@firebase/auth",zxe="@firebase/auth-compat",Hxe="@firebase/database",Kxe="@firebase/data-connect",$xe="@firebase/database-compat",qxe="@firebase/functions",Yxe="@firebase/functions-compat",Xxe="@firebase/installations",Jxe="@firebase/installations-compat",Qxe="@firebase/messaging",Zxe="@firebase/messaging-compat",eMe="@firebase/performance",tMe="@firebase/performance-compat",nMe="@firebase/remote-config",rMe="@firebase/remote-config-compat",iMe="@firebase/storage",oMe="@firebase/storage-compat",sMe="@firebase/firestore",aMe="@firebase/vertexai-preview",cMe="@firebase/firestore-compat",lMe="firebase",uMe="10.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fU="[DEFAULT]",dMe={[hU]:"fire-core",[Vxe]:"fire-core-compat",[jxe]:"fire-analytics",[Fxe]:"fire-analytics-compat",[Wxe]:"fire-app-check",[Bxe]:"fire-app-check-compat",[Gxe]:"fire-auth",[zxe]:"fire-auth-compat",[Hxe]:"fire-rtdb",[Kxe]:"fire-data-connect",[$xe]:"fire-rtdb-compat",[qxe]:"fire-fn",[Yxe]:"fire-fn-compat",[Xxe]:"fire-iid",[Jxe]:"fire-iid-compat",[Qxe]:"fire-fcm",[Zxe]:"fire-fcm-compat",[eMe]:"fire-perf",[tMe]:"fire-perf-compat",[nMe]:"fire-rc",[rMe]:"fire-rc-compat",[iMe]:"fire-gcs",[oMe]:"fire-gcs-compat",[sMe]:"fire-fst",[cMe]:"fire-fst-compat",[aMe]:"fire-vertex","fire-js":"fire-js",[lMe]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FP=new Map,hMe=new Map,pU=new Map;function D7(r,t){try{r.container.addComponent(t)}catch(o){qf.debug(`Component ${t.name} failed to register with FirebaseApp ${r.name}`,o)}}function J_(r){const t=r.name;if(pU.has(t))return qf.debug(`There were multiple attempts to register component ${t}.`),!1;pU.set(t,r);for(const o of FP.values())D7(o,r);for(const o of hMe.values())D7(o,r);return!0}function MN(r,t){const o=r.container.getProvider("heartbeat").getImmediate({optional:!0});return o&&o.triggerHeartbeat(),r.container.getProvider(t)}function ah(r){return r.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fMe={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Rm=new eR("app","Firebase",fMe);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pMe{constructor(t,o,a){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},o),this._name=o.name,this._automaticDataCollectionEnabled=o.automaticDataCollectionEnabled,this._container=a,this.container.addComponent(new km("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw Rm.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const av=uMe;function Qee(r,t={}){let o=r;typeof t!="object"&&(t={name:t});const a=Object.assign({name:fU,automaticDataCollectionEnabled:!1},t),l=a.name;if(typeof l!="string"||!l)throw Rm.create("bad-app-name",{appName:String(l)});if(o||(o=$ee()),!o)throw Rm.create("no-options");const d=FP.get(l);if(d){if(VP(o,d.options)&&VP(a,d.config))return d;throw Rm.create("duplicate-app",{appName:l})}const m=new yxe(l);for(const y of pU.values())m.addComponent(y);const v=new pMe(o,a,m);return FP.set(l,v),v}function hF(r=fU){const t=FP.get(r);if(!t&&r===fU&&$ee())return Qee();if(!t)throw Rm.create("no-app",{appName:r});return t}function fh(r,t,o){var a;let l=(a=dMe[r])!==null&&a!==void 0?a:r;o&&(l+=`-${o}`);const d=l.match(/\s|\//),m=t.match(/\s|\//);if(d||m){const v=[`Unable to register library "${l}" with version "${t}":`];d&&v.push(`library name "${l}" contains illegal characters (whitespace or "/")`),d&&m&&v.push("and"),m&&v.push(`version name "${t}" contains illegal characters (whitespace or "/")`),qf.warn(v.join(" "));return}J_(new km(`${l}-version`,()=>({library:l,version:t}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mMe="firebase-heartbeat-database",gMe=1,bw="firebase-heartbeat-store";let qM=null;function Zee(){return qM||(qM=Dxe(mMe,gMe,{upgrade:(r,t)=>{switch(t){case 0:try{r.createObjectStore(bw)}catch(o){console.warn(o)}}}}).catch(r=>{throw Rm.create("idb-open",{originalErrorMessage:r.message})})),qM}async function _Me(r){try{const o=(await Zee()).transaction(bw),a=await o.objectStore(bw).get(ete(r));return await o.done,a}catch(t){if(t instanceof Ph)qf.warn(t.message);else{const o=Rm.create("idb-get",{originalErrorMessage:t==null?void 0:t.message});qf.warn(o.message)}}}async function L7(r,t){try{const a=(await Zee()).transaction(bw,"readwrite");await a.objectStore(bw).put(t,ete(r)),await a.done}catch(o){if(o instanceof Ph)qf.warn(o.message);else{const a=Rm.create("idb-set",{originalErrorMessage:o==null?void 0:o.message});qf.warn(a.message)}}}function ete(r){return`${r.name}!${r.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vMe=1024,EMe=30*24*60*60*1e3;class yMe{constructor(t){this.container=t,this._heartbeatsCache=null;const o=this.container.getProvider("app").getImmediate();this._storage=new TMe(o),this._heartbeatsCachePromise=this._storage.read().then(a=>(this._heartbeatsCache=a,a))}async triggerHeartbeat(){var t,o;try{const l=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),d=x7();return((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((o=this._heartbeatsCache)===null||o===void 0?void 0:o.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===d||this._heartbeatsCache.heartbeats.some(m=>m.date===d)?void 0:(this._heartbeatsCache.heartbeats.push({date:d,agent:l}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(m=>{const v=new Date(m.date).valueOf();return Date.now()-v<=EMe}),this._storage.overwrite(this._heartbeatsCache))}catch(a){qf.warn(a)}}async getHeartbeatsHeader(){var t;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const o=x7(),{heartbeatsToSend:a,unsentEntries:l}=SMe(this._heartbeatsCache.heartbeats),d=UP(JSON.stringify({version:2,heartbeats:a}));return this._heartbeatsCache.lastSentHeartbeatDate=o,l.length>0?(this._heartbeatsCache.heartbeats=l,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),d}catch(o){return qf.warn(o),""}}}function x7(){return new Date().toISOString().substring(0,10)}function SMe(r,t=vMe){const o=[];let a=r.slice();for(const l of r){const d=o.find(m=>m.agent===l.agent);if(d){if(d.dates.push(l.date),M7(o)>t){d.dates.pop();break}}else if(o.push({agent:l.agent,dates:[l.date]}),M7(o)>t){o.pop();break}a=a.slice(1)}return{heartbeatsToSend:o,unsentEntries:a}}class TMe{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return cxe()?lxe().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const o=await _Me(this.app);return o!=null&&o.heartbeats?o:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(t){var o;if(await this._canUseIndexedDBPromise){const l=await this.read();return L7(this.app,{lastSentHeartbeatDate:(o=t.lastSentHeartbeatDate)!==null&&o!==void 0?o:l.lastSentHeartbeatDate,heartbeats:t.heartbeats})}else return}async add(t){var o;if(await this._canUseIndexedDBPromise){const l=await this.read();return L7(this.app,{lastSentHeartbeatDate:(o=t.lastSentHeartbeatDate)!==null&&o!==void 0?o:l.lastSentHeartbeatDate,heartbeats:[...l.heartbeats,...t.heartbeats]})}else return}}function M7(r){return UP(JSON.stringify({version:2,heartbeats:r})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bMe(r){J_(new km("platform-logger",t=>new Mxe(t),"PRIVATE")),J_(new km("heartbeat",t=>new yMe(t),"PRIVATE")),fh(hU,k7,r),fh(hU,k7,"esm2017"),fh("fire-js","")}bMe("");function tte(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const wMe=tte,nte=new eR("auth","Firebase",tte());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jP=new uF("@firebase/auth");function RMe(r,...t){jP.logLevel<=br.WARN&&jP.warn(`Auth (${av}): ${r}`,...t)}function lP(r,...t){jP.logLevel<=br.ERROR&&jP.error(`Auth (${av}): ${r}`,...t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rd(r,...t){throw fF(r,...t)}function ph(r,...t){return fF(r,...t)}function rte(r,t,o){const a=Object.assign(Object.assign({},wMe()),{[t]:o});return new eR("auth","Firebase",a).create(t,{appName:r.name})}function zf(r){return rte(r,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function fF(r,...t){if(typeof r!="string"){const o=t[0],a=[...t.slice(1)];return a[0]&&(a[0].appName=r.name),r._errorFactory.create(o,...a)}return nte.create(r,...t)}function Ln(r,t,...o){if(!r)throw fF(t,...o)}function Mf(r){const t="INTERNAL ASSERTION FAILED: "+r;throw lP(t),new Error(t)}function Yf(r,t){r||Mf(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mU(){var r;return typeof self<"u"&&((r=self.location)===null||r===void 0?void 0:r.href)||""}function CMe(){return U7()==="http:"||U7()==="https:"}function U7(){var r;return typeof self<"u"&&((r=self.location)===null||r===void 0?void 0:r.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function IMe(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(CMe()||ixe()||"connection"in navigator)?navigator.onLine:!0}function AMe(){if(typeof navigator>"u")return null;const r=navigator;return r.languages&&r.languages[0]||r.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nR{constructor(t,o){this.shortDelay=t,this.longDelay=o,Yf(o>t,"Short delay should be less than long delay!"),this.isMobile=txe()||oxe()}get(){return IMe()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pF(r,t){Yf(r.emulator,"Emulator should always be set here");const{url:o}=r.emulator;return t?`${o}${t.startsWith("/")?t.slice(1):t}`:o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ite{static initialize(t,o,a){this.fetchImpl=t,o&&(this.headersImpl=o),a&&(this.responseImpl=a)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Mf("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Mf("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Mf("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OMe={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PMe=new nR(3e4,6e4);function Bm(r,t){return r.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:r.tenantId}):t}async function Wm(r,t,o,a,l={}){return ote(r,l,async()=>{let d={},m={};a&&(t==="GET"?m=a:d={body:JSON.stringify(a)});const v=tR(Object.assign({key:r.config.apiKey},m)).slice(1),y=await r._getAdditionalHeaders();y["Content-Type"]="application/json",r.languageCode&&(y["X-Firebase-Locale"]=r.languageCode);const b=Object.assign({method:t,headers:y},d);return rxe()||(b.referrerPolicy="no-referrer"),ite.fetch()(ste(r,r.config.apiHost,o,v),b)})}async function ote(r,t,o){r._canInitEmulator=!1;const a=Object.assign(Object.assign({},OMe),t);try{const l=new kMe(r),d=await Promise.race([o(),l.promise]);l.clearNetworkTimeout();const m=await d.json();if("needConfirmation"in m)throw AO(r,"account-exists-with-different-credential",m);if(d.ok&&!("errorMessage"in m))return m;{const v=d.ok?m.errorMessage:m.error.message,[y,b]=v.split(" : ");if(y==="FEDERATED_USER_ID_ALREADY_LINKED")throw AO(r,"credential-already-in-use",m);if(y==="EMAIL_EXISTS")throw AO(r,"email-already-in-use",m);if(y==="USER_DISABLED")throw AO(r,"user-disabled",m);const R=a[y]||y.toLowerCase().replace(/[_\s]+/g,"-");if(b)throw rte(r,R,b);rd(r,R)}}catch(l){if(l instanceof Ph)throw l;rd(r,"network-request-failed",{message:String(l)})}}async function rR(r,t,o,a,l={}){const d=await Wm(r,t,o,a,l);return"mfaPendingCredential"in d&&rd(r,"multi-factor-auth-required",{_serverResponse:d}),d}function ste(r,t,o,a){const l=`${t}${o}?${a}`;return r.config.emulator?pF(r.config,l):`${r.config.apiScheme}://${l}`}function NMe(r){switch(r){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class kMe{constructor(t){this.auth=t,this.timer=null,this.promise=new Promise((o,a)=>{this.timer=setTimeout(()=>a(ph(this.auth,"network-request-failed")),PMe.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function AO(r,t,o){const a={appName:r.name};o.email&&(a.email=o.email),o.phoneNumber&&(a.phoneNumber=o.phoneNumber);const l=ph(r,t,a);return l.customData._tokenResponse=o,l}function V7(r){return r!==void 0&&r.enterprise!==void 0}class DMe{constructor(t){if(this.siteKey="",this.recaptchaEnforcementState=[],t.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=t.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=t.recaptchaEnforcementState}getProviderEnforcementState(t){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const o of this.recaptchaEnforcementState)if(o.provider&&o.provider===t)return NMe(o.enforcementState);return null}isProviderEnabled(t){return this.getProviderEnforcementState(t)==="ENFORCE"||this.getProviderEnforcementState(t)==="AUDIT"}}async function LMe(r,t){return Wm(r,"GET","/v2/recaptchaConfig",Bm(r,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function xMe(r,t){return Wm(r,"POST","/v1/accounts:delete",t)}async function ate(r,t){return Wm(r,"POST","/v1/accounts:lookup",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xb(r){if(r)try{const t=new Date(Number(r));if(!isNaN(t.getTime()))return t.toUTCString()}catch{}}async function MMe(r,t=!1){const o=to(r),a=await o.getIdToken(t),l=mF(a);Ln(l&&l.exp&&l.auth_time&&l.iat,o.auth,"internal-error");const d=typeof l.firebase=="object"?l.firebase:void 0,m=d==null?void 0:d.sign_in_provider;return{claims:l,token:a,authTime:Xb(YM(l.auth_time)),issuedAtTime:Xb(YM(l.iat)),expirationTime:Xb(YM(l.exp)),signInProvider:m||null,signInSecondFactor:(d==null?void 0:d.sign_in_second_factor)||null}}function YM(r){return Number(r)*1e3}function mF(r){const[t,o,a]=r.split(".");if(t===void 0||o===void 0||a===void 0)return lP("JWT malformed, contained fewer than 3 sections"),null;try{const l=zee(o);return l?JSON.parse(l):(lP("Failed to decode base64 JWT payload"),null)}catch(l){return lP("Caught error parsing JWT payload as JSON",l==null?void 0:l.toString()),null}}function F7(r){const t=mF(r);return Ln(t,"internal-error"),Ln(typeof t.exp<"u","internal-error"),Ln(typeof t.iat<"u","internal-error"),Number(t.exp)-Number(t.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ww(r,t,o=!1){if(o)return t;try{return await t}catch(a){throw a instanceof Ph&&UMe(a)&&r.auth.currentUser===r&&await r.auth.signOut(),a}}function UMe({code:r}){return r==="auth/user-disabled"||r==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VMe{constructor(t){this.user=t,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(t){var o;if(t){const a=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),a}else{this.errorBackoff=3e4;const l=((o=this.user.stsTokenManager.expirationTime)!==null&&o!==void 0?o:0)-Date.now()-3e5;return Math.max(0,l)}}schedule(t=!1){if(!this.isRunning)return;const o=this.getInterval(t);this.timerId=setTimeout(async()=>{await this.iteration()},o)}async iteration(){try{await this.user.getIdToken(!0)}catch(t){(t==null?void 0:t.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gU{constructor(t,o){this.createdAt=t,this.lastLoginAt=o,this._initializeTime()}_initializeTime(){this.lastSignInTime=Xb(this.lastLoginAt),this.creationTime=Xb(this.createdAt)}_copy(t){this.createdAt=t.createdAt,this.lastLoginAt=t.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function BP(r){var t;const o=r.auth,a=await r.getIdToken(),l=await ww(r,ate(o,{idToken:a}));Ln(l==null?void 0:l.users.length,o,"internal-error");const d=l.users[0];r._notifyReloadListener(d);const m=!((t=d.providerUserInfo)===null||t===void 0)&&t.length?cte(d.providerUserInfo):[],v=jMe(r.providerData,m),y=r.isAnonymous,b=!(r.email&&d.passwordHash)&&!(v!=null&&v.length),R=y?b:!1,O={uid:d.localId,displayName:d.displayName||null,photoURL:d.photoUrl||null,email:d.email||null,emailVerified:d.emailVerified||!1,phoneNumber:d.phoneNumber||null,tenantId:d.tenantId||null,providerData:v,metadata:new gU(d.createdAt,d.lastLoginAt),isAnonymous:R};Object.assign(r,O)}async function FMe(r){const t=to(r);await BP(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}function jMe(r,t){return[...r.filter(a=>!t.some(l=>l.providerId===a.providerId)),...t]}function cte(r){return r.map(t=>{var{providerId:o}=t,a=$w(t,["providerId"]);return{providerId:o,uid:a.rawId||"",displayName:a.displayName||null,email:a.email||null,phoneNumber:a.phoneNumber||null,photoURL:a.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function BMe(r,t){const o=await ote(r,{},async()=>{const a=tR({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:l,apiKey:d}=r.config,m=ste(r,l,"/v1/token",`key=${d}`),v=await r._getAdditionalHeaders();return v["Content-Type"]="application/x-www-form-urlencoded",ite.fetch()(m,{method:"POST",headers:v,body:a})});return{accessToken:o.access_token,expiresIn:o.expires_in,refreshToken:o.refresh_token}}async function WMe(r,t){return Wm(r,"POST","/v2/accounts:revokeToken",Bm(r,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qy{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(t){Ln(t.idToken,"internal-error"),Ln(typeof t.idToken<"u","internal-error"),Ln(typeof t.refreshToken<"u","internal-error");const o="expiresIn"in t&&typeof t.expiresIn<"u"?Number(t.expiresIn):F7(t.idToken);this.updateTokensAndExpiration(t.idToken,t.refreshToken,o)}updateFromIdToken(t){Ln(t.length!==0,"internal-error");const o=F7(t);this.updateTokensAndExpiration(t,null,o)}async getToken(t,o=!1){return!o&&this.accessToken&&!this.isExpired?this.accessToken:(Ln(this.refreshToken,t,"user-token-expired"),this.refreshToken?(await this.refresh(t,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(t,o){const{accessToken:a,refreshToken:l,expiresIn:d}=await BMe(t,o);this.updateTokensAndExpiration(a,l,Number(d))}updateTokensAndExpiration(t,o,a){this.refreshToken=o||null,this.accessToken=t||null,this.expirationTime=Date.now()+a*1e3}static fromJSON(t,o){const{refreshToken:a,accessToken:l,expirationTime:d}=o,m=new Qy;return a&&(Ln(typeof a=="string","internal-error",{appName:t}),m.refreshToken=a),l&&(Ln(typeof l=="string","internal-error",{appName:t}),m.accessToken=l),d&&(Ln(typeof d=="number","internal-error",{appName:t}),m.expirationTime=d),m}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(t){this.accessToken=t.accessToken,this.refreshToken=t.refreshToken,this.expirationTime=t.expirationTime}_clone(){return Object.assign(new Qy,this.toJSON())}_performRefresh(){return Mf("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dm(r,t){Ln(typeof r=="string"||typeof r>"u","internal-error",{appName:t})}class Uf{constructor(t){var{uid:o,auth:a,stsTokenManager:l}=t,d=$w(t,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new VMe(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=o,this.auth=a,this.stsTokenManager=l,this.accessToken=l.accessToken,this.displayName=d.displayName||null,this.email=d.email||null,this.emailVerified=d.emailVerified||!1,this.phoneNumber=d.phoneNumber||null,this.photoURL=d.photoURL||null,this.isAnonymous=d.isAnonymous||!1,this.tenantId=d.tenantId||null,this.providerData=d.providerData?[...d.providerData]:[],this.metadata=new gU(d.createdAt||void 0,d.lastLoginAt||void 0)}async getIdToken(t){const o=await ww(this,this.stsTokenManager.getToken(this.auth,t));return Ln(o,this.auth,"internal-error"),this.accessToken!==o&&(this.accessToken=o,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),o}getIdTokenResult(t){return MMe(this,t)}reload(){return FMe(this)}_assign(t){this!==t&&(Ln(this.uid===t.uid,this.auth,"internal-error"),this.displayName=t.displayName,this.photoURL=t.photoURL,this.email=t.email,this.emailVerified=t.emailVerified,this.phoneNumber=t.phoneNumber,this.isAnonymous=t.isAnonymous,this.tenantId=t.tenantId,this.providerData=t.providerData.map(o=>Object.assign({},o)),this.metadata._copy(t.metadata),this.stsTokenManager._assign(t.stsTokenManager))}_clone(t){const o=new Uf(Object.assign(Object.assign({},this),{auth:t,stsTokenManager:this.stsTokenManager._clone()}));return o.metadata._copy(this.metadata),o}_onReload(t){Ln(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=t,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(t){this.reloadListener?this.reloadListener(t):this.reloadUserInfo=t}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(t,o=!1){let a=!1;t.idToken&&t.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(t),a=!0),o&&await BP(this),await this.auth._persistUserIfCurrent(this),a&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(ah(this.auth.app))return Promise.reject(zf(this.auth));const t=await this.getIdToken();return await ww(this,xMe(this.auth,{idToken:t})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(t=>Object.assign({},t)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(t,o){var a,l,d,m,v,y,b,R;const O=(a=o.displayName)!==null&&a!==void 0?a:void 0,N=(l=o.email)!==null&&l!==void 0?l:void 0,F=(d=o.phoneNumber)!==null&&d!==void 0?d:void 0,H=(m=o.photoURL)!==null&&m!==void 0?m:void 0,G=(v=o.tenantId)!==null&&v!==void 0?v:void 0,z=(y=o._redirectEventId)!==null&&y!==void 0?y:void 0,ne=(b=o.createdAt)!==null&&b!==void 0?b:void 0,J=(R=o.lastLoginAt)!==null&&R!==void 0?R:void 0,{uid:oe,emailVerified:se,isAnonymous:ae,providerData:ye,stsTokenManager:Q}=o;Ln(oe&&Q,t,"internal-error");const te=Qy.fromJSON(this.name,Q);Ln(typeof oe=="string",t,"internal-error"),dm(O,t.name),dm(N,t.name),Ln(typeof se=="boolean",t,"internal-error"),Ln(typeof ae=="boolean",t,"internal-error"),dm(F,t.name),dm(H,t.name),dm(G,t.name),dm(z,t.name),dm(ne,t.name),dm(J,t.name);const re=new Uf({uid:oe,auth:t,email:N,emailVerified:se,displayName:O,isAnonymous:ae,photoURL:H,phoneNumber:F,tenantId:G,stsTokenManager:te,createdAt:ne,lastLoginAt:J});return ye&&Array.isArray(ye)&&(re.providerData=ye.map(le=>Object.assign({},le))),z&&(re._redirectEventId=z),re}static async _fromIdTokenResponse(t,o,a=!1){const l=new Qy;l.updateFromServerResponse(o);const d=new Uf({uid:o.localId,auth:t,stsTokenManager:l,isAnonymous:a});return await BP(d),d}static async _fromGetAccountInfoResponse(t,o,a){const l=o.users[0];Ln(l.localId!==void 0,"internal-error");const d=l.providerUserInfo!==void 0?cte(l.providerUserInfo):[],m=!(l.email&&l.passwordHash)&&!(d!=null&&d.length),v=new Qy;v.updateFromIdToken(a);const y=new Uf({uid:l.localId,auth:t,stsTokenManager:v,isAnonymous:m}),b={uid:l.localId,displayName:l.displayName||null,photoURL:l.photoUrl||null,email:l.email||null,emailVerified:l.emailVerified||!1,phoneNumber:l.phoneNumber||null,tenantId:l.tenantId||null,providerData:d,metadata:new gU(l.createdAt,l.lastLoginAt),isAnonymous:!(l.email&&l.passwordHash)&&!(d!=null&&d.length)};return Object.assign(y,b),y}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const j7=new Map;function Vf(r){Yf(r instanceof Function,"Expected a class definition");let t=j7.get(r);return t?(Yf(t instanceof r,"Instance stored in cache mismatched with class"),t):(t=new r,j7.set(r,t),t)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lte{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(t,o){this.storage[t]=o}async _get(t){const o=this.storage[t];return o===void 0?null:o}async _remove(t){delete this.storage[t]}_addListener(t,o){}_removeListener(t,o){}}lte.type="NONE";const B7=lte;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uP(r,t,o){return`firebase:${r}:${t}:${o}`}class Zy{constructor(t,o,a){this.persistence=t,this.auth=o,this.userKey=a;const{config:l,name:d}=this.auth;this.fullUserKey=uP(this.userKey,l.apiKey,d),this.fullPersistenceKey=uP("persistence",l.apiKey,d),this.boundEventHandler=o._onStorageEvent.bind(o),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(t){return this.persistence._set(this.fullUserKey,t.toJSON())}async getCurrentUser(){const t=await this.persistence._get(this.fullUserKey);return t?Uf._fromJSON(this.auth,t):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(t){if(this.persistence===t)return;const o=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=t,o)return this.setCurrentUser(o)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(t,o,a="authUser"){if(!o.length)return new Zy(Vf(B7),t,a);const l=(await Promise.all(o.map(async b=>{if(await b._isAvailable())return b}))).filter(b=>b);let d=l[0]||Vf(B7);const m=uP(a,t.config.apiKey,t.name);let v=null;for(const b of o)try{const R=await b._get(m);if(R){const O=Uf._fromJSON(t,R);b!==d&&(v=O),d=b;break}}catch{}const y=l.filter(b=>b._shouldAllowMigration);return!d._shouldAllowMigration||!y.length?new Zy(d,t,a):(d=y[0],v&&await d._set(m,v.toJSON()),await Promise.all(o.map(async b=>{if(b!==d)try{await b._remove(m)}catch{}})),new Zy(d,t,a))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function W7(r){const t=r.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(fte(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(ute(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(mte(t))return"Blackberry";if(gte(t))return"Webos";if(dte(t))return"Safari";if((t.includes("chrome/")||hte(t))&&!t.includes("edge/"))return"Chrome";if(pte(t))return"Android";{const o=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,a=r.match(o);if((a==null?void 0:a.length)===2)return a[1]}return"Other"}function ute(r=ba()){return/firefox\//i.test(r)}function dte(r=ba()){const t=r.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function hte(r=ba()){return/crios\//i.test(r)}function fte(r=ba()){return/iemobile/i.test(r)}function pte(r=ba()){return/android/i.test(r)}function mte(r=ba()){return/blackberry/i.test(r)}function gte(r=ba()){return/webos/i.test(r)}function gF(r=ba()){return/iphone|ipad|ipod/i.test(r)||/macintosh/i.test(r)&&/mobile/i.test(r)}function GMe(r=ba()){var t;return gF(r)&&!!(!((t=window.navigator)===null||t===void 0)&&t.standalone)}function zMe(){return sxe()&&document.documentMode===10}function _te(r=ba()){return gF(r)||pte(r)||gte(r)||mte(r)||/windows phone/i.test(r)||fte(r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vte(r,t=[]){let o;switch(r){case"Browser":o=W7(ba());break;case"Worker":o=`${W7(ba())}-${r}`;break;default:o=r}const a=t.length?t.join(","):"FirebaseCore-web";return`${o}/JsCore/${av}/${a}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HMe{constructor(t){this.auth=t,this.queue=[]}pushCallback(t,o){const a=d=>new Promise((m,v)=>{try{const y=t(d);m(y)}catch(y){v(y)}});a.onAbort=o,this.queue.push(a);const l=this.queue.length-1;return()=>{this.queue[l]=()=>Promise.resolve()}}async runMiddleware(t){if(this.auth.currentUser===t)return;const o=[];try{for(const a of this.queue)await a(t),a.onAbort&&o.push(a.onAbort)}catch(a){o.reverse();for(const l of o)try{l()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:a==null?void 0:a.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function KMe(r,t={}){return Wm(r,"GET","/v2/passwordPolicy",Bm(r,t))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $Me=6;class qMe{constructor(t){var o,a,l,d;const m=t.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(o=m.minPasswordLength)!==null&&o!==void 0?o:$Me,m.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=m.maxPasswordLength),m.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=m.containsLowercaseCharacter),m.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=m.containsUppercaseCharacter),m.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=m.containsNumericCharacter),m.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=m.containsNonAlphanumericCharacter),this.enforcementState=t.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(l=(a=t.allowedNonAlphanumericCharacters)===null||a===void 0?void 0:a.join(""))!==null&&l!==void 0?l:"",this.forceUpgradeOnSignin=(d=t.forceUpgradeOnSignin)!==null&&d!==void 0?d:!1,this.schemaVersion=t.schemaVersion}validatePassword(t){var o,a,l,d,m,v;const y={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(t,y),this.validatePasswordCharacterOptions(t,y),y.isValid&&(y.isValid=(o=y.meetsMinPasswordLength)!==null&&o!==void 0?o:!0),y.isValid&&(y.isValid=(a=y.meetsMaxPasswordLength)!==null&&a!==void 0?a:!0),y.isValid&&(y.isValid=(l=y.containsLowercaseLetter)!==null&&l!==void 0?l:!0),y.isValid&&(y.isValid=(d=y.containsUppercaseLetter)!==null&&d!==void 0?d:!0),y.isValid&&(y.isValid=(m=y.containsNumericCharacter)!==null&&m!==void 0?m:!0),y.isValid&&(y.isValid=(v=y.containsNonAlphanumericCharacter)!==null&&v!==void 0?v:!0),y}validatePasswordLengthOptions(t,o){const a=this.customStrengthOptions.minPasswordLength,l=this.customStrengthOptions.maxPasswordLength;a&&(o.meetsMinPasswordLength=t.length>=a),l&&(o.meetsMaxPasswordLength=t.length<=l)}validatePasswordCharacterOptions(t,o){this.updatePasswordCharacterOptionsStatuses(o,!1,!1,!1,!1);let a;for(let l=0;l<t.length;l++)a=t.charAt(l),this.updatePasswordCharacterOptionsStatuses(o,a>="a"&&a<="z",a>="A"&&a<="Z",a>="0"&&a<="9",this.allowedNonAlphanumericCharacters.includes(a))}updatePasswordCharacterOptionsStatuses(t,o,a,l,d){this.customStrengthOptions.containsLowercaseLetter&&(t.containsLowercaseLetter||(t.containsLowercaseLetter=o)),this.customStrengthOptions.containsUppercaseLetter&&(t.containsUppercaseLetter||(t.containsUppercaseLetter=a)),this.customStrengthOptions.containsNumericCharacter&&(t.containsNumericCharacter||(t.containsNumericCharacter=l)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(t.containsNonAlphanumericCharacter||(t.containsNonAlphanumericCharacter=d))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YMe{constructor(t,o,a,l){this.app=t,this.heartbeatServiceProvider=o,this.appCheckServiceProvider=a,this.config=l,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new G7(this),this.idTokenSubscription=new G7(this),this.beforeStateQueue=new HMe(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=nte,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=t.name,this.clientVersion=l.sdkClientVersion}_initializeWithPersistence(t,o){return o&&(this._popupRedirectResolver=Vf(o)),this._initializationPromise=this.queue(async()=>{var a,l;if(!this._deleted&&(this.persistenceManager=await Zy.create(this,t),!this._deleted)){if(!((a=this._popupRedirectResolver)===null||a===void 0)&&a._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(o),this.lastNotifiedUid=((l=this.currentUser)===null||l===void 0?void 0:l.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const t=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!t)){if(this.currentUser&&t&&this.currentUser.uid===t.uid){this._currentUser._assign(t),await this.currentUser.getIdToken();return}await this._updateCurrentUser(t,!0)}}async initializeCurrentUserFromIdToken(t){try{const o=await ate(this,{idToken:t}),a=await Uf._fromGetAccountInfoResponse(this,o,t);await this.directlySetCurrentUser(a)}catch(o){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",o),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(t){var o;if(ah(this.app)){const m=this.app.settings.authIdToken;return m?new Promise(v=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(m).then(v,v))}):this.directlySetCurrentUser(null)}const a=await this.assertedPersistence.getCurrentUser();let l=a,d=!1;if(t&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const m=(o=this.redirectUser)===null||o===void 0?void 0:o._redirectEventId,v=l==null?void 0:l._redirectEventId,y=await this.tryRedirectSignIn(t);(!m||m===v)&&(y!=null&&y.user)&&(l=y.user,d=!0)}if(!l)return this.directlySetCurrentUser(null);if(!l._redirectEventId){if(d)try{await this.beforeStateQueue.runMiddleware(l)}catch(m){l=a,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(m))}return l?this.reloadAndSetCurrentUserOrClear(l):this.directlySetCurrentUser(null)}return Ln(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===l._redirectEventId?this.directlySetCurrentUser(l):this.reloadAndSetCurrentUserOrClear(l)}async tryRedirectSignIn(t){let o=null;try{o=await this._popupRedirectResolver._completeRedirectFn(this,t,!0)}catch{await this._setRedirectUser(null)}return o}async reloadAndSetCurrentUserOrClear(t){try{await BP(t)}catch(o){if((o==null?void 0:o.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(t)}useDeviceLanguage(){this.languageCode=AMe()}async _delete(){this._deleted=!0}async updateCurrentUser(t){if(ah(this.app))return Promise.reject(zf(this));const o=t?to(t):null;return o&&Ln(o.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(o&&o._clone(this))}async _updateCurrentUser(t,o=!1){if(!this._deleted)return t&&Ln(this.tenantId===t.tenantId,this,"tenant-id-mismatch"),o||await this.beforeStateQueue.runMiddleware(t),this.queue(async()=>{await this.directlySetCurrentUser(t),this.notifyAuthListeners()})}async signOut(){return ah(this.app)?Promise.reject(zf(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(t){return ah(this.app)?Promise.reject(zf(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Vf(t))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(t){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const o=this._getPasswordPolicyInternal();return o.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):o.validatePassword(t)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const t=await KMe(this),o=new qMe(t);this.tenantId===null?this._projectPasswordPolicy=o:this._tenantPasswordPolicies[this.tenantId]=o}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(t){this._errorFactory=new eR("auth","Firebase",t())}onAuthStateChanged(t,o,a){return this.registerStateListener(this.authStateSubscription,t,o,a)}beforeAuthStateChanged(t,o){return this.beforeStateQueue.pushCallback(t,o)}onIdTokenChanged(t,o,a){return this.registerStateListener(this.idTokenSubscription,t,o,a)}authStateReady(){return new Promise((t,o)=>{if(this.currentUser)t();else{const a=this.onAuthStateChanged(()=>{a(),t()},o)}})}async revokeAccessToken(t){if(this.currentUser){const o=await this.currentUser.getIdToken(),a={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:t,idToken:o};this.tenantId!=null&&(a.tenantId=this.tenantId),await WMe(this,a)}}toJSON(){var t;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(t=this._currentUser)===null||t===void 0?void 0:t.toJSON()}}async _setRedirectUser(t,o){const a=await this.getOrInitRedirectPersistenceManager(o);return t===null?a.removeCurrentUser():a.setCurrentUser(t)}async getOrInitRedirectPersistenceManager(t){if(!this.redirectPersistenceManager){const o=t&&Vf(t)||this._popupRedirectResolver;Ln(o,this,"argument-error"),this.redirectPersistenceManager=await Zy.create(this,[Vf(o._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(t){var o,a;return this._isInitialized&&await this.queue(async()=>{}),((o=this._currentUser)===null||o===void 0?void 0:o._redirectEventId)===t?this._currentUser:((a=this.redirectUser)===null||a===void 0?void 0:a._redirectEventId)===t?this.redirectUser:null}async _persistUserIfCurrent(t){if(t===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(t))}_notifyListenersIfCurrent(t){t===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var t,o;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const a=(o=(t=this.currentUser)===null||t===void 0?void 0:t.uid)!==null&&o!==void 0?o:null;this.lastNotifiedUid!==a&&(this.lastNotifiedUid=a,this.authStateSubscription.next(this.currentUser))}registerStateListener(t,o,a,l){if(this._deleted)return()=>{};const d=typeof o=="function"?o:o.next.bind(o);let m=!1;const v=this._isInitialized?Promise.resolve():this._initializationPromise;if(Ln(v,this,"internal-error"),v.then(()=>{m||d(this.currentUser)}),typeof o=="function"){const y=t.addObserver(o,a,l);return()=>{m=!0,y()}}else{const y=t.addObserver(o);return()=>{m=!0,y()}}}async directlySetCurrentUser(t){this.currentUser&&this.currentUser!==t&&this._currentUser._stopProactiveRefresh(),t&&this.isProactiveRefreshEnabled&&t._startProactiveRefresh(),this.currentUser=t,t?await this.assertedPersistence.setCurrentUser(t):await this.assertedPersistence.removeCurrentUser()}queue(t){return this.operations=this.operations.then(t,t),this.operations}get assertedPersistence(){return Ln(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(t){!t||this.frameworks.includes(t)||(this.frameworks.push(t),this.frameworks.sort(),this.clientVersion=vte(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var t;const o={"X-Client-Version":this.clientVersion};this.app.options.appId&&(o["X-Firebase-gmpid"]=this.app.options.appId);const a=await((t=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||t===void 0?void 0:t.getHeartbeatsHeader());a&&(o["X-Firebase-Client"]=a);const l=await this._getAppCheckToken();return l&&(o["X-Firebase-AppCheck"]=l),o}async _getAppCheckToken(){var t;const o=await((t=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||t===void 0?void 0:t.getToken());return o!=null&&o.error&&RMe(`Error while retrieving App Check token: ${o.error}`),o==null?void 0:o.token}}function cv(r){return to(r)}class G7{constructor(t){this.auth=t,this.observer=null,this.addObserver=pxe(o=>this.observer=o)}get next(){return Ln(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let UN={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function XMe(r){UN=r}function Ete(r){return UN.loadJS(r)}function JMe(){return UN.recaptchaEnterpriseScript}function QMe(){return UN.gapiScript}function ZMe(r){return`__${r}${Math.floor(Math.random()*1e6)}`}const e2e="recaptcha-enterprise",t2e="NO_RECAPTCHA";class n2e{constructor(t){this.type=e2e,this.auth=cv(t)}async verify(t="verify",o=!1){async function a(d){if(!o){if(d.tenantId==null&&d._agentRecaptchaConfig!=null)return d._agentRecaptchaConfig.siteKey;if(d.tenantId!=null&&d._tenantRecaptchaConfigs[d.tenantId]!==void 0)return d._tenantRecaptchaConfigs[d.tenantId].siteKey}return new Promise(async(m,v)=>{LMe(d,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(y=>{if(y.recaptchaKey===void 0)v(new Error("recaptcha Enterprise site key undefined"));else{const b=new DMe(y);return d.tenantId==null?d._agentRecaptchaConfig=b:d._tenantRecaptchaConfigs[d.tenantId]=b,m(b.siteKey)}}).catch(y=>{v(y)})})}function l(d,m,v){const y=window.grecaptcha;V7(y)?y.enterprise.ready(()=>{y.enterprise.execute(d,{action:t}).then(b=>{m(b)}).catch(()=>{m(t2e)})}):v(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((d,m)=>{a(this.auth).then(v=>{if(!o&&V7(window.grecaptcha))l(v,d,m);else{if(typeof window>"u"){m(new Error("RecaptchaVerifier is only supported in browser"));return}let y=JMe();y.length!==0&&(y+=v),Ete(y).then(()=>{l(v,d,m)}).catch(b=>{m(b)})}}).catch(v=>{m(v)})})}}async function z7(r,t,o,a=!1){const l=new n2e(r);let d;try{d=await l.verify(o)}catch{d=await l.verify(o,!0)}const m=Object.assign({},t);return a?Object.assign(m,{captchaResp:d}):Object.assign(m,{captchaResponse:d}),Object.assign(m,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(m,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),m}async function _U(r,t,o,a){var l;if(!((l=r._getRecaptchaConfig())===null||l===void 0)&&l.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const d=await z7(r,t,o,o==="getOobCode");return a(r,d)}else return a(r,t).catch(async d=>{if(d.code==="auth/missing-recaptcha-token"){console.log(`${o} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const m=await z7(r,t,o,o==="getOobCode");return a(r,m)}else return Promise.reject(d)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function r2e(r,t){const o=MN(r,"auth");if(o.isInitialized()){const l=o.getImmediate(),d=o.getOptions();if(VP(d,t??{}))return l;rd(l,"already-initialized")}return o.initialize({options:t})}function i2e(r,t){const o=(t==null?void 0:t.persistence)||[],a=(Array.isArray(o)?o:[o]).map(Vf);t!=null&&t.errorMap&&r._updateErrorMap(t.errorMap),r._initializeWithPersistence(a,t==null?void 0:t.popupRedirectResolver)}function o2e(r,t,o){const a=cv(r);Ln(a._canInitEmulator,a,"emulator-config-failed"),Ln(/^https?:\/\//.test(t),a,"invalid-emulator-scheme");const l=!1,d=yte(t),{host:m,port:v}=s2e(t),y=v===null?"":`:${v}`;a.config.emulator={url:`${d}//${m}${y}/`},a.settings.appVerificationDisabledForTesting=!0,a.emulatorConfig=Object.freeze({host:m,port:v,protocol:d.replace(":",""),options:Object.freeze({disableWarnings:l})}),a2e()}function yte(r){const t=r.indexOf(":");return t<0?"":r.substr(0,t+1)}function s2e(r){const t=yte(r),o=/(\/\/)?([^?#/]+)/.exec(r.substr(t.length));if(!o)return{host:"",port:null};const a=o[2].split("@").pop()||"",l=/^(\[[^\]]+\])(:|$)/.exec(a);if(l){const d=l[1];return{host:d,port:H7(a.substr(d.length+1))}}else{const[d,m]=a.split(":");return{host:d,port:H7(m)}}}function H7(r){if(!r)return null;const t=Number(r);return isNaN(t)?null:t}function a2e(){function r(){const t=document.createElement("p"),o=t.style;t.innerText="Running in emulator mode. Do not use with production credentials.",o.position="fixed",o.width="100%",o.backgroundColor="#ffffff",o.border=".1em solid #000000",o.color="#b50000",o.bottom="0px",o.left="0px",o.margin="0px",o.zIndex="10000",o.textAlign="center",t.classList.add("firebase-emulator-warning"),document.body.appendChild(t)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",r):r())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _F{constructor(t,o){this.providerId=t,this.signInMethod=o}toJSON(){return Mf("not implemented")}_getIdTokenResponse(t){return Mf("not implemented")}_linkToIdToken(t,o){return Mf("not implemented")}_getReauthenticationResolver(t){return Mf("not implemented")}}async function c2e(r,t){return Wm(r,"POST","/v1/accounts:signUp",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function l2e(r,t){return rR(r,"POST","/v1/accounts:signInWithPassword",Bm(r,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function u2e(r,t){return rR(r,"POST","/v1/accounts:signInWithEmailLink",Bm(r,t))}async function d2e(r,t){return rR(r,"POST","/v1/accounts:signInWithEmailLink",Bm(r,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rw extends _F{constructor(t,o,a,l=null){super("password",a),this._email=t,this._password=o,this._tenantId=l}static _fromEmailAndPassword(t,o){return new Rw(t,o,"password")}static _fromEmailAndCode(t,o,a=null){return new Rw(t,o,"emailLink",a)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(t){const o=typeof t=="string"?JSON.parse(t):t;if(o!=null&&o.email&&(o!=null&&o.password)){if(o.signInMethod==="password")return this._fromEmailAndPassword(o.email,o.password);if(o.signInMethod==="emailLink")return this._fromEmailAndCode(o.email,o.password,o.tenantId)}return null}async _getIdTokenResponse(t){switch(this.signInMethod){case"password":const o={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return _U(t,o,"signInWithPassword",l2e);case"emailLink":return u2e(t,{email:this._email,oobCode:this._password});default:rd(t,"internal-error")}}async _linkToIdToken(t,o){switch(this.signInMethod){case"password":const a={idToken:o,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return _U(t,a,"signUpPassword",c2e);case"emailLink":return d2e(t,{idToken:o,email:this._email,oobCode:this._password});default:rd(t,"internal-error")}}_getReauthenticationResolver(t){return this._getIdTokenResponse(t)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function eS(r,t){return rR(r,"POST","/v1/accounts:signInWithIdp",Bm(r,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const h2e="http://localhost";class Q_ extends _F{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(t){const o=new Q_(t.providerId,t.signInMethod);return t.idToken||t.accessToken?(t.idToken&&(o.idToken=t.idToken),t.accessToken&&(o.accessToken=t.accessToken),t.nonce&&!t.pendingToken&&(o.nonce=t.nonce),t.pendingToken&&(o.pendingToken=t.pendingToken)):t.oauthToken&&t.oauthTokenSecret?(o.accessToken=t.oauthToken,o.secret=t.oauthTokenSecret):rd("argument-error"),o}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(t){const o=typeof t=="string"?JSON.parse(t):t,{providerId:a,signInMethod:l}=o,d=$w(o,["providerId","signInMethod"]);if(!a||!l)return null;const m=new Q_(a,l);return m.idToken=d.idToken||void 0,m.accessToken=d.accessToken||void 0,m.secret=d.secret,m.nonce=d.nonce,m.pendingToken=d.pendingToken||null,m}_getIdTokenResponse(t){const o=this.buildRequest();return eS(t,o)}_linkToIdToken(t,o){const a=this.buildRequest();return a.idToken=o,eS(t,a)}_getReauthenticationResolver(t){const o=this.buildRequest();return o.autoCreate=!1,eS(t,o)}buildRequest(){const t={requestUri:h2e,returnSecureToken:!0};if(this.pendingToken)t.pendingToken=this.pendingToken;else{const o={};this.idToken&&(o.id_token=this.idToken),this.accessToken&&(o.access_token=this.accessToken),this.secret&&(o.oauth_token_secret=this.secret),o.providerId=this.providerId,this.nonce&&!this.pendingToken&&(o.nonce=this.nonce),t.postBody=tR(o)}return t}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function f2e(r){switch(r){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function p2e(r){const t=Ob(Pb(r)).link,o=t?Ob(Pb(t)).deep_link_id:null,a=Ob(Pb(r)).deep_link_id;return(a?Ob(Pb(a)).link:null)||a||o||t||r}class vF{constructor(t){var o,a,l,d,m,v;const y=Ob(Pb(t)),b=(o=y.apiKey)!==null&&o!==void 0?o:null,R=(a=y.oobCode)!==null&&a!==void 0?a:null,O=f2e((l=y.mode)!==null&&l!==void 0?l:null);Ln(b&&R&&O,"argument-error"),this.apiKey=b,this.operation=O,this.code=R,this.continueUrl=(d=y.continueUrl)!==null&&d!==void 0?d:null,this.languageCode=(m=y.languageCode)!==null&&m!==void 0?m:null,this.tenantId=(v=y.tenantId)!==null&&v!==void 0?v:null}static parseLink(t){const o=p2e(t);try{return new vF(o)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PS{constructor(){this.providerId=PS.PROVIDER_ID}static credential(t,o){return Rw._fromEmailAndPassword(t,o)}static credentialWithLink(t,o){const a=vF.parseLink(o);return Ln(a,"argument-error"),Rw._fromEmailAndCode(t,a.code,a.tenantId)}}PS.PROVIDER_ID="password";PS.EMAIL_PASSWORD_SIGN_IN_METHOD="password";PS.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ste{constructor(t){this.providerId=t,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(t){this.defaultLanguageCode=t}setCustomParameters(t){return this.customParameters=t,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iR extends Ste{constructor(){super(...arguments),this.scopes=[]}addScope(t){return this.scopes.includes(t)||this.scopes.push(t),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gm extends iR{constructor(){super("facebook.com")}static credential(t){return Q_._fromParams({providerId:gm.PROVIDER_ID,signInMethod:gm.FACEBOOK_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return gm.credentialFromTaggedObject(t)}static credentialFromError(t){return gm.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t)||!t.oauthAccessToken)return null;try{return gm.credential(t.oauthAccessToken)}catch{return null}}}gm.FACEBOOK_SIGN_IN_METHOD="facebook.com";gm.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _m extends iR{constructor(){super("google.com"),this.addScope("profile")}static credential(t,o){return Q_._fromParams({providerId:_m.PROVIDER_ID,signInMethod:_m.GOOGLE_SIGN_IN_METHOD,idToken:t,accessToken:o})}static credentialFromResult(t){return _m.credentialFromTaggedObject(t)}static credentialFromError(t){return _m.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthIdToken:o,oauthAccessToken:a}=t;if(!o&&!a)return null;try{return _m.credential(o,a)}catch{return null}}}_m.GOOGLE_SIGN_IN_METHOD="google.com";_m.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vm extends iR{constructor(){super("github.com")}static credential(t){return Q_._fromParams({providerId:vm.PROVIDER_ID,signInMethod:vm.GITHUB_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return vm.credentialFromTaggedObject(t)}static credentialFromError(t){return vm.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t)||!t.oauthAccessToken)return null;try{return vm.credential(t.oauthAccessToken)}catch{return null}}}vm.GITHUB_SIGN_IN_METHOD="github.com";vm.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Em extends iR{constructor(){super("twitter.com")}static credential(t,o){return Q_._fromParams({providerId:Em.PROVIDER_ID,signInMethod:Em.TWITTER_SIGN_IN_METHOD,oauthToken:t,oauthTokenSecret:o})}static credentialFromResult(t){return Em.credentialFromTaggedObject(t)}static credentialFromError(t){return Em.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthAccessToken:o,oauthTokenSecret:a}=t;if(!o||!a)return null;try{return Em.credential(o,a)}catch{return null}}}Em.TWITTER_SIGN_IN_METHOD="twitter.com";Em.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function m2e(r,t){return rR(r,"POST","/v1/accounts:signUp",Bm(r,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Z_{constructor(t){this.user=t.user,this.providerId=t.providerId,this._tokenResponse=t._tokenResponse,this.operationType=t.operationType}static async _fromIdTokenResponse(t,o,a,l=!1){const d=await Uf._fromIdTokenResponse(t,a,l),m=K7(a);return new Z_({user:d,providerId:m,_tokenResponse:a,operationType:o})}static async _forOperation(t,o,a){await t._updateTokensIfNecessary(a,!0);const l=K7(a);return new Z_({user:t,providerId:l,_tokenResponse:a,operationType:o})}}function K7(r){return r.providerId?r.providerId:"phoneNumber"in r?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WP extends Ph{constructor(t,o,a,l){var d;super(o.code,o.message),this.operationType=a,this.user=l,Object.setPrototypeOf(this,WP.prototype),this.customData={appName:t.name,tenantId:(d=t.tenantId)!==null&&d!==void 0?d:void 0,_serverResponse:o.customData._serverResponse,operationType:a}}static _fromErrorAndOperation(t,o,a,l){return new WP(t,o,a,l)}}function Tte(r,t,o,a){return(t==="reauthenticate"?o._getReauthenticationResolver(r):o._getIdTokenResponse(r)).catch(d=>{throw d.code==="auth/multi-factor-auth-required"?WP._fromErrorAndOperation(r,d,t,a):d})}async function g2e(r,t,o=!1){const a=await ww(r,t._linkToIdToken(r.auth,await r.getIdToken()),o);return Z_._forOperation(r,"link",a)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _2e(r,t,o=!1){const{auth:a}=r;if(ah(a.app))return Promise.reject(zf(a));const l="reauthenticate";try{const d=await ww(r,Tte(a,l,t,r),o);Ln(d.idToken,a,"internal-error");const m=mF(d.idToken);Ln(m,a,"internal-error");const{sub:v}=m;return Ln(r.uid===v,a,"user-mismatch"),Z_._forOperation(r,l,d)}catch(d){throw(d==null?void 0:d.code)==="auth/user-not-found"&&rd(a,"user-mismatch"),d}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function bte(r,t,o=!1){if(ah(r.app))return Promise.reject(zf(r));const a="signIn",l=await Tte(r,a,t),d=await Z_._fromIdTokenResponse(r,a,l);return o||await r._updateCurrentUser(d.user),d}async function v2e(r,t){return bte(cv(r),t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function wte(r){const t=cv(r);t._getPasswordPolicyInternal()&&await t._updatePasswordPolicy()}async function E2e(r,t,o){if(ah(r.app))return Promise.reject(zf(r));const a=cv(r),m=await _U(a,{returnSecureToken:!0,email:t,password:o,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",m2e).catch(y=>{throw y.code==="auth/password-does-not-meet-requirements"&&wte(r),y}),v=await Z_._fromIdTokenResponse(a,"signIn",m);return await a._updateCurrentUser(v.user),v}function y2e(r,t,o){return ah(r.app)?Promise.reject(zf(r)):v2e(to(r),PS.credential(t,o)).catch(async a=>{throw a.code==="auth/password-does-not-meet-requirements"&&wte(r),a})}function S2e(r,t,o,a){return to(r).onIdTokenChanged(t,o,a)}function T2e(r,t,o){return to(r).beforeAuthStateChanged(t,o)}function b2e(r,t,o,a){return to(r).onAuthStateChanged(t,o,a)}function w2e(r){return to(r).signOut()}const GP="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rte{constructor(t,o){this.storageRetriever=t,this.type=o}_isAvailable(){try{return this.storage?(this.storage.setItem(GP,"1"),this.storage.removeItem(GP),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(t,o){return this.storage.setItem(t,JSON.stringify(o)),Promise.resolve()}_get(t){const o=this.storage.getItem(t);return Promise.resolve(o?JSON.parse(o):null)}_remove(t){return this.storage.removeItem(t),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const R2e=1e3,C2e=10;class Cte extends Rte{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(t,o)=>this.onStorageEvent(t,o),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=_te(),this._shouldAllowMigration=!0}forAllChangedKeys(t){for(const o of Object.keys(this.listeners)){const a=this.storage.getItem(o),l=this.localCache[o];a!==l&&t(o,l,a)}}onStorageEvent(t,o=!1){if(!t.key){this.forAllChangedKeys((m,v,y)=>{this.notifyListeners(m,y)});return}const a=t.key;o?this.detachListener():this.stopPolling();const l=()=>{const m=this.storage.getItem(a);!o&&this.localCache[a]===m||this.notifyListeners(a,m)},d=this.storage.getItem(a);zMe()&&d!==t.newValue&&t.newValue!==t.oldValue?setTimeout(l,C2e):l()}notifyListeners(t,o){this.localCache[t]=o;const a=this.listeners[t];if(a)for(const l of Array.from(a))l(o&&JSON.parse(o))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((t,o,a)=>{this.onStorageEvent(new StorageEvent("storage",{key:t,oldValue:o,newValue:a}),!0)})},R2e)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(t,o){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[t]||(this.listeners[t]=new Set,this.localCache[t]=this.storage.getItem(t)),this.listeners[t].add(o)}_removeListener(t,o){this.listeners[t]&&(this.listeners[t].delete(o),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(t,o){await super._set(t,o),this.localCache[t]=JSON.stringify(o)}async _get(t){const o=await super._get(t);return this.localCache[t]=JSON.stringify(o),o}async _remove(t){await super._remove(t),delete this.localCache[t]}}Cte.type="LOCAL";const I2e=Cte;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ite extends Rte{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(t,o){}_removeListener(t,o){}}Ite.type="SESSION";const Ate=Ite;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function A2e(r){return Promise.all(r.map(async t=>{try{return{fulfilled:!0,value:await t}}catch(o){return{fulfilled:!1,reason:o}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VN{constructor(t){this.eventTarget=t,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){const o=this.receivers.find(l=>l.isListeningto(t));if(o)return o;const a=new VN(t);return this.receivers.push(a),a}isListeningto(t){return this.eventTarget===t}async handleEvent(t){const o=t,{eventId:a,eventType:l,data:d}=o.data,m=this.handlersMap[l];if(!(m!=null&&m.size))return;o.ports[0].postMessage({status:"ack",eventId:a,eventType:l});const v=Array.from(m).map(async b=>b(o.origin,d)),y=await A2e(v);o.ports[0].postMessage({status:"done",eventId:a,eventType:l,response:y})}_subscribe(t,o){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[t]||(this.handlersMap[t]=new Set),this.handlersMap[t].add(o)}_unsubscribe(t,o){this.handlersMap[t]&&o&&this.handlersMap[t].delete(o),(!o||this.handlersMap[t].size===0)&&delete this.handlersMap[t],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}VN.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function EF(r="",t=10){let o="";for(let a=0;a<t;a++)o+=Math.floor(Math.random()*10);return r+o}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class O2e{constructor(t){this.target=t,this.handlers=new Set}removeMessageHandler(t){t.messageChannel&&(t.messageChannel.port1.removeEventListener("message",t.onMessage),t.messageChannel.port1.close()),this.handlers.delete(t)}async _send(t,o,a=50){const l=typeof MessageChannel<"u"?new MessageChannel:null;if(!l)throw new Error("connection_unavailable");let d,m;return new Promise((v,y)=>{const b=EF("",20);l.port1.start();const R=setTimeout(()=>{y(new Error("unsupported_event"))},a);m={messageChannel:l,onMessage(O){const N=O;if(N.data.eventId===b)switch(N.data.status){case"ack":clearTimeout(R),d=setTimeout(()=>{y(new Error("timeout"))},3e3);break;case"done":clearTimeout(d),v(N.data.response);break;default:clearTimeout(R),clearTimeout(d),y(new Error("invalid_response"));break}}},this.handlers.add(m),l.port1.addEventListener("message",m.onMessage),this.target.postMessage({eventType:t,eventId:b,data:o},[l.port2])}).finally(()=>{m&&this.removeMessageHandler(m)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mh(){return window}function P2e(r){mh().location.href=r}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ote(){return typeof mh().WorkerGlobalScope<"u"&&typeof mh().importScripts=="function"}async function N2e(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function k2e(){var r;return((r=navigator==null?void 0:navigator.serviceWorker)===null||r===void 0?void 0:r.controller)||null}function D2e(){return Ote()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pte="firebaseLocalStorageDb",L2e=1,zP="firebaseLocalStorage",Nte="fbase_key";class oR{constructor(t){this.request=t}toPromise(){return new Promise((t,o)=>{this.request.addEventListener("success",()=>{t(this.request.result)}),this.request.addEventListener("error",()=>{o(this.request.error)})})}}function FN(r,t){return r.transaction([zP],t?"readwrite":"readonly").objectStore(zP)}function x2e(){const r=indexedDB.deleteDatabase(Pte);return new oR(r).toPromise()}function vU(){const r=indexedDB.open(Pte,L2e);return new Promise((t,o)=>{r.addEventListener("error",()=>{o(r.error)}),r.addEventListener("upgradeneeded",()=>{const a=r.result;try{a.createObjectStore(zP,{keyPath:Nte})}catch(l){o(l)}}),r.addEventListener("success",async()=>{const a=r.result;a.objectStoreNames.contains(zP)?t(a):(a.close(),await x2e(),t(await vU()))})})}async function $7(r,t,o){const a=FN(r,!0).put({[Nte]:t,value:o});return new oR(a).toPromise()}async function M2e(r,t){const o=FN(r,!1).get(t),a=await new oR(o).toPromise();return a===void 0?null:a.value}function q7(r,t){const o=FN(r,!0).delete(t);return new oR(o).toPromise()}const U2e=800,V2e=3;class kte{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await vU(),this.db)}async _withRetries(t){let o=0;for(;;)try{const a=await this._openDb();return await t(a)}catch(a){if(o++>V2e)throw a;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Ote()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=VN._getInstance(D2e()),this.receiver._subscribe("keyChanged",async(t,o)=>({keyProcessed:(await this._poll()).includes(o.key)})),this.receiver._subscribe("ping",async(t,o)=>["keyChanged"])}async initializeSender(){var t,o;if(this.activeServiceWorker=await N2e(),!this.activeServiceWorker)return;this.sender=new O2e(this.activeServiceWorker);const a=await this.sender._send("ping",{},800);a&&!((t=a[0])===null||t===void 0)&&t.fulfilled&&!((o=a[0])===null||o===void 0)&&o.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(t){if(!(!this.sender||!this.activeServiceWorker||k2e()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:t},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const t=await vU();return await $7(t,GP,"1"),await q7(t,GP),!0}catch{}return!1}async _withPendingWrite(t){this.pendingWrites++;try{await t()}finally{this.pendingWrites--}}async _set(t,o){return this._withPendingWrite(async()=>(await this._withRetries(a=>$7(a,t,o)),this.localCache[t]=o,this.notifyServiceWorker(t)))}async _get(t){const o=await this._withRetries(a=>M2e(a,t));return this.localCache[t]=o,o}async _remove(t){return this._withPendingWrite(async()=>(await this._withRetries(o=>q7(o,t)),delete this.localCache[t],this.notifyServiceWorker(t)))}async _poll(){const t=await this._withRetries(l=>{const d=FN(l,!1).getAll();return new oR(d).toPromise()});if(!t)return[];if(this.pendingWrites!==0)return[];const o=[],a=new Set;if(t.length!==0)for(const{fbase_key:l,value:d}of t)a.add(l),JSON.stringify(this.localCache[l])!==JSON.stringify(d)&&(this.notifyListeners(l,d),o.push(l));for(const l of Object.keys(this.localCache))this.localCache[l]&&!a.has(l)&&(this.notifyListeners(l,null),o.push(l));return o}notifyListeners(t,o){this.localCache[t]=o;const a=this.listeners[t];if(a)for(const l of Array.from(a))l(o)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),U2e)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(t,o){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[t]||(this.listeners[t]=new Set,this._get(t)),this.listeners[t].add(o)}_removeListener(t,o){this.listeners[t]&&(this.listeners[t].delete(o),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&this.stopPolling()}}kte.type="LOCAL";const F2e=kte;new nR(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function j2e(r,t){return t?Vf(t):(Ln(r._popupRedirectResolver,r,"argument-error"),r._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yF extends _F{constructor(t){super("custom","custom"),this.params=t}_getIdTokenResponse(t){return eS(t,this._buildIdpRequest())}_linkToIdToken(t,o){return eS(t,this._buildIdpRequest(o))}_getReauthenticationResolver(t){return eS(t,this._buildIdpRequest())}_buildIdpRequest(t){const o={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return t&&(o.idToken=t),o}}function B2e(r){return bte(r.auth,new yF(r),r.bypassAuthState)}function W2e(r){const{auth:t,user:o}=r;return Ln(o,t,"internal-error"),_2e(o,new yF(r),r.bypassAuthState)}async function G2e(r){const{auth:t,user:o}=r;return Ln(o,t,"internal-error"),g2e(o,new yF(r),r.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dte{constructor(t,o,a,l,d=!1){this.auth=t,this.resolver=a,this.user=l,this.bypassAuthState=d,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(o)?o:[o]}execute(){return new Promise(async(t,o)=>{this.pendingPromise={resolve:t,reject:o};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(a){this.reject(a)}})}async onAuthEvent(t){const{urlResponse:o,sessionId:a,postBody:l,tenantId:d,error:m,type:v}=t;if(m){this.reject(m);return}const y={auth:this.auth,requestUri:o,sessionId:a,tenantId:d||void 0,postBody:l||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(v)(y))}catch(b){this.reject(b)}}onError(t){this.reject(t)}getIdpTask(t){switch(t){case"signInViaPopup":case"signInViaRedirect":return B2e;case"linkViaPopup":case"linkViaRedirect":return G2e;case"reauthViaPopup":case"reauthViaRedirect":return W2e;default:rd(this.auth,"internal-error")}}resolve(t){Yf(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(t),this.unregisterAndCleanUp()}reject(t){Yf(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(t),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const z2e=new nR(2e3,1e4);class jy extends Dte{constructor(t,o,a,l,d){super(t,o,l,d),this.provider=a,this.authWindow=null,this.pollId=null,jy.currentPopupAction&&jy.currentPopupAction.cancel(),jy.currentPopupAction=this}async executeNotNull(){const t=await this.execute();return Ln(t,this.auth,"internal-error"),t}async onExecution(){Yf(this.filter.length===1,"Popup operations only handle one event");const t=EF();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],t),this.authWindow.associatedEvent=t,this.resolver._originValidation(this.auth).catch(o=>{this.reject(o)}),this.resolver._isIframeWebStorageSupported(this.auth,o=>{o||this.reject(ph(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var t;return((t=this.authWindow)===null||t===void 0?void 0:t.associatedEvent)||null}cancel(){this.reject(ph(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,jy.currentPopupAction=null}pollUserCancellation(){const t=()=>{var o,a;if(!((a=(o=this.authWindow)===null||o===void 0?void 0:o.window)===null||a===void 0)&&a.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(ph(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(t,z2e.get())};t()}}jy.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const H2e="pendingRedirect",dP=new Map;class K2e extends Dte{constructor(t,o,a=!1){super(t,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],o,void 0,a),this.eventId=null}async execute(){let t=dP.get(this.auth._key());if(!t){try{const a=await $2e(this.resolver,this.auth)?await super.execute():null;t=()=>Promise.resolve(a)}catch(o){t=()=>Promise.reject(o)}dP.set(this.auth._key(),t)}return this.bypassAuthState||dP.set(this.auth._key(),()=>Promise.resolve(null)),t()}async onAuthEvent(t){if(t.type==="signInViaRedirect")return super.onAuthEvent(t);if(t.type==="unknown"){this.resolve(null);return}if(t.eventId){const o=await this.auth._redirectUserForId(t.eventId);if(o)return this.user=o,super.onAuthEvent(t);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function $2e(r,t){const o=X2e(t),a=Y2e(r);if(!await a._isAvailable())return!1;const l=await a._get(o)==="true";return await a._remove(o),l}function q2e(r,t){dP.set(r._key(),t)}function Y2e(r){return Vf(r._redirectPersistence)}function X2e(r){return uP(H2e,r.config.apiKey,r.name)}async function J2e(r,t,o=!1){if(ah(r.app))return Promise.reject(zf(r));const a=cv(r),l=j2e(a,t),m=await new K2e(a,l,o).execute();return m&&!o&&(delete m.user._redirectEventId,await a._persistUserIfCurrent(m.user),await a._setRedirectUser(null,t)),m}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Q2e=10*60*1e3;class Z2e{constructor(t){this.auth=t,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(t){this.consumers.add(t),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,t)&&(this.sendToConsumer(this.queuedRedirectEvent,t),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(t){this.consumers.delete(t)}onEvent(t){if(this.hasEventBeenHandled(t))return!1;let o=!1;return this.consumers.forEach(a=>{this.isEventForConsumer(t,a)&&(o=!0,this.sendToConsumer(t,a),this.saveEventToCache(t))}),this.hasHandledPotentialRedirect||!eUe(t)||(this.hasHandledPotentialRedirect=!0,o||(this.queuedRedirectEvent=t,o=!0)),o}sendToConsumer(t,o){var a;if(t.error&&!Lte(t)){const l=((a=t.error.code)===null||a===void 0?void 0:a.split("auth/")[1])||"internal-error";o.onError(ph(this.auth,l))}else o.onAuthEvent(t)}isEventForConsumer(t,o){const a=o.eventId===null||!!t.eventId&&t.eventId===o.eventId;return o.filter.includes(t.type)&&a}hasEventBeenHandled(t){return Date.now()-this.lastProcessedEventTime>=Q2e&&this.cachedEventUids.clear(),this.cachedEventUids.has(Y7(t))}saveEventToCache(t){this.cachedEventUids.add(Y7(t)),this.lastProcessedEventTime=Date.now()}}function Y7(r){return[r.type,r.eventId,r.sessionId,r.tenantId].filter(t=>t).join("-")}function Lte({type:r,error:t}){return r==="unknown"&&(t==null?void 0:t.code)==="auth/no-auth-event"}function eUe(r){switch(r.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Lte(r);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function tUe(r,t={}){return Wm(r,"GET","/v1/projects",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nUe=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,rUe=/^https?/;async function iUe(r){if(r.config.emulator)return;const{authorizedDomains:t}=await tUe(r);for(const o of t)try{if(oUe(o))return}catch{}rd(r,"unauthorized-domain")}function oUe(r){const t=mU(),{protocol:o,hostname:a}=new URL(t);if(r.startsWith("chrome-extension://")){const m=new URL(r);return m.hostname===""&&a===""?o==="chrome-extension:"&&r.replace("chrome-extension://","")===t.replace("chrome-extension://",""):o==="chrome-extension:"&&m.hostname===a}if(!rUe.test(o))return!1;if(nUe.test(r))return a===r;const l=r.replace(/\./g,"\\.");return new RegExp("^(.+\\."+l+"|"+l+")$","i").test(a)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sUe=new nR(3e4,6e4);function X7(){const r=mh().___jsl;if(r!=null&&r.H){for(const t of Object.keys(r.H))if(r.H[t].r=r.H[t].r||[],r.H[t].L=r.H[t].L||[],r.H[t].r=[...r.H[t].L],r.CP)for(let o=0;o<r.CP.length;o++)r.CP[o]=null}}function aUe(r){return new Promise((t,o)=>{var a,l,d;function m(){X7(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{X7(),o(ph(r,"network-request-failed"))},timeout:sUe.get()})}if(!((l=(a=mh().gapi)===null||a===void 0?void 0:a.iframes)===null||l===void 0)&&l.Iframe)t(gapi.iframes.getContext());else if(!((d=mh().gapi)===null||d===void 0)&&d.load)m();else{const v=ZMe("iframefcb");return mh()[v]=()=>{gapi.load?m():o(ph(r,"network-request-failed"))},Ete(`${QMe()}?onload=${v}`).catch(y=>o(y))}}).catch(t=>{throw hP=null,t})}let hP=null;function cUe(r){return hP=hP||aUe(r),hP}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lUe=new nR(5e3,15e3),uUe="__/auth/iframe",dUe="emulator/auth/iframe",hUe={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},fUe=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function pUe(r){const t=r.config;Ln(t.authDomain,r,"auth-domain-config-required");const o=t.emulator?pF(t,dUe):`https://${r.config.authDomain}/${uUe}`,a={apiKey:t.apiKey,appName:r.name,v:av},l=fUe.get(r.config.apiHost);l&&(a.eid=l);const d=r._getFrameworks();return d.length&&(a.fw=d.join(",")),`${o}?${tR(a).slice(1)}`}async function mUe(r){const t=await cUe(r),o=mh().gapi;return Ln(o,r,"internal-error"),t.open({where:document.body,url:pUe(r),messageHandlersFilter:o.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:hUe,dontclear:!0},a=>new Promise(async(l,d)=>{await a.restyle({setHideOnLeave:!1});const m=ph(r,"network-request-failed"),v=mh().setTimeout(()=>{d(m)},lUe.get());function y(){mh().clearTimeout(v),l(a)}a.ping(y).then(y,()=>{d(m)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gUe={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},_Ue=500,vUe=600,EUe="_blank",yUe="http://localhost";class J7{constructor(t){this.window=t,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function SUe(r,t,o,a=_Ue,l=vUe){const d=Math.max((window.screen.availHeight-l)/2,0).toString(),m=Math.max((window.screen.availWidth-a)/2,0).toString();let v="";const y=Object.assign(Object.assign({},gUe),{width:a.toString(),height:l.toString(),top:d,left:m}),b=ba().toLowerCase();o&&(v=hte(b)?EUe:o),ute(b)&&(t=t||yUe,y.scrollbars="yes");const R=Object.entries(y).reduce((N,[F,H])=>`${N}${F}=${H},`,"");if(GMe(b)&&v!=="_self")return TUe(t||"",v),new J7(null);const O=window.open(t||"",v,R);Ln(O,r,"popup-blocked");try{O.focus()}catch{}return new J7(O)}function TUe(r,t){const o=document.createElement("a");o.href=r,o.target=t;const a=document.createEvent("MouseEvent");a.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),o.dispatchEvent(a)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bUe="__/auth/handler",wUe="emulator/auth/handler",RUe=encodeURIComponent("fac");async function Q7(r,t,o,a,l,d){Ln(r.config.authDomain,r,"auth-domain-config-required"),Ln(r.config.apiKey,r,"invalid-api-key");const m={apiKey:r.config.apiKey,appName:r.name,authType:o,redirectUrl:a,v:av,eventId:l};if(t instanceof Ste){t.setDefaultLanguage(r.languageCode),m.providerId=t.providerId||"",fxe(t.getCustomParameters())||(m.customParameters=JSON.stringify(t.getCustomParameters()));for(const[R,O]of Object.entries({}))m[R]=O}if(t instanceof iR){const R=t.getScopes().filter(O=>O!=="");R.length>0&&(m.scopes=R.join(","))}r.tenantId&&(m.tid=r.tenantId);const v=m;for(const R of Object.keys(v))v[R]===void 0&&delete v[R];const y=await r._getAppCheckToken(),b=y?`#${RUe}=${encodeURIComponent(y)}`:"";return`${CUe(r)}?${tR(v).slice(1)}${b}`}function CUe({config:r}){return r.emulator?pF(r,wUe):`https://${r.authDomain}/${bUe}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XM="webStorageSupport";class IUe{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Ate,this._completeRedirectFn=J2e,this._overrideRedirectResult=q2e}async _openPopup(t,o,a,l){var d;Yf((d=this.eventManagers[t._key()])===null||d===void 0?void 0:d.manager,"_initialize() not called before _openPopup()");const m=await Q7(t,o,a,mU(),l);return SUe(t,m,EF())}async _openRedirect(t,o,a,l){await this._originValidation(t);const d=await Q7(t,o,a,mU(),l);return P2e(d),new Promise(()=>{})}_initialize(t){const o=t._key();if(this.eventManagers[o]){const{manager:l,promise:d}=this.eventManagers[o];return l?Promise.resolve(l):(Yf(d,"If manager is not set, promise should be"),d)}const a=this.initAndGetManager(t);return this.eventManagers[o]={promise:a},a.catch(()=>{delete this.eventManagers[o]}),a}async initAndGetManager(t){const o=await mUe(t),a=new Z2e(t);return o.register("authEvent",l=>(Ln(l==null?void 0:l.authEvent,t,"invalid-auth-event"),{status:a.onEvent(l.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[t._key()]={manager:a},this.iframes[t._key()]=o,a}_isIframeWebStorageSupported(t,o){this.iframes[t._key()].send(XM,{type:XM},l=>{var d;const m=(d=l==null?void 0:l[0])===null||d===void 0?void 0:d[XM];m!==void 0&&o(!!m),rd(t,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(t){const o=t._key();return this.originValidationPromises[o]||(this.originValidationPromises[o]=iUe(t)),this.originValidationPromises[o]}get _shouldInitProactively(){return _te()||dte()||gF()}}const AUe=IUe;var Z7="@firebase/auth",eY="1.7.9";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OUe{constructor(t){this.auth=t,this.internalListeners=new Map}getUid(){var t;return this.assertAuthConfigured(),((t=this.auth.currentUser)===null||t===void 0?void 0:t.uid)||null}async getToken(t){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(t)}:null}addAuthTokenListener(t){if(this.assertAuthConfigured(),this.internalListeners.has(t))return;const o=this.auth.onIdTokenChanged(a=>{t((a==null?void 0:a.stsTokenManager.accessToken)||null)});this.internalListeners.set(t,o),this.updateProactiveRefresh()}removeAuthTokenListener(t){this.assertAuthConfigured();const o=this.internalListeners.get(t);o&&(this.internalListeners.delete(t),o(),this.updateProactiveRefresh())}assertAuthConfigured(){Ln(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function PUe(r){switch(r){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function NUe(r){J_(new km("auth",(t,{options:o})=>{const a=t.getProvider("app").getImmediate(),l=t.getProvider("heartbeat"),d=t.getProvider("app-check-internal"),{apiKey:m,authDomain:v}=a.options;Ln(m&&!m.includes(":"),"invalid-api-key",{appName:a.name});const y={apiKey:m,authDomain:v,clientPlatform:r,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:vte(r)},b=new YMe(a,l,d,y);return i2e(b,o),b},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((t,o,a)=>{t.getProvider("auth-internal").initialize()})),J_(new km("auth-internal",t=>{const o=cv(t.getProvider("auth").getImmediate());return(a=>new OUe(a))(o)},"PRIVATE").setInstantiationMode("EXPLICIT")),fh(Z7,eY,PUe(r)),fh(Z7,eY,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kUe=5*60,DUe=qee("authIdTokenMaxAge")||kUe;let tY=null;const LUe=r=>async t=>{const o=t&&await t.getIdTokenResult(),a=o&&(new Date().getTime()-Date.parse(o.issuedAtTime))/1e3;if(a&&a>DUe)return;const l=o==null?void 0:o.token;tY!==l&&(tY=l,await fetch(r,{method:l?"POST":"DELETE",headers:l?{Authorization:`Bearer ${l}`}:{}}))};function xte(r=hF()){const t=MN(r,"auth");if(t.isInitialized())return t.getImmediate();const o=r2e(r,{popupRedirectResolver:AUe,persistence:[F2e,I2e,Ate]}),a=qee("authTokenSyncURL");if(a&&typeof isSecureContext=="boolean"&&isSecureContext){const d=new URL(a,location.origin);if(location.origin===d.origin){const m=LUe(d.toString());T2e(o,m,()=>m(o.currentUser)),S2e(o,v=>m(v))}}const l=Hee("auth");return l&&o2e(o,`http://${l}`),o}function xUe(){var r,t;return(t=(r=document.getElementsByTagName("head"))===null||r===void 0?void 0:r[0])!==null&&t!==void 0?t:document}XMe({loadJS(r){return new Promise((t,o)=>{const a=document.createElement("script");a.setAttribute("src",r),a.onload=t,a.onerror=l=>{const d=ph("internal-error");d.customData=l,o(d)},a.type="text/javascript",a.charset="UTF-8",xUe().appendChild(a)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});NUe("Browser");var nY=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var z_,Mte;(function(){var r;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function t(Q,te){function re(){}re.prototype=te.prototype,Q.D=te.prototype,Q.prototype=new re,Q.prototype.constructor=Q,Q.C=function(le,ve,fe){for(var de=Array(arguments.length-2),lt=2;lt<arguments.length;lt++)de[lt-2]=arguments[lt];return te.prototype[ve].apply(le,de)}}function o(){this.blockSize=-1}function a(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}t(a,o),a.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function l(Q,te,re){re||(re=0);var le=Array(16);if(typeof te=="string")for(var ve=0;16>ve;++ve)le[ve]=te.charCodeAt(re++)|te.charCodeAt(re++)<<8|te.charCodeAt(re++)<<16|te.charCodeAt(re++)<<24;else for(ve=0;16>ve;++ve)le[ve]=te[re++]|te[re++]<<8|te[re++]<<16|te[re++]<<24;te=Q.g[0],re=Q.g[1],ve=Q.g[2];var fe=Q.g[3],de=te+(fe^re&(ve^fe))+le[0]+3614090360&4294967295;te=re+(de<<7&4294967295|de>>>25),de=fe+(ve^te&(re^ve))+le[1]+3905402710&4294967295,fe=te+(de<<12&4294967295|de>>>20),de=ve+(re^fe&(te^re))+le[2]+606105819&4294967295,ve=fe+(de<<17&4294967295|de>>>15),de=re+(te^ve&(fe^te))+le[3]+3250441966&4294967295,re=ve+(de<<22&4294967295|de>>>10),de=te+(fe^re&(ve^fe))+le[4]+4118548399&4294967295,te=re+(de<<7&4294967295|de>>>25),de=fe+(ve^te&(re^ve))+le[5]+1200080426&4294967295,fe=te+(de<<12&4294967295|de>>>20),de=ve+(re^fe&(te^re))+le[6]+2821735955&4294967295,ve=fe+(de<<17&4294967295|de>>>15),de=re+(te^ve&(fe^te))+le[7]+4249261313&4294967295,re=ve+(de<<22&4294967295|de>>>10),de=te+(fe^re&(ve^fe))+le[8]+1770035416&4294967295,te=re+(de<<7&4294967295|de>>>25),de=fe+(ve^te&(re^ve))+le[9]+2336552879&4294967295,fe=te+(de<<12&4294967295|de>>>20),de=ve+(re^fe&(te^re))+le[10]+4294925233&4294967295,ve=fe+(de<<17&4294967295|de>>>15),de=re+(te^ve&(fe^te))+le[11]+2304563134&4294967295,re=ve+(de<<22&4294967295|de>>>10),de=te+(fe^re&(ve^fe))+le[12]+1804603682&4294967295,te=re+(de<<7&4294967295|de>>>25),de=fe+(ve^te&(re^ve))+le[13]+4254626195&4294967295,fe=te+(de<<12&4294967295|de>>>20),de=ve+(re^fe&(te^re))+le[14]+2792965006&4294967295,ve=fe+(de<<17&4294967295|de>>>15),de=re+(te^ve&(fe^te))+le[15]+1236535329&4294967295,re=ve+(de<<22&4294967295|de>>>10),de=te+(ve^fe&(re^ve))+le[1]+4129170786&4294967295,te=re+(de<<5&4294967295|de>>>27),de=fe+(re^ve&(te^re))+le[6]+3225465664&4294967295,fe=te+(de<<9&4294967295|de>>>23),de=ve+(te^re&(fe^te))+le[11]+643717713&4294967295,ve=fe+(de<<14&4294967295|de>>>18),de=re+(fe^te&(ve^fe))+le[0]+3921069994&4294967295,re=ve+(de<<20&4294967295|de>>>12),de=te+(ve^fe&(re^ve))+le[5]+3593408605&4294967295,te=re+(de<<5&4294967295|de>>>27),de=fe+(re^ve&(te^re))+le[10]+38016083&4294967295,fe=te+(de<<9&4294967295|de>>>23),de=ve+(te^re&(fe^te))+le[15]+3634488961&4294967295,ve=fe+(de<<14&4294967295|de>>>18),de=re+(fe^te&(ve^fe))+le[4]+3889429448&4294967295,re=ve+(de<<20&4294967295|de>>>12),de=te+(ve^fe&(re^ve))+le[9]+568446438&4294967295,te=re+(de<<5&4294967295|de>>>27),de=fe+(re^ve&(te^re))+le[14]+3275163606&4294967295,fe=te+(de<<9&4294967295|de>>>23),de=ve+(te^re&(fe^te))+le[3]+4107603335&4294967295,ve=fe+(de<<14&4294967295|de>>>18),de=re+(fe^te&(ve^fe))+le[8]+1163531501&4294967295,re=ve+(de<<20&4294967295|de>>>12),de=te+(ve^fe&(re^ve))+le[13]+2850285829&4294967295,te=re+(de<<5&4294967295|de>>>27),de=fe+(re^ve&(te^re))+le[2]+4243563512&4294967295,fe=te+(de<<9&4294967295|de>>>23),de=ve+(te^re&(fe^te))+le[7]+1735328473&4294967295,ve=fe+(de<<14&4294967295|de>>>18),de=re+(fe^te&(ve^fe))+le[12]+2368359562&4294967295,re=ve+(de<<20&4294967295|de>>>12),de=te+(re^ve^fe)+le[5]+4294588738&4294967295,te=re+(de<<4&4294967295|de>>>28),de=fe+(te^re^ve)+le[8]+2272392833&4294967295,fe=te+(de<<11&4294967295|de>>>21),de=ve+(fe^te^re)+le[11]+1839030562&4294967295,ve=fe+(de<<16&4294967295|de>>>16),de=re+(ve^fe^te)+le[14]+4259657740&4294967295,re=ve+(de<<23&4294967295|de>>>9),de=te+(re^ve^fe)+le[1]+2763975236&4294967295,te=re+(de<<4&4294967295|de>>>28),de=fe+(te^re^ve)+le[4]+1272893353&4294967295,fe=te+(de<<11&4294967295|de>>>21),de=ve+(fe^te^re)+le[7]+4139469664&4294967295,ve=fe+(de<<16&4294967295|de>>>16),de=re+(ve^fe^te)+le[10]+3200236656&4294967295,re=ve+(de<<23&4294967295|de>>>9),de=te+(re^ve^fe)+le[13]+681279174&4294967295,te=re+(de<<4&4294967295|de>>>28),de=fe+(te^re^ve)+le[0]+3936430074&4294967295,fe=te+(de<<11&4294967295|de>>>21),de=ve+(fe^te^re)+le[3]+3572445317&4294967295,ve=fe+(de<<16&4294967295|de>>>16),de=re+(ve^fe^te)+le[6]+76029189&4294967295,re=ve+(de<<23&4294967295|de>>>9),de=te+(re^ve^fe)+le[9]+3654602809&4294967295,te=re+(de<<4&4294967295|de>>>28),de=fe+(te^re^ve)+le[12]+3873151461&4294967295,fe=te+(de<<11&4294967295|de>>>21),de=ve+(fe^te^re)+le[15]+530742520&4294967295,ve=fe+(de<<16&4294967295|de>>>16),de=re+(ve^fe^te)+le[2]+3299628645&4294967295,re=ve+(de<<23&4294967295|de>>>9),de=te+(ve^(re|~fe))+le[0]+4096336452&4294967295,te=re+(de<<6&4294967295|de>>>26),de=fe+(re^(te|~ve))+le[7]+1126891415&4294967295,fe=te+(de<<10&4294967295|de>>>22),de=ve+(te^(fe|~re))+le[14]+2878612391&4294967295,ve=fe+(de<<15&4294967295|de>>>17),de=re+(fe^(ve|~te))+le[5]+4237533241&4294967295,re=ve+(de<<21&4294967295|de>>>11),de=te+(ve^(re|~fe))+le[12]+1700485571&4294967295,te=re+(de<<6&4294967295|de>>>26),de=fe+(re^(te|~ve))+le[3]+2399980690&4294967295,fe=te+(de<<10&4294967295|de>>>22),de=ve+(te^(fe|~re))+le[10]+4293915773&4294967295,ve=fe+(de<<15&4294967295|de>>>17),de=re+(fe^(ve|~te))+le[1]+2240044497&4294967295,re=ve+(de<<21&4294967295|de>>>11),de=te+(ve^(re|~fe))+le[8]+1873313359&4294967295,te=re+(de<<6&4294967295|de>>>26),de=fe+(re^(te|~ve))+le[15]+4264355552&4294967295,fe=te+(de<<10&4294967295|de>>>22),de=ve+(te^(fe|~re))+le[6]+2734768916&4294967295,ve=fe+(de<<15&4294967295|de>>>17),de=re+(fe^(ve|~te))+le[13]+1309151649&4294967295,re=ve+(de<<21&4294967295|de>>>11),de=te+(ve^(re|~fe))+le[4]+4149444226&4294967295,te=re+(de<<6&4294967295|de>>>26),de=fe+(re^(te|~ve))+le[11]+3174756917&4294967295,fe=te+(de<<10&4294967295|de>>>22),de=ve+(te^(fe|~re))+le[2]+718787259&4294967295,ve=fe+(de<<15&4294967295|de>>>17),de=re+(fe^(ve|~te))+le[9]+3951481745&4294967295,Q.g[0]=Q.g[0]+te&4294967295,Q.g[1]=Q.g[1]+(ve+(de<<21&4294967295|de>>>11))&4294967295,Q.g[2]=Q.g[2]+ve&4294967295,Q.g[3]=Q.g[3]+fe&4294967295}a.prototype.u=function(Q,te){te===void 0&&(te=Q.length);for(var re=te-this.blockSize,le=this.B,ve=this.h,fe=0;fe<te;){if(ve==0)for(;fe<=re;)l(this,Q,fe),fe+=this.blockSize;if(typeof Q=="string"){for(;fe<te;)if(le[ve++]=Q.charCodeAt(fe++),ve==this.blockSize){l(this,le),ve=0;break}}else for(;fe<te;)if(le[ve++]=Q[fe++],ve==this.blockSize){l(this,le),ve=0;break}}this.h=ve,this.o+=te},a.prototype.v=function(){var Q=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);Q[0]=128;for(var te=1;te<Q.length-8;++te)Q[te]=0;var re=8*this.o;for(te=Q.length-8;te<Q.length;++te)Q[te]=re&255,re/=256;for(this.u(Q),Q=Array(16),te=re=0;4>te;++te)for(var le=0;32>le;le+=8)Q[re++]=this.g[te]>>>le&255;return Q};function d(Q,te){var re=v;return Object.prototype.hasOwnProperty.call(re,Q)?re[Q]:re[Q]=te(Q)}function m(Q,te){this.h=te;for(var re=[],le=!0,ve=Q.length-1;0<=ve;ve--){var fe=Q[ve]|0;le&&fe==te||(re[ve]=fe,le=!1)}this.g=re}var v={};function y(Q){return-128<=Q&&128>Q?d(Q,function(te){return new m([te|0],0>te?-1:0)}):new m([Q|0],0>Q?-1:0)}function b(Q){if(isNaN(Q)||!isFinite(Q))return O;if(0>Q)return z(b(-Q));for(var te=[],re=1,le=0;Q>=re;le++)te[le]=Q/re|0,re*=4294967296;return new m(te,0)}function R(Q,te){if(Q.length==0)throw Error("number format error: empty string");if(te=te||10,2>te||36<te)throw Error("radix out of range: "+te);if(Q.charAt(0)=="-")return z(R(Q.substring(1),te));if(0<=Q.indexOf("-"))throw Error('number format error: interior "-" character');for(var re=b(Math.pow(te,8)),le=O,ve=0;ve<Q.length;ve+=8){var fe=Math.min(8,Q.length-ve),de=parseInt(Q.substring(ve,ve+fe),te);8>fe?(fe=b(Math.pow(te,fe)),le=le.j(fe).add(b(de))):(le=le.j(re),le=le.add(b(de)))}return le}var O=y(0),N=y(1),F=y(16777216);r=m.prototype,r.m=function(){if(G(this))return-z(this).m();for(var Q=0,te=1,re=0;re<this.g.length;re++){var le=this.i(re);Q+=(0<=le?le:4294967296+le)*te,te*=4294967296}return Q},r.toString=function(Q){if(Q=Q||10,2>Q||36<Q)throw Error("radix out of range: "+Q);if(H(this))return"0";if(G(this))return"-"+z(this).toString(Q);for(var te=b(Math.pow(Q,6)),re=this,le="";;){var ve=se(re,te).g;re=ne(re,ve.j(te));var fe=((0<re.g.length?re.g[0]:re.h)>>>0).toString(Q);if(re=ve,H(re))return fe+le;for(;6>fe.length;)fe="0"+fe;le=fe+le}},r.i=function(Q){return 0>Q?0:Q<this.g.length?this.g[Q]:this.h};function H(Q){if(Q.h!=0)return!1;for(var te=0;te<Q.g.length;te++)if(Q.g[te]!=0)return!1;return!0}function G(Q){return Q.h==-1}r.l=function(Q){return Q=ne(this,Q),G(Q)?-1:H(Q)?0:1};function z(Q){for(var te=Q.g.length,re=[],le=0;le<te;le++)re[le]=~Q.g[le];return new m(re,~Q.h).add(N)}r.abs=function(){return G(this)?z(this):this},r.add=function(Q){for(var te=Math.max(this.g.length,Q.g.length),re=[],le=0,ve=0;ve<=te;ve++){var fe=le+(this.i(ve)&65535)+(Q.i(ve)&65535),de=(fe>>>16)+(this.i(ve)>>>16)+(Q.i(ve)>>>16);le=de>>>16,fe&=65535,de&=65535,re[ve]=de<<16|fe}return new m(re,re[re.length-1]&-2147483648?-1:0)};function ne(Q,te){return Q.add(z(te))}r.j=function(Q){if(H(this)||H(Q))return O;if(G(this))return G(Q)?z(this).j(z(Q)):z(z(this).j(Q));if(G(Q))return z(this.j(z(Q)));if(0>this.l(F)&&0>Q.l(F))return b(this.m()*Q.m());for(var te=this.g.length+Q.g.length,re=[],le=0;le<2*te;le++)re[le]=0;for(le=0;le<this.g.length;le++)for(var ve=0;ve<Q.g.length;ve++){var fe=this.i(le)>>>16,de=this.i(le)&65535,lt=Q.i(ve)>>>16,ft=Q.i(ve)&65535;re[2*le+2*ve]+=de*ft,J(re,2*le+2*ve),re[2*le+2*ve+1]+=fe*ft,J(re,2*le+2*ve+1),re[2*le+2*ve+1]+=de*lt,J(re,2*le+2*ve+1),re[2*le+2*ve+2]+=fe*lt,J(re,2*le+2*ve+2)}for(le=0;le<te;le++)re[le]=re[2*le+1]<<16|re[2*le];for(le=te;le<2*te;le++)re[le]=0;return new m(re,0)};function J(Q,te){for(;(Q[te]&65535)!=Q[te];)Q[te+1]+=Q[te]>>>16,Q[te]&=65535,te++}function oe(Q,te){this.g=Q,this.h=te}function se(Q,te){if(H(te))throw Error("division by zero");if(H(Q))return new oe(O,O);if(G(Q))return te=se(z(Q),te),new oe(z(te.g),z(te.h));if(G(te))return te=se(Q,z(te)),new oe(z(te.g),te.h);if(30<Q.g.length){if(G(Q)||G(te))throw Error("slowDivide_ only works with positive integers.");for(var re=N,le=te;0>=le.l(Q);)re=ae(re),le=ae(le);var ve=ye(re,1),fe=ye(le,1);for(le=ye(le,2),re=ye(re,2);!H(le);){var de=fe.add(le);0>=de.l(Q)&&(ve=ve.add(re),fe=de),le=ye(le,1),re=ye(re,1)}return te=ne(Q,ve.j(te)),new oe(ve,te)}for(ve=O;0<=Q.l(te);){for(re=Math.max(1,Math.floor(Q.m()/te.m())),le=Math.ceil(Math.log(re)/Math.LN2),le=48>=le?1:Math.pow(2,le-48),fe=b(re),de=fe.j(te);G(de)||0<de.l(Q);)re-=le,fe=b(re),de=fe.j(te);H(fe)&&(fe=N),ve=ve.add(fe),Q=ne(Q,de)}return new oe(ve,Q)}r.A=function(Q){return se(this,Q).h},r.and=function(Q){for(var te=Math.max(this.g.length,Q.g.length),re=[],le=0;le<te;le++)re[le]=this.i(le)&Q.i(le);return new m(re,this.h&Q.h)},r.or=function(Q){for(var te=Math.max(this.g.length,Q.g.length),re=[],le=0;le<te;le++)re[le]=this.i(le)|Q.i(le);return new m(re,this.h|Q.h)},r.xor=function(Q){for(var te=Math.max(this.g.length,Q.g.length),re=[],le=0;le<te;le++)re[le]=this.i(le)^Q.i(le);return new m(re,this.h^Q.h)};function ae(Q){for(var te=Q.g.length+1,re=[],le=0;le<te;le++)re[le]=Q.i(le)<<1|Q.i(le-1)>>>31;return new m(re,Q.h)}function ye(Q,te){var re=te>>5;te%=32;for(var le=Q.g.length-re,ve=[],fe=0;fe<le;fe++)ve[fe]=0<te?Q.i(fe+re)>>>te|Q.i(fe+re+1)<<32-te:Q.i(fe+re);return new m(ve,Q.h)}a.prototype.digest=a.prototype.v,a.prototype.reset=a.prototype.s,a.prototype.update=a.prototype.u,Mte=a,m.prototype.add=m.prototype.add,m.prototype.multiply=m.prototype.j,m.prototype.modulo=m.prototype.A,m.prototype.compare=m.prototype.l,m.prototype.toNumber=m.prototype.m,m.prototype.toString=m.prototype.toString,m.prototype.getBits=m.prototype.i,m.fromNumber=b,m.fromString=R,z_=m}).apply(typeof nY<"u"?nY:typeof self<"u"?self:typeof window<"u"?window:{});var OO=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Ute,Nb,Vte,fP,EU,Fte,jte,Bte;(function(){var r,t=typeof Object.defineProperties=="function"?Object.defineProperty:function(C,j,X){return C==Array.prototype||C==Object.prototype||(C[j]=X.value),C};function o(C){C=[typeof globalThis=="object"&&globalThis,C,typeof window=="object"&&window,typeof self=="object"&&self,typeof OO=="object"&&OO];for(var j=0;j<C.length;++j){var X=C[j];if(X&&X.Math==Math)return X}throw Error("Cannot find global object")}var a=o(this);function l(C,j){if(j)e:{var X=a;C=C.split(".");for(var he=0;he<C.length-1;he++){var Me=C[he];if(!(Me in X))break e;X=X[Me]}C=C[C.length-1],he=X[C],j=j(he),j!=he&&j!=null&&t(X,C,{configurable:!0,writable:!0,value:j})}}function d(C,j){C instanceof String&&(C+="");var X=0,he=!1,Me={next:function(){if(!he&&X<C.length){var qe=X++;return{value:j(qe,C[qe]),done:!1}}return he=!0,{done:!0,value:void 0}}};return Me[Symbol.iterator]=function(){return Me},Me}l("Array.prototype.values",function(C){return C||function(){return d(this,function(j,X){return X})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var m=m||{},v=this||self;function y(C){var j=typeof C;return j=j!="object"?j:C?Array.isArray(C)?"array":j:"null",j=="array"||j=="object"&&typeof C.length=="number"}function b(C){var j=typeof C;return j=="object"&&C!=null||j=="function"}function R(C,j,X){return C.call.apply(C.bind,arguments)}function O(C,j,X){if(!C)throw Error();if(2<arguments.length){var he=Array.prototype.slice.call(arguments,2);return function(){var Me=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(Me,he),C.apply(j,Me)}}return function(){return C.apply(j,arguments)}}function N(C,j,X){return N=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?R:O,N.apply(null,arguments)}function F(C,j){var X=Array.prototype.slice.call(arguments,1);return function(){var he=X.slice();return he.push.apply(he,arguments),C.apply(this,he)}}function H(C,j){function X(){}X.prototype=j.prototype,C.aa=j.prototype,C.prototype=new X,C.prototype.constructor=C,C.Qb=function(he,Me,qe){for(var At=Array(arguments.length-2),Gr=2;Gr<arguments.length;Gr++)At[Gr-2]=arguments[Gr];return j.prototype[Me].apply(he,At)}}function G(C){const j=C.length;if(0<j){const X=Array(j);for(let he=0;he<j;he++)X[he]=C[he];return X}return[]}function z(C,j){for(let X=1;X<arguments.length;X++){const he=arguments[X];if(y(he)){const Me=C.length||0,qe=he.length||0;C.length=Me+qe;for(let At=0;At<qe;At++)C[Me+At]=he[At]}else C.push(he)}}class ne{constructor(j,X){this.i=j,this.j=X,this.h=0,this.g=null}get(){let j;return 0<this.h?(this.h--,j=this.g,this.g=j.next,j.next=null):j=this.i(),j}}function J(C){return/^[\s\xa0]*$/.test(C)}function oe(){var C=v.navigator;return C&&(C=C.userAgent)?C:""}function se(C){return se[" "](C),C}se[" "]=function(){};var ae=oe().indexOf("Gecko")!=-1&&!(oe().toLowerCase().indexOf("webkit")!=-1&&oe().indexOf("Edge")==-1)&&!(oe().indexOf("Trident")!=-1||oe().indexOf("MSIE")!=-1)&&oe().indexOf("Edge")==-1;function ye(C,j,X){for(const he in C)j.call(X,C[he],he,C)}function Q(C,j){for(const X in C)j.call(void 0,C[X],X,C)}function te(C){const j={};for(const X in C)j[X]=C[X];return j}const re="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function le(C,j){let X,he;for(let Me=1;Me<arguments.length;Me++){he=arguments[Me];for(X in he)C[X]=he[X];for(let qe=0;qe<re.length;qe++)X=re[qe],Object.prototype.hasOwnProperty.call(he,X)&&(C[X]=he[X])}}function ve(C){var j=1;C=C.split(":");const X=[];for(;0<j&&C.length;)X.push(C.shift()),j--;return C.length&&X.push(C.join(":")),X}function fe(C){v.setTimeout(()=>{throw C},0)}function de(){var C=nt;let j=null;return C.g&&(j=C.g,C.g=C.g.next,C.g||(C.h=null),j.next=null),j}class lt{constructor(){this.h=this.g=null}add(j,X){const he=ft.get();he.set(j,X),this.h?this.h.next=he:this.g=he,this.h=he}}var ft=new ne(()=>new Xe,C=>C.reset());class Xe{constructor(){this.next=this.g=this.h=null}set(j,X){this.h=j,this.g=X,this.next=null}reset(){this.next=this.g=this.h=null}}let Le,Ke=!1,nt=new lt,Ee=()=>{const C=v.Promise.resolve(void 0);Le=()=>{C.then(Ye)}};var Ye=()=>{for(var C;C=de();){try{C.h.call(C.g)}catch(X){fe(X)}var j=ft;j.j(C),100>j.h&&(j.h++,C.next=j.g,j.g=C)}Ke=!1};function yt(){this.s=this.s,this.C=this.C}yt.prototype.s=!1,yt.prototype.ma=function(){this.s||(this.s=!0,this.N())},yt.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function at(C,j){this.type=C,this.g=this.target=j,this.defaultPrevented=!1}at.prototype.h=function(){this.defaultPrevented=!0};var Fe=function(){if(!v.addEventListener||!Object.defineProperty)return!1;var C=!1,j=Object.defineProperty({},"passive",{get:function(){C=!0}});try{const X=()=>{};v.addEventListener("test",X,j),v.removeEventListener("test",X,j)}catch{}return C}();function et(C,j){if(at.call(this,C?C.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,C){var X=this.type=C.type,he=C.changedTouches&&C.changedTouches.length?C.changedTouches[0]:null;if(this.target=C.target||C.srcElement,this.g=j,j=C.relatedTarget){if(ae){e:{try{se(j.nodeName);var Me=!0;break e}catch{}Me=!1}Me||(j=null)}}else X=="mouseover"?j=C.fromElement:X=="mouseout"&&(j=C.toElement);this.relatedTarget=j,he?(this.clientX=he.clientX!==void 0?he.clientX:he.pageX,this.clientY=he.clientY!==void 0?he.clientY:he.pageY,this.screenX=he.screenX||0,this.screenY=he.screenY||0):(this.clientX=C.clientX!==void 0?C.clientX:C.pageX,this.clientY=C.clientY!==void 0?C.clientY:C.pageY,this.screenX=C.screenX||0,this.screenY=C.screenY||0),this.button=C.button,this.key=C.key||"",this.ctrlKey=C.ctrlKey,this.altKey=C.altKey,this.shiftKey=C.shiftKey,this.metaKey=C.metaKey,this.pointerId=C.pointerId||0,this.pointerType=typeof C.pointerType=="string"?C.pointerType:_t[C.pointerType]||"",this.state=C.state,this.i=C,C.defaultPrevented&&et.aa.h.call(this)}}H(et,at);var _t={2:"touch",3:"pen",4:"mouse"};et.prototype.h=function(){et.aa.h.call(this);var C=this.i;C.preventDefault?C.preventDefault():C.returnValue=!1};var Dt="closure_listenable_"+(1e6*Math.random()|0),Ht=0;function Wt(C,j,X,he,Me){this.listener=C,this.proxy=null,this.src=j,this.type=X,this.capture=!!he,this.ha=Me,this.key=++Ht,this.da=this.fa=!1}function Fn(C){C.da=!0,C.listener=null,C.proxy=null,C.src=null,C.ha=null}function xn(C){this.src=C,this.g={},this.h=0}xn.prototype.add=function(C,j,X,he,Me){var qe=C.toString();C=this.g[qe],C||(C=this.g[qe]=[],this.h++);var At=gr(C,j,he,Me);return-1<At?(j=C[At],X||(j.fa=!1)):(j=new Wt(j,this.src,qe,!!he,Me),j.fa=X,C.push(j)),j};function hn(C,j){var X=j.type;if(X in C.g){var he=C.g[X],Me=Array.prototype.indexOf.call(he,j,void 0),qe;(qe=0<=Me)&&Array.prototype.splice.call(he,Me,1),qe&&(Fn(j),C.g[X].length==0&&(delete C.g[X],C.h--))}}function gr(C,j,X,he){for(var Me=0;Me<C.length;++Me){var qe=C[Me];if(!qe.da&&qe.listener==j&&qe.capture==!!X&&qe.ha==he)return Me}return-1}var Ar="closure_lm_"+(1e6*Math.random()|0),bt={};function bn(C,j,X,he,Me){if(Array.isArray(j)){for(var qe=0;qe<j.length;qe++)bn(C,j[qe],X,he,Me);return null}return X=jn(X),C&&C[Dt]?C.K(j,X,b(he)?!!he.capture:!1,Me):wn(C,j,X,!1,he,Me)}function wn(C,j,X,he,Me,qe){if(!j)throw Error("Invalid event type");var At=b(Me)?!!Me.capture:!!Me,Gr=ht(C);if(Gr||(C[Ar]=Gr=new xn(C)),X=Gr.add(j,X,he,At,qe),X.proxy)return X;if(he=we(),X.proxy=he,he.src=C,he.listener=X,C.addEventListener)Fe||(Me=At),Me===void 0&&(Me=!1),C.addEventListener(j.toString(),he,Me);else if(C.attachEvent)C.attachEvent(mt(j.toString()),he);else if(C.addListener&&C.removeListener)C.addListener(he);else throw Error("addEventListener and attachEvent are unavailable.");return X}function we(){function C(X){return j.call(C.src,C.listener,X)}const j=gt;return C}function De(C,j,X,he,Me){if(Array.isArray(j))for(var qe=0;qe<j.length;qe++)De(C,j[qe],X,he,Me);else he=b(he)?!!he.capture:!!he,X=jn(X),C&&C[Dt]?(C=C.i,j=String(j).toString(),j in C.g&&(qe=C.g[j],X=gr(qe,X,he,Me),-1<X&&(Fn(qe[X]),Array.prototype.splice.call(qe,X,1),qe.length==0&&(delete C.g[j],C.h--)))):C&&(C=ht(C))&&(j=C.g[j.toString()],C=-1,j&&(C=gr(j,X,he,Me)),(X=-1<C?j[C]:null)&&We(X))}function We(C){if(typeof C!="number"&&C&&!C.da){var j=C.src;if(j&&j[Dt])hn(j.i,C);else{var X=C.type,he=C.proxy;j.removeEventListener?j.removeEventListener(X,he,C.capture):j.detachEvent?j.detachEvent(mt(X),he):j.addListener&&j.removeListener&&j.removeListener(he),(X=ht(j))?(hn(X,C),X.h==0&&(X.src=null,j[Ar]=null)):Fn(C)}}}function mt(C){return C in bt?bt[C]:bt[C]="on"+C}function gt(C,j){if(C.da)C=!0;else{j=new et(j,this);var X=C.listener,he=C.ha||C.src;C.fa&&We(C),C=X.call(he,j)}return C}function ht(C){return C=C[Ar],C instanceof xn?C:null}var Mt="__closure_events_fn_"+(1e9*Math.random()>>>0);function jn(C){return typeof C=="function"?C:(C[Mt]||(C[Mt]=function(j){return C.handleEvent(j)}),C[Mt])}function On(){yt.call(this),this.i=new xn(this),this.M=this,this.F=null}H(On,yt),On.prototype[Dt]=!0,On.prototype.removeEventListener=function(C,j,X,he){De(this,C,j,X,he)};function nn(C,j){var X,he=C.F;if(he)for(X=[];he;he=he.F)X.push(he);if(C=C.M,he=j.type||j,typeof j=="string")j=new at(j,C);else if(j instanceof at)j.target=j.target||C;else{var Me=j;j=new at(he,C),le(j,Me)}if(Me=!0,X)for(var qe=X.length-1;0<=qe;qe--){var At=j.g=X[qe];Me=_r(At,he,!0,j)&&Me}if(At=j.g=C,Me=_r(At,he,!0,j)&&Me,Me=_r(At,he,!1,j)&&Me,X)for(qe=0;qe<X.length;qe++)At=j.g=X[qe],Me=_r(At,he,!1,j)&&Me}On.prototype.N=function(){if(On.aa.N.call(this),this.i){var C=this.i,j;for(j in C.g){for(var X=C.g[j],he=0;he<X.length;he++)Fn(X[he]);delete C.g[j],C.h--}}this.F=null},On.prototype.K=function(C,j,X,he){return this.i.add(String(C),j,!1,X,he)},On.prototype.L=function(C,j,X,he){return this.i.add(String(C),j,!0,X,he)};function _r(C,j,X,he){if(j=C.i.g[String(j)],!j)return!0;j=j.concat();for(var Me=!0,qe=0;qe<j.length;++qe){var At=j[qe];if(At&&!At.da&&At.capture==X){var Gr=At.listener,ti=At.ha||At.src;At.fa&&hn(C.i,At),Me=Gr.call(ti,he)!==!1&&Me}}return Me&&!he.defaultPrevented}function Ra(C,j,X){if(typeof C=="function")X&&(C=N(C,X));else if(C&&typeof C.handleEvent=="function")C=N(C.handleEvent,C);else throw Error("Invalid listener argument");return 2147483647<Number(j)?-1:v.setTimeout(C,j||0)}function _o(C){C.g=Ra(()=>{C.g=null,C.i&&(C.i=!1,_o(C))},C.l);const j=C.h;C.h=null,C.m.apply(null,j)}class ns extends yt{constructor(j,X){super(),this.m=j,this.l=X,this.h=null,this.i=!1,this.g=null}j(j){this.h=arguments,this.g?this.i=!0:_o(this)}N(){super.N(),this.g&&(v.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Lt(C){yt.call(this),this.h=C,this.g={}}H(Lt,yt);var fn=[];function rs(C){ye(C.g,function(j,X){this.g.hasOwnProperty(X)&&We(j)},C),C.g={}}Lt.prototype.N=function(){Lt.aa.N.call(this),rs(this)},Lt.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var or=v.JSON.stringify,$i=v.JSON.parse,Mc=class{stringify(C){return v.JSON.stringify(C,void 0)}parse(C){return v.JSON.parse(C,void 0)}};function $a(){}$a.prototype.h=null;function _s(C){return C.h||(C.h=C.i())}function qa(){}var Ui={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Po(){at.call(this,"d")}H(Po,at);function Ys(){at.call(this,"c")}H(Ys,at);var Ya={},Uc=null;function lu(){return Uc=Uc||new On}Ya.La="serverreachability";function Xa(C){at.call(this,Ya.La,C)}H(Xa,at);function Vc(C){const j=lu();nn(j,new Xa(j))}Ya.STAT_EVENT="statevent";function vs(C,j){at.call(this,Ya.STAT_EVENT,C),this.stat=j}H(vs,at);function Ci(C){const j=lu();nn(j,new vs(j,C))}Ya.Ma="timingevent";function ro(C,j){at.call(this,Ya.Ma,C),this.size=j}H(ro,at);function Ca(C,j){if(typeof C!="function")throw Error("Fn must not be null and must be a function");return v.setTimeout(function(){C()},j)}function uu(){this.g=!0}uu.prototype.xa=function(){this.g=!1};function Ja(C,j,X,he,Me,qe){C.info(function(){if(C.g)if(qe)for(var At="",Gr=qe.split("&"),ti=0;ti<Gr.length;ti++){var fr=Gr[ti].split("=");if(1<fr.length){var ko=fr[0];fr=fr[1];var oo=ko.split("_");At=2<=oo.length&&oo[1]=="type"?At+(ko+"="+fr+"&"):At+(ko+"=redacted&")}}else At=null;else At=qe;return"XMLHTTP REQ ("+he+") [attempt "+Me+"]: "+j+`
`+X+`
`+At})}function Xs(C,j,X,he,Me,qe,At){C.info(function(){return"XMLHTTP RESP ("+he+") [ attempt "+Me+"]: "+j+`
`+X+`
`+qe+" "+At})}function Js(C,j,X,he){C.info(function(){return"XMLHTTP TEXT ("+j+"): "+Hm(C,X)+(he?" "+he:"")})}function sd(C,j){C.info(function(){return"TIMEOUT: "+j})}uu.prototype.info=function(){};function Hm(C,j){if(!C.g)return j;if(!j)return null;try{var X=JSON.parse(j);if(X){for(C=0;C<X.length;C++)if(Array.isArray(X[C])){var he=X[C];if(!(2>he.length)){var Me=he[1];if(Array.isArray(Me)&&!(1>Me.length)){var qe=Me[0];if(qe!="noop"&&qe!="stop"&&qe!="close")for(var At=1;At<Me.length;At++)Me[At]=""}}}}return or(X)}catch{return j}}var du={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Nh={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},No;function hu(){}H(hu,$a),hu.prototype.g=function(){return new XMLHttpRequest},hu.prototype.i=function(){return{}},No=new hu;function Qs(C,j,X,he){this.j=C,this.i=j,this.l=X,this.R=he||1,this.U=new Lt(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new ad}function ad(){this.i=null,this.g="",this.h=!1}var cd={},Ia={};function ld(C,j,X){C.L=1,C.v=Oa(ys(j)),C.m=X,C.P=!0,fu(C,null)}function fu(C,j){C.F=Date.now(),Ur(C),C.A=ys(C.v);var X=C.A,he=C.R;Array.isArray(he)||(he=[String(he)]),Tl(X.i,"t",he),C.C=0,X=C.j.J,C.h=new ad,C.g=fv(C.j,X?j:null,!C.m),0<C.O&&(C.M=new ns(N(C.Y,C,C.g),C.O)),j=C.U,X=C.g,he=C.ca;var Me="readystatechange";Array.isArray(Me)||(Me&&(fn[0]=Me.toString()),Me=fn);for(var qe=0;qe<Me.length;qe++){var At=bn(X,Me[qe],he||j.handleEvent,!1,j.h||j);if(!At)break;j.g[At.key]=At}j=C.H?te(C.H):{},C.m?(C.u||(C.u="POST"),j["Content-Type"]="application/x-www-form-urlencoded",C.g.ea(C.A,C.u,C.m,j)):(C.u="GET",C.g.ea(C.A,C.u,null,j)),Vc(),Ja(C.i,C.u,C.A,C.l,C.R,C.m)}Qs.prototype.ca=function(C){C=C.target;const j=this.M;j&&di(C)==3?j.j():this.Y(C)},Qs.prototype.Y=function(C){try{if(C==this.g)e:{const oo=di(this.g);var j=this.g.Ba();const Pa=this.g.Z();if(!(3>oo)&&(oo!=3||this.g&&(this.h.h||this.g.oa()||vo(this.g)))){this.J||oo!=4||j==7||(j==8||0>=Pa?Vc(3):Vc(2)),Qa(this);var X=this.g.Z();this.X=X;t:if(Es(this)){var he=vo(this.g);C="";var Me=he.length,qe=di(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Zs(this),Fc(this);var At="";break t}this.h.i=new v.TextDecoder}for(j=0;j<Me;j++)this.h.h=!0,C+=this.h.i.decode(he[j],{stream:!(qe&&j==Me-1)});he.length=0,this.h.g+=C,this.C=0,At=this.h.g}else At=this.g.oa();if(this.o=X==200,Xs(this.i,this.u,this.A,this.l,this.R,oo,X),this.o){if(this.T&&!this.K){t:{if(this.g){var Gr,ti=this.g;if((Gr=ti.g?ti.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!J(Gr)){var fr=Gr;break t}}fr=null}if(X=fr)Js(this.i,this.l,X,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,kh(this,X);else{this.o=!1,this.s=3,Ci(12),Zs(this),Fc(this);break e}}if(this.P){X=!0;let Ps;for(;!this.J&&this.C<At.length;)if(Ps=ud(this,At),Ps==Ia){oo==4&&(this.s=4,Ci(14),X=!1),Js(this.i,this.l,null,"[Incomplete Response]");break}else if(Ps==cd){this.s=4,Ci(15),Js(this.i,this.l,At,"[Invalid Chunk]"),X=!1;break}else Js(this.i,this.l,Ps,null),kh(this,Ps);if(Es(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),oo!=4||At.length!=0||this.h.h||(this.s=1,Ci(16),X=!1),this.o=this.o&&X,!X)Js(this.i,this.l,At,"[Invalid Chunked Response]"),Zs(this),Fc(this);else if(0<At.length&&!this.W){this.W=!0;var ko=this.j;ko.g==this&&ko.ba&&!ko.M&&(ko.j.info("Great, no buffering proxy detected. Bytes received: "+At.length),$m(ko),ko.M=!0,Ci(11))}}else Js(this.i,this.l,At,null),kh(this,At);oo==4&&Zs(this),this.o&&!this.J&&(oo==4?lp(this.j,this):(this.o=!1,Ur(this)))}else Cs(this.g),X==400&&0<At.indexOf("Unknown SID")?(this.s=3,Ci(12)):(this.s=0,Ci(13)),Zs(this),Fc(this)}}}catch{}finally{}};function Es(C){return C.g?C.u=="GET"&&C.L!=2&&C.j.Ca:!1}function ud(C,j){var X=C.C,he=j.indexOf(`
`,X);return he==-1?Ia:(X=Number(j.substring(X,he)),isNaN(X)?cd:(he+=1,he+X>j.length?Ia:(j=j.slice(he,he+X),C.C=he+X,j)))}Qs.prototype.cancel=function(){this.J=!0,Zs(this)};function Ur(C){C.S=Date.now()+C.I,ui(C,C.I)}function ui(C,j){if(C.B!=null)throw Error("WatchDog timer not null");C.B=Ca(N(C.ba,C),j)}function Qa(C){C.B&&(v.clearTimeout(C.B),C.B=null)}Qs.prototype.ba=function(){this.B=null;const C=Date.now();0<=C-this.S?(sd(this.i,this.A),this.L!=2&&(Vc(),Ci(17)),Zs(this),this.s=2,Fc(this)):ui(this,this.S-C)};function Fc(C){C.j.G==0||C.J||lp(C.j,C)}function Zs(C){Qa(C);var j=C.M;j&&typeof j.ma=="function"&&j.ma(),C.M=null,rs(C.U),C.g&&(j=C.g,C.g=null,j.abort(),j.ma())}function kh(C,j){try{var X=C.j;if(X.G!=0&&(X.g==C||Wo(X.h,C))){if(!C.K&&Wo(X.h,C)&&X.G==3){try{var he=X.Da.g.parse(j)}catch{he=null}if(Array.isArray(he)&&he.length==3){var Me=he;if(Me[0]==0){e:if(!X.u){if(X.g)if(X.g.F+3e3<C.F)cp(X),zc(X);else break e;ap(X),Ci(18)}}else X.za=Me[1],0<X.za-X.T&&37500>Me[2]&&X.F&&X.v==0&&!X.C&&(X.C=Ca(N(X.Za,X),6e3));if(1>=tp(X.h)&&X.ca){try{X.ca()}catch{}X.ca=void 0}}else yu(X,11)}else if((C.K||X.g==C)&&cp(X),!J(j))for(Me=X.Da.g.parse(j),j=0;j<Me.length;j++){let fr=Me[j];if(X.T=fr[0],fr=fr[1],X.G==2)if(fr[0]=="c"){X.K=fr[1],X.ia=fr[2];const ko=fr[3];ko!=null&&(X.la=ko,X.j.info("VER="+X.la));const oo=fr[4];oo!=null&&(X.Aa=oo,X.j.info("SVER="+X.Aa));const Pa=fr[5];Pa!=null&&typeof Pa=="number"&&0<Pa&&(he=1.5*Pa,X.L=he,X.j.info("backChannelRequestTimeoutMs_="+he)),he=X;const Ps=C.g;if(Ps){const Uh=Ps.g?Ps.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Uh){var qe=he.h;qe.g||Uh.indexOf("spdy")==-1&&Uh.indexOf("quic")==-1&&Uh.indexOf("h2")==-1||(qe.j=qe.l,qe.g=new Set,qe.h&&(Dh(qe,qe.h),qe.h=null))}if(he.D){const dp=Ps.g?Ps.g.getResponseHeader("X-HTTP-Session-Id"):null;dp&&(he.ya=dp,Wr(he.I,he.D,dp))}}X.G=3,X.l&&X.l.ua(),X.ba&&(X.R=Date.now()-C.F,X.j.info("Handshake RTT: "+X.R+"ms")),he=X;var At=C;if(he.qa=qm(he,he.J?he.ia:null,he.W),At.K){jc(he.h,At);var Gr=At,ti=he.L;ti&&(Gr.I=ti),Gr.B&&(Qa(Gr),Ur(Gr)),he.g=At}else wl(he);0<X.i.length&&tc(X)}else fr[0]!="stop"&&fr[0]!="close"||yu(X,7);else X.G==3&&(fr[0]=="stop"||fr[0]=="close"?fr[0]=="stop"?yu(X,7):Vi(X):fr[0]!="noop"&&X.l&&X.l.ta(fr),X.v=0)}}Vc(4)}catch{}}var dd=class{constructor(C,j){this.g=C,this.map=j}};function _l(C){this.l=C||10,v.PerformanceNavigationTiming?(C=v.performance.getEntriesByType("navigation"),C=0<C.length&&(C[0].nextHopProtocol=="hq"||C[0].nextHopProtocol=="h2")):C=!!(v.chrome&&v.chrome.loadTimes&&v.chrome.loadTimes()&&v.chrome.loadTimes().wasFetchedViaSpdy),this.j=C?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function is(C){return C.h?!0:C.g?C.g.size>=C.j:!1}function tp(C){return C.h?1:C.g?C.g.size:0}function Wo(C,j){return C.h?C.h==j:C.g?C.g.has(j):!1}function Dh(C,j){C.g?C.g.add(j):C.h=j}function jc(C,j){C.h&&C.h==j?C.h=null:C.g&&C.g.has(j)&&C.g.delete(j)}_l.prototype.cancel=function(){if(this.i=hd(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const C of this.g.values())C.cancel();this.g.clear()}};function hd(C){if(C.h!=null)return C.i.concat(C.h.D);if(C.g!=null&&C.g.size!==0){let j=C.i;for(const X of C.g.values())j=j.concat(X.D);return j}return G(C.i)}function fd(C){if(C.V&&typeof C.V=="function")return C.V();if(typeof Map<"u"&&C instanceof Map||typeof Set<"u"&&C instanceof Set)return Array.from(C.values());if(typeof C=="string")return C.split("");if(y(C)){for(var j=[],X=C.length,he=0;he<X;he++)j.push(C[he]);return j}j=[],X=0;for(he in C)j[X++]=C[he];return j}function sr(C){if(C.na&&typeof C.na=="function")return C.na();if(!C.V||typeof C.V!="function"){if(typeof Map<"u"&&C instanceof Map)return Array.from(C.keys());if(!(typeof Set<"u"&&C instanceof Set)){if(y(C)||typeof C=="string"){var j=[];C=C.length;for(var X=0;X<C;X++)j.push(X);return j}j=[],X=0;for(const he in C)j[X++]=he;return j}}}function vl(C,j){if(C.forEach&&typeof C.forEach=="function")C.forEach(j,void 0);else if(y(C)||typeof C=="string")Array.prototype.forEach.call(C,j,void 0);else for(var X=sr(C),he=fd(C),Me=he.length,qe=0;qe<Me;qe++)j.call(void 0,he[qe],X&&X[qe],C)}var El=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function pu(C,j){if(C){C=C.split("&");for(var X=0;X<C.length;X++){var he=C[X].indexOf("="),Me=null;if(0<=he){var qe=C[X].substring(0,he);Me=C[X].substring(he+1)}else qe=C[X];j(qe,Me?decodeURIComponent(Me.replace(/\+/g," ")):"")}}}function Aa(C){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,C instanceof Aa){this.h=C.h,mu(this,C.j),this.o=C.o,this.g=C.g,Bc(this,C.s),this.l=C.l;var j=C.i,X=new Ss;X.i=j.i,j.g&&(X.g=new Map(j.g),X.h=j.h),yl(this,X),this.m=C.m}else C&&(j=String(C).match(El))?(this.h=!1,mu(this,j[1]||"",!0),this.o=Jn(j[2]||""),this.g=Jn(j[3]||"",!0),Bc(this,j[4]),this.l=Jn(j[5]||"",!0),yl(this,j[6]||"",!0),this.m=Jn(j[7]||"")):(this.h=!1,this.i=new Ss(null,this.h))}Aa.prototype.toString=function(){var C=[],j=this.j;j&&C.push(Za(j,Sl,!0),":");var X=this.g;return(X||j=="file")&&(C.push("//"),(j=this.o)&&C.push(Za(j,Sl,!0),"@"),C.push(encodeURIComponent(String(X)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),X=this.s,X!=null&&C.push(":",String(X))),(X=this.l)&&(this.g&&X.charAt(0)!="/"&&C.push("/"),C.push(Za(X,X.charAt(0)=="/"?Lh:pd,!0))),(X=this.i.toString())&&C.push("?",X),(X=this.m)&&C.push("#",Za(X,xh)),C.join("")};function ys(C){return new Aa(C)}function mu(C,j,X){C.j=X?Jn(j,!0):j,C.j&&(C.j=C.j.replace(/:$/,""))}function Bc(C,j){if(j){if(j=Number(j),isNaN(j)||0>j)throw Error("Bad port number "+j);C.s=j}else C.s=null}function yl(C,j,X){j instanceof Ss?(C.i=j,Rs(C.i,C.h)):(X||(j=Za(j,rp)),C.i=new Ss(j,C.h))}function Wr(C,j,X){C.i.set(j,X)}function Oa(C){return Wr(C,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),C}function Jn(C,j){return C?j?decodeURI(C.replace(/%25/g,"%2525")):decodeURIComponent(C):""}function Za(C,j,X){return typeof C=="string"?(C=encodeURI(C).replace(j,np),X&&(C=C.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),C):null}function np(C){return C=C.charCodeAt(0),"%"+(C>>4&15).toString(16)+(C&15).toString(16)}var Sl=/[#\/\?@]/g,pd=/[#\?:]/g,Lh=/[#\?]/g,rp=/[#\?@]/g,xh=/#/g;function Ss(C,j){this.h=this.g=null,this.i=C||null,this.j=!!j}function qi(C){C.g||(C.g=new Map,C.h=0,C.i&&pu(C.i,function(j,X){C.add(decodeURIComponent(j.replace(/\+/g," ")),X)}))}r=Ss.prototype,r.add=function(C,j){qi(this),this.i=null,C=ws(this,C);var X=this.g.get(C);return X||this.g.set(C,X=[]),X.push(j),this.h+=1,this};function Ts(C,j){qi(C),j=ws(C,j),C.g.has(j)&&(C.i=null,C.h-=C.g.get(j).length,C.g.delete(j))}function bs(C,j){return qi(C),j=ws(C,j),C.g.has(j)}r.forEach=function(C,j){qi(this),this.g.forEach(function(X,he){X.forEach(function(Me){C.call(j,Me,he,this)},this)},this)},r.na=function(){qi(this);const C=Array.from(this.g.values()),j=Array.from(this.g.keys()),X=[];for(let he=0;he<j.length;he++){const Me=C[he];for(let qe=0;qe<Me.length;qe++)X.push(j[he])}return X},r.V=function(C){qi(this);let j=[];if(typeof C=="string")bs(this,C)&&(j=j.concat(this.g.get(ws(this,C))));else{C=Array.from(this.g.values());for(let X=0;X<C.length;X++)j=j.concat(C[X])}return j},r.set=function(C,j){return qi(this),this.i=null,C=ws(this,C),bs(this,C)&&(this.h-=this.g.get(C).length),this.g.set(C,[j]),this.h+=1,this},r.get=function(C,j){return C?(C=this.V(C),0<C.length?String(C[0]):j):j};function Tl(C,j,X){Ts(C,j),0<X.length&&(C.i=null,C.g.set(ws(C,j),G(X)),C.h+=X.length)}r.toString=function(){if(this.i)return this.i;if(!this.g)return"";const C=[],j=Array.from(this.g.keys());for(var X=0;X<j.length;X++){var he=j[X];const qe=encodeURIComponent(String(he)),At=this.V(he);for(he=0;he<At.length;he++){var Me=qe;At[he]!==""&&(Me+="="+encodeURIComponent(String(At[he]))),C.push(Me)}}return this.i=C.join("&")};function ws(C,j){return j=String(j),C.j&&(j=j.toLowerCase()),j}function Rs(C,j){j&&!C.j&&(qi(C),C.i=null,C.g.forEach(function(X,he){var Me=he.toLowerCase();he!=Me&&(Ts(this,he),Tl(this,Me,X))},C)),C.j=j}function ip(C,j){const X=new uu;if(v.Image){const he=new Image;he.onload=F(io,X,"TestLoadImage: loaded",!0,j,he),he.onerror=F(io,X,"TestLoadImage: error",!1,j,he),he.onabort=F(io,X,"TestLoadImage: abort",!1,j,he),he.ontimeout=F(io,X,"TestLoadImage: timeout",!1,j,he),v.setTimeout(function(){he.ontimeout&&he.ontimeout()},1e4),he.src=C}else j(!1)}function ec(C,j){const X=new uu,he=new AbortController,Me=setTimeout(()=>{he.abort(),io(X,"TestPingServer: timeout",!1,j)},1e4);fetch(C,{signal:he.signal}).then(qe=>{clearTimeout(Me),qe.ok?io(X,"TestPingServer: ok",!0,j):io(X,"TestPingServer: server error",!1,j)}).catch(()=>{clearTimeout(Me),io(X,"TestPingServer: error",!1,j)})}function io(C,j,X,he,Me){try{Me&&(Me.onload=null,Me.onerror=null,Me.onabort=null,Me.ontimeout=null),he(X)}catch{}}function gu(){this.g=new Mc}function Mh(C,j,X){const he=X||"";try{vl(C,function(Me,qe){let At=Me;b(Me)&&(At=or(Me)),j.push(he+qe+"="+encodeURIComponent(At))})}catch(Me){throw j.push(he+"type="+encodeURIComponent("_badmap")),Me}}function Wc(C){this.l=C.Ub||null,this.j=C.eb||!1}H(Wc,$a),Wc.prototype.g=function(){return new bl(this.l,this.j)},Wc.prototype.i=function(C){return function(){return C}}({});function bl(C,j){On.call(this),this.D=C,this.o=j,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}H(bl,On),r=bl.prototype,r.open=function(C,j){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=C,this.A=j,this.readyState=1,ta(this)},r.send=function(C){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const j={headers:this.u,method:this.B,credentials:this.m,cache:void 0};C&&(j.body=C),(this.D||v).fetch(new Request(this.A,j)).then(this.Sa.bind(this),this.ga.bind(this))},r.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,ea(this)),this.readyState=0},r.Sa=function(C){if(this.g&&(this.l=C,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=C.headers,this.readyState=2,ta(this)),this.g&&(this.readyState=3,ta(this),this.g)))if(this.responseType==="arraybuffer")C.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof v.ReadableStream<"u"&&"body"in C){if(this.j=C.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;op(this)}else C.text().then(this.Ra.bind(this),this.ga.bind(this))};function op(C){C.j.read().then(C.Pa.bind(C)).catch(C.ga.bind(C))}r.Pa=function(C){if(this.g){if(this.o&&C.value)this.response.push(C.value);else if(!this.o){var j=C.value?C.value:new Uint8Array(0);(j=this.v.decode(j,{stream:!C.done}))&&(this.response=this.responseText+=j)}C.done?ea(this):ta(this),this.readyState==3&&op(this)}},r.Ra=function(C){this.g&&(this.response=this.responseText=C,ea(this))},r.Qa=function(C){this.g&&(this.response=C,ea(this))},r.ga=function(){this.g&&ea(this)};function ea(C){C.readyState=4,C.l=null,C.j=null,C.v=null,ta(C)}r.setRequestHeader=function(C,j){this.u.append(C,j)},r.getResponseHeader=function(C){return this.h&&this.h.get(C.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";const C=[],j=this.h.entries();for(var X=j.next();!X.done;)X=X.value,C.push(X[0]+": "+X[1]),X=j.next();return C.join(`\r
`)};function ta(C){C.onreadystatechange&&C.onreadystatechange.call(C)}Object.defineProperty(bl.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(C){this.m=C?"include":"same-origin"}});function Gc(C){let j="";return ye(C,function(X,he){j+=he,j+=":",j+=X,j+=`\r
`}),j}function _e(C,j,X){e:{for(he in X){var he=!1;break e}he=!0}he||(X=Gc(X),typeof C=="string"?X!=null&&encodeURIComponent(String(X)):Wr(C,j,X))}function Ce(C){On.call(this),this.headers=new Map,this.o=C||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}H(Ce,On);var Ge=/^https?$/i,Bt=["POST","PUT"];r=Ce.prototype,r.Ha=function(C){this.J=C},r.ea=function(C,j,X,he){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+C);j=j?j.toUpperCase():"GET",this.D=C,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():No.g(),this.v=this.o?_s(this.o):_s(No),this.g.onreadystatechange=N(this.Ea,this);try{this.B=!0,this.g.open(j,String(C),!0),this.B=!1}catch(qe){Wn(this,qe);return}if(C=X||"",X=new Map(this.headers),he)if(Object.getPrototypeOf(he)===Object.prototype)for(var Me in he)X.set(Me,he[Me]);else if(typeof he.keys=="function"&&typeof he.get=="function")for(const qe of he.keys())X.set(qe,he.get(qe));else throw Error("Unknown input type for opt_headers: "+String(he));he=Array.from(X.keys()).find(qe=>qe.toLowerCase()=="content-type"),Me=v.FormData&&C instanceof v.FormData,!(0<=Array.prototype.indexOf.call(Bt,j,void 0))||he||Me||X.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[qe,At]of X)this.g.setRequestHeader(qe,At);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Or(this),this.u=!0,this.g.send(C),this.u=!1}catch(qe){Wn(this,qe)}};function Wn(C,j){C.h=!1,C.g&&(C.j=!0,C.g.abort(),C.j=!1),C.l=j,C.m=5,hr(C),Qt(C)}function hr(C){C.A||(C.A=!0,nn(C,"complete"),nn(C,"error"))}r.abort=function(C){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=C||7,nn(this,"complete"),nn(this,"abort"),Qt(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Qt(this,!0)),Ce.aa.N.call(this)},r.Ea=function(){this.s||(this.B||this.u||this.j?Vr(this):this.bb())},r.bb=function(){Vr(this)};function Vr(C){if(C.h&&typeof m<"u"&&(!C.v[1]||di(C)!=4||C.Z()!=2)){if(C.u&&di(C)==4)Ra(C.Ea,0,C);else if(nn(C,"readystatechange"),di(C)==4){C.h=!1;try{const At=C.Z();e:switch(At){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var j=!0;break e;default:j=!1}var X;if(!(X=j)){var he;if(he=At===0){var Me=String(C.D).match(El)[1]||null;!Me&&v.self&&v.self.location&&(Me=v.self.location.protocol.slice(0,-1)),he=!Ge.test(Me?Me.toLowerCase():"")}X=he}if(X)nn(C,"complete"),nn(C,"success");else{C.m=6;try{var qe=2<di(C)?C.g.statusText:""}catch{qe=""}C.l=qe+" ["+C.Z()+"]",hr(C)}}finally{Qt(C)}}}}function Qt(C,j){if(C.g){Or(C);const X=C.g,he=C.v[0]?()=>{}:null;C.g=null,C.v=null,j||nn(C,"ready");try{X.onreadystatechange=he}catch{}}}function Or(C){C.I&&(v.clearTimeout(C.I),C.I=null)}r.isActive=function(){return!!this.g};function di(C){return C.g?C.g.readyState:0}r.Z=function(){try{return 2<di(this)?this.g.status:-1}catch{return-1}},r.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},r.Oa=function(C){if(this.g){var j=this.g.responseText;return C&&j.indexOf(C)==0&&(j=j.substring(C.length)),$i(j)}};function vo(C){try{if(!C.g)return null;if("response"in C.g)return C.g.response;switch(C.H){case"":case"text":return C.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in C.g)return C.g.mozResponseArrayBuffer}return null}catch{return null}}function Cs(C){const j={};C=(C.g&&2<=di(C)&&C.g.getAllResponseHeaders()||"").split(`\r
`);for(let he=0;he<C.length;he++){if(J(C[he]))continue;var X=ve(C[he]);const Me=X[0];if(X=X[1],typeof X!="string")continue;X=X.trim();const qe=j[Me]||[];j[Me]=qe,qe.push(X)}Q(j,function(he){return he.join(", ")})}r.Ba=function(){return this.m},r.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Is(C,j,X){return X&&X.internalChannelParams&&X.internalChannelParams[C]||j}function _u(C){this.Aa=0,this.i=[],this.j=new uu,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Is("failFast",!1,C),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Is("baseRetryDelayMs",5e3,C),this.cb=Is("retryDelaySeedMs",1e4,C),this.Wa=Is("forwardChannelMaxRetries",2,C),this.wa=Is("forwardChannelRequestTimeoutMs",2e4,C),this.pa=C&&C.xmlHttpFactory||void 0,this.Xa=C&&C.Tb||void 0,this.Ca=C&&C.useFetchStreams||!1,this.L=void 0,this.J=C&&C.supportsCrossDomainXhr||!1,this.K="",this.h=new _l(C&&C.concurrentRequestLimit),this.Da=new gu,this.P=C&&C.fastHandshake||!1,this.O=C&&C.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=C&&C.Rb||!1,C&&C.xa&&this.j.xa(),C&&C.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&C&&C.detectBufferingProxy||!1,this.ja=void 0,C&&C.longPollingTimeout&&0<C.longPollingTimeout&&(this.ja=C.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}r=_u.prototype,r.la=8,r.G=1,r.connect=function(C,j,X,he){Ci(0),this.W=C,this.H=j||{},X&&he!==void 0&&(this.H.OSID=X,this.H.OAID=he),this.F=this.X,this.I=qm(this,null,this.W),tc(this)};function Vi(C){if(md(C),C.G==3){var j=C.U++,X=ys(C.I);if(Wr(X,"SID",C.K),Wr(X,"RID",j),Wr(X,"TYPE","terminate"),vu(C,X),j=new Qs(C,C.j,j),j.L=2,j.v=Oa(ys(X)),X=!1,v.navigator&&v.navigator.sendBeacon)try{X=v.navigator.sendBeacon(j.v.toString(),"")}catch{}!X&&v.Image&&(new Image().src=j.v,X=!0),X||(j.g=fv(j.j,null),j.g.ea(j.v)),j.F=Date.now(),Ur(j)}Su(C)}function zc(C){C.g&&($m(C),C.g.cancel(),C.g=null)}function md(C){zc(C),C.u&&(v.clearTimeout(C.u),C.u=null),cp(C),C.h.cancel(),C.s&&(typeof C.s=="number"&&v.clearTimeout(C.s),C.s=null)}function tc(C){if(!is(C.h)&&!C.s){C.s=!0;var j=C.Ga;Le||Ee(),Ke||(Le(),Ke=!0),nt.add(j,C),C.B=0}}function Km(C,j){return tp(C.h)>=C.h.j-(C.s?1:0)?!1:C.s?(C.i=j.D.concat(C.i),!0):C.G==1||C.G==2||C.B>=(C.Va?0:C.Wa)?!1:(C.s=Ca(N(C.Ga,C,j),Eu(C,C.B)),C.B++,!0)}r.Ga=function(C){if(this.s)if(this.s=null,this.G==1){if(!C){this.U=Math.floor(1e5*Math.random()),C=this.U++;const Me=new Qs(this,this.j,C);let qe=this.o;if(this.S&&(qe?(qe=te(qe),le(qe,this.S)):qe=this.S),this.m!==null||this.O||(Me.H=qe,qe=null),this.P)e:{for(var j=0,X=0;X<this.i.length;X++){t:{var he=this.i[X];if("__data__"in he.map&&(he=he.map.__data__,typeof he=="string")){he=he.length;break t}he=void 0}if(he===void 0)break;if(j+=he,4096<j){j=X;break e}if(j===4096||X===this.i.length-1){j=X+1;break e}}j=1e3}else j=1e3;j=As(this,Me,j),X=ys(this.I),Wr(X,"RID",C),Wr(X,"CVER",22),this.D&&Wr(X,"X-HTTP-Session-Id",this.D),vu(this,X),qe&&(this.O?j="headers="+encodeURIComponent(String(Gc(qe)))+"&"+j:this.m&&_e(X,this.m,qe)),Dh(this.h,Me),this.Ua&&Wr(X,"TYPE","init"),this.P?(Wr(X,"$req",j),Wr(X,"SID","null"),Me.T=!0,ld(Me,X,null)):ld(Me,X,j),this.G=2}}else this.G==3&&(C?sp(this,C):this.i.length==0||is(this.h)||sp(this))};function sp(C,j){var X;j?X=j.l:X=C.U++;const he=ys(C.I);Wr(he,"SID",C.K),Wr(he,"RID",X),Wr(he,"AID",C.T),vu(C,he),C.m&&C.o&&_e(he,C.m,C.o),X=new Qs(C,C.j,X,C.B+1),C.m===null&&(X.H=C.o),j&&(C.i=j.D.concat(C.i)),j=As(C,X,1e3),X.I=Math.round(.5*C.wa)+Math.round(.5*C.wa*Math.random()),Dh(C.h,X),ld(X,he,j)}function vu(C,j){C.H&&ye(C.H,function(X,he){Wr(j,he,X)}),C.l&&vl({},function(X,he){Wr(j,he,X)})}function As(C,j,X){X=Math.min(C.i.length,X);var he=C.l?N(C.l.Na,C.l,C):null;e:{var Me=C.i;let qe=-1;for(;;){const At=["count="+X];qe==-1?0<X?(qe=Me[0].g,At.push("ofs="+qe)):qe=0:At.push("ofs="+qe);let Gr=!0;for(let ti=0;ti<X;ti++){let fr=Me[ti].g;const ko=Me[ti].map;if(fr-=qe,0>fr)qe=Math.max(0,Me[ti].g-100),Gr=!1;else try{Mh(ko,At,"req"+fr+"_")}catch{he&&he(ko)}}if(Gr){he=At.join("&");break e}}}return C=C.i.splice(0,X),j.D=C,he}function wl(C){if(!C.g&&!C.u){C.Y=1;var j=C.Fa;Le||Ee(),Ke||(Le(),Ke=!0),nt.add(j,C),C.v=0}}function ap(C){return C.g||C.u||3<=C.v?!1:(C.Y++,C.u=Ca(N(C.Fa,C),Eu(C,C.v)),C.v++,!0)}r.Fa=function(){if(this.u=null,hv(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var C=2*this.R;this.j.info("BP detection timer enabled: "+C),this.A=Ca(N(this.ab,this),C)}},r.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Ci(10),zc(this),hv(this))};function $m(C){C.A!=null&&(v.clearTimeout(C.A),C.A=null)}function hv(C){C.g=new Qs(C,C.j,"rpc",C.Y),C.m===null&&(C.g.H=C.o),C.g.O=0;var j=ys(C.qa);Wr(j,"RID","rpc"),Wr(j,"SID",C.K),Wr(j,"AID",C.T),Wr(j,"CI",C.F?"0":"1"),!C.F&&C.ja&&Wr(j,"TO",C.ja),Wr(j,"TYPE","xmlhttp"),vu(C,j),C.m&&C.o&&_e(j,C.m,C.o),C.L&&(C.g.I=C.L);var X=C.g;C=C.ia,X.L=1,X.v=Oa(ys(j)),X.m=null,X.P=!0,fu(X,C)}r.Za=function(){this.C!=null&&(this.C=null,zc(this),ap(this),Ci(19))};function cp(C){C.C!=null&&(v.clearTimeout(C.C),C.C=null)}function lp(C,j){var X=null;if(C.g==j){cp(C),$m(C),C.g=null;var he=2}else if(Wo(C.h,j))X=j.D,jc(C.h,j),he=1;else return;if(C.G!=0){if(j.o)if(he==1){X=j.m?j.m.length:0,j=Date.now()-j.F;var Me=C.B;he=lu(),nn(he,new ro(he,X)),tc(C)}else wl(C);else if(Me=j.s,Me==3||Me==0&&0<j.X||!(he==1&&Km(C,j)||he==2&&ap(C)))switch(X&&0<X.length&&(j=C.h,j.i=j.i.concat(X)),Me){case 1:yu(C,5);break;case 4:yu(C,10);break;case 3:yu(C,6);break;default:yu(C,2)}}}function Eu(C,j){let X=C.Ta+Math.floor(Math.random()*C.cb);return C.isActive()||(X*=2),X*j}function yu(C,j){if(C.j.info("Error code "+j),j==2){var X=N(C.fb,C),he=C.Xa;const Me=!he;he=new Aa(he||"//www.google.com/images/cleardot.gif"),v.location&&v.location.protocol=="http"||mu(he,"https"),Oa(he),Me?ip(he.toString(),X):ec(he.toString(),X)}else Ci(2);C.G=0,C.l&&C.l.sa(j),Su(C),md(C)}r.fb=function(C){C?(this.j.info("Successfully pinged google.com"),Ci(2)):(this.j.info("Failed to ping google.com"),Ci(1))};function Su(C){if(C.G=0,C.ka=[],C.l){const j=hd(C.h);(j.length!=0||C.i.length!=0)&&(z(C.ka,j),z(C.ka,C.i),C.h.i.length=0,G(C.i),C.i.length=0),C.l.ra()}}function qm(C,j,X){var he=X instanceof Aa?ys(X):new Aa(X);if(he.g!="")j&&(he.g=j+"."+he.g),Bc(he,he.s);else{var Me=v.location;he=Me.protocol,j=j?j+"."+Me.hostname:Me.hostname,Me=+Me.port;var qe=new Aa(null);he&&mu(qe,he),j&&(qe.g=j),Me&&Bc(qe,Me),X&&(qe.l=X),he=qe}return X=C.D,j=C.ya,X&&j&&Wr(he,X,j),Wr(he,"VER",C.la),vu(C,he),he}function fv(C,j,X){if(j&&!C.J)throw Error("Can't create secondary domain capable XhrIo object.");return j=C.Ca&&!C.pa?new Ce(new Wc({eb:X})):new Ce(C.pa),j.Ha(C.J),j}r.isActive=function(){return!!this.l&&this.l.isActive(this)};function Pn(){}r=Pn.prototype,r.ua=function(){},r.ta=function(){},r.sa=function(){},r.ra=function(){},r.isActive=function(){return!0},r.Na=function(){};function up(){}up.prototype.g=function(C,j){return new Os(C,j)};function Os(C,j){On.call(this),this.g=new _u(j),this.l=C,this.h=j&&j.messageUrlParams||null,C=j&&j.messageHeaders||null,j&&j.clientProtocolHeaderRequired&&(C?C["X-Client-Protocol"]="webchannel":C={"X-Client-Protocol":"webchannel"}),this.g.o=C,C=j&&j.initMessageHeaders||null,j&&j.messageContentType&&(C?C["X-WebChannel-Content-Type"]=j.messageContentType:C={"X-WebChannel-Content-Type":j.messageContentType}),j&&j.va&&(C?C["X-WebChannel-Client-Profile"]=j.va:C={"X-WebChannel-Client-Profile":j.va}),this.g.S=C,(C=j&&j.Sb)&&!J(C)&&(this.g.m=C),this.v=j&&j.supportsCrossDomainXhr||!1,this.u=j&&j.sendRawJson||!1,(j=j&&j.httpSessionIdParam)&&!J(j)&&(this.g.D=j,C=this.h,C!==null&&j in C&&(C=this.h,j in C&&delete C[j])),this.j=new nc(this)}H(Os,On),Os.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Os.prototype.close=function(){Vi(this.g)},Os.prototype.o=function(C){var j=this.g;if(typeof C=="string"){var X={};X.__data__=C,C=X}else this.u&&(X={},X.__data__=or(C),C=X);j.i.push(new dd(j.Ya++,C)),j.G==3&&tc(j)},Os.prototype.N=function(){this.g.l=null,delete this.j,Vi(this.g),delete this.g,Os.aa.N.call(this)};function pv(C){Po.call(this),C.__headers__&&(this.headers=C.__headers__,this.statusCode=C.__status__,delete C.__headers__,delete C.__status__);var j=C.__sm__;if(j){e:{for(const X in j){C=X;break e}C=void 0}(this.i=C)&&(C=this.i,j=j!==null&&C in j?j[C]:void 0),this.data=j}else this.data=C}H(pv,Po);function mv(){Ys.call(this),this.status=1}H(mv,Ys);function nc(C){this.g=C}H(nc,Pn),nc.prototype.ua=function(){nn(this.g,"a")},nc.prototype.ta=function(C){nn(this.g,new pv(C))},nc.prototype.sa=function(C){nn(this.g,new mv)},nc.prototype.ra=function(){nn(this.g,"b")},up.prototype.createWebChannel=up.prototype.g,Os.prototype.send=Os.prototype.o,Os.prototype.open=Os.prototype.m,Os.prototype.close=Os.prototype.close,Bte=function(){return new up},jte=function(){return lu()},Fte=Ya,EU={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},du.NO_ERROR=0,du.TIMEOUT=8,du.HTTP_ERROR=6,fP=du,Nh.COMPLETE="complete",Vte=Nh,qa.EventType=Ui,Ui.OPEN="a",Ui.CLOSE="b",Ui.ERROR="c",Ui.MESSAGE="d",On.prototype.listen=On.prototype.K,Nb=qa,Ce.prototype.listenOnce=Ce.prototype.L,Ce.prototype.getLastError=Ce.prototype.Ka,Ce.prototype.getLastErrorCode=Ce.prototype.Ba,Ce.prototype.getStatus=Ce.prototype.Z,Ce.prototype.getResponseJson=Ce.prototype.Oa,Ce.prototype.getResponseText=Ce.prototype.oa,Ce.prototype.send=Ce.prototype.ea,Ce.prototype.setWithCredentials=Ce.prototype.Ha,Ute=Ce}).apply(typeof OO<"u"?OO:typeof self<"u"?self:typeof window<"u"?window:{});const rY="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class va{constructor(t){this.uid=t}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}va.UNAUTHENTICATED=new va(null),va.GOOGLE_CREDENTIALS=new va("google-credentials-uid"),va.FIRST_PARTY=new va("first-party-uid"),va.MOCK_USER=new va("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let NS="10.14.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ev=new uF("@firebase/firestore");function ab(){return ev.logLevel}function en(r,...t){if(ev.logLevel<=br.DEBUG){const o=t.map(SF);ev.debug(`Firestore (${NS}): ${r}`,...o)}}function Xf(r,...t){if(ev.logLevel<=br.ERROR){const o=t.map(SF);ev.error(`Firestore (${NS}): ${r}`,...o)}}function fS(r,...t){if(ev.logLevel<=br.WARN){const o=t.map(SF);ev.warn(`Firestore (${NS}): ${r}`,...o)}}function SF(r){if(typeof r=="string")return r;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(o){return JSON.stringify(o)}(r)}catch{return r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vn(r="Unexpected state"){const t=`FIRESTORE (${NS}) INTERNAL ASSERTION FAILED: `+r;throw Xf(t),new Error(t)}function li(r,t){r||Vn()}function Hn(r,t){return r}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const st={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Ut extends Ph{constructor(t,o){super(t,o),this.code=t,this.message=o,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hf{constructor(){this.promise=new Promise((t,o)=>{this.resolve=t,this.reject=o})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wte{constructor(t,o){this.user=o,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class MUe{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,o){t.enqueueRetryable(()=>o(va.UNAUTHENTICATED))}shutdown(){}}class UUe{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,o){this.changeListener=o,t.enqueueRetryable(()=>o(this.token.user))}shutdown(){this.changeListener=null}}class VUe{constructor(t){this.t=t,this.currentUser=va.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,o){li(this.o===void 0);let a=this.i;const l=y=>this.i!==a?(a=this.i,o(y)):Promise.resolve();let d=new Hf;this.o=()=>{this.i++,this.currentUser=this.u(),d.resolve(),d=new Hf,t.enqueueRetryable(()=>l(this.currentUser))};const m=()=>{const y=d;t.enqueueRetryable(async()=>{await y.promise,await l(this.currentUser)})},v=y=>{en("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=y,this.o&&(this.auth.addAuthTokenListener(this.o),m())};this.t.onInit(y=>v(y)),setTimeout(()=>{if(!this.auth){const y=this.t.getImmediate({optional:!0});y?v(y):(en("FirebaseAuthCredentialsProvider","Auth not yet detected"),d.resolve(),d=new Hf)}},0),m()}getToken(){const t=this.i,o=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(o).then(a=>this.i!==t?(en("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):a?(li(typeof a.accessToken=="string"),new Wte(a.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const t=this.auth&&this.auth.getUid();return li(t===null||typeof t=="string"),new va(t)}}class FUe{constructor(t,o,a){this.l=t,this.h=o,this.P=a,this.type="FirstParty",this.user=va.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const t=this.T();return t&&this.I.set("Authorization",t),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class jUe{constructor(t,o,a){this.l=t,this.h=o,this.P=a}getToken(){return Promise.resolve(new FUe(this.l,this.h,this.P))}start(t,o){t.enqueueRetryable(()=>o(va.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class BUe{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class WUe{constructor(t){this.A=t,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(t,o){li(this.o===void 0);const a=d=>{d.error!=null&&en("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${d.error.message}`);const m=d.token!==this.R;return this.R=d.token,en("FirebaseAppCheckTokenProvider",`Received ${m?"new":"existing"} token.`),m?o(d.token):Promise.resolve()};this.o=d=>{t.enqueueRetryable(()=>a(d))};const l=d=>{en("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=d,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(d=>l(d)),setTimeout(()=>{if(!this.appCheck){const d=this.A.getImmediate({optional:!0});d?l(d):en("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then(o=>o?(li(typeof o.token=="string"),this.R=o.token,new BUe(o.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function GUe(r){const t=typeof self<"u"&&(self.crypto||self.msCrypto),o=new Uint8Array(r);if(t&&typeof t.getRandomValues=="function")t.getRandomValues(o);else for(let a=0;a<r;a++)o[a]=Math.floor(256*Math.random());return o}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gte{static newId(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",o=Math.floor(256/t.length)*t.length;let a="";for(;a.length<20;){const l=GUe(40);for(let d=0;d<l.length;++d)a.length<20&&l[d]<o&&(a+=t.charAt(l[d]%t.length))}return a}}function Br(r,t){return r<t?-1:r>t?1:0}function pS(r,t,o){return r.length===t.length&&r.every((a,l)=>o(a,t[l]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zo{constructor(t,o){if(this.seconds=t,this.nanoseconds=o,o<0)throw new Ut(st.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+o);if(o>=1e9)throw new Ut(st.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+o);if(t<-62135596800)throw new Ut(st.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new Ut(st.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}static now(){return Zo.fromMillis(Date.now())}static fromDate(t){return Zo.fromMillis(t.getTime())}static fromMillis(t){const o=Math.floor(t/1e3),a=Math.floor(1e6*(t-1e3*o));return new Zo(o,a)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(t){return this.seconds===t.seconds?Br(this.nanoseconds,t.nanoseconds):Br(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zn{constructor(t){this.timestamp=t}static fromTimestamp(t){return new zn(t)}static min(){return new zn(new Zo(0,0))}static max(){return new zn(new Zo(253402300799,999999999))}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cw{constructor(t,o,a){o===void 0?o=0:o>t.length&&Vn(),a===void 0?a=t.length-o:a>t.length-o&&Vn(),this.segments=t,this.offset=o,this.len=a}get length(){return this.len}isEqual(t){return Cw.comparator(this,t)===0}child(t){const o=this.segments.slice(this.offset,this.limit());return t instanceof Cw?t.forEach(a=>{o.push(a)}):o.push(t),this.construct(o)}limit(){return this.offset+this.length}popFirst(t){return t=t===void 0?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return this.length===0}isPrefixOf(t){if(t.length<this.length)return!1;for(let o=0;o<this.length;o++)if(this.get(o)!==t.get(o))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let o=0;o<this.length;o++)if(this.get(o)!==t.get(o))return!1;return!0}forEach(t){for(let o=this.offset,a=this.limit();o<a;o++)t(this.segments[o])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,o){const a=Math.min(t.length,o.length);for(let l=0;l<a;l++){const d=t.get(l),m=o.get(l);if(d<m)return-1;if(d>m)return 1}return t.length<o.length?-1:t.length>o.length?1:0}}class wi extends Cw{construct(t,o,a){return new wi(t,o,a)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){const o=[];for(const a of t){if(a.indexOf("//")>=0)throw new Ut(st.INVALID_ARGUMENT,`Invalid segment (${a}). Paths must not contain // in them.`);o.push(...a.split("/").filter(l=>l.length>0))}return new wi(o)}static emptyPath(){return new wi([])}}const zUe=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Ks extends Cw{construct(t,o,a){return new Ks(t,o,a)}static isValidIdentifier(t){return zUe.test(t)}canonicalString(){return this.toArray().map(t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Ks.isValidIdentifier(t)||(t="`"+t+"`"),t)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new Ks(["__name__"])}static fromServerFormat(t){const o=[];let a="",l=0;const d=()=>{if(a.length===0)throw new Ut(st.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);o.push(a),a=""};let m=!1;for(;l<t.length;){const v=t[l];if(v==="\\"){if(l+1===t.length)throw new Ut(st.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const y=t[l+1];if(y!=="\\"&&y!=="."&&y!=="`")throw new Ut(st.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);a+=y,l+=2}else v==="`"?(m=!m,l++):v!=="."||m?(a+=v,l++):(d(),l++)}if(d(),m)throw new Ut(st.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new Ks(o)}static emptyPath(){return new Ks([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cn{constructor(t){this.path=t}static fromPath(t){return new cn(wi.fromString(t))}static fromName(t){return new cn(wi.fromString(t).popFirst(5))}static empty(){return new cn(wi.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return t!==null&&wi.comparator(this.path,t.path)===0}toString(){return this.path.toString()}static comparator(t,o){return wi.comparator(t.path,o.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new cn(new wi(t.slice()))}}function HUe(r,t){const o=r.toTimestamp().seconds,a=r.toTimestamp().nanoseconds+1,l=zn.fromTimestamp(a===1e9?new Zo(o+1,0):new Zo(o,a));return new Dm(l,cn.empty(),t)}function KUe(r){return new Dm(r.readTime,r.key,-1)}class Dm{constructor(t,o,a){this.readTime=t,this.documentKey=o,this.largestBatchId=a}static min(){return new Dm(zn.min(),cn.empty(),-1)}static max(){return new Dm(zn.max(),cn.empty(),-1)}}function $Ue(r,t){let o=r.readTime.compareTo(t.readTime);return o!==0?o:(o=cn.comparator(r.documentKey,t.documentKey),o!==0?o:Br(r.largestBatchId,t.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qUe="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class YUe{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(t=>t())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function sR(r){if(r.code!==st.FAILED_PRECONDITION||r.message!==qUe)throw r;en("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tt{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(o=>{this.isDone=!0,this.result=o,this.nextCallback&&this.nextCallback(o)},o=>{this.isDone=!0,this.error=o,this.catchCallback&&this.catchCallback(o)})}catch(t){return this.next(void 0,t)}next(t,o){return this.callbackAttached&&Vn(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(o,this.error):this.wrapSuccess(t,this.result):new Tt((a,l)=>{this.nextCallback=d=>{this.wrapSuccess(t,d).next(a,l)},this.catchCallback=d=>{this.wrapFailure(o,d).next(a,l)}})}toPromise(){return new Promise((t,o)=>{this.next(t,o)})}wrapUserFunction(t){try{const o=t();return o instanceof Tt?o:Tt.resolve(o)}catch(o){return Tt.reject(o)}}wrapSuccess(t,o){return t?this.wrapUserFunction(()=>t(o)):Tt.resolve(o)}wrapFailure(t,o){return t?this.wrapUserFunction(()=>t(o)):Tt.reject(o)}static resolve(t){return new Tt((o,a)=>{o(t)})}static reject(t){return new Tt((o,a)=>{a(t)})}static waitFor(t){return new Tt((o,a)=>{let l=0,d=0,m=!1;t.forEach(v=>{++l,v.next(()=>{++d,m&&d===l&&o()},y=>a(y))}),m=!0,d===l&&o()})}static or(t){let o=Tt.resolve(!1);for(const a of t)o=o.next(l=>l?Tt.resolve(l):a());return o}static forEach(t,o){const a=[];return t.forEach((l,d)=>{a.push(o.call(this,l,d))}),this.waitFor(a)}static mapArray(t,o){return new Tt((a,l)=>{const d=t.length,m=new Array(d);let v=0;for(let y=0;y<d;y++){const b=y;o(t[b]).next(R=>{m[b]=R,++v,v===d&&a(m)},R=>l(R))}})}static doWhile(t,o){return new Tt((a,l)=>{const d=()=>{t()===!0?o().next(()=>{d()},l):a()};d()})}}function XUe(r){const t=r.match(/Android ([\d.]+)/i),o=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(o)}function aR(r){return r.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TF{constructor(t,o){this.previousValue=t,o&&(o.sequenceNumberHandler=a=>this.ie(a),this.se=a=>o.writeSequenceNumber(a))}ie(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.se&&this.se(t),t}}TF.oe=-1;function jN(r){return r==null}function HP(r){return r===0&&1/r==-1/0}function JUe(r){return typeof r=="number"&&Number.isInteger(r)&&!HP(r)&&r<=Number.MAX_SAFE_INTEGER&&r>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iY(r){let t=0;for(const o in r)Object.prototype.hasOwnProperty.call(r,o)&&t++;return t}function lv(r,t){for(const o in r)Object.prototype.hasOwnProperty.call(r,o)&&t(o,r[o])}function zte(r){for(const t in r)if(Object.prototype.hasOwnProperty.call(r,t))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class no{constructor(t,o){this.comparator=t,this.root=o||zs.EMPTY}insert(t,o){return new no(this.comparator,this.root.insert(t,o,this.comparator).copy(null,null,zs.BLACK,null,null))}remove(t){return new no(this.comparator,this.root.remove(t,this.comparator).copy(null,null,zs.BLACK,null,null))}get(t){let o=this.root;for(;!o.isEmpty();){const a=this.comparator(t,o.key);if(a===0)return o.value;a<0?o=o.left:a>0&&(o=o.right)}return null}indexOf(t){let o=0,a=this.root;for(;!a.isEmpty();){const l=this.comparator(t,a.key);if(l===0)return o+a.left.size;l<0?a=a.left:(o+=a.left.size+1,a=a.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal((o,a)=>(t(o,a),!1))}toString(){const t=[];return this.inorderTraversal((o,a)=>(t.push(`${o}:${a}`),!1)),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new PO(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new PO(this.root,t,this.comparator,!1)}getReverseIterator(){return new PO(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new PO(this.root,t,this.comparator,!0)}}class PO{constructor(t,o,a,l){this.isReverse=l,this.nodeStack=[];let d=1;for(;!t.isEmpty();)if(d=o?a(t.key,o):1,o&&l&&(d*=-1),d<0)t=this.isReverse?t.left:t.right;else{if(d===0){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const o={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return o}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class zs{constructor(t,o,a,l,d){this.key=t,this.value=o,this.color=a??zs.RED,this.left=l??zs.EMPTY,this.right=d??zs.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,o,a,l,d){return new zs(t??this.key,o??this.value,a??this.color,l??this.left,d??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,o,a){let l=this;const d=a(t,l.key);return l=d<0?l.copy(null,null,null,l.left.insert(t,o,a),null):d===0?l.copy(null,o,null,null,null):l.copy(null,null,null,null,l.right.insert(t,o,a)),l.fixUp()}removeMin(){if(this.left.isEmpty())return zs.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,o){let a,l=this;if(o(t,l.key)<0)l.left.isEmpty()||l.left.isRed()||l.left.left.isRed()||(l=l.moveRedLeft()),l=l.copy(null,null,null,l.left.remove(t,o),null);else{if(l.left.isRed()&&(l=l.rotateRight()),l.right.isEmpty()||l.right.isRed()||l.right.left.isRed()||(l=l.moveRedRight()),o(t,l.key)===0){if(l.right.isEmpty())return zs.EMPTY;a=l.right.min(),l=l.copy(a.key,a.value,null,null,l.right.removeMin())}l=l.copy(null,null,null,null,l.right.remove(t,o))}return l.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,zs.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,zs.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),o=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,o)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw Vn();const t=this.left.check();if(t!==this.right.check())throw Vn();return t+(this.isRed()?0:1)}}zs.EMPTY=null,zs.RED=!0,zs.BLACK=!1;zs.EMPTY=new class{constructor(){this.size=0}get key(){throw Vn()}get value(){throw Vn()}get color(){throw Vn()}get left(){throw Vn()}get right(){throw Vn()}copy(t,o,a,l,d){return this}insert(t,o,a){return new zs(t,o)}remove(t,o){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $s{constructor(t){this.comparator=t,this.data=new no(this.comparator)}has(t){return this.data.get(t)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal((o,a)=>(t(o),!1))}forEachInRange(t,o){const a=this.data.getIteratorFrom(t[0]);for(;a.hasNext();){const l=a.getNext();if(this.comparator(l.key,t[1])>=0)return;o(l.key)}}forEachWhile(t,o){let a;for(a=o!==void 0?this.data.getIteratorFrom(o):this.data.getIterator();a.hasNext();)if(!t(a.getNext().key))return}firstAfterOrEqual(t){const o=this.data.getIteratorFrom(t);return o.hasNext()?o.getNext().key:null}getIterator(){return new oY(this.data.getIterator())}getIteratorFrom(t){return new oY(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let o=this;return o.size<t.size&&(o=t,t=this),t.forEach(a=>{o=o.add(a)}),o}isEqual(t){if(!(t instanceof $s)||this.size!==t.size)return!1;const o=this.data.getIterator(),a=t.data.getIterator();for(;o.hasNext();){const l=o.getNext().key,d=a.getNext().key;if(this.comparator(l,d)!==0)return!1}return!0}toArray(){const t=[];return this.forEach(o=>{t.push(o)}),t}toString(){const t=[];return this.forEach(o=>t.push(o)),"SortedSet("+t.toString()+")"}copy(t){const o=new $s(this.comparator);return o.data=t,o}}class oY{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dl{constructor(t){this.fields=t,t.sort(Ks.comparator)}static empty(){return new dl([])}unionWith(t){let o=new $s(Ks.comparator);for(const a of this.fields)o=o.add(a);for(const a of t)o=o.add(a);return new dl(o.toArray())}covers(t){for(const o of this.fields)if(o.isPrefixOf(t))return!0;return!1}isEqual(t){return pS(this.fields,t.fields,(o,a)=>o.isEqual(a))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hte extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qs{constructor(t){this.binaryString=t}static fromBase64String(t){const o=function(l){try{return atob(l)}catch(d){throw typeof DOMException<"u"&&d instanceof DOMException?new Hte("Invalid base64 string: "+d):d}}(t);return new qs(o)}static fromUint8Array(t){const o=function(l){let d="";for(let m=0;m<l.length;++m)d+=String.fromCharCode(l[m]);return d}(t);return new qs(o)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(o){return btoa(o)}(this.binaryString)}toUint8Array(){return function(o){const a=new Uint8Array(o.length);for(let l=0;l<o.length;l++)a[l]=o.charCodeAt(l);return a}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return Br(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}qs.EMPTY_BYTE_STRING=new qs("");const QUe=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Lm(r){if(li(!!r),typeof r=="string"){let t=0;const o=QUe.exec(r);if(li(!!o),o[1]){let l=o[1];l=(l+"000000000").substr(0,9),t=Number(l)}const a=new Date(r);return{seconds:Math.floor(a.getTime()/1e3),nanos:t}}return{seconds:Ao(r.seconds),nanos:Ao(r.nanos)}}function Ao(r){return typeof r=="number"?r:typeof r=="string"?Number(r):0}function tv(r){return typeof r=="string"?qs.fromBase64String(r):qs.fromUint8Array(r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function BN(r){var t,o;return((o=(((t=r==null?void 0:r.mapValue)===null||t===void 0?void 0:t.fields)||{}).__type__)===null||o===void 0?void 0:o.stringValue)==="server_timestamp"}function bF(r){const t=r.mapValue.fields.__previous_value__;return BN(t)?bF(t):t}function Iw(r){const t=Lm(r.mapValue.fields.__local_write_time__.timestampValue);return new Zo(t.seconds,t.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZUe{constructor(t,o,a,l,d,m,v,y,b){this.databaseId=t,this.appId=o,this.persistenceKey=a,this.host=l,this.ssl=d,this.forceLongPolling=m,this.autoDetectLongPolling=v,this.longPollingOptions=y,this.useFetchStreams=b}}class Aw{constructor(t,o){this.projectId=t,this.database=o||"(default)"}static empty(){return new Aw("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(t){return t instanceof Aw&&t.projectId===this.projectId&&t.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const NO={mapValue:{}};function nv(r){return"nullValue"in r?0:"booleanValue"in r?1:"integerValue"in r||"doubleValue"in r?2:"timestampValue"in r?3:"stringValue"in r?5:"bytesValue"in r?6:"referenceValue"in r?7:"geoPointValue"in r?8:"arrayValue"in r?9:"mapValue"in r?BN(r)?4:tVe(r)?9007199254740991:eVe(r)?10:11:Vn()}function Th(r,t){if(r===t)return!0;const o=nv(r);if(o!==nv(t))return!1;switch(o){case 0:case 9007199254740991:return!0;case 1:return r.booleanValue===t.booleanValue;case 4:return Iw(r).isEqual(Iw(t));case 3:return function(l,d){if(typeof l.timestampValue=="string"&&typeof d.timestampValue=="string"&&l.timestampValue.length===d.timestampValue.length)return l.timestampValue===d.timestampValue;const m=Lm(l.timestampValue),v=Lm(d.timestampValue);return m.seconds===v.seconds&&m.nanos===v.nanos}(r,t);case 5:return r.stringValue===t.stringValue;case 6:return function(l,d){return tv(l.bytesValue).isEqual(tv(d.bytesValue))}(r,t);case 7:return r.referenceValue===t.referenceValue;case 8:return function(l,d){return Ao(l.geoPointValue.latitude)===Ao(d.geoPointValue.latitude)&&Ao(l.geoPointValue.longitude)===Ao(d.geoPointValue.longitude)}(r,t);case 2:return function(l,d){if("integerValue"in l&&"integerValue"in d)return Ao(l.integerValue)===Ao(d.integerValue);if("doubleValue"in l&&"doubleValue"in d){const m=Ao(l.doubleValue),v=Ao(d.doubleValue);return m===v?HP(m)===HP(v):isNaN(m)&&isNaN(v)}return!1}(r,t);case 9:return pS(r.arrayValue.values||[],t.arrayValue.values||[],Th);case 10:case 11:return function(l,d){const m=l.mapValue.fields||{},v=d.mapValue.fields||{};if(iY(m)!==iY(v))return!1;for(const y in m)if(m.hasOwnProperty(y)&&(v[y]===void 0||!Th(m[y],v[y])))return!1;return!0}(r,t);default:return Vn()}}function Ow(r,t){return(r.values||[]).find(o=>Th(o,t))!==void 0}function mS(r,t){if(r===t)return 0;const o=nv(r),a=nv(t);if(o!==a)return Br(o,a);switch(o){case 0:case 9007199254740991:return 0;case 1:return Br(r.booleanValue,t.booleanValue);case 2:return function(d,m){const v=Ao(d.integerValue||d.doubleValue),y=Ao(m.integerValue||m.doubleValue);return v<y?-1:v>y?1:v===y?0:isNaN(v)?isNaN(y)?0:-1:1}(r,t);case 3:return sY(r.timestampValue,t.timestampValue);case 4:return sY(Iw(r),Iw(t));case 5:return Br(r.stringValue,t.stringValue);case 6:return function(d,m){const v=tv(d),y=tv(m);return v.compareTo(y)}(r.bytesValue,t.bytesValue);case 7:return function(d,m){const v=d.split("/"),y=m.split("/");for(let b=0;b<v.length&&b<y.length;b++){const R=Br(v[b],y[b]);if(R!==0)return R}return Br(v.length,y.length)}(r.referenceValue,t.referenceValue);case 8:return function(d,m){const v=Br(Ao(d.latitude),Ao(m.latitude));return v!==0?v:Br(Ao(d.longitude),Ao(m.longitude))}(r.geoPointValue,t.geoPointValue);case 9:return aY(r.arrayValue,t.arrayValue);case 10:return function(d,m){var v,y,b,R;const O=d.fields||{},N=m.fields||{},F=(v=O.value)===null||v===void 0?void 0:v.arrayValue,H=(y=N.value)===null||y===void 0?void 0:y.arrayValue,G=Br(((b=F==null?void 0:F.values)===null||b===void 0?void 0:b.length)||0,((R=H==null?void 0:H.values)===null||R===void 0?void 0:R.length)||0);return G!==0?G:aY(F,H)}(r.mapValue,t.mapValue);case 11:return function(d,m){if(d===NO.mapValue&&m===NO.mapValue)return 0;if(d===NO.mapValue)return 1;if(m===NO.mapValue)return-1;const v=d.fields||{},y=Object.keys(v),b=m.fields||{},R=Object.keys(b);y.sort(),R.sort();for(let O=0;O<y.length&&O<R.length;++O){const N=Br(y[O],R[O]);if(N!==0)return N;const F=mS(v[y[O]],b[R[O]]);if(F!==0)return F}return Br(y.length,R.length)}(r.mapValue,t.mapValue);default:throw Vn()}}function sY(r,t){if(typeof r=="string"&&typeof t=="string"&&r.length===t.length)return Br(r,t);const o=Lm(r),a=Lm(t),l=Br(o.seconds,a.seconds);return l!==0?l:Br(o.nanos,a.nanos)}function aY(r,t){const o=r.values||[],a=t.values||[];for(let l=0;l<o.length&&l<a.length;++l){const d=mS(o[l],a[l]);if(d)return d}return Br(o.length,a.length)}function gS(r){return yU(r)}function yU(r){return"nullValue"in r?"null":"booleanValue"in r?""+r.booleanValue:"integerValue"in r?""+r.integerValue:"doubleValue"in r?""+r.doubleValue:"timestampValue"in r?function(o){const a=Lm(o);return`time(${a.seconds},${a.nanos})`}(r.timestampValue):"stringValue"in r?r.stringValue:"bytesValue"in r?function(o){return tv(o).toBase64()}(r.bytesValue):"referenceValue"in r?function(o){return cn.fromName(o).toString()}(r.referenceValue):"geoPointValue"in r?function(o){return`geo(${o.latitude},${o.longitude})`}(r.geoPointValue):"arrayValue"in r?function(o){let a="[",l=!0;for(const d of o.values||[])l?l=!1:a+=",",a+=yU(d);return a+"]"}(r.arrayValue):"mapValue"in r?function(o){const a=Object.keys(o.fields||{}).sort();let l="{",d=!0;for(const m of a)d?d=!1:l+=",",l+=`${m}:${yU(o.fields[m])}`;return l+"}"}(r.mapValue):Vn()}function KP(r,t){return{referenceValue:`projects/${r.projectId}/databases/${r.database}/documents/${t.path.canonicalString()}`}}function SU(r){return!!r&&"integerValue"in r}function wF(r){return!!r&&"arrayValue"in r}function cY(r){return!!r&&"nullValue"in r}function lY(r){return!!r&&"doubleValue"in r&&isNaN(Number(r.doubleValue))}function pP(r){return!!r&&"mapValue"in r}function eVe(r){var t,o;return((o=(((t=r==null?void 0:r.mapValue)===null||t===void 0?void 0:t.fields)||{}).__type__)===null||o===void 0?void 0:o.stringValue)==="__vector__"}function Jb(r){if(r.geoPointValue)return{geoPointValue:Object.assign({},r.geoPointValue)};if(r.timestampValue&&typeof r.timestampValue=="object")return{timestampValue:Object.assign({},r.timestampValue)};if(r.mapValue){const t={mapValue:{fields:{}}};return lv(r.mapValue.fields,(o,a)=>t.mapValue.fields[o]=Jb(a)),t}if(r.arrayValue){const t={arrayValue:{values:[]}};for(let o=0;o<(r.arrayValue.values||[]).length;++o)t.arrayValue.values[o]=Jb(r.arrayValue.values[o]);return t}return Object.assign({},r)}function tVe(r){return(((r.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oc{constructor(t){this.value=t}static empty(){return new Oc({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let o=this.value;for(let a=0;a<t.length-1;++a)if(o=(o.mapValue.fields||{})[t.get(a)],!pP(o))return null;return o=(o.mapValue.fields||{})[t.lastSegment()],o||null}}set(t,o){this.getFieldsMap(t.popLast())[t.lastSegment()]=Jb(o)}setAll(t){let o=Ks.emptyPath(),a={},l=[];t.forEach((m,v)=>{if(!o.isImmediateParentOf(v)){const y=this.getFieldsMap(o);this.applyChanges(y,a,l),a={},l=[],o=v.popLast()}m?a[v.lastSegment()]=Jb(m):l.push(v.lastSegment())});const d=this.getFieldsMap(o);this.applyChanges(d,a,l)}delete(t){const o=this.field(t.popLast());pP(o)&&o.mapValue.fields&&delete o.mapValue.fields[t.lastSegment()]}isEqual(t){return Th(this.value,t.value)}getFieldsMap(t){let o=this.value;o.mapValue.fields||(o.mapValue={fields:{}});for(let a=0;a<t.length;++a){let l=o.mapValue.fields[t.get(a)];pP(l)&&l.mapValue.fields||(l={mapValue:{fields:{}}},o.mapValue.fields[t.get(a)]=l),o=l}return o.mapValue.fields}applyChanges(t,o,a){lv(o,(l,d)=>t[l]=d);for(const l of a)delete t[l]}clone(){return new Oc(Jb(this.value))}}function Kte(r){const t=[];return lv(r.fields,(o,a)=>{const l=new Ks([o]);if(pP(a)){const d=Kte(a.mapValue).fields;if(d.length===0)t.push(l);else for(const m of d)t.push(l.child(m))}else t.push(l)}),new dl(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ea{constructor(t,o,a,l,d,m,v){this.key=t,this.documentType=o,this.version=a,this.readTime=l,this.createTime=d,this.data=m,this.documentState=v}static newInvalidDocument(t){return new Ea(t,0,zn.min(),zn.min(),zn.min(),Oc.empty(),0)}static newFoundDocument(t,o,a,l){return new Ea(t,1,o,zn.min(),a,l,0)}static newNoDocument(t,o){return new Ea(t,2,o,zn.min(),zn.min(),Oc.empty(),0)}static newUnknownDocument(t,o){return new Ea(t,3,o,zn.min(),zn.min(),Oc.empty(),2)}convertToFoundDocument(t,o){return!this.createTime.isEqual(zn.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=t),this.version=t,this.documentType=1,this.data=o,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=Oc.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=Oc.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=zn.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(t){return t instanceof Ea&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new Ea(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _S{constructor(t,o){this.position=t,this.inclusive=o}}function uY(r,t,o){let a=0;for(let l=0;l<r.position.length;l++){const d=t[l],m=r.position[l];if(d.field.isKeyField()?a=cn.comparator(cn.fromName(m.referenceValue),o.key):a=mS(m,o.data.field(d.field)),d.dir==="desc"&&(a*=-1),a!==0)break}return a}function dY(r,t){if(r===null)return t===null;if(t===null||r.inclusive!==t.inclusive||r.position.length!==t.position.length)return!1;for(let o=0;o<r.position.length;o++)if(!Th(r.position[o],t.position[o]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pw{constructor(t,o="asc"){this.field=t,this.dir=o}}function nVe(r,t){return r.dir===t.dir&&r.field.isEqual(t.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $te{}class jo extends $te{constructor(t,o,a){super(),this.field=t,this.op=o,this.value=a}static create(t,o,a){return t.isKeyField()?o==="in"||o==="not-in"?this.createKeyFieldInFilter(t,o,a):new iVe(t,o,a):o==="array-contains"?new aVe(t,a):o==="in"?new cVe(t,a):o==="not-in"?new lVe(t,a):o==="array-contains-any"?new uVe(t,a):new jo(t,o,a)}static createKeyFieldInFilter(t,o,a){return o==="in"?new oVe(t,a):new sVe(t,a)}matches(t){const o=t.data.field(this.field);return this.op==="!="?o!==null&&this.matchesComparison(mS(o,this.value)):o!==null&&nv(this.value)===nv(o)&&this.matchesComparison(mS(o,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return t===0;case"!=":return t!==0;case">":return t>0;case">=":return t>=0;default:return Vn()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class id extends $te{constructor(t,o){super(),this.filters=t,this.op=o,this.ae=null}static create(t,o){return new id(t,o)}matches(t){return qte(this)?this.filters.find(o=>!o.matches(t))===void 0:this.filters.find(o=>o.matches(t))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((t,o)=>t.concat(o.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function qte(r){return r.op==="and"}function Yte(r){return rVe(r)&&qte(r)}function rVe(r){for(const t of r.filters)if(t instanceof id)return!1;return!0}function TU(r){if(r instanceof jo)return r.field.canonicalString()+r.op.toString()+gS(r.value);if(Yte(r))return r.filters.map(t=>TU(t)).join(",");{const t=r.filters.map(o=>TU(o)).join(",");return`${r.op}(${t})`}}function Xte(r,t){return r instanceof jo?function(a,l){return l instanceof jo&&a.op===l.op&&a.field.isEqual(l.field)&&Th(a.value,l.value)}(r,t):r instanceof id?function(a,l){return l instanceof id&&a.op===l.op&&a.filters.length===l.filters.length?a.filters.reduce((d,m,v)=>d&&Xte(m,l.filters[v]),!0):!1}(r,t):void Vn()}function Jte(r){return r instanceof jo?function(o){return`${o.field.canonicalString()} ${o.op} ${gS(o.value)}`}(r):r instanceof id?function(o){return o.op.toString()+" {"+o.getFilters().map(Jte).join(" ,")+"}"}(r):"Filter"}class iVe extends jo{constructor(t,o,a){super(t,o,a),this.key=cn.fromName(a.referenceValue)}matches(t){const o=cn.comparator(t.key,this.key);return this.matchesComparison(o)}}class oVe extends jo{constructor(t,o){super(t,"in",o),this.keys=Qte("in",o)}matches(t){return this.keys.some(o=>o.isEqual(t.key))}}class sVe extends jo{constructor(t,o){super(t,"not-in",o),this.keys=Qte("not-in",o)}matches(t){return!this.keys.some(o=>o.isEqual(t.key))}}function Qte(r,t){var o;return(((o=t.arrayValue)===null||o===void 0?void 0:o.values)||[]).map(a=>cn.fromName(a.referenceValue))}class aVe extends jo{constructor(t,o){super(t,"array-contains",o)}matches(t){const o=t.data.field(this.field);return wF(o)&&Ow(o.arrayValue,this.value)}}class cVe extends jo{constructor(t,o){super(t,"in",o)}matches(t){const o=t.data.field(this.field);return o!==null&&Ow(this.value.arrayValue,o)}}class lVe extends jo{constructor(t,o){super(t,"not-in",o)}matches(t){if(Ow(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const o=t.data.field(this.field);return o!==null&&!Ow(this.value.arrayValue,o)}}class uVe extends jo{constructor(t,o){super(t,"array-contains-any",o)}matches(t){const o=t.data.field(this.field);return!(!wF(o)||!o.arrayValue.values)&&o.arrayValue.values.some(a=>Ow(this.value.arrayValue,a))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dVe{constructor(t,o=null,a=[],l=[],d=null,m=null,v=null){this.path=t,this.collectionGroup=o,this.orderBy=a,this.filters=l,this.limit=d,this.startAt=m,this.endAt=v,this.ue=null}}function hY(r,t=null,o=[],a=[],l=null,d=null,m=null){return new dVe(r,t,o,a,l,d,m)}function RF(r){const t=Hn(r);if(t.ue===null){let o=t.path.canonicalString();t.collectionGroup!==null&&(o+="|cg:"+t.collectionGroup),o+="|f:",o+=t.filters.map(a=>TU(a)).join(","),o+="|ob:",o+=t.orderBy.map(a=>function(d){return d.field.canonicalString()+d.dir}(a)).join(","),jN(t.limit)||(o+="|l:",o+=t.limit),t.startAt&&(o+="|lb:",o+=t.startAt.inclusive?"b:":"a:",o+=t.startAt.position.map(a=>gS(a)).join(",")),t.endAt&&(o+="|ub:",o+=t.endAt.inclusive?"a:":"b:",o+=t.endAt.position.map(a=>gS(a)).join(",")),t.ue=o}return t.ue}function CF(r,t){if(r.limit!==t.limit||r.orderBy.length!==t.orderBy.length)return!1;for(let o=0;o<r.orderBy.length;o++)if(!nVe(r.orderBy[o],t.orderBy[o]))return!1;if(r.filters.length!==t.filters.length)return!1;for(let o=0;o<r.filters.length;o++)if(!Xte(r.filters[o],t.filters[o]))return!1;return r.collectionGroup===t.collectionGroup&&!!r.path.isEqual(t.path)&&!!dY(r.startAt,t.startAt)&&dY(r.endAt,t.endAt)}function bU(r){return cn.isDocumentKey(r.path)&&r.collectionGroup===null&&r.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uv{constructor(t,o=null,a=[],l=[],d=null,m="F",v=null,y=null){this.path=t,this.collectionGroup=o,this.explicitOrderBy=a,this.filters=l,this.limit=d,this.limitType=m,this.startAt=v,this.endAt=y,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function hVe(r,t,o,a,l,d,m,v){return new uv(r,t,o,a,l,d,m,v)}function WN(r){return new uv(r)}function fY(r){return r.filters.length===0&&r.limit===null&&r.startAt==null&&r.endAt==null&&(r.explicitOrderBy.length===0||r.explicitOrderBy.length===1&&r.explicitOrderBy[0].field.isKeyField())}function IF(r){return r.collectionGroup!==null}function tS(r){const t=Hn(r);if(t.ce===null){t.ce=[];const o=new Set;for(const d of t.explicitOrderBy)t.ce.push(d),o.add(d.field.canonicalString());const a=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(m){let v=new $s(Ks.comparator);return m.filters.forEach(y=>{y.getFlattenedFilters().forEach(b=>{b.isInequality()&&(v=v.add(b.field))})}),v})(t).forEach(d=>{o.has(d.canonicalString())||d.isKeyField()||t.ce.push(new Pw(d,a))}),o.has(Ks.keyField().canonicalString())||t.ce.push(new Pw(Ks.keyField(),a))}return t.ce}function gh(r){const t=Hn(r);return t.le||(t.le=fVe(t,tS(r))),t.le}function fVe(r,t){if(r.limitType==="F")return hY(r.path,r.collectionGroup,t,r.filters,r.limit,r.startAt,r.endAt);{t=t.map(l=>{const d=l.dir==="desc"?"asc":"desc";return new Pw(l.field,d)});const o=r.endAt?new _S(r.endAt.position,r.endAt.inclusive):null,a=r.startAt?new _S(r.startAt.position,r.startAt.inclusive):null;return hY(r.path,r.collectionGroup,t,r.filters,r.limit,o,a)}}function wU(r,t){const o=r.filters.concat([t]);return new uv(r.path,r.collectionGroup,r.explicitOrderBy.slice(),o,r.limit,r.limitType,r.startAt,r.endAt)}function RU(r,t,o){return new uv(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),t,o,r.startAt,r.endAt)}function GN(r,t){return CF(gh(r),gh(t))&&r.limitType===t.limitType}function Zte(r){return`${RF(gh(r))}|lt:${r.limitType}`}function Ry(r){return`Query(target=${function(o){let a=o.path.canonicalString();return o.collectionGroup!==null&&(a+=" collectionGroup="+o.collectionGroup),o.filters.length>0&&(a+=`, filters: [${o.filters.map(l=>Jte(l)).join(", ")}]`),jN(o.limit)||(a+=", limit: "+o.limit),o.orderBy.length>0&&(a+=`, orderBy: [${o.orderBy.map(l=>function(m){return`${m.field.canonicalString()} (${m.dir})`}(l)).join(", ")}]`),o.startAt&&(a+=", startAt: ",a+=o.startAt.inclusive?"b:":"a:",a+=o.startAt.position.map(l=>gS(l)).join(",")),o.endAt&&(a+=", endAt: ",a+=o.endAt.inclusive?"a:":"b:",a+=o.endAt.position.map(l=>gS(l)).join(",")),`Target(${a})`}(gh(r))}; limitType=${r.limitType})`}function zN(r,t){return t.isFoundDocument()&&function(a,l){const d=l.key.path;return a.collectionGroup!==null?l.key.hasCollectionId(a.collectionGroup)&&a.path.isPrefixOf(d):cn.isDocumentKey(a.path)?a.path.isEqual(d):a.path.isImmediateParentOf(d)}(r,t)&&function(a,l){for(const d of tS(a))if(!d.field.isKeyField()&&l.data.field(d.field)===null)return!1;return!0}(r,t)&&function(a,l){for(const d of a.filters)if(!d.matches(l))return!1;return!0}(r,t)&&function(a,l){return!(a.startAt&&!function(m,v,y){const b=uY(m,v,y);return m.inclusive?b<=0:b<0}(a.startAt,tS(a),l)||a.endAt&&!function(m,v,y){const b=uY(m,v,y);return m.inclusive?b>=0:b>0}(a.endAt,tS(a),l))}(r,t)}function pVe(r){return r.collectionGroup||(r.path.length%2==1?r.path.lastSegment():r.path.get(r.path.length-2))}function ene(r){return(t,o)=>{let a=!1;for(const l of tS(r)){const d=mVe(l,t,o);if(d!==0)return d;a=a||l.field.isKeyField()}return 0}}function mVe(r,t,o){const a=r.field.isKeyField()?cn.comparator(t.key,o.key):function(d,m,v){const y=m.data.field(d),b=v.data.field(d);return y!==null&&b!==null?mS(y,b):Vn()}(r.field,t,o);switch(r.dir){case"asc":return a;case"desc":return-1*a;default:return Vn()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kS{constructor(t,o){this.mapKeyFn=t,this.equalsFn=o,this.inner={},this.innerSize=0}get(t){const o=this.mapKeyFn(t),a=this.inner[o];if(a!==void 0){for(const[l,d]of a)if(this.equalsFn(l,t))return d}}has(t){return this.get(t)!==void 0}set(t,o){const a=this.mapKeyFn(t),l=this.inner[a];if(l===void 0)return this.inner[a]=[[t,o]],void this.innerSize++;for(let d=0;d<l.length;d++)if(this.equalsFn(l[d][0],t))return void(l[d]=[t,o]);l.push([t,o]),this.innerSize++}delete(t){const o=this.mapKeyFn(t),a=this.inner[o];if(a===void 0)return!1;for(let l=0;l<a.length;l++)if(this.equalsFn(a[l][0],t))return a.length===1?delete this.inner[o]:a.splice(l,1),this.innerSize--,!0;return!1}forEach(t){lv(this.inner,(o,a)=>{for(const[l,d]of a)t(l,d)})}isEmpty(){return zte(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gVe=new no(cn.comparator);function Jf(){return gVe}const tne=new no(cn.comparator);function kb(...r){let t=tne;for(const o of r)t=t.insert(o.key,o);return t}function nne(r){let t=tne;return r.forEach((o,a)=>t=t.insert(o,a.overlayedDocument)),t}function L_(){return Qb()}function rne(){return Qb()}function Qb(){return new kS(r=>r.toString(),(r,t)=>r.isEqual(t))}const _Ve=new no(cn.comparator),vVe=new $s(cn.comparator);function mr(...r){let t=vVe;for(const o of r)t=t.add(o);return t}const EVe=new $s(Br);function yVe(){return EVe}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function AF(r,t){if(r.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:HP(t)?"-0":t}}function ine(r){return{integerValue:""+r}}function SVe(r,t){return JUe(t)?ine(t):AF(r,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HN{constructor(){this._=void 0}}function TVe(r,t,o){return r instanceof $P?function(l,d){const m={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:l.seconds,nanos:l.nanoseconds}}}};return d&&BN(d)&&(d=bF(d)),d&&(m.fields.__previous_value__=d),{mapValue:m}}(o,t):r instanceof Nw?sne(r,t):r instanceof kw?ane(r,t):function(l,d){const m=one(l,d),v=pY(m)+pY(l.Pe);return SU(m)&&SU(l.Pe)?ine(v):AF(l.serializer,v)}(r,t)}function bVe(r,t,o){return r instanceof Nw?sne(r,t):r instanceof kw?ane(r,t):o}function one(r,t){return r instanceof qP?function(a){return SU(a)||function(d){return!!d&&"doubleValue"in d}(a)}(t)?t:{integerValue:0}:null}class $P extends HN{}class Nw extends HN{constructor(t){super(),this.elements=t}}function sne(r,t){const o=cne(t);for(const a of r.elements)o.some(l=>Th(l,a))||o.push(a);return{arrayValue:{values:o}}}class kw extends HN{constructor(t){super(),this.elements=t}}function ane(r,t){let o=cne(t);for(const a of r.elements)o=o.filter(l=>!Th(l,a));return{arrayValue:{values:o}}}class qP extends HN{constructor(t,o){super(),this.serializer=t,this.Pe=o}}function pY(r){return Ao(r.integerValue||r.doubleValue)}function cne(r){return wF(r)&&r.arrayValue.values?r.arrayValue.values.slice():[]}function wVe(r,t){return r.field.isEqual(t.field)&&function(a,l){return a instanceof Nw&&l instanceof Nw||a instanceof kw&&l instanceof kw?pS(a.elements,l.elements,Th):a instanceof qP&&l instanceof qP?Th(a.Pe,l.Pe):a instanceof $P&&l instanceof $P}(r.transform,t.transform)}class RVe{constructor(t,o){this.version=t,this.transformResults=o}}class _h{constructor(t,o){this.updateTime=t,this.exists=o}static none(){return new _h}static exists(t){return new _h(void 0,t)}static updateTime(t){return new _h(t)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function mP(r,t){return r.updateTime!==void 0?t.isFoundDocument()&&t.version.isEqual(r.updateTime):r.exists===void 0||r.exists===t.isFoundDocument()}class KN{}function lne(r,t){if(!r.hasLocalMutations||t&&t.fields.length===0)return null;if(t===null)return r.isNoDocument()?new dne(r.key,_h.none()):new cR(r.key,r.data,_h.none());{const o=r.data,a=Oc.empty();let l=new $s(Ks.comparator);for(let d of t.fields)if(!l.has(d)){let m=o.field(d);m===null&&d.length>1&&(d=d.popLast(),m=o.field(d)),m===null?a.delete(d):a.set(d,m),l=l.add(d)}return new Gm(r.key,a,new dl(l.toArray()),_h.none())}}function CVe(r,t,o){r instanceof cR?function(l,d,m){const v=l.value.clone(),y=gY(l.fieldTransforms,d,m.transformResults);v.setAll(y),d.convertToFoundDocument(m.version,v).setHasCommittedMutations()}(r,t,o):r instanceof Gm?function(l,d,m){if(!mP(l.precondition,d))return void d.convertToUnknownDocument(m.version);const v=gY(l.fieldTransforms,d,m.transformResults),y=d.data;y.setAll(une(l)),y.setAll(v),d.convertToFoundDocument(m.version,y).setHasCommittedMutations()}(r,t,o):function(l,d,m){d.convertToNoDocument(m.version).setHasCommittedMutations()}(0,t,o)}function Zb(r,t,o,a){return r instanceof cR?function(d,m,v,y){if(!mP(d.precondition,m))return v;const b=d.value.clone(),R=_Y(d.fieldTransforms,y,m);return b.setAll(R),m.convertToFoundDocument(m.version,b).setHasLocalMutations(),null}(r,t,o,a):r instanceof Gm?function(d,m,v,y){if(!mP(d.precondition,m))return v;const b=_Y(d.fieldTransforms,y,m),R=m.data;return R.setAll(une(d)),R.setAll(b),m.convertToFoundDocument(m.version,R).setHasLocalMutations(),v===null?null:v.unionWith(d.fieldMask.fields).unionWith(d.fieldTransforms.map(O=>O.field))}(r,t,o,a):function(d,m,v){return mP(d.precondition,m)?(m.convertToNoDocument(m.version).setHasLocalMutations(),null):v}(r,t,o)}function IVe(r,t){let o=null;for(const a of r.fieldTransforms){const l=t.data.field(a.field),d=one(a.transform,l||null);d!=null&&(o===null&&(o=Oc.empty()),o.set(a.field,d))}return o||null}function mY(r,t){return r.type===t.type&&!!r.key.isEqual(t.key)&&!!r.precondition.isEqual(t.precondition)&&!!function(a,l){return a===void 0&&l===void 0||!(!a||!l)&&pS(a,l,(d,m)=>wVe(d,m))}(r.fieldTransforms,t.fieldTransforms)&&(r.type===0?r.value.isEqual(t.value):r.type!==1||r.data.isEqual(t.data)&&r.fieldMask.isEqual(t.fieldMask))}class cR extends KN{constructor(t,o,a,l=[]){super(),this.key=t,this.value=o,this.precondition=a,this.fieldTransforms=l,this.type=0}getFieldMask(){return null}}class Gm extends KN{constructor(t,o,a,l,d=[]){super(),this.key=t,this.data=o,this.fieldMask=a,this.precondition=l,this.fieldTransforms=d,this.type=1}getFieldMask(){return this.fieldMask}}function une(r){const t=new Map;return r.fieldMask.fields.forEach(o=>{if(!o.isEmpty()){const a=r.data.field(o);t.set(o,a)}}),t}function gY(r,t,o){const a=new Map;li(r.length===o.length);for(let l=0;l<o.length;l++){const d=r[l],m=d.transform,v=t.data.field(d.field);a.set(d.field,bVe(m,v,o[l]))}return a}function _Y(r,t,o){const a=new Map;for(const l of r){const d=l.transform,m=o.data.field(l.field);a.set(l.field,TVe(d,m,t))}return a}class dne extends KN{constructor(t,o){super(),this.key=t,this.precondition=o,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class AVe extends KN{constructor(t,o){super(),this.key=t,this.precondition=o,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OVe{constructor(t,o,a,l){this.batchId=t,this.localWriteTime=o,this.baseMutations=a,this.mutations=l}applyToRemoteDocument(t,o){const a=o.mutationResults;for(let l=0;l<this.mutations.length;l++){const d=this.mutations[l];d.key.isEqual(t.key)&&CVe(d,t,a[l])}}applyToLocalView(t,o){for(const a of this.baseMutations)a.key.isEqual(t.key)&&(o=Zb(a,t,o,this.localWriteTime));for(const a of this.mutations)a.key.isEqual(t.key)&&(o=Zb(a,t,o,this.localWriteTime));return o}applyToLocalDocumentSet(t,o){const a=rne();return this.mutations.forEach(l=>{const d=t.get(l.key),m=d.overlayedDocument;let v=this.applyToLocalView(m,d.mutatedFields);v=o.has(l.key)?null:v;const y=lne(m,v);y!==null&&a.set(l.key,y),m.isValidDocument()||m.convertToNoDocument(zn.min())}),a}keys(){return this.mutations.reduce((t,o)=>t.add(o.key),mr())}isEqual(t){return this.batchId===t.batchId&&pS(this.mutations,t.mutations,(o,a)=>mY(o,a))&&pS(this.baseMutations,t.baseMutations,(o,a)=>mY(o,a))}}class OF{constructor(t,o,a,l){this.batch=t,this.commitVersion=o,this.mutationResults=a,this.docVersions=l}static from(t,o,a){li(t.mutations.length===a.length);let l=function(){return _Ve}();const d=t.mutations;for(let m=0;m<d.length;m++)l=l.insert(d[m].key,a[m].version);return new OF(t,o,a,l)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PVe{constructor(t,o){this.largestBatchId=t,this.mutation=o}getKey(){return this.mutation.key}isEqual(t){return t!==null&&this.mutation===t.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NVe{constructor(t,o){this.count=t,this.unchangedNames=o}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Uo,Ir;function kVe(r){switch(r){default:return Vn();case st.CANCELLED:case st.UNKNOWN:case st.DEADLINE_EXCEEDED:case st.RESOURCE_EXHAUSTED:case st.INTERNAL:case st.UNAVAILABLE:case st.UNAUTHENTICATED:return!1;case st.INVALID_ARGUMENT:case st.NOT_FOUND:case st.ALREADY_EXISTS:case st.PERMISSION_DENIED:case st.FAILED_PRECONDITION:case st.ABORTED:case st.OUT_OF_RANGE:case st.UNIMPLEMENTED:case st.DATA_LOSS:return!0}}function hne(r){if(r===void 0)return Xf("GRPC error has no .code"),st.UNKNOWN;switch(r){case Uo.OK:return st.OK;case Uo.CANCELLED:return st.CANCELLED;case Uo.UNKNOWN:return st.UNKNOWN;case Uo.DEADLINE_EXCEEDED:return st.DEADLINE_EXCEEDED;case Uo.RESOURCE_EXHAUSTED:return st.RESOURCE_EXHAUSTED;case Uo.INTERNAL:return st.INTERNAL;case Uo.UNAVAILABLE:return st.UNAVAILABLE;case Uo.UNAUTHENTICATED:return st.UNAUTHENTICATED;case Uo.INVALID_ARGUMENT:return st.INVALID_ARGUMENT;case Uo.NOT_FOUND:return st.NOT_FOUND;case Uo.ALREADY_EXISTS:return st.ALREADY_EXISTS;case Uo.PERMISSION_DENIED:return st.PERMISSION_DENIED;case Uo.FAILED_PRECONDITION:return st.FAILED_PRECONDITION;case Uo.ABORTED:return st.ABORTED;case Uo.OUT_OF_RANGE:return st.OUT_OF_RANGE;case Uo.UNIMPLEMENTED:return st.UNIMPLEMENTED;case Uo.DATA_LOSS:return st.DATA_LOSS;default:return Vn()}}(Ir=Uo||(Uo={}))[Ir.OK=0]="OK",Ir[Ir.CANCELLED=1]="CANCELLED",Ir[Ir.UNKNOWN=2]="UNKNOWN",Ir[Ir.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Ir[Ir.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Ir[Ir.NOT_FOUND=5]="NOT_FOUND",Ir[Ir.ALREADY_EXISTS=6]="ALREADY_EXISTS",Ir[Ir.PERMISSION_DENIED=7]="PERMISSION_DENIED",Ir[Ir.UNAUTHENTICATED=16]="UNAUTHENTICATED",Ir[Ir.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Ir[Ir.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Ir[Ir.ABORTED=10]="ABORTED",Ir[Ir.OUT_OF_RANGE=11]="OUT_OF_RANGE",Ir[Ir.UNIMPLEMENTED=12]="UNIMPLEMENTED",Ir[Ir.INTERNAL=13]="INTERNAL",Ir[Ir.UNAVAILABLE=14]="UNAVAILABLE",Ir[Ir.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function DVe(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LVe=new z_([4294967295,4294967295],0);function vY(r){const t=DVe().encode(r),o=new Mte;return o.update(t),new Uint8Array(o.digest())}function EY(r){const t=new DataView(r.buffer),o=t.getUint32(0,!0),a=t.getUint32(4,!0),l=t.getUint32(8,!0),d=t.getUint32(12,!0);return[new z_([o,a],0),new z_([l,d],0)]}class PF{constructor(t,o,a){if(this.bitmap=t,this.padding=o,this.hashCount=a,o<0||o>=8)throw new Db(`Invalid padding: ${o}`);if(a<0)throw new Db(`Invalid hash count: ${a}`);if(t.length>0&&this.hashCount===0)throw new Db(`Invalid hash count: ${a}`);if(t.length===0&&o!==0)throw new Db(`Invalid padding when bitmap length is 0: ${o}`);this.Ie=8*t.length-o,this.Te=z_.fromNumber(this.Ie)}Ee(t,o,a){let l=t.add(o.multiply(z_.fromNumber(a)));return l.compare(LVe)===1&&(l=new z_([l.getBits(0),l.getBits(1)],0)),l.modulo(this.Te).toNumber()}de(t){return(this.bitmap[Math.floor(t/8)]&1<<t%8)!=0}mightContain(t){if(this.Ie===0)return!1;const o=vY(t),[a,l]=EY(o);for(let d=0;d<this.hashCount;d++){const m=this.Ee(a,l,d);if(!this.de(m))return!1}return!0}static create(t,o,a){const l=t%8==0?0:8-t%8,d=new Uint8Array(Math.ceil(t/8)),m=new PF(d,l,o);return a.forEach(v=>m.insert(v)),m}insert(t){if(this.Ie===0)return;const o=vY(t),[a,l]=EY(o);for(let d=0;d<this.hashCount;d++){const m=this.Ee(a,l,d);this.Ae(m)}}Ae(t){const o=Math.floor(t/8),a=t%8;this.bitmap[o]|=1<<a}}class Db extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $N{constructor(t,o,a,l,d){this.snapshotVersion=t,this.targetChanges=o,this.targetMismatches=a,this.documentUpdates=l,this.resolvedLimboDocuments=d}static createSynthesizedRemoteEventForCurrentChange(t,o,a){const l=new Map;return l.set(t,lR.createSynthesizedTargetChangeForCurrentChange(t,o,a)),new $N(zn.min(),l,new no(Br),Jf(),mr())}}class lR{constructor(t,o,a,l,d){this.resumeToken=t,this.current=o,this.addedDocuments=a,this.modifiedDocuments=l,this.removedDocuments=d}static createSynthesizedTargetChangeForCurrentChange(t,o,a){return new lR(a,o,mr(),mr(),mr())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gP{constructor(t,o,a,l){this.Re=t,this.removedTargetIds=o,this.key=a,this.Ve=l}}class fne{constructor(t,o){this.targetId=t,this.me=o}}class pne{constructor(t,o,a=qs.EMPTY_BYTE_STRING,l=null){this.state=t,this.targetIds=o,this.resumeToken=a,this.cause=l}}class yY{constructor(){this.fe=0,this.ge=TY(),this.pe=qs.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(t){t.approximateByteSize()>0&&(this.we=!0,this.pe=t)}ve(){let t=mr(),o=mr(),a=mr();return this.ge.forEach((l,d)=>{switch(d){case 0:t=t.add(l);break;case 2:o=o.add(l);break;case 1:a=a.add(l);break;default:Vn()}}),new lR(this.pe,this.ye,t,o,a)}Ce(){this.we=!1,this.ge=TY()}Fe(t,o){this.we=!0,this.ge=this.ge.insert(t,o)}Me(t){this.we=!0,this.ge=this.ge.remove(t)}xe(){this.fe+=1}Oe(){this.fe-=1,li(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class xVe{constructor(t){this.Le=t,this.Be=new Map,this.ke=Jf(),this.qe=SY(),this.Qe=new no(Br)}Ke(t){for(const o of t.Re)t.Ve&&t.Ve.isFoundDocument()?this.$e(o,t.Ve):this.Ue(o,t.key,t.Ve);for(const o of t.removedTargetIds)this.Ue(o,t.key,t.Ve)}We(t){this.forEachTarget(t,o=>{const a=this.Ge(o);switch(t.state){case 0:this.ze(o)&&a.De(t.resumeToken);break;case 1:a.Oe(),a.Se||a.Ce(),a.De(t.resumeToken);break;case 2:a.Oe(),a.Se||this.removeTarget(o);break;case 3:this.ze(o)&&(a.Ne(),a.De(t.resumeToken));break;case 4:this.ze(o)&&(this.je(o),a.De(t.resumeToken));break;default:Vn()}})}forEachTarget(t,o){t.targetIds.length>0?t.targetIds.forEach(o):this.Be.forEach((a,l)=>{this.ze(l)&&o(l)})}He(t){const o=t.targetId,a=t.me.count,l=this.Je(o);if(l){const d=l.target;if(bU(d))if(a===0){const m=new cn(d.path);this.Ue(o,m,Ea.newNoDocument(m,zn.min()))}else li(a===1);else{const m=this.Ye(o);if(m!==a){const v=this.Ze(t),y=v?this.Xe(v,t,m):1;if(y!==0){this.je(o);const b=y===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(o,b)}}}}}Ze(t){const o=t.me.unchangedNames;if(!o||!o.bits)return null;const{bits:{bitmap:a="",padding:l=0},hashCount:d=0}=o;let m,v;try{m=tv(a).toUint8Array()}catch(y){if(y instanceof Hte)return fS("Decoding the base64 bloom filter in existence filter failed ("+y.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw y}try{v=new PF(m,l,d)}catch(y){return fS(y instanceof Db?"BloomFilter error: ":"Applying bloom filter failed: ",y),null}return v.Ie===0?null:v}Xe(t,o,a){return o.me.count===a-this.nt(t,o.targetId)?0:2}nt(t,o){const a=this.Le.getRemoteKeysForTarget(o);let l=0;return a.forEach(d=>{const m=this.Le.tt(),v=`projects/${m.projectId}/databases/${m.database}/documents/${d.path.canonicalString()}`;t.mightContain(v)||(this.Ue(o,d,null),l++)}),l}rt(t){const o=new Map;this.Be.forEach((d,m)=>{const v=this.Je(m);if(v){if(d.current&&bU(v.target)){const y=new cn(v.target.path);this.ke.get(y)!==null||this.it(m,y)||this.Ue(m,y,Ea.newNoDocument(y,t))}d.be&&(o.set(m,d.ve()),d.Ce())}});let a=mr();this.qe.forEach((d,m)=>{let v=!0;m.forEachWhile(y=>{const b=this.Je(y);return!b||b.purpose==="TargetPurposeLimboResolution"||(v=!1,!1)}),v&&(a=a.add(d))}),this.ke.forEach((d,m)=>m.setReadTime(t));const l=new $N(t,o,this.Qe,this.ke,a);return this.ke=Jf(),this.qe=SY(),this.Qe=new no(Br),l}$e(t,o){if(!this.ze(t))return;const a=this.it(t,o.key)?2:0;this.Ge(t).Fe(o.key,a),this.ke=this.ke.insert(o.key,o),this.qe=this.qe.insert(o.key,this.st(o.key).add(t))}Ue(t,o,a){if(!this.ze(t))return;const l=this.Ge(t);this.it(t,o)?l.Fe(o,1):l.Me(o),this.qe=this.qe.insert(o,this.st(o).delete(t)),a&&(this.ke=this.ke.insert(o,a))}removeTarget(t){this.Be.delete(t)}Ye(t){const o=this.Ge(t).ve();return this.Le.getRemoteKeysForTarget(t).size+o.addedDocuments.size-o.removedDocuments.size}xe(t){this.Ge(t).xe()}Ge(t){let o=this.Be.get(t);return o||(o=new yY,this.Be.set(t,o)),o}st(t){let o=this.qe.get(t);return o||(o=new $s(Br),this.qe=this.qe.insert(t,o)),o}ze(t){const o=this.Je(t)!==null;return o||en("WatchChangeAggregator","Detected inactive target",t),o}Je(t){const o=this.Be.get(t);return o&&o.Se?null:this.Le.ot(t)}je(t){this.Be.set(t,new yY),this.Le.getRemoteKeysForTarget(t).forEach(o=>{this.Ue(t,o,null)})}it(t,o){return this.Le.getRemoteKeysForTarget(t).has(o)}}function SY(){return new no(cn.comparator)}function TY(){return new no(cn.comparator)}const MVe={asc:"ASCENDING",desc:"DESCENDING"},UVe={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},VVe={and:"AND",or:"OR"};class FVe{constructor(t,o){this.databaseId=t,this.useProto3Json=o}}function CU(r,t){return r.useProto3Json||jN(t)?t:{value:t}}function YP(r,t){return r.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function mne(r,t){return r.useProto3Json?t.toBase64():t.toUint8Array()}function jVe(r,t){return YP(r,t.toTimestamp())}function vh(r){return li(!!r),zn.fromTimestamp(function(o){const a=Lm(o);return new Zo(a.seconds,a.nanos)}(r))}function NF(r,t){return IU(r,t).canonicalString()}function IU(r,t){const o=function(l){return new wi(["projects",l.projectId,"databases",l.database])}(r).child("documents");return t===void 0?o:o.child(t)}function gne(r){const t=wi.fromString(r);return li(Sne(t)),t}function AU(r,t){return NF(r.databaseId,t.path)}function JM(r,t){const o=gne(t);if(o.get(1)!==r.databaseId.projectId)throw new Ut(st.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+o.get(1)+" vs "+r.databaseId.projectId);if(o.get(3)!==r.databaseId.database)throw new Ut(st.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+o.get(3)+" vs "+r.databaseId.database);return new cn(vne(o))}function _ne(r,t){return NF(r.databaseId,t)}function BVe(r){const t=gne(r);return t.length===4?wi.emptyPath():vne(t)}function OU(r){return new wi(["projects",r.databaseId.projectId,"databases",r.databaseId.database]).canonicalString()}function vne(r){return li(r.length>4&&r.get(4)==="documents"),r.popFirst(5)}function bY(r,t,o){return{name:AU(r,t),fields:o.value.mapValue.fields}}function WVe(r,t){let o;if("targetChange"in t){t.targetChange;const a=function(b){return b==="NO_CHANGE"?0:b==="ADD"?1:b==="REMOVE"?2:b==="CURRENT"?3:b==="RESET"?4:Vn()}(t.targetChange.targetChangeType||"NO_CHANGE"),l=t.targetChange.targetIds||[],d=function(b,R){return b.useProto3Json?(li(R===void 0||typeof R=="string"),qs.fromBase64String(R||"")):(li(R===void 0||R instanceof Buffer||R instanceof Uint8Array),qs.fromUint8Array(R||new Uint8Array))}(r,t.targetChange.resumeToken),m=t.targetChange.cause,v=m&&function(b){const R=b.code===void 0?st.UNKNOWN:hne(b.code);return new Ut(R,b.message||"")}(m);o=new pne(a,l,d,v||null)}else if("documentChange"in t){t.documentChange;const a=t.documentChange;a.document,a.document.name,a.document.updateTime;const l=JM(r,a.document.name),d=vh(a.document.updateTime),m=a.document.createTime?vh(a.document.createTime):zn.min(),v=new Oc({mapValue:{fields:a.document.fields}}),y=Ea.newFoundDocument(l,d,m,v),b=a.targetIds||[],R=a.removedTargetIds||[];o=new gP(b,R,y.key,y)}else if("documentDelete"in t){t.documentDelete;const a=t.documentDelete;a.document;const l=JM(r,a.document),d=a.readTime?vh(a.readTime):zn.min(),m=Ea.newNoDocument(l,d),v=a.removedTargetIds||[];o=new gP([],v,m.key,m)}else if("documentRemove"in t){t.documentRemove;const a=t.documentRemove;a.document;const l=JM(r,a.document),d=a.removedTargetIds||[];o=new gP([],d,l,null)}else{if(!("filter"in t))return Vn();{t.filter;const a=t.filter;a.targetId;const{count:l=0,unchangedNames:d}=a,m=new NVe(l,d),v=a.targetId;o=new fne(v,m)}}return o}function GVe(r,t){let o;if(t instanceof cR)o={update:bY(r,t.key,t.value)};else if(t instanceof dne)o={delete:AU(r,t.key)};else if(t instanceof Gm)o={update:bY(r,t.key,t.data),updateMask:QVe(t.fieldMask)};else{if(!(t instanceof AVe))return Vn();o={verify:AU(r,t.key)}}return t.fieldTransforms.length>0&&(o.updateTransforms=t.fieldTransforms.map(a=>function(d,m){const v=m.transform;if(v instanceof $P)return{fieldPath:m.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(v instanceof Nw)return{fieldPath:m.field.canonicalString(),appendMissingElements:{values:v.elements}};if(v instanceof kw)return{fieldPath:m.field.canonicalString(),removeAllFromArray:{values:v.elements}};if(v instanceof qP)return{fieldPath:m.field.canonicalString(),increment:v.Pe};throw Vn()}(0,a))),t.precondition.isNone||(o.currentDocument=function(l,d){return d.updateTime!==void 0?{updateTime:jVe(l,d.updateTime)}:d.exists!==void 0?{exists:d.exists}:Vn()}(r,t.precondition)),o}function zVe(r,t){return r&&r.length>0?(li(t!==void 0),r.map(o=>function(l,d){let m=l.updateTime?vh(l.updateTime):vh(d);return m.isEqual(zn.min())&&(m=vh(d)),new RVe(m,l.transformResults||[])}(o,t))):[]}function HVe(r,t){return{documents:[_ne(r,t.path)]}}function KVe(r,t){const o={structuredQuery:{}},a=t.path;let l;t.collectionGroup!==null?(l=a,o.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(l=a.popLast(),o.structuredQuery.from=[{collectionId:a.lastSegment()}]),o.parent=_ne(r,l);const d=function(b){if(b.length!==0)return yne(id.create(b,"and"))}(t.filters);d&&(o.structuredQuery.where=d);const m=function(b){if(b.length!==0)return b.map(R=>function(N){return{field:Cy(N.field),direction:YVe(N.dir)}}(R))}(t.orderBy);m&&(o.structuredQuery.orderBy=m);const v=CU(r,t.limit);return v!==null&&(o.structuredQuery.limit=v),t.startAt&&(o.structuredQuery.startAt=function(b){return{before:b.inclusive,values:b.position}}(t.startAt)),t.endAt&&(o.structuredQuery.endAt=function(b){return{before:!b.inclusive,values:b.position}}(t.endAt)),{_t:o,parent:l}}function $Ve(r){let t=BVe(r.parent);const o=r.structuredQuery,a=o.from?o.from.length:0;let l=null;if(a>0){li(a===1);const R=o.from[0];R.allDescendants?l=R.collectionId:t=t.child(R.collectionId)}let d=[];o.where&&(d=function(O){const N=Ene(O);return N instanceof id&&Yte(N)?N.getFilters():[N]}(o.where));let m=[];o.orderBy&&(m=function(O){return O.map(N=>function(H){return new Pw(Iy(H.field),function(z){switch(z){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(H.direction))}(N))}(o.orderBy));let v=null;o.limit&&(v=function(O){let N;return N=typeof O=="object"?O.value:O,jN(N)?null:N}(o.limit));let y=null;o.startAt&&(y=function(O){const N=!!O.before,F=O.values||[];return new _S(F,N)}(o.startAt));let b=null;return o.endAt&&(b=function(O){const N=!O.before,F=O.values||[];return new _S(F,N)}(o.endAt)),hVe(t,l,m,d,v,"F",y,b)}function qVe(r,t){const o=function(l){switch(l){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Vn()}}(t.purpose);return o==null?null:{"goog-listen-tags":o}}function Ene(r){return r.unaryFilter!==void 0?function(o){switch(o.unaryFilter.op){case"IS_NAN":const a=Iy(o.unaryFilter.field);return jo.create(a,"==",{doubleValue:NaN});case"IS_NULL":const l=Iy(o.unaryFilter.field);return jo.create(l,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const d=Iy(o.unaryFilter.field);return jo.create(d,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const m=Iy(o.unaryFilter.field);return jo.create(m,"!=",{nullValue:"NULL_VALUE"});default:return Vn()}}(r):r.fieldFilter!==void 0?function(o){return jo.create(Iy(o.fieldFilter.field),function(l){switch(l){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Vn()}}(o.fieldFilter.op),o.fieldFilter.value)}(r):r.compositeFilter!==void 0?function(o){return id.create(o.compositeFilter.filters.map(a=>Ene(a)),function(l){switch(l){case"AND":return"and";case"OR":return"or";default:return Vn()}}(o.compositeFilter.op))}(r):Vn()}function YVe(r){return MVe[r]}function XVe(r){return UVe[r]}function JVe(r){return VVe[r]}function Cy(r){return{fieldPath:r.canonicalString()}}function Iy(r){return Ks.fromServerFormat(r.fieldPath)}function yne(r){return r instanceof jo?function(o){if(o.op==="=="){if(lY(o.value))return{unaryFilter:{field:Cy(o.field),op:"IS_NAN"}};if(cY(o.value))return{unaryFilter:{field:Cy(o.field),op:"IS_NULL"}}}else if(o.op==="!="){if(lY(o.value))return{unaryFilter:{field:Cy(o.field),op:"IS_NOT_NAN"}};if(cY(o.value))return{unaryFilter:{field:Cy(o.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Cy(o.field),op:XVe(o.op),value:o.value}}}(r):r instanceof id?function(o){const a=o.getFilters().map(l=>yne(l));return a.length===1?a[0]:{compositeFilter:{op:JVe(o.op),filters:a}}}(r):Vn()}function QVe(r){const t=[];return r.fields.forEach(o=>t.push(o.canonicalString())),{fieldPaths:t}}function Sne(r){return r.length>=4&&r.get(0)==="projects"&&r.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ym{constructor(t,o,a,l,d=zn.min(),m=zn.min(),v=qs.EMPTY_BYTE_STRING,y=null){this.target=t,this.targetId=o,this.purpose=a,this.sequenceNumber=l,this.snapshotVersion=d,this.lastLimboFreeSnapshotVersion=m,this.resumeToken=v,this.expectedCount=y}withSequenceNumber(t){return new ym(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,o){return new ym(this.target,this.targetId,this.purpose,this.sequenceNumber,o,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new ym(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new ym(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZVe{constructor(t){this.ct=t}}function eFe(r){const t=$Ve({parent:r.parent,structuredQuery:r.structuredQuery});return r.limitType==="LAST"?RU(t,t.limit,"L"):t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tFe{constructor(){this.un=new nFe}addToCollectionParentIndex(t,o){return this.un.add(o),Tt.resolve()}getCollectionParents(t,o){return Tt.resolve(this.un.getEntries(o))}addFieldIndex(t,o){return Tt.resolve()}deleteFieldIndex(t,o){return Tt.resolve()}deleteAllFieldIndexes(t){return Tt.resolve()}createTargetIndexes(t,o){return Tt.resolve()}getDocumentsMatchingTarget(t,o){return Tt.resolve(null)}getIndexType(t,o){return Tt.resolve(0)}getFieldIndexes(t,o){return Tt.resolve([])}getNextCollectionGroupToUpdate(t){return Tt.resolve(null)}getMinOffset(t,o){return Tt.resolve(Dm.min())}getMinOffsetFromCollectionGroup(t,o){return Tt.resolve(Dm.min())}updateCollectionGroup(t,o,a){return Tt.resolve()}updateIndexEntries(t,o){return Tt.resolve()}}class nFe{constructor(){this.index={}}add(t){const o=t.lastSegment(),a=t.popLast(),l=this.index[o]||new $s(wi.comparator),d=!l.has(a);return this.index[o]=l.add(a),d}has(t){const o=t.lastSegment(),a=t.popLast(),l=this.index[o];return l&&l.has(a)}getEntries(t){return(this.index[t]||new $s(wi.comparator)).toArray()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vS{constructor(t){this.Ln=t}next(){return this.Ln+=2,this.Ln}static Bn(){return new vS(0)}static kn(){return new vS(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rFe{constructor(){this.changes=new kS(t=>t.toString(),(t,o)=>t.isEqual(o)),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,o){this.assertNotApplied(),this.changes.set(t,Ea.newInvalidDocument(t).setReadTime(o))}getEntry(t,o){this.assertNotApplied();const a=this.changes.get(o);return a!==void 0?Tt.resolve(a):this.getFromCache(t,o)}getEntries(t,o){return this.getAllFromCache(t,o)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iFe{constructor(t,o){this.overlayedDocument=t,this.mutatedFields=o}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oFe{constructor(t,o,a,l){this.remoteDocumentCache=t,this.mutationQueue=o,this.documentOverlayCache=a,this.indexManager=l}getDocument(t,o){let a=null;return this.documentOverlayCache.getOverlay(t,o).next(l=>(a=l,this.remoteDocumentCache.getEntry(t,o))).next(l=>(a!==null&&Zb(a.mutation,l,dl.empty(),Zo.now()),l))}getDocuments(t,o){return this.remoteDocumentCache.getEntries(t,o).next(a=>this.getLocalViewOfDocuments(t,a,mr()).next(()=>a))}getLocalViewOfDocuments(t,o,a=mr()){const l=L_();return this.populateOverlays(t,l,o).next(()=>this.computeViews(t,o,l,a).next(d=>{let m=kb();return d.forEach((v,y)=>{m=m.insert(v,y.overlayedDocument)}),m}))}getOverlayedDocuments(t,o){const a=L_();return this.populateOverlays(t,a,o).next(()=>this.computeViews(t,o,a,mr()))}populateOverlays(t,o,a){const l=[];return a.forEach(d=>{o.has(d)||l.push(d)}),this.documentOverlayCache.getOverlays(t,l).next(d=>{d.forEach((m,v)=>{o.set(m,v)})})}computeViews(t,o,a,l){let d=Jf();const m=Qb(),v=function(){return Qb()}();return o.forEach((y,b)=>{const R=a.get(b.key);l.has(b.key)&&(R===void 0||R.mutation instanceof Gm)?d=d.insert(b.key,b):R!==void 0?(m.set(b.key,R.mutation.getFieldMask()),Zb(R.mutation,b,R.mutation.getFieldMask(),Zo.now())):m.set(b.key,dl.empty())}),this.recalculateAndSaveOverlays(t,d).next(y=>(y.forEach((b,R)=>m.set(b,R)),o.forEach((b,R)=>{var O;return v.set(b,new iFe(R,(O=m.get(b))!==null&&O!==void 0?O:null))}),v))}recalculateAndSaveOverlays(t,o){const a=Qb();let l=new no((m,v)=>m-v),d=mr();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,o).next(m=>{for(const v of m)v.keys().forEach(y=>{const b=o.get(y);if(b===null)return;let R=a.get(y)||dl.empty();R=v.applyToLocalView(b,R),a.set(y,R);const O=(l.get(v.batchId)||mr()).add(y);l=l.insert(v.batchId,O)})}).next(()=>{const m=[],v=l.getReverseIterator();for(;v.hasNext();){const y=v.getNext(),b=y.key,R=y.value,O=rne();R.forEach(N=>{if(!d.has(N)){const F=lne(o.get(N),a.get(N));F!==null&&O.set(N,F),d=d.add(N)}}),m.push(this.documentOverlayCache.saveOverlays(t,b,O))}return Tt.waitFor(m)}).next(()=>a)}recalculateAndSaveOverlaysForDocumentKeys(t,o){return this.remoteDocumentCache.getEntries(t,o).next(a=>this.recalculateAndSaveOverlays(t,a))}getDocumentsMatchingQuery(t,o,a,l){return function(m){return cn.isDocumentKey(m.path)&&m.collectionGroup===null&&m.filters.length===0}(o)?this.getDocumentsMatchingDocumentQuery(t,o.path):IF(o)?this.getDocumentsMatchingCollectionGroupQuery(t,o,a,l):this.getDocumentsMatchingCollectionQuery(t,o,a,l)}getNextDocuments(t,o,a,l){return this.remoteDocumentCache.getAllFromCollectionGroup(t,o,a,l).next(d=>{const m=l-d.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,o,a.largestBatchId,l-d.size):Tt.resolve(L_());let v=-1,y=d;return m.next(b=>Tt.forEach(b,(R,O)=>(v<O.largestBatchId&&(v=O.largestBatchId),d.get(R)?Tt.resolve():this.remoteDocumentCache.getEntry(t,R).next(N=>{y=y.insert(R,N)}))).next(()=>this.populateOverlays(t,b,d)).next(()=>this.computeViews(t,y,b,mr())).next(R=>({batchId:v,changes:nne(R)})))})}getDocumentsMatchingDocumentQuery(t,o){return this.getDocument(t,new cn(o)).next(a=>{let l=kb();return a.isFoundDocument()&&(l=l.insert(a.key,a)),l})}getDocumentsMatchingCollectionGroupQuery(t,o,a,l){const d=o.collectionGroup;let m=kb();return this.indexManager.getCollectionParents(t,d).next(v=>Tt.forEach(v,y=>{const b=function(O,N){return new uv(N,null,O.explicitOrderBy.slice(),O.filters.slice(),O.limit,O.limitType,O.startAt,O.endAt)}(o,y.child(d));return this.getDocumentsMatchingCollectionQuery(t,b,a,l).next(R=>{R.forEach((O,N)=>{m=m.insert(O,N)})})}).next(()=>m))}getDocumentsMatchingCollectionQuery(t,o,a,l){let d;return this.documentOverlayCache.getOverlaysForCollection(t,o.path,a.largestBatchId).next(m=>(d=m,this.remoteDocumentCache.getDocumentsMatchingQuery(t,o,a,d,l))).next(m=>{d.forEach((y,b)=>{const R=b.getKey();m.get(R)===null&&(m=m.insert(R,Ea.newInvalidDocument(R)))});let v=kb();return m.forEach((y,b)=>{const R=d.get(y);R!==void 0&&Zb(R.mutation,b,dl.empty(),Zo.now()),zN(o,b)&&(v=v.insert(y,b))}),v})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sFe{constructor(t){this.serializer=t,this.hr=new Map,this.Pr=new Map}getBundleMetadata(t,o){return Tt.resolve(this.hr.get(o))}saveBundleMetadata(t,o){return this.hr.set(o.id,function(l){return{id:l.id,version:l.version,createTime:vh(l.createTime)}}(o)),Tt.resolve()}getNamedQuery(t,o){return Tt.resolve(this.Pr.get(o))}saveNamedQuery(t,o){return this.Pr.set(o.name,function(l){return{name:l.name,query:eFe(l.bundledQuery),readTime:vh(l.readTime)}}(o)),Tt.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aFe{constructor(){this.overlays=new no(cn.comparator),this.Ir=new Map}getOverlay(t,o){return Tt.resolve(this.overlays.get(o))}getOverlays(t,o){const a=L_();return Tt.forEach(o,l=>this.getOverlay(t,l).next(d=>{d!==null&&a.set(l,d)})).next(()=>a)}saveOverlays(t,o,a){return a.forEach((l,d)=>{this.ht(t,o,d)}),Tt.resolve()}removeOverlaysForBatchId(t,o,a){const l=this.Ir.get(a);return l!==void 0&&(l.forEach(d=>this.overlays=this.overlays.remove(d)),this.Ir.delete(a)),Tt.resolve()}getOverlaysForCollection(t,o,a){const l=L_(),d=o.length+1,m=new cn(o.child("")),v=this.overlays.getIteratorFrom(m);for(;v.hasNext();){const y=v.getNext().value,b=y.getKey();if(!o.isPrefixOf(b.path))break;b.path.length===d&&y.largestBatchId>a&&l.set(y.getKey(),y)}return Tt.resolve(l)}getOverlaysForCollectionGroup(t,o,a,l){let d=new no((b,R)=>b-R);const m=this.overlays.getIterator();for(;m.hasNext();){const b=m.getNext().value;if(b.getKey().getCollectionGroup()===o&&b.largestBatchId>a){let R=d.get(b.largestBatchId);R===null&&(R=L_(),d=d.insert(b.largestBatchId,R)),R.set(b.getKey(),b)}}const v=L_(),y=d.getIterator();for(;y.hasNext()&&(y.getNext().value.forEach((b,R)=>v.set(b,R)),!(v.size()>=l)););return Tt.resolve(v)}ht(t,o,a){const l=this.overlays.get(a.key);if(l!==null){const m=this.Ir.get(l.largestBatchId).delete(a.key);this.Ir.set(l.largestBatchId,m)}this.overlays=this.overlays.insert(a.key,new PVe(o,a));let d=this.Ir.get(o);d===void 0&&(d=mr(),this.Ir.set(o,d)),this.Ir.set(o,d.add(a.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cFe{constructor(){this.sessionToken=qs.EMPTY_BYTE_STRING}getSessionToken(t){return Tt.resolve(this.sessionToken)}setSessionToken(t,o){return this.sessionToken=o,Tt.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kF{constructor(){this.Tr=new $s(ps.Er),this.dr=new $s(ps.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(t,o){const a=new ps(t,o);this.Tr=this.Tr.add(a),this.dr=this.dr.add(a)}Rr(t,o){t.forEach(a=>this.addReference(a,o))}removeReference(t,o){this.Vr(new ps(t,o))}mr(t,o){t.forEach(a=>this.removeReference(a,o))}gr(t){const o=new cn(new wi([])),a=new ps(o,t),l=new ps(o,t+1),d=[];return this.dr.forEachInRange([a,l],m=>{this.Vr(m),d.push(m.key)}),d}pr(){this.Tr.forEach(t=>this.Vr(t))}Vr(t){this.Tr=this.Tr.delete(t),this.dr=this.dr.delete(t)}yr(t){const o=new cn(new wi([])),a=new ps(o,t),l=new ps(o,t+1);let d=mr();return this.dr.forEachInRange([a,l],m=>{d=d.add(m.key)}),d}containsKey(t){const o=new ps(t,0),a=this.Tr.firstAfterOrEqual(o);return a!==null&&t.isEqual(a.key)}}class ps{constructor(t,o){this.key=t,this.wr=o}static Er(t,o){return cn.comparator(t.key,o.key)||Br(t.wr,o.wr)}static Ar(t,o){return Br(t.wr,o.wr)||cn.comparator(t.key,o.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lFe{constructor(t,o){this.indexManager=t,this.referenceDelegate=o,this.mutationQueue=[],this.Sr=1,this.br=new $s(ps.Er)}checkEmpty(t){return Tt.resolve(this.mutationQueue.length===0)}addMutationBatch(t,o,a,l){const d=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const m=new OVe(d,o,a,l);this.mutationQueue.push(m);for(const v of l)this.br=this.br.add(new ps(v.key,d)),this.indexManager.addToCollectionParentIndex(t,v.key.path.popLast());return Tt.resolve(m)}lookupMutationBatch(t,o){return Tt.resolve(this.Dr(o))}getNextMutationBatchAfterBatchId(t,o){const a=o+1,l=this.vr(a),d=l<0?0:l;return Tt.resolve(this.mutationQueue.length>d?this.mutationQueue[d]:null)}getHighestUnacknowledgedBatchId(){return Tt.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(t){return Tt.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,o){const a=new ps(o,0),l=new ps(o,Number.POSITIVE_INFINITY),d=[];return this.br.forEachInRange([a,l],m=>{const v=this.Dr(m.wr);d.push(v)}),Tt.resolve(d)}getAllMutationBatchesAffectingDocumentKeys(t,o){let a=new $s(Br);return o.forEach(l=>{const d=new ps(l,0),m=new ps(l,Number.POSITIVE_INFINITY);this.br.forEachInRange([d,m],v=>{a=a.add(v.wr)})}),Tt.resolve(this.Cr(a))}getAllMutationBatchesAffectingQuery(t,o){const a=o.path,l=a.length+1;let d=a;cn.isDocumentKey(d)||(d=d.child(""));const m=new ps(new cn(d),0);let v=new $s(Br);return this.br.forEachWhile(y=>{const b=y.key.path;return!!a.isPrefixOf(b)&&(b.length===l&&(v=v.add(y.wr)),!0)},m),Tt.resolve(this.Cr(v))}Cr(t){const o=[];return t.forEach(a=>{const l=this.Dr(a);l!==null&&o.push(l)}),o}removeMutationBatch(t,o){li(this.Fr(o.batchId,"removed")===0),this.mutationQueue.shift();let a=this.br;return Tt.forEach(o.mutations,l=>{const d=new ps(l.key,o.batchId);return a=a.delete(d),this.referenceDelegate.markPotentiallyOrphaned(t,l.key)}).next(()=>{this.br=a})}On(t){}containsKey(t,o){const a=new ps(o,0),l=this.br.firstAfterOrEqual(a);return Tt.resolve(o.isEqual(l&&l.key))}performConsistencyCheck(t){return this.mutationQueue.length,Tt.resolve()}Fr(t,o){return this.vr(t)}vr(t){return this.mutationQueue.length===0?0:t-this.mutationQueue[0].batchId}Dr(t){const o=this.vr(t);return o<0||o>=this.mutationQueue.length?null:this.mutationQueue[o]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uFe{constructor(t){this.Mr=t,this.docs=function(){return new no(cn.comparator)}(),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,o){const a=o.key,l=this.docs.get(a),d=l?l.size:0,m=this.Mr(o);return this.docs=this.docs.insert(a,{document:o.mutableCopy(),size:m}),this.size+=m-d,this.indexManager.addToCollectionParentIndex(t,a.path.popLast())}removeEntry(t){const o=this.docs.get(t);o&&(this.docs=this.docs.remove(t),this.size-=o.size)}getEntry(t,o){const a=this.docs.get(o);return Tt.resolve(a?a.document.mutableCopy():Ea.newInvalidDocument(o))}getEntries(t,o){let a=Jf();return o.forEach(l=>{const d=this.docs.get(l);a=a.insert(l,d?d.document.mutableCopy():Ea.newInvalidDocument(l))}),Tt.resolve(a)}getDocumentsMatchingQuery(t,o,a,l){let d=Jf();const m=o.path,v=new cn(m.child("")),y=this.docs.getIteratorFrom(v);for(;y.hasNext();){const{key:b,value:{document:R}}=y.getNext();if(!m.isPrefixOf(b.path))break;b.path.length>m.length+1||$Ue(KUe(R),a)<=0||(l.has(R.key)||zN(o,R))&&(d=d.insert(R.key,R.mutableCopy()))}return Tt.resolve(d)}getAllFromCollectionGroup(t,o,a,l){Vn()}Or(t,o){return Tt.forEach(this.docs,a=>o(a))}newChangeBuffer(t){return new dFe(this)}getSize(t){return Tt.resolve(this.size)}}class dFe extends rFe{constructor(t){super(),this.cr=t}applyChanges(t){const o=[];return this.changes.forEach((a,l)=>{l.isValidDocument()?o.push(this.cr.addEntry(t,l)):this.cr.removeEntry(a)}),Tt.waitFor(o)}getFromCache(t,o){return this.cr.getEntry(t,o)}getAllFromCache(t,o){return this.cr.getEntries(t,o)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hFe{constructor(t){this.persistence=t,this.Nr=new kS(o=>RF(o),CF),this.lastRemoteSnapshotVersion=zn.min(),this.highestTargetId=0,this.Lr=0,this.Br=new kF,this.targetCount=0,this.kr=vS.Bn()}forEachTarget(t,o){return this.Nr.forEach((a,l)=>o(l)),Tt.resolve()}getLastRemoteSnapshotVersion(t){return Tt.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return Tt.resolve(this.Lr)}allocateTargetId(t){return this.highestTargetId=this.kr.next(),Tt.resolve(this.highestTargetId)}setTargetsMetadata(t,o,a){return a&&(this.lastRemoteSnapshotVersion=a),o>this.Lr&&(this.Lr=o),Tt.resolve()}Kn(t){this.Nr.set(t.target,t);const o=t.targetId;o>this.highestTargetId&&(this.kr=new vS(o),this.highestTargetId=o),t.sequenceNumber>this.Lr&&(this.Lr=t.sequenceNumber)}addTargetData(t,o){return this.Kn(o),this.targetCount+=1,Tt.resolve()}updateTargetData(t,o){return this.Kn(o),Tt.resolve()}removeTargetData(t,o){return this.Nr.delete(o.target),this.Br.gr(o.targetId),this.targetCount-=1,Tt.resolve()}removeTargets(t,o,a){let l=0;const d=[];return this.Nr.forEach((m,v)=>{v.sequenceNumber<=o&&a.get(v.targetId)===null&&(this.Nr.delete(m),d.push(this.removeMatchingKeysForTargetId(t,v.targetId)),l++)}),Tt.waitFor(d).next(()=>l)}getTargetCount(t){return Tt.resolve(this.targetCount)}getTargetData(t,o){const a=this.Nr.get(o)||null;return Tt.resolve(a)}addMatchingKeys(t,o,a){return this.Br.Rr(o,a),Tt.resolve()}removeMatchingKeys(t,o,a){this.Br.mr(o,a);const l=this.persistence.referenceDelegate,d=[];return l&&o.forEach(m=>{d.push(l.markPotentiallyOrphaned(t,m))}),Tt.waitFor(d)}removeMatchingKeysForTargetId(t,o){return this.Br.gr(o),Tt.resolve()}getMatchingKeysForTargetId(t,o){const a=this.Br.yr(o);return Tt.resolve(a)}containsKey(t,o){return Tt.resolve(this.Br.containsKey(o))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fFe{constructor(t,o){this.qr={},this.overlays={},this.Qr=new TF(0),this.Kr=!1,this.Kr=!0,this.$r=new cFe,this.referenceDelegate=t(this),this.Ur=new hFe(this),this.indexManager=new tFe,this.remoteDocumentCache=function(l){return new uFe(l)}(a=>this.referenceDelegate.Wr(a)),this.serializer=new ZVe(o),this.Gr=new sFe(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let o=this.overlays[t.toKey()];return o||(o=new aFe,this.overlays[t.toKey()]=o),o}getMutationQueue(t,o){let a=this.qr[t.toKey()];return a||(a=new lFe(o,this.referenceDelegate),this.qr[t.toKey()]=a),a}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(t,o,a){en("MemoryPersistence","Starting transaction:",t);const l=new pFe(this.Qr.next());return this.referenceDelegate.zr(),a(l).next(d=>this.referenceDelegate.jr(l).next(()=>d)).toPromise().then(d=>(l.raiseOnCommittedEvent(),d))}Hr(t,o){return Tt.or(Object.values(this.qr).map(a=>()=>a.containsKey(t,o)))}}class pFe extends YUe{constructor(t){super(),this.currentSequenceNumber=t}}class DF{constructor(t){this.persistence=t,this.Jr=new kF,this.Yr=null}static Zr(t){return new DF(t)}get Xr(){if(this.Yr)return this.Yr;throw Vn()}addReference(t,o,a){return this.Jr.addReference(a,o),this.Xr.delete(a.toString()),Tt.resolve()}removeReference(t,o,a){return this.Jr.removeReference(a,o),this.Xr.add(a.toString()),Tt.resolve()}markPotentiallyOrphaned(t,o){return this.Xr.add(o.toString()),Tt.resolve()}removeTarget(t,o){this.Jr.gr(o.targetId).forEach(l=>this.Xr.add(l.toString()));const a=this.persistence.getTargetCache();return a.getMatchingKeysForTargetId(t,o.targetId).next(l=>{l.forEach(d=>this.Xr.add(d.toString()))}).next(()=>a.removeTargetData(t,o))}zr(){this.Yr=new Set}jr(t){const o=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Tt.forEach(this.Xr,a=>{const l=cn.fromPath(a);return this.ei(t,l).next(d=>{d||o.removeEntry(l,zn.min())})}).next(()=>(this.Yr=null,o.apply(t)))}updateLimboDocument(t,o){return this.ei(t,o).next(a=>{a?this.Xr.delete(o.toString()):this.Xr.add(o.toString())})}Wr(t){return 0}ei(t,o){return Tt.or([()=>Tt.resolve(this.Jr.containsKey(o)),()=>this.persistence.getTargetCache().containsKey(t,o),()=>this.persistence.Hr(t,o)])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LF{constructor(t,o,a,l){this.targetId=t,this.fromCache=o,this.$i=a,this.Ui=l}static Wi(t,o){let a=mr(),l=mr();for(const d of o.docChanges)switch(d.type){case 0:a=a.add(d.doc.key);break;case 1:l=l.add(d.doc.key)}return new LF(t,o.fromCache,a,l)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mFe{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gFe{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return axe()?8:XUe(ba())>0?6:4}()}initialize(t,o){this.Ji=t,this.indexManager=o,this.Gi=!0}getDocumentsMatchingQuery(t,o,a,l){const d={result:null};return this.Yi(t,o).next(m=>{d.result=m}).next(()=>{if(!d.result)return this.Zi(t,o,l,a).next(m=>{d.result=m})}).next(()=>{if(d.result)return;const m=new mFe;return this.Xi(t,o,m).next(v=>{if(d.result=v,this.zi)return this.es(t,o,m,v.size)})}).next(()=>d.result)}es(t,o,a,l){return a.documentReadCount<this.ji?(ab()<=br.DEBUG&&en("QueryEngine","SDK will not create cache indexes for query:",Ry(o),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),Tt.resolve()):(ab()<=br.DEBUG&&en("QueryEngine","Query:",Ry(o),"scans",a.documentReadCount,"local documents and returns",l,"documents as results."),a.documentReadCount>this.Hi*l?(ab()<=br.DEBUG&&en("QueryEngine","The SDK decides to create cache indexes for query:",Ry(o),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,gh(o))):Tt.resolve())}Yi(t,o){if(fY(o))return Tt.resolve(null);let a=gh(o);return this.indexManager.getIndexType(t,a).next(l=>l===0?null:(o.limit!==null&&l===1&&(o=RU(o,null,"F"),a=gh(o)),this.indexManager.getDocumentsMatchingTarget(t,a).next(d=>{const m=mr(...d);return this.Ji.getDocuments(t,m).next(v=>this.indexManager.getMinOffset(t,a).next(y=>{const b=this.ts(o,v);return this.ns(o,b,m,y.readTime)?this.Yi(t,RU(o,null,"F")):this.rs(t,b,o,y)}))})))}Zi(t,o,a,l){return fY(o)||l.isEqual(zn.min())?Tt.resolve(null):this.Ji.getDocuments(t,a).next(d=>{const m=this.ts(o,d);return this.ns(o,m,a,l)?Tt.resolve(null):(ab()<=br.DEBUG&&en("QueryEngine","Re-using previous result from %s to execute query: %s",l.toString(),Ry(o)),this.rs(t,m,o,HUe(l,-1)).next(v=>v))})}ts(t,o){let a=new $s(ene(t));return o.forEach((l,d)=>{zN(t,d)&&(a=a.add(d))}),a}ns(t,o,a,l){if(t.limit===null)return!1;if(a.size!==o.size)return!0;const d=t.limitType==="F"?o.last():o.first();return!!d&&(d.hasPendingWrites||d.version.compareTo(l)>0)}Xi(t,o,a){return ab()<=br.DEBUG&&en("QueryEngine","Using full collection scan to execute query:",Ry(o)),this.Ji.getDocumentsMatchingQuery(t,o,Dm.min(),a)}rs(t,o,a,l){return this.Ji.getDocumentsMatchingQuery(t,a,l).next(d=>(o.forEach(m=>{d=d.insert(m.key,m)}),d))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _Fe{constructor(t,o,a,l){this.persistence=t,this.ss=o,this.serializer=l,this.os=new no(Br),this._s=new kS(d=>RF(d),CF),this.us=new Map,this.cs=t.getRemoteDocumentCache(),this.Ur=t.getTargetCache(),this.Gr=t.getBundleCache(),this.ls(a)}ls(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new oFe(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",o=>t.collect(o,this.os))}}function vFe(r,t,o,a){return new _Fe(r,t,o,a)}async function Tne(r,t){const o=Hn(r);return await o.persistence.runTransaction("Handle user change","readonly",a=>{let l;return o.mutationQueue.getAllMutationBatches(a).next(d=>(l=d,o.ls(t),o.mutationQueue.getAllMutationBatches(a))).next(d=>{const m=[],v=[];let y=mr();for(const b of l){m.push(b.batchId);for(const R of b.mutations)y=y.add(R.key)}for(const b of d){v.push(b.batchId);for(const R of b.mutations)y=y.add(R.key)}return o.localDocuments.getDocuments(a,y).next(b=>({hs:b,removedBatchIds:m,addedBatchIds:v}))})})}function EFe(r,t){const o=Hn(r);return o.persistence.runTransaction("Acknowledge batch","readwrite-primary",a=>{const l=t.batch.keys(),d=o.cs.newChangeBuffer({trackRemovals:!0});return function(v,y,b,R){const O=b.batch,N=O.keys();let F=Tt.resolve();return N.forEach(H=>{F=F.next(()=>R.getEntry(y,H)).next(G=>{const z=b.docVersions.get(H);li(z!==null),G.version.compareTo(z)<0&&(O.applyToRemoteDocument(G,b),G.isValidDocument()&&(G.setReadTime(b.commitVersion),R.addEntry(G)))})}),F.next(()=>v.mutationQueue.removeMutationBatch(y,O))}(o,a,t,d).next(()=>d.apply(a)).next(()=>o.mutationQueue.performConsistencyCheck(a)).next(()=>o.documentOverlayCache.removeOverlaysForBatchId(a,l,t.batch.batchId)).next(()=>o.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(a,function(v){let y=mr();for(let b=0;b<v.mutationResults.length;++b)v.mutationResults[b].transformResults.length>0&&(y=y.add(v.batch.mutations[b].key));return y}(t))).next(()=>o.localDocuments.getDocuments(a,l))})}function bne(r){const t=Hn(r);return t.persistence.runTransaction("Get last remote snapshot version","readonly",o=>t.Ur.getLastRemoteSnapshotVersion(o))}function yFe(r,t){const o=Hn(r),a=t.snapshotVersion;let l=o.os;return o.persistence.runTransaction("Apply remote event","readwrite-primary",d=>{const m=o.cs.newChangeBuffer({trackRemovals:!0});l=o.os;const v=[];t.targetChanges.forEach((R,O)=>{const N=l.get(O);if(!N)return;v.push(o.Ur.removeMatchingKeys(d,R.removedDocuments,O).next(()=>o.Ur.addMatchingKeys(d,R.addedDocuments,O)));let F=N.withSequenceNumber(d.currentSequenceNumber);t.targetMismatches.get(O)!==null?F=F.withResumeToken(qs.EMPTY_BYTE_STRING,zn.min()).withLastLimboFreeSnapshotVersion(zn.min()):R.resumeToken.approximateByteSize()>0&&(F=F.withResumeToken(R.resumeToken,a)),l=l.insert(O,F),function(G,z,ne){return G.resumeToken.approximateByteSize()===0||z.snapshotVersion.toMicroseconds()-G.snapshotVersion.toMicroseconds()>=3e8?!0:ne.addedDocuments.size+ne.modifiedDocuments.size+ne.removedDocuments.size>0}(N,F,R)&&v.push(o.Ur.updateTargetData(d,F))});let y=Jf(),b=mr();if(t.documentUpdates.forEach(R=>{t.resolvedLimboDocuments.has(R)&&v.push(o.persistence.referenceDelegate.updateLimboDocument(d,R))}),v.push(SFe(d,m,t.documentUpdates).next(R=>{y=R.Ps,b=R.Is})),!a.isEqual(zn.min())){const R=o.Ur.getLastRemoteSnapshotVersion(d).next(O=>o.Ur.setTargetsMetadata(d,d.currentSequenceNumber,a));v.push(R)}return Tt.waitFor(v).next(()=>m.apply(d)).next(()=>o.localDocuments.getLocalViewOfDocuments(d,y,b)).next(()=>y)}).then(d=>(o.os=l,d))}function SFe(r,t,o){let a=mr(),l=mr();return o.forEach(d=>a=a.add(d)),t.getEntries(r,a).next(d=>{let m=Jf();return o.forEach((v,y)=>{const b=d.get(v);y.isFoundDocument()!==b.isFoundDocument()&&(l=l.add(v)),y.isNoDocument()&&y.version.isEqual(zn.min())?(t.removeEntry(v,y.readTime),m=m.insert(v,y)):!b.isValidDocument()||y.version.compareTo(b.version)>0||y.version.compareTo(b.version)===0&&b.hasPendingWrites?(t.addEntry(y),m=m.insert(v,y)):en("LocalStore","Ignoring outdated watch update for ",v,". Current version:",b.version," Watch version:",y.version)}),{Ps:m,Is:l}})}function TFe(r,t){const o=Hn(r);return o.persistence.runTransaction("Get next mutation batch","readonly",a=>(t===void 0&&(t=-1),o.mutationQueue.getNextMutationBatchAfterBatchId(a,t)))}function bFe(r,t){const o=Hn(r);return o.persistence.runTransaction("Allocate target","readwrite",a=>{let l;return o.Ur.getTargetData(a,t).next(d=>d?(l=d,Tt.resolve(l)):o.Ur.allocateTargetId(a).next(m=>(l=new ym(t,m,"TargetPurposeListen",a.currentSequenceNumber),o.Ur.addTargetData(a,l).next(()=>l))))}).then(a=>{const l=o.os.get(a.targetId);return(l===null||a.snapshotVersion.compareTo(l.snapshotVersion)>0)&&(o.os=o.os.insert(a.targetId,a),o._s.set(t,a.targetId)),a})}async function PU(r,t,o){const a=Hn(r),l=a.os.get(t),d=o?"readwrite":"readwrite-primary";try{o||await a.persistence.runTransaction("Release target",d,m=>a.persistence.referenceDelegate.removeTarget(m,l))}catch(m){if(!aR(m))throw m;en("LocalStore",`Failed to update sequence numbers for target ${t}: ${m}`)}a.os=a.os.remove(t),a._s.delete(l.target)}function wY(r,t,o){const a=Hn(r);let l=zn.min(),d=mr();return a.persistence.runTransaction("Execute query","readwrite",m=>function(y,b,R){const O=Hn(y),N=O._s.get(R);return N!==void 0?Tt.resolve(O.os.get(N)):O.Ur.getTargetData(b,R)}(a,m,gh(t)).next(v=>{if(v)return l=v.lastLimboFreeSnapshotVersion,a.Ur.getMatchingKeysForTargetId(m,v.targetId).next(y=>{d=y})}).next(()=>a.ss.getDocumentsMatchingQuery(m,t,o?l:zn.min(),o?d:mr())).next(v=>(wFe(a,pVe(t),v),{documents:v,Ts:d})))}function wFe(r,t,o){let a=r.us.get(t)||zn.min();o.forEach((l,d)=>{d.readTime.compareTo(a)>0&&(a=d.readTime)}),r.us.set(t,a)}class RY{constructor(){this.activeTargetIds=yVe()}fs(t){this.activeTargetIds=this.activeTargetIds.add(t)}gs(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Vs(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class RFe{constructor(){this.so=new RY,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,o,a){}addLocalQueryTarget(t,o=!0){return o&&this.so.fs(t),this.oo[t]||"not-current"}updateQueryState(t,o,a){this.oo[t]=o}removeLocalQueryTarget(t){this.so.gs(t)}isLocalQueryTarget(t){return this.so.activeTargetIds.has(t)}clearQueryState(t){delete this.oo[t]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(t){return this.so.activeTargetIds.has(t)}start(){return this.so=new RY,Promise.resolve()}handleUserChange(t,o,a){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CFe{_o(t){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CY{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(t){this.ho.push(t)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){en("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const t of this.ho)t(0)}lo(){en("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const t of this.ho)t(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let kO=null;function QM(){return kO===null?kO=function(){return 268435456+Math.round(2147483648*Math.random())}():kO++,"0x"+kO.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IFe={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AFe{constructor(t){this.Io=t.Io,this.To=t.To}Eo(t){this.Ao=t}Ro(t){this.Vo=t}mo(t){this.fo=t}onMessage(t){this.po=t}close(){this.To()}send(t){this.Io(t)}yo(){this.Ao()}wo(){this.Vo()}So(t){this.fo(t)}bo(t){this.po(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ma="WebChannelConnection";class OFe extends class{constructor(o){this.databaseInfo=o,this.databaseId=o.databaseId;const a=o.ssl?"https":"http",l=encodeURIComponent(this.databaseId.projectId),d=encodeURIComponent(this.databaseId.database);this.Do=a+"://"+o.host,this.vo=`projects/${l}/databases/${d}`,this.Co=this.databaseId.database==="(default)"?`project_id=${l}`:`project_id=${l}&database_id=${d}`}get Fo(){return!1}Mo(o,a,l,d,m){const v=QM(),y=this.xo(o,a.toUriEncodedString());en("RestConnection",`Sending RPC '${o}' ${v}:`,y,l);const b={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(b,d,m),this.No(o,y,b,l).then(R=>(en("RestConnection",`Received RPC '${o}' ${v}: `,R),R),R=>{throw fS("RestConnection",`RPC '${o}' ${v} failed with error: `,R,"url: ",y,"request:",l),R})}Lo(o,a,l,d,m,v){return this.Mo(o,a,l,d,m)}Oo(o,a,l){o["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+NS}(),o["Content-Type"]="text/plain",this.databaseInfo.appId&&(o["X-Firebase-GMPID"]=this.databaseInfo.appId),a&&a.headers.forEach((d,m)=>o[m]=d),l&&l.headers.forEach((d,m)=>o[m]=d)}xo(o,a){const l=IFe[o];return`${this.Do}/v1/${a}:${l}`}terminate(){}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}No(t,o,a,l){const d=QM();return new Promise((m,v)=>{const y=new Ute;y.setWithCredentials(!0),y.listenOnce(Vte.COMPLETE,()=>{try{switch(y.getLastErrorCode()){case fP.NO_ERROR:const R=y.getResponseJson();en(ma,`XHR for RPC '${t}' ${d} received:`,JSON.stringify(R)),m(R);break;case fP.TIMEOUT:en(ma,`RPC '${t}' ${d} timed out`),v(new Ut(st.DEADLINE_EXCEEDED,"Request time out"));break;case fP.HTTP_ERROR:const O=y.getStatus();if(en(ma,`RPC '${t}' ${d} failed with status:`,O,"response text:",y.getResponseText()),O>0){let N=y.getResponseJson();Array.isArray(N)&&(N=N[0]);const F=N==null?void 0:N.error;if(F&&F.status&&F.message){const H=function(z){const ne=z.toLowerCase().replace(/_/g,"-");return Object.values(st).indexOf(ne)>=0?ne:st.UNKNOWN}(F.status);v(new Ut(H,F.message))}else v(new Ut(st.UNKNOWN,"Server responded with status "+y.getStatus()))}else v(new Ut(st.UNAVAILABLE,"Connection failed."));break;default:Vn()}}finally{en(ma,`RPC '${t}' ${d} completed.`)}});const b=JSON.stringify(l);en(ma,`RPC '${t}' ${d} sending request:`,l),y.send(o,"POST",b,a,15)})}Bo(t,o,a){const l=QM(),d=[this.Do,"/","google.firestore.v1.Firestore","/",t,"/channel"],m=Bte(),v=jte(),y={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},b=this.longPollingOptions.timeoutSeconds;b!==void 0&&(y.longPollingTimeout=Math.round(1e3*b)),this.useFetchStreams&&(y.useFetchStreams=!0),this.Oo(y.initMessageHeaders,o,a),y.encodeInitMessageHeaders=!0;const R=d.join("");en(ma,`Creating RPC '${t}' stream ${l}: ${R}`,y);const O=m.createWebChannel(R,y);let N=!1,F=!1;const H=new AFe({Io:z=>{F?en(ma,`Not sending because RPC '${t}' stream ${l} is closed:`,z):(N||(en(ma,`Opening RPC '${t}' stream ${l} transport.`),O.open(),N=!0),en(ma,`RPC '${t}' stream ${l} sending:`,z),O.send(z))},To:()=>O.close()}),G=(z,ne,J)=>{z.listen(ne,oe=>{try{J(oe)}catch(se){setTimeout(()=>{throw se},0)}})};return G(O,Nb.EventType.OPEN,()=>{F||(en(ma,`RPC '${t}' stream ${l} transport opened.`),H.yo())}),G(O,Nb.EventType.CLOSE,()=>{F||(F=!0,en(ma,`RPC '${t}' stream ${l} transport closed`),H.So())}),G(O,Nb.EventType.ERROR,z=>{F||(F=!0,fS(ma,`RPC '${t}' stream ${l} transport errored:`,z),H.So(new Ut(st.UNAVAILABLE,"The operation could not be completed")))}),G(O,Nb.EventType.MESSAGE,z=>{var ne;if(!F){const J=z.data[0];li(!!J);const oe=J,se=oe.error||((ne=oe[0])===null||ne===void 0?void 0:ne.error);if(se){en(ma,`RPC '${t}' stream ${l} received error:`,se);const ae=se.status;let ye=function(re){const le=Uo[re];if(le!==void 0)return hne(le)}(ae),Q=se.message;ye===void 0&&(ye=st.INTERNAL,Q="Unknown error status: "+ae+" with message "+se.message),F=!0,H.So(new Ut(ye,Q)),O.close()}else en(ma,`RPC '${t}' stream ${l} received:`,J),H.bo(J)}}),G(v,Fte.STAT_EVENT,z=>{z.stat===EU.PROXY?en(ma,`RPC '${t}' stream ${l} detected buffering proxy`):z.stat===EU.NOPROXY&&en(ma,`RPC '${t}' stream ${l} detected no buffering proxy`)}),setTimeout(()=>{H.wo()},0),H}}function ZM(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qN(r){return new FVe(r,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wne{constructor(t,o,a=1e3,l=1.5,d=6e4){this.ui=t,this.timerId=o,this.ko=a,this.qo=l,this.Qo=d,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(t){this.cancel();const o=Math.floor(this.Ko+this.zo()),a=Math.max(0,Date.now()-this.Uo),l=Math.max(0,o-a);l>0&&en("ExponentialBackoff",`Backing off for ${l} ms (base delay: ${this.Ko} ms, delay with jitter: ${o} ms, last attempt: ${a} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,l,()=>(this.Uo=Date.now(),t())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rne{constructor(t,o,a,l,d,m,v,y){this.ui=t,this.Ho=a,this.Jo=l,this.connection=d,this.authCredentialsProvider=m,this.appCheckCredentialsProvider=v,this.listener=y,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new wne(t,o)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(t){this.u_(),this.stream.send(t)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(t,o){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,t!==4?this.t_.reset():o&&o.code===st.RESOURCE_EXHAUSTED?(Xf(o.toString()),Xf("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):o&&o.code===st.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=t,await this.listener.mo(o)}l_(){}auth(){this.state=1;const t=this.h_(this.Yo),o=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([a,l])=>{this.Yo===o&&this.P_(a,l)},a=>{t(()=>{const l=new Ut(st.UNKNOWN,"Fetching auth token failed: "+a.message);return this.I_(l)})})}P_(t,o){const a=this.h_(this.Yo);this.stream=this.T_(t,o),this.stream.Eo(()=>{a(()=>this.listener.Eo())}),this.stream.Ro(()=>{a(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(l=>{a(()=>this.I_(l))}),this.stream.onMessage(l=>{a(()=>++this.e_==1?this.E_(l):this.onNext(l))})}i_(){this.state=5,this.t_.Go(async()=>{this.state=0,this.start()})}I_(t){return en("PersistentStream",`close with error: ${t}`),this.stream=null,this.close(4,t)}h_(t){return o=>{this.ui.enqueueAndForget(()=>this.Yo===t?o():(en("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class PFe extends Rne{constructor(t,o,a,l,d,m){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",o,a,l,m),this.serializer=d}T_(t,o){return this.connection.Bo("Listen",t,o)}E_(t){return this.onNext(t)}onNext(t){this.t_.reset();const o=WVe(this.serializer,t),a=function(d){if(!("targetChange"in d))return zn.min();const m=d.targetChange;return m.targetIds&&m.targetIds.length?zn.min():m.readTime?vh(m.readTime):zn.min()}(t);return this.listener.d_(o,a)}A_(t){const o={};o.database=OU(this.serializer),o.addTarget=function(d,m){let v;const y=m.target;if(v=bU(y)?{documents:HVe(d,y)}:{query:KVe(d,y)._t},v.targetId=m.targetId,m.resumeToken.approximateByteSize()>0){v.resumeToken=mne(d,m.resumeToken);const b=CU(d,m.expectedCount);b!==null&&(v.expectedCount=b)}else if(m.snapshotVersion.compareTo(zn.min())>0){v.readTime=YP(d,m.snapshotVersion.toTimestamp());const b=CU(d,m.expectedCount);b!==null&&(v.expectedCount=b)}return v}(this.serializer,t);const a=qVe(this.serializer,t);a&&(o.labels=a),this.a_(o)}R_(t){const o={};o.database=OU(this.serializer),o.removeTarget=t,this.a_(o)}}class NFe extends Rne{constructor(t,o,a,l,d,m){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",o,a,l,m),this.serializer=d}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(t,o){return this.connection.Bo("Write",t,o)}E_(t){return li(!!t.streamToken),this.lastStreamToken=t.streamToken,li(!t.writeResults||t.writeResults.length===0),this.listener.f_()}onNext(t){li(!!t.streamToken),this.lastStreamToken=t.streamToken,this.t_.reset();const o=zVe(t.writeResults,t.commitTime),a=vh(t.commitTime);return this.listener.g_(a,o)}p_(){const t={};t.database=OU(this.serializer),this.a_(t)}m_(t){const o={streamToken:this.lastStreamToken,writes:t.map(a=>GVe(this.serializer,a))};this.a_(o)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kFe extends class{}{constructor(t,o,a,l){super(),this.authCredentials=t,this.appCheckCredentials=o,this.connection=a,this.serializer=l,this.y_=!1}w_(){if(this.y_)throw new Ut(st.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(t,o,a,l){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([d,m])=>this.connection.Mo(t,IU(o,a),l,d,m)).catch(d=>{throw d.name==="FirebaseError"?(d.code===st.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),d):new Ut(st.UNKNOWN,d.toString())})}Lo(t,o,a,l,d){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([m,v])=>this.connection.Lo(t,IU(o,a),l,m,v,d)).catch(m=>{throw m.name==="FirebaseError"?(m.code===st.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),m):new Ut(st.UNKNOWN,m.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class DFe{constructor(t,o){this.asyncQueue=t,this.onlineStateHandler=o,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(t){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.C_("Offline")))}set(t){this.x_(),this.S_=0,t==="Online"&&(this.D_=!1),this.C_(t)}C_(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}F_(t){const o=`Could not reach Cloud Firestore backend. ${t}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(Xf(o),this.D_=!1):en("OnlineStateTracker",o)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LFe{constructor(t,o,a,l,d){this.localStore=t,this.datastore=o,this.asyncQueue=a,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=d,this.k_._o(m=>{a.enqueueAndForget(async()=>{dv(this)&&(en("RemoteStore","Restarting streams for network reachability change."),await async function(y){const b=Hn(y);b.L_.add(4),await uR(b),b.q_.set("Unknown"),b.L_.delete(4),await YN(b)}(this))})}),this.q_=new DFe(a,l)}}async function YN(r){if(dv(r))for(const t of r.B_)await t(!0)}async function uR(r){for(const t of r.B_)await t(!1)}function Cne(r,t){const o=Hn(r);o.N_.has(t.targetId)||(o.N_.set(t.targetId,t),VF(o)?UF(o):DS(o).r_()&&MF(o,t))}function xF(r,t){const o=Hn(r),a=DS(o);o.N_.delete(t),a.r_()&&Ine(o,t),o.N_.size===0&&(a.r_()?a.o_():dv(o)&&o.q_.set("Unknown"))}function MF(r,t){if(r.Q_.xe(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(zn.min())>0){const o=r.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(o)}DS(r).A_(t)}function Ine(r,t){r.Q_.xe(t),DS(r).R_(t)}function UF(r){r.Q_=new xVe({getRemoteKeysForTarget:t=>r.remoteSyncer.getRemoteKeysForTarget(t),ot:t=>r.N_.get(t)||null,tt:()=>r.datastore.serializer.databaseId}),DS(r).start(),r.q_.v_()}function VF(r){return dv(r)&&!DS(r).n_()&&r.N_.size>0}function dv(r){return Hn(r).L_.size===0}function Ane(r){r.Q_=void 0}async function xFe(r){r.q_.set("Online")}async function MFe(r){r.N_.forEach((t,o)=>{MF(r,t)})}async function UFe(r,t){Ane(r),VF(r)?(r.q_.M_(t),UF(r)):r.q_.set("Unknown")}async function VFe(r,t,o){if(r.q_.set("Online"),t instanceof pne&&t.state===2&&t.cause)try{await async function(l,d){const m=d.cause;for(const v of d.targetIds)l.N_.has(v)&&(await l.remoteSyncer.rejectListen(v,m),l.N_.delete(v),l.Q_.removeTarget(v))}(r,t)}catch(a){en("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),a),await XP(r,a)}else if(t instanceof gP?r.Q_.Ke(t):t instanceof fne?r.Q_.He(t):r.Q_.We(t),!o.isEqual(zn.min()))try{const a=await bne(r.localStore);o.compareTo(a)>=0&&await function(d,m){const v=d.Q_.rt(m);return v.targetChanges.forEach((y,b)=>{if(y.resumeToken.approximateByteSize()>0){const R=d.N_.get(b);R&&d.N_.set(b,R.withResumeToken(y.resumeToken,m))}}),v.targetMismatches.forEach((y,b)=>{const R=d.N_.get(y);if(!R)return;d.N_.set(y,R.withResumeToken(qs.EMPTY_BYTE_STRING,R.snapshotVersion)),Ine(d,y);const O=new ym(R.target,y,b,R.sequenceNumber);MF(d,O)}),d.remoteSyncer.applyRemoteEvent(v)}(r,o)}catch(a){en("RemoteStore","Failed to raise snapshot:",a),await XP(r,a)}}async function XP(r,t,o){if(!aR(t))throw t;r.L_.add(1),await uR(r),r.q_.set("Offline"),o||(o=()=>bne(r.localStore)),r.asyncQueue.enqueueRetryable(async()=>{en("RemoteStore","Retrying IndexedDB access"),await o(),r.L_.delete(1),await YN(r)})}function One(r,t){return t().catch(o=>XP(r,o,t))}async function XN(r){const t=Hn(r),o=xm(t);let a=t.O_.length>0?t.O_[t.O_.length-1].batchId:-1;for(;FFe(t);)try{const l=await TFe(t.localStore,a);if(l===null){t.O_.length===0&&o.o_();break}a=l.batchId,jFe(t,l)}catch(l){await XP(t,l)}Pne(t)&&Nne(t)}function FFe(r){return dv(r)&&r.O_.length<10}function jFe(r,t){r.O_.push(t);const o=xm(r);o.r_()&&o.V_&&o.m_(t.mutations)}function Pne(r){return dv(r)&&!xm(r).n_()&&r.O_.length>0}function Nne(r){xm(r).start()}async function BFe(r){xm(r).p_()}async function WFe(r){const t=xm(r);for(const o of r.O_)t.m_(o.mutations)}async function GFe(r,t,o){const a=r.O_.shift(),l=OF.from(a,t,o);await One(r,()=>r.remoteSyncer.applySuccessfulWrite(l)),await XN(r)}async function zFe(r,t){t&&xm(r).V_&&await async function(a,l){if(function(m){return kVe(m)&&m!==st.ABORTED}(l.code)){const d=a.O_.shift();xm(a).s_(),await One(a,()=>a.remoteSyncer.rejectFailedWrite(d.batchId,l)),await XN(a)}}(r,t),Pne(r)&&Nne(r)}async function IY(r,t){const o=Hn(r);o.asyncQueue.verifyOperationInProgress(),en("RemoteStore","RemoteStore received new credentials");const a=dv(o);o.L_.add(3),await uR(o),a&&o.q_.set("Unknown"),await o.remoteSyncer.handleCredentialChange(t),o.L_.delete(3),await YN(o)}async function HFe(r,t){const o=Hn(r);t?(o.L_.delete(2),await YN(o)):t||(o.L_.add(2),await uR(o),o.q_.set("Unknown"))}function DS(r){return r.K_||(r.K_=function(o,a,l){const d=Hn(o);return d.w_(),new PFe(a,d.connection,d.authCredentials,d.appCheckCredentials,d.serializer,l)}(r.datastore,r.asyncQueue,{Eo:xFe.bind(null,r),Ro:MFe.bind(null,r),mo:UFe.bind(null,r),d_:VFe.bind(null,r)}),r.B_.push(async t=>{t?(r.K_.s_(),VF(r)?UF(r):r.q_.set("Unknown")):(await r.K_.stop(),Ane(r))})),r.K_}function xm(r){return r.U_||(r.U_=function(o,a,l){const d=Hn(o);return d.w_(),new NFe(a,d.connection,d.authCredentials,d.appCheckCredentials,d.serializer,l)}(r.datastore,r.asyncQueue,{Eo:()=>Promise.resolve(),Ro:BFe.bind(null,r),mo:zFe.bind(null,r),f_:WFe.bind(null,r),g_:GFe.bind(null,r)}),r.B_.push(async t=>{t?(r.U_.s_(),await XN(r)):(await r.U_.stop(),r.O_.length>0&&(en("RemoteStore",`Stopping write stream with ${r.O_.length} pending writes`),r.O_=[]))})),r.U_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FF{constructor(t,o,a,l,d){this.asyncQueue=t,this.timerId=o,this.targetTimeMs=a,this.op=l,this.removalCallback=d,this.deferred=new Hf,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(m=>{})}get promise(){return this.deferred.promise}static createAndSchedule(t,o,a,l,d){const m=Date.now()+a,v=new FF(t,o,m,l,d);return v.start(a),v}start(t){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Ut(st.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(t=>this.deferred.resolve(t))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function jF(r,t){if(Xf("AsyncQueue",`${t}: ${r}`),aR(r))return new Ut(st.UNAVAILABLE,`${t}: ${r}`);throw r}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nS{constructor(t){this.comparator=t?(o,a)=>t(o,a)||cn.comparator(o.key,a.key):(o,a)=>cn.comparator(o.key,a.key),this.keyedMap=kb(),this.sortedSet=new no(this.comparator)}static emptySet(t){return new nS(t.comparator)}has(t){return this.keyedMap.get(t)!=null}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const o=this.keyedMap.get(t);return o?this.sortedSet.indexOf(o):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal((o,a)=>(t(o),!1))}add(t){const o=this.delete(t.key);return o.copy(o.keyedMap.insert(t.key,t),o.sortedSet.insert(t,null))}delete(t){const o=this.get(t);return o?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(o)):this}isEqual(t){if(!(t instanceof nS)||this.size!==t.size)return!1;const o=this.sortedSet.getIterator(),a=t.sortedSet.getIterator();for(;o.hasNext();){const l=o.getNext().key,d=a.getNext().key;if(!l.isEqual(d))return!1}return!0}toString(){const t=[];return this.forEach(o=>{t.push(o.toString())}),t.length===0?"DocumentSet ()":`DocumentSet (
  `+t.join(`  
`)+`
)`}copy(t,o){const a=new nS;return a.comparator=this.comparator,a.keyedMap=t,a.sortedSet=o,a}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AY{constructor(){this.W_=new no(cn.comparator)}track(t){const o=t.doc.key,a=this.W_.get(o);a?t.type!==0&&a.type===3?this.W_=this.W_.insert(o,t):t.type===3&&a.type!==1?this.W_=this.W_.insert(o,{type:a.type,doc:t.doc}):t.type===2&&a.type===2?this.W_=this.W_.insert(o,{type:2,doc:t.doc}):t.type===2&&a.type===0?this.W_=this.W_.insert(o,{type:0,doc:t.doc}):t.type===1&&a.type===0?this.W_=this.W_.remove(o):t.type===1&&a.type===2?this.W_=this.W_.insert(o,{type:1,doc:a.doc}):t.type===0&&a.type===1?this.W_=this.W_.insert(o,{type:2,doc:t.doc}):Vn():this.W_=this.W_.insert(o,t)}G_(){const t=[];return this.W_.inorderTraversal((o,a)=>{t.push(a)}),t}}class ES{constructor(t,o,a,l,d,m,v,y,b){this.query=t,this.docs=o,this.oldDocs=a,this.docChanges=l,this.mutatedKeys=d,this.fromCache=m,this.syncStateChanged=v,this.excludesMetadataChanges=y,this.hasCachedResults=b}static fromInitialDocuments(t,o,a,l,d){const m=[];return o.forEach(v=>{m.push({type:0,doc:v})}),new ES(t,o,nS.emptySet(o),m,a,l,!0,!1,d)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&GN(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const o=this.docChanges,a=t.docChanges;if(o.length!==a.length)return!1;for(let l=0;l<o.length;l++)if(o[l].type!==a[l].type||!o[l].doc.isEqual(a[l].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KFe{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(t=>t.J_())}}class $Fe{constructor(){this.queries=OY(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(o,a){const l=Hn(o),d=l.queries;l.queries=OY(),d.forEach((m,v)=>{for(const y of v.j_)y.onError(a)})})(this,new Ut(st.ABORTED,"Firestore shutting down"))}}function OY(){return new kS(r=>Zte(r),GN)}async function BF(r,t){const o=Hn(r);let a=3;const l=t.query;let d=o.queries.get(l);d?!d.H_()&&t.J_()&&(a=2):(d=new KFe,a=t.J_()?0:1);try{switch(a){case 0:d.z_=await o.onListen(l,!0);break;case 1:d.z_=await o.onListen(l,!1);break;case 2:await o.onFirstRemoteStoreListen(l)}}catch(m){const v=jF(m,`Initialization of query '${Ry(t.query)}' failed`);return void t.onError(v)}o.queries.set(l,d),d.j_.push(t),t.Z_(o.onlineState),d.z_&&t.X_(d.z_)&&GF(o)}async function WF(r,t){const o=Hn(r),a=t.query;let l=3;const d=o.queries.get(a);if(d){const m=d.j_.indexOf(t);m>=0&&(d.j_.splice(m,1),d.j_.length===0?l=t.J_()?0:1:!d.H_()&&t.J_()&&(l=2))}switch(l){case 0:return o.queries.delete(a),o.onUnlisten(a,!0);case 1:return o.queries.delete(a),o.onUnlisten(a,!1);case 2:return o.onLastRemoteStoreUnlisten(a);default:return}}function qFe(r,t){const o=Hn(r);let a=!1;for(const l of t){const d=l.query,m=o.queries.get(d);if(m){for(const v of m.j_)v.X_(l)&&(a=!0);m.z_=l}}a&&GF(o)}function YFe(r,t,o){const a=Hn(r),l=a.queries.get(t);if(l)for(const d of l.j_)d.onError(o);a.queries.delete(t)}function GF(r){r.Y_.forEach(t=>{t.next()})}var NU,PY;(PY=NU||(NU={})).ea="default",PY.Cache="cache";class zF{constructor(t,o,a){this.query=t,this.ta=o,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=a||{}}X_(t){if(!this.options.includeMetadataChanges){const a=[];for(const l of t.docChanges)l.type!==3&&a.push(l);t=new ES(t.query,t.docs,t.oldDocs,a,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let o=!1;return this.na?this.ia(t)&&(this.ta.next(t),o=!0):this.sa(t,this.onlineState)&&(this.oa(t),o=!0),this.ra=t,o}onError(t){this.ta.error(t)}Z_(t){this.onlineState=t;let o=!1;return this.ra&&!this.na&&this.sa(this.ra,t)&&(this.oa(this.ra),o=!0),o}sa(t,o){if(!t.fromCache||!this.J_())return!0;const a=o!=="Offline";return(!this.options._a||!a)&&(!t.docs.isEmpty()||t.hasCachedResults||o==="Offline")}ia(t){if(t.docChanges.length>0)return!0;const o=this.ra&&this.ra.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!o)&&this.options.includeMetadataChanges===!0}oa(t){t=ES.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.na=!0,this.ta.next(t)}J_(){return this.options.source!==NU.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kne{constructor(t){this.key=t}}class Dne{constructor(t){this.key=t}}class XFe{constructor(t,o){this.query=t,this.Ta=o,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=mr(),this.mutatedKeys=mr(),this.Aa=ene(t),this.Ra=new nS(this.Aa)}get Va(){return this.Ta}ma(t,o){const a=o?o.fa:new AY,l=o?o.Ra:this.Ra;let d=o?o.mutatedKeys:this.mutatedKeys,m=l,v=!1;const y=this.query.limitType==="F"&&l.size===this.query.limit?l.last():null,b=this.query.limitType==="L"&&l.size===this.query.limit?l.first():null;if(t.inorderTraversal((R,O)=>{const N=l.get(R),F=zN(this.query,O)?O:null,H=!!N&&this.mutatedKeys.has(N.key),G=!!F&&(F.hasLocalMutations||this.mutatedKeys.has(F.key)&&F.hasCommittedMutations);let z=!1;N&&F?N.data.isEqual(F.data)?H!==G&&(a.track({type:3,doc:F}),z=!0):this.ga(N,F)||(a.track({type:2,doc:F}),z=!0,(y&&this.Aa(F,y)>0||b&&this.Aa(F,b)<0)&&(v=!0)):!N&&F?(a.track({type:0,doc:F}),z=!0):N&&!F&&(a.track({type:1,doc:N}),z=!0,(y||b)&&(v=!0)),z&&(F?(m=m.add(F),d=G?d.add(R):d.delete(R)):(m=m.delete(R),d=d.delete(R)))}),this.query.limit!==null)for(;m.size>this.query.limit;){const R=this.query.limitType==="F"?m.last():m.first();m=m.delete(R.key),d=d.delete(R.key),a.track({type:1,doc:R})}return{Ra:m,fa:a,ns:v,mutatedKeys:d}}ga(t,o){return t.hasLocalMutations&&o.hasCommittedMutations&&!o.hasLocalMutations}applyChanges(t,o,a,l){const d=this.Ra;this.Ra=t.Ra,this.mutatedKeys=t.mutatedKeys;const m=t.fa.G_();m.sort((R,O)=>function(F,H){const G=z=>{switch(z){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Vn()}};return G(F)-G(H)}(R.type,O.type)||this.Aa(R.doc,O.doc)),this.pa(a),l=l!=null&&l;const v=o&&!l?this.ya():[],y=this.da.size===0&&this.current&&!l?1:0,b=y!==this.Ea;return this.Ea=y,m.length!==0||b?{snapshot:new ES(this.query,t.Ra,d,m,t.mutatedKeys,y===0,b,!1,!!a&&a.resumeToken.approximateByteSize()>0),wa:v}:{wa:v}}Z_(t){return this.current&&t==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new AY,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(t){return!this.Ta.has(t)&&!!this.Ra.has(t)&&!this.Ra.get(t).hasLocalMutations}pa(t){t&&(t.addedDocuments.forEach(o=>this.Ta=this.Ta.add(o)),t.modifiedDocuments.forEach(o=>{}),t.removedDocuments.forEach(o=>this.Ta=this.Ta.delete(o)),this.current=t.current)}ya(){if(!this.current)return[];const t=this.da;this.da=mr(),this.Ra.forEach(a=>{this.Sa(a.key)&&(this.da=this.da.add(a.key))});const o=[];return t.forEach(a=>{this.da.has(a)||o.push(new Dne(a))}),this.da.forEach(a=>{t.has(a)||o.push(new kne(a))}),o}ba(t){this.Ta=t.Ts,this.da=mr();const o=this.ma(t.documents);return this.applyChanges(o,!0)}Da(){return ES.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}}class JFe{constructor(t,o,a){this.query=t,this.targetId=o,this.view=a}}class QFe{constructor(t){this.key=t,this.va=!1}}class ZFe{constructor(t,o,a,l,d,m){this.localStore=t,this.remoteStore=o,this.eventManager=a,this.sharedClientState=l,this.currentUser=d,this.maxConcurrentLimboResolutions=m,this.Ca={},this.Fa=new kS(v=>Zte(v),GN),this.Ma=new Map,this.xa=new Set,this.Oa=new no(cn.comparator),this.Na=new Map,this.La=new kF,this.Ba={},this.ka=new Map,this.qa=vS.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}}async function eje(r,t,o=!0){const a=Fne(r);let l;const d=a.Fa.get(t);return d?(a.sharedClientState.addLocalQueryTarget(d.targetId),l=d.view.Da()):l=await Lne(a,t,o,!0),l}async function tje(r,t){const o=Fne(r);await Lne(o,t,!0,!1)}async function Lne(r,t,o,a){const l=await bFe(r.localStore,gh(t)),d=l.targetId,m=r.sharedClientState.addLocalQueryTarget(d,o);let v;return a&&(v=await nje(r,t,d,m==="current",l.resumeToken)),r.isPrimaryClient&&o&&Cne(r.remoteStore,l),v}async function nje(r,t,o,a,l){r.Ka=(O,N,F)=>async function(G,z,ne,J){let oe=z.view.ma(ne);oe.ns&&(oe=await wY(G.localStore,z.query,!1).then(({documents:Q})=>z.view.ma(Q,oe)));const se=J&&J.targetChanges.get(z.targetId),ae=J&&J.targetMismatches.get(z.targetId)!=null,ye=z.view.applyChanges(oe,G.isPrimaryClient,se,ae);return kY(G,z.targetId,ye.wa),ye.snapshot}(r,O,N,F);const d=await wY(r.localStore,t,!0),m=new XFe(t,d.Ts),v=m.ma(d.documents),y=lR.createSynthesizedTargetChangeForCurrentChange(o,a&&r.onlineState!=="Offline",l),b=m.applyChanges(v,r.isPrimaryClient,y);kY(r,o,b.wa);const R=new JFe(t,o,m);return r.Fa.set(t,R),r.Ma.has(o)?r.Ma.get(o).push(t):r.Ma.set(o,[t]),b.snapshot}async function rje(r,t,o){const a=Hn(r),l=a.Fa.get(t),d=a.Ma.get(l.targetId);if(d.length>1)return a.Ma.set(l.targetId,d.filter(m=>!GN(m,t))),void a.Fa.delete(t);a.isPrimaryClient?(a.sharedClientState.removeLocalQueryTarget(l.targetId),a.sharedClientState.isActiveQueryTarget(l.targetId)||await PU(a.localStore,l.targetId,!1).then(()=>{a.sharedClientState.clearQueryState(l.targetId),o&&xF(a.remoteStore,l.targetId),kU(a,l.targetId)}).catch(sR)):(kU(a,l.targetId),await PU(a.localStore,l.targetId,!0))}async function ije(r,t){const o=Hn(r),a=o.Fa.get(t),l=o.Ma.get(a.targetId);o.isPrimaryClient&&l.length===1&&(o.sharedClientState.removeLocalQueryTarget(a.targetId),xF(o.remoteStore,a.targetId))}async function oje(r,t,o){const a=hje(r);try{const l=await function(m,v){const y=Hn(m),b=Zo.now(),R=v.reduce((F,H)=>F.add(H.key),mr());let O,N;return y.persistence.runTransaction("Locally write mutations","readwrite",F=>{let H=Jf(),G=mr();return y.cs.getEntries(F,R).next(z=>{H=z,H.forEach((ne,J)=>{J.isValidDocument()||(G=G.add(ne))})}).next(()=>y.localDocuments.getOverlayedDocuments(F,H)).next(z=>{O=z;const ne=[];for(const J of v){const oe=IVe(J,O.get(J.key).overlayedDocument);oe!=null&&ne.push(new Gm(J.key,oe,Kte(oe.value.mapValue),_h.exists(!0)))}return y.mutationQueue.addMutationBatch(F,b,ne,v)}).next(z=>{N=z;const ne=z.applyToLocalDocumentSet(O,G);return y.documentOverlayCache.saveOverlays(F,z.batchId,ne)})}).then(()=>({batchId:N.batchId,changes:nne(O)}))}(a.localStore,t);a.sharedClientState.addPendingMutation(l.batchId),function(m,v,y){let b=m.Ba[m.currentUser.toKey()];b||(b=new no(Br)),b=b.insert(v,y),m.Ba[m.currentUser.toKey()]=b}(a,l.batchId,o),await dR(a,l.changes),await XN(a.remoteStore)}catch(l){const d=jF(l,"Failed to persist write");o.reject(d)}}async function xne(r,t){const o=Hn(r);try{const a=await yFe(o.localStore,t);t.targetChanges.forEach((l,d)=>{const m=o.Na.get(d);m&&(li(l.addedDocuments.size+l.modifiedDocuments.size+l.removedDocuments.size<=1),l.addedDocuments.size>0?m.va=!0:l.modifiedDocuments.size>0?li(m.va):l.removedDocuments.size>0&&(li(m.va),m.va=!1))}),await dR(o,a,t)}catch(a){await sR(a)}}function NY(r,t,o){const a=Hn(r);if(a.isPrimaryClient&&o===0||!a.isPrimaryClient&&o===1){const l=[];a.Fa.forEach((d,m)=>{const v=m.view.Z_(t);v.snapshot&&l.push(v.snapshot)}),function(m,v){const y=Hn(m);y.onlineState=v;let b=!1;y.queries.forEach((R,O)=>{for(const N of O.j_)N.Z_(v)&&(b=!0)}),b&&GF(y)}(a.eventManager,t),l.length&&a.Ca.d_(l),a.onlineState=t,a.isPrimaryClient&&a.sharedClientState.setOnlineState(t)}}async function sje(r,t,o){const a=Hn(r);a.sharedClientState.updateQueryState(t,"rejected",o);const l=a.Na.get(t),d=l&&l.key;if(d){let m=new no(cn.comparator);m=m.insert(d,Ea.newNoDocument(d,zn.min()));const v=mr().add(d),y=new $N(zn.min(),new Map,new no(Br),m,v);await xne(a,y),a.Oa=a.Oa.remove(d),a.Na.delete(t),HF(a)}else await PU(a.localStore,t,!1).then(()=>kU(a,t,o)).catch(sR)}async function aje(r,t){const o=Hn(r),a=t.batch.batchId;try{const l=await EFe(o.localStore,t);Une(o,a,null),Mne(o,a),o.sharedClientState.updateMutationState(a,"acknowledged"),await dR(o,l)}catch(l){await sR(l)}}async function cje(r,t,o){const a=Hn(r);try{const l=await function(m,v){const y=Hn(m);return y.persistence.runTransaction("Reject batch","readwrite-primary",b=>{let R;return y.mutationQueue.lookupMutationBatch(b,v).next(O=>(li(O!==null),R=O.keys(),y.mutationQueue.removeMutationBatch(b,O))).next(()=>y.mutationQueue.performConsistencyCheck(b)).next(()=>y.documentOverlayCache.removeOverlaysForBatchId(b,R,v)).next(()=>y.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(b,R)).next(()=>y.localDocuments.getDocuments(b,R))})}(a.localStore,t);Une(a,t,o),Mne(a,t),a.sharedClientState.updateMutationState(t,"rejected",o),await dR(a,l)}catch(l){await sR(l)}}function Mne(r,t){(r.ka.get(t)||[]).forEach(o=>{o.resolve()}),r.ka.delete(t)}function Une(r,t,o){const a=Hn(r);let l=a.Ba[a.currentUser.toKey()];if(l){const d=l.get(t);d&&(o?d.reject(o):d.resolve(),l=l.remove(t)),a.Ba[a.currentUser.toKey()]=l}}function kU(r,t,o=null){r.sharedClientState.removeLocalQueryTarget(t);for(const a of r.Ma.get(t))r.Fa.delete(a),o&&r.Ca.$a(a,o);r.Ma.delete(t),r.isPrimaryClient&&r.La.gr(t).forEach(a=>{r.La.containsKey(a)||Vne(r,a)})}function Vne(r,t){r.xa.delete(t.path.canonicalString());const o=r.Oa.get(t);o!==null&&(xF(r.remoteStore,o),r.Oa=r.Oa.remove(t),r.Na.delete(o),HF(r))}function kY(r,t,o){for(const a of o)a instanceof kne?(r.La.addReference(a.key,t),lje(r,a)):a instanceof Dne?(en("SyncEngine","Document no longer in limbo: "+a.key),r.La.removeReference(a.key,t),r.La.containsKey(a.key)||Vne(r,a.key)):Vn()}function lje(r,t){const o=t.key,a=o.path.canonicalString();r.Oa.get(o)||r.xa.has(a)||(en("SyncEngine","New document in limbo: "+o),r.xa.add(a),HF(r))}function HF(r){for(;r.xa.size>0&&r.Oa.size<r.maxConcurrentLimboResolutions;){const t=r.xa.values().next().value;r.xa.delete(t);const o=new cn(wi.fromString(t)),a=r.qa.next();r.Na.set(a,new QFe(o)),r.Oa=r.Oa.insert(o,a),Cne(r.remoteStore,new ym(gh(WN(o.path)),a,"TargetPurposeLimboResolution",TF.oe))}}async function dR(r,t,o){const a=Hn(r),l=[],d=[],m=[];a.Fa.isEmpty()||(a.Fa.forEach((v,y)=>{m.push(a.Ka(y,t,o).then(b=>{var R;if((b||o)&&a.isPrimaryClient){const O=b?!b.fromCache:(R=o==null?void 0:o.targetChanges.get(y.targetId))===null||R===void 0?void 0:R.current;a.sharedClientState.updateQueryState(y.targetId,O?"current":"not-current")}if(b){l.push(b);const O=LF.Wi(y.targetId,b);d.push(O)}}))}),await Promise.all(m),a.Ca.d_(l),await async function(y,b){const R=Hn(y);try{await R.persistence.runTransaction("notifyLocalViewChanges","readwrite",O=>Tt.forEach(b,N=>Tt.forEach(N.$i,F=>R.persistence.referenceDelegate.addReference(O,N.targetId,F)).next(()=>Tt.forEach(N.Ui,F=>R.persistence.referenceDelegate.removeReference(O,N.targetId,F)))))}catch(O){if(!aR(O))throw O;en("LocalStore","Failed to update sequence numbers: "+O)}for(const O of b){const N=O.targetId;if(!O.fromCache){const F=R.os.get(N),H=F.snapshotVersion,G=F.withLastLimboFreeSnapshotVersion(H);R.os=R.os.insert(N,G)}}}(a.localStore,d))}async function uje(r,t){const o=Hn(r);if(!o.currentUser.isEqual(t)){en("SyncEngine","User change. New user:",t.toKey());const a=await Tne(o.localStore,t);o.currentUser=t,function(d,m){d.ka.forEach(v=>{v.forEach(y=>{y.reject(new Ut(st.CANCELLED,m))})}),d.ka.clear()}(o,"'waitForPendingWrites' promise is rejected due to a user change."),o.sharedClientState.handleUserChange(t,a.removedBatchIds,a.addedBatchIds),await dR(o,a.hs)}}function dje(r,t){const o=Hn(r),a=o.Na.get(t);if(a&&a.va)return mr().add(a.key);{let l=mr();const d=o.Ma.get(t);if(!d)return l;for(const m of d){const v=o.Fa.get(m);l=l.unionWith(v.view.Va)}return l}}function Fne(r){const t=Hn(r);return t.remoteStore.remoteSyncer.applyRemoteEvent=xne.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=dje.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=sje.bind(null,t),t.Ca.d_=qFe.bind(null,t.eventManager),t.Ca.$a=YFe.bind(null,t.eventManager),t}function hje(r){const t=Hn(r);return t.remoteStore.remoteSyncer.applySuccessfulWrite=aje.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=cje.bind(null,t),t}class JP{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(t){this.serializer=qN(t.databaseInfo.databaseId),this.sharedClientState=this.Wa(t),this.persistence=this.Ga(t),await this.persistence.start(),this.localStore=this.za(t),this.gcScheduler=this.ja(t,this.localStore),this.indexBackfillerScheduler=this.Ha(t,this.localStore)}ja(t,o){return null}Ha(t,o){return null}za(t){return vFe(this.persistence,new gFe,t.initialUser,this.serializer)}Ga(t){return new fFe(DF.Zr,this.serializer)}Wa(t){return new RFe}async terminate(){var t,o;(t=this.gcScheduler)===null||t===void 0||t.stop(),(o=this.indexBackfillerScheduler)===null||o===void 0||o.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}JP.provider={build:()=>new JP};class DU{async initialize(t,o){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(o),this.remoteStore=this.createRemoteStore(o),this.eventManager=this.createEventManager(o),this.syncEngine=this.createSyncEngine(o,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=a=>NY(this.syncEngine,a,1),this.remoteStore.remoteSyncer.handleCredentialChange=uje.bind(null,this.syncEngine),await HFe(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return function(){return new $Fe}()}createDatastore(t){const o=qN(t.databaseInfo.databaseId),a=function(d){return new OFe(d)}(t.databaseInfo);return function(d,m,v,y){return new kFe(d,m,v,y)}(t.authCredentials,t.appCheckCredentials,a,o)}createRemoteStore(t){return function(a,l,d,m,v){return new LFe(a,l,d,m,v)}(this.localStore,this.datastore,t.asyncQueue,o=>NY(this.syncEngine,o,0),function(){return CY.D()?new CY:new CFe}())}createSyncEngine(t,o){return function(l,d,m,v,y,b,R){const O=new ZFe(l,d,m,v,y,b);return R&&(O.Qa=!0),O}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,o)}async terminate(){var t,o;await async function(l){const d=Hn(l);en("RemoteStore","RemoteStore shutting down."),d.L_.add(5),await uR(d),d.k_.shutdown(),d.q_.set("Unknown")}(this.remoteStore),(t=this.datastore)===null||t===void 0||t.terminate(),(o=this.eventManager)===null||o===void 0||o.terminate()}}DU.provider={build:()=>new DU};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KF{constructor(t){this.observer=t,this.muted=!1}next(t){this.muted||this.observer.next&&this.Ya(this.observer.next,t)}error(t){this.muted||(this.observer.error?this.Ya(this.observer.error,t):Xf("Uncaught Error in snapshot listener:",t.toString()))}Za(){this.muted=!0}Ya(t,o){setTimeout(()=>{this.muted||t(o)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fje{constructor(t,o,a,l,d){this.authCredentials=t,this.appCheckCredentials=o,this.asyncQueue=a,this.databaseInfo=l,this.user=va.UNAUTHENTICATED,this.clientId=Gte.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=d,this.authCredentials.start(a,async m=>{en("FirestoreClient","Received user=",m.uid),await this.authCredentialListener(m),this.user=m}),this.appCheckCredentials.start(a,m=>(en("FirestoreClient","Received new app check token=",m),this.appCheckCredentialListener(m,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}terminate(){this.asyncQueue.enterRestrictedMode();const t=new Hf;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(o){const a=jF(o,"Failed to shutdown persistence");t.reject(a)}}),t.promise}}async function e2(r,t){r.asyncQueue.verifyOperationInProgress(),en("FirestoreClient","Initializing OfflineComponentProvider");const o=r.configuration;await t.initialize(o);let a=o.initialUser;r.setCredentialChangeListener(async l=>{a.isEqual(l)||(await Tne(t.localStore,l),a=l)}),t.persistence.setDatabaseDeletedListener(()=>r.terminate()),r._offlineComponents=t}async function DY(r,t){r.asyncQueue.verifyOperationInProgress();const o=await pje(r);en("FirestoreClient","Initializing OnlineComponentProvider"),await t.initialize(o,r.configuration),r.setCredentialChangeListener(a=>IY(t.remoteStore,a)),r.setAppCheckTokenChangeListener((a,l)=>IY(t.remoteStore,l)),r._onlineComponents=t}async function pje(r){if(!r._offlineComponents)if(r._uninitializedComponentsProvider){en("FirestoreClient","Using user provided OfflineComponentProvider");try{await e2(r,r._uninitializedComponentsProvider._offline)}catch(t){const o=t;if(!function(l){return l.name==="FirebaseError"?l.code===st.FAILED_PRECONDITION||l.code===st.UNIMPLEMENTED:!(typeof DOMException<"u"&&l instanceof DOMException)||l.code===22||l.code===20||l.code===11}(o))throw o;fS("Error using user provided cache. Falling back to memory cache: "+o),await e2(r,new JP)}}else en("FirestoreClient","Using default OfflineComponentProvider"),await e2(r,new JP);return r._offlineComponents}async function jne(r){return r._onlineComponents||(r._uninitializedComponentsProvider?(en("FirestoreClient","Using user provided OnlineComponentProvider"),await DY(r,r._uninitializedComponentsProvider._online)):(en("FirestoreClient","Using default OnlineComponentProvider"),await DY(r,new DU))),r._onlineComponents}function mje(r){return jne(r).then(t=>t.syncEngine)}async function QP(r){const t=await jne(r),o=t.eventManager;return o.onListen=eje.bind(null,t.syncEngine),o.onUnlisten=rje.bind(null,t.syncEngine),o.onFirstRemoteStoreListen=tje.bind(null,t.syncEngine),o.onLastRemoteStoreUnlisten=ije.bind(null,t.syncEngine),o}function gje(r,t,o={}){const a=new Hf;return r.asyncQueue.enqueueAndForget(async()=>function(d,m,v,y,b){const R=new KF({next:N=>{R.Za(),m.enqueueAndForget(()=>WF(d,O));const F=N.docs.has(v);!F&&N.fromCache?b.reject(new Ut(st.UNAVAILABLE,"Failed to get document because the client is offline.")):F&&N.fromCache&&y&&y.source==="server"?b.reject(new Ut(st.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):b.resolve(N)},error:N=>b.reject(N)}),O=new zF(WN(v.path),R,{includeMetadataChanges:!0,_a:!0});return BF(d,O)}(await QP(r),r.asyncQueue,t,o,a)),a.promise}function _je(r,t,o={}){const a=new Hf;return r.asyncQueue.enqueueAndForget(async()=>function(d,m,v,y,b){const R=new KF({next:N=>{R.Za(),m.enqueueAndForget(()=>WF(d,O)),N.fromCache&&y.source==="server"?b.reject(new Ut(st.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):b.resolve(N)},error:N=>b.reject(N)}),O=new zF(v,R,{includeMetadataChanges:!0,_a:!0});return BF(d,O)}(await QP(r),r.asyncQueue,t,o,a)),a.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bne(r){const t={};return r.timeoutSeconds!==void 0&&(t.timeoutSeconds=r.timeoutSeconds),t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LY=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wne(r,t,o){if(!o)throw new Ut(st.INVALID_ARGUMENT,`Function ${r}() cannot be called with an empty ${t}.`)}function vje(r,t,o,a){if(t===!0&&a===!0)throw new Ut(st.INVALID_ARGUMENT,`${r} and ${o} cannot be used together.`)}function xY(r){if(!cn.isDocumentKey(r))throw new Ut(st.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${r} has ${r.length}.`)}function MY(r){if(cn.isDocumentKey(r))throw new Ut(st.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${r} has ${r.length}.`)}function JN(r){if(r===void 0)return"undefined";if(r===null)return"null";if(typeof r=="string")return r.length>20&&(r=`${r.substring(0,20)}...`),JSON.stringify(r);if(typeof r=="number"||typeof r=="boolean")return""+r;if(typeof r=="object"){if(r instanceof Array)return"an array";{const t=function(a){return a.constructor?a.constructor.name:null}(r);return t?`a custom ${t} object`:"an object"}}return typeof r=="function"?"a function":Vn()}function ru(r,t){if("_delegate"in r&&(r=r._delegate),!(r instanceof t)){if(t.name===r.constructor.name)throw new Ut(st.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const o=JN(r);throw new Ut(st.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${o}`)}}return r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UY{constructor(t){var o,a;if(t.host===void 0){if(t.ssl!==void 0)throw new Ut(st.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=(o=t.ssl)===null||o===void 0||o;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,t.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(t.cacheSizeBytes!==-1&&t.cacheSizeBytes<1048576)throw new Ut(st.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}vje("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:t.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Bne((a=t.experimentalLongPollingOptions)!==null&&a!==void 0?a:{}),function(d){if(d.timeoutSeconds!==void 0){if(isNaN(d.timeoutSeconds))throw new Ut(st.INVALID_ARGUMENT,`invalid long polling timeout: ${d.timeoutSeconds} (must not be NaN)`);if(d.timeoutSeconds<5)throw new Ut(st.INVALID_ARGUMENT,`invalid long polling timeout: ${d.timeoutSeconds} (minimum allowed value is 5)`);if(d.timeoutSeconds>30)throw new Ut(st.INVALID_ARGUMENT,`invalid long polling timeout: ${d.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(a,l){return a.timeoutSeconds===l.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class QN{constructor(t,o,a,l){this._authCredentials=t,this._appCheckCredentials=o,this._databaseId=a,this._app=l,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new UY({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Ut(st.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(t){if(this._settingsFrozen)throw new Ut(st.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new UY(t),t.credentials!==void 0&&(this._authCredentials=function(a){if(!a)return new MUe;switch(a.type){case"firstParty":return new jUe(a.sessionIndex||"0",a.iamToken||null,a.authTokenFactory||null);case"provider":return a.client;default:throw new Ut(st.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(o){const a=LY.get(o);a&&(en("ComponentProvider","Removing Datastore"),LY.delete(o),a.terminate())}(this),Promise.resolve()}}function Eje(r,t,o,a={}){var l;const d=(r=ru(r,QN))._getSettings(),m=`${t}:${o}`;if(d.host!=="firestore.googleapis.com"&&d.host!==m&&fS("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),r._setSettings(Object.assign(Object.assign({},d),{host:m,ssl:!1})),a.mockUserToken){let v,y;if(typeof a.mockUserToken=="string")v=a.mockUserToken,y=va.MOCK_USER;else{v=Yee(a.mockUserToken,(l=r._app)===null||l===void 0?void 0:l.options.projectId);const b=a.mockUserToken.sub||a.mockUserToken.user_id;if(!b)throw new Ut(st.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");y=new va(b)}r._authCredentials=new UUe(new Wte(v,y))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zf{constructor(t,o,a){this.converter=o,this._query=a,this.type="query",this.firestore=t}withConverter(t){return new Zf(this.firestore,t,this._query)}}class Ta{constructor(t,o,a){this.converter=o,this._key=a,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Cm(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new Ta(this.firestore,t,this._key)}}class Cm extends Zf{constructor(t,o,a){super(t,o,WN(a)),this._path=a,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new Ta(this.firestore,null,new cn(t))}withConverter(t){return new Cm(this.firestore,t,this._path)}}function Gne(r,t,...o){if(r=to(r),Wne("collection","path",t),r instanceof QN){const a=wi.fromString(t,...o);return MY(a),new Cm(r,null,a)}{if(!(r instanceof Ta||r instanceof Cm))throw new Ut(st.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const a=r._path.child(wi.fromString(t,...o));return MY(a),new Cm(r.firestore,null,a)}}function yS(r,t,...o){if(r=to(r),arguments.length===1&&(t=Gte.newId()),Wne("doc","path",t),r instanceof QN){const a=wi.fromString(t,...o);return xY(a),new Ta(r,null,new cn(a))}{if(!(r instanceof Ta||r instanceof Cm))throw new Ut(st.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const a=r._path.child(wi.fromString(t,...o));return xY(a),new Ta(r.firestore,r instanceof Cm?r.converter:null,new cn(a))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VY{constructor(t=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new wne(this,"async_queue_retry"),this.Vu=()=>{const a=ZM();a&&en("AsyncQueue","Visibility state changed to "+a.visibilityState),this.t_.jo()},this.mu=t;const o=ZM();o&&typeof o.addEventListener=="function"&&o.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.fu(),this.gu(t)}enterRestrictedMode(t){if(!this.Iu){this.Iu=!0,this.Au=t||!1;const o=ZM();o&&typeof o.removeEventListener=="function"&&o.removeEventListener("visibilitychange",this.Vu)}}enqueue(t){if(this.fu(),this.Iu)return new Promise(()=>{});const o=new Hf;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(t().then(o.resolve,o.reject),o.promise)).then(()=>o.promise)}enqueueRetryable(t){this.enqueueAndForget(()=>(this.Pu.push(t),this.pu()))}async pu(){if(this.Pu.length!==0){try{await this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(t){if(!aR(t))throw t;en("AsyncQueue","Operation failed with retryable error: "+t)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}}gu(t){const o=this.mu.then(()=>(this.du=!0,t().catch(a=>{this.Eu=a,this.du=!1;const l=function(m){let v=m.message||"";return m.stack&&(v=m.stack.includes(m.message)?m.stack:m.message+`
`+m.stack),v}(a);throw Xf("INTERNAL UNHANDLED ERROR: ",l),a}).then(a=>(this.du=!1,a))));return this.mu=o,o}enqueueAfterDelay(t,o,a){this.fu(),this.Ru.indexOf(t)>-1&&(o=0);const l=FF.createAndSchedule(this,t,o,a,d=>this.yu(d));return this.Tu.push(l),l}fu(){this.Eu&&Vn()}verifyOperationInProgress(){}async wu(){let t;do t=this.mu,await t;while(t!==this.mu)}Su(t){for(const o of this.Tu)if(o.timerId===t)return!0;return!1}bu(t){return this.wu().then(()=>{this.Tu.sort((o,a)=>o.targetTimeMs-a.targetTimeMs);for(const o of this.Tu)if(o.skipDelay(),t!=="all"&&o.timerId===t)break;return this.wu()})}Du(t){this.Ru.push(t)}yu(t){const o=this.Tu.indexOf(t);this.Tu.splice(o,1)}}function FY(r){return function(o,a){if(typeof o!="object"||o===null)return!1;const l=o;for(const d of a)if(d in l&&typeof l[d]=="function")return!0;return!1}(r,["next","error","complete"])}class rv extends QN{constructor(t,o,a,l){super(t,o,a,l),this.type="firestore",this._queue=new VY,this._persistenceKey=(l==null?void 0:l.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const t=this._firestoreClient.terminate();this._queue=new VY(t),this._firestoreClient=void 0,await t}}}function yje(r,t){const o=typeof r=="object"?r:hF(),a=typeof r=="string"?r:"(default)",l=MN(o,"firestore").getImmediate({identifier:a});if(!l._initialized){const d=Kee("firestore");d&&Eje(l,...d)}return l}function ZN(r){if(r._terminated)throw new Ut(st.FAILED_PRECONDITION,"The client has already been terminated.");return r._firestoreClient||Sje(r),r._firestoreClient}function Sje(r){var t,o,a;const l=r._freezeSettings(),d=function(v,y,b,R){return new ZUe(v,y,b,R.host,R.ssl,R.experimentalForceLongPolling,R.experimentalAutoDetectLongPolling,Bne(R.experimentalLongPollingOptions),R.useFetchStreams)}(r._databaseId,((t=r._app)===null||t===void 0?void 0:t.options.appId)||"",r._persistenceKey,l);r._componentsProvider||!((o=l.localCache)===null||o===void 0)&&o._offlineComponentProvider&&(!((a=l.localCache)===null||a===void 0)&&a._onlineComponentProvider)&&(r._componentsProvider={_offline:l.localCache._offlineComponentProvider,_online:l.localCache._onlineComponentProvider}),r._firestoreClient=new fje(r._authCredentials,r._appCheckCredentials,r._queue,d,r._componentsProvider&&function(v){const y=v==null?void 0:v._online.build();return{_offline:v==null?void 0:v._offline.build(y),_online:y}}(r._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SS{constructor(t){this._byteString=t}static fromBase64String(t){try{return new SS(qs.fromBase64String(t))}catch(o){throw new Ut(st.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+o)}}static fromUint8Array(t){return new SS(qs.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ek{constructor(...t){for(let o=0;o<t.length;++o)if(t[o].length===0)throw new Ut(st.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Ks(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $F{constructor(t){this._methodName=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qF{constructor(t,o){if(!isFinite(t)||t<-90||t>90)throw new Ut(st.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(o)||o<-180||o>180)throw new Ut(st.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+o);this._lat=t,this._long=o}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return Br(this._lat,t._lat)||Br(this._long,t._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YF{constructor(t){this._values=(t||[]).map(o=>o)}toArray(){return this._values.map(t=>t)}isEqual(t){return function(a,l){if(a.length!==l.length)return!1;for(let d=0;d<a.length;++d)if(a[d]!==l[d])return!1;return!0}(this._values,t._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tje=/^__.*__$/;class bje{constructor(t,o,a){this.data=t,this.fieldMask=o,this.fieldTransforms=a}toMutation(t,o){return this.fieldMask!==null?new Gm(t,this.data,this.fieldMask,o,this.fieldTransforms):new cR(t,this.data,o,this.fieldTransforms)}}class zne{constructor(t,o,a){this.data=t,this.fieldMask=o,this.fieldTransforms=a}toMutation(t,o){return new Gm(t,this.data,this.fieldMask,o,this.fieldTransforms)}}function Hne(r){switch(r){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Vn()}}class XF{constructor(t,o,a,l,d,m){this.settings=t,this.databaseId=o,this.serializer=a,this.ignoreUndefinedProperties=l,d===void 0&&this.vu(),this.fieldTransforms=d||[],this.fieldMask=m||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(t){return new XF(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(t){var o;const a=(o=this.path)===null||o===void 0?void 0:o.child(t),l=this.Fu({path:a,xu:!1});return l.Ou(t),l}Nu(t){var o;const a=(o=this.path)===null||o===void 0?void 0:o.child(t),l=this.Fu({path:a,xu:!1});return l.vu(),l}Lu(t){return this.Fu({path:void 0,xu:!0})}Bu(t){return ZP(t,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(t){return this.fieldMask.find(o=>t.isPrefixOf(o))!==void 0||this.fieldTransforms.find(o=>t.isPrefixOf(o.field))!==void 0}vu(){if(this.path)for(let t=0;t<this.path.length;t++)this.Ou(this.path.get(t))}Ou(t){if(t.length===0)throw this.Bu("Document fields must not be empty");if(Hne(this.Cu)&&Tje.test(t))throw this.Bu('Document fields cannot begin and end with "__"')}}class wje{constructor(t,o,a){this.databaseId=t,this.ignoreUndefinedProperties=o,this.serializer=a||qN(t)}Qu(t,o,a,l=!1){return new XF({Cu:t,methodName:o,qu:a,path:Ks.emptyPath(),xu:!1,ku:l},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function tk(r){const t=r._freezeSettings(),o=qN(r._databaseId);return new wje(r._databaseId,!!t.ignoreUndefinedProperties,o)}function Rje(r,t,o,a,l,d={}){const m=r.Qu(d.merge||d.mergeFields?2:0,t,o,l);JF("Data must be an object, but it was:",m,a);const v=$ne(a,m);let y,b;if(d.merge)y=new dl(m.fieldMask),b=m.fieldTransforms;else if(d.mergeFields){const R=[];for(const O of d.mergeFields){const N=LU(t,O,o);if(!m.contains(N))throw new Ut(st.INVALID_ARGUMENT,`Field '${N}' is specified in your field mask but missing from your input data.`);Yne(R,N)||R.push(N)}y=new dl(R),b=m.fieldTransforms.filter(O=>y.covers(O.field))}else y=null,b=m.fieldTransforms;return new bje(new Oc(v),y,b)}class nk extends $F{_toFieldTransform(t){if(t.Cu!==2)throw t.Cu===1?t.Bu(`${this._methodName}() can only appear at the top level of your update data`):t.Bu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof nk}}function Cje(r,t,o,a){const l=r.Qu(1,t,o);JF("Data must be an object, but it was:",l,a);const d=[],m=Oc.empty();lv(a,(y,b)=>{const R=QF(t,y,o);b=to(b);const O=l.Nu(R);if(b instanceof nk)d.push(R);else{const N=hR(b,O);N!=null&&(d.push(R),m.set(R,N))}});const v=new dl(d);return new zne(m,v,l.fieldTransforms)}function Ije(r,t,o,a,l,d){const m=r.Qu(1,t,o),v=[LU(t,a,o)],y=[l];if(d.length%2!=0)throw new Ut(st.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let N=0;N<d.length;N+=2)v.push(LU(t,d[N])),y.push(d[N+1]);const b=[],R=Oc.empty();for(let N=v.length-1;N>=0;--N)if(!Yne(b,v[N])){const F=v[N];let H=y[N];H=to(H);const G=m.Nu(F);if(H instanceof nk)b.push(F);else{const z=hR(H,G);z!=null&&(b.push(F),R.set(F,z))}}const O=new dl(b);return new zne(R,O,m.fieldTransforms)}function Kne(r,t,o,a=!1){return hR(o,r.Qu(a?4:3,t))}function hR(r,t){if(qne(r=to(r)))return JF("Unsupported field value:",t,r),$ne(r,t);if(r instanceof $F)return function(a,l){if(!Hne(l.Cu))throw l.Bu(`${a._methodName}() can only be used with update() and set()`);if(!l.path)throw l.Bu(`${a._methodName}() is not currently supported inside arrays`);const d=a._toFieldTransform(l);d&&l.fieldTransforms.push(d)}(r,t),null;if(r===void 0&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),r instanceof Array){if(t.settings.xu&&t.Cu!==4)throw t.Bu("Nested arrays are not supported");return function(a,l){const d=[];let m=0;for(const v of a){let y=hR(v,l.Lu(m));y==null&&(y={nullValue:"NULL_VALUE"}),d.push(y),m++}return{arrayValue:{values:d}}}(r,t)}return function(a,l){if((a=to(a))===null)return{nullValue:"NULL_VALUE"};if(typeof a=="number")return SVe(l.serializer,a);if(typeof a=="boolean")return{booleanValue:a};if(typeof a=="string")return{stringValue:a};if(a instanceof Date){const d=Zo.fromDate(a);return{timestampValue:YP(l.serializer,d)}}if(a instanceof Zo){const d=new Zo(a.seconds,1e3*Math.floor(a.nanoseconds/1e3));return{timestampValue:YP(l.serializer,d)}}if(a instanceof qF)return{geoPointValue:{latitude:a.latitude,longitude:a.longitude}};if(a instanceof SS)return{bytesValue:mne(l.serializer,a._byteString)};if(a instanceof Ta){const d=l.databaseId,m=a.firestore._databaseId;if(!m.isEqual(d))throw l.Bu(`Document reference is for database ${m.projectId}/${m.database} but should be for database ${d.projectId}/${d.database}`);return{referenceValue:NF(a.firestore._databaseId||l.databaseId,a._key.path)}}if(a instanceof YF)return function(m,v){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:m.toArray().map(y=>{if(typeof y!="number")throw v.Bu("VectorValues must only contain numeric values.");return AF(v.serializer,y)})}}}}}}(a,l);throw l.Bu(`Unsupported field value: ${JN(a)}`)}(r,t)}function $ne(r,t){const o={};return zte(r)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):lv(r,(a,l)=>{const d=hR(l,t.Mu(a));d!=null&&(o[a]=d)}),{mapValue:{fields:o}}}function qne(r){return!(typeof r!="object"||r===null||r instanceof Array||r instanceof Date||r instanceof Zo||r instanceof qF||r instanceof SS||r instanceof Ta||r instanceof $F||r instanceof YF)}function JF(r,t,o){if(!qne(o)||!function(l){return typeof l=="object"&&l!==null&&(Object.getPrototypeOf(l)===Object.prototype||Object.getPrototypeOf(l)===null)}(o)){const a=JN(o);throw a==="an object"?t.Bu(r+" a custom object"):t.Bu(r+" "+a)}}function LU(r,t,o){if((t=to(t))instanceof ek)return t._internalPath;if(typeof t=="string")return QF(r,t);throw ZP("Field path arguments must be of type string or ",r,!1,void 0,o)}const Aje=new RegExp("[~\\*/\\[\\]]");function QF(r,t,o){if(t.search(Aje)>=0)throw ZP(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,r,!1,void 0,o);try{return new ek(...t.split("."))._internalPath}catch{throw ZP(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,r,!1,void 0,o)}}function ZP(r,t,o,a,l){const d=a&&!a.isEmpty(),m=l!==void 0;let v=`Function ${t}() called with invalid data`;o&&(v+=" (via `toFirestore()`)"),v+=". ";let y="";return(d||m)&&(y+=" (found",d&&(y+=` in field ${a}`),m&&(y+=` in document ${l}`),y+=")"),new Ut(st.INVALID_ARGUMENT,v+r+y)}function Yne(r,t){return r.some(o=>o.isEqual(t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZF{constructor(t,o,a,l,d){this._firestore=t,this._userDataWriter=o,this._key=a,this._document=l,this._converter=d}get id(){return this._key.path.lastSegment()}get ref(){return new Ta(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const t=new Oje(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const o=this._document.data.field(ej("DocumentSnapshot.get",t));if(o!==null)return this._userDataWriter.convertValue(o)}}}class Oje extends ZF{data(){return super.data()}}function ej(r,t){return typeof t=="string"?QF(r,t):t instanceof ek?t._internalPath:t._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xne(r){if(r.limitType==="L"&&r.explicitOrderBy.length===0)throw new Ut(st.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class tj{}class nj extends tj{}function Pje(r,t,...o){let a=[];t instanceof tj&&a.push(t),a=a.concat(o),function(d){const m=d.filter(y=>y instanceof ij).length,v=d.filter(y=>y instanceof rj).length;if(m>1||m>0&&v>0)throw new Ut(st.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(a);for(const l of a)r=l._apply(r);return r}class rj extends nj{constructor(t,o,a){super(),this._field=t,this._op=o,this._value=a,this.type="where"}static _create(t,o,a){return new rj(t,o,a)}_apply(t){const o=this._parse(t);return Jne(t._query,o),new Zf(t.firestore,t.converter,wU(t._query,o))}_parse(t){const o=tk(t.firestore);return function(d,m,v,y,b,R,O){let N;if(b.isKeyField()){if(R==="array-contains"||R==="array-contains-any")throw new Ut(st.INVALID_ARGUMENT,`Invalid Query. You can't perform '${R}' queries on documentId().`);if(R==="in"||R==="not-in"){BY(O,R);const F=[];for(const H of O)F.push(jY(y,d,H));N={arrayValue:{values:F}}}else N=jY(y,d,O)}else R!=="in"&&R!=="not-in"&&R!=="array-contains-any"||BY(O,R),N=Kne(v,m,O,R==="in"||R==="not-in");return jo.create(b,R,N)}(t._query,"where",o,t.firestore._databaseId,this._field,this._op,this._value)}}class ij extends tj{constructor(t,o){super(),this.type=t,this._queryConstraints=o}static _create(t,o){return new ij(t,o)}_parse(t){const o=this._queryConstraints.map(a=>a._parse(t)).filter(a=>a.getFilters().length>0);return o.length===1?o[0]:id.create(o,this._getOperator())}_apply(t){const o=this._parse(t);return o.getFilters().length===0?t:(function(l,d){let m=l;const v=d.getFlattenedFilters();for(const y of v)Jne(m,y),m=wU(m,y)}(t._query,o),new Zf(t.firestore,t.converter,wU(t._query,o)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class oj extends nj{constructor(t,o){super(),this._field=t,this._direction=o,this.type="orderBy"}static _create(t,o){return new oj(t,o)}_apply(t){const o=function(l,d,m){if(l.startAt!==null)throw new Ut(st.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(l.endAt!==null)throw new Ut(st.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Pw(d,m)}(t._query,this._field,this._direction);return new Zf(t.firestore,t.converter,function(l,d){const m=l.explicitOrderBy.concat([d]);return new uv(l.path,l.collectionGroup,m,l.filters.slice(),l.limit,l.limitType,l.startAt,l.endAt)}(t._query,o))}}function Nje(r,t="asc"){const o=t,a=ej("orderBy",r);return oj._create(a,o)}class sj extends nj{constructor(t,o,a){super(),this.type=t,this._docOrFields=o,this._inclusive=a}static _create(t,o,a){return new sj(t,o,a)}_apply(t){const o=Dje(t,this.type,this._docOrFields,this._inclusive);return new Zf(t.firestore,t.converter,function(l,d){return new uv(l.path,l.collectionGroup,l.explicitOrderBy.slice(),l.filters.slice(),l.limit,l.limitType,d,l.endAt)}(t._query,o))}}function kje(...r){return sj._create("startAt",r,!0)}function Dje(r,t,o,a){if(o[0]=to(o[0]),o[0]instanceof ZF)return function(d,m,v,y,b){if(!y)throw new Ut(st.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${v}().`);const R=[];for(const O of tS(d))if(O.field.isKeyField())R.push(KP(m,y.key));else{const N=y.data.field(O.field);if(BN(N))throw new Ut(st.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+O.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(N===null){const F=O.field.canonicalString();throw new Ut(st.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${F}' (used as the orderBy) does not exist.`)}R.push(N)}return new _S(R,b)}(r._query,r.firestore._databaseId,t,o[0]._document,a);{const l=tk(r.firestore);return function(m,v,y,b,R,O){const N=m.explicitOrderBy;if(R.length>N.length)throw new Ut(st.INVALID_ARGUMENT,`Too many arguments provided to ${b}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const F=[];for(let H=0;H<R.length;H++){const G=R[H];if(N[H].field.isKeyField()){if(typeof G!="string")throw new Ut(st.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${b}(), but got a ${typeof G}`);if(!IF(m)&&G.indexOf("/")!==-1)throw new Ut(st.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${b}() must be a plain document ID, but '${G}' contains a slash.`);const z=m.path.child(wi.fromString(G));if(!cn.isDocumentKey(z))throw new Ut(st.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${b}() must result in a valid document path, but '${z}' is not because it contains an odd number of segments.`);const ne=new cn(z);F.push(KP(v,ne))}else{const z=Kne(y,b,G);F.push(z)}}return new _S(F,O)}(r._query,r.firestore._databaseId,l,t,o,a)}}function jY(r,t,o){if(typeof(o=to(o))=="string"){if(o==="")throw new Ut(st.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!IF(t)&&o.indexOf("/")!==-1)throw new Ut(st.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${o}' contains a '/' character.`);const a=t.path.child(wi.fromString(o));if(!cn.isDocumentKey(a))throw new Ut(st.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${a}' is not because it has an odd number of segments (${a.length}).`);return KP(r,new cn(a))}if(o instanceof Ta)return KP(r,o._key);throw new Ut(st.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${JN(o)}.`)}function BY(r,t){if(!Array.isArray(r)||r.length===0)throw new Ut(st.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function Jne(r,t){const o=function(l,d){for(const m of l)for(const v of m.getFlattenedFilters())if(d.indexOf(v.op)>=0)return v.op;return null}(r.filters,function(l){switch(l){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(o!==null)throw o===t.op?new Ut(st.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new Ut(st.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${o.toString()}' filters.`)}class Lje{convertValue(t,o="none"){switch(nv(t)){case 0:return null;case 1:return t.booleanValue;case 2:return Ao(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,o);case 5:return t.stringValue;case 6:return this.convertBytes(tv(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,o);case 11:return this.convertObject(t.mapValue,o);case 10:return this.convertVectorValue(t.mapValue);default:throw Vn()}}convertObject(t,o){return this.convertObjectMap(t.fields,o)}convertObjectMap(t,o="none"){const a={};return lv(t,(l,d)=>{a[l]=this.convertValue(d,o)}),a}convertVectorValue(t){var o,a,l;const d=(l=(a=(o=t.fields)===null||o===void 0?void 0:o.value.arrayValue)===null||a===void 0?void 0:a.values)===null||l===void 0?void 0:l.map(m=>Ao(m.doubleValue));return new YF(d)}convertGeoPoint(t){return new qF(Ao(t.latitude),Ao(t.longitude))}convertArray(t,o){return(t.values||[]).map(a=>this.convertValue(a,o))}convertServerTimestamp(t,o){switch(o){case"previous":const a=bF(t);return a==null?null:this.convertValue(a,o);case"estimate":return this.convertTimestamp(Iw(t));default:return null}}convertTimestamp(t){const o=Lm(t);return new Zo(o.seconds,o.nanos)}convertDocumentKey(t,o){const a=wi.fromString(t);li(Sne(a));const l=new Aw(a.get(1),a.get(3)),d=new cn(a.popFirst(5));return l.isEqual(o)||Xf(`Document ${d} contains a document reference within a different database (${l.projectId}/${l.database}) which is not supported. It will be treated as a reference in the current database (${o.projectId}/${o.database}) instead.`),d}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xje(r,t,o){let a;return a=r?r.toFirestore(t):t,a}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lb{constructor(t,o){this.hasPendingWrites=t,this.fromCache=o}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class Qne extends ZF{constructor(t,o,a,l,d,m){super(t,o,a,l,m),this._firestore=t,this._firestoreImpl=t,this.metadata=d}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const o=new _P(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(o,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,o={}){if(this._document){const a=this._document.data.field(ej("DocumentSnapshot.get",t));if(a!==null)return this._userDataWriter.convertValue(a,o.serverTimestamps)}}}class _P extends Qne{data(t={}){return super.data(t)}}class Zne{constructor(t,o,a,l){this._firestore=t,this._userDataWriter=o,this._snapshot=l,this.metadata=new Lb(l.hasPendingWrites,l.fromCache),this.query=a}get docs(){const t=[];return this.forEach(o=>t.push(o)),t}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(t,o){this._snapshot.docs.forEach(a=>{t.call(o,new _P(this._firestore,this._userDataWriter,a.key,a,new Lb(this._snapshot.mutatedKeys.has(a.key),this._snapshot.fromCache),this.query.converter))})}docChanges(t={}){const o=!!t.includeMetadataChanges;if(o&&this._snapshot.excludesMetadataChanges)throw new Ut(st.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===o||(this._cachedChanges=function(l,d){if(l._snapshot.oldDocs.isEmpty()){let m=0;return l._snapshot.docChanges.map(v=>{const y=new _P(l._firestore,l._userDataWriter,v.doc.key,v.doc,new Lb(l._snapshot.mutatedKeys.has(v.doc.key),l._snapshot.fromCache),l.query.converter);return v.doc,{type:"added",doc:y,oldIndex:-1,newIndex:m++}})}{let m=l._snapshot.oldDocs;return l._snapshot.docChanges.filter(v=>d||v.type!==3).map(v=>{const y=new _P(l._firestore,l._userDataWriter,v.doc.key,v.doc,new Lb(l._snapshot.mutatedKeys.has(v.doc.key),l._snapshot.fromCache),l.query.converter);let b=-1,R=-1;return v.type!==0&&(b=m.indexOf(v.doc.key),m=m.delete(v.doc.key)),v.type!==1&&(m=m.add(v.doc),R=m.indexOf(v.doc.key)),{type:Mje(v.type),doc:y,oldIndex:b,newIndex:R}})}}(this,o),this._cachedChangesIncludeMetadataChanges=o),this._cachedChanges}}function Mje(r){switch(r){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Vn()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xU(r){r=ru(r,Ta);const t=ru(r.firestore,rv);return gje(ZN(t),r._key).then(o=>rre(t,r,o))}class aj extends Lje{constructor(t){super(),this.firestore=t}convertBytes(t){return new SS(t)}convertReference(t){const o=this.convertDocumentKey(t,this.firestore._databaseId);return new Ta(this.firestore,null,o)}}function Uje(r){r=ru(r,Zf);const t=ru(r.firestore,rv),o=ZN(t),a=new aj(t);return Xne(r._query),_je(o,r._query).then(l=>new Zne(t,a,r,l))}function Vje(r,t,o){r=ru(r,Ta);const a=ru(r.firestore,rv),l=xje(r.converter,t);return nre(a,[Rje(tk(a),"setDoc",r._key,l,r.converter!==null,o).toMutation(r._key,_h.none())])}function ere(r,t,o,...a){r=ru(r,Ta);const l=ru(r.firestore,rv),d=tk(l);let m;return m=typeof(t=to(t))=="string"||t instanceof ek?Ije(d,"updateDoc",r._key,t,o,a):Cje(d,"updateDoc",r._key,t),nre(l,[m.toMutation(r._key,_h.exists(!0))])}function tre(r,...t){var o,a,l;r=to(r);let d={includeMetadataChanges:!1,source:"default"},m=0;typeof t[m]!="object"||FY(t[m])||(d=t[m],m++);const v={includeMetadataChanges:d.includeMetadataChanges,source:d.source};if(FY(t[m])){const O=t[m];t[m]=(o=O.next)===null||o===void 0?void 0:o.bind(O),t[m+1]=(a=O.error)===null||a===void 0?void 0:a.bind(O),t[m+2]=(l=O.complete)===null||l===void 0?void 0:l.bind(O)}let y,b,R;if(r instanceof Ta)b=ru(r.firestore,rv),R=WN(r._key.path),y={next:O=>{t[m]&&t[m](rre(b,r,O))},error:t[m+1],complete:t[m+2]};else{const O=ru(r,Zf);b=ru(O.firestore,rv),R=O._query;const N=new aj(b);y={next:F=>{t[m]&&t[m](new Zne(b,N,O,F))},error:t[m+1],complete:t[m+2]},Xne(r._query)}return function(N,F,H,G){const z=new KF(G),ne=new zF(F,z,H);return N.asyncQueue.enqueueAndForget(async()=>BF(await QP(N),ne)),()=>{z.Za(),N.asyncQueue.enqueueAndForget(async()=>WF(await QP(N),ne))}}(ZN(b),R,v,y)}function nre(r,t){return function(a,l){const d=new Hf;return a.asyncQueue.enqueueAndForget(async()=>oje(await mje(a),l,d)),d.promise}(ZN(r),t)}function rre(r,t,o){const a=o.docs.get(t._key),l=new aj(r);return new Qne(r,l,t._key,a,new Lb(o.hasPendingWrites,o.fromCache),t.converter)}(function(t,o=!0){(function(l){NS=l})(av),J_(new km("firestore",(a,{instanceIdentifier:l,options:d})=>{const m=a.getProvider("app").getImmediate(),v=new rv(new VUe(a.getProvider("auth-internal")),new WUe(a.getProvider("app-check-internal")),function(b,R){if(!Object.prototype.hasOwnProperty.apply(b.options,["projectId"]))throw new Ut(st.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Aw(b.options.projectId,R)}(m,l),m);return d=Object.assign({useFetchStreams:o},d),v._setSettings(d),v},"PUBLIC").setMultipleInstances(!0)),fh(rY,"4.7.3",t),fh(rY,"4.7.3","esm2017")})();var Fje="firebase",jje="10.14.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */fh(Fje,jje,"app");const Bje={apiKey:"AIzaSyCaxoNKRIMaXhotGzdAjXc5gkARoqtS3bU",authDomain:"disruptive-metaverse.firebaseapp.com",projectId:"disruptive-metaverse",storageBucket:"disruptive-metaverse.appspot.com",messagingSenderId:"294433070603",appId:"1:294433070603:web:136cddd196eea9614fb10e"},ire=Qee(Bje),Wje=xte(ire),Mm=yje(ire),Um=async r=>{try{Ct.log("userFirestore: Get user Profile data for user ID: "+r);const t=yS(Mm,"users",r),o=await xU(t);return o.exists()?(Ct.log("userFirestore: Found Profile for : "+o.data().Nickname),o.data()):(Ct.error("userFirestore: user profile document not found"),null)}catch(t){throw Ct.error("userFirestore: Error fetching user profile data:",t),t}},Gje=async(r,t,o)=>{try{const l=(await E2e(Wje,r,t)).user,d=yS(Mm,"users",l.uid);return await Vje(d,{email:l.email,createdAt:new Date,...o}),Ct.log("userFirestore: User created successfully."),l}catch(a){throw Ct.error("userFirestore: Error creating user:",a),a}},ore=async(r,t)=>{try{Ct.log(`userFirestore: Updating rpmURL for user ID: ${r}`);const o=yS(Mm,"users",r);await ere(o,{rpmURL:t,lastUpdated:new Date().toISOString()}),Ct.log("userFirestore: rpmURL updated successfully.")}catch(o){throw Ct.error("userFirestore: Error updating rpmURL:",o),o}},zje=["email","name","rpmURL","Nickname","created_on","height_cm","companyName","firstName","lastName","linkedInProfile"],xb={sendUserToUnity:"sendUserToUnity"};class Hje{constructor(){this.events={}}subscribe(t,o){this.events[t]||(this.events[t]=[]),this.events[t].push(o)}publish(t,o){const a=this.events[t];a?(a.forEach(l=>{l(o)}),Ct.log(`EventBus: Published event '${t}'`)):Ct.log(`EventBus: No subscribers for event '${t}'`)}unsubscribe(t,o){var l;const a=(l=this.events[t])==null?void 0:l.indexOf(o);a>-1&&this.events[t].splice(a,1)}}const Mb=new Hje,wa=V.createContext(null),rk=({children:r})=>{const[t,o]=V.useState(null),a=V.useRef(null),[l,d]=V.useState(!0),m=xte(),v=z=>z?z.Nickname?z.Nickname:`${z.firstName} ${z.lastName}`:"Anon";V.useEffect(()=>{const z=b2e(m,async ne=>{if(Ct.log("UserProvider: Firebase onAuthStateChanged() fired"),ne)try{const J=await Um(ne.uid),oe=v(J),se={uid:ne.uid,email:ne.email,...J,displayName:oe};console.log(se),o(se),a.current=se,O(se)}catch(J){Ct.error("UserProvider: Error fetching user profile data:",J)}else o(null),a.current=null;d(!1)});return()=>{z&&z()}},[]);const y=async(z,ne,J)=>{try{const{firstName:oe,lastName:se}=J,ae=`${oe}${se.charAt(0).toUpperCase()}`,ye={...J,Nickname:ae,rpmURL:"https://models.readyplayer.me/67c8408d38f7924e15a8bd0a.glb"},Q=await Gje(z,ne,ye);o(Q),a.current=Q}catch(oe){throw Ct.error("UserProvider: Error creating user:",oe),oe}},b=async(z,ne)=>{try{const J=await y2e(m,z,ne),oe=await Um(J.user.uid),se=v(oe),ae={uid:J.user.uid,email:J.user.email,...oe,displayName:se};o(ae),O(ae)}catch(J){throw Ct.error("UserProvider: Error signing in:",J),J}},R=async()=>{try{await w2e(m),o(null),Ct.log("UserProvider: User signed out.")}catch(z){throw Ct.error("UserProvider: Error signing out:",z),z}},O=()=>{const z=a.current;if(z){const ne=N(z);Ct.log("UserProvider: sendUserToUnity() using the eventBus",ne),Mb.publish(xb.sendUserToUnity,ne)}else Ct.log("UserProvider: No current user to send to Unity.")},N=z=>{const ne={};return[...zje,"uid"].forEach(oe=>{z.hasOwnProperty(oe)&&(ne[oe]=z[oe])}),ne},F=async z=>{if(!t||!t.uid)return!1;try{const ne=await getSpaceItem(z);return ne.usersAllowed.includes(t.uid)||ne.userAdmin.includes(t.uid)||ne.usersModerators.includes(t.uid)}catch(ne){return Ct.error("UserProvider: Error verifying user access to space:",ne),!1}},H=async z=>{if(!t||!t.uid)return!1;try{return(await getSpaceItem(z)).userAdmin.includes(t.uid)}catch(ne){return Ct.error("UserProvider: Error verifying user admin status for space:",ne),!1}},G=async z=>{if(!t||!t.uid)return!1;try{return(await getSpaceItem(z)).usersModerators.includes(t.uid)}catch(ne){return Ct.error("UserProvider: Error verifying user moderator status for space:",ne),!1}};return D.jsx(wa.Provider,{value:{user:t,loading:l,register:y,signIn:b,signOut:R,sendUserToUnity:O,userHasAccessToSpace:F,userIsAdminOfSpace:H,userIsModeratorOfSpace:G},children:r})},sre=V.createContext(),ep=()=>V.useContext(sre),cj=({children:r})=>{const[t,o]=V.useState(!1),a=V.useRef(null),[l,d]=V.useState(!1);V.useEffect(()=>{const y=()=>{const b=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent);d(b)};return y(),window.addEventListener("resize",y),()=>window.removeEventListener("resize",y)},[]);const m=V.useCallback(y=>{a.current=y},[]),v=V.useCallback(()=>{const y=a.current;if(y){if(l){y.webkitEnterFullscreen&&(document.webkitFullscreenElement?(document.webkitExitFullscreen(),o(!1)):(y.webkitEnterFullscreen(),o(!0)));return}document.fullscreenElement?document.exitFullscreen&&document.exitFullscreen().then(()=>{o(!1)}).catch(b=>console.error("Error exiting fullscreen:",b)):y.requestFullscreen&&y.requestFullscreen().then(()=>{o(!0)}).catch(b=>console.error("Error entering fullscreen:",b))}},[l]);return V.useEffect(()=>{const y=()=>{o(!!document.fullscreenElement)},b=()=>{o(!!document.webkitFullscreenElement)};return document.addEventListener("fullscreenchange",y),document.addEventListener("webkitfullscreenchange",b),()=>{document.removeEventListener("fullscreenchange",y),document.removeEventListener("webkitfullscreenchange",b)}},[]),D.jsx(sre.Provider,{value:{isFullscreen:t,toggleFullscreen:v,fullscreenRef:a,setFullscreenRef:m,isMobile:l},children:D.jsx("div",{ref:m,style:{position:"relative",zIndex:1,width:"100%",height:"100%",overflow:"hidden"},children:r})})};var Kje=IS({displayName:"QuestionOutlineIcon",path:D.jsxs("g",{stroke:"currentColor",strokeWidth:"1.5",children:[D.jsx("path",{strokeLinecap:"round",fill:"none",d:"M9,9a3,3,0,1,1,4,2.829,1.5,1.5,0,0,0-1,1.415V14.25"}),D.jsx("path",{fill:"none",strokeLinecap:"round",d:"M12,17.25a.375.375,0,1,0,.375.375A.375.375,0,0,0,12,17.25h0"}),D.jsx("circle",{fill:"none",strokeMiterlimit:"10",cx:"12",cy:"12",r:"11.25"})]})}),$je=IS({displayName:"EmailIcon",path:D.jsxs("g",{fill:"currentColor",children:[D.jsx("path",{d:"M11.114,14.556a1.252,1.252,0,0,0,1.768,0L22.568,4.87a.5.5,0,0,0-.281-.849A1.966,1.966,0,0,0,22,4H2a1.966,1.966,0,0,0-.289.021.5.5,0,0,0-.281.849Z"}),D.jsx("path",{d:"M23.888,5.832a.182.182,0,0,0-.2.039l-6.2,6.2a.251.251,0,0,0,0,.354l5.043,5.043a.75.75,0,1,1-1.06,1.061l-5.043-5.043a.25.25,0,0,0-.354,0l-2.129,2.129a2.75,2.75,0,0,1-3.888,0L7.926,13.488a.251.251,0,0,0-.354,0L2.529,18.531a.75.75,0,0,1-1.06-1.061l5.043-5.043a.251.251,0,0,0,0-.354l-6.2-6.2a.18.18,0,0,0-.2-.039A.182.182,0,0,0,0,6V18a2,2,0,0,0,2,2H22a2,2,0,0,0,2-2V6A.181.181,0,0,0,23.888,5.832Z"})]})}),qje=IS({displayName:"HamburgerIcon",viewBox:"0 0 24 24",d:"M 3 5 A 1.0001 1.0001 0 1 0 3 7 L 21 7 A 1.0001 1.0001 0 1 0 21 5 L 3 5 z M 3 11 A 1.0001 1.0001 0 1 0 3 13 L 21 13 A 1.0001 1.0001 0 1 0 21 11 L 3 11 z M 3 17 A 1.0001 1.0001 0 1 0 3 19 L 21 19 A 1.0001 1.0001 0 1 0 21 17 L 3 17 z"}),Yje=IS({d:"M19.5,9.5h-.75V6.75a6.75,6.75,0,0,0-13.5,0V9.5H4.5a2,2,0,0,0-2,2V22a2,2,0,0,0,2,2h15a2,2,0,0,0,2-2V11.5A2,2,0,0,0,19.5,9.5Zm-9.5,6a2,2,0,1,1,3,1.723V19.5a1,1,0,0,1-2,0V17.223A1.994,1.994,0,0,1,10,15.5ZM7.75,6.75a4.25,4.25,0,0,1,8.5,0V9a.5.5,0,0,1-.5.5H8.25a.5.5,0,0,1-.5-.5Z",displayName:"LockIcon"}),Xje=IS({displayName:"CloseIcon",d:"M.439,21.44a1.5,1.5,0,0,0,2.122,2.121L11.823,14.3a.25.25,0,0,1,.354,0l9.262,9.263a1.5,1.5,0,1,0,2.122-2.121L14.3,12.177a.25.25,0,0,1,0-.354l9.263-9.262A1.5,1.5,0,0,0,21.439.44L12.177,9.7a.25.25,0,0,1-.354,0L2.561.44A1.5,1.5,0,0,0,.439,2.561L9.7,11.823a.25.25,0,0,1,0,.354Z"}),Jje=IS({displayName:"ChevronDownIcon",d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"}),fR=r=>r.type==="checkbox",By=r=>r instanceof Date,za=r=>r==null;const are=r=>typeof r=="object";var es=r=>!za(r)&&!Array.isArray(r)&&are(r)&&!By(r),Qje=r=>es(r)&&r.target?fR(r.target)?r.target.checked:r.target.value:r,Zje=r=>r.substring(0,r.search(/\.\d+(\.|$)/))||r,eBe=(r,t)=>r.has(Zje(t)),tBe=r=>{const t=r.constructor&&r.constructor.prototype;return es(t)&&t.hasOwnProperty("isPrototypeOf")},lj=typeof window<"u"&&typeof window.HTMLElement<"u"&&typeof document<"u";function Jl(r){let t;const o=Array.isArray(r);if(r instanceof Date)t=new Date(r);else if(r instanceof Set)t=new Set(r);else if(!(lj&&(r instanceof Blob||r instanceof FileList))&&(o||es(r)))if(t=o?[]:{},!o&&!tBe(r))t=r;else for(const a in r)r.hasOwnProperty(a)&&(t[a]=Jl(r[a]));else return r;return t}var pR=r=>Array.isArray(r)?r.filter(Boolean):[],Io=r=>r===void 0,Zt=(r,t,o)=>{if(!t||!es(r))return o;const a=pR(t.split(/[,[\].]+?/)).reduce((l,d)=>za(l)?l:l[d],r);return Io(a)||a===r?Io(r[t])?o:r[t]:a},Nf=r=>typeof r=="boolean";const WY={BLUR:"blur",FOCUS_OUT:"focusout"},td={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},If={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"};Gi.createContext(null);var nBe=(r,t,o,a=!0)=>{const l={defaultValues:t._defaultValues};for(const d in r)Object.defineProperty(l,d,{get:()=>{const m=d;return t._proxyFormState[m]!==td.all&&(t._proxyFormState[m]=!a||td.all),r[m]}});return l},ll=r=>es(r)&&!Object.keys(r).length,rBe=(r,t,o,a)=>{o(r);const{name:l,...d}=r;return ll(d)||Object.keys(d).length>=Object.keys(t).length||Object.keys(d).find(m=>t[m]===td.all)},t2=r=>Array.isArray(r)?r:[r];function iBe(r){const t=Gi.useRef(r);t.current=r,Gi.useEffect(()=>{const o=!r.disabled&&t.current.subject&&t.current.subject.subscribe({next:t.current.next});return()=>{o&&o.unsubscribe()}},[r.disabled])}var ch=r=>typeof r=="string",oBe=(r,t,o,a,l)=>ch(r)?(a&&t.watch.add(r),Zt(o,r,l)):Array.isArray(r)?r.map(d=>(a&&t.watch.add(d),Zt(o,d))):(a&&(t.watchAll=!0),o),uj=r=>/^\w*$/.test(r),cre=r=>pR(r.replace(/["|']|\]/g,"").split(/\.|\[/)),Mi=(r,t,o)=>{let a=-1;const l=uj(t)?[t]:cre(t),d=l.length,m=d-1;for(;++a<d;){const v=l[a];let y=o;if(a!==m){const b=r[v];y=es(b)||Array.isArray(b)?b:isNaN(+l[a+1])?{}:[]}r[v]=y,r=r[v]}return r},sBe=(r,t,o,a,l)=>t?{...o[r],types:{...o[r]&&o[r].types?o[r].types:{},[a]:l||!0}}:{},GY=r=>({isOnSubmit:!r||r===td.onSubmit,isOnBlur:r===td.onBlur,isOnChange:r===td.onChange,isOnAll:r===td.all,isOnTouch:r===td.onTouched}),zY=(r,t,o)=>!o&&(t.watchAll||t.watch.has(r)||[...t.watch].some(a=>r.startsWith(a)&&/^\.\w+/.test(r.slice(a.length))));const ew=(r,t,o,a)=>{for(const l of o||Object.keys(r)){const d=Zt(r,l);if(d){const{_f:m,...v}=d;if(m){if(m.refs&&m.refs[0]&&t(m.refs[0],l)&&!a)break;if(m.ref&&t(m.ref,m.name)&&!a)break;ew(v,t)}else es(v)&&ew(v,t)}}};var aBe=(r,t,o)=>{const a=pR(Zt(r,o));return Mi(a,"root",t[o]),Mi(r,o,a),r},dj=r=>r.type==="file",Sm=r=>typeof r=="function",eN=r=>{if(!lj)return!1;const t=r?r.ownerDocument:0;return r instanceof(t&&t.defaultView?t.defaultView.HTMLElement:HTMLElement)},vP=r=>ch(r),hj=r=>r.type==="radio",tN=r=>r instanceof RegExp;const HY={value:!1,isValid:!1},KY={value:!0,isValid:!0};var lre=r=>{if(Array.isArray(r)){if(r.length>1){const t=r.filter(o=>o&&o.checked&&!o.disabled).map(o=>o.value);return{value:t,isValid:!!t.length}}return r[0].checked&&!r[0].disabled?r[0].attributes&&!Io(r[0].attributes.value)?Io(r[0].value)||r[0].value===""?KY:{value:r[0].value,isValid:!0}:KY:HY}return HY};const $Y={isValid:!1,value:null};var ure=r=>Array.isArray(r)?r.reduce((t,o)=>o&&o.checked&&!o.disabled?{isValid:!0,value:o.value}:t,$Y):$Y;function qY(r,t,o="validate"){if(vP(r)||Array.isArray(r)&&r.every(vP)||Nf(r)&&!r)return{type:o,message:vP(r)?r:"",ref:t}}var Ty=r=>es(r)&&!tN(r)?r:{value:r,message:""},YY=async(r,t,o,a,l)=>{const{ref:d,refs:m,required:v,maxLength:y,minLength:b,min:R,max:O,pattern:N,validate:F,name:H,valueAsNumber:G,mount:z,disabled:ne}=r._f,J=Zt(t,H);if(!z||ne)return{};const oe=m?m[0]:d,se=fe=>{a&&oe.reportValidity&&(oe.setCustomValidity(Nf(fe)?"":fe||""),oe.reportValidity())},ae={},ye=hj(d),Q=fR(d),te=ye||Q,re=(G||dj(d))&&Io(d.value)&&Io(J)||eN(d)&&d.value===""||J===""||Array.isArray(J)&&!J.length,le=sBe.bind(null,H,o,ae),ve=(fe,de,lt,ft=If.maxLength,Xe=If.minLength)=>{const Le=fe?de:lt;ae[H]={type:fe?ft:Xe,message:Le,ref:d,...le(fe?ft:Xe,Le)}};if(l?!Array.isArray(J)||!J.length:v&&(!te&&(re||za(J))||Nf(J)&&!J||Q&&!lre(m).isValid||ye&&!ure(m).isValid)){const{value:fe,message:de}=vP(v)?{value:!!v,message:v}:Ty(v);if(fe&&(ae[H]={type:If.required,message:de,ref:oe,...le(If.required,de)},!o))return se(de),ae}if(!re&&(!za(R)||!za(O))){let fe,de;const lt=Ty(O),ft=Ty(R);if(!za(J)&&!isNaN(J)){const Xe=d.valueAsNumber||J&&+J;za(lt.value)||(fe=Xe>lt.value),za(ft.value)||(de=Xe<ft.value)}else{const Xe=d.valueAsDate||new Date(J),Le=Ee=>new Date(new Date().toDateString()+" "+Ee),Ke=d.type=="time",nt=d.type=="week";ch(lt.value)&&J&&(fe=Ke?Le(J)>Le(lt.value):nt?J>lt.value:Xe>new Date(lt.value)),ch(ft.value)&&J&&(de=Ke?Le(J)<Le(ft.value):nt?J<ft.value:Xe<new Date(ft.value))}if((fe||de)&&(ve(!!fe,lt.message,ft.message,If.max,If.min),!o))return se(ae[H].message),ae}if((y||b)&&!re&&(ch(J)||l&&Array.isArray(J))){const fe=Ty(y),de=Ty(b),lt=!za(fe.value)&&J.length>+fe.value,ft=!za(de.value)&&J.length<+de.value;if((lt||ft)&&(ve(lt,fe.message,de.message),!o))return se(ae[H].message),ae}if(N&&!re&&ch(J)){const{value:fe,message:de}=Ty(N);if(tN(fe)&&!J.match(fe)&&(ae[H]={type:If.pattern,message:de,ref:d,...le(If.pattern,de)},!o))return se(de),ae}if(F){if(Sm(F)){const fe=await F(J,t),de=qY(fe,oe);if(de&&(ae[H]={...de,...le(If.validate,de.message)},!o))return se(de.message),ae}else if(es(F)){let fe={};for(const de in F){if(!ll(fe)&&!o)break;const lt=qY(await F[de](J,t),oe,de);lt&&(fe={...lt,...le(de,lt.message)},se(lt.message),o&&(ae[H]=fe))}if(!ll(fe)&&(ae[H]={ref:oe,...fe},!o))return ae}}return se(!0),ae};function cBe(r,t){const o=t.slice(0,-1).length;let a=0;for(;a<o;)r=Io(r)?a++:r[t[a++]];return r}function lBe(r){for(const t in r)if(r.hasOwnProperty(t)&&!Io(r[t]))return!1;return!0}function Qo(r,t){const o=Array.isArray(t)?t:uj(t)?[t]:cre(t),a=o.length===1?r:cBe(r,o),l=o.length-1,d=o[l];return a&&delete a[d],l!==0&&(es(a)&&ll(a)||Array.isArray(a)&&lBe(a))&&Qo(r,o.slice(0,-1)),r}var n2=()=>{let r=[];return{get observers(){return r},next:l=>{for(const d of r)d.next&&d.next(l)},subscribe:l=>(r.push(l),{unsubscribe:()=>{r=r.filter(d=>d!==l)}}),unsubscribe:()=>{r=[]}}},nN=r=>za(r)||!are(r);function x_(r,t){if(nN(r)||nN(t))return r===t;if(By(r)&&By(t))return r.getTime()===t.getTime();const o=Object.keys(r),a=Object.keys(t);if(o.length!==a.length)return!1;for(const l of o){const d=r[l];if(!a.includes(l))return!1;if(l!=="ref"){const m=t[l];if(By(d)&&By(m)||es(d)&&es(m)||Array.isArray(d)&&Array.isArray(m)?!x_(d,m):d!==m)return!1}}return!0}var dre=r=>r.type==="select-multiple",uBe=r=>hj(r)||fR(r),r2=r=>eN(r)&&r.isConnected,hre=r=>{for(const t in r)if(Sm(r[t]))return!0;return!1};function rN(r,t={}){const o=Array.isArray(r);if(es(r)||o)for(const a in r)Array.isArray(r[a])||es(r[a])&&!hre(r[a])?(t[a]=Array.isArray(r[a])?[]:{},rN(r[a],t[a])):za(r[a])||(t[a]=!0);return t}function fre(r,t,o){const a=Array.isArray(r);if(es(r)||a)for(const l in r)Array.isArray(r[l])||es(r[l])&&!hre(r[l])?Io(t)||nN(o[l])?o[l]=Array.isArray(r[l])?rN(r[l],[]):{...rN(r[l])}:fre(r[l],za(t)?{}:t[l],o[l]):o[l]=!x_(r[l],t[l]);return o}var DO=(r,t)=>fre(r,t,rN(t)),pre=(r,{valueAsNumber:t,valueAsDate:o,setValueAs:a})=>Io(r)?r:t?r===""?NaN:r&&+r:o&&ch(r)?new Date(r):a?a(r):r;function i2(r){const t=r.ref;if(!(r.refs?r.refs.every(o=>o.disabled):t.disabled))return dj(t)?t.files:hj(t)?ure(r.refs).value:dre(t)?[...t.selectedOptions].map(({value:o})=>o):fR(t)?lre(r.refs).value:pre(Io(t.value)?r.ref.value:t.value,r)}var dBe=(r,t,o,a)=>{const l={};for(const d of r){const m=Zt(t,d);m&&Mi(l,d,m._f)}return{criteriaMode:o,names:[...r],fields:l,shouldUseNativeValidation:a}},cb=r=>Io(r)?r:tN(r)?r.source:es(r)?tN(r.value)?r.value.source:r.value:r,hBe=r=>r.mount&&(r.required||r.min||r.max||r.maxLength||r.minLength||r.pattern||r.validate);function XY(r,t,o){const a=Zt(r,o);if(a||uj(o))return{error:a,name:o};const l=o.split(".");for(;l.length;){const d=l.join("."),m=Zt(t,d),v=Zt(r,d);if(m&&!Array.isArray(m)&&o!==d)return{name:o};if(v&&v.type)return{name:d,error:v};l.pop()}return{name:o}}var fBe=(r,t,o,a,l)=>l.isOnAll?!1:!o&&l.isOnTouch?!(t||r):(o?a.isOnBlur:l.isOnBlur)?!r:(o?a.isOnChange:l.isOnChange)?r:!0,pBe=(r,t)=>!pR(Zt(r,t)).length&&Qo(r,t);const mBe={mode:td.onSubmit,reValidateMode:td.onChange,shouldFocusError:!0};function gBe(r={}){let t={...mBe,...r},o={submitCount:0,isDirty:!1,isLoading:Sm(t.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:t.errors||{},disabled:t.disabled||!1},a={},l=es(t.defaultValues)||es(t.values)?Jl(t.defaultValues||t.values)||{}:{},d=t.shouldUnregister?{}:Jl(l),m={action:!1,mount:!1,watch:!1},v={mount:new Set,unMount:new Set,array:new Set,watch:new Set},y,b=0;const R={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1},O={values:n2(),array:n2(),state:n2()},N=GY(t.mode),F=GY(t.reValidateMode),H=t.criteriaMode===td.all,G=we=>De=>{clearTimeout(b),b=setTimeout(we,De)},z=async we=>{if(R.isValid||we){const De=t.resolver?ll((await te()).errors):await le(a,!0);De!==o.isValid&&O.state.next({isValid:De})}},ne=(we,De)=>{(R.isValidating||R.validatingFields)&&((we||Array.from(v.mount)).forEach(We=>{We&&(De?Mi(o.validatingFields,We,De):Qo(o.validatingFields,We))}),O.state.next({validatingFields:o.validatingFields,isValidating:!ll(o.validatingFields)}))},J=(we,De=[],We,mt,gt=!0,ht=!0)=>{if(mt&&We){if(m.action=!0,ht&&Array.isArray(Zt(a,we))){const Mt=We(Zt(a,we),mt.argA,mt.argB);gt&&Mi(a,we,Mt)}if(ht&&Array.isArray(Zt(o.errors,we))){const Mt=We(Zt(o.errors,we),mt.argA,mt.argB);gt&&Mi(o.errors,we,Mt),pBe(o.errors,we)}if(R.touchedFields&&ht&&Array.isArray(Zt(o.touchedFields,we))){const Mt=We(Zt(o.touchedFields,we),mt.argA,mt.argB);gt&&Mi(o.touchedFields,we,Mt)}R.dirtyFields&&(o.dirtyFields=DO(l,d)),O.state.next({name:we,isDirty:fe(we,De),dirtyFields:o.dirtyFields,errors:o.errors,isValid:o.isValid})}else Mi(d,we,De)},oe=(we,De)=>{Mi(o.errors,we,De),O.state.next({errors:o.errors})},se=we=>{o.errors=we,O.state.next({errors:o.errors,isValid:!1})},ae=(we,De,We,mt)=>{const gt=Zt(a,we);if(gt){const ht=Zt(d,we,Io(We)?Zt(l,we):We);Io(ht)||mt&&mt.defaultChecked||De?Mi(d,we,De?ht:i2(gt._f)):ft(we,ht),m.mount&&z()}},ye=(we,De,We,mt,gt)=>{let ht=!1,Mt=!1;const jn={name:we},On=!!(Zt(a,we)&&Zt(a,we)._f.disabled);if(!We||mt){R.isDirty&&(Mt=o.isDirty,o.isDirty=jn.isDirty=fe(),ht=Mt!==jn.isDirty);const nn=On||x_(Zt(l,we),De);Mt=!!(!On&&Zt(o.dirtyFields,we)),nn||On?Qo(o.dirtyFields,we):Mi(o.dirtyFields,we,!0),jn.dirtyFields=o.dirtyFields,ht=ht||R.dirtyFields&&Mt!==!nn}if(We){const nn=Zt(o.touchedFields,we);nn||(Mi(o.touchedFields,we,We),jn.touchedFields=o.touchedFields,ht=ht||R.touchedFields&&nn!==We)}return ht&&gt&&O.state.next(jn),ht?jn:{}},Q=(we,De,We,mt)=>{const gt=Zt(o.errors,we),ht=R.isValid&&Nf(De)&&o.isValid!==De;if(r.delayError&&We?(y=G(()=>oe(we,We)),y(r.delayError)):(clearTimeout(b),y=null,We?Mi(o.errors,we,We):Qo(o.errors,we)),(We?!x_(gt,We):gt)||!ll(mt)||ht){const Mt={...mt,...ht&&Nf(De)?{isValid:De}:{},errors:o.errors,name:we};o={...o,...Mt},O.state.next(Mt)}},te=async we=>{ne(we,!0);const De=await t.resolver(d,t.context,dBe(we||v.mount,a,t.criteriaMode,t.shouldUseNativeValidation));return ne(we),De},re=async we=>{const{errors:De}=await te(we);if(we)for(const We of we){const mt=Zt(De,We);mt?Mi(o.errors,We,mt):Qo(o.errors,We)}else o.errors=De;return De},le=async(we,De,We={valid:!0})=>{for(const mt in we){const gt=we[mt];if(gt){const{_f:ht,...Mt}=gt;if(ht){const jn=v.array.has(ht.name);ne([mt],!0);const On=await YY(gt,d,H,t.shouldUseNativeValidation&&!De,jn);if(ne([mt]),On[ht.name]&&(We.valid=!1,De))break;!De&&(Zt(On,ht.name)?jn?aBe(o.errors,On,ht.name):Mi(o.errors,ht.name,On[ht.name]):Qo(o.errors,ht.name))}Mt&&await le(Mt,De,We)}}return We.valid},ve=()=>{for(const we of v.unMount){const De=Zt(a,we);De&&(De._f.refs?De._f.refs.every(We=>!r2(We)):!r2(De._f.ref))&&_t(we)}v.unMount=new Set},fe=(we,De)=>(we&&De&&Mi(d,we,De),!x_(Ye(),l)),de=(we,De,We)=>oBe(we,v,{...m.mount?d:Io(De)?l:ch(we)?{[we]:De}:De},We,De),lt=we=>pR(Zt(m.mount?d:l,we,r.shouldUnregister?Zt(l,we,[]):[])),ft=(we,De,We={})=>{const mt=Zt(a,we);let gt=De;if(mt){const ht=mt._f;ht&&(!ht.disabled&&Mi(d,we,pre(De,ht)),gt=eN(ht.ref)&&za(De)?"":De,dre(ht.ref)?[...ht.ref.options].forEach(Mt=>Mt.selected=gt.includes(Mt.value)):ht.refs?fR(ht.ref)?ht.refs.length>1?ht.refs.forEach(Mt=>(!Mt.defaultChecked||!Mt.disabled)&&(Mt.checked=Array.isArray(gt)?!!gt.find(jn=>jn===Mt.value):gt===Mt.value)):ht.refs[0]&&(ht.refs[0].checked=!!gt):ht.refs.forEach(Mt=>Mt.checked=Mt.value===gt):dj(ht.ref)?ht.ref.value="":(ht.ref.value=gt,ht.ref.type||O.values.next({name:we,values:{...d}})))}(We.shouldDirty||We.shouldTouch)&&ye(we,gt,We.shouldTouch,We.shouldDirty,!0),We.shouldValidate&&Ee(we)},Xe=(we,De,We)=>{for(const mt in De){const gt=De[mt],ht=`${we}.${mt}`,Mt=Zt(a,ht);(v.array.has(we)||!nN(gt)||Mt&&!Mt._f)&&!By(gt)?Xe(ht,gt,We):ft(ht,gt,We)}},Le=(we,De,We={})=>{const mt=Zt(a,we),gt=v.array.has(we),ht=Jl(De);Mi(d,we,ht),gt?(O.array.next({name:we,values:{...d}}),(R.isDirty||R.dirtyFields)&&We.shouldDirty&&O.state.next({name:we,dirtyFields:DO(l,d),isDirty:fe(we,ht)})):mt&&!mt._f&&!za(ht)?Xe(we,ht,We):ft(we,ht,We),zY(we,v)&&O.state.next({...o}),O.values.next({name:m.mount?we:void 0,values:{...d}})},Ke=async we=>{m.mount=!0;const De=we.target;let We=De.name,mt=!0;const gt=Zt(a,We),ht=()=>De.type?i2(gt._f):Qje(we),Mt=jn=>{mt=Number.isNaN(jn)||jn===Zt(d,We,jn)};if(gt){let jn,On;const nn=ht(),_r=we.type===WY.BLUR||we.type===WY.FOCUS_OUT,Ra=!hBe(gt._f)&&!t.resolver&&!Zt(o.errors,We)&&!gt._f.deps||fBe(_r,Zt(o.touchedFields,We),o.isSubmitted,F,N),_o=zY(We,v,_r);Mi(d,We,nn),_r?(gt._f.onBlur&&gt._f.onBlur(we),y&&y(0)):gt._f.onChange&&gt._f.onChange(we);const ns=ye(We,nn,_r,!1),Lt=!ll(ns)||_o;if(!_r&&O.values.next({name:We,type:we.type,values:{...d}}),Ra)return R.isValid&&z(),Lt&&O.state.next({name:We,..._o?{}:ns});if(!_r&&_o&&O.state.next({...o}),t.resolver){const{errors:fn}=await te([We]);if(Mt(nn),mt){const rs=XY(o.errors,a,We),or=XY(fn,a,rs.name||We);jn=or.error,We=or.name,On=ll(fn)}}else ne([We],!0),jn=(await YY(gt,d,H,t.shouldUseNativeValidation))[We],ne([We]),Mt(nn),mt&&(jn?On=!1:R.isValid&&(On=await le(a,!0)));mt&&(gt._f.deps&&Ee(gt._f.deps),Q(We,On,jn,ns))}},nt=(we,De)=>{if(Zt(o.errors,De)&&we.focus)return we.focus(),1},Ee=async(we,De={})=>{let We,mt;const gt=t2(we);if(t.resolver){const ht=await re(Io(we)?we:gt);We=ll(ht),mt=we?!gt.some(Mt=>Zt(ht,Mt)):We}else we?(mt=(await Promise.all(gt.map(async ht=>{const Mt=Zt(a,ht);return await le(Mt&&Mt._f?{[ht]:Mt}:Mt)}))).every(Boolean),!(!mt&&!o.isValid)&&z()):mt=We=await le(a);return O.state.next({...!ch(we)||R.isValid&&We!==o.isValid?{}:{name:we},...t.resolver||!we?{isValid:We}:{},errors:o.errors}),De.shouldFocus&&!mt&&ew(a,nt,we?gt:v.mount),mt},Ye=we=>{const De={...l,...m.mount?d:{}};return Io(we)?De:ch(we)?Zt(De,we):we.map(We=>Zt(De,We))},yt=(we,De)=>({invalid:!!Zt((De||o).errors,we),isDirty:!!Zt((De||o).dirtyFields,we),isTouched:!!Zt((De||o).touchedFields,we),isValidating:!!Zt((De||o).validatingFields,we),error:Zt((De||o).errors,we)}),at=we=>{we&&t2(we).forEach(De=>Qo(o.errors,De)),O.state.next({errors:we?o.errors:{}})},Fe=(we,De,We)=>{const mt=(Zt(a,we,{_f:{}})._f||{}).ref;Mi(o.errors,we,{...De,ref:mt}),O.state.next({name:we,errors:o.errors,isValid:!1}),We&&We.shouldFocus&&mt&&mt.focus&&mt.focus()},et=(we,De)=>Sm(we)?O.values.subscribe({next:We=>we(de(void 0,De),We)}):de(we,De,!0),_t=(we,De={})=>{for(const We of we?t2(we):v.mount)v.mount.delete(We),v.array.delete(We),De.keepValue||(Qo(a,We),Qo(d,We)),!De.keepError&&Qo(o.errors,We),!De.keepDirty&&Qo(o.dirtyFields,We),!De.keepTouched&&Qo(o.touchedFields,We),!De.keepIsValidating&&Qo(o.validatingFields,We),!t.shouldUnregister&&!De.keepDefaultValue&&Qo(l,We);O.values.next({values:{...d}}),O.state.next({...o,...De.keepDirty?{isDirty:fe()}:{}}),!De.keepIsValid&&z()},Dt=({disabled:we,name:De,field:We,fields:mt,value:gt})=>{if(Nf(we)){const ht=we?void 0:Io(gt)?i2(We?We._f:Zt(mt,De)._f):gt;Mi(d,De,ht),ye(De,ht,!1,!1,!0)}},Ht=(we,De={})=>{let We=Zt(a,we);const mt=Nf(De.disabled);return Mi(a,we,{...We||{},_f:{...We&&We._f?We._f:{ref:{name:we}},name:we,mount:!0,...De}}),v.mount.add(we),We?Dt({field:We,disabled:De.disabled,name:we,value:De.value}):ae(we,!0,De.value),{...mt?{disabled:De.disabled}:{},...t.progressive?{required:!!De.required,min:cb(De.min),max:cb(De.max),minLength:cb(De.minLength),maxLength:cb(De.maxLength),pattern:cb(De.pattern)}:{},name:we,onChange:Ke,onBlur:Ke,ref:gt=>{if(gt){Ht(we,De),We=Zt(a,we);const ht=Io(gt.value)&&gt.querySelectorAll&&gt.querySelectorAll("input,select,textarea")[0]||gt,Mt=uBe(ht),jn=We._f.refs||[];if(Mt?jn.find(On=>On===ht):ht===We._f.ref)return;Mi(a,we,{_f:{...We._f,...Mt?{refs:[...jn.filter(r2),ht,...Array.isArray(Zt(l,we))?[{}]:[]],ref:{type:ht.type,name:we}}:{ref:ht}}}),ae(we,!1,void 0,ht)}else We=Zt(a,we,{}),We._f&&(We._f.mount=!1),(t.shouldUnregister||De.shouldUnregister)&&!(eBe(v.array,we)&&m.action)&&v.unMount.add(we)}}},Wt=()=>t.shouldFocusError&&ew(a,nt,v.mount),Fn=we=>{Nf(we)&&(O.state.next({disabled:we}),ew(a,(De,We)=>{let mt=we;const gt=Zt(a,We);gt&&Nf(gt._f.disabled)&&(mt||(mt=gt._f.disabled)),De.disabled=mt},0,!1))},xn=(we,De)=>async We=>{let mt;We&&(We.preventDefault&&We.preventDefault(),We.persist&&We.persist());let gt=Jl(d);if(O.state.next({isSubmitting:!0}),t.resolver){const{errors:ht,values:Mt}=await te();o.errors=ht,gt=Mt}else await le(a);if(Qo(o.errors,"root"),ll(o.errors)){O.state.next({errors:{}});try{await we(gt,We)}catch(ht){mt=ht}}else De&&await De({...o.errors},We),Wt(),setTimeout(Wt);if(O.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:ll(o.errors)&&!mt,submitCount:o.submitCount+1,errors:o.errors}),mt)throw mt},hn=(we,De={})=>{Zt(a,we)&&(Io(De.defaultValue)?Le(we,Jl(Zt(l,we))):(Le(we,De.defaultValue),Mi(l,we,Jl(De.defaultValue))),De.keepTouched||Qo(o.touchedFields,we),De.keepDirty||(Qo(o.dirtyFields,we),o.isDirty=De.defaultValue?fe(we,Jl(Zt(l,we))):fe()),De.keepError||(Qo(o.errors,we),R.isValid&&z()),O.state.next({...o}))},gr=(we,De={})=>{const We=we?Jl(we):l,mt=Jl(We),gt=ll(we),ht=gt?l:mt;if(De.keepDefaultValues||(l=We),!De.keepValues){if(De.keepDirtyValues)for(const Mt of v.mount)Zt(o.dirtyFields,Mt)?Mi(ht,Mt,Zt(d,Mt)):Le(Mt,Zt(ht,Mt));else{if(lj&&Io(we))for(const Mt of v.mount){const jn=Zt(a,Mt);if(jn&&jn._f){const On=Array.isArray(jn._f.refs)?jn._f.refs[0]:jn._f.ref;if(eN(On)){const nn=On.closest("form");if(nn){nn.reset();break}}}}a={}}d=r.shouldUnregister?De.keepDefaultValues?Jl(l):{}:Jl(ht),O.array.next({values:{...ht}}),O.values.next({values:{...ht}})}v={mount:De.keepDirtyValues?v.mount:new Set,unMount:new Set,array:new Set,watch:new Set,watchAll:!1,focus:""},m.mount=!R.isValid||!!De.keepIsValid||!!De.keepDirtyValues,m.watch=!!r.shouldUnregister,O.state.next({submitCount:De.keepSubmitCount?o.submitCount:0,isDirty:gt?!1:De.keepDirty?o.isDirty:!!(De.keepDefaultValues&&!x_(we,l)),isSubmitted:De.keepIsSubmitted?o.isSubmitted:!1,dirtyFields:gt?[]:De.keepDirtyValues?De.keepDefaultValues&&d?DO(l,d):o.dirtyFields:De.keepDefaultValues&&we?DO(l,we):{},touchedFields:De.keepTouched?o.touchedFields:{},errors:De.keepErrors?o.errors:{},isSubmitSuccessful:De.keepIsSubmitSuccessful?o.isSubmitSuccessful:!1,isSubmitting:!1})},Ar=(we,De)=>gr(Sm(we)?we(d):we,De);return{control:{register:Ht,unregister:_t,getFieldState:yt,handleSubmit:xn,setError:Fe,_executeSchema:te,_getWatch:de,_getDirty:fe,_updateValid:z,_removeUnmounted:ve,_updateFieldArray:J,_updateDisabledField:Dt,_getFieldArray:lt,_reset:gr,_resetDefaultValues:()=>Sm(t.defaultValues)&&t.defaultValues().then(we=>{Ar(we,t.resetOptions),O.state.next({isLoading:!1})}),_updateFormState:we=>{o={...o,...we}},_disableForm:Fn,_subjects:O,_proxyFormState:R,_setErrors:se,get _fields(){return a},get _formValues(){return d},get _state(){return m},set _state(we){m=we},get _defaultValues(){return l},get _names(){return v},set _names(we){v=we},get _formState(){return o},set _formState(we){o=we},get _options(){return t},set _options(we){t={...t,...we}}},trigger:Ee,register:Ht,handleSubmit:xn,watch:et,setValue:Le,getValues:Ye,reset:Ar,resetField:hn,clearErrors:at,unregister:_t,setError:Fe,setFocus:(we,De={})=>{const We=Zt(a,we),mt=We&&We._f;if(mt){const gt=mt.refs?mt.refs[0]:mt.ref;gt.focus&&(gt.focus(),De.shouldSelect&&gt.select())}},getFieldState:yt}}function mre(r={}){const t=Gi.useRef(),o=Gi.useRef(),[a,l]=Gi.useState({isDirty:!1,isValidating:!1,isLoading:Sm(r.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:r.errors||{},disabled:r.disabled||!1,defaultValues:Sm(r.defaultValues)?void 0:r.defaultValues});t.current||(t.current={...gBe(r),formState:a});const d=t.current.control;return d._options=r,iBe({subject:d._subjects.state,next:m=>{rBe(m,d._proxyFormState,d._updateFormState)&&l({...d._formState})}}),Gi.useEffect(()=>d._disableForm(r.disabled),[d,r.disabled]),Gi.useEffect(()=>{if(d._proxyFormState.isDirty){const m=d._getDirty();m!==a.isDirty&&d._subjects.state.next({isDirty:m})}},[d,a.isDirty]),Gi.useEffect(()=>{r.values&&!x_(r.values,o.current)?(d._reset(r.values,d._options.resetOptions),o.current=r.values,l(m=>({...m}))):d._resetDefaultValues()},[r.values,d]),Gi.useEffect(()=>{r.errors&&d._setErrors(r.errors)},[r.errors,d]),Gi.useEffect(()=>{d._state.mount||(d._updateValid(),d._state.mount=!0),d._state.watch&&(d._state.watch=!1,d._subjects.state.next({...d._formState})),d._removeUnmounted()}),Gi.useEffect(()=>{r.shouldUnregister&&d._subjects.values.next({values:d._getWatch()})},[r.shouldUnregister,d]),t.current.formState=nBe(a,d),t.current}const gre=r=>{V.useEffect(()=>{if(!window.unityInstance)return;const t=()=>{try{window.unityInstance.SendMessage("WebGLInputManager","Disable"),Ct.log("Unity input disabled")}catch(a){Ct.error("Failed to disable Unity input:",a)}},o=()=>{try{window.unityInstance.SendMessage("WebGLInputManager","Enable"),Ct.log("Unity input enabled")}catch(a){Ct.error("Failed to enable Unity input:",a)}};return r?t():o(),()=>{r&&o()}},[r])};function ik({mode:r,label:t,buttonProps:o={},isOpen:a,onClose:l}){const{register:d,handleSubmit:m,formState:{errors:v}}=mre(),{register:y}=V.useContext(wa),b=Hw(),{fullscreenRef:R}=ep(),[O,N]=V.useState(!1),[F,H]=V.useState(!1),G=a!==void 0?a:O,z=l||(()=>N(!1));gre(G);const ne=async se=>{const{email:ae,password:ye,confirmPassword:Q,...te}=se;if(ye!==Q){b({title:"Error",description:"Passwords do not match.",status:"error",duration:3e3,isClosable:!0,position:"top"});return}H(!0);try{await y(ae,ye,te),Ct.log("User: Registration process complete."),z(),b({title:"Registration Successful",description:"Your account has been created.",status:"success",duration:3e3,isClosable:!0,position:"top"})}catch(re){Ct.error("User: Registration Error:",re),b({title:"Error",description:"An error occurred during registration. Please try again.",status:"error",duration:3e3,isClosable:!0,position:"top"})}finally{H(!1)}},J=()=>{l?l():N(!O)},oe=r==="link"?D.jsx(yh,{variant:"header",onClick:J,children:t}):D.jsx(Nc,{onClick:J,...o,children:t});return D.jsxs(D.Fragment,{children:[!a&&oe,D.jsxs(Rh,{isOpen:G,onClose:z,size:"md",portalProps:{containerRef:R},isCentered:!0,motionPreset:"slideInBottom",blockScrollOnMount:!1,children:[D.jsx(Ih,{bg:"blackAlpha.800",backdropFilter:"blur(5px)"}),D.jsxs(Ch,{bg:"gray.800",borderRadius:"xl",boxShadow:"xl",color:"white",maxW:"md",mx:4,position:"relative",zIndex:9999,sx:{isolation:"isolate","& input":{position:"relative",zIndex:1e4,isolation:"isolate"},"& *":{pointerEvents:"auto !important"}},onKeyDown:se=>{se.stopPropagation()},children:[D.jsxs(Qf,{p:8,textAlign:"center",children:[D.jsx(YV,{size:"lg",mb:2,children:"Create Account"}),D.jsx(pn,{fontSize:"sm",color:"gray.400",children:"Fill in your details to get started"})]}),D.jsx(Oh,{color:"gray.400"}),D.jsx(Ah,{px:8,children:D.jsx("form",{onSubmit:m(ne),children:D.jsxs(Bo,{spacing:4,children:[D.jsxs(go,{isInvalid:v.companyName,isRequired:!0,children:[D.jsx(Gs,{placeholder:"Company Name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("companyName",{required:"Company name is required"})}),D.jsx(Pf,{children:v.companyName&&v.companyName.message})]}),D.jsxs(Ic,{gap:4,w:"100%",children:[D.jsxs(go,{isInvalid:v.firstName,isRequired:!0,children:[D.jsx(Gs,{placeholder:"First Name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("firstName",{required:"First name is required"})}),D.jsx(Pf,{children:v.firstName&&v.firstName.message})]}),D.jsxs(go,{isInvalid:v.lastName,isRequired:!0,children:[D.jsx(Gs,{placeholder:"Last Name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("lastName",{required:"Last name is required"})}),D.jsx(Pf,{children:v.lastName&&v.lastName.message})]})]}),D.jsxs(go,{isInvalid:v.email,isRequired:!0,children:[D.jsx(Gs,{type:"email",placeholder:"Work Email Address",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("email",{required:"Email is required",pattern:{value:/^[^@ \t\r\n]+@[^@ \t\r\n]+\.[^@ \t\r\n]+$/,message:"Invalid email address"}})}),D.jsx(Pf,{children:v.email&&v.email.message})]}),D.jsxs(Ic,{gap:4,w:"100%",children:[D.jsxs(go,{isInvalid:v.password,isRequired:!0,children:[D.jsx(Gs,{type:"password",placeholder:"Password",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("password",{required:"Password is required",minLength:{value:8,message:"Password must be at least 8 characters long"}})}),D.jsx(Pf,{children:v.password&&v.password.message})]}),D.jsxs(go,{isInvalid:v.confirmPassword,isRequired:!0,children:[D.jsx(Gs,{type:"password",placeholder:"Confirm Password",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("confirmPassword",{required:"Confirm password is required"})}),D.jsx(Pf,{children:v.confirmPassword&&v.confirmPassword.message})]})]}),D.jsx(go,{children:D.jsx(Gs,{placeholder:"Access Code",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("accessCode")})}),D.jsx(go,{children:D.jsx(Gs,{placeholder:"LinkedIn Profile (optional)",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("linkedInProfile")})})]})})}),D.jsxs(ON,{px:8,pb:8,flexDirection:"column",gap:4,children:[D.jsx(Nc,{type:"submit",colorScheme:"blue",size:"lg",width:"100%",onClick:m(ne),isLoading:F,loadingText:"Creating Account",children:"Create Account"}),D.jsxs(pn,{fontSize:"sm",color:"gray.400",textAlign:"center",children:["Already have an account?"," ",D.jsx(yh,{color:"blue.400",onClick:z,children:"Sign In"})]})]})]})]})]})}ik.propTypes={mode:Mr.oneOf(["button","link"]),label:Mr.string,buttonProps:Mr.object,isOpen:Mr.bool,onClose:Mr.func};function ok({mode:r,label:t,buttonProps:o={}}){const{signIn:a}=V.useContext(wa),{fullscreenRef:l}=ep(),d=Hw(),{register:m,handleSubmit:v,formState:{errors:y,isSubmitting:b}}=mre({defaultValues:{email:"neil@pursey.net",password:"123456"}}),[R,O]=V.useState(!1),[N,F]=V.useState(!1);gre(R);const H=async J=>{try{await a(J.email,J.password),Ct.log("User: Sign-in process complete."),O(!1),window.location.reload()}catch(oe){Ct.error("User: SignIn Error:",oe),d({title:"Error",description:"An error occurred while logging in. Please check your credentials.",status:"error",duration:1e4,isClosable:!0,position:"top",container:l.current})}},G=()=>O(J=>!J),z=()=>{O(!1),F(!0)},ne=r==="link"?D.jsx(yh,{variant:"header",onClick:G,children:t}):D.jsx(Nc,{onClick:G,...o,children:t});return D.jsxs(D.Fragment,{children:[ne,D.jsxs(Rh,{isOpen:R,onClose:G,size:"md",portalProps:{containerRef:l},isCentered:!0,motionPreset:"slideInBottom",blockScrollOnMount:!1,children:[D.jsx(Ih,{bg:"blackAlpha.800",backdropFilter:"blur(5px)"}),D.jsx("form",{onSubmit:v(H),children:D.jsxs(Ch,{bg:"gray.800",borderRadius:"xl",boxShadow:"xl",color:"white",maxW:"md",mx:4,position:"relative",zIndex:9999,sx:{isolation:"isolate","& input":{position:"relative",zIndex:1e4,isolation:"isolate"},"& *":{pointerEvents:"auto !important"}},onKeyDown:J=>{J.stopPropagation()},children:[D.jsxs(Qf,{p:8,textAlign:"center",children:[D.jsx(YV,{size:"lg",mb:2,children:"Welcome Back"}),D.jsx(pn,{fontSize:"sm",color:"gray.400",children:"Enter your credentials to access your account"})]}),D.jsx(Oh,{color:"gray.400"}),D.jsx(Ah,{px:8,pb:8,children:D.jsxs(Bo,{spacing:4,children:[D.jsxs(go,{isInvalid:y.email,children:[D.jsxs(J2,{children:[D.jsx(xP,{pointerEvents:"none",children:D.jsx($je,{color:"gray.500"})}),D.jsx(Gs,{type:"email",placeholder:"Email",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...m("email",{required:"Email is required."})})]}),D.jsx(Pf,{children:y.email&&y.email.message})]}),D.jsxs(go,{isInvalid:y.password,children:[D.jsxs(J2,{children:[D.jsx(xP,{pointerEvents:"none",children:D.jsx(Yje,{color:"gray.500"})}),D.jsx(Gs,{type:"password",placeholder:"Password",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...m("password",{required:"Password is required."})})]}),D.jsx(Pf,{children:y.password&&y.password.message})]})]})}),D.jsxs(ON,{px:8,pb:8,flexDirection:"column",gap:4,children:[D.jsx(Nc,{type:"submit",colorScheme:"blue",size:"lg",width:"100%",isLoading:b,loadingText:"Signing In",children:"Sign In"}),D.jsxs(pn,{fontSize:"sm",color:"gray.400",textAlign:"center",children:["Don't have an account?"," ",D.jsx(yh,{color:"blue.400",onClick:z,children:"Sign Up"})]})]})]})})]}),D.jsx(ik,{mode:"link",isOpen:N,onClose:()=>F(!1)})]})}ok.propTypes={mode:Mr.oneOf(["button","link"]),label:Mr.string,buttonProps:Mr.object};ok.defaultProps={mode:"button",label:"Sign In"};function sk({mode:r,label:t}){const o=Hw(),{signOut:a}=V.useContext(wa),{fullscreenRef:l}=ep(),d=async()=>{try{await a(),o({title:"Logged Out",description:"You have been successfully logged out.",status:"success",duration:3e3,isClosable:!0,position:"top",container:l.current}),window.location.href="/"}catch(v){console.error("SignOut Error:",v),o({title:"Error",description:"An error occurred while logging out.",status:"error",duration:3e3,isClosable:!0,position:"top",container:l.current})}},m=r==="link"?D.jsx(yh,{variant:"header",onClick:d,style:{cursor:"pointer"},children:t}):null;return D.jsx(D.Fragment,{children:m})}sk.propTypes={mode:Mr.oneOf(["button","link"]),label:Mr.string};sk.defaultProps={mode:"button",label:"Sign Out"};const _Be=()=>{const[r,t]=V.useState(!1);return V.useEffect(()=>{var o,a,l;if(r){const d=document.querySelector("#unity-canvas");d&&(d.blur(),d.style.pointerEvents="none");const m=(a=(o=window.unityInstance)==null?void 0:o.Module)==null?void 0:a.WebGLInputHandler;(l=window.unityInstance)!=null&&l.Module&&(window.unityInstance.Module.WebGLInputHandler=null);const v=y=>{y.stopImmediatePropagation(),y.stopPropagation()};return document.addEventListener("keydown",v,!0),document.addEventListener("keyup",v,!0),document.addEventListener("keypress",v,!0),document.addEventListener("keydown",v,!1),document.addEventListener("keyup",v,!1),document.addEventListener("keypress",v,!1),()=>{var y;(y=window.unityInstance)!=null&&y.Module&&m&&(window.unityInstance.Module.WebGLInputHandler=m),d&&(d.style.pointerEvents="auto"),document.removeEventListener("keydown",v,!0),document.removeEventListener("keyup",v,!0),document.removeEventListener("keypress",v,!0),document.removeEventListener("keydown",v,!1),document.removeEventListener("keyup",v,!1),document.removeEventListener("keypress",v,!1)}}},[r]),[r,t]},vBe=({isOpen:r,onClose:t,user:o,profileImageUrl:a})=>{const[l,d]=V.useState(!1),[m,v]=V.useState({Nickname:(o==null?void 0:o.Nickname)||"",companyName:(o==null?void 0:o.companyName)||"",firstName:(o==null?void 0:o.firstName)||"",lastName:(o==null?void 0:o.lastName)||"",linkedInProfile:(o==null?void 0:o.linkedInProfile)||""}),[y,b]=V.useState(!1),[R,O]=_Be(),N=Hw(),{sendUserToUnity:F}=V.useContext(wa),H=V.useRef(null);V.useEffect(()=>{v({Nickname:(o==null?void 0:o.Nickname)||"",companyName:(o==null?void 0:o.companyName)||"",firstName:(o==null?void 0:o.firstName)||"",lastName:(o==null?void 0:o.lastName)||"",linkedInProfile:(o==null?void 0:o.linkedInProfile)||""})},[o]),V.useEffect(()=>{if(l&&H.current){const se=()=>{H.current.focus(),O(!0);const Q=document.querySelector("#unity-canvas");Q&&Q.blur()};se();const ae=setTimeout(se,100),ye=setTimeout(se,300);return()=>{clearTimeout(ae),clearTimeout(ye)}}else O(!1)},[l,O]);const G=()=>{d(!1),O(!1),t()},z=se=>{const{name:ae,value:ye}=se.target;v(Q=>({...Q,[ae]:ye}))},ne=async()=>{if(m.Nickname.trim()===""){N({title:"Error",description:"Nickname cannot be empty",status:"error",duration:3e3,isClosable:!0});return}b(!0);try{const se=yS(Mm,"users",o.uid),ae=tre(se,ye=>{ye.exists()&&ye.data().Nickname===m.Nickname&&(F(),ae())});await ere(se,{...m,lastUpdated:new Date().toISOString()}),await updateUser(),v({Nickname:m.Nickname,companyName:m.companyName,firstName:m.firstName,lastName:m.lastName,linkedInProfile:m.linkedInProfile}),N({title:"Success",description:"Profile updated successfully",status:"success",duration:3e3,isClosable:!0}),d(!1)}catch(se){N({title:"Error",description:"Failed to update profile",status:"error",duration:3e3,isClosable:!0}),console.error("Error updating profile:",se)}finally{b(!1)}},J=()=>D.jsxs(Bo,{spacing:4,align:"stretch",w:"100%",children:[D.jsx(Ic,{direction:"column",align:"center",gap:2,children:D.jsx(pn,{fontSize:"2xl",fontWeight:"bold",children:o.Nickname})}),D.jsxs(Bo,{spacing:3,align:"stretch",bg:"gray.700",p:4,borderRadius:"md",children:[D.jsxs(Ic,{direction:"column",children:[D.jsx(pn,{color:"gray.400",fontSize:"sm",children:"Company"}),D.jsx(pn,{children:o.companyName||"Not specified"})]}),D.jsxs(Ic,{direction:"column",children:[D.jsx(pn,{color:"gray.400",fontSize:"sm",children:"Full Name"}),D.jsx(pn,{children:`${o.firstName||""} ${o.lastName||""}`.trim()||"Not specified"})]}),D.jsxs(Ic,{direction:"column",children:[D.jsx(pn,{color:"gray.400",fontSize:"sm",children:"LinkedIn"}),D.jsx(pn,{children:o.linkedInProfile||"Not specified"})]})]}),D.jsx(Nc,{onClick:()=>d(!0),size:"sm",variant:"outline",_hover:{bg:"gray.700"},color:"white",borderColor:"gray.600",children:"Edit Profile"})]}),oe=()=>D.jsxs(Bo,{spacing:4,align:"stretch",w:"100%",children:[D.jsxs(go,{children:[D.jsx(eu,{color:"gray.400",fontSize:"sm",children:"Nickname"}),D.jsx(Gs,{ref:H,name:"Nickname",value:m.Nickname,onChange:z,onFocus:()=>{O(!0);const se=document.querySelector("#unity-canvas");se&&se.blur()},placeholder:"Enter nickname",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"}})]}),D.jsxs(go,{children:[D.jsx(eu,{color:"gray.400",fontSize:"sm",children:"Company Name"}),D.jsx(Gs,{name:"companyName",value:m.companyName,onChange:z,placeholder:"Enter company name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"}})]}),D.jsxs(Ic,{gap:4,children:[D.jsxs(go,{children:[D.jsx(eu,{color:"gray.400",fontSize:"sm",children:"First Name"}),D.jsx(Gs,{name:"firstName",value:m.firstName,onChange:z,placeholder:"Enter first name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"}})]}),D.jsxs(go,{children:[D.jsx(eu,{color:"gray.400",fontSize:"sm",children:"Last Name"}),D.jsx(Gs,{name:"lastName",value:m.lastName,onChange:z,placeholder:"Enter last name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"}})]})]}),D.jsxs(go,{children:[D.jsx(eu,{color:"gray.400",fontSize:"sm",children:"LinkedIn Profile"}),D.jsx(Gs,{name:"linkedInProfile",value:m.linkedInProfile,onChange:z,placeholder:"Enter LinkedIn profile URL",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"}})]}),D.jsxs(Ic,{gap:2,justify:"flex-end",mt:2,children:[D.jsx(Nc,{onClick:()=>{v({Nickname:(o==null?void 0:o.Nickname)||"",companyName:(o==null?void 0:o.companyName)||"",firstName:(o==null?void 0:o.firstName)||"",lastName:(o==null?void 0:o.lastName)||"",linkedInProfile:(o==null?void 0:o.linkedInProfile)||""}),d(!1)},variant:"outline",size:"sm",isDisabled:y,color:"white",borderColor:"gray.600",_hover:{bg:"gray.700"},children:"Cancel"}),D.jsx(Nc,{onClick:ne,colorScheme:"blue",size:"sm",isLoading:y,children:"Save Changes"})]})]});return D.jsxs(Rh,{isOpen:r,onClose:G,isCentered:!0,closeOnOverlayClick:!l,trapFocus:!0,blockScrollOnMount:!1,size:"md",children:[D.jsx(Ih,{backdropFilter:"blur(10px)"}),D.jsxs(Ch,{bg:"gray.800",color:"white",children:[D.jsx(Qf,{children:"Profile"}),D.jsx(Oh,{}),D.jsx(Ah,{pb:6,children:D.jsxs(Bo,{spacing:6,children:[D.jsx(Eh,{src:a,size:"2xl",borderRadius:"full"}),l?oe():J()]})})]})]})},LO={bg:"white",color:"black",borderRadius:"full",px:"6",py:"2",height:"auto",fontSize:"md",fontWeight:"medium",_hover:{bg:"gray.100"},display:"flex",alignItems:"center",gap:2},_re=()=>{const{user:r,updateUser:t}=V.useContext(wa),[o,a]=V.useState(!0),{isOpen:l,onOpen:d,onClose:m}=zZ();V.useEffect(()=>{const b=setTimeout(()=>{a(!1)},500);return()=>clearTimeout(b)},[]);const v=()=>{m(),t()},y=r!=null&&r.rpmURL?r.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null;return o?null:D.jsx(Ic,{align:"center",gap:"4",children:r?D.jsxs(D.Fragment,{children:[D.jsx(vBe,{isOpen:l,onClose:v,user:r,profileImageUrl:y}),D.jsxs(sF,{children:[D.jsx(cF,{as:Xt,cursor:"pointer",children:D.jsx(Ic,{align:"center",height:"40px",px:4,borderRadius:"full",border:"1px solid rgba(255, 255, 255, 0.3)",transition:"all 0.2s",sx:{"&:hover":{border:"2px solid white"}},children:D.jsxs(Ic,{align:"center",gap:"3",children:[D.jsx(Xt,{width:"28px",height:"28px",borderRadius:"full",overflow:"hidden",bg:"white",display:"flex",alignItems:"center",justifyContent:"center",children:D.jsx(Eh,{src:y,width:"100%",height:"100%",borderRadius:"full"})}),D.jsx(pn,{color:"white",fontWeight:"medium",children:r.Nickname}),D.jsx(Xt,{display:"flex",alignItems:"center",height:"28px",children:D.jsx(Jje,{color:"white",w:4,h:4})})]})})}),D.jsx(au,{children:D.jsxs(aF,{bg:"gray.800",borderColor:"gray.700",zIndex:9999,children:[D.jsxs(Xt,{p:4,display:"flex",alignItems:"center",gap:3,children:[D.jsx(Eh,{src:y,size:"md",borderRadius:"full"}),D.jsx(pn,{fontSize:"xl",fontWeight:"bold",color:"white",children:r.Nickname})]}),D.jsx(Ew,{borderColor:"gray.700"}),D.jsx(Ab,{_hover:{bg:"gray.700"},color:"white",bg:"gray.800",children:"My Spaces"}),D.jsx(Ab,{onClick:d,_hover:{bg:"gray.700"},color:"white",bg:"gray.800",children:"View Profile"}),D.jsx(Ew,{borderColor:"gray.700"}),D.jsx(Ab,{_hover:{bg:"gray.700"},color:"white",bg:"gray.800",children:"Support"}),D.jsx(Ab,{_hover:{bg:"gray.700"},color:"white",bg:"gray.800",children:D.jsx(sk,{mode:"link",label:"Log out",linkProps:{color:"white",_hover:{textDecoration:"none"}}})})]})})]})]}):D.jsxs(D.Fragment,{children:[D.jsx(ik,{mode:"button",label:"Register",buttonProps:{...LO,width:["100%","auto"]},customButton:D.jsxs(Nc,{...LO,children:[D.jsx(Xt,{as:"span",fontSize:"xl",children:""}),"Register"]})}),D.jsx(ok,{mode:"button",label:"Sign In",buttonProps:{...LO,width:["100%","auto"]},customButton:D.jsxs(Nc,{...LO,children:[D.jsx(Xt,{as:"span",fontSize:"xl",children:""}),"Sign In"]})})]})})},o2=document.getElementById("header-auth-root");if(o2){const r=o2.getAttribute("data-theme")||"default",t=()=>{const[o,a]=V.useState(null);return V.useEffect(()=>{Tw(r).then(a)},[]),o?D.jsx(wN,{theme:o,children:D.jsx(rk,{children:D.jsx(cj,{children:D.jsx(_re,{})})})}):D.jsx("div",{children:"Loading theme..."})};oN.createRoot(o2).render(D.jsx(t,{}))}else console.error("Root element 'header-auth-root' not found.");var s2={},lb={},ub={},JY;function EBe(){if(JY)return ub;JY=1,Object.defineProperty(ub,"__esModule",{value:!0}),ub.useUnityCanvasId=void 0;var r=iu(),t=0,o="react-unity-webgl-canvas",a=function(l){if(l.id!==void 0)return l.id;var d=(0,r.useMemo)(function(){return[o,++t].join("-")},[]);return d};return ub.useUnityCanvasId=a,ub}var Af={},db={},QY;function vre(){if(QY)return db;QY=1,Object.defineProperty(db,"__esModule",{value:!0}),db.UnityLoaderStatus=void 0;var r;return function(t){t.Idle="Idle",t.Loading="Loading",t.Loaded="Loaded",t.Error="Error"}(r||(db.UnityLoaderStatus=r={})),db}var hb={},ZY;function fj(){return ZY||(ZY=1,Object.defineProperty(hb,"__esModule",{value:!0}),hb.isBrowserEnvironment=void 0,hb.isBrowserEnvironment=typeof window<"u"&&typeof document<"u"),hb}var eX;function yBe(){if(eX)return Af;eX=1;var r=Af&&Af.__awaiter||function(m,v,y,b){function R(O){return O instanceof y?O:new y(function(N){N(O)})}return new(y||(y=Promise))(function(O,N){function F(z){try{G(b.next(z))}catch(ne){N(ne)}}function H(z){try{G(b.throw(z))}catch(ne){N(ne)}}function G(z){z.done?O(z.value):R(z.value).then(F,H)}G((b=b.apply(m,v||[])).next())})},t=Af&&Af.__generator||function(m,v){var y={label:0,sent:function(){if(O[0]&1)throw O[1];return O[1]},trys:[],ops:[]},b,R,O,N=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return N.next=F(0),N.throw=F(1),N.return=F(2),typeof Symbol=="function"&&(N[Symbol.iterator]=function(){return this}),N;function F(G){return function(z){return H([G,z])}}function H(G){if(b)throw new TypeError("Generator is already executing.");for(;N&&(N=0,G[0]&&(y=0)),y;)try{if(b=1,R&&(O=G[0]&2?R.return:G[0]?R.throw||((O=R.return)&&O.call(R),0):R.next)&&!(O=O.call(R,G[1])).done)return O;switch(R=0,O&&(G=[G[0]&2,O.value]),G[0]){case 0:case 1:O=G;break;case 4:return y.label++,{value:G[1],done:!1};case 5:y.label++,R=G[1],G=[0];continue;case 7:G=y.ops.pop(),y.trys.pop();continue;default:if(O=y.trys,!(O=O.length>0&&O[O.length-1])&&(G[0]===6||G[0]===2)){y=0;continue}if(G[0]===3&&(!O||G[1]>O[0]&&G[1]<O[3])){y.label=G[1];break}if(G[0]===6&&y.label<O[1]){y.label=O[1],O=G;break}if(O&&y.label<O[2]){y.label=O[2],y.ops.push(G);break}O[2]&&y.ops.pop(),y.trys.pop();continue}G=v.call(m,y)}catch(z){G=[6,z],R=0}finally{b=O=0}if(G[0]&5)throw G[1];return{value:G[0]?G[1]:void 0,done:!0}}};Object.defineProperty(Af,"__esModule",{value:!0}),Af.useUnityInstance=void 0;var o=iu(),a=vre(),l=fj(),d=function(m,v,y,b){(0,o.useEffect)(function(){(function(){return r(void 0,void 0,void 0,function(){var R,O;return t(this,function(N){switch(N.label){case 0:if(l.isBrowserEnvironment===!1)return[2];if(m!==a.UnityLoaderStatus.Loaded||v===null)return b.setUnityInstance(null),b.setInitialisationError(null),[2];N.label=1;case 1:return N.trys.push([1,3,,4]),[4,window.createUnityInstance(v,y,b.setLoadingProgression)];case 2:return R=N.sent(),b.setUnityInstance(R),b.setInitialisationError(null),[3,4];case 3:return O=N.sent(),b.setUnityInstance(null),b.setInitialisationError(O),[3,4];case 4:return[2]}})})})()},[m,v,y,b])};return Af.useUnityInstance=d,Af}var fb={},tX;function SBe(){if(tX)return fb;tX=1,Object.defineProperty(fb,"__esModule",{value:!0}),fb.useUnityArguments=void 0;var r=iu(),t=function(o){return(0,r.useMemo)(function(){return{dataUrl:o.unityProvider.unityConfig.dataUrl,frameworkUrl:o.unityProvider.unityConfig.frameworkUrl,codeUrl:o.unityProvider.unityConfig.codeUrl,streamingAssetsUrl:o.unityProvider.unityConfig.streamingAssetsUrl,memoryUrl:o.unityProvider.unityConfig.memoryUrl,symbolsUrl:o.unityProvider.unityConfig.symbolsUrl,companyName:o.unityProvider.unityConfig.companyName,productName:o.unityProvider.unityConfig.productName,productVersion:o.unityProvider.unityConfig.productVersion,webglContextAttributes:o.unityProvider.unityConfig.webglContextAttributes||{},cacheControl:o.unityProvider.unityConfig.cacheControl||function(){return"must-revalidate"},devicePixelRatio:o.devicePixelRatio||1,autoSyncPersistentDataPath:o.autoSyncPersistentDataPath,matchWebGLToCanvasSize:typeof o.matchWebGLToCanvasSize=="boolean"?o.matchWebGLToCanvasSize:!0,disabledCanvasEvents:o.disabledCanvasEvents||["contextmenu","dragstart"],print:function(a){},printErr:function(a){}}},[])};return fb.useUnityArguments=t,fb}var pb={},nX;function TBe(){if(nX)return pb;nX=1,Object.defineProperty(pb,"__esModule",{value:!0}),pb.useUnityLoader=void 0;var r=iu(),t=fj(),o=vre(),a=function(l){var d=(0,r.useState)(o.UnityLoaderStatus.Loading),m=d[0],v=d[1];return(0,r.useEffect)(function(){if(t.isBrowserEnvironment!==!1){if(l.loaderUrl===null){v(o.UnityLoaderStatus.Idle);return}var y=window.document.querySelector('script[src="'.concat(l.loaderUrl,'"]'));y===null?(y=window.document.createElement("script"),y.type="text/javascript",y.src=l.loaderUrl,y.async=!0,y.setAttribute("data-status","loading"),window.document.body.appendChild(y),y.addEventListener("load",function(){return y==null?void 0:y.setAttribute("data-status","loaded")}),y.addEventListener("error",function(){return y==null?void 0:y.setAttribute("data-status","error")})):v(y.getAttribute("data-status")==="loaded"?o.UnityLoaderStatus.Loaded:o.UnityLoaderStatus.Error);var b=function(R){return v(R.type==="load"?o.UnityLoaderStatus.Loaded:o.UnityLoaderStatus.Error)};return y.addEventListener("load",b),y.addEventListener("error",b),function(){y!==null&&(y.removeEventListener("load",b),y.removeEventListener("error",b),window.document.body.removeChild(y))}}},[l.loaderUrl]),m};return pb.useUnityLoader=a,pb}var rX;function bBe(){if(rX)return lb;rX=1,Object.defineProperty(lb,"__esModule",{value:!0}),lb.Unity=void 0;var r=iu(),t=iu(),o=EBe(),a=yBe(),l=SBe(),d=TBe(),m=(0,t.forwardRef)(function(v,y){var b=(0,t.useRef)(null),R=(0,o.useUnityCanvasId)(v),O=(0,l.useUnityArguments)(v),N=(0,d.useUnityLoader)(v.unityProvider.unityConfig);return(0,a.useUnityInstance)(N,b.current,O,v.unityProvider),(0,r.useImperativeHandle)(y,function(){return b.current}),(0,r.createElement)("canvas",{ref:b,id:R,style:v.style,className:v.className,tabIndex:v.tabIndex})});return lb.Unity=m,lb}var Of={},mb={},iX;function Ere(){if(iX)return mb;iX=1,Object.defineProperty(mb,"__esModule",{value:!0}),mb.errorMessages=void 0;var r={genericNoUnityInstance:"No Unity Instance found.",requestFullscreenNoUnityInstance:"Unable to Set Fullscreen while Unity is not Instantiated.",requestPointerLockNoUnityInstanceOrCanvas:"Unable to Request Pointer Lock while Unity is not Instantiated or the Canvas is not found.",sendMessageNoUnityInstance:"Unable to Send Message while Unity is not Instantiated.",quitNoUnityInstance:"Unable to Quit Unity while Unity is not Instantiated.",screenshotNoUnityInstanceOrCanvas:"Unable to Take Screenshot while Unity is not Instantiated or Canvas is not available.",noEventListener:"Unable to find Event Listener in Event System for Event"};return mb.errorMessages=r,mb}var T_={},oX;function wBe(){if(oX)return T_;oX=1;var r=T_&&T_.__spreadArray||function(v,y,b){if(b||arguments.length===2)for(var R=0,O=y.length,N;R<O;R++)(N||!(R in y))&&(N||(N=Array.prototype.slice.call(y,0,R)),N[R]=y[R]);return v.concat(N||Array.prototype.slice.call(y))};Object.defineProperty(T_,"__esModule",{value:!0}),T_.useEventSystem=void 0;var t=iu(),o=Ere(),a=fj(),l=[],d=function(v){for(var y=[],b=1;b<arguments.length;b++)y[b-1]=arguments[b];var R=void 0;return l.forEach(function(O){R=O.apply(void 0,r([v],y,!1))}),R};a.isBrowserEnvironment===!0&&(window.dispatchReactUnityEvent=d);var m=function(){var v=(0,t.useRef)([]),y=(0,t.useCallback)(function(O,N){v.current=r(r([],v.current,!0),[{eventName:O,callback:N}],!1)},[v]),b=(0,t.useCallback)(function(O,N){v.current=v.current.filter(function(F){return F.eventName!==O&&F.callback!==N})},[v]),R=(0,t.useCallback)(function(O){for(var N=[],F=1;F<arguments.length;F++)N[F-1]=arguments[F];var H=v.current.find(function(G){return G.eventName===O});if(typeof H>"u"){console.warn(o.errorMessages.noEventListener,{eventName:O});return}return H.callback.apply(H,N)},[v]);return(0,t.useEffect)(function(){return l.push(R),function(){l.splice(l.indexOf(R),1)}},[R]),{addEventListener:y,removeEventListener:b}};return T_.useEventSystem=m,T_}var gb={},sX;function RBe(){if(sX)return gb;sX=1,Object.defineProperty(gb,"__esModule",{value:!0}),gb.useNullableState=void 0;var r=iu(),t=function(o){return(0,r.useState)(o||null)};return gb.useNullableState=t,gb}var aX;function CBe(){if(aX)return Of;aX=1;var r=Of&&Of.__awaiter||function(v,y,b,R){function O(N){return N instanceof b?N:new b(function(F){F(N)})}return new(b||(b=Promise))(function(N,F){function H(ne){try{z(R.next(ne))}catch(J){F(J)}}function G(ne){try{z(R.throw(ne))}catch(J){F(J)}}function z(ne){ne.done?N(ne.value):O(ne.value).then(H,G)}z((R=R.apply(v,y||[])).next())})},t=Of&&Of.__generator||function(v,y){var b={label:0,sent:function(){if(N[0]&1)throw N[1];return N[1]},trys:[],ops:[]},R,O,N,F=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return F.next=H(0),F.throw=H(1),F.return=H(2),typeof Symbol=="function"&&(F[Symbol.iterator]=function(){return this}),F;function H(z){return function(ne){return G([z,ne])}}function G(z){if(R)throw new TypeError("Generator is already executing.");for(;F&&(F=0,z[0]&&(b=0)),b;)try{if(R=1,O&&(N=z[0]&2?O.return:z[0]?O.throw||((N=O.return)&&N.call(O),0):O.next)&&!(N=N.call(O,z[1])).done)return N;switch(O=0,N&&(z=[z[0]&2,N.value]),z[0]){case 0:case 1:N=z;break;case 4:return b.label++,{value:z[1],done:!1};case 5:b.label++,O=z[1],z=[0];continue;case 7:z=b.ops.pop(),b.trys.pop();continue;default:if(N=b.trys,!(N=N.length>0&&N[N.length-1])&&(z[0]===6||z[0]===2)){b=0;continue}if(z[0]===3&&(!N||z[1]>N[0]&&z[1]<N[3])){b.label=z[1];break}if(z[0]===6&&b.label<N[1]){b.label=N[1],N=z;break}if(N&&b.label<N[2]){b.label=N[2],b.ops.push(z);break}N[2]&&b.ops.pop(),b.trys.pop();continue}z=y.call(v,b)}catch(ne){z=[6,ne],O=0}finally{R=N=0}if(z[0]&5)throw z[1];return{value:z[0]?z[1]:void 0,done:!0}}};Object.defineProperty(Of,"__esModule",{value:!0}),Of.useUnityContext=void 0;var o=iu(),a=Ere(),l=wBe(),d=RBe(),m=function(v){var y=(0,d.useNullableState)(),b=y[0],R=y[1],O=(0,o.useState)(0),N=O[0],F=O[1],H=(0,o.useState)(!1),G=H[0],z=H[1],ne=(0,d.useNullableState)(),J=ne[0],oe=ne[1],se=(0,l.useEventSystem)(),ae=(0,o.useRef)({setLoadingProgression:F,setInitialisationError:oe,setUnityInstance:R,setIsLoaded:z,unityConfig:v}),ye=(0,o.useCallback)(function(fe){if(b===null){console.warn(a.errorMessages.requestFullscreenNoUnityInstance);return}b.SetFullscreen(fe===!0?1:0)},[b]),Q=(0,o.useCallback)(function(){if(b===null||typeof b.Module.canvas>"u"){console.warn(a.errorMessages.requestPointerLockNoUnityInstanceOrCanvas);return}return b.Module.canvas.requestPointerLock()},[b]),te=(0,o.useCallback)(function(fe,de,lt){if(b===null){console.warn(a.errorMessages.sendMessageNoUnityInstance);return}b.SendMessage(fe,de,lt)},[b]),re=(0,o.useCallback)(function(fe,de){if(b===null||typeof b.Module.canvas>"u"){console.warn(a.errorMessages.screenshotNoUnityInstanceOrCanvas);return}return b.Module.canvas.toDataURL(fe,de)},[b]),le=(0,o.useCallback)(function(){return b===null?(console.warn(a.errorMessages.quitNoUnityInstance),Promise.reject()):b.Quit()},[b]),ve=(0,o.useCallback)(function(){return r(void 0,void 0,void 0,function(){var fe;return t(this,function(de){switch(de.label){case 0:return b===null||typeof b.Module.canvas>"u"?(console.warn(a.errorMessages.genericNoUnityInstance),[2,Promise.reject()]):(fe=b.Module.canvas,document.body.appendChild(fe),fe.style.display="none",[4,le()]);case 1:return de.sent(),fe.remove(),[2]}})})},[b]);return(0,o.useEffect)(function(){z(N===1)},[N]),{unityProvider:ae.current,loadingProgression:N,initialisationError:J,isLoaded:G,UNSAFE__unityInstance:b,requestFullscreen:ye,requestPointerLock:Q,sendMessage:te,takeScreenshot:re,unload:le,UNSAFE__detachAndUnloadImmediate:ve,addEventListener:se.addEventListener,removeEventListener:se.removeEventListener}};return Of.useUnityContext=m,Of}var cX;function IBe(){return cX||(cX=1,function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.useUnityContext=r.Unity=void 0;var t=bBe();Object.defineProperty(r,"Unity",{enumerable:!0,get:function(){return t.Unity}});var o=CBe();Object.defineProperty(r,"useUnityContext",{enumerable:!0,get:function(){return o.useUnityContext}})}(s2)),s2}var yre=IBe();const Zu="[UnityProvider]",Sre=V.createContext(),ABe=({spaceID:r,children:t,loaderUrl:o,dataUrl:a,frameworkUrl:l,codeUrl:d,loadingBackground:m,showLoginButton:v,showDisruptiveLogo:y})=>{Ct.log(`${Zu} Initializing with spaceID:`,r),Ct.log(`${Zu} Unity URLs:`,{loaderUrl:o,dataUrl:a,frameworkUrl:l,codeUrl:d});const{unityProvider:b,loadingProgression:R,isLoaded:O,sendMessage:N,addEventListener:F,removeEventListener:H,error:G}=yre.useUnityContext({loaderUrl:o,dataUrl:a,frameworkUrl:l,codeUrl:d}),z=V.useRef(null),ne=V.useRef(Date.now());V.useEffect(()=>{const ae=()=>{document.hidden?(Ct.log(`${Zu} Page hidden, starting keep-alive`),J()):(Ct.log(`${Zu} Page visible, stopping keep-alive`),oe())};return document.addEventListener("visibilitychange",ae),()=>{document.removeEventListener("visibilitychange",ae),oe()}},[]),V.useEffect(()=>{const ae=()=>{ne.current=Date.now(),document.hidden&&N("WebGLInputManager","KeepAlive")};return window.addEventListener("mousemove",ae),window.addEventListener("keydown",ae),window.addEventListener("touchstart",ae),()=>{window.removeEventListener("mousemove",ae),window.removeEventListener("keydown",ae),window.removeEventListener("touchstart",ae)}},[N]);const J=()=>{z.current||(z.current=setInterval(()=>{O&&document.hidden&&(N("WebGLInputManager","KeepAlive"),Ct.debug(`${Zu} Sent keep-alive message`))},1e4))},oe=()=>{z.current&&(clearInterval(z.current),z.current=null)};V.useEffect(()=>(Ct.log(`${Zu} Component mounted`),()=>{Ct.log(`${Zu} Component unmounting`),oe()}),[]),V.useEffect(()=>{Ct.log(`${Zu} Loading progress:`,R)},[R]),V.useEffect(()=>{O&&(Ct.log(`${Zu} Unity instance loaded for:`,r),document.hidden&&J())},[O,r]),V.useEffect(()=>{G&&Ct.error(`${Zu} Unity error:`,G)},[G]);const se={spaceID:r,unityProvider:b,loadingProgression:R,isLoaded:O,sendMessage:N,addEventListener:F,removeEventListener:H};return Ct.log(`${Zu} Rendering provider with instance:`,se),D.jsx(Sre.Provider,{value:se,children:t})},LS=()=>V.useContext(Sre);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tre="firebasestorage.googleapis.com",bre="storageBucket",OBe=2*60*1e3,PBe=10*60*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gs extends Ph{constructor(t,o,a=0){super(a2(t),`Firebase Storage: ${o} (${a2(t)})`),this.status_=a,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,gs.prototype)}get status(){return this.status_}set status(t){this.status_=t}_codeEquals(t){return a2(t)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(t){this.customData.serverResponse=t,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var ms;(function(r){r.UNKNOWN="unknown",r.OBJECT_NOT_FOUND="object-not-found",r.BUCKET_NOT_FOUND="bucket-not-found",r.PROJECT_NOT_FOUND="project-not-found",r.QUOTA_EXCEEDED="quota-exceeded",r.UNAUTHENTICATED="unauthenticated",r.UNAUTHORIZED="unauthorized",r.UNAUTHORIZED_APP="unauthorized-app",r.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",r.INVALID_CHECKSUM="invalid-checksum",r.CANCELED="canceled",r.INVALID_EVENT_NAME="invalid-event-name",r.INVALID_URL="invalid-url",r.INVALID_DEFAULT_BUCKET="invalid-default-bucket",r.NO_DEFAULT_BUCKET="no-default-bucket",r.CANNOT_SLICE_BLOB="cannot-slice-blob",r.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",r.NO_DOWNLOAD_URL="no-download-url",r.INVALID_ARGUMENT="invalid-argument",r.INVALID_ARGUMENT_COUNT="invalid-argument-count",r.APP_DELETED="app-deleted",r.INVALID_ROOT_OPERATION="invalid-root-operation",r.INVALID_FORMAT="invalid-format",r.INTERNAL_ERROR="internal-error",r.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(ms||(ms={}));function a2(r){return"storage/"+r}function wre(){const r="An unknown error occurred, please check the error payload for server response.";return new gs(ms.UNKNOWN,r)}function NBe(r){return new gs(ms.OBJECT_NOT_FOUND,"Object '"+r+"' does not exist.")}function kBe(r){return new gs(ms.QUOTA_EXCEEDED,"Quota for bucket '"+r+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function DBe(){const r="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new gs(ms.UNAUTHENTICATED,r)}function LBe(){return new gs(ms.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function xBe(r){return new gs(ms.UNAUTHORIZED,"User does not have permission to access '"+r+"'.")}function MBe(){return new gs(ms.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function UBe(){return new gs(ms.CANCELED,"User canceled the upload/download.")}function VBe(r){return new gs(ms.INVALID_URL,"Invalid URL '"+r+"'.")}function FBe(r){return new gs(ms.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+r+"'.")}function jBe(){return new gs(ms.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+bre+"' property when initializing the app?")}function BBe(){return new gs(ms.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function MU(r){return new gs(ms.INVALID_ARGUMENT,r)}function Rre(){return new gs(ms.APP_DELETED,"The Firebase app was deleted.")}function WBe(r){return new gs(ms.INVALID_ROOT_OPERATION,"The operation '"+r+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function _b(r){throw new gs(ms.INTERNAL_ERROR,"Internal error: "+r)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hl{constructor(t,o){this.bucket=t,this.path_=o}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const t=encodeURIComponent;return"/b/"+t(this.bucket)+"/o/"+t(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(t,o){let a;try{a=hl.makeFromUrl(t,o)}catch{return new hl(t,"")}if(a.path==="")return a;throw FBe(t)}static makeFromUrl(t,o){let a=null;const l="([A-Za-z0-9.\\-_]+)";function d(se){se.path.charAt(se.path.length-1)==="/"&&(se.path_=se.path_.slice(0,-1))}const m="(/(.*))?$",v=new RegExp("^gs://"+l+m,"i"),y={bucket:1,path:3};function b(se){se.path_=decodeURIComponent(se.path)}const R="v[A-Za-z0-9_]+",O=o.replace(/[.]/g,"\\."),N="(/([^?#]*).*)?$",F=new RegExp(`^https?://${O}/${R}/b/${l}/o${N}`,"i"),H={bucket:1,path:3},G=o===Tre?"(?:storage.googleapis.com|storage.cloud.google.com)":o,z="([^?#]*)",ne=new RegExp(`^https?://${G}/${l}/${z}`,"i"),oe=[{regex:v,indices:y,postModify:d},{regex:F,indices:H,postModify:b},{regex:ne,indices:{bucket:1,path:2},postModify:b}];for(let se=0;se<oe.length;se++){const ae=oe[se],ye=ae.regex.exec(t);if(ye){const Q=ye[ae.indices.bucket];let te=ye[ae.indices.path];te||(te=""),a=new hl(Q,te),ae.postModify(a);break}}if(a==null)throw VBe(t);return a}}class GBe{constructor(t){this.promise_=Promise.reject(t)}getPromise(){return this.promise_}cancel(t=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zBe(r,t,o){let a=1,l=null,d=null,m=!1,v=0;function y(){return v===2}let b=!1;function R(...z){b||(b=!0,t.apply(null,z))}function O(z){l=setTimeout(()=>{l=null,r(F,y())},z)}function N(){d&&clearTimeout(d)}function F(z,...ne){if(b){N();return}if(z){N(),R.call(null,z,...ne);return}if(y()||m){N(),R.call(null,z,...ne);return}a<64&&(a*=2);let oe;v===1?(v=2,oe=0):oe=(a+Math.random())*1e3,O(oe)}let H=!1;function G(z){H||(H=!0,N(),!b&&(l!==null?(z||(v=2),clearTimeout(l),O(0)):z||(v=1)))}return O(0),d=setTimeout(()=>{m=!0,G(!0)},o),G}function HBe(r){r(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function KBe(r){return r!==void 0}function $Be(r){return typeof r=="object"&&!Array.isArray(r)}function Cre(r){return typeof r=="string"||r instanceof String}function lX(r,t,o,a){if(a<t)throw MU(`Invalid value for '${r}'. Expected ${t} or greater.`);if(a>o)throw MU(`Invalid value for '${r}'. Expected ${o} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ire(r,t,o){let a=t;return o==null&&(a=`https://${t}`),`${o}://${a}/v0${r}`}function Are(r){const t=encodeURIComponent;let o="?";for(const a in r)if(r.hasOwnProperty(a)){const l=t(a)+"="+t(r[a]);o=o+l+"&"}return o=o.slice(0,-1),o}var H_;(function(r){r[r.NO_ERROR=0]="NO_ERROR",r[r.NETWORK_ERROR=1]="NETWORK_ERROR",r[r.ABORT=2]="ABORT"})(H_||(H_={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qBe(r,t){const o=r>=500&&r<600,l=[408,429].indexOf(r)!==-1,d=t.indexOf(r)!==-1;return o||l||d}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YBe{constructor(t,o,a,l,d,m,v,y,b,R,O,N=!0){this.url_=t,this.method_=o,this.headers_=a,this.body_=l,this.successCodes_=d,this.additionalRetryCodes_=m,this.callback_=v,this.errorCallback_=y,this.timeout_=b,this.progressCallback_=R,this.connectionFactory_=O,this.retry=N,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((F,H)=>{this.resolve_=F,this.reject_=H,this.start_()})}start_(){const t=(a,l)=>{if(l){a(!1,new xO(!1,null,!0));return}const d=this.connectionFactory_();this.pendingConnection_=d;const m=v=>{const y=v.loaded,b=v.lengthComputable?v.total:-1;this.progressCallback_!==null&&this.progressCallback_(y,b)};this.progressCallback_!==null&&d.addUploadProgressListener(m),d.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&d.removeUploadProgressListener(m),this.pendingConnection_=null;const v=d.getErrorCode()===H_.NO_ERROR,y=d.getStatus();if(!v||qBe(y,this.additionalRetryCodes_)&&this.retry){const R=d.getErrorCode()===H_.ABORT;a(!1,new xO(!1,null,R));return}const b=this.successCodes_.indexOf(y)!==-1;a(!0,new xO(b,d))})},o=(a,l)=>{const d=this.resolve_,m=this.reject_,v=l.connection;if(l.wasSuccessCode)try{const y=this.callback_(v,v.getResponse());KBe(y)?d(y):d()}catch(y){m(y)}else if(v!==null){const y=wre();y.serverResponse=v.getErrorText(),this.errorCallback_?m(this.errorCallback_(v,y)):m(y)}else if(l.canceled){const y=this.appDelete_?Rre():UBe();m(y)}else{const y=MBe();m(y)}};this.canceled_?o(!1,new xO(!1,null,!0)):this.backoffId_=zBe(t,o,this.timeout_)}getPromise(){return this.promise_}cancel(t){this.canceled_=!0,this.appDelete_=t||!1,this.backoffId_!==null&&HBe(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class xO{constructor(t,o,a){this.wasSuccessCode=t,this.connection=o,this.canceled=!!a}}function XBe(r,t){t!==null&&t.length>0&&(r.Authorization="Firebase "+t)}function JBe(r,t){r["X-Firebase-Storage-Version"]="webjs/"+(t??"AppManager")}function QBe(r,t){t&&(r["X-Firebase-GMPID"]=t)}function ZBe(r,t){t!==null&&(r["X-Firebase-AppCheck"]=t)}function e4e(r,t,o,a,l,d,m=!0){const v=Are(r.urlParams),y=r.url+v,b=Object.assign({},r.headers);return QBe(b,t),XBe(b,o),JBe(b,d),ZBe(b,a),new YBe(y,r.method,b,r.body,r.successCodes,r.additionalRetryCodes,r.handler,r.errorHandler,r.timeout,r.progressCallback,l,m)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ore(r){let t;try{t=JSON.parse(r)}catch{return null}return $Be(t)?t:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function t4e(r){if(r.length===0)return null;const t=r.lastIndexOf("/");return t===-1?"":r.slice(0,t)}function n4e(r,t){const o=t.split("/").filter(a=>a.length>0).join("/");return r.length===0?o:r+"/"+o}function Pre(r){const t=r.lastIndexOf("/",r.length-2);return t===-1?r:r.slice(t+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function r4e(r,t){return t}class Ga{constructor(t,o,a,l){this.server=t,this.local=o||t,this.writable=!!a,this.xform=l||r4e}}let MO=null;function i4e(r){return!Cre(r)||r.length<2?r:Pre(r)}function o4e(){if(MO)return MO;const r=[];r.push(new Ga("bucket")),r.push(new Ga("generation")),r.push(new Ga("metageneration")),r.push(new Ga("name","fullPath",!0));function t(d,m){return i4e(m)}const o=new Ga("name");o.xform=t,r.push(o);function a(d,m){return m!==void 0?Number(m):m}const l=new Ga("size");return l.xform=a,r.push(l),r.push(new Ga("timeCreated")),r.push(new Ga("updated")),r.push(new Ga("md5Hash",null,!0)),r.push(new Ga("cacheControl",null,!0)),r.push(new Ga("contentDisposition",null,!0)),r.push(new Ga("contentEncoding",null,!0)),r.push(new Ga("contentLanguage",null,!0)),r.push(new Ga("contentType",null,!0)),r.push(new Ga("metadata","customMetadata",!0)),MO=r,MO}function s4e(r,t){function o(){const a=r.bucket,l=r.fullPath,d=new hl(a,l);return t._makeStorageReference(d)}Object.defineProperty(r,"ref",{get:o})}function a4e(r,t,o){const a={};a.type="file";const l=o.length;for(let d=0;d<l;d++){const m=o[d];a[m.local]=m.xform(a,t[m.server])}return s4e(a,r),a}function c4e(r,t,o){const a=Ore(t);return a===null?null:a4e(r,a,o)}function l4e(r,t,o,a){const l=Ore(t);if(l===null||!Cre(l.downloadTokens))return null;const d=l.downloadTokens;if(d.length===0)return null;const m=encodeURIComponent;return d.split(",").map(b=>{const R=r.bucket,O=r.fullPath,N="/b/"+m(R)+"/o/"+m(O),F=Ire(N,o,a),H=Are({alt:"media",token:b});return F+H})[0]}class u4e{constructor(t,o,a,l){this.url=t,this.method=o,this.handler=a,this.timeout=l,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function d4e(r){if(!r)throw wre()}function h4e(r,t){function o(a,l){const d=c4e(r,l,t);return d4e(d!==null),l4e(d,l,r.host,r._protocol)}return o}function f4e(r){function t(o,a){let l;return o.getStatus()===401?o.getErrorText().includes("Firebase App Check token is invalid")?l=LBe():l=DBe():o.getStatus()===402?l=kBe(r.bucket):o.getStatus()===403?l=xBe(r.path):l=a,l.status=o.getStatus(),l.serverResponse=a.serverResponse,l}return t}function p4e(r){const t=f4e(r);function o(a,l){let d=t(a,l);return a.getStatus()===404&&(d=NBe(r.path)),d.serverResponse=l.serverResponse,d}return o}function m4e(r,t,o){const a=t.fullServerUrl(),l=Ire(a,r.host,r._protocol),d="GET",m=r.maxOperationRetryTime,v=new u4e(l,d,h4e(r,o),m);return v.errorHandler=p4e(t),v}class g4e{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=H_.NO_ERROR,this.sendPromise_=new Promise(t=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=H_.ABORT,t()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=H_.NETWORK_ERROR,t()}),this.xhr_.addEventListener("load",()=>{t()})})}send(t,o,a,l){if(this.sent_)throw _b("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(o,t,!0),l!==void 0)for(const d in l)l.hasOwnProperty(d)&&this.xhr_.setRequestHeader(d,l[d].toString());return a!==void 0?this.xhr_.send(a):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw _b("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw _b("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw _b("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw _b("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(t){return this.xhr_.getResponseHeader(t)}addUploadProgressListener(t){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",t)}removeUploadProgressListener(t){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",t)}}class _4e extends g4e{initXhr(){this.xhr_.responseType="text"}}function v4e(){return new _4e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iv{constructor(t,o){this._service=t,o instanceof hl?this._location=o:this._location=hl.makeFromUrl(o,t.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(t,o){return new iv(t,o)}get root(){const t=new hl(this._location.bucket,"");return this._newRef(this._service,t)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return Pre(this._location.path)}get storage(){return this._service}get parent(){const t=t4e(this._location.path);if(t===null)return null;const o=new hl(this._location.bucket,t);return new iv(this._service,o)}_throwIfRoot(t){if(this._location.path==="")throw WBe(t)}}function E4e(r){r._throwIfRoot("getDownloadURL");const t=m4e(r.storage,r._location,o4e());return r.storage.makeRequestWithTokens(t,v4e).then(o=>{if(o===null)throw BBe();return o})}function y4e(r,t){const o=n4e(r._location.path,t),a=new hl(r._location.bucket,o);return new iv(r.storage,a)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function S4e(r){return/^[A-Za-z]+:\/\//.test(r)}function T4e(r,t){return new iv(r,t)}function Nre(r,t){if(r instanceof pj){const o=r;if(o._bucket==null)throw jBe();const a=new iv(o,o._bucket);return t!=null?Nre(a,t):a}else return t!==void 0?y4e(r,t):r}function b4e(r,t){if(t&&S4e(t)){if(r instanceof pj)return T4e(r,t);throw MU("To use ref(service, url), the first argument must be a Storage instance.")}else return Nre(r,t)}function uX(r,t){const o=t==null?void 0:t[bre];return o==null?null:hl.makeFromBucketSpec(o,r)}function w4e(r,t,o,a={}){r.host=`${t}:${o}`,r._protocol="http";const{mockUserToken:l}=a;l&&(r._overrideAuthToken=typeof l=="string"?l:Yee(l,r.app.options.projectId))}class pj{constructor(t,o,a,l,d){this.app=t,this._authProvider=o,this._appCheckProvider=a,this._url=l,this._firebaseVersion=d,this._bucket=null,this._host=Tre,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=OBe,this._maxUploadRetryTime=PBe,this._requests=new Set,l!=null?this._bucket=hl.makeFromBucketSpec(l,this._host):this._bucket=uX(this._host,this.app.options)}get host(){return this._host}set host(t){this._host=t,this._url!=null?this._bucket=hl.makeFromBucketSpec(this._url,t):this._bucket=uX(t,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(t){lX("time",0,Number.POSITIVE_INFINITY,t),this._maxUploadRetryTime=t}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(t){lX("time",0,Number.POSITIVE_INFINITY,t),this._maxOperationRetryTime=t}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const t=this._authProvider.getImmediate({optional:!0});if(t){const o=await t.getToken();if(o!==null)return o.accessToken}return null}async _getAppCheckToken(){const t=this._appCheckProvider.getImmediate({optional:!0});return t?(await t.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(t=>t.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(t){return new iv(this,t)}_makeRequest(t,o,a,l,d=!0){if(this._deleted)return new GBe(Rre());{const m=e4e(t,this._appId,a,l,o,this._firebaseVersion,d);return this._requests.add(m),m.getPromise().then(()=>this._requests.delete(m),()=>this._requests.delete(m)),m}}async makeRequestWithTokens(t,o){const[a,l]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(t,o,a,l).getPromise()}}const dX="@firebase/storage",hX="0.13.2";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kre="storage";function R4e(r){return r=to(r),E4e(r)}function C4e(r,t){return r=to(r),b4e(r,t)}function I4e(r=hF(),t){r=to(r);const a=MN(r,kre).getImmediate({identifier:t}),l=Kee("storage");return l&&A4e(a,...l),a}function A4e(r,t,o,a={}){w4e(r,t,o,a)}function O4e(r,{instanceIdentifier:t}){const o=r.getProvider("app").getImmediate(),a=r.getProvider("auth-internal"),l=r.getProvider("app-check-internal");return new pj(o,a,l,t,av)}function P4e(){J_(new km(kre,O4e,"PUBLIC").setMultipleInstances(!0)),fh(dX,hX,""),fh(dX,hX,"esm2017")}P4e();const Dre=async r=>{const t=I4e(),o=C4e(t,r);try{return await R4e(o)}catch(a){throw Ct.error("Failed to fetch HTTP URL from gs:// URL:","/src/packages/shared/firebase/firebaseStorage.js",a),a}};let N4e={};const k4e=async r=>{try{const t=yS(Mm,"spaces",r),o=await xU(t);if(o.exists()){let a=o.data();if(a.webglBuildId){const l=yS(Mm,"webglBuilds",a.webglBuildId),d=await xU(l);if(d.exists()){const m=d.data();a={...a,...m}}else Ct.warn(`spacesFirestore: No document found for webglBuildId: ${a.webglBuildId}`)}return a=await D4e(a),a=L4e(a),console.log("Space data:",a),Ct.log(`spacesFirestore: Caching space data for: ${r}`),N4e[r]=a,a}else return Ct.warn(`spacesFirestore: No document found for item ID: ${r}`),null}catch(t){throw Ct.error("spacesFirestore: Error fetching item data:",t),t}},D4e=async r=>{const o=["gsUrlCode","gsUrlData","gsUrlFramework","gsUrlLoader","gsUrlLoadingBackground"].map(async a=>{const l=r[a];l&&l.startsWith("gs://")&&(r[a]=await Dre(l))});return await Promise.all(o),r},L4e=r=>{const{gsUrlCode:t,gsUrlData:o,gsUrlFramework:a,gsUrlLoader:l,...d}=r;return{...d,codeUrl:t,dataUrl:o,frameworkUrl:a,loaderUrl:l}};let c2={};const Lre=async r=>{Ct.log("spacesFirestore: Get Videos from Firestore for space: ",r);try{if(c2[r])return Ct.log("spacesFirestore: Returning cached videos for space:",r),c2[r];const t=Gne(Mm,`spaces/${r}/videos`),o=await Uje(t),a=[];return o.forEach(l=>{a.push({id:l.id,...l.data()})}),c2[r]=a,a}catch(t){throw Ct.error("spacesFirestore: Error fetching Space videos from Firestore:",t),t}},ak=()=>{const{sendMessage:r,isLoaded:t}=LS(),o=V.useRef([]),a=V.useCallback(()=>{if(t)for(;o.current.length>0;){const{eventName:d,data:m}=o.current.shift();Ct.log("useSendUnityEvent: Processing queued event to Unity:",d,m);try{r("ReactIncomingEvent","HandleEvent",JSON.stringify({eventName:d,data:JSON.stringify(m)}))}catch(v){Ct.error("useSendUnityEvent: Error sending event to Unity:",v),o.current.unshift({eventName:d,data:m});break}}},[r,t]);return V.useEffect(()=>{const d=setInterval(()=>{a()},1e3);return()=>clearInterval(d)},[a]),V.useCallback((d,m)=>{Ct.log("useSendUnityEvent: Queuing event for Unity:",d),o.current.push({eventName:d,data:m}),a()},[a])},mR=()=>{const{addEventListener:r,removeEventListener:t}=LS();return V.useCallback((o,a)=>{const l=d=>{Ct.log(o+" unity message received.");let m=null;if(d)try{m=JSON.parse(d)}catch(v){Ct.warn("Failed to parse JSON data from Unity message:",v)}a(m)};return r(o,l),()=>{t(o,l)}},[r,t])},x4e=()=>{const[r,t]=V.useState(!1),o=mR();return V.useEffect(()=>{const l=o("FirstSceneLoaded",()=>{Ct.log("FirstSceneLoaded unity message received."),t(!0)});return()=>{l()}},[o]),r},M4e=r=>{const[t,o]=V.useState(null),a=mR(),{spaceID:l}=LS();return V.useEffect(()=>{let m=!0;const y=a("PlayVideo",async b=>{try{const{gameObjectName:R}=b;if(!R){Ct.error("Game object name is missing in Unity event data.");return}const O=await Lre(l);Ct.log("SPACES VIDEOS",O);const N=O.find(F=>F.id===R);N&&m?(o(N.url),Ct.log("Video URL set to:",N.url)):console.error("Video not found for game object:",R)}catch(R){console.error("Error fetching space videos:",R)}});return()=>{m=!1,y()}},[a,l,r]),[t,()=>{o(null)}]},U4e=()=>{const r=mR(),{sendUserToUnity:t}=V.useContext(wa);return V.useEffect(()=>{const a=r("RequestUserForUnity",()=>{Ct.log("React: Request from Unity to send user data"),t()});return()=>{a()}},[r,t]),!0},V4e=()=>{const{spaceID:r}=LS(),t=ak();V.useEffect(()=>{(async()=>{try{if(!r)throw new Error("spaceID is not defined.");const a=await Lre(r),l=async v=>{const y=`https://vimeo.com/api/oembed.json?url=${v}`,b=await fetch(y);if(!b.ok)throw new Error(`Failed to fetch thumbnail: ${b.statusText}`);const R=await b.json(),O=R.thumbnail_url.replace(/_\d+x\d+/,""),N=["640x360","295x166"];let F=null;for(let H of N){const G=`https://i.vimeocdn.com/filter/overlay?src0=${encodeURIComponent(`${O}_${H}`)}&src1=http://f.vimeocdn.com/p/images/crawler_play.png`;try{if((await fetch(G,{method:"HEAD"})).ok){F=G;break}}catch(z){console.warn(`Failed to validate thumbnail URL: ${G}`,z)}}return F||R.thumbnail_url},d=a.map(async v=>{const y=await l(v.url);return{gameObjectName:v.id,thumbnailUrl:y}}),m=await Promise.all(d);Ct.log("Fetched Thumbnails",m),m.forEach(({gameObjectName:v,thumbnailUrl:y})=>{t("SetThumbnail",{gameObjectName:v,thumbnailUrl:y})})}catch(a){Ct.error("Error fetching thumbnails:",a)}})()},[t,r])},F4e=()=>{const[r,t]=V.useState(null),o=mR();return console.log(" Nameplate click hook initialized"),V.useEffect(()=>{console.log(" Setting up nameplate click listener...");const d=o("OpenNameplateModal",m=>{if(console.log(" Nameplate click detected!",m),!m){console.warn(" Received empty data in nameplate click handler");return}try{const v=typeof m=="string"?JSON.parse(m):m;t({playerName:v.playerName,playerId:v.playerId,uid:v.uid,isLocalPlayer:v.isLocalPlayer}),console.log(" Processed nameplate data:",v)}catch(v){console.error(" Error processing nameplate data:",v)}});return()=>{console.log(" Cleaning up nameplate click listener"),typeof d=="function"&&d()}},[o]),[r,()=>{console.log(" Resetting nameplate data"),t(null)}]},xre=()=>{const[r,t]=V.useState([]),o=mR();return V.useEffect(()=>{let a=!0,l=null;const d=()=>{window.unityInstance&&(Ct.log("Requesting fresh player list"),window.unityInstance.SendMessage("NetworkManager","RequestPlayerList"))},m=F=>{if(a){Ct.log("UpdatePlayerList unity message received.");try{let H=[];if(typeof F=="object"&&F!==null?H=F.players||[]:H=JSON.parse(F).players||[],Array.isArray(H)){const G=Array.from(new Map(H.map(z=>[z.playerId,z])).values());t(G),l&&(clearTimeout(l),l=null)}}catch(H){Ct.error("Error handling player list data:",H),l||(l=setTimeout(d,1e3))}}},v=()=>{Ct.log("Player disconnected, requesting fresh player list"),d()},y=()=>{Ct.log("Player left, requesting fresh player list"),d()};d();const b=o("UpdatePlayerList",m),R=o("PlayerDisconnected",v),O=o("PlayerLeft",y),N=setInterval(d,5e3);return()=>{a=!1,l&&clearTimeout(l),typeof b=="function"&&b(),typeof R=="function"&&R(),typeof O=="function"&&O(),clearInterval(N)}},[o]),r},j4e=r=>({opacity:1});Mr.string.isRequired,Mr.func.isRequired;function B4e(){const{loadingProgression:r,isLoaded:t,error:o}=LS(),{user:a}=V.useContext(wa),[l,d]=V.useState(!1),[m,v]=V.useState(!1);return V.useEffect(()=>{d(!a&&r===0)},[a,r]),D.jsx(D.Fragment,{children:l?D.jsx(Xt,{position:"absolute",zIndex:"1",width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",children:D.jsxs(Bo,{spacing:4,padding:6,borderRadius:"md",backgroundColor:"rgba(0, 0, 0, 0.8)",color:"white",children:[D.jsx(pn,{fontSize:"xl",fontWeight:"bold",children:"Sign In Required"}),D.jsx(pn,{textAlign:"center",children:"Please sign in to enter The Disruptive Spaces"}),D.jsx(Nc,{colorScheme:"blue",size:"lg",width:"200px",onClick:()=>v(!0),children:"Sign In"})]})}):D.jsx(Xt,{position:"absolute",zIndex:"1",width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",transition:"opacity 3s ease-in-out",opacity:t?0:1,children:D.jsxs(Ic,{flexDirection:"column",alignItems:"center",padding:4,marginY:4,borderRadius:"md",backgroundColor:"rgba(0, 0, 0, 0.8)",color:"white",zIndex:"1",children:[D.jsx(pn,{fontWeight:"bold",children:"Entering The Disruptive Spaces"}),D.jsxs(pn,{fontSize:"sm",children:[t?"World Initialising":"World loading","."]}),D.jsx(lF,{value:r*100,size:"lg",width:"100%",marginY:2})]})})})}function W4e(){const{user:r}=V.useContext(wa);return D.jsx("div",{children:r!==null?D.jsx("div",{children:D.jsx(sk,{})}):D.jsxs("div",{children:[D.jsx(ik,{}),D.jsx(ok,{})]})})}function G4e(){const{fullscreenRef:r}=ep(),[t,o]=V.useState(!1),a=()=>{o(!t)};return D.jsxs(D.Fragment,{children:[D.jsx(Zw,{label:"Help",hasArrow:!0,placement:"top",closeOnClick:!0,portalProps:{containerRef:r},children:D.jsx(ul,{"aria-label":"Controller Help",icon:D.jsx(Kje,{}),onClick:a,variant:"iconButton"})}),D.jsxs(Rh,{isOpen:t,onClose:a,size:"md",portalProps:{containerRef:r},children:[D.jsx(Ih,{}),D.jsxs(Ch,{children:[D.jsx(Qf,{children:"Notes"}),D.jsx(Oh,{}),D.jsx(Ah,{children:D.jsx(pn,{variant:"formIntro",children:"The help button is showing so we can see the blur and transparency styles on the button."})}),D.jsx(ON,{children:D.jsx(Nc,{variant:"primary",onClick:a,children:"Close"})})]})]})]})}var Mre={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},fX=Gi.createContext&&Gi.createContext(Mre),Im=function(){return Im=Object.assign||function(r){for(var t,o=1,a=arguments.length;o<a;o++){t=arguments[o];for(var l in t)Object.prototype.hasOwnProperty.call(t,l)&&(r[l]=t[l])}return r},Im.apply(this,arguments)},z4e=function(r,t){var o={};for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&t.indexOf(a)<0&&(o[a]=r[a]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,a=Object.getOwnPropertySymbols(r);l<a.length;l++)t.indexOf(a[l])<0&&Object.prototype.propertyIsEnumerable.call(r,a[l])&&(o[a[l]]=r[a[l]]);return o};function Ure(r){return r&&r.map(function(t,o){return Gi.createElement(t.tag,Im({key:o},t.attr),Ure(t.child))})}function zm(r){return function(t){return Gi.createElement(H4e,Im({attr:Im({},r.attr)},t),Ure(r.child))}}function H4e(r){var t=function(o){var a=r.attr,l=r.size,d=r.title,m=z4e(r,["attr","size","title"]),v=l||o.size||"1em",y;return o.className&&(y=o.className),r.className&&(y=(y?y+" ":"")+r.className),Gi.createElement("svg",Im({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},o.attr,a,m,{className:y,style:Im(Im({color:r.color||o.color},o.style),r.style),height:v,width:v,xmlns:"http://www.w3.org/2000/svg"}),d&&Gi.createElement("title",null,d),r.children)};return fX!==void 0?Gi.createElement(fX.Consumer,null,function(o){return t(o)}):t(Mre)}function Vre(r){return zm({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"}}]})(r)}function Fre(r){return zm({attr:{viewBox:"0 0 496 512"},child:[{tag:"path",attr:{d:"M336.5 160C322 70.7 287.8 8 248 8s-74 62.7-88.5 152h177zM152 256c0 22.2 1.2 43.5 3.3 64h185.3c2.1-20.5 3.3-41.8 3.3-64s-1.2-43.5-3.3-64H155.3c-2.1 20.5-3.3 41.8-3.3 64zm324.7-96c-28.6-67.9-86.5-120.4-158-141.6 24.4 33.8 41.2 84.7 50 141.6h108zM177.2 18.4C105.8 39.6 47.8 92.1 19.3 160h108c8.7-56.9 25.5-107.8 49.9-141.6zM487.4 192H372.7c2.1 21 3.3 42.5 3.3 64s-1.2 43-3.3 64h114.6c5.5-20.5 8.6-41.8 8.6-64s-3.1-43.5-8.5-64zM120 256c0-21.5 1.2-43 3.3-64H8.6C3.2 212.5 0 233.8 0 256s3.2 43.5 8.6 64h114.6c-2-21-3.2-42.5-3.2-64zm39.5 96c14.5 89.3 48.7 152 88.5 152s74-62.7 88.5-152h-177zm159.3 141.6c71.4-21.2 129.4-73.7 158-141.6h-108c-8.8 56.9-25.6 107.8-50 141.6zM19.3 352c28.6 67.9 86.5 120.4 158 141.6-24.4-33.8-41.2-84.7-50-141.6h-108z"}}]})(r)}function UU(r){return zm({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M633.82 458.1l-157.8-121.96C488.61 312.13 496 285.01 496 256v-48c0-8.84-7.16-16-16-16h-16c-8.84 0-16 7.16-16 16v48c0 17.92-3.96 34.8-10.72 50.2l-26.55-20.52c3.1-9.4 5.28-19.22 5.28-29.67V96c0-53.02-42.98-96-96-96s-96 42.98-96 96v45.36L45.47 3.37C38.49-2.05 28.43-.8 23.01 6.18L3.37 31.45C-2.05 38.42-.8 48.47 6.18 53.9l588.36 454.73c6.98 5.43 17.03 4.17 22.46-2.81l19.64-25.27c5.41-6.97 4.16-17.02-2.82-22.45zM400 464h-56v-33.77c11.66-1.6 22.85-4.54 33.67-8.31l-50.11-38.73c-6.71.4-13.41.87-20.35.2-55.85-5.45-98.74-48.63-111.18-101.85L144 241.31v6.85c0 89.64 63.97 169.55 152 181.69V464h-56c-8.84 0-16 7.16-16 16v16c0 8.84 7.16 16 16 16h160c8.84 0 16-7.16 16-16v-16c0-8.84-7.16-16-16-16z"}}]})(r)}function VU(r){return zm({attr:{viewBox:"0 0 352 512"},child:[{tag:"path",attr:{d:"M176 352c53.02 0 96-42.98 96-96V96c0-53.02-42.98-96-96-96S80 42.98 80 96v160c0 53.02 42.98 96 96 96zm160-160h-16c-8.84 0-16 7.16-16 16v48c0 74.8-64.49 134.82-140.79 127.38C96.71 376.89 48 317.11 48 250.3V208c0-8.84-7.16-16-16-16H16c-8.84 0-16 7.16-16 16v40.16c0 89.64 63.97 169.55 152 181.69V464H96c-8.84 0-16 7.16-16 16v16c0 8.84 7.16 16 16 16h160c8.84 0 16-7.16 16-16v-16c0-8.84-7.16-16-16-16h-56v-33.77C285.71 418.47 352 344.9 352 256v-48c0-8.84-7.16-16-16-16z"}}]})(r)}function K4e(r){return zm({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M416 208H272V64c0-17.67-14.33-32-32-32h-32c-17.67 0-32 14.33-32 32v144H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h144v144c0 17.67 14.33 32 32 32h32c17.67 0 32-14.33 32-32V304h144c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z"}}]})(r)}function $4e(r){return zm({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M96 224c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm448 0c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm32 32h-64c-17.6 0-33.5 7.1-45.1 18.6 40.3 22.1 68.9 62 75.1 109.4h66c17.7 0 32-14.3 32-32v-32c0-35.3-28.7-64-64-64zm-256 0c61.9 0 112-50.1 112-112S381.9 32 320 32 208 82.1 208 144s50.1 112 112 112zm76.8 32h-8.3c-20.8 10-43.9 16-68.5 16s-47.6-6-68.5-16h-8.3C179.6 288 128 339.6 128 403.2V432c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48v-28.8c0-63.6-51.6-115.2-115.2-115.2zm-223.7-13.4C161.5 263.1 145.6 256 128 256H64c-35.3 0-64 28.7-64 64v32c0 17.7 14.3 32 32 32h65.9c6.3-47.4 34.9-87.3 75.2-109.4z"}}]})(r)}function jre({open:r,onClose:t}){const o=V.useRef(null),a=ak(),{user:l}=V.useContext(wa),d=y=>{o.current&&!o.current.contains(y.target)&&t()},m=async y=>{const b=v(y);if((b==null?void 0:b.source)==="readyplayerme"&&(b.eventName==="v1.frame.ready"&&o.current.contentWindow.postMessage(JSON.stringify({target:"readyplayerme",type:"subscribe",eventName:"v1.**"}),"*"),b.eventName==="v1.avatar.exported")){const R=b.data.url;if(console.log(`Avatar URL: ${R}`),a("AvatarUrlFromReact",{url:R}),l&&l.uid)try{await ore(l.uid,R),t()}catch(O){console.error("Error updating RPM URL:",O)}else console.error("No authenticated user found to update rpmURL.")}},v=y=>{try{return JSON.parse(y.data)}catch{return null}};return V.useEffect(()=>(r&&(document.addEventListener("mousedown",d),window.addEventListener("message",m)),()=>{document.removeEventListener("mousedown",d),window.removeEventListener("message",m)}),[r]),r&&D.jsx(au,{children:D.jsx(Xt,{position:"fixed",top:"0",left:"0",width:"100%",height:"100%",bg:"rgba(0, 0, 0, 0.8)",zIndex:1e4,display:"flex",justifyContent:"center",alignItems:"center",onClick:y=>y.stopPropagation(),children:D.jsx(Xt,{position:"relative",maxWidth:"1080px",maxHeight:"800px",width:"90%",height:"90%",children:D.jsx("iframe",{ref:o,src:"https://spacesmetaverse.readyplayer.me/avatar?frameApi",title:"Ready Player Me",width:"100%",height:"100%",style:{border:"none",borderRadius:"8px"},allow:"camera *; microphone *; clipboard-write"})})})})}function q4e({isOpen:r,onClose:t}){const[o,a]=V.useState(!1),[l,d]=V.useState(null),{user:m}=V.useContext(wa),v=ak(),y=H=>{H.stopPropagation(),a(!0)},b=()=>{a(!1),t()},R=async H=>{if(d(H),m&&m.uid)try{await ore(m.uid,H.url),v("AvatarUrlFromReact",{url:H.url}),t()}catch(G){console.error("Error updating RPM URL:",G)}else console.error("No authenticated user found to update rpmURL.")},O=jge("gray.200","whiteAlpha.300"),N="rgba(0, 0, 0, 0.3)",F=[{id:1,url:"https://models.readyplayer.me/67c8408d38f7924e15a8bd0a.glb",name:"Default Avatar 1"},{id:2,url:"https://models.readyplayer.me/67c8576838e3cf57cc697c15.glb",name:"Default Avatar 2"},{id:3,url:"https://models.readyplayer.me/67c884144c4878c55e515ff5.glb",name:"Default Avatar 3"},{id:4,url:"https://models.readyplayer.me/67c885af25f4d62e75c0ff1e.glb",name:"Default Avatar 4"},{id:5,url:"https://models.readyplayer.me/67c8860f4c4878c55e5189b6.glb",name:"Default Avatar 5"},{id:6,url:"https://models.readyplayer.me/67c8869db6d0b438b7abd822.glb",name:"Default Avatar 6"},{id:7,url:"https://models.readyplayer.me/67c886ed28ee0e0bfac89688.glb",name:"Default Avatar 7"},{id:8,url:"https://models.readyplayer.me/67c88731795ea3e2e6ea84db.glb",name:"Default Avatar 8"},{id:9,url:"https://models.readyplayer.me/67c8878b0cdc0f22383f0f8f.glb",name:"Default Avatar 9"}];return D.jsxs(D.Fragment,{children:[D.jsx(au,{children:D.jsxs(Rh,{isOpen:r,onClose:t,isCentered:!0,size:"xl",zIndex:9999,children:[D.jsx(Ih,{bg:"rgba(0, 0, 0, 0.7)"}),D.jsxs(Ch,{bg:"gray.800",color:"white",maxW:"900px",children:[D.jsx(Qf,{fontSize:"lg",children:"Customise Your Avatar"}),D.jsx(Oh,{color:"white",_hover:{bg:"transparent",color:"whiteAlpha.800"},_focus:{boxShadow:"none"},size:"lg",position:"absolute",right:2,top:2}),D.jsx(Ah,{pb:4,children:D.jsxs(Bo,{spacing:4,align:"stretch",children:[D.jsx(pn,{fontSize:"sm",children:"Choose from our collection or create your own unique avatar"}),D.jsxs($Z,{columns:5,spacing:2,children:[D.jsx(Xt,{position:"relative",cursor:"pointer",borderWidth:"2px",borderStyle:"dashed",borderColor:O,borderRadius:"lg",overflow:"hidden",onClick:y,_hover:{bg:N},transition:"all 0.2s",display:"flex",alignItems:"center",justifyContent:"center",aspectRatio:"1",children:D.jsxs(Bo,{spacing:1,children:[D.jsx(Fm,{as:K4e,boxSize:4}),D.jsx(pn,{fontSize:"xs",children:"Create Custom Avatar"})]})}),F.map(H=>D.jsxs(Xt,{position:"relative",cursor:"pointer",borderWidth:"2px",borderColor:(l==null?void 0:l.id)===H.id?"blue.400":O,borderRadius:"lg",overflow:"hidden",onClick:()=>R(H),_hover:{bg:N},transition:"all 0.2s",aspectRatio:"1",children:[D.jsx(kV,{src:H.url.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"),alt:H.name,width:"100%",height:"100%",objectFit:"cover"}),D.jsx(Xt,{position:"absolute",bottom:"0",left:"0",right:"0",p:1,bg:"rgba(0, 0, 0, 0.7)",children:D.jsx(pn,{fontSize:"xs",children:H.name})})]},H.id))]})]})})]})]})}),o&&D.jsx(jre,{open:o,onClose:b})]})}function Y4e(){const{fullscreenRef:r}=ep(),[t,o]=V.useState(!1),[a,l]=V.useState(!1),[d,m]=V.useState(!1),[v,y]=V.useState(!1),{user:b}=V.useContext(wa),[R,O]=V.useState(null),[N,F]=V.useState(!0),H=(J,oe)=>!J||!oe?"?":`${J.charAt(0)}${oe.charAt(0)}`.toUpperCase(),G=async()=>{if(b!=null&&b.uid){F(!0);try{const J=await Um(b.uid);O({rpmURL:J.rpmURL?J.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null,firstName:J.firstName,lastName:J.lastName})}catch(J){console.error("Error fetching profile data:",J)}finally{F(!1)}}};V.useEffect(()=>{G()},[b==null?void 0:b.uid]),V.useEffect(()=>{const J=()=>{o(!0)};return window.addEventListener("PlayerInstantiated",J),()=>{window.removeEventListener("PlayerInstantiated",J)}},[]);const z=()=>l(!a),ne=()=>{l(!1),G()};return t?D.jsxs(D.Fragment,{children:[D.jsx(Zw,{label:"Edit Avatar",hasArrow:!0,placement:"top",closeOnClick:!0,isOpen:v,portalProps:{containerRef:r},children:D.jsxs(Xt,{position:"relative",onMouseEnter:()=>{m(!0),y(!0)},onMouseLeave:()=>{m(!1),y(!1)},cursor:"pointer",onClick:z,children:[D.jsx(Eh,{src:N||R==null?void 0:R.rpmURL,size:"md",borderRadius:"full",bg:"white",name:N?H(R==null?void 0:R.firstName,R==null?void 0:R.lastName):" ",borderWidth:"1px",borderColor:"whiteAlpha.300"}),d&&D.jsx(Xt,{position:"absolute",top:"0",left:"0",right:"0",bottom:"0",display:"flex",alignItems:"center",justifyContent:"center",bg:"rgba(0, 0, 0, 0.4)",borderRadius:"full",children:D.jsx(pn,{fontSize:"xs",fontWeight:"bold",color:"white",children:"Edit"})})]})}),D.jsx(q4e,{isOpen:a,onClose:ne})]}):null}function X4e(r){return zm({attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M391 240.9c-.8-6.6-8.9-9.4-13.6-4.7l-43.7 43.7L200 146.3a8.03 8.03 0 0 0-11.3 0l-42.4 42.3a8.03 8.03 0 0 0 0 11.3L280 333.6l-43.9 43.9a8.01 8.01 0 0 0 4.7 13.6L401 410c5.1.6 9.5-3.7 8.9-8.9L391 240.9zm10.1 373.2L240.8 633c-6.6.8-9.4 8.9-4.7 13.6l43.9 43.9L146.3 824a8.03 8.03 0 0 0 0 11.3l42.4 42.3c3.1 3.1 8.2 3.1 11.3 0L333.7 744l43.7 43.7A8.01 8.01 0 0 0 391 783l18.9-160.1c.6-5.1-3.7-9.4-8.8-8.8zm221.8-204.2L783.2 391c6.6-.8 9.4-8.9 4.7-13.6L744 333.6 877.7 200c3.1-3.1 3.1-8.2 0-11.3l-42.4-42.3a8.03 8.03 0 0 0-11.3 0L690.3 279.9l-43.7-43.7a8.01 8.01 0 0 0-13.6 4.7L614.1 401c-.6 5.2 3.7 9.5 8.8 8.9zM744 690.4l43.9-43.9a8.01 8.01 0 0 0-4.7-13.6L623 614c-5.1-.6-9.5 3.7-8.9 8.9L633 783.1c.8 6.6 8.9 9.4 13.6 4.7l43.7-43.7L824 877.7c3.1 3.1 8.2 3.1 11.3 0l42.4-42.3c3.1-3.1 3.1-8.2 0-11.3L744 690.4z"}}]})(r)}function J4e(r){return zm({attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M290 236.4l43.9-43.9a8.01 8.01 0 0 0-4.7-13.6L169 160c-5.1-.6-9.5 3.7-8.9 8.9L179 329.1c.8 6.6 8.9 9.4 13.6 4.7l43.7-43.7L370 423.7c3.1 3.1 8.2 3.1 11.3 0l42.4-42.3c3.1-3.1 3.1-8.2 0-11.3L290 236.4zm352.7 187.3c3.1 3.1 8.2 3.1 11.3 0l133.7-133.6 43.7 43.7a8.01 8.01 0 0 0 13.6-4.7L863.9 169c.6-5.1-3.7-9.5-8.9-8.9L694.8 179c-6.6.8-9.4 8.9-4.7 13.6l43.9 43.9L600.3 370a8.03 8.03 0 0 0 0 11.3l42.4 42.4zM845 694.9c-.8-6.6-8.9-9.4-13.6-4.7l-43.7 43.7L654 600.3a8.03 8.03 0 0 0-11.3 0l-42.4 42.3a8.03 8.03 0 0 0 0 11.3L734 787.6l-43.9 43.9a8.01 8.01 0 0 0 4.7 13.6L855 864c5.1.6 9.5-3.7 8.9-8.9L845 694.9zm-463.7-94.6a8.03 8.03 0 0 0-11.3 0L236.3 733.9l-43.7-43.7a8.01 8.01 0 0 0-13.6 4.7L160.1 855c-.6 5.1 3.7 9.5 8.9 8.9L329.2 845c6.6-.8 9.4-8.9 4.7-13.6L290 787.6 423.7 654c3.1-3.1 3.1-8.2 0-11.3l-42.4-42.4z"}}]})(r)}function Q4e(){const{isFullscreen:r,toggleFullscreen:t,fullscreenRef:o}=ep(),a=()=>{o.current?t():console.error("Fullscreen target not set")};return D.jsx(Zw,{label:r?"Exit Fullscreen":"Enter Fullscreen",hasArrow:!0,placement:"bottom",closeOnClick:!0,portalProps:{containerRef:o},children:D.jsx(ul,{"aria-label":r?"Exit Fullscreen":"Enter Fullscreen",icon:r?D.jsx(X4e,{}):D.jsx(J4e,{}),onClick:a,variant:"iconButton"})})}const Z4e=()=>(V4e(),null),pX={iframeContainer:{position:"relative",paddingBottom:"56.25%",height:0,overflow:"hidden",width:"100%"},iframe:{position:"absolute",top:0,left:0,width:"100%",height:"100%",border:"none"}};function e3e(){const{isOpen:r,onOpen:t,onClose:o}=zZ(),{fullscreenRef:a}=ep(),[l,d]=M4e(!1);V.useEffect(()=>{Ct.log("VideoPlayer: Current video URL:",l),l&&(Ct.log("VideoPlayer: Opening modal for video URL:",l),t())},[l,t]);const m=()=>{Ct.log("VideoPlayer: Closing modal"),d(),o()};return D.jsx(au,{containerRef:a,children:D.jsxs(Rh,{isOpen:r,onClose:m,size:"lg",isCentered:!0,portalProps:{containerRef:a},children:[D.jsx(Ih,{bg:"rgba(0, 0, 0, 0.8)"}),D.jsxs(Ch,{bg:"gray.900",color:"white",borderRadius:"lg",overflow:"hidden",maxWidth:"80vw",maxHeight:"80vh",display:"flex",justifyContent:"center",alignItems:"center",position:"relative",zIndex:"modal",children:[D.jsx(Oh,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",zIndex:"modal",_hover:{bg:"gray.600"},_focus:{boxShadow:"none"},position:"absolute",top:"10px",right:"10px"}),D.jsx(Ah,{p:0,width:"100%",children:l&&D.jsx(Xt,{style:pX.iframeContainer,children:D.jsx("iframe",{src:l,style:pX.iframe,allow:"autoplay; fullscreen",allowFullScreen:!0,title:"Video Player"})})})]})]})})}function t3e({isOpen:r,onClose:t,playerName:o,playerId:a,uid:l}){const[d,m]=V.useState(null),[v,y]=V.useState(!0),[b,R]=V.useState(null);return V.useEffect(()=>{r&&(async()=>{if(y(!0),R(null),!l){Ct.warn("NameplateModal: No UID provided for player:",o),R("No user ID available for this player"),y(!1);return}try{Ct.log("NameplateModal: Fetching profile for UID:",l);const N=await Um(l);N?m({firstName:N.firstName,lastName:N.lastName,linkedinUrl:N.linkedinUrl,websiteUrl:N.websiteUrl,rpmURL:N.rpmURL?N.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null}):R("Could not find profile data for this player")}catch(N){Ct.error("Error fetching profile data:",N),R("Error loading profile data")}finally{y(!1)}})()},[l,r,o]),D.jsxs(Rh,{isOpen:r,onClose:t,isCentered:!0,size:"md",children:[D.jsx(Ih,{backdropFilter:"blur(10px)"}),D.jsxs(Ch,{bg:"gray.900",color:"white",borderRadius:"xl",children:[D.jsx(Qf,{children:"Player Info"}),D.jsx(Oh,{}),D.jsx(Ah,{pb:6,children:v?D.jsx(ZZ,{py:8,children:D.jsx(zw,{size:"xl",color:"blue.400"})}):b?D.jsxs(bN,{status:"warning",variant:"solid",borderRadius:"md",children:[D.jsx(TN,{}),b]}):D.jsxs(Bo,{spacing:4,align:"center",children:[D.jsx(Eh,{size:"2xl",src:d==null?void 0:d.rpmURL,bg:"whiteAlpha.300",name:o,borderWidth:"2px",borderColor:"whiteAlpha.300"}),D.jsxs(Bo,{spacing:1,children:[D.jsx(pn,{fontSize:"2xl",fontWeight:"bold",children:o}),(d==null?void 0:d.firstName)&&D.jsxs(pn,{fontSize:"md",color:"gray.400",children:[d.firstName," ",d.lastName]}),D.jsxs(pn,{fontSize:"xs",color:"gray.500",mt:1,children:["ID: ",a]})]}),((d==null?void 0:d.linkedinUrl)||(d==null?void 0:d.websiteUrl))&&D.jsxs(D.Fragment,{children:[D.jsx(Ew,{borderColor:"whiteAlpha.300"}),D.jsxs(cS,{spacing:4,pt:2,children:[(d==null?void 0:d.linkedinUrl)&&D.jsx(yh,{href:d.linkedinUrl,isExternal:!0,children:D.jsx(ul,{icon:D.jsx(Vre,{}),variant:"ghost",colorScheme:"linkedin",size:"lg","aria-label":"LinkedIn profile",_hover:{bg:"whiteAlpha.200"}})}),(d==null?void 0:d.websiteUrl)&&D.jsx(yh,{href:d.websiteUrl,isExternal:!0,children:D.jsx(ul,{icon:D.jsx(Fre,{}),variant:"ghost",colorScheme:"blue",size:"lg","aria-label":"Personal website",_hover:{bg:"whiteAlpha.200"}})})]})]})]})})]})]})}const n3e=({isVisible:r,onToggleVisibility:t})=>{const o=xre(),[a,l]=V.useState(!1),[d,m]=V.useState([]),[v,y]=V.useState(!1),[b,R]=V.useState({}),[O,N]=V.useState({}),F=window.currentUser||{};V.useEffect(()=>{const oe={};o.forEach(se=>{if(se.uid){if(se.isLocalPlayer&&window.agoraClient&&window.agoraClient.client)oe[se.uid]=window.agoraClient.client.uid;else if(window.agoraClient&&window.agoraClient.client&&window.agoraClient.client.remoteUsers){const ae=window.agoraClient.client.remoteUsers,ye=ae.find(Q=>String(Q.uid)===String(se.uid));if(ye)oe[se.uid]=ye.uid;else{const Q=ae.find(te=>typeof te.uid=="string"&&te.uid.includes(se.uid));if(Q)oe[se.uid]=Q.uid;else{const te=ae.find(re=>typeof se.uid=="string"&&se.uid.includes(String(re.uid)));if(te)oe[se.uid]=te.uid;else{const re=ae.filter(le=>!(typeof le.uid=="string"&&le.uid.startsWith("screen-")));re.length===1&&!se.isLocalPlayer&&(console.log(`Special case: Mapping player ${se.playerName} (${se.uid}) to the only remote user: ${re[0].uid}`),oe[se.uid]=re[0].uid)}}}}}}),N(oe)},[o]);const H=()=>{if(window.agoraClient&&typeof window.agoraClient.isVoiceEnabled=="boolean"){const oe=window.agoraClient.isVoiceEnabled;oe!==v&&(console.log("UnityPlayerList: Updating mic state from window.agoraClient:",oe),y(oe))}if(window.agoraClient&&window.agoraClient.client&&window.agoraClient.client.remoteUsers){const oe=window.agoraClient.client.remoteUsers,se={};oe.forEach(ae=>{typeof ae.uid=="string"&&ae.uid.startsWith("screen-")||(se[ae.uid]=!!ae.audioTrack&&!ae.audioTrack.muted)}),JSON.stringify(se)!==JSON.stringify(b)&&(console.log("UnityPlayerList: Updating active mics:",se),R(se))}};V.useEffect(()=>{const oe=setInterval(H,500),se=ae=>{console.log("UnityPlayerList: Voice toggle event received:",ae.detail),ae.detail&&typeof ae.detail.enabled=="boolean"&&y(ae.detail.enabled)};return window.addEventListener("VoiceToggled",se),H(),()=>{clearInterval(oe),window.removeEventListener("VoiceToggled",se)}},[]),V.useEffect(()=>{const oe=()=>{Ct.log("UnityPlayerList: Player instantiated, showing list"),l(!0)};return window.addEventListener("PlayerInstantiated",oe),window.isPlayerInstantiated&&(Ct.log("UnityPlayerList: Player was already instantiated"),l(!0)),()=>{window.removeEventListener("PlayerInstantiated",oe)}},[]),V.useEffect(()=>{(async()=>{const se=await Promise.all(o.map(async ae=>{if(ae.uid)try{const ye=await Um(ae.uid);return{...ae,firstName:ye.firstName,lastName:ye.lastName,linkedInProfile:ye.linkedInProfile,websiteUrl:ye.websiteUrl,rpmURL:ye.rpmURL?ye.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null}}catch(ye){return Ct.error(`Error fetching data for player ${ae.playerName}:`,ye),ae}return ae}));m(se)})()},[o]);const G=[...d].sort((oe,se)=>oe.isLocalPlayer?-1:se.isLocalPlayer?1:0),z=()=>{Ct.log("UnityPlayerList: Toggling visibility"),t&&t()},ne=oe=>!!(oe.isLocalPlayer||F&&F.uid&&oe.uid===F.uid),J=oe=>{try{if(ne(oe))return window.agoraClient&&typeof window.agoraClient.isVoiceEnabled=="boolean"?window.agoraClient.isVoiceEnabled:v;if(oe.uid){if(b[oe.uid])return!0;const se=O[oe.uid];if(se&&b[se])return!0;const ae=parseInt(oe.uid);if(!isNaN(ae)&&b[ae])return!0}return!1}catch(se){return console.error("Error in hasActiveMic:",se),!1}};return D.jsxs(Xt,{position:"absolute",top:"100px",right:"20px",zIndex:"1",bg:"rgba(0,0,0,0.4)",p:4,borderRadius:"md",color:"white",minWidth:"200px",maxHeight:"300px",visibility:a&&r?"visible":"hidden",role:"group",children:[D.jsx(Xt,{position:"absolute",top:2,right:2,opacity:0,_groupHover:{opacity:1},transition:"opacity 0.2s",children:D.jsx(ul,{icon:D.jsx(Xje,{boxSize:3}),size:"xs","aria-label":"Close list",variant:"unstyled",color:"white",onClick:z,_hover:{opacity:.8}})}),D.jsxs(pn,{fontWeight:"bold",mb:2,fontSize:"sm",children:["People Online: ",o.length]}),D.jsx(Xt,{maxHeight:"200px",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"4px"},"&::-webkit-scrollbar-track":{background:"rgba(0,0,0,0.1)"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"2px"}},children:D.jsx(Bo,{align:"stretch",spacing:1,width:"100%",children:G.map((oe,se)=>{const ae=ne(oe),ye=J(oe);return D.jsx(Xt,{children:D.jsxs(Iee,{placement:"left",trigger:"hover",children:[D.jsx(Cee,{children:D.jsxs(cS,{width:"100%",spacing:2,p:1,borderRadius:"md",_hover:{bg:"whiteAlpha.200"},transition:"background 0.2s",children:[D.jsx(Eh,{size:"xs",src:oe.rpmURL,bg:"whiteAlpha.400",name:" ",borderWidth:"1px",borderColor:"whiteAlpha.300"}),D.jsx(pn,{fontSize:"xs",children:oe.playerName}),D.jsx(qZ,{}),ye?D.jsx(Xt,{color:"green.400",children:D.jsx(VU,{})}):D.jsx(Xt,{color:"red.400",children:D.jsx(UU,{})}),ae&&D.jsx(pn,{fontSize:"xs",color:"gray.300",ml:1,children:"(you)"})]})}),D.jsx(Pee,{bg:"rgba(0,0,0,0.4)",border:"none",boxShadow:"lg",color:"white",p:3,width:"auto",minWidth:"200px",ml:"-20px",position:"absolute",left:"-220px",top:"-100px",transform:"none !important",children:D.jsx(Aee,{children:D.jsxs(Bo,{align:"center",spacing:2,children:[D.jsx(Eh,{size:"lg",src:oe.rpmURL,bg:"whiteAlpha.400",name:" ",borderWidth:"2px",borderColor:"whiteAlpha.300"}),D.jsx(pn,{fontSize:"lg",fontWeight:"bold",children:oe.playerName}),oe.firstName&&D.jsxs(pn,{fontSize:"sm",color:"gray.300",children:[oe.firstName," ",oe.lastName]}),D.jsxs(cS,{spacing:4,pt:2,children:[oe.linkedInProfile&&D.jsx(yh,{href:oe.linkedInProfile,isExternal:!0,children:D.jsx(ul,{icon:D.jsx(Vre,{}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"LinkedIn profile",_hover:{bg:"whiteAlpha.200"}})}),oe.websiteUrl&&D.jsx(yh,{href:oe.websiteUrl,isExternal:!0,children:D.jsx(ul,{icon:D.jsx(Fre,{}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"Personal website",_hover:{bg:"whiteAlpha.200"}})}),D.jsx(ul,{icon:ye?D.jsx(VU,{}):D.jsx(UU,{}),variant:"ghost",colorScheme:ye?"green":"red",size:"sm","aria-label":"Microphone status",isDisabled:!0})]})]})})})]})},se)})})})]})};var EP={exports:{}},r3e=EP.exports,mX;function i3e(){return mX||(mX=1,function(r,t){(function(o,a){r.exports=a()})(r3e,function(){function o(e,n){return n.forEach(function(i){i&&typeof i!="string"&&!Array.isArray(i)&&Object.keys(i).forEach(function(s){if(s!=="default"&&!(s in e)){var c=Object.getOwnPropertyDescriptor(i,s);Object.defineProperty(e,s,c.get?c:{enumerable:!0,get:function(){return i[s]}})}})}),Object.freeze(e)}var a=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof N_<"u"?N_:typeof self<"u"?self:{};function l(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var d=function(e){try{return!!e()}catch{return!0}},m=!d(function(){var e=(function(){}).bind();return typeof e!="function"||e.hasOwnProperty("prototype")}),v=m,y=Function.prototype,b=y.call,R=v&&y.bind.bind(b,b),O=v?R:function(e){return function(){return b.apply(e,arguments)}},N=O({}.isPrototypeOf),F=function(e){return e&&e.Math==Math&&e},H=F(typeof globalThis=="object"&&globalThis)||F(typeof window=="object"&&window)||F(typeof self=="object"&&self)||F(typeof a=="object"&&a)||function(){return this}()||a||Function("return this")(),G=m,z=Function.prototype,ne=z.apply,J=z.call,oe=typeof Reflect=="object"&&Reflect.apply||(G?J.bind(ne):function(){return J.apply(ne,arguments)}),se=O,ae=se({}.toString),ye=se("".slice),Q=function(e){return ye(ae(e),8,-1)},te=Q,re=O,le=function(e){if(te(e)==="Function")return re(e)},ve=typeof document=="object"&&document.all,fe={all:ve,IS_HTMLDDA:ve===void 0&&ve!==void 0},de=fe.all,lt=fe.IS_HTMLDDA?function(e){return typeof e=="function"||e===de}:function(e){return typeof e=="function"},ft={},Xe=!d(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),Le=m,Ke=Function.prototype.call,nt=Le?Ke.bind(Ke):function(){return Ke.apply(Ke,arguments)},Ee={},Ye={}.propertyIsEnumerable,yt=Object.getOwnPropertyDescriptor,at=yt&&!Ye.call({1:2},1);Ee.f=at?function(e){var n=yt(this,e);return!!n&&n.enumerable}:Ye;var Fe,et,_t=function(e,n){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:n}},Dt=d,Ht=Q,Wt=Object,Fn=O("".split),xn=Dt(function(){return!Wt("z").propertyIsEnumerable(0)})?function(e){return Ht(e)=="String"?Fn(e,""):Wt(e)}:Wt,hn=function(e){return e==null},gr=hn,Ar=TypeError,bt=function(e){if(gr(e))throw Ar("Can't call method on "+e);return e},bn=xn,wn=bt,we=function(e){return bn(wn(e))},De=lt,We=fe.all,mt=fe.IS_HTMLDDA?function(e){return typeof e=="object"?e!==null:De(e)||e===We}:function(e){return typeof e=="object"?e!==null:De(e)},gt={},ht=gt,Mt=H,jn=lt,On=function(e){return jn(e)?e:void 0},nn=function(e,n){return arguments.length<2?On(ht[e])||On(Mt[e]):ht[e]&&ht[e][n]||Mt[e]&&Mt[e][n]},_r=typeof navigator<"u"&&String(navigator.userAgent)||"",Ra=H,_o=_r,ns=Ra.process,Lt=Ra.Deno,fn=ns&&ns.versions||Lt&&Lt.version,rs=fn&&fn.v8;rs&&(et=(Fe=rs.split("."))[0]>0&&Fe[0]<4?1:+(Fe[0]+Fe[1])),!et&&_o&&(!(Fe=_o.match(/Edge\/(\d+)/))||Fe[1]>=74)&&(Fe=_o.match(/Chrome\/(\d+)/))&&(et=+Fe[1]);var or=et,$i=or,Mc=d,$a=H.String,_s=!!Object.getOwnPropertySymbols&&!Mc(function(){var e=Symbol();return!$a(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&$i&&$i<41}),qa=_s&&!Symbol.sham&&typeof Symbol.iterator=="symbol",Ui=nn,Po=lt,Ys=N,Ya=Object,Uc=qa?function(e){return typeof e=="symbol"}:function(e){var n=Ui("Symbol");return Po(n)&&Ys(n.prototype,Ya(e))},lu=String,Xa=function(e){try{return lu(e)}catch{return"Object"}},Vc=lt,vs=Xa,Ci=TypeError,ro=function(e){if(Vc(e))return e;throw Ci(vs(e)+" is not a function")},Ca=ro,uu=hn,Ja=function(e,n){var i=e[n];return uu(i)?void 0:Ca(i)},Xs=nt,Js=lt,sd=mt,Hm=TypeError,du={exports:{}},Nh=H,No=Object.defineProperty,hu=function(e,n){try{No(Nh,e,{value:n,configurable:!0,writable:!0})}catch{Nh[e]=n}return n},Qs="__core-js_shared__",ad=H[Qs]||hu(Qs,{}),cd=ad;(du.exports=function(e,n){return cd[e]||(cd[e]=n!==void 0?n:{})})("versions",[]).push({version:"3.31.1",mode:"pure",copyright:" 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.31.1/LICENSE",source:"https://github.com/zloirock/core-js"});var Ia=du.exports,ld=bt,fu=Object,Es=function(e){return fu(ld(e))},ud=Es,Ur=O({}.hasOwnProperty),ui=Object.hasOwn||function(e,n){return Ur(ud(e),n)},Qa=O,Fc=0,Zs=Math.random(),kh=Qa(1 .toString),dd=function(e){return"Symbol("+(e===void 0?"":e)+")_"+kh(++Fc+Zs,36)},_l=Ia,is=ui,tp=dd,Wo=_s,Dh=qa,jc=H.Symbol,hd=_l("wks"),fd=Dh?jc.for||jc:jc&&jc.withoutSetter||tp,sr=function(e){return is(hd,e)||(hd[e]=Wo&&is(jc,e)?jc[e]:fd("Symbol."+e)),hd[e]},vl=nt,El=mt,pu=Uc,Aa=Ja,ys=function(e,n){var i,s;if(Js(i=e.toString)&&!sd(s=Xs(i,e))||Js(i=e.valueOf)&&!sd(s=Xs(i,e)))return s;throw Hm("Can't convert object to primitive value")},mu=TypeError,Bc=sr("toPrimitive"),yl=function(e,n){if(!El(e)||pu(e))return e;var i,s=Aa(e,Bc);if(s){if(i=vl(s,e,n),!El(i)||pu(i))return i;throw mu("Can't convert object to primitive value")}return ys(e)},Wr=Uc,Oa=function(e){var n=yl(e,"string");return Wr(n)?n:n+""},Jn=mt,Za=H.document,np=Jn(Za)&&Jn(Za.createElement),Sl=function(e){return np?Za.createElement(e):{}},pd=Sl,Lh=!Xe&&!d(function(){return Object.defineProperty(pd("div"),"a",{get:function(){return 7}}).a!=7}),rp=Xe,xh=nt,Ss=Ee,qi=_t,Ts=we,bs=Oa,Tl=ui,ws=Lh,Rs=Object.getOwnPropertyDescriptor;ft.f=rp?Rs:function(e,n){if(e=Ts(e),n=bs(n),ws)try{return Rs(e,n)}catch{}if(Tl(e,n))return qi(!xh(Ss.f,e,n),e[n])};var ip=d,ec=lt,io=/#|\.prototype\./,gu=function(e,n){var i=Wc[Mh(e)];return i==op||i!=bl&&(ec(n)?ip(n):!!n)},Mh=gu.normalize=function(e){return String(e).replace(io,".").toLowerCase()},Wc=gu.data={},bl=gu.NATIVE="N",op=gu.POLYFILL="P",ea=gu,ta=ro,Gc=m,_e=le(le.bind),Ce=function(e,n){return ta(e),n===void 0?e:Gc?_e(e,n):function(){return e.apply(n,arguments)}},Ge={},Bt=Xe&&d(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),Wn=mt,hr=String,Vr=TypeError,Qt=function(e){if(Wn(e))return e;throw Vr(hr(e)+" is not an object")},Or=Xe,di=Lh,vo=Bt,Cs=Qt,Is=Oa,_u=TypeError,Vi=Object.defineProperty,zc=Object.getOwnPropertyDescriptor,md="enumerable",tc="configurable",Km="writable";Ge.f=Or?vo?function(e,n,i){if(Cs(e),n=Is(n),Cs(i),typeof e=="function"&&n==="prototype"&&"value"in i&&Km in i&&!i[Km]){var s=zc(e,n);s&&s[Km]&&(e[n]=i.value,i={configurable:tc in i?i[tc]:s[tc],enumerable:md in i?i[md]:s[md],writable:!1})}return Vi(e,n,i)}:Vi:function(e,n,i){if(Cs(e),n=Is(n),Cs(i),di)try{return Vi(e,n,i)}catch{}if("get"in i||"set"in i)throw _u("Accessors not supported");return"value"in i&&(e[n]=i.value),e};var sp=Ge,vu=_t,As=Xe?function(e,n,i){return sp.f(e,n,vu(1,i))}:function(e,n,i){return e[n]=i,e},wl=H,ap=oe,$m=le,hv=lt,cp=ft.f,lp=ea,Eu=gt,yu=Ce,Su=As,qm=ui,fv=function(e){var n=function(i,s,c){if(this instanceof n){switch(arguments.length){case 0:return new e;case 1:return new e(i);case 2:return new e(i,s)}return new e(i,s,c)}return ap(e,this,arguments)};return n.prototype=e.prototype,n},Pn=function(e,n){var i,s,c,u,h,p,_,E,S,w=e.target,I=e.global,P=e.stat,B=e.proto,M=I?wl:P?wl[w]:(wl[w]||{}).prototype,U=I?Eu:Eu[w]||Su(Eu,w,{})[w],$=U.prototype;for(u in n)s=!(i=lp(I?u:w+(P?".":"#")+u,e.forced))&&M&&qm(M,u),p=U[u],s&&(_=e.dontCallGetSet?(S=cp(M,u))&&S.value:M[u]),h=s&&_?_:n[u],s&&typeof p==typeof h||(E=e.bind&&s?yu(h,wl):e.wrap&&s?fv(h):B&&hv(h)?$m(h):h,(e.sham||h&&h.sham||p&&p.sham)&&Su(E,"sham",!0),Su(U,u,E),B&&(qm(Eu,c=w+"Prototype")||Su(Eu,c,{}),Su(Eu[c],u,h),e.real&&$&&(i||!$[u])&&Su($,u,h)))},up=Math.ceil,Os=Math.floor,pv=Math.trunc||function(e){var n=+e;return(n>0?Os:up)(n)},mv=pv,nc=function(e){var n=+e;return n!=n||n===0?0:mv(n)},C=nc,j=Math.max,X=Math.min,he=function(e,n){var i=C(e);return i<0?j(i+n,0):X(i,n)},Me=nc,qe=Math.min,At=function(e){return e>0?qe(Me(e),9007199254740991):0},Gr=At,ti=function(e){return Gr(e.length)},fr=we,ko=he,oo=ti,Pa=function(e){return function(n,i,s){var c,u=fr(n),h=oo(u),p=ko(s,h);if(e&&i!=i){for(;h>p;)if((c=u[p++])!=c)return!0}else for(;h>p;p++)if((e||p in u)&&u[p]===i)return e||p||0;return!e&&-1}},Ps={includes:Pa(!0),indexOf:Pa(!1)},Uh=Ps.includes;Pn({target:"Array",proto:!0,forced:d(function(){return!Array(1).includes()})},{includes:function(e){return Uh(this,e,arguments.length>1?arguments[1]:void 0)}});var dp=gt,Na=function(e){return dp[e+"Prototype"]},gR=Na("Array").includes,_R=mt,hp=Q,lk=sr("match"),vR=function(e){var n;return _R(e)&&((n=e[lk])!==void 0?!!n:hp(e)=="RegExp")},uk=vR,ER=TypeError,xS={};xS[sr("toStringTag")]="z";var Vh=String(xS)==="[object z]",Ym=Vh,dk=lt,Fh=Q,hk=sr("toStringTag"),yR=Object,MS=Fh(function(){return arguments}())=="Arguments",rc=Ym?Fh:function(e){var n,i,s;return e===void 0?"Undefined":e===null?"Null":typeof(i=function(c,u){try{return c[u]}catch{}}(n=yR(e),hk))=="string"?i:MS?Fh(n):(s=Fh(n))=="Object"&&dk(n.callee)?"Arguments":s},SR=rc,TR=String,na=function(e){if(SR(e)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return TR(e)},fk=sr("match"),pk=Pn,mk=function(e){if(uk(e))throw ER("The method doesn't accept regular expressions");return e},gk=bt,bR=na,Hc=function(e){var n=/./;try{"/./"[e](n)}catch{try{return n[fk]=!1,"/./"[e](n)}catch{}}return!1},Xm=O("".indexOf);pk({target:"String",proto:!0,forced:!Hc("includes")},{includes:function(e){return!!~Xm(bR(gk(this)),bR(mk(e)),arguments.length>1?arguments[1]:void 0)}});var wR=Na("String").includes,US=N,RR=gR,CR=wR,Jm=Array.prototype,VS=String.prototype,_k=function(e){var n=e.includes;return e===Jm||US(Jm,e)&&n===Jm.includes?RR:typeof e=="string"||e===VS||US(VS,e)&&n===VS.includes?CR:n},$e=l(_k),FS=ro,Qm=Es,jS=xn,IR=ti,gv=TypeError,fp=function(e){return function(n,i,s,c){FS(i);var u=Qm(n),h=jS(u),p=IR(u),_=e?p-1:0,E=e?-1:1;if(s<2)for(;;){if(_ in h){c=h[_],_+=E;break}if(_+=E,e?_<0:p<=_)throw gv("Reduce of empty array with no initial value")}for(;e?_>=0:p>_;_+=E)_ in h&&(c=i(c,h[_],_,u));return c}},BS={left:fp(!1)},AR=d,jh=function(e,n){var i=[][e];return!!i&&AR(function(){i.call(null,n||function(){return 1},1)})},Bh=typeof process<"u"&&Q(process)=="process",OR=BS.left;Pn({target:"Array",proto:!0,forced:!Bh&&or>79&&or<83||!jh("reduce")},{reduce:function(e){var n=arguments.length;return OR(this,e,n,n>1?arguments[1]:void 0)}});var PR=Na("Array").reduce,NR=N,kR=PR,_v=Array.prototype,gd=function(e){var n=e.reduce;return e===_v||NR(_v,e)&&n===_v.reduce?kR:n},vv=gd,ka=l(vv),vk=Q,Zm=Array.isArray||function(e){return vk(e)=="Array"},eg=Pn,Ek=Zm,DR=O([].reverse),WS=[1,2];eg({target:"Array",proto:!0,forced:String(WS)===String(WS.reverse())},{reverse:function(){return Ek(this)&&(this.length=this.length),DR(this)}});var vi=Na("Array").reverse,GS=N,Ev=vi,Wh=Array.prototype,LR=function(e){var n=e.reverse;return e===Wh||GS(Wh,e)&&n===Wh.reverse?Ev:n},yv=LR,pp=l(yv),Sv=dd,Gh=Ia("keys"),tg=function(e){return Gh[e]||(Gh[e]=Sv(e))},yk=!d(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),Sk=ui,xR=lt,Tv=Es,bv=yk,wv=tg("IE_PROTO"),ng=Object,zS=ng.prototype,rg=bv?ng.getPrototypeOf:function(e){var n=Tv(e);if(Sk(n,wv))return n[wv];var i=n.constructor;return xR(i)&&n instanceof i?i.prototype:n instanceof ng?zS:null},Tk=O,MR=ro,bk=lt,wk=String,HS=TypeError,_d=function(e,n,i){try{return Tk(MR(Object.getOwnPropertyDescriptor(e,n)[i]))}catch{}},UR=Qt,mp=function(e){if(typeof e=="object"||bk(e))return e;throw HS("Can't set "+wk(e)+" as a prototype")},Rl=Object.setPrototypeOf||("__proto__"in{}?function(){var e,n=!1,i={};try{(e=_d(Object.prototype,"__proto__","set"))(i,[]),n=i instanceof Array}catch{}return function(s,c){return UR(s),mp(c),n?e(s,c):s.__proto__=c,s}}():void 0),vd={},ic={},ig=ui,Rk=we,Ck=Ps.indexOf,zh=ic,gp=O([].push),Hh=function(e,n){var i,s=Rk(e),c=0,u=[];for(i in s)!ig(zh,i)&&ig(s,i)&&gp(u,i);for(;n.length>c;)ig(s,i=n[c++])&&(~Ck(u,i)||gp(u,i));return u},_p=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],KS=Hh,vp=_p.concat("length","prototype");vd.f=Object.getOwnPropertyNames||function(e){return KS(e,vp)};var oc={};oc.f=Object.getOwnPropertySymbols;var Ei=nn,hi=vd,Ed=oc,os=Qt,ra=O([].concat),Kh=Ei("Reflect","ownKeys")||function(e){var n=hi.f(os(e)),i=Ed.f;return i?ra(n,i(e)):n},$h=ui,ia=Kh,Rv=ft,VR=Ge,Cv={},Iv=Hh,FR=_p,sc=Object.keys||function(e){return Iv(e,FR)},Av=Xe,$S=Bt,jR=Ge,Ik=Qt,yd=we,Ep=sc;Cv.f=Av&&!$S?Object.defineProperties:function(e,n){Ik(e);for(var i,s=yd(n),c=Ep(n),u=c.length,h=0;u>h;)jR.f(e,i=c[h++],s[i]);return e};var Tu,og=nn("document","documentElement"),Ov=Qt,ac=Cv,Da=_p,qh=ic,bu=og,wu=Sl,Ru="prototype",Pv="script",Nv=tg("IE_PROTO"),sg=function(){},oa=function(e){return"<"+Pv+">"+e+"</"+Pv+">"},sa=function(e){e.write(oa("")),e.close();var n=e.parentWindow.Object;return e=null,n},ni=function(){try{Tu=new ActiveXObject("htmlfile")}catch{}var e,n,i;ni=typeof document<"u"?document.domain&&Tu?sa(Tu):(n=wu("iframe"),i="java"+Pv+":",n.style.display="none",bu.appendChild(n),n.src=String(i),(e=n.contentWindow.document).open(),e.write(oa("document.F=Object")),e.close(),e.F):sa(Tu);for(var s=Da.length;s--;)delete ni[Ru][Da[s]];return ni()};qh[Nv]=!0;var Ns=Object.create||function(e,n){var i;return e!==null?(sg[Ru]=Ov(e),i=new sg,sg[Ru]=null,i[Nv]=e):i=ni(),n===void 0?i:ac.f(i,n)},BR=mt,WR=As,kv=Error,qS=O("".replace),GR=String(kv("zxcasd").stack),ag=/\n\s*at [^:]*:[^\n]*/,zR=ag.test(GR),yp=_t,YS=!d(function(){var e=Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",yp(1,7)),e.stack!==7)}),Ak=As,Kc=function(e,n){if(zR&&typeof e=="string"&&!kv.prepareStackTrace)for(;n--;)e=qS(e,ag,"");return e},Dv=YS,cg=Error.captureStackTrace,cc={},XS=cc,JS=sr("iterator"),QS=Array.prototype,Lv=function(e){return e!==void 0&&(XS.Array===e||QS[JS]===e)},Sp=rc,La=Ja,Yh=hn,ZS=cc,HR=sr("iterator"),lc=function(e){if(!Yh(e))return La(e,HR)||La(e,"@@iterator")||ZS[Sp(e)]},Sd=nt,eT=ro,KR=Qt,Cu=Xa,Td=lc,xv=TypeError,Mv=function(e,n){var i=arguments.length<2?Td(e):n;if(eT(i))return KR(Sd(i,e));throw xv(Cu(e)+" is not iterable")},Uv=nt,tT=Qt,$R=Ja,Vv=function(e,n,i){var s,c;tT(e);try{if(!(s=$R(e,"return"))){if(n==="throw")throw i;return i}s=Uv(s,e)}catch(u){c=!0,s=u}if(n==="throw")throw i;if(c)throw s;return tT(s),i},Fv=Ce,qR=nt,YR=Qt,XR=Xa,nT=Lv,lg=ti,ug=N,JR=Mv,QR=lc,Xh=Vv,ZR=TypeError,bd=function(e,n){this.stopped=e,this.result=n},$c=bd.prototype,Iu=function(e,n,i){var s,c,u,h,p,_,E,S=i&&i.that,w=!(!i||!i.AS_ENTRIES),I=!(!i||!i.IS_RECORD),P=!(!i||!i.IS_ITERATOR),B=!(!i||!i.INTERRUPTED),M=Fv(n,S),U=function(q){return s&&Xh(s,"normal",q),new bd(!0,q)},$=function(q){return w?(YR(q),B?M(q[0],q[1],U):M(q[0],q[1])):B?M(q,U):M(q)};if(I)s=e.iterator;else if(P)s=e;else{if(!(c=QR(e)))throw ZR(XR(e)+" is not iterable");if(nT(c)){for(u=0,h=lg(e);h>u;u++)if((p=$(e[u]))&&ug($c,p))return p;return new bd(!1)}s=JR(e,c)}for(_=I?e.next:s.next;!(E=qR(_,s)).done;){try{p=$(E.value)}catch(q){Xh(s,"throw",q)}if(typeof p=="object"&&p&&ug($c,p))return p}return new bd(!1)},dg=na,Jh=Pn,rT=N,Tp=rg,hg=Rl,iT=function(e,n,i){for(var s=ia(n),c=VR.f,u=Rv.f,h=0;h<s.length;h++){var p=s[h];$h(e,p)||i&&$h(i,p)||c(e,p,u(n,p))}},Ti=Ns,bp=As,fg=_t,oT=function(e,n){BR(n)&&"cause"in n&&WR(e,"cause",n.cause)},jv=function(e,n,i,s){Dv&&(cg?cg(e,n):Ak(e,"stack",Kc(i,s)))},sT=Iu,Qh=function(e,n){return e===void 0?arguments.length<2?"":n:dg(e)},Ii=sr("toStringTag"),Fi=Error,Do=[].push,Au=function(e,n){var i,s=rT(Zh,this);hg?i=hg(Fi(),s?Tp(this):Zh):(i=s?this:Ti(Zh),bp(i,Ii,"Error")),n!==void 0&&bp(i,"message",Qh(n)),jv(i,Au,i.stack,1),arguments.length>2&&oT(i,arguments[2]);var c=[];return sT(e,Do,{that:c}),bp(i,"errors",c),i};hg?hg(Au,Fi):iT(Au,Fi,{name:!0});var Zh=Au.prototype=Ti(Fi.prototype,{constructor:fg(1,Au),message:fg(1,""),name:fg(1,"AggregateError")});Jh({global:!0},{AggregateError:Au});var wd,pg,Eo,aT=lt,Bv=H.WeakMap,cT=aT(Bv)&&/native code/.test(String(Bv)),qc=H,uc=mt,mg=As,gg=ui,_g=ad,eC=tg,tC=ic,lT="Object already initialized",Wv=qc.TypeError,nC=qc.WeakMap;if(cT||_g.state){var Yc=_g.state||(_g.state=new nC);Yc.get=Yc.get,Yc.has=Yc.has,Yc.set=Yc.set,wd=function(e,n){if(Yc.has(e))throw Wv(lT);return n.facade=e,Yc.set(e,n),n},pg=function(e){return Yc.get(e)||{}},Eo=function(e){return Yc.has(e)}}else{var ef=eC("state");tC[ef]=!0,wd=function(e,n){if(gg(e,ef))throw Wv(lT);return n.facade=e,mg(e,ef,n),n},pg=function(e){return gg(e,ef)?e[ef]:{}},Eo=function(e){return gg(e,ef)}}var Rd,wp,uT,Cl={set:wd,get:pg,has:Eo,enforce:function(e){return Eo(e)?pg(e):wd(e,{})},getterFor:function(e){return function(n){var i;if(!uc(n)||(i=pg(n)).type!==e)throw Wv("Incompatible receiver, "+e+" required");return i}}},Rp=Xe,rC=ui,Gv=Function.prototype,iC=Rp&&Object.getOwnPropertyDescriptor,dT=rC(Gv,"name"),hT={PROPER:dT&&(function(){}).name==="something",CONFIGURABLE:dT&&(!Rp||Rp&&iC(Gv,"name").configurable)},oC=As,Il=function(e,n,i,s){return s&&s.enumerable?e[n]=i:oC(e,n,i),e},sC=d,aC=lt,cC=mt,Ok=Ns,fT=rg,Pk=Il,pT=sr("iterator"),mT=!1;[].keys&&("next"in(uT=[].keys())?(wp=fT(fT(uT)))!==Object.prototype&&(Rd=wp):mT=!0);var lC=!cC(Rd)||sC(function(){var e={};return Rd[pT].call(e)!==e});aC((Rd=lC?{}:Ok(Rd))[pT])||Pk(Rd,pT,function(){return this});var gT={IteratorPrototype:Rd,BUGGY_SAFARI_ITERATORS:mT},zv=rc,Nk=Vh?{}.toString:function(){return"[object "+zv(this)+"]"},kk=Vh,Dk=Ge.f,Cp=As,_T=ui,vT=Nk,uC=sr("toStringTag"),Ou=function(e,n,i,s){if(e){var c=i?e:e.prototype;_T(c,uC)||Dk(c,uC,{configurable:!0,value:n}),s&&!kk&&Cp(c,"toString",vT)}},dC=gT.IteratorPrototype,hC=Ns,fC=_t,pC=Ou,Lk=cc,aa=function(){return this},Go=function(e,n,i,s){var c=n+" Iterator";return e.prototype=hC(dC,{next:fC(+!s,i)}),pC(e,c,!1,!0),Lk[c]=aa,e},mC=Pn,gC=nt,_C=hT,vC=Go,EC=rg,ET=Ou,yT=Il,Hv=cc,yC=gT,SC=_C.PROPER,Ip=yC.BUGGY_SAFARI_ITERATORS,vg=sr("iterator"),ST="keys",Ap="values",Eg="entries",xk=function(){return this},TT=function(e,n,i,s,c,u,h){vC(i,n,s);var p,_,E,S=function($){if($===c&&M)return M;if(!Ip&&$ in P)return P[$];switch($){case ST:case Ap:case Eg:return function(){return new i(this,$)}}return function(){return new i(this)}},w=n+" Iterator",I=!1,P=e.prototype,B=P[vg]||P["@@iterator"]||c&&P[c],M=!Ip&&B||S(c),U=n=="Array"&&P.entries||B;if(U&&(p=EC(U.call(new e)))!==Object.prototype&&p.next&&(ET(p,w,!0,!0),Hv[w]=xk),SC&&c==Ap&&B&&B.name!==Ap&&(I=!0,M=function(){return gC(B,this)}),c)if(_={values:S(Ap),keys:u?M:S(ST),entries:S(Eg)},h)for(E in _)(Ip||I||!(E in P))&&yT(P,E,_[E]);else mC({target:n,proto:!0,forced:Ip||I},_);return h&&P[vg]!==M&&yT(P,vg,M,{}),Hv[n]=M,_},yg=function(e,n){return{value:e,done:n}},TC=we,Sg=cc,Al=Cl;Ge.f;var Mk=TT,bT=yg,Kv="Array Iterator",bC=Al.set,wC=Al.getterFor(Kv);Mk(Array,"Array",function(e,n){bC(this,{type:Kv,target:TC(e),index:0,kind:n})},function(){var e=wC(this),n=e.target,i=e.kind,s=e.index++;return!n||s>=n.length?(e.target=void 0,bT(void 0,!0)):bT(i=="keys"?s:i=="values"?n[s]:[s,n[s]],!1)},"values"),Sg.Arguments=Sg.Array;var Tg=Ge,yo=function(e,n,i){return Tg.f(e,n,i)},Uk=nn,Vk=yo,$v=Xe,zo=sr("species"),Fk=N,$t=TypeError,Cd=function(e,n){if(Fk(n,e))return e;throw $t("Incorrect invocation")},wT=lt,qv=ad,jk=O(Function.toString);wT(qv.inspectSource)||(qv.inspectSource=function(e){return jk(e)});var Op=qv.inspectSource,Yv=O,RT=d,CT=lt,RC=rc,CC=Op,Xv=function(){},IT=[],Lo=nn("Reflect","construct"),xa=/^\s*(?:class|function)\b/,Id=Yv(xa.exec),IC=!xa.exec(Xv),Pp=function(e){if(!CT(e))return!1;try{return Lo(Xv,IT,e),!0}catch{return!1}},dc=function(e){if(!CT(e))return!1;switch(RC(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return IC||!!Id(xa,CC(e))}catch{return!0}};dc.sham=!0;var Np,ks,AC,Jv,bg=!Lo||RT(function(){var e;return Pp(Pp.call)||!Pp(Object)||!Pp(function(){e=!0})||e})?dc:Pp,OC=bg,PC=Xa,Bk=TypeError,wg=Qt,AT=function(e){if(OC(e))return e;throw Bk(PC(e)+" is not a constructor")},hc=hn,vr=sr("species"),so=function(e,n){var i,s=wg(e).constructor;return s===void 0||hc(i=wg(s)[vr])?n:AT(i)},Ai=O([].slice),Ho=TypeError,xo=function(e,n){if(e<n)throw Ho("Not enough arguments");return e},tf=/(?:ipad|iphone|ipod).*applewebkit/i.test(_r),Pr=H,Rg=oe,nf=Ce,Cg=lt,OT=ui,kp=d,Ds=og,PT=Ai,rf=Sl,Pu=xo,Qv=tf,NT=Bh,Ol=Pr.setImmediate,Dp=Pr.clearImmediate,Ad=Pr.process,Lp=Pr.Dispatch,Ig=Pr.Function,Zv=Pr.MessageChannel,eE=Pr.String,xp=0,So={},Nu="onreadystatechange";kp(function(){Np=Pr.location});var Ma=function(e){if(OT(So,e)){var n=So[e];delete So[e],n()}},ss=function(e){return function(){Ma(e)}},kT=function(e){Ma(e.data)},tE=function(e){Pr.postMessage(eE(e),Np.protocol+"//"+Np.host)};Ol&&Dp||(Ol=function(e){Pu(arguments.length,1);var n=Cg(e)?e:Ig(e),i=PT(arguments,1);return So[++xp]=function(){Rg(n,void 0,i)},ks(xp),xp},Dp=function(e){delete So[e]},NT?ks=function(e){Ad.nextTick(ss(e))}:Lp&&Lp.now?ks=function(e){Lp.now(ss(e))}:Zv&&!Qv?(Jv=(AC=new Zv).port2,AC.port1.onmessage=kT,ks=nf(Jv.postMessage,Jv)):Pr.addEventListener&&Cg(Pr.postMessage)&&!Pr.importScripts&&Np&&Np.protocol!=="file:"&&!kp(tE)?(ks=tE,Pr.addEventListener("message",kT,!1)):ks=Nu in rf("script")?function(e){Ds.appendChild(rf("script"))[Nu]=function(){Ds.removeChild(this),Ma(e)}}:function(e){setTimeout(ss(e),0)});var Mp={set:Ol,clear:Dp},NC=function(){this.head=null,this.tail=null};NC.prototype={add:function(e){var n={item:e,next:null},i=this.tail;i?i.next=n:this.head=n,this.tail=n},get:function(){var e=this.head;if(e)return(this.head=e.next)===null&&(this.tail=null),e.item}};var Ua,nE,Ag,ku,rE,Od=NC,kC=/ipad|iphone|ipod/i.test(_r)&&typeof Pebble<"u",DC=/web0s(?!.*chrome)/i.test(_r),Du=H,Og=Ce,Wk=ft.f,DT=Mp.set,LC=Od,xC=tf,of=kC,Gk=DC,Pd=Bh,LT=Du.MutationObserver||Du.WebKitMutationObserver,Oi=Du.document,MC=Du.process,Pg=Du.Promise,UC=Wk(Du,"queueMicrotask"),xT=UC&&UC.value;if(!xT){var Ng=new LC,kg=function(){var e,n;for(Pd&&(e=MC.domain)&&e.exit();n=Ng.get();)try{n()}catch(i){throw Ng.head&&Ua(),i}e&&e.enter()};xC||Pd||Gk||!LT||!Oi?!of&&Pg&&Pg.resolve?((ku=Pg.resolve(void 0)).constructor=Pg,rE=Og(ku.then,ku),Ua=function(){rE(kg)}):Pd?Ua=function(){MC.nextTick(kg)}:(DT=Og(DT,Du),Ua=function(){DT(kg)}):(nE=!0,Ag=Oi.createTextNode(""),new LT(kg).observe(Ag,{characterData:!0}),Ua=function(){Ag.data=nE=!nE}),xT=function(e){Ng.head||Ua(),Ng.add(e)}}var VC=xT,Ko=function(e){try{return{error:!1,value:e()}}catch(n){return{error:!0,value:n}}},Lu=H.Promise,FC=typeof Deno=="object"&&Deno&&typeof Deno.version=="object",Nd=!FC&&!Bh&&typeof window=="object"&&typeof document=="object",iE=H,Xc=Lu,oE=lt,MT=ea,UT=Op,zk=sr,VT=Nd,Hk=FC,sE=or,FT=Xc&&Xc.prototype,aE=zk("species"),Dg=oE(iE.PromiseRejectionEvent),jC=MT("Promise",function(){var e=UT(Xc),n=e!==String(Xc);if(!n&&sE===66||!FT.catch||!FT.finally)return!0;if(!sE||sE<51||!/native code/.test(e)){var i=new Xc(function(c){c(1)}),s=function(c){c(function(){},function(){})};if((i.constructor={})[aE]=s,!(i.then(function(){})instanceof s))return!0}return!n&&(VT||Hk)&&!Dg}),sf={CONSTRUCTOR:jC,REJECTION_EVENT:Dg},Pl={},jT=ro,BT=TypeError,cE=function(e){var n,i;this.promise=new e(function(s,c){if(n!==void 0||i!==void 0)throw BT("Bad Promise constructor");n=s,i=c}),this.resolve=jT(n),this.reject=jT(i)};Pl.f=function(e){return new cE(e)};var Lg,xg,BC=Pn,lE=Bh,Jc=H,Mg=nt,Ug=Il,Kk=Ou,uE=function(e){var n=Uk(e);$v&&n&&!n[zo]&&Vk(n,zo,{configurable:!0,get:function(){return this}})},f=ro,g=lt,T=mt,A=Cd,x=so,W=Mp.set,ie=VC,Se=function(e,n){try{arguments.length==1?console.error(e):console.error(e,n)}catch{}},Ae=Ko,ze=Od,Et=Cl,St=Lu,vt=sf,Ft=Pl,Kt="Promise",Yt=vt.CONSTRUCTOR,Yi=vt.REJECTION_EVENT,Ue=Et.getterFor(Kt),Oe=Et.set,Be=St&&St.prototype,wt=St,Jt=Be,ln=Jc.TypeError,rn=Jc.document,Rn=Jc.process,ao=Ft.f,wr=ao,kd=!!(rn&&rn.createEvent&&Jc.dispatchEvent),WC="unhandledrejection",_j=function(e){var n;return!(!T(e)||!g(n=e.then))&&n},vj=function(e,n){var i,s,c,u=n.value,h=n.state==1,p=h?e.ok:e.fail,_=e.resolve,E=e.reject,S=e.domain;try{p?(h||(n.rejection===2&&Zre(n),n.rejection=1),p===!0?i=u:(S&&S.enter(),i=p(u),S&&(S.exit(),c=!0)),i===e.promise?E(ln("Promise-chain cycle")):(s=_j(i))?Mg(s,i,_,E):_(i)):E(u)}catch(w){S&&!c&&S.exit(),E(w)}},Ej=function(e,n){e.notified||(e.notified=!0,ie(function(){for(var i,s=e.reactions;i=s.get();)vj(i,e);e.notified=!1,n&&!e.rejection&&Qre(e)}))},yj=function(e,n,i){var s,c;kd?((s=rn.createEvent("Event")).promise=n,s.reason=i,s.initEvent(e,!1,!0),Jc.dispatchEvent(s)):s={promise:n,reason:i},!Yi&&(c=Jc["on"+e])?c(s):e===WC&&Se("Unhandled promise rejection",i)},Qre=function(e){Mg(W,Jc,function(){var n,i=e.facade,s=e.value;if(Sj(e)&&(n=Ae(function(){lE?Rn.emit("unhandledRejection",s,i):yj(WC,i,s)}),e.rejection=lE||Sj(e)?2:1,n.error))throw n.value})},Sj=function(e){return e.rejection!==1&&!e.parent},Zre=function(e){Mg(W,Jc,function(){var n=e.facade;lE?Rn.emit("rejectionHandled",n):yj("rejectionhandled",n,e.value)})},dE=function(e,n,i){return function(s){e(n,s,i)}},hE=function(e,n,i){e.done||(e.done=!0,i&&(e=i),e.value=n,e.state=2,Ej(e,!0))},$k=function(e,n,i){if(!e.done){e.done=!0,i&&(e=i);try{if(e.facade===n)throw ln("Promise can't be resolved itself");var s=_j(n);s?ie(function(){var c={done:!1};try{Mg(s,n,dE($k,c,e),dE(hE,c,e))}catch(u){hE(c,u,e)}}):(e.value=n,e.state=1,Ej(e,!1))}catch(c){hE({done:!1},c,e)}}};Yt&&(Jt=(wt=function(e){A(this,Jt),f(e),Mg(Lg,this);var n=Ue(this);try{e(dE($k,n),dE(hE,n))}catch(i){hE(n,i)}}).prototype,(Lg=function(e){Oe(this,{type:Kt,done:!1,notified:!1,parent:!1,reactions:new ze,rejection:!1,state:0,value:void 0})}).prototype=Ug(Jt,"then",function(e,n){var i=Ue(this),s=ao(x(this,wt));return i.parent=!0,s.ok=!g(e)||e,s.fail=g(n)&&n,s.domain=lE?Rn.domain:void 0,i.state==0?i.reactions.add(s):ie(function(){vj(s,i)}),s.promise}),xg=function(){var e=new Lg,n=Ue(e);this.promise=e,this.resolve=dE($k,n),this.reject=dE(hE,n)},Ft.f=ao=function(e){return e===wt||e===void 0?new xg(e):wr(e)}),BC({global:!0,wrap:!0,forced:Yt},{Promise:wt}),Kk(wt,Kt,!1,!0),uE(Kt);var Tj=sr("iterator"),bj=!1;try{var eie=0,wj={next:function(){return{done:!!eie++}},return:function(){bj=!0}};wj[Tj]=function(){return this},Array.from(wj,function(){throw 2})}catch{}var tie=Lu,nie=function(e,n){if(!bj)return!1;var i=!1;try{var s={};s[Tj]=function(){return{next:function(){return{done:i=!0}}}},e(s)}catch{}return i},GC=sf.CONSTRUCTOR||!nie(function(e){tie.all(e).then(void 0,function(){})}),rie=nt,iie=ro,oie=Pl,sie=Ko,aie=Iu;Pn({target:"Promise",stat:!0,forced:GC},{all:function(e){var n=this,i=oie.f(n),s=i.resolve,c=i.reject,u=sie(function(){var h=iie(n.resolve),p=[],_=0,E=1;aie(e,function(S){var w=_++,I=!1;E++,rie(h,n,S).then(function(P){I||(I=!0,p[w]=P,--E||s(p))},c)}),--E||s(p)});return u.error&&c(u.value),i.promise}});var cie=Pn,lie=sf.CONSTRUCTOR;Lu&&Lu.prototype,cie({target:"Promise",proto:!0,forced:lie,real:!0},{catch:function(e){return this.then(void 0,e)}});var uie=nt,die=ro,hie=Pl,fie=Ko,pie=Iu;Pn({target:"Promise",stat:!0,forced:GC},{race:function(e){var n=this,i=hie.f(n),s=i.reject,c=fie(function(){var u=die(n.resolve);pie(e,function(h){uie(u,n,h).then(i.resolve,s)})});return c.error&&s(c.value),i.promise}});var mie=nt,gie=Pl;Pn({target:"Promise",stat:!0,forced:sf.CONSTRUCTOR},{reject:function(e){var n=gie.f(this);return mie(n.reject,void 0,e),n.promise}});var _ie=Qt,vie=mt,Eie=Pl,Rj=function(e,n){if(_ie(e),vie(n)&&n.constructor===e)return n;var i=Eie.f(e);return(0,i.resolve)(n),i.promise},yie=Pn,Sie=Lu,Tie=sf.CONSTRUCTOR,bie=Rj,wie=nn("Promise"),Rie=!Tie;yie({target:"Promise",stat:!0,forced:!0},{resolve:function(e){return bie(Rie&&this===wie?Sie:this,e)}});var Cie=nt,Iie=ro,Aie=Pl,Oie=Ko,Pie=Iu;Pn({target:"Promise",stat:!0,forced:GC},{allSettled:function(e){var n=this,i=Aie.f(n),s=i.resolve,c=i.reject,u=Oie(function(){var h=Iie(n.resolve),p=[],_=0,E=1;Pie(e,function(S){var w=_++,I=!1;E++,Cie(h,n,S).then(function(P){I||(I=!0,p[w]={status:"fulfilled",value:P},--E||s(p))},function(P){I||(I=!0,p[w]={status:"rejected",reason:P},--E||s(p))})}),--E||s(p)});return u.error&&c(u.value),i.promise}});var Nie=nt,kie=ro,Die=nn,Lie=Pl,xie=Ko,Mie=Iu,Cj="No one promise resolved";Pn({target:"Promise",stat:!0,forced:GC},{any:function(e){var n=this,i=Die("AggregateError"),s=Lie.f(n),c=s.resolve,u=s.reject,h=xie(function(){var p=kie(n.resolve),_=[],E=0,S=1,w=!1;Mie(e,function(I){var P=E++,B=!1;S++,Nie(p,n,I).then(function(M){B||w||(w=!0,c(M))},function(M){B||w||(B=!0,_[P]=M,--S||u(new i(_,Cj)))})}),--S||u(new i(_,Cj))});return h.error&&u(h.value),s.promise}});var Uie=Pn,qk=Lu,Vie=d,Fie=nn,jie=lt,Bie=so,Ij=Rj,Wie=qk&&qk.prototype;Uie({target:"Promise",proto:!0,real:!0,forced:!!qk&&Vie(function(){Wie.finally.call({then:function(){}},function(){})})},{finally:function(e){var n=Bie(this,Fie("Promise")),i=jie(e);return this.then(i?function(s){return Ij(n,e()).then(function(){return s})}:e,i?function(s){return Ij(n,e()).then(function(){throw s})}:e)}});var Yk=O,Gie=nc,zie=na,Hie=bt,Kie=Yk("".charAt),Aj=Yk("".charCodeAt),$ie=Yk("".slice),Oj=function(e){return function(n,i){var s,c,u=zie(Hie(n)),h=Gie(i),p=u.length;return h<0||h>=p?e?"":void 0:(s=Aj(u,h))<55296||s>56319||h+1===p||(c=Aj(u,h+1))<56320||c>57343?e?Kie(u,h):s:e?$ie(u,h,h+2):c-56320+(s-55296<<10)+65536}},Xk={codeAt:Oj(!1),charAt:Oj(!0)},qie=Xk.charAt,Yie=na,Pj=Cl,Xie=TT,Nj=yg,kj="String Iterator",Jie=Pj.set,Qie=Pj.getterFor(kj);Xie(String,"String",function(e){Jie(this,{type:kj,string:Yie(e),index:0})},function(){var e,n=Qie(this),i=n.string,s=n.index;return s>=i.length?Nj(void 0,!0):(e=qie(i,s),n.index+=e.length,Nj(e,!1))});var Zie=gt.Promise,eoe={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},toe=H,noe=rc,roe=As,Dj=cc,Lj=sr("toStringTag");for(var Jk in eoe){var xj=toe[Jk],Qk=xj&&xj.prototype;Qk&&noe(Qk)!==Lj&&roe(Qk,Lj,Jk),Dj[Jk]=Dj.Array}var Mj=Zie,Qe=l(Mj),ioe=Na("Array").values,ooe=rc,soe=ui,aoe=N,coe=ioe,Zk=Array.prototype,loe={DOMTokenList:!0,NodeList:!0},uoe=function(e){var n=e.values;return e===Zk||aoe(Zk,e)&&n===Zk.values||soe(loe,ooe(e))?coe:n},fc=l(uoe),doe=d,hoe=sr("iterator"),eD=!doe(function(){var e=new URL("b?a=1&b=2&c=3","http://a"),n=e.searchParams,i=new URLSearchParams("a=1&a=2"),s="";return e.pathname="c%20d",n.forEach(function(c,u){n.delete("b"),s+=u+c}),i.delete("a",2),!e.toJSON||!i.has("a",1)||i.has("a",2)||!n.size&&!0||!n.sort||e.href!=="http://a/c%20d?a=1&c=3"||n.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!n[hoe]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("http://").host!=="xn--e1aybc"||new URL("http://a#").hash!=="#%D0%B1"||s!=="a1c3"||new URL("http://x",void 0).host!=="x"}),foe=Il,poe=Oa,moe=Ge,goe=_t,zC=function(e,n,i){var s=poe(n);s in e?moe.f(e,s,goe(0,i)):e[s]=i},Uj=he,_oe=ti,voe=zC,Eoe=Array,yoe=Math.max,tD=function(e,n,i){for(var s=_oe(e),c=Uj(n,s),u=Uj(i===void 0?s:i,s),h=Eoe(yoe(u-c,0)),p=0;c<u;c++,p++)voe(h,p,e[c]);return h.length=p,h},Vj=tD,Soe=Math.floor,nD=function(e,n){var i=e.length,s=Soe(i/2);return i<8?Toe(e,n):boe(e,nD(Vj(e,0,s),n),nD(Vj(e,s),n),n)},Toe=function(e,n){for(var i,s,c=e.length,u=1;u<c;){for(s=u,i=e[u];s&&n(e[s-1],i)>0;)e[s]=e[--s];s!==u++&&(e[s]=i)}return e},boe=function(e,n,i,s){for(var c=n.length,u=i.length,h=0,p=0;h<c||p<u;)e[h+p]=h<c&&p<u?s(n[h],i[p])<=0?n[h++]:i[p++]:h<c?n[h++]:i[p++];return e},Fj=nD,rD=Pn,fE=H,HC=nt,Dd=O,pE=Xe,jj=eD,Bj=Il,woe=yo,Roe=function(e,n,i){for(var s in n)i&&i.unsafe&&e[s]?e[s]=n[s]:foe(e,s,n[s],i);return e},Coe=Ou,Ioe=Go,iD=Cl,Wj=Cd,oD=lt,Aoe=ui,Ooe=Ce,Poe=rc,Noe=Qt,Gj=mt,Va=na,koe=Ns,zj=_t,sD=Mv,Doe=lc,mE=xo,Loe=Fj,xoe=sr("iterator"),WT="URLSearchParams",Hj=WT+"Iterator",Kj=iD.set,Nl=iD.getterFor(WT),Moe=iD.getterFor(Hj),Uoe=Object.getOwnPropertyDescriptor,aD=function(e){if(!pE)return fE[e];var n=Uoe(fE,e);return n&&n.value},$j=aD("fetch"),KC=aD("Request"),GT=aD("Headers"),cD=KC&&KC.prototype,qj=GT&&GT.prototype,Voe=fE.RegExp,Foe=fE.TypeError,Yj=fE.decodeURIComponent,joe=fE.encodeURIComponent,Boe=Dd("".charAt),Xj=Dd([].join),Vg=Dd([].push),lD=Dd("".replace),Woe=Dd([].shift),Jj=Dd([].splice),Qj=Dd("".split),Goe=Dd("".slice),zoe=/\+/g,Zj=Array(4),Hoe=function(e){return Zj[e-1]||(Zj[e-1]=Voe("((?:%[\\da-f]{2}){"+e+"})","gi"))},Koe=function(e){try{return Yj(e)}catch{return e}},eB=function(e){var n=lD(e,zoe," "),i=4;try{return Yj(n)}catch{for(;i;)n=lD(n,Hoe(i--),Koe);return n}},$oe=/[!'()~]|%20/g,qoe={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},Yoe=function(e){return qoe[e]},tB=function(e){return lD(joe(e),$oe,Yoe)},uD=Ioe(function(e,n){Kj(this,{type:Hj,iterator:sD(Nl(e).entries),kind:n})},"Iterator",function(){var e=Moe(this),n=e.kind,i=e.iterator.next(),s=i.value;return i.done||(i.value=n==="keys"?s.key:n==="values"?s.value:[s.key,s.value]),i},!0),nB=function(e){this.entries=[],this.url=null,e!==void 0&&(Gj(e)?this.parseObject(e):this.parseQuery(typeof e=="string"?Boe(e,0)==="?"?Goe(e,1):e:Va(e)))};nB.prototype={type:WT,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var n,i,s,c,u,h,p,_=Doe(e);if(_)for(i=(n=sD(e,_)).next;!(s=HC(i,n)).done;){if(u=(c=sD(Noe(s.value))).next,(h=HC(u,c)).done||(p=HC(u,c)).done||!HC(u,c).done)throw Foe("Expected sequence with length 2");Vg(this.entries,{key:Va(h.value),value:Va(p.value)})}else for(var E in e)Aoe(e,E)&&Vg(this.entries,{key:E,value:Va(e[E])})},parseQuery:function(e){if(e)for(var n,i,s=Qj(e,"&"),c=0;c<s.length;)(n=s[c++]).length&&(i=Qj(n,"="),Vg(this.entries,{key:eB(Woe(i)),value:eB(Xj(i,"="))}))},serialize:function(){for(var e,n=this.entries,i=[],s=0;s<n.length;)e=n[s++],Vg(i,tB(e.key)+"="+tB(e.value));return Xj(i,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var $C=function(){Wj(this,gE);var e=Kj(this,new nB(arguments.length>0?arguments[0]:void 0));pE||(this.size=e.entries.length)},gE=$C.prototype;if(Roe(gE,{append:function(e,n){var i=Nl(this);mE(arguments.length,2),Vg(i.entries,{key:Va(e),value:Va(n)}),pE||this.length++,i.updateURL()},delete:function(e){for(var n=Nl(this),i=mE(arguments.length,1),s=n.entries,c=Va(e),u=i<2?void 0:arguments[1],h=u===void 0?u:Va(u),p=0;p<s.length;){var _=s[p];if(_.key!==c||h!==void 0&&_.value!==h)p++;else if(Jj(s,p,1),h!==void 0)break}pE||(this.size=s.length),n.updateURL()},get:function(e){var n=Nl(this).entries;mE(arguments.length,1);for(var i=Va(e),s=0;s<n.length;s++)if(n[s].key===i)return n[s].value;return null},getAll:function(e){var n=Nl(this).entries;mE(arguments.length,1);for(var i=Va(e),s=[],c=0;c<n.length;c++)n[c].key===i&&Vg(s,n[c].value);return s},has:function(e){for(var n=Nl(this).entries,i=mE(arguments.length,1),s=Va(e),c=i<2?void 0:arguments[1],u=c===void 0?c:Va(c),h=0;h<n.length;){var p=n[h++];if(p.key===s&&(u===void 0||p.value===u))return!0}return!1},set:function(e,n){var i=Nl(this);mE(arguments.length,1);for(var s,c=i.entries,u=!1,h=Va(e),p=Va(n),_=0;_<c.length;_++)(s=c[_]).key===h&&(u?Jj(c,_--,1):(u=!0,s.value=p));u||Vg(c,{key:h,value:p}),pE||(this.size=c.length),i.updateURL()},sort:function(){var e=Nl(this);Loe(e.entries,function(n,i){return n.key>i.key?1:-1}),e.updateURL()},forEach:function(e){for(var n,i=Nl(this).entries,s=Ooe(e,arguments.length>1?arguments[1]:void 0),c=0;c<i.length;)s((n=i[c++]).value,n.key,this)},keys:function(){return new uD(this,"keys")},values:function(){return new uD(this,"values")},entries:function(){return new uD(this,"entries")}},{enumerable:!0}),Bj(gE,xoe,gE.entries,{}),Bj(gE,"toString",function(){return Nl(this).serialize()},{enumerable:!0}),pE&&woe(gE,"size",{get:function(){return Nl(this).entries.length},configurable:!0,enumerable:!0}),Coe($C,WT),rD({global:!0,forced:!jj},{URLSearchParams:$C}),!jj&&oD(GT)){var Xoe=Dd(qj.has),Joe=Dd(qj.set),rB=function(e){if(Gj(e)){var n,i=e.body;if(Poe(i)===WT)return n=e.headers?new GT(e.headers):new GT,Xoe(n,"content-type")||Joe(n,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),koe(e,{body:zj(0,Va(i)),headers:zj(0,n)})}return e};if(oD($j)&&rD({global:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return $j(e,arguments.length>1?rB(arguments[1]):{})}}),oD(KC)){var dD=function(e){return Wj(this,cD),new KC(e,arguments.length>1?rB(arguments[1]):{})};cD.constructor=dD,dD.prototype=cD,rD({global:!0,dontCallGetSet:!0,forced:!0},{Request:dD})}}var kl,Qoe={URLSearchParams:$C,getState:Nl},Zoe=gt.URLSearchParams,iB=Xe,ese=O,tse=nt,nse=d,hD=sc,rse=oc,ise=Ee,ose=Es,sse=xn,_E=Object.assign,oB=Object.defineProperty,ase=ese([].concat),cse=!_E||nse(function(){if(iB&&_E({b:1},_E(oB({},"a",{enumerable:!0,get:function(){oB(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var e={},n={},i=Symbol(),s="abcdefghijklmnopqrst";return e[i]=7,s.split("").forEach(function(c){n[c]=c}),_E({},e)[i]!=7||hD(_E({},n)).join("")!=s})?function(e,n){for(var i=ose(e),s=arguments.length,c=1,u=rse.f,h=ise.f;s>c;)for(var p,_=sse(arguments[c++]),E=u?ase(hD(_),u(_)):hD(_),S=E.length,w=0;S>w;)p=E[w++],iB&&!tse(h,_,p)||(i[p]=_[p]);return i}:_E,lse=Qt,use=Vv,dse=Ce,hse=nt,fse=Es,pse=function(e,n,i,s){try{return s?n(lse(i)[0],i[1]):n(i)}catch(c){use(e,"throw",c)}},mse=Lv,gse=bg,_se=ti,sB=zC,vse=Mv,Ese=lc,aB=Array,Fg=O,fD=2147483647,yse=/[^\0-\u007E]/,cB=/[.\u3002\uFF0E\uFF61]/g,lB="Overflow: input needs wider integers to process",uB=RangeError,Sse=Fg(cB.exec),vE=Math.floor,pD=String.fromCharCode,dB=Fg("".charCodeAt),hB=Fg([].join),Up=Fg([].push),Tse=Fg("".replace),bse=Fg("".split),wse=Fg("".toLowerCase),fB=function(e){return e+22+75*(e<26)},Rse=function(e,n,i){var s=0;for(e=i?vE(e/700):e>>1,e+=vE(e/n);e>455;)e=vE(e/35),s+=36;return vE(s+36*e/(e+38))},Cse=function(e){var n=[];e=function($){for(var q=[],ce=0,me=$.length;ce<me;){var ge=dB($,ce++);if(ge>=55296&&ge<=56319&&ce<me){var pe=dB($,ce++);(64512&pe)==56320?Up(q,((1023&ge)<<10)+(1023&pe)+65536):(Up(q,ge),ce--)}else Up(q,ge)}return q}(e);var i,s,c=e.length,u=128,h=0,p=72;for(i=0;i<e.length;i++)(s=e[i])<128&&Up(n,pD(s));var _=n.length,E=_;for(_&&Up(n,"-");E<c;){var S=fD;for(i=0;i<e.length;i++)(s=e[i])>=u&&s<S&&(S=s);var w=E+1;if(S-u>vE((fD-h)/w))throw uB(lB);for(h+=(S-u)*w,u=S,i=0;i<e.length;i++){if((s=e[i])<u&&++h>fD)throw uB(lB);if(s==u){for(var I=h,P=36;;){var B=P<=p?1:P>=p+26?26:P-p;if(I<B)break;var M=I-B,U=36-B;Up(n,pD(fB(B+M%U))),I=vE(M/U),P+=36}Up(n,pD(fB(I))),p=Rse(h,w,E==_),h=0,E++}}h++,u++}return hB(n,"")},Ise=Pn,mD=Xe,Ase=eD,gD=H,pB=Ce,Dl=O,qC=Il,Ll=yo,Ose=Cd,_D=ui,vD=cse,EE=function(e){var n=fse(e),i=gse(this),s=arguments.length,c=s>1?arguments[1]:void 0,u=c!==void 0;u&&(c=dse(c,s>2?arguments[2]:void 0));var h,p,_,E,S,w,I=Ese(n),P=0;if(!I||this===aB&&mse(I))for(h=_se(n),p=i?new this(h):aB(h);h>P;P++)w=u?c(n[P],P):n[P],sB(p,P,w);else for(S=(E=vse(n,I)).next,p=i?new this:[];!(_=hse(S,E)).done;P++)w=u?pse(E,c,[_.value,P],!0):_.value,sB(p,P,w);return p.length=P,p},xu=tD,Pse=Xk.codeAt,Nse=function(e){var n,i,s=[],c=bse(Tse(wse(e),cB,"."),".");for(n=0;n<c.length;n++)i=c[n],Up(s,Sse(yse,i)?"xn--"+Cse(i):i);return hB(s,".")},af=na,kse=Ou,Dse=xo,mB=Qoe,gB=Cl,Lse=gB.set,YC=gB.getterFor("URL"),xse=mB.URLSearchParams,Mse=mB.getState,zT=gD.URL,ED=gD.TypeError,XC=gD.parseInt,Use=Math.floor,_B=Math.pow,xl=Dl("".charAt),Mu=Dl(/./.exec),HT=Dl([].join),Vse=Dl(1 .toString),Fse=Dl([].pop),yE=Dl([].push),yD=Dl("".replace),jse=Dl([].shift),Bse=Dl("".split),KT=Dl("".slice),JC=Dl("".toLowerCase),Wse=Dl([].unshift),SD="Invalid scheme",jg="Invalid host",vB="Invalid port",EB=/[a-z]/i,Gse=/[\d+-.a-z]/i,TD=/\d/,zse=/^0x/i,Hse=/^[0-7]+$/,Kse=/^\d+$/,yB=/^[\da-f]+$/i,$se=/[\0\t\n\r #%/:<>?@[\\\]^|]/,qse=/[\0\t\n\r #/:<>?@[\\\]^|]/,Yse=/^[\u0000-\u0020]+/,Xse=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,Jse=/[\t\n\r]/g,$T=function(e){var n,i,s,c;if(typeof e=="number"){for(n=[],i=0;i<4;i++)Wse(n,e%256),e=Use(e/256);return HT(n,".")}if(typeof e=="object"){for(n="",s=function(u){for(var h=null,p=1,_=null,E=0,S=0;S<8;S++)u[S]!==0?(E>p&&(h=_,p=E),_=null,E=0):(_===null&&(_=S),++E);return E>p&&(h=_,p=E),h}(e),i=0;i<8;i++)c&&e[i]===0||(c&&(c=!1),s===i?(n+=i?":":"::",c=!0):(n+=Vse(e[i],16),i<7&&(n+=":")));return"["+n+"]"}return e},QC={},SB=vD({},QC,{" ":1,'"':1,"<":1,">":1,"`":1}),TB=vD({},SB,{"#":1,"?":1,"{":1,"}":1}),bD=vD({},TB,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),Vp=function(e,n){var i=Pse(e,0);return i>32&&i<127&&!_D(n,e)?e:encodeURIComponent(e)},ZC={ftp:21,file:null,http:80,https:443,ws:80,wss:443},qT=function(e,n){var i;return e.length==2&&Mu(EB,xl(e,0))&&((i=xl(e,1))==":"||!n&&i=="|")},bB=function(e){var n;return e.length>1&&qT(KT(e,0,2))&&(e.length==2||(n=xl(e,2))==="/"||n==="\\"||n==="?"||n==="#")},Qse=function(e){return e==="."||JC(e)==="%2e"},wD={},wB={},RD={},RB={},CB={},CD={},IB={},AB={},eI={},tI={},ID={},AD={},OD={},PD={},OB={},ND={},SE={},Ld={},PB={},Bg={},cf={},kD=function(e,n,i){var s,c,u,h=af(e);if(n){if(c=this.parse(h))throw ED(c);this.searchParams=null}else{if(i!==void 0&&(s=new kD(i,!0)),c=this.parse(h,null,s))throw ED(c);(u=Mse(new xse)).bindURL(this),this.searchParams=u}};kD.prototype={type:"URL",parse:function(e,n,i){var s,c,u,h,p,_=this,E=n||wD,S=0,w="",I=!1,P=!1,B=!1;for(e=af(e),n||(_.scheme="",_.username="",_.password="",_.host=null,_.port=null,_.path=[],_.query=null,_.fragment=null,_.cannotBeABaseURL=!1,e=yD(e,Yse,""),e=yD(e,Xse,"$1")),e=yD(e,Jse,""),s=EE(e);S<=s.length;){switch(c=s[S],E){case wD:if(!c||!Mu(EB,c)){if(n)return SD;E=RD;continue}w+=JC(c),E=wB;break;case wB:if(c&&(Mu(Gse,c)||c=="+"||c=="-"||c=="."))w+=JC(c);else{if(c!=":"){if(n)return SD;w="",E=RD,S=0;continue}if(n&&(_.isSpecial()!=_D(ZC,w)||w=="file"&&(_.includesCredentials()||_.port!==null)||_.scheme=="file"&&!_.host))return;if(_.scheme=w,n)return void(_.isSpecial()&&ZC[_.scheme]==_.port&&(_.port=null));w="",_.scheme=="file"?E=PD:_.isSpecial()&&i&&i.scheme==_.scheme?E=RB:_.isSpecial()?E=AB:s[S+1]=="/"?(E=CB,S++):(_.cannotBeABaseURL=!0,yE(_.path,""),E=PB)}break;case RD:if(!i||i.cannotBeABaseURL&&c!="#")return SD;if(i.cannotBeABaseURL&&c=="#"){_.scheme=i.scheme,_.path=xu(i.path),_.query=i.query,_.fragment="",_.cannotBeABaseURL=!0,E=cf;break}E=i.scheme=="file"?PD:CD;continue;case RB:if(c!="/"||s[S+1]!="/"){E=CD;continue}E=eI,S++;break;case CB:if(c=="/"){E=tI;break}E=Ld;continue;case CD:if(_.scheme=i.scheme,c==kl)_.username=i.username,_.password=i.password,_.host=i.host,_.port=i.port,_.path=xu(i.path),_.query=i.query;else if(c=="/"||c=="\\"&&_.isSpecial())E=IB;else if(c=="?")_.username=i.username,_.password=i.password,_.host=i.host,_.port=i.port,_.path=xu(i.path),_.query="",E=Bg;else{if(c!="#"){_.username=i.username,_.password=i.password,_.host=i.host,_.port=i.port,_.path=xu(i.path),_.path.length--,E=Ld;continue}_.username=i.username,_.password=i.password,_.host=i.host,_.port=i.port,_.path=xu(i.path),_.query=i.query,_.fragment="",E=cf}break;case IB:if(!_.isSpecial()||c!="/"&&c!="\\"){if(c!="/"){_.username=i.username,_.password=i.password,_.host=i.host,_.port=i.port,E=Ld;continue}E=tI}else E=eI;break;case AB:if(E=eI,c!="/"||xl(w,S+1)!="/")continue;S++;break;case eI:if(c!="/"&&c!="\\"){E=tI;continue}break;case tI:if(c=="@"){I&&(w="%40"+w),I=!0,u=EE(w);for(var M=0;M<u.length;M++){var U=u[M];if(U!=":"||B){var $=Vp(U,bD);B?_.password+=$:_.username+=$}else B=!0}w=""}else if(c==kl||c=="/"||c=="?"||c=="#"||c=="\\"&&_.isSpecial()){if(I&&w=="")return"Invalid authority";S-=EE(w).length+1,w="",E=ID}else w+=c;break;case ID:case AD:if(n&&_.scheme=="file"){E=ND;continue}if(c!=":"||P){if(c==kl||c=="/"||c=="?"||c=="#"||c=="\\"&&_.isSpecial()){if(_.isSpecial()&&w=="")return jg;if(n&&w==""&&(_.includesCredentials()||_.port!==null))return;if(h=_.parseHost(w))return h;if(w="",E=SE,n)return;continue}c=="["?P=!0:c=="]"&&(P=!1),w+=c}else{if(w=="")return jg;if(h=_.parseHost(w))return h;if(w="",E=OD,n==AD)return}break;case OD:if(!Mu(TD,c)){if(c==kl||c=="/"||c=="?"||c=="#"||c=="\\"&&_.isSpecial()||n){if(w!=""){var q=XC(w,10);if(q>65535)return vB;_.port=_.isSpecial()&&q===ZC[_.scheme]?null:q,w=""}if(n)return;E=SE;continue}return vB}w+=c;break;case PD:if(_.scheme="file",c=="/"||c=="\\")E=OB;else{if(!i||i.scheme!="file"){E=Ld;continue}if(c==kl)_.host=i.host,_.path=xu(i.path),_.query=i.query;else if(c=="?")_.host=i.host,_.path=xu(i.path),_.query="",E=Bg;else{if(c!="#"){bB(HT(xu(s,S),""))||(_.host=i.host,_.path=xu(i.path),_.shortenPath()),E=Ld;continue}_.host=i.host,_.path=xu(i.path),_.query=i.query,_.fragment="",E=cf}}break;case OB:if(c=="/"||c=="\\"){E=ND;break}i&&i.scheme=="file"&&!bB(HT(xu(s,S),""))&&(qT(i.path[0],!0)?yE(_.path,i.path[0]):_.host=i.host),E=Ld;continue;case ND:if(c==kl||c=="/"||c=="\\"||c=="?"||c=="#"){if(!n&&qT(w))E=Ld;else if(w==""){if(_.host="",n)return;E=SE}else{if(h=_.parseHost(w))return h;if(_.host=="localhost"&&(_.host=""),n)return;w="",E=SE}continue}w+=c;break;case SE:if(_.isSpecial()){if(E=Ld,c!="/"&&c!="\\")continue}else if(n||c!="?")if(n||c!="#"){if(c!=kl&&(E=Ld,c!="/"))continue}else _.fragment="",E=cf;else _.query="",E=Bg;break;case Ld:if(c==kl||c=="/"||c=="\\"&&_.isSpecial()||!n&&(c=="?"||c=="#")){if((p=JC(p=w))===".."||p==="%2e."||p===".%2e"||p==="%2e%2e"?(_.shortenPath(),c=="/"||c=="\\"&&_.isSpecial()||yE(_.path,"")):Qse(w)?c=="/"||c=="\\"&&_.isSpecial()||yE(_.path,""):(_.scheme=="file"&&!_.path.length&&qT(w)&&(_.host&&(_.host=""),w=xl(w,0)+":"),yE(_.path,w)),w="",_.scheme=="file"&&(c==kl||c=="?"||c=="#"))for(;_.path.length>1&&_.path[0]==="";)jse(_.path);c=="?"?(_.query="",E=Bg):c=="#"&&(_.fragment="",E=cf)}else w+=Vp(c,TB);break;case PB:c=="?"?(_.query="",E=Bg):c=="#"?(_.fragment="",E=cf):c!=kl&&(_.path[0]+=Vp(c,QC));break;case Bg:n||c!="#"?c!=kl&&(c=="'"&&_.isSpecial()?_.query+="%27":_.query+=c=="#"?"%23":Vp(c,QC)):(_.fragment="",E=cf);break;case cf:c!=kl&&(_.fragment+=Vp(c,SB))}S++}},parseHost:function(e){var n,i,s;if(xl(e,0)=="["){if(xl(e,e.length-1)!="]"||(n=function(c){var u,h,p,_,E,S,w,I=[0,0,0,0,0,0,0,0],P=0,B=null,M=0,U=function(){return xl(c,M)};if(U()==":"){if(xl(c,1)!=":")return;M+=2,B=++P}for(;U();){if(P==8)return;if(U()!=":"){for(u=h=0;h<4&&Mu(yB,U());)u=16*u+XC(U(),16),M++,h++;if(U()=="."){if(h==0||(M-=h,P>6))return;for(p=0;U();){if(_=null,p>0){if(!(U()=="."&&p<4))return;M++}if(!Mu(TD,U()))return;for(;Mu(TD,U());){if(E=XC(U(),10),_===null)_=E;else{if(_==0)return;_=10*_+E}if(_>255)return;M++}I[P]=256*I[P]+_,++p!=2&&p!=4||P++}if(p!=4)return;break}if(U()==":"){if(M++,!U())return}else if(U())return;I[P++]=u}else{if(B!==null)return;M++,B=++P}}if(B!==null)for(S=P-B,P=7;P!=0&&S>0;)w=I[P],I[P--]=I[B+S-1],I[B+--S]=w;else if(P!=8)return;return I}(KT(e,1,-1)),!n))return jg;this.host=n}else if(this.isSpecial()){if(e=Nse(e),Mu($se,e)||(n=function(c){var u,h,p,_,E,S,w,I=Bse(c,".");if(I.length&&I[I.length-1]==""&&I.length--,(u=I.length)>4)return c;for(h=[],p=0;p<u;p++){if((_=I[p])=="")return c;if(E=10,_.length>1&&xl(_,0)=="0"&&(E=Mu(zse,_)?16:8,_=KT(_,E==8?1:2)),_==="")S=0;else{if(!Mu(E==10?Kse:E==8?Hse:yB,_))return c;S=XC(_,E)}yE(h,S)}for(p=0;p<u;p++)if(S=h[p],p==u-1){if(S>=_B(256,5-u))return null}else if(S>255)return null;for(w=Fse(h),p=0;p<h.length;p++)w+=h[p]*_B(256,3-p);return w}(e),n===null))return jg;this.host=n}else{if(Mu(qse,e))return jg;for(n="",i=EE(e),s=0;s<i.length;s++)n+=Vp(i[s],QC);this.host=n}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme=="file"},includesCredentials:function(){return this.username!=""||this.password!=""},isSpecial:function(){return _D(ZC,this.scheme)},shortenPath:function(){var e=this.path,n=e.length;!n||this.scheme=="file"&&n==1&&qT(e[0],!0)||e.length--},serialize:function(){var e=this,n=e.scheme,i=e.username,s=e.password,c=e.host,u=e.port,h=e.path,p=e.query,_=e.fragment,E=n+":";return c!==null?(E+="//",e.includesCredentials()&&(E+=i+(s?":"+s:"")+"@"),E+=$T(c),u!==null&&(E+=":"+u)):n=="file"&&(E+="//"),E+=e.cannotBeABaseURL?h[0]:h.length?"/"+HT(h,"/"):"",p!==null&&(E+="?"+p),_!==null&&(E+="#"+_),E},setHref:function(e){var n=this.parse(e);if(n)throw ED(n);this.searchParams.update()},getOrigin:function(){var e=this.scheme,n=this.port;if(e=="blob")try{return new TE(e.path[0]).origin}catch{return"null"}return e!="file"&&this.isSpecial()?e+"://"+$T(this.host)+(n!==null?":"+n:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(af(e)+":",wD)},getUsername:function(){return this.username},setUsername:function(e){var n=EE(af(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var i=0;i<n.length;i++)this.username+=Vp(n[i],bD)}},getPassword:function(){return this.password},setPassword:function(e){var n=EE(af(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var i=0;i<n.length;i++)this.password+=Vp(n[i],bD)}},getHost:function(){var e=this.host,n=this.port;return e===null?"":n===null?$T(e):$T(e)+":"+n},setHost:function(e){this.cannotBeABaseURL||this.parse(e,ID)},getHostname:function(){var e=this.host;return e===null?"":$T(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,AD)},getPort:function(){var e=this.port;return e===null?"":af(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||((e=af(e))==""?this.port=null:this.parse(e,OD))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+HT(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,SE))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){(e=af(e))==""?this.query=null:(xl(e,0)=="?"&&(e=KT(e,1)),this.query="",this.parse(e,Bg)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){(e=af(e))!=""?(xl(e,0)=="#"&&(e=KT(e,1)),this.fragment="",this.parse(e,cf)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var TE=function(e){var n=Ose(this,Fa),i=Dse(arguments.length,1)>1?arguments[1]:void 0,s=Lse(n,new kD(e,!1,i));mD||(n.href=s.serialize(),n.origin=s.getOrigin(),n.protocol=s.getProtocol(),n.username=s.getUsername(),n.password=s.getPassword(),n.host=s.getHost(),n.hostname=s.getHostname(),n.port=s.getPort(),n.pathname=s.getPathname(),n.search=s.getSearch(),n.searchParams=s.getSearchParams(),n.hash=s.getHash())},Fa=TE.prototype,Ml=function(e,n){return{get:function(){return YC(this)[e]()},set:n&&function(i){return YC(this)[n](i)},configurable:!0,enumerable:!0}};if(mD&&(Ll(Fa,"href",Ml("serialize","setHref")),Ll(Fa,"origin",Ml("getOrigin")),Ll(Fa,"protocol",Ml("getProtocol","setProtocol")),Ll(Fa,"username",Ml("getUsername","setUsername")),Ll(Fa,"password",Ml("getPassword","setPassword")),Ll(Fa,"host",Ml("getHost","setHost")),Ll(Fa,"hostname",Ml("getHostname","setHostname")),Ll(Fa,"port",Ml("getPort","setPort")),Ll(Fa,"pathname",Ml("getPathname","setPathname")),Ll(Fa,"search",Ml("getSearch","setSearch")),Ll(Fa,"searchParams",Ml("getSearchParams")),Ll(Fa,"hash",Ml("getHash","setHash"))),qC(Fa,"toJSON",function(){return YC(this).serialize()},{enumerable:!0}),qC(Fa,"toString",function(){return YC(this).serialize()},{enumerable:!0}),zT){var NB=zT.createObjectURL,kB=zT.revokeObjectURL;NB&&qC(TE,"createObjectURL",pB(NB,zT)),kB&&qC(TE,"revokeObjectURL",pB(kB,zT))}kse(TE,"URL"),Ise({global:!0,forced:!Ase,sham:!mD},{URL:TE});var Zse=Pn,eae=d,tae=xo,DB=na,nae=eD,LB=nn("URL");Zse({target:"URL",stat:!0,forced:!(nae&&eae(function(){LB.canParse()}))},{canParse:function(e){var n=tae(arguments.length,1),i=DB(e),s=n<2||arguments[1]===void 0?void 0:DB(arguments[1]);try{return!!new LB(i,s)}catch{return!1}}});var nI=l(gt.URL);let xB=!0,MB=!0;function rI(e,n,i){const s=e.match(n);return s&&s.length>=i&&parseInt(s[i],10)}function Wg(e,n,i){if(!e.RTCPeerConnection)return;const s=e.RTCPeerConnection.prototype,c=s.addEventListener;s.addEventListener=function(h,p){if(h!==n)return c.apply(this,arguments);const _=E=>{const S=i(E);S&&(p.handleEvent?p.handleEvent(S):p(S))};return this._eventMap=this._eventMap||{},this._eventMap[n]||(this._eventMap[n]=new Map),this._eventMap[n].set(p,_),c.apply(this,[h,_])};const u=s.removeEventListener;s.removeEventListener=function(h,p){if(h!==n||!this._eventMap||!this._eventMap[n])return u.apply(this,arguments);if(!this._eventMap[n].has(p))return u.apply(this,arguments);const _=this._eventMap[n].get(p);return this._eventMap[n].delete(p),this._eventMap[n].size===0&&delete this._eventMap[n],Object.keys(this._eventMap).length===0&&delete this._eventMap,u.apply(this,[h,_])},Object.defineProperty(s,"on"+n,{get(){return this["_on"+n]},set(h){this["_on"+n]&&(this.removeEventListener(n,this["_on"+n]),delete this["_on"+n]),h&&this.addEventListener(n,this["_on"+n]=h)},enumerable:!0,configurable:!0})}function rae(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(xB=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function iae(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(MB=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function UB(){if(typeof window=="object"){if(xB)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function DD(e,n){MB&&console.warn(e+" is deprecated, please use "+n+" instead.")}function VB(e){return Object.prototype.toString.call(e)==="[object Object]"}function FB(e){var n;return VB(e)?ka(n=Object.keys(e)).call(n,function(i,s){const c=VB(e[s]),u=c?FB(e[s]):e[s],h=c&&!Object.keys(u).length;return u===void 0||h?i:Object.assign(i,{[s]:u})},{}):e}function LD(e,n,i){n&&!i.has(n.id)&&(i.set(n.id,n),Object.keys(n).forEach(s=>{s.endsWith("Id")?LD(e,e.get(n[s]),i):s.endsWith("Ids")&&n[s].forEach(c=>{LD(e,e.get(c),i)})}))}function jB(e,n,i){const s=i?"outbound-rtp":"inbound-rtp",c=new Map;if(n===null)return c;const u=[];return e.forEach(h=>{h.type==="track"&&h.trackIdentifier===n.id&&u.push(h)}),u.forEach(h=>{e.forEach(p=>{p.type===s&&p.trackId===h.id&&LD(e,p,c)})}),c}const BB=UB;function WB(e,n){const i=e&&e.navigator;if(!i.mediaDevices)return;const s=function(h){if(typeof h!="object"||h.mandatory||h.optional)return h;const p={};return Object.keys(h).forEach(_=>{if(_==="require"||_==="advanced"||_==="mediaSource")return;const E=typeof h[_]=="object"?h[_]:{ideal:h[_]};E.exact!==void 0&&typeof E.exact=="number"&&(E.min=E.max=E.exact);const S=function(w,I){return w?w+I.charAt(0).toUpperCase()+I.slice(1):I==="deviceId"?"sourceId":I};if(E.ideal!==void 0){p.optional=p.optional||[];let w={};typeof E.ideal=="number"?(w[S("min",_)]=E.ideal,p.optional.push(w),w={},w[S("max",_)]=E.ideal,p.optional.push(w)):(w[S("",_)]=E.ideal,p.optional.push(w))}E.exact!==void 0&&typeof E.exact!="number"?(p.mandatory=p.mandatory||{},p.mandatory[S("",_)]=E.exact):["min","max"].forEach(w=>{E[w]!==void 0&&(p.mandatory=p.mandatory||{},p.mandatory[S(w,_)]=E[w])})}),h.advanced&&(p.optional=(p.optional||[]).concat(h.advanced)),p},c=function(h,p){if(n.version>=61)return p(h);if((h=JSON.parse(JSON.stringify(h)))&&typeof h.audio=="object"){const _=function(E,S,w){S in E&&!(w in E)&&(E[w]=E[S],delete E[S])};_((h=JSON.parse(JSON.stringify(h))).audio,"autoGainControl","googAutoGainControl"),_(h.audio,"noiseSuppression","googNoiseSuppression"),h.audio=s(h.audio)}if(h&&typeof h.video=="object"){let _=h.video.facingMode;_=_&&(typeof _=="object"?_:{ideal:_});const E=n.version<66;if(_&&(_.exact==="user"||_.exact==="environment"||_.ideal==="user"||_.ideal==="environment")&&(!i.mediaDevices.getSupportedConstraints||!i.mediaDevices.getSupportedConstraints().facingMode||E)){let S;if(delete h.video.facingMode,_.exact==="environment"||_.ideal==="environment"?S=["back","rear"]:_.exact!=="user"&&_.ideal!=="user"||(S=["front"]),S)return i.mediaDevices.enumerateDevices().then(w=>{let I=(w=w.filter(P=>P.kind==="videoinput")).find(P=>S.some(B=>{var M;return $e(M=P.label.toLowerCase()).call(M,B)}));return!I&&w.length&&$e(S).call(S,"back")&&(I=w[w.length-1]),I&&(h.video.deviceId=_.exact?{exact:I.deviceId}:{ideal:I.deviceId}),h.video=s(h.video),BB("chrome: "+JSON.stringify(h)),p(h)})}h.video=s(h.video)}return BB("chrome: "+JSON.stringify(h)),p(h)},u=function(h){return n.version>=64?h:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[h.name]||h.name,message:h.message,constraint:h.constraint||h.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(i.getUserMedia=(function(h,p,_){c(h,E=>{i.webkitGetUserMedia(E,p,S=>{_&&_(u(S))})})}).bind(i),i.mediaDevices.getUserMedia){const h=i.mediaDevices.getUserMedia.bind(i.mediaDevices);i.mediaDevices.getUserMedia=function(p){return c(p,_=>h(_).then(E=>{if(_.audio&&!E.getAudioTracks().length||_.video&&!E.getVideoTracks().length)throw E.getTracks().forEach(S=>{S.stop()}),new DOMException("","NotFoundError");return E},E=>Qe.reject(u(E))))}}}function GB(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function zB(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(i){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=i)},enumerable:!0,configurable:!0});const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=i=>{i.stream.addEventListener("addtrack",s=>{let c;c=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===s.track.id):{track:s.track};const u=new Event("track");u.track=s.track,u.receiver=c,u.transceiver={receiver:c},u.streams=[i.stream],this.dispatchEvent(u)}),i.stream.getTracks().forEach(s=>{let c;c=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===s.id):{track:s};const u=new Event("track");u.track=s,u.receiver=c,u.transceiver={receiver:c},u.streams=[i.stream],this.dispatchEvent(u)})},this.addEventListener("addstream",this._ontrackpoly)),n.apply(this,arguments)}}else Wg(e,"track",n=>(n.transceiver||Object.defineProperty(n,"transceiver",{value:{receiver:n.receiver}}),n))}function HB(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const n=function(c,u){return{track:u,get dtmf(){return this._dtmf===void 0&&(u.kind==="audio"?this._dtmf=c.createDTMFSender(u):this._dtmf=null),this._dtmf},_pc:c}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const c=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(h,p){let _=c.apply(this,arguments);return _||(_=n(this,h),this._senders.push(_)),_};const u=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(h){u.apply(this,arguments);const p=this._senders.indexOf(h);p!==-1&&this._senders.splice(p,1)}}const i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(c){this._senders=this._senders||[],i.apply(this,[c]),c.getTracks().forEach(u=>{this._senders.push(n(this,u))})};const s=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(c){this._senders=this._senders||[],s.apply(this,[c]),c.getTracks().forEach(u=>{const h=this._senders.find(p=>p.track===u);h&&this._senders.splice(this._senders.indexOf(h),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const n=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const i=n.apply(this,[]);return i.forEach(s=>s._pc=this),i},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function KB(e){if(!e.RTCPeerConnection)return;const n=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[i,s,c]=arguments;if(arguments.length>0&&typeof i=="function")return n.apply(this,arguments);if(n.length===0&&(arguments.length===0||typeof i!="function"))return n.apply(this,[]);const u=function(p){const _={};return p.result().forEach(E=>{const S={id:E.id,timestamp:E.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[E.type]||E.type};E.names().forEach(w=>{S[w]=E.stat(w)}),_[S.id]=S}),_},h=function(p){return new Map(Object.keys(p).map(_=>[_,p[_]]))};if(arguments.length>=2){const p=function(_){s(h(u(_)))};return n.apply(this,[p,i])}return new Qe((p,_)=>{n.apply(this,[function(E){p(h(u(E)))},_])}).then(s,c)}}function $B(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const i=e.RTCPeerConnection.prototype.getSenders;i&&(e.RTCPeerConnection.prototype.getSenders=function(){const c=i.apply(this,[]);return c.forEach(u=>u._pc=this),c});const s=e.RTCPeerConnection.prototype.addTrack;s&&(e.RTCPeerConnection.prototype.addTrack=function(){const c=s.apply(this,arguments);return c._pc=this,c}),e.RTCRtpSender.prototype.getStats=function(){const c=this;return this._pc.getStats().then(u=>jB(u,c.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const i=e.RTCPeerConnection.prototype.getReceivers;i&&(e.RTCPeerConnection.prototype.getReceivers=function(){const s=i.apply(this,[]);return s.forEach(c=>c._pc=this),s}),Wg(e,"track",s=>(s.receiver._pc=s.srcElement,s)),e.RTCRtpReceiver.prototype.getStats=function(){const s=this;return this._pc.getStats().then(c=>jB(c,s.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const n=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const i=arguments[0];let s,c,u;return this.getSenders().forEach(h=>{h.track===i&&(s?u=!0:s=h)}),this.getReceivers().forEach(h=>(h.track===i&&(c?u=!0:c=h),h.track===i)),u||s&&c?Qe.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):s?s.getStats():c?c.getStats():Qe.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return n.apply(this,arguments)}}function qB(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(u=>this._shimmedLocalStreams[u][0])};const n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(u,h){if(!h)return n.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const p=n.apply(this,arguments);return this._shimmedLocalStreams[h.id]?this._shimmedLocalStreams[h.id].indexOf(p)===-1&&this._shimmedLocalStreams[h.id].push(p):this._shimmedLocalStreams[h.id]=[h,p],p};const i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(u){this._shimmedLocalStreams=this._shimmedLocalStreams||{},u.getTracks().forEach(_=>{if(this.getSenders().find(S=>S.track===_))throw new DOMException("Track already exists.","InvalidAccessError")});const h=this.getSenders();i.apply(this,arguments);const p=this.getSenders().filter(_=>h.indexOf(_)===-1);this._shimmedLocalStreams[u.id]=[u].concat(p)};const s=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(u){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[u.id],s.apply(this,arguments)};const c=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(u){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},u&&Object.keys(this._shimmedLocalStreams).forEach(h=>{const p=this._shimmedLocalStreams[h].indexOf(u);p!==-1&&this._shimmedLocalStreams[h].splice(p,1),this._shimmedLocalStreams[h].length===1&&delete this._shimmedLocalStreams[h]}),c.apply(this,arguments)}}function YB(e,n){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&n.version>=65)return qB(e);const i=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const _=i.apply(this);return this._reverseStreams=this._reverseStreams||{},_.map(E=>this._reverseStreams[E.id])};const s=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(_){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},_.getTracks().forEach(E=>{if(this.getSenders().find(w=>w.track===E))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[_.id]){const E=new e.MediaStream(_.getTracks());this._streams[_.id]=E,this._reverseStreams[E.id]=_,_=E}s.apply(this,[_])};const c=e.RTCPeerConnection.prototype.removeStream;function u(_,E){let S=E.sdp;return Object.keys(_._reverseStreams||[]).forEach(w=>{const I=_._reverseStreams[w],P=_._streams[I.id];S=S.replace(new RegExp(P.id,"g"),I.id)}),new RTCSessionDescription({type:E.type,sdp:S})}e.RTCPeerConnection.prototype.removeStream=function(_){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},c.apply(this,[this._streams[_.id]||_]),delete this._reverseStreams[this._streams[_.id]?this._streams[_.id].id:_.id],delete this._streams[_.id]},e.RTCPeerConnection.prototype.addTrack=function(_,E){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const S=[].slice.call(arguments,1);if(S.length!==1||!S[0].getTracks().find(P=>P===_))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(P=>P.track===_))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const I=this._streams[E.id];if(I)I.addTrack(_),Qe.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const P=new e.MediaStream([_]);this._streams[E.id]=P,this._reverseStreams[P.id]=E,this.addStream(P)}return this.getSenders().find(P=>P.track===_)},["createOffer","createAnswer"].forEach(function(_){const E=e.RTCPeerConnection.prototype[_],S={[_](){const w=arguments;return arguments.length&&typeof arguments[0]=="function"?E.apply(this,[I=>{const P=u(this,I);w[0].apply(null,[P])},I=>{w[1]&&w[1].apply(null,I)},arguments[2]]):E.apply(this,arguments).then(I=>u(this,I))}};e.RTCPeerConnection.prototype[_]=S[_]});const h=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(_,E){let S=E.sdp;return Object.keys(_._reverseStreams||[]).forEach(w=>{const I=_._reverseStreams[w],P=_._streams[I.id];S=S.replace(new RegExp(I.id,"g"),P.id)}),new RTCSessionDescription({type:E.type,sdp:S})}(this,arguments[0]),h.apply(this,arguments)):h.apply(this,arguments)};const p=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const _=p.get.apply(this);return _.type===""?_:u(this,_)}}),e.RTCPeerConnection.prototype.removeTrack=function(_){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!_._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(_._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let E;this._streams=this._streams||{},Object.keys(this._streams).forEach(S=>{this._streams[S].getTracks().find(w=>_.track===w)&&(E=this._streams[S])}),E&&(E.getTracks().length===1?this.removeStream(this._reverseStreams[E.id]):E.removeTrack(_.track),this.dispatchEvent(new Event("negotiationneeded")))}}function xD(e,n){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&n.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){const s=e.RTCPeerConnection.prototype[i],c={[i](){return arguments[0]=new(i==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};e.RTCPeerConnection.prototype[i]=c[i]})}function XB(e,n){Wg(e,"negotiationneeded",i=>{const s=i.target;if(!(n.version<72||s.getConfiguration&&s.getConfiguration().sdpSemantics==="plan-b")||s.signalingState==="stable")return i})}var JB=Object.freeze({__proto__:null,fixNegotiationNeeded:XB,shimAddTrackRemoveTrack:YB,shimAddTrackRemoveTrackWithNative:qB,shimGetDisplayMedia:function(e,n){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(typeof n=="function"?e.navigator.mediaDevices.getDisplayMedia=function(i){return n(i).then(s=>{const c=i.video&&i.video.width,u=i.video&&i.video.height,h=i.video&&i.video.frameRate;return i.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:s,maxFrameRate:h||3}},c&&(i.video.mandatory.maxWidth=c),u&&(i.video.mandatory.maxHeight=u),e.navigator.mediaDevices.getUserMedia(i)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:HB,shimGetStats:KB,shimGetUserMedia:WB,shimMediaStream:GB,shimOnTrack:zB,shimPeerConnection:xD,shimSenderReceiverGetStats:$B});function QB(e,n){const i=e&&e.navigator,s=e&&e.MediaStreamTrack;if(i.getUserMedia=function(c,u,h){DD("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),i.mediaDevices.getUserMedia(c).then(u,h)},!(n.version>55&&"autoGainControl"in i.mediaDevices.getSupportedConstraints())){const c=function(h,p,_){p in h&&!(_ in h)&&(h[_]=h[p],delete h[p])},u=i.mediaDevices.getUserMedia.bind(i.mediaDevices);if(i.mediaDevices.getUserMedia=function(h){return typeof h=="object"&&typeof h.audio=="object"&&(h=JSON.parse(JSON.stringify(h)),c(h.audio,"autoGainControl","mozAutoGainControl"),c(h.audio,"noiseSuppression","mozNoiseSuppression")),u(h)},s&&s.prototype.getSettings){const h=s.prototype.getSettings;s.prototype.getSettings=function(){const p=h.apply(this,arguments);return c(p,"mozAutoGainControl","autoGainControl"),c(p,"mozNoiseSuppression","noiseSuppression"),p}}if(s&&s.prototype.applyConstraints){const h=s.prototype.applyConstraints;s.prototype.applyConstraints=function(p){return this.kind==="audio"&&typeof p=="object"&&(p=JSON.parse(JSON.stringify(p)),c(p,"autoGainControl","mozAutoGainControl"),c(p,"noiseSuppression","mozNoiseSuppression")),h.apply(this,[p])}}}}function ZB(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function MD(e,n){if(typeof e!="object"||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),n.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(c){const u=e.RTCPeerConnection.prototype[c],h={[c](){return arguments[0]=new(c==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),u.apply(this,arguments)}};e.RTCPeerConnection.prototype[c]=h[c]});const i={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},s=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[c,u,h]=arguments;return s.apply(this,[c||null]).then(p=>{if(n.version<53&&!u)try{p.forEach(_=>{_.type=i[_.type]||_.type})}catch(_){if(_.name!=="TypeError")throw _;p.forEach((E,S)=>{p.set(S,Object.assign({},E,{type:i[E.type]||E.type}))})}return p}).then(u,h)}}function e4(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const n=e.RTCPeerConnection.prototype.getSenders;n&&(e.RTCPeerConnection.prototype.getSenders=function(){const s=n.apply(this,[]);return s.forEach(c=>c._pc=this),s});const i=e.RTCPeerConnection.prototype.addTrack;i&&(e.RTCPeerConnection.prototype.addTrack=function(){const s=i.apply(this,arguments);return s._pc=this,s}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Qe.resolve(new Map)}}function t4(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const n=e.RTCPeerConnection.prototype.getReceivers;n&&(e.RTCPeerConnection.prototype.getReceivers=function(){const i=n.apply(this,[]);return i.forEach(s=>s._pc=this),i}),Wg(e,"track",i=>(i.receiver._pc=i.srcElement,i)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function n4(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(n){DD("removeStream","removeTrack"),this.getSenders().forEach(i=>{var s;i.track&&$e(s=n.getTracks()).call(s,i.track)&&this.removeTrack(i)})})}function r4(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function i4(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const n=e.RTCPeerConnection.prototype.addTransceiver;n&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let i=arguments[1]&&arguments[1].sendEncodings;i===void 0&&(i=[]),i=[...i];const s=i.length>0;s&&i.forEach(u=>{if("rid"in u&&!/^[a-z0-9]{0,16}$/i.test(u.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in u&&!(parseFloat(u.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in u&&!(parseFloat(u.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const c=n.apply(this,arguments);if(s){const{sender:u}=c,h=u.getParameters();(!("encodings"in h)||h.encodings.length===1&&Object.keys(h.encodings[0]).length===0)&&(h.encodings=i,u.sendEncodings=i,this.setParametersPromises.push(u.setParameters(h).then(()=>{delete u.sendEncodings}).catch(()=>{delete u.sendEncodings})))}return c})}function o4(e){if(typeof e!="object"||!e.RTCRtpSender)return;const n=e.RTCRtpSender.prototype.getParameters;n&&(e.RTCRtpSender.prototype.getParameters=function(){const i=n.apply(this,arguments);return"encodings"in i||(i.encodings=[].concat(this.sendEncodings||[{}])),i})}function s4(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const n=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Qe.all(this.setParametersPromises).then(()=>n.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):n.apply(this,arguments)}}function a4(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const n=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Qe.all(this.setParametersPromises).then(()=>n.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):n.apply(this,arguments)}}var c4=Object.freeze({__proto__:null,shimAddTransceiver:i4,shimCreateAnswer:a4,shimCreateOffer:s4,shimGetDisplayMedia:function(e,n){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(i){if(!i||!i.video){const s=new DOMException("getDisplayMedia without video constraints is undefined");return s.name="NotFoundError",s.code=8,Qe.reject(s)}return i.video===!0?i.video={mediaSource:n}:i.video.mediaSource=n,e.navigator.mediaDevices.getUserMedia(i)})},shimGetParameters:o4,shimGetUserMedia:QB,shimOnTrack:ZB,shimPeerConnection:MD,shimRTCDataChannel:r4,shimReceiverGetStats:t4,shimRemoveStream:n4,shimSenderGetStats:e4});function l4(e){if(typeof e=="object"&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(i){var s;this._localStreams||(this._localStreams=[]),$e(s=this._localStreams).call(s,i)||this._localStreams.push(i),i.getAudioTracks().forEach(c=>n.call(this,c,i)),i.getVideoTracks().forEach(c=>n.call(this,c,i))},e.RTCPeerConnection.prototype.addTrack=function(i){for(var s=arguments.length,c=new Array(s>1?s-1:0),u=1;u<s;u++)c[u-1]=arguments[u];return c&&c.forEach(h=>{var p;this._localStreams?$e(p=this._localStreams).call(p,h)||this._localStreams.push(h):this._localStreams=[h]}),n.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(n){this._localStreams||(this._localStreams=[]);const i=this._localStreams.indexOf(n);if(i===-1)return;this._localStreams.splice(i,1);const s=n.getTracks();this.getSenders().forEach(c=>{$e(s).call(s,c.track)&&this.removeTrack(c)})})}}function u4(e){if(typeof e=="object"&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(i){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=i),this.addEventListener("track",this._onaddstreampoly=s=>{s.streams.forEach(c=>{var u;if(this._remoteStreams||(this._remoteStreams=[]),$e(u=this._remoteStreams).call(u,c))return;this._remoteStreams.push(c);const h=new Event("addstream");h.stream=c,this.dispatchEvent(h)})})}});const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const i=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(s){s.streams.forEach(c=>{if(i._remoteStreams||(i._remoteStreams=[]),i._remoteStreams.indexOf(c)>=0)return;i._remoteStreams.push(c);const u=new Event("addstream");u.stream=c,i.dispatchEvent(u)})}),n.apply(i,arguments)}}}function d4(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const n=e.RTCPeerConnection.prototype,i=n.createOffer,s=n.createAnswer,c=n.setLocalDescription,u=n.setRemoteDescription,h=n.addIceCandidate;n.createOffer=function(_,E){const S=arguments.length>=2?arguments[2]:arguments[0],w=i.apply(this,[S]);return E?(w.then(_,E),Qe.resolve()):w},n.createAnswer=function(_,E){const S=arguments.length>=2?arguments[2]:arguments[0],w=s.apply(this,[S]);return E?(w.then(_,E),Qe.resolve()):w};let p=function(_,E,S){const w=c.apply(this,[_]);return S?(w.then(E,S),Qe.resolve()):w};n.setLocalDescription=p,p=function(_,E,S){const w=u.apply(this,[_]);return S?(w.then(E,S),Qe.resolve()):w},n.setRemoteDescription=p,p=function(_,E,S){const w=h.apply(this,[_]);return S?(w.then(E,S),Qe.resolve()):w},n.addIceCandidate=p}function h4(e){const n=e&&e.navigator;if(n.mediaDevices&&n.mediaDevices.getUserMedia){const i=n.mediaDevices,s=i.getUserMedia.bind(i);n.mediaDevices.getUserMedia=c=>s(f4(c))}!n.getUserMedia&&n.mediaDevices&&n.mediaDevices.getUserMedia&&(n.getUserMedia=(function(i,s,c){n.mediaDevices.getUserMedia(i).then(s,c)}).bind(n))}function f4(e){return e&&e.video!==void 0?Object.assign({},e,{video:FB(e.video)}):e}function p4(e){if(!e.RTCPeerConnection)return;const n=e.RTCPeerConnection;e.RTCPeerConnection=function(i,s){if(i&&i.iceServers){const c=[];for(let u=0;u<i.iceServers.length;u++){let h=i.iceServers[u];!h.hasOwnProperty("urls")&&h.hasOwnProperty("url")?(DD("RTCIceServer.url","RTCIceServer.urls"),h=JSON.parse(JSON.stringify(h)),h.urls=h.url,delete h.url,c.push(h)):c.push(i.iceServers[u])}i.iceServers=c}return new n(i,s)},e.RTCPeerConnection.prototype=n.prototype,"generateCertificate"in n&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>n.generateCertificate})}function m4(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function g4(e){const n=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(i){if(i){i.offerToReceiveAudio!==void 0&&(i.offerToReceiveAudio=!!i.offerToReceiveAudio);const s=this.getTransceivers().find(u=>u.receiver.track.kind==="audio");i.offerToReceiveAudio===!1&&s?s.direction==="sendrecv"?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":s.direction==="recvonly"&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):i.offerToReceiveAudio!==!0||s||this.addTransceiver("audio",{direction:"recvonly"}),i.offerToReceiveVideo!==void 0&&(i.offerToReceiveVideo=!!i.offerToReceiveVideo);const c=this.getTransceivers().find(u=>u.receiver.track.kind==="video");i.offerToReceiveVideo===!1&&c?c.direction==="sendrecv"?c.setDirection?c.setDirection("sendonly"):c.direction="sendonly":c.direction==="recvonly"&&(c.setDirection?c.setDirection("inactive"):c.direction="inactive"):i.offerToReceiveVideo!==!0||c||this.addTransceiver("video",{direction:"recvonly"})}return n.apply(this,arguments)}}function _4(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var v4=Object.freeze({__proto__:null,shimAudioContext:_4,shimCallbacksAPI:d4,shimConstraints:f4,shimCreateOfferLegacy:g4,shimGetUserMedia:h4,shimLocalStreamsAPI:l4,shimRTCIceServerUrls:p4,shimRemoteStreamsAPI:u4,shimTrackEventTransceiver:m4}),E4=`	
\v\f\r \u2028\u2029\uFEFF`,oae=bt,sae=na,UD=E4,y4=O("".replace),aae=RegExp("^["+UD+"]+"),cae=RegExp("(^|[^"+UD+"])["+UD+"]+$"),lae=function(e){return function(n){var i=sae(oae(n));return 1&e&&(i=y4(i,aae,"")),2&e&&(i=y4(i,cae,"$1")),i}},uae={trim:lae(3)},dae=hT.PROPER,hae=d,S4=E4,fae=uae.trim;Pn({target:"String",proto:!0,forced:function(e){return hae(function(){return!!S4[e]()||""[e]()!==""||dae&&S4[e].name!==e})}("trim")},{trim:function(){return fae(this)}});var pae=Na("String").trim,mae=N,gae=pae,VD=String.prototype,_ae=function(e){var n=e.trim;return typeof e=="string"||e===VD||mae(VD,e)&&n===VD.trim?gae:n},$o=l(_ae),T4={exports:{}};(function(e){const n={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};n.localCName=n.generateIdentifier(),n.splitLines=function(i){return i.trim().split(`
`).map(s=>s.trim())},n.splitSections=function(i){return i.split(`
m=`).map((s,c)=>(c>0?"m="+s:s).trim()+`\r
`)},n.getDescription=function(i){const s=n.splitSections(i);return s&&s[0]},n.getMediaSections=function(i){const s=n.splitSections(i);return s.shift(),s},n.matchPrefix=function(i,s){return n.splitLines(i).filter(c=>c.indexOf(s)===0)},n.parseCandidate=function(i){let s;s=i.indexOf("a=candidate:")===0?i.substring(12).split(" "):i.substring(10).split(" ");const c={foundation:s[0],component:{1:"rtp",2:"rtcp"}[s[1]]||s[1],protocol:s[2].toLowerCase(),priority:parseInt(s[3],10),ip:s[4],address:s[4],port:parseInt(s[5],10),type:s[7]};for(let u=8;u<s.length;u+=2)switch(s[u]){case"raddr":c.relatedAddress=s[u+1];break;case"rport":c.relatedPort=parseInt(s[u+1],10);break;case"tcptype":c.tcpType=s[u+1];break;case"ufrag":c.ufrag=s[u+1],c.usernameFragment=s[u+1];break;default:c[s[u]]===void 0&&(c[s[u]]=s[u+1])}return c},n.writeCandidate=function(i){const s=[];s.push(i.foundation);const c=i.component;c==="rtp"?s.push(1):c==="rtcp"?s.push(2):s.push(c),s.push(i.protocol.toUpperCase()),s.push(i.priority),s.push(i.address||i.ip),s.push(i.port);const u=i.type;return s.push("typ"),s.push(u),u!=="host"&&i.relatedAddress&&i.relatedPort&&(s.push("raddr"),s.push(i.relatedAddress),s.push("rport"),s.push(i.relatedPort)),i.tcpType&&i.protocol.toLowerCase()==="tcp"&&(s.push("tcptype"),s.push(i.tcpType)),(i.usernameFragment||i.ufrag)&&(s.push("ufrag"),s.push(i.usernameFragment||i.ufrag)),"candidate:"+s.join(" ")},n.parseIceOptions=function(i){return i.substring(14).split(" ")},n.parseRtpMap=function(i){let s=i.substring(9).split(" ");const c={payloadType:parseInt(s.shift(),10)};return s=s[0].split("/"),c.name=s[0],c.clockRate=parseInt(s[1],10),c.channels=s.length===3?parseInt(s[2],10):1,c.numChannels=c.channels,c},n.writeRtpMap=function(i){let s=i.payloadType;i.preferredPayloadType!==void 0&&(s=i.preferredPayloadType);const c=i.channels||i.numChannels||1;return"a=rtpmap:"+s+" "+i.name+"/"+i.clockRate+(c!==1?"/"+c:"")+`\r
`},n.parseExtmap=function(i){const s=i.substring(9).split(" ");return{id:parseInt(s[0],10),direction:s[0].indexOf("/")>0?s[0].split("/")[1]:"sendrecv",uri:s[1],attributes:s.slice(2).join(" ")}},n.writeExtmap=function(i){return"a=extmap:"+(i.id||i.preferredId)+(i.direction&&i.direction!=="sendrecv"?"/"+i.direction:"")+" "+i.uri+(i.attributes?" "+i.attributes:"")+`\r
`},n.parseFmtp=function(i){const s={};let c;const u=i.substring(i.indexOf(" ")+1).split(";");for(let h=0;h<u.length;h++)c=u[h].trim().split("="),s[c[0].trim()]=c[1];return s},n.writeFmtp=function(i){let s="",c=i.payloadType;if(i.preferredPayloadType!==void 0&&(c=i.preferredPayloadType),i.parameters&&Object.keys(i.parameters).length){const u=[];Object.keys(i.parameters).forEach(h=>{i.parameters[h]!==void 0?u.push(h+"="+i.parameters[h]):u.push(h)}),s+="a=fmtp:"+c+" "+u.join(";")+`\r
`}return s},n.parseRtcpFb=function(i){const s=i.substring(i.indexOf(" ")+1).split(" ");return{type:s.shift(),parameter:s.join(" ")}},n.writeRtcpFb=function(i){let s="",c=i.payloadType;return i.preferredPayloadType!==void 0&&(c=i.preferredPayloadType),i.rtcpFeedback&&i.rtcpFeedback.length&&i.rtcpFeedback.forEach(u=>{s+="a=rtcp-fb:"+c+" "+u.type+(u.parameter&&u.parameter.length?" "+u.parameter:"")+`\r
`}),s},n.parseSsrcMedia=function(i){const s=i.indexOf(" "),c={ssrc:parseInt(i.substring(7,s),10)},u=i.indexOf(":",s);return u>-1?(c.attribute=i.substring(s+1,u),c.value=i.substring(u+1)):c.attribute=i.substring(s+1),c},n.parseSsrcGroup=function(i){const s=i.substring(13).split(" ");return{semantics:s.shift(),ssrcs:s.map(c=>parseInt(c,10))}},n.getMid=function(i){const s=n.matchPrefix(i,"a=mid:")[0];if(s)return s.substring(6)},n.parseFingerprint=function(i){const s=i.substring(14).split(" ");return{algorithm:s[0].toLowerCase(),value:s[1].toUpperCase()}},n.getDtlsParameters=function(i,s){return{role:"auto",fingerprints:n.matchPrefix(i+s,"a=fingerprint:").map(n.parseFingerprint)}},n.writeDtlsParameters=function(i,s){let c="a=setup:"+s+`\r
`;return i.fingerprints.forEach(u=>{c+="a=fingerprint:"+u.algorithm+" "+u.value+`\r
`}),c},n.parseCryptoLine=function(i){const s=i.substring(9).split(" ");return{tag:parseInt(s[0],10),cryptoSuite:s[1],keyParams:s[2],sessionParams:s.slice(3)}},n.writeCryptoLine=function(i){return"a=crypto:"+i.tag+" "+i.cryptoSuite+" "+(typeof i.keyParams=="object"?n.writeCryptoKeyParams(i.keyParams):i.keyParams)+(i.sessionParams?" "+i.sessionParams.join(" "):"")+`\r
`},n.parseCryptoKeyParams=function(i){if(i.indexOf("inline:")!==0)return null;const s=i.substring(7).split("|");return{keyMethod:"inline",keySalt:s[0],lifeTime:s[1],mkiValue:s[2]?s[2].split(":")[0]:void 0,mkiLength:s[2]?s[2].split(":")[1]:void 0}},n.writeCryptoKeyParams=function(i){return i.keyMethod+":"+i.keySalt+(i.lifeTime?"|"+i.lifeTime:"")+(i.mkiValue&&i.mkiLength?"|"+i.mkiValue+":"+i.mkiLength:"")},n.getCryptoParameters=function(i,s){return n.matchPrefix(i+s,"a=crypto:").map(n.parseCryptoLine)},n.getIceParameters=function(i,s){const c=n.matchPrefix(i+s,"a=ice-ufrag:")[0],u=n.matchPrefix(i+s,"a=ice-pwd:")[0];return c&&u?{usernameFragment:c.substring(12),password:u.substring(10)}:null},n.writeIceParameters=function(i){let s="a=ice-ufrag:"+i.usernameFragment+`\r
a=ice-pwd:`+i.password+`\r
`;return i.iceLite&&(s+=`a=ice-lite\r
`),s},n.parseRtpParameters=function(i){const s={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},c=n.splitLines(i)[0].split(" ");s.profile=c[2];for(let h=3;h<c.length;h++){const p=c[h],_=n.matchPrefix(i,"a=rtpmap:"+p+" ")[0];if(_){const E=n.parseRtpMap(_),S=n.matchPrefix(i,"a=fmtp:"+p+" ");switch(E.parameters=S.length?n.parseFmtp(S[0]):{},E.rtcpFeedback=n.matchPrefix(i,"a=rtcp-fb:"+p+" ").map(n.parseRtcpFb),s.codecs.push(E),E.name.toUpperCase()){case"RED":case"ULPFEC":s.fecMechanisms.push(E.name.toUpperCase())}}}n.matchPrefix(i,"a=extmap:").forEach(h=>{s.headerExtensions.push(n.parseExtmap(h))});const u=n.matchPrefix(i,"a=rtcp-fb:* ").map(n.parseRtcpFb);return s.codecs.forEach(h=>{u.forEach(p=>{h.rtcpFeedback.find(_=>_.type===p.type&&_.parameter===p.parameter)||h.rtcpFeedback.push(p)})}),s},n.writeRtpDescription=function(i,s){let c="";c+="m="+i+" ",c+=s.codecs.length>0?"9":"0",c+=" "+(s.profile||"UDP/TLS/RTP/SAVPF")+" ",c+=s.codecs.map(h=>h.preferredPayloadType!==void 0?h.preferredPayloadType:h.payloadType).join(" ")+`\r
`,c+=`c=IN IP4 0.0.0.0\r
`,c+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,s.codecs.forEach(h=>{c+=n.writeRtpMap(h),c+=n.writeFmtp(h),c+=n.writeRtcpFb(h)});let u=0;return s.codecs.forEach(h=>{h.maxptime>u&&(u=h.maxptime)}),u>0&&(c+="a=maxptime:"+u+`\r
`),s.headerExtensions&&s.headerExtensions.forEach(h=>{c+=n.writeExtmap(h)}),c},n.parseRtpEncodingParameters=function(i){const s=[],c=n.parseRtpParameters(i),u=c.fecMechanisms.indexOf("RED")!==-1,h=c.fecMechanisms.indexOf("ULPFEC")!==-1,p=n.matchPrefix(i,"a=ssrc:").map(I=>n.parseSsrcMedia(I)).filter(I=>I.attribute==="cname"),_=p.length>0&&p[0].ssrc;let E;const S=n.matchPrefix(i,"a=ssrc-group:FID").map(I=>I.substring(17).split(" ").map(P=>parseInt(P,10)));S.length>0&&S[0].length>1&&S[0][0]===_&&(E=S[0][1]),c.codecs.forEach(I=>{if(I.name.toUpperCase()==="RTX"&&I.parameters.apt){let P={ssrc:_,codecPayloadType:parseInt(I.parameters.apt,10)};_&&E&&(P.rtx={ssrc:E}),s.push(P),u&&(P=JSON.parse(JSON.stringify(P)),P.fec={ssrc:_,mechanism:h?"red+ulpfec":"red"},s.push(P))}}),s.length===0&&_&&s.push({ssrc:_});let w=n.matchPrefix(i,"b=");return w.length&&(w=w[0].indexOf("b=TIAS:")===0?parseInt(w[0].substring(7),10):w[0].indexOf("b=AS:")===0?1e3*parseInt(w[0].substring(5),10)*.95-16e3:void 0,s.forEach(I=>{I.maxBitrate=w})),s},n.parseRtcpParameters=function(i){const s={},c=n.matchPrefix(i,"a=ssrc:").map(p=>n.parseSsrcMedia(p)).filter(p=>p.attribute==="cname")[0];c&&(s.cname=c.value,s.ssrc=c.ssrc);const u=n.matchPrefix(i,"a=rtcp-rsize");s.reducedSize=u.length>0,s.compound=u.length===0;const h=n.matchPrefix(i,"a=rtcp-mux");return s.mux=h.length>0,s},n.writeRtcpParameters=function(i){let s="";return i.reducedSize&&(s+=`a=rtcp-rsize\r
`),i.mux&&(s+=`a=rtcp-mux\r
`),i.ssrc!==void 0&&i.cname&&(s+="a=ssrc:"+i.ssrc+" cname:"+i.cname+`\r
`),s},n.parseMsid=function(i){let s;const c=n.matchPrefix(i,"a=msid:");if(c.length===1)return s=c[0].substring(7).split(" "),{stream:s[0],track:s[1]};const u=n.matchPrefix(i,"a=ssrc:").map(h=>n.parseSsrcMedia(h)).filter(h=>h.attribute==="msid");return u.length>0?(s=u[0].value.split(" "),{stream:s[0],track:s[1]}):void 0},n.parseSctpDescription=function(i){const s=n.parseMLine(i),c=n.matchPrefix(i,"a=max-message-size:");let u;c.length>0&&(u=parseInt(c[0].substring(19),10)),isNaN(u)&&(u=65536);const h=n.matchPrefix(i,"a=sctp-port:");if(h.length>0)return{port:parseInt(h[0].substring(12),10),protocol:s.fmt,maxMessageSize:u};const p=n.matchPrefix(i,"a=sctpmap:");if(p.length>0){const _=p[0].substring(10).split(" ");return{port:parseInt(_[0],10),protocol:_[1],maxMessageSize:u}}},n.writeSctpDescription=function(i,s){let c=[];return c=i.protocol!=="DTLS/SCTP"?["m="+i.kind+" 9 "+i.protocol+" "+s.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+s.port+`\r
`]:["m="+i.kind+" 9 "+i.protocol+" "+s.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+s.port+" "+s.protocol+` 65535\r
`],s.maxMessageSize!==void 0&&c.push("a=max-message-size:"+s.maxMessageSize+`\r
`),c.join("")},n.generateSessionId=function(){return Math.random().toString().substr(2,22)},n.writeSessionBoilerplate=function(i,s,c){let u;const h=s!==void 0?s:2;return u=i||n.generateSessionId(),`v=0\r
o=`+(c||"thisisadapterortc")+" "+u+" "+h+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},n.getDirection=function(i,s){const c=n.splitLines(i);for(let u=0;u<c.length;u++)switch(c[u]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return c[u].substring(2)}return s?n.getDirection(s):"sendrecv"},n.getKind=function(i){return n.splitLines(i)[0].split(" ")[0].substring(2)},n.isRejected=function(i){return i.split(" ",2)[1]==="0"},n.parseMLine=function(i){const s=n.splitLines(i)[0].substring(2).split(" ");return{kind:s[0],port:parseInt(s[1],10),protocol:s[2],fmt:s.slice(3).join(" ")}},n.parseOLine=function(i){const s=n.matchPrefix(i,"o=")[0].substring(2).split(" ");return{username:s[0],sessionId:s[1],sessionVersion:parseInt(s[2],10),netType:s[3],addressType:s[4],address:s[5]}},n.isValidSDP=function(i){if(typeof i!="string"||i.length===0)return!1;const s=n.splitLines(i);for(let c=0;c<s.length;c++)if(s[c].length<2||s[c].charAt(1)!=="=")return!1;return!0},e.exports=n})(T4);var b4=T4.exports,bE=l(b4),vae=o({__proto__:null,default:bE},[b4]);function iI(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const n=e.RTCIceCandidate;e.RTCIceCandidate=function(i){if(typeof i=="object"&&i.candidate&&i.candidate.indexOf("a=")===0&&((i=JSON.parse(JSON.stringify(i))).candidate=i.candidate.substr(2)),i.candidate&&i.candidate.length){const s=new n(i),c=bE.parseCandidate(i.candidate),u=Object.assign(s,c);return u.toJSON=function(){return{candidate:u.candidate,sdpMid:u.sdpMid,sdpMLineIndex:u.sdpMLineIndex,usernameFragment:u.usernameFragment}},u}return new n(i)},e.RTCIceCandidate.prototype=n.prototype,Wg(e,"icecandidate",i=>(i.candidate&&Object.defineProperty(i,"candidate",{value:new e.RTCIceCandidate(i.candidate),writable:"false"}),i))}function FD(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||Wg(e,"icecandidate",n=>{if(n.candidate){const i=bE.parseCandidate(n.candidate.candidate);i.type==="relay"&&(n.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[i.priority>>24])}return n})}function oI(e,n){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const i=function(p){if(!p||!p.sdp)return!1;const _=bE.splitSections(p.sdp);return _.shift(),_.some(E=>{const S=bE.parseMLine(E);return S&&S.kind==="application"&&S.protocol.indexOf("SCTP")!==-1})},s=function(p){const _=p.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(_===null||_.length<2)return-1;const E=parseInt(_[1],10);return E!=E?-1:E},c=function(p){let _=65536;return n.browser==="firefox"&&(_=n.version<57?p===-1?16384:2147483637:n.version<60?n.version===57?65535:65536:2147483637),_},u=function(p,_){let E=65536;n.browser==="firefox"&&n.version===57&&(E=65535);const S=bE.matchPrefix(p.sdp,"a=max-message-size:");return S.length>0?E=parseInt(S[0].substr(19),10):n.browser==="firefox"&&_!==-1&&(E=2147483637),E},h=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,n.browser==="chrome"&&n.version>=76){const{sdpSemantics:p}=this.getConfiguration();p==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(i(arguments[0])){const p=s(arguments[0]),_=c(p),E=u(arguments[0],p);let S;S=_===0&&E===0?Number.POSITIVE_INFINITY:_===0||E===0?Math.max(_,E):Math.min(_,E);const w={};Object.defineProperty(w,"maxMessageSize",{get:()=>S}),this._sctp=w}return h.apply(this,arguments)}}function sI(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function n(s,c){const u=s.send;s.send=function(){const h=arguments[0],p=h.length||h.size||h.byteLength;if(s.readyState==="open"&&c.sctp&&p>c.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+c.sctp.maxMessageSize+" bytes)");return u.apply(s,arguments)}}const i=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const s=i.apply(this,arguments);return n(s,this),s},Wg(e,"datachannel",s=>(n(s.channel,s.target),s))}function jD(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype;Object.defineProperty(n,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(n,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(i){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),i&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=i)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(i=>{const s=n[i];n[i]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=c=>{const u=c.target;if(u._lastConnectionState!==u.connectionState){u._lastConnectionState=u.connectionState;const h=new Event("connectionstatechange",c);u.dispatchEvent(h)}return c},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),s.apply(this,arguments)}})}function BD(e,n){if(!e.RTCPeerConnection||n.browser==="chrome"&&n.version>=71||n.browser==="safari"&&n.version>=605)return;const i=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(s){if(s&&s.sdp&&s.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const c=s.sdp.split(`
`).filter(u=>$o(u).call(u)!=="a=extmap-allow-mixed").join(`
`);e.RTCSessionDescription&&s instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:s.type,sdp:c}):s.sdp=c}return i.apply(this,arguments)}}function aI(e,n){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const i=e.RTCPeerConnection.prototype.addIceCandidate;i&&i.length!==0&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(n.browser==="chrome"&&n.version<78||n.browser==="firefox"&&n.version<68||n.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Qe.resolve():i.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Qe.resolve())})}function cI(e,n){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const i=e.RTCPeerConnection.prototype.setLocalDescription;i&&i.length!==0&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let s=arguments[0]||{};if(typeof s!="object"||s.type&&s.sdp)return i.apply(this,arguments);if(s={type:s.type,sdp:s.sdp},!s.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":s.type="offer";break;default:s.type="answer"}return s.sdp||s.type!=="offer"&&s.type!=="answer"?i.apply(this,[s]):(s.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(c=>i.apply(this,[c]))})}var Eae=Object.freeze({__proto__:null,removeExtmapAllowMixed:BD,shimAddIceCandidateNullOrEmpty:aI,shimConnectionState:jD,shimMaxMessageSize:oI,shimParameterlessSetLocalDescription:cI,shimRTCIceCandidate:iI,shimRTCIceCandidateRelayProtocol:FD,shimSendThrowTypeError:sI});(function(){let{window:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const i=UB,s=function(u){const h={browser:null,version:null};if(u===void 0||!u.navigator)return h.browser="Not a browser.",h;const{navigator:p}=u;if(p.mozGetUserMedia)h.browser="firefox",h.version=rI(p.userAgent,/Firefox\/(\d+)\./,1);else if(p.webkitGetUserMedia||u.isSecureContext===!1&&u.webkitRTCPeerConnection)h.browser="chrome",h.version=rI(p.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!u.RTCPeerConnection||!p.userAgent.match(/AppleWebKit\/(\d+)\./))return h.browser="Not a supported browser.",h;h.browser="safari",h.version=rI(p.userAgent,/AppleWebKit\/(\d+)\./,1),h.supportsUnifiedPlan=u.RTCRtpTransceiver&&"currentDirection"in u.RTCRtpTransceiver.prototype}return h}(e),c={browserDetails:s,commonShim:Eae,extractVersion:rI,disableLog:rae,disableWarnings:iae,sdp:vae};switch(s.browser){case"chrome":if(!JB||!xD||!n.shimChrome)return i("Chrome shim is not included in this adapter release."),c;if(s.version===null)return i("Chrome shim can not determine version, not shimming."),c;i("adapter.js shimming chrome."),c.browserShim=JB,aI(e,s),cI(e),WB(e,s),GB(e),xD(e,s),zB(e),YB(e,s),HB(e),KB(e),$B(e),XB(e,s),iI(e),FD(e),jD(e),oI(e,s),sI(e),BD(e,s);break;case"firefox":if(!c4||!MD||!n.shimFirefox)return i("Firefox shim is not included in this adapter release."),c;i("adapter.js shimming firefox."),c.browserShim=c4,aI(e,s),cI(e),QB(e,s),MD(e,s),ZB(e),n4(e),e4(e),t4(e),r4(e),i4(e),o4(e),s4(e),a4(e),iI(e),jD(e),oI(e,s),sI(e);break;case"safari":if(!v4||!n.shimSafari)return i("Safari shim is not included in this adapter release."),c;i("adapter.js shimming safari."),c.browserShim=v4,aI(e,s),cI(e),p4(e),g4(e),d4(e),l4(e),u4(e),m4(e),h4(e),_4(e),iI(e),FD(e),oI(e,s),sI(e),BD(e,s);break;default:i("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var w4=Xa,yae=TypeError,R4=_r.match(/firefox\/(\d+)/i),Sae=!!R4&&+R4[1],Tae=/MSIE|Trident/.test(_r),C4=_r.match(/AppleWebKit\/(\d+)\./),bae=!!C4&&+C4[1],wae=Pn,I4=O,Rae=ro,Cae=Es,A4=ti,Iae=function(e,n){if(!delete e[n])throw yae("Cannot delete property "+w4(n)+" of "+w4(e))},O4=na,WD=d,Aae=Fj,Oae=jh,P4=Sae,Pae=Tae,N4=or,k4=bae,Fp=[],D4=I4(Fp.sort),Nae=I4(Fp.push),kae=WD(function(){Fp.sort(void 0)}),Dae=WD(function(){Fp.sort(null)}),Lae=Oae("sort"),L4=!WD(function(){if(N4)return N4<70;if(!(P4&&P4>3)){if(Pae)return!0;if(k4)return k4<603;var e,n,i,s,c="";for(e=65;e<76;e++){switch(n=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:i=3;break;case 68:case 71:i=4;break;default:i=2}for(s=0;s<47;s++)Fp.push({k:n+s,v:i})}for(Fp.sort(function(u,h){return h.v-u.v}),s=0;s<Fp.length;s++)n=Fp[s].k.charAt(0),c.charAt(c.length-1)!==n&&(c+=n);return c!=="DGBEFHACIJK"}});wae({target:"Array",proto:!0,forced:kae||!Dae||!Lae||!L4},{sort:function(e){e!==void 0&&Rae(e);var n=Cae(this);if(L4)return e===void 0?D4(n):D4(n,e);var i,s,c=[],u=A4(n);for(s=0;s<u;s++)s in n&&Nae(c,n[s]);for(Aae(c,function(h){return function(p,_){return _===void 0?-1:p===void 0?1:h!==void 0?+h(p,_)||0:O4(p)>O4(_)?1:-1}}(e)),i=A4(c),s=0;s<i;)n[s]=c[s++];for(;s<u;)Iae(n,s++);return n}});var xae=Na("Array").sort,Mae=N,Uae=xae,GD=Array.prototype,Vae=function(e){var n=e.sort;return e===GD||Mae(GD,e)&&n===GD.sort?Uae:n},YT=l(Vae),zD=H;Pn({global:!0,forced:zD.globalThis!==zD},{globalThis:zD});var x4=l(H),HD={exports:{}};(function(e,n){(function(i,s){var c="function",u="undefined",h="object",p="string",_="major",E="model",S="name",w="type",I="vendor",P="version",B="architecture",M="console",U="mobile",$="tablet",q="smarttv",ce="wearable",me="embedded",ge="Amazon",pe="Apple",Re="ASUS",Ve="BlackBerry",Ze="Browser",rt="Chrome",un="Firefox",dn="Google",nr="Huawei",Qr="LG",jr="Microsoft",js="Motorola",Pe="Opera",He="Samsung",dt="Sharp",ke="Sony",L="Xiaomi",ee="Zebra",ue="Facebook",je="Chromium OS",jt="Mac OS",Xn=function(gi){for(var Li={},pr=0;pr<gi.length;pr++)Li[gi[pr].toUpperCase()]=gi[pr];return Li},Di=function(gi,Li){return typeof gi===p&&fa(Li).indexOf(fa(gi))!==-1},fa=function(gi){return gi.toLowerCase()},Rf=function(gi,Li){if(typeof gi===p)return gi=gi.replace(/^\s\s*/,""),typeof Li===u?gi:gi.substring(0,350)},E_=function(gi,Li){for(var pr,Wa,Zd,Zr,Dn,pa,am=0;am<Li.length&&!Dn;){var Xu=Li[am],cK=Li[am+1];for(pr=Wa=0;pr<Xu.length&&!Dn&&Xu[pr];)if(Dn=Xu[pr++].exec(gi))for(Zd=0;Zd<cK.length;Zd++)pa=Dn[++Wa],typeof(Zr=cK[Zd])===h&&Zr.length>0?Zr.length===2?typeof Zr[1]==c?this[Zr[0]]=Zr[1].call(this,pa):this[Zr[0]]=Zr[1]:Zr.length===3?typeof Zr[1]!==c||Zr[1].exec&&Zr[1].test?this[Zr[0]]=pa?pa.replace(Zr[1],Zr[2]):s:this[Zr[0]]=pa?Zr[1].call(this,pa,Zr[2]):s:Zr.length===4&&(this[Zr[0]]=pa?Zr[3].call(this,pa.replace(Zr[1],Zr[2])):s):this[Zr]=pa||s;am+=2}},Q0=function(gi,Li){for(var pr in Li)if(typeof Li[pr]===h&&Li[pr].length>0){for(var Wa=0;Wa<Li[pr].length;Wa++)if(Di(Li[pr][Wa],gi))return pr==="?"?s:pr}else if(Di(Li[pr],gi))return pr==="?"?s:pr;return gi},oO={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},sO={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[P,[S,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[P,[S,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[S,P],[/opios[\/ ]+([\w\.]+)/i],[P,[S,Pe+" Mini"]],[/\bopr\/([\w\.]+)/i],[P,[S,Pe]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[S,P],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[P,[S,"UC"+Ze]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[P,[S,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[P,[S,"WeChat"]],[/konqueror\/([\w\.]+)/i],[P,[S,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[P,[S,"IE"]],[/yabrowser\/([\w\.]+)/i],[P,[S,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[S,/(.+)/,"$1 Secure "+Ze],P],[/\bfocus\/([\w\.]+)/i],[P,[S,un+" Focus"]],[/\bopt\/([\w\.]+)/i],[P,[S,Pe+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[P,[S,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[P,[S,"Dolphin"]],[/coast\/([\w\.]+)/i],[P,[S,Pe+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[P,[S,"MIUI "+Ze]],[/fxios\/([-\w\.]+)/i],[P,[S,un]],[/\bqihu|(qi?ho?o?|360)browser/i],[[S,"360 "+Ze]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[S,/(.+)/,"$1 "+Ze],P],[/(comodo_dragon)\/([\w\.]+)/i],[[S,/_/g," "],P],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[S,P],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[S],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[S,ue],P],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[S,P],[/\bgsa\/([\w\.]+) .*safari\//i],[P,[S,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[P,[S,rt+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[S,rt+" WebView"],P],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[P,[S,"Android "+Ze]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[S,P],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[P,[S,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[P,S],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[S,[P,Q0,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[S,P],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[S,"Netscape"],P],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[P,[S,un+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[S,P],[/(cobalt)\/([\w\.]+)/i],[S,[P,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[B,"amd64"]],[/(ia32(?=;))/i],[[B,fa]],[/((?:i[346]|x)86)[;\)]/i],[[B,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[B,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[B,"armhf"]],[/windows (ce|mobile); ppc;/i],[[B,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[B,/ower/,"",fa]],[/(sun4\w)[;\)]/i],[[B,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[B,fa]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[E,[I,He],[w,$]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[E,[I,He],[w,U]],[/\((ip(?:hone|od)[\w ]*);/i],[E,[I,pe],[w,U]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[E,[I,pe],[w,$]],[/(macintosh);/i],[E,[I,pe]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[E,[I,dt],[w,U]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[E,[I,nr],[w,$]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[E,[I,nr],[w,U]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[E,/_/g," "],[I,L],[w,U]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[E,/_/g," "],[I,L],[w,$]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[E,[I,"OPPO"],[w,U]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[E,[I,"Vivo"],[w,U]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[E,[I,"Realme"],[w,U]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[E,[I,js],[w,U]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[E,[I,js],[w,$]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[E,[I,Qr],[w,$]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[E,[I,Qr],[w,U]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[E,[I,"Lenovo"],[w,$]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[E,/_/g," "],[I,"Nokia"],[w,U]],[/(pixel c)\b/i],[E,[I,dn],[w,$]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[E,[I,dn],[w,U]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[E,[I,ke],[w,U]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[E,"Xperia Tablet"],[I,ke],[w,$]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[E,[I,"OnePlus"],[w,U]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[E,[I,ge],[w,$]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[E,/(.+)/g,"Fire Phone $1"],[I,ge],[w,U]],[/(playbook);[-\w\),; ]+(rim)/i],[E,I,[w,$]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[E,[I,Ve],[w,U]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[E,[I,Re],[w,$]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[E,[I,Re],[w,U]],[/(nexus 9)/i],[E,[I,"HTC"],[w,$]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[I,[E,/_/g," "],[w,U]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[E,[I,"Acer"],[w,$]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[E,[I,"Meizu"],[w,U]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[I,E,[w,U]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[I,E,[w,$]],[/(surface duo)/i],[E,[I,jr],[w,$]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[E,[I,"Fairphone"],[w,U]],[/(u304aa)/i],[E,[I,"AT&T"],[w,U]],[/\bsie-(\w*)/i],[E,[I,"Siemens"],[w,U]],[/\b(rct\w+) b/i],[E,[I,"RCA"],[w,$]],[/\b(venue[\d ]{2,7}) b/i],[E,[I,"Dell"],[w,$]],[/\b(q(?:mv|ta)\w+) b/i],[E,[I,"Verizon"],[w,$]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[E,[I,"Barnes & Noble"],[w,$]],[/\b(tm\d{3}\w+) b/i],[E,[I,"NuVision"],[w,$]],[/\b(k88) b/i],[E,[I,"ZTE"],[w,$]],[/\b(nx\d{3}j) b/i],[E,[I,"ZTE"],[w,U]],[/\b(gen\d{3}) b.+49h/i],[E,[I,"Swiss"],[w,U]],[/\b(zur\d{3}) b/i],[E,[I,"Swiss"],[w,$]],[/\b((zeki)?tb.*\b) b/i],[E,[I,"Zeki"],[w,$]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[I,"Dragon Touch"],E,[w,$]],[/\b(ns-?\w{0,9}) b/i],[E,[I,"Insignia"],[w,$]],[/\b((nxa|next)-?\w{0,9}) b/i],[E,[I,"NextBook"],[w,$]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[I,"Voice"],E,[w,U]],[/\b(lvtel\-)?(v1[12]) b/i],[[I,"LvTel"],E,[w,U]],[/\b(ph-1) /i],[E,[I,"Essential"],[w,U]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[E,[I,"Envizen"],[w,$]],[/\b(trio[-\w\. ]+) b/i],[E,[I,"MachSpeed"],[w,$]],[/\btu_(1491) b/i],[E,[I,"Rotor"],[w,$]],[/(shield[\w ]+) b/i],[E,[I,"Nvidia"],[w,$]],[/(sprint) (\w+)/i],[I,E,[w,U]],[/(kin\.[onetw]{3})/i],[[E,/\./g," "],[I,jr],[w,U]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[E,[I,ee],[w,$]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[E,[I,ee],[w,U]],[/smart-tv.+(samsung)/i],[I,[w,q]],[/hbbtv.+maple;(\d+)/i],[[E,/^/,"SmartTV"],[I,He],[w,q]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[I,Qr],[w,q]],[/(apple) ?tv/i],[I,[E,pe+" TV"],[w,q]],[/crkey/i],[[E,rt+"cast"],[I,dn],[w,q]],[/droid.+aft(\w)( bui|\))/i],[E,[I,ge],[w,q]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[E,[I,dt],[w,q]],[/(bravia[\w ]+)( bui|\))/i],[E,[I,ke],[w,q]],[/(mitv-\w{5}) bui/i],[E,[I,L],[w,q]],[/Hbbtv.*(technisat) (.*);/i],[I,E,[w,q]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[I,Rf],[E,Rf],[w,q]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[w,q]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[I,E,[w,M]],[/droid.+; (shield) bui/i],[E,[I,"Nvidia"],[w,M]],[/(playstation [345portablevi]+)/i],[E,[I,ke],[w,M]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[E,[I,jr],[w,M]],[/((pebble))app/i],[I,E,[w,ce]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[E,[I,pe],[w,ce]],[/droid.+; (glass) \d/i],[E,[I,dn],[w,ce]],[/droid.+; (wt63?0{2,3})\)/i],[E,[I,ee],[w,ce]],[/(quest( 2| pro)?)/i],[E,[I,ue],[w,ce]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[I,[w,me]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[E,[w,U]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[E,[w,$]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[w,$]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[w,U]],[/(android[-\w\. ]{0,9});.+buil/i],[E,[I,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[P,[S,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[P,[S,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[S,P],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[P,S]],os:[[/microsoft (windows) (vista|xp)/i],[S,P],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[S,[P,Q0,oO]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[S,"Windows"],[P,Q0,oO]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[P,/_/g,"."],[S,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[S,jt],[P,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[P,S],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[S,P],[/\(bb(10);/i],[P,[S,Ve]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[P,[S,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[P,[S,un+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[P,[S,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[P,[S,"watchOS"]],[/crkey\/([\d\.]+)/i],[P,[S,rt+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[S,je],P],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[S,P],[/(sunos) ?([\w\.\d]*)/i],[[S,"Solaris"],P],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[S,P]]},cl=function(gi,Li){if(typeof gi===h&&(Li=gi,gi=s),!(this instanceof cl))return new cl(gi,Li).getResult();var pr=typeof i!==u&&i.navigator?i.navigator:s,Wa=gi||(pr&&pr.userAgent?pr.userAgent:""),Zd=pr&&pr.userAgentData?pr.userAgentData:s,Zr=Li?function(Dn,pa){var am={};for(var Xu in Dn)pa[Xu]&&pa[Xu].length%2==0?am[Xu]=pa[Xu].concat(Dn[Xu]):am[Xu]=Dn[Xu];return am}(sO,Li):sO;return this.getBrowser=function(){var Dn={};return Dn[S]=s,Dn[P]=s,E_.call(Dn,Wa,Zr.browser),Dn[_]=function(pa){return typeof pa===p?pa.replace(/[^\d\.]/g,"").split(".")[0]:s}(Dn[P]),pr&&pr.brave&&typeof pr.brave.isBrave==c&&(Dn[S]="Brave"),Dn},this.getCPU=function(){var Dn={};return Dn[B]=s,E_.call(Dn,Wa,Zr.cpu),Dn},this.getDevice=function(){var Dn={};return Dn[I]=s,Dn[E]=s,Dn[w]=s,E_.call(Dn,Wa,Zr.device),!Dn[w]&&Zd&&Zd.mobile&&(Dn[w]=U),Dn[E]=="Macintosh"&&pr&&typeof pr.standalone!==u&&pr.maxTouchPoints&&pr.maxTouchPoints>2&&(Dn[E]="iPad",Dn[w]=$),Dn},this.getEngine=function(){var Dn={};return Dn[S]=s,Dn[P]=s,E_.call(Dn,Wa,Zr.engine),Dn},this.getOS=function(){var Dn={};return Dn[S]=s,Dn[P]=s,E_.call(Dn,Wa,Zr.os),!Dn[S]&&Zd&&Zd.platform!="Unknown"&&(Dn[S]=Zd.platform.replace(/chrome os/i,je).replace(/macos/i,jt)),Dn},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return Wa},this.setUA=function(Dn){return Wa=typeof Dn===p&&Dn.length>350?Rf(Dn,350):Dn,this},this.setUA(Wa),this};cl.VERSION="0.7.34",cl.BROWSER=Xn([S,P,_]),cl.CPU=Xn([B]),cl.DEVICE=Xn([E,I,w,M,U,q,$,ce,me]),cl.ENGINE=cl.OS=Xn([S,P]),e.exports&&(n=e.exports=cl),n.UAParser=cl;var sm=typeof i!==u&&(i.jQuery||i.Zepto);if(sm&&!sm.ua){var y_=new cl;sm.ua=y_.getResult(),sm.ua.get=function(){return y_.getUA()},sm.ua.set=function(gi){y_.setUA(gi);var Li=y_.getResult();for(var pr in Li)sm.ua[pr]=Li[pr]}}})(typeof window=="object"?window:a)})(HD,HD.exports);var Fae=l(HD.exports),jae=rc,Bae=ui,Wae=hn,Gae=cc,zae=sr("iterator"),Hae=Object,Kae=function(e){if(Wae(e))return!1;var n=Hae(e);return n[zae]!==void 0||"@@iterator"in n||Bae(Gae,jae(n))},$ae=l(Kae),M4=Mp.clear;Pn({global:!0,bind:!0,forced:H.clearImmediate!==M4},{clearImmediate:M4});var qae=typeof Bun=="function"&&Bun&&typeof Bun.version=="string",U4=H,Yae=oe,Xae=lt,Jae=qae,Qae=_r,Zae=Ai,ece=xo,tce=U4.Function,nce=/MSIE .\./.test(Qae)||Jae&&function(){var e=U4.Bun.version.split(".");return e.length<3||e[0]==0&&(e[1]<3||e[1]==3&&e[2]==0)}(),rce=Pn,V4=H,F4=Mp.set,ice=function(e,n){var i=1;return nce?function(s,c){var u=ece(arguments.length,1)>i,h=Xae(s)?s:tce(s),p=u?Zae(arguments,i):[],_=u?function(){Yae(h,this,p)}:h;return e(_)}:e},j4=V4.setImmediate?ice(F4):F4;rce({global:!0,bind:!0,forced:V4.setImmediate!==j4},{setImmediate:j4});var B4=l(gt.setImmediate),oce=Pn,sce=VC,ace=ro,cce=xo,lce=Bh,uce=H.process;oce({global:!0,dontCallGetSet:!0},{queueMicrotask:function(e){cce(arguments.length,1),ace(e);var n=lce&&uce.domain;sce(n?n.bind(e):e)}});var W4=l(gt.queueMicrotask);function G4(e,n){return function(){return e.apply(n,arguments)}}const{toString:dce}=Object.prototype,{getPrototypeOf:KD}=Object,lI=($D=Object.create(null),e=>{const n=dce.call(e);return $D[n]||($D[n]=n.slice(8,-1).toLowerCase())});var $D;const Uu=e=>(e=e.toLowerCase(),n=>lI(n)===e),uI=e=>n=>typeof n===e,{isArray:wE}=Array,XT=uI("undefined"),z4=Uu("ArrayBuffer"),hce=uI("string"),Qc=uI("function"),H4=uI("number"),dI=e=>e!==null&&typeof e=="object",hI=e=>{if(lI(e)!=="object")return!1;const n=KD(e);return!(n!==null&&n!==Object.prototype&&Object.getPrototypeOf(n)!==null||Symbol.toStringTag in e||$ae(e))},fce=Uu("Date"),pce=Uu("File"),mce=Uu("Blob"),gce=Uu("FileList"),_ce=Uu("URLSearchParams"),[vce,Ece,yce,Sce]=["ReadableStream","Request","Response","Headers"].map(Uu);function JT(e,n){let i,s,{allOwnKeys:c=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(e!=null)if(typeof e!="object"&&(e=[e]),wE(e))for(i=0,s=e.length;i<s;i++)n.call(null,e[i],i,e);else{const u=c?Object.getOwnPropertyNames(e):Object.keys(e),h=u.length;let p;for(i=0;i<h;i++)p=u[i],n.call(null,e[p],p,e)}}function K4(e,n){n=n.toLowerCase();const i=Object.keys(e);let s,c=i.length;for(;c-- >0;)if(s=i[c],n===s.toLowerCase())return s;return null}const Gg=x4!==void 0?x4:typeof self<"u"?self:typeof window<"u"?window:N_,$4=e=>!XT(e)&&e!==Gg,Tce=(qD=typeof Uint8Array<"u"&&KD(Uint8Array),e=>qD&&e instanceof qD);var qD;const bce=Uu("HTMLFormElement"),q4=(e=>{let{hasOwnProperty:n}=e;return(i,s)=>n.call(i,s)})(Object.prototype),wce=Uu("RegExp"),Y4=(e,n)=>{const i=Object.getOwnPropertyDescriptors(e),s={};JT(i,(c,u)=>{let h;(h=n(c,u,e))!==!1&&(s[u]=h||c)}),Object.defineProperties(e,s)},YD="abcdefghijklmnopqrstuvwxyz",X4="0123456789",J4={DIGIT:X4,ALPHA:YD,ALPHA_DIGIT:YD+YD.toUpperCase()+X4},Rce=Uu("AsyncFunction"),Q4=(Z4=typeof B4=="function",e3=Qc(Gg.postMessage),Z4?B4:e3?(XD="axios@".concat(Math.random()),fI=[],Gg.addEventListener("message",e=>{let{source:n,data:i}=e;n===Gg&&i===XD&&fI.length&&fI.shift()()},!1),e=>{fI.push(e),Gg.postMessage(XD,"*")}):e=>setTimeout(e));var Z4,e3,XD,fI;const Cce=W4!==void 0?W4.bind(Gg):typeof process<"u"&&process.nextTick||Q4;var Je={isArray:wE,isArrayBuffer:z4,isBuffer:function(e){return e!==null&&!XT(e)&&e.constructor!==null&&!XT(e.constructor)&&Qc(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let n;return e&&(typeof FormData=="function"&&e instanceof FormData||Qc(e.append)&&((n=lI(e))==="formdata"||n==="object"&&Qc(e.toString)&&e.toString()==="[object FormData]"))},isArrayBufferView:function(e){let n;return n=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&z4(e.buffer),n},isString:hce,isNumber:H4,isBoolean:e=>e===!0||e===!1,isObject:dI,isPlainObject:hI,isReadableStream:vce,isRequest:Ece,isResponse:yce,isHeaders:Sce,isUndefined:XT,isDate:fce,isFile:pce,isBlob:mce,isRegExp:wce,isFunction:Qc,isStream:e=>dI(e)&&Qc(e.pipe),isURLSearchParams:_ce,isTypedArray:Tce,isFileList:gce,forEach:JT,merge:function e(){const{caseless:n}=$4(this)&&this||{},i={},s=(c,u)=>{const h=n&&K4(i,u)||u;hI(i[h])&&hI(c)?i[h]=e(i[h],c):hI(c)?i[h]=e({},c):wE(c)?i[h]=c.slice():i[h]=c};for(let c=0,u=arguments.length;c<u;c++)arguments[c]&&JT(arguments[c],s);return i},extend:function(e,n,i){let{allOwnKeys:s}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return JT(n,(c,u)=>{i&&Qc(c)?e[u]=G4(c,i):e[u]=c},{allOwnKeys:s}),e},trim:e=>$o(e)?$o(e).call(e):e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),inherits:(e,n,i,s)=>{e.prototype=Object.create(n.prototype,s),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:n.prototype}),i&&Object.assign(e.prototype,i)},toFlatObject:(e,n,i,s)=>{let c,u,h;const p={};if(n=n||{},e==null)return n;do{for(c=Object.getOwnPropertyNames(e),u=c.length;u-- >0;)h=c[u],s&&!s(h,e,n)||p[h]||(n[h]=e[h],p[h]=!0);e=i!==!1&&KD(e)}while(e&&(!i||i(e,n))&&e!==Object.prototype);return n},kindOf:lI,kindOfTest:Uu,endsWith:(e,n,i)=>{e=String(e),(i===void 0||i>e.length)&&(i=e.length),i-=n.length;const s=e.indexOf(n,i);return s!==-1&&s===i},toArray:e=>{if(!e)return null;if(wE(e))return e;let n=e.length;if(!H4(n))return null;const i=new Array(n);for(;n-- >0;)i[n]=e[n];return i},forEachEntry:(e,n)=>{const i=(e&&e[Symbol.iterator]).call(e);let s;for(;(s=i.next())&&!s.done;){const c=s.value;n.call(e,c[0],c[1])}},matchAll:(e,n)=>{let i;const s=[];for(;(i=e.exec(n))!==null;)s.push(i);return s},isHTMLForm:bce,hasOwnProperty:q4,hasOwnProp:q4,reduceDescriptors:Y4,freezeMethods:e=>{Y4(e,(n,i)=>{if(Qc(e)&&["arguments","caller","callee"].indexOf(i)!==-1)return!1;const s=e[i];Qc(s)&&(n.enumerable=!1,"writable"in n?n.writable=!1:n.set||(n.set=()=>{throw Error("Can not rewrite read-only method '"+i+"'")}))})},toObjectSet:(e,n)=>{const i={},s=c=>{c.forEach(u=>{i[u]=!0})};return wE(e)?s(e):s(String(e).split(n)),i},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(n,i,s){return i.toUpperCase()+s}),noop:()=>{},toFiniteNumber:(e,n)=>e!=null&&Number.isFinite(e=+e)?e:n,findKey:K4,global:Gg,isContextDefined:$4,ALPHABET:J4,generateString:function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:J4.ALPHA_DIGIT,i="";const{length:s}=n;for(;e--;)i+=n[Math.random()*s|0];return i},isSpecCompliantForm:function(e){return!!(e&&Qc(e.append)&&e[Symbol.toStringTag]==="FormData"&&e[Symbol.iterator])},toJSONObject:e=>{const n=new Array(10),i=(s,c)=>{if(dI(s)){if(n.indexOf(s)>=0)return;if(!("toJSON"in s)){n[c]=s;const u=wE(s)?[]:{};return JT(s,(h,p)=>{const _=i(h,c+1);!XT(_)&&(u[p]=_)}),n[c]=void 0,u}}return s};return i(e,0)},isAsyncFn:Rce,isThenable:e=>e&&(dI(e)||Qc(e))&&Qc(e.then)&&Qc(e.catch),setImmediate:Q4,asap:Cce};function qn(e,n,i,s,c){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",n&&(this.code=n),i&&(this.config=i),s&&(this.request=s),c&&(this.response=c,this.status=c.status?c.status:null)}Je.inherits(qn,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Je.toJSONObject(this.config),code:this.code,status:this.status}}});const t3=qn.prototype,n3={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{n3[e]={value:e}}),Object.defineProperties(qn,n3),Object.defineProperty(t3,"isAxiosError",{value:!0}),qn.from=(e,n,i,s,c,u)=>{const h=Object.create(t3);return Je.toFlatObject(e,h,function(p){return p!==Error.prototype},p=>p!=="isAxiosError"),qn.call(h,e.message,n,i,s,c),h.cause=e,h.name=e.name,u&&Object.assign(h,u),h};function JD(e){return Je.isPlainObject(e)||Je.isArray(e)}function r3(e){return Je.endsWith(e,"[]")?e.slice(0,-2):e}function i3(e,n,i){return e?e.concat(n).map(function(s,c){return s=r3(s),!i&&c?"["+s+"]":s}).join(i?".":""):n}const Ice=Je.toFlatObject(Je,{},null,function(e){return/^is[A-Z]/.test(e)});function pI(e,n,i){if(!Je.isObject(e))throw new TypeError("target must be an object");n=n||new FormData;const s=(i=Je.toFlatObject(i,{metaTokens:!0,dots:!1,indexes:!1},!1,function(I,P){return!Je.isUndefined(P[I])})).metaTokens,c=i.visitor||E,u=i.dots,h=i.indexes,p=(i.Blob||typeof Blob<"u"&&Blob)&&Je.isSpecCompliantForm(n);if(!Je.isFunction(c))throw new TypeError("visitor must be a function");function _(I){if(I===null)return"";if(Je.isDate(I))return I.toISOString();if(!p&&Je.isBlob(I))throw new qn("Blob is not supported. Use a Buffer instead.");return Je.isArrayBuffer(I)||Je.isTypedArray(I)?p&&typeof Blob=="function"?new Blob([I]):Buffer.from(I):I}function E(I,P,B){let M=I;if(I&&!B&&typeof I=="object"){if(Je.endsWith(P,"{}"))P=s?P:P.slice(0,-2),I=JSON.stringify(I);else if(Je.isArray(I)&&function(U){return Je.isArray(U)&&!U.some(JD)}(I)||(Je.isFileList(I)||Je.endsWith(P,"[]"))&&(M=Je.toArray(I)))return P=r3(P),M.forEach(function(U,$){!Je.isUndefined(U)&&U!==null&&n.append(h===!0?i3([P],$,u):h===null?P:P+"[]",_(U))}),!1}return!!JD(I)||(n.append(i3(B,P,u),_(I)),!1)}const S=[],w=Object.assign(Ice,{defaultVisitor:E,convertValue:_,isVisitable:JD});if(!Je.isObject(e))throw new TypeError("data must be an object");return function I(P,B){if(!Je.isUndefined(P)){if(S.indexOf(P)!==-1)throw Error("Circular reference detected in "+B.join("."));S.push(P),Je.forEach(P,function(M,U){(!(Je.isUndefined(M)||M===null)&&c.call(n,M,Je.isString(U)?$o(U).call(U):U,B,w))===!0&&I(M,B?B.concat(U):[U])}),S.pop()}}(e),n}function o3(e){const n={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(i){return n[i]})}function QD(e,n){this._pairs=[],e&&pI(e,this,n)}const s3=QD.prototype;function Ace(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function a3(e,n,i){if(!n)return e;const s=i&&i.encode||Ace;Je.isFunction(i)&&(i={serialize:i});const c=i&&i.serialize;let u;if(u=c?c(n,i):Je.isURLSearchParams(n)?n.toString():new QD(n,i).toString(s),u){const h=e.indexOf("#");h!==-1&&(e=e.slice(0,h)),e+=(e.indexOf("?")===-1?"?":"&")+u}return e}s3.append=function(e,n){this._pairs.push([e,n])},s3.toString=function(e){const n=e?function(i){return e.call(this,i,o3)}:o3;return this._pairs.map(function(i){return n(i[0])+"="+n(i[1])},"").join("&")};var c3=class{constructor(){this.handlers=[]}use(e,n,i){return this.handlers.push({fulfilled:e,rejected:n,synchronous:!!i&&i.synchronous,runWhen:i?i.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){Je.forEach(this.handlers,function(n){n!==null&&e(n)})}},l3={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},u3={exports:{}},Oce=Pn,Pce=Xe,d3=Ge.f;Oce({target:"Object",stat:!0,forced:Object.defineProperty!==d3,sham:!Pce},{defineProperty:d3});var h3=gt.Object,Nce=u3.exports=function(e,n,i){return h3.defineProperty(e,n,i)};h3.defineProperty.sham&&(Nce.sham=!0);var f3=l(u3.exports),kce=TypeError,p3=Zm,Dce=bg,Lce=mt,xce=sr("species"),m3=Array,Mce=function(e){var n;return p3(e)&&(n=e.constructor,(Dce(n)&&(n===m3||p3(n.prototype))||Lce(n)&&(n=n[xce])===null)&&(n=void 0)),n===void 0?m3:n},g3=function(e,n){return new(Mce(e))(n===0?0:n)},Uce=d,Vce=or,Fce=sr("species"),_3=function(e){return Vce>=51||!Uce(function(){var n=[];return(n.constructor={})[Fce]=function(){return{foo:1}},n[e](Boolean).foo!==1})},jce=Pn,Bce=d,Wce=Zm,Gce=mt,zce=Es,Hce=ti,v3=function(e){if(e>9007199254740991)throw kce("Maximum allowed index exceeded");return e},E3=zC,Kce=g3,$ce=_3,qce=or,y3=sr("isConcatSpreadable"),Yce=qce>=51||!Bce(function(){var e=[];return e[y3]=!1,e.concat()[0]!==e}),Xce=function(e){if(!Gce(e))return!1;var n=e[y3];return n!==void 0?!!n:Wce(e)};jce({target:"Array",proto:!0,forced:!Yce||!$ce("concat")},{concat:function(e){var n,i,s,c,u,h=zce(this),p=Kce(h,0),_=0;for(n=-1,s=arguments.length;n<s;n++)if(Xce(u=n===-1?h:arguments[n]))for(c=Hce(u),v3(_+c),i=0;i<c;i++,_++)i in u&&E3(p,_,u[i]);else v3(_+1),E3(p,_++,u);return p.length=_,p}});var S3={},Jce=Q,Qce=we,T3=vd.f,Zce=tD,b3=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];S3.f=function(e){return b3&&Jce(e)=="Window"?function(n){try{return T3(n)}catch{return Zce(b3)}}(e):T3(Qce(e))};var RE={},ele=sr;RE.f=ele;var w3=gt,tle=ui,nle=RE,rle=Ge.f,co=function(e){var n=w3.Symbol||(w3.Symbol={});tle(n,e)||rle(n,e,{value:nle.f(e)})},ile=nt,ole=nn,sle=sr,ale=Il,R3=function(){var e=ole("Symbol"),n=e&&e.prototype,i=n&&n.valueOf,s=sle("toPrimitive");n&&!n[s]&&ale(n,s,function(c){return ile(i,this)},{})},cle=Ce,lle=xn,ule=Es,dle=ti,hle=g3,C3=O([].push),fle=function(e){var n=e==1,i=e==2,s=e==3,c=e==4,u=e==6,h=e==7,p=e==5||u;return function(_,E,S,w){for(var I,P,B=ule(_),M=lle(B),U=cle(E,S),$=dle(M),q=0,ce=w||hle,me=n?ce(_,$):i||h?ce(_,0):void 0;$>q;q++)if((p||q in M)&&(P=U(I=M[q],q,B),e))if(n)me[q]=P;else if(P)switch(e){case 3:return!0;case 5:return I;case 6:return q;case 2:C3(me,I)}else switch(e){case 4:return!1;case 7:C3(me,I)}return u?-1:s||c?c:me}},I3={forEach:fle(0)},mI=Pn,ZD=H,e1=nt,ple=O,CE=Xe,IE=_s,mle=d,as=ui,gle=N,t1=Qt,gI=we,n1=Oa,_le=na,r1=_t,QT=Ns,A3=sc,vle=vd,O3=S3,Ele=oc,P3=ft,N3=Ge,yle=Cv,k3=Ee,D3=Il,Sle=yo,i1=Ia,L3=ic,x3=dd,Tle=sr,ble=RE,wle=co,Rle=R3,Cle=Ou,M3=Cl,_I=I3.forEach,pc=tg("hidden"),vI="Symbol",ZT="prototype",Ile=M3.set,U3=M3.getterFor(vI),Vu=Object[ZT],zg=ZD.Symbol,EI=zg&&zg[ZT],Ale=ZD.TypeError,o1=ZD.QObject,V3=P3.f,Hg=N3.f,F3=O3.f,Ole=k3.f,j3=ple([].push),lf=i1("symbols"),e0=i1("op-symbols"),Ple=i1("wks"),s1=!o1||!o1[ZT]||!o1[ZT].findChild,a1=CE&&mle(function(){return QT(Hg({},"a",{get:function(){return Hg(this,"a",{value:7}).a}})).a!=7})?function(e,n,i){var s=V3(Vu,n);s&&delete Vu[n],Hg(e,n,i),s&&e!==Vu&&Hg(Vu,n,s)}:Hg,c1=function(e,n){var i=lf[e]=QT(EI);return Ile(i,{type:vI,tag:e,description:n}),CE||(i.description=n),i},yI=function(e,n,i){e===Vu&&yI(e0,n,i),t1(e);var s=n1(n);return t1(i),as(lf,s)?(i.enumerable?(as(e,pc)&&e[pc][s]&&(e[pc][s]=!1),i=QT(i,{enumerable:r1(0,!1)})):(as(e,pc)||Hg(e,pc,r1(1,{})),e[pc][s]=!0),a1(e,s,i)):Hg(e,s,i)},l1=function(e,n){t1(e);var i=gI(n),s=A3(i).concat(z3(i));return _I(s,function(c){CE&&!e1(B3,i,c)||yI(e,c,i[c])}),e},B3=function(e){var n=n1(e),i=e1(Ole,this,n);return!(this===Vu&&as(lf,n)&&!as(e0,n))&&(!(i||!as(this,n)||!as(lf,n)||as(this,pc)&&this[pc][n])||i)},W3=function(e,n){var i=gI(e),s=n1(n);if(i!==Vu||!as(lf,s)||as(e0,s)){var c=V3(i,s);return!c||!as(lf,s)||as(i,pc)&&i[pc][s]||(c.enumerable=!0),c}},G3=function(e){var n=F3(gI(e)),i=[];return _I(n,function(s){as(lf,s)||as(L3,s)||j3(i,s)}),i},z3=function(e){var n=e===Vu,i=F3(n?e0:gI(e)),s=[];return _I(i,function(c){!as(lf,c)||n&&!as(Vu,c)||j3(s,lf[c])}),s};IE||(zg=function(){if(gle(EI,this))throw Ale("Symbol is not a constructor");var e=arguments.length&&arguments[0]!==void 0?_le(arguments[0]):void 0,n=x3(e),i=function(s){this===Vu&&e1(i,e0,s),as(this,pc)&&as(this[pc],n)&&(this[pc][n]=!1),a1(this,n,r1(1,s))};return CE&&s1&&a1(Vu,n,{configurable:!0,set:i}),c1(n,e)},D3(EI=zg[ZT],"toString",function(){return U3(this).tag}),D3(zg,"withoutSetter",function(e){return c1(x3(e),e)}),k3.f=B3,N3.f=yI,yle.f=l1,P3.f=W3,vle.f=O3.f=G3,Ele.f=z3,ble.f=function(e){return c1(Tle(e),e)},CE&&Sle(EI,"description",{configurable:!0,get:function(){return U3(this).description}})),mI({global:!0,wrap:!0,forced:!IE,sham:!IE},{Symbol:zg}),_I(A3(Ple),function(e){wle(e)}),mI({target:vI,stat:!0,forced:!IE},{useSetter:function(){s1=!0},useSimple:function(){s1=!1}}),mI({target:"Object",stat:!0,forced:!IE,sham:!CE},{create:function(e,n){return n===void 0?QT(e):l1(QT(e),n)},defineProperty:yI,defineProperties:l1,getOwnPropertyDescriptor:W3}),mI({target:"Object",stat:!0,forced:!IE},{getOwnPropertyNames:G3}),Rle(),Cle(zg,vI),L3[pc]=!0;var H3=_s&&!!Symbol.for&&!!Symbol.keyFor,Nle=Pn,kle=nn,Dle=ui,Lle=na,K3=Ia,xle=H3,u1=K3("string-to-symbol-registry"),Mle=K3("symbol-to-string-registry");Nle({target:"Symbol",stat:!0,forced:!xle},{for:function(e){var n=Lle(e);if(Dle(u1,n))return u1[n];var i=kle("Symbol")(n);return u1[n]=i,Mle[i]=n,i}});var Ule=Pn,Vle=ui,Fle=Uc,jle=Xa,Ble=H3,$3=Ia("symbol-to-string-registry");Ule({target:"Symbol",stat:!0,forced:!Ble},{keyFor:function(e){if(!Fle(e))throw TypeError(jle(e)+" is not a symbol");if(Vle($3,e))return $3[e]}});var q3=Zm,Wle=lt,Y3=Q,Gle=na,X3=O([].push),zle=Pn,J3=nn,Q3=oe,Hle=nt,t0=O,Z3=d,e5=lt,t5=Uc,n5=Ai,Kle=function(e){if(Wle(e))return e;if(q3(e)){for(var n=e.length,i=[],s=0;s<n;s++){var c=e[s];typeof c=="string"?X3(i,c):typeof c!="number"&&Y3(c)!="Number"&&Y3(c)!="String"||X3(i,Gle(c))}var u=i.length,h=!0;return function(p,_){if(h)return h=!1,_;if(q3(this))return _;for(var E=0;E<u;E++)if(i[E]===p)return _}}},$le=_s,qle=String,jp=J3("JSON","stringify"),SI=t0(/./.exec),r5=t0("".charAt),Yle=t0("".charCodeAt),Xle=t0("".replace),Jle=t0(1 .toString),Qle=/[\uD800-\uDFFF]/g,i5=/^[\uD800-\uDBFF]$/,o5=/^[\uDC00-\uDFFF]$/,s5=!$le||Z3(function(){var e=J3("Symbol")();return jp([e])!="[null]"||jp({a:e})!="{}"||jp(Object(e))!="{}"}),a5=Z3(function(){return jp("\uDF06\uD834")!=='"\\udf06\\ud834"'||jp("\uDEAD")!=='"\\udead"'}),Zle=function(e,n){var i=n5(arguments),s=Kle(n);if(e5(s)||e!==void 0&&!t5(e))return i[1]=function(c,u){if(e5(s)&&(u=Hle(s,this,qle(c),u)),!t5(u))return u},Q3(jp,null,i)},eue=function(e,n,i){var s=r5(i,n-1),c=r5(i,n+1);return SI(i5,e)&&!SI(o5,c)||SI(o5,e)&&!SI(i5,s)?"\\u"+Jle(Yle(e,0),16):e};jp&&zle({target:"JSON",stat:!0,forced:s5||a5},{stringify:function(e,n,i){var s=n5(arguments),c=Q3(s5?Zle:jp,null,s);return a5&&typeof c=="string"?Xle(c,Qle,eue):c}});var c5=oc,tue=Es;Pn({target:"Object",stat:!0,forced:!_s||d(function(){c5.f(1)})},{getOwnPropertySymbols:function(e){var n=c5.f;return n?n(tue(e)):[]}}),co("asyncIterator"),co("hasInstance"),co("isConcatSpreadable"),co("iterator"),co("match"),co("matchAll"),co("replace"),co("search"),co("species"),co("split");var nue=R3;co("toPrimitive"),nue();var rue=nn,iue=Ou;co("toStringTag"),iue(rue("Symbol"),"Symbol"),co("unscopables"),Ou(H.JSON,"JSON",!0);var oue=gt.Symbol,sue=sr,aue=Ge.f,l5=sue("metadata"),u5=Function.prototype;u5[l5]===void 0&&aue(u5,l5,{value:null}),co("dispose"),co("metadata");var cue=oue;co("asyncDispose");var lue=O,d1=nn("Symbol"),uue=d1.keyFor,due=lue(d1.prototype.valueOf),d5=d1.isRegisteredSymbol||function(e){try{return uue(due(e))!==void 0}catch{return!1}};Pn({target:"Symbol",stat:!0},{isRegisteredSymbol:d5});for(var hue=Ia,h5=nn,fue=O,pue=Uc,mue=sr,TI=h5("Symbol"),f5=TI.isWellKnownSymbol,p5=h5("Object","getOwnPropertyNames"),gue=fue(TI.prototype.valueOf),m5=hue("wks"),h1=0,g5=p5(TI),_ue=g5.length;h1<_ue;h1++)try{var _5=g5[h1];pue(TI[_5])&&mue(_5)}catch{}var v5=function(e){if(f5&&f5(e))return!0;try{for(var n=gue(e),i=0,s=p5(m5),c=s.length;i<c;i++)if(m5[s[i]]==n)return!0}catch{}return!1};Pn({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:v5}),co("matcher"),co("observable"),Pn({target:"Symbol",stat:!0},{isRegistered:d5}),Pn({target:"Symbol",stat:!0,forced:!0},{isWellKnown:v5}),co("metadataKey"),co("patternMatch"),co("replaceAll");var AE=l(cue),E5=l(RE.f("iterator"));function n0(e){return n0=typeof AE=="function"&&typeof E5=="symbol"?function(n){return typeof n}:function(n){return n&&typeof AE=="function"&&n.constructor===AE&&n!==AE.prototype?"symbol":typeof n},n0(e)}var vue=l(RE.f("toPrimitive"));function Eue(e){var n=function(i,s){if(n0(i)!=="object"||i===null)return i;var c=i[vue];if(c!==void 0){var u=c.call(i,s);if(n0(u)!=="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return(s==="string"?String:Number)(i)}(e,"string");return n0(n)==="symbol"?n:String(n)}function K(e,n,i){return(n=Eue(n))in e?f3(e,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[n]=i,e}var y5=l(Zoe),yue={isBrowser:!0,classes:{URLSearchParams:y5!==void 0?y5:QD,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const f1=typeof window<"u"&&typeof document<"u",p1=typeof navigator=="object"&&navigator||void 0,Sue=f1&&(!p1||["ReactNative","NativeScript","NS"].indexOf(p1.product)<0),Tue=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",bue=f1&&window.location.href||"http://localhost";function S5(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,s)}return i}function T5(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?S5(Object(i),!0).forEach(function(s){K(e,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):S5(Object(i)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(i,s))})}return e}var ca=T5(T5({},Object.freeze({__proto__:null,hasBrowserEnv:f1,hasStandardBrowserEnv:Sue,hasStandardBrowserWebWorkerEnv:Tue,navigator:p1,origin:bue})),yue),wue=Qt,Rue=nt,Cue=ui,Iue=N,Aue=function(){var e=wue(this),n="";return e.hasIndices&&(n+="d"),e.global&&(n+="g"),e.ignoreCase&&(n+="i"),e.multiline&&(n+="m"),e.dotAll&&(n+="s"),e.unicode&&(n+="u"),e.unicodeSets&&(n+="v"),e.sticky&&(n+="y"),n},b5=RegExp.prototype,w5=function(e){var n=e.flags;return n!==void 0||"flags"in b5||Cue(e,"flags")||!Iue(b5,e)?n:Rue(Aue,e)},Oue=Xk.charAt,R5=nt,Pue=Qt,Nue=lt,kue=Q,Due=/./.exec,Lue=TypeError,xue=Pn,C5=nt,I5=le,Mue=Go,bI=yg,A5=bt,O5=At,r0=na,Uue=Qt,Vue=hn,Fue=Q,jue=vR,P5=w5,Bue=Ja,Wue=d,Gue=so,zue=function(e,n,i){return n+(i?Oue(e,n).length:1)},Hue=function(e,n){var i=e.exec;if(Nue(i)){var s=R5(i,e,n);return s!==null&&Pue(s),s}if(kue(e)==="RegExp")return R5(Due,e,n);throw Lue("RegExp#exec called on incompatible receiver")},N5=Cl,Kue=sr("matchAll"),k5="RegExp String",D5=k5+" Iterator",$ue=N5.set,que=N5.getterFor(D5),Yue=TypeError,m1=I5("".indexOf),wI=I5("".matchAll),g1=!!wI&&!Wue(function(){wI("a",/./)}),Xue=Mue(function(e,n,i,s){$ue(this,{type:D5,regexp:e,string:n,global:i,unicode:s,done:!1})},k5,function(){var e=que(this);if(e.done)return bI(void 0,!0);var n=e.regexp,i=e.string,s=Hue(n,i);return s===null?(e.done=!0,bI(void 0,!0)):e.global?(r0(s[0])===""&&(n.lastIndex=zue(i,O5(n.lastIndex),e.unicode)),bI(s,!1)):(e.done=!0,bI(s,!1))}),L5=function(e){var n,i,s,c=Uue(this),u=r0(e),h=Gue(c,RegExp),p=r0(P5(c));return n=new h(h===RegExp?c.source:c,p),i=!!~m1(p,"g"),s=!!~m1(p,"u"),n.lastIndex=O5(c.lastIndex),new Xue(n,u,i,s)};xue({target:"String",proto:!0,forced:g1},{matchAll:function(e){var n,i,s,c,u=A5(this);if(Vue(e)){if(g1)return wI(u,e)}else{if(jue(e)&&(n=r0(A5(P5(e))),!~m1(n,"g")))throw Yue("`.matchAll` does not allow non-global regexes");if(g1)return wI(u,e);if((s=Bue(e,Kue))===void 0&&Fue(e)=="RegExp"&&(s=L5),s)return C5(s,e,u)}return i=r0(u),c=new RegExp(e,"g"),C5(L5,c,i)}});var Jue=Na("String").matchAll,Que=N,Zue=Jue,_1=String.prototype,ede=function(e){var n=e.matchAll;return typeof e=="string"||e===_1||Que(_1,e)&&n===_1.matchAll?Zue:n},tde=l(ede);function x5(e){function n(i,s,c,u){let h=i[u++];if(h==="__proto__")return!0;const p=Number.isFinite(+h),_=u>=i.length;return h=!h&&Je.isArray(c)?c.length:h,_?(Je.hasOwnProp(c,h)?c[h]=[c[h],s]:c[h]=s,!p):(c[h]&&Je.isObject(c[h])||(c[h]=[]),n(i,s,c[h],u)&&Je.isArray(c[h])&&(c[h]=function(E){const S={},w=Object.keys(E);let I;const P=w.length;let B;for(I=0;I<P;I++)B=w[I],S[B]=E[B];return S}(c[h])),!p)}if(Je.isFormData(e)&&Je.isFunction(e.entries)){const i={};return Je.forEachEntry(e,(s,c)=>{n(function(u){return tde(Je).call(Je,/\w+|\[(\w*)]/g,u).map(h=>h[0]==="[]"?"":h[1]||h[0])}(s),c,i,0)}),i}return null}const v1={transitional:l3,adapter:["xhr","http","fetch"],transformRequest:[function(e,n){const i=n.getContentType()||"",s=i.indexOf("application/json")>-1,c=Je.isObject(e);if(c&&Je.isHTMLForm(e)&&(e=new FormData(e)),Je.isFormData(e))return s?JSON.stringify(x5(e)):e;if(Je.isArrayBuffer(e)||Je.isBuffer(e)||Je.isStream(e)||Je.isFile(e)||Je.isBlob(e)||Je.isReadableStream(e))return e;if(Je.isArrayBufferView(e))return e.buffer;if(Je.isURLSearchParams(e))return n.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let u;if(c){if(i.indexOf("application/x-www-form-urlencoded")>-1)return function(h,p){return pI(h,new ca.classes.URLSearchParams,Object.assign({visitor:function(_,E,S,w){return ca.isNode&&Je.isBuffer(_)?(this.append(E,_.toString("base64")),!1):w.defaultVisitor.apply(this,arguments)}},p))}(e,this.formSerializer).toString();if((u=Je.isFileList(e))||i.indexOf("multipart/form-data")>-1){const h=this.env&&this.env.FormData;return pI(u?{"files[]":e}:e,h&&new h,this.formSerializer)}}return c||s?(n.setContentType("application/json",!1),function(h,p,_){if(Je.isString(h))try{return(p||JSON.parse)(h),$o(Je).call(Je,h)}catch(E){if(E.name!=="SyntaxError")throw E}return(_||JSON.stringify)(h)}(e)):e}],transformResponse:[function(e){const n=this.transitional||v1.transitional,i=n&&n.forcedJSONParsing,s=this.responseType==="json";if(Je.isResponse(e)||Je.isReadableStream(e))return e;if(e&&Je.isString(e)&&(i&&!this.responseType||s)){const c=!(n&&n.silentJSONParsing)&&s;try{return JSON.parse(e)}catch(u){if(c)throw u.name==="SyntaxError"?qn.from(u,qn.ERR_BAD_RESPONSE,this,null,this.response):u}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ca.classes.FormData,Blob:ca.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Je.forEach(["delete","get","head","post","put","patch"],e=>{v1.headers[e]={}});var E1=v1;const nde=Je.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),M5=Symbol("internals");function i0(e){var n;return e&&$o(n=String(e)).call(n).toLowerCase()}function RI(e){return e===!1||e==null?e:Je.isArray(e)?e.map(RI):String(e)}function y1(e,n,i,s,c){return Je.isFunction(s)?s.call(this,n,i):(c&&(n=i),Je.isString(n)?Je.isString(s)?n.indexOf(s)!==-1:Je.isRegExp(s)?s.test(n):void 0:void 0)}class CI{constructor(n){n&&this.set(n)}set(n,i,s){const c=this;function u(_,E,S){const w=i0(E);if(!w)throw new Error("header name must be a non-empty string");const I=Je.findKey(c,w);(!I||c[I]===void 0||S===!0||S===void 0&&c[I]!==!1)&&(c[I||E]=RI(_))}const h=(_,E)=>Je.forEach(_,(S,w)=>u(S,w,E));if(Je.isPlainObject(n)||n instanceof this.constructor)h(n,i);else if(Je.isString(n)&&(n=$o(n).call(n))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test($o(p=n).call(p)))h((_=>{const E={};let S,w,I;return _&&_.split(`
`).forEach(function(P){var B,M;I=P.indexOf(":"),S=$o(B=P.substring(0,I)).call(B).toLowerCase(),w=$o(M=P.substring(I+1)).call(M),!S||E[S]&&nde[S]||(S==="set-cookie"?E[S]?E[S].push(w):E[S]=[w]:E[S]=E[S]?E[S]+", "+w:w)}),E})(n),i);else if(Je.isHeaders(n))for(const[_,E]of n.entries())u(E,_,s);else n!=null&&u(i,n,s);var p;return this}get(n,i){if(n=i0(n)){const s=Je.findKey(this,n);if(s){const c=this[s];if(!i)return c;if(i===!0)return function(u){const h=Object.create(null),p=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let _;for(;_=p.exec(u);)h[_[1]]=_[2];return h}(c);if(Je.isFunction(i))return i.call(this,c,s);if(Je.isRegExp(i))return i.exec(c);throw new TypeError("parser must be boolean|regexp|function")}}}has(n,i){if(n=i0(n)){const s=Je.findKey(this,n);return!(!s||this[s]===void 0||i&&!y1(0,this[s],s,i))}return!1}delete(n,i){const s=this;let c=!1;function u(h){if(h=i0(h)){const p=Je.findKey(s,h);!p||i&&!y1(0,s[p],p,i)||(delete s[p],c=!0)}}return Je.isArray(n)?n.forEach(u):u(n),c}clear(n){const i=Object.keys(this);let s=i.length,c=!1;for(;s--;){const u=i[s];n&&!y1(0,this[u],u,n,!0)||(delete this[u],c=!0)}return c}normalize(n){const i=this,s={};return Je.forEach(this,(c,u)=>{var h;const p=Je.findKey(s,u);if(p)return i[p]=RI(c),void delete i[u];const _=n?function(E){return $o(E).call(E).toLowerCase().replace(/([a-z\d])(\w*)/g,(S,w,I)=>w.toUpperCase()+I)}(u):$o(h=String(u)).call(h);_!==u&&delete i[u],i[_]=RI(c),s[_]=!0}),this}concat(){for(var n=arguments.length,i=new Array(n),s=0;s<n;s++)i[s]=arguments[s];return this.constructor.concat(this,...i)}toJSON(n){const i=Object.create(null);return Je.forEach(this,(s,c)=>{s!=null&&s!==!1&&(i[c]=n&&Je.isArray(s)?s.join(", "):s)}),i}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(n=>{let[i,s]=n;return i+": "+s}).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(n){return n instanceof this?n:new this(n)}static concat(n){const i=new this(n);for(var s=arguments.length,c=new Array(s>1?s-1:0),u=1;u<s;u++)c[u-1]=arguments[u];return c.forEach(h=>i.set(h)),i}static accessor(n){const i=(this[M5]=this[M5]={accessors:{}}).accessors,s=this.prototype;function c(u){const h=i0(u);i[h]||(function(p,_){const E=Je.toCamelCase(" "+_);["get","set","has"].forEach(S=>{Object.defineProperty(p,S+E,{value:function(w,I,P){return this[S].call(this,_,w,I,P)},configurable:!0})})}(s,u),i[h]=!0)}return Je.isArray(n)?n.forEach(c):c(n),this}}CI.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),Je.reduceDescriptors(CI.prototype,(e,n)=>{let{value:i}=e,s=n[0].toUpperCase()+n.slice(1);return{get:()=>i,set(c){this[s]=c}}}),Je.freezeMethods(CI);var Fu=CI;function S1(e,n){const i=this||E1,s=n||i,c=Fu.from(s.headers);let u=s.data;return Je.forEach(e,function(h){u=h.call(i,u,c.normalize(),n?n.status:void 0)}),c.normalize(),u}function U5(e){return!(!e||!e.__CANCEL__)}function OE(e,n,i){qn.call(this,e??"canceled",qn.ERR_CANCELED,n,i),this.name="CanceledError"}function V5(e,n,i){const s=i.config.validateStatus;i.status&&s&&!s(i.status)?n(new qn("Request failed with status code "+i.status,[qn.ERR_BAD_REQUEST,qn.ERR_BAD_RESPONSE][Math.floor(i.status/100)-4],i.config,i.request,i)):e(i)}Je.inherits(OE,qn,{__CANCEL__:!0});const II=function(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,s=0;const c=function(u,h){u=u||10;const p=new Array(u),_=new Array(u);let E,S=0,w=0;return h=h!==void 0?h:1e3,function(I){const P=Date.now(),B=_[w];E||(E=P),p[S]=I,_[S]=P;let M=w,U=0;for(;M!==S;)U+=p[M++],M%=u;if(S=(S+1)%u,S===w&&(w=(w+1)%u),P-E<h)return;const $=B&&P-B;return $?Math.round(1e3*U/$):void 0}}(50,250);return function(u,h){let p,_,E=0,S=1e3/h;const w=function(I){E=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),p=null,_&&(clearTimeout(_),_=null),u.apply(null,I)};return[function(){const I=Date.now(),P=I-E;for(var B=arguments.length,M=new Array(B),U=0;U<B;U++)M[U]=arguments[U];P>=S?w(M,I):(p=M,_||(_=setTimeout(()=>{_=null,w(p)},S-P)))},()=>p&&w(p)]}(u=>{const h=u.loaded,p=u.lengthComputable?u.total:void 0,_=h-s,E=c(_);s=h,e({loaded:h,total:p,progress:p?h/p:void 0,bytes:_,rate:E||void 0,estimated:E&&p&&h<=p?(p-h)/E:void 0,event:u,lengthComputable:p!=null,[n?"download":"upload"]:!0})},i)},F5=(e,n)=>{const i=e!=null;return[s=>n[0]({lengthComputable:i,total:e,loaded:s}),n[1]]},j5=e=>function(){for(var n=arguments.length,i=new Array(n),s=0;s<n;s++)i[s]=arguments[s];return Je.asap(()=>e(...i))};var rde=ca.hasStandardBrowserEnv?((e,n)=>i=>(i=new nI(i,ca.origin),e.protocol===i.protocol&&e.host===i.host&&(n||e.port===i.port)))(new nI(ca.origin),ca.navigator&&/(msie|trident)/i.test(ca.navigator.userAgent)):()=>!0,ide=ca.hasStandardBrowserEnv?{write(e,n,i,s,c,u){const h=[e+"="+encodeURIComponent(n)];Je.isNumber(i)&&h.push("expires="+new Date(i).toGMTString()),Je.isString(s)&&h.push("path="+s),Je.isString(c)&&h.push("domain="+c),u===!0&&h.push("secure"),document.cookie=h.join("; ")},read(e){const n=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return n?decodeURIComponent(n[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function B5(e,n){return e&&!function(i){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(i)}(n)?function(i,s){return s?i.replace(/\/?\/$/,"")+"/"+s.replace(/^\/+/,""):i}(e,n):n}function W5(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,s)}return i}const G5=e=>e instanceof Fu?function(n){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?W5(Object(s),!0).forEach(function(c){K(n,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):W5(Object(s)).forEach(function(c){Object.defineProperty(n,c,Object.getOwnPropertyDescriptor(s,c))})}return n}({},e):e;function Kg(e,n){n=n||{};const i={};function s(E,S,w,I){return Je.isPlainObject(E)&&Je.isPlainObject(S)?Je.merge.call({caseless:I},E,S):Je.isPlainObject(S)?Je.merge({},S):Je.isArray(S)?S.slice():S}function c(E,S,w,I){return Je.isUndefined(S)?Je.isUndefined(E)?void 0:s(void 0,E,0,I):s(E,S,0,I)}function u(E,S){if(!Je.isUndefined(S))return s(void 0,S)}function h(E,S){return Je.isUndefined(S)?Je.isUndefined(E)?void 0:s(void 0,E):s(void 0,S)}function p(E,S,w){return w in n?s(E,S):w in e?s(void 0,E):void 0}const _={url:u,method:u,data:u,baseURL:h,transformRequest:h,transformResponse:h,paramsSerializer:h,timeout:h,timeoutMessage:h,withCredentials:h,withXSRFToken:h,adapter:h,responseType:h,xsrfCookieName:h,xsrfHeaderName:h,onUploadProgress:h,onDownloadProgress:h,decompress:h,maxContentLength:h,maxBodyLength:h,beforeRedirect:h,transport:h,httpAgent:h,httpsAgent:h,cancelToken:h,socketPath:h,responseEncoding:h,validateStatus:p,headers:(E,S,w)=>c(G5(E),G5(S),0,!0)};return Je.forEach(Object.keys(Object.assign({},e,n)),function(E){const S=_[E]||c,w=S(e[E],n[E],E);Je.isUndefined(w)&&S!==p||(i[E]=w)}),i}var z5=e=>{const n=Kg({},e);let i,{data:s,withXSRFToken:c,xsrfHeaderName:u,xsrfCookieName:h,headers:p,auth:_}=n;if(n.headers=p=Fu.from(p),n.url=a3(B5(n.baseURL,n.url),e.params,e.paramsSerializer),_&&p.set("Authorization","Basic "+btoa((_.username||"")+":"+(_.password?unescape(encodeURIComponent(_.password)):""))),Je.isFormData(s)){if(ca.hasStandardBrowserEnv||ca.hasStandardBrowserWebWorkerEnv)p.setContentType(void 0);else if((i=p.getContentType())!==!1){const[E,...S]=i?i.split(";").map(w=>$o(w).call(w)).filter(Boolean):[];p.setContentType([E||"multipart/form-data",...S].join("; "))}}if(ca.hasStandardBrowserEnv&&(c&&Je.isFunction(c)&&(c=c(n)),c||c!==!1&&rde(n.url))){const E=u&&h&&ide.read(h);E&&p.set(u,E)}return n},ode=typeof XMLHttpRequest<"u"&&function(e){return new Qe(function(n,i){const s=z5(e);let c=s.data;const u=Fu.from(s.headers).normalize();let h,p,_,E,S,{responseType:w,onUploadProgress:I,onDownloadProgress:P}=s;function B(){E&&E(),S&&S(),s.cancelToken&&s.cancelToken.unsubscribe(h),s.signal&&s.signal.removeEventListener("abort",h)}let M=new XMLHttpRequest;function U(){if(!M)return;const q=Fu.from("getAllResponseHeaders"in M&&M.getAllResponseHeaders());V5(function(ce){n(ce),B()},function(ce){i(ce),B()},{data:w&&w!=="text"&&w!=="json"?M.response:M.responseText,status:M.status,statusText:M.statusText,headers:q,config:e,request:M}),M=null}M.open(s.method.toUpperCase(),s.url,!0),M.timeout=s.timeout,"onloadend"in M?M.onloadend=U:M.onreadystatechange=function(){M&&M.readyState===4&&(M.status!==0||M.responseURL&&M.responseURL.indexOf("file:")===0)&&setTimeout(U)},M.onabort=function(){M&&(i(new qn("Request aborted",qn.ECONNABORTED,e,M)),M=null)},M.onerror=function(){i(new qn("Network Error",qn.ERR_NETWORK,e,M)),M=null},M.ontimeout=function(){let q=s.timeout?"timeout of "+s.timeout+"ms exceeded":"timeout exceeded";const ce=s.transitional||l3;s.timeoutErrorMessage&&(q=s.timeoutErrorMessage),i(new qn(q,ce.clarifyTimeoutError?qn.ETIMEDOUT:qn.ECONNABORTED,e,M)),M=null},c===void 0&&u.setContentType(null),"setRequestHeader"in M&&Je.forEach(u.toJSON(),function(q,ce){M.setRequestHeader(ce,q)}),Je.isUndefined(s.withCredentials)||(M.withCredentials=!!s.withCredentials),w&&w!=="json"&&(M.responseType=s.responseType),P&&([_,S]=II(P,!0),M.addEventListener("progress",_)),I&&M.upload&&([p,E]=II(I),M.upload.addEventListener("progress",p),M.upload.addEventListener("loadend",E)),(s.cancelToken||s.signal)&&(h=q=>{M&&(i(!q||q.type?new OE(null,e,M):q),M.abort(),M=null)},s.cancelToken&&s.cancelToken.subscribe(h),s.signal&&(s.signal.aborted?h():s.signal.addEventListener("abort",h)));const $=function(q){const ce=/^([-+\w]{1,25})(:?\/\/|:)/.exec(q);return ce&&ce[1]||""}(s.url);$&&ca.protocols.indexOf($)===-1?i(new qn("Unsupported protocol "+$+":",qn.ERR_BAD_REQUEST,e)):M.send(c||null)})},sde=(e,n)=>{const{length:i}=e=e?e.filter(Boolean):[];if(n||i){let s,c=new AbortController;const u=function(E){if(!s){s=!0,p();const S=E instanceof Error?E:this.reason;c.abort(S instanceof qn?S:new OE(S instanceof Error?S.message:S))}};let h=n&&setTimeout(()=>{h=null,u(new qn("timeout ".concat(n," of ms exceeded"),qn.ETIMEDOUT))},n);const p=()=>{e&&(h&&clearTimeout(h),h=null,e.forEach(E=>{E.unsubscribe?E.unsubscribe(u):E.removeEventListener("abort",u)}),e=null)};e.forEach(E=>E.addEventListener("abort",u));const{signal:_}=c;return _.unsubscribe=()=>Je.asap(p),_}},ade=Mj,cde=Pl;Pn({target:"Promise",stat:!0,forced:!0},{withResolvers:function(){var e=cde.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}});var lde=Pl,ude=Ko;Pn({target:"Promise",stat:!0,forced:!0},{try:function(e){var n=lde.f(this),i=ude(e);return(i.error?n.reject:n.resolve)(i.value),n.promise}});var T1=l(ade),H5=RE.f("asyncIterator"),dde=l(H5);function b1(e,n){this.v=e,this.k=n}function o0(e){var n,i;function s(u,h){try{var p=e[u](h),_=p.value,E=_ instanceof b1;T1.resolve(E?_.v:_).then(function(S){if(E){var w=u==="return"?"return":"next";if(!_.k||S.done)return s(w,S);S=e[w](S).value}c(p.done?"return":"normal",S)},function(S){s("throw",S)})}catch(S){c("throw",S)}}function c(u,h){switch(u){case"return":n.resolve({value:h,done:!0});break;case"throw":n.reject(h);break;default:n.resolve({value:h,done:!1})}(n=n.next)?s(n.key,n.arg):i=null}this._invoke=function(u,h){return new T1(function(p,_){var E={key:u,arg:h,resolve:p,reject:_,next:null};i?i=i.next=E:(n=i=E,s(u,h))})},typeof e.return!="function"&&(this.return=void 0)}function Zc(e){return function(){return new o0(e.apply(this,arguments))}}function _n(e){return new b1(e,0)}function AI(e){var n={},i=!1;function s(c,u){return i=!0,{done:!1,value:new b1(u=new T1(function(h){h(e[c](u))}),1)}}return n[AE!==void 0&&E5||"@@iterator"]=function(){return this},n.next=function(c){return i?(i=!1,c):s("next",c)},typeof e.throw=="function"&&(n.throw=function(c){if(i)throw i=!1,c;return s("throw",c)}),typeof e.return=="function"&&(n.return=function(c){return i?(i=!1,c):s("return",c)}),n}o0.prototype[typeof AE=="function"&&dde||"@@asyncIterator"]=function(){return this},o0.prototype.next=function(e){return this._invoke("next",e)},o0.prototype.throw=function(e){return this._invoke("throw",e)},o0.prototype.return=function(e){return this._invoke("return",e)};var w1=l(H5);function R1(e){var n,i,s,c=2;for(typeof Symbol<"u"&&(i=w1,s=Symbol.iterator);c--;){if(i&&(n=e[i])!=null)return n.call(e);if(s&&(n=e[s])!=null)return new OI(n.call(e));i="@@asyncIterator",s="@@iterator"}throw new TypeError("Object is not async iterable")}function OI(e){function n(i){if(Object(i)!==i)return Qe.reject(new TypeError(i+" is not an object."));var s=i.done;return Qe.resolve(i.value).then(function(c){return{value:c,done:s}})}return OI=function(i){this.s=i,this.n=i.next},OI.prototype={s:null,n:null,next:function(){return n(this.n.apply(this.s,arguments))},return:function(i){var s=this.s.return;return s===void 0?Qe.resolve({value:i,done:!0}):n(s.apply(this.s,arguments))},throw:function(i){var s=this.s.return;return s===void 0?Qe.reject(i):n(s.apply(this.s,arguments))}},new OI(e)}const hde=function*(e,n){let i=e.byteLength;if(!n||i<n)return void(yield e);let s,c=0;for(;c<i;)s=c+n,yield e.slice(c,s),c=s},fde=function(){var e=Zc(function*(n,i){var s,c=!1,u=!1;try{for(var h,p=R1(pde(n));c=!(h=yield _n(p.next())).done;c=!1){const _=h.value;yield*AI(R1(hde(_,i)))}}catch(_){u=!0,s=_}finally{try{c&&p.return!=null&&(yield _n(p.return()))}finally{if(u)throw s}}});return function(n,i){return e.apply(this,arguments)}}(),pde=function(){var e=Zc(function*(n){if(n[w1])return void(yield*AI(R1(n)));const i=n.getReader();try{for(;;){const{done:s,value:c}=yield _n(i.read());if(s)break;yield c}}finally{yield _n(i.cancel())}});return function(n){return e.apply(this,arguments)}}(),K5=(e,n,i,s)=>{const c=fde(e,n);let u,h=0,p=_=>{u||(u=!0,s&&s(_))};return new ReadableStream({async pull(_){try{const{done:E,value:S}=await c.next();if(E)return p(),void _.close();let w=S.byteLength;if(i){let I=h+=w;i(I)}_.enqueue(new Uint8Array(S))}catch(E){throw p(E),E}},cancel:_=>(p(_),c.return())},{highWaterMark:2})};function $5(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,s)}return i}function q5(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?$5(Object(i),!0).forEach(function(s){K(e,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):$5(Object(i)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(i,s))})}return e}const PI=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",Y5=PI&&typeof ReadableStream=="function",mde=PI&&(typeof TextEncoder=="function"?(X5=new TextEncoder,e=>X5.encode(e)):async e=>new Uint8Array(await new Response(e).arrayBuffer()));var X5;const J5=function(e){try{for(var n=arguments.length,i=new Array(n>1?n-1:0),s=1;s<n;s++)i[s-1]=arguments[s];return!!e(...i)}catch{return!1}},gde=Y5&&J5(()=>{let e=!1;const n=new Request(ca.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!n}),C1=Y5&&J5(()=>Je.isReadableStream(new Response("").body)),NI={stream:C1&&(e=>e.body)};var Q5;PI&&(Q5=new Response,["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!NI[e]&&(NI[e]=Je.isFunction(Q5[e])?n=>n[e]():(n,i)=>{throw new qn("Response type '".concat(e,"' is not supported"),qn.ERR_NOT_SUPPORT,i)})}));const _de=async(e,n)=>{const i=Je.toFiniteNumber(e.getContentLength());return i??(async s=>s==null?0:Je.isBlob(s)?s.size:Je.isSpecCompliantForm(s)?(await new Request(ca.origin,{method:"POST",body:s}).arrayBuffer()).byteLength:Je.isArrayBufferView(s)||Je.isArrayBuffer(s)?s.byteLength:(Je.isURLSearchParams(s)&&(s+=""),Je.isString(s)?(await mde(s)).byteLength:void 0))(n)};var vde=PI&&(async e=>{let{url:n,method:i,data:s,signal:c,cancelToken:u,timeout:h,onDownloadProgress:p,onUploadProgress:_,responseType:E,headers:S,withCredentials:w="same-origin",fetchOptions:I}=z5(e);E=E?(E+"").toLowerCase():"text";let P,B=sde([c,u&&u.toAbortSignal()],h);const M=B&&B.unsubscribe&&(()=>{B.unsubscribe()});let U;try{if(_&&gde&&i!=="get"&&i!=="head"&&(U=await _de(S,s))!==0){let ge,pe=new Request(n,{method:"POST",body:s,duplex:"half"});if(Je.isFormData(s)&&(ge=pe.headers.get("content-type"))&&S.setContentType(ge),pe.body){const[Re,Ve]=F5(U,II(j5(_)));s=K5(pe.body,65536,Re,Ve)}}Je.isString(w)||(w=w?"include":"omit");const $="credentials"in Request.prototype;P=new Request(n,q5(q5({},I),{},{signal:B,method:i.toUpperCase(),headers:S.normalize().toJSON(),body:s,duplex:"half",credentials:$?w:void 0}));let q=await fetch(P);const ce=C1&&(E==="stream"||E==="response");if(C1&&(p||ce&&M)){const ge={};["status","statusText","headers"].forEach(Ze=>{ge[Ze]=q[Ze]});const pe=Je.toFiniteNumber(q.headers.get("content-length")),[Re,Ve]=p&&F5(pe,II(j5(p),!0))||[];q=new Response(K5(q.body,65536,Re,()=>{Ve&&Ve(),M&&M()}),ge)}E=E||"text";let me=await NI[Je.findKey(NI,E)||"text"](q,e);return!ce&&M&&M(),await new Qe((ge,pe)=>{V5(ge,pe,{data:me,headers:Fu.from(q.headers),status:q.status,statusText:q.statusText,config:e,request:P})})}catch($){throw M&&M(),$&&$.name==="TypeError"&&/fetch/i.test($.message)?Object.assign(new qn("Network Error",qn.ERR_NETWORK,e,P),{cause:$.cause||$}):qn.from($,$&&$.code,e,P)}});const I1={http:null,xhr:ode,fetch:vde};Je.forEach(I1,(e,n)=>{if(e){try{Object.defineProperty(e,"name",{value:n})}catch{}Object.defineProperty(e,"adapterName",{value:n})}});const Z5=e=>"- ".concat(e),Ede=e=>Je.isFunction(e)||e===null||e===!1;var e6={getAdapter:e=>{e=Je.isArray(e)?e:[e];const{length:n}=e;let i,s;const c={};for(let u=0;u<n;u++){let h;if(i=e[u],s=i,!Ede(i)&&(s=I1[(h=String(i)).toLowerCase()],s===void 0))throw new qn("Unknown adapter '".concat(h,"'"));if(s)break;c[h||"#"+u]=s}if(!s){const u=Object.entries(c).map(h=>{let[p,_]=h;return"adapter ".concat(p," ")+(_===!1?"is not supported by the environment":"is not available in the build")});throw new qn("There is no suitable adapter to dispatch the request "+(n?u.length>1?`since :
`+u.map(Z5).join(`
`):" "+Z5(u[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return s},adapters:I1};function A1(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new OE(null,e)}function t6(e){return A1(e),e.headers=Fu.from(e.headers),e.data=S1.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),e6.getAdapter(e.adapter||E1.adapter)(e).then(function(n){return A1(e),n.data=S1.call(e,e.transformResponse,n),n.headers=Fu.from(n.headers),n},function(n){return U5(n)||(A1(e),n&&n.response&&(n.response.data=S1.call(e,e.transformResponse,n.response),n.response.headers=Fu.from(n.response.headers))),Qe.reject(n)})}const n6="1.7.9",kI={};["object","boolean","number","function","string","symbol"].forEach((e,n)=>{kI[e]=function(i){return typeof i===e||"a"+(n<1?"n ":" ")+e}});const r6={};kI.transitional=function(e,n,i){function s(c,u){return"[Axios v"+n6+"] Transitional option '"+c+"'"+u+(i?". "+i:"")}return(c,u,h)=>{if(e===!1)throw new qn(s(u," has been removed"+(n?" in "+n:"")),qn.ERR_DEPRECATED);return n&&!r6[u]&&(r6[u]=!0,console.warn(s(u," has been deprecated since v"+n+" and will be removed in the near future"))),!e||e(c,u,h)}},kI.spelling=function(e){return(n,i)=>(console.warn("".concat(i," is likely a misspelling of ").concat(e)),!0)};var DI={assertOptions:function(e,n,i){if(typeof e!="object")throw new qn("options must be an object",qn.ERR_BAD_OPTION_VALUE);const s=Object.keys(e);let c=s.length;for(;c-- >0;){const u=s[c],h=n[u];if(h){const p=e[u],_=p===void 0||h(p,u,e);if(_!==!0)throw new qn("option "+u+" must be "+_,qn.ERR_BAD_OPTION_VALUE)}else if(i!==!0)throw new qn("Unknown option "+u,qn.ERR_BAD_OPTION)}},validators:kI};const xd=DI.validators;let LI=class{constructor(e){this.defaults=e,this.interceptors={request:new c3,response:new c3}}async request(e,n){try{return await this._request(e,n)}catch(i){if(i instanceof Error){let s={};Error.captureStackTrace?Error.captureStackTrace(s):s=new Error;const c=s.stack?s.stack.replace(/^.+\n/,""):"";try{i.stack?c&&!String(i.stack).endsWith(c.replace(/^.+\n.+\n/,""))&&(i.stack+=`
`+c):i.stack=c}catch{}}throw i}}_request(e,n){typeof e=="string"?(n=n||{}).url=e:n=e||{},n=Kg(this.defaults,n);const{transitional:i,paramsSerializer:s,headers:c}=n;i!==void 0&&DI.assertOptions(i,{silentJSONParsing:xd.transitional(xd.boolean),forcedJSONParsing:xd.transitional(xd.boolean),clarifyTimeoutError:xd.transitional(xd.boolean)},!1),s!=null&&(Je.isFunction(s)?n.paramsSerializer={serialize:s}:DI.assertOptions(s,{encode:xd.function,serialize:xd.function},!0)),DI.assertOptions(n,{baseUrl:xd.spelling("baseURL"),withXsrfToken:xd.spelling("withXSRFToken")},!0),n.method=(n.method||this.defaults.method||"get").toLowerCase();let u=c&&Je.merge(c.common,c[n.method]);c&&Je.forEach(["delete","get","head","post","put","patch","common"],P=>{delete c[P]}),n.headers=Fu.concat(u,c);const h=[];let p=!0;this.interceptors.request.forEach(function(P){typeof P.runWhen=="function"&&P.runWhen(n)===!1||(p=p&&P.synchronous,h.unshift(P.fulfilled,P.rejected))});const _=[];let E;this.interceptors.response.forEach(function(P){_.push(P.fulfilled,P.rejected)});let S,w=0;if(!p){const P=[t6.bind(this),void 0];for(P.unshift.apply(P,h),P.push.apply(P,_),S=P.length,E=Qe.resolve(n);w<S;)E=E.then(P[w++],P[w++]);return E}S=h.length;let I=n;for(w=0;w<S;){const P=h[w++],B=h[w++];try{I=P(I)}catch(M){B.call(this,M);break}}try{E=t6.call(this,I)}catch(P){return Qe.reject(P)}for(w=0,S=_.length;w<S;)E=E.then(_[w++],_[w++]);return E}getUri(e){return a3(B5((e=Kg(this.defaults,e)).baseURL,e.url),e.params,e.paramsSerializer)}};Je.forEach(["delete","get","head","options"],function(e){LI.prototype[e]=function(n,i){return this.request(Kg(i||{},{method:e,url:n,data:(i||{}).data}))}}),Je.forEach(["post","put","patch"],function(e){function n(i){return function(s,c,u){return this.request(Kg(u||{},{method:e,headers:i?{"Content-Type":"multipart/form-data"}:{},url:s,data:c}))}}LI.prototype[e]=n(),LI.prototype[e+"Form"]=n(!0)});var xI=LI;class O1{constructor(n){if(typeof n!="function")throw new TypeError("executor must be a function.");let i;this.promise=new Qe(function(c){i=c});const s=this;this.promise.then(c=>{if(!s._listeners)return;let u=s._listeners.length;for(;u-- >0;)s._listeners[u](c);s._listeners=null}),this.promise.then=c=>{let u;const h=new Qe(p=>{s.subscribe(p),u=p}).then(c);return h.cancel=function(){s.unsubscribe(u)},h},n(function(c,u,h){s.reason||(s.reason=new OE(c,u,h),i(s.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(n){this.reason?n(this.reason):this._listeners?this._listeners.push(n):this._listeners=[n]}unsubscribe(n){if(!this._listeners)return;const i=this._listeners.indexOf(n);i!==-1&&this._listeners.splice(i,1)}toAbortSignal(){const n=new AbortController,i=s=>{n.abort(s)};return this.subscribe(i),n.signal.unsubscribe=()=>this.unsubscribe(i),n.signal}static source(){let n;return{token:new O1(function(s){n=s}),cancel:n}}}var yde=O1;const P1={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(P1).forEach(e=>{let[n,i]=e;P1[i]=n});var Sde=P1;const Mo=function e(n){const i=new xI(n),s=G4(xI.prototype.request,i);return Je.extend(s,xI.prototype,i,{allOwnKeys:!0}),Je.extend(s,i,null,{allOwnKeys:!0}),s.create=function(c){return e(Kg(n,c))},s}(E1);Mo.Axios=xI,Mo.CanceledError=OE,Mo.CancelToken=yde,Mo.isCancel=U5,Mo.VERSION=n6,Mo.toFormData=pI,Mo.AxiosError=qn,Mo.Cancel=Mo.CanceledError,Mo.all=function(e){return Qe.all(e)},Mo.spread=function(e){return function(n){return e.apply(null,n)}},Mo.isAxiosError=function(e){return Je.isObject(e)&&e.isAxiosError===!0},Mo.mergeConfig=Kg,Mo.AxiosHeaders=Fu,Mo.formToJSON=e=>x5(Je.isHTMLForm(e)?new FormData(e):e),Mo.getAdapter=e6.getAdapter,Mo.HttpStatusCode=Sde,Mo.default=Mo;var Ls=Mo;const Tde=()=>{};function s0(){const e={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:Tde};return e.promise=new Qe((n,i)=>{e.resolve=s=>{e.isFinished||(e.isResolved=!0,e.isFinished=!0,n(s),e.value=s)},e.reject=s=>{e.isFinished||(e.isRejected=!0,e.isFinished=!0,i(s))}}),e}const MI=new Map,UI=new Map,Md=new Map;let Pi=function(e){return e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.HARMONY_OS="HarmonyOS",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS="Mac OS",e.CHROMIUM_OS="Chromium OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot",e}({}),Nn=function(e){return e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger",e}({});const i6=new Fae;let ju=i6.getResult(),N1=null;function vn(e){if(!N1){ju=i6.getResult();const n=function(p){if(p.engine.name==="Blink"&&p.browser.name!=="WeChat")return Nn.CHROME;switch(p.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return Nn.CHROME;case"Safari":case"Mobile Safari":return Nn.SAFARI;case"Edge":return Nn.EDGE;case"Firefox":return Nn.FIREFOX;case"QQ":case"QQBrowser":return Nn.QQ;case"Opera":return Nn.OPERA;case"WeChat":return Nn.WECHAT;default:return p.browser.name||""}}(ju),i=o6(ju),s=function(p){return p.os.name==="Windows"?p.os.version?p.os.name+" "+p.os.version:p.os.name:p.os.name||""}(ju),c=ju.os.version,u=o6(ju,!1),h=ju.device.type;if(!(n&&i&&s&&c))return{name:n,version:i,os:s,osVersion:c,browserVersion:u,deviceType:h};N1={name:n,version:i,os:s,osVersion:c,browserVersion:u,deviceType:h}}return N1}function o6(e){let n,i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return n=e.engine.name==="Blink"?e.engine.version||"":e.browser.version||"",i?n.split(".")[0]:n}function VI(){return vn().os}function s6(){const e=vn();return"".concat(e.os," ").concat(e.osVersion)}function FI(){const e=vn();return!!(ju.engine.name==="WebKit"&&e.os===Pi.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==Nn.SAFARI||cs()&&e.name!==Nn.SAFARI)}function uf(){return vn().name===Nn.CHROME}function lo(){return vn().name===Nn.SAFARI}function a6(){return vn().name===Nn.EDGE}function Nr(){return vn().name===Nn.FIREFOX}function cs(){return vn().os===Pi.IOS}function a0(e){const n=vn();return!(n.name!==Nn.CHROME||!n.osVersion)&&Number(n.version)>=e}function c6(e){const n=vn();return!(n.name!==Nn.CHROME||!n.osVersion)&&Number(n.version)<e}function k1(e,n,i){const s=vn();return!(s.name!==e||!s.osVersion)&&(i?Number(s.version)>=n&&Number(s.version)<=i:Number(s.version)===n)}function D1(e){const n=vn();return!(n.name!==Nn.EDGE||!n.osVersion)&&Number(n.version)>=e}function l6(e){const n=vn();return!(n.name!==Nn.SAFARI||!n.osVersion)&&Number(n.version)>=e}function u6(e,n,i){const s=vn();if(s.os!==Pi.IOS||!s.osVersion)return!1;const c=s.osVersion.split(".");return n&&Number(c[0])===e&&Number(c[1])<n||Number(c[0])<e}function d6(e,n,i){const s=vn();if(s.name!==Nn.SAFARI||!s.osVersion||!s.browserVersion)return!1;const c=s.browserVersion.split(".");return i?n&&Number(c[0])===e&&Number(c[1])<n||Number(c[0])<e:n?Number(c[0])===e&&Number(c[1])<=n||Number(c[0])<e:Number(c[0])<=e}function L1(e){const n=vn();return!(n.name!==Nn.OPERA||!n.osVersion)&&Number(n.version)>=e}function h6(){const e=vn();if(e.os!==Pi.IOS||!e.osVersion)return!1;const n=e.osVersion.split(".");return Number(n[0])<14||Number(n[0])===14&&Number(n[1])<=6}function PE(){const e=vn();if(e.os!==Pi.IOS||!e.osVersion)return!1;const n=e.osVersion.split(".");return Number(n[0])===15}function x1(){const e=vn();if(e.os!==Pi.IOS||!e.osVersion)return!1;const n=e.osVersion.split(".");return Number(n[0])===16}function f6(){const e=vn();if(e.os!==Pi.IOS||!e.osVersion)return!1;const n=e.osVersion.split(".");return Number(n[0])===15&&Number(n[1])>=1}function Ul(){return lo()&&navigator.maxTouchPoints>0}function p6(){return vn().name===Nn.WECHAT}function m6(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function M1(){const e=VI();return function(){const{deviceType:n}=vn();return n==="mobile"||n==="tablet"}()||e===Pi.ANDROID||e===Pi.IOS||e===Pi.HARMONY_OS}function df(){const e=vn();return e.name!==Nn.EDGE&&e.name!==Nn.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function jI(){return VI()===Pi.ANDROID}function c0(){const e=vn();return jI()&&(e.name===Nn.CHROME||e.name===Nn.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function g6(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,s)}return i}function it(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?g6(Object(i),!0).forEach(function(s){Vt(e,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):g6(Object(i)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(i,s))})}return e}function Vt(e,n,i){return(n=function(s){var c=function(u,h){if(typeof u!="object"||u===null)return u;var p=u[Symbol.toPrimitive];if(p!==void 0){var _=p.call(u,"string");if(typeof _!="object")return _;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(u)}(s);return typeof c=="symbol"?c:String(c)}(n))in e?Object.defineProperty(e,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[n]=i,e}let Y=function(e){return e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",e.DATACHANNEL_FAILED="DATACHANNEL_FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e.INVALID_PLUGIN="INVALID_PLUGIN",e.DISCONNECT_P2P="DISCONNECT_P2P",e.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",e.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",e.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",e.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",e.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",e.PROHIBITED_OPERATION="PROHIBITED_OPERATION",e.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",e.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",e}({}),Ie=class extends Error{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",i=arguments.length>2?arguments[2]:void 0;super(n),Vt(this,"code",void 0),Vt(this,"message",void 0),Vt(this,"data",void 0),Vt(this,"name","AgoraRTCException"),this.code=e,this.message="AgoraRTCError ".concat(this.code,": ").concat(n),this.data=i}toString(){return this.data?"".concat(this.message,`
data: `).concat(JSON.stringify(this.data)):this.message}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",n=arguments.length>1?arguments[1]:void 0;return e==="error"&&(n||console).error(this.toString()),e==="warning"&&(n||console).warn(this.toString()),this}throw(e){throw this.print("error",e),this}};function hf(e,n){if(typeof e!="boolean")throw new Ie(Y.INVALID_PARAMS,"Invalid ".concat(n,": The value is of the boolean type."))}function bi(e,n,i){if(!$e(i).call(i,e))throw new Ie(Y.INVALID_PARAMS,"".concat(n," can only be set as ").concat(JSON.stringify(i)))}function Yn(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(e<i||e>s||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(c){return typeof c=="number"&&c%1==0}(e))throw new Ie(Y.INVALID_PARAMS,"invalid ".concat(n,": the value range is [").concat(i,", ").concat(s,"]. integer only"))}function U1(e,n){if(typeof e!="number"){if(!(e.min||e.max||e.ideal||e.exact))throw new Ie(Y.INVALID_PARAMS,"".concat(n," is not a valid ConstrainLong"));e.min!==void 0&&Yn(e.min,"".concat(n,".min"),0,1/0),e.max!==void 0&&Yn(e.max,"".concat(n,".max"),1,1/0),e.exact!==void 0&&Yn(e.exact,"".concat(n,".exact"),1,1/0),e.ideal!==void 0&&Yn(e.ideal,"".concat(n,".ideal"),1,1/0)}else Yn(e,n,1,1/0)}function Xi(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,c=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(e==null)throw new Ie(Y.INVALID_PARAMS,"".concat(n||"param"," cannot be empty"));if(!_6(e,i,s,c))throw new Ie(Y.INVALID_PARAMS,"Invalid ".concat(n||"string param",": Length of the string: [").concat(i,",").concat(s,"].").concat(c?" ASCII characters only.":""))}function ff(e,n){if(!Array.isArray(e))throw new Ie(Y.INVALID_PARAMS,"".concat(n," should be an array"))}function kr(e){return e==null}function _6(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,s=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof e=="string"&&e.length<=i&&e.length>=n&&(!s||function(c){if(typeof c!="string")return!1;for(let u=0;u<c.length;u+=1){const h=c.charCodeAt(u);if(h<0||h>255)return!1}return!0}(e))}var l0=function(e){return e.COVERED="COVERED",e.POSITION="POSITION",e.SIZE="SIZE",e.STYLE="STYLE",e}(l0||{}),V1=function(e){return e.UNMOUNTED="UNMOUNTED",e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",e}(V1||{});const v6=new class{constructor(){Vt(this,"_clientSize",null),Vt(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),Vt(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),Vt(this,"getStyle",e=>window.getComputedStyle(e,null)),Vt(this,"checkCssVisibleProperty",e=>{var n;let i=!0;const s=this.getStyle(e),{display:c,visibility:u,opacity:h,filter:p}=s;return(c==="none"||$e(n=["hidden","collapse"]).call(n,u)||Number(h)<.1)&&(i=!1),!!i&&(p&&p.split(" ").filter(_=>{var E;const S=_.split("(")[0];return $e(E=["brightness","blur","opacity"]).call(E,S)}).map(_=>{const[E,S]=_.split(/\(|\)/);return[E,Number(S.match(/^[0-9\.]+/))]}).forEach(_=>{const[E,S]=_;switch(E){case"brightness":(S<.1||S>3)&&(i=!1);break;case"blur":S>3&&(i=!1);break;case"opacity":S<.1&&(i=!1)}}),i)}),Vt(this,"checkPropertyUpToAllParentNodes",(e,n)=>{let i=!0,s=!0;const c=h=>n(h);let u=e;for(;u&&s;)c(u)||(i=!1,s=!1),u=u.parentElement,u||(s=!1);return i}),Vt(this,"checkActualCssVisibleIncludeInherit",e=>this.checkPropertyUpToAllParentNodes(e,this.checkCssVisibleProperty)),Vt(this,"getSizeAboutClient",e=>{const{width:n,height:i,left:s,right:c,top:u,bottom:h}=e.getBoundingClientRect(),p=this.getClientWidth(),_=this.getClientHeight();return{width:n,height:i,left:s,right:c,top:u,bottom:h,clientWidth:p,clientHeight:_,clientMin:Math.min(p,_)}}),Vt(this,"checkActualSize",()=>{const{width:e,height:n,clientMin:i}=this._clientSize;return this.checkSizeIsVisible(e,n,i)}),Vt(this,"elementFromPoint",(e,n)=>document.elementFromPoint?document.elementFromPoint(e,n):null),Vt(this,"checkCoverForAPoint",(e,n,i)=>{const s=this.elementFromPoint(e,n);return s!==null&&s!==i}),Vt(this,"getPointPositionList",()=>{const{width:e,height:n,left:i,top:s}=this._clientSize,c=e/6,u=n/6,h=[],p=10**6;for(let _=0;_<5;_++)for(let E=0;E<5;E++){const S=(i*p+(_===0?.1:_===4?(c*_*p-1e5)/p:c*_)*p)/p,w=(s*p+(E===0?.1:E===4?(u*E*p-1e5)/p:u*E)*p)/p;h.push({x:S,y:w})}return[...h]}),Vt(this,"checkElementCover",e=>this.getPointPositionList().map(n=>this.checkCoverForAPoint(n.x,n.y,e)).filter(n=>!!n).length>6),Vt(this,"checkSizeIsVisible",(e,n,i)=>(e>50||i/e<=10)&&(n>50||i/n<=10)),Vt(this,"checkSizeOfPartInClient",()=>{const{left:e,right:n,top:i,bottom:s,clientHeight:c,clientWidth:u,clientMin:h}=this._clientSize;let p,_,E,S;if(e<0)p=0;else{if(!(e<u))return!1;p=e}if(n<0)return!1;if(_=n<u?n:u,i<0)E=0;else{if(!(i<c))return!1;E=i}if(s<0)return!1;S=s<c?s:c;const w=_-p,I=S-E;return this.checkSizeIsVisible(w,I,h)}),Vt(this,"returnHiddenResult",e=>(this._clientSize=null,{visible:!1,reason:e})),Vt(this,"checkOneElementVisible",e=>{if(e instanceof HTMLElement){if(this.checkElementIsMountedOnDom(e)){if(this.checkActualCssVisibleIncludeInherit(e)){if(this._clientSize=this.getSizeAboutClient(e),this.checkElementCover(e))return this.returnHiddenResult(l0.COVERED);{const n=this.checkActualSize(),i=this.checkSizeOfPartInClient();return n&&!i?this.returnHiddenResult(l0.POSITION):n?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(l0.SIZE)}}return this.returnHiddenResult(l0.STYLE)}return this.returnHiddenResult(V1.UNMOUNTED)}return this.returnHiddenResult(V1.INVALID_HTML_ELEMENT)}),Vt(this,"checkElementIsMountedOnDom",e=>this.checkPropertyUpToAllParentNodes(e,n=>n.nodeName.toUpperCase()!=="HTML"?n.parentElement!==null:!!document.documentElement))}};function F1(e){return new TextEncoder().encode(e)}const E6=function(e,n){const i=new Uint8Array(e.byteLength+n.byteLength);return i.set(new Uint8Array(e),0),i.set(new Uint8Array(n),e.byteLength),i},j1=async e=>function(n,i){let s="";return new Uint8Array(n).forEach(c=>{s+=c.toString(i).padStart(2,"0")}),s}(await crypto.subtle.digest("SHA-256",F1(e)),16);let Rr=class{constructor(){Vt(this,"_events",{}),Vt(this,"addListener",this.on)}getListeners(e){return this._events[e]?this._events[e].map(n=>n.listener):[]}on(e,n){this._events[e]||(this._events[e]=[]);const i=this._events[e];this._indexOfListener(i,n)===-1&&i.push({listener:n,once:!1})}once(e,n){this._events[e]||(this._events[e]=[]);const i=this._events[e];this._indexOfListener(i,n)===-1&&i.push({listener:n,once:!0})}off(e,n){if(!this._events[e])return;const i=this._events[e],s=this._indexOfListener(i,n);s!==-1&&i.splice(s,1),this._events[e].length===0&&delete this._events[e]}removeAllListeners(e){e?delete this._events[e]:this._events={}}emit(e){this._events[e]||(this._events[e]=[]);const n=this._events[e].map(u=>u);for(var i=arguments.length,s=new Array(i>1?i-1:0),c=1;c<i;c++)s[c-1]=arguments[c];for(let u=0;u<n.length;u+=1){const h=n[u];h.once&&this.off(e,h.listener),h.listener.apply(this,s||[])}}safeEmit(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),s=1;s<n;s++)i[s-1]=arguments[s];[...this._events[e]||[]].forEach(c=>{c.once&&this.off(e,c.listener);try{c.listener.apply(this,i)}catch(u){console.error("safeEmit event:".concat(e," error ").concat(u==null?void 0:u.toString()))}})}_indexOfListener(e,n){let i=e.length;for(;i--;)if(e[i].listener===n)return i;return-1}},u0=null;function y6(){if(u0)return u0;if(window.electron)return u0=window.electron;if(!window.require)return null;try{return u0=window.require("electron"),u0}catch{return null}}let fi=function(e){return e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.PRELOAD="PRELOAD",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.MASS_SUBSCRIBE="Client.massSubscribe",e.MASS_UNSUBSCRIBE="Client.massUnsubscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",e.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",e.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange",e.CONNECTION_STATE_CHANGE="connectionStateChange",e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",e.IMAGE_MODERATION_UPLOAD="imageModerationUpload",e.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",e}({}),Dr=function(e){return e.TRACER="tracer",e}({});function S6(e){return Yn(e.timeout,"config.timeout",0,1e5),Yn(e.timeoutFactor,"config.timeoutFactor",0,100,!1),Yn(e.maxRetryCount,"config.maxRetryConfig",0,1/0),Yn(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let bde=function(e){return e[e.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",e[e.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",e[e.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",e}({}),Mn=function(e){return e.LEAVE="LEAVE",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.UID_BANNED="UID_BANNED",e.FALLBACK="FALLBACK",e.IP_BANNED="IP_BANNED",e.CHANNEL_BANNED="CHANNEL_BANNED",e.LICENSE_MISSING="LICENSE_MISSING",e.LICENSE_EXPIRED="LICENSE_EXPIRED",e.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",e.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",e.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",e.LICENSE_ILLEGAL="LICENSE_ILLEGAL",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e}({});function d0(e){if(!Array.isArray(e)||e.length<1)return!1;try{e.forEach(n=>{if(!n.urls)throw Error()})}catch{return!1}return!0}function T6(e){return Xi(e.turnServerURL,"turnServerURL"),Xi(e.username,"username"),Xi(e.password,"password"),e.udpport&&Yn(e.udpport,"udpport",1,99999,!0),e.forceturn&&hf(e.forceturn,"forceturn"),e.security&&hf(e.security,"security"),e.tcpport&&Yn(e.tcpport,"tcpport",1,99999,!0),!0}function B1(e){return e.level!==void 0&&bi(e.level,"level",[1,2,3]),e.delay!==void 0&&Yn(e.delay,"delay",0,3e3,!0),!0}let on=function(e){return e.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",e.AUDIO_METADATA="audio-metadata",e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.EXCEPTION="exception",e.ERROR="error",e.P2P_LOST="p2p_lost",e.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",e.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",e.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",e.PUBLISHED_USER_LIST="published-user-list",e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",e.CONTENT_INSPECT_ERROR="content-inspect-error",e.CONTENT_INSPECT_RESULT="content-inspect-result",e.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",e}({}),uo=function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",e}({}),ja=function(e){return e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({}),NE=function(e){return e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({});function ho(e,n){for(var i=arguments.length,s=new Array(i>2?i-2:0),c=2;c<i;c++)s[c-2]=arguments[c];return e.getListeners(n).length===0?Qe.reject(new Ie(Y.UNEXPECTED_ERROR,"can not emit promise")):new Qe((u,h)=>{e.emit(n,...s,u,h)})}function Zn(e,n){if(e.getListeners(n).length===0)return Qe.resolve();for(var i=arguments.length,s=new Array(i>2?i-2:0),c=2;c<i;c++)s[c-2]=arguments[c];return ho(e,n,...s)}function mc(e,n){if(e.getListeners(n).length===0)return null;for(var i=arguments.length,s=new Array(i>2?i-2:0),c=2;c<i;c++)s[c-2]=arguments[c];return h0(e,n,...s)}function h0(e,n){let i=null,s=null;for(var c=arguments.length,u=new Array(c>2?c-2:0),h=2;h<c;h++)u[h-2]=arguments[h];if(e.emit(n,...u,p=>{i=p},p=>{s=p}),s!==null)throw s;if(i===null)throw new Ie(Y.UNEXPECTED_ERROR,"handler is not sync");return i}const ri=new class extends Rr{set networkState(e){this.emit(NE.NETWORK_STATE_CHANGE,e,this._networkState),e===ja.ONLINE?this.emit(NE.ONLINE):e===ja.OFFLINE&&(this.onlineWaiter=new Qe(n=>{this.once(NE.ONLINE,()=>{this.onlineWaiter=void 0,n(ja.ONLINE)})}),this.emit(NE.OFFLINE)),this._networkState=e}get networkState(){return this._networkState}get isOnline(){return this._networkState===ja.ONLINE}constructor(){super(),Vt(this,"_moduleName","network-indicator"),Vt(this,"_networkState",ja.ONLINE),Vt(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=ja.ONLINE}),window.addEventListener("offline",()=>{this.networkState=ja.OFFLINE})}};function BI(e,n){const i=e.indexOf(n);i!==-1&&e.splice(i,1)}function kE(e){const n=[];return e.forEach(i=>{n.indexOf(i)===-1&&n.push(i)}),n}function WI(e){Qe!==void 0?Qe.resolve().then(e):setTimeout(e,0)}function Lr(e){return JSON.parse(JSON.stringify(e))}function $g(e){try{return Lr(e)}catch{return e}}const b6={};function Bp(e,n){b6[n]||(b6[n]=!0,e())}function qg(e){const n=window.atob(e),i=new Uint8Array(new ArrayBuffer(n.length));for(let s=0;s<n.length;s+=1)i[s]=n.charCodeAt(s);return i}function Wp(e){let n="";for(let i=0;i<e.length;i+=1)n+=String.fromCharCode(e[i]);return window.btoa(n)}function w6(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,i=new TextEncoder().encode(e);if(i.length>n)i=i.slice(0,n);else if(i.length<n){const s=new Uint8Array(n);s.set(i),i=s}return i}function R6(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];const s=ka(n).call(n,(h,p)=>h+p.length,0),c=new Uint8Array(new ArrayBuffer(s));let u=0;return n.forEach(h=>{c.set(h,u),u+=h.length}),c}function Ud(e){return window.TextEncoder?new TextEncoder().encode(e).length:e.length}function C6(e){let n=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&e.realFormData&&(e=e.realFormData),e.forEach(i=>{n+=typeof i=="string"?Ud(i):i.size}),n+138}function wde(e){const n=new Ie(Y.TIMEOUT,"timeout");return new Qe((i,s)=>{window.setTimeout(()=>s(n),e)})}function Ji(e){return new Qe(n=>{window.setTimeout(n,e)})}function er(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,n=arguments.length>1?arguments[1]:void 0;const i=Math.random().toString(16).substr(2,e).toLowerCase();return i.length===e?"".concat(n).concat(i):"".concat(n).concat(i)+er(e-i.length,"")}function Yg(){return er(32,"").toUpperCase()}const GI=()=>{},I6=new class{constructor(){Vt(this,"fnMap",new Map)}throttleByKey(e,n,i,s){for(var c=arguments.length,u=new Array(c>4?c-4:0),h=4;h<c;h++)u[h-4]=arguments[h];if(this.fnMap.has(n)){const p=this.fnMap.get(n);if(p.threshold!==i){p.fn(...p.args),clearTimeout(p.timer);const _=window.setTimeout(()=>{const E=this.fnMap.get(n);E&&E.fn(...E.args),this.fnMap.delete(n)},i);this.fnMap.set(n,{fn:e,threshold:i,timer:_,args:u,skipFn:s})}else p.skipFn&&p.skipFn(...p.args),this.fnMap.set(n,it(it({},p),{},{fn:e,args:u,skipFn:s}))}else{const p=window.setTimeout(()=>{const _=this.fnMap.get(n);_&&_.fn(..._.args),this.fnMap.delete(n)},i);this.fnMap.set(n,{fn:e,threshold:i,timer:p,args:u,skipFn:s})}}},A6=I6.throttleByKey.bind(I6);function O6(e){return typeof e=="object"&&e!==null&&!(e instanceof RegExp)}function W1(e,n){if(!O6(e)||!O6(n)||Array.isArray(e)&&!Array.isArray(n)||!Array.isArray(e)&&Array.isArray(n))return n;if(Array.isArray(n)&&Array.isArray(e)){const i=[...e];for(let s=0;s<n.length;s++)i[s]=W1(e[s],n[s]);return i}{const i=it({},e);for(const s in n)Object.prototype.hasOwnProperty.call(n,s)&&(Object.prototype.hasOwnProperty.call(e,s)?i[s]=W1(e[s],n[s]):i[s]=n[s]);return i}}function P6(e,n){let i=[0];if(i=new Array(n).fill(0),e===0)return i;let s=0;for(;e>0&&(i[s]=255&e,e>>=8,s++,s!==n););return i}function G1(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function N6(e){const n="0123456789abcdef";function i(ce){let me,ge="";for(me=0;me<=3;me++)ge+=n.charAt(ce>>8*me+4&15)+n.charAt(ce>>8*me&15);return ge}function s(ce,me){const ge=(65535&ce)+(65535&me);return(ce>>16)+(me>>16)+(ge>>16)<<16|65535&ge}function c(ce,me,ge,pe,Re,Ve){return s(function(Ze,rt){return Ze<<rt|Ze>>>32-rt}(s(s(me,ce),s(pe,Ve)),Re),ge)}function u(ce,me,ge,pe,Re,Ve,Ze){return c(me&ge|~me&pe,ce,me,Re,Ve,Ze)}function h(ce,me,ge,pe,Re,Ve,Ze){return c(me&pe|ge&~pe,ce,me,Re,Ve,Ze)}function p(ce,me,ge,pe,Re,Ve,Ze){return c(me^ge^pe,ce,me,Re,Ve,Ze)}function _(ce,me,ge,pe,Re,Ve,Ze){return c(ge^(me|~pe),ce,me,Re,Ve,Ze)}const E=function(ce){let me;const ge=1+(ce.length+8>>6),pe=new Array(16*ge);for(me=0;me<16*ge;me++)pe[me]=0;for(me=0;me<ce.length;me++)pe[me>>2]|=ce.charCodeAt(me)<<me%4*8;return pe[me>>2]|=128<<me%4*8,pe[16*ge-2]=8*ce.length,pe}(e);let S,w,I,P,B,M=1732584193,U=-271733879,$=-1732584194,q=271733878;for(S=0;S<E.length;S+=16)w=M,I=U,P=$,B=q,M=u(M,U,$,q,E[S+0],7,-680876936),q=u(q,M,U,$,E[S+1],12,-389564586),$=u($,q,M,U,E[S+2],17,606105819),U=u(U,$,q,M,E[S+3],22,-1044525330),M=u(M,U,$,q,E[S+4],7,-176418897),q=u(q,M,U,$,E[S+5],12,1200080426),$=u($,q,M,U,E[S+6],17,-1473231341),U=u(U,$,q,M,E[S+7],22,-45705983),M=u(M,U,$,q,E[S+8],7,1770035416),q=u(q,M,U,$,E[S+9],12,-1958414417),$=u($,q,M,U,E[S+10],17,-42063),U=u(U,$,q,M,E[S+11],22,-1990404162),M=u(M,U,$,q,E[S+12],7,1804603682),q=u(q,M,U,$,E[S+13],12,-40341101),$=u($,q,M,U,E[S+14],17,-1502002290),U=u(U,$,q,M,E[S+15],22,1236535329),M=h(M,U,$,q,E[S+1],5,-165796510),q=h(q,M,U,$,E[S+6],9,-1069501632),$=h($,q,M,U,E[S+11],14,643717713),U=h(U,$,q,M,E[S+0],20,-373897302),M=h(M,U,$,q,E[S+5],5,-701558691),q=h(q,M,U,$,E[S+10],9,38016083),$=h($,q,M,U,E[S+15],14,-660478335),U=h(U,$,q,M,E[S+4],20,-405537848),M=h(M,U,$,q,E[S+9],5,568446438),q=h(q,M,U,$,E[S+14],9,-1019803690),$=h($,q,M,U,E[S+3],14,-187363961),U=h(U,$,q,M,E[S+8],20,1163531501),M=h(M,U,$,q,E[S+13],5,-1444681467),q=h(q,M,U,$,E[S+2],9,-51403784),$=h($,q,M,U,E[S+7],14,1735328473),U=h(U,$,q,M,E[S+12],20,-1926607734),M=p(M,U,$,q,E[S+5],4,-378558),q=p(q,M,U,$,E[S+8],11,-2022574463),$=p($,q,M,U,E[S+11],16,1839030562),U=p(U,$,q,M,E[S+14],23,-35309556),M=p(M,U,$,q,E[S+1],4,-1530992060),q=p(q,M,U,$,E[S+4],11,1272893353),$=p($,q,M,U,E[S+7],16,-155497632),U=p(U,$,q,M,E[S+10],23,-1094730640),M=p(M,U,$,q,E[S+13],4,681279174),q=p(q,M,U,$,E[S+0],11,-358537222),$=p($,q,M,U,E[S+3],16,-722521979),U=p(U,$,q,M,E[S+6],23,76029189),M=p(M,U,$,q,E[S+9],4,-640364487),q=p(q,M,U,$,E[S+12],11,-421815835),$=p($,q,M,U,E[S+15],16,530742520),U=p(U,$,q,M,E[S+2],23,-995338651),M=_(M,U,$,q,E[S+0],6,-198630844),q=_(q,M,U,$,E[S+7],10,1126891415),$=_($,q,M,U,E[S+14],15,-1416354905),U=_(U,$,q,M,E[S+5],21,-57434055),M=_(M,U,$,q,E[S+12],6,1700485571),q=_(q,M,U,$,E[S+3],10,-1894986606),$=_($,q,M,U,E[S+10],15,-1051523),U=_(U,$,q,M,E[S+1],21,-2054922799),M=_(M,U,$,q,E[S+8],6,1873313359),q=_(q,M,U,$,E[S+15],10,-30611744),$=_($,q,M,U,E[S+6],15,-1560198380),U=_(U,$,q,M,E[S+13],21,1309151649),M=_(M,U,$,q,E[S+4],6,-145523070),q=_(q,M,U,$,E[S+11],10,-1120210379),$=_($,q,M,U,E[S+2],15,718787259),U=_(U,$,q,M,E[S+9],21,-343485551),M=s(M,w),U=s(U,I),$=s($,P),q=s(q,B);return i(M)+i(U)+i($)+i(q)}let Rde=1,k6=console,To=class{static setLogger(e){k6=e}constructor(e,n){Vt(this,"id",void 0),Vt(this,"lockingPromise",Qe.resolve()),Vt(this,"locks",0),Vt(this,"name",""),Vt(this,"lockId",void 0),this.lockId=Rde++,e&&(this.name=e),n&&(this.id=n),this.logger("created")}logger(e,n){const i=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),s=e==="created"?"is ".concat(e,"."):"is ".concat(e,", current queue ").concat(this.locks,". ").concat(n??"");k6.debug("".concat(i," ").concat(s))}setId(e){this.id=e}get isLocked(){return this.locks>0}lock(e){let n;this.locks+=1,this.logger("locked",e);const i=new Qe(c=>{n=()=>{this.locks-=1,this.logger("unlocked",e),c()}}),s=this.lockingPromise.then(()=>n);return this.lockingPromise=this.lockingPromise.then(()=>i),s}};function DE(e,n){return function(i,s,c){const u=c.value;if(typeof u!="function")throw new Error("Cannot use mutex on object property.");return c.value=async function(){const h=this[n];if(!h)throw new Error("mutex property key ".concat(n," doesn't exist on ").concat(e));const p=await h.lock("From ".concat(e,".").concat(s));try{for(var _=arguments.length,E=new Array(_),S=0;S<_;S++)E[S]=arguments[S];return await u.apply(this,E)}finally{p()}},c}}const pi={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function z1(e,n){const i=Math.floor(n.timeout*Math.pow(n.timeoutFactor,e));return Math.min(n.maxRetryTimeout,i)}function Bu(e,n,i,s){const c=Object.assign({},pi,s);let u=c.timeout;const h=async()=>{await function(E){return new Qe(S=>{window.setTimeout(S,E)})}(u),u*=c.timeoutFactor,u=Math.min(c.maxRetryTimeout,u)};let p=!1;const _=new Qe(async(E,S)=>{n=n||(()=>!1),i=i||(()=>!0);for(let w=0;w<c.maxRetryCount;w+=1){if(p)return S(new Ie(Y.OPERATION_ABORTED));try{const I=await e();if(!n(I,w)||w+1===c.maxRetryCount)return E(I);await h()}catch(I){if(!i(I,w)||w+1===c.maxRetryCount)return S(I);await h()}}});return _.cancel=()=>p=!0,_}let zI,D6=class{constructor(e){Vt(this,"input",[]),Vt(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}mean(){var e;return this.input.length===0?0:ka(e=this.input).call(e,(n,i)=>n+i)/this.input.length}},HI=0,H1=0;function K1(e,n,i,s){return new Qe((c,u)=>{n.responseType=n.responseType||"json",n.data&&!i?(n.data=JSON.stringify(n.data),HI+=Ud(n.data)):i&&(n.data.size?HI+=n.data.size:n.data instanceof FormData?HI+=C6(n.data):HI+=Ud(JSON.stringify(n.data))),n.headers=n.headers||{},n.headers["Content-Type"]=n.headers["Content-Type"]||"application/json",n.method="POST",n.url=e,Ls.request(n).then(h=>{typeof h.data=="string"?H1+=Ud(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?H1+=h.data.byteLength:H1+=Ud(JSON.stringify(h.data)),c(h.data)}).catch(h=>{Ls.isCancel(h)?u(new Ie(Y.OPERATION_ABORTED,"cancel token canceled")):h.code==="ECONNABORTED"?u(new Ie(Y.NETWORK_TIMEOUT,h.message)):h.response?u(new Ie(Y.NETWORK_RESPONSE_ERROR,h.response.status)):u(new Ie(Y.NETWORK_ERROR,h.message))})})}async function Cde(e,n){const i=new Blob([n.data],{type:"buffer"});return await K1(e,it(it({},n),{},{data:i,headers:{"Content-Type":"application/octet-stream"}}),!0)}const L6=()=>window.isSecureContext!==void 0;function Vl(e){if(Array.isArray(e))return e.map(i=>i);if(!x6(e))return e;const n={};for(const i in e){const s=e[i];x6(s)||Array.isArray(s)?n[i]=Vl(s):n[i]=s}return n}function x6(e){return!(typeof e!="object"||Array.isArray(e)||!e)}let $1=class{constructor(e){Vt(this,"input",[]),Vt(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}};const Vd={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},f0={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:Vd,remoteCandidate:Vd},updateInterval:0},M6={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},U6={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},V6={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},F6={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0};let q1=class{constructor(e,n){Vt(this,"onFirstVideoReceived",void 0),Vt(this,"onFirstVideoDecoded",void 0),Vt(this,"onFirstAudioReceived",void 0),Vt(this,"onFirstVideoDecodedTimeout",void 0),Vt(this,"onFirstAudioDecoded",void 0),Vt(this,"onSelectedLocalCandidateChanged",void 0),Vt(this,"onSelectedRemoteCandidateChanged",void 0),Vt(this,"videoIsReady",!1),Vt(this,"videoIsReady2",{}),Vt(this,"pc",void 0),Vt(this,"options",void 0),Vt(this,"intervalTimer",void 0),Vt(this,"stats",Vl(f0)),Vt(this,"isFirstVideoReceived",{}),Vt(this,"isFirstVideoDecoded",{}),Vt(this,"isFirstAudioReceived",{}),Vt(this,"isFirstAudioDecoded",{}),Vt(this,"isFirstVideoDecodedTimeout",{}),Vt(this,"lossRateWindowStats",[]),this.pc=e,this.options=n,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new Qe(e=>{e({local:it({},Vd),remote:it({},Vd)})})}setVideoIsReady(e){this.videoIsReady=e}setVideoIsReady2(e,n){this.videoIsReady2[e]=n}getVideoIsReady(e){return this.videoIsReady2[e]||!1}setIsFirstAudioDecoded(e){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(e){this.lossRateWindowStats.push(e),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const n=this.lossRateWindowStats.length,i=["videoSend","audioSend","videoRecv","audioRecv"];let s=0,c=0,u=0,h=0;for(const p of i)e[p].forEach((_,E)=>{if(!this.lossRateWindowStats[n-1][p][E]||!this.lossRateWindowStats[0][p][E])return;const S=this.lossRateWindowStats[n-1][p][E].packets-this.lossRateWindowStats[0][p][E].packets,w=this.lossRateWindowStats[n-1][p][E].packetsLost-this.lossRateWindowStats[0][p][E].packetsLost;p==="videoSend"||p==="audioSend"?(s+=S,u+=w):(c+=S,h+=w),Number.isNaN(S)||Number.isNaN(S)?_.packetLostRate=0:_.packetLostRate=S<=0||w<=0?0:w/(S+w)});e.sendPacketLossRate=s<=0||u<=0?0:u/(s+u),e.recvPacketLossRate=c<=0||h<=0?0:h/(c+h)}},Ide=class extends q1{constructor(){super(...arguments),Vt(this,"_stats",f0),Vt(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const e=await this._getStats(),n=this.statsResponsesToObjects(e);this._stats=Vl(f0);const i=n.filter(c=>c.type==="ssrc");this.processSSRCStats(i);const s=n.find(c=>c.type==="VideoBwe");s&&this.processBandwidthStats(s),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(e){this._stats.bitrate={actualEncoded:Number(e.googActualEncBitrate),targetEncoded:Number(e.googTargetEncBitrate),retransmit:Number(e.googRetransmitBitrate),transmit:Number(e.googTransmitBitrate)},this._stats.sendBandwidth=Number(e.googAvailableSendBandwidth)}processSSRCStats(e){e.forEach(n=>{var i;const s=$e(i=n.id).call(i,"send");switch("".concat(n.mediaType,"_").concat(s?"send":"recv")){case"video_send":{const c=Vl(U6);c.codec=n.googCodecName,c.adaptionChangeReason="none",n.googCpuLimitedResolution&&(c.adaptionChangeReason="cpu"),n.googBandwidthLimitedResolution&&(c.adaptionChangeReason="bandwidth"),c.avgEncodeMs=Number(n.googAvgEncodeMs),c.inputFrame={width:Number(n.googFrameWidthInput)||Number(n.googFrameWidthSent),height:Number(n.googFrameHeightInput)||Number(n.googFrameHeightSent),frameRate:Number(n.googFrameRateInput)},c.sentFrame={width:Number(n.googFrameWidthSent),height:Number(n.googFrameHeightSent),frameRate:Number(n.googFrameRateInput)},c.firsCount=Number(n.googFirReceived),c.nacksCount=Number(n.googNacksReceived),c.plisCount=Number(n.googPlisReceived),c.frameCount=Number(n.framesEncoded),c.bytes=Number(n.bytesSent),c.packets=Number(n.packetsSent),c.packetsLost=Number(n.packetsLost),c.ssrc=Number(n.ssrc),c.rttMs=Number(n.googRtt||0),this._stats.videoSend.push(c),this._stats.rtt=c.rttMs;break}case"video_recv":{const c=Vl(M6),u=this.lastDecodeVideoReceiverStats.get(Number(n.ssrc));if(c.codec=n.googCodecName,c.targetDelayMs=Number(n.googTargetDelayMs),c.renderDelayMs=Number(n.googRenderDelayMs),c.currentDelayMs=Number(n.googCurrentDelayMs),c.minPlayoutDelayMs=Number(n.googMinPlayoutDelayMs),c.decodeMs=Number(n.googDecodeMs),c.maxDecodeMs=Number(n.googMaxDecodeMs),c.receivedFrame={width:Number(n.googFrameWidthReceived),height:Number(n.googFrameHeightReceived),frameRate:Number(n.googFrameRateReceived)},c.decodedFrame={width:Number(n.googFrameWidthReceived),height:Number(n.googFrameHeightReceived),frameRate:Number(n.googFrameRateDecoded)},c.decodeFrameRate=Number(n.googFrameRateDecoded),c.outputFrame={width:Number(n.googFrameWidthReceived),height:Number(n.googFrameHeightReceived),frameRate:Number(n.googFrameRateOutput)},c.jitterBufferMs=Number(n.googJitterBufferMs),c.firsCount=Number(n.googFirsSent),c.nacksCount=Number(n.googNacksSent),c.plisCount=Number(n.googPlisSent),c.framesDecodeCount=Number(n.framesDecoded),c.bytes=Number(n.bytesReceived),c.packets=Number(n.packetsReceived),c.packetsLost=Number(n.packetsLost),c.ssrc=Number(n.ssrc),c.packets>0&&!this.isFirstVideoReceived[c.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(c.ssrc),this.isFirstVideoReceived[c.ssrc]=!0),c.framesDecodeCount>0&&!this.isFirstVideoDecoded[c.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(c.ssrc,c.decodedFrame.width,c.decodedFrame.height),this.isFirstVideoDecoded[c.ssrc]=!0),u){const h=u.stats,p=Date.now()-u.lts;c.framesDecodeFreezeTime=h.framesDecodeFreezeTime,c.framesDecodeInterval=h.framesDecodeInterval,c.framesDecodeCount>h.framesDecodeCount&&this.isFirstVideoDecoded[c.ssrc]?(u.lts=Date.now(),c.framesDecodeInterval=p,c.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(n.ssrc,10))?c.framesDecodeFreezeTime+=c.framesDecodeInterval:this.setVideoIsReady2(parseInt(n.ssrc,10),!0))):c.framesDecodeCount<u.stats.framesDecodeCount&&(c.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(c.ssrc,{stats:it({},c),lts:Date.now()}),this._stats.videoRecv.push(c);break}case"audio_recv":{const c=Vl(F6);c.codec=n.googCodecName,c.outputLevel=Math.abs(Number(n.audioOutputLevel))/32767,c.decodingCNG=Number(n.googDecodingCNG),c.decodingCTN=Number(n.googDecodingCTN),c.decodingCTSG=Number(n.googDecodingCTSG),c.decodingNormal=Number(n.googDecodingNormal),c.decodingPLC=Number(n.googDecodingPLC),c.decodingPLCCNG=Number(n.googDecodingPLCCNG),c.expandRate=Number(n.googExpandRate),c.accelerateRate=Number(n.googAccelerateRate),c.preemptiveExpandRate=Number(n.googPreemptiveExpandRate),c.secondaryDecodedRate=Number(n.googSecondaryDecodedRate),c.speechExpandRate=Number(n.googSpeechExpandRate),c.preferredJitterBufferMs=Number(n.googPreferredJitterBufferMs),c.jitterBufferMs=Number(n.googJitterBufferMs),c.jitterMs=Number(n.googJitterReceived),c.bytes=Number(n.bytesReceived),c.packets=Number(n.packetsReceived),c.packetsLost=Number(n.packetsLost),c.ssrc=Number(n.ssrc),c.receivedFrames=Number(n.googDecodingCTN)||Number(n.packetsReceived),c.droppedFrames=Number(n.googDecodingPLC)+Number(n.googDecodingPLCCNG)||Number(n.packetsLost),c.receivedFrames>0&&!this.isFirstAudioReceived[c.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(c.ssrc),this.isFirstAudioReceived[c.ssrc]=!0),c.decodingNormal>0&&!this.isFirstAudioDecoded[c.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(c.ssrc),this.isFirstAudioDecoded[c.ssrc]=!0),this._stats.audioRecv.push(c);break}case"audio_send":{const c=Vl(V6);c.codec=n.googCodecName,c.inputLevel=Math.abs(Number(n.audioInputLevel))/32767,c.aecReturnLoss=Number(n.googEchoCancellationReturnLoss||0),c.aecReturnLossEnhancement=Number(n.googEchoCancellationReturnLossEnhancement||0),c.residualEchoLikelihood=Number(n.googResidualEchoLikelihood||0),c.residualEchoLikelihoodRecentMax=Number(n.googResidualEchoLikelihoodRecentMax||0),c.bytes=Number(n.bytesSent),c.packets=Number(n.packetsSent),c.packetsLost=Number(n.packetsLost),c.ssrc=Number(n.ssrc),c.rttMs=Number(n.googRtt||0),this._stats.rtt=c.rttMs,this._stats.audioSend.push(c);break}}})}_getStats(){return new Qe((e,n)=>{this.pc.getStats(e,n)})}statsResponsesToObjects(e){const n=[];return e.result().forEach(i=>{const s={id:i.id,timestamp:i.timestamp.valueOf().toString(),type:i.type};i.names().forEach(c=>{s[c]=i.stat(c)}),n.push(s)}),n}},p0=function(e){return e.BANDWIDTH="bandwidth",e.CPU="cpu",e.NONE="none",e.OTHER="other",e}({}),KI=function(e){return e.L1T1="L1T1",e.L1T2="L1T2",e.L1T3="L1T3",e.L1T3_KEY="L1T3_KEY",e.L2T1_KEY="L2T1_KEY",e.L2T2_KEY="L2T2_KEY",e.L2T3_KEY="L2T3_KEY",e.L3T1_KEY="L3T1_KEY",e.L3T2_KEY="L3T2_KEY",e.L3T3_KEY="L3T3_KEY",e}({}),Y1=function(e){return e[e.new=0]="new",e[e.connecting=1]="connecting",e[e.connected=2]="connected",e[e.disconnected=3]="disconnected",e[e.failed=4]="failed",e[e.closed=5]="closed",e}({}),gc=function(e){return e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver",e}({});var LE=function(e){return e[e.kNone=1]="kNone",e[e.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",e[e.kBytesToBits=8]="kBytesToBits",e}(LE||{});function m0(e,n,i,s){let c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:LE.kNone;if(!n)return;const u=Number(n[i]);if(typeof u!="number")return;const h=Number(n[s]);if(typeof h!="number")return;if(!e)return h?u/h*c:void 0;const p=Number(e[i]);if(typeof p!="number")return;const _=Number(e[s]);if(typeof _!="number")return;const E=h-_;return E?(u-p)/E*c:void 0}let j6=class extends q1{constructor(){super(...arguments),Vt(this,"_stats",f0),Vt(this,"report",void 0),Vt(this,"lastDecodeVideoReceiverStats",new Map),Vt(this,"lastVideoFramesRecv",new Map),Vt(this,"lastVideoFramesSent",new Map),Vt(this,"lastVideoFramesDecode",new Map),Vt(this,"lastVideoFramesOutput",new Map),Vt(this,"lastVideoJBDelay",new Map),Vt(this,"lastAudioJBDelay",new Map),Vt(this,"mediaBytesSent",new Map),Vt(this,"mediaBytesRetransmit",new Map),Vt(this,"mediaBytesTargetEncode",new Map),Vt(this,"lastDecodeAudioReceiverStats",new Map),Vt(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=Vl(f0),this.report.forEach(e=>{switch(e.type){case gc.OUTBOUND:case gc.INBOUND:{const n=e.mediaType||e.kind,i=!n&&"frameWidth"in e,s=!n&&!("frameWidth"in e);e.type===gc.OUTBOUND?n==="audio"||s?this.processAudioOutboundStats(e):(n==="video"||i)&&this.processVideoOutboundStats(e):e.type===gc.INBOUND&&(n==="audio"||s?this.processAudioInboundStats(e):(n==="video"||i)&&this.processVideoInboundStats(e));break}case gc.TRANSPORT:{const n=this.report.get(e.selectedCandidatePairId);n&&this.processCandidatePairStats(n);break}case gc.CANDIDATE_PAIR:e.selected&&this.processCandidatePairStats(e)}}),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const e=await this.pc.getStats(),n={local:it({},Vd),remote:it({},Vd)};return e.forEach(i=>{let s;if(i.type===gc.TRANSPORT&&(s=e.get(i.selectedCandidatePairId)),i.type===gc.CANDIDATE_PAIR&&i.selected&&(s=i),s){const c=(u,h)=>{u.type=h.type,u.id=h.id,h.address&&(u.address=h.address),h.candidateType&&(u.candidateType=h.candidateType),h.port&&(u.port=h.port),h.priority&&(u.priority=h.priority),h.protocol&&(u.protocol=h.protocol),h.relayProtocol&&(u.relayProtocol=h.relayProtocol)};if(s.localCandidateId){const u=e.get(s.localCandidateId);u&&c(n.local,u)}if(s.remoteCandidateId){const u=e.get(s.remoteCandidateId);u&&c(n.remote,u)}}}),n}processCandidatePairStats(e){if(this._stats.sendBandwidth=e.availableOutgoingBitrate||0,e.currentRoundTripTime&&(this._stats.rtt=1e3*e.currentRoundTripTime),this._stats.videoSend.forEach(n=>{e.currentRoundTripTime&&(n.rttMs=1e3*e.currentRoundTripTime)}),this._stats.audioSend.forEach(n=>{e.currentRoundTripTime&&(n.rttMs=1e3*e.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=e.id,e.localCandidateId){const n=this.report.get(e.localCandidateId);n&&this.processCandidateStats(n)}if(e.remoteCandidateId){const n=this.report.get(e.remoteCandidateId);n&&this.processCandidateStats(n)}}processCandidateStats(e){let n;e.type===gc.LOCAL_CANDIDATE&&(n=this._stats.selectedCandidatePair.localCandidate),e.type===gc.REMOTE_CANDIDATE&&(n=this._stats.selectedCandidatePair.remoteCandidate),n&&(n.type=e.type,n.id=e.id,e.address&&(n.address=e.address),e.candidateType&&(n.candidateType=e.candidateType),e.port&&(n.port=e.port),e.priority&&(n.priority=e.priority),e.protocol&&(n.protocol=e.protocol),e.relayProtocol&&(n.relayProtocol=e.relayProtocol),e.type===gc.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==n.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(it({},n),it({},this.stats.selectedCandidatePair.localCandidate)),e.type===gc.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==n.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(it({},n),it({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(e){let n=this._stats.audioRecv.find(s=>s.ssrc===e.ssrc);n||(n=Vl(F6),this._stats.audioRecv.push(n)),n.ssrc=e.ssrc,n.packets=e.packetsReceived,n.packetsLost=e.packetsLost,n.packetsDiscarded=e.packetsDiscarded,n.bytes=e.bytesReceived,n.jitterMs=1e3*e.jitter,n.retransmittedBytesReceived=e.retransmittedBytesReceived,n.retransmittedPacketsReceived=e.retransmittedPacketsReceived,n.totalProcessingDelay=e.totalProcessingDelay,n.jitterBufferEmittedCount=e.jitterBufferEmittedCount;const i=this.lastDecodeAudioReceiverStats.get(n.ssrc);n.avgProcessingDelayMs=m0(i,n,"totalProcessingDelay","jitterBufferEmittedCount",LE.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(e,e.trackId,n),e.codecId&&(n.codec=this.getCodecFromCodecStats(e.codecId)),n.receivedFrames||(n.receivedFrames=e.packetsReceived),n.droppedFrames||(n.droppedFrames=e.packetsLost),n.receivedFrames>0&&!this.isFirstAudioReceived[n.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(n.ssrc),this.isFirstAudioReceived[n.ssrc]=!0),n.outputLevel&&n.outputLevel>0&&!this.isFirstAudioDecoded[n.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(n.ssrc),this.isFirstAudioDecoded[n.ssrc]=!0),typeof e.concealedSamples=="number"&&(n.concealedSamples=e.concealedSamples),this.lastDecodeAudioReceiverStats.set(n.ssrc,it({},n))}processVideoInboundStats(e){let n=this._stats.videoRecv.find(h=>h.ssrc===e.ssrc);n||(n=Vl(M6),this._stats.videoRecv.push(n)),n.ssrc=e.ssrc,n.packets=e.packetsReceived,n.packetsLost=e.packetsLost,n.bytes=e.bytesReceived,n.firsCount=e.firCount,n.nacksCount=e.nackCount,n.plisCount=e.pliCount,n.framesDecodeCount=e.framesDecoded,n.framesDroppedCount=e.framesDropped,n.totalInterFrameDelay=e.totalInterFrameDelay,n.totalSquaredInterFrameDelay=e.totalSquaredInterFrameDelay,n.totalFreezesDuration=e.totalFreezesDuration,n.totalProcessingDelay=e.totalProcessingDelay,n.packetsDiscarded=e.packetsDiscarded,n.framesAssembledFromMultiplePackets=e.framesAssembledFromMultiplePackets,n.totalAssemblyTime=e.totalAssemblyTime,n.keyFramesDecoded=e.keyFramesDecoded,n.retransmittedBytesReceived=e.retransmittedBytesReceived,n.retransmittedPacketsReceived=e.retransmittedPacketsReceived;const i=this.lastDecodeVideoReceiverStats.get(n.ssrc),s=this.lastVideoFramesDecode.get(n.ssrc),c=this.lastVideoFramesOutput.get(n.ssrc),u=Date.now();if(n.framesDecodeCount>0&&!this.isFirstVideoDecoded[n.ssrc]){const h=n.decodedFrame?n.decodedFrame.width:0,p=n.decodedFrame?n.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(n.ssrc,h,p),this.isFirstVideoDecoded[n.ssrc]=!0}if(i){const h=i.stats,p=u-i.lts;n.framesDecodeFreezeTime=h.framesDecodeFreezeTime,n.framesDecodeInterval=h.framesDecodeInterval,!this.isFirstVideoDecoded[n.ssrc]&&p>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[n.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(n.ssrc),this.isFirstVideoDecodedTimeout[n.ssrc]=!0),n.framesDecodeCount>h.framesDecodeCount&&this.isFirstVideoDecoded[n.ssrc]?(i.lts=Date.now(),n.framesDecodeInterval=p,n.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc))?n.framesDecodeFreezeTime+=n.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):n.framesDecodeCount<h.framesDecodeCount&&(n.framesDecodeInterval=0),e.framesDecoded&&e.qpSum&&(i.stats.framesDecodeCount>e.framesDecoded?n.qpSumPerFrame=e.qpSum/e.framesDecoded:n.qpSumPerFrame=(e.qpSum-i.qpSum)/(e.framesDecoded-i.stats.framesDecodeCount))}e.totalDecodeTime&&(n.decodeMs=1e3*e.totalDecodeTime,n.avgDecodeMs=m0(i==null?void 0:i.stats,n,"decodeMs","framesDecodeCount")),n.avgProcessingDelayMs=m0(i==null?void 0:i.stats,n,"totalProcessingDelay","framesDecodeCount",LE.kMillisecondsFromSeconds),n.avgFramesAssembledFromMultiplePacketsMs=m0(i==null?void 0:i.stats,n,"totalAssemblyTime","framesAssembledFromMultiplePackets",LE.kMillisecondsFromSeconds),n.avgInterFrameDelayMs=m0(i==null?void 0:i.stats,n,"totalInterFrameDelay","framesDecodeCount",LE.kMillisecondsFromSeconds),s&&u-s.lts>=800?(n.decodeFrameRate=Math.round((n.framesDecodeCount-s.count)/((u-s.lts)/1e3)),this.lastVideoFramesDecode.set(n.ssrc,{count:n.framesDecodeCount,lts:u,rate:n.decodeFrameRate})):s?n.decodeFrameRate=s.rate:this.lastVideoFramesDecode.set(n.ssrc,{count:n.framesDecodeCount,lts:u,rate:0}),n.framesDroppedCount&&e.framesReceived&&(c&&u-c.lts>=800?(n.outputFrameRate=Math.round((e.framesReceived-n.framesDroppedCount-c.count)/((u-c.lts)/1e3)),this.lastVideoFramesOutput.set(n.ssrc,{count:e.framesReceived-n.framesDroppedCount,lts:u,rate:Math.max(n.outputFrameRate,0)})):c?n.outputFrameRate=c.rate:this.lastVideoFramesOutput.set(n.ssrc,{count:e.framesReceived-n.framesDroppedCount,lts:u,rate:0})),this.processVideoTrackReceiverStats(e,e.trackId,n),e.codecId&&(n.codec=this.getCodecFromCodecStats(e.codecId)),e.framerateMean&&(n.framesRateFirefox=e.framerateMean),n.packets>0&&!this.isFirstVideoReceived[n.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(n.ssrc),this.isFirstVideoReceived[n.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(n.ssrc,{stats:it({},n),lts:i?i.lts:Date.now(),qpSum:e.qpSum})}processVideoOutboundStats(e){let n=this._stats.videoSend.find(s=>s.ssrc===e.ssrc);n||(n=Vl(U6),this._stats.videoSend.push(n));const i=this.mediaBytesSent.get(e.ssrc);if(i)i.add(e.bytesSent);else{const s=new $1(10);s.add(e.bytesSent),this.mediaBytesSent.set(e.ssrc,s)}if(e.retransmittedBytesSent!==void 0){const s=this.mediaBytesRetransmit.get(e.ssrc);if(s)s.add(e.retransmittedBytesSent);else{const c=new $1(10);c.add(e.retransmittedBytesSent),this.mediaBytesRetransmit.set(e.ssrc,c)}}if(e.totalEncodedBytesTarget){const s=this.mediaBytesTargetEncode.get(e.ssrc);if(s)s.add(e.totalEncodedBytesTarget);else{const c=new $1(10);c.add(e.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(e.ssrc,c)}}if(n.ssrc=e.ssrc,n.bytes=e.bytesSent,n.packets=e.packetsSent,n.firsCount=e.firCount,n.nacksCount=e.nackCount,n.plisCount=e.pliCount,n.frameCount=e.framesEncoded,n.adaptionChangeReason=e.qualityLimitationReason,n.scalabilityMode=e.scalabilityMode,n.retransmittedBytesSent=e.retransmittedBytesSent,n.retransmittedPacketsSent=e.retransmittedPacketsSent,n.hugeFramesSent=e.hugeFramesSent,n.keyFramesEncoded=e.keyFramesEncoded,e.totalEncodeTime&&e.framesEncoded){const s=this.lastEncoderMs.get(e.ssrc);if(!s||s.lastFrameCount>e.framesEncoded)n.avgEncodeMs=1e3*e.totalEncodeTime/e.framesEncoded;else{const c=e.framesEncoded-s.lastFrameCount,u=e.totalEncodeTime-s.lastEncoderTime;n.avgEncodeMs=1e3*u/c}}if(e.framesEncoded&&e.qpSum){const s=this.lastEncoderMs.get(e.ssrc);!s||s.lastFrameCount>e.framesEncoded?n.qpSumPerFrame=e.qpSum/e.framesEncoded:n.qpSumPerFrame=(e.qpSum-s.lastQpSum)/(e.framesEncoded-s.lastFrameCount)}if(this.lastEncoderMs.set(e.ssrc,{lastFrameCount:e.framesEncoded,lastEncoderTime:e.totalEncodeTime,lastQpSum:e.qpSum,lts:Date.now()}),e.codecId&&(n.codec=this.getCodecFromCodecStats(e.codecId)),e.mediaSourceId&&this.processVideoMediaSource(e.mediaSourceId,n),this.processVideoTrackSenderStats(e,e.trackId,n),e.remoteId)this.processRemoteInboundStats(e.remoteId,n);else{const s=this.findRemoteStatsId(e.ssrc,gc.REMOTE_INBOUND);s&&this.processRemoteInboundStats(s,n)}}processAudioOutboundStats(e){let n=this._stats.audioSend.find(i=>i.ssrc===e.ssrc);if(n||(n=Vl(V6),this._stats.audioSend.push(n)),n.ssrc=e.ssrc,n.packets=e.packetsSent,n.bytes=e.bytesSent,n.retransmittedBytesSent=e.retransmittedBytesSent,n.retransmittedPacketsSent=e.retransmittedPacketsSent,e.mediaSourceId&&this.processAudioMediaSource(e.mediaSourceId,n),e.codecId&&(n.codec=this.getCodecFromCodecStats(e.codecId)),this.processAudioTrackSenderStats(e,e.trackId,n),e.remoteId)this.processRemoteInboundStats(e.remoteId,n);else{const i=this.findRemoteStatsId(e.ssrc,gc.REMOTE_INBOUND);i&&this.processRemoteInboundStats(i,n)}}findRemoteStatsId(e,n){var i;const s=Array.from(fc(i=this.report).call(i)).find(c=>c.type===n&&c.ssrc===e);return s?s.id:null}processVideoMediaSource(e,n){const i=this.report.get(e);i&&i.width&&i.height&&i.framesPerSecond&&(n.inputFrame={width:i.width,height:i.height,frameRate:i.framesPerSecond})}processAudioMediaSource(e,n){const i=this.report.get(e);i&&(n.inputLevel=i.audioLevel)}processVideoTrackSenderStats(e,n,i){var s,c,u,h;const p=n?this.report.get(n):void 0,_=(s=p==null?void 0:p.framesSent)!==null&&s!==void 0?s:e.framesSent;if(typeof _!="number")return;let E=(c=p==null?void 0:p.frameWidth)!==null&&c!==void 0?c:e.frameWidth,S=(u=p==null?void 0:p.frameHeight)!==null&&u!==void 0?u:e.frameHeight,w=(h=p==null?void 0:p.framesPerSecond)!==null&&h!==void 0?h:e.framesPerSecond;if(typeof E=="number"&&typeof S=="number"||(E=0,S=0),w==null){const I=Date.now(),P=this.lastVideoFramesSent.get(i.ssrc);P&&I-P.lts>=800?(w=Math.round((_-P.count)/((I-P.lts)/1e3)),this.lastVideoFramesSent.set(i.ssrc,{count:_,lts:I,rate:w})):P?w=P.rate:this.lastVideoFramesSent.set(i.ssrc,{count:_,lts:I,rate:0})}i.sentFrame={width:E,height:S,frameRate:Math.max(0,w)}}processVideoTrackReceiverStats(e,n,i){var s,c,u,h,p;const _=n?this.report.get(n):void 0,E=(s=_==null?void 0:_.framesReceived)!==null&&s!==void 0?s:e.framesReceived,S=(c=_==null?void 0:_.frameWidth)!==null&&c!==void 0?c:e.frameWidth,w=(u=_==null?void 0:_.frameHeight)!==null&&u!==void 0?u:e.frameHeight,I=(h=_==null?void 0:_.jitterBufferDelay)!==null&&h!==void 0?h:e.jitterBufferDelay,P=(p=_==null?void 0:_.jitterBufferEmittedCount)!==null&&p!==void 0?p:e.jitterBufferEmittedCount;if(typeof E=="number"){const B=this.lastVideoFramesRecv.get(i.ssrc),M=Date.now();i.framesReceivedCount=E;let U=0;B&&M-B.lts>=800?(U=Math.round((E-B.count)/((M-B.lts)/1e3)),this.lastVideoFramesRecv.set(i.ssrc,{count:E,lts:M,rate:U})):B?U=B.rate:this.lastVideoFramesRecv.set(i.ssrc,{count:E,lts:M,rate:0}),i.receivedFrame={width:S||0,height:w||0,frameRate:U||0},i.decodedFrame={width:S||0,height:w||0,frameRate:i.decodeFrameRate||0},i.outputFrame={width:S||0,height:w||0,frameRate:i.outputFrameRate||i.decodeFrameRate||0}}if(I&&P){const B=this.lastVideoJBDelay.get(i.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let M=B.jitterBufferMs;const U=P-B.jitterBufferEmittedCount;U>0&&(M=1e3*(I-B.jitterBufferDelay)/U),i.jitterBufferMs=M,i.currentDelayMs=Math.round(M),this.lastVideoJBDelay.set(i.ssrc,{jitterBufferDelay:I,jitterBufferEmittedCount:P,jitterBufferMs:i.currentDelayMs})}}processAudioTrackSenderStats(e,n,i){var s,c,u,h;const p=n?this.report.get(n):void 0,_=(s=(c=p==null?void 0:p.echoReturnLoss)!==null&&c!==void 0?c:e.echoReturnLoss)!==null&&s!==void 0?s:0,E=(u=(h=p==null?void 0:p.echoReturnLossEnhancement)!==null&&h!==void 0?h:e.echoReturnLossEnhancement)!==null&&u!==void 0?u:0;i.aecReturnLoss=_,i.aecReturnLossEnhancement=E}processAudioTrackReceiverStats(e,n,i){var s,c,u,h,p,_,E;const S=n?this.report.get(n):void 0,w=(s=S==null?void 0:S.removedSamplesForAcceleration)!==null&&s!==void 0?s:e.removedSamplesForAcceleration,I=(c=S==null?void 0:S.totalSamplesReceived)!==null&&c!==void 0?c:e.totalSamplesReceived,P=(u=S==null?void 0:S.jitterBufferDelay)!==null&&u!==void 0?u:e.jitterBufferDelay,B=(h=S==null?void 0:S.jitterBufferEmittedCount)!==null&&h!==void 0?h:e.jitterBufferEmittedCount,M=(p=S==null?void 0:S.audioLevel)!==null&&p!==void 0?p:e==null?void 0:e.audioLevel,U=(_=S==null?void 0:S.totalSamplesDuration)!==null&&_!==void 0?_:e==null?void 0:e.totalSamplesDuration,$=(E=S==null?void 0:S.concealedSamples)!==null&&E!==void 0?E:e.concealedSamples;if(typeof I=="number"&&(i.totalSamplesReceived=I),w&&I&&(i.accelerateRate=w/I),P&&B){const ce=this.lastAudioJBDelay.get(i.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let me=ce.jitterBufferMs;const ge=B-ce.jitterBufferEmittedCount;ge>0&&(me=1e3*(P-ce.jitterBufferDelay)/ge),i.jitterBufferMs=Math.round(me),this.lastAudioJBDelay.set(i.ssrc,{jitterBufferDelay:P,jitterBufferEmittedCount:B,jitterBufferMs:i.jitterBufferMs})}i.outputLevel=M;let q=1920;U&&I&&(q=I/U/50,i.receivedFrames=Math.round(I/q)),$&&(i.droppedFrames=Math.round($/q))}processRemoteInboundStats(e,n){const i=this.report.get(e);i&&(n.packetsLost=i.packetsLost,i.roundTripTime&&(n.rttMs=1e3*i.roundTripTime),i.jitter&&(n.jitterMs=1e3*i.jitter),i.timestamp&&(n.timestamp=i.timestamp))}getCodecFromCodecStats(e){const n=this.report.get(e);if(!n)return"";const i=n.mimeType.match(/\/(.*)$/);return i&&i[1]?i[1]:""}updateSendBitrate(){let e=0,n=null,i=null;this.mediaBytesSent.forEach(c=>{e+=c.diffMean()}),this.mediaBytesRetransmit.forEach(c=>{n=n===null?c.diffMean():n+c.diffMean()}),this.mediaBytesTargetEncode.forEach(c=>{i=i===null?c.diffMean():i+c.diffMean()});const s=n!==null?e-n:e;this._stats.bitrate={actualEncoded:8*s/(this.options.updateInterval/1e3),transmit:8*e/(this.options.updateInterval/1e3)},n!==null&&(this._stats.bitrate.retransmit=8*n/(this.options.updateInterval/1e3)),i!==null&&(this._stats.bitrate.targetEncoded=8*i/(this.options.updateInterval/1e3))}},Ade=class extends q1{updateStats(){return Qe.resolve()}};function X1(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const u=function(){const h=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return h&&h[0]?Number(h[0].split("/")[1]):null}();return u?u<76?new Ide(e,{updateInterval:n,lossRateInterval:i,freezeRateLimit:s,firstVideoDecodedTimeout:c}):new j6(e,{updateInterval:n,lossRateInterval:i,freezeRateLimit:s,firstVideoDecodedTimeout:c}):function(h){if(!window.RTCStatsReport)return!1;const p=h.getStats();return!!(p instanceof Qe||function(_){return!!_&&(typeof _=="object"||typeof _=="function")&&typeof _.then=="function"}(p))}(e)?new j6(e,{updateInterval:n,lossRateInterval:i,freezeRateLimit:s,firstVideoDecodedTimeout:c}):new Ade(e,{updateInterval:n,lossRateInterval:i,freezeRateLimit:s,firstVideoDecodedTimeout:c})}const B6="websdk_ng_install_id";function J1(){try{if(Z("INSTALL_ID"))return Z("INSTALL_ID");let e=window.localStorage.getItem(B6);return e||(e=Yg(),window.localStorage.setItem(B6,e)),Kn("INSTALL_ID",e),e}catch{return}}const el=function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;const n=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(n&&n[1]&&n[2]){const i=n[1],s=n[2];return"".concat(i,".").concat(s)}return"4.0.0.999"}("4.23.2"),Q1=function(){try{return JSON.parse("true")===!0}catch{return!0}}();let Xg=function(e){return e.Default="default",e.Auto="auto",e.Relay="relay",e.SdRtn="sd-rtn",e}({});const fo=function(){const e="us".concat("erna","me"),n="pa".concat("sswo","rd"),i=["t","s","t"];i.splice(1,0,"e");const s=i.join(""),c=[];for(let p=0;p<6;p++)c.push("1");const u=c.join(""),h={};return h[e]=s,h[n]=u,Object.assign(h,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=fo;const $I={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:2,ENABLE_AUT_FEEDBACK:!1,SVC_EXTENDED:["VP9"]},Z1={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},eL="v4.23.2-0-g1599fdac-dirty(3/4/2025, 5:13:36 PM)",tL={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!1,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",USE_TURN_IP:!1,NEW_TURN_MODE:void 0,NEW_FORCE_TURN:!1},lr=it(it(it({},tL),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS_METADATA:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:Z1,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},$I),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1},{INSTALL_ID:""});function Kn(e,n,i){var s,c,u;$e(s=Object.keys(lr)).call(s,e)&&(!i&&$e(c=Object.keys(Wu)).call(c,e)||(lr[e]=n,e!=="ENABLE_VIDEO_SEI"&&e!=="ENABLE_AUDIO_TOPN"&&e!=="ENABLE_AUDIO_METADATA"&&e!=="ENABLE_AUDIO_PTS_METADATA"||n!==!0||(lr.ENABLE_ENCODED_TRANSFORM=!0,e==="ENABLE_AUDIO_PTS_METADATA"&&(lr.ENABLE_AUDIO_METADATA=!0)),e==="USE_NEW_NETWORK_CONFIG"&&n&&(u=!!n,lr.USE_NEW_NETWORK_CONFIG=u,u&&(lr.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],lr.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],lr.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],lr.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],lr.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",lr.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",lr.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),e==="ENABLE_PRE_SUB"&&n&&(lr.ENABLE_INSTANT_VIDEO=!0,lr.ENABLE_PREALLOC_PC=!0),e==="ENABLE_SVC"&&n&&(lr.ENABLE_AUT_CC=!0),e==="NEW_FORCE_TURN"&&n&&(lr.NEW_TURN_MODE||(lr.NEW_TURN_MODE=4))))}function Z(e){return lr[e]}Q1||(lr.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],lr.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],lr.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],lr.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],lr.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],lr.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],lr.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",lr.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",lr.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",lr.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",lr.AREAS=["NORTH_AMERICA","OVERSEA"]);let W6=function(e){return e[e.REALTIME=1]="REALTIME",e}({});const Wu={};var sn=function(e){return e.SET_SESSION_ID="SET_SESSION_ID",e.SET_P2P_ID="SET_P2P_id",e.SET_DC_ID="SET_DC_id",e.SET_UID="SET_UID",e.SET_INT_UID="SET_INT_UID",e.SET_PUB_ID="SET_PUB_ID",e.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e.AVOID_JOIN_START="AVOID_JOIN_START",e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",e.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",e.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",e.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",e.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",e.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",e.RESET_KEY_METRICS="RESET_KEY_METRICS",e.SET_USE_P2P="SET_USE_P2P",e.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",e}(sn||{});let qI=function(e){return e.h264="h264",e.h265="h265",e.vp8="vp8",e.vp9="vp9",e.av1="av1",e}({});(function(e){e.opus="opus",e.pcma="pcma",e.pcmu="pcmu",e.g722="g722"})({});const G6=128,Ode=96,z6=1e3,xE=10;let Pde=0;var H6=(()=>{var e={8:(s,c,u)=>{u.r(c),u.d(c,{Parser:()=>Ze,Printer:()=>Qr,parse:()=>He,print:()=>dt});const h=`
`,p="".concat("\r").concat(h),_=" ";let E;function S(ke){return ke>="0"&&ke<="9"}function w(ke){return ke>="!"&&ke<="~"}function I(ke){return w(ke)||ke>=""&&ke<=""}function P(ke){return ke==="!"||ke>="#"&&ke<="'"||ke>="*"&&ke<="+"||ke>="-"&&ke<="."||ke>="0"&&ke<="9"||ke>="A"&&ke<="Z"||ke>="^"&&ke<="~"}function B(ke){return ke>="1"&&ke<="9"}function M(ke){return ke>="A"&&ke<="Z"||ke>="a"&&ke<="z"}function U(ke){return ke==="d"||ke==="h"||ke==="m"||ke==="s"}function $(ke){return ke>""&&ke<"	"||ke>"\v"&&ke<"\f"||ke>""&&ke<""}function q(ke){return M(ke)||S(ke)||ke==="+"||ke==="/"}function ce(ke){return S(ke)||M(ke)||ke==="+"||ke==="/"||ke==="-"||ke==="_"}function me(ke){return M(ke)||S(ke)||ke==="+"||ke==="/"}function ge(ke,L){var ee=Object.keys(ke);if(Object.getOwnPropertySymbols){var ue=Object.getOwnPropertySymbols(ke);L&&(ue=ue.filter(function(je){return Object.getOwnPropertyDescriptor(ke,je).enumerable})),ee.push.apply(ee,ue)}return ee}function pe(ke){for(var L=1;L<arguments.length;L++){var ee=arguments[L]!=null?arguments[L]:{};L%2?ge(Object(ee),!0).forEach(function(ue){Re(ke,ue,ee[ue])}):Object.getOwnPropertyDescriptors?Object.defineProperties(ke,Object.getOwnPropertyDescriptors(ee)):ge(Object(ee)).forEach(function(ue){Object.defineProperty(ke,ue,Object.getOwnPropertyDescriptor(ee,ue))})}return ke}function Re(ke,L,ee){return L in ke?Object.defineProperty(ke,L,{value:ee,enumerable:!0,configurable:!0,writable:!0}):ke[L]=ee,ke}(function(ke){ke.VERSION="v",ke.ORIGIN="o",ke.SESSION_NAME="s",ke.INFORMATION="i",ke.URI="u",ke.EMAIL="e",ke.PHONE="p",ke.CONNECTION="c",ke.BANDWIDTH="b",ke.TIME="t",ke.REPEAT="r",ke.ZONE_ADJUSTMENTS="z",ke.KEY="k",ke.ATTRIBUTE="a",ke.MEDIA="m"})(E||(E={}));class Ve{consumeText(L,ee){let ue=ee;for(;ue<L.length;){const je=L[ue];if(je==="\0"||je==="\r"||je===h)break;ue+=1}if(ue-ee==0)throw new Error("Invalid text, at ".concat(L));return ue}consumeUnicastAddress(L,ee,ue){return this.consumeTill(L,ee,_)}consumeOneOrMore(L,ee,ue){let je=ee;for(;ue(L[je]);)je++;if(je-ee==0)throw new Error("Invalid rule at ".concat(ee,"."));return je}consumeSpace(L,ee){if(L[ee]===_)return ee+1;throw new Error("Invalid space at ".concat(ee,"."))}consumeIP4Address(L,ee){let ue=ee;for(let je=0;je<4;je++)if(ue=this.consumeDecimalUChar(L,ue),je!==3){if(L[ue]!==".")throw new Error("Invalid IP4 address.");ue++}return ue}consumeDecimalUChar(L,ee){let ue=ee;for(let jt=0;jt<3&&S(L[ue]);jt++,ue++);if(ue-ee==0)throw new Error("Invalid decimal uchar.");const je=parseInt(L.slice(ee,ue));if(je>=0&&je<=255)return ue;throw new Error("Invalid decimal uchar")}consumeIP6Address(L,ee){let ue=this.consumeHexpart(L,ee);return L[ue]===":"&&(ue+=1,ue=this.consumeIP4Address(L,ue)),ue}consumeHexpart(L,ee){let ue=ee;if(L[ue]===":"&&L[ue+1]===":"){ue+=2;try{ue=this.consumeHexseq(L,ue)}catch{}return ue}if(ue=this.consumeHexseq(L,ue),L[ue]===":"&&L[ue+1]===":"){ue+=2;try{ue=this.consumeHexseq(L,ue)}catch{}return ue}return ue}consumeHexseq(L,ee){let ue=ee;for(;ue=this.consumeHex4(L,ue),L[ue]===":"&&L[ue+1]!==":";)ue+=1;return ue}consumeHex4(L,ee){let ue=0;for(;ue<4;ue++)if(!((je=L[ee+ue])>="0"&&je<="9"||je>="a"&&je<="f"||je>="A"&&je<="F")){if(ue===0)throw new Error("Invalid hex 4");break}var je;return ee+ue}consumeFQDN(L,ee){let ue=ee;for(;S(L[ue])||M(L[ue])||L[ue]==="-"||L[ue]===".";)ue+=1;if(ue-ee<4)throw new Error("Invalid FQDN");return ue}consumeExtnAddr(L,ee){return this.consumeOneOrMore(L,ee,I)}consumeMulticastAddress(L,ee,ue){switch(ue){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(L,ee);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(L,ee);default:try{return this.consumeFQDN(L,ee)}catch{return this.consumeExtnAddr(L,ee)}}}consumeIP6MulticastAddress(L,ee){const ue=this.consumeHexpart(L,ee);return L[ue]==="/"?this.consumeInteger(L,ue+1):ue}consumeIP4MulticastAddress(L,ee){let ue=ee+3;const je=L.slice(ee,ue),jt=parseInt(je);if(jt<224||jt>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let Xn=0;Xn<3;Xn++){if(L[ue]!==".")throw new Error("Invalid IP4 multicast address.");ue+=1,ue=this.consumeDecimalUChar(L,ue)}return L[ue]==="/"&&(ue+=1),ue=this.consumeTTL(L,ue),L[ue]==="/"&&(ue=this.consumeInteger(L,ue)),ue}consumeInteger(L,ee){if(!B(L[ee]))throw new Error("Invalid integer.");for(ee+=1;S(L[ee]);)ee+=1;return ee}consumeTTL(L,ee){if(L[ee]==="0")return ee+1;if(!B(L[ee]))throw new Error("Invalid TTL.");ee+=1;for(let ue=0;ue<2&&S(L[ee]);ue++)ee+=1;return ee}consumeToken(L,ee){return this.consumeOneOrMore(L,ee,P)}consumeTime(L,ee){let ue=ee;if(L[ue]==="0")return ue+1;for(B(L[ue])&&(ue+=1);S(L[ue]);)ue++;if(ue-ee<10)throw new Error("Invalid time");return ue}consumeAddress(L,ee){return this.consumeTill(L,ee,_)}consumeTypedTime(L,ee){let ue=ee;return ue=this.consumeOneOrMore(L,ue,S),U(L[ue])?ue+1:ue}consumeRepeatInterval(L,ee){if(!B(L[ee]))throw new Error("Invalid repeat interval");for(ee+=1;S(L[ee]);)ee+=1;return U(L[ee])&&(ee+=1),ee}consumePort(L,ee){return this.consumeOneOrMore(L,ee,S)}consume(L,ee,ue){for(let je=0;je<ue.length;je++){if(ee+je>=L.length)throw new Error("consume exceeding value length");if(L[ee+je]!==ue[je])throw new Error("consume ".concat(ue," failed at ").concat(je))}return ee+ue.length}consumeTill(L,ee,ue){let je=ee;for(;je<L.length&&(typeof ue!="string"||L[je]!==ue)&&(typeof ue!="function"||!ue(L[je]));)je++;return je}}class Ze extends Ve{constructor(){super(),Re(this,"records",[]),Re(this,"currentLine",0)}parse(L){const ee=this.probeEOL(L);this.records=L.split(ee).filter(y_=>!!$o(y_).call(y_)).map(this.parseLine),this.currentLine=0;const ue=this.parseVersion(),je=this.parseOrigin(),jt=this.parseSessionName(),Xn=this.parseInformation(),Di=this.parseUri(),fa=this.parseEmail(),Rf=this.parsePhone(),E_=this.parseConnection(),Q0=this.parseBandWidth(),oO=this.parseTimeFields(),sO=this.parseKey(),cl=this.parseSessionAttribute(),sm=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:ue,origin:je,sessionName:jt,information:Xn,uri:Di,emails:fa,phones:Rf,connection:E_,bandwidths:Q0,timeFields:oO,key:sO,attributes:cl,mediaDescriptions:sm}}getCurrentRecord(){const L=this.records[this.currentLine];if(!L)throw new Error("Record doesn't exit.");return L}probeEOL(L){for(let ee=0;ee<L.length;ee++)if(L[ee]===h)return L[ee-1]==="\r"?p:h;throw new Error("Invalid newline character.")}parseLine(L,ee){if(L.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const ue=L[0];if(L[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:ue,value:L.slice(2),line:ee,cur:0}}parseSessionAttribute(){const L=new un;for(;this.currentLine<this.records.length;){const ee=this.getCurrentRecord();if(ee.type!==E.ATTRIBUTE)break;const ue={attField:this.extractOneOrMore(ee,je=>P(je)&&je!==":"),_cur:0};ee.value[ee.cur]===":"&&(ee.cur+=1,ue.attValue=this.extractOneOrMore(ee,$)),L.parse(ue),this.currentLine++}return L.digest()}parseMediaAttributes(L){const ee=new dn(L);for(;this.currentLine<this.records.length;){const ue=this.getCurrentRecord();if(ue.type!==E.ATTRIBUTE)break;const je={attField:this.extractOneOrMore(ue,jt=>P(jt)&&jt!==":"),_cur:0};ue.value[ue.cur]===":"&&(ue.cur+=1,je.attValue=this.extractOneOrMore(ue,$)),ee.parse(je),this.currentLine++}return ee.digest()}parseKey(){const L=this.getCurrentRecord();if(L.type===E.KEY){if(L.value==="prompt"||L.value==="clear:"||L.value==="base64:"||L.value==="uri:")return L.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const L=this.getCurrentRecord();if(L.type===E.ZONE_ADJUSTMENTS){const ee=[];for(;;)try{const ue=this.extract(L,this.consumeTime);this.consumeSpaceForRecord(L);let je=!1;L.value[L.cur]==="-"&&(je=!0,L.cur+=1);const jt=this.extract(L,this.consumeTypedTime);ee.push({time:ue,typedTime:jt,back:je})}catch{break}if(ee.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,ee}return[]}parseRepeat(){const L=[];for(;;){const ee=this.getCurrentRecord();if(ee.type!==E.REPEAT)break;{const ue=this.extract(ee,this.consumeRepeatInterval),je=this.parseTypedTime(ee);L.push({repeatInterval:ue,typedTimes:je}),this.currentLine++}}return L}parseTypedTime(L){const ee=[];for(;;)try{this.consumeSpaceForRecord(L),ee.push(this.extract(L,this.consumeTypedTime))}catch{break}if(ee.length===0)throw new Error("Invalid typed time.");return ee}parseTime(){const L=this.getCurrentRecord(),ee=this.extract(L,this.consumeTime);this.consumeSpaceForRecord(L);const ue=this.extract(L,this.consumeTime);return this.currentLine++,{startTime:ee,stopTime:ue}}parseBandWidth(){const L=[];for(;this.currentLine<this.records.length;){const ee=this.getCurrentRecord();if(ee.type!==E.BANDWIDTH)break;{const ue=this.extractOneOrMore(ee,P);if(ee.value[ee.cur]!==":")throw new Error("Invalid bandwidth field.");ee.cur++;const je=this.extractOneOrMore(ee,S);L.push({bwtype:ue,bandwidth:je}),this.currentLine++}}return L}parseVersion(){const L=this.getCurrentRecord();if(L.type!==E.VERSION)throw new Error("first sdp record must be version");const ee=L.value.slice(0,this.consumeOneOrMore(L.value,0,S));if(ee.length!==L.value.length)throw new Error('invalid proto version, "v='.concat(L.value,'"'));return this.currentLine++,ee}parseOrigin(){const L=this.getCurrentRecord();if(L.type!==E.ORIGIN)throw new Error("second line of sdp must be origin");const ee=this.extractOneOrMore(L,I);this.consumeSpaceForRecord(L);const ue=this.extractOneOrMore(L,S);this.consumeSpaceForRecord(L);const je=this.extractOneOrMore(L,S);this.consumeSpaceForRecord(L);const jt=this.extractOneOrMore(L,P);this.consumeSpaceForRecord(L);const Xn=this.extractOneOrMore(L,P);this.consumeSpaceForRecord(L);const Di=this.extract(L,this.consumeUnicastAddress);return this.currentLine++,{username:ee,sessId:ue,sessVersion:je,nettype:jt,addrtype:Xn,unicastAddress:Di}}parseSessionName(){const L=this.getCurrentRecord();if(L.type===E.SESSION_NAME){const ee=this.extract(L,this.consumeText);return this.currentLine++,ee}}parseInformation(){const L=this.getCurrentRecord();if(L.type!==E.INFORMATION)return;const ee=this.extract(L,this.consumeText);return this.currentLine++,ee}parseUri(){const L=this.getCurrentRecord();if(L.type===E.URI)return this.currentLine++,L.value}parseEmail(){const L=[];for(;;){const ee=this.getCurrentRecord();if(ee.type!==E.EMAIL)break;L.push(ee.value),this.currentLine++}return L}parsePhone(){const L=[];for(;;){const ee=this.getCurrentRecord();if(ee.type!==E.PHONE)break;L.push(ee.value),this.currentLine++}return L}parseConnection(){const L=this.getCurrentRecord();if(L.type===E.CONNECTION){const ee=this.extractOneOrMore(L,P);this.consumeSpaceForRecord(L);const ue=this.extractOneOrMore(L,P);this.consumeSpaceForRecord(L);const je=this.extract(L,this.consumeAddress);return this.currentLine++,{nettype:ee,addrtype:ue,address:je}}}parseMedia(){const L=this.getCurrentRecord(),ee=this.extract(L,this.consumeToken);this.consumeSpaceForRecord(L);let ue=this.extract(L,this.consumePort);L.value[L.cur]==="/"&&(L.cur+=1,ue+=this.extract(L,this.consumeInteger)),this.consumeSpaceForRecord(L);const je=[];for(je.push(this.extract(L,this.consumeToken));L.value[L.cur]==="/";)L.cur+=1,je.push(this.extract(L,this.consumeToken));if(je.length===0)throw new Error("Invalid proto");const jt=this.parseFmt(L);return this.currentLine++,{mediaType:ee,port:ue,protos:je,fmts:jt}}parseTimeFields(){const L=[];for(;this.getCurrentRecord().type===E.TIME;){const ee=this.parseTime(),ue=this.parseRepeat(),je=this.parseZone();L.push({time:ee,repeats:ue,zones:je})}return L}parseMediaDescription(){const L=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===E.MEDIA;){const ee=this.parseMedia(),ue=this.parseInformation(),je=this.parseConnections(),jt=this.parseBandWidth(),Xn=this.parseKey(),Di=this.parseMediaAttributes(ee);L.push({media:ee,information:ue,connections:je,bandwidths:jt,key:Xn,attributes:Di})}return L}parseConnections(){const L=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===E.CONNECTION;)L.push(this.parseConnection());return L}parseFmt(L){const ee=[];for(;;)try{this.consumeSpaceForRecord(L),ee.push(this.extract(L,this.consumeToken))}catch{break}if(ee.length===0)throw new Error("Invalid fmts");return ee}extract(L,ee){for(var ue=arguments.length,je=new Array(ue>2?ue-2:0),jt=2;jt<ue;jt++)je[jt-2]=arguments[jt];const Xn=ee.call(this,L.value,L.cur,...je),Di=L.value.slice(L.cur,Xn);return L.cur=Xn,Di}extractOneOrMore(L,ee){const ue=this.consumeOneOrMore(L.value,L.cur,ee),je=L.value.slice(L.cur,ue);return L.cur=ue,je}consumeSpaceForRecord(L){if(L.value[L.cur]!==_)throw new Error("Invalid space at ".concat(L.cur,"."));L.cur+=1}}class rt extends Ve{constructor(){super(...arguments),Re(this,"attributes",void 0),Re(this,"digested",!1)}extractOneOrMore(L,ee,ue){const je=this.consumeOneOrMore(L.attValue,L._cur,ee),jt=L.attValue.slice(L._cur,je),[Xn,Di]=ue||[];if(typeof Xn=="number"&&jt.length<Xn)throw new Error("error in length, should be more or equal than ".concat(Xn," characters."));if(typeof Di=="number"&&jt.length>Di)throw new Error("error in length, should be less or equal than ".concat(Di," characters."));return L._cur=je,jt}consumeAttributeSpace(L){if(L.attValue[L._cur]!==_)throw new Error("Invalid space at ".concat(L._cur,"."));L._cur+=1}extract(L,ee){if(!L.attValue)throw new Error("Nothing to extract from attValue.");for(var ue=arguments.length,je=new Array(ue>2?ue-2:0),jt=2;jt<ue;jt++)je[jt-2]=arguments[jt];const Xn=ee.call(this,L.attValue,L._cur,...je),Di=L.attValue.slice(L._cur,Xn);return L._cur=Xn,Di}atEnd(L){if(!L.attValue)throw new Error;return L._cur>=L.attValue.length}peekChar(L){if(!L.attValue)throw new Error;return L.attValue[L._cur]}peek(L,ee){if(!L.attValue)throw new Error;for(let ue=0;ue<ee.length;ue++)if(ee[ue]!==L.attValue[L._cur+ue])return!1;return!0}parseIceUfrag(L){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(L,q,[4,256])}parseIcePwd(L){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(L,q,[22,256])}parseIceOptions(L){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const ee=[];for(;!this.atEnd(L);){ee.push(this.extractOneOrMore(L,q));try{this.consumeAttributeSpace(L)}catch(ue){if(this.atEnd(L))break;throw ue}}this.attributes.iceOptions=ee}parseFingerprint(L){const ee=this.extract(L,this.consumeToken);this.consumeAttributeSpace(L);const ue=this.extract(L,this.consumeTill);this.attributes.fingerprints.push({hashFunction:ee,fingerprint:ue})}parseExtmap(L){const ee=this.extractOneOrMore(L,S);let ue;this.peekChar(L)==="/"&&(this.extract(L,this.consume,"/"),ue=this.extract(L,this.consumeToken)),this.consumeAttributeSpace(L);const je=this.extract(L,this.consumeTill,_),jt=pe(pe({entry:parseInt(ee,10)},ue&&{direction:ue}),{},{extensionName:je});this.peekChar(L)===_&&(this.consumeAttributeSpace(L),jt.extensionAttributes=this.extract(L,this.consumeTill)),this.attributes.extmaps.push(jt)}parseSetup(L){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const ee=this.extract(L,this.consumeTill);if(ee!=="active"&&ee!=="passive"&&ee!=="actpass"&&ee!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=ee}}class un extends rt{constructor(){super(...arguments),Re(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(L){if(this.digested)throw new Error("already digested");try{switch(L.attField){case"group":this.parseGroup(L);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(L);break;case"ice-pwd":this.parseIcePwd(L);break;case"ice-options":this.parseIceOptions(L);break;case"fingerprint":this.parseFingerprint(L);break;case"setup":this.parseSetup(L);break;case"tls-id":this.parseTlsId(L);break;case"identity":this.parseIdentity(L);break;case"extmap":this.parseExtmap(L);break;case"msid-semantic":this.parseMsidSemantic(L);break;default:L.ignored=!0,this.attributes.unrecognized.push(L)}}catch(ee){throw console.error("parsing session attribute ".concat(L.attField,' error, "a=').concat(L.attField,":").concat(L.attValue,'"')),ee}if(!L.ignored&&L.attValue&&!this.atEnd(L))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(L){const ee=this.extract(L,this.consumeToken),ue=[];for(;!this.atEnd(L)&&this.peekChar(L)===_;)this.consumeAttributeSpace(L),ue.push(this.extract(L,this.consumeToken));this.attributes.groups.push({semantic:ee,identificationTag:ue})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(L){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(L,ce)}parseIdentity(L){const ee=this.extractOneOrMore(L,me),ue=[];for(;!this.atEnd(L)&&this.peekChar(L)===_;){this.consumeAttributeSpace(L);const je=this.extract(L,this.consumeToken);this.extract(L,this.consume,"=");const jt=this.extractOneOrMore(L,Xn=>Xn!==_&&$(Xn));ue.push({name:je,value:jt})}this.attributes.identities.push({assertionValue:ee,extensions:ue})}parseMsidSemantic(L){this.peekChar(L)===_&&this.consumeAttributeSpace(L);const ee={semantic:this.extract(L,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(L)}catch{break}if(this.peekChar(L)==="*"){this.extract(L,this.consume,"*"),ee.applyForAll=!0;break}{const ue=this.extract(L,this.consumeTill,_);ee.identifierList.push(ue)}}this.attributes.msidSemantic=ee}}class dn extends rt{constructor(L){super(),Re(this,"attributes",void 0),L.protos.indexOf("RTP")!==-1||L.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(L){if(this.digested)throw new Error("already digested");try{switch(L.attField){case"extmap":this.parseExtmap(L);break;case"setup":this.parseSetup(L);break;case"ice-ufrag":this.parseIceUfrag(L);break;case"ice-pwd":this.parseIcePwd(L);break;case"ice-options":this.parseIceOptions(L);break;case"candidate":this.parseCandidate(L);break;case"remote-candidate":this.parseRemoteCandidate(L);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(L);break;case"rtpmap":this.parseRtpmap(L);break;case"ptime":this.parsePtime(L);break;case"maxptime":this.parseMaxPtime(L);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(L);break;case"ssrc":this.parseSSRC(L);break;case"fmtp":this.parseFmtp(L);break;case"rtcp-fb":this.parseRtcpFb(L);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(L);break;case"mid":this.parseMid(L);break;case"msid":this.parseMsid(L);break;case"imageattr":this.parseImageAttr(L);break;case"rid":this.parseRid(L);break;case"simulcast":this.parseSimulcast(L);break;case"sctp-port":this.parseSctpPort(L);break;case"max-message-size":this.parseMaxMessageSize(L);break;case"ssrc-group":this.parseSSRCGroup(L);break;default:L.ignored=!0,this.attributes.unrecognized.push(L)}}catch(ee){throw console.error("parsing media attribute ".concat(L.attField,' error, "a=').concat(L.attField,":").concat(L.attValue,'"')),ee}if(!L.ignored&&L.attValue&&!this.atEnd(L))throw new Error("attribute parsing error")}parseCandidate(L){const ee=this.extractOneOrMore(L,q,[1,32]);this.consumeAttributeSpace(L);const ue=this.extractOneOrMore(L,S,[1,5]);this.consumeAttributeSpace(L);const je=this.extract(L,this.consumeToken);this.consumeAttributeSpace(L);const jt=this.extractOneOrMore(L,S,[1,10]);this.consumeAttributeSpace(L);const Xn=this.extract(L,this.consumeAddress);this.consumeAttributeSpace(L);const Di=this.extract(L,this.consumePort);this.consumeAttributeSpace(L),this.extract(L,this.consume,"typ"),this.consumeAttributeSpace(L);const fa={foundation:ee,componentId:ue,transport:je,priority:jt,connectionAddress:Xn,port:Di,type:this.extract(L,this.consumeToken),extension:{}};for(this.peek(L," raddr")&&(this.extract(L,this.consume," raddr"),this.consumeAttributeSpace(L),fa.relAddr=this.extract(L,this.consumeAddress)),this.peek(L," rport")&&(this.extract(L,this.consume," rport"),this.consumeAttributeSpace(L),fa.relPort=this.extract(L,this.consumePort));this.peekChar(L)===_;){this.consumeAttributeSpace(L);const Rf=this.extract(L,this.consumeToken);this.consumeAttributeSpace(L),fa.extension[Rf]=this.extractOneOrMore(L,w)}this.attributes.candidates.push(fa)}parseRemoteCandidate(L){const ee=[];for(;;){const ue=this.extractOneOrMore(L,S,[1,5]);this.consumeAttributeSpace(L);const je=this.extract(L,this.consumeAddress);this.consumeAttributeSpace(L);const jt=this.extract(L,this.consumePort);ee.push({componentId:ue,connectionAddress:je,port:jt});try{this.consumeAttributeSpace(L)}catch{break}}this.attributes.remoteCandidatesList.push(ee)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(L){const ee=this.extract(L,this.consumeToken);this.consumeAttributeSpace(L);const ue=this.extract(L,this.consumeTill,"/");this.extract(L,this.consume,"/");const je={encodingName:ue,clockRate:this.extractOneOrMore(L,S)};this.atEnd(L)||this.peekChar(L)!=="/"||(this.extract(L,this.consume,"/"),je.encodingParameters=parseInt(this.extract(L,this.consumeTill),10));const jt=this.attributes.payloads.find(Xn=>Xn.payloadType===parseInt(ee,10));jt?jt.rtpMap=je:this.attributes.payloads.push({payloadType:parseInt(ee,10),rtpMap:je,rtcpFeedbacks:[]})}parsePtime(L){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(L,this.consumeTill)}parseMaxPtime(L){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(L,this.consumeTill)}parseDirection(L){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=L.attField}parseSSRC(L){const ee=this.extractOneOrMore(L,S);this.consumeAttributeSpace(L);const ue=this.extract(L,this.consumeTill,":");let je;this.peekChar(L)===":"&&(this.extract(L,this.consume,":"),je=this.extract(L,this.consumeTill));const jt=this.attributes.ssrcs.find(Xn=>Xn.ssrcId===parseInt(ee,10));jt?jt.attributes[ue]=je:this.attributes.ssrcs.push({ssrcId:parseInt(ee,10),attributes:{[ue]:je}})}parseFmtp(L){const ee=this.extract(L,this.consumeTill,_);this.consumeAttributeSpace(L);const ue=this.extract(L,this.consumeTill),je={};ue.split(";").forEach(Xn=>{let[Di,fa]=Xn.split("=");Di=$o(Di).call(Di);const Rf=typeof fa=="string"?$o(fa).call(fa):null;typeof Di=="string"&&Di.length>0&&(je[Di]=Rf)});const jt=this.attributes.payloads.find(Xn=>Xn.payloadType===parseInt(ee,10));jt?jt.fmtp={parameters:je}:this.attributes.payloads.push({payloadType:parseInt(ee,10),rtcpFeedbacks:[],fmtp:{parameters:je}})}parseFmtParameters(L){const ee={},ue=this.extract(L,this.consumeTill,"=");L._cur++;const je=this.extract(L,this.consumeTill,";");for(ee[ue]=je;L.attValue[L._cur]===";";){const jt=this.extract(L,this.consumeTill,"=");L._cur++;const Xn=this.extract(L,this.consumeTill,";");ee[jt]=Xn}return ee}parseRtcpFb(L){let ee="";ee=this.peekChar(L)==="*"?this.extract(L,this.consume,"*"):this.extract(L,this.consumeTill,_),this.consumeAttributeSpace(L);const ue=this.extract(L,this.consumeTill,_);let je;if(ue==="trr-int")je={type:ue,interval:this.extract(L,this.consumeTill)};else{const jt={type:ue};this.peekChar(L)===_&&(this.consumeAttributeSpace(L),jt.parameter=this.extract(L,this.consumeToken),this.peekChar(L)===_&&(jt.additional=this.extract(L,this.consumeTill))),je=jt}if(ee==="*")this.attributes.rtcpFeedbackWildcards.push(je);else{const jt=this.attributes.payloads.find(Xn=>Xn.payloadType===parseInt(ee,10));jt?jt.rtcpFeedbacks.push(je):this.attributes.payloads.push({payloadType:parseInt(ee,10),rtcpFeedbacks:[je]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(L){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const ee={port:this.extract(L,this.consumePort)};this.peekChar(L)===_&&(this.consumeAttributeSpace(L),ee.netType=this.extractOneOrMore(L,P),this.consumeAttributeSpace(L),ee.addressType=this.extractOneOrMore(L,P),this.consumeAttributeSpace(L),ee.address=this.extract(L,this.consumeAddress)),this.attributes.rtcp=ee}parseMsid(L){const ee={id:this.extractOneOrMore(L,P,[1,64])};this.peekChar(L)===_&&(this.consumeAttributeSpace(L),ee.appdata=this.extractOneOrMore(L,P,[1,64])),this.attributes.msids.push(ee)}parseImageAttr(L){this.attributes.imageattr.push(L.attValue)}parseRid(L){const ee=this.extractOneOrMore(L,je=>M(je)||S(je)||je==="_"||je==="-");this.consumeAttributeSpace(L);const ue={id:ee,direction:this.extract(L,this.consumeToken),params:[]};if(this.peekChar(L)===_){if(this.consumeAttributeSpace(L),this.peek(L,"pt=")){this.extract(L,this.consume,"pt=");const je=[];for(;;){const jt=this.extract(L,this.consumeToken);je.push(jt);try{this.extract(L,this.consume,",")}catch{break}}ue.payloads=je,this.peekChar(L)===_&&this.extract(L,this.consume,_)}for(;;){const je=this.extract(L,this.consumeToken);switch(je){case"depend":{const jt={type:je,rids:this.extract(L,this.consume,"=").split(",")};ue.params.push(jt);break}default:{const jt={type:je};this.peekChar(L)==="="&&(this.extract(L,this.consume,"="),jt.val=this.extract(L,this.consumeTill,";")),ue.params.push(jt)}}try{this.extract(L,this.consume,";")}catch{break}}}this.attributes.rids.push(ue)}parseSimulcast(L){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=L.attValue,this.extract(L,this.consumeTill)}parseSctpPort(L){this.attributes.sctpPort=this.extractOneOrMore(L,S,[1,5])}parseMaxMessageSize(L){this.attributes.maxMessageSize=this.extractOneOrMore(L,S,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(L){this.attributes.mid=this.extract(L,this.consumeToken)}parseSSRCGroup(L){const ee=this.extract(L,this.consumeToken),ue=[];for(;;)try{this.consumeAttributeSpace(L);const je=this.extract(L,this.consumeInteger);ue.push(parseInt(je,10))}catch{break}this.attributes.ssrcGroups.push({semantic:ee,ssrcIds:ue})}}function nr(ke,L,ee){return L in ke?Object.defineProperty(ke,L,{value:ee,enumerable:!0,configurable:!0,writable:!0}):ke[L]=ee,ke}class Qr{constructor(){nr(this,"eol",p)}print(L,ee){let ue="";return ee&&(this.eol=ee),ue+=this.printVersion(L.version),ue+=this.printOrigin(L.origin),ue+=this.printSessionName(L.sessionName),ue+=this.printInformation(L.information),ue+=this.printUri(L.uri),ue+=this.printEmail(L.emails),ue+=this.printPhone(L.phones),ue+=this.printConnection(L.connection),ue+=this.printBandwidth(L.bandwidths),ue+=this.printTimeFields(L.timeFields),ue+=this.printKey(L.key),ue+=this.printSessionAttributes(L.attributes),ue+=this.printMediaDescription(L.mediaDescriptions),ue}printVersion(L){return"v=".concat(L).concat(this.eol)}printOrigin(L){return"o=".concat(L.username," ").concat(L.sessId," ").concat(L.sessVersion," ").concat(L.nettype," ").concat(L.addrtype," ").concat(L.unicastAddress).concat(this.eol)}printSessionName(L){return L?"s=".concat(L).concat(this.eol):""}printInformation(L){return L?"i=".concat(L).concat(this.eol):""}printUri(L){return L?"u=".concat(L).concat(this.eol):""}printEmail(L){let ee="";for(const ue of L)ee+="e=".concat(ue).concat(this.eol);return ee}printPhone(L){let ee="";for(const ue of L)ee+="e=".concat(ue).concat(this.eol);return ee}printConnection(L){return L?"c=".concat(L.nettype," ").concat(L.addrtype," ").concat(L.address).concat(this.eol):""}printBandwidth(L){let ee="";for(const ue of L)ee+="b=".concat(ue.bwtype,":").concat(ue.bandwidth).concat(this.eol);return ee}printTimeFields(L){let ee="";for(const ue of L){ee+="t=".concat(ue.time.startTime," ").concat(ue.time.startTime).concat(this.eol);for(const je of ue.repeats)ee+="r=".concat(je.repeatInterval," ").concat(je.typedTimes.join(" ")).concat(this.eol);ue.zoneAdjustments&&(ee+="z=",ee+="z=".concat(ue.zoneAdjustments.map(je=>"".concat(je.time," ").concat(je.back?"-":""," ").concat(je.typedTime)).join(" ")).concat(this.eol),ee+=this.eol)}return ee}printKey(L){return L?"k=".concat(L).concat(this.eol):""}printAttributes(L){let ee="";for(const ue of L)ee+="a=".concat(ue.attField).concat(ue.attValue?":".concat(ue.attValue):"").concat(this.eol);return ee}printMediaDescription(L){let ee="";for(const ue of L)ee+=this.printMedia(ue.media),ee+=this.printInformation(ue.information),ee+=this.printConnections(ue.connections),ee+=this.printBandwidth(ue.bandwidths),ee+=this.printKey(ue.key),ee+=this.printMediaAttributes(ue);return ee}printConnections(L){let ee="";for(const ue of L)ee+=this.printConnection(ue);return ee}printMedia(L){return"m=".concat(L.mediaType," ").concat(L.port," ").concat(L.protos.join("/")," ").concat(L.fmts.join(" ")).concat(this.eol)}printSessionAttributes(L){return new js(this.eol).print(L)}printMediaAttributes(L){return new Pe(this.eol).print(L)}}class jr{constructor(L){nr(this,"eol",void 0),this.eol=L}printIceUfrag(L){return L===void 0?"":"a=ice-ufrag:".concat(L).concat(this.eol)}printIcePwd(L){return L===void 0?"":"a=ice-pwd:".concat(L).concat(this.eol)}printIceOptions(L){return L===void 0?"":"a=ice-options:".concat(L.join(_)).concat(this.eol)}printFingerprints(L){return L.length>0?L.map(ee=>"a=fingerprint:".concat(ee.hashFunction).concat(_).concat(ee.fingerprint)).join(this.eol)+this.eol:""}printExtmap(L){return L.map(ee=>"a=extmap:".concat(ee.entry).concat(ee.direction?"/".concat(ee.direction):"").concat(_).concat(ee.extensionName).concat(ee.extensionAttributes?"".concat(_).concat(ee.extensionAttributes):"").concat(this.eol)).join("")}printSetup(L){return L===void 0?"":"a=setup:".concat(L).concat(this.eol)}printUnrecognized(L){return L.map(ee=>"a=".concat(ee.attField).concat(ee.attValue?":".concat(ee.attValue):"").concat(this.eol)).join("")}}class js extends jr{print(L){let ee="";return ee+=this.printGroups(L.groups),ee+=this.printMsidSemantic(L.msidSemantic),ee+=this.printIceLite(L.iceLite),ee+=this.printIceUfrag(L.iceUfrag),ee+=this.printIcePwd(L.icePwd),ee+=this.printIceOptions(L.iceOptions),ee+=this.printFingerprints(L.fingerprints),ee+=this.printSetup(L.setup),ee+=this.printTlsId(L.tlsId),ee+=this.printIdentity(L.identities),ee+=this.printExtmap(L.extmaps),ee+=this.printUnrecognized(L.unrecognized),ee}printGroups(L){let ee="";return L.length>0&&(ee+=L.map(ue=>"a=group:".concat(ue.semantic).concat(ue.identificationTag.map(je=>"".concat(_).concat(je)).join("")).concat(this.eol)).join("")),ee}printIceLite(L){return L===void 0?"":"a=ice-lite"+this.eol}printTlsId(L){return L?"a=tls-id:".concat(L).concat(this.eol):""}printIdentity(L){return L.length===0?"":L.map(ee=>"a=identity:".concat(ee.assertionValue).concat(ee.extensions.map(ue=>"".concat(_).concat(ue.name).concat(ue.value?"=".concat(ue.value):"")))).join(this.eol)+this.eol}printMsidSemantic(L){if(!L)return"";let ee="a=msid-semantic:".concat(L.semantic);return L.applyForAll?ee+="".concat(_,"*"):L.identifierList.length>0&&(ee+=L.identifierList.map(ue=>"".concat(_).concat(ue))),ee+this.eol}}class Pe extends jr{print(L){const ee=L.attributes;let ue="";return ue+=this.printRTCP(ee.rtcp),ue+=this.printIceUfrag(ee.iceUfrag),ue+=this.printIcePwd(ee.icePwd),ue+=this.printIceOptions(ee.iceOptions),ue+=this.printCandidates(ee.candidates),ue+=this.printRemoteCandidatesList(ee.remoteCandidatesList),ue+=this.printEndOfCandidates(ee.endOfCandidates),ue+=this.printFingerprints(ee.fingerprints),ue+=this.printSetup(ee.setup),ue+=this.printMid(ee.mid),ue+=this.printExtmap(ee.extmaps),ue+=this.printRTPRelated(ee),ue+=this.printPtime(ee.ptime),ue+=this.printMaxPtime(ee.maxPtime),ue+=this.printDirection(ee.direction),ue+=this.printSSRCGroups(ee.ssrcGroups),ue+=this.printSSRC(ee.ssrcs),ue+=this.printRTCPMux(ee.rtcpMux),ue+=this.printRTCPMuxOnly(ee.rtcpMuxOnly),ue+=this.printRTCPRsize(ee.rtcpRsize),ue+=this.printMSId(ee.msids),ue+=this.printImageattr(ee.imageattr),ue+=this.printRid(ee.rids),ue+=this.printSimulcast(ee.simulcast),ue+=this.printSCTPPort(ee.sctpPort),ue+=this.printMaxMessageSize(ee.maxMessageSize),ue+=this.printUnrecognized(ee.unrecognized),ue}printCandidates(L){return L.map(ee=>"a=candidate:".concat(ee.foundation).concat(_).concat(ee.componentId).concat(_).concat(ee.transport).concat(_).concat(ee.priority).concat(_).concat(ee.connectionAddress).concat(_).concat(ee.port).concat(_,"typ").concat(_).concat(ee.type).concat(ee.relAddr?"".concat(_,"raddr").concat(_).concat(ee.relAddr):"").concat(ee.relPort?"".concat(_,"rport").concat(_).concat(ee.relPort):"").concat(Object.keys(ee.extension).map(ue=>"".concat(_).concat(ue).concat(_).concat(ee.extension[ue])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(L){return L.map(ee=>"a=remote-candidates:".concat(ee.join(_)).concat(this.eol)).join("")}printEndOfCandidates(L){return L===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(L){if(!L.payloads)return"";const ee=L.payloads;let ue="";ue+=L.rtcpFeedbackWildcards.map(je=>this.printRTCPFeedback("*",je)).join("");for(const je of ee)ue+=this.printRtpMap(je.payloadType,je.rtpMap),ue+=this.printFmtp(je.payloadType,je.fmtp),ue+=je.rtcpFeedbacks.map(jt=>this.printRTCPFeedback(je.payloadType,jt)).join("");return ue}printFmtp(L,ee){if(!ee)return"";const ue=Object.keys(ee.parameters);return ue.length===1&&ee.parameters[ue[0]]===null?"a=fmtp:".concat(L).concat(_).concat(ue[0]).concat(this.eol):"a=fmtp:".concat(L).concat(_).concat(Object.keys(ee.parameters).map(je=>"".concat(je,"=").concat(ee.parameters[je])).join(";")).concat(this.eol)}printRtpMap(L,ee){return ee?"a=rtpmap:".concat(L).concat(_).concat(ee.encodingName,"/").concat(ee.clockRate).concat(ee.encodingParameters?"/".concat(ee.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(L,ee){let ue="a=rtcp-fb:".concat(L).concat(_),je=ee;return je.type==="trr-int"?ue+="ttr-int".concat(_).concat(je.interval):(ue+="".concat(je.type),je.parameter&&(ue+="".concat(_).concat(je.parameter),je.additional&&(ue+="".concat(_).concat(je.additional)))),ue+this.eol}printPtime(L){return L===void 0?"":"a=ptime:".concat(L).concat(this.eol)}printMaxPtime(L){return L===void 0?"":"a=maxptime:".concat(L).concat(this.eol)}printDirection(L){return L===void 0?"":"a=".concat(L).concat(this.eol)}printSSRC(L){return L.map(ee=>Object.keys(ee.attributes).map(ue=>"a=ssrc:".concat(ee.ssrcId.toString(10)).concat(_).concat(ue).concat(ee.attributes[ue]?":".concat(ee.attributes[ue]):"").concat(this.eol)).join("")).join("")}printRTCPMux(L){return L===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(L){return L===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(L){return L===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(L){if(L===void 0)return"";let ee="a=rtcp:".concat(L.port);return L.netType&&(ee+="".concat(_).concat(L.netType)),L.addressType&&(ee+="".concat(_).concat(L.addressType)),L.address&&(ee+="".concat(_).concat(L.address)),ee+this.eol}printMSId(L){return L.map(ee=>"a=msid:".concat(ee.id).concat(ee.appdata?"".concat(_).concat(ee.appdata):"").concat(this.eol)).join("")}printImageattr(L){return L.map(ee=>"a=imageattr:".concat(ee).concat(this.eol)).join("")}printRid(L){return L.map(ee=>{let ue="a=rid:".concat(ee.id).concat(_).concat(ee.direction);return ee.payloads&&(ue+="".concat(_,"pt=").concat(ee.payloads.join(","))),ee.params.length>0&&(ue+="".concat(_).concat(ee.params.map(je=>je.type==="depend"?"depend=".concat(je.rids.join(",")):"".concat(je.type,"=").concat(je.val)).join(";"))),ue+this.eol}).join("")}printSimulcast(L){return L===void 0?"":"a=simulcast:".concat(L).concat(this.eol)}printSCTPPort(L){return L===void 0?"":"a=sctp-port:".concat(L).concat(this.eol)}printMaxMessageSize(L){return L===void 0?"":"a=max-message-size:".concat(L).concat(this.eol)}printMid(L){return L===void 0?"":"a=mid:".concat(L).concat(this.eol)}printSSRCGroups(L){return L.map(ee=>"a=ssrc-group:".concat(ee.semantic).concat(ee.ssrcIds.map(ue=>"".concat(_).concat(ue.toString(10))).join("")).concat(this.eol)).join("")}}function He(ke){return new Ze().parse(ke)}function dt(ke,L){return new Qr().print(ke,L)}}},n={};function i(s){if(n[s])return n[s].exports;var c=n[s]={exports:{}};return e[s](c,c.exports,i),c.exports}return i.d=(s,c)=>{for(var u in c)i.o(c,u)&&!i.o(s,u)&&Object.defineProperty(s,u,{enumerable:!0,get:c[u]})},i.o=(s,c)=>Object.prototype.hasOwnProperty.call(s,c),i.r=s=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(s,"__esModule",{value:!0})},i(8)})();function la(e){return H6.parse(e)}function Gp(e,n){return H6.print(e,n)}var Nde=Na("Array").keys,kde=rc,Dde=ui,Lde=N,xde=Nde,nL=Array.prototype,Mde={DOMTokenList:!0,NodeList:!0},Ude=function(e){var n=e.keys;return e===nL||Lde(nL,e)&&n===nL.keys||Dde(Mde,kde(e))?xde:n},_c=l(Ude);function K6(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,s)}return i}function qt(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?K6(Object(i),!0).forEach(function(s){xr(e,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):K6(Object(i)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(i,s))})}return e}function xr(e,n,i){return(n=function(s){var c=function(u,h){if(typeof u!="object"||u===null)return u;var p=u[Symbol.toPrimitive];if(p!==void 0){var _=p.call(u,"string");if(typeof _!="object")return _;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(u)}(s);return typeof c=="symbol"?c:String(c)}(n))in e?Object.defineProperty(e,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[n]=i,e}const $6=new class extends Rr{constructor(){super(...arguments),xr(this,"currentUploadLogID",0)}reportLogUploadError(e){const{errorRange:n}=e;n[n.length-1]&&n[n.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=n[n.length-1],this.emit("REPORT_LOG_UPLOAD",e))}};class Vde{constructor(n){xr(this,"logger",void 0),xr(this,"prefixLists",[]),this.logger=n}debug(){for(var n=arguments.length,i=new Array(n),s=0;s<n;s++)i[s]=arguments[s];this.logger.debug(...this.prefixLists,...i)}info(){for(var n=arguments.length,i=new Array(n),s=0;s<n;s++)i[s]=arguments[s];this.logger.info(...this.prefixLists,...i)}warning(){for(var n=arguments.length,i=new Array(n),s=0;s<n;s++)i[s]=arguments[s];this.logger.warning(...this.prefixLists,...i)}error(){for(var n=arguments.length,i=new Array(n),s=0;s<n;s++)i[s]=arguments[s];this.logger.error(...this.prefixLists,...i)}prefix(n){return this.prefixLists.push(n),this}popPrefix(){return this.prefixLists.pop(),this}}function rL(){const e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function q6(){const e=new Date,n=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return n?(n==null?void 0:n[0])+":"+e.getUTCMilliseconds():e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}const tl={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},YI=Date.now(),g0=e=>{for(const n in tl)if(Object.prototype.hasOwnProperty.call(tl,n)&&tl[n]===e)return n;return"DEFAULT"},k=new class{constructor(){xr(this,"proxyServerURL",void 0),xr(this,"logLevel",tl.DEBUG),xr(this,"uploadState","collecting"),xr(this,"uploadLogWaitingList",[]),xr(this,"uploadLogUploadingList",[]),xr(this,"uploadErrorCount",0),xr(this,"currentLogID",0),xr(this,"url",void 0),xr(this,"extLog",(e,n)=>{this.appendLogToWaitingList(e,...n)})}debug(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];const s=[tl.DEBUG].concat(n);this.log.apply(this,s)}info(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];const s=[tl.INFO].concat(n);this.log.apply(this,s)}warning(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];const s=[tl.WARNING].concat(n);this.log.apply(this,s)}warn(){this.warning(...arguments)}error(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];const s=[tl.ERROR].concat(n);this.log.apply(this,s)}upload(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];const s=[tl.DEBUG].concat(n);this.uploadLog.apply(this,s)}setLogLevel(e){e=Math.min(Math.max(0,e),4),this.logLevel=e}enableLogUpload(){Kn("UPLOAD_LOG",!0)}disableLogUpload(){Kn("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e){this.proxyServerURL=e}prefix(e){return new Vde(this).prefix(e)}log(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];if(Date.now()-YI<100)return void setTimeout(()=>{this.log(...n)},Date.now()-YI);const s=Math.max(0,Math.min(4,n[0]));if(n[0]=rL()+" Agora-SDK [".concat(g0(s),"]:"),this.appendLogToWaitingList(s,...n),s<this.logLevel)return;const c=rL()+" %cAgora-SDK [".concat(g0(s),"]:");let u=[];if(!Z("USE_NEW_LOG"))switch(s){case tl.DEBUG:u=[c,"color: #64B5F6;"].concat(n.slice(1)),console.log.apply(console,u);break;case tl.INFO:u=[c,"color: #1E88E5; font-weight: bold;"].concat(n.slice(1)),console.log.apply(console,u);break;case tl.WARNING:u=[c,"color: #FB8C00; font-weight: bold;"].concat(n.slice(1)),console.warn.apply(console,u);break;case tl.ERROR:u=[c,"color: #B00020; font-weight: bold;"].concat(n.slice(1)),console.error.apply(console,u)}}uploadLog(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];if(Date.now()-YI<100)return void setTimeout(()=>{this.uploadLog(...n)},Date.now()-YI);const s=Math.max(0,Math.min(4,n[0]));n[0]=rL()+" Agora-SDK [".concat(g0(s),"]:"),this.appendLogToWaitingList(s,...n)}appendLogToWaitingList(e){if(!Z("UPLOAD_LOG"))return;for(var n=arguments.length,i=new Array(n>1?n-1:0),s=1;s<n;s++)i[s-1]=arguments[s];Array.isArray(i[0])?i[0][0]=q6()+" Agora-SDK [".concat(g0(e),"]:"):i[0]=q6()+" Agora-SDK [".concat(g0(e),"]:");let c="";i.forEach(u=>{typeof u=="object"&&(u=JSON.stringify(u)),c+="".concat(u," ")}),this.uploadLogWaitingList.push({payload_str:c,log_level:e,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const e=this.uploadLogUploadingList,n={sdk_version:el,process_id:Z("PROCESS_ID"),payload:JSON.stringify(e)};return Bu(async()=>{const i=await Ls.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(Z("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(Z("LOG_UPLOAD_SERVER"),"/upload/v1")),n,{responseType:"text"});if(i.data!=="OK"){const s=new Error("unexpected upload log response");throw s.response=i,s}},()=>(this.uploadLogUploadingList=[],!1),i=>{const s={status:-1,message:i.message,errorRange:e.map(c=>c.log_item_id)};return i.response?(s.status=i.response.status,s.data=i.response.data,s.headers=i.response.headers):i.request&&(s.status=i.request.status),$6.reportLogUploadError(s),!0},{timeout:Z("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:Z("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,Z("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),Z("UPLOAD_LOG_INTERVAL"))}).catch(e=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),Z("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),Z("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var Y6;function Fde(e){return Xi(e.reportId,"params.reportId",0,100,!1),Xi(e.category,"params.category",0,100,!1),Xi(e.event,"params.event",0,100,!1),Xi(e.label,"params.label",0,100,!1),Yn(e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(Y6={}).FREE="free",Y6.UPLOADING="uploading",function(e){e[e.MISC=0]="MISC",e[e.INTERNAL_EVENT=1]="INTERNAL_EVENT",e[e.PUBLIC_EVENT=2]="PUBLIC_EVENT",e[e.WEB_EVENT=3]="WEB_EVENT",e[e.INTERNAL_API=4]="INTERNAL_API",e[e.WEB_API=5]="WEB_API",e[e.PUBLIC_API=6]="PUBLIC_API"}({});const jde={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let Ni=function(e){return e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.WS_COMPRESSOR_INIT="ws_compressor_init",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.REJOIN_GATEWAY="rejoin_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics",e.PC_STATS="pc_stats",e.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",e.AB_TEST="ab_test",e}({}),Er=function(e){return e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",e.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",e.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",e.PC_STATS="io.agora.pb.Wrtc.PCStats",e.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",e.AB_TEST="io.agora.pb.Wrtc.ABTest",e}({});(function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let Bde=function(e){return e[e.SESSION=26]="SESSION",e[e.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",e[e.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",e[e.JOIN_GATEWAY=28]="JOIN_GATEWAY",e[e.PUBLISH=30]="PUBLISH",e[e.SUBSCRIBE=29]="SUBSCRIBE",e[e.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",e[e.STREAM_SWITCH=32]="STREAM_SWITCH",e[e.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",e[e.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",e[e.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",e[e.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",e[e.API_INVOKE=41]="API_INVOKE",e[e.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",e[e.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",e[e.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",e[e.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",e[e.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",e[e.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",e[e.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",e[e.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",e[e.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",e[e.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",e[e.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",e[e.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",e[e.USER_ANALYTICS=1e4]="USER_ANALYTICS",e[e.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",e}({});function Ot(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(n,i,s){const c=s.value;if(typeof c=="function"){const u=e.className||n.__className__||(n.constructor.name==="AgoraRTCClient"?"Client":n.constructor.name);s.value=function(){for(var h,p=arguments.length,_=new Array(p),E=0;E<p;E++)_[E]=arguments[E];let S=_;if(e.argsMap)try{S=e.argsMap(this,..._)}catch(I){k.warning(I),S=[]}try{JSON.stringify(S)}catch{k.warning("arguments for method ".concat(u,".").concat(String(i)," not serializable for apiInvoke.")),S=[]}const w=(e.report||pt).reportApiInvoke(this._sessionId||null,{id:this._clientId||((h=this.store)===null||h===void 0?void 0:h.clientId)||this._ID,name:"".concat(u,".").concat(String(i)),options:S,tag:Dr.TRACER,reportResult:e.reportResult},e.throttleTime);try{const I=c.apply(this,_);return I instanceof Qe?I.then(P=>(w.onSuccess(e.reportResult&&P),P)).catch(P=>{throw w.onError(P),P}):(w.onSuccess(e.reportResult&&I),I)}catch(I){throw w.onError(I),I}}}return s}}const pt=new class{constructor(){xr(this,"baseInfoMap",new Map),xr(this,"proxyServer",void 0),xr(this,"eventUploadTimer",void 0),xr(this,"setSessionIdTimer",void 0),xr(this,"url",void 0),xr(this,"sids",new Set),xr(this,"backupUrl",void 0),xr(this,"_appId",void 0),xr(this,"_aid",0),xr(this,"keyEventUploadPendingItems",[]),xr(this,"normalEventUploadPendingItems",[]),xr(this,"apiInvokeUploadPendingItems",[]),xr(this,"apiInvokeCount",0),xr(this,"apiInvokeLoggedCount",0),xr(this,"ltsList",[]),xr(this,"lastSendNormalEventTime",Date.now()),xr(this,"customReportCounterTimer",void 0),xr(this,"customReportCount",0),xr(this,"extApiInvoke",async e=>{for(const n of e){const i=qt(qt({},n),{},{sid:null,invokeId:++this.apiInvokeCount,tag:Dr.TRACER});this.sendApiInvoke(i)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),Z("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),Z("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(e){return this.baseInfoMap.get(e)}setAppId(e){this._appId=e,this._aid=parseInt(e.replace(/[a-fA-F0-9]{8}/g,n=>{let[i,s]=n;return i+s}),16)||0}reportApiInvoke(e,n,i){n.timeout=n.timeout||6e4,n.reportResult=n.reportResult===void 0||n.reportResult;const s=Date.now();this.apiInvokeCount+=1;const c=this.apiInvokeCount,u=!!Z("SHOW_REPORT_INVOKER_LOG"),h=!!Z("SHOW_REPORT_USER_INVOKER_LOG"),p=u||h&&n.id;p&&(this.apiInvokeLoggedCount+=1);const _=this.apiInvokeLoggedCount;function E(P,B){if(p){let M="[apiInvoke-".concat(_,"]");n.id&&(M+="[".concat(n.id,"]")),n.name&&(M+="[".concat(n.name,"]")),k.info("".concat(M," ").concat(P),P==="start"?n.options:B||"")}}const S=()=>({tag:n.tag,invokeId:c,sid:e,name:n.name,apiInvokeTime:s,options:n.options,states:n.states||null});E("start");let w=!1;Ji(n.timeout).then(()=>{w||(this.sendApiInvoke(qt(qt({},S()),{},{error:Y.API_INVOKE_TIMEOUT,success:!1})),E("timeout"))});const I=new Ie(Y.UNEXPECTED_ERROR,"".concat(n.name,": this api invoke is end"));return{onSuccess:P=>{const B=()=>{if(w)throw I;return w=!0,this.sendApiInvoke(qt(qt({},S()),{},{success:!0},n.reportResult&&{result:P})),E("onSuccess"),P};return i?A6(B,n.name+"Success",i,()=>w=!0):B()},onError:P=>{const B=()=>{if(w)throw P;w=!0,this.sendApiInvoke(qt(qt({},S()),{},{success:!1,error:P})),E("onFailure",P.toString())};return i?A6(B,n.name+"Error",i,()=>w=!0):B()}}}sessionInit(e,n){if(this.baseInfoMap.has(e))return;const i=Date.now(),s=this.createBaseInfo(e,i);s.cname=n.cname;const c=Object.assign({},{willUploadConsoleLog:Z("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:Q1?"global":"oversea",areas:Z("AREAS")&&Z("AREAS").join(",")},n.extend),{stringUid:u,channelProfile:h,channelMode:p,isABTestSuccess:_,lsid:E,clientRole:S}=n,w=Date.now(),I=qt(qt({},s),{},{eventType:Ni.SESSION_INIT,appid:n.appid,browser:navigator.userAgent,buildFormat:n.buildFormat,build:eL,lts:w,elapse:w-i,extend:JSON.stringify(c),mode:n.mode,process:Z("PROCESS_ID"),appType:Z("APP_TYPE"),success:!0,version:el,stringUid:u,channelProfile:h,channelMode:p,isABTestSuccess:_,lsid:E,clientType:$e(P=window.navigator.userAgent).call(P,"AgoraWebView")?42:20,clientRole:S,serviceId:Z("PROCESS_ID"),extensionID:Z("PLUGIN_INFO").join(",")||""});var P;this.send({type:Er.SESSION,data:I},!0)}joinChooseServer(e,n){const i=this.baseInfoMap.get(e);if(!i)return;const s=i.info,c=Date.now(),u=qt(qt({},s),{},{role:n.role,eventType:Ni.JOIN_CHOOSE_SERVER,lts:c,eventElapse:n.elapse||c-n.lts,chooseServerAddr:n.csAddr,errorCode:n.ec,elapse:c-i.startTime,success:n.succ,chooseServerAddrList:JSON.stringify(n.serverList),uid:n.uid?parseInt(n.uid):null,cid:n.cid?parseInt(n.cid):null,chooseServerIp:n.csIp||"",opid:n.opid,unilbsServerIds:n.unilbsServerIds,extend:n.extend||void 0,isHttp3:n.isHttp3,corssRegionTagReq:n.corssRegionTagReq||void 0,corssRegionTagRes:n.corssRegionTagRes||void 0});this.send({type:Er.JOIN_CHOOSE_SERVER,data:u},!0)}reqUserAccount(e,n){const i=this.baseInfoMap.get(e);if(!i)return;const s=i.info,c=Date.now(),u=qt(qt({},s),{},{eventType:Ni.REQ_USER_ACCOUNT,lts:c,success:n.success,serverAddress:n.serverAddr,stringUid:n.stringUid,uid:n.uid,errorCode:n.errorCode,elapse:n.elapse||c-i.startTime,eventElapse:c-n.lts,extend:JSON.stringify(n.extend)});this.send({type:Er.REQ_USER_ACCOUNT,data:u},!0)}joinGateway(e,n){const i=this.baseInfoMap.get(e);if(!i)return;const s=i.info;n.vid&&(s.vid=n.vid),s.uid=n.uid,s.cid=n.cid;const c=Date.now(),{firstSuccess:u,avoidJoinStartTime:h,addr:p,isProxy:_}=n,E=c-(u&&h?h:i.startTime),S=qt(qt({},s),{},{eventType:Ni.JOIN_GATEWAY,lts:c,gatewayAddr:n.addr,success:n.succ,errorCode:n.ec,errorMsg:n.errorMsg||"",elapse:E,eventElapse:c-n.lts,firstSuccess:u,signalChannel:n.signalChannel,preload:n.preload?1:0,installId:J1(),isABTestSuccess:n.isABTestSuccess?1:0}),w=S.success?1:0;if(n.succ&&(i.lastJoinSuccessTime=c),u)this.send({type:Er.JOIN_GATEWAY,data:S},!0);else{let I;if(p)if(_){const B=p.match(/h=(\d{1,3}-){3}\d{1,3}/g),M=p.match(/p=[0-9]{1,6}/g);I={isSuccess:w,gatewayIp:B&&B.length?B[0].split("=")[1].replace(/-/g,"."):"",port:M&&M.length?M[0].split("=")[1]:"",isProxy:_?1:0}}else{const B=p.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),M=p.match(/(:|p=)[0-9]{1,6}/g);I={isSuccess:w,gatewayIp:B&&B.length?B[0].split("//")[1].replace(/-/g,"."):"",port:M&&M.length?M[0].split(/:|p=/g)[1]:"",isProxy:_?1:0}}else I={isSuccess:w,gatewayIp:"",port:"",isProxy:_?1:0};delete S.success,delete S.eventType,delete S.firstSuccess,S.vid=Number(S.vid);const P=Object.assign({},S,I,{eventType:Ni.REJOIN_GATEWAY});this.send({type:Er.RE_JOIN_GATEWAY,data:P},!0)}}joinChannelTimeout(e,n){const i=this.baseInfoMap.get(e);if(!i)return;const s=Date.now(),c=qt(qt({},i.info),{},{lts:s,timeout:n,elapse:s-i.startTime});this.send({type:Er.JOIN_CHANNEL_TIMEOUT,data:c},!0)}publish(e,n){const i=this.baseInfoMap.get(e);if(!i)return;const s=i.info,c=Date.now(),u=qt(qt({},s),{},{eventType:Ni.PUBLISH,lts:c,eventElapse:n.eventElapse,elapse:c-i.startTime,success:n.succ,errorCode:n.ec,videoName:n.videoName,audioName:n.audioName,screenName:n.screenName,screenshare:n.screenshare,audio:n.audio,video:n.video,p2pid:n.p2pid,publishRequestid:n.publishRequestid});this.send({type:Er.PUBLISH,data:u},!0)}subscribe(e,n,i){const s=this.baseInfoMap.get(e);if(!s)return;const c=s.info,u=Date.now(),h=qt(qt({},c),{},{eventType:Ni.SUBSCRIBE,lts:u,eventElapse:n.eventElapse,elapse:u-s.startTime,success:n.succ,errorCode:n.ec,video:n.video,audio:n.audio,subscribeRequestid:n.subscribeRequestid,p2pid:n.p2pid,preSsrc:n.preSsrc?1:0},i&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof n.peerid=="string"?h.peerSuid=n.peerid:h.peer=n.peerid,this.send({type:Er.SUBSCRIBE,data:h},!0)}wsCompressorInit(e){var n;const i=[..._c(n=this.baseInfoMap).call(n)],s=i.length?i[0]:"UnableToGetSid",c=this.baseInfoMap.get(s);if(!c)return;const u=c.info,h=Date.now(),p=qt(qt({},u),{},{eventType:Ni.WS_COMPRESSOR_INIT,lts:h,eventElapse:e.eventElapse,elapse:h-c.startTime,status:e.status?1:2});this.send({type:Er.WS_COMPRESSOR_INIT,data:p},!0)}firstRemoteVideoDecode(e,n,i,s){const c=this.baseInfoMap.get(e);if(!c)return;const u=c.info,h=Date.now(),p=qt(qt(qt({},u),s),{},{elapse:h-c.startTime,eventType:n,lts:h,firstDecodeFrame:Math.max((s.firstFrame||h)-c.startTime,0),apEnd:Math.max(s.apEnd-c.startTime,0),apStart:Math.max(s.apStart-c.startTime,0),joinGwEnd:Math.max(s.joinGwEnd-c.startTime,0),joinGwStart:Math.max(s.joinGwStart-c.startTime,0),pcEnd:Math.max(s.pcEnd-c.startTime,0),pcStart:Math.max(s.pcStart-c.startTime,0),subscriberEnd:Math.max(s.subscriberEnd-c.startTime,0),subscriberStart:Math.max(s.subscriberStart-c.startTime,0),videoAddNotify:Math.max(s.videoAddNotify-c.startTime,0)});this.send({type:i,data:p},!0)}firstRemoteFrame(e,n,i,s){const c=this.baseInfoMap.get(e);if(!c)return;const u=c.info,h=Date.now(),p=qt(qt(qt({},u),s),{},{elapse:h-c.startTime,eventType:n,lts:h});this.send({type:i,data:p},!0)}abTest(e,n){const i=this.baseInfoMap.get(e);if(!i)return;const s=i.info,c=Date.now(),u=qt(qt(qt({},s),n),{},{vid:s.vid===void 0?0:Number(s.vid),elapse:c-i.startTime,eventType:Ni.AB_TEST,lts:c});this.send({type:Er.AB_TEST,data:u},!0)}pcStats(e,n){const i=this.baseInfoMap.get(e);if(!i)return;const s=i.info,c=Date.now(),u=qt(qt(qt({},s),n),{},{vid:s.vid===void 0?0:Number(s.vid),elapse:c-i.startTime,eventType:Ni.PC_STATS,lts:c,preallocation:n.preallocation?1:0});this.send({type:Er.PC_STATS,data:u},!0)}updateRemoteRTPCapabilities(e,n){if(e){const i=this.baseInfoMap.get(e);if(!i)return;const s=i.info,c=Date.now(),u=qt(qt(qt({},s),n),{},{vid:s.vid===void 0?0:Number(s.vid),eventType:Ni.UPDATE_REMOTE_RTPCAPABILITIES,lts:c});this.send({type:Er.UPDATE_REMOTE_RTPCAPABILITIES,data:u},!0)}}onGatewayStream(e,n,i,s){const c=this.baseInfoMap.get(e);if(!c)return;const u=c.info,h=Date.now(),p=qt(qt(qt({},u),s),{},{eventType:n,lts:h});this.send({type:i,data:p},!0)}streamSwitch(e,n){const i=this.baseInfoMap.get(e);if(!i)return;const s=i.info,c=Date.now(),u=qt(qt({},s),{},{eventType:Ni.STREAM_SWITCH,lts:c,isDual:n.isdual,elapse:c-i.startTime,success:n.succ});this.send({type:Er.STREAM_SWITCH,data:u},!0)}requestProxyAppCenter(e,n){const i=this.baseInfoMap.get(e);if(!i)return;const s=i.info,c=Date.now(),u=qt(qt({},s),{},{eventType:Ni.REQUEST_PROXY_APPCENTER,lts:c,eventElapse:c-n.lts,elapse:c-i.startTime,APAddr:n.APAddr,workerManagerList:n.workerManagerList,response:n.response,errorCode:n.ec,success:n.succ});this.send({type:Er.REQUEST_PROXY_APPCENTER,data:u},!0)}requestProxyWorkerManager(e,n){const i=this.baseInfoMap.get(e);if(!i)return;const s=i.info,c=Date.now(),u=qt(qt({},s),{},{eventType:Ni.REQUEST_PROXY_WORKER_MANAGER,lts:c,eventElapse:c-n.lts,elapse:c-i.startTime,workerManagerAddr:n.workerManagerAddr,response:n.response,errorCode:n.ec,success:n.succ});this.send({type:Er.REQUEST_PROXY_WORKER_MANAGER,data:u},!0)}setProxyServer(e){this.proxyServer=e,e?k.debug("reportProxyServerurl: ".concat(e)):k.debug("disable reportProxyServerurl: ".concat(e))}peerPublishStatus(e,n){const i=this.baseInfoMap.get(e);if(!i)return;const s=i.info,c=Date.now(),u=qt(qt({},s),{},{subscribeElapse:n.subscribeElapse,peer:n.peer,peerPublishDuration:Math.max(n.audioPublishDuration,n.videoPublishDuration),audiotag:n.audioPublishDuration>0?1:-1,videotag:n.videoPublishDuration>0?1:-1,lts:c,elapse:c-i.startTime,joinChannelSuccessElapse:c-(i.lastJoinSuccessTime||c),peerPublishDurationVideo:n.videoPublishDuration,peerPublishDurationAudio:n.audioPublishDuration});this.send({type:Er.PEER_PUBLISH_STATUS,data:u},!0)}workerEvent(e,n){const i=this.baseInfoMap.get(e);if(!i)return;const s=i.info,c=Date.now();(function(u,h,p){const _=u[h];if(!_||typeof _!="string")return[u];u[h]="";const E=Ud(JSON.stringify(u));let S=0;const w=[];let I=0;for(let P=0;P<_.length;P++)I+=_.charCodeAt(P)<=127?1:3,I<=p-E||(w[w.length]=it(it({},u),{},{[h]:_.substring(S,P)}),S=P,I=_.charCodeAt(P)<=127?1:3);return S!==_.length-1&&(w[w.length]=it(it({},u),{},{[h]:_.substring(S)})),w})(qt(qt(qt({},s),n),{},{elapse:c-i.startTime,lts:c,productType:"WebRTC"}),"payload",1300).forEach(u=>this.send({type:Er.WORKER_EVENT,data:u},!0))}apworkerEvent(e,n){const i=this.baseInfoMap.get(e);if(!i)return;const s=i.info,c=Date.now(),u=qt(qt(qt({},s),n),{},{elapse:c-i.startTime,lts:c});this.send({type:Er.AP_WORKER_EVENT,data:u},!0)}joinWebProxyAP(e,n){const i=this.baseInfoMap.get(e);if(!i)return;const s=i.info,c=Date.now(),u=qt(qt(qt({},s),n),{},{elapse:c-i.startTime,lts:c,extend:n.extend||void 0});this.send({type:Er.JOIN_WEB_PROXY_AP,data:u},!0)}WebSocketQuit(e,n){const i=this.baseInfoMap.get(e);if(!i)return;const s=i.info,c=Date.now(),u=qt(qt(qt({},s),n),{},{elapse:c-i.startTime,lts:c});this.send({type:Er.WEBSOCKET_QUIT,data:u},!0)}async sendCustomReportMessage(e,n){if(this.customReportCount+=n.length,this.customReportCount>Z("CUSTOM_REPORT_LIMIT"))throw new Ie(Y.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const i=Date.now(),s=n.map(c=>({type:Er.USER_ANALYTICS,data:qt(qt({sid:e},c),{},{lts:i})}));try{Z("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(s):await this.postDataToStatsCollector(s)}catch(c){throw k.error("send custom report message failed",c.toString()),new Ie(Y.CUSTOM_REPORT_SEND_FAILED,c.message)}}sendApiInvoke(e){const n=Z("NOT_REPORT_EVENT");if(e.tag&&$e(n)&&$e(n).call(n,e.tag))return!1;if(e.sid===null)return this.apiInvokeUploadPendingItems.push(e),!1;const i=this.baseInfoMap.get(e.sid);if(!i)return this.apiInvokeUploadPendingItems.push(e),!1;const{cname:s,uid:c,cid:u}=i.info;let h;if(e.lts=e.lts||Date.now(),e.error)if(e.error instanceof Ie){const{code:_,message:E}=e.error;h=_||E||e.error.toString()}else h=e.error.toString();const p={invokeId:e.invokeId,sid:e.sid,cname:s,cid:u,uid:c,lts:e.lts,success:e.success,elapse:e.lts-i.startTime,execElapse:e.lts-e.apiInvokeTime,apiName:e.name,options:e.options?JSON.stringify(e.options):void 0,execStates:e.states?JSON.stringify(e.states):void 0,execResult:e.result?JSON.stringify(e.result):void 0,errorCode:e.error?h:void 0,errorMsg:e.error?JSON.stringify(e.error):void 0};return this.send({type:Er.API_INVOKE,data:p},!1),!0}addSid(e){this.sids.add(e)}removeSid(e){this.sids.delete(e)}appendSessionId(){const e=this.apiInvokeUploadPendingItems;if(e.length===0)return;const n=Array.from(this.sids).find(i=>i!==null);n&&e.forEach(i=>{i&&(i.sid=n,this.sendApiInvoke(Object.assign({},i)))}),e.length=0}send(e,n){if(n)return this.keyEventUploadPendingItems.push(e),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(e),this.normalEventUploadPendingItems.length>Z("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(e,n){const i=[],s=[];for(;e.length;){const u=e.shift();i.length<20?i.push(u):s.push(u)}e.push(...s);for(const u of[...i]){var c;this.ltsList.indexOf(u.data.lts)!==-1?(u.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(u.data.lts)):(this.ltsList.push(u.data.lts),YT(c=this.ltsList).call(c,(h,p)=>h-p))}return n||(this.lastSendNormalEventTime=Date.now()),Z("ENABLE_EVENT_REPORT")&&i.length&&(Z("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(i):this.postDataToStatsCollector(i)).catch((u=>h=>{Z("EVENT_REPORT_RETRY")&&(n?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(u):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(u),this.normalEventUploadPendingItems.length>Z("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-Z("NORMAL_EVENT_QUEUE_CAPACITY")),k.warning("report: drop normal events"))))})(i)),e}async postDataToStatsCollector2(e){ri.networkState===ja.OFFLINE&&await Qe.race([ri.onlineWaiter,Ji(2*pi.maxRetryTimeout)]);const n=c=>{let u=new Uint8Array;return c.forEach(h=>{const p=F1(JSON.stringify(h.data)),_=new ArrayBuffer(5),E=(w=>{let I=0;return Object.entries(Er).forEach(P=>{let[B,M]=P;M===w.type&&(I=Bde[B])}),I})(h),S=new DataView(_);S.setUint16(0,p.byteLength,!0),S.setUint8(2,255&E),S.setUint8(3,E>>>8&255),S.setUint8(4,E>>>16&255),u=E6(u,new Uint8Array(_)),u=E6(u,p)}),u},i="event";let s=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(Z("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(i):"https://".concat(Z("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(i);for(let c=0;c<2;c+=1){c===1&&(s=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(Z("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(i):"https://".concat(Z("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(i));try{await K1(s,{timeout:1e4,data:n(e),headers:qt(qt({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(u){if(c===1)throw u;continue}return}}async postDataToStatsCollector(e){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const i=(p=>{const _=p&&p.data.sid&&this.baseInfoMap.get(p.data.sid);return _&&_.info.vid&&+_.info.vid||0})(e[0]),s=i?void 0:this._aid,c={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:e.map(p=>JSON.stringify(p)),vid:i,aid:s};ri.networkState===ja.OFFLINE&&await Qe.race([ri.onlineWaiter,Ji(2*pi.maxRetryTimeout)]);const u=n?"/events/proto-raws":"/events/messages";let h=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(Z("EVENT_REPORT_DOMAIN"),"&p=").concat(Z("STATS_COLLECTOR_PORT"),"&d=").concat(u):"https://".concat(Z("EVENT_REPORT_DOMAIN"),":").concat(Z("STATS_COLLECTOR_PORT")).concat(u));for(let p=0;p<2;p+=1){p===1&&(h=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(Z("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(Z("STATS_COLLECTOR_PORT"),"&d=").concat(u):"https://".concat(Z("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(Z("STATS_COLLECTOR_PORT")).concat(u)));try{n?await Cde(h,{timeout:1e4,data:c}):await K1(h,{timeout:1e4,data:c})}catch(_){if(p===1)throw _;continue}return}}createBaseInfo(e,n){const i=Object.assign({},jde);return i.sid=e,this.baseInfoMap.set(e,{info:i,startTime:n}),i}reportResourceTiming(e,n){const i=performance.getEntriesByName(e),s=i[i.length-1];s&&this.reportApiInvoke(n,{name:"Client.resourceTiming",options:s,tag:Dr.TRACER}).onSuccess()}};$6.on("REPORT_LOG_UPLOAD",e=>{e.networkState=ri.networkState,pt.reportApiInvoke(null,{name:"logUploadError",options:e,tag:Dr.TRACER}).onSuccess("logUploadError")});class be extends Ie{constructor(n){super(n,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),xr(this,"name","AgoraRTCException")}print(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(n,k)}throw(){super.throw(k)}}const Qi={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function Cn(){return Qi}function X6(){return"setSinkId"in HTMLAudioElement.prototype&&(!Z("RESTRICTION_SET_PLAYBACK_DEVICE")||(uf()||a6())&&!M1())}function J6(){return!Qi.supportUnifiedPlan||Z("CHROME_FORCE_PLAN_B")&&df()}let Zi=function(e){return e.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",e.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",e.IOS_INTERRUPTION_START="ios-interruption-start",e.IOS_INTERRUPTION_END="ios-interruption-end",e.STATE_CHANGE="state-change",e}({});function ME(e,n,i){return{sampleRate:e,stereo:n,bitrate:i}}function En(e,n,i,s,c){return{width:e,height:n,frameRate:i,bitrateMin:s,bitrateMax:c}}function Fl(e,n,i,s,c){return{width:{max:e},height:{max:n},frameRate:i,bitrateMin:s,bitrateMax:c}}function iL(e,n){return{numSpatialLayers:e,numTemporalLayers:n}}const Wde={"90p":En(160,90),"90p_1":En(160,90),"120p":En(160,120,15,30,65),"120p_1":En(160,120,15,30,65),"120p_3":En(120,120,15,30,50),"120p_4":En(212,120),"180p":En(320,180,15,30,140),"180p_1":En(320,180,15,30,140),"180p_3":En(180,180,15,30,100),"180p_4":En(240,180,15,30,120),"240p":En(320,240,15,40,200),"240p_1":En(320,240,15,40,200),"240p_3":En(240,240,15,40,140),"240p_4":En(424,240,15,40,220),"360p":En(640,360,15,80,400),"360p_1":En(640,360,15,80,400),"360p_3":En(360,360,15,80,260),"360p_4":En(640,360,30,80,600),"360p_6":En(360,360,30,80,400),"360p_7":En(480,360,15,80,320),"360p_8":En(480,360,30,80,490),"360p_9":En(640,360,15,80,800),"360p_10":En(640,360,24,80,800),"360p_11":En(640,360,24,80,1e3),"480p":En(640,480,15,100,500),"480p_1":En(640,480,15,100,500),"480p_2":En(640,480,30,100,1e3),"480p_3":En(480,480,15,100,400),"480p_4":En(640,480,30,100,750),"480p_6":En(480,480,30,100,600),"480p_8":En(848,480,15,100,610),"480p_9":En(848,480,30,100,930),"480p_10":En(640,480,10,100,400),"720p":En(1280,720,15,120,1130),"720p_auto":En(1280,720,30,900,3e3),"720p_1":En(1280,720,15,120,1130),"720p_2":En(1280,720,30,120,2e3),"720p_3":En(1280,720,30,120,1710),"720p_5":En(960,720,15,120,910),"720p_6":En(960,720,30,120,1380),"1080p":En(1920,1080,15,120,2080),"1080p_1":En(1920,1080,15,120,2080),"1080p_2":En(1920,1080,30,120,3e3),"1080p_3":En(1920,1080,30,120,3150),"1080p_5":En(1920,1080,60,120,4780),"1440p":En(2560,1440,30,120,4850),"1440p_1":En(2560,1440,30,120,4850),"1440p_2":En(2560,1440,60,120,7350),"4k":En(3840,2160,30,120,8910),"4k_1":En(3840,2160,30,120,8910),"4k_3":En(3840,2160,60,120,13500)},Gde={"480p":Fl(640,480,5),"480p_1":Fl(640,480,5),"480p_2":Fl(640,480,30),"480p_3":Fl(640,480,15),"720p":Fl(1280,720,5),"720p_auto":En(1280,720,30,900,3e3),"720p_1":Fl(1280,720,5),"720p_2":Fl(1280,720,30),"720p_3":Fl(1280,720,15),"1080p":Fl(1920,1080,5),"1080p_1":Fl(1920,1080,5),"1080p_2":Fl(1920,1080,30),"1080p_3":Fl(1920,1080,15)},zde={"1SL1TL":iL(1,1),"3SL3TL":iL(3,3),"2SL3TL":iL(2,3)};function Fd(e){return e||(e="480p_1"),typeof e=="string"?Object.assign({},Wde[e]):e}function oL(e){return typeof e=="string"?Object.assign({},Gde[e]):e}function XI(e){return typeof e=="string"?Object.assign({},zde[e]):e}const Hde={speech_low_quality:ME(16e3,!1),speech_standard:ME(32e3,!1,18),music_standard:ME(48e3,!1),standard_stereo:ME(48e3,!0,56),high_quality:ME(48e3,!1,128),high_quality_stereo:ME(48e3,!0,192)};function JI(e){return typeof e=="string"?Object.assign({},Hde[e]):e}const UE=[];function Q6(e){return bi(e,"mediaSource",["screen","window","application"]),!0}let ct=function(e){return e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",e.NEED_CLOSE="@need_close",e.NEED_ENABLE_TRACK="@need_enable_track",e.NEED_DISABLE_TRACK="@need_disable_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_RTC_STATS="@get_rtc_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",e.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",e.NEED_MUTE_TRACK="@need_mute_track",e.NEED_UNMUTE_TRACK="@need_unmute_track",e}({}),tr=function(e){return e.SCREEN_TRACK="screen_track",e.CUSTOM_TRACK="custome_track",e.LOW_STREAM="low_stream",e.SCREEN_LOW_TRACK="screen_low_track",e}({}),VE=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e}({}),Kde=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",e}({}),$de=function(e){return e[e.DISABLE=0]="DISABLE",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.AUDIO_ONLY=2]="AUDIO_ONLY",e[e.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",e}({}),Jg=function(e){return e.TRANSCEIVER_UPDATED="transceiver-updated",e.SEI_TO_SEND="sei-to-send",e.SEI_RECEIVED="sei-received",e.TRACK_UPDATED="track-updated",e}({}),FE=function(e){return e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.CLOSED="closed",e}({}),jE=function(e){return e.FIRST_FRAME_DECODED="first-frame-decoded",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.VIDEO_STATE_CHANGED="video-state-changed",e}({}),BE=function(e){return e.AUDIO="audio",e.VIDEO="video",e.DATA="data",e}({}),vc=function(e){return e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer",e.UPDATE_SOURCE="update_source",e}({});(function(e){e.UPDATE_TRACK_SOURCE="update-track-source"})({});const sL={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},aL={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},Z6={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},qde={uplinkNetworkQuality:0,downlinkNetworkQuality:0},eW={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let ls=function(e){return e.ON_TRACK="on_track",e.ON_NODE="on_node",e}({}),Ec=function(e){return e.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",e.REQUEST_CONSTRAINTS="request_constraints",e}({}),_0=function(e){return e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND",e}({}),Qg=function(e){return e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",e}({}),qo=function(e){return e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied",e.LOADEDDATA="loadeddata",e}({}),jd=function(e){return e[e.VideoStateStopped=0]="VideoStateStopped",e[e.VideoStateStarting=1]="VideoStateStarting",e[e.VideoStateDecoding=2]="VideoStateDecoding",e[e.VideoStateFrozen=3]="VideoStateFrozen",e}({});const cL={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let QI=function(e){return e.OPEN="open",e.MESSAGE="message",e.CLOSE="close",e.CLOSING="closing",e.ERROR="error",e}({});function tW(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,s)}return i}function yr(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?tW(Object(i),!0).forEach(function(s){Te(e,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):tW(Object(i)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(i,s))})}return e}function Te(e,n,i){return(n=function(s){var c=function(u,h){if(typeof u!="object"||u===null)return u;var p=u[Symbol.toPrimitive];if(p!==void 0){var _=p.call(u,"string");if(typeof _!="object")return _;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(u)}(s);return typeof c=="symbol"?c:String(c)}(n))in e?Object.defineProperty(e,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[n]=i,e}function yn(e,n,i,s,c){var u,h,p={};return Object.keys(s).forEach(function(_){p[_]=s[_]}),p.enumerable=!!p.enumerable,p.configurable=!!p.configurable,("value"in p||p.initializer)&&(p.writable=!0),p=ka(u=pp(h=i.slice()).call(h)).call(u,function(_,E){return E(e,n,_)||_},p),c&&p.initializer!==void 0&&(p.value=p.initializer?p.initializer.call(c):void 0,p.initializer=void 0),p.initializer===void 0&&(Object.defineProperty(e,n,p),p=null),p}class nW extends Rr{set _mediaStreamTrack(n){n!==this.mediaStreamTrack&&(this.safeEmit(Jg.TRACK_UPDATED,n),this.mediaStreamTrack=n)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(n,i){super(),Te(this,"trackMediaType",void 0),Te(this,"_ID",void 0),Te(this,"_rtpTransceiver",void 0),Te(this,"_lowRtpTransceiver",void 0),Te(this,"_hints",[]),Te(this,"_isClosed",!1),Te(this,"_originMediaStreamTrack",void 0),Te(this,"mediaStreamTrack",void 0),Te(this,"_external",{}),this._ID=i||er(8,"track-"),this._originMediaStreamTrack=n,this.mediaStreamTrack=n,function(s){$e(UE).call(UE,s)||UE.push(s)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(n){return n||Bp(()=>{var i;pt.reportApiInvoke(null,{name:fi.GET_MEDIA_STREAM_TRACK,options:[],tag:Dr.TRACER}).onSuccess(((i=this._mediaStreamTrack)===null||i===void 0?void 0:i.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(n){return n===VE.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(n){const i=UE.indexOf(n);i!==-1&&UE.splice(i,1)}(this),this.emit(FE.CLOSED),this.removeAllListeners(Jg.SEI_RECEIVED)}_updateRtpTransceiver(n,i){if(i===VE.LOW_STREAM){if(this._lowRtpTransceiver===n)return;this._lowRtpTransceiver=n}else{if(this._rtpTransceiver===n)return;this._rtpTransceiver=n}this.emit(Jg.TRANSCEIVER_UPDATED,n,i)}}class WE extends nW{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(n,i){super(n,i),Te(this,"_enabled",!0),Te(this,"_muted",!1),Te(this,"_isExternalTrack",!1),Te(this,"_isClosed",!1),Te(this,"_enabledMutex",void 0),Te(this,"processor",void 0),Te(this,"_processorContext",void 0),Te(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new To("".concat(this.getTrackId())),n.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var n,i;return(n=(i=this._originMediaStreamTrack)===null||i===void 0?void 0:i.label)!==null&&n!==void 0?n:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,k.debug("[".concat(this.getTrackId(),"] close")),this.emit(ct.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(n,i){let s=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=s,n!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),i&&this._originMediaStreamTrack.stop()),n.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=n,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Zn(this,ct.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){k.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(FE.TRACK_ENDED)}stateCheck(n,i){if(k.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(n,": ").concat(i,"]")),hf(i,n),this._enabled&&this._muted&&n==="enabled"&&i===!1)throw new Ie(Y.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",k);if(!this._enabled&&!this._muted&&n==="muted"&&i===!0)throw new Ie(Y.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",k)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():Qe.resolve([])}}const rW=window.AudioContext||window.webkitAudioContext;let yc=null;const $n=new class extends Rr{constructor(){super(...arguments),Te(this,"prevState",void 0),Te(this,"curState",void 0),Te(this,"currentTime",void 0),Te(this,"currentTimeStuckAt",void 0),Te(this,"interruptDetectorTrack",void 0),Te(this,"onLocalAudioTrackMute",()=>{k.info("ios15-interruption-start"),this.emit(Zi.IOS_15_16_INTERRUPTION_START)}),Te(this,"onLocalAudioTrackUnmute",async()=>{k.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?k.info("ios15-interruption-end-canceled"):(yc&&await yc.suspend(),this.emit(Zi.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(e){k.debug("webaudio bindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(e){k.debug("webaudio unbindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function GE(){if(!yc){if(function(){if(!rW)return void k.error("your browser is not support web audio");k.info("create audio context");const e=yr({},Z("WEBAUDIO_INIT_OPTIONS"));k.debug("audio context init option:",JSON.stringify(e)),yc=new rW(e),$n.curState=yc.state,yc.onstatechange=()=>{$n.prevState=$n.curState,$n.curState=yc?yc.state:void 0;const{prevState:n,curState:i}=$n,s=i==="running",c=i==="interrupted",u=n==="running",h=n==="suspended",p=n==="interrupted",_=vn().osVersion;(cs()||Ul())&&u&&c&&(k.info("ios".concat(_,"-interruption-start")),$n.emit(Zi.IOS_INTERRUPTION_START)),(cs()||Ul())&&(h||p)&&s&&(k.info("ios".concat(_,"-interruption-end")),$n.emit(Zi.IOS_INTERRUPTION_END)),n!==i&&$n.emit(Zi.STATE_CHANGE,i,n)},setInterval(()=>{var n;const i=(n=yc)===null||n===void 0?void 0:n.currentTime;$n.currentTime!==i?($n.currentTimeStuckAt&&(k.debug("AudioContext current time resume at ".concat(i)),$n.currentTimeStuckAt=void 0),$n.currentTime=i):(i!==$n.currentTimeStuckAt&&(pt.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:i},tag:Dr.TRACER}).onSuccess(),k.warning("AudioContext current time stuck at ".concat(i))),$n.currentTimeStuckAt=i)},5e3),async function(n){const i=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let s,c=!1,u=!1,h=!1;function p(M){n.state==="running"?_(!1):cs()||Ul()?n.state==="suspended"&&(_(!0),M&&n.resume().then(E,E)):n.state!=="closed"&&(_(!0),M&&n.resume().then(E,E))}function _(M){if(c!==M){c=M;for(let U=0,$=i;U<$.length;U+=1){const q=$[U];M?window.addEventListener(q,S,{capture:!0,passive:!0}):window.removeEventListener(q,S,{capture:!0,passive:!0})}}}function E(){p(!1)}function S(){p(!0)}function w(M){if(!h)if(s.paused)if(M){let U;I(!1),h=!0;try{U=s.play(),U?U.then(P,P):(s.addEventListener("playing",P),s.addEventListener("abort",P),s.addEventListener("error",P))}catch{P()}}else I(!0);else I(!1)}function I(M){if(u!==M){u=M;for(let U=0,$=i;U<$.length;U++){const q=$[U];M?window.addEventListener(q,B,{capture:!0,passive:!0}):window.removeEventListener(q,B,{capture:!0,passive:!0})}}}function P(){s.removeEventListener("playing",P),s.removeEventListener("abort",P),s.removeEventListener("error",P),h=!1,w(!1)}function B(){w(!0)}if(cs()){const M=n.createMediaStreamDestination(),U=document.createElement("div");U.innerHTML="<audio x-webkit-airplay='deny'></audio>",s=U.children.item(0),s.controls=!1,s.disableRemotePlayback=!0,s.preload="auto",s.srcObject=M.stream,w(!0)}$n.on(Zi.STATE_CHANGE,function(){p(!0)}),p(!1)}(yc)}(),!yc)throw new Ie(Y.NOT_SUPPORTED,"can not create audio context");return yc}return yc}function Zg(e){if(function(){if(lL!==null)return lL;const s=GE(),c=s.createBufferSource(),u=s.createGain(),h=s.createGain();c.connect(u),c.connect(h),c.disconnect(u);let p=!1;try{c.disconnect(u)}catch{p=!0}return c.disconnect(),lL=p,p}())return;const n=e.connect,i=e.disconnect;e.connect=(s,c,u)=>{var h;return e._inputNodes||(e._inputNodes=[]),$e(h=e._inputNodes).call(h,s)||(s instanceof AudioNode?(e._inputNodes.push(s),n.call(e,s,c,u)):n.call(e,s,c)),e},e.disconnect=(s,c,u)=>{i.call(e),s?BI(e._inputNodes,s):e._inputNodes=[];for(const h of e._inputNodes)n.call(e,h)}}let lL=null;function uL(e,n){let i=!1;const s=1/n;if(Z("DISABLE_WEBAUDIO")){const c=window.setInterval(()=>{i?window.clearInterval(c):e(performance.now()/1e3)},1e3*s)}else{const c=GE();let u=c.createGain();u.gain.value=0,u.connect(c.destination);const h=()=>{if(i)return void(u=null);const p=c.createOscillator();p.onended=h,p.connect(u),p.start(0),p.stop(c.currentTime+s),e(c.currentTime)};h()}return()=>{i=!0}}class iW{constructor(){Te(this,"context",void 0),Te(this,"analyserNode",void 0),Te(this,"sourceNode",void 0),this.context=GE(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(n){if(n!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=n,n==null||n.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||cs()||Ul()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const n=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(n);else{const s=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(s);for(let c=0;c<n.length;++c)n[c]=s[c]/128-1}const i=ka(n).call(n,(s,c)=>s+c*c,0)/n.length;return Math.max(10*Math.log10(i)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var n,i;(n=this.sourceNode)===null||n===void 0||n.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(i=this.sourceNode)===null||i===void 0||i.connect(this.analyserNode)}catch{k.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class oW extends Rr{get processSourceNode(){return this.sourceNode}set processedNode(n){var i;if(!this.isDestroyed&&this._processedNode!==n){try{var s;(s=this.sourceNode)===null||s===void 0||s.disconnect(this.outputNode)}catch{}(i=this._processedNode)===null||i===void 0||i.disconnect(),this._processedNode=n,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),Te(this,"outputNode",void 0),Te(this,"outputTrack",void 0),Te(this,"isPlayed",!1),Te(this,"sourceNode",void 0),Te(this,"context",void 0),Te(this,"audioBufferNode",void 0),Te(this,"destNode",void 0),Te(this,"audioOutputLevel",0),Te(this,"volumeLevelAnalyser",void 0),Te(this,"_processedNode",void 0),Te(this,"playNode",void 0),Te(this,"isDestroyed",!1),Te(this,"onNoAudioInput",void 0),Te(this,"isNoAudioInput",!1),Te(this,"_noAudioInputCount",0),this.context=GE(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),Zg(this.outputNode),this.volumeLevelAnalyser=new iW}startGetAudioBuffer(n){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(n),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=i=>{this.emit(vc.ON_AUDIO_BUFFER,function(s){for(let c=0;c<s.outputBuffer.numberOfChannels;c+=1){const u=s.outputBuffer.getChannelData(c);for(let h=0;h<u.length;h+=1)u[h]=0}return s.inputBuffer}(i))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!Cn().webAudioMediaStreamDest)throw new Ie(Y.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(n){this.context.state!=="running"&&WI(()=>{$n.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=n||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(n>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;cs()||Ul()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const i=this.volumeLevelAnalyser.getAnalyserNode();let s;i.getFloatTimeDomainData?(s=new Float32Array(i.fftSize),i.getFloatTimeDomainData(s)):(s=new Uint8Array(i.fftSize),i.getByteTimeDomainData(s));let c=!1;for(let u=0;u<s.length;u++)s[u]!==0&&(c=!0);return c?(this.isNoAudioInput=!1,!0):(await Ji(200),await this.checkHasAudioInput(n?n+1:1)&&c)}getAudioVolume(){return this.outputNode.gain.value}setVolume(n){this.outputNode.gain.setValueAtTime(n,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var n,i;(n=this.processedNode)===null||n===void 0||n.disconnect(),(i=this.sourceNode)===null||i===void 0||i.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var n;this.processedNode?(n=this.processedNode)===null||n===void 0||n.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class sW extends oW{get isFreeze(){return!1}constructor(n,i,s){var c;if(super(),Te(this,"sourceNode",void 0),Te(this,"track",void 0),Te(this,"clonedTrack",void 0),Te(this,"audioElement",void 0),Te(this,"isCurrentTrackCloned",!1),Te(this,"isRemoteTrack",!1),Te(this,"originVolumeLevelAnalyser",void 0),Te(this,"rebuildWebAudio",async()=>{if(k.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void k.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>k.info("resume success")),k.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const p=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?p.stop():this.isCurrentTrackCloned=!0;const _=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(_),Zg(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const E=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(E,this.context.currentTime),Zg(this.outputNode),this.emit(vc.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=_,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),n.kind!=="audio")throw new Ie(Y.UNEXPECTED_ERROR);this.track=n;const u=new MediaStream([this.track]);if(this.isRemoteTrack=!!i,this.sourceNode=this.context.createMediaStreamSource(u),Zg(this.sourceNode),s){const p=s.clone();p.enabled=!0,this.clonedTrack=p,k.debug("create an unmuted track ".concat(p.id," from the original track ").concat(s.id," to get the volume"));const _=this.context.createMediaStreamSource(new MediaStream([p]));Zg(_),this.originVolumeLevelAnalyser=new iW,this.originVolumeLevelAnalyser.updateSource(_)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=u;const h=vn();i&&h.os===Pi.IOS&&Number((c=h.osVersion)===null||c===void 0?void 0:c.split(".")[0])<15&&($n.on(Zi.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(p=>{p||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(n){this.sourceNode.disconnect(),this.track=n,this.isCurrentTrackCloned=!1;const i=new MediaStream([n]);this.sourceNode=this.context.createMediaStreamSource(i),Zg(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(vc.UPDATE_SOURCE),this.audioElement.srcObject=i}destroy(){var n;this.audioElement.srcObject=null,this.audioElement.remove(),$n.off("state-change",this.rebuildWebAudio),(n=this.originVolumeLevelAnalyser)===null||n===void 0||n.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(n){return this.context.createMediaStreamSource(new MediaStream([n]))}updateOriginTrack(n){const i=n.clone();i.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=i),k.debug("create an unmuted track ".concat(i.id," from the original track ").concat(n.id," to get the volume"));const s=this.context.createMediaStreamSource(new MediaStream([i]));Zg(s),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(s)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function aW(e,n,i){const s=(u,h)=>u?typeof u!="number"?u.max||u.exact||u.ideal||u.min||h:u:h,c={audio:!!i&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:s(n.height,1080),maxWidth:s(n.width,1920)}}};return n.frameRate&&typeof n.frameRate!="number"?(c.video.mandatory.maxFrameRate=n.frameRate.max,c.video.mandatory.minFrameRate=n.frameRate.min):typeof n.frameRate=="number"&&(c.video.mandatory.maxFrameRate=n.frameRate),await navigator.mediaDevices.getUserMedia(c)}async function Yde(e,n){const i=await cW(e.mediaSource),{sourceId:s,audio:c}=await function(u){let h=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new Qe((p,_)=>{const E=document.createElement("div");E.innerText="share screen",E.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const S=document.createElement("div");S.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const w=document.createElement("div");w.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",w.setAttribute("style","height: 12%;");const I=document.createElement("div");I.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const P=document.createElement("div");P.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const B=document.createElement("button");B.innerHTML="cancel",B.setAttribute("style","width: 85px;"),B.onclick=()=>{document.body.removeChild($);const q=new Error("NotAllowedError");q.name="NotAllowedError",_(q)};let M=h;const U=document.createElement("div");if(h){const q=document.createElement("input");q.setAttribute("type","checkbox");const ce=document.createElement("span");q.setAttribute("style","margin-right: 6px;"),ce.innerText="Share audio",q.checked=M,q.onchange=()=>{M=q.checked},U.appendChild(q),U.appendChild(ce)}P.appendChild(U),P.appendChild(B),S.appendChild(w),S.appendChild(I),S.appendChild(P);const $=document.createElement("div");$.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),$.appendChild(E),$.appendChild(S),document.body.appendChild($),u.map(q=>{if(q.id){const ce=document.createElement("div");ce.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let me=q.thumbnail;try{const{width:ge}=me.getSize();ge>1920&&(me=me.resize({width:1920}))}catch(ge){throw ge&&ge.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),ge}ce.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+me.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+q.name.replace(/[\u00A0-\u9999<>\&]/g,function(ge){return"&#"+ge.charCodeAt(0)+";"})+"</span>",ce.onclick=()=>{document.body.removeChild($),p({sourceId:q.id,audio:M})},I.appendChild(ce)}})})}(i,n);return await aW(s,e,c)}async function cW(e){let n=["window","screen"];e!=="application"&&e!=="window"||(n=["window"]),e==="screen"&&(n=["screen"]);const i=y6();if(!i)throw console.error("failed to fetch electron, please mount it to window"),new Ie(Y.ELECTRON_IS_NULL);let s=null;try{var c;s=((c=i.desktopCapturer)===null||c===void 0?void 0:c.getSources({types:n}))||i.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:n})}catch{s=null}s&&s.then||(s=new Qe((u,h)=>{i.desktopCapturer.getSources({types:n},(p,_)=>{p?h(p):u(_)})}));try{return await s}catch(u){throw new Ie(Y.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,u.toString())}}const dL=new To("safari");let lW=!1,uW=!1;async function Sc(e,n){let i=0,s=null;for(;i<2;)try{s=await Xde(e,n,i>0);break}catch(c){if(c instanceof Ie)throw k.error("[".concat(n,"] ").concat(c.toString())),c;const u=ZI(c.name||c.code||c,c.message);if(u.code===Y.MEDIA_OPTION_INVALID){k.debug("[".concat(n,"] detect media option invalid, retry")),i+=1,await Ji(500);continue}throw k.error("[".concat(n,"] ").concat(u.toString())),u}if(!s)throw new Ie(Y.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return s}async function Xde(e,n,i){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Ie(Y.NOT_SUPPORTED,"can not find getUserMedia");i&&(e.video&&(delete e.video.width,delete e.video.height),e.screen&&(delete e.screen.width,delete e.screen.height));const s=Cn(),c=new MediaStream;if(e.audioSource&&c.addTrack(e.audioSource),e.videoSource&&c.addTrack(e.videoSource),!e.audio&&!e.video&&!e.screen)return k.debug("Using Video Source/ Audio Source"),c;if(e.screen)if(y6())e.screen.sourceId?zE(c,await aW(e.screen.sourceId,e.screen,!!e.screenAudio)):zE(c,await Yde(e.screen,!!e.screenAudio));else if(uf()&&e.screen.extensionId&&e.screen.mandatory){if(!s.getStreamFromExtension)throw new Ie(Y.NOT_SUPPORTED,"This browser does not support screen sharing");k.debug("[".concat(n,'] Screen access on chrome stable, looking for extension"'));const I=await(h=e.screen.extensionId,p=n,new Qe((P,B)=>{try{chrome.runtime.sendMessage(h,{getStream:!0},M=>{if(!M||!M.streamId)return k.error("[".concat(p,"] No response from Chrome Plugin. Plugin not installed properly"),M),void B(new Ie(Y.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));P(M.streamId)})}catch(M){k.error("[".concat(p,"] AgoraRTC screensharing plugin is not accessible(").concat(h,")"),M.toString()),B(new Ie(Y.CHROME_PLUGIN_NOT_INSTALL))}}));e.screen.mandatory.chromeMediaSourceId=I,zE(c,await navigator.mediaDevices.getUserMedia({video:{mandatory:e.screen.mandatory}}))}else if(s.getDisplayMedia){var u;e.screen.mediaSource&&Q6(e.screen.mediaSource);const I={width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate,displaySurface:(u=e.screen.displaySurface)!==null&&u!==void 0?u:e.screen.mediaSource==="screen"?"monitor":e.screen.mediaSource},{selfBrowserSurface:P,surfaceSwitching:B,systemAudio:M,preferCurrentTab:U}=e.screen,$={selfBrowserSurface:P,surfaceSwitching:B,systemAudio:M,preferCurrentTab:U};!P&&delete $.selfBrowserSurface,!B&&delete $.surfaceSwitching,!M&&delete $.systemAudio,!U&&delete $.preferCurrentTab,k.debug("[".concat(n,"] getDisplayMedia:"),JSON.stringify({video:I,audio:e.screenAudio,controls:$})),zE(c,await navigator.mediaDevices.getDisplayMedia(yr({video:I,audio:e.screenAudio},$)))}else{if(!Nr())throw k.error("[".concat(n,"] This browser does not support screenSharing")),new Ie(Y.NOT_SUPPORTED,"This browser does not support screen sharing");{e.screen.mediaSource&&Q6(e.screen.mediaSource);const I={video:{mediaSource:e.screen.mediaSource,width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}};k.debug("[".concat(n,"] getUserMedia: ").concat(JSON.stringify(I))),zE(c,await navigator.mediaDevices.getUserMedia(I))}}var h,p;if(!e.video&&!e.audio)return c;let _={video:e.video,audio:e.audio},E=Z("MEDIA_DEVICE_CONSTRAINTS");if(E)try{typeof E=="string"&&(E=JSON.parse(E)),_=W1(_,E)}catch{}k.debug("[".concat(n,"] GetUserMedia"),JSON.stringify(_)),vn();let S,w=null;(lo()||cs()||FI())&&(w=await dL.lock());try{S=await navigator.mediaDevices.getUserMedia(_)}catch(I){throw w&&w(),I}return _.audio&&(lW=!0),_.video&&(uW=!0),zE(c,S),w&&w(),c}function ZI(e,n){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new Ie(Y.MEDIA_OPTION_INVALID,"".concat(e,": ").concat(n));case"NotFoundError":case"DevicesNotFoundError":return new Ie(Y.DEVICE_NOT_FOUND,"".concat(e,": ").concat(n));case"NotSupportedError":return new Ie(Y.NOT_SUPPORTED,"".concat(e,": ").concat(n));case"NotReadableError":return new Ie(Y.NOT_READABLE,"".concat(e,": ").concat(n));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new Ie(Y.PERMISSION_DENIED,"".concat(e,": ").concat(n));case"ConstraintNotSatisfiedError":return new Ie(Y.CONSTRAINT_NOT_SATISFIED,"".concat(e,": ").concat(n));default:return k.error("getUserMedia unexpected error",e),new Ie(Y.UNEXPECTED_ERROR,"".concat(e,": ").concat(n))}}function zE(e,n){const i=e.getVideoTracks()[0],s=e.getAudioTracks()[0],c=n.getVideoTracks()[0],u=n.getAudioTracks()[0];u&&(s&&e.removeTrack(s),e.addTrack(u)),c&&(i&&e.removeTrack(i),e.addTrack(c))}const Tc=new class extends Rr{get state(){return this._state}set state(e){e!==this._state&&(this.emit(Qg.STATE_CHANGE,e),this._state=e)}constructor(){super(),Te(this,"_state",_0.IDLE),Te(this,"isAccessMicrophonePermission",!1),Te(this,"isAccessCameraPermission",!1),Te(this,"lastAccessMicrophonePermission",!1),Te(this,"lastAccessCameraPermission",!1),Te(this,"checkdeviceMatched",!1),Te(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(Z("ENUMERATE_DEVICES_INTERVAL")||(jI()||VI()===Pi.HARMONY_OS)&&df())&&this.updateDevicesInfo()},Z("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(e=>k.error(e.toString()))}async enumerateDevices(e,n){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new Ie(Y.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const s=await navigator.mediaDevices.enumerateDevices(),c=this.checkMediaDeviceInfoIsOk(s);let u=!this.isAccessMicrophonePermission&&e,h=!this.isAccessCameraPermission&&n;c.audio&&(u=!1),c.video&&(h=!1);let p=null,_=null,E=null;if(!i&&(u||h)){if(dL.isLocked&&(k.debug("[device manager] wait GUM lock"),(await dL.lock())(),k.debug("[device manager] GUM unlock")),lW&&(u=!1,this.isAccessMicrophonePermission=!0),uW&&(h=!1,this.isAccessCameraPermission=!0),k.debug("[device manager] check media device permissions",e,n,u,h),u&&h){try{E=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(S){const w=ZI(S.name||S.code||S,S.message);if(w.code===Y.PERMISSION_DENIED)throw w;k.warning("getUserMedia failed in getDevices",w)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(u){try{p=await navigator.mediaDevices.getUserMedia({audio:e})}catch(S){const w=ZI(S.name||S.code||S,S.message);if(w.code===Y.PERMISSION_DENIED)throw w;k.warning("getUserMedia failed in getDevices",w)}this.isAccessMicrophonePermission=!0}else if(h){try{_=await navigator.mediaDevices.getUserMedia({video:n})}catch(S){const w=ZI(S.name||S.code||S,S.message);if(w.code===Y.PERMISSION_DENIED)throw w;k.warning("getUserMedia failed in getDevices",w)}this.isAccessCameraPermission=!0}k.debug("[device manager] mic permission",e,"cam permission",n)}try{const S=await navigator.mediaDevices.enumerateDevices();return p&&p.getTracks().forEach(w=>w.stop()),_&&_.getTracks().forEach(w=>w.stop()),E&&E.getTracks().forEach(w=>w.stop()),p=null,_=null,E=null,S}catch(S){return p&&p.getTracks().forEach(w=>w.stop()),_&&_.getTracks().forEach(w=>w.stop()),E&&E.getTracks().forEach(w=>w.stop()),p=null,_=null,E=null,new Ie(Y.ENUMERATE_DEVICES_FAILED,S.toString()).throw()}}async getRecordingDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(n=>n.kind==="audioinput")}async getCamerasDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,e)).filter(n=>n.kind==="videoinput")}async getSpeakers(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(n=>n.kind==="audiooutput")}searchDeviceIdByName(e){let n=null;return this.deviceInfoMap.forEach(i=>{i.device.label===e&&(n=i.device.deviceId)}),n}async getDeviceById(e){const n=(await this.enumerateDevices(!0,!0,!0)).find(i=>i.deviceId===e);if(!n)throw new Ie(Y.DEVICE_NOT_FOUND,"deviceId: ".concat(e));return n}async init(){this.state=_0.INITING;try{await this.updateDevicesInfo(),this.state=_0.INITEND}catch(e){throw k.warning("Device Detection functionality cannot start properly.",e.toString()),this.state=_0.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new Ie(Y.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),e}}async updateDevicesInfo(){const e=await this.enumerateDevices(!0,!0,!0),n=Date.now(),i=[];if(e[0]&&e[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const c=e.find(h=>h.kind==="audioinput"&&h.deviceId==="default"),u=e.find(h=>h.kind==="audiooutput"&&h.deviceId==="default");c&&u?u.groupId===c.groupId?k.debug("[device-check] default input ".concat(c.label," and output ").concat(u.label," is the same group")):k.debug("[device-check] default input ".concat(c.label," and output ").concat(u.label," is not the same group")):k.debug("[device-check] default input or output not found")}const s=this.checkMediaDeviceInfoIsOk(e);if(e.forEach(c=>{if(!c.deviceId)return;const u=this.deviceInfoMap.get("".concat(c.kind,"_").concat(c.deviceId));if((u?u.state:"INACTIVE")!=="ACTIVE"){const h={initAt:n,updateAt:n,device:c,state:"ACTIVE"};this.deviceInfoMap.set("".concat(c.kind,"_").concat(c.deviceId),h),i.push(h)}u&&(u.updateAt=n)}),this.deviceInfoMap.forEach((c,u)=>{c.state==="ACTIVE"&&c.updateAt!==n&&(c.state="INACTIVE",i.push(c))}),this.state!==_0.INITEND)return s.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(s.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));i.forEach(c=>{switch(c.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Qg.RECORDING_DEVICE_CHANGED,c);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(Qg.CAMERA_DEVICE_CHANGED,c);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Qg.PLAYOUT_DEVICE_CHANGED,c)}}),s.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),s.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(e){const n=e.filter(c=>c.kind==="audioinput"),i=e.filter(c=>c.kind==="videoinput"),s={audio:!1,video:!1};for(const c of n)if(c.label&&c.deviceId){s.audio=!0;break}for(const c of i)if(c.label&&c.deviceId){s.video=!0;break}return s}};let hL=!1;const bc=new class extends Rr{constructor(){super(...arguments),Te(this,"onAutoplayFailed",void 0),Te(this,"onAudioAutoplayFailed",void 0)}};function dW(){if(vn(),!hL){const e=n=>{n.preventDefault(),hL=!1,c0()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};hL=!0,c0()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),k.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),bc.onAutoplayFailed?bc.onAutoplayFailed():bc.onAudioAutoplayFailed?k.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):k.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),bc.emit("autoplay-failed")}}function hW(e,n,i,s){if(!e)return;const c=pt.getBaseInfoBySessionId(e);if(!c)return;const u=c.info,h=Date.now(),p=yr(yr({},u),{},{vid:u.vid===void 0?0:Number(u.vid),lts:h,elapse:h-c.startTime,cbRegistered:bc.onAutoplayFailed||bc.onAudioAutoplayFailed?1:-1,errorMsg:i,mediaType:n,trackId:s,extend:void 0});pt.send({type:Er.AUTOPLAY_FAILED,data:p},!0)}const Jde=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],xs=new class{constructor(){Te(this,"onAutoplayFailed",void 0),Te(this,"elementMap",new Map),Te(this,"elementStateMap",new Map),Te(this,"elementsNeedToResume",[]),Te(this,"sinkIdMap",new Map),Te(this,"autoResumeAfterInterruption",e=>{Array.from(this.elementMap.entries()).forEach(n=>{let[i,s]=n;const c=this.elementStateMap.get(i),u=s.srcObject.getAudioTracks()[0],h=u&&u.readyState;if(k.debug("resume after interrupted, ele: ".concat(c," audio: ").concat(h," ").concat(e)),h==="live"){if(e)return s.pause(),void s.play();if($n.curState==="running")return PE()?(s.pause(),void s.play()):void(c&&c==="paused"&&s.play())}})}),Te(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(e=>{let[n,i]=e;const s=i.srcObject.getAudioTracks()[0];s&&s.readyState==="live"&&(k.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),i.pause(),i.play())})}),this.autoResumeAudioElement(),$n.on(Zi.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),$n.on(Zi.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),$n.on(Zi.STATE_CHANGE,()=>{cs()&&$n.prevState==="suspended"&&$n.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(e,n){const i=this.elementMap.get(e);if(this.sinkIdMap.set(e,n),i)try{await i.setSinkId(n)}catch(s){throw new Ie(Y.PERMISSION_DENIED,"can not set sink id: "+s.toString())}}play(e,n,i,s){if(this.elementMap.has(n))return;const c=document.createElement("audio");c.autoplay=!0,c.srcObject=new MediaStream([e]),this.bindAudioElementEvents(n,c),this.elementMap.set(n,c),this.elementStateMap.set(n,qo.INIT),this.setVolume(n,i);const u=this.sinkIdMap.get(n);if(u)try{c.setSinkId(u).catch(p=>{k.warning("[".concat(n,"] set sink id failed"),p.toString())})}catch(p){k.warning("[".concat(n,"] set sink id failed"),p.toString())}const h=c.play();h&&h.then&&h.catch(p=>{s&&hW(s,"audio",p.message,n),k.warning("audio element play warning",p.toString()),this.elementMap.has(n)&&p.name==="NotAllowedError"&&(k.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(c),WI(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),dW()}))})}updateTrack(e,n){const i=this.elementMap.get(e);i&&(i.srcObject=new MediaStream([n]))}isPlaying(e){return this.elementMap.has(e)&&this.elementStateMap.get(e)==="playing"}setVolume(e,n){const i=this.elementMap.get(e);i&&(n=Math.max(0,Math.min(100,n)),i.volume=n/100)}stop(e){const n=this.elementMap.get(e);if(this.sinkIdMap.delete(e),!n)return;const i=this.elementsNeedToResume.indexOf(n);this.elementsNeedToResume.splice(i,1),n.srcObject=null,n.remove(),this.elementMap.delete(e),this.elementStateMap.delete(e)}bindAudioElementEvents(e,n){Jde.forEach(i=>{n.addEventListener(i,s=>{const c=this.elementStateMap.get(e),u=s.type==="pause"?"paused":s.type;if(k.debug("[".concat(e,"] audio-element-status change ").concat(c," => ").concat(u)),s.type==="error"){const h=n==null?void 0:n.error;h&&k.error("[".concat(e,"] media error, code: ").concat(h.code,", message: ").concat(h.message))}this.elementStateMap.set(e,u)})})}getPlayerState(e){return this.elementStateMap.get(e)||"uninit"}autoResumeAudioElement(){const e=()=>{this.elementsNeedToResume.forEach(n=>{n.play().then(i=>{k.debug("Auto resume audio element success")}).catch(i=>{k.warning("Auto resume audio element failed!",i)})}),this.elementsNeedToResume=[]};new Qe(n=>{document.body?n():window.addEventListener("load",()=>n())}).then(()=>{c0()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0))})}};function Xr(){return function(e,n,i){const s=i.value;return typeof s=="function"&&(i.value=function(){this._isClosed&&new Ie(Y.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",k);for(var c=arguments.length,u=new Array(c),h=0;h<c;h++)u[h]=arguments[h];const p=s.apply(this,u);return p instanceof Qe?new Qe((_,E)=>{p.then(_).catch(E)}):p}),i}}class fW extends Rr{constructor(n){super(),Te(this,"name","VideoProcessorDestination"),Te(this,"ID","0"),Te(this,"_source",void 0),Te(this,"videoContext",void 0),Te(this,"inputTrack",void 0),this.videoContext=n}get kind(){return"video"}get enabled(){return!0}pipe(){throw new Ie(Y.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new Ie(Y.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(n){if(n.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);n.track&&n.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=n.track,this.emit(ls.ON_TRACK,n.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(ls.ON_TRACK,void 0)}}class pW extends Rr{set chained(n){this._chained=n}get chained(){return this._chained}constructor(n,i){super(),Te(this,"constraintsMap",new Map),Te(this,"statsRegistry",[]),Te(this,"usageRegistry",[]),Te(this,"trackId",void 0),Te(this,"direction",void 0),Te(this,"_chained",!1),this.trackId=n,this.direction=i}async getConstraints(){return await ho(this,Ec.REQUEST_CONSTRAINTS)}async requestApplyConstraints(n,i){var s;return k.info("processor ".concat(i.name," requestApplyConstraints for ").concat(this.trackId)),n&&this.constraintsMap.set(i,n),Zn(this,Ec.REQUEST_UPDATE_CONSTRAINTS,Array.from(fc(s=this.constraintsMap).call(s)))}async requestRevertConstraints(n){var i;if(this.constraintsMap.has(n))return k.info("processor ".concat(n.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(n),Zn(this,Ec.REQUEST_UPDATE_CONSTRAINTS,Array.from(fc(i=this.constraintsMap).call(i)))}registerStats(n,i,s){this.statsRegistry.find(c=>c.processorID===n.ID&&c.processorName===n.name&&c.type===i)||this.statsRegistry.push({processorName:n.name,processorID:n.ID,type:i,cb:s})}unregisterStats(n,i){const s=this.statsRegistry.findIndex(c=>c.processorID===n.ID&&c.processorName===n.name&&c.type===i);s!==-1&&this.statsRegistry.splice(s,1)}gatherStats(){const n=[];for(const{processorID:i,processorName:s,type:c,cb:u}of this.statsRegistry)try{const h=u();n.push({processorID:i,processorName:s,type:c,stats:h})}catch(h){k.error(new Ie(Y.UNEXPECTED_ERROR,h.message))}return n}registerUsage(n,i){this.usageRegistry.find(s=>s.processorID===n.ID&&s.processorName===n.name)||this.usageRegistry.push({processorID:n.ID,processorName:n.name,cb:i})}unregisterUsage(n){const i=this.usageRegistry.findIndex(s=>s.processorID===n.ID&&s.processorName===n.name);i!==-1&&this.usageRegistry.splice(i,1)}async gatherUsage(){const n=[];if(!this.chained)return[];for(const{cb:i}of this.usageRegistry)try{let s=i();s instanceof Qe&&(s=await s),n.push(yr(yr({},s),{},{direction:this.direction}))}catch(s){k.error("gather extension usage error",s)}return n}getDirection(){return this.direction}}class mW extends Rr{constructor(n){super(),Te(this,"name","AudioProcessorDestination"),Te(this,"ID","0"),Te(this,"inputTrack",void 0),Te(this,"inputNode",void 0),Te(this,"audioProcessorContext",void 0),Te(this,"_source",void 0),this.audioProcessorContext=n}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new Ie(Y.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new Ie(Y.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(ls.ON_TRACK,void 0),this.emit(ls.ON_NODE,void 0)}updateInput(n){if(n.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);n.track&&this.inputTrack!==n.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=n.track,this.emit(ls.ON_TRACK,this.inputTrack)),n.node&&this.inputNode!==n.node&&(this.audioProcessorContext.chained=!0,this.inputNode=n.node,this.emit(ls.ON_NODE,this.inputNode))}}class gW extends Rr{set chained(n){this._chained=n}get chained(){return this._chained}constructor(n,i,s){super(),Te(this,"constraintsMap",new Map),Te(this,"statsRegistry",[]),Te(this,"audioContext",void 0),Te(this,"trackId",void 0),Te(this,"direction",void 0),Te(this,"usageRegistry",[]),Te(this,"_chained",!1),this.audioContext=n,this.trackId=i,this.direction=s}async getConstraints(){return ho(this,Ec.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(n,i){var s;return k.info("processor ".concat(i.name," requestApplyConstraints for ").concat(this.trackId)),n&&this.constraintsMap.set(i,n),Zn(this,Ec.REQUEST_UPDATE_CONSTRAINTS,Array.from(fc(s=this.constraintsMap).call(s)))}async requestRevertConstraints(n){var i;if(this.constraintsMap.has(n))return this.constraintsMap.delete(n),Zn(this,Ec.REQUEST_UPDATE_CONSTRAINTS,Array.from(fc(i=this.constraintsMap).call(i)))}registerStats(n,i,s){this.statsRegistry.find(c=>c.processorID===n.ID&&c.processorName===n.name&&c.type===i)||this.statsRegistry.push({processorName:n.name,processorID:n.ID,type:i,cb:s})}unregisterStats(n,i){const s=this.statsRegistry.findIndex(c=>c.processorID===n.ID&&c.processorName===n.name&&c.type===i);s!==-1&&this.statsRegistry.splice(s,1)}gatherStats(){const n=[];for(const{processorID:i,processorName:s,type:c,cb:u}of this.statsRegistry)try{const h=u();n.push({processorID:i,processorName:s,type:c,stats:h})}catch(h){k.error(new Ie(Y.UNEXPECTED_ERROR,h.message))}return n}registerUsage(n,i){this.usageRegistry.find(s=>s.processorID===n.ID&&s.processorName===n.name)||this.usageRegistry.push({processorID:n.ID,processorName:n.name,cb:i})}unregisterUsage(n){const i=this.usageRegistry.findIndex(s=>s.processorID===n.ID&&s.processorName===n.name);i!==-1&&this.usageRegistry.splice(i,1)}async gatherUsage(){const n=[];if(!this.chained)return[];for(const{cb:i}of this.usageRegistry)try{let s=i();s instanceof Qe&&(s=await s),n.push(yr(yr({},s),{},{direction:this.direction}))}catch(s){k.error("gather extension usage error",s)}return n}getDirection(){return this.direction}}class fL extends Rr{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),Te(this,"context",void 0),Te(this,"processSourceNode",void 0),Te(this,"outputTrack",void 0),Te(this,"processedNode",void 0),Te(this,"clonedTrack",void 0),Te(this,"outputNode",void 0),this.outputNode=new Qde}setVolume(){}createOutputTrack(){throw new Ie(Y.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class Qde{disconnect(){}connect(){}}function _W(e){return new Qe((n,i)=>{let s=!1;const c=document.createElement("video");c.setAttribute("autoplay",""),c.setAttribute("muted",""),c.muted=!0,c.autoplay=!0,c.setAttribute("playsinline",""),c.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(c);const u=cs()?"canplay":"playing";c.addEventListener(u,()=>{const h=c.videoWidth,p=c.videoHeight;!h&&Nr()||(s=!0,c.srcObject=null,c.remove(),n([h,p]))}),c.srcObject=new MediaStream([e]),c.play().catch(GI),setTimeout(()=>{s||(c.srcObject=null,c.remove(),n([c.videoWidth,c.videoHeight]))},4e3)})}function eA(e){const n={};e.facingMode&&(n.facingMode=e.facingMode),e.cameraId&&(n.deviceId={exact:e.cameraId});const i=Fd(e.encoderConfig);return i.width!=null&&(n.width=i.width),i.height!=null&&(n.height=i.height),!m6()&&i.frameRate&&(n.frameRate=i.frameRate),a6()&&typeof n.frameRate=="object"&&(n.frameRate.max=60),Nr()&&(n.frameRate={ideal:30,max:30}),n}function vW(e){const n={};return m6()||(e.AGC!==void 0&&(n.autoGainControl=e.AGC),e.AEC!==void 0&&(n.echoCancellation=e.AEC),e.ANS!==void 0&&(n.noiseSuppression=e.ANS,uf()&&e.ANS&&(n.googHighpassFilter=e.ANS))),n}function EW(e){const n=vW(e);if(e.encoderConfig){const i=JI(e.encoderConfig);n.channelCount=i.stereo?2:1,n.sampleRate=i.sampleRate,n.sampleSize=i.sampleSize}return e.microphoneId&&(n.deviceId={exact:e.microphoneId}),jI()&&(n.sampleRate=void 0),n}const Zde=e=>{const n=e._encoderConfig;if(!n)return;const{frameRate:i,width:s,height:c}=e.getMediaStreamTrackSettings();let{frameRate:u=i,width:h=s,height:p=c}=n;if(!u||!h||!p)return;h=G1(h),p=G1(p),u=G1(u);const{max:_,min:E}=function(P,B,M){const U=200*Math.pow(M/15,.6)*Math.pow(P*B/640/360,.75);return{min:Math.floor(U),max:Math.floor(4*U)}}(h,p,u),{bitrateMax:S,bitrateMin:w}=n||{};S||k.debug("calculate bitrate: [w: ".concat(h,", h: ").concat(p,", fps: ").concat(u,"] => [brMax: ").concat(S,", brMin: ").concat(w,"]"));const{maxFramerate:I}=Z("ENCODER_CONFIG_LIMIT");return I&&typeof I=="number"&&(u=Math.min(u,I)),{frameRate:u,bitrateMax:S||_,bitrateMin:w||E,scaleResolutionDownBy:1,scale:0}},yW=async(e,n,i)=>await(async(s,c,u)=>{const h=function(E){const S=[];for(let w=0;w<E.length;w+=2)S.push(parseInt(E.slice(w,w+2),16));return Uint8Array.from(S)}(N6(""+c+u)).slice(0,16),p=h.slice(0,12),_=await window.crypto.subtle.importKey("raw",h,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:p},_,s))})(e.buffer,n,i),pL=e=>{const n=document.createElement("canvas");return n.width=2,n.height=2,new Qe((i,s)=>{n.toBlob(async c=>{if(n.remove(),c){const u=await SW(c);i({buffer:u,width:n.width,height:n.height})}else s(new Ie(Y.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,1)})},SW=async e=>{const n=await e.arrayBuffer();return new Uint8Array(n)};var TW,bW,wW,RW,CW,IW,AW,OW,PW,NW,kW,DW,LW,xW,MW,UW,VW,FW,Cr,jW,BW,WW,GW,zW,HW,Bd,KW,$W,qW,YW,XW,JW,QW,ZW,eG,tG,nG,rG,iG,po;let Fr=(TW=Ot({argsMap:(e,n)=>[e.getTrackId(),n],throttleTime:300}),bW=Ot({argsMap:(e,n)=>[e.getTrackId(),n]}),wW=Xr(),RW=DE("LocalAudioTrack","_enabledMutex"),CW=Ot({argsMap:(e,n)=>[e.getTrackId(),n]}),IW=Xr(),AW=DE("LocalAudioTrack","_enabledMutex"),OW=Ot({argsMap:(e,n)=>[e.getTrackId(),n]}),PW=Xr(),NW=Xr(),kW=Xr(),DW=Ot({argsMap:e=>[e.getTrackId()]}),LW=Xr(),xW=Ot({argsMap:e=>[e.getTrackId()]}),MW=Xr(),UW=Ot({argsMap:e=>[e.getTrackId()]}),VW=Ot({argsMap:(e,n)=>[e.getTrackId(),n.name]}),FW=Ot({argsMap:e=>[e.getTrackId()]}),yn((Cr=class extends WE{get _source(){return this.initWebAudio()}set _source(e){this._trackSource=e}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?xs.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(e,n,i,s){super(e,i),Te(this,"trackMediaType",BE.AUDIO),Te(this,"_encoderConfig",void 0),Te(this,"_trackSource",void 0),Te(this,"metadata",[]),Te(this,"_enabled",!0),Te(this,"_volume",100),Te(this,"_useAudioElement",!0),Te(this,"_bypassWebAudio",!1),Te(this,"processor",void 0),Te(this,"_processorContext",void 0),Te(this,"_processorDestination",void 0),Te(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=n,this._getOriginVolumeLevel=!!s,this._trackSource=new fL,Z("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),Z("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),lo()&&!yc?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(e){Yn(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&xs.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void k.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const n=this._source.createOutputTrack();this._mediaStreamTrack!==n&&(this._mediaStreamTrack=n,Zn(this,ct.NEED_REPLACE_TRACK,this).then(()=>{k.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(i=>{k.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),i)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(e){if(!this._useAudioElement||!X6())throw new Ie(Y.NOT_SUPPORTED,"your browser does not support setting the audio output device");await xs.setSinkID(this.getTrackId(),e)}async setEnabled(e,n,i){return this._setEnabled(e,n,i)}async _setEnabled(e,n,i){if(!i){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(k.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){this._originMediaStreamTrack.enabled=!0;try{i||(this._enabled=!0),await Zn(this,ct.NEED_ENABLE_TRACK,this),k.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(e," success"))}catch(s){throw i||(this._enabled=!1),k.error("[".concat(this.getTrackId(),"] setEnabled to true error"),s.toString()),s}}else{this._originMediaStreamTrack.enabled=!1,i||(this._enabled=!1);try{await Zn(this,ct.NEED_DISABLE_TRACK,this)}catch(s){throw i||(this._enabled=!0),k.error("[".concat(this.getTrackId(),"] setEnabled to false error"),s.toString()),s}}}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,k.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await Zn(this,ct.NEED_MUTE_TRACK,this):await Zn(this,ct.NEED_UNMUTE_TRACK,this))}getStats(){return Bp(()=>{k.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),mc(this,ct.GET_STATS)||yr({},sL)}setAudioFrameCallback(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(vc.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(n),this._source.removeAllListeners(vc.ON_AUDIO_BUFFER),this._source.on(vc.ON_AUDIO_BUFFER,i=>e(i))}play(){k.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(k.debug("[".concat(this.getTrackId(),"] start audio playback in element")),xs.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){k.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?xs.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];k.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&xs.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(e,n){this._originMediaStreamTrack!==e&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),n&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:e,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Zn(this,ct.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(e))}renewMediaStreamTrack(e){return Qe.resolve(void 0)}pipe(e){if(this._bypassWebAudio)throw new Ie(Y.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new Ie(Y.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(!this.processor)return;const n=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,n.reset()}bindProcessorDestinationEvents(e){e.on(ls.ON_TRACK,async n=>{n?n!==this._mediaStreamTrack&&(this._mediaStreamTrack=n,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(n),await Zn(this,ct.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Zn(this,ct.NEED_REPLACE_TRACK,this))}),e.on(ls.ON_NODE,n=>{this._source.processedNode=n})}unbindProcessorDestinationEvents(e){e.removeAllListeners(ls.ON_TRACK),e.removeAllListeners(ls.ON_NODE)}bindProcessorContextEvents(e){e.on(Ec.REQUEST_CONSTRAINTS,async n=>{n(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(e){e.removeAllListeners(Ec.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof fL&&(this._trackSource=new sW(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const e=new gW(this._source.context,this.getTrackId(),"local"),n=new mW(e);return this._processorContext=e,this._processorDestination=n,this.bindProcessorContextEvents(e),this.bindProcessorDestinationEvents(n),this._source.on(vc.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:e})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(xs.stop(this.getTrackId()),this._source.play()),Zn(this,ct.NEED_REPLACE_MIXING_TRACK,this).then(()=>{k.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(i=>{k.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),i)})),{processorContext:e,processorDestination:n}}}).prototype,"setVolume",[TW],Object.getOwnPropertyDescriptor(Cr.prototype,"setVolume"),Cr.prototype),yn(Cr.prototype,"setPlaybackDevice",[bW,wW],Object.getOwnPropertyDescriptor(Cr.prototype,"setPlaybackDevice"),Cr.prototype),yn(Cr.prototype,"setEnabled",[RW,CW,IW],Object.getOwnPropertyDescriptor(Cr.prototype,"setEnabled"),Cr.prototype),yn(Cr.prototype,"setMuted",[AW,OW,PW],Object.getOwnPropertyDescriptor(Cr.prototype,"setMuted"),Cr.prototype),yn(Cr.prototype,"getStats",[NW],Object.getOwnPropertyDescriptor(Cr.prototype,"getStats"),Cr.prototype),yn(Cr.prototype,"setAudioFrameCallback",[kW],Object.getOwnPropertyDescriptor(Cr.prototype,"setAudioFrameCallback"),Cr.prototype),yn(Cr.prototype,"play",[DW,LW],Object.getOwnPropertyDescriptor(Cr.prototype,"play"),Cr.prototype),yn(Cr.prototype,"stop",[xW,MW],Object.getOwnPropertyDescriptor(Cr.prototype,"stop"),Cr.prototype),yn(Cr.prototype,"close",[UW],Object.getOwnPropertyDescriptor(Cr.prototype,"close"),Cr.prototype),yn(Cr.prototype,"pipe",[VW],Object.getOwnPropertyDescriptor(Cr.prototype,"pipe"),Cr.prototype),yn(Cr.prototype,"unpipe",[FW],Object.getOwnPropertyDescriptor(Cr.prototype,"unpipe"),Cr.prototype),Cr),tA=(jW=Ot({argsMap:(e,n)=>[e.getTrackId(),n]}),BW=Xr(),WW=DE("MicrophoneAudioTrack","_enabledMutex"),GW=Ot({argsMap:(e,n,i)=>[e.getTrackId(),n,i]}),zW=Xr(),HW=Ot({argsMap:e=>[e.getTrackId()]}),yn((Bd=class extends Fr{get __className__(){return"MicrophoneAudioTrack"}constructor(e,n,i,s){super(e,n.encoderConfig?JI(n.encoderConfig):{},s,Z("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),Te(this,"_config",void 0),Te(this,"_deviceName","default"),Te(this,"_constraints",void 0),Te(this,"_originalConstraints",void 0),Te(this,"_enabled",!0),this._config=n,this._constraints=i,this._originalConstraints=i,this._deviceName=e.label,typeof n.bypassWebAudio=="boolean"&&(this._bypassWebAudio=n.bypassWebAudio),(PE()||x1())&&$n.bindInterruptDetectorTrack(this)}async setDevice(e){if(k.info("[".concat(this.getTrackId(),"] start set device to ").concat(e)),this._enabled)try{const n=await Tc.getDeviceById(e),i={};i.audio=yr({},this._constraints),i.audio.deviceId={exact:e},this._originMediaStreamTrack.stop();let s=null;try{s=await Sc(i,this.getTrackId())}catch(c){throw k.error("[".concat(this.getTrackId(),"] setDevice failed"),c.toString()),s=await Sc({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(s.getAudioTracks()[0],!1),c}await this._updateOriginMediaStreamTrack(s.getAudioTracks()[0],!1),this._deviceName=n.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(n){throw k.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}else try{const n=await Tc.getDeviceById(e);this._deviceName=n.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(n){throw k.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}k.info("[".concat(this.getTrackId(),"] set device to ").concat(e," success"))}async setEnabled(e,n,i){if(n)return k.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(e);if(!i){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(k.info("[".concat(this.getTrackId(),"] start setEnabled"),e),Z("AUTO_RESET_AUDIO_ROUTE")&&(cs()||Ul())){const h=navigator.audioSession;h&&(e||(h.type="playback"),h.type="auto")}if(!e){var s;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(s=this._source.clonedTrack)===null||s===void 0||s.stop(),i||(this._enabled=!1);try{await Zn(this,ct.NEED_DISABLE_TRACK,this)}catch(h){throw k.error("[".concat(this.getTrackId(),"] setEnabled false failed"),h.toString()),h}return}const c=yr({},this._constraints),u=Tc.searchDeviceIdByName(this._deviceName);u&&!c.deviceId&&(c.deviceId=u);try{i||(this._enabled=!0);const h=await Sc({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(h.getAudioTracks()[0],!1),await Zn(this,ct.NEED_ENABLE_TRACK,this)}catch(h){throw i||(this._enabled=!1),k.error("[".concat(this.getTrackId(),"] setEnabled true failed"),h.toString()),h}k.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(PE()||x1())&&$n.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((cs()||Ul())&&this._enabled&&!this._isClosed&&$n.duringInterruption){const e=async()=>{$n.off(Zi.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(k.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};$n.on(Zi.IOS_INTERRUPTION_END,e)}else k.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(FE.TRACK_ENDED)}async renewMediaStreamTrack(e){const n=e||this._constraints,i=Tc.searchDeviceIdByName(this._deviceName);if(i&&!n.deviceId&&(n.deviceId=i),this._constraints=n,this._enabled){this._originMediaStreamTrack.stop();const s=await Sc({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(s.getAudioTracks()[0],!0)}}bindProcessorContextEvents(e){super.bindProcessorContextEvents(e),e.on(Ec.REQUEST_UPDATE_CONSTRAINTS,async(n,i,s)=>{try{const c=Object.assign({},this._originalConstraints,...n);await this.renewMediaStreamTrack(c),i()}catch(c){s(c)}})}unbindProcessorContextEvents(e){super.unbindProcessorContextEvents(e),e.removeAllListeners(Ec.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[jW,BW],Object.getOwnPropertyDescriptor(Bd.prototype,"setDevice"),Bd.prototype),yn(Bd.prototype,"setEnabled",[WW,GW,zW],Object.getOwnPropertyDescriptor(Bd.prototype,"setEnabled"),Bd.prototype),yn(Bd.prototype,"close",[HW],Object.getOwnPropertyDescriptor(Bd.prototype,"close"),Bd.prototype),Bd),ehe=(KW=Ot({argsMap:(e,n)=>[e.getTrackId(),n,e.duration]}),$W=Xr(),qW=Ot({argsMap:e=>[e.getTrackId()]}),YW=Xr(),XW=Ot({argsMap:e=>[e.getTrackId()]}),JW=Xr(),QW=Ot({argsMap:e=>[e.getTrackId()]}),ZW=Xr(),eG=Ot({argsMap:e=>[e.getTrackId()]}),tG=Xr(),nG=Ot({argsMap:e=>[e.getTrackId()]}),rG=Ot({argsMap:e=>[e.getTrackId()]}),iG=Xr(),yn((po=class extends Fr{get __className__(){return"BufferSourceAudioTrack"}constructor(e,n,i,s){super(n.createOutputTrack(),i,s),Te(this,"source",void 0),Te(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=e,this._bufferSource=n,this._bufferSource.on(vc.AUDIO_SOURCE_STATE_CHANGE,c=>{this.safeEmit(FE.SOURCE_STATE_CHANGE,c)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(e){this._bufferSource.seekAudioBuffer(e)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(e){Yn(e,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e)}}).prototype,"startProcessAudioBuffer",[KW,$W],Object.getOwnPropertyDescriptor(po.prototype,"startProcessAudioBuffer"),po.prototype),yn(po.prototype,"pauseProcessAudioBuffer",[qW,YW],Object.getOwnPropertyDescriptor(po.prototype,"pauseProcessAudioBuffer"),po.prototype),yn(po.prototype,"seekAudioBuffer",[XW,JW],Object.getOwnPropertyDescriptor(po.prototype,"seekAudioBuffer"),po.prototype),yn(po.prototype,"resumeProcessAudioBuffer",[QW,ZW],Object.getOwnPropertyDescriptor(po.prototype,"resumeProcessAudioBuffer"),po.prototype),yn(po.prototype,"stopProcessAudioBuffer",[eG,tG],Object.getOwnPropertyDescriptor(po.prototype,"stopProcessAudioBuffer"),po.prototype),yn(po.prototype,"close",[nG],Object.getOwnPropertyDescriptor(po.prototype,"close"),po.prototype),yn(po.prototype,"setAudioBufferPlaybackSpeed",[rG,iG],Object.getOwnPropertyDescriptor(po.prototype,"setAudioBufferPlaybackSpeed"),po.prototype),po);class yi extends Fr{get __className__(){return"MixingAudioTrack"}get isActive(){for(const n of this.trackList)if(n._enabled&&!n._isClosed&&!n.muted)return!0;return!1}constructor(){const n=GE().createMediaStreamDestination();super(n.stream.getAudioTracks()[0],void 0,er(8,"track-mix-")),Te(this,"trackList",void 0),Te(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=n,this.trackList=[]}hasAudioTrack(n){return this.trackList.indexOf(n)!==-1}addAudioTrack(n){this.trackList.indexOf(n)===-1?(k.debug("add ".concat(n.getTrackId()," to mixing track")),n._source.outputNode.connect(this.destNode),this.trackList.push(n),this.updateEncoderConfig()):k.debug("track ".concat(n.getTrackId()," is already added"))}removeAudioTrack(n){if(this.trackList.indexOf(n)!==-1){k.debug("remove ".concat(n.getTrackId()," from mixing track"));try{n._source.outputNode.disconnect(this.destNode)}catch{}BI(this.trackList,n),this.updateEncoderConfig()}}updateEncoderConfig(){const n={};this.trackList.forEach(i=>{i._encoderConfig&&((i._encoderConfig.bitrate||0)>(n.bitrate||0)&&(n.bitrate=i._encoderConfig.bitrate),(i._encoderConfig.sampleRate||0)>(n.sampleRate||0)&&(n.sampleRate=i._encoderConfig.sampleRate),(i._encoderConfig.sampleSize||0)>(n.sampleSize||0)&&(n.sampleSize=i._encoderConfig.sampleSize),i._encoderConfig.stereo&&(n.stereo=!0))}),this._encoderConfig=n}_updateRtpTransceiver(n){this._rtpTransceiver!==n&&(this._rtpTransceiver=n,this.trackList.forEach(i=>{i instanceof yi?i.emit(Jg.TRANSCEIVER_UPDATED,n):i._updateRtpTransceiver(n)}))}}class the extends oW{set currentState(n){n!==this._currentState&&(this._currentState=n,this.safeEmit(vc.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),Te(this,"audioBuffer",void 0),Te(this,"sourceNode",void 0),Te(this,"startPlayTime",0),Te(this,"startPlayOffset",0),Te(this,"pausePlayTime",0),Te(this,"options",void 0),Te(this,"currentLoopCount",0),Te(this,"currentPlaybackSpeed",100),Te(this,"_currentState","stopped"),this.audioBuffer=n,this.options=i,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(n){this.currentState==="stopped"?(this.options=n,this.startPlayOffset=this.options.startPlayTime||0):k.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(n){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=n,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=n))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(n){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=n/100),this.currentPlaybackSpeed=n}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const n=this.context.createBufferSource();return n.buffer=this.audioBuffer,n.loop=!!this.options.loop,n.connect(this.outputNode),n.playbackRate.value=this.currentPlaybackSpeed/100,n}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const oG=new Map;class mL{get rendFrameRate(){if(this.renderStats&&this.renderStats.curTs!==this.renderStats.lastTs){const n=this.renderStats.curTs-this.renderStats.lastTs,i=(this.renderStats.renderNum-this.renderStats.lastRenderNum)/n;return this.renderStats.lastRenderNum=this.renderStats.renderNum,this.renderStats.lastTs=this.renderStats.curTs,i}return 0}get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(n){n!==this._videoElementStatus&&(k.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(n)),this._videoElementStatus=n)}get videoState(){return this._videoState}set videoState(n){var i;n!==this._videoState&&(this._videoState=n,(i=this.onVideoStateChanged)===null||i===void 0||i.call(this,this.videoState))}constructor(n){Te(this,"trackId",void 0),Te(this,"config",void 0),Te(this,"onFirstVideoFrameDecoded",void 0),Te(this,"onVideoStateChanged",void 0),Te(this,"freezeTimeCounterList",[]),Te(this,"renderFreezeAccTime",0),Te(this,"isKeepLastFrame",!1),Te(this,"timeUpdatedCount",0),Te(this,"freezeTime",0),Te(this,"playbackTime",0),Te(this,"lastTimeUpdatedTime",0),Te(this,"autoplayFailed",!1),Te(this,"videoTrack",void 0),Te(this,"videoElement",void 0),Te(this,"cacheVideoElement",void 0),Te(this,"renderStats",void 0),Te(this,"_videoState",jd.VideoStateStopped),Te(this,"videoElementCheckInterval",void 0),Te(this,"videoElementFreezeTimeout",void 0),Te(this,"_videoElementStatus",qo.NONE),Te(this,"isGettingVideoDimensions",!1),Te(this,"startGetVideoDimensions",()=>{const i=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return k.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(i,500)};!this.isGettingVideoDimensions&&i()}),Te(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&$n.curState==="running"&&(k.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(s6())),f6()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),Te(this,"handleVideoEvents",i=>{switch(i.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=qo.PLAYING;break;case"loadeddata":if(this.videoState=jd.VideoStateStarting,this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=qo.CANPLAY;break;case"stalled":this.videoElementStatus=qo.STALLED;break;case"suspend":this.videoElementStatus=qo.SUSPEND;break;case"pause":this.videoElementStatus=qo.PAUSED,cs()||Ul()||lo()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(k.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=qo.WAITING;break;case"abort":this.videoElementStatus=qo.ABORT;break;case"ended":this.videoElementStatus=qo.ENDED;break;case"emptied":this.videoElementStatus=qo.EMPTIED;break;case"error":{const s=this.videoElement.error;s&&(this.videoElementStatus=qo.ERROR,k.error("[".concat(this.trackId,"] media error: ").concat(s.message," (").concat(s.code,")")));break}case"timeupdate":{const s=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=s);const c=s-this.lastTimeUpdatedTime,u=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=s,pf.lastVisibleTime<pf.lastHiddenTime||u<pf.lastHiddenTime||u<pf.lastVisibleTime)return;for(c>Z("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=c),this.playbackTime+=c;this.playbackTime>=6e3;){this.playbackTime-=6e3;const h=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(h),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),Te(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(k.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(s6())),f6()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=n.trackId,this.config=n,n.element instanceof HTMLVideoElement?this.videoElement=n.element:this.videoElement=document.createElement("video"),$n.on(Zi.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),$n.on(Zi.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var n;return(n=this.videoElement.parentElement)!==null&&n!==void 0?n:void 0}updateConfig(n){this.config=n,this.trackId=n.trackId,n.element!==this.videoElement&&(this.destroy(),this.videoElement=n.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(n){this.videoTrack!==n&&(this.videoTrack=n,this.initVideoElement())}play(n){const i=this.videoElement.play();i&&i.catch&&i.catch(c=>{n&&hW(n,"video",c.message,this.trackId),c.name==="NotAllowedError"?(k.warning("detected video element autoplay failed",c),this.autoplayFailed=!0,this.handleAutoPlayFailed()):k.warning("[".concat(this.trackId,"] play warning: "),c)});const s=vn();if((s.name==="Safari"&&Number(s.version)===15||PE())&&i&&i.then){const c=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};i.then(c).catch(c)}}getCurrentFrame(){const n=document.createElement("canvas");n.width=this.videoElement.videoWidth,n.height=this.videoElement.videoHeight;const i=n.getContext("2d");if(!i)return k.error("create canvas context failed!"),new ImageData(2,2);i.drawImage(this.videoElement,0,0,n.width,n.height);const s=i.getImageData(0,0,n.width,n.height);return n.remove(),s}async getCurrentFrameToUint8Array(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const s=document.createElement("canvas");s.width=this.videoElement.videoWidth,s.height=this.videoElement.videoHeight;const c=s.getContext("2d");return c?(c.drawImage(this.videoElement,0,0,s.width,s.height),new Qe((u,h)=>{s.toBlob(async p=>{if(s.remove(),p){const _=await SW(p);u({buffer:_,width:s.width,height:s.height})}else h(new Ie(Y.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},n,i<0?.1:i>1?1:i)})):await pL(n)}destroy(){this.renderStats=void 0,$n.off(Zi.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),$n.off(Zi.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=jd.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=qo.INIT,!this.videoElementCheckInterval&&(sG.forEach(u=>{this.videoElement.addEventListener(u,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{(function(u){return u!==document.body&&document.body.contains(u)})(this.videoElement)||(this.videoElementStatus=qo.DESTROYED)},1e3),Z("ENABLE_VIDEO_FRAME_CALLBACK"))){var n,i;let u;const h=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",h),this.videoElementFreezeTimeout=window.setTimeout(p,Z("VIDEO_FREEZE_DURATION")))},p=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===jd.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=jd.VideoStateFrozen:document.addEventListener("visibilitychange",h))},_=(E,S)=>{if(this.videoElementStatus===qo.PLAYING){if(this.renderStats?(this.renderStats.renderNum++,this.renderStats.curTs=S.mediaTime):this.renderStats={lastTs:S.mediaTime,curTs:S.mediaTime,lastRenderNum:0,renderNum:0},u){const P=S.presentationTime-u.presentationTime;this.videoState===jd.VideoStateStarting&&(this.videoState=jd.VideoStateDecoding),this.videoState===jd.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(p,Z("VIDEO_FREEZE_DURATION"))),P<Z("VIDEO_FREEZE_DURATION")&&this.videoState===jd.VideoStateFrozen&&(this.videoState=jd.VideoStateDecoding),P>Z("VIDEO_FREEZE_DURATION")&&pf.lastVisibleTime>=pf.lastHiddenTime&&u.timestamp>pf.lastVisibleTime&&u.timestamp>pf.lastHiddenTime&&(this.renderFreezeAccTime+=P)}u=yr(yr({},S),{},{timestamp:E})}var w,I;Z("ENABLE_VIDEO_FRAME_CALLBACK")&&((w=(I=this.videoElement).requestVideoFrameCallback)===null||w===void 0||w.call(I,_))};(n=(i=this.videoElement).requestVideoFrameCallback)===null||n===void 0||n.call(i,_)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),jI()&&!Z("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const s=vn();s.name==="Safari"&&Number(s.version)===15||PE()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Nr()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Nr()&&this.videoElement.load());const c=this.videoElement.play();c!==void 0&&c.catch(u=>{k.debug("[".concat(this.trackId,"] playback interrupted"),u.toString())})}resetVideoElement(){sG.forEach(n=>{this.videoElement&&this.videoElement.removeEventListener(n,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=qo.NONE}handleAutoPlayFailed(){const n=i=>{i.preventDefault(),this.videoElement.play().then(()=>{k.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(s=>{k.error(s)}),this.autoplayFailed=!1,c0()?document.body.removeEventListener("click",n,!0):(document.body.removeEventListener("touchstart",n,!0),document.body.removeEventListener("mousedown",n,!0))};c0()?document.body.addEventListener("click",n,!0):(document.body.addEventListener("touchstart",n,!0),document.body.addEventListener("mousedown",n,!0)),dW()}}const sG=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class aG extends mL{constructor(n){super(n),Te(this,"container",void 0),Te(this,"slot",void 0),this.slot=n.element,this.updateConfig(n)}updateConfig(n){this.config=n,this.trackId=n.trackId;const i=n.element;i!==this.slot&&(this.destroy(),this.slot=i),this.createElements()}updateVideoTrack(n){this.videoTrack!==n&&(this.videoTrack=n,this.createElements())}play(n){var i;(i=this.container)!==null&&i!==void 0&&i.contains(this.videoElement)&&super.play(n)}getCurrentFrame(){var n;return(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(n){var i;let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(i=this.container)!==null&&i!==void 0&&i.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(n,s):await pL(n)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",Z("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var n;!this.container||(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var n;if((n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var n;(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var cG,lG,uG,dG,hG,fG,pG,mG,gG,_G,vG,EG,yG,SG,TG,bG,wG,RG,CG,IG,AG,OG,PG,NG,mn,kG,DG,LG,xG,MG,UG,VG,FG,wc;let ur=(cG=Ot({argsMap:(e,n,i)=>[e.getTrackId(),typeof n=="string"?n:n instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",i]}),lG=Xr(),uG=Ot({argsMap:e=>[e.getTrackId()]}),dG=DE("LocalVideoTrack","_enabledMutex"),hG=Ot({argsMap:(e,n)=>[e.getTrackId(),n]}),fG=Xr(),pG=DE("LocalVideoTrack","_enabledMutex"),mG=Ot({argsMap:(e,n)=>[e.getTrackId(),n]}),gG=Xr(),_G=Ot({argsMap:(e,n)=>[e.getTrackId(),n]}),vG=Xr(),EG=Xr(),yG=Ot({argsMap:(e,n,i)=>[e.getTrackId(),n,i]}),SG=Xr(),TG=Xr(),bG=Xr(),wG=Xr(),RG=Xr(),CG=Xr(),IG=Xr(),AG=Ot({argsMap:(e,n)=>[e.getTrackId(),n.name]}),OG=Ot({argsMap:e=>[e.getTrackId()]}),PG=Ot({argsMap:e=>[e.getTrackId()]}),NG=Ot({argsMap:(e,n,i)=>[e.getTrackId(),n.label,i]}),mn=class Bre extends WE{get videoHeight(){if(lo()){const{height:n}=this._mediaStreamTrack.getSettings();return this._videoHeight=n,this._videoHeight}return this._videoHeight}get videoWidth(){if(lo()){const{width:n}=this._mediaStreamTrack.getSettings();return this._videoWidth=n,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==qo.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(n){this._processorContext=n}get __className__(){return"LocalVideoTrack"}constructor(n,i,s,c,u,h){if(super(n,u),Te(this,"trackMediaType",BE.VIDEO),Te(this,"_player",void 0),Te(this,"isUseScaleResolutionDownBy",!1),Te(this,"_videoVisibleTimer",null),Te(this,"_previousVideoVisibleStatus",void 0),Te(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),Te(this,"_encoderConfig",void 0),Te(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),Te(this,"_optimizationMode",void 0),Te(this,"_videoHeight",void 0),Te(this,"_videoWidth",void 0),Te(this,"_forceBitrateLimit",void 0),Te(this,"_enabled",!0),Te(this,"_processorDestination",void 0),Te(this,"_processorContext",void 0),lo()){const{width:p,height:_}=n.getSettings();this._videoWidth=p,this._videoHeight=_}else this.updateMediaStreamTrackResolution();if(this._encoderConfig=i,this._scalabilityMode=s,this._optimizationMode=c,this._hints=h||[],this._hints.indexOf(tr.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(k1(Nn.CHROME,115)&&VI().indexOf("Windows")!==-1){const p=function(_,E){if("VideoFrame"in window&&"TransformStream"in window&&Cn().supportWebRTCInsertableStream){const S=new MediaStreamTrackProcessor(_),w=new MediaStreamTrackGenerator({kind:"video"});let I,P,B=Date.now();const M=()=>{U&&(clearInterval(U),U=void 0),I&&(I.close(),I=void 0),_.stop(),P=void 0,w.removeEventListener("ended",M)};let U=window.setInterval(()=>{if(P&&I&&Date.now()-B>1e3)try{w.readyState==="live"?P.enqueue(I.clone()):M()}catch{M()}},1e3);const $=new TransformStream({transform:(q,ce)=>{w.readyState==="live"?(P=ce,B=Date.now(),I===void 0?(I=q,ce.enqueue(q.clone())):(ce.enqueue(I),I=q)):q.close()}});return w.addEventListener("ended",M),S.readable.pipeThrough($).pipeTo(w.writable),w}}(n);p&&(k.info("local screen video track begin to inject frame"),this._mediaStreamTrack=p)}i&&this._hints.indexOf(tr.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(i),this._processorContext=new pW(this.getTrackId(),"local"),this._processorDestination=new fW(this.processorContext),this.bindProcessorDestinationEvents()}play(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof n=="string"){const c=document.getElementById(n);c?n=c:(k.warning("[".concat(this.getTrackId(),'] can not find "#').concat(n,'" element, use document.body')),n=document.body)}k.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(n instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(i));const s=yr(yr(yr({},this._getDefaultPlayerConfig()),i),{},{trackId:this.getTrackId(),element:n});this._player?this._player.updateConfig(s):(n instanceof HTMLVideoElement?this._player=new mL(s):this._player=new aG(s),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const c=this.getVideoElementVisibleStatus();this.safeEmit(FE.VIDEO_ELEMENT_VISIBLE_STATUS,c)}catch{}},Z("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,k.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(n,i){if(!i){if(n===this._enabled)return;this.stateCheck("enabled",n)}if(k.info("[".concat(this.getTrackId(),"] start setEnabled"),n),!n){this._originMediaStreamTrack.enabled=!1;try{await Zn(this,ct.NEED_DISABLE_TRACK,this)}catch(s){throw k.error("[".concat(this.getTrackId(),"] setEnabled to false error"),s.toString()),s}return i||(this._enabled=!1),void k.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await Zn(this,ct.NEED_ENABLE_TRACK,this)}catch(s){throw k.error("[".concat(this.getTrackId(),"] setEnabled to true error"),s.toString()),s}k.info("[".concat(this.getTrackId(),"] setEnabled to true success")),i||(this._enabled=!0)}async setMuted(n){n!==this._muted&&(this.stateCheck("muted",n),this._muted=n,this._originMediaStreamTrack.enabled=!n,k.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(n)),n?await Zn(this,ct.NEED_MUTE_TRACK,this):await Zn(this,ct.NEED_UNMUTE_TRACK,this))}async setEncoderConfiguration(n,i){if(!this._enabled)throw new Ie(Y.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(n=Fd(n),this._forceBitrateLimit&&(n.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:n.bitrateMax,n.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:n.bitrateMin),n.width||n.height||n.frameRate){const s=eA({encoderConfig:n});(lo()||cs()||Ul())&&(s.deviceId=void 0),k.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(n),JSON.stringify(s));try{await this._originMediaStreamTrack.applyConstraints(s),this.updateMediaStreamTrackResolution()}catch(c){const u=new Ie(Y.UNEXPECTED_ERROR,c.toString());throw k.error("[".concat(this.getTrackId(),"] applyConstraints error"),u.toString()),u}}this._encoderConfig=n,this._hints.indexOf(tr.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Zn(this,ct.NEED_UPDATE_VIDEO_ENCODER,this)}catch(s){return s.throw(k)}}getStats(){return Bp(()=>{k.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),mc(this,ct.GET_STATS)||yr({},aL)}async setBeautyEffect(n){k.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(n,i):await pL(n)}async setBitrateLimit(n){k.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(n))),n&&(this._forceBitrateLimit=n,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<n.max_bitrate?this._encoderConfig.bitrateMax:n.max_bitrate:this._encoderConfig.bitrateMax=n.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=n.min_bitrate))}async setOptimizationMode(n){if(n!=="motion"&&n!=="detail"&&n!=="balanced")return void k.error(Y.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const i=this._optimizationMode;try{this._optimizationMode=n,await Zn(this,ct.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(s){throw this._optimizationMode=i,k.error("[".concat(this.getTrackId(),"] set optimization mode failed"),s.toString()),s}k.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(n,")"))}setScalabiltyMode(n){if(n.numSpatialLayers===1&&n.numTemporalLayers!==1)return k.error(Y.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=n,k.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(n,")"))}updateMediaStreamTrackResolution(){_W(this._originMediaStreamTrack).then(n=>{let[i,s]=n;this._videoHeight=s,this._videoWidth=i}).catch(GI)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(n){if(!this._enabled)throw new Ie(Y.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");k.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(n)),n=Fd(n),this._forceBitrateLimit&&(n.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:n.bitrateMax,n.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:n.bitrateMin),this._encoderConfig=n,this._hints.indexOf(tr.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Zn(this,ct.NEED_UPDATE_VIDEO_ENCODER,this)}catch(i){return i.throw(k)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:n,height:i,frameRate:s}=this.getMediaStreamTrackSettings();if(!n||!i||!s)return;const{bitrateMax:c,bitrateMin:u}=this._encoderConfig;if(u==null||c==null){const{max:h,min:p}=function(_,E,S,w,I){const P=Z("BITRATE_ADAPTER_TYPE");if(P==="DEFAULT_BITRATE")return{min:w,max:I};if(I===void 0){var B;const U=Math.floor(200*Math.pow(S/15,.6)*Math.pow(_*E/640/360,.75));I=P==="STANDARD_BITRATE"?4*U:2*U,w=(B=w)!==null&&B!==void 0?B:U}else{var M;w=(M=w)!==null&&M!==void 0?M:Math.floor(I/10)}return{min:w,max:I}}(n,i,s,u,c);this._encoderConfig.bitrateMin=p,this._encoderConfig.bitrateMax=h,k.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(n,", h: ").concat(i,", fps: ").concat(s,"] => [brMax: ").concat(h,", brMin: ").concat(p,"]"))}}getVideoElementVisibleStatus(){try{var n,i;const s=this==null||(n=this._player)===null||n===void 0?void 0:n.getContainerElement(),c={track:this,element:this==null||(i=this._player)===null||i===void 0?void 0:i.getVideoElement(),slot:s==null?void 0:s.parentElement},{element:u,slot:h}=c;if(this.isPlaying&&u instanceof HTMLVideoElement&&h instanceof HTMLElement){const p=v6.checkOneElementVisible(u),_=Object.assign({},p);if(_.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=_.visible;const E=pt.reportApiInvoke(null,{tag:Dr.TRACER,name:fi.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});_.visible?E.onSuccess("Video is visible"):E.onSuccess("Invisible because of ".concat(_.reason))}return _}return}catch(s){throw new Ie(Y.GET_VIDEO_ELEMENT_VISIBLE_ERROR,s.message)}}async renewMediaStreamTrack(n){}pipe(n){if(this.processor===n)return n;if(n._source)throw new Ie(Y.INVALID_OPERATION,"Processor ".concat(n.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=n,this.processor._source=this,n.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),n}unpipe(){if(!this.processor)return;const n=this.processor;this.processor._source=void 0,this.processor=void 0,n.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(n){let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],s=this._encoderConfig;n&&(s=yr(yr({},s),Fd(n))),s=$g(s);const c=er(8,"track-video-cloned-"),u=new Bre(i?this._mediaStreamTrack.clone():this._mediaStreamTrack,s,$g(this._scalabilityMode),this._optimizationMode,c,$g(this._hints));return n&&s&&u.setEncoderConfiguration(s),k.debug("clone video track from ".concat(this.getTrackId()," to ").concat(c,", clone ").concat(i)),u}async replaceTrack(n,i){if(!(n instanceof MediaStreamTrack))throw new Ie(Y.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(n.kind!=="video")throw new Ie(Y.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(n,i,!0),this.updateMediaStreamTrackResolution()}sendSeiData(n){if(Bp(()=>{pt.reportApiInvoke(null,{name:fi.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:Dr.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!Z("ENABLE_VIDEO_SEI")||!Z("ENABLE_ENCODED_TRANSFORM"))return void k.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(n instanceof Uint8Array==0)return new Ie(Y.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const i=this.getRTCRtpTransceiver();if(!i)return void k.warning("Video track is not published, SEI can not be send");const s=i.sender.getParameters();if(s.codecs.length===0)return;const c=s.codecs[0].mimeType.toLocaleLowerCase();c==="video/h264"?this.safeEmit("sei-to-send",n):k.warning("SEI is not supported by ".concat(c))}bindProcessorDestinationEvents(){this.processorDestination.on(ls.ON_TRACK,async n=>{n?n!==this._mediaStreamTrack&&(this._mediaStreamTrack=n,this._updatePlayerSource(),await Zn(this,ct.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Zn(this,ct.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(ls.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(Ec.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(Ec.REQUEST_CONSTRAINTS)}},yn(mn.prototype,"play",[cG,lG],Object.getOwnPropertyDescriptor(mn.prototype,"play"),mn.prototype),yn(mn.prototype,"stop",[uG],Object.getOwnPropertyDescriptor(mn.prototype,"stop"),mn.prototype),yn(mn.prototype,"setEnabled",[dG,hG,fG],Object.getOwnPropertyDescriptor(mn.prototype,"setEnabled"),mn.prototype),yn(mn.prototype,"setMuted",[pG,mG,gG],Object.getOwnPropertyDescriptor(mn.prototype,"setMuted"),mn.prototype),yn(mn.prototype,"setEncoderConfiguration",[_G,vG],Object.getOwnPropertyDescriptor(mn.prototype,"setEncoderConfiguration"),mn.prototype),yn(mn.prototype,"getStats",[EG],Object.getOwnPropertyDescriptor(mn.prototype,"getStats"),mn.prototype),yn(mn.prototype,"setBeautyEffect",[yG,SG],Object.getOwnPropertyDescriptor(mn.prototype,"setBeautyEffect"),mn.prototype),yn(mn.prototype,"getCurrentFrameData",[TG],Object.getOwnPropertyDescriptor(mn.prototype,"getCurrentFrameData"),mn.prototype),yn(mn.prototype,"getCurrentFrameImage",[bG],Object.getOwnPropertyDescriptor(mn.prototype,"getCurrentFrameImage"),mn.prototype),yn(mn.prototype,"setBitrateLimit",[wG],Object.getOwnPropertyDescriptor(mn.prototype,"setBitrateLimit"),mn.prototype),yn(mn.prototype,"setOptimizationMode",[RG],Object.getOwnPropertyDescriptor(mn.prototype,"setOptimizationMode"),mn.prototype),yn(mn.prototype,"setScalabiltyMode",[CG],Object.getOwnPropertyDescriptor(mn.prototype,"setScalabiltyMode"),mn.prototype),yn(mn.prototype,"updateMediaStreamTrackResolution",[IG],Object.getOwnPropertyDescriptor(mn.prototype,"updateMediaStreamTrackResolution"),mn.prototype),yn(mn.prototype,"pipe",[AG],Object.getOwnPropertyDescriptor(mn.prototype,"pipe"),mn.prototype),yn(mn.prototype,"unpipe",[OG],Object.getOwnPropertyDescriptor(mn.prototype,"unpipe"),mn.prototype),yn(mn.prototype,"close",[PG],Object.getOwnPropertyDescriptor(mn.prototype,"close"),mn.prototype),yn(mn.prototype,"replaceTrack",[NG],Object.getOwnPropertyDescriptor(mn.prototype,"replaceTrack"),mn.prototype),mn),gL=(kG=Ot({argsMap:(e,n)=>[e.getTrackId(),n]}),DG=Xr(),LG=DE("CameraVideoTrack","_enabledMutex"),xG=Ot({argsMap:(e,n)=>[e.getTrackId(),n]}),MG=Xr(),UG=Ot({argsMap:(e,n)=>[e.getTrackId(),n]}),VG=Xr(),FG=Ot({argsMap:e=>[e.getTrackId()]}),wc=class Wre extends ur{get __className__(){return"CameraVideoTrack"}constructor(n,i,s,c,u,h){super(n,Fd(i.encoderConfig),c,u,h),Te(this,"_config",void 0),Te(this,"_originalConstraints",void 0),Te(this,"_constraints",void 0),Te(this,"_enabled",!0),Te(this,"_deviceName","default"),Te(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(PE()||x1())&&!function(){const p=vn();if(p.os!==Pi.IOS||!p.osVersion)return!1;const _=p.osVersion.split(".");return Number(_[0])===15&&Number(_[1])>=2}()&&p6()&&this._enabled&&!this._isClosed&&(k.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=i,this._originalConstraints=s,this._constraints=s,this._deviceName=n.label,this._encoderConfig=Fd(this._config.encoderConfig),$n.on(Zi.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),$n.on(Zi.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(n){return typeof n=="string"?this._setDeviceById(n):n.deviceId?this._setDeviceById(n.deviceId):n.facingMode?this._setDeviceByFacingModel(n.facingMode):void 0}async _setDeviceById(n){if(k.info("[".concat(this.getTrackId(),"] set device to ").concat(n)),this._enabled)try{const i=await Tc.getDeviceById(n),s={};s.video=yr({},this._constraints),s.video.deviceId={exact:n},s.video.facingMode=void 0,this._originMediaStreamTrack.stop();let c=null;try{c=await Sc(s,this.getTrackId())}catch(u){throw k.error("[".concat(this.getTrackId(),"] setDevice failed"),u.toString()),c=await Sc({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1),u}await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=i.label,this._config.cameraId=n,this._constraints.deviceId={exact:n}}catch(i){throw k.error("[".concat(this.getTrackId(),"] setDevice error"),i.toString()),i}else try{const i=await Tc.getDeviceById(n);this._deviceName=i.label,this._config.cameraId=n,this._constraints.deviceId={exact:n}}catch(i){throw k.error("[".concat(this.getTrackId(),"] setDevice error"),i.toString()),i}k.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(n){k.info("[".concat(this.getTrackId(),"] set facingMode ").concat(n));const i={video:yr(yr({},this._constraints),{},{deviceId:void 0,facingMode:{exact:n}})};if(this._enabled){this._originMediaStreamTrack.stop();let s=null;try{s=await Sc(i,this.getTrackId())}catch(c){throw k.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),c.toString()),s=await Sc({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(s.getVideoTracks()[0],!1),c}await this._updateOriginMediaStreamTrack(s.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=n,this._config.cameraId=void 0,this._constraints=yr({},i.video),k.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(n,i){if(!i){if(n===this._enabled)return;this.stateCheck("enabled",n)}if(k.info("[".concat(this.getTrackId(),"] start setEnabled"),n),n){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const s=await Sc({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(s.getVideoTracks()[0],!1)}await Zn(this,ct.NEED_ENABLE_TRACK,this)}catch(s){throw k.error("[".concat(this.getTrackId(),"] setEnabled true error"),s.toString()),s}this.updateMediaStreamTrackResolution(),k.info("[".concat(this.getTrackId(),"] setEnabled to true success")),i||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),i||(this._enabled=!1);try{await Zn(this,ct.NEED_DISABLE_TRACK,this)}catch(s){throw k.error("[".concat(this.getTrackId(),"] setEnabled to false error"),s.toString()),s}k.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(n,i){if(!this._enabled)throw new Ie(Y.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");n=Fd(n),this._forceBitrateLimit&&(n.bitrateMax=this._forceBitrateLimit.max_bitrate||n.bitrateMax,n.bitrateMin=this._forceBitrateLimit.min_bitrate||n.bitrateMin);const s=Lr(this._config);s.encoderConfig=n;const c=eA(s);(lo()||cs()||Ul())&&(c.deviceId=void 0),k.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(n),JSON.stringify(c));try{await this._originMediaStreamTrack.applyConstraints(c),this.updateMediaStreamTrackResolution()}catch(u){const h=new Ie(Y.UNEXPECTED_ERROR,u.toString());throw k.error("[".concat(this.getTrackId(),"] applyConstraints error"),h.toString()),h}this._config=s,this._constraints=c,this._originalConstraints=c,this._encoderConfig=n,this._hints.indexOf(tr.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Zn(this,ct.NEED_UPDATE_VIDEO_ENCODER,this)}catch(u){return u.throw(k)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((cs()||Ul())&&this._enabled&&!this._isClosed&&$n.duringInterruption){const n=async()=>{$n.off(Zi.IOS_INTERRUPTION_END,n),this._enabled&&!this._isClosed&&(k.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};$n.on(Zi.IOS_INTERRUPTION_END,n)}else k.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(FE.TRACK_ENDED)}async renewMediaStreamTrack(n){const i=n||this._constraints,s=Tc.searchDeviceIdByName(this._deviceName);if(s&&!i.deviceId&&(i.deviceId={exact:s}),this._enabled){const c=await Sc({video:i},this.getTrackId());this._constraints=i,await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),$n.off(Zi.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),$n.off(Zi.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(n){let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],s=this._encoderConfig;n&&(s=yr(yr({},s),Fd(n))),s=$g(s);const c=er(8,"track-cam-cloned-"),u=new Wre(i?this._mediaStreamTrack.clone():this._mediaStreamTrack,$g(yr(yr({},this._config),{},{encoderConfig:s})),$g(this._constraints),$g(this._scalabilityMode),this._optimizationMode,c);return n&&s&&u.setEncoderConfiguration(s),k.debug("clone track from ".concat(this.getTrackId()," to ").concat(c,", clone ").concat(i)),u}bindProcessorContextEvents(){this.processorContext.on(Ec.REQUEST_UPDATE_CONSTRAINTS,async(n,i,s)=>{try{const c=Object.assign({},this._originalConstraints,...n);await this.renewMediaStreamTrack(c),i()}catch(c){s(c)}}),this.processorContext.on(Ec.REQUEST_CONSTRAINTS,async n=>{n(this._originMediaStreamTrack.getSettings())})}},yn(wc.prototype,"setDevice",[kG,DG],Object.getOwnPropertyDescriptor(wc.prototype,"setDevice"),wc.prototype),yn(wc.prototype,"setEnabled",[LG,xG,MG],Object.getOwnPropertyDescriptor(wc.prototype,"setEnabled"),wc.prototype),yn(wc.prototype,"setEncoderConfiguration",[UG,VG],Object.getOwnPropertyDescriptor(wc.prototype,"setEncoderConfiguration"),wc.prototype),yn(wc.prototype,"close",[FG],Object.getOwnPropertyDescriptor(wc.prototype,"close"),wc.prototype),wc);function _L(e,n,i,s){i.optimizationMode&&(s&&s.width&&s.height?(i.encoderConfig=yr(yr({},s),{},{bitrateMin:s.bitrateMin,bitrateMax:s.bitrateMax}),i.optimizationMode!=="motion"&&i.optimizationMode!=="detail"||(n.contentHint=i.optimizationMode,n.contentHint===i.optimizationMode?k.debug("[".concat(e,"] set content hint to"),i.optimizationMode):k.debug("[".concat(e,"] set content hint failed")))):k.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}var jG,BG,WG,GG,nl,zG,HG,KG,$G,qG,YG,Yo;class XG extends nW{getUserId(){return this._userId}constructor(n,i,s,c){super(n,"track-".concat(n.kind,"-").concat(i,"-").concat(c.clientId,"_").concat(er(5,""))),Te(this,"_userId",void 0),Te(this,"_uintId",void 0),Te(this,"_isDestroyed",!1),Te(this,"store",void 0),Te(this,"processor",void 0),Te(this,"processorContext",void 0),this._userId=i,this._uintId=s,this.store=c}_updateOriginMediaStreamTrack(n){this._originMediaStreamTrack=n,this._mediaStreamTrack=n,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,k.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let HE=(jG=Ot({argsMap:(e,n,i)=>[e.getTrackId(),typeof n=="string"?n:n instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",i]}),BG=Ot({argsMap:e=>[e.getTrackId()]}),WG=Ot({argsMap:(e,n)=>[e.getTrackId(),n.name]}),GG=Ot({argsMap:e=>[e.getTrackId()]}),yn((nl=class extends XG{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==qo.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(e,n,i,s){super(e,n,i,s),Te(this,"_videoVisibleTimer",null),Te(this,"_previousVideoVisibleStatus",void 0),Te(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),Te(this,"trackMediaType",BE.VIDEO),Te(this,"_videoWidth",void 0),Te(this,"_videoHeight",void 0),Te(this,"_player",void 0),Te(this,"processorDestination",void 0),Te(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new pW(this.getTrackId(),"remote"),this.processorDestination=new fW(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return Bp(()=>{k.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),mc(this,ct.GET_STATS)||yr({},eW)}play(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof e=="string"){const s=document.getElementById(e);s?e=s:(k.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}k.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(n));const i=yr(yr({fit:"cover"},n),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(i):(e instanceof HTMLVideoElement?this._player=new mL(i):this._player=new aG(i),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(jE.FIRST_FRAME_DECODED)},this._player.onVideoStateChanged=s=>{this.safeEmit(jE.VIDEO_STATE_CHANGED,s)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const s=this.getVideoElementVisibleStatus();this.safeEmit(jE.VIDEO_ELEMENT_VISIBLE_STATUS,s)}catch{}},Z("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,k.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){_W(this._originMediaStreamTrack).then(e=>{let[n,i]=e;this._videoHeight=i,this._videoWidth=n}).catch(GI)}_updatePlayerSource(){k.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var e,n;const i=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),s={track:this,element:this==null||(n=this._player)===null||n===void 0?void 0:n.getVideoElement(),slot:i==null?void 0:i.parentElement},{element:c,slot:u}=s;if(this.isPlaying&&c instanceof HTMLVideoElement&&u instanceof HTMLElement){const h=v6.checkOneElementVisible(c),p=Object.assign({},h);if(p.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=p.visible;const _=pt.reportApiInvoke(null,{tag:Dr.TRACER,name:fi.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});p.visible?_.onSuccess("Video is visible"):_.onSuccess("Invisible because of ".concat(p.reason))}return p}return}catch(i){throw new Ie(Y.GET_VIDEO_ELEMENT_VISIBLE_ERROR,i.message)}}pipe(e){if(this.processor===e)return e;if(e._source)throw new Ie(Y.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(ls.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(ls.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(e){this.emit(Jg.SEI_RECEIVED,e)}}).prototype,"play",[jG],Object.getOwnPropertyDescriptor(nl.prototype,"play"),nl.prototype),yn(nl.prototype,"stop",[BG],Object.getOwnPropertyDescriptor(nl.prototype,"stop"),nl.prototype),yn(nl.prototype,"pipe",[WG],Object.getOwnPropertyDescriptor(nl.prototype,"pipe"),nl.prototype),yn(nl.prototype,"unpipe",[GG],Object.getOwnPropertyDescriptor(nl.prototype,"unpipe"),nl.prototype),nl),KE=(zG=Ot({argsMap:(e,n)=>[e.getTrackId(),n],throttleTime:300}),HG=Ot({argsMap:(e,n)=>[e.getTrackId(),n]}),KG=Ot({argsMap:e=>[e.getTrackId()]}),$G=Ot({argsMap:e=>[e.getTrackId()]}),qG=Ot({argsMap:(e,n)=>[e.getTrackId(),n.name]}),YG=Ot({argsMap:e=>[e.getTrackId()]}),yn((Yo=class extends XG{get isPlaying(){return this._useAudioElement?xs.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(e,n,i,s){super(e,n,i,s),Te(this,"trackMediaType",BE.AUDIO),Te(this,"_source",void 0),Te(this,"_useAudioElement",!0),Te(this,"_volume",100),Te(this,"processorContext",void 0),Te(this,"processorDestination",void 0),Te(this,"_played",!1),Te(this,"_bypassWebAudio",!1),Z("DISABLE_WEBAUDIO")?(this._source=new fL,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new sW(e,!0),Z("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(vc.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(jE.FIRST_FRAME_DECODED)}),this.processorContext=new gW(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new mW(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(vc.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(vc.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(n),this._source.removeAllListeners(vc.ON_AUDIO_BUFFER),this._source.on(vc.ON_AUDIO_BUFFER,i=>e(i))}setVolume(e){this._volume=e,this._useAudioElement?xs.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)}async setPlaybackDevice(e){if(!this._useAudioElement||!X6())throw new Ie(Y.NOT_SUPPORTED,"your browser does not support setting the audio output device");await xs.setSinkID(this.getTrackId(),e)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return Bp(()=>{k.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),mc(this,ct.GET_STATS)||yr({},Z6)}play(){k.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(k.debug("[".concat(this.getTrackId(),"] use audio element to play")),xs.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){k.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?xs.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];k.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&xs.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(e){if(this._bypassWebAudio)throw new Ie(Y.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new Ie(Y.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(this._bypassWebAudio)throw new Ie(Y.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const n=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,n.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(ls.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(ls.ON_NODE,e=>{this._source.processedNode=e;const n=!e;this._useAudioElement!==n&&(this._played?(this.stop(),this._useAudioElement=n,this.play()):this._useAudioElement=n)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(ls.ON_TRACK),this.processorDestination.removeAllListeners(ls.ON_NODE)}}).prototype,"setVolume",[zG],Object.getOwnPropertyDescriptor(Yo.prototype,"setVolume"),Yo.prototype),yn(Yo.prototype,"setPlaybackDevice",[HG],Object.getOwnPropertyDescriptor(Yo.prototype,"setPlaybackDevice"),Yo.prototype),yn(Yo.prototype,"play",[KG],Object.getOwnPropertyDescriptor(Yo.prototype,"play"),Yo.prototype),yn(Yo.prototype,"stop",[$G],Object.getOwnPropertyDescriptor(Yo.prototype,"stop"),Yo.prototype),yn(Yo.prototype,"pipe",[qG],Object.getOwnPropertyDescriptor(Yo.prototype,"pipe"),Yo.prototype),yn(Yo.prototype,"unpipe",[YG],Object.getOwnPropertyDescriptor(Yo.prototype,"unpipe"),Yo.prototype),Yo);const pf=new class extends Rr{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),Te(this,"_lastHiddenTime",0),Te(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),k.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};class JG extends Rr{constructor(n,i){super(),Te(this,"trackMediaType",BE.DATA),Te(this,"_version",1),Te(this,"_type",3),Te(this,"_config",void 0),Te(this,"_originDataChannel",void 0),Te(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),Te(this,"_dataStreamPacketHandler",{serialize:s=>s,deserialize:s=>s}),Te(this,"_datachannelEventMap",new Map),this._config=n,i&&(this._originDataChannel=i,this._bandDataChannelEvents(i)),this._initPacketHeader()}useDataStream(n){this._dataStreamPacketHandler=n}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return Z("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var n,i;return(n=(i=this._originDataChannel)===null||i===void 0?void 0:i.readyState)!==null&&n!==void 0?n:"connecting"}get _originDataChannelId(){var n,i;return(n=(i=this._originDataChannel)===null||i===void 0?void 0:i.id)!==null&&n!==void 0?n:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new Qe((n,i)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&n();const s=setTimeout(()=>{var c;i(new Ie(Y.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((c=this._originDataChannel)===null||c===void 0?void 0:c.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(s),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),n()},this._originDataChannel.onerror=()=>{throw clearTimeout(s),new Ie(Y.DATACHANNEL_CONNECTION_TIMEOUT)}}else i(new Ie(Y.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(n){this._originDataChannel=n,this._bandDataChannelEvents(n)}_initPacketHeader(){const n=new DataView(this._dataStreamPacketHeader);n.setUint16(0,this._version),n.setUint8(2,this._type),n.setUint8(3,this._config.id)}_bandDataChannelEvents(n){this._unbindDataChannelEvents(n),[QI.OPEN,QI.CLOSE,QI.ERROR].forEach(i=>{const s=()=>{this.emit(i)};this._datachannelEventMap.set(i,s),n.addEventListener(i,s)})}_unbindDataChannelEvents(n){Array.from(this._datachannelEventMap.entries()).forEach(i=>{let[s,c]=i;n.removeEventListener(s,c)}),this._datachannelEventMap.clear()}}class nhe extends JG{constructor(n){super(n),Te(this,"_messageListener",void 0),this._messageListener=i=>{if(i.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const s=i.data.slice(0,this._dataStreamPacketHeader.byteLength),c=new DataView(s).getUint8(3);if(c!==this.id)return void(Z("SHOW_DATASTREAM2_LOG")&&k.debug("invalid datachannel id: ".concat(c," !== ").concat(this.id)));let u=i.data.slice(this._dataStreamPacketHeader.byteLength);u=this._dataStreamPacketHandler.deserialize(u),this.emit(QI.MESSAGE,u)}}_updateOriginDataChannel(n){super._updateOriginDataChannel(n),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class rhe extends JG{send(n){if(this._originDataChannel){let i=n;i=this._dataStreamPacketHandler.serialize(n);const s=new Uint8Array(this._dataStreamPacketHeader.byteLength+i.byteLength);s.set(new Uint8Array(this._dataStreamPacketHeader),0),s.set(new Uint8Array(i),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(s.buffer)}}}function nA(){const e=new Blob([atob("ZnVuY3Rpb24gdCh0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLG89W10scj0wO2Zvcig7by5sZW5ndGg8bjspciszPG4mJjA9PT1hW3JdJiYwPT09YVtyKzFdJiYzPT09YVtyKzJdJiYoMD09PWFbciszXXx8MT09PWFbciszXXx8Mj09PWFbciszXXx8Mz09PWFbciszXSk/KG8ucHVzaChhW3JdLGFbcisxXSxhW3IrM10pLHIrPTQpOihvLnB1c2goYVtyXSkscisrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobyl9ZnVuY3Rpb24gZSh0LGUpe2NvbnN0IG49ZnVuY3Rpb24odCl7Y29uc3QgZT10Lmxlbmd0aDtsZXQgbj1bXSxhPTA7Zm9yKDthPGU7KWErMjxlJiYwPT09dFthXSYmMD09PXRbYSsxXSYmKDA9PT10W2ErMl18fDE9PT10W2ErMl18fDI9PT10W2ErMl18fDM9PT10W2ErMl0pPyhuLnB1c2godFthXSx0W2ErMV0sMyx0W2ErMl0pLGErPTMpOihuLnB1c2godFthXSksYSsrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobil9KGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxyPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNitvKzErYSt0LmJ5dGVMZW5ndGgpO3NbMF09MCxzWzFdPTAsc1syXT0wLHNbM109MSxzWzRdPTYsc1s1XT0xMDE7bGV0IGk9MDtmb3IoO2k8bzspc1s2K2ldPTI1NSxpKys7cmV0dXJuIHNbNitpXT1yLGkrKyxzLnNldChuLDYraSkscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNitpK2EpLHMuYnVmZmVyfWNvbnN0IG49NzEsYT0xLG89MixyPTEscz0yO3ZhciBpOyFmdW5jdGlvbih0KXt0W3QuQVVESU9fTEVWRUw9MV09IkFVRElPX0xFVkVMIix0W3QuTUVUQURBVEE9Ml09Ik1FVEFEQVRBIix0W3QuQVVESU9fNjRfQklUX1BUUz0zXT0iQVVESU9fNjRfQklUX1BUUyJ9KGl8fChpPXt9KSk7bmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJTYWZhcmkiKT4tMSYmLTE9PT1uYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoIkNocm9tZSIpJiYoc2VsZi5vbnJ0Y3RyYW5zZm9ybT1mPT57Y29uc3QgdT1mLnRyYW5zZm9ybWVyO2xldCBkPVtdLGw9W107dS5vcHRpb25zLnBvcnQub25tZXNzYWdlPXQ9Pnt0LmRhdGEuc2VpJiZkLnB1c2godC5kYXRhLnNlaSksdC5kYXRhLm1ldGFkYXRhJiZsLnB1c2godC5kYXRhLm1ldGFkYXRhKX0sc2VsZi5wb3N0TWVzc2FnZSgic3RhcnRlZCIpO2NvbnN0IGc9dS5yZWFkYWJsZS5nZXRSZWFkZXIoKSxjPXUud3JpdGFibGUuZ2V0V3JpdGVyKCk7InNlaS1yeCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiBlKG4pe2cucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IGU9ZnVuY3Rpb24oZSl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcoZS5kYXRhKTtsZXQgYT0wO2Zvcig7YSs0PGUuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PW4uZ2V0VWludDgoYSswKSYmMD09PW4uZ2V0VWludDgoYSsxKSYmMD09PW4uZ2V0VWludDgoYSsyKSYmMT09PW4uZ2V0VWludDgoYSszKSYmNj09PW4uZ2V0VWludDgoYSs0KSl7bGV0IG89YSs2LHI9MCxzPTA7Zm9yKDsyNTU9PT0ocz1uLmdldFVpbnQ4KG8rKykpOylyKz0yNTU7cis9cztjb25zdCBpPXQoZS5kYXRhLG8scik7cmV0dXJuIG5ldyBVaW50OEFycmF5KGkpfWErK31yZXR1cm4gbnVsbH0oYS52YWx1ZSk7ZSYmbi5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3NlaTplfSl9Yy53cml0ZShhLnZhbHVlKSxuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSxlKG4pfX0pKX0odSk6InNlaS10eCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KG4pe2cucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IHQ9ZC5zaGlmdCgpO3QmJihhLnZhbHVlLmRhdGE9ZShhLnZhbHVlLmRhdGEsdCkpfWMud3JpdGUoYS52YWx1ZSksbi5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3RyYW5zZm9ybWVkOiEwfSksdChuKX19KSl9KHUpOiJhdWRpby1tZXRhZGF0YS1yeCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KGUpe2cucmVhZCgpLnRoZW4oKGY9PntpZighZi5kb25lKXtpZihmLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZEF1ZGlvRnJhbWUpe2NvbnN0IHQ9ZnVuY3Rpb24odCxlPSExKXtjb25zdCBmPXQuZ2V0VWludDgoMCk7aWYoZiE9PW4pcmV0dXJuO2NvbnN0IHU9dC5nZXRVaW50MTYoMSksZD1hK28rdSxsPW5ldyBVaW50OEFycmF5KHQuYnl0ZUxlbmd0aC1kKTtsLnNldChuZXcgVWludDhBcnJheSh0LmJ1ZmZlcixkLHQuYnl0ZUxlbmd0aC1kKSk7Y29uc3QgZz17bTpmLHRsdkxlbjp1LHRsdjpbXSxmcmFtZTpsfTtsZXQgYz1hK287Zm9yKDtjPGQ7KXtjb25zdCBuPXQuZ2V0VWludDgoYyksYT10LmdldFVpbnQxNihjK3IpLG89citzO2lmKG49PT1pLkFVRElPX0xFVkVMKXtsZXQgcj10LmdldFVpbnQ4KGMrbyk7Zm9yKGxldCBlPTE7ZTxhO2UrKylyPXI8PDh8dC5nZXRVaW50OChjK28rZSk7Zy50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZT8xMjdecj4+MToxMjcmcn0pfWVsc2UgaWYobj09PWkuTUVUQURBVEF8fG49PT1pLkFVRElPXzY0X0JJVF9QVFMpe2NvbnN0IGU9bmV3IFVpbnQ4QXJyYXkoYSk7Zm9yKGxldCBuPTA7bjxhO24rKyllW25dPXQuZ2V0VWludDgoYytvK24pO2cudGx2LnB1c2goe3RhZzpuLGxlbmd0aDphLHZhbHVlOmV9KX1jKz1vK2F9cmV0dXJuIGd9KG5ldyBEYXRhVmlldyhmLnZhbHVlLmRhdGEpKTtpZih0KXtjb25zdCBuPXQudGx2LmZpbmQoKHQ9PnQudGFnPT09aS5NRVRBREFUQXx8dC50YWc9PT1pLkFVRElPXzY0X0JJVF9QVFMpKTtuJiZuLnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe21ldGFkYXRhOm4udmFsdWV9KSxmLnZhbHVlLmRhdGE9dC5mcmFtZS5idWZmZXJ9fWMud3JpdGUoZi52YWx1ZSksZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3RyYW5zZm9ybWVkOiEwfSksdChlKX19KSl9KHUpOiJhdWRpby1tZXRhZGF0YS10eCI9PT11Lm9wdGlvbnMubmFtZSYmZnVuY3Rpb24gdChlKXtnLnJlYWQoKS50aGVuKChmPT57aWYoIWYuZG9uZSl7aWYoZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe2dldE1ldGFkYXRhOiEwfSksZi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRBdWRpb0ZyYW1lKXtjb25zdCB0PWwuc2hpZnQoKTt0JiYoZi52YWx1ZS5kYXRhPWZ1bmN0aW9uKHQsZSxpKXtjb25zdCBmPWkuYnl0ZUxlbmd0aCx1PWYrcitzLGQ9YStvK3UsbD1uZXcgQXJyYXlCdWZmZXIodC5ieXRlTGVuZ3RoK2QpLGc9bmV3IERhdGFWaWV3KGwpO2cuc2V0VWludDgoMCxuKSxnLnNldFVpbnQxNigxLHUpLGcuc2V0VWludDgoMyxlKSxnLnNldFVpbnQxNig0LGYpO2ZvcihsZXQgdD0wO3Q8Zjt0KyspZy5zZXRVaW50OCg2K3QsaVt0XSk7Y29uc3QgYz1uZXcgVWludDhBcnJheShnLmJ1ZmZlcik7cmV0dXJuIGMuc2V0KG5ldyBVaW50OEFycmF5KHQpLGQpLGMuYnVmZmVyfShmLnZhbHVlLmRhdGEsaS5BVURJT182NF9CSVRfUFRTLHQpKX1jLndyaXRlKGYudmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfSh1KX0sc2VsZi5wb3N0TWVzc2FnZSgicmVnaXN0ZXJlZCIpKTsK")],{type:"text/javascript"});return setTimeout(()=>nI.revokeObjectURL(e),0),new Worker(nI.createObjectURL(e))}const QG=71,vL=1,EL=2,yL=1,ZG=2;var mf=function(e){return e[e.AUDIO_LEVEL=1]="AUDIO_LEVEL",e[e.METADATA=2]="METADATA",e[e.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",e}(mf||{});function ez(e){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const i=e.getUint8(0);if(i!==QG)return;const s=e.getUint16(1),c=vL+EL+s,u=new Uint8Array(e.byteLength-c);u.set(new Uint8Array(e.buffer,c,e.byteLength-c));const h={m:i,tlvLen:s,tlv:[],frame:u};let p=vL+EL;for(;p<c;){const _=e.getUint8(p),E=e.getUint16(p+yL),S=yL+ZG;if(_===mf.AUDIO_LEVEL){let w=e.getUint8(p+S);for(let I=1;I<E;I++)w=w<<8|e.getUint8(p+S+I);h.tlv.push({tag:_,length:E,value:n?127^w>>1:127&w})}else if(_===mf.METADATA||_===mf.AUDIO_64_BIT_PTS){const w=new Uint8Array(E);for(let I=0;I<E;I++)w[I]=e.getUint8(p+S+I);h.tlv.push({tag:_,length:E,value:w})}p+=S+E}return h}const rA=new Map,iA=127,e_=1e-10,SL=139/13,oA=new Map;function TL(e,n,i){const s="".concat(e,"-").concat(n,"-").concat(i);let c=0;return oA.has(s)?c=oA.get(s):(c=Math.log(function(h,p){const _=h-p;p<_&&(p=_);let E=1;for(let S=h,w=1;S>p;S--,w++)E=E*S/w;return E}(n,e))+e*Math.log(.5)+(n-e)*Math.log(1-.5)-Math.log(i)+i*e,oA.set(s,c)),c<e_&&(c=e_),c}function tz(e,n,i){const s=n.length,c=e.length/s;let u=!1;for(let h=0,p=0;h<s;h++){let _=0;for(let E=p+c;p<E;p++)e[p]>i&&_++;n[h]!==_&&(n[h]=_,u=!0)}return u}window.cache=oA;let ihe=0;class nz{constructor(n){Te(this,"id",void 0),Te(this,"immediates",[]),Te(this,"lastNonSilence",-1),Te(this,"immediateSpeechActivityScore",e_),Te(this,"lastLevelChangedTime",Date.now()),Te(this,"levels",[]),Te(this,"longs",[]),Te(this,"longSpeechActivityScore",e_),Te(this,"mediums",[]),Te(this,"mediumSpeechActivityScore",e_),Te(this,"minLevel",0),Te(this,"nextMinLevel",0),Te(this,"nextMinLevelWindowLength",0),Te(this,"energyScore",0),this.id=n||"".concat(ihe++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){const n=this.immediates,i=this.levels,s=this.minLevel+SL;let c=!1;for(let u=0;u<n.length;++u){let h=i[u];h<s&&(h=0);const p=Math.floor(h/SL);n[u]!==p&&(n[u]=p,c=!0)}return c}computeLongs(){return tz(this.mediums,this.longs,4)}computeMediums(){return tz(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=TL(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(n){this.longSpeechActivityScore=TL(this.longs[0],10,47),this.longSpeechActivityScore>e_&&(this.lastNonSilence=n)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=TL(this.mediums[0],5,24)}evaluateSpeechActivityScores(n){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(n)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var n;return"[".concat(pp(n=[...this.levels]).call(n).join(),"]")}getSpeechActivityScore(n){switch(n){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+n)}}levelChanged(n,i){if(this.lastLevelChangedTime<=i){this.lastLevelChangedTime=i;let s=n;return n<0&&(s=0),n>iA&&(s=iA),this.levels.unshift(s),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(s),s>=this.minLevel+SL?s:s/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(n){if(n!==0){if(this.minLevel===0||this.minLevel>n)return this.minLevel=n,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(this.nextMinLevel===0)return this.nextMinLevel=n,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>n&&(this.nextMinLevel=n),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let i=Math.sqrt(this.minLevel*this.nextMinLevel);i<0?i=0:i>iA&&(i=iA),this.minLevel=i,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class ohe{constructor(n){Te(this,"algorithm",void 0),this.algorithm=n}execute(){let n=!this.algorithm;if(!n)try{const i=this.algorithm.runInDecisionMaker(this);i<=0?n=!0:setTimeout(this.execute.bind(this),i)}catch{n=!0}n&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class bL{constructor(n,i,s){Te(this,"isDominant",void 0),Te(this,"energyRanking",void 0),Te(this,"energyScore",void 0),this.isDominant=n,this.energyRanking=i,this.energyScore=s}}class she extends Rr{constructor(n){super(),Te(this,"dominantId",null),Te(this,"lastDecisionTime",0),Te(this,"lastLevelChangedTime",0),Te(this,"lastLevelIdleTime",0),Te(this,"relativeSpeechActivities",[]),Te(this,"speakers",new Map),Te(this,"enableSilence",!1),Te(this,"timeoutToSilenceInterval",0),Te(this,"decisionMaker",null),Te(this,"loudest",[]),Te(this,"numLoudestToTrack",3),Te(this,"energyExpireTimeMs",250),Te(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=n,this.enableSilence=n>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3,i=arguments.length>1?arguments[1]:void 0,s=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=n,i!=null&&(this.energyExpireTimeMs=i),s!=null&&(this.energyAlphaPct=s),this.loudest.length>n&&this.loudest.splice(n)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(n){return this.loudest.some(i=>i.id===n)}levelChanged(n,i){const s=Date.now(),c=this.getOrCreateSpeaker(n);this.lastLevelChangedTime<s&&(this.lastLevelChangedTime=s,this.maybeStartDecisionMaker());const u=c.levelChanged(i,s);return this.updateLoudestList(c,u,s)}runInDecisionMaker(n){return this.decisionMaker!==n||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(n){this.decisionMaker===n&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(n){n.forEach(i=>{this.speakers.has(i.id)||this.speakers.set(i.id,i)})}removeSpeakers(n){n.forEach(i=>{this.speakers.delete(i.id)})}getOrCreateSpeaker(n){let i=this.speakers.get(n);return i||(i=new nz(n),this.speakers.set(n,i),this.maybeStartDecisionMaker()),i}updateLoudestList(n,i,s){const c=n.id===this.dominantId;if(i<0){let _=0;for(;_<this.loudest.length&&this.loudest[_]!==n;)++_;return new bL(c,_,n.energyScore)}if(n.energyScore=Math.floor((this.energyAlphaPct*i+(100-this.energyAlphaPct)*n.energyScore+50)/100),this.numLoudestToTrack===0)return new bL(c,0,n.energyScore);const u=s-this.energyExpireTimeMs;let h=0;for(;h<this.loudest.length;){const _=this.loudest[h];if(_.getLastLevelChangedTime()<u&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(h,1);else if(_.id!==n.id)++h;else if(this.loudest.splice(h,1),this.loudest.length<this.numLoudestToTrack)break}let p=0;for(;p<this.loudest.length&&!(this.loudest[p].energyScore<n.energyScore);)++p;return p<this.numLoudestToTrack&&(this.loudest.splice(p,0,n),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new bL(c,p,n.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new ohe(this),this.decisionMaker.execute())}makeDecision(n){let i=null,s=null;const c=this.speakers.size;let u=null;if(c===0)u=null;else if(c===1){var h;const p=fc(h=this.speakers).call(h).next().value;this.enableSilence&&p&&(u=p.id,p.evaluateSpeechActivityScores(n),n-p.lastNonSilence>this.timeoutToSilenceInterval&&(u=null))}else{let p=this.dominantId==null?null:this.speakers.get(this.dominantId);if(p==null){const S=this.speakers.entries().next();S.value&&(u=S.value[0],p=S.value[1])}else u=p.id;p!=null&&p.evaluateSpeechActivityScores(n);const _=this.relativeSpeechActivities;let E=2;for(const S of this.speakers.entries()){const[w,I]=S;if(I===p)continue;I.evaluateSpeechActivityScores(n);for(let U=0;U<_.length;++U){const $=p==null?e_:p.getSpeechActivityScore(U);_[U]=Math.log(I.getSpeechActivityScore(U)/$)}const P=_[0],B=_[1],M=_[2];P>3&&B>2&&M>0&&B>E&&(E=B,u=w)}this.enableSilence&&p!=null&&u===p.id&&n-p.lastNonSilence>this.timeoutToSilenceInterval&&(u=null)}u==null&&!this.enableSilence||u===this.dominantId||(i=this.dominantId,this.dominantId=u,s=this.dominantId),s==null&&!this.enableSilence||s===i||this.emit("ActiveSpeakerChanged",s)}_runInDecisionMaker(){const n=Date.now(),i=300-(n-this.lastLevelIdleTime);let s=0;i<=0?(this.lastLevelIdleTime!==0&&this.timeoutIdleLevels(n),this.lastLevelIdleTime=n):s=i;let c=300-(n-this.lastDecisionTime);return c<=0&&(this.lastDecisionTime=n,this.makeDecision(n),c=300-(Date.now()-n)),c>0&&s>c&&(s=c),s}timeoutIdleLevels(n){const i=[];for(const c of fc(s=this.speakers).call(s)){var s;const u=n-c.getLastLevelChangedTime();36e5<u&&(this.dominantId==null||c.id!==this.dominantId)?i.push(c.id):300<u&&c.levelTimedOut()}i.forEach(c=>this.speakers.delete(c))}}const $E=new Map;let Gu=null,sA=null;const rz=3;let t_=[];const zu=new Map,aA=new Map;class ahe{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(n,i){Te(this,"id",void 0),Te(this,"track",void 0),Te(this,"score",0),Te(this,"active",!0),Te(this,"muted",!1),Te(this,"timer",0),Te(this,"actives",0),Te(this,"inactives",0),this.id=n,this.track=i,this.setActive(zu.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){const n=this.active;this.active=this.activeRate>=.8;const{actives:i,inactives:s}=function(){const c=[],u=[];return Array.from(fc(zu).call(zu)).forEach(h=>{h.active?c.push(h):u.push(h)}),{actives:c,inactives:u}}();if(i.length>3){let c;i.forEach(u=>{(!c||c.score>u.score)&&(c=u)}),c&&c.setActive(!1)}if(i.length<3&&s.length>0){let c;s.forEach(u=>{(!c||c.score<u.score)&&u.id!==this.id&&(c=u)}),c&&n&&!this.active&&(c.samples>40&&c.activeRate-this.activeRate>.4?c.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(n){this.active=n,this.resetTimer(),this.setMuted(!n)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){const n=function(i){let s;return Array.from(fc(zu).call(zu)).forEach(c=>{!c.active||c.id===i||c.samples<40||(!s||c.score<s.score)&&(s=c)}),s}(this.id);n&&this.activeRate-n.activeRate>.4&&(n.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){const n=function(i){let s;return Array.from(fc(zu).call(zu)).forEach(c=>{c.active||c.id===i||c.samples<40||(!s||c.score>s.score)&&(s=c)}),s}(this.id);n&&n.activeRate-this.activeRate>.4&&(n.setActive(!0),this.setActive(!1))}addSample(n){n?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()}setMuted(n){this.track&&(this.track.enabled=!n,this.muted=n)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout(()=>{if(this.samples!==0)return this.samples<50?this.resetTimer():void this.autoCheckActive()},1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let cA;function iz(e){const n=zu.get(e);n&&(zu.delete(e),n.clearTimer())}const lA=new Map,che=new Map;function lhe(e,n,i){let s=new Uint8Array(e,n,i),c=[],u=0;for(;c.length<i;)u+3<i&&s[u]===0&&s[u+1]===0&&s[u+2]===3&&(s[u+3]===0||s[u+3]===1||s[u+3]===2||s[u+3]===3)?(c.push(s[u],s[u+1],s[u+3]),u+=4):(c.push(s[u]),u++);return new Uint8Array(c)}const uA=new Map,v0=new Map;(function(){const e=vn();Qi.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),Qi.getStreamFromExtension=e.name===Nn.CHROME&&Number(e.version)>34,Qi.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const n=new RTCPeerConnection;let i=!1;try{n.addTransceiver("audio"),i=!0}catch{}return n.close(),i}(),Qi.supportMinBitrate=e.name===Nn.CHROME||e.name===Nn.EDGE,Qi.supportSetRtpSenderParameters=function(){const n=vn();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!df()||!(!lo()&&!FI())||n.name===Nn.FIREFOX&&Number(n.version)>=64)}(),e.name===Nn.SAFARI&&(Number(e.version)>=14?Qi.supportDualStream=!0:Qi.supportDualStream=!1),Qi.webAudioMediaStreamDest=function(){const n=vn();return!(n.name===Nn.SAFARI&&Number(n.version)<12)}(),Qi.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",Qi.supportWebGL=typeof WebGLRenderingContext<"u",Qi.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,df()||(Qi.webAudioWithAEC=!0),Qi.supportShareAudio=function(){const n=vn();return(n.os===Pi.WIN_10||n.os===Pi.WIN_81||n.os===Pi.WIN_7||n.os===Pi.LINUX||n.os===Pi.MAC_OS||n.os===Pi.CHROMIUM_OS)&&n.name===Nn.CHROME&&Number(n.version)>=74}(),Qi.supportDataChannel=!!(a0(76)||function(n){const i=vn();return!(i.name!==Nn.FIREFOX||!i.osVersion)&&Number(i.version)>=n}(68)||l6(14)),Qi.supportPCSetConfiguration=function(){const n=window.RTCPeerConnection;return!Nr()&&!!n&&n.prototype.setConfiguration instanceof Function}(),Qi.supportWebRTCEncodedTransform=function(){const n=vn();return n.name==="Chrome"&&Number(n.version)>=87||n.name==="Safari"&&Number(n.version)>=15}(),Qi.supportWebRTCInsertableStream=function(){const n=vn();return(n.name===Nn.CHROME||n.name===Nn.EDGE)&&Number(n.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),Qi.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,Qi.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,WI(()=>{Qi.supportDualStreamEncoding=function(){const n=vn();return!!Z("DISABLE_WEBAUDIO")||n.name==="Safari"&&Number(n.version)>=14||!!(n.name==="Chrome"&&/Windows/i.test(n.os||"")&&Number(n.version)>=100&&Z("CHROME_DUAL_STREAM_USE_ENCODING"))}(),k.debug("browser ua: ",navigator.userAgent),k.info("browser info: ",e),k.info("browser compatibility: ",Qi)})})();const uhe=["CHINA","GLOBAL"],oz=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],n_=[],qE=[];function r_(e,n){return!!n&&n_.some(i=>i.uid===e&&i.channelName===n)}function wL(){return qE.length>0}var dhe=I3.forEach,sz=jh("forEach")?[].forEach:function(e){return dhe(this,e,arguments.length>1?arguments[1]:void 0)};Pn({target:"Array",proto:!0,forced:[].forEach!=sz},{forEach:sz});var hhe=Na("Array").forEach,fhe=rc,phe=ui,mhe=N,ghe=hhe,RL=Array.prototype,_he={DOMTokenList:!0,NodeList:!0},vhe=function(e){var n=e.forEach;return e===RL||mhe(RL,e)&&n===RL.forEach||phe(_he,fhe(e))?ghe:n},Ehe=l(vhe),yhe=Es,az=sc;Pn({target:"Object",stat:!0,forced:d(function(){az(1)})},{keys:function(e){return az(yhe(e))}});var cz=l(gt.Object.keys),She=l(vv),The=l(yv),bhe=Pn,lz=Zm,whe=bg,Rhe=mt,uz=he,Che=ti,Ihe=we,Ahe=zC,Ohe=sr,Phe=Ai,Nhe=_3("slice"),khe=Ohe("species"),CL=Array,Dhe=Math.max;bhe({target:"Array",proto:!0,forced:!Nhe},{slice:function(e,n){var i,s,c,u=Ihe(this),h=Che(u),p=uz(e,h),_=uz(n===void 0?h:n,h);if(lz(u)&&(i=u.constructor,(whe(i)&&(i===CL||lz(i.prototype))||Rhe(i)&&(i=i[khe])===null)&&(i=void 0),i===CL||i===void 0))return Phe(u,p,_);for(s=new(i===void 0?CL:i)(Dhe(_-p,0)),c=0;p<_;p++,c++)p in u&&Ahe(s,c,u[p]);return s.length=c,s}});var Lhe=Na("Array").slice,xhe=N,Mhe=Lhe,IL=Array.prototype,Uhe=function(e){var n=e.slice;return e===IL||xhe(IL,e)&&n===IL.slice?Mhe:n},Vhe=l(Uhe);function ut(e,n,i,s,c){var u,h,p,_={};return Ehe(u=cz(s)).call(u,function(E){_[E]=s[E]}),_.enumerable=!!_.enumerable,_.configurable=!!_.configurable,("value"in _||_.initializer)&&(_.writable=!0),_=She(h=The(p=Vhe(i).call(i)).call(p)).call(h,function(E,S){return S(e,n,E)||E},_),c&&_.initializer!==void 0&&(_.value=_.initializer?_.initializer.call(c):void 0,_.initializer=void 0),_.initializer===void 0&&(f3(e,n,_),_=null),_}let dA=function(e){return e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",e}({}),AL=function(e){return e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR",e}({}),jl=function(e){return e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",e}({}),us=function(e){return e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",e[e.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",e}({}),It=function(e){return e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",e[e.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",e[e.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",e[e.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",e[e.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",e[e.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",e[e.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",e[e.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",e[e.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",e}({}),ir=function(e){return e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed",e}({}),xt=function(e){return e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.ABORT_P2P_EXECUTION="abort_p2p_execution",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success",e.JOIN_RESPONSE="join_response",e.PRE_CONNECT_PC="pre_connect_pc",e.P2P_CONNECTION="p2p_connection",e.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",e.P2P_SUBSCRIBE="p2p_subscribe",e.P2P_UNSUBSCRIBE="p2p_unsubscribe",e.P2P_EXCHANGE_SDP="p2p_exchange_sdp",e.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",e.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",e.RECOVER_NOTIFICATION="recover_notification",e}({}),kt=function(e){return e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v3",e.REJOIN="rejoin_v3",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.PUBLISH_DATASTREAM="publish_datastream",e.UNPUBLISH="unpublish",e.UNPUBLISH_DATASTREAM="unpublish_datastream",e.SUBSCRIBE="subscribe",e.PRE_SUBSCRIBE="pre_subscribe",e.SUBSCRIBE_DATASTREAM="subscribe_datastream",e.SUBSCRIBE_STREAMS="subscribe_streams",e.UNSUBSCRIBE="unsubscribe",e.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",e.UNSUBSCRIBE_STREAMS="unsubscribe_streams",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.DEFAULT_VIDEO_STREAM="default_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer",e.RESTART_ICE="restart_ice",e.CONNECT_PC="connect_pc",e.SET_VIDEO_PROFILE="set_video_profile",e.SET_PARAMETER="set_parameter",e.SET_RTM2_FLAG="set_rtm2_flag",e}({}),E0=function(e){return e.WRTC_STATS="wrtc_stats",e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",e.DENOISER_STATS="denoiser_stats",e.EXTENSION_USAGE_STATS="extension_usage_stats",e}({}),an=function(e){return e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_USER_LICENSE_BANNED="on_user_license_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.ON_P2P_OK="on_p2p_ok",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",e.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",e.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio",e.ON_PUBLISHED_USER_LIST="on_published_user_list",e}({}),ds=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({}),Gt=function(e){return e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls",e.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",e}({});function hA(e){if(typeof e!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e))throw k.error("Invalid Channel Name ".concat(e)),new be(Y.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function fA(e){if(n=e,!(typeof n=="number"&&Math.floor(n)===n&&0<=n&&n<=4294967295||_6(e,1,255)))throw new be(Y.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var n;typeof e=="string"&&k.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let gf=function(e){return e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e}({});const Fhe={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},OL={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function PL(e,n){Xi(e.url,"".concat(n,".url"),1,1e3,!1),kr(e.x)||Yn(e.x,"".concat(n,".x"),0,1e4),kr(e.y)||Yn(e.y,"".concat(n,".y"),0,1e4),kr(e.width)||Yn(e.width,"".concat(n,".width"),0,1e4),kr(e.height)||Yn(e.height,"".concat(n,".height"),0,1e4),kr(e.zOrder)||Yn(e.zOrder,"".concat(n,".zOrder"),0,255),kr(e.alpha)||Yn(e.alpha,"".concat(n,".alpha"),0,1,!1)}const jhe={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let zp=function(e){return e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address",e}({}),NL=function(e){return e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",e}({}),Si=function(e){return e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",e}({});function dz(e){if(!e.channelName)throw new be(Y.INVALID_PARAMS,"invalid channelName in info");if(typeof e.uid!="number")throw new be(Y.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&Xi(e.token,"info.token",1,2047),fA(e.uid),hA(e.channelName),!0}let hs=function(e){return e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile",e}({}),_f=function(e){return e.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",e.NETWORK_CONNECTED="NETWORK_CONNECTED",e.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",e.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",e.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",e.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",e.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",e.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",e.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",e}({}),ua=function(e){return e.RELAY_STATE_IDLE="RELAY_STATE_IDLE",e.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",e.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",e.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",e}({}),YE=function(e){return e.RELAY_OK="RELAY_OK",e.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",e.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",e.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",e}({}),Bn=function(e){return e.High="high",e.Low="low",e.Audio="audio",e.Screen="screen",e.ScreenLow="screen_low",e}({}),ji=function(e){return e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid",e.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",e.JOIN_RESPONSE="join-response",e.RESET_CONNECTION_EVENTS="reset-connection-events",e.PRE_CONNECT_PC="pre-connect_pc",e.UPDATE_GATEWAY_CONFIG="update-gateway-config",e}({}),pA=function(e){return e.P2P_DISCONNECTED="P2P_DISCONNECTED",e.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",e.TIMEOUT="TIMEOUT",e.UNKNOWN_REASON="UNKNOWN_REASON",e}({}),ki=function(e){return e[e.Nothing=0]="Nothing",e[e.Audio=1]="Audio",e[e.LwoVideo=2]="LwoVideo",e[e.Video=4]="Video",e[e.Data=8]="Data",e[e.DataStream0=256]="DataStream0",e[e.DataStream1=512]="DataStream1",e[e.DataStream2=1024]="DataStream2",e[e.DataStream3=2048]="DataStream3",e[e.DataStream4=4096]="DataStream4",e[e.DataStream5=8192]="DataStream5",e[e.DataStream6=16384]="DataStream6",e[e.DataStream7=32768]="DataStream7",e}({}),kn=function(e){return e.CHINA="CHINA",e.ASIA="ASIA",e.NORTH_AMERICA="NORTH_AMERICA",e.EUROPE="EUROPE",e.JAPAN="JAPAN",e.INDIA="INDIA",e.KOREA="KOREA",e.HKMC="HKMC",e.US="US",e.OCEANIA="OCEANIA",e.SOUTH_AMERICA="SOUTH_AMERICA",e.AFRICA="AFRICA",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="EXTENSIONS",e}({});const hz=[kn.AFRICA,kn.ASIA,kn.CHINA,kn.EUROPE,kn.GLOBAL,kn.INDIA,kn.JAPAN,kn.NORTH_AMERICA,kn.OCEANIA,kn.OVERSEA,kn.SOUTH_AMERICA];let bo=function(e){return e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.KOREA="KR",e.HKMC="HK",e.US="US",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="GLOBAL",e}({});const mA={CHINA:{},ASIA:{CODE:bo.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:bo.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:bo.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:bo.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:bo.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:bo.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:bo.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:bo.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:bo.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:bo.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:bo.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:bo.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:bo.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};Q1&&(mA.CHINA={CODE:bo.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let y0=function(e){return e.UPDATE_BITRATE_LIMIT="update_bitrate_limit",e.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",e}({});function fz(e){return!!e&&!(!e.uplink||!e.id)&&e.uplink.max_bitrate!==void 0&&e.uplink.min_bitrate!==void 0}class pz extends Rr{constructor(n,i){super(),K(this,"onICEConnectionStateChange",void 0),K(this,"onConnectionStateChange",void 0),K(this,"onDTLSTransportStateChange",void 0),K(this,"onDTLSTransportError",void 0),K(this,"onICETransportStateChange",void 0),K(this,"onFirstAudioReceived",void 0),K(this,"onFirstVideoReceived",void 0),K(this,"onFirstAudioDecoded",void 0),K(this,"onFirstVideoDecoded",void 0),K(this,"onFirstVideoDecodedTimeout",void 0),K(this,"onSelectedLocalCandidateChanged",void 0),K(this,"onSelectedRemoteCandidateChanged",void 0),K(this,"onICECandidateError",void 0),K(this,"getLocalVideoStats",void 0)}}class mz extends pz{constructor(n,i){super(n,i),K(this,"establishPromise",void 0)}}let ot=function(e){return e.VIDEO="video",e.AUDIO="audio",e}({}),wo=function(e){return e.UDP_RELAY="udp_relay",e.UDP_TCP_RELAY="udp_tcp_relay",e.TCP_RELAY="tcp_relay",e.RELAY="relay",e}({}),vf=function(e){return e[e.FIRST_CONNECTION=0]="FIRST_CONNECTION",e[e.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",e[e.RELAY_RESTART=2]="RELAY_RESTART",e[e.TCP_RESTART=3]="TCP_RESTART",e[e.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",e[e.OLD_RESTART=11]="OLD_RESTART",e[e.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",e}({});const gz=["disconnected","failed"];let xe=function(e){return e.LocalVideoTrack="videoTrack",e.LocalAudioTrack="audioTrack",e.LocalVideoLowTrack="videoLowTrack",e}({}),Un=function(e){return e.New="new",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnected="disconnected",e}({}),Rt=function(e){return e.AudioMetadata="audioMetadata",e.StateChange="stateChange",e.IceConnectionStateChange="iceConnectionStateChange",e.RequestMuteLocal="requestMuteLocal",e.RequestUnmuteLocal="requestUnmuteLocal",e.RequestRePublish="requestRePublish",e.RequestRePublishDataChannel="requestRePublishDataChannel",e.RequestReSubscribe="requestReSubscribe",e.RequestUploadStats="requestUploadStats",e.RequestUpload="requestUpload",e.MediaReconnectStart="MediaReconnectStart",e.MediaReconnectEnd="MediaReconnectEnd",e.NeedSignalRTT="NeedSignalRTT",e.RequestRestartICE="RequestRestartIce",e.PeerConnectionStateChange="PeerConnectionStateChange",e.RequestReconnect="RequestReconnect",e.RequestReconnectPC="RequestReconnectPC",e.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",e.P2PLost="P2PLost",e.UpdateVideoEncoder="UpdateVideoEncoder",e.ConnectionTypeChange="ConnectionTypeChange",e.RequestLowStreamParameter="RequestLowStreamParameter",e.QueryClientConnectionState="QueryClientConnectionState",e.LocalCandidate="LocalCandidate",e.RequestP2PMuteLocal="requestP2PMuteLocal",e.RequestP2PUnPublish="RequestP2PUnPublish",e.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",e.RequestP2PMuteRemote="RequestP2PMuteRemote",e.RequestP2PRestartICE="RequestP2PRestartICE",e}({}),Bl=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),Wl=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),Bi=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),_z=function(e){return e.CONNECTED="transmitter:connected",e.RECONNECTING="transmitter:reconnecting",e.WILL_RECONNECT="transmitter:will_reconnect",e.CLOSED="transmitter:closed",e.FAILED="transmitter:failed",e.ON_MESSAGE="transmitter:on_message",e.REQUEST_NEW_URLS="transmitter:request_new_urls",e.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",e.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",e.FAILBACK="transmitter:failback",e.PRE_CONNECT_PC="transmitter:pre_connect_pc",e}({}),Wd=function(e){return e.CAMERA_CHANGED="camera-changed",e.MICROPHONE_CHANGED="microphone-changed",e.PLAYBACK_DEVICE_CHANGED="playback-device-changed",e.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",e.AUTOPLAY_FAILED="autoplay-failed",e.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",e.SECURITY_POLICY_VIOLATION="security-policy-violation",e}({}),rl=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),Hu=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),XE=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),Jr=function(e){return e.CALL="call",e.CANDIDATE="candidate",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.CONTROL="control",e.RESTART_ICE="restart_ice",e.ACK="ack",e.RESPONSE="response",e.JOIN="join",e.CHECK="check",e}({}),JE=function(e){return e.ABORT="abort",e}({}),Hp=function(e){return e.MUTE_LOCAL_AUDIO="mute_local_audio",e.MUTE_LOCAL_VIDEO="mute_local_video",e.UNMUTE_LOCAL_AUDIO="unmute_local_audio",e.UNMUTE_LOCAL_VIDEO="unmute_local_video",e}({}),Bhe=function(e){return e.P2P_TOKEN_TIMEOUT="p2p_token_timeout",e.P2P_TOKEN_CHANGED="p2p_token_changed",e}({});const Whe={[dA.ACCESS_POINT]:{[us.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[us.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[us.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[us.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[us.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[us.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[us.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[us.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[us.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[us.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[us.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[us.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[us.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[us.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[us.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[us.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[us.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[us.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[dA.UNILBS]:{[jl.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[jl.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[jl.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[jl.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[jl.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[jl.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[jl.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[jl.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[jl.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[jl.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[jl.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[jl.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[dA.STRING_UID_ALLOCATOR]:{[AL.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[AL.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[AL.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function QE(e){const n=Whe[Math.floor(e/1e4)];if(!n)return{desc:"unknown error",retry:!1};const i=n[e%1e4];if(!i){if(Math.floor(e/1e4)===dA.ACCESS_POINT){const s=e%1e4;if(s.toString()[0]==="1")return{desc:e.toString(),retry:!1};if(s.toString()[0]==="2")return{desc:e.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return i}const Ghe={[It.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[It.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[It.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[It.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[It.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[It.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[It.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[It.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[It.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[It.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[It.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[It.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[It.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[It.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[It.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[It.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[It.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[It.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[It.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[It.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[It.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[It.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[It.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[It.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[It.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[It.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[It.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[It.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[It.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[It.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[It.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[It.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[It.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[It.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[It.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[It.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[It.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[It.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[It.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[It.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[It.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[It.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[It.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[It.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[It.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[It.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[It.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[It.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[It.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[It.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[It.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[It.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[It.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[It.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[It.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[It.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[It.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[It.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[It.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[It.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[It.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[It.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[It.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[It.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function S0(e){return Ghe[e]||{desc:"UNKNOWN_ERROR_".concat(e),action:"failed"}}function vz(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,s)}return i}function kL(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?vz(Object(i),!0).forEach(function(s){K(e,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):vz(Object(i)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(i,s))})}return e}function Ez(e,n){if(typeof e=="string")return e;const{proxy:i,host:s,port:c}=e;if(n){const u=Z("JOIN_GATEWAY_FALLBACK_PORT")||443;return u===443?"wss://".concat(s,"/ws/?p=").concat(Number(c)+150):"wss://".concat(s,":").concat(u,"/ws/?p=").concat(Number(c)+150)}return i?"wss://".concat(i,"/ws/?h=").concat(s,"&p=").concat(c):"wss://".concat(s,":").concat(c)}const zhe=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,Hhe=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,Khe=/wss:\/\/(.+):([0-9]+)\/?/,$he=/wss:\/\/(.[^\/]+)\/?/;let qhe=0;class Yhe{constructor(n,i){K(this,"id",0),K(this,"store",void 0),K(this,"recordIndex",void 0),K(this,"websockets",[]),K(this,"try443PortDuration",2e3),K(this,"forceCloseWSDuration",5e3),K(this,"try443PortTimeout",null),K(this,"forceCloseTimeout",null),K(this,"isTry443PortFailed",!1),K(this,"isNormalPortFailed",!1),K(this,"useDoubleDomain",!1),K(this,"useProxy",!1),K(this,"startTime",Date.now()),this.id=++qhe,this.try443PortDuration=Z("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=n||5e3,this.store=i}closeAllWebsockets(){this.websockets.forEach(n=>{n.onopen=null,n.onclose=null,n.onmessage=null,n.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var n;const i=Date.now()-this.startTime;for(var s=arguments.length,c=new Array(s),u=0;u<s;u++)c[u]=arguments[u];k.debug("[choose-best-ws ".concat((n=this.store)===null||n===void 0?void 0:n.clientId," ").concat(this.id,"] ").concat(i,"ms:"),...c)}createWebSocket(n,i,s){this.logger("createWebSocket:",n,{isTry443Port:i,hasTimeoutDetection:s});const c=Z("GATEWAY_DOMAINS"),u=Date.now(),h=[],p=c.find(I=>{var P;return $e(P=n.host).call(P,I)});p||(this.useDoubleDomain=!1);const _=[];if(this.useDoubleDomain)c.forEach(I=>{_.push(Ez(kL(kL({},n),{},{host:n.host.replace(p,I)}),i))});else{const I=kL({},n);if(i&&p){const P=c.find(B=>B!==p);P&&(I.host=I.host.replace(p,P))}_.push(Ez(I,i))}try{_.forEach(I=>{const P=new WebSocket(I);P.binaryType="arraybuffer",h.push(P),this.logger("ws is connecting:",P.url)})}catch(I){if(this.logger("ws create failed"),h.forEach(P=>P.close()),h.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(n,i,s);if(!i&&Number(n.port)!==443)return this.createWebSocket(n,!0,s);throw new be(Y.WS_ERR,"init websocket failed! Error: ".concat(I.toString()))}const E=s0();this.store&&this.store.recordJoinChannelService({urls:h.map(I=>I.url),service:"gateway"},this.recordIndex),h.forEach(I=>{I.onopen=()=>{this.logger("onopen: ws ".concat(I.url," open cost ").concat(Date.now()-u,"ms")),this.websockets.forEach(P=>{P!==I&&(P.onopen=null,P.onclose=null,P.onmessage=null,P.close(),this.logger("close backup websocket: ".concat(P.url)))}),this.websockets.length=0,E.resolve(I)},I.onclose=P=>{this.logger("onclose: ws ".concat(I.url," closed cost ").concat(Date.now()-u,"ms state: ").concat(I.readyState));const B=h.every(M=>M.readyState===WebSocket.CLOSED||M.readyState===WebSocket.CLOSING);this.logger("".concat(i?"443":"47xx"," websocket closed, all failed: ").concat(B)),B&&(i||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(P.reason)),E.reject({code:P.code,reason:pA.A_ROUND_WS_FAILED})):!i&&B&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),w()),i?this.isTry443PortFailed=B:this.isNormalPortFailed=B},I.onmessage=P=>this.logger("".concat(I.url," onmessage: ").concat(P.data))}),this.websockets.push(...h);const S=()=>{this.websockets.forEach(I=>I.readyState!==WebSocket.OPEN&&I.close())},w=()=>{if(E.isResolved)return S();vn().os===Pi.MAC_OS&&Nr()&&S(),this.createWebSocket(n,!0,!0).then(I=>{E.resolve(I)}).catch(I=>{this.isNormalPortFailed&&E.reject(I),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",E.isResolved),this.forceCloseTimeout=null,S()},this.forceCloseWSDuration)};return s||(()=>{if(i||this.useProxy)return this.logger("add 5s timeout at ".concat(i?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(()=>{this.forceCloseTimeout=null,S()},this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{this.logger("2s timeout, isWebsocket created: ",E.isResolved),this.try443PortTimeout=null,w()},this.try443PortDuration)})(),E.promise}chooseBestWebsocket(n,i,s,c){return this.useDoubleDomain=!!i,typeof n=="string"&&(n=function(u){let h,p,_;return[,h,p,_]=u.match(zhe)||[],h||([,p,_]=u.match(Hhe)||[]),p&&_||([,p,_]=u.match(Khe)||[]),p&&_||([,p]=u.match($he)||[]),p||k.warning("un-destructible url: ",u),{proxy:h,host:p,port:_||"443"}}(n)),this.recordIndex=c,this.useProxy=!!n.proxy,s&&this.useProxy&&(k.warn("cannot use 443 only when use proxy"),s=!1),this.createWebSocket(n,!!s,!1).finally(()=>this.clearTimeout())}}function yz(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,s)}return i}class Sz extends Rr{get url(){return this.websocket&&this.websocket.url||null}get reconnectMode(){return this._reconnectMode}set reconnectMode(n){var i;$e(i=["tryNext","recover"]).call(i,n)&&this.resetReconnectCount(n),this._reconnectMode=n}get state(){return this._state}set state(n){n!==this._state&&(this._state=n,this._state==="reconnecting"?this.emit(Gt.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(Gt.CONNECTED):this._state==="closed"?this.emit(Gt.CLOSED):this._state==="failed"&&this.emit(Gt.FAILED))}resetReconnectCount(n){k.debug("websocket reset reconnect count, reason: "+n),this.reconnectCount=0}constructor(n,i){let s=arguments.length>2&&arguments[2]!==void 0&&arguments[2],c=arguments.length>3&&arguments[3]!==void 0&&arguments[3],u=arguments.length>4&&arguments[4]!==void 0&&arguments[4],h=arguments.length>5?arguments[5]:void 0;super(),K(this,"connectionID",0),K(this,"currentURLIndex",0),K(this,"urls",[]),K(this,"_reconnectMode","tryNext"),K(this,"reconnectReason",void 0),K(this,"_initMutex",void 0),K(this,"name",void 0),K(this,"_state","closed"),K(this,"reconnectInterrupter",void 0),K(this,"websocket",void 0),K(this,"retryConfig",void 0),K(this,"reconnectCount",0),K(this,"forceCloseTimeout",5e3),K(this,"onlineReconnectListener",void 0),K(this,"useCompress",void 0),K(this,"tryDoubleDomain",!1),K(this,"use443PortOnly",!1),K(this,"wsInflateLength",0),K(this,"wsDeflateLength",0),K(this,"closeEstablishingWs",()=>{}),K(this,"store",void 0),K(this,"joinGatewayRecordIndex",void 0),this.store=h,this.name=n,this.retryConfig=function(w){for(var I=1;I<arguments.length;I++){var P=arguments[I]!=null?arguments[I]:{};I%2?yz(Object(P),!0).forEach(function(B){K(w,B,P[B])}):Object.getOwnPropertyDescriptors?Object.defineProperties(w,Object.getOwnPropertyDescriptors(P)):yz(Object(P)).forEach(function(B){Object.defineProperty(w,B,Object.getOwnPropertyDescriptor(P,B))})}return w}({},i),this.useCompress=s,this.tryDoubleDomain=c,this.use443PortOnly=u,this._initMutex=new To("websocket",h?h.clientId:void 0);const{timeout:p,timeoutFactor:_}=i,E=Math.max(300,Math.floor(3*p/5)),S=Math.max(1.2,Math.floor(8*_)/10);ja.ONLINE&&(this.retryConfig.timeout=E,this.retryConfig.timeoutFactor=S),ri.on(NE.NETWORK_STATE_CHANGE,(w,I)=>{w!==I&&(this.resetReconnectCount("network state change: ".concat(I," -> ").concat(w)),w===ja.ONLINE?(this.retryConfig.timeout=E,this.retryConfig.timeoutFactor=S):(this.retryConfig.timeout=p,this.retryConfig.timeoutFactor=_))})}getConnection(){return this.websocket||void 0}async init(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const s=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=i,this.urls=n,this.state="connecting";try{const c=s0(),u=this.urls[this.currentURLIndex];Z("ENABLE_PREALLOC_PC")&&this.emit(_z.PRE_CONNECT_PC),this.createWebSocketConnection(u).then(c.resolve).catch(c.reject),this.once(Gt.CLOSED,()=>{c.reject(new Ie(Y.WS_DISCONNECT))}),this.once(Gt.CONNECTED,c.resolve),await c.promise}catch{}finally{s()}}close(n,i){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const s=this.websocket;i?setTimeout(()=>s.close(),500):s.close(),this.websocket=void 0}this.state=n?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(n,i){if(!this.websocket)return void k.warning("[".concat(this.name,"] can not reconnect, no websocket"));n!==void 0&&(this.reconnectMode=n),k.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(i)]},this.joinGatewayRecordIndex);const s=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),s&&s.bind(this.websocket)({code:9999,reason:i})}sendMessage(n){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new Ie(Y.WS_ABORT,"websocket is not ready");try{i||(n=JSON.stringify(n)),this.websocket.send(n)}catch(s){throw new Ie(Y.WS_ERR,"send websocket message error"+s.toString())}}setWsInflateData(n){this.wsDeflateLength=this.wsDeflateLength+n.originLength,this.wsInflateLength=this.wsInflateLength+n.compressedLength}getWsInflateData(){const n=this.wsInflateLength,i=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:n,wsDeflateLength:i}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(n){var i;const s=s0();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const c=S=>{var w;(w=this.store)===null||w===void 0||w.signalChannelOpen(),k.debug("[".concat(this.name,"] websocket opened:"),S),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),s.resolve()},u=async S=>{var w;if(k.debug("[".concat(this.name,"] websocket close ").concat((w=this.websocket)===null||w===void 0?void 0:w.url,", code: ").concat(S.code,", reason: ").concat(S.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)s.reject(new Ie(Y.WS_DISCONNECT,"websocket close: ".concat(S.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=S.reason,this.state="reconnecting");const I=mc(this,Gt.WILL_RECONNECT,this.reconnectMode,S.reason)||this.reconnectMode,P=await this.reconnectWithAction(I);if(this.state==="closed")return void k.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!P)return s.reject(new Ie(Y.WS_DISCONNECT,"websocket reconnect failed: ".concat(S.code))),this.close(!0);s.resolve()}},h=S=>{this.emit(Gt.ON_MESSAGE,S)},p=S=>{k.warn("[".concat(this.connectionID,"] ws open error ").concat(S))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),Z("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(n=Z("GATEWAY_WSS_ADDRESS")),k.debug("[".concat(this.name,"] start connect, url:"),n);const _=(i=this.store)===null||i===void 0?void 0:i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var E;const S=await this.chooseBestWebsocketConnection(n);this.websocket=S,c&&c(this.websocket.url),this.websocket.onclose=u,this.websocket.onmessage=h,this.websocket.onerror=p,(E=this.store)===null||E===void 0||E.recordJoinChannelService({endTs:Date.now(),status:"success"},_),this.joinGatewayRecordIndex=_}catch(S){const w=this.state==="closed",I=S instanceof Ie,P=I&&S.code===Y.WS_ABORT,B=I&&S.code===Y.WS_ERR,M=I?S.message:S&&(S.reason||S.toString());k.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(M)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:P?"aborted":"error",errors:[S]},_),w||B?(s.reject(w?new Ie(Y.WS_DISCONNECT,"websocket is closed: ".concat(M)):new Ie(Y.WS_ERR,"init websocket failed: ".concat(M))),B&&k.error("[".concat(this.name,"] init websocket failed: ").concat(M))):u&&u(S)}return s.promise}async reconnectWithAction(n){let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;k.warning("[choose-best-ws] action: =>",n),this.onlineReconnectListener||ri.isOnline||!ri.onlineWaiter||(this.onlineReconnectListener=ri.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let s=!0;if(this.reconnectInterrupter=()=>s=!1,i){const h=z1(this.reconnectCount,this.retryConfig);k.debug("[".concat(this.name,"] wait ").concat(h,"ms to reconnect websocket, mode: ").concat(n)),await Qe.race([Ji(h),this.onlineReconnectListener||new Qe(()=>{})])}if(this._state==="closed"||!s)return!1;this.reconnectCount+=1;const c=async(h,p)=>{this.emit(Gt.RECONNECT_CREATE_CONNECTION,p),await this.createWebSocketConnection(h)};try{if(n==="retry")await c(this.urls[this.currentURLIndex],n);else if(n==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);k.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await c(this.urls[this.currentURLIndex],n)}else n==="recover"&&(k.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await ho(this,Gt.REQUEST_NEW_URLS),this.currentURLIndex=0,await c(this.urls[this.currentURLIndex],n))}catch(h){var u;k.error("[".concat(this.name,"] reconnect failed ").concat(h&&h.toString()));const p=h==null||(u=h.data)===null||u===void 0?void 0:u.desc;return Array.isArray(p)&&$e(p).call(p,"dynamic key expired")?(this.emit(Gt.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(n,i)}return!0}}class DL extends Sz{constructor(n,i){super(n,i,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(n,i){const s=s0(),c=function(h,p){return new Yhe(h,p)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{k.debug("[choose-best-ws] close establishing websockets"),c.closeAllWebsockets(),s.reject(new Ie(Y.WS_ABORT,"choose best websocket aborted"))};const u=Z("GATEWAY_DOMAINS");return k.debug("[choose-best-ws] currentDomain: ",n,", domains: ",u,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),c.chooseBestWebsocket(n,this.tryDoubleDomain,this.use443PortOnly,i).then(s.resolve).catch(s.reject),s.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class T0 extends Sz{constructor(n,i){super(n,i,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(n,i){return new Qe((s,c)=>{let u=!1;const h=[];this.closeEstablishingWs=()=>{k.debug("[choose-best-ws] close establishing websockets"),h.forEach(B=>{B.onclose=null,B.onopen=null,B.onmessage=null,B.close()}),c(new Ie(Y.WS_ABORT,"choose best websocket aborted"))};const p=Z("GATEWAY_DOMAINS");let _;const E=n.indexOf("?h="),S=p.find(B=>E!==-1?$e(n).call(n,B,E):$e(n).call(n,B));k.debug("[choose-best-ws] currentDomain: ",S,", domains: ",p);let w=!this.tryDoubleDomain||!S;if(!w&&S){var I;const B=Date.now();try{p.forEach(M=>{const U=E===-1?n.replace(S,M):n.substr(0,E)+n.substr(E).replace(S,M),$=new WebSocket(U);$.binaryType="arraybuffer",h.push($),k.debug("[choose-best-ws] ws is connecting:",$.url)})}catch{for(k.debug("[choose-best-ws] ws create failed, fallback to single url"),h.forEach(U=>U.close());h.length;)h.pop();w=!0}(I=this.store)===null||I===void 0||I.recordJoinChannelService({urls:h.map(M=>M.url),service:"gateway"},i),h.forEach(M=>{M.onopen=()=>{if(u)return;const U=Date.now()-B;k.debug("[choose-best-ws] ws open cost ".concat(U,"ms")),h.filter($=>$!==M).forEach($=>{k.debug("[choose-best-ws]close backup websocket: ".concat($.url)),$.close()}),u=!0,s(M)},M.onclose=U=>{_=U,!u&&(h.find($=>!($.readyState===WebSocket.CLOSED||$.readyState===WebSocket.CLOSING))||(k.debug("[choose-best-ws] all websocket is closed"),u=!0,c(_)))},M.onmessage=U=>{k.debug("[choose-best-ws]".concat(M.url," onmessage: ").concat(U.data))}}),Ji(this.forceCloseTimeout).then(()=>{h.forEach(M=>{M.readyState!==WebSocket.OPEN&&M.close()})})}if(w){var P;let B;k.debug("[choose-best-ws] use single url: ",n),(P=this.store)===null||P===void 0||P.recordJoinChannelService({urls:[n],service:"gateway"},i);try{B=new WebSocket(n),h.push(B),B.binaryType="arraybuffer"}catch(M){const U=new Ie(Y.WS_ERR,"init websocket failed! Error: ".concat(M.toString()));return k.error("[".concat(this.name,"]").concat(U)),void c(U)}B.onopen=()=>{s(B)},B.onclose=M=>{c(M)},B.onmessage=M=>{k.debug("[choose-best-ws]".concat(B.url," onmessage: ").concat(M.data))},Ji(this.forceCloseTimeout).then(()=>{B&&B.readyState!==WebSocket.OPEN&&B.close()})}}).then(s=>(this.closeEstablishingWs=void 0,s)).catch(s=>{throw this.closeEstablishingWs=void 0,s})}}class Xhe extends Rr{get connectionState(){return this._connectionState}set connectionState(n){n!==this._connectionState&&(this._connectionState=n,n===ir.CONNECTED?this.emit(xt.WS_CONNECTED):n===ir.RECONNECTING?this.emit(xt.WS_RECONNECTING,this._websocketReconnectReason):n===ir.CLOSED&&this.emit(xt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(n,i){super(),K(this,"_disconnectedReason",void 0),K(this,"_websocketReconnectReason",void 0),K(this,"_connectionState",ir.CLOSED),K(this,"reconnectToken",void 0),K(this,"websocket",void 0),K(this,"openConnectionTime",void 0),K(this,"clientId",void 0),K(this,"lastMsgTime",Date.now()),K(this,"uploadCache",[]),K(this,"uploadCacheInterval",void 0),K(this,"rttRolling",new D6(5)),K(this,"pingpongTimer",void 0),K(this,"wsInflateDataTimer",void 0),K(this,"pingpongTimeoutCount",0),K(this,"joinResponse",void 0),K(this,"multiIpOption",void 0),K(this,"initError",void 0),K(this,"spec",void 0),K(this,"store",void 0),K(this,"onWebsocketMessage",s=>{if(s.data instanceof ArrayBuffer)return void this.emit(xt.ON_BINARY_DATA,s.data);const c=JSON.parse(s.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){const u="res-@".concat(c._id);this.emit(u,c._result,c._message)}else if(Object.prototype.hasOwnProperty.call(c,"_type")){if(this.emit(c._type,c._message),c._type===an.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===an.ON_USER_BANNED)switch(c._message.error_code){case 14:this.close(Mn.UID_BANNED);break;case 15:this.close(Mn.IP_BANNED);break;case 16:this.close(Mn.CHANNEL_BANNED)}if(c._type===an.ON_USER_LICENSE_BANNED)switch(c._message.error_code){case It.ERR_LICENSE_MISSING:this.close(Mn.LICENSE_MISSING);break;case It.ERR_LICENSE_EXPIRED:this.close(Mn.LICENSE_EXPIRED);break;case It.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Mn.LICENSE_MINUTES_EXCEEDED);break;case It.ERR_LICENSE_PERIOD_INVALID:this.close(Mn.LICENSE_PERIOD_INVALID);break;case It.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Mn.LICENSE_MULTIPLE_SDK_SERVICE);break;case It.ERR_LICENSE_ILLEGAL:this.close(Mn.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=n.clientId,this.spec=n,this.store=i,this.websocket=new DL("gateway-".concat(this.clientId),this.spec.retryConfig,!0,Z("JOIN_GATEWAY_USE_DUAL_DOMAIN"),Z("JOIN_GATEWAY_USE_443PORT_ONLY"),i),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===ir.CONNECTED&&this.reconnect("retry",uo.OFFLINE)})}async request(n,i,s,c){const u=er(6,""),h={_id:u,_type:n,_message:i},p=this.websocket.connectionID,_=()=>new Qe((B,M)=>{if(this.connectionState===ir.CONNECTED)return B();const U=()=>{this.off(xt.WS_CLOSED,$),B()},$=()=>{this.off(xt.WS_CONNECTED,U),M(new be(Y.WS_ABORT))};this.once(xt.WS_CONNECTED,U),this.once(xt.WS_CLOSED,$),n!==kt.PUBLISH&&n!==kt.PUBLISH_DATASTREAM&&n!==kt.SUBSCRIBE&&n!==kt.SUBSCRIBE_DATASTREAM&&n!==kt.UNSUBSCRIBE&&n!==kt.UNSUBSCRIBE_DATASTREAM&&n!==kt.UNPUBLISH&&n!==kt.UNPUBLISH_DATASTREAM&&n!==kt.CONTROL&&n!==kt.RESTART_ICE||this.once(xt.DISCONNECT_P2P,()=>{M(new be(Y.DISCONNECT_P2P))}),n!==kt.PUBLISH&&n!==kt.RESTART_ICE||this.once(xt.ABORT_P2P_EXECUTION,()=>{M(new be(Y.DISCONNECT_P2P))})});if(this.connectionState!==ir.CONNECTING&&this.connectionState!==ir.RECONNECTING||n===kt.JOIN||n===kt.REJOIN||await _(),this.websocket.sendMessage(h,!0),c)return;const E=new Qe((B,M)=>{let U=!1;const $=(ce,me)=>{U=!0,B({isSuccess:ce==="success",message:me||{}}),this.off(xt.WS_CLOSED,q),this.off(xt.WS_RECONNECTING,q),this.emit(xt.REQUEST_SUCCESS,n,i)};this.once("res-@".concat(u),$);const q=()=>{M(new be(Y.WS_ABORT,"type: ".concat(n))),this.off(xt.WS_CLOSED,q),this.off(xt.WS_RECONNECTING,q),this.off("res-@".concat(u),$)};this.once(xt.WS_CLOSED,q),this.once(xt.WS_RECONNECTING,q),Ji(Z("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==p||U||(k.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(n)),this.emit(xt.REQUEST_TIMEOUT,n,i))})});let S=null;try{S=await E}catch(B){if(this.connectionState===ir.CLOSED||n===kt.LEAVE)throw new be(Y.WS_ABORT);return!this.spec.forceWaitGatewayResponse||s?B.throw():n===kt.JOIN||n===kt.REJOIN?null:(await _(),await this.request(n,i))}if(S.isSuccess)return S.message;const w=Number(S.message.error_code||S.message.code),I=S0(w),P=new be(Y.UNEXPECTED_RESPONSE,"".concat(I.desc,": ").concat(S.message.error_str),{code:w,data:S.message,desc:I.desc});return I.action==="success"?S.message:(k.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(n,", error_code: ").concat(w,", message: ").concat(I.desc,", action: ").concat(I.action)),w===It.ERR_TOO_MANY_BROADCASTERS?((n===kt.JOIN||n===kt.REJOIN)&&(this.initError=P,this.close()),P.throw()):I.action==="failed"?P.throw():I.action==="quit"?(this.initError=P,this.close(),P.throw()):(w===It.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=S.message.option,k.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",uo.MULTI_IP)):this.reconnect(I.action,uo.SERVER_ERROR),n===kt.JOIN||n===kt.REJOIN?null:await this.request(n,i)))}waitMessage(n,i){return new Qe(s=>{const c=u=>{(!i||i(u))&&(this.off(n,c),s(u))};this.on(n,c)})}uploadWRTCStats(n){if(!this.store.sessionId)return void k.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const i={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:n};this.upload(E0.WRTC_STATS,i)}upload(n,i){const s={_type:n,_message:i};try{this.websocket.sendMessage(s)}catch{const u=Z("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(s),this.uploadCache.length>u&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==ir.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},Z("UPLOAD_CACHE_INTERVAL")||2e3))}}send(n,i){const s={_type:n,_message:i};this.websocket.sendMessage(s)}init(n){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new Qe((i,s)=>{this.once(xt.WS_CONNECTED,()=>i(this.joinResponse)),this.once(xt.WS_CLOSED,c=>s(this.initError||new be(Y.WS_ABORT,c))),this.connectionState=ir.CONNECTING,this.websocket.init(n).catch(s),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=n||Mn.LEAVE,this.connectionState=ir.CLOSED,k.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(xt.ABORT_P2P_EXECUTION);const n=await ho(this,xt.REQUEST_JOIN_INFO),i=await this.request(kt.JOIN,n);if(!i)return this.emit(xt.REPORT_JOIN_GATEWAY,pA.TIMEOUT,this.url||""),!1;this.joinResponse=i,this.emit(xt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=ir.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new be(Y.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const n=h0(this,xt.REQUEST_REJOIN_INFO);n.token=this.reconnectToken;const i=await this.request(kt.REJOIN,n);return!!i&&(this.connectionState=ir.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),i.peers&&i.peers.forEach(s=>{this.emit(an.ON_USER_ONLINE,{uid:s.uid}),s.audio&&this.emit(an.ON_ADD_AUDIO_STREAM,{uid:s.uid,uint_id:s.uint_id,audio:!0,ssrcId:s.audio_ssrc}),s.video&&this.emit(an.ON_ADD_VIDEO_STREAM,{uid:s.uid,uint_id:s.uint_id,video:!0,ssrcId:s.video_ssrc}),s.audio_mute?this.emit(an.MUTE_AUDIO,{uid:s.uid}):this.emit(an.UNMUTE_AUDIO,{uid:s.uid}),s.video_mute?this.emit(an.MUTE_VIDEO,{uid:s.uid}):this.emit(an.UNMUTE_VIDEO,{uid:s.uid}),s.audio_enable_local?this.emit(an.ENABLE_LOCAL_AUDIO,{uid:s.uid}):this.emit(an.DISABLE_LOCAL_AUDIO,{uid:s.uid}),s.video_enable_local?this.emit(an.ENABLE_LOCAL_VIDEO,{uid:s.uid}):this.emit(an.DISABLE_LOCAL_VIDEO,{uid:s.uid}),s.audio||s.video||this.emit(an.ON_REMOVE_STREAM,{uid:s.uid,uint_id:s.uint_id})}),!0)}reconnect(n,i){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(n,i)}handleNotification(n){k.debug("[".concat(this.clientId,"] receive notification: "),n);const i=S0(n.code);if(n.code===28&&"detail"in n&&(k.info("[".concat(this.clientId,"] receive recover notification: "),n.detail),this.emit(xt.RECOVER_NOTIFICATION,n.detail)),i.action!=="success"){if(i.action!=="failed")return i.action==="quit"?(i.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Mn.UID_BANNED),void this.close()):void this.reconnect(i.action,uo.SERVER_ERROR);k.error("[".concat(this.clientId,"] ignore error: "),i.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const n=Z("PING_PONG_TIME_OUT"),i=Date.now();this.pingpongTimeoutCount>=n&&(k.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(i-this.lastMsgTime,"ms")),i-this.lastMsgTime>Z("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",uo.TIMEOUT):this.request(kt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const s=Date.now()-i;this.rttRolling.add(s),Z("REPORT_STATS")&&this.send(kt.PING_BACK,{pingpongElapse:s})}).catch(s=>{})}handleWsInflateData(){const{wsInflateLength:n,wsDeflateLength:i}=this.websocket.getWsInflateData();n!==0&&i!==0&&this.upload(E0.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:i,ws_inflate_length:n})}handleWebsocketEvents(){this.websocket.on(Gt.RECONNECT_CREATE_CONNECTION,n=>{this.emit(xt.WS_RECONNECT_CREATE_CONNECTION,n)}),this.websocket.on(Gt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Gt.CLOSED,()=>{this.connectionState=ir.CLOSED}),this.websocket.on(Gt.FAILED,()=>{this._disconnectedReason=Mn.NETWORK_ERROR,this.connectionState=ir.CLOSED}),this.websocket.on(Gt.RECONNECTING,n=>{this._websocketReconnectReason=n,this.joinResponse=void 0,this.connectionState===ir.CONNECTED?this.connectionState=ir.RECONNECTING:this.connectionState=ir.CONNECTING}),this.websocket.on(Gt.WILL_RECONNECT,(n,i,s)=>{const c=h0(this,xt.IS_P2P_DISCONNECTED),u=c||n!=="retry";c&&n==="retry"&&(k.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),n="tryNext",i=pA.P2P_DISCONNECTED),u&&(k.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(n)),this.emit(xt.REPORT_JOIN_GATEWAY,i||pA.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(xt.DISCONNECT_P2P)),s(n)}),this.websocket.on(Gt.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(n=>{k.warning("[".concat(this.clientId,"] rejoin failed ").concat(n)),this.reconnect("tryNext",uo.SERVER_ERROR)}):this.join().catch(n=>{if(this.emit(xt.REPORT_JOIN_GATEWAY,n,this.url||""),n instanceof be){if(n.code===Y.UNEXPECTED_RESPONSE&&n.data.code===It.ERR_NO_AUTHORIZED)return this.initError=new be(Y.TOKEN_EXPIRE,"dynamic key expired"),void this.close(Mn.TOKEN_EXPIRE);k.error("[".concat(this.clientId,"] join gateway request failed"),n.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",uo.SERVER_ERROR):(this.initError=n,this.close())}})}),this.websocket.on(Gt.REQUEST_NEW_URLS,(n,i)=>{ho(this,xt.REQUEST_RECOVER,this.multiIpOption).then(n).catch(i)}),this.websocket.on(Gt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(an.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(_z.PRE_CONNECT_PC,()=>{this.emit(xt.PRE_CONNECT_PC)})}}let Jhe=function(e){return e.NATIVE_RTC="native_rtc",e.NATIVE_RTM="native_rtm",e.WEB_RTC="web_rtc",e.WEB_RTM="web_rtm",e}({}),ii=function(e){return e[e.CHOOSE_SERVER=11]="CHOOSE_SERVER",e[e.CLOUD_PROXY=18]="CLOUD_PROXY",e[e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",e[e.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",e}({});function Tz(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,s)}return i}function gA(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?Tz(Object(i),!0).forEach(function(s){K(e,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Tz(Object(i)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(i,s))})}return e}function Kp(e){return e.match(/^[\.\:\d]+$/)?"".concat(e.replace(/[^\d]/g,"-"),".").concat(Z("TURN_DOMAIN")):(k.debug("Cannot recognized as ip address: ".concat(e,", use as host")),e)}function LL(e,n){e.addresses||(e.addresses=[]);const i=function(p,_){if(Z("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return p.map(w=>{let{ip:I,port:P}=w;return{address:"".concat(I,":").concat(P)}});const E=Z("GATEWAY_DOMAINS");let S=E[1]&&$e(_).call(_,E[1])?1:0;return p.map(w=>{let{domain_prefix:I,port:P,ip:B}=w;if(I)return{address:"".concat(I,".").concat(E[S++%E.length],":").concat(P)};const M=/^[\.\:\d]+$/.test(B),U=M?"".concat(B.replace(/[^\d]/g,"-"),".").concat(E[S++%E.length],":").concat(P):"".concat(B,":").concat(P);return M||k.debug("Cannot recognized as ip address: ".concat(B,", use as host")),{ip:B,port:P,address:U}})}(e.addresses,n),s=Array.isArray(e.detail)&&e.detail[18];if(s&&typeof s=="string"){const p=s.split(";");for(let _=0;_<p.length;_++){var c;const E=$o(c=p[_]).call(c);i[_]&&E&&(i[_].ip6=E)}}const u=e.detail&&e.detail.candidate;let h;if(u){const[p,_]=u.split(":");p&&_&&(h={port:Number(_),ip:p,address:"".concat(p,":").concat(_)})}return{gatewayAddrs:i,apGatewayAddress:h,uid:e.uid,cid:e.cid,cert:e.cert,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function Ba(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function bz(e){const n=e._encoderConfig;if(!n)return{};const i={resolution:n.width&&n.height?"".concat(Ba(n.width),"x").concat(Ba(n.height)):void 0,maxVideoBW:n.bitrateMax,minVideoBW:n.bitrateMin};return typeof n.frameRate=="number"?(i.maxFrameRate=n.frameRate,i.minFrameRate=n.frameRate):n.frameRate&&(i.maxFrameRate=n.frameRate.max||n.frameRate.ideal||n.frameRate.exact||n.frameRate.min,i.minFrameRate=n.frameRate.min||n.frameRate.ideal||n.frameRate.exact||n.frameRate.max),i}function wz(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function b0(e,n){let i,s,c;switch(n){case ii.CHOOSE_SERVER:s=4096,c="choose server";break;case ii.CLOUD_PROXY:s=1048576,c="proxy";break;case ii.CLOUD_PROXY_5:s=4194304,c="proxy5";break;case ii.CLOUD_PROXY_FALLBACK:s=4194310,c="proxy fallback";break;default:throw new be(Y.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(e.response_body.forEach(u=>{u.buffer&&u.buffer.flag===s&&(i={code:u.buffer.code,addresses:(u.buffer.edges_services||[]).map(h=>gA(gA({},h),{},{ticket:u.buffer.cert})),server_ts:e.enter_ts,uid:u.buffer.uid,cid:u.buffer.cid,cname:u.buffer.cname,detail:gA(gA({},u.buffer.detail),e.detail),flag:u.buffer.flag,opid:e.opid,cert:u.buffer.cert})}),!i)throw new be(Y.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(c," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return i}async function Rz(e,n){return await Qe.all(e.addresses.map(async i=>({address:Z("USE_TURN_IP")?i.ip:Kp(i.ip),tcpport:i.port,udpport:i.port,username:n&&Z("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?n.toString():fo.username,password:n&&Z("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await j1(n.toString()):fo.password})))}function xL(e,n){const i=n.getMediaStreamTrack(!0).getSettings(),s=n.videoHeight||i.height,c=n.videoWidth||i.width;return s&&c?Math.max(Math.min(s,c)/Math.min(Ba(e.height),Ba(e.width)),1):(k.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function $p(e){let{candidateType:n,relayProtocol:i,type:s,address:c,port:u,protocol:h}=e;const p={candidateType:n,relayProtocol:i,protocol:h};if(s!=="local-candidate"){const _=c.split(".");_.length>=4&&(_[1]="*",_[2]="*"),p.address=_.join("."),p.port=u}return p}function _A(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Z("SVC_MODE");if(Z("ENABLE_SVC"))return function(n){return n in KI}(e)?e:KI.L1T3}const Cz={[ot.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[ot.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function vA(e,n,i){n.forEach(s=>{var c;const u=Cz[e].find(p=>{var _;let{key:E}=p;return $e(_=s.extensionName).call(_,E)});if(!u)return;const h=i.find(p=>{let{extensionName:_}=p;return $e(_).call(_,u.key)});h&&$e(c=h.extensionName).call(c,"gdpr_forbidden")&&(s.extensionName=h.extensionName)})}function ZE(e,n){n.forEach(i=>{var s;const c=Cz[e].find(u=>{var h;let{key:p}=u;return $e(h=i.extensionName).call(h,p)});$e(s=i.extensionName).call(s,"gdpr_forbidden")&&c&&(i.extensionName=c.extensionName)})}function Iz(e){return e==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"||$e(e).call(e,"abs-send-time")}function EA(e){return e==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"||$e(e).call(e,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function Az(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,s)}return i}function Oz(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?Az(Object(i),!0).forEach(function(s){K(e,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Az(Object(i)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(i,s))})}return e}function w0(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=arguments.length>3?arguments[3]:void 0;const{filterRTX:c,filterVideoFec:u,filterAudioFec:h,filterAudioCodec:p,filterVideoCodec:_}=n,{useXR:E}=i;let S=[],w=[],I=[],P=[],B=!1,M=!1;if(la(e).mediaDescriptions.forEach($=>{s&&s!==$.attributes.direction||($.media.mediaType!=="video"||B||(w=$.attributes.payloads,P=$.attributes.extmaps,B=!0),$.media.mediaType!=="audio"||M||(S=$.attributes.payloads,I=$.attributes.extmaps,M=!0))}),!P||w.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!I||S.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(w.forEach($=>{var q;(q=$.rtpMap)!==null&&q!==void 0&&q.clockRate&&($.rtpMap.clockRate=parseInt($.rtpMap.clockRate)),E&&$.rtcpFeedbacks.push({type:"rrtr"})}),S.forEach($=>{var q;(q=$.rtpMap)!==null&&q!==void 0&&q.clockRate&&($.rtpMap.clockRate=parseInt($.rtpMap.clockRate)),E&&$.rtcpFeedbacks.push({type:"rrtr"})}),c&&(S=S.filter($=>{var q;return((q=$.rtpMap)===null||q===void 0?void 0:q.encodingName.toLowerCase())!=="rtx"}),w=w.filter($=>{var q;return((q=$.rtpMap)===null||q===void 0?void 0:q.encodingName.toLowerCase())!=="rtx"})),u&&(w=w.filter($=>{var q;return!/(red)|(ulpfec)|(flexfec)/i.test(((q=$.rtpMap)===null||q===void 0?void 0:q.encodingName)||"")})),h&&(S=S.filter($=>{var q;return!/(red)|(ulpfec)|(flexfec)/i.test(((q=$.rtpMap)===null||q===void 0?void 0:q.encodingName)||"")})),p&&(p==null?void 0:p.length)>0&&(S=S.filter($=>{var q;return $e(p).call(p,((q=$.rtpMap)===null||q===void 0?void 0:q.encodingName.toLowerCase())||"")})),_&&(_==null?void 0:_.length)>0){const $=w.filter(q=>{var ce;return $e(_).call(_,((ce=q.rtpMap)===null||ce===void 0?void 0:ce.encodingName.toLowerCase())||"")});w=$.concat(c?[]:VL($,w))}const U=Z("UNSUPPORTED_VIDEO_CODEC");return U&&U.length>0&&(w=w.filter($=>!($.rtpMap&&$e(U).call(U,$.rtpMap.encodingName.toLowerCase())))),{audioCodecs:S,videoCodecs:w,audioExtensions:I,videoExtensions:P}}function qp(e){const n=la(e);let i,s;for(const c of n.mediaDescriptions){if(!i){const u=c.attributes.iceUfrag,h=c.attributes.icePwd;if(!u||!h)throw new Error("Cannot get iceUfrag or icePwd from SDP.");i={iceUfrag:u,icePwd:h}}if(!s){const u=c.attributes.fingerprints;u.length>0&&(s={fingerprints:u})}}if(!s&&n.attributes.fingerprints.length>0&&(s={fingerprints:n.attributes.fingerprints}),!s||!i)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:i,dtlsParameters:s}}function Pz(e,n){const i=[],s=e.attributes.ssrcGroups.filter(h=>h.semantic==="FID"),c=e.attributes.ssrcGroups.find(h=>h.semantic==="SIM"),u=e.attributes.ssrcs;if(c)c.ssrcIds.forEach(h=>{var p;const _=(p=s.find(E=>E.ssrcIds[0]===h))===null||p===void 0?void 0:p.ssrcIds[1];i.push({ssrcId:h,rtx:n?_:void 0})});else if(s.length>0){const h=s[0].ssrcIds[0],p=s[0].ssrcIds[1];i.push({ssrcId:h,rtx:n?p:void 0})}else{if(u.length===0)throw new Error("No ssrcs found on local media description.");i.push({ssrcId:u[0].ssrcId})}return i}function Nz(e,n,i){const{cname:s}=e;let c=[];n&&(c=kz(n)),c.length===0&&(c=e.iceParameters.candidates.map(S=>({foundation:S.foundation,componentId:"1",transport:S.protocol,priority:S.priority.toString(),connectionAddress:S.ip,port:S.port.toString(),type:S.type,extension:{}})),k.debug("Using candidates from gateway."));const u={fingerprints:e.dtlsParameters.fingerprints.map(S=>({hashFunction:S.algorithm,fingerprint:S.fingerprint}))},h={iceUfrag:e.iceParameters.iceUfrag,icePwd:e.iceParameters.icePwd};let p;switch(e.dtlsParameters.role){case"server":p="passive";break;case"client":p="active";break;case"auto":p="actpass"}const _=SA(e.rtpCapabilities),E=[];return Array.isArray(i)&&i.length>0&&i.forEach(S=>{E.push({kind:ot.VIDEO,ssrcId:S.v,rtx:S.v_rtx,mslabel:"".concat(S.v,"_").concat(S.a)},{kind:ot.AUDIO,ssrcId:S.a,mslabel:"".concat(S.v,"_").concat(S.a)})}),{dtlsParameters:u,iceParameters:h,candidates:c,rtpCapabilities:_,setup:p,cname:s,preSSRCs:E}}function kz(e){let n=[];return e.ip&&typeof e.port=="number"&&(n=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip,port:e.port.toString(),type:"host",extension:{}}],k.debug("Using remote candidate from AP ".concat(e.ip,":").concat(e.port)),e.ip6&&(n.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip6,port:e.port.toString(),type:"host",extension:{}}),k.debug("Using IPV6 remote candidate from AP ".concat(e.ip6,":").concat(e.port)))),n}function i_(e,n,i){const s=[],c=[];return e.forEach(u=>{let{ssrcId:h,rtx:p}=u;const _=er(8,"track-"),E={ssrcId:h,attributes:Oz({label:_,mslabel:i=i||er(10,""),msid:"".concat(i," ").concat(_)},n&&{cname:n})};if(s.push(E),p!==void 0){const S={ssrcId:p,attributes:Oz({label:_,mslabel:i,msid:"".concat(i," ").concat(_)},n&&{cname:n})};s.push(S),c.push({semantic:"FID",ssrcIds:[h,p]})}}),e.length>1&&c.push({semantic:"SIM",ssrcIds:e.map(u=>{let{ssrcId:h}=u;return h})}),{ssrcs:s,ssrcGroups:c}}function ey(e,n){n instanceof Fr&&e.attributes.payloads.forEach(i=>{var s;const c=(s=i.rtpMap)===null||s===void 0?void 0:s.encodingName.toLowerCase();if(!c||["opus","pcmu","pcma","g722"].indexOf(c)===-1)return;i.fmtp||(i.fmtp={parameters:{}}),i.fmtp.parameters.minptime="10",i.fmtp.parameters.useinbandfec="1";const u=n._encoderConfig;u&&c!=="pcmu"&&c!=="pcma"&&c!=="g722"&&(u.bitrate&&!Nr()&&(i.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*u.bitrate))),u.sampleRate&&(i.fmtp.parameters.maxplaybackrate="".concat(u.sampleRate),i.fmtp.parameters["sprop-maxcapturerate"]="".concat(u.sampleRate)),u.stereo&&(i.fmtp.parameters.stereo="1",i.fmtp.parameters["sprop-stereo"]="1"))})}function ML(e){const n=e.attributes.unrecognized.findIndex(i=>i.attField==="x-google-flag"&&i.attValue==="conference");n!==-1&&e.attributes.unrecognized.splice(n,1)}function UL(e,n){var i;if(!(n instanceof ur&&n._encoderConfig&&n._hints.indexOf(tr.SCREEN_TRACK)===-1))return;const s=n._encoderConfig;Cn().supportMinBitrate&&s.bitrateMin&&e.attributes.payloads.forEach(c=>{var u,h;$e(u=["h264","h265","vp8","vp9","av1"]).call(u,((h=c.rtpMap)===null||h===void 0?void 0:h.encodingName.toLowerCase())||"")&&(c.fmtp||(c.fmtp={parameters:{}}),c.fmtp.parameters["x-google-min-bitrate"]="".concat(s.bitrateMin))}),Cn().supportMinBitrate&&!$e(i=n._hints).call(i,tr.LOW_STREAM)&&s.bitrateMax&&e.attributes.payloads.forEach(c=>{var u,h;$e(u=["h264","h265","vp8","vp9","av1"]).call(u,((h=c.rtpMap)===null||h===void 0?void 0:h.encodingName.toLowerCase())||"")&&(c.fmtp||(c.fmtp={parameters:{}}),c.fmtp.parameters["x-google-start-bitrate"]="".concat(Z("X_GOOGLE_START_BITRATE")||Math.floor(s.bitrateMax)))})}function Dz(e){if(e.media.mediaType!=="video")return;const n=vn();if(n.name!==Nn.SAFARI&&n.os!==Pi.IOS)return;const i=e.attributes.extmaps.findIndex(s=>/video-orientation/g.test(s.extensionName));i!==-1&&e.attributes.extmaps.splice(i,1)}function yA(e,n,i){if(!n)return;let s,c;if(e.media.mediaType==="video"?(s=i.videoExtensions,c=i.videoCodecs):(s=i.audioExtensions,c=i.audioCodecs),n.twcc===!0){const u=s.find(h=>EA(h.extensionName));if(u){const h=u.extensionName;e.attributes.extmaps.find(_=>EA(_.extensionName))||e.attributes.extmaps.push({entry:u.entry,extensionName:h}),function(_,E){return E.filter(S=>!!_.find(w=>w.payloadType===S.payloadType&&!!w.rtcpFeedbacks.find(I=>I.type==="transport-cc")))}(c,e.attributes.payloads).forEach(_=>{_.rtcpFeedbacks.find(E=>E.type==="transport-cc")||_.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(n.twcc===!1){const u=e.attributes.extmaps.findIndex(h=>EA(h.extensionName));u!==-1&&e.attributes.extmaps.splice(u,1),e.attributes.payloads.forEach(h=>{const p=h.rtcpFeedbacks.findIndex(_=>_.type==="transport-cc");p!==-1&&h.rtcpFeedbacks.splice(p,1)})}if(n.remb===!0){const u=s.find(h=>Iz(h.extensionName));if(u){const h=u.extensionName;e.attributes.extmaps.find(_=>_.extensionName===h)||e.attributes.extmaps.push({entry:u.entry,extensionName:h}),function(_,E){return E.filter(S=>!!_.find(w=>w.payloadType===S.payloadType&&!!w.rtcpFeedbacks.find(I=>I.type==="goog-remb")))}(c,e.attributes.payloads).forEach(_=>{_.rtcpFeedbacks.find(E=>E.type==="goog-remb")||_.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(n.remb===!1){const u=e.attributes.extmaps.findIndex(h=>Iz(h.extensionName));u!==-1&&e.attributes.extmaps.splice(u,1),e.attributes.payloads.forEach(h=>{const p=h.rtcpFeedbacks.findIndex(_=>_.type==="goog-remb");p!==-1&&h.rtcpFeedbacks.splice(p,1)})}}function Lz(e,n,i){if(Nr()||e.media.mediaType!=="video"||!(n instanceof ur)||i!=="vp9"&&i!=="vp8"||i==="vp8"&&!Z("SIMULCAST")||i==="vp9"&&Z("ENABLE_SVC")||n._scalabilityMode===void 0||n._scalabilityMode.numSpatialLayers<=1)return;const s=i==="vp8"?2:n._scalabilityMode.numSpatialLayers,c=e.attributes.ssrcs[0],u=e.attributes.ssrcGroups.find(p=>p.semantic==="FID"&&p.ssrcIds[0]===c.ssrcId),h={semantic:"SIM",ssrcIds:[c.ssrcId]};for(let p=1;p<s;p++)e.attributes.ssrcs.push({ssrcId:c.ssrcId+p,attributes:Lr(c.attributes)}),h.ssrcIds.push(c.ssrcId+p),u&&(e.attributes.ssrcs.push({ssrcId:u.ssrcIds[1]+p,attributes:Lr(c.attributes)}),e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[c.ssrcId+p,u.ssrcIds[1]+p]}));e.attributes.ssrcGroups.unshift(h)}async function xz(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=new RTCPeerConnection;i.addTransceiver("video",{direction:"sendonly"}),i.addTransceiver("audio",{direction:"sendonly"}),i.addTransceiver("video",{direction:"recvonly"}),i.addTransceiver("audio",{direction:"recvonly"});const s=(await i.createOffer()).sdp,{send:c,recv:u,sendrecv:h}=function(){let p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},_=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},E=arguments.length>2?arguments[2]:void 0;const S=w0(E,p,_,"sendonly"),w=w0(E,p,_,"recvonly"),I={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},P={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},B={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Gl(S,w,"videoExtensions",I,P,B),Gl(S,w,"videoCodecs",I,P,B),Gl(S,w,"audioExtensions",I,P,B),Gl(S,w,"audioCodecs",I,P,B),Z("RAISE_H264_BASELINE_PRIORITY")){const M=[],U=[];B.videoCodecs.forEach(($,q)=>{var ce;if(((ce=$.rtpMap)===null||ce===void 0?void 0:ce.encodingName.toLocaleLowerCase())==="h264"){var me,ge;const pe=B.videoCodecs[q+1],Re=pe&&jz($,pe),Ve=(me=$.fmtp)===null||me===void 0?void 0:me.parameters["profile-level-id"],Ze=(ge=$.fmtp)===null||ge===void 0?void 0:ge.parameters["packetization-mode"];!Ve||Ve!==Z("FIRST_H264_PROFILE_LEVEL_ID")||Z("FIRST_PACKETIZATION_MODE")&&Ze!==Z("FIRST_PACKETIZATION_MODE")?Re?U.push([$,pe]):U.push([$]):Re?M.push([$,pe]):M.push([$])}}),M.length>0&&U.length>0&&(k.debug("raising H264 baseline profile priority"),B.videoCodecs.forEach(($,q)=>{var ce;if(((ce=$.rtpMap)===null||ce===void 0?void 0:ce.encodingName.toLocaleLowerCase())==="h264"){const me=jz($,B.videoCodecs[q+1]),ge=M.shift()||U.shift()||[];ge.length>0&&(me?B.videoCodecs.splice(q,2,...ge):B.videoCodecs.splice(q,1,...ge))}}),P.videoCodecs=P.videoCodecs.filter($=>{var q,ce;return!(((q=$.rtpMap)===null||q===void 0?void 0:q.encodingName.toLocaleLowerCase())==="h264"&&((ce=$.fmtp)===null||ce===void 0?void 0:ce.parameters["profile-level-id"])!==Z("FIRST_H264_PROFILE_LEVEL_ID"))}),Z("FILTER_SEND_H264_BASELINE")&&(I.videoCodecs=I.videoCodecs.filter($=>{var q,ce;return!(((q=$.rtpMap)===null||q===void 0?void 0:q.encodingName.toLocaleLowerCase())==="h264"&&((ce=$.fmtp)===null||ce===void 0?void 0:ce.parameters["profile-level-id"])!==Z("FIRST_H264_PROFILE_LEVEL_ID"))})))}return{send:I,recv:P,sendrecv:B}}(e,n,s);try{i.close()}catch{}return{send:c,recv:u,sendrecv:h}}function Mz(){const e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},n=w0(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},s={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Gl(e,n,"videoExtensions",i,s,c),Gl(e,n,"videoCodecs",i,s,c),Gl(e,n,"audioExtensions",i,s,c),Gl(e,n,"audioCodecs",i,s,c),Z("RAISE_H264_BASELINE_PRIORITY")){const u=c.videoCodecs.findIndex(h=>h.rtpMap&&h.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&h.fmtp&&h.fmtp.parameters["profile-level-id"]==="42001f");if(u!==-1){const h=c.videoCodecs.findIndex(p=>p.rtpMap&&p.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(h<u){k.debug("raising H264 baseline profile priority");const p=c.videoCodecs[u];c.videoCodecs.splice(u,1),c.videoCodecs.splice(h,0,p)}h!==-1&&(s.videoCodecs=s.videoCodecs.filter(p=>!(p.rtpMap&&p.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&p.fmtp&&p.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:i,recv:s,sendrecv:c}}function Gl(e,n,i,s,c,u){if(i==="videoExtensions"||i==="audioExtensions"){const h=[];return e[i].forEach(p=>{n[i].some((_,E)=>{if(p.entry===_.entry&&p.extensionName===_.extensionName)return h.push(E),!0})?u[i].push(p):s[i].push(p)}),void n[i].forEach((p,_)=>{h.indexOf(_)===-1&&c[i].push(p)})}if(i==="videoCodecs"||i==="audioCodecs"){const h=[];return e[i].forEach(p=>{n[i].some((_,E)=>{if(p.payloadType===_.payloadType&&JSON.stringify(p)===JSON.stringify(_))return h.push(E),!0})?u[i].push(p):s[i].push(p)}),void n[i].forEach((p,_)=>{h.indexOf(_)===-1&&c[i].push(p)})}}function SA(e){const{send:n,recv:i,sendrecv:s}=e;if(!s){if(!n||!i)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:n,recv:i}}let c,u;return n?(c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c.audioCodecs=[...n.audioCodecs,...s.audioCodecs],c.videoCodecs=[...n.videoCodecs,...s.videoCodecs],c.audioExtensions=[...n.audioExtensions,...s.audioExtensions],c.videoExtensions=[...n.videoExtensions,...s.videoExtensions]):c=s,i?(u={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},u.audioCodecs=[...i.audioCodecs,...s.audioCodecs],u.videoCodecs=[...i.videoCodecs,...s.videoCodecs],u.audioExtensions=[...i.audioExtensions,...s.audioExtensions],u.videoExtensions=[...i.videoExtensions,...s.videoExtensions]):u=s,{send:c,recv:u}}function ty(e){e.media.mediaType==="audio"&&e.attributes.payloads.filter(n=>{var i;return((i=n.rtpMap)===null||i===void 0?void 0:i.encodingName.toLowerCase())==="opus"}).forEach(n=>{n.fmtp||(n.fmtp={parameters:{}}),n.fmtp.parameters.stereo="1",n.fmtp.parameters["sprop-stereo"]="1"})}function R0(e,n,i,s){let c=[];if(e===ot.VIDEO){if(Z("H264_PROFILE_LEVEL_ID")&&s==="h264"&&(c=n.videoCodecs.filter(u=>{var h;return $e(h=u.rtpMap&&u.rtpMap.encodingName.toLowerCase()||"").call(h,s)&&u&&u.fmtp&&u.fmtp.parameters["profile-level-id"]===Z("H264_PROFILE_LEVEL_ID")})),!Array.isArray(c)||c.length===0){let u=[];const h=[],p=[],_=[];if(i.videoCodecs.forEach(E=>{const S=E.rtpMap&&E.rtpMap.encodingName.toLowerCase()||"";$e(S).call(S,s)?u.push(E):$e(S).call(S,"vp9")?h.push(E):$e(S).call(S,"vp8")?p.push(E):$e(S).call(S,"h264")&&_.push(E)}),u.length===0){let E="";h.length!==0?(u=h,E="vp9"):p.length!==0?(u=p,E="vp8"):_.length!==0&&(u=_,E="h264"),k.warning("codec ".concat(s," not included in rtpCapabilities, fallback to default payloads: ").concat(E))}u.length!==0&&(c=n.videoCodecs.filter(E=>u.some(S=>S.payloadType===E.payloadType)))}if(c.length===0&&(k.warning("codec ".concat(s," not included in rtpCapabilities, fallback to default payloads: ").concat(n.videoCodecs[0].rtpMap&&n.videoCodecs[0].rtpMap.encodingName)),c=n.videoCodecs),Z("USE_PUB_RTX")||Z("USE_SUB_RTX")){const u=VL(c,n.videoCodecs);c=[...c,...u]}}else c=n.audioCodecs.filter(u=>{var h;return $e(h=u.rtpMap&&u.rtpMap.encodingName.toLowerCase()||"").call(h,s)}),c.length===0&&(k.warning("codec ".concat(s," not included in rtpCapabilities, fallback to opus")),c=n.audioCodecs.filter(u=>{var h;return $e(h=u.rtpMap&&u.rtpMap.encodingName.toLowerCase()||"").call(h,"opus")}));return c}function VL(e,n){const i=e.map(s=>s.payloadType.toString());return n.filter(s=>s.rtpMap&&s.rtpMap.encodingName==="rtx"&&s.fmtp&&s.fmtp.parameters.apt&&$e(i).call(i,s.fmtp&&s.fmtp.parameters.apt))}async function C0(e,n,i){const s=n.toString(),c=Vz(s,"offer","remote","exchangeSDP");await e.setRemoteDescription({type:"offer",sdp:s});const u=await e.createAnswer();if(!u.sdp)throw new Error("cannot get answer sdp");let h=u.sdp;h=Uz(h,i||{}),c==null||c(h||""),await e.setLocalDescription({type:"answer",sdp:h})}function Uz(e,n,i){const s=la(e),{useXR:c}=n;return s.mediaDescriptions.forEach(u=>{var h;u.attributes.mid&&(Array.isArray(i)&&!$e(i).call(i,u.attributes.mid)||(u.media.mediaType==="audio"&&ty(u),c&&$e(h=["audio","video"]).call(h,u.media.mediaType)&&u.attributes.payloads.forEach(p=>{p.rtcpFeedbacks.findIndex(_=>_.type==="rrtr")===-1&&p.rtcpFeedbacks.push({type:"rrtr"})})))}),Gp(s)}function Vz(e,n,i,s){if(Z("SDP_LOGGING"))return k.upload("exchanging ".concat(i," ").concat(n," SDP during P2PConnection.").concat(s,`
`),e),n==="offer"?c=>{Vz(c,"answer",i==="local"?"remote":"local",s)}:void 0}function Fz(e){const n=Z("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(n)&&n.length>0)&&n.some(i=>$e(e).call(e,i))}function jz(e,n){try{var i;return((i=e.fmtp)===null||i===void 0?void 0:i.parameters.apt)===n.payloadType.toString()}catch{return!1}}function Bz(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,s)}return i}function il(e,n){return typeof Z(e)===n?Z(e):void 0}function Qhe(){try{const e=Z("EXPERIMENTS")||{};return typeof e=="string"||Array.isArray(e)?{}:function(n){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?Bz(Object(s),!0).forEach(function(c){K(n,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):Bz(Object(s)).forEach(function(c){Object.defineProperty(n,c,Object.getOwnPropertyDescriptor(s,c))})}return n}({},e)}catch(e){return k.debug("handle gateway attributes failed: ",e),{}}}const Wz={};function Yp(e){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&k.debug("install service ".concat(e.name)),Wz[e.name]=e}function Ef(e){const n=Wz[e];if(!n)throw new Ie(Y.INVALID_OPERATION,"".concat(e," not found, please use AgoraRTC.use(").concat(e,"Service) to load it first"));return n}function Gz(e,n){return Ef("DataStream").create(e,n)}function TA(){return Ef("InterceptFrame").create()}function zz(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,s)}return i}function yf(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?zz(Object(i),!0).forEach(function(s){K(e,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):zz(Object(i)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(i,s))})}return e}const FL=new Map;class Zhe extends Rr{get state(){return this._state}set state(n){if(n===this._state)return;const i=this._state;this._state=n,n==="DISCONNECTED"&&this._disconnectedReason?this.emit(ji.CONNECTION_STATE_CHANGE,n,i,this._disconnectedReason):this.emit(ji.CONNECTION_STATE_CHANGE,n,i)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(n){k.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(n)),this._joinGatewayStartTime=n}constructor(n,i){var s,c,u;super(),K(this,"store",void 0),K(this,"joinInfo",void 0),K(this,"key",void 0),K(this,"ntpOffset",0),K(this,"signal",void 0),K(this,"role",void 0),K(this,"inChannelInfo",{joinAt:null,duration:0}),K(this,"spec",void 0),K(this,"_state","DISCONNECTED"),K(this,"_statsCollector",void 0),K(this,"_disconnectedReason",void 0),K(this,"isSignalRecover",!1),K(this,"hasChangeBGPAddress",!1),K(this,"trafficStatsInterval",void 0),K(this,"networkQualityInterval",void 0),K(this,"_joinGatewayStartTime",0),K(this,"_signalTimeout",!1),K(this,"_clientRoleOptions",void 0),K(this,"_isProactiveJoin",!1),this.store=n,this.spec=i,this.signal=this.store.useP2P?(s={spec:yf(yf({},i),{},{retryConfig:i.websocketRetryConfig}),store:n},(c=(u=Ef("P2PChannel")).createSubmodule)===null||c===void 0?void 0:c.call(u,s)):new Xhe(yf(yf({},i),{},{retryConfig:i.websocketRetryConfig}),n),this._statsCollector=i.statsCollector,this.role=i.role||"audience",this._clientRoleOptions=i.clientRoleOptions,this.handleSignalEvents()}async join(n,i,s){this.store.joinGatewayStart(),n.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const c=Date.now();let u=FL.get(n.cname);if(u||(u=new Map,FL.set(n.cname,u)),this._isProactiveJoin=!0,u.has(n.uid)){const E=new be(Y.UID_CONFLICT);throw pt.joinGateway(n.sid,{lts:c,succ:!1,ec:E.code,addr:null,uid:n.uid,cid:n.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!n.proxyServer,signalChannel:"0",preload:n.preload}),E}u.set(n.uid,!0),this.joinInfo=n,this.key=i;let h=0;this.joinGatewayStartTime=c;const p=n.proxyServer;try{k.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(h));const E=n.gatewayAddrs.map(S=>{let{address:w}=S;const[I,P]=w.split(":"),B={host:I,port:P};return n.proxyServer&&(B.proxy=n.proxyServer),B});h=(await this.signal.init(E)).uid,k.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(h," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(E){var _;throw k.error("[".concat(this.store.clientId,"] User join failed"),E.toString()),pt.joinGateway(n.sid,{lts:c,succ:!1,ec:((_=E.data)===null||_===void 0?void 0:_.desc)||E.code,errorMsg:E.message,addr:this.signal.url,uid:n.uid,cid:n.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!p,signalChannel:"0",preload:n.preload}),u.delete(n.uid),this.signal.close(),E}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),k.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(E=>{k.warning("[".concat(this.store.clientId,"] get traffic stats error"),E.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(ji.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(ji.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(ji.NETWORK_QUALITY,{uplinkNetworkQuality:wz(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:wz(this._statsCollector.trafficStats.B_dnq)}):this.emit(ji.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),h}async leave(){let n=arguments.length>0&&arguments[0]!==void 0&&arguments[0],i=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){i!==Mn.FALLBACK&&(this.state="DISCONNECTING");try{n||this.signal.connectionState!==ir.CONNECTED||await function(s,c){return c===1/0?s:Qe.race([s,wde(c)])}(this.signal.request(kt.LEAVE,void 0,!0),3e3)}catch(s){k.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),s)}this.signal.close(i),i!==Mn.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(n,i,s){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new be(Y.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const c={state:"offer",p2p_id:this.store.p2pId,ortc:i,mode:this.spec.mode,extend:Z("PUB_EXTEND"),twcc:!!Z("PUBLISH_TWCC"),rtx:!!Z("USE_PUB_RTX")};try{return(await this.signal.request(kt.PUBLISH,c,!0))._message}catch(u){if(s&&u.data&&u.data.code===It.ERR_PUBLISH_REQUEST_INVALID)return k.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),u.toString()),await this.tryUnpubBeforeRepub(n,i),this.publish(n,i,!1);throw u}}async publishDataChannel(n,i,s){var c;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new be(Y.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const u={stream_id:i.streamId,ordered:i.ordered?1:0,max_retrans_times:(c=i.maxRetransmits)!==null&&c!==void 0?c:10,channel_id:i.channelId,metadata:i.metadata};try{await this.signal.request(kt.PUBLISH_DATASTREAM,u,!0)}catch(h){if(s&&h.data&&h.data.code===It.ERR_PUBLISH_REQUEST_INVALID)return k.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),h.toString()),await this.tryUnpubDataChannelBeforeRepub(n,i),this.publishDataChannel(n,i,!1);throw h}}async unpublish(n,i){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new be(Y.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(kt.UNPUBLISH,{stream_id:i,ortc:n},!0)}catch(s){k.warning("[".concat(this.store.clientId,"] unpublish warning: "),s)}}async unpublishDataChannel(n){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new be(Y.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await Qe.all(n.map(i=>this.signal.request(kt.UNPUBLISH_DATASTREAM,{channel_id:i},!0)))}catch(i){k.warning("unpublish datachannels warning: ",i)}}async presubscribe(n,i,s){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new be(Y.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const c={stream_id:n,stream_type:i,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!Z("SUBSCRIBE_TWCC"),rtx:!!Z("USE_SUB_RTX")||void 0,extend:Z("SUB_EXTEND"),svc:Array.isArray(Z("SVC"))&&Z("SVC").length!==0?Z("SVC"):void 0};try{return await this.signal.request(kt.PRE_SUBSCRIBE,c,!0)}catch(u){if(s&&u.data&&u.data.code===It.ERR_SUBSCRIBE_REQUEST_INVALID)return k.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),u.toString()),this.presubscribe(n,i,!1);throw u}}async subscribe(n,i,s){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new be(Y.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const c={stream_id:n,stream_type:i.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!Z("SUBSCRIBE_TWCC"),rtx:!!Z("USE_SUB_RTX"),extend:Z("SUB_EXTEND"),ssrcId:i.ssrcId,svc:Array.isArray(Z("SVC"))&&Z("SVC").length!==0?Z("SVC"):void 0};try{return(await this.signal.request(kt.SUBSCRIBE,c,!0))._message}catch(u){if(s&&u.data&&u.data.code===It.ERR_SUBSCRIBE_REQUEST_INVALID)return k.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),u.toString()),await this.tryUnsubBeforeResub(n,i),await this.subscribe(n,i,!1);throw u}}async subscribeDataChannel(n,i,s){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new be(Y.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const c={uid:n,stream_id:i.id,channel_id:i.datachannelId};try{return void await this.signal.request(kt.SUBSCRIBE_DATASTREAM,c,!0)}catch(u){if(s&&u.data&&u.data.code===It.ERR_SUBSCRIBE_REQUEST_INVALID)return k.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),u.toString()),await this.tryUnsubDataChannelBeforeResub(n,i),await this.subscribeDataChannel(n,i,!1);throw u}}async subscribeAll(n,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new be(Y.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const s={p2p_id:this.store.p2pId,users:n,dtx:!1,rtx:!!Z("USE_SUB_RTX"),twcc:!!Z("SUBSCRIBE_TWCC"),svc:Array.isArray(Z("SVC"))&&Z("SVC").length!==0?Z("SVC"):void 0};try{return await this.signal.request(kt.SUBSCRIBE_STREAMS,s,!0)}catch(c){if(i&&c.data&&c.data.code===It.ERR_SUBSCRIBE_REQUEST_INVALID)return k.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),c.toString()),await this.tryMassUnsubBeforeResub(n),await this.subscribeAll(n,!1);throw c}}async setVideoProfile(n){const i=function(s){if(!(s.bitrateMax&&s.bitrateMin&&s.frameRate&&s.height&&s.width))return;let c=s.frameRate,u=s.width,h=s.height,p=!0;return typeof c!="number"&&(c=c.exact||c.ideal||c.max||c.min||0,c||(p=!1)),typeof u!="number"&&(u=u.exact||u.ideal||u.max||u.min||0,u||(p=!1)),typeof h!="number"&&(h=h.exact||h.ideal||h.max||h.min||0,c||(p=!1)),p?{stream_type:0,width:u,height:h,fps:c,start_bps:1e3*s.bitrateMax,min_bps:1e3*s.bitrateMin,target_bps:1e3*s.bitrateMax}:void 0}(n);if(i)return this.signal.request(kt.SET_VIDEO_PROFILE,i);k.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(n,i){try{await this.signal.request(kt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:n,stream_id:i},!0)}catch(s){k.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),s)}}async unsubscribeDataChannel(n,i){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new be(Y.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await Qe.all(n.map(s=>this.signal.request(kt.UNSUBSCRIBE_DATASTREAM,{stream_id:s,uid:i},!0)))}catch(s){k.warning("unsubscribeDataChannel warning: ",s)}}async massUnsubscribe(n){try{await this.signal.request(kt.UNSUBSCRIBE_STREAMS,n,!0)}catch(i){k.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),i)}}async reconnectPC(n){const{iceParameters:i,dtlsParameters:s,rtpCapabilities:c}=n;return{gatewayEstablishParams:await this.signal.request(kt.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:i,dtlsParameters:s,rtpCapabilities:c}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(kt.GATEWAY_INFO)}async renewToken(n){await this.signal.request(kt.RENEW_TOKEN,n),this.key=n.token}updateClientRole(n,i){i&&(this._clientRoleOptions=Object.assign({},i)),Z("CLIENT_ROLE_OPTIONS")&&(k.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(Z("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},Z("CLIENT_ROLE_OPTIONS"))),this.role=n}async setClientRole(n,i){if(i&&(this._clientRoleOptions=Object.assign({},i)),Z("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},Z("CLIENT_ROLE_OPTIONS")),k.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(Z("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),this.state!=="CONNECTED")return void(this.role=n);let s,c=0;n==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(s=this._clientRoleOptions.delay,c=1):c=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:c=0,await this.signal.request(kt.SET_CLIENT_ROLE,{role:n,level:c,delay:s,client_ts:Date.now()}),this.role=n}async setRemoteVideoStreamType(n,i){await this.signal.request(kt.SWITCH_VIDEO_STREAM,{stream_id:n,stream_type:i})}async setDefaultRemoteVideoStreamType(n){await this.signal.request(kt.DEFAULT_VIDEO_STREAM,{stream_type:n})}async setStreamFallbackOption(n,i){await this.signal.request(kt.SET_FALLBACK_OPTION,{stream_id:n,fallback_type:i})}async pickSVCLayer(n,i){await this.signal.request(kt.PICK_SVC_LAYER,{stream_id:n,spatial_layer:i.spatialLayer,temporal_layer:i.temporalLayer})}async setRTM2Flag(n){await this.signal.request(kt.SET_RTM2_FLAG,{rtm2_flag:n})}async sendExtensionMessage(n,i,s){if(this.store.useP2P)return this.signal.sendExtensionMessage(n,i,s)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),yf({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(kt.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const n=FL.get(this.joinInfo.cname);n&&n.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const n=function(i){let s;return s=i.startsWith("dc")?i.match(/(dc\:\/\/)?([^:]+):(\d+)/):i.match(/(wss\:\/\/)?([^:]+):(\d+)/),s?{username:fo.username,password:fo.password,turnServerURL:s[2],tcpport:parseInt(s[3])+30,udpport:parseInt(s[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],n&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(yf(yf({},fo),{},{turnServerURL:n.turnServerURL,tcpport:n.tcpport,udpport:n.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const n=await this.signal.request(kt.TRAFFIC_STATS,void 0,!0);n.timestamp=Date.now(),n.ntp_offset!=null&&(this.ntpOffset=n.ntp_offset),n.peer_delay.forEach(i=>{const s=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(c=>c.peer_uid===i.peer_uid);s&&s.B_st!==i.B_st&&WI(()=>{this.emit(ji.STREAM_TYPE_CHANGE,i.peer_uid,i.B_st)})}),this._statsCollector.updateTrafficStats(n)}getJoinMessage(n){if(!this.joinInfo||!this.key)throw new be(Y.UNEXPECTED_ERROR,"can not generate join message, no join info");const i=Object.assign({},this.joinInfo.apResponse);let s=Z("REPORT_APP_SCENARIO");if(typeof s!="string")try{s=JSON.stringify(s)}catch{s=void 0}var c;s&&s.length>128&&(s=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(ji.UPDATE_GATEWAY_CONFIG),c=this.store.clientId,$e(qE).call(qE,c)||qE.push(c);const u=!(Nr()||c6(87)||J6())&&typeof Z("ENABLE_PRE_SUB")=="boolean"&&Z("ENABLE_PRE_SUB"),h=!J6()&&il("ENABLE_PREALLOC_PC","boolean"),p=Qhe(),_=a0(87)||function(){const S=vn();if(S.name!==Nn.SAFARI||!S.browserVersion)return!1;const w=S.browserVersion.split(".");return Number(w[0])>15||Number(w[0])===15&&Number(w[1])>=4}(),E=yf({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:el,browser:navigator.userAgent,process_id:Z("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:i,extend:Z("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:s,attributes:{userAttributes:yf({enableEncodedTransform:!!Z("ENABLE_AUDIO_METADATA")&&_||!!Z("ENABLE_AUDIO_TOPN")&&k1(Nn.CHROME,87,116)||void 0,enableAudioMetadata:!!Z("ENABLE_AUDIO_METADATA")&&_,enableAudioPts:!!Z("ENABLE_AUDIO_PTS_METADATA")&&_,topnSmoothLevel:Z("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:Z("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:Z("TOPN_SWITCH_HOLD_MS"),topnAudioGain:Z("TOPN_AUDIO_GAIN"),enablePublishedUserList:Z("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:Z("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:il("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:il("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:il("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:Z("USE_PUB_RTX")===!0||Z("USE_SUB_RTX")===!0||void 0,disableFEC:Z("DISABLE_FEC"),enableNTPReport:!!Z("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:!!Z("ENABLE_INSTANT_VIDEO")||void 0,enableFulllinkAvSync:!!Z("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:il("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!Z("ENABLE_AUT_FEEDBACK")||void 0,rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!Z("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:il("USE_XR","boolean"),enableLossbasedBwe:il("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!Z("ENABLE_AUT_CC")||void 0,enableCCFallback:il("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:h,preSubNum:u?il("PRE_SUB_NUM","number"):void 0,enablePubTWCC:il("PUBLISH_TWCC","boolean"),enableSubTWCC:il("SUBSCRIBE_TWCC","boolean"),enablePubRTX:il("USE_PUB_RTX","boolean"),enableSubRTX:il("USE_SUB_RTX","boolean"),enableSubSVC:Z("ENABLE_SVC")?Z("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(Z("SVC"))&&Z("SVC").length!==0?Z("SVC"):void 0,enableSvcExtended:Z("ENABLE_SVC")&&Array.isArray(Z("SVC_EXTENDED"))&&Z("SVC_EXTENDED").length!==0?Z("SVC_EXTENDED"):void 0},p)},join_ts:this.joinGatewayStartTime},n);return this.joinInfo.stringUid&&(E.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(E.aes_mode=this.joinInfo.aesmode,Z("ENCRYPT_AES")?(E.aes_secret=this.joinInfo.aespassword,E.aes_encrypt=!0):E.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(E.aes_salt=this.joinInfo.aessalt)),i.addresses[this.signal.websocket.currentURLIndex]&&(E.ap_response.ticket=i.addresses[this.signal.websocket.currentURLIndex].ticket,delete i.addresses),this.joinInfo.defaultVideoStream!==void 0&&(E.default_video_stream=this.joinInfo.defaultVideoStream),E}getRejoinMessage(){if(!this.joinInfo)throw new be(Y.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(xt.WS_RECONNECT_CREATE_CONNECTION,n=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(xt.WS_RECONNECTING,n=>{this.joinInfo&&pt.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:n||uo.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",pt.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(xt.WS_CLOSED,n=>{let i;switch(n){case Mn.LEAVE:i=uo.LEAVE;break;case Mn.UID_BANNED:case Mn.IP_BANNED:case Mn.CHANNEL_BANNED:case Mn.SERVER_ERROR:i=uo.SERVER_ERROR;break;case Mn.FALLBACK:i=uo.FALLBACK;break;case Mn.LICENSE_MISSING:case Mn.LICENSE_EXPIRED:case Mn.LICENSE_MINUTES_EXCEEDED:case Mn.LICENSE_PERIOD_INVALID:case Mn.LICENSE_MULTIPLE_SDK_SERVICE:case Mn.LICENSE_ILLEGAL:case Mn.TOKEN_EXPIRE:i=n;break;default:i=uo.NETWORK_ERROR}k.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(i||"undefined -> "+uo.NETWORK_ERROR)),this.joinInfo&&pt.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:n===Mn.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:i}),this._disconnectedReason=n,n!==Mn.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(xt.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if(this.role==="audience"){const n=Z("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;n&&(n.level||n.delay)&&(k.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(n.level,", delay: ").concat(n.delay)),this.setClientRole(this.role,n))}if(pt.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1){const n=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!n)return void k.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(n));Kn("EVENT_REPORT_DOMAIN",n[1]),Kn("EVENT_REPORT_BACKUP_DOMAIN",n[1]),Kn("LOG_UPLOAD_SERVER","".concat(n[1],":6444"))}}}),this.signal.on(an.ON_UPLINK_STATS,n=>{this._statsCollector.updateUplinkStats(n)}),this.signal.on(xt.REQUEST_RECOVER,(n,i,s)=>{if(!this.joinInfo)return s(new be(Y.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));n&&(this.joinInfo.multiIP=n,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,ho(this,ji.REQUEST_NEW_GATEWAY_LIST).then(i).catch(s)}),this.signal.on(xt.REQUEST_JOIN_INFO,async(n,i,s)=>{var c;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void n(this.getJoinMessage({ortc:{}}));const u=Lr((c=this.joinInfo)===null||c===void 0?void 0:c.turnServer);if(Z("NEW_TURN_MODE")&&u){let E=u.servers,S=u.serversFromGateway;const w=this.signal.currentURLIndex;E.length>0&&(E=[E[w%E.length]],u.servers=E),Array.isArray(S)&&S.length>0&&(S=[S[0]],u.serversFromGateway=S),k.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(w))}const{iceParameters:h,dtlsParameters:p,rtpCapabilities:_}=await ho(this,ji.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:u});try{n(this.getJoinMessage({ortc:{iceParameters:h,dtlsParameters:p,rtpCapabilities:_,version:"2"}}))}catch(E){i(E)}}),this.signal.on(xt.REQUEST_REJOIN_INFO,n=>{n(this.getRejoinMessage())}),this.signal.on(xt.REPORT_JOIN_GATEWAY,(n,i)=>{if(!this.joinInfo)return;let s,c="";var u;n instanceof be?(s=((u=n.data)===null||u===void 0?void 0:u.desc)||n.code,c=n.message):s=n,pt.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:s,errorMsg:c,addr:i,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload})}),this.signal.on(xt.IS_P2P_DISCONNECTED,n=>{n(h0(this,ji.IS_P2P_DISCONNECTED))}),this.signal.on(xt.DISCONNECT_P2P,()=>{this.emit(ji.DISCONNECT_P2P)}),this.signal.on(xt.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(xt.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(xt.JOIN_RESPONSE,n=>{const i=this.getCurrentGatewayAddress();this.emit(ji.JOIN_RESPONSE,n,i)}),this.signal.on(xt.PRE_CONNECT_PC,async()=>{if(this.joinInfo){this.updateTurnConfigFromSignal();const n=this.getCurrentGatewayAddress(),i=Z("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(n&&i){const s=kz(n);this.emit(ji.PRE_CONNECT_PC,{candidates:s,fingerprint:i})}}}),this.signal.on(xt.RECOVER_NOTIFICATION,n=>{this.joinInfo&&typeof Z("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat(Z("AP_REQUEST_DETAIL"),";").concat(n))})}async tryUnsubBeforeResub(n,i){try{await this.signal.request(kt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:n,ortc:[i]},!0)}catch(s){throw k.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),s),s}}async tryUnsubDataChannelBeforeResub(n,i){try{await this.signal.request(kt.UNSUBSCRIBE,{stream_id:i.id},!0)}catch(s){throw k.warning("unsubscribe datachannel warning",s),s}}async tryUnpubBeforeRepub(n,i){try{await this.signal.request(kt.UNPUBLISH,{stream_id:n,ortc:i},!0)}catch(s){throw k.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),s),s}}async tryUnpubDataChannelBeforeRepub(n,i){try{await this.signal.request(kt.UNPUBLISH_DATASTREAM,{channnel_id:i.channelId},!0)}catch(s){throw k.warning("unpublish datastream warning: ",s),s}}async tryMassUnsubBeforeResub(n){const i={users:n.map(s=>({stream_id:s.stream_id,stream_type:s.stream_type}))};try{await this.signal.request(kt.UNSUBSCRIBE_STREAMS,i,!0)}catch(s){throw k.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),s),s}}async muteLocal(n,i){const s={action:n.find(c=>c.stream_type===Bn.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:n,stream_id:i};try{await this.signal.request(kt.CONTROL,s,!0,!0)}catch(c){throw k.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),c),c}}async unmuteLocal(n,i){const s={action:n.find(c=>c.stream_type===Bn.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:n,stream_id:i};try{await this.signal.request(kt.CONTROL,s,!0,!0)}catch(c){throw k.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),c),c}}async muteRemote(n,i){const s={action:n===ot.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:i};try{await this.signal.request(kt.CONTROL,s,!0,!0)}catch(c){throw k.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),c),c}}async unmuteRemote(n,i){const s={action:n===ot.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:i};try{await this.signal.request(kt.CONTROL,s,!0,!0)}catch(c){throw k.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),c),c}}uploadWRTCStats(n){this.signal.uploadWRTCStats(n)}upload(n,i){this.signal.upload(n,i)}getSignalRTT(){return this.signal.rtt}async restartICE(n){const i={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:n};try{return await this.signal.request(kt.RESTART_ICE,i,!0)}catch(s){throw k.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),s),s}}reconnect(n,i){this.state==="CONNECTED"&&this.signal.reconnect(n||void 0,i||uo.P2P_FAILED)}getCurrentGatewayAddress(){var n,i;if(!Z("GATEWAY_WSS_ADDRESS"))return Z("USE_CANDIDATE_FROM_AP_DETAIL")&&(n=this.joinInfo)!==null&&n!==void 0&&n.apGatewayAddress?(k.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(i=this.joinInfo)!==null&&i!==void 0&&i.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(n){await this.signal.request(kt.SET_PARAMETER,{enablePublishAudioFilter:n})}}let bA=0,jL=0;function Ku(e,n,i,s){return new Qe((c,u)=>{n.timeout=n.timeout||Z("HTTP_CONNECT_TIMEOUT"),n.responseType=n.responseType||"json",n.data&&!i?(n.data=JSON.stringify(n.data),bA+=Ud(n.data)):i&&(n.data.size?bA+=n.data.size:n.data instanceof FormData?bA+=C6(n.data):bA+=Ud(JSON.stringify(n.data))),n.headers=n.headers||{},n.headers["Content-Type"]=n.headers["Content-Type"]||"application/json",n.method="POST",n.url=e,Ls.request(n).then(h=>{typeof h.data=="string"?jL+=Ud(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?jL+=h.data.byteLength:jL+=Ud(JSON.stringify(h.data)),s&&c({data:h.data,headers:h.headers}),c(h.data)}).catch(h=>{Ls.isCancel(h)?u(new be(Y.OPERATION_ABORTED,"cancel token canceled")):h.code==="ECONNABORTED"?u(new be(Y.NETWORK_TIMEOUT,h.message)):h.response?u(new be(Y.NETWORK_RESPONSE_ERROR,h.response.status)):u(new be(Y.NETWORK_ERROR,h.message))})})}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var e;function n(Pe){var He=0;return function(){return He<Pe.length?{done:!1,value:Pe[He++]}:{done:!0}}}var i=typeof Object.defineProperties=="function"?Object.defineProperty:function(Pe,He,dt){return Pe==Array.prototype||Pe==Object.prototype||(Pe[He]=dt.value),Pe},s,c=function(Pe){Pe=[typeof globalThis=="object"&&globalThis,Pe,typeof window=="object"&&window,typeof self=="object"&&self,typeof a=="object"&&a];for(var He=0;He<Pe.length;++He){var dt=Pe[He];if(dt&&dt.Math==Math)return dt}throw Error("Cannot find global object")}(this);function u(Pe,He){if(He)e:{var dt=c;Pe=Pe.split(".");for(var ke=0;ke<Pe.length-1;ke++){var L=Pe[ke];if(!(L in dt))break e;dt=dt[L]}(He=He(ke=dt[Pe=Pe[Pe.length-1]]))!=ke&&He!=null&&i(dt,Pe,{configurable:!0,writable:!0,value:He})}}function h(Pe){return(Pe={next:Pe})[Symbol.iterator]=function(){return this},Pe}function p(Pe){var He=typeof Symbol<"u"&&Symbol.iterator&&Pe[Symbol.iterator];return He?He.call(Pe):{next:n(Pe)}}if(u("Symbol",function(Pe){function He(L,ee){this.A=L,i(this,"description",{configurable:!0,writable:!0,value:ee})}if(Pe)return Pe;He.prototype.toString=function(){return this.A};var dt="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",ke=0;return function L(ee){if(this instanceof L)throw new TypeError("Symbol is not a constructor");return new He(dt+(ee||"")+"_"+ke++,ee)}}),u("Symbol.iterator",function(Pe){if(Pe)return Pe;Pe=Symbol("Symbol.iterator");for(var He="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),dt=0;dt<He.length;dt++){var ke=c[He[dt]];typeof ke=="function"&&typeof ke.prototype[Pe]!="function"&&i(ke.prototype,Pe,{configurable:!0,writable:!0,value:function(){return h(n(this))}})}return Pe}),typeof Object.setPrototypeOf=="function")s=Object.setPrototypeOf;else{var _;e:{var E={};try{E.__proto__={a:!0},_=E.a;break e}catch{}_=!1}s=_?function(Pe,He){if(Pe.__proto__=He,Pe.__proto__!==He)throw new TypeError(Pe+" is not extensible");return Pe}:null}var S=s;function w(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function I(Pe){if(Pe.m)throw new TypeError("Generator is already running");Pe.m=!0}function P(Pe,He){return Pe.h=3,{value:He}}function B(Pe){this.g=new w,this.G=Pe}function M(Pe,He,dt,ke){try{var L=He.call(Pe.g.j,dt);if(!(L instanceof Object))throw new TypeError("Iterator result "+L+" is not an object");if(!L.done)return Pe.g.m=!1,L;var ee=L.value}catch(ue){return Pe.g.j=null,Pe.g.s(ue),U(Pe)}return Pe.g.j=null,ke.call(Pe.g,ee),U(Pe)}function U(Pe){for(;Pe.g.h;)try{var He=Pe.G(Pe.g);if(He)return Pe.g.m=!1,{value:He.value,done:!1}}catch(dt){Pe.g.v=void 0,Pe.g.s(dt)}if(Pe.g.m=!1,Pe.g.l){if(He=Pe.g.l,Pe.g.l=null,He.F)throw He.D;return{value:He.return,done:!0}}return{value:void 0,done:!0}}function $(Pe){this.next=function(He){return Pe.o(He)},this.throw=function(He){return Pe.s(He)},this.return=function(He){return function(dt,ke){I(dt.g);var L=dt.g.j;return L?M(dt,"return"in L?L.return:function(ee){return{value:ee,done:!0}},ke,dt.g.return):(dt.g.return(ke),U(dt))}(Pe,He)},this[Symbol.iterator]=function(){return this}}function q(Pe,He){return He=new $(new B(He)),S&&Pe.prototype&&S(He,Pe.prototype),He}if(w.prototype.o=function(Pe){this.v=Pe},w.prototype.s=function(Pe){this.l={D:Pe,F:!0},this.h=this.C||this.u},w.prototype.return=function(Pe){this.l={return:Pe},this.h=this.u},B.prototype.o=function(Pe){return I(this.g),this.g.j?M(this,this.g.j.next,Pe,this.g.o):(this.g.o(Pe),U(this))},B.prototype.s=function(Pe){return I(this.g),this.g.j?M(this,this.g.j.throw,Pe,this.g.o):(this.g.s(Pe),U(this))},u("Array.prototype.entries",function(Pe){return Pe||function(){return function(He,dt){He instanceof String&&(He+="");var ke=0,L=!1,ee={next:function(){if(!L&&ke<He.length){var ue=ke++;return{value:dt(ue,He[ue]),done:!1}}return L=!0,{done:!0,value:void 0}}};return ee[Symbol.iterator]=function(){return ee},ee}(this,function(He,dt){return[He,dt]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var ce=function(Pe,He){for(var dt=0;dt<Pe.length;dt++)He(Pe[dt])},me=function(Pe){return Pe.replace(/\r?\n|\r/g,`\r
`)},ge=function(Pe,He,dt){return He instanceof Blob?(dt=dt!==void 0?dt+"":typeof He.name=="string"?He.name:"blob",He.name===dt&&Object.prototype.toString.call(He)!=="[object Blob]"||(He=new File([He],dt)),[String(Pe),He]):[String(Pe),String(He)]},pe=function(Pe,He){if(Pe.length<He)throw new TypeError(He+" argument required, but only "+Pe.length+" present.")},Re=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,Ve=Re.FormData,Ze=Re.XMLHttpRequest&&Re.XMLHttpRequest.prototype.send,rt=Re.Request&&Re.fetch,un=Re.navigator&&Re.navigator.sendBeacon,dn=Re.Element&&Re.Element.prototype,nr=Re.Symbol&&Symbol.toStringTag;nr&&(Blob.prototype[nr]||(Blob.prototype[nr]="Blob"),"File"in Re&&!File.prototype[nr]&&(File.prototype[nr]="File"));try{new File([],"")}catch{Re.File=function(He,dt,ke){return He=new Blob(He,ke||{}),Object.defineProperties(He,{name:{value:dt},lastModified:{value:+(ke&&ke.lastModified!==void 0?new Date(ke.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),nr&&Object.defineProperty(He,nr,{value:"File"}),He}}var Qr=function(Pe){return Pe.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},jr=function(Pe){this.i=[];var He=this;Pe&&ce(Pe.elements,function(dt){if(dt.name&&!dt.disabled&&dt.type!=="submit"&&dt.type!=="button"&&!dt.matches("form fieldset[disabled] *"))if(dt.type==="file"){var ke=dt.files&&dt.files.length?dt.files:[new File([],"",{type:"application/octet-stream"})];ce(ke,function(L){He.append(dt.name,L)})}else dt.type==="select-multiple"||dt.type==="select-one"?ce(dt.options,function(L){!L.disabled&&L.selected&&He.append(dt.name,L.value)}):dt.type==="checkbox"||dt.type==="radio"?dt.checked&&He.append(dt.name,dt.value):(ke=dt.type==="textarea"?me(dt.value):dt.value,He.append(dt.name,ke))})};if((e=jr.prototype).append=function(Pe,He,dt){pe(arguments,2),this.i.push(ge(Pe,He,dt))},e.delete=function(Pe){pe(arguments,1);var He=[];Pe=String(Pe),ce(this.i,function(dt){dt[0]!==Pe&&He.push(dt)}),this.i=He},e.entries=function Pe(){var He,dt=this;return q(Pe,function(ke){if(ke.h==1&&(He=0),ke.h!=3)return He<dt.i.length?ke=P(ke,dt.i[He]):(ke.h=0,ke=void 0),ke;He++,ke.h=2})},e.forEach=function(Pe,He){pe(arguments,1);for(var dt=p(this),ke=dt.next();!ke.done;ke=dt.next()){var L=p(ke.value);ke=L.next().value,L=L.next().value,Pe.call(He,L,ke,this)}},e.get=function(Pe){pe(arguments,1);var He=this.i;Pe=String(Pe);for(var dt=0;dt<He.length;dt++)if(He[dt][0]===Pe)return He[dt][1];return null},e.getAll=function(Pe){pe(arguments,1);var He=[];return Pe=String(Pe),ce(this.i,function(dt){dt[0]===Pe&&He.push(dt[1])}),He},e.has=function(Pe){pe(arguments,1),Pe=String(Pe);for(var He=0;He<this.i.length;He++)if(this.i[He][0]===Pe)return!0;return!1},e.keys=function Pe(){var He,dt,ke,L,ee=this;return q(Pe,function(ue){if(ue.h==1&&(He=p(ee),dt=He.next()),ue.h!=3)return dt.done?void(ue.h=0):(ke=dt.value,L=p(ke),P(ue,L.next().value));dt=He.next(),ue.h=2})},e.set=function(Pe,He,dt){pe(arguments,2),Pe=String(Pe);var ke=[],L=ge(Pe,He,dt),ee=!0;ce(this.i,function(ue){ue[0]===Pe?ee&&(ee=!ke.push(L)):ke.push(ue)}),ee&&ke.push(L),this.i=ke},e.values=function Pe(){var He,dt,ke,L,ee=this;return q(Pe,function(ue){if(ue.h==1&&(He=p(ee),dt=He.next()),ue.h!=3)return dt.done?void(ue.h=0):(ke=dt.value,(L=p(ke)).next(),P(ue,L.next().value));dt=He.next(),ue.h=2})},jr.prototype._asNative=function(){for(var Pe=new Ve,He=p(this),dt=He.next();!dt.done;dt=He.next()){var ke=p(dt.value);dt=ke.next().value,ke=ke.next().value,Pe.append(dt,ke)}return Pe},jr.prototype._blob=function(){var Pe="----formdata-polyfill-"+Math.random(),He=[],dt="--"+Pe+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(ke,L){return typeof ke=="string"?He.push(dt+Qr(me(L))+`"\r
\r
`+me(ke)+`\r
`):He.push(dt+Qr(me(L))+'"; filename="'+Qr(ke.name)+`"\r
Content-Type: `+(ke.type||"application/octet-stream")+`\r
\r
`,ke,`\r
`)}),He.push("--"+Pe+"--"),new Blob(He,{type:"multipart/form-data; boundary="+Pe})},jr.prototype[Symbol.iterator]=function(){return this.entries()},jr.prototype.toString=function(){return"[object FormData]"},dn&&!dn.matches&&(dn.matches=dn.matchesSelector||dn.mozMatchesSelector||dn.msMatchesSelector||dn.oMatchesSelector||dn.webkitMatchesSelector||function(Pe){for(var He=(Pe=(this.document||this.ownerDocument).querySelectorAll(Pe)).length;0<=--He&&Pe.item(He)!==this;);return-1<He}),nr&&(jr.prototype[nr]="FormData"),Ze){var js=Re.XMLHttpRequest.prototype.setRequestHeader;Re.XMLHttpRequest.prototype.setRequestHeader=function(Pe,He){js.call(this,Pe,He),Pe.toLowerCase()==="content-type"&&(this.B=!0)},Re.XMLHttpRequest.prototype.send=function(Pe){Pe instanceof jr?(Pe=Pe._blob(),this.B||this.setRequestHeader("Content-Type",Pe.type),Ze.call(this,Pe)):Ze.call(this,Pe)}}rt&&(Re.fetch=function(Pe,He){return He&&He.body&&He.body instanceof jr&&(He.body=He.body._blob()),rt.call(this,Pe,He)}),un&&(Re.navigator.sendBeacon=function(Pe,He){return He instanceof jr&&(He=He._asNative()),un.call(this,Pe,He)}),Re.FormData=jr}})();const I0=()=>{const e=Z("AREAS");return e.length===0&&e.push(kn.GLOBAL),ka(e).call(e,(n,i,s)=>{const c=Hz(i);return c?s===0?c:"".concat(n,",").concat(c):n},"")},Hz=e=>e===kn.OVERSEA?"".concat(bo.ASIA,",").concat(bo.EUROPE,",").concat(bo.AFRICA,",").concat(bo.NORTH_AMERICA,",").concat(bo.SOUTH_AMERICA,",").concat(bo.OCEANIA):bo[e],efe=e=>{const n={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return e.map(i=>{const s=mA[i],c=Object.keys(s);c&&c.map(u=>{u!=="CODE"&&(n[u]=n[u].concat(s[u]))})}),n},wA={GLOBAL:{ASIA:[kn.CHINA,kn.JAPAN,kn.INDIA,kn.KOREA,kn.HKMC],EUROPE:[],NORTH_AMERICA:[kn.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},RA=Object.keys(wA[kn.GLOBAL]),BL=[kn.CHINA,kn.NORTH_AMERICA,kn.EUROPE,kn.ASIA,kn.JAPAN,kn.INDIA,kn.OCEANIA,kn.SOUTH_AMERICA,kn.AFRICA,kn.KOREA,kn.HKMC,kn.US],tfe=function(e,n){let i=[];if($e(e).call(e,kn.GLOBAL)){const u=[kn.GLOBAL,kn.OVERSEA],h=Object.keys(mA);if(n===kn.GLOBAL)throw new be(Y.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(n===kn.CHINA)i=[kn.OVERSEA];else if(c=n,$e(RA).call(RA,c)){const p=(s=n,wA[kn.GLOBAL][s]||[]),_=[...u,n,...p];i=h.filter(E=>!$e(_).call(_,E))}else if(function(p){let _=!1;return RA.forEach(E=>{var S;$e(S=wA[kn.GLOBAL][E]).call(S,p)&&(_=!0)}),_}(n)){const p=function(E){let S;return RA.forEach(w=>{var I;$e(I=wA[kn.GLOBAL][w]).call(I,E)&&(S=w)}),S}(n),_=[...u,p,n];i=h.filter(E=>!$e(_).call(_,E))}else i=e;i=function(p){const _=[];return BL.forEach(E=>{$e(p).call(p,E)&&_.push(E)}),_.concat(p.filter(E=>!$e(BL).call(BL,E)))}(i)}else i=e;var s,c;return i};function Kz(e){var n,i;if(!e&&$e(n=Z("AREAS")).call(n,kn.EXTENSIONS))return k.debug("update area from ap : reset"),void WL(uhe,!0);if(!$e(i=Z("AREAS")).call(i,kn.GLOBAL)||!e)return;let s=mA.EXTENSIONS;s&&(s={CODE:Hz(kn.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e,".agora.io"),"cds-ap-web-2-".concat(e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e,".agora.io"),"sua-ap-web-2-".concat(e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e,".agora.io"),"uap-ap-web-2-".concat(e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e,".agora.io")]},k.debug("update area from ap success: ".concat(e,",config is "),s),Kn("AREAS",[kn.EXTENSIONS],!0),Object.keys(s).map(c=>{c==="LOG_UPLOAD_SERVER"||c==="EVENT_REPORT_DOMAIN"||c==="EVENT_REPORT_BACKUP_DOMAIN"||c==="PROXY_SERVER_TYPE3"?Kn(c,s[c][0]):Kn(c,s[c])}))}function WL(e){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const i=pt.reportApiInvoke(null,{name:fi.SET_AREA,options:e,tag:Dr.TRACER});try{let s=[];if(typeof e=="string"&&(s=[e]),Array.isArray(e)&&(e.forEach(u=>{if(!$e(hz).call(hz,u))throw new be(Y.INVALID_PARAMS,"invalid area code")}),s=e),Object.prototype.toString.call(e)==="[object Object]"){const{areaCode:u,excludedArea:h}=e;if(!u)throw new be(Y.INVALID_PARAMS,"area code is needed");let p=u;typeof u=="string"&&(p=[u]),s=h?tfe(p,h):p}if(!n){if(Wu.AREAS){const u=new be(Y.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return i.onError(u),void k.warning("setArea is prohibited because of config-distribute")}if($e(s).call(s,kn.GLOBAL)&&Z("AREAS")===kn.EXTENSIONS){const u=new be(Y.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return i.onError(u),void k.warning("setArea is prohibited because of ap extensions")}}Kn("AREAS",s,n);const c=efe(s);Object.keys(c).map(u=>{u==="LOG_UPLOAD_SERVER"||u==="EVENT_REPORT_DOMAIN"||u==="EVENT_REPORT_BACKUP_DOMAIN"||u==="PROXY_SERVER_TYPE3"?Kn(u,c[u][0]):Kn(u,c[u])}),k.debug("set area success:",s.join(","))}catch(s){throw i.onError(s),s}i.onSuccess()}function $z(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,s)}return i}function Gd(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?$z(Object(i),!0).forEach(function(s){K(e,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):$z(Object(i)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(i,s))})}return e}let GL=1;function nfe(e,n,i,s,c){GL+=1;const u={sid:i.sid,command:"convergeAllocateEdge",uid:"666",appId:i.appId,ts:Math.floor(Date.now()/1e3),seq:GL,requestId:GL,version:el,cname:i.cname},h={service_name:n,json_body:JSON.stringify(u)};let p,_,E=e[0];return Bu(async()=>{p=Date.now();const S=await Ku(E,{data:h,cancelToken:s,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(_=Date.now()-p,S.code!==0){const P=new be(Y.UNEXPECTED_RESPONSE,"live streaming ap error, code"+S.code,{retry:!0,responseTime:_});throw k.error(P.toString()),P}const w=JSON.parse(S.json_body);if(w.code!==200){const P=new be(Y.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(w.code,", reason: ").concat(w.reason),{code:w.code,responseTime:_});throw k.error(P.toString()),P}if(!w.servers||w.servers.length===0){const P=new be(Y.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:w.code,responseTime:_});throw k.error(P.toString()),P}const I=function(P,B){return{addressList:P.servers.map(M=>"wss://".concat(M.address.replace(/\./g,"-"),".").concat(Z("WORKER_DOMAIN"),":").concat(M.wss,"?serviceName=").concat(encodeURIComponent(B))),workerToken:P.workerToken,vid:P.vid}}(w,n);return Z("LIVE_STREAMING_ADDRESS")&&(I.addressList=Z("LIVE_STREAMING_ADDRESS")instanceof Array?Z("LIVE_STREAMING_ADDRESS"):[Z("LIVE_STREAMING_ADDRESS")]),Gd(Gd({},I),{},{responseTime:_})},(S,w)=>(pt.apworkerEvent(i.sid,{success:!0,sc:200,serviceName:n,responseDetail:JSON.stringify(S.addressList),firstSuccess:w===0,responseTime:_,serverIp:e[w%e.length]}),!1),(S,w)=>(pt.apworkerEvent(i.sid,{success:!1,sc:S.data&&S.data.code||200,serviceName:n,responseTime:_,serverIp:e[w%e.length]}),!!(S.code!==Y.OPERATION_ABORTED&&S.code!==Y.UNEXPECTED_RESPONSE||S.data&&S.data.retry)&&(E=e[(w+1)%e.length],!0)),c)}let zL=1;function qz(e,n,i,s){let{url:c,areaCode:u}=e;const{clientId:h,sid:p}=n,_=Date.now();let E;const S=n.role,[w,I]=KL(n,u,[ii.CHOOSE_SERVER]);let P=ri.networkState;return Bu(async()=>{P&&ri.networkState===ja.OFFLINE&&ri.onlineWaiter&&await Qe.race([ri.onlineWaiter,Ji(s&&s.maxRetryTimeout||pi.maxRetryTimeout)]),P=ri.networkState;const{data:B,headers:M}=await Ku(c,{data:w,cancelToken:i,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);E=M.http3==="1"?1:-1,pt.reportResourceTiming(c,p),Xz(B,c,n,_,[ii.CHOOSE_SERVER],E);const U=b0(B,ii.CHOOSE_SERVER);return HL(U),LL(U,c)},B=>(B&&pt.joinChooseServer(p,{role:S,lts:_,succ:!0,csAddr:c,opid:I,serverList:B.gatewayAddrs.map(M=>M.address),ec:null,cid:B.cid.toString(),uid:B.uid.toString(),csIp:B.csIp,unilbsServerIds:[ii.CHOOSE_SERVER].toString(),isHttp3:E,corssRegionTagReq:n.apRequestDetail,corssRegionTagRes:B.res.detail&&B.res.detail[38]}),!1),B=>B.code!==Y.OPERATION_ABORTED&&(B.code===Y.CAN_NOT_GET_GATEWAY_SERVER?B.data.retry:(pt.joinChooseServer(p,{role:S,lts:_,succ:!1,csAddr:c,serverList:null,opid:I,ec:B.code,csIp:B.data&&B.data.csIp,unilbsServerIds:[ii.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:P}),isHttp3:E,corssRegionTagReq:n.apRequestDetail}),k.warning("[".concat(h||"sid-".concat(p.slice(0,6)),"] Choose server network error, retry"),B),!0)),s)}function Yz(e,n,i,s){let c,{url:u,areaCode:h,serviceIds:p}=e;const _=Date.now(),E=n.role,[S,w]=KL(n,h,p);let I;return Bu(async()=>{I&&ri.networkState===ja.OFFLINE&&ri.onlineWaiter&&await Qe.race([ri.onlineWaiter,Ji(s&&s.maxRetryTimeout||pi.maxRetryTimeout)]),I=ri.networkState;const{data:P,headers:B}=await Ku(u,{data:S,cancelToken:i,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);c=B.http3==="1"?1:-1,pt.reportResourceTiming(u,n.sid),Xz(P,u,n,_,p,c);const M=b0(P,ii.CHOOSE_SERVER),U=b0(P,n.cloudProxyServer==="proxy5"?ii.CLOUD_PROXY_5:n.cloudProxyServer==="proxy3"||n.cloudProxyServer==="proxy4"?ii.CLOUD_PROXY:ii.CLOUD_PROXY_FALLBACK);return HL(M),{gatewayInfo:LL(M,u),proxyInfo:U,url:u}},P=>(P.gatewayInfo&&pt.joinChooseServer(n.sid,{role:E,lts:_,succ:!0,csAddr:u,serverList:P.gatewayInfo.gatewayAddrs.map(B=>B.address),ec:null,opid:w,cid:P.gatewayInfo.cid.toString(),uid:P.gatewayInfo.uid.toString(),csIp:P.gatewayInfo.csIp,unilbsServerIds:p.toString(),isHttp3:c,corssRegionTagReq:n.apRequestDetail,corssRegionTagRes:P.gatewayInfo.res.detail&&P.gatewayInfo.res.detail[38]}),P.proxyInfo&&pt.joinWebProxyAP(n.sid,{lts:_,sucess:1,apServerAddr:u,turnServerAddrList:P.proxyInfo.addresses.map(B=>B.ip).join(","),errorCode:null,eventType:n.cloudProxyServer,unilbsServerIds:p.toString()}),!1),P=>P.code!==Y.OPERATION_ABORTED&&(P.code===Y.CAN_NOT_GET_GATEWAY_SERVER?P.data.retry:(pt.joinWebProxyAP(n.sid,{lts:_,sucess:0,apServerAddr:u,turnServerAddrList:null,errorCode:P.code,eventType:n.cloudProxyServer,unilbsServerIds:p.toString(),extend:JSON.stringify({networkState:I})}),k.warning("[".concat(n.clientId,"] multi unilbs network error, retry"),P),!0)),s)}const Xz=(e,n,i,s,c,u)=>{const{sid:h,clientId:p,cloudProxyServer:_}=i,E=[],S=w=>{w.flag===4096?pt.joinChooseServer(h,{role:i.role,lts:s,succ:!1,csAddr:n,opid:e.opid,serverList:null,ec:w.error.message,csIp:w.error.data&&w.error.data.csIp,unilbsServerIds:c.toString(),isHttp3:u,corssRegionTagReq:i.apRequestDetail}):w.flag!==1048576&&w.flag!==4194304&&w.flag!==4194310||pt.joinWebProxyAP(h,{lts:s,sucess:0,apServerAddr:n,turnServerAddrList:null,errorCode:w.error.code,eventType:_,unilbsServerIds:c.toString()})};if(e.response_body.forEach(w=>{const I=w.buffer.code;if(w.uri===23&&I===0&&!w.buffer.edges_services)if(w.buffer.flag===4194310)k.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),w.buffer.edges_services=[];else{const P={error:new be(Y.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:w.buffer.flag};E.push(P),S(P)}if(I!==0){const P=QE(I),B={error:new be(Y.CAN_NOT_GET_GATEWAY_SERVER,P.desc,{desc:P.desc,retry:P.retry,csIp:e.detail[502]}),flag:w.buffer.flag};w.buffer.flag===4194310?k.warning(B.error.toString()):E.push(B),S(B)}}),E.length)throw k.warning("[".concat(p||"sid-".concat(h.slice(0,6)),"] multi unilbs ").concat(n," failed, ").concat(E.map(w=>"flag: ".concat(w.flag,", message: ").concat(w.error.message,", retry: ").concat(w.error.data.retry)).join(" | "))),new be(Y.CAN_NOT_GET_GATEWAY_SERVER,E.map(w=>"flag: ".concat(w.flag,", message: ").concat(w.error.message)).join(" | "),{retry:!!E.find(w=>w.error.data.retry),csIp:e.detail[502],desc:[...new Set(E.map(w=>{var I;return w==null||(I=w.error)===null||I===void 0||(I=I.data)===null||I===void 0?void 0:I.desc}).filter(w=>!!w))]})},HL=e=>{var n,i,s,c;if(e.addresses&&e.addresses.length===0&&e.code===0)throw new be(Y.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if(Z("AP_AREA")&&((s=e.detail)!==null&&s!==void 0&&s[23]&&typeof((c=e.detail)===null||c===void 0?void 0:c[23])=="string"?Kz(e.detail[23].toLowerCase()):Kz()),(n=e.detail)!==null&&n!==void 0&&n[19]&&typeof((i=e.detail)===null||i===void 0?void 0:i[19])=="string"){const h=e.detail[19],p=h==null?void 0:h.split(";");for(let _=0;_<p.length;_++){var u;const E=$o(u=p[_]).call(u);e.addresses[_]&&p&&(e.addresses[_].fingerprint=E)}}if(Z("GATEWAY_ADDRESS")&&Z("GATEWAY_ADDRESS").length>0){k.debug("assign gateway address to",Z("GATEWAY_ADDRESS"));const h=Z("GATEWAY_ADDRESS").map(p=>{var _,E;const S=(_=(E=e.addresses.find(w=>w.ip===p.ip&&w.port===p.port))===null||E===void 0?void 0:E.fingerprint)!==null&&_!==void 0?_:"";return{ip:p.ip,port:p.port,ticket:e.addresses[0]&&e.addresses[0].ticket,fingerprint:S}});e.addresses=h}},rfe=(e,n)=>{if(e.response_body&&e.response_body.length){const i=e.response_body[0];if(i.buffer.code!==0){const s=QE(i.buffer.code);throw new be(Y.UPDATE_TICKET_FAILED,"[".concat(i.buffer.code,"]: ").concat(s.desc),{retry:s.retry})}return i.buffer.ticket}throw k.debug("update ticket request received ap response without response body:",n),new be(Y.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},KL=(e,n,i)=>{const s=Math.floor(Math.random()*1e12),c=e.role==="host"?"1":e.role==="audience"?"2":void 0,u={appid:e.appId,client_ts:Date.now(),opid:s,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:Gd(Gd(Gd({6:e.stringUid,11:n,12:Z("USE_NEW_TOKEN")?"1":void 0},c?{17:c}:{}),{},{22:n},e.apRequestDetail?{33:e.apRequestDetail}:{}),e.apRTM?{26:"RTM2"}:{}),key:e.token,service_ids:i,uid:e.uid||0}}]};u.request_bodies.forEach(p=>{e.multiIP&&e.multiIP.gateway_ip&&(p.buffer.detail[5]=JSON.stringify({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))});const h=new FormData;return h.append("request",JSON.stringify(u)),[h,s]},ife=(e,n)=>{const i=Math.floor(Math.random()*1e12),s={appid:e.appId,client_ts:Date.now(),opid:i,sid:e.sid,request_bodies:[{uri:28,buffer:{cname:e.cname,detail:{1:"",6:e.stringUid,12:"1"},token:e.token,service_ids:n,uid:e.uid||0,edges_services:e.apResponse.addresses.map(u=>({ip:u.ip,port:u.port}))}}]},c=new FormData;return c.append("request",JSON.stringify(s)),[c,i]};let ny=0;function ry(e){return Qe.all(e.map(n=>n.then(i=>{throw i},i=>i))).then(n=>{throw n},n=>n)}const A0=async e=>{let{fragementLength:n,referenceList:i,asyncMapHandler:s,allFailedhandler:c,promisesCollector:u}=e,h=0;const p=n;let _,E=0;const S=async()=>{const w=(()=>{const I=h*p,P=I+p;return i.slice(I,P).map(s)})();u&&u.push(...w);try{_=await ry(w)}catch(I){if(E+=p,h++,!(E>=i.length))return void await S();c(I)}w.forEach(I=>I.cancel())};return await S(),_},Jz=async e=>{let{referenceList:n,asyncMapHandler:i,closeFn:s}=e;const c=n.length;let u=0;const h=async()=>{const p=i(n.shift());try{return await p}catch(_){if(u++,u>=c||s!=null&&s(_))throw _;return h()}};return h()};async function $L(e,n,i,s){return{gatewayInfo:await async function(u,h,p,_){let E=null;const S=[],w=async()=>{const P=Z("WEBCS_DOMAIN").slice(0,Z("AJAX_REQUEST_CONCURRENT")).map(U=>({url:u.proxyServer?"https://".concat(u.proxyServer,"/ap/?url=").concat(U+"/api/v2/transpond/webrtc?v=2"):"https://".concat(U,"/api/v2/transpond/webrtc?v=2"),areaCode:I0()})),B=_.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:P.map(U=>U.url)}),M=await A0({fragementLength:Z("FRAGEMENT_LENGTH"),referenceList:P,asyncMapHandler:U=>(k.debug("[".concat(u.clientId,"] Connect to choose_server:"),U.url),qz(U,u,h,p)),allFailedhandler:U=>{throw _.recordJoinChannelService({endTs:Date.now(),status:"error",errors:U},B),U[0]},promisesCollector:S});return _.recordJoinChannelService({endTs:Date.now(),status:"success"},B),M},I=async()=>{if(await Ji(1e3),E!==null)return E;const P=Z("WEBCS_DOMAIN_BACKUP_LIST").map(U=>({url:u.proxyServer?"https://".concat(u.proxyServer,"/ap/?url=").concat(U+"/api/v2/transpond/webrtc?v=2"):"https://".concat(U,"/api/v2/transpond/webrtc?v=2"),areaCode:I0()})),B=_.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:P.map(U=>U.url)}),M=await A0({fragementLength:Z("FRAGEMENT_LENGTH"),referenceList:P,asyncMapHandler:U=>(k.debug("[".concat(u.clientId,"] Connect to backup choose_server:"),U.url),qz(U,u,h,p)),allFailedhandler:U=>{throw _.recordJoinChannelService({endTs:Date.now(),status:"error",errors:U},B),U[0]},promisesCollector:S});return _.recordJoinChannelService({endTs:Date.now(),status:"success"},B),M};try{return E=await ry([w(),I()]),S.length&&S.forEach(P=>P.cancel&&typeof P.cancel=="function"&&P.cancel()),E}catch(P){throw P[0]}}(e,n,i,s)}}async function Qz(e,n,i,s,c){const u=e.cloudProxyServer;if(u==="disabled"){if(e.useLocalAccessPoint)return await $L(e,n,i,c);if(Z("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:I,proxyInfo:P}=await t8(e,n,i,c);if(e.turnServer&&e.turnServer.mode!=="auto")return{gatewayInfo:I};const B=P.map(M=>({turnServerURL:M.address,tcpport:M.tcpport||fo.tcpport,udpport:M.udpport||fo.udpport,username:M.username||fo.username,password:M.password||fo.password,forceturn:!1,security:!0}));if(c.useP2P){var h;const M=(h=e.uid)!==null&&h!==void 0?h:I.uid,U="glb:".concat(M.toString()),$=await j1(U),q=P.map(ce=>({turnServerURL:ce.address,tcpport:ce.tcpport||fo.tcpport,udpport:ce.udpport||fo.udpport,username:U,password:$,forceturn:!1,security:!0}));B.push(...q)}return e.turnServer={mode:"manual",servers:B},{gatewayInfo:I}}return await $L(e,n,i,c)}const{proxyInfo:p,gatewayInfo:_}=await t8(e,n,i,c),E={gatewayInfo:_},S=p.map(I=>({turnServerURL:I.address,tcpport:u==="proxy3"?void 0:I.tcpport?I.tcpport:fo.tcpport,udpport:u==="proxy4"?void 0:I.udpport?I.udpport:fo.udpport,username:I.username||fo.username,password:I.password||fo.password,forceturn:u!=="proxy4",security:u==="proxy5"}));if(c.useP2P){var w;const I=(w=e.uid)!==null&&w!==void 0?w:_.uid,P="glb:".concat(I.toString()),B=await j1(P),M=p.map(U=>({turnServerURL:U.address,tcpport:u==="proxy3"?void 0:U.tcpport||fo.tcpport,udpport:u==="proxy4"?void 0:U.udpport||fo.udpport,username:P,password:B,forceturn:u!=="proxy4",security:u==="proxy5"}));S.push(...M)}return e.turnServer={mode:"manual",servers:S},k.debug("[".concat(e.clientId,"] set proxy server: ").concat(e.proxyServer,", mode: ").concat(u)),E}async function Zz(e,n,i,s,c){const u=Z("ACCOUNT_REGISTER").slice(0,Z("AJAX_REQUEST_CONCURRENT"));let h=[];h=n.proxyServer?u.map(_=>"https://".concat(n.proxyServer,"/ap/?url=").concat(_+"/api/v1")):u.map(_=>"https://".concat(_,"/api/v1"));const p=c==null?void 0:c.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:h});try{const _=await async function(E,S,w,I,P){const B=Date.now(),M={sid:w.sid,opid:10,appid:w.appId,string_uid:S};let U=E[0];const $=await Bu(()=>Ku(U+"".concat(U.indexOf("?")===-1?"?":"&","action=stringuid"),{data:M,cancelToken:I,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(q,ce)=>{if(q.code===0){if(q.uid<=0||q.uid>=Math.pow(2,32))throw k.error("Invalid Uint Uid ".concat(S," => ").concat(q.uid),q),pt.reqUserAccount(M.sid,{lts:B,success:!1,serverAddr:U,stringUid:M.string_uid,uid:q.uid,errorCode:Y.INVALID_UINT_UID_FROM_STRING_UID,extend:M}),new be(Y.INVALID_UINT_UID_FROM_STRING_UID);return pt.reqUserAccount(M.sid,{lts:B,success:!0,serverAddr:U,stringUid:M.string_uid,uid:q.uid,errorCode:null,extend:M}),!1}const me=QE(q.code);return me.retry&&(U=E[(ce+1)%E.length]),pt.reqUserAccount(M.sid,{lts:B,success:!1,serverAddr:U,stringUid:M.string_uid,uid:q.uid,errorCode:me.desc,extend:M}),me.retry},(q,ce)=>q.code!==Y.OPERATION_ABORTED&&(pt.reqUserAccount(M.sid,{lts:B,success:!1,serverAddr:U,stringUid:M.string_uid,uid:null,errorCode:q.code,extend:M}),U=E[(ce+1)%E.length],!0),P);if($.code!==0){const q=QE($.code);throw new be(Y.UNEXPECTED_RESPONSE,q.desc)}return $}(h,e,n,i,s);return c==null||c.recordJoinChannelService({status:"success",endTs:Date.now()},p),_.uid}catch(_){throw c==null||c.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[_]},p),_}}async function ofe(e,n,i){const s=Z("ACCOUNT_REGISTER");let c=[];c=n.proxyServer?s.map(u=>"https://".concat(n.proxyServer,"/ap/?url=").concat(u+"/api/v1")):s.map(u=>"https://".concat(u,"/api/v1"));try{return await Jz({referenceList:c,asyncMapHandler:h=>async function(p,_,E,S){const w=Date.now(),I={sid:E.sid,opid:10,appid:E.appId,string_uid:_};try{const P=await Ku(p+"".concat(p.indexOf("?")===-1?"?":"&","action=stringuid"),{data:I,cancelToken:S,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(P.code!==0){const B=QE(P.code);throw new be(Y.UNEXPECTED_RESPONSE,"preload sua error:".concat(B.desc),B)}if(P.uid<=0||P.uid>=Math.pow(2,32))throw new be(Y.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:w,url:p,req:I,uid:P.uid,elapse:Date.now()-w}}catch(P){throw P}}(h,e,n,i),closeFn:h=>h.code===Y.OPERATION_ABORTED||h.code===Y.UNEXPECTED_RESPONSE&&!h.data.retry})}catch(u){throw u}}async function sfe(e,n,i){const s=Z("CDS_AP").slice(0,Z("AJAX_REQUEST_CONCURRENT")).map(_=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(_+"/api/v1"):"https://".concat(_,"/api/v1?action=config")),c=s.map(_=>function(E,S,w,I){const P=vn(),B={flag:64,cipher_method:0,features:Gd(Gd(Gd(Gd(Gd({install_id:J1(),device:P.name,system:P.os,system_general:navigator.userAgent,vendor:S.appId,version:el,cname:S.cname,session_id:S.sid,proxyServer:S.proxyServer,sdk_type:Jhe.WEB_RTC,browser_name:P.name,browser_version:P.version,user_agent:navigator.userAgent,channel_name:S.cname},S.stringUid&&{string_uid:S.stringUid}),S.uid&&{uid:S.uid+""}),P.os&&{os_name:P.os}),P.osVersion&&{os_version:P.osVersion}),{},{detail:""})};return Bu(()=>Ku(E,{data:B,timeout:1e3,cancelToken:w,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,M=>M.code!==Y.OPERATION_ABORTED,I)}(_,e,n,i));let u=null,h=null,p={};try{u=await ry(c)}catch(_){if(_.code===Y.OPERATION_ABORTED)throw _;h=_}if(c.forEach(_=>_.cancel()),pt.reportApiInvoke(e.sid,{name:fi.REQUEST_CONFIG_DISTRIBUTE,options:{error:h,res:u}}).onSuccess(),u&&u.test_tags)try{p=function(_){if(!_.test_tags)return{};const E=_.test_tags,S=Object.keys(E),w={};return S.forEach(I=>{var P;const B=$o(P=I.slice(4)).call(P),M=JSON.parse(E[I]),U=M[1];w[B]={tag:M[0]||"",value:U}}),w}(u)}catch{}return p}async function e8(e,n){const i=Z("WEBCS_DOMAIN").concat(Z("WEBCS_DOMAIN_BACKUP_LIST")).map(s=>({url:"https://".concat(s,"/api/v2/transpond/webrtc?v=2"),areaCode:I0(),serviceIds:[ii.CHOOSE_SERVER,ii.CLOUD_PROXY_FALLBACK]}));try{return await Jz({referenceList:i,asyncMapHandler:c=>async function(u,h,p){let _,{url:E,areaCode:S,serviceIds:w}=u;const I=Date.now(),[P,B]=KL(h,S,w);let M=ri.networkState;try{M&&ri.networkState===ja.OFFLINE&&ri.onlineWaiter&&await Qe.race([ri.onlineWaiter,Ji(pi.maxRetryTimeout)]),M=ri.networkState;const{data:U,headers:$}=await Ku(E,{data:P,cancelToken:p,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);_=$.http3==="1"?1:-1,(ge=>{const pe=[];if(ge.response_body.forEach(Re=>{const Ve=Re.buffer.code;if(Re.uri===23&&Ve===0&&!Re.buffer.edges_services)if(Re.buffer.flag===4194310)Re.buffer.edges_services=[];else{const Ze={error:new be(Y.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:ge.detail[502]}),flag:Re.buffer.flag};pe.push(Ze)}if(Ve!==0){const Ze=QE(Ve),rt={error:new be(Y.CAN_NOT_GET_GATEWAY_SERVER,Ze.desc,{desc:Ze.desc,retry:Ze.retry,csIp:ge.detail[502]}),flag:Re.buffer.flag};Re.buffer.flag===4194310?k.warning(rt.error.toString()):pe.push(rt)}}),pe.length)throw new be(Y.CAN_NOT_GET_GATEWAY_SERVER,pe.map(Re=>"flag: ".concat(Re.flag,", message: ").concat(Re.error.message)).join(" | "),{retry:!!pe.find(Re=>Re.error.data.retry),csIp:ge.detail[502],desc:[...new Set(pe.map(Re=>{var Ve;return Re==null||(Ve=Re.error)===null||Ve===void 0||(Ve=Ve.data)===null||Ve===void 0?void 0:Ve.desc}).filter(Re=>!!Re))]})})(U);const ce=b0(U,ii.CHOOSE_SERVER),me=b0(U,ii.CLOUD_PROXY_FALLBACK);return HL(ce),{gatewayInfo:LL(ce,E),proxyInfo:me,opid:B,requestTime:I,url:E,isHttp3:_,elapse:Date.now()-I}}catch(U){throw U}}(c,e,n),closeFn:c=>c.code===Y.OPERATION_ABORTED||c.code===Y.CAN_NOT_GET_GATEWAY_SERVER&&!c.data.retry})}catch(s){throw s}}async function t8(e,n,i,s){const c=Z("PROXY_SERVER_TYPE3"),u=(P,B,M)=>{let U=M||c;return Array.isArray(U)&&(U=B%2==0?c[1]:c[0]),"https://".concat(U,"/ap/?url=").concat(P)};let h=null;const p=[],_=async()=>{const P=Z("WEBCS_DOMAIN").slice(0,Z("AJAX_REQUEST_CONCURRENT")).map((U,$)=>{let q;return q=e.cloudProxyServer==="disabled"&&e.proxyServer?u("".concat(U,"/api/v2/transpond/webrtc?v=2"),$,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(U,"/api/v2/transpond/webrtc?v=2"):u("".concat(U,"/api/v2/transpond/webrtc?v=2"),$),{url:q,areaCode:I0(),serviceIds:[ii.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?ii.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?ii.CLOUD_PROXY:ii.CLOUD_PROXY_FALLBACK]}}),B=s.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:P.map(U=>U.url)}),M=await A0({fragementLength:Z("FRAGEMENT_LENGTH"),referenceList:P,asyncMapHandler:U=>(k.debug("[".concat(e.clientId,"] Connect to choose_server:"),U.url),Yz(U,e,n,i)),allFailedhandler:U=>{throw s.recordJoinChannelService({endTs:Date.now(),status:"error",errors:U},B),U[0]},promisesCollector:p});return s.recordJoinChannelService({endTs:Date.now(),status:"success"},B),M},E=async()=>{if(await Ji(1e3),h!==null)return h;const P=Z("WEBCS_DOMAIN_BACKUP_LIST").map((U,$)=>{let q;return q=e.cloudProxyServer==="disabled"&&e.proxyServer?u("".concat(U,"/api/v2/transpond/webrtc?v=2"),$,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(U,"/api/v2/transpond/webrtc?v=2"):u("".concat(U,"/api/v2/transpond/webrtc?v=2"),$),{url:q,areaCode:I0(),serviceIds:[ii.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?ii.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?ii.CLOUD_PROXY:ii.CLOUD_PROXY_FALLBACK]}}),B=s.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:P.map(U=>U.url)}),M=await A0({fragementLength:Z("FRAGEMENT_LENGTH"),referenceList:P,asyncMapHandler:U=>(k.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),U.url),Yz(U,e,n,i)),allFailedhandler:U=>{throw s.recordJoinChannelService({endTs:Date.now(),status:"error",errors:U},B),U[0]},promisesCollector:p});return s.recordJoinChannelService({endTs:Date.now(),status:"success"},B),M};let S,w,I;try{({gatewayInfo:S,proxyInfo:w,url:I}=await ry([_(),E()]))}catch(P){throw P[0]}if(p.length&&p.forEach(P=>P.cancel&&typeof P.cancel=="function"&&P.cancel()),!S||!w)throw new be(Y.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(e.apUrl=I,e.cloudProxyServer!=="disabled"&&Array.isArray(c)&&I){const P=/^https?:\/\/(.+?)(\/.*)?$/.exec(I)[1];$e(c).call(c,P)&&(e.proxyServer=P,k.setProxyServer(P),pt.setProxyServer(P))}return h={gatewayInfo:S,proxyInfo:await Rz(w,S.uid)},h}async function afe(e,n,i){const s=Z("UAP_AP").slice(0,Z("AJAX_REQUEST_CONCURRENT")).map(u=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(u+"/api/v1?action=uap"):"https://".concat(u,"/api/v1?action=uap")),c=s.map(u=>function(h,p,_,E){const S={command:"convergeAllocateEdge",sid:p.sid,appId:p.appId,token:p.token,ts:Date.now(),version:el,cname:p.cname,uid:p.uid.toString(),requestId:zL,seq:zL};zL+=1;const w={service_name:"tele_channel",json_body:JSON.stringify(S)};return Bu(async()=>{const I=await Ku(h,{data:w,cancelToken:_,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(I.code!==0){const B=new be(Y.UNEXPECTED_RESPONSE,"cross channel ap error, code"+I.code,{retry:!0});throw k.error(B.toString()),B}const P=JSON.parse(I.json_body);if(P.code!==200){const B=new be(Y.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(P.code,", reason: ").concat(P.reason));throw k.error(B.toString()),B}if(!P.servers||P.servers.length===0){const B=new be(Y.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw k.error(B.toString()),B}return{vid:P.vid,workerToken:P.workerToken,addressList:(Z("CHANNEL_MEDIA_RELAY_SERVERS")||P.servers).map(B=>"wss://".concat(B.address.replace(/\./g,"-"),".").concat(Z("WORKER_DOMAIN"),":").concat(B.wss))}},void 0,I=>!!(I.code!==Y.OPERATION_ABORTED&&I.code!==Y.UNEXPECTED_RESPONSE||I.data&&I.data.retry),E)}(u,e,n,i));try{const u=await ry(c);return c.forEach(h=>h.cancel()),u}catch(u){throw u[0]}}async function cfe(e,n,i){let s=null;const c=[],u=async h=>{const p=Z(h?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(_=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(_+"/api/v2/transpond/webrtc?v=2"):"https://".concat(_,"/api/v2/transpond/webrtc?v=2"));return h&&(await Ji(1e3),s!==null)?s:await A0({fragementLength:Z("FRAGEMENT_LENGTH"),referenceList:p,asyncMapHandler:_=>(k.debug("[".concat(e.clientId,"] update ticket, Connect to ").concat(h?"backup":""," choose_server:"),_),function(E,S,w,I){const[P]=ife(S,[ii.CHOOSE_SERVER]);let B=ri.networkState;return Bu(async()=>{B&&ri.networkState===ja.OFFLINE&&ri.onlineWaiter&&await Qe.race([ri.onlineWaiter,Ji(I&&I.maxRetryTimeout||pi.maxRetryTimeout)]),B=ri.networkState;const M=await Ku(E,{data:P,cancelToken:w,headers:{"Content-Type":"multipart/form-data;"}},!0);return rfe(M,E)},()=>!1,M=>M.code!==Y.OPERATION_ABORTED&&(M.code===Y.UPDATE_TICKET_FAILED?M.data.retry:(k.warning("[".concat(S.clientId,"] update ticket network error, retry"),M),!0)),I)}(_,e,n,i)),allFailedhandler:_=>{throw _[0]},promisesCollector:c})};try{return s=await ry([u(!1),u(!0)]),c.length&&c.forEach(h=>h.cancel&&typeof h.cancel=="function"&&h.cancel()),s}catch(h){throw h[0]}}function n8(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,s)}return i}function qL(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?n8(Object(i),!0).forEach(function(s){K(e,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):n8(Object(i)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(i,s))})}return e}class lfe extends Rr{get isSuccess(){return!!this.configs}constructor(n,i){super(),K(this,"configs",void 0),K(this,"store",void 0),K(this,"joinInfo",void 0),K(this,"cancelToken",void 0),K(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),K(this,"interval",void 0),K(this,"mutex",void 0),K(this,"mutableParamsRead",!1),K(this,"configCache",{}),K(this,"limit_bitrate",void 0),this.mutex=new To("config-distribute",n),this.store=i}startGetConfigDistribute(n,i){this.joinInfo=n,this.cancelToken=i,this.interval&&this.stopGetConfigDistribute(),Z("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},Z("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,pt.reportApiInvoke(null,{options:void 0,name:fi.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:Dr.TRACER}).onSuccess(JSON.stringify(Wu))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void k.debug("[config-distribute] get config distribute interrupted have no joininfo");let n;const i=await this.mutex.lock();try{n=await sfe(this.joinInfo,this.cancelToken,this.retryConfig),k.debug("[config-distribute] get config distribute",JSON.stringify(n));const s=function(c){var u;const h=YT(u=Object.keys(c).filter(E=>/^webrtc_ng_global_parameter/.test(E))).call(u);for(let E=0;E<h.length;E++)for(let S=h.length-1;S>E;S--){const w=h[S],I=c[w].value;if(typeof I.__priority=="number"){const P=I.__priority,B=h[S-1],M=c[B].value;if(typeof M.__priority=="number"){if(!(P>M.__priority))continue;{const U=w;h[S]=h[S-1],h[S-1]=U}}else{const U=w;h[S]=h[S-1],h[S-1]=U}}}const p=Date.now();let _={};return h.forEach(E=>{const S=c[E].value.__expires;S&&S<=p||(_[E]=c[E])}),_}(n);this.cacheGlobalParameterConfig(s),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=s}catch(s){const c=new be(Y.NETWORK_RESPONSE_ERROR,s);k.warning("[config-distribute] ".concat(c.toString()))}finally{i()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(n){fz(n)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==n.id&&this.emit(y0.UPDATE_BITRATE_LIMIT,n):this.emit(y0.UPDATE_BITRATE_LIMIT,n))}getLowStreamConfigDistribute(){return this.limit_bitrate&&qL({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(n){try{const i={},s=Object.keys(n),c=[];s.forEach(u=>{const h=n[u].value;i[u]=h;const p=h.__id;if(p&&this.configCache[u]&&this.configCache[u].__id===p)return;const _=h.__type,E=n[u].value,S=n[u].tag;let w=0;_?_===W6.REALTIME&&(w=1):Object.keys(E).some(I=>Object.prototype.hasOwnProperty.call(tL,I)||!wL()&&Object.prototype.hasOwnProperty.call($I,I)?(w=1,!0):void 0),c.push({tag:S,isApplied:w,feature:u,params:JSON.stringify(h)})}),c.forEach(u=>{let{tag:h,feature:p,params:_,isApplied:E}=u;this.store.sessionId&&pt.abTest(this.store.sessionId,{intSucc:1,isApplied:E,tag:h,feature:p,params:_,cid:this.store.cid,uid:this.store.intUid})}),this.configCache=i}catch(i){k.debug("handleABTestConfigDistribute error",i)}}cacheGlobalParameterConfig(n){const i=function(c){const u={};return Object.keys(c).forEach(h=>{const p=c[h].value,_=p.__expires,E=p.__type;Object.keys(p).forEach(S=>{S==="__id"||S==="__type"||S==="__priority"||S==="__expires"||Object.prototype.hasOwnProperty.call(u,S)||(u[S]=qL(qL({value:p[S]},_&&{expires:_}),E&&{type:E}))})}),u}(n);try{var s;const c=(s=i.LIMIT_BITRATE)===null||s===void 0?void 0:s.value;delete i.LIMIT_BITRATE,c&&fz(c)&&this.handleBitrateLimit(c),this.limit_bitrate=c,this.handleGlobalParameterConfig(i),this.handleABTestConfigDistribute(n),function(p){try{const _=Date.now();Object.keys(p).forEach(E=>{const{value:S,type:w,expires:I}=p[E];I&&I<=_||((w===W6.REALTIME||Object.prototype.hasOwnProperty.call(tL,E))&&(Wu[E]=S,lr[E]=S,k.debug("Update realtime parameters from config distribute",E,S)),w||wL()||!Object.prototype.hasOwnProperty.call($I,E)||(Wu[E]=S,lr[E]=S,k.debug("Update gateway parameters from config distribute",E,S)))})}catch(_){k.error("Error update config immediately: ".concat(p),_.message)}}(i);const u=JSON.stringify(i),h=window.btoa(u);window.localStorage.setItem("websdk_ng_global_parameter",h),k.debug("Caching global parameters ".concat(u))}catch(c){k.error("Error caching global parameters:",c.message)}}handleGlobalParameterConfig(n){try{const i=Date.now();Object.keys(n).forEach(s=>{if(s==="CLIENT_ROLE_OPTIONS"&&Object.prototype.hasOwnProperty.call(lr,s)){const{value:c,expires:u}=n[s];if(u&&u<=i)return;(function(h,p){try{return typeof h=="object"&&typeof p=="object"&&JSON.stringify(h)===JSON.stringify(p)}catch{return!1}})(lr[s],c)||(Wu[s]=c,lr[s]=c,this.emit(y0.UPDATE_CLIENT_ROLE_OPTIONS,c),k.debug("Updating client role options: ".concat(JSON.stringify(c))))}})}catch(i){k.error("Error handling global parameter config:",i.message)}}}class ufe extends Rr{constructor(){super(...arguments),K(this,"resultStorage",new Map)}setLocalAudioStats(n,i,s){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",n,this.checkAudioInputLevel(s,i)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",n,this.checkSendAudioBitrate(s,i))}setLocalVideoStats(n,i,s){this.record("SEND_VIDEO_BITRATE_TOO_LOW",n,this.checkSendVideoBitrate(s,i)),this.record("FRAMERATE_INPUT_TOO_LOW",n,this.checkFramerateInput(s,i)),this.record("FRAMERATE_SENT_TOO_LOW",n,this.checkFramerateSent(s))}setRemoteAudioStats(n,i){const s=n.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",s,this.checkAudioOutputLevel(i))}setRemoteVideoStats(n,i){const s=n.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",s,this.checkVideoDecode(i))}record(n,i,s){if(Z("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(n)||this.resultStorage.set(n,{result:[],isPrevNormal:!0});const c=this.resultStorage.get(n);if(c&&(c.result.push(s),c.result.length>=5)){var u;const h=$e(u=c.result).call(u,!0);c.isPrevNormal&&!h&&this.emit("exception",r8[n],n,i),!c.isPrevNormal&&h&&this.emit("exception",r8[n]+2e3,n+"_RECOVER",i),c.isPrevNormal=h,c.result=[]}}checkAudioOutputLevel(n){return!(n.receiveBitrate>0&&n.receiveLevel===0)}checkAudioInputLevel(n,i){return i instanceof yi&&!i.isActive||!!i.muted||n.sendVolumeLevel!==0}checkFramerateInput(n,i){let s=null;i._encoderConfig&&i._encoderConfig.frameRate&&(s=Ba(i._encoderConfig.frameRate));const c=n.captureFrameRate;return!s||!c||!(s>10&&c<5||s<10&&s>=5&&c<=1)}checkFramerateSent(n){return!(n.captureFrameRate&&n.sendFrameRate&&n.captureFrameRate>5&&n.sendFrameRate<=1)}checkSendVideoBitrate(n,i){return!!i.muted||n.sendBitrate!==0}checkSendAudioBitrate(n,i){return i instanceof yi&&!i.isActive||!!i.muted||n.sendBitrate!==0}checkVideoDecode(n){return n.receiveBitrate===0||n.decodeFrameRate!==0}}const r8={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},Ro=new class{markSubscribeStart(e,n){performance.mark("agora-web-sdk/".concat(e,"/subscribe-").concat(n))}markPublishStart(e,n){performance.mark("agora-web-sdk/".concat(e,"/publish-").concat(n))}measureFromSubscribeStart(e,n){const i=performance.getEntriesByName("agora-web-sdk/".concat(e,"/subscribe-").concat(n));if(i.length>0){const s=i[i.length-1];return Math.round(performance.now()-s.startTime)}return 0}measureFromPublishStart(e,n){const i=performance.getEntriesByName("agora-web-sdk/".concat(e,"/publish-").concat(n));if(i.length>0){const s=i[i.length-1];return Math.round(performance.now()-s.startTime)}return 0}};function i8(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,s)}return i}function o_(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?i8(Object(i),!0).forEach(function(s){K(e,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):i8(Object(i)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(i,s))})}return e}class O0{constructor(n){K(this,"store",void 0),K(this,"onStatsException",void 0),K(this,"onUploadPublishDuration",void 0),K(this,"onStatsChanged",void 0),K(this,"localStats",new Map),K(this,"remoteStats",new Map),K(this,"updateStatsInterval",void 0),K(this,"trafficStats",void 0),K(this,"trafficStatsPeerList",[]),K(this,"uplinkStats",void 0),K(this,"exceptionMonitor",void 0),K(this,"p2pChannel",void 0),K(this,"scalabilityMode",KI.L1T1),K(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=n,this.exceptionMonitor=new ufe,this.exceptionMonitor.on("exception",(i,s,c)=>{this.onStatsException&&this.onStatsException(i,s,c)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(xe.LocalAudioTrack)||o_({},sL)}getLocalVideoTrackStats(){return this.localStats.get(xe.LocalVideoTrack)||o_({},aL)}getRemoteAudioTrackStats(n){const i=(u,h)=>{if(!this.trafficStats)return h;const p=this.trafficStats.peer_delay.find(_=>_.peer_uid===u);return p&&(h.publishDuration=p.B_ppad+(Date.now()-this.trafficStats.timestamp)),h},s={};if(n){var c;const u=(c=this.remoteStats.get(n))===null||c===void 0?void 0:c.audioStats;u&&(s[n]=i(n,u))}else Array.from(this.remoteStats.entries()).forEach(u=>{let[h,{audioStats:p}]=u;p&&(s[h]=i(h,p))});return s}getRemoteNetworkQualityStats(n){const i={};if(n){var s;const c=(s=this.remoteStats.get(n))===null||s===void 0?void 0:s.networkStats;c&&(i[n]=c)}else Array.from(this.remoteStats.entries()).forEach(c=>{let[u,{networkStats:h}]=c;h&&(i[u]=h)});return i}getRemoteVideoTrackStats(n){const i=(u,h)=>{if(!this.trafficStats)return h;const p=this.trafficStats.peer_delay.find(_=>_.peer_uid===u);return p&&(h.publishDuration=p.B_ppvd+(Date.now()-this.trafficStats.timestamp)),h},s={};if(n){var c;const u=(c=this.remoteStats.get(n))===null||c===void 0?void 0:c.videoStats;u&&(s[n]=i(n,u))}else Array.from(this.remoteStats.entries()).forEach(u=>{let[h,{videoStats:p}]=u;p&&(s[h]=i(h,p))});return s}getRTCStats(){let n=0,i=0,s=0,c=0;const u=this.localStats.get(xe.LocalAudioTrack);u&&(n+=u.sendBytes,i+=u.sendBitrate);const h=this.localStats.get(xe.LocalVideoTrack);h&&(n+=h.sendBytes,i+=h.sendBitrate);const p=this.localStats.get(xe.LocalVideoLowTrack);p&&(n+=p.sendBytes,i+=p.sendBitrate),this.remoteStats.forEach(E=>{let{audioStats:S,videoStats:w}=E;S&&(s+=S.receiveBytes,c+=S.receiveBitrate),w&&(s+=w.receiveBytes,c+=w.receiveBitrate)});let _=1;return this.trafficStats&&(_+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:_,SendBitrate:i,SendBytes:n,RecvBytes:s,RecvBitrate:c,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(n){this.localStats.set(n,void 0)}removeLocalStats(n){n?this.localStats.delete(n):this.localStats.clear()}addRemoteStats(n){this.remoteStats.set(n,{})}removeRemoteStats(n){n?this.remoteStats.delete(n):this.remoteStats.clear()}addP2PChannel(n){this.p2pChannel=n}updateTrafficStats(n){n.peer_delay=n.peer_delay.filter(i=>i.B_ppad!==void 0||i.B_ppvd!==void 0),n.peer_delay.filter(i=>this.trafficStatsPeerList.indexOf(i.peer_uid)===-1).forEach(i=>{var s;const c=(s=this.p2pChannel)===null||s===void 0?void 0:s.getRemoteMedia(i.peer_uid),u=c!=null&&c.videoSSRC?Ro.measureFromSubscribeStart(this.store.clientId,c.videoSSRC):0,h=c!=null&&c.audioSSRC?Ro.measureFromSubscribeStart(this.store.clientId,c.audioSSRC):0;i.B_ppad!==void 0&&i.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(i.peer_uid,i.B_ppad,i.B_ppvd,u>h?u:h),this.trafficStatsPeerList.push(i.peer_uid))}),this.trafficStats=n}updateUplinkStats(n){this.uplinkStats&&this.uplinkStats.B_fir!==n.B_fir&&k.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(n.B_fir)),this.uplinkStats=n}static isRemoteVideoFreeze(n,i,s){if(!n)return!1;const c=!!s&&i.framesDecodeFreezeTime>s.framesDecodeFreezeTime,u=!s||i.framesDecodeCount>s.framesDecodeCount;return c||!u}static isRemoteAudioFreeze(n){return!!n&&n._isFreeze()}isLocalVideoFreeze(n){return!(!n.inputFrame||!n.sentFrame)&&n.inputFrame.frameRate>5&&n.sentFrame.frameRate<3}updateLocalStats(n){Array.from(this.localStats.entries()).forEach(i=>{let[s,c]=i;switch(s){case xe.LocalVideoTrack:case xe.LocalVideoLowTrack:{const h=c,p=o_({},aL),_=n.getStats(),E=n.getLocalMedia(s);if(_){const S=_.videoSend.find(w=>w.ssrc===(E==null?void 0:E.ssrcs[0].ssrcId));if(S){const w=n.getLocalVideoSize(),I=n.getEncoderConfig(xe.LocalVideoTrack);S.codec!=="H264"&&S.codec!=="H265"&&S.codec!=="VP8"&&S.codec!=="VP9"&&S.codec!=="AV1X"&&S.codec!=="AV1"||(p.codecType=S.codec),p.sendBytes=S.bytes,p.sendBitrate=h?8*Math.max(0,p.sendBytes-h.sendBytes):0,S.inputFrame?(p.captureFrameRate=S.inputFrame.frameRate,p.captureResolutionHeight=S.inputFrame.height,p.captureResolutionWidth=S.inputFrame.width):w&&(p.captureResolutionWidth=w.width,p.captureResolutionHeight=w.height),S.sentFrame?(p.sendFrameRate=S.sentFrame.frameRate,p.sendResolutionHeight=S.sentFrame.height,p.sendResolutionWidth=S.sentFrame.width):w&&(p.sendResolutionWidth=w.width,p.sendResolutionHeight=w.height),S.avgEncodeMs&&(p.encodeDelay=S.avgEncodeMs),I&&I.bitrateMax&&(p.targetSendBitrate=1e3*I.bitrateMax),p.sendPackets=S.packets,p.sendPacketsLost=S.packetsLost,p.sendJitterMs=S.jitterMs,p.sendRttMs=S.rttMs,p.totalDuration=h?h.totalDuration+1:1,p.totalFreezeTime=h?h.totalFreezeTime:0,this.isLocalVideoFreeze(S)&&(p.totalFreezeTime+=1),S.scalabilityMode&&this.scalabilityMode!==S.scalabilityMode&&(k.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(S.scalabilityMode)),this.scalabilityMode=S.scalabilityMode)}this.trafficStats&&(p.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var u;this.localStats.set(s,p),((h==null?void 0:h.sendResolutionWidth)!==p.sendResolutionWidth||(h==null?void 0:h.sendResolutionHeight)!==p.sendResolutionHeight)&&((u=this.onStatsChanged)===null||u===void 0||u.call(this,"resolution",{width:p.sendResolutionWidth,height:p.sendResolutionHeight})),p&&E&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,E.track,p);break}case xe.LocalAudioTrack:{const h=c,p=o_({},sL),_=n.getStats(),E=n.getLocalMedia(s);if(_){const S=_.audioSend.find(w=>w.ssrc===(E==null?void 0:E.ssrcs[0].ssrcId));if(S){if(S.codec!=="opus"&&S.codec!=="aac"&&S.codec!=="PCMU"&&S.codec!=="PCMA"&&S.codec!=="G722"||(p.codecType=S.codec),S.inputLevel)p.sendVolumeLevel=Math.round(32767*S.inputLevel);else{const w=n.getLocalAudioVolume();w&&(p.sendVolumeLevel=Math.round(32767*w))}p.sendBytes=S.bytes,p.sendPackets=S.packets,p.sendPacketsLost=S.packetsLost,p.sendJitterMs=S.jitterMs,p.sendRttMs=S.rttMs,p.sendBitrate=h?8*Math.max(0,p.sendBytes-h.sendBytes):0}}this.trafficStats&&(p.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(xe.LocalAudioTrack,p),p&&E&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,E.track,p);break}}})}updateRemoteStats(n){Array.from(this.remoteStats.entries()).forEach(i=>{var s,c;let[u,{videoStats:h,audioStats:p,videoPcStats:_}]=i;const E=p,S=h,w=_,I=o_({},Z6),P=o_({},eW),B=o_({},qde),{audioTrack:M,videoTrack:U,audioSSRC:$,videoSSRC:q}=n.getRemoteMedia(u);let ce;ce=this.store.useP2P?n.getStats(!0):n.getStats();const me=(s=ce)===null||s===void 0?void 0:s.audioRecv.find(Ve=>Ve.ssrc===$),ge=(c=ce)===null||c===void 0?void 0:c.videoRecv.find(Ve=>Ve.ssrc===q),pe=this.trafficStats&&this.trafficStats.peer_delay.find(Ve=>Ve.peer_uid===u);if(me&&(me.codec!=="opus"&&me.codec!=="aac"&&me.codec!=="PCMU"&&me.codec!=="PCMA"&&me.codec!=="G722"||(I.codecType=me.codec),me.outputLevel?I.receiveLevel=Math.round(32767*me.outputLevel):M&&(I.receiveLevel=Math.round(32767*M.getVolumeLevel())),I.receiveBytes=me.bytes,I.receivePackets=me.packets,I.receivePacketsLost=me.packetsLost,I.receivePacketsDiscarded=me.packetsDiscarded,I.packetLossRate=I.receivePacketsLost/(I.receivePackets+I.receivePacketsLost),I.receiveBitrate=E?8*Math.max(0,I.receiveBytes-E.receiveBytes):0,I.totalDuration=E?E.totalDuration+1:1,I.totalFreezeTime=E?E.totalFreezeTime:0,I.freezeRate=I.totalFreezeTime/I.totalDuration,I.receiveDelay=me.jitterBufferMs,I.totalDuration>10&&O0.isRemoteAudioFreeze(M)&&(I.totalFreezeTime+=1)),ge){var Re;ge.codec!=="H264"&&ge.codec!=="H265"&&ge.codec!=="VP8"&&ge.codec!=="VP9"&&ge.codec!=="AV1X"&&ge.codec!=="AV1"||(P.codecType=ge.codec),P.receiveBytes=ge.bytes,P.receiveBitrate=S?8*Math.max(0,P.receiveBytes-S.receiveBytes):0,P.decodeFrameRate=ge.decodeFrameRate<0?0:ge.decodeFrameRate,P.renderFrameRate=ge.decodeFrameRate<0?0:ge.decodeFrameRate,ge.outputFrame&&(P.renderFrameRate=ge.outputFrame.frameRate),ge.receivedFrame?(P.receiveFrameRate=ge.receivedFrame.frameRate,P.receiveResolutionHeight=ge.receivedFrame.height,P.receiveResolutionWidth=ge.receivedFrame.width):U&&(P.receiveResolutionHeight=U._videoHeight||0,P.receiveResolutionWidth=U._videoWidth||0),ge.framesRateFirefox!==void 0&&(P.receiveFrameRate=Math.round(ge.framesRateFirefox)),P.receivePackets=ge.packets,P.receivePacketsLost=ge.packetsLost,P.packetLossRate=P.receivePacketsLost/(P.receivePackets+P.receivePacketsLost);const Ve=S?S.totalFreezeTime:0,Ze=S?S.totalDuration:0;P.totalDuration=S?S.totalDuration+1:1,P.totalFreezeTime=(Re=ge.totalFreezesDuration)!==null&&Re!==void 0?Re:Ve||0,P.receiveDelay=ge.jitterBufferMs||0;const rt=!!q&&n.getRemoteVideoIsReady(q);ge.totalFreezesDuration===void 0&&U&&rt&&O0.isRemoteVideoFreeze(U,ge,w)&&(P.totalFreezeTime+=1),P.freezeRate=Math.max(0,Math.min((P.totalFreezeTime-Ve)/(P.totalDuration-Ze),1))}pe&&(I.end2EndDelay=pe.B_ad,P.end2EndDelay=pe.B_vd,I.transportDelay=pe.B_ed,P.transportDelay=pe.B_ed,I.currentPacketLossRate=pe.B_ealr4/100,P.currentPacketLossRate=pe.B_evlr4/100,B.uplinkNetworkQuality=pe.B_punq?pe.B_punq:0,B.downlinkNetworkQuality=pe.B_pdnq?pe.B_pdnq:0),this.remoteStats.set(u,{audioStats:I,videoStats:P,videoPcStats:ge,networkStats:B}),M&&this.exceptionMonitor.setRemoteAudioStats(M,I),U&&this.exceptionMonitor.setRemoteVideoStats(U,P)})}}class o8{constructor(){K(this,"destChannelMediaInfos",new Map),K(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(n){dz(n),this.srcChannelMediaInfo=n}addDestChannelInfo(n){dz(n),this.destChannelMediaInfos.set(n.channelName,n)}removeDestChannelInfo(n){hA(n),this.destChannelMediaInfos.delete(n)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function s8(e){if(!(e instanceof o8))return new be(Y.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const n=e.getSrcChannelMediaInfo(),i=e.getDestChannelMediaInfo();if(!n)return new be(Y.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(i.size===0)return new be(Y.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class Xp{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(n,i){K(this,"uid",void 0),K(this,"_uintid",void 0),K(this,"_trust_in_room_",!0),K(this,"_trust_audio_enabled_state_",!0),K(this,"_trust_video_enabled_state_",!0),K(this,"_trust_audio_mute_state_",!0),K(this,"_trust_video_mute_state_",!0),K(this,"_audio_muted_",!1),K(this,"_video_muted_",!1),K(this,"_audio_enabled_",!0),K(this,"_video_enabled_",!0),K(this,"_audio_added_",!1),K(this,"_video_added_",!1),K(this,"_is_pre_created",!1),K(this,"_video_pre_subscribed",!1),K(this,"_audio_pre_subscribed",!1),K(this,"_trust_video_stream_added_state_",!0),K(this,"_trust_audio_stream_added_state_",!0),K(this,"_audioTrack",void 0),K(this,"_videoTrack",void 0),K(this,"_dataChannels",[]),K(this,"_audioSSRC",void 0),K(this,"_videoSSRC",void 0),K(this,"_audioOrtc",void 0),K(this,"_videoOrtc",void 0),K(this,"_cname",void 0),K(this,"_rtxSsrcId",void 0),K(this,"_videoMid",void 0),K(this,"_audioMid",void 0),this.uid=n,this._uintid=i}}function a8(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,s)}return i}function c8(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?a8(Object(i),!0).forEach(function(s){K(e,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):a8(Object(i)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(i,s))})}return e}const P0="9",l8=4e4;function u8(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,s)}return i}function Sf(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?u8(Object(i),!0).forEach(function(s){K(e,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):u8(Object(i)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(i,s))})}return e}var iy=function(e){return e[e.DOWN=0]="DOWN",e[e.UP=1]="UP",e}(iy||{});const CA=new Map;function d8(e,n,i,s){let{scale:c}=e;if(c===0&&s===iy.UP||c>=n.length-1&&s===iy.DOWN)return e;let u=Sf(Sf({},e),{},{scale:s===iy.DOWN?++c:--c});switch(i){case"maintain-framerate":u=Sf(Sf({},u),n[c].motion);break;case"maintain-resolution":u=Sf(Sf({},u),n[c].detail);break;case"balanced":u=Sf(Sf({},u),n[c].balanced)}return u}function h8(e,n){if(n){const i={overUse:0,underUse:0,adaptationList:f8(n)};CA.set(e,i)}else CA.delete(e)}function f8(e){const n=Sf({},e),{bitrateMax:i,frameRate:s,scaleResolutionDownBy:c,bitrateMin:u}=n,{MIN_FRAME_RATE:h,MAX_THRESHOLD_FRAMERATE:p,MAX_SCALE:_,BITRATE_MIN_THRESHOLD:E,BITRATE_MAX_THRESHOLD:S,BWE_SCALE_UP_THRESHOLD:w,BWE_SCALE_DOWN_THRESHOLD:I,PERF_SCALE_DOWN_THRESHOLD:P,PERF_SCALE_UP_THRESHOLD:B,BALANCE_BITRATE_FACTOR:M,BALANCE_FRAMERATE_FACTOR:U,BALANCE_RESOLUTION_FACTOR:$,MOTION_RESOLUTION_FACTOR:q,MOTION_BITRATE_FACTOR:ce,DETAIL_FRAMERATE_FACTOR:me,DETAIL_BITRATE_FACTOR:ge}=Z1,pe=Math.min(n.frameRate,p),Re=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(I,1)*i),bwe_up:i,fps_down:Math.round(Math.pow(P,1)*pe),fps_up:s},balanced:{scaleResolutionDownBy:1,frameRate:s,bitrateMax:i,bitrateMin:u},motion:{scaleResolutionDownBy:1,frameRate:s,bitrateMax:i,bitrateMin:u},detail:{scaleResolutionDownBy:1,frameRate:s,bitrateMax:i,bitrateMin:u}}];for(let Ve=1;Ve<=_;Ve++){const Ze={bwe_up:Math.round(Math.pow(w,Ve)*i),bwe_down:Math.round(Math.pow(I,Ve+1)*i),fps_up:Math.round(Math.pow(B,Ve)*pe),fps_down:Math.round(Math.pow(P,Ve+1)*pe)},rt={scaleResolutionDownBy:c/Math.pow($,Ve),frameRate:Math.max(Math.round(Math.pow(U,Ve)*s),h),bitrateMax:Math.max(Math.round(Math.pow(M,Ve)*i),S),bitrateMin:Math.max(Math.round(Math.pow(M,Ve)*u),E)},un={scaleResolutionDownBy:c/Math.pow(q,Ve),frameRate:s,bitrateMax:Math.max(Math.round(Math.pow(ce,Ve)*i),S),bitrateMin:Math.max(Math.round(Math.pow(ce,Ve)*u),E)},dn={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(me,Ve)*s),h),bitrateMax:Math.max(Math.round(Math.pow(ge,Ve)*i),S),bitrateMin:Math.max(Math.round(Math.pow(ge,Ve)*u),E)};Re.push({scale:Ve,threshold:Ze,balanced:rt,motion:un,detail:dn})}return Re}function dfe(e,n,i,s,c,u){const h=CA.get(e)||{overUse:0,underUse:0,adaptationList:f8(c)},{adaptationList:p}=h;CA.set(e,h);const{OVERUSE_TIMES_THRESHOLD:_,UNDERUSE_TIMES_THRESHOLD:E}=Z1,{scale:S}=s;let w,I;return typeof n=="number"&&n>0&&function(P,B,M,U){if(B>=M.length)return!1;let{threshold:{fps_down:$}}=M[B];return Z("FORCE_AG_HIGH_FRAMERATE")&&U==="maintain-framerate"&&($=M[0].threshold.fps_down),P<$}(n,S,p,u)&&(h.overUse++,I=p0.CPU,h.overUse>_)||typeof i=="number"&&i>0&&function(P,B,M){if(B>=M.length)return!1;const{threshold:{bwe_down:U}}=M[B];return P<U}(i,S,p)&&(h.overUse++,I=p0.BANDWIDTH,h.overUse>_)?(h.overUse=0,h.underUse=0,w=d8(s,p,u,iy.DOWN),[w,I]):(typeof n=="number"&&n>0&&typeof i=="number"&&i>0&&function(P,B,M,U){if(B===0)return;let{threshold:{fps_up:$}}=M[B];return Z("FORCE_AG_HIGH_FRAMERATE")&&U==="maintain-framerate"&&($=M[1].threshold.fps_up),P>$}(n,S,p,u)&&function(P,B,M){if(B===0)return;const{threshold:{bwe_up:U}}=M[B];return P>U}(i,S,p)&&(h.underUse++,h.underUse>E&&(h.overUse=0,h.underUse=0,w=d8(s,p,u,iy.UP),w.scale===0&&(I=p0.NONE))),[w,I])}function p8(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,s)}return i}function YL(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?p8(Object(i),!0).forEach(function(s){K(e,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):p8(Object(i)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(i,s))})}return e}function hfe(e){var n;return!!Z("ENABLE_AG_ADAPTATION")&&!!(e instanceof gL||$e(n=e._hints).call(n,tr.CUSTOM_TRACK))&&(!!Z("FORCE_SUPPORT_AG_ADAPTATION")||!!(function(i){const s=vn();if(s.os!==Pi.IOS||!s.osVersion)return!1;const c=s.osVersion.split(".");return Number(c[0])>=i}(14)&&u6(17,4)||l6(14)&&d6(17,4,!0)))}const IA=new Map;function AA(e,n){const i=IA.get(e);if(i){const{timer:s}=i;window.clearTimeout(s),IA.delete(e)}n.qualityLimitationReason=p0.NONE,h8(e)}function ffe(e,n){var i;let s;switch(n){case xe.LocalAudioTrack:s=Bn.Audio;break;case xe.LocalVideoTrack:s=$e(i=e._hints).call(i,tr.SCREEN_TRACK)?Bn.Screen:Bn.High;break;case xe.LocalVideoLowTrack:s=Bn.Low}return s}function XL(e){const n=Cn();if(e.some(i=>i._bypassWebAudio))throw new Ie(Y.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!n.webAudioMediaStreamDest)throw new Ie(Y.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function JL(e,n){XL(e);const i=new yi;return e.forEach(s=>i.addAudioTrack(s)),i}const pfe=!Cn().supportUnifiedPlan||Z("CHROME_FORCE_PLAN_B")&&df();function OA(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i;return pfe?(i={spec:n,store:e},Ef("PlanBConnection").create(i)):new zd(n,e)}function QL(e){return e&&(e.iceConnectionState==="disconnected"||e.iceConnectionState==="checking"||e.iceConnectionState==="failed")}function m8(e){try{if(e.iceServers)return!1;if(e.turnServer&&e.turnServer.mode!=="off"){if(d0(e.turnServer.servers))return!1;if(Z("FORCE_TURN_TCP")||e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).some(n=>n.forceturn))return!0}return!1}catch{return!1}}var gn;function g8(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,s)}return i}function $u(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?g8(Object(i),!0).forEach(function(s){K(e,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):g8(Object(i)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(i,s))})}return e}let zd=(gn=class I_ extends mz{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var n,i;return(n=(i=this.peerConnection.getReceivers()[0])===null||i===void 0||(i=i.transport)===null||i===void 0?void 0:i.state)!==null&&n!==void 0?n:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(n=>n.rtpMap&&n.rtpMap.encodingName.toLowerCase()||"").filter(n=>{var i;return $e(i=Object.keys(qI)).call(i,n)}))]}constructor(n,i){super(n,i),K(this,"id",er(5,"connection-")),K(this,"store",void 0),K(this,"peerConnection",void 0),K(this,"forceTurn",!1),K(this,"remoteSDP",void 0),K(this,"initialOffer",void 0),K(this,"transportEventReceiver",void 0),K(this,"statsFilter",void 0),K(this,"extension",{useXR:Z("USE_XR")}),K(this,"localCapabilities",void 0),K(this,"remoteCodecs",void 0),K(this,"localCandidateCount",0),K(this,"allCandidatesReceived",!1),K(this,"isPreallocation",!1),K(this,"preSSRCMap",new Map),K(this,"dataStreamChannelMap",new Map),K(this,"establishPromise",void 0),K(this,"recoveredDataChannelIds",[]),K(this,"currentDataChannelId",1),K(this,"supportAV1RtpSpec",!1),K(this,"mutex",void 0),K(this,"qualityLimitationReason",p0.NONE),K(this,"isFirstConnected",!1),this.store=i,this.forceTurn=m8(n),this.mutex=new To("P2PConnection-mutex",i.clientId),this.peerConnection=new RTCPeerConnection(I_.resolvePCConfiguration(n),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=X1(this.peerConnection,Z("STATS_UPDATE_INTERVAL"),void 0,Nr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}getPreMedia(n){const i=this.preSSRCMap.get(n);if(i!==void 0){const s=this.peerConnection.getTransceivers().find(c=>c.mid===i);if(s)return{transceiver:s,track:s.receiver.track,id:i}}}async updateRemoteRTPCapabilities(n,i){if(this.remoteCodecs=i,!this.remoteSDP)return void k.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(i));if(this.remoteSDP.updateRemoteCodec(n,i,this.store.codec)){const s=await this.peerConnection.createOffer(),c=this.logSDPExchange(s.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(s);const u=this.remoteSDP.toString();c==null||c(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}else k.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const s=await this.peerConnection.createOffer();if(!s.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const c=qp(s.sdp),u=await xz({filterRTX:!Z("USE_PUB_RTX")&&!Z("USE_SUB_RTX"),filterVideoFec:Z("FILTER_VIDEO_FEC"),filterAudioFec:Z("FILTER_AUDIO_FEC"),filterVideoCodec:Z("FILTER_VIDEO_CODEC")},this.extension);if(this.localCapabilities=SA(u),this.initialOffer=s,Z("ENABLE_SVC")&&this.store.codec=="av1"){const p=await async function(){try{const _=new RTCPeerConnection;_.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:KI.L1T3}]});const E=await _.createOffer();if(!E.sdp)return void _.close();const S=la(E.sdp).mediaDescriptions[0];if(!S)return;const w=S.attributes.extmaps.find(I=>I.extensionName==="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension");return _.close(),w}catch{return}}();var n;p&&(this.supportAV1RtpSpec=!0,(n=u.send)===null||n===void 0||n.videoExtensions.push(p))}let h;return s.sdp&&Fz(s.sdp)&&(h=Lr(u),(i=h).send&&(ZE(ot.VIDEO,i.send.videoExtensions),ZE(ot.AUDIO,i.send.audioExtensions)),i.recv&&(ZE(ot.VIDEO,i.recv.videoExtensions),ZE(ot.AUDIO,i.recv.audioExtensions)),i.sendrecv&&(ZE(ot.VIDEO,i.sendrecv.videoExtensions),ZE(ot.AUDIO,i.sendrecv.audioExtensions))),$u($u({},c),{},{rtpCapabilities:h||u,offerSDP:s.sdp})}catch(s){throw new Ie(Y.GET_LOCAL_CONNECTION_PARAMS_FAILED,s.toString())}var i}async connect(n){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&Fz(this.initialOffer.sdp)&&(i=n.rtpCapabilities,s=this.localCapabilities,i.send&&(vA(ot.VIDEO,i.send.videoExtensions,s.send.videoExtensions),vA(ot.AUDIO,i.send.audioExtensions,s.send.audioExtensions)),i.recv&&(vA(ot.VIDEO,i.recv.videoExtensions,s.recv.videoExtensions),vA(ot.AUDIO,i.recv.audioExtensions,s.recv.audioExtensions))),this.remoteSDP=new class{get localCapabilities(){return Lr(this._localCapabilities)}get rtpCapabilities(){return Lr(this._rtpCapabilities)}get candidates(){return Lr(this._candidates)}get iceParameters(){return Lr(this._iceParameters)}get dtlsParameters(){return Lr(this._dtlsParameters)}constructor(E){let S=arguments.length>1&&arguments[1]!==void 0&&arguments[1];K(this,"sessionDesc",void 0),K(this,"_localCapabilities",void 0),K(this,"_rtpCapabilities",void 0),K(this,"_candidates",void 0),K(this,"_originCandidates",void 0),K(this,"_iceParameters",void 0),K(this,"_isUseExtmapAllowMixed",void 0),K(this,"_dtlsParameters",void 0),K(this,"setup",void 0),K(this,"currentMidIndex",void 0),K(this,"cname",void 0),K(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=S,E=Lr(E);const{iceParameters:w,dtlsParameters:I,candidates:P,rtpCapabilities:B,setup:M,localCapabilities:U,cname:$}=E;this._rtpCapabilities=B,this._candidates=P,this._originCandidates=Lr(P),this._iceParameters=w,this._dtlsParameters=I,this._localCapabilities=U,this.setup=M,this.cname=$,this.sessionDesc=this.updateRemoteRTPCapabilities(B),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}preloadRemoteMedia(E){const S=this.candidates,w=this.dtlsParameters,I=this.iceParameters,P=this.rtpCapabilities.send;let B=this.sessionDesc.mediaDescriptions.length-1;for(let M=1;M<E;M++){const U=2*M+2e4,$=2*M+l8,{ssrcs:q,ssrcGroups:ce}=i_([{ssrcId:U}],this.cname),{ssrcs:me,ssrcGroups:ge}=i_([{ssrcId:$,rtx:Z("USE_SUB_RTX")?$+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:P0,protos:["UDP","TLS","RTP","SAVPF"],fmts:P.videoCodecs.map(pe=>pe.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:I.iceUfrag,icePwd:I.icePwd,unrecognized:[],candidates:S,extmaps:P.videoExtensions,fingerprints:w.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:me,ssrcGroups:ge,rtcpFeedbackWildcards:[],payloads:P.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++B)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:P0,protos:["UDP","TLS","RTP","SAVPF"],fmts:P.audioCodecs.map(pe=>pe.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:I.iceUfrag,icePwd:I.icePwd,unrecognized:[],candidates:S,extmaps:P.audioExtensions,fingerprints:w.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:q,ssrcGroups:ce,rtcpFeedbackWildcards:[],payloads:P.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++B)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return Gp(this.sessionDesc)}send(E,S,w,I){const{ssrcs:P,ssrcGroups:B}=i_(S,this.cname,Z("SYNC_GROUP")?w:void 0),M=this.findPreloadMediaDesc(P);if(M){if(Nr()&&this.firefoxSsrcMidMap.set(P[0].ssrcId,M.attributes.mid),I&&(I.twcc||I.remb)){const U=this.sessionDesc.mediaDescriptions.indexOf(M);return this.sessionDesc.mediaDescriptions[U]=this.mungSendMediaDesc(M,I),{mid:M.attributes.mid,needExchangeSDP:!0}}return{mid:M.attributes.mid,needExchangeSDP:!1}}{const U=this.findAvailableMediaIndex(E,P);let $;return U===-1||U===1&&(lo()||function(){const q=vn();return!(q.name!==Nn.CHROME||!q.osVersion)&&Number(q.version)<=90}()||Z("ENABLE_ENCODED_TRANSFORM")&&uf())||U===0&&Z("USE_SUB_RTX")||h6()?($=this.createOrRecycleSendMedia(E,P,B,"sendonly",I),this.updateBundleMids()):($=Lr(this.sessionDesc.mediaDescriptions[U]),$.attributes.direction="sendonly",$.attributes.ssrcs=P,$.attributes.ssrcGroups=B,this.sessionDesc.mediaDescriptions[U]=this.mungSendMediaDesc($,I)),Nr()&&this.firefoxSsrcMidMap.set(P[0].ssrcId,$.attributes.mid),{mid:$.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:E,needExchangeSDP:S}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:E.attributes.mid,needExchangeSDP:S}}batchSend(E){const S=E.map(P=>{let{kind:B,ssrcMsg:M,mslabel:U}=P;return this.send(B,M,U)}),w=[];let I=!1;return S.forEach(P=>{let{mid:B,needExchangeSDP:M}=P;M&&(I=!0),w.push(B)}),{mids:w,needExchangeSDP:I}}stopSending(E){const S=this.sessionDesc.mediaDescriptions.filter(w=>w.attributes.mid&&E.indexOf(w.attributes.mid)!==-1);if(S.length!==E.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");S.forEach(w=>{w.attributes.mid==="0"||Nr()||h6()?w.attributes.ssrcs=[]:(w.attributes.ssrcs=[],w.attributes.direction="inactive",w.media.port="0")}),this.updateBundleMids()}mute(E){const S=this.sessionDesc.mediaDescriptions.find(w=>w.attributes.mid===E);if(!S)throw new Error("mediaDescription not found with ".concat(E," in remote SDP when calling RemoteSDP.mute."));S.attributes.direction="inactive"}unmute(E){const S=this.sessionDesc.mediaDescriptions.find(w=>w.attributes.mid===E);if(!S)throw new Error("mediaDescription not found with ".concat(E," in remote SDP when calling RemoteSDP.unmute."));S.attributes.direction="sendonly"}muteRemote(E){const S=this.sessionDesc.mediaDescriptions.filter(w=>$e(E).call(E,w.attributes.mid||""));if(S.length!==E.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");S.forEach(w=>{w.attributes.direction="inactive"})}unmuteRemote(E){const S=this.sessionDesc.mediaDescriptions.filter(w=>$e(E).call(E,w.attributes.mid||""));if(S.length!==E.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");S.forEach(w=>{w.attributes.direction="recvonly"})}receive(E,S,w,I){E.forEach((P,B)=>{this.createOrRecycleRecvMedia(P,[],"recvonly",S,w,I[B])}),this.updateBundleMids()}stopReceiving(E){const S=this.sessionDesc.mediaDescriptions.filter(w=>E.indexOf(w.attributes.mid)!==-1);if(S.length!==E.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");S.forEach(w=>{w.media.port="0",w.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(E){const S=this.sessionDesc||la((w=this._isUseExtmapAllowMixed,`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite`.concat(w?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`)));var w;this._rtpCapabilities=E;const I=this.rtpCapabilities.send,P=this.localCapabilities.send;for(const B of S.mediaDescriptions){if(B.attributes.iceUfrag=this._iceParameters.iceUfrag,B.attributes.icePwd=this._iceParameters.icePwd,B.attributes.fingerprints=this._dtlsParameters.fingerprints,B.attributes.candidates=this._candidates,B.attributes.setup=this.setup,B.media.mediaType==="application"&&(B.attributes.sctpPort="5000"),B.media.mediaType==="video"){if(I.videoCodecs.length===0){const M=P.videoCodecs.filter(U=>{var $,q;return($=U.rtpMap)===null||$===void 0?void 0:$e(q=$.encodingName.toLowerCase()).call(q,"vp8")})||[P.videoCodecs[0]];B.media.fmts=M.map(U=>U.payloadType.toString(10)),B.attributes.payloads=M,B.attributes.extmaps=[]}else if(B.media.fmts=I.videoCodecs.map(M=>M.payloadType.toString(10)),B.attributes.payloads=I.videoCodecs,B.attributes.extmaps=I.videoExtensions,Z("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:M,ssrcGroups:U}=i_([{ssrcId:l8,rtx:Z("USE_SUB_RTX")?40001:void 0}],this.cname);B.attributes.ssrcs=M,B.attributes.ssrcGroups=U}}if(B.media.mediaType==="audio"){if(I.audioCodecs.length===0){const M=P.audioCodecs.filter(U=>{var $,q;return($=U.rtpMap)===null||$===void 0?void 0:$e(q=$.encodingName.toLowerCase()).call(q,"opus")})||[P.audioCodecs[0]];B.media.fmts=M.map(U=>U.payloadType.toString(10)),B.attributes.payloads=M,B.attributes.extmaps=[]}else if(B.media.fmts=I.audioCodecs.map(M=>M.payloadType.toString(10)),B.attributes.payloads=I.audioCodecs,B.attributes.extmaps=I.audioExtensions,ty(B),Z("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:M,ssrcGroups:U}=i_([{ssrcId:2e4}],this.cname);B.attributes.ssrcs=M,B.attributes.ssrcGroups=U}}}return this.sessionDesc=S,this.currentMidIndex=S.mediaDescriptions.length-1,this.sessionDesc}updateCandidates(E){const S=this._originCandidates.filter(I=>I.transport==="udp"),w=[];if(S.forEach(I=>{w.push(c8(c8({},I),{},{foundation:"tcpcandidate",priority:Number(I.priority)-1+"",transport:"tcp",port:Number(I.port)+90+""}))}),S.length!==0){switch(E){case wo.TCP_RELAY:this._candidates=w;break;case wo.UDP_TCP_RELAY:case wo.RELAY:this._candidates=[...S,...w];break;default:this._candidates=S}for(const I of this.sessionDesc.mediaDescriptions)I.attributes.candidates=this.candidates}}restartICE(E){E=Lr(E),this._iceParameters=E,this.sessionDesc.mediaDescriptions.forEach(S=>{S.attributes.iceUfrag=E.iceUfrag,S.attributes.icePwd=E.icePwd})}predictReceivingMids(E){const S=[];for(let w=0;w<E;w++)S.push((this.currentMidIndex+w+1).toString(10));return S}findAvailableMediaIndex(E,S){return this.sessionDesc.mediaDescriptions.findIndex(w=>{const I=w.media.mediaType===E&&w.media.port!=="0"&&(w.attributes.direction==="sendonly"||w.attributes.direction==="sendrecv")&&w.attributes.ssrcs.length===0;if(Nr()){if(I){const P=this.firefoxSsrcMidMap.get(S[0].ssrcId);return!(P||w.attributes.mid!=="0"&&w.attributes.mid!=="1")||!(!P||P!==w.attributes.mid)}return!1}return I})}createOrRecycleDataChannel(){for(const w of this.sessionDesc.mediaDescriptions)if(w.media.mediaType==="application")return{mediaDesc:w,needExchangeSDP:!1};this.currentMidIndex+=1;const E="".concat(this.currentMidIndex),S={media:{mediaType:"application",port:P0,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(E),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(S),{mediaDesc:S,needExchangeSDP:!0}}createOrRecycleRecvMedia(E,S,w,I,P,B){const M=E._mediaStreamTrack.kind,U=this.rtpCapabilities.recv,$=R0(M,U,this.localCapabilities.send,M===ot.VIDEO?I:P),q=M===ot.VIDEO?U.videoExtensions:U.audioExtensions;this.currentMidIndex+=1;const ce="".concat(this.currentMidIndex);let me={media:{mediaType:M,port:P0,protos:["UDP","TLS","RTP","SAVPF"],fmts:$.map(pe=>pe.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:q,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:S,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:$,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:w,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(ce)}};me=this.mungRecvMediaDsec(me,E,B);const ge=this.findFirstClosedMedia(M);if(ge){const pe=this.sessionDesc.mediaDescriptions.indexOf(ge);this.sessionDesc.mediaDescriptions[pe]=me}else this.sessionDesc.mediaDescriptions.push(me);return me}updateRemoteCodec(E,S,w){const I=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(me=>me.rtpMap&&me.rtpMap.encodingName.toLowerCase()||"").filter(me=>{var ge;return $e(ge=Object.keys(qI)).call(ge,me)}))],P=new Set(S);if(I.every(me=>P.has(me)))return k.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(S)),!1;const B=this._rtpCapabilities.recv.videoCodecs.filter(me=>S.some(ge=>{var pe;return $e(pe=me.rtpMap&&me.rtpMap.encodingName.toLowerCase()||"").call(pe,ge)}));if(B.length===0)return k.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(I," codecs: ").concat(S)),!1;const M=[...new Set(B.map(me=>me.rtpMap&&me.rtpMap.encodingName.toLowerCase()||""))];let U;if(k.debug("updateRemoteCodec, from ".concat(I," to ").concat(M)),E.length===0)U=this.sessionDesc.mediaDescriptions.filter(me=>me.media.mediaType==="video"&&me.attributes.direction==="recvonly");else if(U=this.sessionDesc.mediaDescriptions.filter(me=>me.attributes.mid&&$e(E).call(E,me.attributes.mid)&&me.attributes.direction==="recvonly"),U.length!==E.length)return k.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(E,", codecs: ").concat(S)),!1;if(Z("USE_PUB_RTX")||Z("USE_SUB_RTX")){const me=VL(B,this.rtpCapabilities.recv.videoCodecs);B.push(...me)}this._rtpCapabilities.recv.videoCodecs=B;const $=this.localCapabilities.send,q=this.rtpCapabilities.recv,ce=R0(ot.VIDEO,q,$,w);return U.forEach(me=>{const ge=ce.map(pe=>pe.payloadType.toString(10));k.debug("updateRemoteCodec mid: ".concat(me.attributes.mid,", from"),me.attributes.payloads,"to",ce),me.attributes.payloads=ce,me.media.fmts=ge}),!0}createOrRecycleSendMedia(E,S,w,I,P){const B=this.rtpCapabilities.send,M=E===ot.VIDEO?B.videoCodecs:B.audioCodecs,U=E===ot.VIDEO?B.videoExtensions:B.audioExtensions;this.currentMidIndex+=1;const $="".concat(this.currentMidIndex);let q={media:{mediaType:E,port:P0,protos:["UDP","TLS","RTP","SAVPF"],fmts:M.map(me=>me.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:U,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:S,ssrcGroups:w,rtcpFeedbackWildcards:[],payloads:M,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:I,rtcpMux:!0,rtcpRsize:!0,mid:"".concat($)}};q=this.mungSendMediaDesc(q,P);const ce=this.findFirstClosedMedia(E);if(ce){const me=this.sessionDesc.mediaDescriptions.indexOf(ce);this.sessionDesc.mediaDescriptions[me]=q}else this.sessionDesc.mediaDescriptions.push(q);return q}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(E=>E.media.port!=="0").map(E=>E.attributes.mid)}mungRecvMediaDsec(E,S,w){const I=Lr(E);return ML(I),ey(I,S),UL(I,S),Dz(I),yA(I,w,this.localCapabilities.send),I}mungSendMediaDesc(E,S){const w=Lr(E);return yA(w,S,this.localCapabilities.recv),ty(w),w}updateRecvMedia(E,S){const w=this.sessionDesc.mediaDescriptions.findIndex(I=>I.attributes.mid===E);if(w!==-1){const I=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[w],S);this.sessionDesc.mediaDescriptions[w]=I}}bumpMid(E){this.currentMidIndex+=E}findFirstClosedMedia(E){return this.sessionDesc.mediaDescriptions.find(S=>Nr()?S.media.port==="0"&&S.media.mediaType===E:S.media.port==="0")}findPreloadMediaDesc(E){return this.sessionDesc.mediaDescriptions.find(S=>{var w;return((w=S.attributes)===null||w===void 0||(w=w.ssrcs[0])===null||w===void 0?void 0:w.ssrcId)===E[0].ssrcId})}getSSRC(E){var S;return(S=this.sessionDesc.mediaDescriptions.find(w=>w.attributes.mid===E))===null||S===void 0?void 0:S.attributes.ssrcs}}($u($u({},n),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec),n.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const c=this.remoteSDP.toString(),u=Uz(this.initialOffer.sdp,this.extension),h=this.logSDPExchange(u||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:u}),h==null||h(c),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c});const p=this.peerConnection.getTransceivers()[0];if(p!=null&&p.receiver&&this.tryBindTransportEvents(p.receiver),Z("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia(Z("PRELOAD_MEDIA_COUNT"));const E=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:E});const S=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(S)}const{preSSRCs:_}=n;if(Array.isArray(_)&&_.length>0){const{mids:E}=this.remoteSDP.batchSend(_.map(S=>({kind:S.kind,ssrcMsg:[{ssrcId:S.ssrcId,rtx:S.rtx}],mslabel:S.mslabel})));E.forEach((S,w)=>{this.preSSRCMap.set(_[w].ssrcId,S)}),await C0(this.peerConnection,this.remoteSDP,this.extension),k.debug("[".concat(this.store.clientId,"] [P2PConnection] pre-batchReceive exchange SDP."))}}catch(c){throw new Ie(Y.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(c.toString()))}var i,s}async updateRemoteConnect(n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");const{rtpCapabilities:i}=n;this.remoteSDP.updateRemoteRTPCapabilities(i),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const{preSSRCs:s}=n;if(Array.isArray(s)&&s.length>0){const{mids:c}=this.remoteSDP.batchSend(s.map(u=>Object.assign({},{kind:u.kind,ssrcMsg:[{ssrcId:u.ssrcId,rtx:u.rtx}],mslabel:u.mslabel})));c.forEach((u,h)=>{this.preSSRCMap.set(s[h].ssrcId,u)})}await C0(this.peerConnection,this.remoteSDP,this.extension),k.debug("[P2PConnection] updateRemoteRTPCapabilities by exchanging SDP.")}catch(i){throw new Ie(Y.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(i.toString()))}}send(n,i,s){var c=this;return Zc(function*(){const u=yield _n(c.mutex.lock("From P2PConnection.send"));try{if(!c.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const h=[],p=_A();n.forEach(U=>{const $=c.peerConnection.addTransceiver(U._mediaStreamTrack,$u({direction:"sendonly"},U.trackMediaType==="video"&&c.supportAV1RtpSpec&&p?{sendEncodings:[{scalabilityMode:p}]}:{}));h.push($),U._updateRtpTransceiver($)}),Nr()&&Z("SIMULCAST")===!0&&(yield _n(c.applySimulcastForFirefox(h,n)));const _=yield _n(c.peerConnection.createOffer()),E=c.remoteSDP.predictReceivingMids(n.length),S=c.mungSendOfferSDP(_.sdp,n,E),w=la(S),I=E.map(U=>{const $=w.mediaDescriptions.find(q=>q.attributes.mid===U);if(!$)throw new Error("Cannot extract ssrc from mediaDescription.");return Pz($,Z("USE_PUB_RTX"))});let P;try{P=yield I}catch(U){P=[],c.remoteSDP.receive(n,i,s,P);const $=c.remoteSDP.toString();throw yield _n(c.peerConnection.setLocalDescription({type:"offer",sdp:S})),yield _n(c.peerConnection.setRemoteDescription({type:"answer",sdp:$})),yield _n(c.stopSending(E,!0)),U}c.remoteSDP.receive(n,i,s,P);const B=c.remoteSDP.toString(),M=c.logSDPExchange(S,"offer","local","send");return yield _n(c.peerConnection.setLocalDescription({type:"offer",sdp:S})),yield _n(c.applySimulcastEncodings(h,n)),yield _n(c.applySendEncodings(h,n)),M==null||M(B),yield _n(c.peerConnection.setRemoteDescription({type:"answer",sdp:B})),h.map((U,$)=>{const q=E[$];return{localSSRC:I[$],id:q,transceiver:U}})}catch(h){throw h instanceof Ie?h:new Ie(Y.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{u()}})()}async createDataChannels(n,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let s=this.dataStreamChannelMap.get(n);if(s&&s.readyState==="open")k.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const u=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof u!="number")throw new Error("create DataChannel error, because cannot get dc id");s=this.peerConnection.createDataChannel("datastream-channel",{id:u,negotiated:!0,ordered:!1,maxRetransmits:Z("DATASTREAM_MAX_RETRANSMITS")}),s.binaryType="arraybuffer",this.dataStreamChannelMap.set(n,s)}i.forEach(u=>{u._updateOriginDataChannel(s)});const{needExchangeSDP:c}=this.remoteSDP.sendDataChannel();if(c){const u=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:u});const h=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(h),k.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else k.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(s){throw s instanceof Ie?s:new Ie(Y.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(s.toString()))}}async stopDataChannels(n){try{const i=this.dataStreamChannelMap.get(n);return i&&(i.id&&this.recoveredDataChannelIds.push(i.id),i.close()),void this.dataStreamChannelMap.delete(n)}catch(i){throw i instanceof Ie?i:new Ie(Y.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(i.toString()))}}async stopSending(n,i){const s=i?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const c=this.peerConnection.getTransceivers().filter(_=>n.indexOf(_.mid)!==-1);if(c.length!==n.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");c.map(_=>{var E;AA(this.id+_.mid,this),_.direction="inactive",(E=_.stop)===null||E===void 0||E.call(_)});const u=await this.peerConnection.createOffer(),h=this.logSDPExchange(u.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(u),this.remoteSDP.stopReceiving(n);const p=this.remoteSDP.toString();h==null||h(p),await this.peerConnection.setRemoteDescription({type:"answer",sdp:p})}catch(c){throw new Ie(Y.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(c.toString()))}finally{s&&s()}}async receive(n,i,s,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(n," before remoteSDP created."));const{mid:u,needExchangeSDP:h}=this.remoteSDP.send(n,i,s,c);h&&(await C0(this.peerConnection,this.remoteSDP,this.extension),k.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(n," by exchanging SDP.")));const p=this.peerConnection.getTransceivers().find(_=>_.mid===u);if(!p)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:p.receiver.track,id:u,transceiver:p}}catch(u){throw new Ie(Y.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async batchReceive(n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:i,needExchangeSDP:s}=this.remoteSDP.batchSend(n);return s&&(await C0(this.peerConnection,this.remoteSDP,this.extension),k.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),i.map(c=>{const u=this.peerConnection.getTransceivers().find(h=>h.mid===c);if(!u)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:u.receiver.track,id:c,transceiver:u}})}catch(i){throw new Ie(Y.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(i.toString()))}}async stopReceiving(n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");n.forEach(u=>{Array.from(this.preSSRCMap.entries()).some(h=>{let[p,_]=h;if(_===u)return this.preSSRCMap.delete(p),!0})}),this.remoteSDP.stopSending(n);const i=this.remoteSDP.toString(),s=this.logSDPExchange(i,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const c=await this.peerConnection.createAnswer();s==null||s(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(i){throw new Ie(Y.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}async muteRemote(n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(n," before remote SDP created."));this.remoteSDP.mute(n);const i=this.remoteSDP.toString(),s=this.logSDPExchange(i,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const c=await this.peerConnection.createAnswer();s==null||s(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(i){throw new Ie(Y.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(i.toString()))}}async unmuteRemote(n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(n," before remote SDP created."));this.remoteSDP.unmute(n);const i=this.remoteSDP.toString(),s=this.logSDPExchange(i,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const c=await this.peerConnection.createAnswer();s==null||s(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(i){throw new Ie(Y.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(i.toString()))}}async muteLocal(n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const i=this.peerConnection.getTransceivers().filter(h=>h.mid&&n.indexOf(h.mid)!==-1);if(i.length!==n.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(h=>{h.direction="inactive"});const s=await this.peerConnection.createOffer(),c=this.logSDPExchange(s.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(s),this.remoteSDP.muteRemote(n);const u=this.remoteSDP.toString();c==null||c(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(i){throw new Ie(Y.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(i.toString()))}}async unmuteLocal(n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const i=this.peerConnection.getTransceivers().filter(h=>h.mid&&n.indexOf(h.mid)!==-1);if(i.length!==n.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(async(h,p)=>{h.direction="sendonly"});const s=await this.peerConnection.createOffer(),c=this.logSDPExchange(s.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(s),this.remoteSDP.unmuteRemote(n),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(n,this.remoteCodecs,this.store.codec);const u=this.remoteSDP.toString();c==null||c(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(i){throw new Ie(Y.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(i.toString()))}}restartICE(n){var i=this;return Zc(function*(){const s=yield _n(i.mutex.lock("From P2PConnection.restartICE"));try{if(!i.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const c=Cn().supportPCSetConfiguration,u=Z("FORCE_TURN_TCP")||i.forceTurn;if(n===wo.RELAY&&!c)return;if(c&&!u){const w=n===wo.RELAY?"relay":"all",I=i.peerConnection.getConfiguration();I.iceTransportPolicy!==w&&(k.debug("[".concat(i.store.clientId,"] restartICE change iceTransportPolicy from [").concat(I.iceTransportPolicy,"] to [").concat(w,"]")),I.iceTransportPolicy=w,i.peerConnection.setConfiguration(I))}i.remoteSDP.updateCandidates(n);const h=yield _n(i.peerConnection.createOffer({iceRestart:!0}));if(!h.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const p=qp(h.sdp),{remoteIceParameters:_}=yield p.iceParameters;i.remoteSDP.restartICE(_);const E=i.remoteSDP.toString(),S=i.logSDPExchange(h.sdp||"","offer","local","restartICE");i.store.descriptionStart(),yield _n(i.peerConnection.setLocalDescription(h)),S==null||S(E),yield _n(i.peerConnection.setRemoteDescription({type:"answer",sdp:E}))}catch(c){k.warning("[".concat(i.store.clientId,"] restart ICE failed, abort operation"),c)}finally{s()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const n=await this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates(wo.TCP_RELAY),await C0(this.peerConnection,this.remoteSDP,this.extension)}catch(i){k.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),i)}finally{n()}}close(){var n;this.peerConnection.getTransceivers().forEach(i=>{AA(this.id+i.mid,this)}),this.preSSRCMap.clear(),this.peerConnection.close(),(n=this.onConnectionStateChange)===null||n===void 0||n.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return $u($u({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(n){return this.statsFilter.getVideoIsReady(n)}async updateEncoderConfig(n,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const s=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(s.sdp,[i],[n]);this.remoteSDP.updateRecvMedia(n,i);const u=this.remoteSDP.toString(),h=this.logSDPExchange(c,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),h==null||h(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(s){throw new Ie(Y.EXCHANGE_SDP_FAILED,s.toString())}}async updateSendParameters(n,i){const s=this.peerConnection.getTransceivers().filter(c=>c.mid===n);s.length===1&&(this.isVP8Simulcast(i)?Nr()||await this.applySimulcastEncodings(s,[i]):await this.applySendEncodings(s,[i]))}setStatsRemoteVideoIsReady(n,i){this.statsFilter.setVideoIsReady2(n,i)}async replaceTrack(n,i){const s=this.peerConnection.getTransceivers().find(c=>c.mid===i);s&&await s.sender.replaceTrack(n._mediaStreamTrack)}async getSelectedCandidatePair(){const n=this.peerConnection.getReceivers();if(n.length>0&&n[0].transport&&n[0].transport.iceTransport&&n[0].transport.iceTransport.getSelectedCandidatePair&&n[0].transport.iceTransport.getSelectedCandidatePair()){const i=n[0].transport.iceTransport,{local:s,remote:c}=i.getSelectedCandidatePair();return{local:$u($u({},Vd),{},{candidateType:s.type,protocol:s.protocol,address:s.address,port:s.port}),remote:$u($u({},Vd),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var n;(n=this.onICEConnectionStateChange)===null||n===void 0||n.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var n;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(n=this.onConnectionStateChange)===null||n===void 0||n.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=n=>{if(n&&(n.errorCode||n.errorText)){var i;const s="code: ".concat(n.errorCode,", message: ").concat(n.errorText),c=n.port?"local: ".concat(n.port):"";k.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(s,"), url: ").concat(n.url||"",", host_candidate:").concat(c)),(i=this.onICECandidateError)===null||i===void 0||i.call(this,s)}},this.peerConnection.onicegatheringstatechange=n=>{n&&n.target&&"iceGatheringState"in n.target&&k.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(n.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=n=>{n.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,k.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,k.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},Z("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(n){const i={iceServers:[]};return n.iceServers?i.iceServers=n.iceServers:n.turnServer&&(d0(n.turnServer.servers)?i.iceServers=n.turnServer.servers:Z("NEW_TURN_MODE")&&i.iceServers?(Z("USE_TURN_SERVER_OF_GATEWAY")?n.turnServer.serversFromGateway&&i.iceServers.push(...I_.newTurnServerConfigToIceServers(n.turnServer.serversFromGateway)):i.iceServers.push(...I_.newTurnServerConfigToIceServers(n.turnServer.servers)),Z("NEW_FORCE_TURN")&&(i.iceTransportPolicy="relay")):n.turnServer.mode!=="off"&&(i.iceServers&&i.iceServers.push(...I_.turnServerConfigToIceServers(n.turnServer.servers)),Z("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&n.turnServer.serversFromGateway&&i.iceServers.push(...I_.turnServerConfigToIceServers(n.turnServer.serversFromGateway)),Z("FORCE_TURN_TCP")?i.iceTransportPolicy="relay":n.turnServer.servers.concat(n.turnServer.serversFromGateway||[]).forEach(s=>{s.forceturn&&(i.iceTransportPolicy="relay")}))),Z("ENABLE_ENCODED_TRANSFORM")&&Cn().supportWebRTCEncodedTransform&&(i.encodedInsertableStreams=!0),i}static turnServerConfigToIceServers(n){const i=[];return n.forEach(s=>{s.security?s.tcpport&&i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turns:".concat(Kp(s.turnServerURL),":").concat(s.tcpport,"?transport=tcp")}):(s.udpport&&!Z("FORCE_TURN_TCP")&&i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.udpport,"?transport=udp")}),s.tcpport&&i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.tcpport,"?transport=tcp")}))}),i}static newTurnServerConfigToIceServers(n){const i=[];return n.forEach(s=>{const c=Z("NEW_TURN_MODE");c===1?i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":3478?transport=udp")}):c===2?i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":3478?transport=tcp")}):c===3?i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turns:".concat(Kp(s.turnServerURL),":443?transport=tcp")}):c===4&&(i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":3478?transport=udp")}),i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":3478?transport=tcp")}),i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turns:".concat(Kp(s.turnServerURL),":443?transport=tcp")}))}),i}tryBindTransportEvents(n){const i=n.transport;if(i){this.transportEventReceiver=n,i.onstatechange=()=>{var c;i!=null&&i.state&&((c=this.onDTLSTransportStateChange)===null||c===void 0||c.call(this,i.state))},i.onerror=c=>{var u;(u=this.onDTLSTransportError)===null||u===void 0||u.call(this,"error"in c?c.error:c)};const s=i.iceTransport;s&&(s.onstatechange=()=>{const c=i==null?void 0:i.iceTransport.state;var u;c&&((u=this.onICETransportStateChange)===null||u===void 0||u.call(this,c))},s.getSelectedCandidatePair&&(s.onselectedcandidatepairchange=()=>{if(s.getSelectedCandidatePair()){const{local:c,remote:u}=s.getSelectedCandidatePair();k.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:c.type,protocol:c.protocol}),", remote ").concat(JSON.stringify({candidateType:u.type,protocol:u.protocol,address:u.address,port:u.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(n,i){var s,c;if(i||(i=this.peerConnection.getSenders().find(U=>U.track===n._mediaStreamTrack)),!i)return k.warn("[".concat(n.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(n))return k.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Cn().supportSetRtpSenderParameters)return k.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const u={},h={};switch(n._optimizationMode){case"motion":u.degradationPreference="maintain-framerate";break;case"detail":u.degradationPreference="maintain-resolution";break;case"balanced":u.degradationPreference="balanced"}const p=function(M,U){return M.getTransceivers().find($=>$.sender.track===U||$.receiver.track===U)}(this.peerConnection,n._mediaStreamTrack),_=Zde(n);if(hfe(n)&&p&&i&&_&&this.getLocalVideoStats&&$e(s=["vp8","vp9"]).call(s,this.store.codec)){var E;const M=u.degradationPreference||($e(E=n._hints).call(E,tr.CUSTOM_TRACK)?Z("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(U,$,q,ce,me,ge){if(AA(U,q),me($),ce!=="balanced"&&ce!=="maintain-framerate"&&ce!=="maintain-resolution")return;let pe=-1;h8(U,$);const Re=window.setInterval(()=>{const Ze=IA.get(U);if(!Z("ENABLE_AG_ADAPTATION")||!Ze)return AA(U,q),void me($);const rt=ge();if(rt.sendPackets>0&&rt.OutgoingAvailableBandwidth>0){if(pe===-1)return void(pe=Date.now());if(Date.now()-pe<1e3)return;const un=rt.sendFrameRate,dn=rt.OutgoingAvailableBandwidth,[nr,Qr]=dfe(U,un,dn,Ze.adaptationConfig,$,ce);Qr&&(q.qualityLimitationReason=Qr),nr&&Ze.adaptationConfig.scale!==nr.scale&&(k.debug("[".concat(U,"] applyAdaptation: ").concat(q.qualityLimitationReason,`
           sendFps `).concat(un,", bwe ").concat(dn,", switch from ").concat(Ze.adaptationConfig.scale," to ").concat(nr.scale," ")),Ze.adaptationConfig=YL(YL({},Ze.adaptationConfig),nr),me(nr))}},Z("CHECK_LOCAL_STATS_INTERVAL")),Ve=YL({},$);IA.set(U,{timer:Re,adaptationConfig:Ve,originConfig:$,adaptationFunc:me}),k.debug("[".concat(U,"] start adaptation, originConfig: ").concat(JSON.stringify($),", degradationPreference: ").concat(ce))})(this.id+p.mid,_,this,M,U=>{i&&this.updateAdaptation(i,U)},this.getLocalVideoStats.bind(this))}if(n._encoderConfig){var S;const{bitrateMax:M,frameRate:U,scaleResolutionDownBy:$}=n._encoderConfig;M&&(h.maxBitrate=1e3*M),($e(S=n._hints).call(S,tr.LOW_STREAM)||n.isUseScaleResolutionDownBy)&&(U&&(h.maxFramerate=Ba(U)),$&&$>=1&&(h.scaleResolutionDownBy=$))}const{maxFramerate:w}=Z("ENCODER_CONFIG_LIMIT");if(w&&typeof w=="number"&&(h.maxFramerate=h.maxFramerate?Math.min(h.maxFramerate,w):w),Z("DSCP_TYPE")&&df()){var I;const M=Z("DSCP_TYPE");$e(I=["very-low","low","medium","high"]).call(I,M)&&(h.networkPriority=M)}const P=i.getParameters(),B=(c=P.encodings)===null||c===void 0?void 0:c[0];Nr()&&!B&&(u.encodings=[h]),B&&Object.assign(B,h),Object.assign(P,u),k.debug("[".concat(n.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(P.encodings))),await i.setParameters(P),await async function(M,U,$){try{var q;if(!Cn().supportSetRtpSenderParameters||!function(Re){return Re==="vp9"||Re==="av1"}(M)||!Z("ENABLE_SVC"))return;const ce={},me={},ge=U.getParameters(),pe=(q=ge.encodings)===null||q===void 0?void 0:q[0];me.scalabilityMode=_A($),pe&&Object.assign(pe,me),Object.assign(ge,ce),await U.setParameters(ge),k.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(ge.encodings)))}catch(ce){k.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",ce)}}(this.store.codec,i,Z("SVC_MODE"))}async updateAdaptation(n,i){var s,c;if(!n)return k.debug("[updateAdaptation] no rtpSender found");if(!Cn().supportSetRtpSenderParameters)return k.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const u={},{bitrateMax:h,frameRate:p,scaleResolutionDownBy:_}=i;h&&(u.maxBitrate=1e3*h),p&&(u.maxFramerate=Ba(p)),_&&_>=1&&$e(s=["vp8","vp9"]).call(s,this.store.codec)&&(u.scaleResolutionDownBy=_);const E=n.getParameters(),S=(c=E.encodings)===null||c===void 0?void 0:c[0];S&&Object.assign(S,u),Object.assign(E,{});try{await n.setParameters(E),k.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(E.encodings)))}catch(w){!("transport"in n)||n.transport&&n.transport.state==="connected"?this.peerConnectionState!=="connected"?k.debug("[updateAdaptation] peerConnection not connected}"):k.debug("[updateAdaptation] updateRtpSenderEncodings failed",w):k.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(n,i){try{if(!Cn().supportSetRtpSenderParameters||n.length!==i.length)return;for(let s=0;s<n.length;s++){const c=n[s],u=i[s];u instanceof ur&&!this.isVP8Simulcast(u)&&await this.updateRtpSenderEncodings(u,c.sender)}}catch{k.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(n,i,s){const c=la(n);return i.forEach((u,h)=>{const p=s[h],_=c.mediaDescriptions.find(E=>E.attributes.mid===p);_&&(ey(_,u),Lz(_,u,this.store.codec))}),Gp(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=n=>{var i;(i=this.onFirstAudioReceived)===null||i===void 0||i.call(this,n)},this.statsFilter.onFirstVideoReceived=n=>{var i;(i=this.onFirstVideoReceived)===null||i===void 0||i.call(this,n)},this.statsFilter.onFirstAudioDecoded=n=>{var i;(i=this.onFirstAudioDecoded)===null||i===void 0||i.call(this,n)},this.statsFilter.onFirstVideoDecoded=(n,i,s)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,n,i,s)},this.statsFilter.onSelectedLocalCandidateChanged=(n,i)=>{var s;(s=this.onSelectedLocalCandidateChanged)===null||s===void 0||s.call(this,n,i)},this.statsFilter.onSelectedRemoteCandidateChanged=(n,i)=>{var s;(s=this.onSelectedRemoteCandidateChanged)===null||s===void 0||s.call(this,n,i)},this.statsFilter.onFirstVideoDecodedTimeout=n=>{var i;(i=this.onFirstVideoDecodedTimeout)===null||i===void 0||i.call(this,n)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(n,i){if(n.length===i.length)for(let _=0;_<n.length;_++){var s,c,u,h,p;const E=n[_],S=i[_];if(S instanceof ur&&!$e(s=S._hints).call(s,tr.LOW_STREAM)&&(c=S._encoderConfig)!==null&&c!==void 0&&c.bitrateMax&&((u=S._encoderConfig)===null||u===void 0?void 0:u.bitrateMax)>200&&(h=S._scalabilityMode)!==null&&h!==void 0&&h.numSpatialLayers&&((p=S._scalabilityMode)===null||p===void 0?void 0:p.numSpatialLayers)>1&&this.store.codec==="vp8"){const w={},I={high:1e3*(S._encoderConfig.bitrateMax-50),medium:5e4};w.encodings=[{rid:"m",active:!0,maxBitrate:I.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:I.high}];const P=E.sender.getParameters();await E.sender.setParameters(Object.assign(P,w))}}}async applySimulcastEncodings(n,i){if(!Nr()&&n.length===i.length)for(let s=0;s<n.length;s++){const c=i[s];if(c instanceof ur&&this.isVP8Simulcast(c)){const u=n[s],h={},p={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};h.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:p.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:p.medium,scaleResolutionDownBy:4}];const _=u.sender.getParameters();await u.sender.setParameters(Object.assign(_,h))}}}isVP8Simulcast(n){var i,s,c,u,h;return!!(n instanceof ur&&Z("SIMULCAST")&&this.store.codec==="vp8"&&!$e(i=n._hints).call(i,tr.LOW_STREAM)&&(s=n._encoderConfig)!==null&&s!==void 0&&s.bitrateMax&&((c=n._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(u=n._scalabilityMode)!==null&&u!==void 0&&u.numSpatialLayers&&((h=n._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1)}logSDPExchange(n,i,s,c){if(Z("SDP_LOGGING"))return k.upload("[".concat(this.store.clientId,"] exchanging ").concat(s," ").concat(i," SDP during P2PConnection.").concat(c,`
`),n),i==="offer"?u=>{this.logSDPExchange(u,"answer",s==="local"?"remote":"local",c)}:void 0}async getRemoteSSRC(n){if(!this.remoteSDP)return;const i=this.remoteSDP.getSSRC(n);return i&&i.length!==0?i[0].ssrcId:void 0}setConfiguration(n){if(Cn().supportPCSetConfiguration){const i=I_.resolvePCConfiguration(n);this.peerConnection.setConfiguration(i)}}},ut(gn.prototype,"updateRemoteRTPCapabilities",[Ms],Object.getOwnPropertyDescriptor(gn.prototype,"updateRemoteRTPCapabilities"),gn.prototype),ut(gn.prototype,"connect",[Ms],Object.getOwnPropertyDescriptor(gn.prototype,"connect"),gn.prototype),ut(gn.prototype,"updateRemoteConnect",[Ms],Object.getOwnPropertyDescriptor(gn.prototype,"updateRemoteConnect"),gn.prototype),ut(gn.prototype,"createDataChannels",[Ms],Object.getOwnPropertyDescriptor(gn.prototype,"createDataChannels"),gn.prototype),ut(gn.prototype,"receive",[Ms],Object.getOwnPropertyDescriptor(gn.prototype,"receive"),gn.prototype),ut(gn.prototype,"batchReceive",[Ms],Object.getOwnPropertyDescriptor(gn.prototype,"batchReceive"),gn.prototype),ut(gn.prototype,"stopReceiving",[Ms],Object.getOwnPropertyDescriptor(gn.prototype,"stopReceiving"),gn.prototype),ut(gn.prototype,"muteRemote",[Ms],Object.getOwnPropertyDescriptor(gn.prototype,"muteRemote"),gn.prototype),ut(gn.prototype,"unmuteRemote",[Ms],Object.getOwnPropertyDescriptor(gn.prototype,"unmuteRemote"),gn.prototype),ut(gn.prototype,"muteLocal",[Ms],Object.getOwnPropertyDescriptor(gn.prototype,"muteLocal"),gn.prototype),ut(gn.prototype,"unmuteLocal",[Ms],Object.getOwnPropertyDescriptor(gn.prototype,"unmuteLocal"),gn.prototype),ut(gn.prototype,"close",[Ms],Object.getOwnPropertyDescriptor(gn.prototype,"close"),gn.prototype),ut(gn.prototype,"updateEncoderConfig",[Ms],Object.getOwnPropertyDescriptor(gn.prototype,"updateEncoderConfig"),gn.prototype),ut(gn.prototype,"updateSendParameters",[Ms],Object.getOwnPropertyDescriptor(gn.prototype,"updateSendParameters"),gn.prototype),ut(gn.prototype,"replaceTrack",[Ms],Object.getOwnPropertyDescriptor(gn.prototype,"replaceTrack"),gn.prototype),ut(gn.prototype,"updateAdaptation",[Ms],Object.getOwnPropertyDescriptor(gn.prototype,"updateAdaptation"),gn.prototype),ut(gn.prototype,"getRemoteSSRC",[Ms],Object.getOwnPropertyDescriptor(gn.prototype,"getRemoteSSRC"),gn.prototype),gn);function Ms(e,n,i){const s=e[n];if(typeof s!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const c=this.mutex,u=await c.lock("From P2PConnection.".concat(n));try{for(var h=arguments.length,p=new Array(h),_=0;_<h;_++)p[_]=arguments[_];return await s.apply(this,p)}finally{u()}},i}function ZL(e,n){let i=document.createElement("video"),s=document.createElement("canvas");i.setAttribute("style","display:none"),s.setAttribute("style","display:none"),i.setAttribute("muted",""),i.muted=!0,i.setAttribute("autoplay",""),i.autoplay=!0,i.setAttribute("playsinline",""),s.width=Ba(n.width),s.height=Ba(n.height);const c=Ba(n.framerate||15);document.body.append(i),document.body.append(s);let u=e._mediaStreamTrack;i.srcObject=new MediaStream([u]),i.play();const h=s.getContext("2d");if(!h)throw new be(Y.UNEXPECTED_ERROR,"can not get canvas context");const p=Cn(),_=s.captureStream(p.supportRequestFrame?0:c).getVideoTracks()[0];_.canvas||(_.canvas=s),s.startCapture=()=>{if(!i)return s.stopCapture&&s.stopCapture();if(i.paused&&i.play(),i.videoHeight>2&&i.videoWidth>2){const S=i.videoWidth,w=i.videoHeight/S,I=s.width*w;Math.abs(I-s.height)>=2&&(k.debug("adjust low stream resolution","".concat(s.width,"x").concat(s.height," -> ").concat(s.width,"x").concat(I)),s.height=I)}h.drawImage(i,0,0,s.width,s.height),_.requestFrame&&_.requestFrame(),u!==e._mediaStreamTrack&&(u=e._mediaStreamTrack,i.srcObject=new MediaStream([u]))},s.stopCapture=uL(()=>s.startCapture&&s.startCapture(),c);const E=_.stop;return _.stop=()=>{E.call(_),i&&(i.remove(),i.srcObject=null,i=null),s&&(s.width=0,s.remove(),s.stopCapture&&s.stopCapture(),s.startCapture=void 0,s.stopCapture=void 0,s=null),k.debug("clean low stream renderer")},_}var PA=function(e){return e[e.HEIGHT=2033]="HEIGHT",e[e.FRAME_RATE=2034]="FRAME_RATE",e[e.WIDTH=2035]="WIDTH",e}(PA||{}),oi=function(e){return e[e.FRAME_RATE=2002]="FRAME_RATE",e[e.WIDTH=2003]="WIDTH",e[e.HEIGHT=2004]="HEIGHT",e[e.PACKAGE_LOST=2005]="PACKAGE_LOST",e[e.AVG_ENCODE=2007]="AVG_ENCODE",e[e.NACKS=2009]="NACKS",e[e.PLIS=2010]="PLIS",e[e.FIRS=2011]="FIRS",e[e.BITRATE=2012]="BITRATE",e[e.PACKAGE_RATE=2031]="PACKAGE_RATE",e[e.ADAPTATION=2032]="ADAPTATION",e[e.ACTUAL_ENCODED=2060]="ACTUAL_ENCODED",e[e.BANDWIDTH=2061]="BANDWIDTH",e[e.RETRANSMIT=2062]="RETRANSMIT",e[e.TARGET_ENCODED=2064]="TARGET_ENCODED",e[e.TRANSMIT=2066]="TRANSMIT",e[e.FREEZE=2082]="FREEZE",e[e.DISABLED=2095]="DISABLED",e[e.PLAYER_STATUS=2128]="PLAYER_STATUS",e[e.QP_SUM=2143]="QP_SUM",e[e.BYTES_RETRANSMIT=2173]="BYTES_RETRANSMIT",e[e.PACKAGES_RETRANSMIT=2172]="PACKAGES_RETRANSMIT",e[e.HUGE_FRAME_SENT=2174]="HUGE_FRAME_SENT",e[e.KEY_FRAMES_ENCODED=2207]="KEY_FRAMES_ENCODED",e}(oi||{}),s_=function(e){return e[e.BITRATE=2069]="BITRATE",e[e.PACKAGE_LOST=2070]="PACKAGE_LOST",e[e.PACKAGE_RATE=2071]="PACKAGE_RATE",e[e.HEIGHT=2073]="HEIGHT",e[e.FRAME_RATE=2075]="FRAME_RATE",e[e.WIDTH=2077]="WIDTH",e}(s_||{}),si=function(e){return e[e.JITTER=-1]="JITTER",e[e.PACKAGE_LOST=2014]="PACKAGE_LOST",e[e.WIDTH=2018]="WIDTH",e[e.HEIGHT=2019]="HEIGHT",e[e.FRAME_RATE=2020]="FRAME_RATE",e[e.JITTER_BUFFER=2023]="JITTER_BUFFER",e[e.CURRENT_DELAY=2024]="CURRENT_DELAY",e[e.NACKS=2026]="NACKS",e[e.PLIS=2027]="PLIS",e[e.FIRS=2028]="FIRS",e[e.BITRATE=2029]="BITRATE",e[e.PACKAGE_RATE=2078]="PACKAGE_RATE",e[e.FREEZE=2084]="FREEZE",e[e.DISABLED=2101]="DISABLED",e[e.PLAYER_STATUS=2129]="PLAYER_STATUS",e[e.QP_SUM=2144]="QP_SUM",e[e.I_FRAME_DELAY=2149]="I_FRAME_DELAY",e[e.FRAMES_DROPPED=2181]="FRAMES_DROPPED",e[e.BYTES_RETRANSMIT=2175]="BYTES_RETRANSMIT",e[e.PACKAGES_RETRANSMIT=2176]="PACKAGES_RETRANSMIT",e[e.PACKAGES_DISCARDED=2198]="PACKAGES_DISCARDED",e[e.AVG_DECODE=2200]="AVG_DECODE",e[e.AVG_PROCESSING_DELAY=2202]="AVG_PROCESSING_DELAY",e[e.AVG_ASSEMBLY_TIME=2203]="AVG_ASSEMBLY_TIME",e[e.AVG_INTER_FRAME_DELAY=2204]="AVG_INTER_FRAME_DELAY",e[e.KEY_FRAMES_DECODED=2206]="KEY_FRAMES_DECODED",e}(si||{}),a_=function(e){return e[e.FRAME_RATE_DECODE=2021]="FRAME_RATE_DECODE",e[e.FRAME_RATE_RENDER=2022]="FRAME_RATE_RENDER",e[e.FRAME_RATE_OUTPUT=2155]="FRAME_RATE_OUTPUT",e[e.FREEZE_TIME=2109]="FREEZE_TIME",e[e.FREEZE_TIME_RENDER=2147]="FREEZE_TIME_RENDER",e[e.FREEZE_DURATION=2156]="FREEZE_DURATION",e}(a_||{}),_8=function(e){return e[e.PCM_LEVEL=2104]="PCM_LEVEL",e}(_8||{}),Hd=function(e){return e[e.PACKAGE_LOST=-1]="PACKAGE_LOST",e[e.LEVEL=2038]="LEVEL",e[e.BITRATE=2039]="BITRATE",e[e.PACKAGE_RATE=2040]="PACKAGE_RATE",e[e.AEC_RETURN_LOSS=2041]="AEC_RETURN_LOSS",e[e.AEC_RETURN_LOSS_ENH=2042]="AEC_RETURN_LOSS_ENH",e[e.FREEZE=2081]="FREEZE",e[e.DISABLED=2096]="DISABLED",e[e.BYTES_RETRANSMIT=2179]="BYTES_RETRANSMIT",e[e.PACKAGES_RETRANSMIT=2180]="PACKAGES_RETRANSMIT",e}(Hd||{}),Us=function(e){return e[e.BITRATE=2044]="BITRATE",e[e.PACKAGE_LOST=2045]="PACKAGE_LOST",e[e.PACKAGE_RATE=2046]="PACKAGE_RATE",e[e.CURRENT_DELAY=2047]="CURRENT_DELAY",e[e.JITTER_BUFFER=2054]="JITTER_BUFFER",e[e.JITTER=2055]="JITTER",e[e.FREEZE=2083]="FREEZE",e[e.DISABLED=2102]="DISABLED",e[e.PCM_LEVEL=2105]="PCM_LEVEL",e[e.PLAYER_STATUS=2130]="PLAYER_STATUS",e[e.CONCEALED_SAMPLES=2148]="CONCEALED_SAMPLES",e[e.BYTES_RETRANSMIT=2178]="BYTES_RETRANSMIT",e[e.PACKAGES_RETRANSMIT=2177]="PACKAGES_RETRANSMIT",e[e.PACKAGES_DISCARDED=2199]="PACKAGES_DISCARDED",e[e.AVG_PROCESSING_DELAY=2201]="AVG_PROCESSING_DELAY",e[e.TOTAL_SAMPLES_RECEIVED=2224]="TOTAL_SAMPLES_RECEIVED",e}(Us||{}),v8=function(e){return e[e.FREEZE_TIME=-1]="FREEZE_TIME",e[e.LEVEL=2043]="LEVEL",e}(v8||{}),Vs=function(e){return e[e.RTT=2006]="RTT",e[e.CONN_TYPE=801]="CONN_TYPE",e[e.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",e}(Vs||{}),NA=function(e){return e[e.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",e}(NA||{});const c_=1e3,l_=6,kA=3,mfe=Math.max(l_,kA);function Nt(e,n,i){i!=null&&Number.isFinite(i)&&(e[n]=Math.round(Math.max(0,i)))}function E8(e){const n={[Vs.CONN_TYPE]:0,[Vs.RTT]:e.rtt,[Vs.STATS_UPDATE_INTERVAL]:e.updateInterval?Math.round(Math.max(0,e.updateInterval)):void 0};switch(e.selectedCandidatePair.localCandidate.candidateType){case"relay":{const i=e.selectedCandidatePair.localCandidate.relayProtocol;i==="udp"&&(n[Vs.CONN_TYPE]=1),i==="tcp"&&(n[Vs.CONN_TYPE]=3),i==="tls"&&(n[Vs.CONN_TYPE]=4);break}case"srflx":n[Vs.CONN_TYPE]=2;break;case"unknown":n[Vs.CONN_TYPE]=5;break;default:n[Vs.CONN_TYPE]=0}return n}function y8(e){let n=0;switch(e){case"none":n=0;break;case"cpu":n=1;break;case"bandwidth":n=2;break;case"other":n=3}return n}class S8 extends Rr{constructor(n){super(),K(this,"store",void 0),K(this,"uploadWRTCStatsTimer",void 0),K(this,"uploadOutboundDenoiserStatsTimer",void 0),K(this,"uploadExtStatsTimer",void 0),K(this,"uploadExtUsageStatsTimer",void 0),K(this,"uploadInboundExtStatsTimer",void 0),K(this,"requestStats",void 0),K(this,"requestTransportStats",void 0),K(this,"requestLocalMedia",void 0),K(this,"requestRemoteMedia",void 0),K(this,"requestAllTracks",void 0),K(this,"requestVideoIsReady",void 0),K(this,"requestUploadStats",void 0),K(this,"requestUpload",void 0),K(this,"uploadOutboundStarted",!1),K(this,"uploadInboundStarted",!1),K(this,"uploadTransportStarted",!1),K(this,"uploadBaseStatsStarted",!1),K(this,"uploadExtensionUsageStarted",!1),K(this,"lastRecvStats",void 0),K(this,"lastSendStats",void 0),K(this,"lastRefRecvStats",void 0),K(this,"lastRefSendStats",void 0),K(this,"lastFullRecvStats",void 0),K(this,"lastFullSendStats",void 0),K(this,"needUploadRenderFreezeTime",!0),this.store=n}uploadWRTCStats(n){if(!this.requestStats||!this.requestUploadStats)return;const i=n%kA==0,s=n%l_==0;let c,u;if(this.uploadTransportStarted&&(c=this.requestStats(),this.store.useP2P&&(u=this.requestStats(!0))),!c&&this.uploadOutboundStarted&&(c=this.requestStats()),!u&&this.uploadInboundStarted&&(u=this.requestStats(!0)),c||u){var h;const p={};if(this.uploadTransportStarted&&c){const E=this.getTransportStats(c,u,i);E&&(p.misc=[E])}if(this.uploadOutboundStarted&&c){const E=this.getOutboundStats(c,s?this.lastFullSendStats:i?this.lastRefSendStats:this.lastSendStats,i,s);E&&(p.outbound=[E])}if(this.uploadInboundStarted&&u){const E=this.getInboundStats(u,s?this.lastFullRecvStats:i?this.lastRefRecvStats:this.lastRecvStats,i,s);E&&(p.inbound=E)}const _=(h=this.requestTransportStats)===null||h===void 0?void 0:h.call(this).connectState;_&&(Array.isArray(p.misc)?p.misc[0]&&p.misc[0].addition&&(p.misc[0].addition[NA.RTC_PEER_CONNECTION_STATE]=Y1[_]):p.misc=[{addition:{[NA.RTC_PEER_CONNECTION_STATE]:Y1[_]}}]),this.requestUploadStats(p)}this.lastRecvStats=u,this.lastSendStats=c,s&&(this.lastFullRecvStats=u,this.lastFullSendStats=c),i&&(this.lastRefRecvStats=u,this.lastRefSendStats=c)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0;let n=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var i,s;const c=(i=this.requestTransportStats)===null||i===void 0?void 0:i.call(this);return void(c&&((s=this.requestUploadStats)===null||s===void 0||s.call(this,{misc:[{addition:{[NA.RTC_PEER_CONNECTION_STATE]:Y1[c.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(n),++n===mfe+1&&(n=1)},c_)}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0)}getTransportStats(n,i,s){if(!this.requestStats)return;if(!s)return n.rtt==null?void 0:{addition:{[Vs.RTT]:n.rtt,[Vs.CONN_TYPE]:void 0,[Vs.STATS_UPDATE_INTERVAL]:n.updateInterval||void 0}};const c=E8(n);if(this.store.useP2P){if(i){const u=E8(i);c[Vs.CONN_TYPE]+=u[Vs.CONN_TYPE]<<3}c[Vs.CONN_TYPE]+=110}else c[Vs.CONN_TYPE]+=100;return{addition:c}}getOutboundStats(n,i,s,c){if(!this.requestUploadStats||!this.requestLocalMedia)return;const u=this.requestLocalMedia();if(!u||u.length===0)return;let h,p,_;return u.forEach(E=>{let[S,{track:w,ssrcs:I}]=E;switch(S){case xe.LocalVideoLowTrack:case xe.LocalVideoTrack:if(S===xe.LocalVideoTrack){const P=function(U,$,q,ce,me,ge){const pe=$.videoSend.find(rt=>rt.ssrc===U);if(!pe)return;const Re={},{sentFrame:Ve,inputFrame:Ze}=pe;if(ge&&(Nt(Re,oi.QP_SUM,pe.qpSumPerFrame),Ze&&Ve)){const rt=Ze.frameRate,un=Ve.frameRate;Re[oi.FREEZE]=function(dn,nr){let Qr=!0;return Qr=!(dn<=5)&&(dn<=10?nr<3:dn<=20?nr<4:nr<5),Qr}(rt,un)?1:0}if(me){switch(Ve&&(Nt(Re,oi.HEIGHT,Ve.height),Nt(Re,oi.WIDTH,Ve.width),Nt(Re,oi.FRAME_RATE,Ve.frameRate)),Re[oi.DISABLED]=ce._originMediaStreamTrack&&!ce._originMediaStreamTrack.enabled||ce._mediaStreamTrack&&!ce._mediaStreamTrack.enabled?1:0,pe.adaptionChangeReason){case"none":Re[oi.ADAPTATION]=0;break;case"cpu":Re[oi.ADAPTATION]=1;break;case"bandwidth":Re[oi.ADAPTATION]=2;break;case"other":Re[oi.ADAPTATION]=3}let rt=0;pe.adaptionChangeReason&&(rt+=y8(pe.adaptionChangeReason)),$.qualityLimitationReason&&(rt+=y8($.qualityLimitationReason)<<3),Re[oi.ADAPTATION]=rt,Re[oi.PLAYER_STATUS]=cL[ce._player?ce._player.videoElementStatus:"uninit"],Nt(Re,oi.NACKS,pe.nacksCount),Nt(Re,oi.PLIS,pe.plisCount),Nt(Re,oi.FIRS,pe.firsCount),Nt(Re,oi.AVG_ENCODE,pe.avgEncodeMs),Nt(Re,oi.HUGE_FRAME_SENT,pe.hugeFramesSent),Nt(Re,oi.BYTES_RETRANSMIT,pe.retransmittedBytesSent),Nt(Re,oi.PACKAGES_RETRANSMIT,pe.retransmittedPacketsSent),Nt(Re,oi.KEY_FRAMES_ENCODED,pe.keyFramesEncoded);const un=q&&q.videoSend.find(dn=>dn.ssrc===U);if(un){let dn=me?c_:c_*l_;un.timestamp&&pe.timestamp&&(dn=pe.timestamp-un.timestamp),un.packets!=null&&pe.packets!=null&&Nt(Re,oi.PACKAGE_RATE,1e3*(pe.packets-un.packets)/dn),pe.packetsLost!=null&&un.packetsLost!=null&&Nt(Re,oi.PACKAGE_LOST,pe.packetsLost-un.packetsLost),un.bytes!=null&&pe.bytes!=null&&Nt(Re,oi.BITRATE,8*(pe.bytes-un.bytes)/dn)}}return Re}(I[0].ssrcId,n,i,w,s,c),B=w&&function(U,$,q,ce){const me=$.videoSend.find(pe=>pe.ssrc===U);if(!me)return null;const ge={};if(ce){const pe=me.inputFrame,Re=pe&&pe.height||q.videoHeight||0,Ve=pe&&pe.width||q.videoWidth||0,Ze=pe&&pe.frameRate||0;Nt(ge,PA.HEIGHT,Re),Nt(ge,PA.WIDTH,Ve),Nt(ge,PA.FRAME_RATE,Ze)}return ge}(I[0].ssrcId,n,w,s),M=function(U,$){const q={};return $&&(Nt(q,oi.RETRANSMIT,U.bitrate.retransmit),Nt(q,oi.TARGET_ENCODED,U.bitrate.targetEncoded),Nt(q,oi.ACTUAL_ENCODED,U.bitrate.actualEncoded),Nt(q,oi.TRANSMIT,U.bitrate.transmit),Nt(q,oi.BANDWIDTH,U.sendBandwidth)),q}(n,s);p=Object.assign({},P,B,M)}else _=function(P,B,M,U){const $=B.videoSend.find(ce=>ce.ssrc===P);if(!$)return;const q={};if(U){const ce=$.sentFrame;if(ce&&(Nt(q,s_.HEIGHT,ce.height),Nt(q,s_.WIDTH,ce.width),Nt(q,s_.FRAME_RATE,ce.frameRate)),M){const me=M.videoSend.find(ge=>ge.ssrc===P);if(me){let ge=c_*l_;me.timestamp&&$.timestamp&&(ge=$.timestamp-me.timestamp),me.packets!=null&&$.packets!=null&&Nt(q,s_.PACKAGE_RATE,1e3*($.packets-me.packets)/ge),$.packetsLost!=null&&me.packetsLost!=null&&Nt(q,s_.PACKAGE_LOST,$.packetsLost-me.packetsLost),me.bytes!=null&&$.bytes!=null&&Nt(q,s_.BITRATE,8*($.bytes-me.bytes)/ge)}}}return q}(I[0].ssrcId,n,i,s);break;case xe.LocalAudioTrack:h=w&&function(P,B,M,U,$){const q=B.audioSend.find(me=>me.ssrc===P);if(!q)return;const ce={};if($){ce[Hd.DISABLED]=U._originMediaStreamTrack&&!U._originMediaStreamTrack.enabled||U._mediaStreamTrack&&!U._mediaStreamTrack.enabled?1:0;const me=100*U._source.getAccurateVolumeLevel(),ge=q.inputLevel;if(ge!=null){const Re=Math.ceil(50*Math.log10(100*ge+1));Nt(ce,Hd.LEVEL,Re)}Nt(ce,_8.PCM_LEVEL,me),Nt(ce,Hd.AEC_RETURN_LOSS,q.aecReturnLoss),Nt(ce,Hd.AEC_RETURN_LOSS_ENH,q.aecReturnLossEnhancement),Nt(ce,Hd.BYTES_RETRANSMIT,q.retransmittedBytesSent),Nt(ce,Hd.PACKAGES_RETRANSMIT,q.retransmittedPacketsSent),ce[Hd.FREEZE]=0;const pe=M&&M.audioSend.find(Re=>Re.ssrc===P);if(pe){let Re=c_*l_;pe.timestamp&&q.timestamp&&(Re=q.timestamp-pe.timestamp),pe.bytes!=null&&q.bytes!=null&&Nt(ce,Hd.BITRATE,8*(q.bytes-pe.bytes)/Re),pe.packets!=null&&q.packets!=null&&Nt(ce,Hd.PACKAGE_RATE,1e3*(q.packets-pe.packets)/Re)}}return ce}(I[0].ssrcId,n,i,w,s)}}),{high:p,low:_,audio:h}}getInboundStats(n,i,s,c){if(!this.requestRemoteMedia)return;const u=this.requestRemoteMedia()||[],h=[];return u.forEach(p=>{let[_,E]=p;const S={peer:_.uid};if(E.has(ot.VIDEO)&&_.videoTrack){const w=_._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(_._videoSSRC)||!1,I=_.videoTrack?function(P,B,M,U,$,q,ce,me){const ge=B.videoRecv.find(dn=>dn.ssrc===P);if(!ge)return;const pe={},{receivedFrame:Re,outputFrame:Ve,decodeFrameRate:Ze}=ge,rt=M&&M.videoRecv.find(dn=>dn.ssrc===P);if(Nt(pe,a_.FRAME_RATE_DECODE,Ze),ge.framesRateFirefox&&Nt(pe,si.FRAME_RATE,ge.framesRateFirefox),Re&&Nt(pe,si.FRAME_RATE,Re.frameRate),Nt(pe,si.FRAMES_DROPPED,ge.framesDroppedCount),Nt(pe,si.BYTES_RETRANSMIT,ge.retransmittedBytesReceived),Nt(pe,si.PACKAGES_RETRANSMIT,ge.retransmittedPacketsReceived),Nt(pe,si.PACKAGES_DISCARDED,ge.packetsDiscarded),Nt(pe,si.AVG_DECODE,ge.avgDecodeMs),Nt(pe,si.AVG_PROCESSING_DELAY,ge.avgProcessingDelayMs),Nt(pe,si.AVG_ASSEMBLY_TIME,ge.avgFramesAssembledFromMultiplePacketsMs),Nt(pe,si.AVG_INTER_FRAME_DELAY,ge.avgInterFrameDelayMs),Nt(pe,si.KEY_FRAMES_DECODED,ge.keyFramesDecoded),rt){const dn=B.timestamp-M.timestamp||c_*(me?l_:ce?kA:1);ge.packetsLost!=null&&rt.packetsLost!=null&&Nt(pe,si.PACKAGE_LOST,ge.packetsLost-rt.packetsLost),rt.bytes!=null&&ge.bytes!=null&&Nt(pe,si.BITRATE,8*(ge.bytes-rt.bytes)/dn),rt.packets!=null&&ge.packets!=null&&Nt(pe,si.PACKAGE_RATE,1e3*(ge.packets-rt.packets)/dn)}if(me&&(Nt(pe,si.QP_SUM,ge.qpSumPerFrame),pe[si.FREEZE]=$&&O0.isRemoteVideoFreeze(U,ge,rt)?1:0),ce){var un;Re?(Nt(pe,si.HEIGHT,Re.height),Nt(pe,si.WIDTH,Re.width)):U&&(Nt(pe,si.HEIGHT,U._videoHeight||0),Nt(pe,si.WIDTH,U._videoWidth||0)),Ve&&Nt(pe,a_.FRAME_RATE_OUTPUT,Ve.frameRate);const dn=(un=U._player)===null||un===void 0?void 0:un.rendFrameRate.toFixed(0);if(dn&&Nt(pe,a_.FRAME_RATE_RENDER,+dn),Nt(pe,si.JITTER_BUFFER,ge.jitterBufferMs),Nt(pe,si.CURRENT_DELAY,ge.currentDelayMs),Nt(pe,si.FIRS,ge.firsCount),Nt(pe,si.NACKS,ge.nacksCount),Nt(pe,si.PLIS,ge.plisCount),U){pe[si.DISABLED]=U._originMediaStreamTrack.enabled&&U._mediaStreamTrack.enabled?0:1;const nr=U._player;if(nr){const{freezeTimeCounterList:Qr,renderFreezeAccTime:jr,videoElementStatus:js}=nr;if(Qr&&Qr.length>0&&Nt(pe,a_.FREEZE_TIME,Qr.splice(0,1)[0]),q&&pf.visibility==="visible"&&js===qo.PLAYING&&Cn().supportRequestVideoFrameCallback){const Pe=Math.min(6e3,jr);nr.renderFreezeAccTime=Math.max(0,jr-Pe),Nt(pe,a_.FREEZE_TIME_RENDER,Pe)}if(typeof ge.totalFreezesDuration=="number"){const Pe=rt&&rt.totalFreezesDuration?ge.totalFreezesDuration-rt.totalFreezesDuration:ge.totalFreezesDuration;Nt(pe,a_.FREEZE_DURATION,1e3*Pe)}}}if(pe[si.PLAYER_STATUS]=cL[U._player?U._player.videoElementStatus:"uninit"],rt&&ge.totalInterFrameDelay!==void 0&&ge.totalSquaredInterFrameDelay!==void 0&&rt.totalInterFrameDelay!==void 0&&rt.totalSquaredInterFrameDelay!==void 0){const nr=ge.totalInterFrameDelay-rt.totalInterFrameDelay,Qr=ge.totalSquaredInterFrameDelay-rt.totalSquaredInterFrameDelay,jr=ge.framesDecodeCount-rt.framesDecodeCount,js=nr/jr*1e3,Pe=Math.round(1e3*Math.sqrt((Qr-Math.pow(nr,2)/jr)/jr));!isNaN(Pe)&&js+Pe>Math.max(3*js,js+150)&&(pe[si.I_FRAME_DELAY]=Pe)}}return pe}(_._videoSSRC,n,i,_.videoTrack,w===!0,this.needUploadRenderFreezeTime,s,c):void 0;I&&(S.video=I)}if(E.has(ot.AUDIO)&&_.audioTrack){const w=_.audioTrack?function(I,P,B,M,U,$){const q=P.audioRecv.find(pe=>pe.ssrc===I);if(!q)return;const ce={},me=B&&B.audioRecv.find(pe=>pe.ssrc===I);if(Nt(ce,Us.JITTER,q.jitterMs),Nt(ce,Us.BYTES_RETRANSMIT,q.retransmittedBytesReceived),Nt(ce,Us.PACKAGES_RETRANSMIT,q.retransmittedPacketsReceived),Nt(ce,Us.PACKAGES_DISCARDED,q.packetsDiscarded),Nt(ce,Us.AVG_PROCESSING_DELAY,q.avgProcessingDelayMs),me){const pe=P.timestamp-B.timestamp||c_*($?l_:U?kA:1);q.packets!=null&&me.packets!=null&&Nt(ce,Us.PACKAGE_RATE,1e3*(q.packets-me.packets)/pe),U&&me.bytes!=null&&q.bytes!=null&&Nt(ce,Us.BITRATE,8*(q.bytes-me.bytes)/pe),q.packetsLost!=null&&me.packetsLost!=null&&Nt(ce,Us.PACKAGE_LOST,q.packetsLost-me.packetsLost)}if($){const{receivedFrames:pe,droppedFrames:Re}=q;pe!=null&&Re!=null&&(ce[Us.FREEZE]=(ge=pe)===0||100*Re/ge>20?1:0)}var ge;if(U){const pe=100*M._source.getAccurateVolumeLevel(),Re=q.outputLevel;if(Re!=null){const Ve=Math.ceil(50*Math.log10(100*Re+1));Nt(ce,v8.LEVEL,Ve)}if(Nt(ce,Us.PCM_LEVEL,pe),M&&(ce[Us.DISABLED]=M._originMediaStreamTrack.enabled&&M._mediaStreamTrack.enabled?0:1),Nt(ce,Us.JITTER_BUFFER,q.jitterBufferMs),Nt(ce,Us.CURRENT_DELAY,q.jitterBufferMs),ce[Us.PLAYER_STATUS]=cL[xs.getPlayerState(M.getTrackId())],me){const Ve=q.concealedSamples-me.concealedSamples;Ve>0&&Nt(ce,Us.CONCEALED_SAMPLES,Ve);const Ze=q.totalSamplesReceived-me.totalSamplesReceived;Ze>0&&Nt(ce,Us.TOTAL_SAMPLES_RECEIVED,Ze)}}return ce}(_._audioSSRC,n,i,_.audioTrack,s,c):void 0;w&&(S.audio=w)}(S.video||S.audio)&&h.push(S)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,h}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;const n=(this.requestAllTracks()||[]).find(i=>i instanceof tA);if(n&&n._external.getDenoiserStats){const i=n._external.getDenoiserStats();i&&this.requestUpload(E0.DENOISER_STATS,i)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(n=>{n.getProcessorStats().forEach(i=>{this.requestUpload&&this.requestUpload(i.type,i.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(n=>{let[i,s]=n;s.has(ot.VIDEO)&&i.videoTrack&&i.videoTrack.getProcessorStats().forEach(c=>{this.requestUpload&&this.requestUpload(c.type,c.stats)}),s.has(ot.AUDIO)&&i.audioTrack&&i.audioTrack.getProcessorStats().forEach(c=>{this.requestUpload&&this.requestUpload(c.type,c.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0))}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const n=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{const i=Date.now(),s={connectionInterval:Z("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:i};let c=[];const u=this.requestAllTracks&&this.requestAllTracks()||[];for(const E of u)!E.muted&&E.enabled&&(c=c.concat(await E.getProcessorUsage()));const h=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[E,S]of h)S.has(ot.VIDEO)&&E.videoTrack&&(c=c.concat(await E.videoTrack.getProcessorUsage())),S.has(ot.AUDIO)&&E.audioTrack&&(c=c.concat(await E.audioTrack.getProcessorUsage()));if(c.length===0)return;s.details=function(E,S){const w={};for(const{id:M,value:U,level:$,direction:q}of E){var I;const ce=(I=S.get(M))!==null&&I!==void 0?I:0,me=U===2?ce+Z("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:ce;var P,B;S.set(M,me),w[M]?(U===2&&(w[M].value=U),$>w[M].level&&(w[M].level=$),q==="remote"&&(w[M].remoteUidCount+=1),w[M].totalTs=(P=S.get(M))!==null&&P!==void 0?P:0):w[M]={value:U,level:$,remoteUidCount:q==="local"?0:1,totalTs:(B=S.get(M))!==null&&B!==void 0?B:0}}return Object.keys(w).map(M=>{const{level:U,value:$,totalTs:q}=w[M];return{id:M,level:U,value:$,totalTs:q}})}(c,n);const p=Date.now(),_=p>i?p:i+1;this.requestUpload&&this.requestUpload(E0.EXTENSION_USAGE_STATS,{usageStats:s,sendTs:_})},Z("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1}}const gfe=Z("ICE_RESTART_INTERVAL");let DA=new Map,oy=new Map,Jp=[wo.UDP_TCP_RELAY,wo.TCP_RELAY,wo.RELAY],ex=Z("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Cn().supportPCSetConfiguration;function T8(e){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const i=DA.get(e.id);i&&(window.clearTimeout(i),DA.delete(e.id));const s=oy.get(e.id);n&&s&&s.index===Jp.length-1&&(k.debug("[".concat(e.id,"] reset ICE restart policy")),oy.delete(e.id))}function b8(e,n,i){if(DA.size===0&&oy.size===0&&(Array.isArray(Z("RESTART_SEQUENCE"))&&Z("RESTART_SEQUENCE").length>0&&!function(p,_){if(p.length!==_.length)return!1;for(let E=0;E<p.length;E+=1){const S=p[E];if(p.filter(w=>w===S).length!==_.filter(w=>w===S).length)return!1}return!0}(Jp,Z("RESTART_SEQUENCE"))&&(Jp=Z("RESTART_SEQUENCE").filter(p=>{var _;if($e(_=Object.values(wo)).call(_,p))return!0}),k.debug("use reconnection policy from config distribution, queues: ".concat(Jp.join(" => ")))),ex=Z("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Cn().supportPCSetConfiguration),Jp.length===0)return void i();let s,{index:c=0,type:u}=oy.get(e.id)||{};if(ex&&u===wo.RELAY)return void i();let h=u&&c>=Jp.length-1;if(ex)u=wo.RELAY;else{if(h)return void i();u?(c++,u=Jp[c]):(u=Jp[0],c=0)}k.debug("[".concat(e.id,"] choose ICE restart policy: ").concat(u,", index: ").concat(c)),n(u),oy.set(e.id,{index:c,type:u}),s=window.setTimeout(()=>b8(e,n,i),gfe),DA.set(e.id,s)}var tn;function w8(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,s)}return i}function Kd(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?w8(Object(i),!0).forEach(function(s){K(e,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):w8(Object(i)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(i,s))})}return e}function R8(e){var n,i,s,c=2;for(typeof Symbol<"u"&&(i=w1,s=Symbol.iterator);c--;){if(i&&(n=e[i])!=null)return n.call(e);if(s&&(n=e[s])!=null)return new LA(n.call(e));i="@@asyncIterator",s="@@iterator"}throw new TypeError("Object is not async iterable")}function LA(e){function n(i){if(Object(i)!==i)return Qe.reject(new TypeError(i+" is not an object."));var s=i.done;return Qe.resolve(i.value).then(function(c){return{value:c,done:s}})}return LA=function(i){this.s=i,this.n=i.next},LA.prototype={s:null,n:null,next:function(){return n(this.n.apply(this.s,arguments))},return:function(i){var s=this.s.return;return s===void 0?Qe.resolve({value:i,done:!0}):n(s.apply(this.s,arguments))},throw:function(i){var s=this.s.return;return s===void 0?Qe.reject(i):n(s.apply(this.s,arguments))}},new LA(e)}let N0=(tn=class extends Rr{get state(){return this._state}set state(e){const n=this._state;this._state=e,this.emit(Rt.StateChange,n,this._state)}constructor(e,n){super(),K(this,"isPlanB",void 0),K(this,"store",void 0),K(this,"statsUploader",void 0),K(this,"connection",void 0),K(this,"localTrackMap",new Map),K(this,"remoteUserMap",new Map),K(this,"localDataChannels",[]),K(this,"remoteDataChannelMap",new Map),K(this,"pendingLocalTracks",[]),K(this,"pendingRemoteTracks",[]),K(this,"pendingLocalDataChannels",[]),K(this,"pendingRemoteDataChannels",[]),K(this,"statsCollector",void 0),K(this,"shouldForwardP2PCreation",void 0),K(this,"iceFailedCount",0),K(this,"dtlsFailedCount",0),K(this,"mutex",void 0),K(this,"_state",Un.Disconnected),K(this,"_pcStatsUploadType",Z("NEW_ICE_RESTART")?vf.FIRST_CONNECTION:vf.OLD_FIRST_CONNECTION),K(this,"_isStartRestartIce",!1),K(this,"_restartTimer",void 0),K(this,"_isTryConnecting",!1),K(this,"_iceError",null),K(this,"_forceTurn",!1),K(this,"_isWaitPcToRePub",!1),K(this,"handleMuteLocalTrack",async(i,s,c)=>{const u=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==Un.Connected)return void c(new Ie(Y.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const h=this.filterTobeMutedTracks(i);if(h.length===0)return void s();const p=h.find(E=>E[0]==="videoLowTrack");p&&p[1].track._originMediaStreamTrack.stop(),await this.connection.muteLocal(h.map(E=>{let[,{id:S}]=E;return S}));const _=this.createMuteMessage(h);await Zn(this,Rt.RequestMuteLocal,_),s()}catch(h){c(h)}finally{u()}}),K(this,"handleUnmuteLocalTrack",async(i,s,c)=>{const u=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==Un.Connected)return void c(new Ie(Y.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const h=this.filterTobeUnmutedTracks(i);if(h.length===0)return void s();const p=h.find(E=>E[0]==="videoLowTrack");if(p){const E=p[1];if(E.track._originMediaStreamTrack.stop(),!Z("DISABLE_DUAL_STREAM_USE_ENCODING")&&Cn().supportDualStreamEncoding){const S=i._mediaStreamTrack.clone();E.track._mediaStreamTrack=S,E.track._originMediaStreamTrack=S}else{const S=ZL(i,h0(this,Rt.RequestLowStreamParameter));E.track._mediaStreamTrack=S,E.track._originMediaStreamTrack=S}await new Qe((S,w)=>{this.handleReplaceTrack(E.track,S,w,!0)})}await this.connection.unmuteLocal(h.map(E=>{let[,{id:S}]=E;return S}));const _=this.createUnmuteMessage(h);await Zn(this,Rt.RequestUnmuteLocal,_),s()}catch(h){c(h)}finally{u()}}),K(this,"handleUpdateVideoEncoder",async(i,s,c,u)=>{let h;u||(h=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{const _=this.localTrackMap.get(xe.LocalVideoTrack);if(!this.connection||!_||_.track!==i||this.state!==Un.Connected)return void s();const{id:E,track:S}=_;await this.connection.updateSendParameters(E,S),await this.connection.updateEncoderConfig(E,S),this.emit(Rt.UpdateVideoEncoder,S),s()}catch(_){c(_)}finally{var p;(p=h)===null||p===void 0||p()}}),K(this,"handleUpdateVideoSendParameters",async(i,s,c)=>{const u=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const h=this.localTrackMap.get(xe.LocalVideoTrack);if(!this.connection||!h||h.track!==i||this.state!==Un.Connected)return void s();const{id:p,track:_}=h;await this.connection.updateSendParameters(p,_),s()}catch(h){c(h)}finally{u()}}),K(this,"handleReplaceMixingTrack",async(i,s,c,u)=>{if(!this.connection||this.state!==Un.Connected)return void s();const h=JL([i]);let p;k.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(h.getTrackId(),"]")),typeof u=="boolean"&&u||(p=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(i,h),s()}catch(E){c(E)}finally{var _;(_=p)===null||_===void 0||_()}}),K(this,"handleReplaceTrack",async(i,s,c,u)=>{let h;k.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(i.getTrackId(),"]")),typeof u=="boolean"&&u||(h=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var p;const E=Array.from(this.localTrackMap.entries()).find(S=>{let[,{track:w}]=S;return i===w});if(!this.connection||!E||this.state!==Un.Connected)return void s();if(await((p=this.connection)===null||p===void 0?void 0:p.replaceTrack(i,E[1].id)),this.isPlanB){const S=E[1];S.id=i._mediaStreamTrack.id,this.localTrackMap.set(E[0],S)}if(E[0]===xe.LocalVideoTrack&&!Z("DISABLE_DUAL_STREAM_USE_ENCODING")&&Cn().supportDualStreamEncoding){const S=this.localTrackMap.get(xe.LocalVideoLowTrack);if(S){const w=i._mediaStreamTrack.clone();S.track._originMediaStreamTrack.stop(),S.track._mediaStreamTrack=w,S.track._originMediaStreamTrack=w,await new Qe((I,P)=>{this.handleReplaceTrack(S.track,I,P,!0)})}}s()}catch(E){c(E)}finally{var _;(_=h)===null||_===void 0||_()}}),K(this,"handleGetRTCStats",i=>{i(this.statsCollector.getRTCStats())}),K(this,"handleGetLocalVideoStats",i=>{i(this.statsCollector.getLocalVideoTrackStats())}),K(this,"handleGetLocalAudioStats",i=>{i(this.statsCollector.getLocalAudioTrackStats())}),K(this,"handleGetRemoteVideoStats",i=>this.statsCollector.getRemoteVideoTrackStats(i.uid)[i.uid]),K(this,"handleGetRemoteAudioStats",i=>this.statsCollector.getRemoteAudioTrackStats(i.uid)[i.uid]),this.store=e,this.statsCollector=n,this.statsCollector.addP2PChannel(this),this.statsUploader=new S8(this.store),this.bindStatsUploaderEvents(),this.mutex=new To("P2PChannel-mutex",this.store.clientId),this.isPlanB=!Cn().supportUnifiedPlan||Z("CHROME_FORCE_PLAN_B")&&df(),this.shouldForwardP2PCreation=Z("FORWARD_P2P_CREATION")&&Cn().supportPCSetConfiguration&&M1(),this.shouldForwardP2PCreation&&(this.connection=OA(this.store),this.emit(Rt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(e){var n;this.state=Un.New,this._forceTurn=m8(e),k.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));const i=this.shouldForwardP2PCreation&&((n=this.connection)===null||n===void 0?void 0:n.peerConnectionState)==="closed";if(this.shouldForwardP2PCreation&&!i||(i&&this.connection&&(k.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=OA(this.store,e),this.emit(Rt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new Ie(Y.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=Z("NEW_ICE_RESTART")?vf.FIRST_CONNECTION:vf.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(e),this.connection.establishPromise}async connect(e){if(!this.connection)throw new Ie(Y.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");Z("ENABLE_PREALLOC_PC")&&this.state===Un.Connected?await this.connection.updateRemoteConnect(e):(this.store.peerConnectionStart(),await this.connection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Un.Connected)}updateRemoteRTPCapabilities(e){const n=Array.from(this.localTrackMap.entries()).filter(c=>{var u;let[h]=c;return $e(u=[xe.LocalVideoLowTrack,xe.LocalVideoTrack]).call(u,h)}),i=n.map(c=>{let[,{id:u}]=c;return u}),s=n.map(c=>{let[u]=c;return u});if(this.connection instanceof zd){if(pt.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(s),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(e)}),!$e(e).call(e,this.store.codec)){const c=["vp9","vp8","h264"].find(u=>$e(e).call(e,u));c&&(this.store.codec=c,k.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(c,".")))}this.connection.updateRemoteRTPCapabilities(i,e)}}async getEstablishParams(){var e;if(this.connection instanceof zd&&this.connection.peerConnectionState!=="closed"&&$e(e=[Un.New,Un.Connected]).call(e,this.state))return this.connection.establishPromise}async publishDataChannel(e){if(!this.connection||this.state!==Un.Connected){if(this.state===Un.Disconnected)throw new Ie(Y.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return e.forEach(i=>{var s;$e(s=this.pendingLocalDataChannels).call(s,i)||this.pendingLocalDataChannels.push(i)}),[]}const n=this.filterTobePublishedDataChannels(e);return n.length===0?[]:(n.forEach(i=>{const s=Date.now();this.store.publish(i.id.toString(),"datachannel",s)}),await this.connection.createDataChannels(this.store.uid,n),n.forEach(i=>{this.localDataChannels.push(i);const s=Date.now();this.store.publish(i.id+"","datachannel",void 0,s)}),e.map(i=>({streamId:i.id,ordered:i.ordered,maxRetransmits:i.maxRetransmits,metadata:i.metadata,channelId:i._originDataChannelId})))}publish(e,n,i){var s=this;return Zc(function*(){const c=yield _n(s.mutex.lock("From P2PChannel.publish"));try{var u;const h=s.connection&&$e(u=["disconnected","failed"]).call(u,s.connection.peerConnectionState);if(!s.connection||s.state!==Un.Connected||h){if(s.state===Un.Disconnected)throw new Ie(Y.UNEXPECTED_ERROR,"PeerConnection already disconnected.");s.throwIfTrackTypeNotMatch(e);const _=e.filter(E=>s.pendingLocalTracks.indexOf(E)===-1);return s.pendingLocalTracks=s.pendingLocalTracks.concat(_),void(h&&(s._isWaitPcToRePub=!0))}s.store.pubId=s.store.pubId+1,Ro.markPublishStart(s.store.clientId,s.store.pubId);const p=s.filterTobePublishedTracks(e,n,i);if(p.length===0)return void(yield _n(s.tryToUnmuteAudio(e)));yield*AI(R8(s.doPublish(s.connection,p)))}finally{c()}})()}doPublish(e,n){var i=this;return Zc(function*(){n.forEach(I=>{let{track:P,type:B}=I;const M=Date.now();i.store.publish(P.getTrackId(),B===xe.LocalAudioTrack?"audio":"video",M)}),i.bindLocalTrackEvents(n);const s=n.map(I=>{let{track:P}=I;return P}),c=yield _n(e.send(s,i.store.codec,i.store.audioCodec)),u=(yield _n(c.next())).value,h=i.createGatewayPublishMessage(n,u);let p;try{p=yield h}catch(I){throw c.throw(I),(I==null?void 0:I.code)===Y.WS_ABORT&&n.forEach(P=>{let{track:B}=P;i.pendingLocalTracks.indexOf(B)===-1&&i.pendingLocalTracks.push(B)}),i.unbindLocalTrackEvents(n),I}const _=i.mapPubResToRemoteConfig(h,p,s),E=(yield _n(c.next(_))).value;if(i.state===Un.Disconnected)throw new Ie(Y.UNEXPECTED_ERROR,"PeerConnection already disconnected.");Z("ENABLE_VIDEO_SEI");const S=Z("ENABLE_ENCODED_TRANSFORM"),w=Z("ENABLE_AUDIO_METADATA");s.forEach(async I=>{const P=I.getRTCRtpTransceiver();if(!P||!S)return;const{interceptLocalVideoFrame:B,interceptLocalAudioFrame:M}=TA();I.trackMediaType===ot.VIDEO?await B(P.sender,I):I.trackMediaType===ot.AUDIO&&await M(P.sender,{metadata:w?()=>{const U=I.metadata.shift();return U&&U.value}:void 0})}),n.forEach(I=>{let{type:P}=I;i.statsCollector.addLocalStats(P)}),i.assignLocalTracks(n,E),i.statsUploader.startUploadOutboundStats(),n.forEach(I=>{let{track:P,type:B}=I;const M=Date.now();i.store.publish(P.getTrackId(),B===xe.LocalAudioTrack?"audio":"video",void 0,M)})})()}async updateVideoStreamParameter(e,n){const i=this.localTrackMap.get(n);if(!i||!this.connection)return;if(!(i.track instanceof ur))return k.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");const{track:s}=i,c=function(u,h){const p={};return u.height&&u.width&&(p.scaleResolutionDownBy=xL(u,h)),p.maxFramerate=u.framerate?Ba(u.framerate):void 0,p.maxBitrate=u.bitrate?1e3*u.bitrate:void 0,p}(e,s);if(s._encoderConfig||(s._encoderConfig={}),n!==xe.LocalVideoLowTrack||!Z("DISABLE_DUAL_STREAM_USE_ENCODING")&&Cn().supportDualStreamEncoding)c.scaleResolutionDownBy!=null&&(s._encoderConfig.scaleResolutionDownBy=c.scaleResolutionDownBy);else{const u=s._originMediaStreamTrack;if(!u.canvas)return k.warn("[".concat(s.getTrackId(),"] no canvas on track"));(function(h,p){const _=h.canvas;p.width&&(_.width=Ba(p.width)),p.height&&(_.height=Ba(p.height)),p.framerate&&(_.stopCapture&&_.stopCapture(),_.stopCapture=uL(()=>{!_.startCapture&&_.stopCapture&&_.stopCapture(),_.startCapture&&_.startCapture()},Ba(p.framerate)))})(u,e)}c.maxBitrate!=null&&(s._encoderConfig.bitrateMax=c.maxBitrate/1e3),c.maxFramerate!=null&&(s._encoderConfig.frameRate&&typeof s._encoderConfig.frameRate=="object"?s._encoderConfig.frameRate.max=c.maxFramerate:s._encoderConfig.frameRate={max:c.maxFramerate}),k.debug("[".concat(s.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(s._encoderConfig))),await this.connection.updateRtpSenderEncodings(s)}publishLowStream(e){var n=this;return Zc(function*(){if(!n.connection||n.state!==Un.Connected)return;const i=yield _n(n.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const c=n.localTrackMap.get(xe.LocalVideoTrack);if(!c)throw new Ie(Y.UNEXPECTED_ERROR,"Could not find high stream");if(n.localTrackMap.has(xe.LocalVideoLowTrack))throw new Ie(Y.UNEXPECTED_ERROR,"[".concat(n.store.clientId,"] Can't publish low stream when stream already publish"));const u=[{track:n.getLowVideoTrack(c.track,e),type:xe.LocalVideoLowTrack}];if(yield*AI(R8(n.doPublish(n.connection,u))),c.track.muted||!c.track.enabled){var s;const h=(s=n.localTrackMap.get(xe.LocalVideoLowTrack))===null||s===void 0?void 0:s.id;h!==void 0&&(yield _n(n.connection.muteLocal([h])))}}finally{i()}})()}async republish(){this.pendingLocalTracks.length>0&&(k.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await ho(this,Rt.RequestRePublish,this.pendingLocalTracks),this.emit(Rt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(k.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await ho(this,Rt.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(e){for(let n=this.pendingRemoteTracks.length-1;n>=0;n--){const{user:i,kind:s}=this.pendingRemoteTracks[n];(s!==ot.AUDIO||i._audio_added_&&i._audioSSRC)&&(s!==ot.VIDEO||i._video_added_&&i._videoSSRC)||this.pendingRemoteTracks.splice(n,1)}if(e)await ho(this,Rt.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:n,kind:i}of this.pendingRemoteTracks)await this.subscribe(n,i,i===ot.VIDEO?n._videoSSRC:n._audioSSRC);this.pendingRemoteTracks.forEach(n=>{let{user:i}=n;this.emit(Rt.MediaReconnectEnd,i.uid)}),this.pendingRemoteTracks=[]}async unpublish(e){if(!this.connection||this.state!==Un.Connected)return void e.forEach(s=>{const c=this.pendingLocalTracks.indexOf(s);c!==-1&&this.pendingLocalTracks.splice(c,1)});const n=this.filterTobeUnpublishedTracks(e);if(n.length===0)return;const i=n.find(s=>s[0]==="videoLowTrack");return i&&i[1].track.close(),this.doUnpublish(this.connection,n)}async unpublishDataChannel(e){if(!this.connection||this.state!==Un.Connected)return void e.forEach(i=>{const s=this.pendingLocalDataChannels.indexOf(i);s!==-1&&this.pendingLocalDataChannels.splice(s,1)});const n=this.filterTobeUnpublishedDataChannels(e);return n.length!==0?(n.forEach(i=>{const s=this.localDataChannels.indexOf(i);s!==-1&&this.localDataChannels.splice(s,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),n.map(i=>i.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==Un.Connected)return;const e=this.localTrackMap.get(xe.LocalVideoLowTrack);if(!e)return;e.track.close();const n=[[xe.LocalVideoLowTrack,e]];return this.doUnpublish(this.connection,n)}async doUnpublish(e,n){const i=this.createGatewayUnpublishMessage(n);return await e.stopSending(n.map(s=>{let[,{id:c}]=s;return c})),this.withdrawLocalTracks(n),this.unbindLocalTrackEvents(n.map(s=>{let[c,{track:u}]=s;return{type:c,track:u}})),n.forEach(s=>{let[c]=s;this.statsCollector.removeLocalStats(c)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),i}async subscribeDataChannel(e,n){if(!this.connection||this.state!==Un.Connected)throw new Ie(Y.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const i=n.filter(s=>{var c;return!((c=this.remoteDataChannelMap.get(e))!==null&&c!==void 0&&c.get(s.id))});if(i.length!==0)return await this.connection.createDataChannels(e.uid,i),i.forEach(s=>{var c;this.remoteDataChannelMap.has(e)?(c=this.remoteDataChannelMap.get(e))===null||c===void 0||c.set(s.id,s):this.remoteDataChannelMap.set(e,new Map([[s.id,s]]));const u=this.pendingRemoteDataChannels.findIndex(h=>{let{user:p,id:_}=h;return p.uid===e.uid&&_===s.id});u!==-1&&this.pendingRemoteDataChannels.splice(u,1)}),i.map(s=>s.id)}async subscribe(e,n,i,s,c){var u;if(!this.connection||this.state!==Un.Connected)throw new Ie(Y.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((u=this.remoteUserMap.get(e))!==null&&u!==void 0&&u.has(n))return;let h,p,_;const E=this.connection.getPreMedia(i);if(E)k.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(i,", no need to send sub to gateway.")),_=E.transceiver,h=E.track,p=E.id;else if(c){const I=c.find(B=>{let{stream_type:M}=B;return M===n});if(!I)throw new Ie(Y.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(n," for user: ").concat(e.uid," because subscribe answer from gateway does not contain stream_type: ").concat(n,"."));const P=await this.connection.receive(n,I.ssrcs,String(e._uintid),I.attributes);this.connection instanceof zd&&(_=P.transceiver),h=P.track,p=P.id}else{const I=await this.connection.receive(n,[{ssrcId:i,rtx:s}],String(e._uintid),void 0);this.connection instanceof zd&&(_=I.transceiver),h=I.track,p=I.id}if(n===ot.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(h):(e._audioTrack=new KE(h,e.uid,e._uintid,this.store),k.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),_&&e._audioTrack._updateRtpTransceiver(_),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(h):(e._videoTrack=new HE(h,e.uid,e._uintid,this.store),k.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),_&&e._videoTrack._updateRtpTransceiver(_),this.bindRemoteTrackEvents(e,e._videoTrack)),_&&Z("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:I,interceptRemoteAudioFrame:P}=TA();n==ot.VIDEO?await I(_.receiver,{onSei:Z("ENABLE_VIDEO_SEI")&&(B=>{var M;return(M=e._videoTrack)===null||M===void 0?void 0:M._onSei(B)})}):n==ot.AUDIO&&await P(_.receiver,{enableTopn:!!Z("ENABLE_AUDIO_TOPN"),enableMetadata:!!Z("ENABLE_AUDIO_METADATA"),onMetadata:B=>{this.safeEmit(Rt.AudioMetadata,B)}})}const S=this.remoteUserMap.get(e);S?S.set(n,p):this.remoteUserMap.set(e,new Map([[n,p]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats();const w=this.pendingRemoteTracks.findIndex(I=>{let{user:P,kind:B}=I;return P.uid===e.uid&&n===B});w!==-1&&(this.pendingRemoteTracks.splice(w,1),this.emit(Rt.MediaReconnectEnd,e.uid))}async massSubscribe(e){return this.massSubscribeNoLock(e)}async massSubscribeNoLock(e){if(!this.connection||this.state!==Un.Connected)throw new Ie(Y.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");e=e.filter(c=>{var u;let{user:h,mediaType:p}=c;return!((u=this.remoteUserMap.get(h))!==null&&u!==void 0&&u.has(p))});const n=[],i=new Map;e.forEach(c=>{if(!this.connection)return;const u=this.connection.getPreMedia(c.ssrcId);u?i.set(c.ssrcId,u):n.push(c)});const s=await this.connection.batchReceive(n.map(c=>{let{user:u,mediaType:h,ssrcId:p,rtxSsrcId:_}=c;return{kind:h,ssrcMsg:[{ssrcId:p,rtx:_}],mslabel:String(u._uintid)}}));n.forEach((c,u)=>{i.set(c.ssrcId,s[u])});for(const{user:c,mediaType:u,ssrcId:h}of e){const p=i.get(h);if(!p)return void k.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(c.uid," subscribe data,").concat(u,", ").concat(h));const{track:_,id:E,transceiver:S}=p;if(S&&Z("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:P,interceptRemoteAudioFrame:B}=TA();u==ot.VIDEO?await P(S.receiver,{onSei:Z("ENABLE_VIDEO_SEI")&&(M=>{var U;return(U=c._videoTrack)===null||U===void 0?void 0:U._onSei(M)})}):u==ot.AUDIO&&await B(S.receiver,{enableTopn:!!Z("ENABLE_AUDIO_TOPN"),enableMetadata:!!Z("ENABLE_AUDIO_METADATA"),onMetadata:M=>{this.safeEmit(Rt.AudioMetadata,M)}})}if(u===ot.AUDIO?(c._audioTrack?c._audioTrack._updateOriginMediaStreamTrack(_):(c._audioTrack=new KE(_,c.uid,c._uintid,this.store),k.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(c._audioTrack.getTrackId()))),S&&c._audioTrack._updateRtpTransceiver(S),this.bindRemoteTrackEvents(c,c._audioTrack)):(c._videoTrack?c._videoTrack._updateOriginMediaStreamTrack(_):(c._videoTrack=new HE(_,c.uid,c._uintid,this.store),k.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(c._videoTrack.getTrackId()))),S&&c._videoTrack._updateRtpTransceiver(S),this.bindRemoteTrackEvents(c,c._videoTrack)),Z("ENABLE_VIDEO_SEI")&&S){const{interceptRemoteVideoFrame:P,interceptRemoteAudioFrame:B}=TA();u==ot.VIDEO?await P(S.receiver,{onSei:M=>{var U;(U=c._videoTrack)===null||U===void 0||U._onSei(M)}}):u==ot.AUDIO&&await B(S.receiver)}const w=this.remoteUserMap.get(c);w?w.set(u,E):this.remoteUserMap.set(c,new Map([[u,E]])),this.statsCollector.addRemoteStats(c.uid),this.statsUploader.startUploadInboundStats();const I=this.pendingRemoteTracks.findIndex(P=>{let{user:B,kind:M}=P;return B.uid===c.uid&&u===M});I!==-1&&(this.pendingRemoteTracks.splice(I,1),this.emit(Rt.MediaReconnectEnd,c.uid))}}async unsubscribe(e,n,i){const s=this.pendingRemoteTracks.filter(h=>{let{user:p,kind:_}=h;return n!==void 0?p.uid===e.uid&&n===_:p.uid===e.uid});if(s.forEach(h=>{const p=this.pendingRemoteTracks.indexOf(h);this.pendingRemoteTracks.splice(p,1)}),this.connection&&this.state===Un.Connected||i||s.forEach(h=>{let{kind:p}=h;var _;if(p===ot.AUDIO)(_=e._audioTrack)===null||_===void 0||_._destroy(),e._audioTrack=void 0;else if(p===ot.VIDEO){var E;(E=e._videoTrack)===null||E===void 0||E._destroy(),e._videoTrack=void 0}}),!this.connection||this.state!==Un.Connected)return;const c=this.filterTobeUnSubscribedTracks(e,n);if(c.length===0)return;await this.connection.stopReceiving(c.map(h=>{let[,{id:p}]=h;return p}));const u=this.createUnsubscribeMessage(c);return this.withdrawRemoteTracks(c),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),c.forEach(h=>{let[p,{kind:_}]=h;var E,S;if(_===ot.VIDEO&&p._videoSSRC&&((E=this.connection)===null||E===void 0||E.setStatsRemoteVideoIsReady(p._videoSSRC,!1)),_===ot.VIDEO)this.unbindRemoteTrackEvents(p._videoTrack),i||((S=p._videoTrack)===null||S===void 0||S._destroy(),p._videoTrack=void 0);else if(_===ot.AUDIO){var w;this.unbindRemoteTrackEvents(p._audioTrack),!i&&((w=p._audioTrack)===null||w===void 0||w._destroy(),p._audioTrack=void 0)}}),u}async unsubscribeDataChannel(e,n){if(n.forEach(c=>{const u=this.pendingRemoteDataChannels.findIndex(h=>h.id===c.id);u!==-1&&this.pendingRemoteDataChannels.splice(u,1)}),!this.connection)return;const i=this.filterTobeUnSubscribedDataChannels(e,n);if(i.length===0)return;n.forEach(c=>{c._close()});const s=this.remoteDataChannelMap.get(e);return i.forEach(c=>{s&&s.delete(c.id)}),s&&s.size===0&&(this.remoteDataChannelMap.delete(e),await this.connection.stopDataChannels(e.uid)),i.map(c=>c.id)}async massUnsubscribe(e){return this.massUnsubscribeNoLock(e)}async massUnsubscribeNoLock(e){let n=[];for(const{user:c,mediaType:u}of e){const h=this.pendingRemoteTracks.filter(p=>{let{user:_,kind:E}=p;return u!==void 0?_.uid===c.uid&&u===E:_.uid===c.uid});h.forEach(p=>{const _=this.pendingRemoteTracks.indexOf(p);this.pendingRemoteTracks.splice(_,1)}),n=n.concat(h)}if(!this.connection||this.state!==Un.Connected)return void n.forEach(c=>{let{user:u,kind:h}=c;var p;if(h===ot.AUDIO)(p=u._audioTrack)===null||p===void 0||p._destroy(),u._audioTrack=void 0;else if(h===ot.VIDEO){var _;(_=u._videoTrack)===null||_===void 0||_._destroy(),u._videoTrack=void 0}});const i=ka(e).call(e,(c,u)=>{let{user:h,mediaType:p}=u;const _=this.filterTobeUnSubscribedTracks(h,p);return c.concat(_)},[]);if(i.length===0)return;await this.connection.stopReceiving(i.map(c=>{let[,{id:u}]=c;return u}));const s=this.createUnsubscribeAllMessage(i);return this.withdrawRemoteTracks(i),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),i.forEach(c=>{let[u,{kind:h}]=c;var p,_;if(h===ot.VIDEO&&u._videoSSRC&&((p=this.connection)===null||p===void 0||p.setStatsRemoteVideoIsReady(u._videoSSRC,!1)),h===ot.VIDEO)this.unbindRemoteTrackEvents(u._videoTrack),(_=u._videoTrack)===null||_===void 0||_._destroy(),u._videoTrack=void 0;else if(h===ot.AUDIO){var E;this.unbindRemoteTrackEvents(u._audioTrack),(E=u._audioTrack)===null||E===void 0||E._destroy(),u._audioTrack=void 0}}),s}isPreSubScribe(e){return!this.connection||this.state!==Un.Connected?!1:!!this.connection.getPreMedia(e)}async muteRemote(e,n){if(!this.connection)return;const i=this.remoteUserMap.get(e);if(!i)return void k.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid,"."));if(!i.get(n))return void k.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid," media type ").concat(n,"."));const s=n===ot.VIDEO?e._videoSSRC:e._audioSSRC;s!==void 0&&this.connection.setStatsRemoteVideoIsReady(s,!1)}async unmuteRemote(e,n){return this.unmuteRemoteNoLock(e,n)}async unmuteRemoteNoLock(e,n){if(!this.connection)return;const i=this.remoteUserMap.get(e);if(!i)return void k.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid,"."));i.get(n)||k.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(n,"."))}addAudioMetadata(e){const n=this.localTrackMap.get(xe.LocalAudioTrack),i=n&&n.track;i&&i.metadata.push(e)}getAllTracks(e){const n=this.localTrackMap.get(xe.LocalAudioTrack);if((n==null?void 0:n.track)instanceof yi){const i=n.track;return Array.from(this.localTrackMap.entries()).filter(s=>{let[c]=s;return c!==xe.LocalAudioTrack}).filter(s=>{let[c]=s;return!(e&&c===xe.LocalVideoLowTrack)}).map(s=>{let[,{track:c}]=s;return c}).concat(i.trackList)}return Array.from(this.localTrackMap.entries()).filter(i=>{let[s]=i;return!(e&&s===xe.LocalVideoLowTrack)}).map(i=>{let[,{track:s}]=i;return s})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(e,n,i,s,c){if(e){const h=this.localTrackMap.get(xe.LocalAudioTrack),p=s?this.localTrackMap.get(xe.LocalVideoLowTrack):this.localTrackMap.get(xe.LocalVideoTrack);pt.publish(this.store.sessionId,{eventElapse:Ro.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:n,audioName:h==null?void 0:h.track.getTrackLabel(),videoName:p==null?void 0:p.track.getTrackLabel(),screenshare:(p==null?void 0:p.track._hints.indexOf(tr.SCREEN_TRACK))!==-1,audio:!!h,video:!!p,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}else{var u;i||(i=[]);const h=i.find(_=>_ instanceof Fr),p=s?(u=this.localTrackMap.get(xe.LocalVideoTrack))===null||u===void 0?void 0:u.track:i.find(_=>_ instanceof ur);pt.publish(this.store.sessionId,{eventElapse:Ro.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:n,audioName:h==null?void 0:h.getTrackLabel(),videoName:p==null?void 0:p.getTrackLabel(),screenshare:(p==null?void 0:p._hints.indexOf(tr.SCREEN_TRACK))!==-1,audio:!!h,video:!!p,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}}reportSubscribeEvent(e,n,i,s){const c=s===ot.VIDEO?i._videoSSRC:i._audioSSRC;c&&pt.subscribe(this.store.sessionId,{succ:e,ec:n,video:s===ot.VIDEO,audio:s===ot.AUDIO,peerid:i.uid,subscribeRequestid:c,p2pid:this.store.p2pId,eventElapse:Ro.measureFromSubscribeStart(this.store.clientId,c),preSsrc:this.isPreSubScribe(c)})}reset(){k.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new To("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=OA(this.store),this.emit(Rt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(xe.LocalAudioTrack);if((e==null?void 0:e.track)instanceof yi){if(e.track.trackList.length>0){const n=e.track;e.track.trackList.forEach(i=>{n.removeAudioTrack(i)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=Un.Disconnected}getStats(){var e;return(e=this.connection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(e){var n;return((n=this.connection)===null||n===void 0?void 0:n.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(xe.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(xe.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const n=this.localTrackMap.get(e);return n&&n.track instanceof ur||n&&n.track instanceof Fr?n.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,n){if(!e)return this.remoteUserMap.size>0;const i=this.remoteUserMap.get(e);return!!i&&(!n||i.has(n))}async hasRemoteMediaWithLock(e,n){if(!e)return this.remoteUserMap.size>0;const i=this.remoteUserMap.get(e);return!!i&&(!n||i.has(n))}getRemoteMedia(e){var n;const i=Array.from(_c(n=this.remoteUserMap).call(n)).find(s=>s.uid===e);return i?{audioTrack:i.audioTrack,audioSSRC:i._audioSSRC,videoTrack:i.videoTrack,videoSSRC:i._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(i=>{let[s]=i;return{uid:s.uid,level:s.audioTrack?100*s.audioTrack._source.getAccurateVolumeLevel():0}});const n=this.localTrackMap.get(xe.LocalAudioTrack);return n&&e.push({level:100*n.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=YT(e).call(e,(i,s)=>i.level-s.level),e}async disconnectForReconnect(){this.connection&&(k.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=Un.Reconnecting,Z("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[n]=e;var i;n._videoTrack&&n._videoTrack._player&&((i=n._videoTrack._player.getVideoElement())===null||i===void 0||i.pause(),n._videoTrack._player.isKeepLastFrame=!0,n._videoTrack._originMediaStreamTrack.stop())}),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=OA(this.store),this.emit(Rt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var n;let[i,{track:s}]=e;switch(i){case xe.LocalVideoTrack:$e(n=s._hints).call(n,tr.LOW_STREAM)?s.close():this.pendingLocalTracks.push(s);break;case xe.LocalAudioTrack:s instanceof yi?this.pendingLocalTracks=this.pendingLocalTracks.concat(s.trackList):this.pendingLocalTracks.push(s);case xe.LocalVideoLowTrack:}}),this.emit(Rt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[n,i]=e;Array.from(_c(i).call(i)).forEach(s=>{this.setPendingRemoteMedia(n,s)}),this.emit(Rt.MediaReconnectStart,n.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(e=>{this.pendingLocalDataChannels.push(e)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(e=>{let[n,i]=e;Array.from(_c(i).call(i)).forEach(s=>{this.setPendingRemoteDataChannel(n,s)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),k.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(e,n){for(const i of this.pendingRemoteDataChannels){const{user:s,id:c}=i;if((e instanceof Xp?e.uid:e)===s.uid&&c===n)return!0}return!1}setPendingRemoteDataChannel(e,n){this.hasPendingRemoteDataChannel(e,n)||this.pendingRemoteDataChannels.push({user:e,id:n})}hasPendingRemoteMedia(e,n){for(const i of this.pendingRemoteTracks){const{user:s,kind:c}=i;if((e instanceof Xp?e.uid:e)===s.uid&&n===c)return!0}return!1}setPendingRemoteMedia(e,n){this.hasPendingRemoteMedia(e,n)||this.pendingRemoteTracks.push({user:e,kind:n})}restartICE(e){var n=this;return Zc(function*(){if(!n.connection||n.state!==Un.Connected)return;const i=yield _n(n.mutex.lock("From P2PChannel.restartICE"));let s;try{s=yield _n(n.connection.restartICE(e));const u=yield _n(s.next());if(u.done)return;const h=u.value,p=yield h;switch(QL(n.connection)&&n.reportPCStats(Date.now(),!1,n._pcStatsUploadType),e){case wo.UDP_TCP_RELAY:n._pcStatsUploadType=vf.UDP_TCP_RESTART;break;case wo.TCP_RELAY:n._pcStatsUploadType=vf.TCP_RESTART;break;case wo.RELAY:n._pcStatsUploadType=vf.RELAY_RESTART;break;default:n._pcStatsUploadType=vf.OLD_RESTART}n._isTryConnecting=!0,s.next(p)}catch(u){var c;(c=s)===null||c===void 0||c.throw(u)}finally{i()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats(),n=this.localTrackMap.get(xe.LocalVideoTrack),i=this.localTrackMap.get(xe.LocalAudioTrack),s=e.videoSend.find(P=>P.ssrc===(n==null?void 0:n.ssrcs[0].ssrcId)),c=e.audioSend.find(P=>P.ssrc===(i==null?void 0:i.ssrcs[0].ssrcId));if(!s||!c)return 1;const u=mc(this,Rt.NeedSignalRTT),h=s?s.rttMs:void 0,p=c?c.rttMs:void 0,_=h&&p?(h+p)/2:h||p,E=(_&&u?(_+u)/2:_||u)||0,S=100*e.sendPacketLossRate*.7/50+.3*E/1500,w=S<.17?1:S<.36?2:S<.59?3:S<.1?4:5,I=n==null?void 0:n.track;if(I&&I._encoderConfig&&I._hints.indexOf(tr.SCREEN_TRACK)===-1){const P=I._encoderConfig.bitrateMax,B=e.bitrate.actualEncoded;if(P&&B){const M=(1e3*P-B)/(1e3*P);return oz[M<.15?0:M<.3?1:M<.45?2:M<.6?3:4][w]}}return w}getDownlinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats();let n=0;return Array.from(this.remoteUserMap.entries()).forEach(i=>{let[s]=i;const c=s._audioSSRC,u=s._videoSSRC,h=e.audioRecv.find(B=>B.ssrc===c),p=e.videoRecv.find(B=>B.ssrc===u);if(!h&&!p)return void(n+=1);const _=mc(this,Rt.NeedSignalRTT),E=e.rtt,S=(E&&_?(E+_)/2:E||_)||0,w=h?h.jitterMs:void 0,I=e.recvPacketLossRate;let P=.7*I*100/50+.3*S/1500;w&&(P=.6*I*100/50+.2*S/1500+.2*w/400),n+=P<.1?1:P<.17?2:P<.36?3:P<.59?4:5}),this.remoteUserMap.size>0?Math.round(n/this.remoteUserMap.size):n}async muteLocalTrack(e){return new Qe((n,i)=>{this.handleMuteLocalTrack(e,n,i)})}async replaceTrack(e,n){var i;if(k.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(e.getTrackId(),"] to [").concat(n.getTrackId(),"]")),!this.connection||this.state!==Un.Connected)return;const s=Array.from(this.localTrackMap.entries()).find(u=>{let[,{track:h}]=u;return e===h});if(!s)return;const c=s[0];if(e!==n&&(this.unbindLocalTrackEvents([{track:e,type:c}]),this.bindLocalTrackEvents([{track:n,type:c}]),s[1].track=n),await((i=this.connection)===null||i===void 0?void 0:i.replaceTrack(n,s[1].id)),this.isPlanB){const u=s[1];u.id=n._mediaStreamTrack.id,this.localTrackMap.set(c,u)}if(c===xe.LocalVideoTrack&&!Z("DISABLE_DUAL_STREAM_USE_ENCODING")&&Cn().supportDualStreamEncoding){const u=this.localTrackMap.get(xe.LocalVideoLowTrack);if(u){const h=e._mediaStreamTrack.clone();u.track._originMediaStreamTrack.stop(),u.track._mediaStreamTrack=h,u.track._originMediaStreamTrack=h,await new Qe((p,_)=>{this.handleReplaceTrack(u.track,p,_,!0)})}}}filterTobePublishedTracks(e,n,i){const s=[],c=this.getAllTracks();e=kE(e=e.filter(_=>c.indexOf(_)===-1));let u,h=!1;const p=this.localTrackMap.get(xe.LocalAudioTrack);for(const _ of e){if(_ instanceof ur&&(this.localTrackMap.has(xe.LocalVideoTrack)||h?new Ie(Y.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(s.push({track:_,type:xe.LocalVideoTrack}),h=!0),n)){const E=this.getLowVideoTrack(_,i);s.push({track:E,type:xe.LocalVideoLowTrack})}if(_ instanceof Fr)if(p){const E=p.track;if(E instanceof yi)XL([_]),E.addAudioTrack(_),this.bindLocalAudioTrackEvents(_,!0);else{const S=JL([E,_]);k.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(S.getTrackId(),"]")),this.replaceTrack(E,S)}}else u instanceof yi?(XL([_]),u.addAudioTrack(_)):u||!_._useAudioElement&&Cn().webAudioMediaStreamDest&&!_._bypassWebAudio?u=JL(u?[_,u]:[_]):u=_}return u&&(k.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(u.getTrackId(),"]")),s.push({track:u,type:xe.LocalAudioTrack})),s}filterTobeUnpublishedTracks(e){const n=[],i=this.getAllTracks();e=kE(e=e.filter(s=>i.indexOf(s)!==-1));for(const s of e){if(s instanceof Fr){const c=this.localTrackMap.get(xe.LocalAudioTrack);if(!c)continue;c.track instanceof yi?(c.track.removeAudioTrack(s),this.unbindLocalAudioTrackEvents(s),c.track.trackList.length===0&&(n.push([xe.LocalAudioTrack,c]),c.track.close())):n.push([xe.LocalAudioTrack,c])}if(s instanceof ur){const c=this.localTrackMap.get(xe.LocalVideoTrack);if(!c)continue;n.push([xe.LocalVideoTrack,c]);const u=this.localTrackMap.get(xe.LocalVideoLowTrack);u&&n.push([xe.LocalVideoLowTrack,u])}}return n}filterTobePublishedDataChannels(e){return e=(e=kE(e)).filter(n=>this.localDataChannels.findIndex(i=>i.id===n.id)===-1)}filterTobeUnpublishedDataChannels(e){return e=(e=(e=kE(e)).filter(n=>this.localDataChannels.indexOf(n)!==-1)).filter(n=>n._originDataChannel)}bindLocalTrackEvents(e){e.forEach(n=>{let{track:i,type:s}=n;switch(s){case xe.LocalVideoTrack:i.addListener(ct.GET_STATS,this.handleGetLocalVideoStats),i.addListener(ct.GET_RTC_STATS,this.handleGetRTCStats),i.addListener(ct.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(ct.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(ct.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.addListener(ct.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.addListener(ct.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.addListener(ct.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(ct.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case xe.LocalAudioTrack:this.bindLocalAudioTrackEvents(i);case xe.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,n){e instanceof yi?e.trackList.forEach(i=>{i.addListener(ct.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(ct.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(ct.GET_STATS,this.handleGetLocalAudioStats),i.addListener(ct.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(ct.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(ct.GET_STATS,this.handleGetLocalAudioStats),e.addListener(ct.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(ct.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(ct.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(ct.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),n||(e.addListener(ct.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.addListener(ct.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(n=>{let[i,{track:s}]=n;return{track:s,type:i}})),e.forEach(n=>{let{track:i,type:s}=n;switch(s){case xe.LocalVideoTrack:i.off(ct.GET_STATS,this.handleGetLocalVideoStats),i.off(ct.GET_RTC_STATS,this.handleGetRTCStats),i.off(ct.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.off(ct.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.off(ct.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.off(ct.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.off(ct.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.off(ct.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.off(ct.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case xe.LocalAudioTrack:this.unbindLocalAudioTrackEvents(i);case xe.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof yi?e.trackList.forEach(n=>{n.off(ct.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(ct.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(ct.GET_STATS,this.handleGetLocalAudioStats),n.off(ct.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(ct.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(ct.GET_STATS,this.handleGetLocalAudioStats),e.off(ct.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(ct.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(ct.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(ct.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),e.off(ct.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(ct.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,n){n instanceof HE&&n.addListener(ct.GET_STATS,i=>{i(this.handleGetRemoteVideoStats(e))}),n instanceof KE&&n.addListener(ct.GET_STATS,i=>{i(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(ct.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[n,i]=e;i.has(ot.AUDIO)&&this.unbindRemoteTrackEvents(n._audioTrack),i.has(ot.VIDEO)&&this.unbindRemoteTrackEvents(n._videoTrack)})}createGatewayPublishMessage(e,n){return e.map((i,s)=>{var c;let u,h,{track:p,type:_}=i;switch(_){case xe.LocalAudioTrack:u=Bn.Audio,h={dtx:p instanceof tA&&p._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case xe.LocalVideoTrack:u=$e(c=p._hints).call(c,tr.SCREEN_TRACK)?Bn.Screen:Bn.High,h=Kd(Kd({},bz(p)),{},{codec:this.store.codec,svc_mode:_A()});break;case xe.LocalVideoLowTrack:u=Bn.Low,h=Kd(Kd({},bz(p)),{},{codec:this.store.codec,svc_mode:_A()})}return{stream_type:u,attributes:h,ssrcs:n[s]}})}createGatewayUnpublishMessage(e){return e.map(n=>{var i;let s,[c,{track:u,ssrcs:h,id:p}]=n;switch(c){case xe.LocalVideoTrack:s=$e(i=u._hints).call(i,tr.SCREEN_TRACK)?Bn.Screen:Bn.High;break;case xe.LocalAudioTrack:s=Bn.Audio;break;case xe.LocalVideoLowTrack:s=Bn.Low}return{stream_type:s,ssrcs:h,mid:p}})}assignLocalTracks(e,n){e.forEach((i,s)=>{let{track:c,type:u}=i;this.localTrackMap.set(u,{track:c,id:n[s].id,ssrcs:n[s].localSSRC})})}withdrawLocalTracks(e){e.forEach(n=>{let[i]=n;this.localTrackMap.delete(i)})}bindConnectionEvents(e){e.onConnectionStateChange=async n=>{if(k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(n,")")),this.emit(Rt.PeerConnectionStateChange,n),n==="connecting"&&e instanceof zd&&!Nr()&&Z("FIRST_TCP_CANDIDATE")&&window.setTimeout(()=>{n==="connecting"&&e.extendCandidate()},Z("FIRST_TCP_CANDIDATE_INTERVAL")),n!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),n==="connected"&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),e instanceof zd&&T8(e,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=vf.DISCONNECTED_OR_FAILED,mc(this,Rt.QueryClientConnectionState)==="CONNECTED"&&this._isWaitPcToRePub)){const i=this.pendingLocalTracks.map(c=>c.getTrackId()),s=this.pendingLocalDataChannels.map(c=>"dc_".concat(c.id));pt.reportApiInvoke(this.store.sessionId,{name:fi.REPUB_AFTER_PC_CONNECTED,options:i.concat(s),tag:Dr.TRACER}).onSuccess(),this.republish()}if(Z("NEW_ICE_RESTART")&&e instanceof zd&&!Nr()&&!this._forceTurn){if($e(gz).call(gz,n)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const i=c=>{QL(e)&&(k.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(c)),mc(this,Rt.QueryClientConnectionState)==="CONNECTED"&&this.emit(Rt.RequestRestartICE,c))},s=()=>{QL(e)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),k.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(Rt.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout(()=>{b8(e,i,s)},800))}}else{if(n==="disconnected"&&e.iceConnectionState==="disconnected")return setTimeout(()=>{e.iceConnectionState==="disconnected"&&Z("ICE_RESTART")&&mc(this,Rt.QueryClientConnectionState)==="CONNECTED"&&this.emit(Rt.RequestRestartICE)},800),void setTimeout(()=>{e.peerConnectionState==="disconnected"&&(k.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout(()=>this.emit(Rt.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);n==="failed"&&(k.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout(()=>this.emit(Rt.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},e.onICEConnectionStateChange=n=>{n!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(n,")")),pt.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:n,tag:Dr.TRACER}).onSuccess(),this.emit(Rt.IceConnectionStateChange,n)},e.onICETransportStateChange=n=>{k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(n,")"))},e.onDTLSTransportStateChange=n=>{k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(n,")"))},e.onDTLSTransportError=n=>{k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(n,")"))},e.onFirstAudioDecoded=n=>{var i;const s=Array.from(_c(i=this.remoteUserMap).call(i)).find(u=>u._audioSSRC===n);var c;s&&(this.store.subscribe(s.uid,"audio",void 0,void 0,void 0,Date.now()),(c=s.audioTrack)===null||c===void 0||c.emit(jE.FIRST_FRAME_DECODED),pt.firstRemoteFrame(this.store.sessionId,Ni.FIRST_AUDIO_DECODE,Er.FIRST_AUDIO_DECODE,{peer:s._uintid,subscribeElapse:Ro.measureFromSubscribeStart(this.store.clientId,n),subscribeRequestid:n,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=n=>{var i;const s=Array.from(_c(i=this.remoteUserMap).call(i)).find(c=>c._audioSSRC===n);s&&pt.firstRemoteFrame(this.store.sessionId,Ni.FIRST_AUDIO_RECEIVED,Er.FIRST_AUDIO_RECEIVED,{peer:s._uintid,subscribeElapse:Ro.measureFromSubscribeStart(this.store.clientId,n),subscribeRequestid:n,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(n,i,s)=>{this.reportVideoFirstFrameDecoded(n,i,s)},e.onFirstVideoReceived=n=>{var i;const s=Array.from(_c(i=this.remoteUserMap).call(i)).find(c=>c._videoSSRC===n);s&&pt.firstRemoteFrame(this.store.sessionId,Ni.FIRST_VIDEO_RECEIVED,Er.FIRST_VIDEO_RECEIVED,{peer:s._uintid,subscribeElapse:Ro.measureFromSubscribeStart(this.store.clientId,n),subscribeRequestid:n,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(n,i)=>{const s=n.candidateType==="relay",c=i.candidateType==="relay";i.candidateType!=="unknown"&&s===c||this.emit(Rt.ConnectionTypeChange,s),k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify($p(i))," -> ").concat(JSON.stringify($p(n)),")"))},e.onSelectedRemoteCandidateChanged=(n,i)=>{k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify($p(i))," -> ").concat(JSON.stringify($p(n)),")"))},e.onFirstVideoDecodedTimeout=n=>{this.reportVideoFirstFrameDecoded(n,void 0,void 0,!0)},e.getLocalVideoStats=()=>{const n=this.statsCollector.getLocalVideoTrackStats(),i=this.statsCollector.getRTCStats();return Kd(Kd({},n),i)},e.onICECandidateError=n=>{this._iceError=n}}resetConnection(e){e instanceof zd&&function(n){oy.delete(n.id),T8(n)}(e),e.close(),this.emit(Rt.PeerConnectionStateChange,"closed"),function(n){n.onConnectionStateChange=void 0,n.onICEConnectionStateChange=void 0,n.onICETransportStateChange=void 0,n.onDTLSTransportStateChange=void 0,n.onDTLSTransportError=void 0,n.onFirstAudioDecoded=void 0,n.onFirstAudioReceived=void 0,n.onFirstVideoDecoded=void 0,n.onFirstVideoReceived=void 0,n.onSelectedLocalCandidateChanged=void 0,n.onSelectedRemoteCandidateChanged=void 0,n.onFirstVideoDecodedTimeout=void 0,n.getLocalVideoStats=void 0}(e),this._isWaitPcToRePub=!1}filterTobeMutedTracks(e){const n=[];if(this.getAllTracks().indexOf(e)===-1)return n;const i=this.localTrackMap.get(xe.LocalAudioTrack);if(e instanceof Fr&&(i==null?void 0:i.track)instanceof yi)return i.track.isActive||n.push([xe.LocalAudioTrack,i]),n;const s=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return e===u});if(s&&(n.push(s),s[0]===xe.LocalVideoTrack)){const c=this.localTrackMap.get(xe.LocalVideoLowTrack);c&&n.push([xe.LocalVideoLowTrack,c])}return n}filterTobeUnmutedTracks(e){const n=[],i=this.localTrackMap.get(xe.LocalAudioTrack);if(e instanceof Fr&&(i==null?void 0:i.track)instanceof yi)return i.track.isActive&&n.push([xe.LocalAudioTrack,i]),n;const s=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return e===u});if(s)if(s[0]===xe.LocalVideoTrack){n.push(s);const c=this.localTrackMap.get(xe.LocalVideoLowTrack);c&&n.push([xe.LocalVideoLowTrack,c])}else n.push(s);return n}createMuteMessage(e){return e.map(n=>{var i;let s,[c,{track:u,ssrcs:h,id:p}]=n;switch(c){case xe.LocalAudioTrack:s=Bn.Audio;break;case xe.LocalVideoTrack:s=$e(i=u._hints).call(i,tr.SCREEN_TRACK)?Bn.Screen:Bn.High;break;case xe.LocalVideoLowTrack:s=Bn.Low}return{stream_type:s,ssrcs:h,mid:p}})}createUnmuteMessage(e){return e.map(n=>{var i;let s,[c,{track:u,ssrcs:h,id:p}]=n;switch(c){case xe.LocalAudioTrack:s=Bn.Audio;break;case xe.LocalVideoTrack:s=$e(i=u._hints).call(i,tr.SCREEN_TRACK)?Bn.Screen:Bn.High;break;case xe.LocalVideoLowTrack:s=Bn.Low}return{stream_type:s,ssrcs:h,mid:p}})}filterTobeUnSubscribedTracks(e,n){const i=[],s=this.remoteUserMap.get(e);if(!s)return i;if(n){const c=s.get(n);if(!c)return i;i.push([e,{kind:n,id:c}])}else Array.from(s.entries()).forEach(c=>{let[u,h]=c;i.push([e,{kind:u,id:h}])});return i}filterTobeUnSubscribedDataChannels(e,n){const i=[];return n.forEach(s=>{var c;(c=this.remoteDataChannelMap.get(e))!==null&&c!==void 0&&c.has(s.id)&&i.push(s)}),i}createUnsubscribeMessage(e){const n=[];return e.forEach(i=>{let[s,{kind:c,id:u}]=i;switch(c){case ot.VIDEO:return void(s._videoSSRC&&n.push({stream_type:ot.VIDEO,ssrcId:s._videoSSRC}));case ot.AUDIO:return void(s._audioSSRC&&n.push({stream_type:ot.AUDIO,ssrcId:s._audioSSRC}))}}),n}createUnsubscribeAllMessage(e){const n=new Map;return e.forEach(i=>{let[s,{kind:c}]=i;if(n.has(s)){let u=n.get(s);c===ot.VIDEO?u|=ki.Video:u|=ki.Audio,n.set(s,u)}else c===ot.VIDEO?n.set(s,ki.Video):n.set(s,ki.Audio)}),{users:Array.from(n.entries()).map(i=>{let[s,c]=i;return{stream_id:s.uid,stream_type:c}})}}withdrawRemoteTracks(e){e.forEach(n=>{let[i,{kind:s}]=n;const c=this.remoteUserMap.get(i);c&&(c.delete(s),Array.from(c.entries()).length===0&&this.remoteUserMap.delete(i))})}async updateBitrateLimit(e){const n=this.localTrackMap.get(xe.LocalVideoTrack),i=this.localTrackMap.get(xe.LocalVideoLowTrack);n&&(await n.track.setBitrateLimit(e.uplink),await new Qe((s,c)=>{this.handleUpdateVideoEncoder(n.track,s,c,!0)})),i&&e.low_stream_uplink&&(await i.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new Qe((s,c)=>{this.handleUpdateVideoEncoder(i.track,s,c,!0)}))}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}mapPubResToRemoteConfig(e,n,i){return e.map((s,c)=>{var u;let{stream_type:h}=s;const p=(u=n.find(_=>{let{stream_type:E}=_;return h===E}))===null||u===void 0?void 0:u.attributes;if(p&&Z("DISABLE_SCREEN_SHARE_REMB")){const _=i[c]._hints;($e(_).call(_,tr.SCREEN_TRACK)||$e(_).call(_,tr.SCREEN_LOW_TRACK))&&(p.remb=!1,k.debug("disable remb for screen share, hints:",_))}return p})}async tryToUnmuteAudio(e){for(let i=0;i<e.length;i++)if(e[i]instanceof Fr){var n;const s=this.filterTobeUnmutedTracks(e[i]);if(s.length===0)continue;await((n=this.connection)===null||n===void 0?void 0:n.unmuteLocal(s.map(u=>{let[,{id:h}]=u;return h})));const c=this.createUnmuteMessage(s);return void await Zn(this,Rt.RequestUnmuteLocal,c)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var n;return!((n=this.connection)===null||n===void 0||!n.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,n)=>this.emit(Rt.RequestUpload,e,n),this.statsUploader.requestUploadStats=e=>this.emit(Rt.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var e;return{connectState:((e=this.connection)===null||e===void 0?void 0:e.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Ji(z1(this.dtlsFailedCount,pi)),this.emit(Rt.RequestReconnect)}async reconnectP2P(){const e=Array.from(this.localTrackMap.entries()),n=this.createGatewayUnpublishMessage(e);Array.from(this.remoteUserMap.entries()),n.length>0&&await ho(this,Rt.RequestUnpublishForReconnectPC,n),this.disconnectForReconnect(),this.emit(Rt.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(xe.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof ur)}throwIfTrackTypeNotMatch(e){if(e.filter(n=>n instanceof ur).length>1)throw new Ie(Y.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(n=>n instanceof Fr).length>1&&(e.some(n=>n instanceof Fr&&n._bypassWebAudio)||!Cn().webAudioMediaStreamDest))throw new Ie(Y.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const n of e){if(n instanceof ur&&this.pendingLocalTracks.some(i=>i instanceof ur))throw new Ie(Y.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(n instanceof Fr&&this.pendingLocalTracks.some(i=>i instanceof Fr)&&(!Cn().webAudioMediaStreamDest||n._bypassWebAudio||this.pendingLocalTracks.some(i=>i instanceof Fr&&i._bypassWebAudio)))throw new Ie(Y.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,n){var i;const s=!Z("DISABLE_DUAL_STREAM_USE_ENCODING")&&Cn().supportDualStreamEncoding,c=Kd(Kd({},{width:160,height:120,framerate:15,bitrate:50}),n);let u;u=s?e._mediaStreamTrack.clone():ZL(e,c);const h=er(8,"track-low-"),p=new ur(u,Kd(Kd({},s&&{scaleResolutionDownBy:xL(c,e)}),{},{frameRate:c.framerate,bitrateMax:c.bitrate,bitrateMin:c.bitrate}),void 0,void 0,h);return p.on(Jg.TRANSCEIVER_UPDATED,_=>{e._updateRtpTransceiver(_,VE.LOW_STREAM)}),p._hints.push(tr.LOW_STREAM),$e(i=e._hints).call(i,tr.SCREEN_TRACK)&&p._hints.push(tr.SCREEN_LOW_TRACK),e.on("sei-to-send",_=>{p.emit("sei-to-send",_)}),e.addListener(ct.NEED_CLOSE,()=>{p.close()}),p}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(e,n,i){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof zd){var c,u,h,p;const _=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:E,dtlsTransportState:S,peerConnectionState:w}=this.connection,{local:I,remote:P}=await this.connection.getSelectedCandidatePair();pt.pcStats(this.store.sessionId,{startTime:_,eventElapse:e-_||0,iceconnectionsate:E,dtlsstate:S,connectionstate:w,intSucc:n?1:2,error:this._iceError||s||"",selectedLocalCandidateProtocol:(c=I==null?void 0:I.protocol)!==null&&c!==void 0?c:"",selectedLocalCandidateType:(u=I.candidateType)!==null&&u!==void 0?u:"",selectedLocalCandidateAddress:"".concat(I.address,":").concat(I.port),selectedRemoteCandidateProtocol:(h=P.protocol)!==null&&h!==void 0?h:"",selectedRemoteCandidateType:(p=P.candidateType)!==null&&p!==void 0?p:"",selectedRemoteCandidateAddress:"".concat(P.address,":").concat(P.port),restartCnt:i,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameDecoded(e,n,i,s){var c;const u=Array.from(_c(c=this.remoteUserMap).call(c)).find(h=>h._videoSSRC===e);if(u){s||this.store.subscribe(u.uid,"video",void 0,void 0,void 0,void 0,Date.now());const h=this.store.keyMetrics,p=h.subscribe.find(_=>_.userId===u.uid&&_.type==="video");pt.firstRemoteVideoDecode(this.store.sessionId,Ni.FIRST_VIDEO_DECODE,Er.FIRST_VIDEO_DECODE,{peer:u._uintid,videowidth:n,videoheight:i,subscribeElapse:Ro.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:h.requestAPEnd||0,apStart:h.requestAPStart||0,joinGwEnd:h.joinGatewayEnd||0,joinGwStart:h.joinGatewayStart||0,pcEnd:h.peerConnectionEnd||0,pcStart:h.peerConnectionStart||0,subscriberEnd:(p==null?void 0:p.subscribeEnd)||0,subscriberStart:(p==null?void 0:p.subscribeStart)||0,videoAddNotify:(p==null?void 0:p.streamAdded)||0,state:s?1:0,firstFrame:(p==null?void 0:p.firstFrame)||0})}}async remoteMediaSsrcChanged(e,n,i){if(!this.connection)return!1;const s=this.remoteUserMap.get(e);if(!s)return!1;const c=s.get(n);if(!c)return!1;const u=await this.connection.getRemoteSSRC(c);return u!==void 0&&u!==i}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[n,{track:i}]=e;n===xe.LocalVideoLowTrack?i._updateRtpTransceiver(void 0,VE.LOW_STREAM):i._updateRtpTransceiver(void 0)})}},ut(tn.prototype,"startP2PConnection",[Xo],Object.getOwnPropertyDescriptor(tn.prototype,"startP2PConnection"),tn.prototype),ut(tn.prototype,"connect",[Xo],Object.getOwnPropertyDescriptor(tn.prototype,"connect"),tn.prototype),ut(tn.prototype,"updateRemoteRTPCapabilities",[Xo],Object.getOwnPropertyDescriptor(tn.prototype,"updateRemoteRTPCapabilities"),tn.prototype),ut(tn.prototype,"publishDataChannel",[Xo],Object.getOwnPropertyDescriptor(tn.prototype,"publishDataChannel"),tn.prototype),ut(tn.prototype,"unpublish",[Xo],Object.getOwnPropertyDescriptor(tn.prototype,"unpublish"),tn.prototype),ut(tn.prototype,"unpublishDataChannel",[Xo],Object.getOwnPropertyDescriptor(tn.prototype,"unpublishDataChannel"),tn.prototype),ut(tn.prototype,"unpublishLowStream",[Xo],Object.getOwnPropertyDescriptor(tn.prototype,"unpublishLowStream"),tn.prototype),ut(tn.prototype,"subscribeDataChannel",[Xo],Object.getOwnPropertyDescriptor(tn.prototype,"subscribeDataChannel"),tn.prototype),ut(tn.prototype,"subscribe",[Xo],Object.getOwnPropertyDescriptor(tn.prototype,"subscribe"),tn.prototype),ut(tn.prototype,"massSubscribe",[Xo],Object.getOwnPropertyDescriptor(tn.prototype,"massSubscribe"),tn.prototype),ut(tn.prototype,"unsubscribe",[Xo],Object.getOwnPropertyDescriptor(tn.prototype,"unsubscribe"),tn.prototype),ut(tn.prototype,"unsubscribeDataChannel",[Xo],Object.getOwnPropertyDescriptor(tn.prototype,"unsubscribeDataChannel"),tn.prototype),ut(tn.prototype,"massUnsubscribe",[Xo],Object.getOwnPropertyDescriptor(tn.prototype,"massUnsubscribe"),tn.prototype),ut(tn.prototype,"muteRemote",[Xo],Object.getOwnPropertyDescriptor(tn.prototype,"muteRemote"),tn.prototype),ut(tn.prototype,"unmuteRemote",[Xo],Object.getOwnPropertyDescriptor(tn.prototype,"unmuteRemote"),tn.prototype),ut(tn.prototype,"hasRemoteMediaWithLock",[Xo],Object.getOwnPropertyDescriptor(tn.prototype,"hasRemoteMediaWithLock"),tn.prototype),ut(tn.prototype,"disconnectForReconnect",[Xo],Object.getOwnPropertyDescriptor(tn.prototype,"disconnectForReconnect"),tn.prototype),ut(tn.prototype,"updateBitrateLimit",[Xo],Object.getOwnPropertyDescriptor(tn.prototype,"updateBitrateLimit"),tn.prototype),ut(tn.prototype,"remoteMediaSsrcChanged",[Xo],Object.getOwnPropertyDescriptor(tn.prototype,"remoteMediaSsrcChanged"),tn.prototype),tn);function Xo(e,n,i){const s=e[n];if(typeof s!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const c=this.mutex,u=await c.lock("From P2PChannel.".concat(n));try{for(var h=arguments.length,p=new Array(h),_=0;_<h;_++)p[_]=arguments[_];return await s.apply(this,p)}finally{u()}},i}function C8(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,s)}return i}function I8(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?C8(Object(i),!0).forEach(function(s){K(e,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):C8(Object(i)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(i,s))})}return e}const _fe=Date.now(),vfe=20,tx=new Map,xA=new Map;async function A8(e){const n=tx.get(e),i=Array.isArray(n)&&n[n.length-1],s=xA.get(e);if(!i)return void(s.isSyncing=!1);const c={uid:i.uid,payload:i.payload};s.firstRecvTs===0&&(s.firstRecvTs=i.recvTs,s.firstSendTs=i.sendTs);const u=i.sendTs-s.firstSendTs,h=u-(Date.now()-s.firstRecvTs);h>0&&(s.firstRecvTs=Date.now()-u);let p=i.mediaDelay+h;p<=0?(n.pop(),O8(i.context,c),p=0):p=Math.min(p,vfe),setTimeout(()=>n.length&&A8(e),p)}function O8(e,n){e.safeEmit(on.STREAM_MESSAGE,n.uid,n.payload),e.onStreamMessage&&e.onStreamMessage(n)}function Efe(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0;if(!e.syncWithAudio)return O8(i,{uid:e.uid,payload:e.payload});const s="".concat(i.id,"-").concat(e.uid),c=tx.get(s)||[],u=c.findIndex(E=>e.sendTs>=E.sendTs),h=I8(I8({},e),{},{context:i,mediaDelay:n,recvTs:Date.now()});u===-1?c.push(h):c.splice(u,0,h),tx.set(s,c);let p=!1;var _;xA.has(s)?p=!((_=xA.get(s))===null||_===void 0||!_.isSyncing):xA.set(s,{isSyncing:p,firstRecvTs:0,firstSendTs:0}),p||A8(s)}const yfe=vn().name;function P8(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,s)}return i}function N8(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?P8(Object(i),!0).forEach(function(s){K(e,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):P8(Object(i)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(i,s))})}return e}const sy="websdk_ng_cache_parameter",Sfe=Z("MAX_PRELOAD_ASYNC_LENGTH"),Tfe=1e4,u_=new Map,d_=[];let nx=null,rx=0,ix=0;const MA=new Map,bfe=function(e,n){const i=[];let s=0;const c=async()=>{const u=i.shift();u&&await u(),i.length>0&&s<n?c():s--};return async function(){for(var u=arguments.length,h=new Array(u),p=0;p<u;p++)h[p]=arguments[p];return new Qe(async(_,E)=>{i.push(async()=>{try{const S=await e(...h);_(S)}catch(S){E(S)}}),s<n&&(s++,c())})}}(k8,Sfe),ox=Ls.CancelToken.source();async function k8(e,n,i,s,c,u){try{if(!Z("ENABLE_PRELOAD"))return;if(!Cn().supportWebCrypto)return void Bp(()=>{k.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!i&&i!==null)throw new Ie(Y.INVALID_PARAMS,"Invalid token: ".concat(i,". If you don not use token, set it to null"));i&&Xi(i,"token",1,2047),Xi(e,"appid",1,2047),hA(n),s&&fA(s);const h=Yg();k.debug("preload channel ".concat(n,", uid is ").concat(s));const p={appId:e,cname:n,token:i||e,uid:typeof s!="string"?s:null,sid:h,proxyServer:c};let _,E;typeof s=="string"?(p.stringUid=s,[E,_]=await Qe.all([ofe(s,{sid:h,appId:e},ox.token),e8(N8(N8({},p),{},{token:i||e,uid:0}),ox.token)]),p.uid=E.uid,_.gatewayInfo.uid=p.uid,_.gatewayInfo.res.uid=p.uid):(u&&(p.stringUid=u),_=await e8(p,ox.token));const S={sid:h,appId:e,cname:n,token:i||e,uid:p.stringUid||s,intUid:p.uid||_.gatewayInfo.uid,stringUid:p.stringUid,ts:Date.now(),sua:E,ap:_};await async function(w){let I;try{w.uid&&L8({appId:w.appId,cname:w.cname,token:w.token,uid:w.uid,stringUid:w.stringUid});const P=V8(w),B=await async function(U,$){try{const q=await window.crypto.subtle.importKey("raw",w6($),"AES-GCM",!1,["encrypt"]),ce=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},q,qg(window.btoa(JSON.stringify(U))));return Wp(new Uint8Array(ce))}catch{return}}(w,w.token||w.appId);if(!B)return;I=U8(sy);const M=I?JSON.parse(I):[];M.push({[P]:B}),M.length>Z("AP_CACHE_NUM")&&M.shift(),UA(sy,JSON.stringify(M))}catch(P){k.warn("Error caching server parameters:",P.message),UA(sy,"")}}(S),rx++}catch(h){throw ix++,function(p){nx||(nx=window.setTimeout(()=>{let E="";MA.forEach((S,w)=>{E+="".concat(w,": ").concat(S," ;")}),pt.reportApiInvoke(null,{name:fi.PRELOAD,options:{success:rx,failed:ix,err:E}}).onError(p),rx=0,ix=0,MA.clear(),nx=null},Tfe));const _=MA.get(p.code)||0;MA.set(p.code,_+1)}(h),h}}async function D8(e){try{if(Z("AP_REQUEST_DETAIL")||Z("ENABLE_ROLE_SELECT_EDGE"))return;const n=L8(e);if(!n||e.cloudProxyServer!=="disabled")return;const i=await async function(s,c){try{const u=await window.crypto.subtle.importKey("raw",w6(c),"AES-GCM",!1,["decrypt"]),h=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},u,qg(s));return JSON.parse(window.atob(Wp(new Uint8Array(h))))}catch{return}}(n,e.token||e.appId);if(!i||!function(s,c){return s.cname===c.cname&&s.appId===c.appId&&s.token===c.token?c.stringUid?s.stringUid===c.stringUid:typeof c.uid=="number"?s.uid===c.uid:s.uid==c.uid:!1}(i,e))return;if(i&&Date.now()-i.ts<Z("AP_CACHE_LIFETIME"))return i}catch(n){k.warn("Error get preloadInfo",n.message)}}function L8(e){let n;try{if(n=U8(sy),!n)return;const i=JSON.parse(n),s=V8(e),c=function(h,p){for(let _=h.length-1;_>=0;_--)if(p(h[_]))return _;return-1}(i,h=>s in h);if(c===-1)return;const u=i.splice(c,1)[0];return UA(sy,JSON.stringify(i)),u[s]}catch(i){k.warn("Error delete preload info: ".concat(n),i.message),UA(sy,"")}}function sx(e){if(e){let n=u_.get(e);n&&(window.clearTimeout(n),n=null,u_.delete(e)),$e(d_).call(d_,e)||e.cloudProxyServer!=="disabled"||d_.push(e)}if(u_.size<Z("AP_CACHE_NUM")&&d_.length>0){const n=d_.shift();u_.set(n,window.setTimeout(async()=>{const{appId:i,cname:s,token:c,stringUid:u,uid:h,proxyServer:p}=n;try{await bfe(i,s,c,h,p,u),u_.has(n)&&sx(n)}catch(_){k.warn("update preload failed",_.message),x8(n)}},Z("AP_UPDATE_INTERVAL")))}}function x8(e){const n=d_.indexOf(e);n!==-1&&d_.splice(n,1);let i=u_.get(e);i&&(window.clearTimeout(i),i=null,u_.delete(e),sx())}function M8(e,n){const i=e.sua,s=e.ap;n&&i&&pt.reqUserAccount(e.sid,{lts:i.requestTime,elapse:i.elapse,success:!0,serverAddr:i.url,stringUid:n,uid:e.intUid,errorCode:null,extend:i.req}),pt.reportResourceTiming(e.ap.url,e.sid),pt.joinWebProxyAP(e.sid,{lts:s.requestTime,elapse:s.elapse,sucess:1,apServerAddr:s.url,turnServerAddrList:s.proxyInfo.addresses.map(c=>c.ip).join(","),eventType:"disabled",unilbsServerIds:[ii.CHOOSE_SERVER,ii.CLOUD_PROXY_FALLBACK].toString()}),pt.joinChooseServer(e.sid,{lts:s.requestTime,elapse:s.elapse,succ:!0,csAddr:s.url,opid:s.opid,serverList:s.gatewayInfo.gatewayAddrs.map(c=>c.address),ec:null,cid:s.gatewayInfo.cid.toString(),uid:s.gatewayInfo.uid.toString(),csIp:s.gatewayInfo.csIp,unilbsServerIds:[ii.CHOOSE_SERVER].toString(),isHttp3:s.isHttp3})}function U8(e){return window.atob(window.localStorage.getItem(e)||"")}function UA(e,n){window.localStorage.setItem(e,window.btoa(n))}function V8(e){let n="".concat(e.appId,"_").concat(e.cname);return typeof e.uid=="string"&&(n+="_s_".concat(e.uid)),typeof e.uid=="number"&&(n+="_".concat(e.uid)),e.token&&(n+="_".concat(e.token)),N6(n)}function wfe(e){let n=function(){const i=Ife.pop();return i?(i.offset=i.limit=0,i):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(i,s){let c=i.appId;c!==void 0&&(ai(s,10),Qp(s,c));let u=i.cid;u!==void 0&&(ai(s,16),ai(s,u));let h=i.cname;h!==void 0&&(ai(s,26),Qp(s,h));let p=i.deviceId;p!==void 0&&(ai(s,34),Qp(s,p));let _=i.elapse;_!==void 0&&(ai(s,40),Zp(s,_));let E=i.fileSize;E!==void 0&&(ai(s,48),Zp(s,ay(E)));let S=i.height;S!==void 0&&(ai(s,56),Zp(s,ay(S)));let w=i.jpg;w!==void 0&&(ai(s,66),ai(s,w.length),j8(s,w));let I=i.networkType;I!==void 0&&(ai(s,72),Zp(s,ay(I)));let P=i.osType;P!==void 0&&(ai(s,80),Zp(s,ay(P)));let B=i.requestId;B!==void 0&&(ai(s,90),Qp(s,B));let M=i.sdkVersion;M!==void 0&&(ai(s,98),Qp(s,M));let U=i.sequence;U!==void 0&&(ai(s,104),Zp(s,ay(U)));let $=i.sid;$!==void 0&&(ai(s,114),Qp(s,$));let q=i.timestamp;q!==void 0&&(ai(s,120),Zp(s,q));let ce=i.uid;ce!==void 0&&(ai(s,128),ai(s,ce));let me=i.vid;me!==void 0&&(ai(s,136),ai(s,me));let ge=i.width;ge!==void 0&&(ai(s,144),Zp(s,ay(ge)));let pe=i.service;pe!==void 0&&(ai(s,152),ai(s,pe));let Re=i.callbackData;Re!==void 0&&(ai(s,162),ai(s,Re.length),j8(s,Re));let Ve=i.ticket;Ve!==void 0&&(ai(s,170),Qp(s,Ve));let Ze=i.vendorConfigs;Ze!==void 0&&(ai(s,178),Qp(s,Ze))}(e,n),function(i){let s=i.bytes,c=i.limit;return s.length===c?s:s.subarray(0,c)}(n)}function Rfe(e){return function(i){let s={};e:for(;!Afe(i);){let c=k0(i);switch(c>>>3){case 0:break e;case 1:s.code=k0(i);break;case 2:s.msg=B8(i,k0(i));break;case 3:s.requestId=B8(i,k0(i));break;case 4:s.timestamp=Ofe(i,!1);break;default:Cfe(i,7&c)}}return s}({bytes:n=e,offset:0,limit:n.length});var n}function Cfe(e,n){switch(n){case 0:for(;128&zl(e););break;case 2:ax(e,k0(e));break;case 5:ax(e,4);break;case 1:ax(e,8);break;default:throw new Error("Unimplemented type: "+n)}}function ay(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let Ife=[];function ax(e,n){if(e.offset+n>e.limit)throw new Error("Skip past limit");e.offset+=n}function Afe(e){return e.offset>=e.limit}function VA(e,n){let i=e.bytes,s=e.offset,c=e.limit,u=s+n;if(u>i.length){let h=new Uint8Array(2*u);h.set(i),e.bytes=h}return e.offset=u,u>c&&(e.limit=u),s}function F8(e,n){let i=e.offset;if(i+n>e.limit)throw new Error("Read past limit");return e.offset+=n,i}function j8(e,n){let i=VA(e,n.length);e.bytes.set(n,i)}function B8(e,n){let i=F8(e,n),s=String.fromCharCode,c=e.bytes,u="",h="";for(let p=0;p<n;p++){let _,E,S,w,I=c[p+i];(128&I)==0?h+=s(I):(224&I)==192?p+1>=n?h+=u:(_=c[p+i+1],(192&_)!=128?h+=u:(w=(31&I)<<6|63&_,w<128?h+=u:(h+=s(w),p++))):(240&I)==224?p+2>=n?h+=u:(_=c[p+i+1],E=c[p+i+2],(49344&(_|E<<8))!=32896?h+=u:(w=(15&I)<<12|(63&_)<<6|63&E,w<2048||w>=55296&&w<=57343?h+=u:(h+=s(w),p+=2))):(248&I)==240?p+3>=n?h+=u:(_=c[p+i+1],E=c[p+i+2],S=c[p+i+3],(12632256&(_|E<<8|S<<16))!=8421504?h+=u:(w=(7&I)<<18|(63&_)<<12|(63&E)<<6|63&S,w<65536||w>1114111?h+=u:(w-=65536,h+=s(55296+(w>>10),56320+(1023&w)),p+=3))):h+=u}return h}function Qp(e,n){let i=n.length,s=0;for(let h=0;h<i;h++){let p=n.charCodeAt(h);p>=55296&&p<=56319&&h+1<i&&(p=(p<<10)+n.charCodeAt(++h)-56613888),s+=p<128?1:p<2048?2:p<65536?3:4}ai(e,s);let c=VA(e,s),u=e.bytes;for(let h=0;h<i;h++){let p=n.charCodeAt(h);p>=55296&&p<=56319&&h+1<i&&(p=(p<<10)+n.charCodeAt(++h)-56613888),p<128?u[c++]=p:(p<2048?u[c++]=p>>6&31|192:(p<65536?u[c++]=p>>12&15|224:(u[c++]=p>>18&7|240,u[c++]=p>>12&63|128),u[c++]=p>>6&63|128),u[c++]=63&p|128)}}function zl(e){return e.bytes[F8(e,1)]}function W8(e,n){let i=VA(e,1);e.bytes[i]=n}function k0(e){let n,i=0,s=0;do n=zl(e),i<32&&(s|=(127&n)<<i),i+=7;while(128&n);return s}function ai(e,n){for(n>>>=0;n>=128;)W8(e,127&n|128),n>>>=7;W8(e,n)}function Ofe(e,n){let i,s=0,c=0,u=0;return i=zl(e),s=127&i,128&i&&(i=zl(e),s|=(127&i)<<7,128&i&&(i=zl(e),s|=(127&i)<<14,128&i&&(i=zl(e),s|=(127&i)<<21,128&i&&(i=zl(e),c=127&i,128&i&&(i=zl(e),c|=(127&i)<<7,128&i&&(i=zl(e),c|=(127&i)<<14,128&i&&(i=zl(e),c|=(127&i)<<21,128&i&&(i=zl(e),u=127&i,128&i&&(i=zl(e),u|=(127&i)<<7))))))))),{low:s|c<<28,high:c>>>4|u<<24,unsigned:n}}function Zp(e,n){let i=n.low>>>0,s=(n.low>>>28|n.high<<4)>>>0,c=n.high>>>24,u=c===0?s===0?i<16384?i<128?1:2:i<1<<21?3:4:s<16384?s<128?5:6:s<1<<21?7:8:c<128?9:10,h=VA(e,u),p=e.bytes;switch(u){case 10:p[h+9]=c>>>7&1;case 9:p[h+8]=u!==9?128|c:127&c;case 8:p[h+7]=u!==8?s>>>21|128:s>>>21&127;case 7:p[h+6]=u!==7?s>>>14|128:s>>>14&127;case 6:p[h+5]=u!==6?s>>>7|128:s>>>7&127;case 5:p[h+4]=u!==5?128|s:127&s;case 4:p[h+3]=u!==4?i>>>21|128:i>>>21&127;case 3:p[h+2]=u!==3?i>>>14|128:i>>>14&127;case 2:p[h+1]=u!==2?i>>>7|128:i>>>7&127;case 1:p[h]=u!==1?128|i:127&i}}const G8={},z8={},FA=4294967296,Pfe=FA*FA,Nfe=Pfe/2;K8(0,!0);const H8=K8(0),kfe=D0(0,-2147483648,!1),Dfe=D0(-1,2147483647,!1);function K8(e,n){let i,s,c;return n?(c=0<=(e>>>=0)&&e<256)&&(s=z8[e],s)?s:(i=D0(e,0,!0),c&&(z8[e]=i),i):(c=-128<=(e|=0)&&e<128)&&(s=G8[e],s)?s:(i=D0(e,e<0?-1:0,!1),c&&(G8[e]=i),i)}function D0(e,n,i){return{low:0|e,high:0|n,unsigned:!!i}}function $8(e,n){if(isNaN(e))return H8;{if(e<=-9223372036854776e3)return kfe;if(e+1>=Nfe)return Dfe}return e<0?H8:D0(e%FA|0,e/FA|0,n)}function q8(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,s)}return i}class cx extends Rr{get connectionState(){return this._connectionState}set connectionState(n){if(this._connectionState===n)return;const i=this._connectionState;this._connectionState=n,this.emit(Hu.CONNECTION_STATE_CHANGE,n,i)}get quality(){return this._quality}set quality(n){this._quality=n>1?1:n<.1?.1:n,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(n){var i;super(),K(this,"name","AgoraRTCImageModeration"),K(this,"_connectionState",rl.CONNECTING),K(this,"_sequence",0),K(this,"_moderationStartTime",void 0),K(this,"_workerConnection",void 0),K(this,"_workerMessageLengthLimit",void 0),K(this,"_qualityRatio",void 0),K(this,"_connectInfo",void 0),K(this,"_cancelTokenSource",Ls.CancelToken.source()),K(this,"_retryConfig",void 0),K(this,"_moderationInterval",void 0),K(this,"_moderationTimer",null),K(this,"_moderationMode",1),K(this,"_quality",1),K(this,"_qualityTimer",null),K(this,"_ticket",void 0),K(this,"_moderationIntervalMinimum",void 0),K(this,"_uploadFailedNum",0),K(this,"_uploadNum",0),K(this,"_uploadTimer",null),K(this,"_extraInfo",void 0),K(this,"_vendor",""),K(this,"_encoder",new TextEncoder),K(this,"_moderationId",void 0),K(this,"inspectImage",()=>{if(this.connectionState!==rl.CONNECTED)throw new be(Y.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===rl.CONNECTED?this.requestToInspectImage():k.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=er(5,"image-moderation-"),this._workerMessageLengthLimit=Z("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=Z("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(i=n.interval)!==null&&i!==void 0?i:1e3,n.extraInfo&&(this._extraInfo=this._encoder.encode(n.extraInfo)),n.vendor&&(this._vendor=n.vendor),this._qualityRatio=Z("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new T0("worker-"+this._moderationId,pi),this.on(Hu.STATE_CHANGE,(s,c)=>{k.debug("[".concat(this._moderationId,"] Moderation operation :").concat(XE[s]," ").concat(c||""))}),this.handleWorkerEvents()}async init(n,i){this.emit(Hu.STATE_CHANGE,XE.CONNECT_AP),this._connectInfo=n;const s=this._cancelTokenSource.token;return this._retryConfig=i,new Qe((c,u)=>{this.on(Hu.CONNECTION_STATE_CHANGE,(h,p)=>{h===rl.CONNECTED&&c()}),this.requestAP(n,s,i).then(h=>{this.connectWorker(h)}).catch(h=>{u(h)})})}updateConfig(n){var i;this._moderationInterval=(i=n.interval)!==null&&i!==void 0?i:1e3,n.extraInfo&&(this._extraInfo=this._encoder.encode(n.extraInfo)),n.vendor&&(this._vendor=n.vendor),k.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(n))),this.connectionState===rl.CONNECTED&&this.inspectImage()}async requestAP(n,i,s){const c=Z("WEBCS_DOMAIN").map(_=>"https://".concat(_,"/api/v1")),u=await function(_,E,S,w){let{appId:I,areaCode:P,cname:B,sid:M,token:U,uid:$}=E;ny++;const q="moderation_plugin",ce={service_name:q,json_body:JSON.stringify({appId:I,areaCode:P,cname:B,command:"allocateEdge",requestId:ny,seq:ny,sid:M,appToken:U,ts:Date.now(),uid:$+""})};let me,ge,pe=_[0];return Bu(async()=>{me=Date.now();const Re=await Ku(pe,{data:ce,cancelToken:S,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(ge=Date.now()-me,Re.code!==0){const rt=new be(Y.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+Re.code,{retry:!0,responseTime:ge});throw k.error(rt.toString()),rt}const Ve=JSON.parse(Re.json_body);if(Ve.code!==200){const rt=new be(Y.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(Ve.code,", reason: ").concat(Ve.reason),{code:Ve.code,responseTime:ge});throw k.error(rt.toString()),rt}if(!Ve.servers||!Array.isArray(Ve.servers)||Ve.servers.length===0){const rt=new be(Y.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:Ve.code,responseTime:ge});throw k.error(rt.toString()),rt}if(!Ve.servers.some(rt=>!!rt.wss)){const rt=new be(Y.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:Ve.code,responseTime:ge});throw k.error(rt.toString()),rt}const Ze=Z("IMAGE_MODERATION_WORKER_HOST");return{addressList:Ve.servers.map(rt=>{let{address:un,wss:dn}=rt;if(un&&dn)return"wss://".concat(un.replace(/\./g,"-"),".").concat(Ze,":").concat(dn,"/moderation")}).filter(rt=>!!rt),workerToken:Ve.workerToken,vid:Ve.vid,ticket:Ve.appTicket,responseTime:ge}},(Re,Ve)=>(pt.apworkerEvent(M,{success:!0,sc:200,serviceName:q,responseDetail:JSON.stringify(Re.addressList),firstSuccess:Ve===0,responseTime:ge,serverIp:_[Ve%_.length]}),!1),(Re,Ve)=>(pt.apworkerEvent(M,{success:!1,sc:Re.data&&Re.data.code||200,serviceName:q,responseTime:ge,serverIp:_[Ve%_.length]}),!!(Re.code!==Y.OPERATION_ABORTED&&Re.code!==Y.UNEXPECTED_RESPONSE||Re.data&&Re.data.retry)&&(pe=_[(Ve+1)%_.length],!0)),w)}(c,n,i,s);this.emit(Hu.STATE_CHANGE,XE.AP_CONNECTED);const{addressList:h,ticket:p}=u;return this._ticket=p,h}async connectWorker(n){this.emit(Hu.STATE_CHANGE,XE.CONNECT_WORKER),await this._workerConnection.init(n,1e4)}handleWorkerEvents(){this._workerConnection.on(Gt.CONNECTED,async()=>{this.emit(Hu.STATE_CHANGE,XE.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=rl.CONNECTED}),this._workerConnection.on(Gt.CLOSED,()=>{this.connectionState=rl.CLOSED}),this._workerConnection.on(Gt.FAILED,()=>{this.connectionState=rl.CLOSED}),this._workerConnection.on(Gt.RECONNECTING,()=>{this.connectionState=this.connectionState===rl.CONNECTED?rl.RECONNECTING:rl.CONNECTING}),this._workerConnection.on(Gt.ON_MESSAGE,async n=>{if(n.data instanceof ArrayBuffer){const i=Rfe(new Uint8Array(n.data));Z("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&k.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(i)),this._uploadNum++,i.code===void 0||i.code===0||(this._uploadFailedNum++,k.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(i.code,", msg is ").concat(i.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{pt.reportApiInvoke(this._connectInfo.sid||null,{name:fi.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,i.code],tag:Dr.TRACER}).onError(new be(Y.IMAGE_MODERATION_UPLOAD_FAILED,i.msg)),this._uploadTimer=null},Z("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else k.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(Gt.WILL_RECONNECT,(n,i,s)=>{n==="recover"&&s(n),s("tryNext")}),this._workerConnection.on(Gt.REQUEST_NEW_URLS,(n,i)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(n).catch(i)})}static intToLong(n){return{low:n|=0,high:n>>31,unsigned:n>=0}}async requestToInspectImage(){const n=mc(this,Hu.CLIENT_LOCAL_VIDEO_TRACK),i={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(n){if(!n.isPlaying)return void(Z("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&k.debug("Only the track being played can be inspected"));this._sequence++;const s=await this.generateRequestData(n,i);this._workerConnection.sendMessage(s,!0,!0)}else Z("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&k.debug("Only the track being published can be inspected")}async generateRequestData(n,i){let{appId:s,cname:c,cid:u,vid:h,sid:p,uid:_}=i;const E=Date.now(),S=await n.getCurrentFrameImage("image/jpeg",this.quality),w=await yW(S,s,c),I=this._sequence+"-"+u+"-"+_+"-"+E+"-"+er(12,""),P={appId:s,cid:u,cname:c,deviceId:"",elapse:cx.intToLong(Number(E-this._moderationStartTime)),fileSize:S.buffer.byteLength,height:S.height,width:S.width,jpg:w,networkType:6,osType:7,requestId:I,sdkVersion:"4.23.2",sequence:this._sequence,sid:p,timestamp:$8(E),uid:_,vid:h,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete P.callbackData;const B=wfe(P);if(B.byteLength<this._workerMessageLengthLimit){if(Z("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const M=function(U){for(var $=1;$<arguments.length;$++){var q=arguments[$]!=null?arguments[$]:{};$%2?q8(Object(q),!0).forEach(function(ce){K(U,ce,q[ce])}):Object.getOwnPropertyDescriptors?Object.defineProperties(U,Object.getOwnPropertyDescriptors(q)):q8(Object(q)).forEach(function(ce){Object.defineProperty(U,ce,Object.getOwnPropertyDescriptor(q,ce))})}return U}({},P);delete M.jpg,k.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(M))}return B}{const M=this.quality*this._qualityRatio;return this.quality=M,await this.generateRequestData(n,{appId:s,cname:c,cid:u,vid:h,sid:p,uid:_})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Ls.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=rl.CLOSED,this.emit(Hu.STATE_CHANGE,XE.CLOSED)}}function Y8(e){if(Yn(e.interval,"interval",1e3,1/0),e&&e.extraInfo&&e.extraInfo.length>1024)throw new be(Y.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(e&&e.vendor&&e.vendor.length>1024)throw new be(Y.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const Lfe={name:"ImageModeration",create:function(e){let{config:n}=e;return Y8(n),new cx(n)}};var X8,J8,Q8,Z8,eH,tH,nH,rH,iH,oH,sH,aH,cH,lH,uH,dH,hH,fH,pH,mH,gH,_H,vH,EH,yH,SH,TH,bH,wH,RH,CH,IH,AH,OH,PH,NH,kH,DH,LH,xH,MH,tt;function UH(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,s)}return i}function Hl(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?UH(Object(i),!0).forEach(function(s){K(e,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):UH(Object(i)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(i,s))})}return e}To.setLogger(k);let xfe=(X8=Ot(),J8=Ot({argsMap:(e,n)=>{if(!Array.isArray(n)){if(!(n instanceof WE))return[n];n=[n]}return n.map(i=>i?Object(i).toString():"null")}}),Q8=Ot({argsMap:(e,n)=>(n||(n=[]),Array.isArray(n)||n.trackMediaType!==BE.DATA?(Array.isArray(n)||(n=[n]),n.map(i=>i.getTrackId())):[n.getChannelId()])}),Z8=Ot({argsMap:(e,n,i,s)=>[typeof n=="object"?n.uid:n,i,s]}),eH=Ot({argsMap:(e,n,i)=>[n,i]}),tH=Ot({argsMap:(e,n)=>n.map(i=>{let{user:s,mediaType:c}=i;return[s==null?void 0:s.uid,c]})}),nH=Ot({argsMap:(e,n,i,s)=>[typeof n=="object"?n.uid:n,i,s]}),rH=Ot({argsMap:(e,n)=>n.map(i=>{let{user:s,mediaType:c}=i;return{uid:s==null?void 0:s.uid,mediaType:c}})}),iH=Ot(),oH=Ot(),sH=Ot(),aH=Ot(),cH=Ot(),lH=Ot(),uH=Ot(),dH=Ot(),hH=Ot(),fH=Ot(),pH=Ot(),mH=Ot(),gH=Ot(),_H=Ot(),vH=Ot(),EH=Ot({argsMap:(e,n)=>[n]}),yH=Ot(),SH=Ot(),TH=Ot(),bH=Ot(),wH=Ot(),RH=Ot(),CH=Ot(),IH=Ot(),AH=Ot({argsMap:(e,n)=>(Array.isArray(n)||(n=[n]),[JSON.stringify(n)])}),OH=Ot(),PH=Ot(),NH=Ot(),kH=Ot(),DH=Ot(),LH=Ot(),xH=Ot({reportResult:!0}),MH=Ot(),tt=class extends Rr{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var e;return((e=this._config)===null||e===void 0?void 0:e.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(e,n){let i;if(super(),K(this,"store",void 0),K(this,"_uid",void 0),K(this,"_channelName",void 0),K(this,"_uintUid",void 0),K(this,"_users",[]),K(this,"_config",void 0),K(this,"_clientId",void 0),K(this,"_appId",void 0),K(this,"_sessionId",null),K(this,"_key",void 0),K(this,"_rtmConfig",{}),K(this,"_joinInfo",void 0),K(this,"_gateway",void 0),K(this,"_statsCollector",void 0),K(this,"_configDistribute",void 0),K(this,"_leaveMutex",void 0),K(this,"_publishMutex",void 0),K(this,"_renewTokenMutex",void 0),K(this,"_subscribeMutex",void 0),K(this,"_encryptionMode","none"),K(this,"_encryptionSecret",null),K(this,"_encryptionSalt",null),K(this,"_encryptDataStream",!1),K(this,"_encryptDataStreamKey",null),K(this,"_encryptDataStreamIv",null),K(this,"_proxyServer",void 0),K(this,"_turnServer",{servers:[],mode:"auto"}),K(this,"_cloudProxyServerMode","disabled"),K(this,"_isDualStreamEnabled",!1),K(this,"_defaultStreamFallbackType",void 0),K(this,"_lowStreamParameter",void 0),K(this,"_streamFallbackTypeCacheMap",new Map),K(this,"_remoteStreamTypeCacheMap",new Map),K(this,"_axiosCancelSource",Ls.CancelToken.source()),K(this,"_audioVolumeIndicationInterval",void 0),K(this,"_networkQualityInterval",void 0),K(this,"_userOfflineTimeout",void 0),K(this,"_streamRemovedTimeout",void 0),K(this,"_liveTranscodeStreamingClient",void 0),K(this,"_liveRawStreamingClient",void 0),K(this,"_channelMediaRelayClient",void 0),K(this,"_networkQualitySensitivity","normal"),K(this,"_p2pChannel",void 0),K(this,"_useLocalAccessPoint",!1),K(this,"_setLocalAPVersion",void 0),K(this,"_joinAndNotLeaveYet",!1),K(this,"_numberOfJoinCount",0),K(this,"_remoteDefaultVideoStreamType",void 0),K(this,"_inspect",void 0),K(this,"_moderation",void 0),K(this,"_license",void 0),K(this,"_pendingPublishedUsers",[]),K(this,"ntpAlignErrorCount",0),K(this,"remoteInboundOffset",0),K(this,"_peerConnectionState",void 0),K(this,"_handleLocalTrackEnable",(c,u,h)=>{this.publish(c,!1).then(u).catch(h)}),K(this,"_handleLocalTrackDisable",(c,u,h)=>{this.unpublish(c).then(u).catch(h)}),K(this,"_handleUserOnline",c=>{if(Z("BLOCK_LOCAL_CLIENT")&&r_(c.uid,this.channelName))return void k.debug("[".concat(c.uid,"] will be ignored in local"));this.isStringUID&&typeof c.uid!="string"&&k.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const u=this._users.find(h=>h.uid===c.uid);if(u)u._trust_in_room_=!0,u._is_pre_created&&(u._is_pre_created=!1,this.safeEmit(on.USER_JOINED,u));else{const h=new Xp(c.uid,c.uint_id||c.uid);this._users.push(h),k.debug("[".concat(this._clientId,"] user online"),c.uid),this.safeEmit(on.USER_JOINED,h)}}),K(this,"_handleUserOffline",c=>{if(Z("BLOCK_LOCAL_CLIENT")&&r_(c.uid,this.channelName))return;const u=this._users.find(h=>h.uid===c.uid);u&&(this._handleRemoveStream(c),this._handleRemoveDataChannels(c),u._audio_pre_subscribed||u._video_pre_subscribed?u._is_pre_created=!0:BI(this._users,u),this._remoteStreamTypeCacheMap.delete(u.uid),this._streamFallbackTypeCacheMap.delete(u.uid),k.debug("[".concat(this._clientId,"] user offline"),c.uid,"reason:",c.reason),this.safeEmit(on.USER_LEAVED,u,c.reason))}),K(this,"_handleAddAudioOrVideoStream",(c,u,h,p,_,E,S)=>{if(Z("BLOCK_LOCAL_CLIENT")&&r_(u,this.channelName))return;const w=this._users.find(P=>P.uid===u);if(!w)return void k.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));k.debug("[".concat(this._clientId,"] stream added with uid ").concat(u,", type ").concat(c)),this.store.subscribe(w.uid,c,void 0,void 0,void 0,Date.now());const I=c==="audio"?w.hasAudio:w.hasVideo;w._uintid||(w._uintid=_||u),c==="audio"?w._trust_audio_stream_added_state_=!0:w._trust_video_stream_added_state_=!0,c==="audio"?(w._audio_added_=!0,h!==void 0&&(w._audioSSRC=h),p!==void 0&&(w._cname=p),E&&(w._audioOrtc=E)):(w._video_added_=!0,h!==void 0&&(w._videoSSRC=h),p!==void 0&&(w._cname=p),S!==void 0&&(w._rtxSsrcId=S),E&&(w._videoOrtc=E)),(c==="audio"?w.hasAudio:w.hasVideo)&&!I&&(k.info("[".concat(this._clientId,"] remote user ").concat(w.uid," published ").concat(c)),this.safeEmit(on.USER_PUBLISHED,w,c)),c==="video"?pt.onGatewayStream(this._sessionId,Ni.ON_ADD_VIDEO_STREAM,Er.ON_ADD_VIDEO_STREAM,{peer:_||u,ssrc:w._videoSSRC}):pt.onGatewayStream(this._sessionId,Ni.ON_ADD_AUDIO_STREAM,Er.ON_ADD_AUDIO_STREAM,{peer:_||u,ssrc:w._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(w,c,h).then(P=>{if(P&&(k.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(w.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof N0))return this._p2pChannel.unsubscribe(w,c,!0).then(()=>this._subscribe(w,c,!0).catch(B=>{k.error("[".concat(this._clientId,"] resubscribe error"),B.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(w,c)&&(k.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(w.uid," after reconnect.")),this._subscribe(w,c,!0).catch(P=>{k.error("[".concat(this._clientId,"] resubscribe error"),P.toString())}))}),K(this,"_handleRemoveStream",c=>{if(Z("BLOCK_LOCAL_CLIENT")&&r_(c.uid,this.channelName))return;const u=this._users.find(p=>p.uid===c.uid);if(!u)return void k.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));k.debug("[".concat(this._clientId,"] stream removed with uid ").concat(c.uid));let h=()=>{};u.hasAudio&&u.hasVideo?h=()=>{k.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished audio track")),this.safeEmit(on.USER_UNPUBLISHED,u,"audio"),k.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished video track")),this.safeEmit(on.USER_UNPUBLISHED,u,"video")}:u.hasVideo?h=()=>{k.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished video track")),this.safeEmit(on.USER_UNPUBLISHED,u,"video")}:u.hasAudio&&(h=()=>{k.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished audio track")),this.safeEmit(on.USER_UNPUBLISHED,u,"audio")}),u._video_pre_subscribed||u._audio_pre_subscribed||(u._trust_audio_stream_added_state_=!0,u._trust_video_stream_added_state_=!0,u._audio_added_=!1,u._video_added_=!1,this._p2pChannel instanceof N0&&this._p2pChannel.unsubscribe(u).then(p=>{if(p)return this._gateway.unsubscribe(p,u.uid)}),u._audioSSRC=void 0,u._videoSSRC=void 0,u._audioOrtc=void 0,u._videoOrtc=void 0,u._rtxSsrcId=void 0),pt.onGatewayStream(this._sessionId,Ni.ON_REMOVE_STREAM,Er.ON_REMOVE_STREAM,{peer:c.uint_id||c.uid}),h()}),K(this,"_handleSetStreamLocalEnable",(c,u,h)=>{if(Z("BLOCK_LOCAL_CLIENT")&&r_(u,this.channelName))return;const p=this._users.find(S=>S.uid===u);if(!p)return void k.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));k.debug("[".concat(this._clientId,"] local ").concat(c," ").concat(h?"enabled":"disabled"," with uid ").concat(u));const _=c==="audio"?p.hasAudio:p.hasVideo;if(c==="audio"){p._trust_audio_enabled_state_=!0;const S=p._audio_enabled_;if(p._audio_enabled_=h,p._audio_enabled_===S)return;{const w=p._audio_enabled_?"enable-local-audio":"disable-local-audio";k.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(u,", msg: ").concat(w)),this.safeEmit(on.USER_INFO_UPDATED,u,w)}}else{p._trust_video_enabled_state_=!0;const S=p._video_enabled_;if(p._video_enabled_=h,p._video_enabled_===S)return;{const w=p._video_enabled_?"enable-local-video":"disable-local-video";k.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(u,", msg: ").concat(w)),this.safeEmit(on.USER_INFO_UPDATED,u,w)}}const E=c==="audio"?p.hasAudio:p.hasVideo;return _!==E?!_&&E?(k.info("[".concat(this._clientId,"] remote user ").concat(u," published ").concat(c)),void this.safeEmit(on.USER_PUBLISHED,p,c)):(c==="video"&&p._videoTrack&&p._videoTrack._destroy(),c==="audio"&&p._audioTrack,this._p2pChannel.muteRemote(p,c),k.info("[".concat(this._clientId,"] remote user ").concat(u," unpublished ").concat(c)),void this.safeEmit(on.USER_UNPUBLISHED,p,c)):void 0}),K(this,"_handleMuteStream",(c,u,h)=>{if(Z("BLOCK_LOCAL_CLIENT")&&r_(c,this.channelName))return;k.debug("[".concat(this._clientId,"] receive mute message"),c,u,h);const p=this._users.find(S=>S.uid===c);if(!p)return void k.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(c));const _=u==="audio"?p.hasAudio:p.hasVideo;if(u==="audio"){p._trust_audio_mute_state_=!0;const S=p._audio_muted_;if(p._audio_muted_=h,p._audio_muted_===S)return;{const w=p._audio_muted_?"mute-audio":"unmute-audio";k.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(w)),this.safeEmit(on.USER_INFO_UPDATED,c,w)}}else{p._trust_video_mute_state_=!0;const S=p._video_muted_;if(p._video_muted_=h,p._video_muted_===S)return;{const w=p._video_muted_?"mute-video":"unmute-video";k.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(w)),this.safeEmit(on.USER_INFO_UPDATED,c,w)}}const E=u==="audio"?p.hasAudio:p.hasVideo;if(_!==E){if(!_&&E)return(u==="audio"?p._audioSSRC:p._videoSSRC)?(k.info("[".concat(this._clientId,"] remote user ").concat(c," published ").concat(u)),void this.safeEmit(on.USER_PUBLISHED,p,u)):void k.warning("[".concat(this._clientId,"] remote user ").concat(c," receive ").concat(u," unmute message  before add stream message, ").concat(u," SSRC doesn't exist yet."));u==="video"&&p._videoTrack&&!p._video_pre_subscribed&&p._videoTrack._destroy(),u==="audio"&&p._audioTrack,this._p2pChannel.muteRemote(p,u),k.info("[".concat(this._clientId,"] remote user ").concat(c," unpublished ").concat(u)),this.safeEmit(on.USER_UNPUBLISHED,p,u)}}),K(this,"_handleP2PLost",async c=>{k.debug("[".concat(this._clientId,"] receive p2p lost"),c),parseInt(c.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():k.warning("[".concat(this._clientId,"] P2PLost stream not found"),c)}),K(this,"_handleTokenWillExpire",()=>{k.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(on.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),K(this,"_handleBeforeUnload",c=>{c.type==="beforeunload"&&c.returnValue!==void 0&&c.returnValue!==""||(this.leave(),k.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),K(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(on.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const c={downlinkNetworkQuality:0,uplinkNetworkQuality:0};c.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),c.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(on.NETWORK_QUALITY,c)}),K(this,"_handleP2PAddAudioOrVideoStream",(c,u,h,p)=>{const _=this._users.find(S=>S.uid===u);if(!_)return void k.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));k.debug("[".concat(this._clientId,"] stream added with uid ").concat(u,", type ").concat(c)),this.store.subscribe(_.uid,c,void 0,void 0,void 0,Date.now());const E=c==="audio"?_.hasAudio:_.hasVideo;c==="audio"?_._trust_audio_stream_added_state_=!0:_._trust_video_stream_added_state_=!0,c==="audio"?(_._audio_added_=!0,h!==void 0&&(_._audioSSRC=h),p!==void 0&&(_._audioMid=p)):(_._video_added_=!0,h!==void 0&&(_._videoSSRC=h),p!==void 0&&(_._videoMid=p)),(c==="audio"?_.hasAudio:_.hasVideo)&&!E&&(k.info("[".concat(this._clientId,"] remote user ").concat(_.uid," published ").concat(c)),this.safeEmit(on.USER_PUBLISHED,_,c)),this._p2pChannel.hasPendingRemoteMedia(_,c)&&(k.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(_.uid," after reconnect.")),this._subscribe(_,c,!0).catch(S=>{k.error("[".concat(this._clientId,"] resubscribe error"),S.toString())}))}),this._config=e,this._clientId=n||er(5,"client-"),this.store=new class{constructor(c,u,h,p){Vt(this,"state",void 0),this.state={codec:c,audioCodec:u,mode:h,clientId:p,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:Xg.Default,hasStartJoinChannel:!1,isABTestSuccess:!1}}dispatch(c){this.state=function(u,h){switch(h.type){case sn.SET_SESSION_ID:return it(it({},u),{},{sessionId:h.sessionId});case sn.SET_P2P_ID:return it(it({},u),{},{p2pId:h.p2pId});case sn.SET_UID:return it(it({},u),{},{uid:h.uid});case sn.SET_INT_UID:return it(it({},u),{},{intUid:h.intUid});case sn.SET_PUB_ID:return it(it({},u),{},{pubId:h.pubId});case sn.KEY_METRIC_CLIENT_CREATED:return it(it({},u),{},{keyMetrics:it(it({},u.keyMetrics),{},{clientCreated:h.metric})});case sn.KEY_METRIC_JOIN_START:return it(it({},u),{},{keyMetrics:it(it({},u.keyMetrics),{},{joinStart:h.metric})});case sn.AVOID_JOIN_START:return it(it({},u),{},{avoidJoinStart:h.avoidJoinStart});case sn.KEY_METRIC_JOIN_END:return it(it({},u),{},{keyMetrics:it(it({},u.keyMetrics),{},{joinEnd:h.metric})});case sn.KEY_METRIC_REQUEST_AP_START:return it(it({},u),{},{keyMetrics:it(it({},u.keyMetrics),{},{requestAPStart:h.metric})});case sn.KEY_METRIC_REQUEST_AP_END:return it(it({},u),{},{keyMetrics:it(it({},u.keyMetrics),{},{requestAPEnd:h.metric})});case sn.KEY_METRIC_JOIN_GATEWAY_START:return it(it({},u),{},{keyMetrics:it(it({},u.keyMetrics),{},{joinGatewayStart:h.metric})});case sn.KEY_METRIC_JOIN_GATEWAY_END:return it(it({},u),{},{keyMetrics:it(it({},u.keyMetrics),{},{joinGatewayEnd:h.metric})});case sn.KEY_METRIC_PEER_CONNECTION_START:return it(it({},u),{},{keyMetrics:it(it({},u.keyMetrics),{},{peerConnectionStart:h.metric})});case sn.KEY_METRIC_PEER_CONNECTION_END:return it(it({},u),{},{keyMetrics:it(it({},u.keyMetrics),{},{peerConnectionEnd:h.metric})});case sn.KEY_METRIC_DESCRIPTION_START:return it(it({},u),{},{keyMetrics:it(it({},u.keyMetrics),{},{descriptionStart:h.metric})});case sn.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return it(it({},u),{},{keyMetrics:it(it({},u.keyMetrics),{},{signalChannelOpen:h.metric})});case sn.KEY_METRIC_ICE_CONNECTION_END:return it(it({},u),{},{keyMetrics:it(it({},u.keyMetrics),{},{iceConnectionEnd:h.metric})});case sn.KEY_METRIC_PUBLISH:{const p=u.keyMetrics.publish,_=p.findIndex(E=>E.trackId===h.metric.trackId);return _!==-1?(p[_]=it(it({},p[_]),h.metric),it(it({},u),{},{keyMetrics:it(it({},u.keyMetrics),{},{publish:[...p]})})):it(it({},u),{},{keyMetrics:it(it({},u.keyMetrics),{},{publish:[...u.keyMetrics.publish,h.metric]})})}case sn.KEY_METRIC_SUBSCRIBE:{const p=u.keyMetrics.subscribe,_=p.findIndex(E=>E.userId===h.metric.userId&&E.type===h.metric.type);return _!==-1?(p[_]=it(it({},p[_]),h.metric),it(it({},u),{},{keyMetrics:it(it({},u.keyMetrics),{},{subscribe:[...p]})})):it(it({},u),{},{keyMetrics:it(it({},u.keyMetrics),{},{subscribe:[...u.keyMetrics.subscribe,h.metric]})})}case sn.SET_CLOUD_PROXY_SERVER_MODE:return u.cloudProxyServerMode=h.mode,u;case sn.RECORD_JOIN_CHANNEL_SERVICE:return typeof h.index!="number"?u.joinChannelServiceRecords=[...u.joinChannelServiceRecords,h.record]:(u.joinChannelServiceRecords[h.index]=it(it({},u.joinChannelServiceRecords[h.index]),h.record),u.joinChannelServiceRecords=[...u.joinChannelServiceRecords]),u;case sn.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return u.joinChannelServiceRecords=[],u;case sn.RESET_KEY_METRICS:return u.keyMetrics={publish:[],subscribe:[]},u;case sn.SET_USE_P2P:return it(it({},u),{},{useP2P:h.val});case sn.SET_TRANSPORT_TYPE:return it(it({},u),{},{p2pTransport:h.val});default:return u}}(this.state,c)}set sessionId(c){this.dispatch({type:sn.SET_SESSION_ID,sessionId:c})}get sessionId(){return this.state.sessionId}set cid(c){this.state.cid=c}get cid(){return this.state.cid}set codec(c){this.state.codec=c}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(c){this.dispatch({type:sn.SET_P2P_ID,p2pId:c})}get p2pId(){return this.state.p2pId}set dcId(c){this.dispatch({type:sn.SET_DC_ID,dcId:c})}get dcId(){return this.state.dcId}set uid(c){this.dispatch({type:sn.SET_UID,uid:c})}get uid(){return this.state.uid}set intUid(c){this.dispatch({type:sn.SET_INT_UID,intUid:c})}get intUid(){return this.state.intUid}set pubId(c){this.dispatch({type:sn.SET_PUB_ID,pubId:c})}get pubId(){return this.state.pubId}set cloudProxyServerMode(c){this.dispatch({type:sn.SET_CLOUD_PROXY_SERVER_MODE,mode:c})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(c){this.dispatch({type:sn.SET_USE_P2P,val:c})}get useP2P(){return this.state.useP2P}set p2pTransport(c){this.dispatch({type:sn.SET_TRANSPORT_TYPE,val:c})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(c){this.state.hasStartJoinChannel=c}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(c){this.state.isABTestSuccess=c}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:sn.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:sn.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:sn.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:sn.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:sn.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:sn.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:sn.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:sn.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:sn.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:sn.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:sn.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:sn.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(c,u,h,p){this.dispatch({type:sn.KEY_METRIC_PUBLISH,metric:it(it({trackId:c,type:u},h&&{publishStart:h}),p&&{publishEnd:p})})}subscribe(c,u,h,p,_,E,S){this.dispatch({type:sn.KEY_METRIC_SUBSCRIBE,metric:it(it(it(it(it({userId:c,type:u},h&&{subscribeStart:h}),p&&{subscribeEnd:p}),_&&{firstFrame:_}),E&&{streamAdded:E}),S&&{firstDecoded:S})})}massSubscribe(c,u,h,p){c.forEach(_=>{this.dispatch({type:sn.KEY_METRIC_SUBSCRIBE,metric:it(it(it({userId:_.userId,type:_.type},u&&{subscribeStart:u}),h&&{subscribeEnd:h}),p&&{firstFrame:p})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(c,u){c.service==="gateway"&&Array.isArray(c.urls)&&(c.urls=c.urls.map(h=>h.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof u!="number"?(this.dispatch({type:sn.RECORD_JOIN_CHANNEL_SERVICE,record:it(it({},c),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(u<0||u>=this.state.joinChannelServiceRecords.length||this.dispatch({type:sn.RECORD_JOIN_CHANNEL_SERVICE,record:c,index:u}),u)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:sn.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:sn.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(c){this.dispatch({type:sn.AVOID_JOIN_START,avoidJoinStart:c})}}(e.codec,e.audioCodec,e.mode,this._clientId),this._leaveMutex=new To("client-leave",this._clientId),this._publishMutex=new To("client-publish",this._clientId),this._renewTokenMutex=new To("client-renewtoken",this._clientId),this._subscribeMutex=new To("client-subscribe",this._clientId),this.store.clientCreated(),e.proxyServer&&this.setProxyServer(e.proxyServer,!0),e.turnServer&&this.setTurnServer(e.turnServer,!0),k.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(el," build: ").concat(eL,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),e.clientRoleOptions)try{B1(e.clientRoleOptions),i=Object.assign({},e.clientRoleOptions)}catch(c){k.warning("[".concat(this._clientId,"] ").concat(c.toString()))}var s;this._statsCollector=new O0(this.store),this._statsCollector.onStatsException=(c,u,h)=>{k.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(c,", msg: ").concat(u,", uid: ").concat(h)),this.safeEmit(on.EXCEPTION,{code:c,msg:u,uid:h})},this._statsCollector.onUploadPublishDuration=(c,u,h,p)=>{const _=this._users.find(E=>E.uid===c);_&&pt.peerPublishStatus(this._sessionId,{subscribeElapse:p,audioPublishDuration:u,videoPublishDuration:h,peer:_._uintid})},this.store.useP2P=e.mode==="p2p",this._gateway=new Zhe(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:e.websocketRetryConfig||pi,httpRetryConfig:e.httpRetryConfig||pi,forceWaitGatewayResponse:e.forceWaitGatewayResponse===void 0||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role,clientRoleOptions:i}),this._configDistribute=new lfe(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(s={store:this.store,statsCollector:this._statsCollector},Ef("P2PChannel").create(s)),this._handleP2PEvents()):this._p2pChannel=new N0(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(e,n,i,s,c){let u=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],h=arguments.length>6&&arguments[6]!==void 0&&arguments[6];Kn("JOIN_GATEWAY_USE_443PORT_ONLY",u),Kn("JOIN_GATEWAY_USE_DUAL_DOMAIN",h);const p=this._gateway.signal.websocket;return p instanceof DL&&(p.use443PortOnly=u,p.tryDoubleDomain=h),async function(_,E,S){MI.get(_)||MI.set(_,[]),UI.get(_)||UI.set(_,E),Md.get(_)||Md.set(_,0);const w=MI.get(_),I=UI.get(_);if(!w||!I)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(Md.get(_)===I){const $=s0();w.push($),await $.promise}Md.set(_,Md.get(_)+1);for(var P=arguments.length,B=new Array(P>3?P-3:0),M=3;M<P;M++)B[M-3]=arguments[M];const U=await S(...B);return Md.set(_,Md.get(_)-1),Md.get(_)===I-1&&w.length>0&&(w[0].resolve(),w.shift()),Md.get(_)===0&&(MI.set(_,[]),UI.set(_,0),Md.set(_,0)),U}("client.join",Z("JOIN_MAX_CONCURRENCY"),this.join.bind(this),e,n,i,s,c)}async join(e,n,i,s,c){const u=++this._numberOfJoinCount;this.store.joinStart(),s&&(this.store.uid=s);const h=(zI||zI||(zI=(window.location.protocol.split(":")[0]||"").toUpperCase(),zI))==="HTTPS",p=L6()?window.isSecureContext:"Browser Not Support";(!L6()&&!h||!window.isSecureContext)&&k.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser"),this.connectionState==="DISCONNECTED"&&(this.store.avoidJoinStart=Math.round(Date.now()),k.debug("[".concat(this._clientId,"] set avoidJoinStart to ").concat(this.store.avoidJoinStart))),pt.setAppId(e);try{if(!i&&i!==null)throw new be(Y.INVALID_PARAMS,"Invalid token: ".concat(i,". If you don not use token, set it to null"));i&&Xi(i,"token",1,2047),Xi(e,"appid",1,2047),hA(n),s&&fA(s),c&&Xi(c,"optionalInfo",1,2047)}catch(M){throw pt.reportApiInvoke(Yg(),{name:fi.JOIN,options:[e,n,i,s],states:{isHttps:h,isSecureContext:p},tag:Dr.TRACER}).onError(M),M}if(this._leaveMutex.isLocked&&(k.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),k.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const M=new be(Y.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw pt.reportApiInvoke(Yg(),{name:fi.JOIN,options:[e,n,i,s],states:{isHttps:h,isSecureContext:p},tag:Dr.TRACER}).onError(M),M}this._gateway.state="CONNECTING";const _=await D8({appId:e,cname:n,uid:s,stringUid:typeof s=="string"?s:void 0,token:i||e,cloudProxyServer:this._cloudProxyServerMode});if(!this._joinAndNotLeaveYet)throw new be(Y.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));const E=(_==null?void 0:_.sid)||Yg();k.info("[".concat(this._clientId,"] start join channel ").concat(n,", join number: ").concat(u)),this._sessionId||(this._sessionId=E,this.store.sessionId=this._sessionId);const S=pt.reportApiInvoke(E,{id:this._clientId,name:fi.JOIN,options:[e,n,i,s],states:{isHttps:h,isSecureContext:p},tag:Dr.TRACER}),w=Hl(Hl(Hl({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:e,sid:this._sessionId,cname:n,uid:typeof s!="string"?s:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:i||e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:c,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!_},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:Z("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(w.setLocalAPVersion=this._setLocalAPVersion),typeof s=="string"&&(w.stringUid=s,this._uintUid?(w.uid=this._uintUid,this._uintUid=void 0):w.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(w.aesmode=this._encryptionMode,w.aespassword=await(async M=>{const U=function(me){const ge=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),pe=new Uint8Array(new ArrayBuffer(ge.length));for(let Re=0;Re<ge.length;Re+=1)pe[Re]=ge.charCodeAt(Re);return pe}(),$=await window.crypto.subtle.importKey("spki",U,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),q=F1(M),ce=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},$,q);return function(me){let ge="";for(let pe=0;pe<me.length;pe+=1)ge+=String.fromCharCode(me[pe]);return window.btoa(ge)}(new Uint8Array(ce))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new be(Y.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(w.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const M=new TextEncoder,U=Z("USE_PURE_ENCRYPTION_MASTER_KEY")?M.encode(w.appId+this._encryptionSecret+this._encryptionSecret):M.encode(w.appId+w.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function($,q,ce){const me=await window.crypto.subtle.importKey("raw",q,"PBKDF2",!1,["deriveBits","deriveKey"]),ge=$==="aes-128-gcm2"?128:256,pe=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:z6,hash:"SHA-256",salt:ce},me,ge+Ode);return new Uint8Array(pe).subarray(ge/8)}(this._encryptionMode,U,qg(this._encryptionSalt)),this._encryptDataStreamKey=await async function($,q,ce){const me=await window.crypto.subtle.importKey("raw",q,"PBKDF2",!1,["deriveBits","deriveKey"]),ge=$==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:z6,hash:"SHA-256",salt:ce},me,{name:"AES-GCM",length:ge},!0,["encrypt","decrypt"])}(this._encryptionMode,U,qg(this._encryptionSalt))}else p?k.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):k.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,k.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:n,appId:e,stringUid:w.stringUid});const I=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&I===this._sessionId&&pt.joinChannelTimeout(this._sessionId,5)},5e3);try{var P;let M;const U=w.cloudProxyServer;if($e(P=["proxy3","proxy4","proxy5"]).call(P,U)){const ge=Z("PROXY_SERVER_TYPE3");Array.isArray(ge)?w.proxyServer=ge[0]:w.proxyServer=ge}if(pt.setProxyServer(w.proxyServer),k.setProxyServer(w.proxyServer),this.store.requestAPStart(),_){if(k.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(w.stringUid?", ".concat(w.stringUid," => ").concat(_.intUid):""," ")),w.stringUid&&!w.uid&&(w.uid=_.intUid),M={gatewayInfo:_.ap.gatewayInfo},Z("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&w.turnServer.mode==="auto")if(_.ap.proxyInfo.addresses.length===0)k.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const ge=(await Rz(_.ap.proxyInfo,_.ap.gatewayInfo.uid)).map(pe=>({turnServerURL:pe.address,tcpport:pe.tcpport||fo.tcpport,udpport:pe.udpport||fo.udpport,username:pe.username||fo.username,password:pe.password||fo.password,forceturn:!1,security:!0}));w.turnServer={mode:"manual",servers:ge}}M8(_,w.stringUid)}else{if(w.stringUid&&!w.uid){let ge;[ge,M]=await Qe.all([Zz(w.stringUid,w,this._axiosCancelSource.token,this._config.httpRetryConfig||pi,this.store),Qz(w,this._axiosCancelSource.token,this._config.httpRetryConfig||pi,!0,this.store)]),k.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(w.stringUid," => ").concat(ge)),w.uid=ge,M.gatewayInfo.uid=ge,M.gatewayInfo.res.uid=ge}else M=await Qz(w,this._axiosCancelSource.token,this._config.httpRetryConfig||pi,!0,this.store);if(!this._joinAndNotLeaveYet)throw new be(Y.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(w,this._axiosCancelSource.token),this._configDistribute.on(y0.UPDATE_BITRATE_LIMIT,ge=>{this._p2pChannel.updateBitrateLimit(ge)}),this._configDistribute.on(y0.UPDATE_CLIENT_ROLE_OPTIONS,ge=>{this._setClientRoleOptions(ge)})},0),this._key=i||e;const $=M.gatewayInfo,q=w.uid?w.uid:$.uid;this._joinInfo=Hl(Hl({},w),{},{cid:$.cid,uid:q,vid:$.vid,apResponse:$.res,apGatewayAddress:$.apGatewayAddress,uni_lbs_ip:$.uni_lbs_ip,gatewayAddrs:$.gatewayAddrs}),this.store.intUid=q,this.store.cid=$.cid;const ce=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new be(Y.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));S.onSuccess(ce),this._appId=e,this._channelName=w.cname,this._uid=ce,this.store.uid=ce,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(lo()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);const me=w.stringUid?"string uid: ".concat(w.stringUid,",uid: ").concat(w.uid):"uid: ".concat(this._uid);return k.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(n,",").concat(me)),setTimeout(()=>{k.startUpload()},5e3),this.store.joinEnd(),B=this,$e(n_).call(n_,B)||n_.push(B),this._cloudProxyServerMode==="disabled"&&Cn().supportWebCrypto&&Z("ENABLE_PRELOAD")&&sx(this._joinInfo),ce}catch(M){const U=Array.isArray(M)?M[0]:M;throw U&&U.code===Y.OPERATION_ABORTED?k.warning("[".concat(this._clientId,"] join number: ").concat(u,", Joining channel failed, rollback"),U):k.error("[".concat(this._clientId,"] join number: ").concat(u,", Joining channel failed, rollback"),U),U.code!==Y.OPERATION_ABORTED&&this._numberOfJoinCount===u&&(this._gateway.state="DISCONNECTED",this._reset()),S.onError(U),U}var B}_joinGateway(){if(!this._joinInfo||!this._key)throw new be(Y.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!Z("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){k.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(lo()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(n){const i=n_.indexOf(n);i!==-1&&n_.splice(i,1)}(this),this._statsCollector.stopUpdateStats();const e=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return k.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void e();await this._gateway.leave(this.connectionState!=="CONNECTED",Mn.LEAVE),k.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),e()}async publish(e){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(e)){if(!(e instanceof WE))return this._publishDataChannel(e);e=[e]}if(e.length===0)throw new be(Y.INVALID_PARAMS,"param list is empty");const i=e;if(this._gateway.role==="audience")throw new be(Y.INVALID_OPERATION,"audience can not publish stream");for(const c of i){if(!(c instanceof WE))throw new be(Y.INVALID_PARAMS,"parameter is not local track");if(!c._enabled&&n)throw new be(Y.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(c.getTrackId()))}k.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(i.map(c=>"".concat(c.getTrackId()," "))));const s=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),n&&i.forEach(c=>{const u=this._configDistribute.getBitrateLimit();c instanceof ur&&u&&c.setBitrateLimit(u.uplink)});try{await this._publishHighStream(i),k.info("[".concat(this._clientId,"] Publish success, id ").concat(i.map(c=>"".concat(c.getTrackId()," "))))}catch(c){throw k.error("[".concat(this._clientId,"] publish error"),c.toString()),c}finally{s()}}async _publishDataChannel(e){Yn(e.id,"id",0,65535,!0),hf(e.ordered,"ordered"),Xi(e.metadata,"metadata",0,512),k.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(e.id));const n=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(c=>c.id===e.id)!==-1)throw new be(Y.INVALID_PARAMS,"Invalid id: ".concat(e.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new be(Y.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new be(Y.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&Z("FORCE_TURN")&&!Z("TURN_ENABLE_TCP")&&!Z("TURN_ENABLE_UDP"))throw new be(Y.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const i=function(c){return Gz(c,!1)}(e),s=await this._p2pChannel.publishDataChannel([i]);if(s.length>0){if(typeof i._originDataChannelId!="number")throw k.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new be(Y.CREATE_DATACHANNEL_ERROR);try{await Qe.all(s.map(c=>this._uid&&this._gateway.publishDataChannel(this._uid,c,!0))),await i._waitTillOpen()}catch(c){if(c.code!==Y.DISCONNECT_P2P)throw c}}return k.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(i.id)),i}catch(i){throw k.error("[".concat(this._clientId,"] publish datachannels error"),i.toString()),i}finally{n()}}async unpublish(e){if(!this._joinInfo||this._uid===void 0)throw new be(Y.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let n=[];if(e)if(Array.isArray(e))n=e;else{if(!(e instanceof WE))return this._unpublishDataChannel([e]);n=[e]}else this.store.useP2P||await this._unpublishDataChannel(),n=this._p2pChannel.getAllTracks(!0);k.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(n.map(s=>"".concat(s.getTrackId()," "))," "));const i=await this._publishMutex.lock();try{if(this.store.useP2P){const s=await this._p2pChannel.unpublish(n);s&&await this._gateway.sendExtensionMessage(Jr.UNPUBLISH,{unpubMsg:s},!0)}else{const s=await this._p2pChannel.unpublish(n);s&&await this._gateway.unpublish(s,this._uid),k.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(n.map(c=>"".concat(c.getTrackId()))))}}catch(s){throw k.error("[".concat(this._clientId,"] unpublish error"),s.toString()),s}finally{i&&i()}}async _unpublishDataChannel(e){e!==void 0&&e.length!==0||(e=this._p2pChannel.getAllDataChannels()),k.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(e.map(i=>"".concat(i.id," "))," "));const n=await this._publishMutex.lock();try{const i=await this._p2pChannel.unpublishDataChannel(e);i&&await this._gateway.unpublishDataChannel(i),k.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(e.map(s=>"".concat(s.id))))}catch(i){throw k.error("[".concat(this._clientId,"] unpublish dataChannel error"),i.toString()),i}finally{n&&n()}}async subscribe(e,n,i){if(!(e instanceof Xp)){const s=this.remoteUsers.find(c=>c.uid===e);if(!s)throw new be(Y.INVALID_REMOTE_USER,"user is not in the channel");e=s}return n==="datachannel"?this._subscribeDataChannel(e,i):this._subscribe(e,n)}async presubscribe(e,n){if(bi(n,"mediaType",["audio","video"]),this.store.useP2P)throw new be(Y.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new be(Y.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new be(Y.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const i=n===ot.AUDIO,s=n===ot.VIDEO,c=await this._subscribeMutex.lock();try{const{ssrcId:u,ortc:h,rtxSsrcId:p,cname:_,uint_id:E}=await this._gateway.presubscribe(e,n,!0);if(u==null)throw new be(Y.UNEXPECTED_RESPONSE,"no ssrc id");let S=this._users.find(I=>I.uid===e);S||(S=new Xp(e,E||e),S._is_pre_created=!0,this._users.push(S)),_&&(S._cname=_),S._uintid||(S._uintid=E||e),i&&(S._audioSSRC=u,S._audio_pre_subscribed=!0,h&&(S._audioOrtc=h)),s&&(S._videoSSRC=u,S._video_pre_subscribed=!0,h&&(S._videoOrtc=h),p!=null&&(S._rtxSsrcId=p)),k.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(u)),await this._p2pChannel.subscribe(S,n,u,p,h);const w=i?S._audioTrack:S._videoTrack;if(!w)throw new be(Y.UNEXPECTED_ERROR,"can not find remote track in user");return i&&(S._trust_audio_stream_added_state_=!0,S._audio_added_=!0),s&&(S._trust_video_stream_added_state_=!0,S._video_added_=!0),w}catch(u){throw k.error("[".concat(this._clientId,"] presub user ").concat(e," error"),u),u}finally{c()}}async _subscribeDataChannel(e,n){var i;if(Yn(n,"channelId",0,65535,!0),!this._joinInfo)throw new be(Y.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new be(Y.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(p=>p===e))throw k.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),new be(Y.INVALID_REMOTE_USER,"user is not in the channel");if(!e.hasAudio&&!e.hasVideo&&e._dataChannels.length===0)throw k.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),new be(Y.INVALID_REMOTE_USER,"user is not published");const c=(i=e._dataChannels)===null||i===void 0?void 0:i.find(p=>p.id===n);if(!c)throw k.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, remote datachannel is not published")),new be(Y.REMOTE_USER_IS_NOT_PUBLISHED);const u=await this._subscribeMutex.lock();k.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: datachannel"));try{const p=await this._p2pChannel.subscribeDataChannel(e,[c]);if(p&&$e(p).call(p,c.id))try{var h;if(typeof c._originDataChannelId!="number")throw k.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, cannot get RTCDatachannel")),new be(Y.CREATE_DATACHANNEL_ERROR);const _={id:c.id,datachannelId:c._originDataChannelId,ordered:c.ordered,maxRetransmits:c.maxRetransmits,metadata:(h=c.metadata)!==null&&h!==void 0?h:""};await this._gateway.subscribeDataChannel(e.uid,_,!0),await c._waitTillOpen()}catch(_){if((_==null?void 0:_.code)!==Y.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(e,[c]),_;await this._p2pChannel.unsubscribeDataChannel(e,[c]),this._p2pChannel.setPendingRemoteDataChannel(e,c.id)}return k.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: datachannel")),c}finally{u()}}async _p2pSubscribe(e,n,i){if(bi(n,"mediaType",["audio","video"]),!this._joinInfo)throw new be(Y.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new be(Y.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(u=>u===e)){const u=new be(Y.INVALID_REMOTE_USER,"user is not in the channel");throw k.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),u}if(!e.hasAudio&&!e.hasVideo){const u=new be(Y.INVALID_REMOTE_USER,"user is not published");throw k.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),u}if(!i&&(n==="audio"&&!e.hasAudio||n==="video"&&!e.hasVideo)){const u=new be(Y.REMOTE_USER_IS_NOT_PUBLISHED);throw k.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(n,", remote track is not published")),u}const c=await this._subscribeMutex.lock();k.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(n));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,n))await this._p2pChannel.unmuteRemote(e,n);else try{const h=n==="audio"?e._audioSSRC:e._videoSSRC,p=n==="audio"?e._audioMid:e._videoMid;this.store.subscribe(e.uid,n,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(e,n,h,p)}catch(h){throw h}k.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(n)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(h=>{k.warning("[".concat(this._clientId,"] auto set fallback failed"),h)});const u=n==="audio"?e._audioTrack:e._videoTrack;if(!u)throw new be(Y.UNEXPECTED_ERROR,"can not find remote track in user object");return u}catch(u){throw k.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),u),u}finally{c()}}async _subscribe(e,n,i){if(this.store.useP2P)return this._p2pSubscribe(e,n);if(bi(n,"mediaType",["audio","video"]),!this._joinInfo)throw new be(Y.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new be(Y.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(E=>E===e)){const E=new be(Y.INVALID_REMOTE_USER,"user is not in the channel");throw k.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),E}if(!e.hasAudio&&!e.hasVideo){const E=new be(Y.INVALID_REMOTE_USER,"user is not published");throw k.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),E}if(!(i||(n!=="audio"||e.hasAudio&&e._audioSSRC!==void 0)&&(n!=="video"||e.hasVideo&&e._videoSSRC!==void 0))){const E=new be(Y.REMOTE_USER_IS_NOT_PUBLISHED);throw k.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(n,", remote track is not published")),E}let c=n==="audio"?e._audioSSRC:e._videoSSRC,u=n==="audio"?e._audioOrtc:e._videoOrtc,h=n==="video"?e._rtxSsrcId:void 0,p={stream_type:n==="audio"?ot.AUDIO:ot.VIDEO,ssrcId:c};const _=await this._subscribeMutex.lock();k.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(n));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,n))await this._p2pChannel.unmuteRemote(e,n);else try{const S=n==="audio"?e._audioSSRC:e._videoSSRC;S!==void 0&&S!==c&&(c=S,u=n==="audio"?e._audioOrtc:e._videoOrtc,h=n==="video"?e._rtxSsrcId:void 0,p={stream_type:n==="audio"?ot.AUDIO:ot.VIDEO,ssrcId:c}),Ro.markSubscribeStart(this.store.clientId,c),this.store.subscribe(e.uid,n,Date.now()),await this._p2pChannel.subscribe(e,n,c,h,u);try{this._p2pChannel.isPreSubScribe(c)||await this._gateway.subscribe(e.uid,p,!0)}catch(w){if((w==null?void 0:w.code)!==Y.WS_ABORT)throw await this._p2pChannel.unsubscribe(e,n),w;await this._p2pChannel.unsubscribe(e,n,!0),this._p2pChannel.setPendingRemoteMedia(e,n)}this.store.subscribe(e.uid,n,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,e,n)}catch(S){throw this._p2pChannel.reportSubscribeEvent(!1,S==null?void 0:S.code,e,n),S}k.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(n)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(S=>{k.warning("[".concat(this._clientId,"] auto set fallback failed"),S)});const E=n==="audio"?e._audioTrack:e._videoTrack;if(!E)throw new be(Y.UNEXPECTED_ERROR,"can not find remote track in user object");return E}catch(E){throw k.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),E),E}finally{_()}}async massSubscribe(e){if(ff(e,"subscribeList"),!this._joinInfo)throw new be(Y.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new be(Y.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const n=Date.now(),i=new Map,s=await this._subscribeMutex.lock();k.info("[".concat(this._clientId,"]start massSubscribe user ").concat(e.map(p=>{let{user:_,mediaType:E}=p;return"user: ".concat(_==null?void 0:_.uid,", mediaType: ").concat(E)}).join("; ")));const c=(e=[...e]).map(p=>{let{user:_,mediaType:E}=p;return{user:_,mediaType:E}}),u=await this._p2pChannel.globalLock();try{var h;for(let _=e.length-1;_>=0;_--){const E=e[_],{user:S,mediaType:w}=E;if(bi(w,"mediaType",["audio","video"]),!S){const M=new be(Y.INVALID_PARAMS,"user property does not exist in subscribeList item");throw k.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),M}if(!this._users.find(M=>M===S)){const M=new be(Y.INVALID_REMOTE_USER,"user is not in the channel");k.error("[".concat(this._clientId,"] can not massSubscribe ").concat(S.uid,", this user is not in the channel")),c[_].error=M,e.splice(_,1);continue}if(w==="audio"&&(!S.hasAudio||S._audioSSRC===void 0)||w==="video"&&(!S.hasVideo||S._videoSSRC===void 0)){const M=new be(Y.REMOTE_USER_IS_NOT_PUBLISHED);k.error("[".concat(this._clientId,"] can not subscribe ").concat(S.uid," with mediaType ").concat(w,", remote user is not published")),c[_].error=M,e.splice(_,1);continue}const P=ki.Video|ki.LwoVideo,B=i.get(S);if(B){if(w==="video"?B&P:B&ki.Audio){e.splice(_,1),k.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(S.uid,", mediaType:").concat(w," twice"));continue}i.set(S,B|(w==="video"?P:ki.Audio))}else i.set(S,w==="video"?P:ki.Audio)}for(let _=e.length-1;_>=0;_--){const E=e[_],{user:S,mediaType:w}=E,I=ki.Video|ki.LwoVideo;if(this._p2pChannel.hasRemoteMedia(S,w)){await this._p2pChannel.unmuteRemoteNoLock(S,w);const P=i.get(S);i.set(S,w==="video"?P^I:P^ki.Audio),e.splice(_,1)}}this.store.massSubscribe(e.map(_=>({userId:_.user.uid,type:_.mediaType})),n);let p=ka(h=Array.from(i.entries())).call(h,(_,E)=>{let[S,w]=E;if(w===0)return _;const I={stream_id:S.uid,stream_type:w};return w&ki.Audio&&(I.audio_ssrc=S._audioSSRC),w&ki.Video&&(I.video_ssrc=S._videoSSRC),_.push(I),_},[]);try{e.length>0&&await this._p2pChannel.massSubscribeNoLock(e.map(E=>{let{user:S,mediaType:w}=E;return{user:S,mediaType:w,ssrcId:w===ot.VIDEO?S._videoSSRC:S._audioSSRC,rtxSsrcId:w===ot.VIDEO?S._rtxSsrcId:void 0}}));const _=new Map;if(p=p.filter(E=>E.video_ssrc&&!this._p2pChannel.isPreSubScribe(E.video_ssrc)||E.audio_ssrc&&!this._p2pChannel.isPreSubScribe(E.audio_ssrc)||!E.video_ssrc&&!E.audio_ssrc),p.length>0){const E=await this._gateway.subscribeAll(p,!0);((E==null?void 0:E.users)||[]).forEach(S=>{let{stream_id:w,video_error_code:I,audio_error_code:P,error_code:B}=S;(I||P||B)&&_.set(w,{video_error_code:I,audio_error_code:P,error_code:B})})}if(Array.from(_.entries()).length>0){const E=[];Array.from(_.entries()).forEach(S=>{let[w,I]=S;const P=this.remoteUsers.find(B=>B.uid===w);if(P){let B;I.error_code||I.video_error_code&&I.audio_error_code?B=void 0:I.video_error_code?B=ot.VIDEO:I.audio_error_code&&(B=ot.AUDIO),E.push({user:P,mediaType:B})}}),E.length>0&&await this._p2pChannel.massUnsubscribeNoLock(E)}for(const E of c){const S=_.get(E.user.uid);if(S){const w=S.error_code||E.mediaType==="audio"&&S.audio_error_code||E.mediaType==="video"&&S.video_error_code;if(w){const I=S0(w);k.error("user:".concat(E.user.uid," mediaType:").concat(E.mediaType," has massSubscribe error ").concat(I.desc)),E.error=new be(Y.SUBSCRIBE_FAILED,"code ".concat(w,": ").concat(I.desc))}}E.error||(E.mediaType==="video"?E.track=E.user.videoTrack:E.track=E.user.audioTrack)}return this.store.massSubscribe(c.filter(E=>!E.error).map(E=>({userId:E.user.uid,type:E.mediaType})),void 0,Date.now()),c.forEach(E=>{var S;pt.subscribe(this.store.sessionId,{succ:!!E.error,ec:((S=E.error)===null||S===void 0?void 0:S.code)||null,video:E.mediaType===ot.VIDEO,audio:E.mediaType===ot.AUDIO,peerid:E.user.uid,subscribeRequestid:E.mediaType===ot.VIDEO?E.user._videoSSRC:E.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-n),preSsrc:this._p2pChannel.isPreSubScribe(E.user._videoSSRC)},!0)}),k.info("[".concat(this._clientId,"] massSubscribe success ").concat(e.map(E=>{let{user:S,mediaType:w}=E;return"user: ".concat(S==null?void 0:S.uid,", mediaType: ").concat(w)}).join("; "))),c}catch(_){throw await this._p2pChannel.massUnsubscribeNoLock(e),_}}finally{u(),s()}}async unsubscribe(e,n,i){if(!(e instanceof Xp)){const u=this.remoteUsers.find(h=>h.uid===e);if(!u)throw new be(Y.INVALID_REMOTE_USER,"user is not in the channel");e=u}if(n||this.store.useP2P){if(n==="datachannel")return this._unsubscribeDataChannel(e,i)}else await this._unsubscribeDataChannel(e,i);if(n&&bi(n,"mediaType",["audio","video"]),!this._joinInfo)throw new be(Y.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(u=>u===e)){const u=new be(Y.INVALID_REMOTE_USER,"user is not in the channel");throw k.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),u}k.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: ").concat(n));const c=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(e,n);else{const u=await this._p2pChannel.unsubscribe(e,n);u&&await this._gateway.unsubscribe(u,e.uid),n&&n!=="audio"||(e._audio_pre_subscribed=!1),n&&n!=="video"||(e._video_pre_subscribed=!1),e._is_pre_created&&BI(this._users,e),k.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(e.uid,", mediaType: ").concat(n))}}catch(u){if(u.code===Y.DISCONNECT_P2P)return void k.warning("disconnecting p2p, abort unsubscribe request.");throw k.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),u.toString()),u}finally{c()}}async _unsubscribeDataChannel(e,n){if(n&&Yn(n,"id",0,65535,!0),!this._joinInfo)throw new be(Y.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(c=>c===e)){const c=new be(Y.INVALID_REMOTE_USER,"user is not in the channel");throw k.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),c}let s;if(typeof n=="number"){const c=e._dataChannels.find(u=>u.id===n);c&&(s=[c])}else s=e._dataChannels;if(s===void 0){const c=new be(Y.REMOTE_USER_IS_NOT_PUBLISHED);throw k.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid," with channelId ").concat(n,", remote datachannel is not published")),c}k.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(s.map(c=>c.id)));try{const c=await this._p2pChannel.unsubscribeDataChannel(e,s);c&&await this._gateway.unsubscribeDataChannel(c,e.uid),k.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(c))}catch(c){if(c.code===Y.DISCONNECT_P2P)return void k.warning("disconnecting p2p, abort unsubscribe request.");throw k.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),c.toString()),c}}async massUnsubscribe(e){if(ff(e,"unsubscribeList"),!this._joinInfo)throw new be(Y.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");k.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(e.map(i=>{let{user:s,mediaType:c}=i;return"user: ".concat(s==null?void 0:s.uid,", mediaType: ").concat(c,";")}).join())),e=[...e];const n=new Map;for(let i=e.length-1;i>=0;i--){const{user:s,mediaType:c}=e[i];if(!s){const p=new be(Y.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw k.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),p}if(bi(c,"mediaType",["video","audio",void 0]),!this._users.find(p=>p===s)){k.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(s.uid,", user is not in the channel")),e.splice(i,1);continue}const h=ki.Video|ki.LwoVideo;if(n.has(s)){const p=n.get(s);let _;switch(c){case"video":_=p&h;break;case"audio":_=p&ki.Audio;break;default:_=p&(ki.Audio|h)}if(_){k.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(s.uid,",mediaType:").concat(c," twice.")),e.splice(i,1);continue}c?c==="audio"?n.set(s,p|ki.Audio):c==="video"&&n.set(s,p|h):n.set(s,p|ki.Audio|h)}else c?c==="audio"?n.set(s,ki.Audio):c==="video"&&n.set(s,h):n.set(s,ki.Audio|h)}try{const i=await this._p2pChannel.massUnsubscribe(e);i&&await this._gateway.massUnsubscribe(i),k.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(e.map(s=>{let{user:c,mediaType:u}=s;return"user: ".concat(c==null?void 0:c.uid,", mediaType: ").concat(u,";")}).join()))}catch(i){if(i.code===Y.DISCONNECT_P2P)return void k.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw k.error("[".concat(this._clientId,"] massUnsubscribe error"),i.toString()),i}}async setLowStreamParameter(e){(function(i){if(!i)throw new Ie(Y.INVALID_PARAMS);kr(i.width)||U1(i.width,"streamParameter.width"),kr(i.height)||U1(i.height,"streamParameter.height"),kr(i.framerate)||U1(i.framerate,"streamParameter.framerate"),kr(i.bitrate)||Yn(i.bitrate,"streamParameter.bitrate")})(e),(!e.width&&e.height||e.width&&!e.height)&&k.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),k.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(e));const n=this._configDistribute.getLowStreamConfigDistribute();if(n&&n.bitrate&&e.bitrate&&n.bitrate<e.bitrate&&(e.bitrate=n.bitrate),this._lowStreamParameter=e,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(e,xe.LocalVideoLowTrack)}async enableDualStream(){if(!Cn().supportDualStream)throw pt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new be(Y.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new be(Y.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(e){throw pt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),e}this._isDualStreamEnabled=!0,pt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),k.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new be(Y.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(xe.LocalVideoLowTrack))try{const e=await this._p2pChannel.unpublishLowStream();e&&await this._gateway.unpublish(e,this._joinInfo.stringUid||this._joinInfo.uid)}catch(e){throw pt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),e}this._isDualStreamEnabled=!1,pt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),k.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(e,n){if(function(s){bi(s,"role",["audience","host"])}(e),n&&B1(n),this.mode==="rtc"||this.mode==="p2p")throw k.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new be(Y.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(n&&n.level&&e==="host")throw new be(Y.INVALID_OPERATION,"host mode can not set audience latency level");if(e==="audience"&&this._p2pChannel.hasLocalMedia())throw new be(Y.INVALID_OPERATION,"can not set client role to audience when publishing stream");const i=this._config.role;this._joinInfo&&(this._joinInfo.role=e),e!==i&&Z("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(e,n),this._config.role=e,this._gateway.reconnect("recover",uo.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(e,n),this._config.role=e),k.info("[".concat(this._clientId,"] set client role to ").concat(e,", level: ").concat(n&&n.level))}async _setClientRoleOptions(e){if(this.mode==="rtc"||this.mode==="p2p"||this._config.role!=="audience"||this._p2pChannel.hasLocalMedia())return;let n=!1;try{e&&B1(e),await this._gateway.setClientRole(this._config.role,e),n=!0}catch{}finally{k.info("[".concat(this._clientId,"] set client role options ").concat(n?"succeed":"failed",", options is ").concat(e))}}getRemoteInboundOffset(){var e;const n=(e=this._p2pChannel.getStats())===null||e===void 0?void 0:e.audioSend[0];if(!n||!n.timestamp)return 0;const i=n.timestamp-Date.now();return Math.abs(i)>1e3+n.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?i:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(e,n){if(Xi(e,"proxyServer"),!n){if(this.connectionState!=="DISCONNECTED")throw new be(Y.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new be(Y.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,pt.setProxyServer(this._proxyServer),k.setProxyServer(this._proxyServer),k.info("[".concat(this._clientId,"] Set proxy server ").concat(n?"by initialize call":""," success."))}setTurnServer(e,n){if(Array.isArray(e)||(e=[e]),!n){if(this.connectionState!=="DISCONNECTED")throw new be(Y.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new be(Y.INVALID_OPERATION,"You have already set the proxy")}if(d0(e))return this._turnServer={servers:e,mode:"original-manual"},void k.info("[".concat(this._clientId,"] Set original turnserver ").concat(n?"by initialize call":""," success: ").concat(e.map(i=>i.urls).join(","),"."));e.forEach(i=>T6(i)),this._turnServer={servers:e,mode:"manual"},k.info("[".concat(this._clientId,"] Set turnserver ").concat(n?"by initialize call":""," success."))}setLicense(e){if(this.connectionState!=="DISCONNECTED")throw new be(Y.INVALID_OPERATION,"you should set license before join channel");if(Xi(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new be(Y.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,k.info("[".concat(this._clientId,"] set license success"),e)}startProxyServer(e){if(this.connectionState!=="DISCONNECTED")throw new be(Y.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new be(Y.INVALID_OPERATION,"You have already set the proxy");const n=[3,4,5];let i;switch(e===void 0&&(e=3),e){case 1:case 2:throw new be(Y.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:i="proxy3";break;case 4:i="proxy4";break;case 5:i="proxy5";break;default:throw new be(Y.INVALID_PARAMS,"proxy server mode must be ".concat(n.join("|")))}this._cloudProxyServerMode=i,this.store.cloudProxyServerMode=i,k.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new be(Y.INVALID_OPERATION,"Stop proxy server after leave channel");pt.setProxyServer(),k.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",k.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(e){if(!e.accessPoints)throw new be(Y.INVALID_PARAMS,"accessPoints is required.");ff(e.accessPoints.serverList,"accessPoints.serverList"),Xi(e.accessPoints.domain,"accessPoints.domain");const n=(I,P)=>{Yn(I,P,0,65535,!0)};let i=443;if(e.accessPoints.port&&(n(e.accessPoints.port,"accessPoints.port"),i=e.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new be(Y.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");Z("CLOSE_AFB_FOR_LOCAL_AP")&&(Kn("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),Kn("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const s=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,c=e.accessPoints.domain,u=e.accessPoints.serverList.map(I=>s.test(I)?"".concat(I.replace(/\./g,"-"),".").concat(c):I),h=u.map(I=>"".concat(I,":").concat(i));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,Kn("WEBCS_DOMAIN",h),Kn("WEBCS_DOMAIN_BACKUP_LIST",h),Kn("GATEWAY_DOMAINS",[c]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?(ff(e.report.hostname,"report.hostname"),Kn("EVENT_REPORT_DOMAIN",e.report.hostname[0]),Kn("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):(Kn("EVENT_REPORT_DOMAIN",u[0]),Kn("EVENT_REPORT_BACKUP_DOMAIN",u[1]||u[0]));let p=6443;e.report&&e.report.port&&(n(e.report.port,"report.port"),p=e.report.port),Kn("STATS_COLLECTOR_PORT",p),e.report?Kn("ENABLE_EVENT_REPORT",!0):Kn("ENABLE_EVENT_REPORT",!1);let _="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?(ff(e.log.hostname,"log.hostname"),_=e.log.hostname[0]):_=u[0];let E=6444;e.log&&e.log.port&&(n(e.log.port,"log.port"),E=e.log.port),Kn("LOG_UPLOAD_SERVER","".concat(_,":").concat(E));let S=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?(ff(e.cds.hostname,"cds.hostname"),S=e.cds.hostname):S=u;let w=443;e.cds&&e.cds.port&&(n(e.cds.port,"cds.port"),w=e.cds.port),Kn("CDS_AP",S.map(I=>"".concat(I,":").concat(w))),e.cds?Kn("ENABLE_CONFIG_DISTRIBUTE",!0):Kn("ENABLE_CONFIG_DISTRIBUTE",!1),k.info("set local access point v2 success")}setLocalAccessPoints(e,n){if(ff(e,"serverList"),Xi(n,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new be(Y.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const i=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map(s=>i.test(s)?"".concat(s.replace(/\./g,"-"),".").concat(n):s),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,Kn("WEBCS_DOMAIN",e),Kn("WEBCS_DOMAIN_BACKUP_LIST",e),Kn("GATEWAY_DOMAINS",[n]),Kn("EVENT_REPORT_DOMAIN",e[0]),Kn("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),Kn("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),k.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(e){if(bi(e,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=e,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(e),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(n){throw k.error("[".concat(this._clientId,"] set default remote video stream type error"),n.toString()),n}else k.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(e))}async setRemoteVideoStreamType(e,n){bi(n,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(e,n),setTimeout(()=>{const i=this._users.find(s=>s.uid===e);i&&i.videoTrack&&i.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(i){throw k.error("[".concat(this._clientId,"] set remote video stream type error"),i.toString()),i}k.info("[".concat(this._clientId,"] set remote ").concat(e," video stream type to ").concat(n)),this._remoteStreamTypeCacheMap.set(e,n)}async setStreamFallbackOption(e,n){bi(n,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(e,n)}catch(i){throw k.error("[".concat(this._clientId,"] set stream fallback option"),i.toString()),i}k.info("[".concat(this._clientId,"] set remote ").concat(e," stream fallback type to ").concat(n)),this._streamFallbackTypeCacheMap.set(e,n)}setEncryptionConfig(e,n,i,s){(function(u){bi(u,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(e),Xi(n,"secret");const c=["aes-128-gcm2","aes-256-gcm2"];if($e(c).call(c,e)){if(!i||!(i instanceof Uint8Array&&i.length===32))throw new be(Y.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(i)throw new be(Y.INVALID_PARAMS,"current encrypt mode does not need salt");if(s){if(hf(s,"encryptDataStream"),!$e(c).call(c,e))throw new be(Y.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(n)||k.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=e,this._encryptionSecret=n,i&&(this._encryptionSalt=Wp(i))}async renewToken(e){if(Xi(e,"token",1,2047),!this._key||!this._joinInfo)throw new be(Y.INVALID_OPERATION,"renewToken should not be called before user join");const n=this._key;this._key=e,this._joinInfo&&(this._joinInfo.token=e);const i=await this._renewTokenMutex.lock();try{if(Z("USE_NEW_TOKEN")){k.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const s=await cfe(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||pi);k.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:e,ticket:s})}else k.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:e});k.debug("[".concat(this._clientId,"] renewToken success"))}catch(s){throw this._key=n,this._joinInfo.token=n,k.error("[".concat(this._clientId,"] renewToken failed"),s.toString()),s}finally{i()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?k.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const e=this._p2pChannel.getAudioLevels();this.safeEmit(on.VOLUME_INDICATOR,e)},Z("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const e=this._statsCollector.getRTCStats(),n=this._gateway.getInChannelInfo();return e.Duration=Math.round(n.duration/1e3),e}async startLiveStreaming(e,n){if(!n){if(this.codec!=="h264")throw new be(Y.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new be(Y.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e))throw new be(Y.LIVE_STREAMING_TASK_CONFLICT);const i=n?gf.TRANSCODE:gf.RAW;return this._createLiveStreamingClient(i).startLiveStreamingTask(e,i)}setLiveTranscoding(e){return this._createLiveStreamingClient(gf.TRANSCODE).setTranscodingConfig(e)}async stopLiveStreaming(e){const n=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(i=>i&&i.hasUrl(e));if(!n.length)throw new be(Y.INVALID_PARAMS,"can not find live streaming url to stop");await Qe.all(n.map(i=>i&&i.stopLiveStreamingTask(e)))}async startChannelMediaRelay(e){s8(e),await this._createChannelMediaRelayClient().startChannelMediaRelay(e)}async updateChannelMediaRelay(e){s8(e),await this._createChannelMediaRelayClient().updateChannelMediaRelay(e)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(e){this._p2pChannel instanceof N0&&this._p2pChannel.addAudioMetadata(e)}async sendStreamMessage(e){var n;let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new be(Y.INVALID_OPERATION,"can not send data stream, not joined");if((typeof e=="string"||e instanceof Uint8Array)&&(e={payload:e}),typeof e.payload=="string"){const c=new TextEncoder;e.payload=c.encode(e.payload)}let s=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&$e(n=["aes-128-gcm2","aes-256-gcm2"]).call(n,this._encryptionMode)&&(s=!0,e.payload=await async function(c,u,h){var p;const _=ka(p=Array.from(h)).call(p,(M,U)=>M+U,0),E={serverTs:0,seq:Pde++,length:h.length,checkSum:_},S=new Uint8Array(P6(_,2)),w=new ArrayBuffer(xE),I=new DataView(w);I.setUint32(0,E.serverTs),I.setUint16(4,E.seq),I.setUint16(6,E.length),I.setUint16(8,E.checkSum);const P=16-h.length%16;h=R6(h,new Uint8Array(P));const B=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:c,tagLength:G6,additionalData:S},u,h);return R6(new Uint8Array(w),new Uint8Array(B))}(this._encryptDataStreamIv,this._encryptDataStreamKey,e.payload)),new Blob([e.payload]).size>1024)throw new be(Y.INVALID_PARAMS,s?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(kt.DATA_STREAM,{payload:Wp(e.payload),syncWithAudio:e.syncWithAudio,sendTs:Date.now()-_fe},!i)}sendMetadata(e){if(!this._joinInfo)throw new be(Y.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new be(Y.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(kt.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:Wp(e)})}async sendCustomReportMessage(e){if(Array.isArray(e)||(e=[e]),e.forEach(Fde),!this._joinInfo)throw new be(Y.INVALID_OPERATION,"can not send custom report, not joined");await pt.sendCustomReportMessage(this._joinInfo.sid,e)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(e,n){bi(n.spatialLayer,"spatialLayer",[0,1,2,3]),bi(n.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(e,n)}catch(i){throw k.error("[".concat(this._clientId,"] pick SVC layer failed"),i.toString()),i}}async setRTMConfig(e){const{apRTM:n=!1,rtmFlag:i}=e;if(hf(n,"apRTM"),Yn(i,"rtmFlag",0),this._rtmConfig.apRTM=n,this._rtmConfig.rtmFlag=i,k.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(e)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=n,this._joinInfo.rtmFlag=i,this._gateway.setRTM2Flag(i)}_reset(){if(k.debug("[".concat(this._clientId,"] reset client")),function(e){const n=qE.indexOf(e);n!==-1&&qE.splice(n,1)}(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this._axiosCancelSource.cancel(),this._axiosCancelSource=Ls.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&x8(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&pt.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(e=>{e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy(),e._dataChannels&&(e._dataChannels.forEach(n=>n._close()),e._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new To("client-publish",this._clientId),this._subscribeMutex=new To("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(e,n){var i;const s=e||Yg();e?k.debug("[".concat(this._clientId,"] new Session ").concat(s)):k.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(s));const c=e?"":this._sessionId||"";this._sessionId=s,this.store.sessionId=s,pt.addSid(s);const u={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:(n==null?void 0:n.stringUid)||((i=this._joinInfo)===null||i===void 0?void 0:i.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:c,clientRole:this.role==="audience"?2:1};pt.sessionInit(this._sessionId,Hl({cname:n.channel,appid:n.appId},u)),this._joinInfo&&(this._joinInfo.sid=s),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=s)}async _publishHighStream(e){if(!this._joinInfo||this._uid===void 0)throw new be(Y.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new be(Y.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&Z("FORCE_TURN")&&!Z("TURN_ENABLE_TCP")&&!Z("TURN_ENABLE_UDP"))throw new be(Y.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");k.debug("[".concat(this._clientId,"] publish high stream"));try{const i=await this._p2pChannel.publish(e,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){const s=(await i.next()).value;if(s){try{await this._gateway.sendExtensionMessage(Jr.PUBLISH,s,!0)}catch(c){throw i.throw(c),c}await i.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const s=(await i.next()).value;if(s){var n;let c;try{c=await this._gateway.publish(this._uid,s,!0)}catch(u){if(u.code!==Y.DISCONNECT_P2P)throw i.throw(u),u}await i.next(((n=c)===null||n===void 0?void 0:n.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const c of e)c instanceof ur&&c._encoderConfig&&this._gateway.setVideoProfile(c._encoderConfig).catch(u=>{k.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))}),!c.muted&&c.enabled||await this._p2pChannel.muteLocalTrack(c)}}catch(i){if(this._p2pChannel.reportPublishEvent(!1,i==null?void 0:i.code,e),(i==null?void 0:i.code)===Y.WS_ABORT)return;throw i}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new be(Y.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new be(Y.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));k.debug("[".concat(this._clientId,"] publish low stream"));const e=this._configDistribute.getLowStreamConfigDistribute();e&&e.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&e.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=e.bitrate));try{const i=await this._p2pChannel.publishLowStream(this._lowStreamParameter),s=(await i.next()).value;if(s){var n;let c;try{c=await this._gateway.publish(this._uid,s,!0)}catch(u){if(u.code!==Y.DISCONNECT_P2P)throw i.throw(u),u}i.next(((n=c)===null||n===void 0?void 0:n.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(i){if(this._p2pChannel.reportPublishEvent(!1,i==null?void 0:i.code,void 0,!0),(i==null?void 0:i.code)===Y.WS_ABORT)return;throw i}}_createLiveStreamingClient(e){const n=()=>{if(!this._joinInfo||!this._appId)return new be(Y.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const i=(s={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},Ef("LiveStreaming").create(s));var s;return i.onLiveStreamError=(c,u)=>{pt.reportApiInvoke(this._sessionId,{name:fi.ON_LIVE_STREAM_ERROR,options:[c,u],tag:Dr.TRACER}).onSuccess(),this.safeEmit(on.LIVE_STREAMING_ERROR,c,u)},i.onLiveStreamWarning=(c,u)=>{pt.reportApiInvoke(this._sessionId,{name:fi.ON_LIVE_STREAM_WARNING,options:[c,u],tag:Dr.TRACER}).onSuccess(),this.safeEmit(on.LIVE_STREAMING_WARNING,c,u)},i.on(NL.REQUEST_WORKER_MANAGER_LIST,(c,u,h)=>{if(!this._joinInfo)return h(new be(Y.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(p,_,E,S){const w=Z("UAP_AP").slice(0,Z("AJAX_REQUEST_CONCURRENT")).map(I=>_.proxyServer?"https://".concat(_.proxyServer,"/ap/?url=").concat(I+"/api/v1?action=uap"):"https://".concat(I,"/api/v1?action=uap"));return await nfe(w,p,_,E,S)})(c,this._joinInfo,this._axiosCancelSource.token,pi).then(u).catch(h)}),i};return e===gf.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||n(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||n(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new be(Y.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:n,sendResolutionHeight:i}=this.getLocalVideoStats(),s=(e={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:n,height:i}},Ef("ChannelMediaRelay").create(e));s.on("state",c=>{c===ua.RELAY_STATE_FAILURE&&s&&s.dispose(),this.safeEmit(on.CHANNEL_MEDIA_RELAY_STATE,c)}),s.on("event",c=>{this.safeEmit(on.CHANNEL_MEDIA_RELAY_EVENT,c)}),this._channelMediaRelayClient=s,this._statsCollector.onStatsChanged=(c,u)=>{var h;c==="resolution"&&((h=this._channelMediaRelayClient)===null||h===void 0||h.setVideoProfile(u))}}var e;return this._channelMediaRelayClient}_handleUpdateDataChannel(e,n){const{added:i,deleted:s}=e,c=[];if(n){const u=[];this._users.forEach(h=>{h._dataChannels.forEach(p=>{i.every(_=>_.uid!==h._uintid||_.stream_id!==p.id)&&u.push({uid:h._uintid,stream_id:p.id,ordered:p.ordered,max_retrans_times:p.maxRetransmits,metadata:p.metadata})})}),u.length>0&&this._handleUpdateDataChannel({added:[],deleted:u})}Array.isArray(i)&&i.length>0&&i.forEach(u=>{const{uid:h,stream_id:p,ordered:_,max_retrans_times:E,metadata:S}=u,w=this._users.find(I=>I._uintid===h);if(!w)return void k.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(k.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(h)),$e(c).call(c,w)||c.push(w),w._uintid||(w._uintid=h),w._dataChannels.findIndex(I=>I.id===u.stream_id)===-1){const I={id:p,ordered:!!_,maxRetransmits:E,metadata:S},P=function(B){return Gz(B,!0)}(I);w._dataChannels.push(P),k.info("[".concat(this._clientId,"] remote user ").concat(w.uid," published datachannel")),n||this.safeEmit(on.USER_PUBLISHED,w,"datachannel",I)}this._p2pChannel.hasPendingRemoteDataChannel(w,u.stream_id)&&(k.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(w.uid," after reconnect.")),this._subscribeDataChannel(w,u.stream_id).catch(I=>{k.error("[".concat(this._clientId,"] resubscribe datachannel error"),I.toString())}))}),n&&(this.safeEmit(on.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(s)&&s.length>0&&s.forEach(u=>{const{uid:h,stream_id:p}=u,_=this._users.find(S=>S._uintid===h);if(!_)return void k.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const E=_._dataChannels.find(S=>S.id===u.stream_id);E&&(k.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(h)),this._p2pChannel.unsubscribeDataChannel(_,[E]).then(S=>{if(_._dataChannels=_._dataChannels.filter(w=>w!==E),S)return this._gateway.unsubscribeDataChannel(S,_.uid)}),k.info("[".concat(this._clientId,"] remote user ").concat(h," unpublished datachannel ,id:").concat(E.id)),this.safeEmit(on.USER_UNPUBLISHED,_,"datachannel",E._config))})}_handleRemoveDataChannels(e){const n=this._users.find(i=>i.uid===e.uid);if(n){if(n._dataChannels!==void 0&&n._dataChannels.length>0){k.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(e.uid));const i=()=>{k.info("[".concat(this._clientId,"] remote user ").concat(n.uid," unpublished datachannel")),n._dataChannels.forEach(s=>{this.safeEmit(on.USER_UNPUBLISHED,n,"datachannel",s._config)})};this._p2pChannel.unsubscribeDataChannel(n,n._dataChannels).then(s=>{if(s)return this._gateway.unsubscribeDataChannel(s,n.uid)}),i()}}else k.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(ji.UPDATE_GATEWAY_CONFIG,()=>{(function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(n){return void k.error("Error loading sdk config",n.message)}if(e)try{const n=JSON.parse(window.atob(e)),i=Date.now();Object.keys(n).forEach(s=>{const{value:c,type:u,expires:h}=n[s];h&&h<=i||u||wL()||!Object.prototype.hasOwnProperty.call($I,s)||(Wu[s]=c,lr[s]=c,k.debug("Update gateway parameters from config distribute",s,c))})}catch(n){k.error("Error update config from local cache",n.message)}})()}),this._gateway.on(ji.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(ji.CONNECTION_STATE_CHANGE,(e,n,i)=>{var s;if(i===Mn.FALLBACK)return;const c=()=>{this.safeEmit(on.CONNECTION_STATE_CHANGE,e,n,i)};if(pt.reportApiInvoke(this._sessionId||((s=this._gateway.joinInfo)===null||s===void 0?void 0:s.sid)||null,{name:fi.CONNECTION_STATE_CHANGE,options:[e,n,i],tag:Dr.TRACER}).onSuccess(JSON.stringify({cur:e,prev:n,reason:i})),k.info("[".concat(this._clientId,"] signal connection state change: ").concat(n," -> ").concat(e)),e==="DISCONNECTED")return this._reset(),void c();if(e==="RECONNECTING")this._users.forEach(h=>{h._trust_in_room_=!1,h._trust_audio_enabled_state_=!1,h._trust_video_enabled_state_=!1,h._trust_audio_mute_state_=!1,h._trust_video_mute_state_=!1,h._trust_audio_stream_added_state_=!1,h._trust_video_stream_added_state_=!1,h._is_pre_created||(h._audio_pre_subscribed||(h._audioSSRC=void 0,h._audioOrtc=void 0),h._video_pre_subscribed||(h._videoSSRC=void 0,h._videoOrtc=void 0,h._rtxSsrcId=void 0),h._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(e==="CONNECTED"){var u;this._streamFallbackTypeCacheMap.forEach((h,p)=>{this._gateway.setStreamFallbackOption(p,h).catch(_=>{k.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),_)})}),this._remoteStreamTypeCacheMap.forEach((h,p)=>{this._gateway.setRemoteVideoStreamType(p,h).catch(_=>{k.warning("[".concat(this._clientId,"] auto set remote stream type failed"),_)})}),this._remoteDefaultVideoStreamType!==void 0&&((u=this._joinInfo)===null||u===void 0?void 0:u.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{k.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(h=>{k.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(h))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(h=>!h._trust_in_room_).forEach(h=>{k.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(h.uid)),this._handleUserOffline({uid:h.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(h=>{h._trust_audio_mute_state_||(k.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(h.uid)),this._handleMuteStream(h.uid,ot.AUDIO,!1)),h._trust_video_mute_state_||(k.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(h.uid)),this._handleMuteStream(h.uid,ot.VIDEO,!1)),h._trust_audio_enabled_state_||(k.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(h.uid)),this._handleSetStreamLocalEnable("audio",h.uid,!0)),h._trust_video_enabled_state_||(k.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(h.uid)),this._handleSetStreamLocalEnable("video",h.uid,!0)),h._trust_video_stream_added_state_||(k.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(h.uid)),this._handleResetAddStream(h,"video")),h._trust_audio_stream_added_state_||(k.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(h.uid)),this._handleResetAddStream(h,"audio")),h._video_added_||h._audio_added_||(k.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(h.uid)),this._handleRemoveStream({uid:h.uid,uint_id:h._uintid}))}))},1e3))}c()}),this._gateway.on(ji.REQUEST_NEW_GATEWAY_LIST,async(e,n)=>{if(!this._joinInfo)return n(new be(Y.UNEXPECTED_ERROR,"can not recover, no join info"));try{let i;const s=await D8(Hl(Hl({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));s?(i=s.ap,M8(s),this._joinInfo.preload=!0):(i=await $L(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||pi,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=i.gatewayInfo.res,this._joinInfo.gatewayAddrs=i.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=i.gatewayInfo.uni_lbs_ip);const c=[];i.gatewayInfo.gatewayAddrs.forEach(u=>{let{address:h}=u;const[p,_]=h.split(":");this._joinInfo&&this._joinInfo.proxyServer?c.push({proxy:this._joinInfo.proxyServer,host:p,port:_}):c.push({host:p,port:_})}),e(c)}catch(i){n(i)}}),this._gateway.on(ji.NETWORK_QUALITY,e=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(on.NETWORK_QUALITY,e)}),this._gateway.on(ji.STREAM_TYPE_CHANGE,(e,n)=>{this.safeEmit(on.STREAM_TYPE_CHANGED,e,n),pt.reportApiInvoke(this._sessionId,{name:fi.STREAM_TYPE_CHANGE,options:[e,n],tag:Dr.TRACER}).onSuccess(JSON.stringify({uid:e,streamType:n}))}),this._gateway.on(ji.IS_P2P_DISCONNECTED,e=>{this._p2pChannel.isP2PDisconnected()?e(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?e(!1):e(!0)}),this._gateway.on(ji.REQUEST_P2P_CONNECTION_PARAMS,async(e,n,i)=>{try{let s=await this._p2pChannel.getEstablishParams();Z("ENABLE_PREALLOC_PC")&&s||(s=await this._p2pChannel.startP2PConnection(e)),n(s)}catch(s){i(s)}}),this._gateway.on(ji.JOIN_RESPONSE,(e,n)=>{if(this.store.useP2P)return;let i;e.attributes?i=e.attributes.userAttributes.preSubSsrcs:k.debug("no attributes in joinResponse");const s=Nz(e.ortc,n,i);this._p2pChannel.connect(s)}),this._gateway.on(ji.PRE_CONNECT_PC,async e=>{const{candidates:n,fingerprint:i}=e;if(this._joinInfo&&n.length>0&&!this._p2pChannel.isPlanB){var s;await this._p2pChannel.startP2PConnection({turnServer:this._joinInfo.turnServer});const{cert:c,cid:u}=this._joinInfo.apResponse;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(u,"_").concat(c),icePwd:"".concat(u,"_").concat(c)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(s=Z("FINGERPRINT"))!==null&&s!==void 0?s:i}]},candidates:n,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}})}_handleGatewaySignalEvents(){this._gateway.signal.on(an.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(an.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(an.ON_ADD_AUDIO_STREAM,e=>this._handleAddAudioOrVideoStream("audio",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc)),this._gateway.signal.on(an.ON_ADD_VIDEO_STREAM,e=>this._handleAddAudioOrVideoStream("video",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc,e.rtxSsrcId)),this._gateway.signal.on(an.ON_REMOTE_DATASTREAM_UPDATE,e=>{this._handleUpdateDataChannel(e)}),this._gateway.signal.on(an.ON_REMOTE_FULL_DATASTREAM_INFO,e=>{this._handleUpdateDataChannel({added:e.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(an.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(an.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(an.MUTE_AUDIO,e=>this._handleMuteStream(e.uid,ot.AUDIO,!0)),this._gateway.signal.on(an.UNMUTE_AUDIO,e=>this._handleMuteStream(e.uid,ot.AUDIO,!1)),this._gateway.signal.on(an.MUTE_VIDEO,e=>this._handleMuteStream(e.uid,ot.VIDEO,!0)),this._gateway.signal.on(an.UNMUTE_VIDEO,e=>this._handleMuteStream(e.uid,ot.VIDEO,!1)),this._gateway.signal.on(an.RECEIVE_METADATA,e=>{const n=qg(e.metadata);this.safeEmit(on.RECEIVE_METADATA,e.uid,n)}),this._gateway.signal.on(an.ON_DATA_STREAM,async e=>{var n;if(!e)return;let i=qg(e.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&$e(n=["aes-128-gcm2","aes-256-gcm2"]).call(n,this._encryptionMode)){if(e.payload.length<xE)throw new be(Y.UNEXPECTED_RESPONSE,"payload length ".concat(e.payload.length," is less than header length ").concat(xE));i=await async function(u,h,p){const _=p.subarray(0,xE),E=_.slice(8,xE),S=(E[0]<<8)+E[1],w=(_[6]<<8)+_[7],I=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:u,tagLength:G6,additionalData:new Uint8Array(P6(S,2))},h,p.subarray(xE));return new Uint8Array(I).subarray(0,w)}(this._encryptDataStreamIv,this._encryptDataStreamKey,i)}let s=0;if(e.ordered||e.syncWithAudio){const c=this._p2pChannel.getStats(),u=this.remoteUsers.find(p=>p.uid===e.uid),h=c==null?void 0:c.audioRecv.find(p=>p.ssrc===(u==null?void 0:u._audioSSRC));s=h==null?void 0:h.jitterBufferMs}(s==null||Number.isNaN(s))&&(s=0),Efe(Hl(Hl({},e),{},{payload:i}),s,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(an.ON_CRYPT_ERROR,()=>{Bp(()=>{k.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(on.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(an.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(an.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{k.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,Mn.TOKEN_EXPIRE),this.safeEmit(on.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(an.ON_STREAM_FALLBACK_UPDATE,e=>{k.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(e.stream_id,", attr: ").concat(e.stream_type)),this.safeEmit(on.STREAM_FALLBACK,e.stream_id,e.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(an.ON_PUBLISH_STREAM,e=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:e.proxy})),k.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(e))))}),this._gateway.signal.on(an.ENABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!0)}),this._gateway.signal.on(an.DISABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!1)}),this._gateway.signal.on(xt.REQUEST_TIMEOUT,(e,n)=>{if(this._joinInfo)switch(e){case kt.PUBLISH:{if(!n)return;const c=n.ortc;if(c){var i,s;const u=c.some(_=>{let{stream_type:E}=_;return E===Bn.Audio}),h=c.some(_=>{let{stream_type:E}=_;return E!==Bn.Audio}),p=c.some(_=>{let{stream_type:E}=_;return E===Bn.Screen||E===Bn.ScreenLow});n.state==="offer"&&pt.publish(this._joinInfo.sid,{eventElapse:Ro.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:Y.TIMEOUT,audio:u,video:h,p2pid:n.p2p_id,publishRequestid:this.store.pubId,screenshare:p,audioName:u?(i=c.find(_=>{let{stream_type:E}=_;return E===Bn.Audio}))===null||i===void 0||(i=i.ssrcs[0])===null||i===void 0?void 0:i.ssrcId.toString():void 0,videoName:h?(s=c.find(_=>{let{stream_type:E}=_;return E!==Bn.Audio}))===null||s===void 0||(s=s.ssrcs[0])===null||s===void 0?void 0:s.ssrcId.toString():void 0})}break}case kt.SUBSCRIBE:n&&pt.subscribe(this._joinInfo.sid,{succ:!1,ec:Y.TIMEOUT,audio:n.stream_type===ot.AUDIO,video:n.stream_type===ot.VIDEO,peerid:n.stream_id,subscribeRequestid:n.ssrcId,p2pid:this.store.p2pId,eventElapse:Ro.measureFromSubscribeStart(this.store.clientId,n.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(n.ssrcId)})}}),this._gateway.signal.on(an.ON_P2P_OK,e=>{this.uid,this._uid}),this._gateway.signal.on(an.ON_PUBLISHED_USER_LIST,e=>{if(e==null||!e.users)return;Z("BLOCK_LOCAL_CLIENT")&&(e.users=e.users.filter(s=>!r_(s.string_id||s.stream_id,this.channelName)));const n=[],i=[];for(const s of e.users){let c=this._users.find(S=>S._uintid===s.stream_id);c?c._trust_in_room_=!0:(c=new Xp(s.string_id||s.stream_id,s.stream_id),this._users.push(c),this.getListeners(on.PUBLISHED_USER_LIST).length===0&&(k.debug("[".concat(this._clientId,"] user online"),s.stream_id),this.safeEmit(on.USER_JOINED,c)));const u=ki.Audio&s.stream_type,h=(ki.Video|ki.LwoVideo)&s.stream_type,p=(65280&s.stream_type)!=0,_=u&&c.hasAudio,E=h&&c.hasVideo;h&&(c._trust_video_stream_added_state_=!0,c._video_added_=!0,c._videoSSRC=s.video_ssrc,c._rtxSsrcId=s.video_rtx),u&&(c._trust_audio_stream_added_state_=!0,c._audio_added_=!0,c._audioSSRC=s.audio_ssrc),u&&!_&&this.getListeners(on.PUBLISHED_USER_LIST).length===0&&(k.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published audio")),this.safeEmit(on.USER_PUBLISHED,c,"audio")),h&&!E&&this.getListeners(on.PUBLISHED_USER_LIST).length===0&&(k.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published video")),this.safeEmit(on.USER_PUBLISHED,c,"video")),(u&&!_||h&&!E||p)&&n.push(c),h&&this._p2pChannel.hasPendingRemoteMedia(c,"video")&&i.push({user:c,mediaType:"video"}),u&&this._p2pChannel.hasPendingRemoteMedia(c,"audio")&&i.push({user:c,mediaType:"audio"})}i.length>0&&(k.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(i.map(s=>"user: ".concat(s.user.uid,", mediaType: ").concat(s.mediaType)).join("; ")," ")),this.massSubscribe(i).catch(s=>{k.error("[".concat(this._clientId,"] mass resubscribe error"),s.toString())})),this.getListeners(on.PUBLISHED_USER_LIST).length>0?Z("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=n:(k.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(n.map(s=>s.uid).join(", "))),this.safeEmit(on.PUBLISHED_USER_LIST,n)):k.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(n.map(s=>s.uid).join(", ")))}),this._gateway.signal.on(an.ON_RTP_CAPABILITY_CHANGE,e=>{const{video_codec:n}=e;this._p2pChannel instanceof N0&&this._p2pChannel.updateRemoteRTPCapabilities(n.map(i=>i.toLowerCase()).filter(i=>{var s;return $e(s=Object.keys(qI)).call(s,i)}))})}_handleP2PEvents(){this._gateway.signal.on(an.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(Jr.PUBLISH,(e,n,i)=>{const{uid:s}=e;e.forEach(c=>{const{kind:u,ssrcs:h,mid:p,isMuted:_}=c;this._handleP2PAddAudioOrVideoStream(u,s,h[0].ssrcId,p);const E=this._users.find(S=>S.uid===s);return E&&this.store.useP2P?this._p2pChannel.mockSubscribe(E,u,h[0].ssrcId,p).then(()=>{n()}).catch(i):n(),this._handleMuteStream(s,u,!!_)})}),this._gateway.signal.on(Jr.CALL,async(e,n,i)=>{if(this.store.useP2P)try{var s;n(await this._p2pChannel.startP2P({turnServer:(s=this._joinInfo)===null||s===void 0?void 0:s.turnServer},e))}catch(c){i(c)}}),this._gateway.signal.on(xt.P2P_CONNECTION,async e=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(e)}),this._gateway.signal.on(Jr.UNPUBLISH,async(e,n,i)=>{if(this.store.useP2P){const{unpubMsg:s,uid:c}=e,u=this._users.find(h=>h.uid===c);if(!u)return k.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(c)),void n();try{s.forEach(async h=>{let{stream_type:p}=h;const _=p===Bn.Audio?ot.AUDIO:ot.VIDEO;await this._p2pChannel.unsubscribe(u,_),this._handleMuteStream(c,_,!0)}),n()}catch(h){i(h)}}}),this._gateway.signal.on(Jr.CONTROL,async(e,n)=>{const{action:i}=e;switch(i){case Hp.MUTE_LOCAL_VIDEO:this._handleMuteStream(n,ot.VIDEO,!0);break;case Hp.MUTE_LOCAL_AUDIO:this._handleMuteStream(n,ot.AUDIO,!0);break;case Hp.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",n),this._handleMuteStream(n,ot.VIDEO,!1);break;case Hp.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",n),this._handleMuteStream(n,ot.AUDIO,!1)}}),this._gateway.signal.on(Jr.RESTART_ICE,async(e,n,i)=>{if(this.store.useP2P)try{const{direction:s,iceParameter:c}=e;s!==ds.SEND_ONLY||c?n(await this._p2pChannel.restartICE(s,c)):(this._p2pChannel.handleDisconnect(s),n())}catch(s){i(s)}}),this._gateway.signal.on(Jr.CANDIDATE,e=>{if(this.store.useP2P){const{candidate:n,direction:i}=e;this._p2pChannel.addRemoteCandidate(n,i)}}),this._p2pChannel.on(Rt.RequestP2PRestartICE,async(e,n,i)=>{try{const{direction:s}=e;n(await this._gateway.sendExtensionMessage(Jr.RESTART_ICE,e,s===ds.SEND_ONLY))}catch(s){i(s)}}),this._p2pChannel.on(Rt.LocalCandidate,e=>{this._gateway.sendExtensionMessage(Jr.CANDIDATE,JSON.stringify(e),!0)}),this._p2pChannel.on(Rt.RequestP2PMuteLocal,async(e,n,i)=>{try{await this._gateway.sendExtensionMessage(Jr.CONTROL,e,!0),n()}catch(s){i(s)}}),this._p2pChannel.on(Rt.RequestP2PUnmuteRemote,async(e,n,i)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),n()}catch(s){s.code===Y.DISCONNECT_P2P?n():i(s)}else n()}),this._p2pChannel.on(Rt.RequestP2PMuteRemote,async(e,n,i)=>{if(this._joinInfo)try{await this._gateway.muteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),n()}catch(s){s.code===Y.DISCONNECT_P2P?n():i(s)}else n()}),this._p2pChannel.on(Rt.StateChange,(e,n)=>{n===Un.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(Rt.PeerConnectionStateChange,e=>{const n=this._peerConnectionState;e!==n&&(this.safeEmit(on.PEERCONNECTION_STATE_CHANGE,e,n),this._peerConnectionState=e)}),this._p2pChannel.on(Rt.RequestMuteLocal,async(e,n,i)=>{if(this._joinInfo)try{await this._gateway.muteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),n()}catch(s){s.code===Y.DISCONNECT_P2P?n():i(s)}else n()}),this._p2pChannel.on(Rt.RequestUnmuteLocal,async(e,n,i)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),n()}catch(s){s.code===Y.DISCONNECT_P2P?n():i(s)}else n()}),this._p2pChannel.on(Rt.RequestRePublish,(e,n,i)=>{this.publish(e,!1).then(n).catch(i)}),this._p2pChannel.on(Rt.RequestRePublishDataChannel,(e,n,i)=>{Qe.all(e.map(async s=>{const c=await this._p2pChannel.publishDataChannel([s]);try{c.forEach(u=>{this._uid&&this._gateway.publishDataChannel(this._uid,u,!0)})}catch(u){if(u.code!==Y.DISCONNECT_P2P)throw u}})).then(n).catch(i)}),this._p2pChannel.on(Rt.RequestReSubscribe,async(e,n,i)=>{try{for(const{user:s,kind:c}of e)c===ot.VIDEO?await this.subscribe(s,"video"):await this.subscribe(s,"audio");n()}catch(s){i(s)}}),this._p2pChannel.on(Rt.RequestUpload,(e,n)=>{this._gateway.upload(e,n)}),this._p2pChannel.on(Rt.RequestUploadStats,e=>{this._gateway.uploadWRTCStats(e)}),this._p2pChannel.on(Rt.MediaReconnectStart,e=>{this.safeEmit(on.MEDIA_RECONNECT_START,e)}),this._p2pChannel.on(Rt.MediaReconnectEnd,e=>{this.safeEmit(on.MEDIA_RECONNECT_END,e)}),this._p2pChannel.on(Rt.NeedSignalRTT,e=>{e(this._gateway.getSignalRTT())}),this._p2pChannel.on(Rt.RequestRestartICE,async e=>{if(this.store.useP2P)return;const n=await this._p2pChannel.restartICE(e),i=await n.next();if(i.done)return;const s=i.value;let c;try{c=await this._gateway.restartICE({iceParameters:s})}catch(h){return void n.throw(h)}const{iceParameters:u}=function(h){const p=h.iceParameters;return{iceParameters:{iceUfrag:p.iceUfrag,icePwd:p.icePwd}}}(c);await n.next({remoteIceParameters:u})}),this._p2pChannel.on(Rt.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(Rt.RequestReconnectPC,async()=>{var e;const{iceParameters:n,dtlsParameters:i,rtpCapabilities:s}=await this._p2pChannel.startP2PConnection({turnServer:(e=this._joinInfo)===null||e===void 0?void 0:e.turnServer}),{gatewayEstablishParams:c,gatewayAddress:u}=await this._gateway.reconnectPC({iceParameters:n,dtlsParameters:i,rtpCapabilities:s}),h=Nz(c,u);await this._p2pChannel.connect(h),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(Rt.RequestUnpublishForReconnectPC,async(e,n,i)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(e,this._uid),n()):i()}),this._p2pChannel.on(Rt.P2PLost,()=>{this.safeEmit(on.P2P_LOST,this.store.uid)}),this._p2pChannel.on(Rt.UpdateVideoEncoder,e=>{e._encoderConfig&&this._gateway.setVideoProfile(e._encoderConfig)}),this._p2pChannel.on(Rt.ConnectionTypeChange,e=>{this.safeEmit(on.IS_USING_CLOUD_PROXY,e)}),this._p2pChannel.on(Rt.RequestLowStreamParameter,e=>{e(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(Rt.QueryClientConnectionState,e=>{e(this.connectionState)}),this._p2pChannel.on(Rt.AudioMetadata,e=>{this.safeEmit(on.AUDIO_METADATA,e)})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(e){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new be(Y.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new be(Y.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{const i=(n={config:e},Ef("ContentInspect").create(n));this._inspect=i,this.handleVideoInspectEvents(i);const{appId:s,cname:c,sid:u,token:h,uid:p,cid:_,vid:E}=this._joinInfo;await i.init({appId:s,areaCode:"",cname:c,sid:u,token:h,uid:p,cid:_,vid:E?Number(E):0},pi)}catch(i){throw Array.isArray(i)?i[0]:i}var n}handleVideoInspectEvents(e){e.on(Bi.CONNECTION_STATE_CHANGE,(n,i)=>{if(this.safeEmit(on.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,n,i),i===Bl.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(on.CONTENT_INSPECT_ERROR,new be(Y.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}}),e.on(Bi.INSPECT_RESULT,(n,i)=>{var s;if((i==null?void 0:i.code)===Y.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return k.debug("Stop inspect content because that has left channel"),this==null||(s=this._inspect)===null||s===void 0||s.close(),void(this._inspect=void 0);this.safeEmit(on.CONTENT_INSPECT_RESULT,n,i)}),e.on(Bi.CLIENT_LOCAL_VIDEO_TRACK,n=>{n(this.localTracks.filter(i=>i.trackMediaType==="video")[0])})}async disableContentInspect(){if(!this._inspect)throw new be(Y.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}async setImageModeration(e,n){if(hf(e,"enabled"),e){if(!n)throw new be(Y.INVALID_PARAMS,"config is required");if(Y8(n),!this._joinInfo)throw new be(Y.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(n);else{const s=(i={config:n},Ef("ImageModeration").create(i));this._moderation=s,this.handleImageModerationEvents(s);const{appId:c,cname:u,sid:h,token:p,uid:_,cid:E,vid:S}=this._joinInfo;await s.init({appId:c,areaCode:"",cname:u,sid:h,token:p,uid:_,cid:E,vid:S?Number(S):0},pi)}}catch(s){throw Array.isArray(s)?s[0]:s}}else{var i;if(!this._moderation)throw new be(Y.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(s){throw Array.isArray(s)?s[0]:s}}}handleImageModerationEvents(e){e.on(Hu.CONNECTION_STATE_CHANGE,(n,i)=>{if(this.safeEmit(on.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,n,i),n===rl.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new be(Y.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");e.inspectImage()}}),e.on(Hu.CLIENT_LOCAL_VIDEO_TRACK,n=>{n(this.localTracks.filter(i=>i.trackMediaType==="video")[0])})}setP2PTransport(e){if(function(n){bi(n,"transport",["default","auto","relay","sd-rtn"])}(e),this.mode!=="p2p")throw new be(Y.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=e,k.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(e))}getJoinChannelServiceRecords(){return k.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(e){hf(e,"enabled"),Kn("ENABLE_PUBLISH_AUDIO_FILTER",e),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(e)}_handleResetAddStream(e,n){switch(n){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}}},ut(tt.prototype,"leave",[X8],Object.getOwnPropertyDescriptor(tt.prototype,"leave"),tt.prototype),ut(tt.prototype,"publish",[J8],Object.getOwnPropertyDescriptor(tt.prototype,"publish"),tt.prototype),ut(tt.prototype,"unpublish",[Q8],Object.getOwnPropertyDescriptor(tt.prototype,"unpublish"),tt.prototype),ut(tt.prototype,"subscribe",[Z8],Object.getOwnPropertyDescriptor(tt.prototype,"subscribe"),tt.prototype),ut(tt.prototype,"presubscribe",[eH],Object.getOwnPropertyDescriptor(tt.prototype,"presubscribe"),tt.prototype),ut(tt.prototype,"massSubscribe",[tH],Object.getOwnPropertyDescriptor(tt.prototype,"massSubscribe"),tt.prototype),ut(tt.prototype,"unsubscribe",[nH],Object.getOwnPropertyDescriptor(tt.prototype,"unsubscribe"),tt.prototype),ut(tt.prototype,"massUnsubscribe",[rH],Object.getOwnPropertyDescriptor(tt.prototype,"massUnsubscribe"),tt.prototype),ut(tt.prototype,"setLowStreamParameter",[iH],Object.getOwnPropertyDescriptor(tt.prototype,"setLowStreamParameter"),tt.prototype),ut(tt.prototype,"enableDualStream",[oH],Object.getOwnPropertyDescriptor(tt.prototype,"enableDualStream"),tt.prototype),ut(tt.prototype,"disableDualStream",[sH],Object.getOwnPropertyDescriptor(tt.prototype,"disableDualStream"),tt.prototype),ut(tt.prototype,"setClientRole",[aH],Object.getOwnPropertyDescriptor(tt.prototype,"setClientRole"),tt.prototype),ut(tt.prototype,"_setClientRoleOptions",[cH],Object.getOwnPropertyDescriptor(tt.prototype,"_setClientRoleOptions"),tt.prototype),ut(tt.prototype,"setProxyServer",[lH],Object.getOwnPropertyDescriptor(tt.prototype,"setProxyServer"),tt.prototype),ut(tt.prototype,"setTurnServer",[uH],Object.getOwnPropertyDescriptor(tt.prototype,"setTurnServer"),tt.prototype),ut(tt.prototype,"setLicense",[dH],Object.getOwnPropertyDescriptor(tt.prototype,"setLicense"),tt.prototype),ut(tt.prototype,"startProxyServer",[hH],Object.getOwnPropertyDescriptor(tt.prototype,"startProxyServer"),tt.prototype),ut(tt.prototype,"stopProxyServer",[fH],Object.getOwnPropertyDescriptor(tt.prototype,"stopProxyServer"),tt.prototype),ut(tt.prototype,"setLocalAccessPointsV2",[pH],Object.getOwnPropertyDescriptor(tt.prototype,"setLocalAccessPointsV2"),tt.prototype),ut(tt.prototype,"setLocalAccessPoints",[mH],Object.getOwnPropertyDescriptor(tt.prototype,"setLocalAccessPoints"),tt.prototype),ut(tt.prototype,"setRemoteDefaultVideoStreamType",[gH],Object.getOwnPropertyDescriptor(tt.prototype,"setRemoteDefaultVideoStreamType"),tt.prototype),ut(tt.prototype,"setRemoteVideoStreamType",[_H],Object.getOwnPropertyDescriptor(tt.prototype,"setRemoteVideoStreamType"),tt.prototype),ut(tt.prototype,"setStreamFallbackOption",[vH],Object.getOwnPropertyDescriptor(tt.prototype,"setStreamFallbackOption"),tt.prototype),ut(tt.prototype,"setEncryptionConfig",[EH],Object.getOwnPropertyDescriptor(tt.prototype,"setEncryptionConfig"),tt.prototype),ut(tt.prototype,"renewToken",[yH],Object.getOwnPropertyDescriptor(tt.prototype,"renewToken"),tt.prototype),ut(tt.prototype,"enableAudioVolumeIndicator",[SH],Object.getOwnPropertyDescriptor(tt.prototype,"enableAudioVolumeIndicator"),tt.prototype),ut(tt.prototype,"startLiveStreaming",[TH],Object.getOwnPropertyDescriptor(tt.prototype,"startLiveStreaming"),tt.prototype),ut(tt.prototype,"setLiveTranscoding",[bH],Object.getOwnPropertyDescriptor(tt.prototype,"setLiveTranscoding"),tt.prototype),ut(tt.prototype,"stopLiveStreaming",[wH],Object.getOwnPropertyDescriptor(tt.prototype,"stopLiveStreaming"),tt.prototype),ut(tt.prototype,"startChannelMediaRelay",[RH],Object.getOwnPropertyDescriptor(tt.prototype,"startChannelMediaRelay"),tt.prototype),ut(tt.prototype,"updateChannelMediaRelay",[CH],Object.getOwnPropertyDescriptor(tt.prototype,"updateChannelMediaRelay"),tt.prototype),ut(tt.prototype,"stopChannelMediaRelay",[IH],Object.getOwnPropertyDescriptor(tt.prototype,"stopChannelMediaRelay"),tt.prototype),ut(tt.prototype,"sendCustomReportMessage",[AH],Object.getOwnPropertyDescriptor(tt.prototype,"sendCustomReportMessage"),tt.prototype),ut(tt.prototype,"pickSVCLayer",[OH],Object.getOwnPropertyDescriptor(tt.prototype,"pickSVCLayer"),tt.prototype),ut(tt.prototype,"setRTMConfig",[PH],Object.getOwnPropertyDescriptor(tt.prototype,"setRTMConfig"),tt.prototype),ut(tt.prototype,"enableContentInspect",[NH],Object.getOwnPropertyDescriptor(tt.prototype,"enableContentInspect"),tt.prototype),ut(tt.prototype,"disableContentInspect",[kH],Object.getOwnPropertyDescriptor(tt.prototype,"disableContentInspect"),tt.prototype),ut(tt.prototype,"setImageModeration",[DH],Object.getOwnPropertyDescriptor(tt.prototype,"setImageModeration"),tt.prototype),ut(tt.prototype,"setP2PTransport",[LH],Object.getOwnPropertyDescriptor(tt.prototype,"setP2PTransport"),tt.prototype),ut(tt.prototype,"getJoinChannelServiceRecords",[xH],Object.getOwnPropertyDescriptor(tt.prototype,"getJoinChannelServiceRecords"),tt.prototype),ut(tt.prototype,"setPublishAudioFilterEnabled",[MH],Object.getOwnPropertyDescriptor(tt.prototype,"setPublishAudioFilterEnabled"),tt.prototype),tt);class L0{constructor(n,i){K(this,"id",0),K(this,"element",void 0),K(this,"peerPair",void 0),K(this,"context",void 0),K(this,"audioPlayerElement",void 0),K(this,"audioTrack",void 0),L0.count+=1,this.id=L0.count,this.element=n,this.context=i}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=n=>{const i=document.createElement("audio");i.srcObject=new MediaStream([n.track]),i.play(),this.audioPlayerElement=i}}async switchSdp(){if(!this.peerPair)return;const n=async(s,c)=>{const u=c==="offer"?await s.createOffer():await s.createAnswer();return await s.setLocalDescription(u),s.iceGatheringState==="complete"?s.localDescription:new Qe(h=>{s.onicegatheringstatechange=()=>{s.iceGatheringState==="complete"&&h(s.localDescription)}})},i=async(s,c)=>await s.setRemoteDescription(c);try{const s=await n(this.peerPair[0],"offer");await i(this.peerPair[1],s);const c=await n(this.peerPair[1],"answer");await i(this.peerPair[0],c)}catch(s){throw new be(Y.LOCAL_AEC_ERROR,s.toString()).print()}}async getTracksFromMediaElement(n){if(this.audioTrack)return this.audioTrack;let i;try{n instanceof HTMLVideoElement&&(n.captureStream?n.captureStream():n.mozCaptureStream()),i=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(n).connect(i)}catch(c){throw new be(Y.LOCAL_AEC_ERROR,c.toString()).print()}if(!i)throw new be(Y.LOCAL_AEC_ERROR,"no dest node when local aec").print();const s=i.stream.getAudioTracks()[0];return this.audioTrack=s,s}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const n=this.element,i=await this.getTracksFromMediaElement(n);this.peerPair&&this.peerPair[0].addTrack(i),await this.switchSdp()}close(){k.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(n=>{n.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var VH,jA;K(L0,"count",0);const Mfe=window.AudioContext||window.webkitAudioContext,Ufe=new(VH=Ot({report:pt}),ut((jA=class{constructor(){K(this,"units",[]),K(this,"context",void 0)}processExternalMediaAEC(e){if(!this._doesEnvironmentNeedAEC())return k.debug("the system does not need to process local aec"),-1;this.context||(this.context=new Mfe);let n=this.units.find(i=>i&&i.getElement()===e);return n||(n=new L0(e,this.context),this.units.push(n)),n.startEchoCancellation(),k.debug("start processing local audio echo cancellation, id is",n.id),n.id}_doesEnvironmentNeedAEC(){return vn().name!==Nn.SAFARI}}).prototype,"processExternalMediaAEC",[VH],Object.getOwnPropertyDescriptor(jA.prototype,"processExternalMediaAEC"),jA.prototype),jA);function FH(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,s)}return i}function jH(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?FH(Object(i),!0).forEach(function(s){K(e,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):FH(Object(i)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(i,s))})}return e}const lx=window||document;function BH(e){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!lx)return;const i=mi._cspEventHandlerPointer;if(i&&n)return void console.error(i,n);const s=c=>{if(!(c&&c.blockedURI&&(mi.onSecurityPolicyViolation||mi.getListeners(Wd.SECURITY_POLICY_VIOLATION).length>0)))return;const u=c.blockedURI;Z("CSP_DETECTED_HOSTNAME_LIST").some(h=>$e(u).call(u,h))&&(mi.onSecurityPolicyViolation&&typeof mi.onSecurityPolicyViolation=="function"&&mi.onSecurityPolicyViolation(c),mi.getListeners(Wd.SECURITY_POLICY_VIOLATION).length>0&&mi.safeEmit(Wd.SECURITY_POLICY_VIOLATION,c))};i&&lx.removeEventListener("securitypolicyviolation",i),(n||e&&typeof e=="function"||mi.getListeners(Wd.SECURITY_POLICY_VIOLATION).length>0)&&lx.addEventListener("securitypolicyviolation",s),mi._cspEventHandlerPointer=s}var Vfe=N,Ffe=w5,WH=RegExp.prototype,jfe=function(e){return e===WH||Vfe(WH,e)?Ffe(e):e.flags},Jo=l(jfe);function cy(e){let n=e.length;for(;--n>=0;)e[n]=0}const ux=256,GH=286,x0=30,M0=15,dx=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),BA=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Bfe=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),zH=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Tf=new Array(576);cy(Tf);const U0=new Array(60);cy(U0);const V0=new Array(512);cy(V0);const F0=new Array(256);cy(F0);const hx=new Array(29);cy(hx);const WA=new Array(x0);function fx(e,n,i,s,c){this.static_tree=e,this.extra_bits=n,this.extra_base=i,this.elems=s,this.max_length=c,this.has_stree=e&&e.length}let HH,KH,$H;function px(e,n){this.dyn_tree=e,this.max_code=0,this.stat_desc=n}cy(WA);const qH=e=>e<256?V0[e]:V0[256+(e>>>7)],j0=(e,n)=>{e.pending_buf[e.pending++]=255&n,e.pending_buf[e.pending++]=n>>>8&255},Rc=(e,n,i)=>{e.bi_valid>16-i?(e.bi_buf|=n<<e.bi_valid&65535,j0(e,e.bi_buf),e.bi_buf=n>>16-e.bi_valid,e.bi_valid+=i-16):(e.bi_buf|=n<<e.bi_valid&65535,e.bi_valid+=i)},$d=(e,n,i)=>{Rc(e,i[2*n],i[2*n+1])},YH=(e,n)=>{let i=0;do i|=1&e,e>>>=1,i<<=1;while(--n>0);return i>>>1},XH=(e,n,i)=>{const s=new Array(16);let c,u,h=0;for(c=1;c<=M0;c++)h=h+i[c-1]<<1,s[c]=h;for(u=0;u<=n;u++){let p=e[2*u+1];p!==0&&(e[2*u]=YH(s[p]++,p))}},JH=e=>{let n;for(n=0;n<GH;n++)e.dyn_ltree[2*n]=0;for(n=0;n<x0;n++)e.dyn_dtree[2*n]=0;for(n=0;n<19;n++)e.bl_tree[2*n]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},QH=e=>{e.bi_valid>8?j0(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},ZH=(e,n,i,s)=>{const c=2*n,u=2*i;return e[c]<e[u]||e[c]===e[u]&&s[n]<=s[i]},mx=(e,n,i)=>{const s=e.heap[i];let c=i<<1;for(;c<=e.heap_len&&(c<e.heap_len&&ZH(n,e.heap[c+1],e.heap[c],e.depth)&&c++,!ZH(n,s,e.heap[c],e.depth));)e.heap[i]=e.heap[c],i=c,c<<=1;e.heap[i]=s},e9=(e,n,i)=>{let s,c,u,h,p=0;if(e.sym_next!==0)do s=255&e.pending_buf[e.sym_buf+p++],s+=(255&e.pending_buf[e.sym_buf+p++])<<8,c=e.pending_buf[e.sym_buf+p++],s===0?$d(e,c,n):(u=F0[c],$d(e,u+ux+1,n),h=dx[u],h!==0&&(c-=hx[u],Rc(e,c,h)),s--,u=qH(s),$d(e,u,i),h=BA[u],h!==0&&(s-=WA[u],Rc(e,s,h)));while(p<e.sym_next);$d(e,256,n)},gx=(e,n)=>{const i=n.dyn_tree,s=n.stat_desc.static_tree,c=n.stat_desc.has_stree,u=n.stat_desc.elems;let h,p,_,E=-1;for(e.heap_len=0,e.heap_max=573,h=0;h<u;h++)i[2*h]!==0?(e.heap[++e.heap_len]=E=h,e.depth[h]=0):i[2*h+1]=0;for(;e.heap_len<2;)_=e.heap[++e.heap_len]=E<2?++E:0,i[2*_]=1,e.depth[_]=0,e.opt_len--,c&&(e.static_len-=s[2*_+1]);for(n.max_code=E,h=e.heap_len>>1;h>=1;h--)mx(e,i,h);_=u;do h=e.heap[1],e.heap[1]=e.heap[e.heap_len--],mx(e,i,1),p=e.heap[1],e.heap[--e.heap_max]=h,e.heap[--e.heap_max]=p,i[2*_]=i[2*h]+i[2*p],e.depth[_]=(e.depth[h]>=e.depth[p]?e.depth[h]:e.depth[p])+1,i[2*h+1]=i[2*p+1]=_,e.heap[1]=_++,mx(e,i,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((S,w)=>{const I=w.dyn_tree,P=w.max_code,B=w.stat_desc.static_tree,M=w.stat_desc.has_stree,U=w.stat_desc.extra_bits,$=w.stat_desc.extra_base,q=w.stat_desc.max_length;let ce,me,ge,pe,Re,Ve,Ze=0;for(pe=0;pe<=M0;pe++)S.bl_count[pe]=0;for(I[2*S.heap[S.heap_max]+1]=0,ce=S.heap_max+1;ce<573;ce++)me=S.heap[ce],pe=I[2*I[2*me+1]+1]+1,pe>q&&(pe=q,Ze++),I[2*me+1]=pe,me>P||(S.bl_count[pe]++,Re=0,me>=$&&(Re=U[me-$]),Ve=I[2*me],S.opt_len+=Ve*(pe+Re),M&&(S.static_len+=Ve*(B[2*me+1]+Re)));if(Ze!==0){do{for(pe=q-1;S.bl_count[pe]===0;)pe--;S.bl_count[pe]--,S.bl_count[pe+1]+=2,S.bl_count[q]--,Ze-=2}while(Ze>0);for(pe=q;pe!==0;pe--)for(me=S.bl_count[pe];me!==0;)ge=S.heap[--ce],ge>P||(I[2*ge+1]!==pe&&(S.opt_len+=(pe-I[2*ge+1])*I[2*ge],I[2*ge+1]=pe),me--)}})(e,n),XH(i,E,e.bl_count)},t9=(e,n,i)=>{let s,c,u=-1,h=n[1],p=0,_=7,E=4;for(h===0&&(_=138,E=3),n[2*(i+1)+1]=65535,s=0;s<=i;s++)c=h,h=n[2*(s+1)+1],++p<_&&c===h||(p<E?e.bl_tree[2*c]+=p:c!==0?(c!==u&&e.bl_tree[2*c]++,e.bl_tree[32]++):p<=10?e.bl_tree[34]++:e.bl_tree[36]++,p=0,u=c,h===0?(_=138,E=3):c===h?(_=6,E=3):(_=7,E=4))},n9=(e,n,i)=>{let s,c,u=-1,h=n[1],p=0,_=7,E=4;for(h===0&&(_=138,E=3),s=0;s<=i;s++)if(c=h,h=n[2*(s+1)+1],!(++p<_&&c===h)){if(p<E)do $d(e,c,e.bl_tree);while(--p!=0);else c!==0?(c!==u&&($d(e,c,e.bl_tree),p--),$d(e,16,e.bl_tree),Rc(e,p-3,2)):p<=10?($d(e,17,e.bl_tree),Rc(e,p-3,3)):($d(e,18,e.bl_tree),Rc(e,p-11,7));p=0,u=c,h===0?(_=138,E=3):c===h?(_=6,E=3):(_=7,E=4)}};let r9=!1;const i9=(e,n,i,s)=>{Rc(e,0+(s?1:0),3),QH(e),j0(e,i),j0(e,~i),i&&e.pending_buf.set(e.window.subarray(n,n+i),e.pending),e.pending+=i};var Wfe=e=>{r9||((()=>{let n,i,s,c,u;const h=new Array(16);for(s=0,c=0;c<28;c++)for(hx[c]=s,n=0;n<1<<dx[c];n++)F0[s++]=c;for(F0[s-1]=c,u=0,c=0;c<16;c++)for(WA[c]=u,n=0;n<1<<BA[c];n++)V0[u++]=c;for(u>>=7;c<x0;c++)for(WA[c]=u<<7,n=0;n<1<<BA[c]-7;n++)V0[256+u++]=c;for(i=0;i<=M0;i++)h[i]=0;for(n=0;n<=143;)Tf[2*n+1]=8,n++,h[8]++;for(;n<=255;)Tf[2*n+1]=9,n++,h[9]++;for(;n<=279;)Tf[2*n+1]=7,n++,h[7]++;for(;n<=287;)Tf[2*n+1]=8,n++,h[8]++;for(XH(Tf,287,h),n=0;n<x0;n++)U0[2*n+1]=5,U0[2*n]=YH(n,5);HH=new fx(Tf,dx,257,GH,M0),KH=new fx(U0,BA,0,x0,M0),$H=new fx(new Array(0),Bfe,0,19,7)})(),r9=!0),e.l_desc=new px(e.dyn_ltree,HH),e.d_desc=new px(e.dyn_dtree,KH),e.bl_desc=new px(e.bl_tree,$H),e.bi_buf=0,e.bi_valid=0,JH(e)},Gfe=(e,n,i,s)=>{let c,u,h=0;e.level>0?(e.strm.data_type===2&&(e.strm.data_type=(p=>{let _,E=4093624447;for(_=0;_<=31;_++,E>>>=1)if(1&E&&p.dyn_ltree[2*_]!==0)return 0;if(p.dyn_ltree[18]!==0||p.dyn_ltree[20]!==0||p.dyn_ltree[26]!==0)return 1;for(_=32;_<ux;_++)if(p.dyn_ltree[2*_]!==0)return 1;return 0})(e)),gx(e,e.l_desc),gx(e,e.d_desc),h=(p=>{let _;for(t9(p,p.dyn_ltree,p.l_desc.max_code),t9(p,p.dyn_dtree,p.d_desc.max_code),gx(p,p.bl_desc),_=18;_>=3&&p.bl_tree[2*zH[_]+1]===0;_--);return p.opt_len+=3*(_+1)+5+5+4,_})(e),c=e.opt_len+3+7>>>3,u=e.static_len+3+7>>>3,u<=c&&(c=u)):c=u=i+5,i+4<=c&&n!==-1?i9(e,n,i,s):e.strategy===4||u===c?(Rc(e,2+(s?1:0),3),e9(e,Tf,U0)):(Rc(e,4+(s?1:0),3),((p,_,E,S)=>{let w;for(Rc(p,_-257,5),Rc(p,E-1,5),Rc(p,S-4,4),w=0;w<S;w++)Rc(p,p.bl_tree[2*zH[w]+1],3);n9(p,p.dyn_ltree,_-1),n9(p,p.dyn_dtree,E-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,h+1),e9(e,e.dyn_ltree,e.dyn_dtree)),JH(e),s&&QH(e)},zfe=(e,n,i)=>(e.pending_buf[e.sym_buf+e.sym_next++]=n,e.pending_buf[e.sym_buf+e.sym_next++]=n>>8,e.pending_buf[e.sym_buf+e.sym_next++]=i,n===0?e.dyn_ltree[2*i]++:(e.matches++,n--,e.dyn_ltree[2*(F0[i]+ux+1)]++,e.dyn_dtree[2*qH(n)]++),e.sym_next===e.sym_end),Hfe=e=>{Rc(e,2,3),$d(e,256,Tf),(n=>{n.bi_valid===16?(j0(n,n.bi_buf),n.bi_buf=0,n.bi_valid=0):n.bi_valid>=8&&(n.pending_buf[n.pending++]=255&n.bi_buf,n.bi_buf>>=8,n.bi_valid-=8)})(e)},Kfe={_tr_init:Wfe,_tr_stored_block:i9,_tr_flush_block:Gfe,_tr_tally:zfe,_tr_align:Hfe},B0=(e,n,i,s)=>{let c=65535&e|0,u=e>>>16&65535|0,h=0;for(;i!==0;){h=i>2e3?2e3:i,i-=h;do c=c+n[s++]|0,u=u+c|0;while(--h);c%=65521,u%=65521}return c|u<<16|0};const $fe=new Uint32Array((()=>{let e,n=[];for(var i=0;i<256;i++){e=i;for(var s=0;s<8;s++)e=1&e?3988292384^e>>>1:e>>>1;n[i]=e}return n})());var fs=(e,n,i,s)=>{const c=$fe,u=s+i;e^=-1;for(let h=s;h<u;h++)e=e>>>8^c[255&(e^n[h])];return-1^e},h_={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},GA={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:qfe,_tr_stored_block:_x,_tr_flush_block:Yfe,_tr_tally:em,_tr_align:Xfe}=Kfe,{Z_NO_FLUSH:tm,Z_PARTIAL_FLUSH:Jfe,Z_FULL_FLUSH:Qfe,Z_FINISH:Kl,Z_BLOCK:o9,Z_OK:Fs,Z_STREAM_END:s9,Z_STREAM_ERROR:qd,Z_DATA_ERROR:Zfe,Z_BUF_ERROR:vx,Z_DEFAULT_COMPRESSION:epe,Z_FILTERED:tpe,Z_HUFFMAN_ONLY:zA,Z_RLE:npe,Z_FIXED:rpe,Z_DEFAULT_STRATEGY:ipe,Z_UNKNOWN:ope,Z_DEFLATED:HA}=GA,Ex=286,spe=30,ape=19,cpe=2*Ex+1,lpe=15,f_=258,Yd=262,ly=42,p_=113,W0=666,m_=(e,n)=>(e.msg=h_[n],n),a9=e=>2*e-(e>4?9:0),nm=e=>{let n=e.length;for(;--n>=0;)e[n]=0},upe=e=>{let n,i,s,c=e.w_size;n=e.hash_size,s=n;do i=e.head[--s],e.head[s]=i>=c?i-c:0;while(--n);n=c,s=n;do i=e.prev[--s],e.prev[s]=i>=c?i-c:0;while(--n)};let rm=(e,n,i)=>(n<<e.hash_shift^i)&e.hash_mask;const ol=e=>{const n=e.state;let i=n.pending;i>e.avail_out&&(i=e.avail_out),i!==0&&(e.output.set(n.pending_buf.subarray(n.pending_out,n.pending_out+i),e.next_out),e.next_out+=i,n.pending_out+=i,e.total_out+=i,e.avail_out-=i,n.pending-=i,n.pending===0&&(n.pending_out=0))},sl=(e,n)=>{Yfe(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,n),e.block_start=e.strstart,ol(e.strm)},zr=(e,n)=>{e.pending_buf[e.pending++]=n},G0=(e,n)=>{e.pending_buf[e.pending++]=n>>>8&255,e.pending_buf[e.pending++]=255&n},yx=(e,n,i,s)=>{let c=e.avail_in;return c>s&&(c=s),c===0?0:(e.avail_in-=c,n.set(e.input.subarray(e.next_in,e.next_in+c),i),e.state.wrap===1?e.adler=B0(e.adler,n,c,i):e.state.wrap===2&&(e.adler=fs(e.adler,n,c,i)),e.next_in+=c,e.total_in+=c,c)},c9=(e,n)=>{let i,s,c=e.max_chain_length,u=e.strstart,h=e.prev_length,p=e.nice_match;const _=e.strstart>e.w_size-Yd?e.strstart-(e.w_size-Yd):0,E=e.window,S=e.w_mask,w=e.prev,I=e.strstart+f_;let P=E[u+h-1],B=E[u+h];e.prev_length>=e.good_match&&(c>>=2),p>e.lookahead&&(p=e.lookahead);do if(i=n,E[i+h]===B&&E[i+h-1]===P&&E[i]===E[u]&&E[++i]===E[u+1]){u+=2,i++;do;while(E[++u]===E[++i]&&E[++u]===E[++i]&&E[++u]===E[++i]&&E[++u]===E[++i]&&E[++u]===E[++i]&&E[++u]===E[++i]&&E[++u]===E[++i]&&E[++u]===E[++i]&&u<I);if(s=f_-(I-u),u=I-f_,s>h){if(e.match_start=n,h=s,s>=p)break;P=E[u+h-1],B=E[u+h]}}while((n=w[n&S])>_&&--c!=0);return h<=e.lookahead?h:e.lookahead},uy=e=>{const n=e.w_size;let i,s,c;do{if(s=e.window_size-e.lookahead-e.strstart,e.strstart>=n+(n-Yd)&&(e.window.set(e.window.subarray(n,n+n-s),0),e.match_start-=n,e.strstart-=n,e.block_start-=n,e.insert>e.strstart&&(e.insert=e.strstart),upe(e),s+=n),e.strm.avail_in===0)break;if(i=yx(e.strm,e.window,e.strstart+e.lookahead,s),e.lookahead+=i,e.lookahead+e.insert>=3)for(c=e.strstart-e.insert,e.ins_h=e.window[c],e.ins_h=rm(e,e.ins_h,e.window[c+1]);e.insert&&(e.ins_h=rm(e,e.ins_h,e.window[c+3-1]),e.prev[c&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=c,c++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<Yd&&e.strm.avail_in!==0)},l9=(e,n)=>{let i,s,c,u=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,h=0,p=e.strm.avail_in;do{if(i=65535,c=e.bi_valid+42>>3,e.strm.avail_out<c||(c=e.strm.avail_out-c,s=e.strstart-e.block_start,i>s+e.strm.avail_in&&(i=s+e.strm.avail_in),i>c&&(i=c),i<u&&(i===0&&n!==Kl||n===tm||i!==s+e.strm.avail_in)))break;h=n===Kl&&i===s+e.strm.avail_in?1:0,_x(e,0,0,h),e.pending_buf[e.pending-4]=i,e.pending_buf[e.pending-3]=i>>8,e.pending_buf[e.pending-2]=~i,e.pending_buf[e.pending-1]=~i>>8,ol(e.strm),s&&(s>i&&(s=i),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+s),e.strm.next_out),e.strm.next_out+=s,e.strm.avail_out-=s,e.strm.total_out+=s,e.block_start+=s,i-=s),i&&(yx(e.strm,e.strm.output,e.strm.next_out,i),e.strm.next_out+=i,e.strm.avail_out-=i,e.strm.total_out+=i)}while(h===0);return p-=e.strm.avail_in,p&&(p>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=p&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-p,e.strm.next_in),e.strstart),e.strstart+=p,e.insert+=p>e.w_size-e.insert?e.w_size-e.insert:p),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),h?4:n!==tm&&n!==Kl&&e.strm.avail_in===0&&e.strstart===e.block_start?2:(c=e.window_size-e.strstart,e.strm.avail_in>c&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,c+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),c>e.strm.avail_in&&(c=e.strm.avail_in),c&&(yx(e.strm,e.window,e.strstart,c),e.strstart+=c,e.insert+=c>e.w_size-e.insert?e.w_size-e.insert:c),e.high_water<e.strstart&&(e.high_water=e.strstart),c=e.bi_valid+42>>3,c=e.pending_buf_size-c>65535?65535:e.pending_buf_size-c,u=c>e.w_size?e.w_size:c,s=e.strstart-e.block_start,(s>=u||(s||n===Kl)&&n!==tm&&e.strm.avail_in===0&&s<=c)&&(i=s>c?c:s,h=n===Kl&&e.strm.avail_in===0&&i===s?1:0,_x(e,e.block_start,i,h),e.block_start+=i,ol(e.strm)),h?3:1)},Sx=(e,n)=>{let i,s;for(;;){if(e.lookahead<Yd){if(uy(e),e.lookahead<Yd&&n===tm)return 1;if(e.lookahead===0)break}if(i=0,e.lookahead>=3&&(e.ins_h=rm(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),i!==0&&e.strstart-i<=e.w_size-Yd&&(e.match_length=c9(e,i)),e.match_length>=3)if(s=em(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do e.strstart++,e.ins_h=rm(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!=0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=rm(e,e.ins_h,e.window[e.strstart+1]);else s=em(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(s&&(sl(e,!1),e.strm.avail_out===0))return 1}return e.insert=e.strstart<2?e.strstart:2,n===Kl?(sl(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(sl(e,!1),e.strm.avail_out===0)?1:2},dy=(e,n)=>{let i,s,c;for(;;){if(e.lookahead<Yd){if(uy(e),e.lookahead<Yd&&n===tm)return 1;if(e.lookahead===0)break}if(i=0,e.lookahead>=3&&(e.ins_h=rm(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,i!==0&&e.prev_length<e.max_lazy_match&&e.strstart-i<=e.w_size-Yd&&(e.match_length=c9(e,i),e.match_length<=5&&(e.strategy===tpe||e.match_length===3&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){c=e.strstart+e.lookahead-3,s=em(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=c&&(e.ins_h=rm(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!=0);if(e.match_available=0,e.match_length=2,e.strstart++,s&&(sl(e,!1),e.strm.avail_out===0))return 1}else if(e.match_available){if(s=em(e,0,e.window[e.strstart-1]),s&&sl(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(s=em(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,n===Kl?(sl(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(sl(e,!1),e.strm.avail_out===0)?1:2};function Xd(e,n,i,s,c){this.good_length=e,this.max_lazy=n,this.nice_length=i,this.max_chain=s,this.func=c}const z0=[new Xd(0,0,0,0,l9),new Xd(4,4,8,4,Sx),new Xd(4,5,16,8,Sx),new Xd(4,6,32,32,Sx),new Xd(4,4,16,16,dy),new Xd(8,16,32,32,dy),new Xd(8,16,128,128,dy),new Xd(8,32,128,256,dy),new Xd(32,128,258,1024,dy),new Xd(32,258,258,4096,dy)];function dpe(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=HA,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*cpe),this.dyn_dtree=new Uint16Array(2*(2*spe+1)),this.bl_tree=new Uint16Array(2*(2*ape+1)),nm(this.dyn_ltree),nm(this.dyn_dtree),nm(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(lpe+1),this.heap=new Uint16Array(2*Ex+1),nm(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*Ex+1),nm(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const H0=e=>{if(!e)return 1;const n=e.state;return!n||n.strm!==e||n.status!==ly&&n.status!==57&&n.status!==69&&n.status!==73&&n.status!==91&&n.status!==103&&n.status!==p_&&n.status!==W0?1:0},u9=e=>{if(H0(e))return m_(e,qd);e.total_in=e.total_out=0,e.data_type=ope;const n=e.state;return n.pending=0,n.pending_out=0,n.wrap<0&&(n.wrap=-n.wrap),n.status=n.wrap===2?57:n.wrap?ly:p_,e.adler=n.wrap===2?0:1,n.last_flush=-2,qfe(n),Fs},d9=e=>{const n=u9(e);return n===Fs&&(i=>{i.window_size=2*i.w_size,nm(i.head),i.max_lazy_match=z0[i.level].max_lazy,i.good_match=z0[i.level].good_length,i.nice_match=z0[i.level].nice_length,i.max_chain_length=z0[i.level].max_chain,i.strstart=0,i.block_start=0,i.lookahead=0,i.insert=0,i.match_length=i.prev_length=2,i.match_available=0,i.ins_h=0})(e.state),n},h9=(e,n,i,s,c,u)=>{if(!e)return qd;let h=1;if(n===epe&&(n=6),s<0?(h=0,s=-s):s>15&&(h=2,s-=16),c<1||c>9||i!==HA||s<8||s>15||n<0||n>9||u<0||u>rpe||s===8&&h!==1)return m_(e,qd);s===8&&(s=9);const p=new dpe;return e.state=p,p.strm=e,p.status=ly,p.wrap=h,p.gzhead=null,p.w_bits=s,p.w_size=1<<p.w_bits,p.w_mask=p.w_size-1,p.hash_bits=c+7,p.hash_size=1<<p.hash_bits,p.hash_mask=p.hash_size-1,p.hash_shift=~~((p.hash_bits+3-1)/3),p.window=new Uint8Array(2*p.w_size),p.head=new Uint16Array(p.hash_size),p.prev=new Uint16Array(p.w_size),p.lit_bufsize=1<<c+6,p.pending_buf_size=4*p.lit_bufsize,p.pending_buf=new Uint8Array(p.pending_buf_size),p.sym_buf=p.lit_bufsize,p.sym_end=3*(p.lit_bufsize-1),p.level=n,p.strategy=u,p.method=i,d9(e)};var hpe=(e,n)=>{if(H0(e)||n>o9||n<0)return e?m_(e,qd):qd;const i=e.state;if(!e.output||e.avail_in!==0&&!e.input||i.status===W0&&n!==Kl)return m_(e,e.avail_out===0?vx:qd);const s=i.last_flush;if(i.last_flush=n,i.pending!==0){if(ol(e),e.avail_out===0)return i.last_flush=-1,Fs}else if(e.avail_in===0&&a9(n)<=a9(s)&&n!==Kl)return m_(e,vx);if(i.status===W0&&e.avail_in!==0)return m_(e,vx);if(i.status===ly&&i.wrap===0&&(i.status=p_),i.status===ly){let c=HA+(i.w_bits-8<<4)<<8,u=-1;if(u=i.strategy>=zA||i.level<2?0:i.level<6?1:i.level===6?2:3,c|=u<<6,i.strstart!==0&&(c|=32),c+=31-c%31,G0(i,c),i.strstart!==0&&(G0(i,e.adler>>>16),G0(i,65535&e.adler)),e.adler=1,i.status=p_,ol(e),i.pending!==0)return i.last_flush=-1,Fs}if(i.status===57){if(e.adler=0,zr(i,31),zr(i,139),zr(i,8),i.gzhead)zr(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),zr(i,255&i.gzhead.time),zr(i,i.gzhead.time>>8&255),zr(i,i.gzhead.time>>16&255),zr(i,i.gzhead.time>>24&255),zr(i,i.level===9?2:i.strategy>=zA||i.level<2?4:0),zr(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(zr(i,255&i.gzhead.extra.length),zr(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(e.adler=fs(e.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=69;else if(zr(i,0),zr(i,0),zr(i,0),zr(i,0),zr(i,0),zr(i,i.level===9?2:i.strategy>=zA||i.level<2?4:0),zr(i,3),i.status=p_,ol(e),i.pending!==0)return i.last_flush=-1,Fs}if(i.status===69){if(i.gzhead.extra){let c=i.pending,u=(65535&i.gzhead.extra.length)-i.gzindex;for(;i.pending+u>i.pending_buf_size;){let p=i.pending_buf_size-i.pending;if(i.pending_buf.set(i.gzhead.extra.subarray(i.gzindex,i.gzindex+p),i.pending),i.pending=i.pending_buf_size,i.gzhead.hcrc&&i.pending>c&&(e.adler=fs(e.adler,i.pending_buf,i.pending-c,c)),i.gzindex+=p,ol(e),i.pending!==0)return i.last_flush=-1,Fs;c=0,u-=p}let h=new Uint8Array(i.gzhead.extra);i.pending_buf.set(h.subarray(i.gzindex,i.gzindex+u),i.pending),i.pending+=u,i.gzhead.hcrc&&i.pending>c&&(e.adler=fs(e.adler,i.pending_buf,i.pending-c,c)),i.gzindex=0}i.status=73}if(i.status===73){if(i.gzhead.name){let c,u=i.pending;do{if(i.pending===i.pending_buf_size){if(i.gzhead.hcrc&&i.pending>u&&(e.adler=fs(e.adler,i.pending_buf,i.pending-u,u)),ol(e),i.pending!==0)return i.last_flush=-1,Fs;u=0}c=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,zr(i,c)}while(c!==0);i.gzhead.hcrc&&i.pending>u&&(e.adler=fs(e.adler,i.pending_buf,i.pending-u,u)),i.gzindex=0}i.status=91}if(i.status===91){if(i.gzhead.comment){let c,u=i.pending;do{if(i.pending===i.pending_buf_size){if(i.gzhead.hcrc&&i.pending>u&&(e.adler=fs(e.adler,i.pending_buf,i.pending-u,u)),ol(e),i.pending!==0)return i.last_flush=-1,Fs;u=0}c=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,zr(i,c)}while(c!==0);i.gzhead.hcrc&&i.pending>u&&(e.adler=fs(e.adler,i.pending_buf,i.pending-u,u))}i.status=103}if(i.status===103){if(i.gzhead.hcrc){if(i.pending+2>i.pending_buf_size&&(ol(e),i.pending!==0))return i.last_flush=-1,Fs;zr(i,255&e.adler),zr(i,e.adler>>8&255),e.adler=0}if(i.status=p_,ol(e),i.pending!==0)return i.last_flush=-1,Fs}if(e.avail_in!==0||i.lookahead!==0||n!==tm&&i.status!==W0){let c=i.level===0?l9(i,n):i.strategy===zA?((u,h)=>{let p;for(;;){if(u.lookahead===0&&(uy(u),u.lookahead===0)){if(h===tm)return 1;break}if(u.match_length=0,p=em(u,0,u.window[u.strstart]),u.lookahead--,u.strstart++,p&&(sl(u,!1),u.strm.avail_out===0))return 1}return u.insert=0,h===Kl?(sl(u,!0),u.strm.avail_out===0?3:4):u.sym_next&&(sl(u,!1),u.strm.avail_out===0)?1:2})(i,n):i.strategy===npe?((u,h)=>{let p,_,E,S;const w=u.window;for(;;){if(u.lookahead<=f_){if(uy(u),u.lookahead<=f_&&h===tm)return 1;if(u.lookahead===0)break}if(u.match_length=0,u.lookahead>=3&&u.strstart>0&&(E=u.strstart-1,_=w[E],_===w[++E]&&_===w[++E]&&_===w[++E])){S=u.strstart+f_;do;while(_===w[++E]&&_===w[++E]&&_===w[++E]&&_===w[++E]&&_===w[++E]&&_===w[++E]&&_===w[++E]&&_===w[++E]&&E<S);u.match_length=f_-(S-E),u.match_length>u.lookahead&&(u.match_length=u.lookahead)}if(u.match_length>=3?(p=em(u,1,u.match_length-3),u.lookahead-=u.match_length,u.strstart+=u.match_length,u.match_length=0):(p=em(u,0,u.window[u.strstart]),u.lookahead--,u.strstart++),p&&(sl(u,!1),u.strm.avail_out===0))return 1}return u.insert=0,h===Kl?(sl(u,!0),u.strm.avail_out===0?3:4):u.sym_next&&(sl(u,!1),u.strm.avail_out===0)?1:2})(i,n):z0[i.level].func(i,n);if(c!==3&&c!==4||(i.status=W0),c===1||c===3)return e.avail_out===0&&(i.last_flush=-1),Fs;if(c===2&&(n===Jfe?Xfe(i):n!==o9&&(_x(i,0,0,!1),n===Qfe&&(nm(i.head),i.lookahead===0&&(i.strstart=0,i.block_start=0,i.insert=0))),ol(e),e.avail_out===0))return i.last_flush=-1,Fs}return n!==Kl?Fs:i.wrap<=0?s9:(i.wrap===2?(zr(i,255&e.adler),zr(i,e.adler>>8&255),zr(i,e.adler>>16&255),zr(i,e.adler>>24&255),zr(i,255&e.total_in),zr(i,e.total_in>>8&255),zr(i,e.total_in>>16&255),zr(i,e.total_in>>24&255)):(G0(i,e.adler>>>16),G0(i,65535&e.adler)),ol(e),i.wrap>0&&(i.wrap=-i.wrap),i.pending!==0?Fs:s9)},fpe=(e,n)=>{let i=n.length;if(H0(e))return qd;const s=e.state,c=s.wrap;if(c===2||c===1&&s.status!==ly||s.lookahead)return qd;if(c===1&&(e.adler=B0(e.adler,n,i,0)),s.wrap=0,i>=s.w_size){c===0&&(nm(s.head),s.strstart=0,s.block_start=0,s.insert=0);let _=new Uint8Array(s.w_size);_.set(n.subarray(i-s.w_size,i),0),n=_,i=s.w_size}const u=e.avail_in,h=e.next_in,p=e.input;for(e.avail_in=i,e.next_in=0,e.input=n,uy(s);s.lookahead>=3;){let _=s.strstart,E=s.lookahead-2;do s.ins_h=rm(s,s.ins_h,s.window[_+3-1]),s.prev[_&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=_,_++;while(--E);s.strstart=_,s.lookahead=2,uy(s)}return s.strstart+=s.lookahead,s.block_start=s.strstart,s.insert=s.lookahead,s.lookahead=0,s.match_length=s.prev_length=2,s.match_available=0,e.next_in=h,e.input=p,e.avail_in=u,s.wrap=c,Fs},K0={deflateInit:(e,n)=>h9(e,n,HA,15,8,ipe),deflateInit2:h9,deflateReset:d9,deflateResetKeep:u9,deflateSetHeader:(e,n)=>H0(e)||e.state.wrap!==2?qd:(e.state.gzhead=n,Fs),deflate:hpe,deflateEnd:e=>{if(H0(e))return qd;const n=e.state.status;return e.state=null,n===p_?m_(e,Zfe):Fs},deflateSetDictionary:fpe,deflateInfo:"pako deflate (from Nodeca project)"};const ppe=(e,n)=>Object.prototype.hasOwnProperty.call(e,n);var KA={assign:function(e){const n=Array.prototype.slice.call(arguments,1);for(;n.length;){const i=n.shift();if(i){if(typeof i!="object")throw new TypeError(i+"must be non-object");for(const s in i)ppe(i,s)&&(e[s]=i[s])}}return e},flattenChunks:e=>{let n=0;for(let s=0,c=e.length;s<c;s++)n+=e[s].length;const i=new Uint8Array(n);for(let s=0,c=0,u=e.length;s<u;s++){let h=e[s];i.set(h,c),c+=h.length}return i}};let f9=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{f9=!1}const $0=new Uint8Array(256);for(let e=0;e<256;e++)$0[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;$0[254]=$0[254]=1;var q0={string2buf:e=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(e);let n,i,s,c,u,h=e.length,p=0;for(c=0;c<h;c++)i=e.charCodeAt(c),(64512&i)==55296&&c+1<h&&(s=e.charCodeAt(c+1),(64512&s)==56320&&(i=65536+(i-55296<<10)+(s-56320),c++)),p+=i<128?1:i<2048?2:i<65536?3:4;for(n=new Uint8Array(p),u=0,c=0;u<p;c++)i=e.charCodeAt(c),(64512&i)==55296&&c+1<h&&(s=e.charCodeAt(c+1),(64512&s)==56320&&(i=65536+(i-55296<<10)+(s-56320),c++)),i<128?n[u++]=i:i<2048?(n[u++]=192|i>>>6,n[u++]=128|63&i):i<65536?(n[u++]=224|i>>>12,n[u++]=128|i>>>6&63,n[u++]=128|63&i):(n[u++]=240|i>>>18,n[u++]=128|i>>>12&63,n[u++]=128|i>>>6&63,n[u++]=128|63&i);return n},buf2string:(e,n)=>{const i=n||e.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(e.subarray(0,n));let s,c;const u=new Array(2*i);for(c=0,s=0;s<i;){let h=e[s++];if(h<128){u[c++]=h;continue}let p=$0[h];if(p>4)u[c++]=65533,s+=p-1;else{for(h&=p===2?31:p===3?15:7;p>1&&s<i;)h=h<<6|63&e[s++],p--;p>1?u[c++]=65533:h<65536?u[c++]=h:(h-=65536,u[c++]=55296|h>>10&1023,u[c++]=56320|1023&h)}}return((h,p)=>{if(p<65534&&h.subarray&&f9)return String.fromCharCode.apply(null,h.length===p?h:h.subarray(0,p));let _="";for(let E=0;E<p;E++)_+=String.fromCharCode(h[E]);return _})(u,c)},utf8border:(e,n)=>{(n=n||e.length)>e.length&&(n=e.length);let i=n-1;for(;i>=0&&(192&e[i])==128;)i--;return i<0||i===0?n:i+$0[e[i]]>n?i:n}},p9=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const m9=Object.prototype.toString,{Z_NO_FLUSH:mpe,Z_SYNC_FLUSH:gpe,Z_FULL_FLUSH:_pe,Z_FINISH:vpe,Z_OK:$A,Z_STREAM_END:Epe,Z_DEFAULT_COMPRESSION:ype,Z_DEFAULT_STRATEGY:Spe,Z_DEFLATED:Tpe}=GA;function qA(e){this.options=KA.assign({level:ype,method:Tpe,chunkSize:16384,windowBits:15,memLevel:8,strategy:Spe},e||{});let n=this.options;n.raw&&n.windowBits>0?n.windowBits=-n.windowBits:n.gzip&&n.windowBits>0&&n.windowBits<16&&(n.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new p9,this.strm.avail_out=0;let i=K0.deflateInit2(this.strm,n.level,n.method,n.windowBits,n.memLevel,n.strategy);if(i!==$A)throw new Error(h_[i]);if(n.header&&K0.deflateSetHeader(this.strm,n.header),n.dictionary){let s;if(s=typeof n.dictionary=="string"?q0.string2buf(n.dictionary):m9.call(n.dictionary)==="[object ArrayBuffer]"?new Uint8Array(n.dictionary):n.dictionary,i=K0.deflateSetDictionary(this.strm,s),i!==$A)throw new Error(h_[i]);this._dict_set=!0}}function bpe(e,n){const i=new qA(n);if(i.push(e,!0),i.err)throw i.msg||h_[i.err];return i.result}qA.prototype.push=function(e,n){const i=this.strm,s=this.options.chunkSize;let c,u;if(this.ended)return!1;for(u=n===~~n?n:n===!0?vpe:mpe,typeof e=="string"?i.input=q0.string2buf(e):m9.call(e)==="[object ArrayBuffer]"?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;;)if(i.avail_out===0&&(i.output=new Uint8Array(s),i.next_out=0,i.avail_out=s),(u===gpe||u===_pe)&&i.avail_out<=6)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else{if(c=K0.deflate(i,u),c===Epe)return i.next_out>0&&this.onData(i.output.subarray(0,i.next_out)),c=K0.deflateEnd(this.strm),this.onEnd(c),this.ended=!0,c===$A;if(i.avail_out!==0){if(u>0&&i.next_out>0)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else if(i.avail_in===0)break}else this.onData(i.output)}return!0},qA.prototype.onData=function(e){this.chunks.push(e)},qA.prototype.onEnd=function(e){e===$A&&(this.result=KA.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var wpe={deflate:bpe};const YA=16209;var Rpe=function(e,n){let i,s,c,u,h,p,_,E,S,w,I,P,B,M,U,$,q,ce,me,ge,pe,Re,Ve,Ze;const rt=e.state;i=e.next_in,Ve=e.input,s=i+(e.avail_in-5),c=e.next_out,Ze=e.output,u=c-(n-e.avail_out),h=c+(e.avail_out-257),p=rt.dmax,_=rt.wsize,E=rt.whave,S=rt.wnext,w=rt.window,I=rt.hold,P=rt.bits,B=rt.lencode,M=rt.distcode,U=(1<<rt.lenbits)-1,$=(1<<rt.distbits)-1;e:do{P<15&&(I+=Ve[i++]<<P,P+=8,I+=Ve[i++]<<P,P+=8),q=B[I&U];t:for(;;){if(ce=q>>>24,I>>>=ce,P-=ce,ce=q>>>16&255,ce===0)Ze[c++]=65535&q;else{if(!(16&ce)){if((64&ce)==0){q=B[(65535&q)+(I&(1<<ce)-1)];continue t}if(32&ce){rt.mode=16191;break e}e.msg="invalid literal/length code",rt.mode=YA;break e}me=65535&q,ce&=15,ce&&(P<ce&&(I+=Ve[i++]<<P,P+=8),me+=I&(1<<ce)-1,I>>>=ce,P-=ce),P<15&&(I+=Ve[i++]<<P,P+=8,I+=Ve[i++]<<P,P+=8),q=M[I&$];n:for(;;){if(ce=q>>>24,I>>>=ce,P-=ce,ce=q>>>16&255,!(16&ce)){if((64&ce)==0){q=M[(65535&q)+(I&(1<<ce)-1)];continue n}e.msg="invalid distance code",rt.mode=YA;break e}if(ge=65535&q,ce&=15,P<ce&&(I+=Ve[i++]<<P,P+=8,P<ce&&(I+=Ve[i++]<<P,P+=8)),ge+=I&(1<<ce)-1,ge>p){e.msg="invalid distance too far back",rt.mode=YA;break e}if(I>>>=ce,P-=ce,ce=c-u,ge>ce){if(ce=ge-ce,ce>E&&rt.sane){e.msg="invalid distance too far back",rt.mode=YA;break e}if(pe=0,Re=w,S===0){if(pe+=_-ce,ce<me){me-=ce;do Ze[c++]=w[pe++];while(--ce);pe=c-ge,Re=Ze}}else if(S<ce){if(pe+=_+S-ce,ce-=S,ce<me){me-=ce;do Ze[c++]=w[pe++];while(--ce);if(pe=0,S<me){ce=S,me-=ce;do Ze[c++]=w[pe++];while(--ce);pe=c-ge,Re=Ze}}}else if(pe+=S-ce,ce<me){me-=ce;do Ze[c++]=w[pe++];while(--ce);pe=c-ge,Re=Ze}for(;me>2;)Ze[c++]=Re[pe++],Ze[c++]=Re[pe++],Ze[c++]=Re[pe++],me-=3;me&&(Ze[c++]=Re[pe++],me>1&&(Ze[c++]=Re[pe++]))}else{pe=c-ge;do Ze[c++]=Ze[pe++],Ze[c++]=Ze[pe++],Ze[c++]=Ze[pe++],me-=3;while(me>2);me&&(Ze[c++]=Ze[pe++],me>1&&(Ze[c++]=Ze[pe++]))}break}}break}}while(i<s&&c<h);me=P>>3,i-=me,P-=me<<3,I&=(1<<P)-1,e.next_in=i,e.next_out=c,e.avail_in=i<s?s-i+5:5-(i-s),e.avail_out=c<h?h-c+257:257-(c-h),rt.hold=I,rt.bits=P};const XA=15,Cpe=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Ipe=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Ape=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Ope=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var Y0=(e,n,i,s,c,u,h,p)=>{const _=p.bits;let E,S,w,I,P,B,M=0,U=0,$=0,q=0,ce=0,me=0,ge=0,pe=0,Re=0,Ve=0,Ze=null;const rt=new Uint16Array(16),un=new Uint16Array(16);let dn,nr,Qr,jr=null;for(M=0;M<=XA;M++)rt[M]=0;for(U=0;U<s;U++)rt[n[i+U]]++;for(ce=_,q=XA;q>=1&&rt[q]===0;q--);if(ce>q&&(ce=q),q===0)return c[u++]=20971520,c[u++]=20971520,p.bits=1,0;for($=1;$<q&&rt[$]===0;$++);for(ce<$&&(ce=$),pe=1,M=1;M<=XA;M++)if(pe<<=1,pe-=rt[M],pe<0)return-1;if(pe>0&&(e===0||q!==1))return-1;for(un[1]=0,M=1;M<XA;M++)un[M+1]=un[M]+rt[M];for(U=0;U<s;U++)n[i+U]!==0&&(h[un[n[i+U]]++]=U);if(e===0?(Ze=jr=h,B=20):e===1?(Ze=Cpe,jr=Ipe,B=257):(Ze=Ape,jr=Ope,B=0),Ve=0,U=0,M=$,P=u,me=ce,ge=0,w=-1,Re=1<<ce,I=Re-1,e===1&&Re>852||e===2&&Re>592)return 1;for(;;){dn=M-ge,h[U]+1<B?(nr=0,Qr=h[U]):h[U]>=B?(nr=jr[h[U]-B],Qr=Ze[h[U]-B]):(nr=96,Qr=0),E=1<<M-ge,S=1<<me,$=S;do S-=E,c[P+(Ve>>ge)+S]=dn<<24|nr<<16|Qr|0;while(S!==0);for(E=1<<M-1;Ve&E;)E>>=1;if(E!==0?(Ve&=E-1,Ve+=E):Ve=0,U++,--rt[M]==0){if(M===q)break;M=n[i+h[U]]}if(M>ce&&(Ve&I)!==w){for(ge===0&&(ge=ce),P+=$,me=M-ge,pe=1<<me;me+ge<q&&(pe-=rt[me+ge],!(pe<=0));)me++,pe<<=1;if(Re+=1<<me,e===1&&Re>852||e===2&&Re>592)return 1;w=Ve&I,c[w]=ce<<24|me<<16|P-u|0}}return Ve!==0&&(c[P+Ve]=M-ge<<24|64<<16|0),p.bits=ce,0};const{Z_FINISH:g9,Z_BLOCK:Ppe,Z_TREES:JA,Z_OK:g_,Z_STREAM_END:Npe,Z_NEED_DICT:kpe,Z_STREAM_ERROR:$l,Z_DATA_ERROR:_9,Z_MEM_ERROR:v9,Z_BUF_ERROR:Dpe,Z_DEFLATED:E9}=GA,QA=16180,ZA=16190,bf=16191,Tx=16192,bx=16194,eO=16199,tO=16200,wx=16206,Wi=16209,y9=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function Lpe(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const __=e=>{if(!e)return 1;const n=e.state;return!n||n.strm!==e||n.mode<QA||n.mode>16211?1:0},S9=e=>{if(__(e))return $l;const n=e.state;return e.total_in=e.total_out=n.total=0,e.msg="",n.wrap&&(e.adler=1&n.wrap),n.mode=QA,n.last=0,n.havedict=0,n.flags=-1,n.dmax=32768,n.head=null,n.hold=0,n.bits=0,n.lencode=n.lendyn=new Int32Array(852),n.distcode=n.distdyn=new Int32Array(592),n.sane=1,n.back=-1,g_},T9=e=>{if(__(e))return $l;const n=e.state;return n.wsize=0,n.whave=0,n.wnext=0,S9(e)},b9=(e,n)=>{let i;if(__(e))return $l;const s=e.state;return n<0?(i=0,n=-n):(i=5+(n>>4),n<48&&(n&=15)),n&&(n<8||n>15)?$l:(s.window!==null&&s.wbits!==n&&(s.window=null),s.wrap=i,s.wbits=n,T9(e))},w9=(e,n)=>{if(!e)return $l;const i=new Lpe;e.state=i,i.strm=e,i.window=null,i.mode=QA;const s=b9(e,n);return s!==g_&&(e.state=null),s};let Rx,Cx,R9=!0;const xpe=e=>{if(R9){Rx=new Int32Array(512),Cx=new Int32Array(32);let n=0;for(;n<144;)e.lens[n++]=8;for(;n<256;)e.lens[n++]=9;for(;n<280;)e.lens[n++]=7;for(;n<288;)e.lens[n++]=8;for(Y0(1,e.lens,0,288,Rx,0,e.work,{bits:9}),n=0;n<32;)e.lens[n++]=5;Y0(2,e.lens,0,32,Cx,0,e.work,{bits:5}),R9=!1}e.lencode=Rx,e.lenbits=9,e.distcode=Cx,e.distbits=5},C9=(e,n,i,s)=>{let c;const u=e.state;return u.window===null&&(u.wsize=1<<u.wbits,u.wnext=0,u.whave=0,u.window=new Uint8Array(u.wsize)),s>=u.wsize?(u.window.set(n.subarray(i-u.wsize,i),0),u.wnext=0,u.whave=u.wsize):(c=u.wsize-u.wnext,c>s&&(c=s),u.window.set(n.subarray(i-s,i-s+c),u.wnext),(s-=c)?(u.window.set(n.subarray(i-s,i),0),u.wnext=s,u.whave=u.wsize):(u.wnext+=c,u.wnext===u.wsize&&(u.wnext=0),u.whave<u.wsize&&(u.whave+=c))),0};var Mpe=(e,n)=>{let i,s,c,u,h,p,_,E,S,w,I,P,B,M,U,$,q,ce,me,ge,pe,Re,Ve=0;const Ze=new Uint8Array(4);let rt,un;const dn=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(__(e)||!e.output||!e.input&&e.avail_in!==0)return $l;i=e.state,i.mode===bf&&(i.mode=Tx),h=e.next_out,c=e.output,_=e.avail_out,u=e.next_in,s=e.input,p=e.avail_in,E=i.hold,S=i.bits,w=p,I=_,Re=g_;e:for(;;)switch(i.mode){case QA:if(i.wrap===0){i.mode=Tx;break}for(;S<16;){if(p===0)break e;p--,E+=s[u++]<<S,S+=8}if(2&i.wrap&&E===35615){i.wbits===0&&(i.wbits=15),i.check=0,Ze[0]=255&E,Ze[1]=E>>>8&255,i.check=fs(i.check,Ze,2,0),E=0,S=0,i.mode=16181;break}if(i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&E)<<8)+(E>>8))%31){e.msg="incorrect header check",i.mode=Wi;break}if((15&E)!==E9){e.msg="unknown compression method",i.mode=Wi;break}if(E>>>=4,S-=4,pe=8+(15&E),i.wbits===0&&(i.wbits=pe),pe>15||pe>i.wbits){e.msg="invalid window size",i.mode=Wi;break}i.dmax=1<<i.wbits,i.flags=0,e.adler=i.check=1,i.mode=512&E?16189:bf,E=0,S=0;break;case 16181:for(;S<16;){if(p===0)break e;p--,E+=s[u++]<<S,S+=8}if(i.flags=E,(255&Jo(i))!==E9){e.msg="unknown compression method",i.mode=Wi;break}if(57344&Jo(i)){e.msg="unknown header flags set",i.mode=Wi;break}i.head&&(i.head.text=E>>8&1),512&Jo(i)&&4&i.wrap&&(Ze[0]=255&E,Ze[1]=E>>>8&255,i.check=fs(i.check,Ze,2,0)),E=0,S=0,i.mode=16182;case 16182:for(;S<32;){if(p===0)break e;p--,E+=s[u++]<<S,S+=8}i.head&&(i.head.time=E),512&Jo(i)&&4&i.wrap&&(Ze[0]=255&E,Ze[1]=E>>>8&255,Ze[2]=E>>>16&255,Ze[3]=E>>>24&255,i.check=fs(i.check,Ze,4,0)),E=0,S=0,i.mode=16183;case 16183:for(;S<16;){if(p===0)break e;p--,E+=s[u++]<<S,S+=8}i.head&&(i.head.xflags=255&E,i.head.os=E>>8),512&Jo(i)&&4&i.wrap&&(Ze[0]=255&E,Ze[1]=E>>>8&255,i.check=fs(i.check,Ze,2,0)),E=0,S=0,i.mode=16184;case 16184:if(1024&Jo(i)){for(;S<16;){if(p===0)break e;p--,E+=s[u++]<<S,S+=8}i.length=E,i.head&&(i.head.extra_len=E),512&Jo(i)&&4&i.wrap&&(Ze[0]=255&E,Ze[1]=E>>>8&255,i.check=fs(i.check,Ze,2,0)),E=0,S=0}else i.head&&(i.head.extra=null);i.mode=16185;case 16185:if(1024&Jo(i)&&(P=i.length,P>p&&(P=p),P&&(i.head&&(pe=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Uint8Array(i.head.extra_len)),i.head.extra.set(s.subarray(u,u+P),pe)),512&Jo(i)&&4&i.wrap&&(i.check=fs(i.check,s,P,u)),p-=P,u+=P,i.length-=P),i.length))break e;i.length=0,i.mode=16186;case 16186:if(2048&Jo(i)){if(p===0)break e;P=0;do pe=s[u+P++],i.head&&pe&&i.length<65536&&(i.head.name+=String.fromCharCode(pe));while(pe&&P<p);if(512&Jo(i)&&4&i.wrap&&(i.check=fs(i.check,s,P,u)),p-=P,u+=P,pe)break e}else i.head&&(i.head.name=null);i.length=0,i.mode=16187;case 16187:if(4096&Jo(i)){if(p===0)break e;P=0;do pe=s[u+P++],i.head&&pe&&i.length<65536&&(i.head.comment+=String.fromCharCode(pe));while(pe&&P<p);if(512&Jo(i)&&4&i.wrap&&(i.check=fs(i.check,s,P,u)),p-=P,u+=P,pe)break e}else i.head&&(i.head.comment=null);i.mode=16188;case 16188:if(512&Jo(i)){for(;S<16;){if(p===0)break e;p--,E+=s[u++]<<S,S+=8}if(4&i.wrap&&E!==(65535&i.check)){e.msg="header crc mismatch",i.mode=Wi;break}E=0,S=0}i.head&&(i.head.hcrc=Jo(i)>>9&1,i.head.done=!0),e.adler=i.check=0,i.mode=bf;break;case 16189:for(;S<32;){if(p===0)break e;p--,E+=s[u++]<<S,S+=8}e.adler=i.check=y9(E),E=0,S=0,i.mode=ZA;case ZA:if(i.havedict===0)return e.next_out=h,e.avail_out=_,e.next_in=u,e.avail_in=p,i.hold=E,i.bits=S,kpe;e.adler=i.check=1,i.mode=bf;case bf:if(n===Ppe||n===JA)break e;case Tx:if(i.last){E>>>=7&S,S-=7&S,i.mode=wx;break}for(;S<3;){if(p===0)break e;p--,E+=s[u++]<<S,S+=8}switch(i.last=1&E,E>>>=1,S-=1,3&E){case 0:i.mode=16193;break;case 1:if(xpe(i),i.mode=eO,n===JA){E>>>=2,S-=2;break e}break;case 2:i.mode=16196;break;case 3:e.msg="invalid block type",i.mode=Wi}E>>>=2,S-=2;break;case 16193:for(E>>>=7&S,S-=7&S;S<32;){if(p===0)break e;p--,E+=s[u++]<<S,S+=8}if((65535&E)!=(E>>>16^65535)){e.msg="invalid stored block lengths",i.mode=Wi;break}if(i.length=65535&E,E=0,S=0,i.mode=bx,n===JA)break e;case bx:i.mode=16195;case 16195:if(P=i.length,P){if(P>p&&(P=p),P>_&&(P=_),P===0)break e;c.set(s.subarray(u,u+P),h),p-=P,u+=P,_-=P,h+=P,i.length-=P;break}i.mode=bf;break;case 16196:for(;S<14;){if(p===0)break e;p--,E+=s[u++]<<S,S+=8}if(i.nlen=257+(31&E),E>>>=5,S-=5,i.ndist=1+(31&E),E>>>=5,S-=5,i.ncode=4+(15&E),E>>>=4,S-=4,i.nlen>286||i.ndist>30){e.msg="too many length or distance symbols",i.mode=Wi;break}i.have=0,i.mode=16197;case 16197:for(;i.have<i.ncode;){for(;S<3;){if(p===0)break e;p--,E+=s[u++]<<S,S+=8}i.lens[dn[i.have++]]=7&E,E>>>=3,S-=3}for(;i.have<19;)i.lens[dn[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,rt={bits:i.lenbits},Re=Y0(0,i.lens,0,19,i.lencode,0,i.work,rt),i.lenbits=rt.bits,Re){e.msg="invalid code lengths set",i.mode=Wi;break}i.have=0,i.mode=16198;case 16198:for(;i.have<i.nlen+i.ndist;){for(;Ve=i.lencode[E&(1<<i.lenbits)-1],U=Ve>>>24,$=Ve>>>16&255,q=65535&Ve,!(U<=S);){if(p===0)break e;p--,E+=s[u++]<<S,S+=8}if(q<16)E>>>=U,S-=U,i.lens[i.have++]=q;else{if(q===16){for(un=U+2;S<un;){if(p===0)break e;p--,E+=s[u++]<<S,S+=8}if(E>>>=U,S-=U,i.have===0){e.msg="invalid bit length repeat",i.mode=Wi;break}pe=i.lens[i.have-1],P=3+(3&E),E>>>=2,S-=2}else if(q===17){for(un=U+3;S<un;){if(p===0)break e;p--,E+=s[u++]<<S,S+=8}E>>>=U,S-=U,pe=0,P=3+(7&E),E>>>=3,S-=3}else{for(un=U+7;S<un;){if(p===0)break e;p--,E+=s[u++]<<S,S+=8}E>>>=U,S-=U,pe=0,P=11+(127&E),E>>>=7,S-=7}if(i.have+P>i.nlen+i.ndist){e.msg="invalid bit length repeat",i.mode=Wi;break}for(;P--;)i.lens[i.have++]=pe}}if(i.mode===Wi)break;if(i.lens[256]===0){e.msg="invalid code -- missing end-of-block",i.mode=Wi;break}if(i.lenbits=9,rt={bits:i.lenbits},Re=Y0(1,i.lens,0,i.nlen,i.lencode,0,i.work,rt),i.lenbits=rt.bits,Re){e.msg="invalid literal/lengths set",i.mode=Wi;break}if(i.distbits=6,i.distcode=i.distdyn,rt={bits:i.distbits},Re=Y0(2,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,rt),i.distbits=rt.bits,Re){e.msg="invalid distances set",i.mode=Wi;break}if(i.mode=eO,n===JA)break e;case eO:i.mode=tO;case tO:if(p>=6&&_>=258){e.next_out=h,e.avail_out=_,e.next_in=u,e.avail_in=p,i.hold=E,i.bits=S,Rpe(e,I),h=e.next_out,c=e.output,_=e.avail_out,u=e.next_in,s=e.input,p=e.avail_in,E=i.hold,S=i.bits,i.mode===bf&&(i.back=-1);break}for(i.back=0;Ve=i.lencode[E&(1<<i.lenbits)-1],U=Ve>>>24,$=Ve>>>16&255,q=65535&Ve,!(U<=S);){if(p===0)break e;p--,E+=s[u++]<<S,S+=8}if($&&(240&$)==0){for(ce=U,me=$,ge=q;Ve=i.lencode[ge+((E&(1<<ce+me)-1)>>ce)],U=Ve>>>24,$=Ve>>>16&255,q=65535&Ve,!(ce+U<=S);){if(p===0)break e;p--,E+=s[u++]<<S,S+=8}E>>>=ce,S-=ce,i.back+=ce}if(E>>>=U,S-=U,i.back+=U,i.length=q,$===0){i.mode=16205;break}if(32&$){i.back=-1,i.mode=bf;break}if(64&$){e.msg="invalid literal/length code",i.mode=Wi;break}i.extra=15&$,i.mode=16201;case 16201:if(i.extra){for(un=i.extra;S<un;){if(p===0)break e;p--,E+=s[u++]<<S,S+=8}i.length+=E&(1<<i.extra)-1,E>>>=i.extra,S-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=16202;case 16202:for(;Ve=i.distcode[E&(1<<i.distbits)-1],U=Ve>>>24,$=Ve>>>16&255,q=65535&Ve,!(U<=S);){if(p===0)break e;p--,E+=s[u++]<<S,S+=8}if((240&$)==0){for(ce=U,me=$,ge=q;Ve=i.distcode[ge+((E&(1<<ce+me)-1)>>ce)],U=Ve>>>24,$=Ve>>>16&255,q=65535&Ve,!(ce+U<=S);){if(p===0)break e;p--,E+=s[u++]<<S,S+=8}E>>>=ce,S-=ce,i.back+=ce}if(E>>>=U,S-=U,i.back+=U,64&$){e.msg="invalid distance code",i.mode=Wi;break}i.offset=q,i.extra=15&$,i.mode=16203;case 16203:if(i.extra){for(un=i.extra;S<un;){if(p===0)break e;p--,E+=s[u++]<<S,S+=8}i.offset+=E&(1<<i.extra)-1,E>>>=i.extra,S-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){e.msg="invalid distance too far back",i.mode=Wi;break}i.mode=16204;case 16204:if(_===0)break e;if(P=I-_,i.offset>P){if(P=i.offset-P,P>i.whave&&i.sane){e.msg="invalid distance too far back",i.mode=Wi;break}P>i.wnext?(P-=i.wnext,B=i.wsize-P):B=i.wnext-P,P>i.length&&(P=i.length),M=i.window}else M=c,B=h-i.offset,P=i.length;P>_&&(P=_),_-=P,i.length-=P;do c[h++]=M[B++];while(--P);i.length===0&&(i.mode=tO);break;case 16205:if(_===0)break e;c[h++]=i.length,_--,i.mode=tO;break;case wx:if(i.wrap){for(;S<32;){if(p===0)break e;p--,E|=s[u++]<<S,S+=8}if(I-=_,e.total_out+=I,i.total+=I,4&i.wrap&&I&&(e.adler=i.check=Jo(i)?fs(i.check,c,I,h-I):B0(i.check,c,I,h-I)),I=_,4&i.wrap&&(Jo(i)?E:y9(E))!==i.check){e.msg="incorrect data check",i.mode=Wi;break}E=0,S=0}i.mode=16207;case 16207:if(i.wrap&&Jo(i)){for(;S<32;){if(p===0)break e;p--,E+=s[u++]<<S,S+=8}if(4&i.wrap&&E!==(4294967295&i.total)){e.msg="incorrect length check",i.mode=Wi;break}E=0,S=0}i.mode=16208;case 16208:Re=Npe;break e;case Wi:Re=_9;break e;case 16210:return v9;default:return $l}return e.next_out=h,e.avail_out=_,e.next_in=u,e.avail_in=p,i.hold=E,i.bits=S,(i.wsize||I!==e.avail_out&&i.mode<Wi&&(i.mode<wx||n!==g9))&&C9(e,e.output,e.next_out,I-e.avail_out),w-=e.avail_in,I-=e.avail_out,e.total_in+=w,e.total_out+=I,i.total+=I,4&i.wrap&&I&&(e.adler=i.check=Jo(i)?fs(i.check,c,I,e.next_out-I):B0(i.check,c,I,e.next_out-I)),e.data_type=i.bits+(i.last?64:0)+(i.mode===bf?128:0)+(i.mode===eO||i.mode===bx?256:0),(w===0&&I===0||n===g9)&&Re===g_&&(Re=Dpe),Re},wf={inflateReset:T9,inflateReset2:b9,inflateResetKeep:S9,inflateInit:e=>w9(e,15),inflateInit2:w9,inflate:Mpe,inflateEnd:e=>{if(__(e))return $l;let n=e.state;return n.window&&(n.window=null),e.state=null,g_},inflateGetHeader:(e,n)=>{if(__(e))return $l;const i=e.state;return(2&i.wrap)==0?$l:(i.head=n,n.done=!1,g_)},inflateSetDictionary:(e,n)=>{const i=n.length;let s,c,u;return __(e)?$l:(s=e.state,s.wrap!==0&&s.mode!==ZA?$l:s.mode===ZA&&(c=1,c=B0(c,n,i,0),c!==s.check)?_9:(u=C9(e,n,i,i),u?(s.mode=16210,v9):(s.havedict=1,g_)))},inflateInfo:"pako inflate (from Nodeca project)"},Upe=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const I9=Object.prototype.toString,{Z_NO_FLUSH:Vpe,Z_FINISH:Fpe,Z_OK:X0,Z_STREAM_END:Ix,Z_NEED_DICT:Ax,Z_STREAM_ERROR:jpe,Z_DATA_ERROR:A9,Z_MEM_ERROR:Bpe}=GA;function nO(e){this.options=KA.assign({chunkSize:65536,windowBits:15,to:""},e||{});const n=this.options;n.raw&&n.windowBits>=0&&n.windowBits<16&&(n.windowBits=-n.windowBits,n.windowBits===0&&(n.windowBits=-15)),!(n.windowBits>=0&&n.windowBits<16)||e&&e.windowBits||(n.windowBits+=32),n.windowBits>15&&n.windowBits<48&&(15&n.windowBits)==0&&(n.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new p9,this.strm.avail_out=0;let i=wf.inflateInit2(this.strm,n.windowBits);if(i!==X0)throw new Error(h_[i]);if(this.header=new Upe,wf.inflateGetHeader(this.strm,this.header),n.dictionary&&(typeof n.dictionary=="string"?n.dictionary=q0.string2buf(n.dictionary):I9.call(n.dictionary)==="[object ArrayBuffer]"&&(n.dictionary=new Uint8Array(n.dictionary)),n.raw&&(i=wf.inflateSetDictionary(this.strm,n.dictionary),i!==X0)))throw new Error(h_[i])}function Wpe(e,n){const i=new nO(n);if(i.push(e),i.err)throw i.msg||h_[i.err];return i.result}nO.prototype.push=function(e,n){const i=this.strm,s=this.options.chunkSize,c=this.options.dictionary;let u,h,p;if(this.ended)return!1;for(h=n===~~n?n:n===!0?Fpe:Vpe,I9.call(e)==="[object ArrayBuffer]"?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;;){for(i.avail_out===0&&(i.output=new Uint8Array(s),i.next_out=0,i.avail_out=s),u=wf.inflate(i,h),u===Ax&&c&&(u=wf.inflateSetDictionary(i,c),u===X0?u=wf.inflate(i,h):u===A9&&(u=Ax));i.avail_in>0&&u===Ix&&i.state.wrap>0&&e[i.next_in]!==0;)wf.inflateReset(i),u=wf.inflate(i,h);switch(u){case jpe:case A9:case Ax:case Bpe:return this.onEnd(u),this.ended=!0,!1}if(p=i.avail_out,i.next_out&&(i.avail_out===0||u===Ix))if(this.options.to==="string"){let _=q0.utf8border(i.output,i.next_out),E=i.next_out-_,S=q0.buf2string(i.output,_);i.next_out=E,i.avail_out=s-E,E&&i.output.set(i.output.subarray(_,_+E),0),this.onData(S)}else this.onData(i.output.length===i.next_out?i.output:i.output.subarray(0,i.next_out));if(u!==X0||p!==0){if(u===Ix)return u=wf.inflateEnd(this.strm),this.onEnd(u),this.ended=!0,!0;if(i.avail_in===0)break}}return!0},nO.prototype.onData=function(e){this.chunks.push(e)},nO.prototype.onEnd=function(e){e===X0&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=KA.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Gpe={inflate:Wpe};const{deflate:zpe}=wpe,{inflate:Hpe}=Gpe;var Kpe=zpe,$pe=Hpe,O9=function(e){return e[e.ONE_BYTE=0]="ONE_BYTE",e[e.TWO_BYTE=1]="TWO_BYTE",e}(O9||{});class qpe{constructor(){K(this,"_sequence",0),K(this,"_startTime",Date.now()),K(this,"isUseOneByte",!0)}get startTime(){const n=Date.now()-this._startTime;return n<Math.pow(2,16)?n:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(n){const i={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:n};if(n.byteLength>128){const p=new Uint8Array(4);p.set([1,0,0,0]);const _={id:0,length:4,data:p.buffer},E={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[_]};i.commonPacketHeader.extension=1,i.extension=E,i.payload=this.compress(n),i.commonPacketHeader.length=8+(i.extension.length+2)+i.payload.byteLength}else i.commonPacketHeader.length=8+i.payload.byteLength;Z("SHOW_DATASTREAM2_LOG")&&k.debug("send data header: ".concat(JSON.stringify(i.commonPacketHeader)));const s=new ArrayBuffer(i.commonPacketHeader.length),c=new Uint8Array(s),u=new DataView(s);let h=0;if(u.setUint16(h,i.commonPacketHeader.extension<<15|i.commonPacketHeader.reserved<<14|i.commonPacketHeader.length,!0),h+=2,u.setUint32(h,i.commonPacketHeader.sequence,!0),h+=4,u.setUint16(h,i.commonStreamHeader,!0),h+=2,i.extension){const p=this.serializeExtension(i.extension);c.set(new Uint8Array(p),h),h+=p.byteLength}if(c.set(new Uint8Array(i.payload),h),h+=i.payload.byteLength,h!==i.commonPacketHeader.length)throw Error("serialize error!");return s}deserialize(n){if(n.byteLength<4)return new ArrayBuffer(0);const i=new DataView(n);let s=0;const c=i.getUint16(s,!0);s+=2;const u={length:16383&c,reserved:(16384&c)>>14,extension:(32768&c)>>15,sequence:i.getUint16(s+2,!0)<<16|i.getUint16(s,!0)};let h,p;if(s+=4,Z("SHOW_DATASTREAM2_LOG")&&k.debug("receive data header: ".concat(JSON.stringify(u))),i.getUint16(s,!0),s+=2,u.extension){p=this.deserializeExtension(n.slice(s)),s+=2+p.length,h=n.slice(s);let _=!1;if(p.datas.length>0){const E=p.datas.find(S=>S.id===0);E&&(_=(1&new DataView(E.data).getUint32(0,!0))==1)}h=_?this.decompress(h):h}else h=n.slice(8);return h}serializeExtension(n){const{profile:i,length:s,datas:c}=n,u=new ArrayBuffer(s+2),h=new Uint8Array(u),p=new DataView(u);let _=0;if(p.setUint8(_++,i),p.setUint8(_++,s),c.forEach(E=>{i?(p.setUint8(_++,E.id),p.setUint8(_++,E.length),h.set(new Uint8Array(E.data),_),_+=E.data.byteLength):(p.setUint8(_++,E.id|E.length<<4),h.set(new Uint8Array(E.data),_),_+=E.data.byteLength)}),_!==s+2)throw Error("serialize extension error, is ".concat(_,"!==").concat(s+2));return u}deserializeExtension(n){const i=new DataView(n);let s=0;const c=i.getUint8(s);s++;const u=i.getUint8(s);s++;const h=c===O9.TWO_BYTE,p=[],_=new DataView(n,2);let E=0;for(;E<u;){let S=0,w=0,I=new ArrayBuffer(0);h?(S=_.getUint8(E),E++,w=_.getUint8(E),E++):(S=15&_.getUint8(E),w=_.getUint8(E)>>4,E++),w>0&&(I=_.buffer.slice(E+2,E+2+w),E+=I.byteLength),p.push({id:S,length:w,data:I})}if(E!==u)throw Error("parse error");return{profile:c,length:u,datas:p}}decompress(n){return $pe(new Uint8Array(n))}compress(n){return Kpe(new Uint8Array(n))}}const Ype={name:"DataStream",create:(e,n)=>{const i=n?new nhe(e):new rhe(e);return i.useDataStream(new qpe),i}};class Xpe extends Rr{constructor(n,i,s){super(),K(this,"ws",void 0),K(this,"requestId",1),K(this,"heartBeatTimer",void 0),K(this,"joinInfo",void 0),K(this,"clientId",void 0),K(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),K(this,"onClose",c=>{this.emit("close"),this.dispose()}),K(this,"onMessage",c=>{const u=JSON.parse(c.data);if(!u||u.command!=="serverResponse"||!u.requestId)return u&&u.command==="serverStatus"&&u.serverStatus&&u.serverStatus.command?(this.emit("status",u.serverStatus),void this.emit(u.serverStatus.command,u.serverStatus)):void 0;this.emit("req_".concat(u.requestId),u)}),this.joinInfo=n,this.clientId=i,this.ws=new T0("cross-channel-".concat(this.clientId),s),this.ws.on(Gt.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(Gt.CONNECTED,this.onOpen),this.ws.on(Gt.ON_MESSAGE,this.onMessage),this.ws.on(Gt.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(n){const i=this.requestId++;return n.requestId=i,n.seq=i,this.ws.sendMessage(n),i}waitStatus(n){return new Qe((i,s)=>{const c=window.setTimeout(()=>{s(new be(Y.TIMEOUT,"wait status timeout, status: ".concat(n)))},5e3);this.once(n,u=>{window.clearTimeout(c),u.state&&u.state!==0?s(new be(Y.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(n))):i(void 0)}),this.once("dispose",()=>{window.clearTimeout(c),s(new be(Y.WS_ABORT))})})}async request(n){if(this.ws.state==="closed")throw new be(Y.WS_DISCONNECT);const i=()=>new Qe((h,p)=>{this.ws.once(Gt.CLOSED,()=>p(new be(Y.WS_ABORT))),this.ws.once(Gt.CONNECTED,h)});this.ws.state!=="connected"&&await i();const s=this.sendMessage(n),c=new Qe((h,p)=>{const _=()=>{p(new be(Y.WS_ABORT))};this.ws.once(Gt.RECONNECTING,_),this.ws.once(Gt.CLOSED,_),this.once("req_".concat(s),h),Ji(3e3).then(()=>{this.removeAllListeners("req_".concat(s)),this.ws.off(Gt.RECONNECTING,_),this.ws.off(Gt.CLOSED,_),p(new be(Y.TIMEOUT,"cross channel ws request timeout"))})}),u=await c;if(!u||u.code!==200)throw new be(Y.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(u)));return u}async connect(n){this.ws.removeAllListeners(Gt.REQUEST_NEW_URLS),this.ws.on(Gt.REQUEST_NEW_URLS,i=>{i(n)}),await this.ws.init(n)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(n){const i=this.requestId++;return n.requestId=i,this.ws.sendMessage(n),i}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class Jpe extends Rr{set state(n){n!==this._state&&(n!==ua.RELAY_STATE_FAILURE&&(this.errorCode=YE.RELAY_OK),this.emit("state",n,this.errorCode),this._state=n)}get state(){return this._state}constructor(n,i,s,c,u){super(),K(this,"joinInfo",void 0),K(this,"sid",void 0),K(this,"clientId",void 0),K(this,"cancelToken",Ls.CancelToken.source()),K(this,"workerToken",void 0),K(this,"requestId",0),K(this,"signal",void 0),K(this,"prevChannelMediaConfig",void 0),K(this,"httpRetryConfig",void 0),K(this,"_resolution",void 0),K(this,"_state",ua.RELAY_STATE_IDLE),K(this,"errorCode",YE.RELAY_OK),K(this,"onStatus",h=>{k.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(h))),h&&h.command&&(h.command==="onAudioPacketReceived"&&this.emit("event",_f.PACKET_RECEIVED_AUDIO_FROM_SRC),h.command==="onVideoPacketReceived"&&this.emit("event",_f.PACKET_RECEIVED_VIDEO_FROM_SRC),h.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=YE.SRC_TOKEN_EXPIRED,this.state=ua.RELAY_STATE_FAILURE),h.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=YE.DEST_TOKEN_EXPIRED,this.state=ua.RELAY_STATE_FAILURE))}),K(this,"onReconnect",async()=>{k.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",_f.NETWORK_DISCONNECTED),this.state=ua.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(h=>{this.state!==ua.RELAY_STATE_IDLE&&(k.error("auto restart channel media relay failed",h.toString()),this.errorCode=YE.SERVER_CONNECTION_LOST,this.state=ua.RELAY_STATE_FAILURE)})}),this.joinInfo=n,this.clientId=i,this.sid=Yg(),this.signal=new Xpe(this.joinInfo,this.clientId,s),this.httpRetryConfig=c,this._resolution=u}async startChannelMediaRelay(n){if(this.state!==ua.RELAY_STATE_IDLE)throw new be(Y.INVALID_OPERATION);this.state=ua.RELAY_STATE_CONNECTING,await this.connect(),k.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(n)}catch(i){throw i.data&&i.data.serverResponse&&i.data.serverResponse.command==="SetSourceChannel"?new be(Y.CROSS_CHANNEL_FAILED_JOIN_SRC):i.data&&i.data.serverResponse&&i.serverResponse.command==="SetDestChannelStatus"?new be(Y.CROSS_CHANNEL_FAILED_JOIN_DEST):i.data&&i.data.serverResponse&&i.serverResponse.command==="StartPacketTransfer"?new be(Y.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):i}this.prevChannelMediaConfig=n}async updateChannelMediaRelay(n){if(this.state!==ua.RELAY_STATE_RUNNING)throw new be(Y.INVALID_OPERATION);await this.sendUpdateMessage(n),this.prevChannelMediaConfig=n}async setVideoProfile(n){if(this._resolution=n,this.state!==ua.RELAY_STATE_RUNNING)throw new be(Y.INVALID_OPERATION);const i=this.genMessage(hs.SetVideoProfile);await this.signal.request(i),k.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),k.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=ua.RELAY_STATE_IDLE,this.dispose()}dispose(){k.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=Ls.CancelToken.source(),this.state=ua.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const n=await afe(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=n.workerToken,await this.signal.connect(n.addressList),this.emit("event",_f.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(n){const i=this.genMessage(hs.StopPacketTransfer);await this.signal.request(i),await this.signal.waitStatus("Normal Quit"),k.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const s=this.genMessage(hs.SetSdkProfile,n);await this.signal.request(s),k.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const c=this.genMessage(hs.SetSourceChannel,n);await this.signal.request(c),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",_f.PACKET_JOINED_SRC_CHANNEL),k.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const u=this.genMessage(hs.SetSourceUserId,n);await this.signal.request(u),k.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const h=this.genMessage(hs.SetDestChannel,n);await this.signal.request(h),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",_f.PACKET_JOINED_DEST_CHANNEL),k.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const p=this.genMessage(hs.StartPacketTransfer,n);await this.signal.request(p),this.emit("event",_f.PACKET_SENT_TO_DEST_CHANNEL),this.state=ua.RELAY_STATE_RUNNING,k.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(n){const i=this.genMessage(hs.UpdateDestChannel,n);await this.signal.request(i),this.emit("event",_f.PACKET_UPDATE_DEST_CHANNEL),k.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const n=this.genMessage(hs.StopPacketTransfer);await this.signal.request(n),k.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(n,i){const s=[],c=[],u=[];this.requestId+=1;const h={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:el,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};h.sdkVersion==="4.23.2"&&(h.sdkVersion="0.0.1");let p=null,_=null;switch(n){case hs.SetSdkProfile:return h.clientRequest={command:"SetSdkProfile",type:"multi_channel"},h;case hs.SetSourceChannel:if(_=i&&i.getSrcChannelMediaInfo(),!_)throw new be(Y.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceChannel",uid:"0",channelName:_.channelName,token:_.token||this.joinInfo.appId},h;case hs.SetSourceUserId:if(_=i&&i.getSrcChannelMediaInfo(),!_)throw new be(Y.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceUserId",uid:_.uid+""},h;case hs.SetDestChannel:if(p=i&&i.getDestChannelMediaInfo(),!p)throw new be(Y.UNEXPECTED_ERROR,"can not find dest config");return p.forEach(E=>{s.push(E.channelName),c.push(E.uid+""),u.push(E.token||this.joinInfo.appId)}),h.clientRequest={command:"SetDestChannel",channelName:s,uid:c,token:u},h;case hs.StartPacketTransfer:return h.clientRequest={command:"StartPacketTransfer"},h;case hs.Reconnect:return h.clientRequest={command:"Reconnect"},h;case hs.StopPacketTransfer:return h.clientRequest={command:"StopPacketTransfer"},h;case hs.UpdateDestChannel:if(p=i&&i.getDestChannelMediaInfo(),!p)throw new be(Y.UNEXPECTED_ERROR,"can not find dest config");return p.forEach(E=>{s.push(E.channelName),c.push(E.uid+""),u.push(E.token||this.joinInfo.appId)}),h.clientRequest={command:"UpdateDestChannel",channelName:s,uid:c,token:u},h;case hs.SetVideoProfile:h.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return h}}const Qpe={name:"ChannelMediaRelay",create:function(e){return new Jpe(e.joinInfo,e.clientId,e.websocketRetryConfig||pi,e.httpRetryConfig||pi,e.resolution)}};function P9(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,s)}return i}function J0(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?P9(Object(i),!0).forEach(function(s){K(e,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):P9(Object(i)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(i,s))})}return e}class Zpe extends Rr{constructor(n,i,s,c){super(),K(this,"spec",void 0),K(this,"token",void 0),K(this,"websocket",void 0),K(this,"pingpongTimer",void 0),K(this,"reconnectMode","retry"),K(this,"serviceMode",void 0),K(this,"reqId",0),K(this,"commandReqId",0),K(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),K(this,"handleWebSocketMessage",u=>{if(!u.data)return;const h=JSON.parse(u.data);h.requestId?this.emit("@".concat(h.requestId,"-").concat(h.sid),h):(pt.workerEvent(this.spec.sid,{actionType:"status",serverCode:h.code,workerType:this.serviceMode===gf.TRANSCODE?1:2}),this.emit(zp.PUBLISH_STREAM_STATUS,h))}),this.spec=i,this.token=n,this.serviceMode=c,this.websocket=new T0("live-streaming",s),this.websocket.on(Gt.CONNECTED,this.handleWebSocketOpen),this.websocket.on(Gt.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(Gt.REQUEST_NEW_URLS,(u,h)=>{ho(this,zp.REQUEST_NEW_ADDRESS).then(u).catch(h)}),this.websocket.on(Gt.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(n){return this.websocket.init(n)}async request(n,i,s,c){this.reqId+=1,n==="request"&&(this.commandReqId+=1);const u=this.commandReqId,h=this.reqId;if(!h||!this.websocket)throw new be(Y.UNEXPECTED_ERROR);const p=J0({command:n,sdkVersion:el==="4.23.2"?"0.0.1":el,seq:h,requestId:h,allocate:s,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},i);if(this.websocket.state==="closed")throw new be(Y.WS_DISCONNECT);const _=()=>new Qe((I,P)=>{this.websocket.once(Gt.CLOSED,()=>P(new be(Y.WS_ABORT))),this.websocket.once(Gt.CONNECTED,I)});this.websocket.state!=="connected"&&await _(),p.clientRequest&&(p.clientRequest.workerToken=this.token);const E=new Qe((I,P)=>{const B=()=>{P(new be(Y.WS_ABORT))};this.websocket.once(Gt.RECONNECTING,B),this.websocket.once(Gt.CLOSED,B),this.once("@".concat(h,"-").concat(this.spec.sid),M=>{I(M)})});c&&pt.workerEvent(this.spec.sid,J0(J0({},c),{},{requestId:u,actionType:"request",payload:JSON.stringify(i.clientRequest),serverCode:0,code:0}));const S=Date.now();this.websocket.sendMessage(p);let w=null;try{w=await E}catch(I){if(this.websocket.state==="closed")throw I;return await _(),await this.request(n,i,s)}return c&&pt.workerEvent(this.spec.sid,J0(J0({},c),{},{requestId:u,actionType:"response",payload:JSON.stringify(w.serverResponse),serverCode:w.code,success:w.code===200,responseTime:Date.now()-S})),w.code!==200&&this.handleResponseError(w),w}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const n=el==="4.23.2"?"0.0.1":el;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:n,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(n){switch(n.code){case Si.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void k.warning("live stream response already exists stream");case Si.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case Si.LIVE_STREAM_RESPONSE_BAD_STREAM:case Si.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new be(Y.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:n.code}).throw();case Si.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(n.serverResponse.command==="UnpublishStream")return;throw new be(Y.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Si.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new be(Y.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:n.code}).throw();case Si.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const i=new be(Y.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(zp.WARNING,i,n.serverResponse.url)}case Si.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const i=new be(Y.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(zp.WARNING,i,n.serverResponse.url)}case Si.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new be(Y.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Si.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new be(Y.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:n.code}).throw();case Si.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const i=new be(Y.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(zp.WARNING,i,n.serverResponse.url)}case Si.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new be(Y.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:n.code}).throw();case Si.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new be(Y.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case Si.LIVE_STREAM_RESPONSE_WORKER_LOST:case Si.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(n.serverResponse.command==="UnpublishStream")return;throw new be(Y.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Si.ERROR_FAIL_SEND_MESSAGE:if(n.serverResponse.command==="UnpublishStream")return;if(n.serverResponse.command==="UpdateTranscoding"||n.serverResponse.command==="ControlStream")return new be(Y.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:n.code}).throw();throw new be(Y.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Si.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Si.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Si.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Si.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new be(Y.LIVE_STREAMING_CDN_ERROR,"",{code:n.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(GI)},6e3)}}function N9(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,s)}return i}function da(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?N9(Object(i),!0).forEach(function(s){K(e,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):N9(Object(i)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(i,s))})}return e}class eme extends Rr{constructor(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:pi,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:pi;super(),K(this,"onLiveStreamWarning",void 0),K(this,"onLiveStreamError",void 0),K(this,"spec",void 0),K(this,"retryTimeout",1e4),K(this,"connection",void 0),K(this,"httpRetryConfig",void 0),K(this,"wsRetryConfig",void 0),K(this,"streamingTasks",new Map),K(this,"isStartingStreamingTask",!1),K(this,"taskMutex",new To("live-streaming")),K(this,"cancelToken",Ls.CancelToken.source()),K(this,"transcodingConfig",void 0),K(this,"uapResponse",void 0),K(this,"lastTaskId",1),K(this,"statusError",new Map),this.spec=n,this.httpRetryConfig=s,this.wsRetryConfig=i}async setTranscodingConfig(n){const i=da(da({},jhe),n);i.videoCodecProfile!==66&&i.videoCodecProfile!==77&&i.videoCodecProfile!==100&&(k.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(i.videoCodecProfile," -> 100")),i.videoCodecProfile=100),i.transcodingUsers||(i.transcodingUsers=i.userConfigs),i.transcodingUsers&&(i.transcodingUsers=i.transcodingUsers.map(h=>da(da(da({},Fhe),h),{},{zOrder:h.zOrder?h.zOrder+1:1}))),function(h){kr(h.width)||Yn(h.width,"config.width",0,1e4),kr(h.height)||Yn(h.height,"config.height",0,1e4),kr(h.videoBitrate)||Yn(h.videoBitrate,"config.videoBitrate",1,1e6),kr(h.videoFrameRate)||Yn(h.videoFrameRate,"config.videoFrameRate"),kr(h.lowLatency)||hf(h.lowLatency,"config.lowLatency"),kr(h.audioSampleRate)||bi(h.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),kr(h.audioBitrate)||Yn(h.audioBitrate,"config.audioBitrate",1,128),kr(h.audioChannels)||bi(h.audioChannels,"config.audioChannels",[1,2,3,4,5]),kr(h.videoGop)||Yn(h.videoGop,"config.videoGop"),kr(h.videoCodecProfile)||bi(h.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),kr(h.userCount)||Yn(h.userCount,"config.userCount",0,17),kr(h.backgroundColor)||Yn(h.backgroundColor,"config.backgroundColor",0,16777215),kr(h.userConfigExtraInfo)||Xi(h.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),h.transcodingUsers&&!kr(h.transcodingUsers)&&(ff(h.transcodingUsers,"config.transcodingUsers"),h.transcodingUsers.forEach((p,_)=>{fA(p.uid),kr(p.x)||Yn(p.x,"transcodingUser[".concat(_,"].x"),0,1e4),kr(p.y)||Yn(p.y,"transcodingUser[".concat(_,"].y"),0,1e4),kr(p.width)||Yn(p.width,"transcodingUser[".concat(_,"].width"),0,1e4),kr(p.height)||Yn(p.height,"transcodingUser[".concat(_,"].height"),0,1e4),kr(p.zOrder)||Yn(p.zOrder-1,"transcodingUser[".concat(_,"].zOrder"),0,100),kr(p.alpha)||Yn(p.alpha,"transcodingUser[".concat(_,"].alpha"),0,1,!1)})),kr(h.watermark)||PL(h.watermark,"watermark"),kr(h.backgroundImage)||PL(h.backgroundImage,"backgroundImage"),h.images&&!kr(h.images)&&(ff(h.images,"config.images"),h.images.forEach((p,_)=>{PL(p,"images[".concat(_,"]"))}))}(i);const s=[];i.images&&s.push(...i.images.map(h=>da(da(da({},OL),h),{},{zOrder:255}))),i.backgroundImage&&(s.push(da(da(da({},OL),i.backgroundImage),{},{zOrder:0})),delete i.backgroundImage),i.watermark&&(s.push(da(da(da({},OL),i.watermark),{},{zOrder:255})),delete i.watermark),i.images=s,i.transcodingUsers&&(i.userConfigs=i.transcodingUsers.map(h=>da({},h)),i.userCount=i.transcodingUsers.length,delete i.transcodingUsers);const c=(i.userConfigs||[]).map(h=>typeof h.uid=="number"?Qe.resolve(h.uid):Zz(h.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await Qe.all(c)).forEach((h,p)=>{i.userConfigs&&i.userConfigs[p]&&(i.userConfigs[p].uid=h)}),this.transcodingConfig=i,this.connection)try{var u;const h=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(fc(u=this.streamingTasks).call(u)).map(p=>p.taskId).join("#")});k.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(h.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(h){if(!h.data||!h.data.retry)throw h;h.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(p=>{k.warning("[".concat(this.spec.clientId,"] live streaming receive error"),h.toString(),"try to republish",p.url),this.startLiveStreamingTask(p.url,p.mode,h).then(()=>{k.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(p.url," success"))}).catch(_=>{k.error("[".concat(this.spec.clientId,"] live streaming republish failed"),p.url,_.toString()),this.onLiveStreamError&&this.onLiveStreamError(p.url,_)})})}}async startLiveStreamingTask(n,i,s){if(!this.transcodingConfig&&i===gf.TRANSCODE)throw new be(Y.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const c={command:"PublishStream",ts:Date.now(),url:n,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};k.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(n,", mode: ").concat(i));const u=await this.taskMutex.lock();if(!this.connection&&s)return void u();if(this.streamingTasks.get(n)&&!s)return u(),new be(Y.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(i))}catch(p){throw u(),p}switch(i){case gf.TRANSCODE:c.transcodingConfig=da({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(c.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const h=this.lastTaskId++;try{const p=new Qe((E,S)=>{Ji(this.retryTimeout).then(()=>{if(s)return S(s);const w=this.statusError.get(n);return w?(this.statusError.delete(n),S(w)):void 0})}),_=await Qe.race([this.connection.request("request",{clientRequest:c},!0,{url:n,command:"PublishStream",workerType:i===gf.TRANSCODE?1:2,requestByUser:!s,tid:h.toString()}),p]);this.isStartingStreamingTask=!1,k.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(_.code)),this.streamingTasks.set(n,{clientRequest:c,mode:i,url:n,taskId:h}),u()}catch(p){if(u(),this.isStartingStreamingTask=!1,!p.data||!p.data.retry||s)throw p;return p.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(n,i,p)):await this.startLiveStreamingTask(n,i,p)}}stopLiveStreamingTask(n){return new Qe((i,s)=>{const c=this.streamingTasks.get(n);if(!c||!this.connection)return new be(Y.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const u=c.mode;c.abortTask=()=>{k.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(n),i()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:c.url}},!1,{url:n,command:"UnPublishStream",workerType:u===gf.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(h=>{k.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(h.code)),this.streamingTasks.delete(n),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),i()}).catch(s)})}resetAllTask(){var n;const i=Array.from(fc(n=this.streamingTasks).call(n));this.terminate();for(const s of i)this.startLiveStreamingTask(s.url,s.mode).catch(c=>{this.onLiveStreamError&&this.onLiveStreamError(s.url,c)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=Ls.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(n){if(this.connection)throw new be(Y.UNEXPECTED_ERROR,"live streaming connection has already connected");const i=await ho(this,NL.REQUEST_WORKER_MANAGER_LIST,n);return this.uapResponse=i,this.connection=new Zpe(i.workerToken,this.spec,this.wsRetryConfig,n),this.connection.on(zp.WARNING,(s,c)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(c,s)),this.connection.on(zp.PUBLISH_STREAM_STATUS,s=>this.handlePublishStreamServer(s)),this.connection.on(zp.REQUEST_NEW_ADDRESS,(s,c)=>{if(!this.connection)return c(new be(Y.UNEXPECTED_ERROR,"can not get new live streaming address list"));ho(this,NL.REQUEST_WORKER_MANAGER_LIST,n).then(u=>{this.uapResponse=u,s(u.addressList)}).catch(c)}),await this.connection.init(i.addressList),this.connection}handlePublishStreamServer(n){const i=n.serverStatus&&n.serverStatus.url||"empty_url",s=this.streamingTasks.get(i),c=n.reason;switch(n.code){case Si.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Si.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Si.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Si.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const h=new be(Y.LIVE_STREAMING_CDN_ERROR,"",{code:n.code});if(s)return k.error(h.toString()),this.onLiveStreamError&&this.onLiveStreamError(i,h);if(!this.isStartingStreamingTask)return;this.statusError.set(i,h)}case Si.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const h=new be(Y.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,c);return this.onLiveStreamWarning&&this.onLiveStreamWarning(i,h)}case Si.LIVE_STREAM_RESPONSE_WORKER_LOST:case Si.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var u;if(!this.connection)return;this.connection.tryNextAddress();const h=Array.from(fc(u=this.streamingTasks).call(u));for(const p of h)p.abortTask?p.abortTask():(k.warning("[".concat(this.spec.clientId,"] publish stream status code"),n.code,"try to republish",p.url),this.startLiveStreamingTask(p.url,p.mode,new be(Y.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:n.code})).then(()=>{k.debug("[".concat(this.spec.clientId,"] republish live stream success"),p.url)}).catch(_=>{k.error(_.toString()),this.onLiveStreamError&&this.onLiveStreamError(p.url,_)}));return}}}hasUrl(n){return this.streamingTasks.has(n)}}const tme={name:"LiveStreaming",create:function(e){return new eme(e.joinInfo,e.websocketRetryConfig||pi,e.httpRetryConfig||pi)}};function nme(e){let n=L9();return function(i,s){let c=i.appId;c!==void 0&&(Gn(s,10),Jd(s,c));let u=i.cid;u!==void 0&&(Gn(s,16),Gn(s,u));let h=i.cname;h!==void 0&&(Gn(s,26),Jd(s,h));let p=i.deviceId;p!==void 0&&(Gn(s,34),Jd(s,p));let _=i.elapse;_!==void 0&&(Gn(s,40),im(s,_));let E=i.fileSize;E!==void 0&&(Gn(s,48),im(s,hy(E)));let S=i.height;S!==void 0&&(Gn(s,56),im(s,hy(S)));let w=i.jpg;w!==void 0&&(Gn(s,66),Gn(s,w.length),function(js,Pe){let He=fy(js,Pe.length);js.bytes.set(Pe,He)}(s,w));let I=i.networkType;I!==void 0&&(Gn(s,72),im(s,hy(I)));let P=i.osType;P!==void 0&&(Gn(s,80),im(s,hy(P)));let B=i.requestId;B!==void 0&&(Gn(s,90),Jd(s,B));let M=i.sdkVersion;M!==void 0&&(Gn(s,98),Jd(s,M));let U=i.sequence;U!==void 0&&(Gn(s,104),im(s,hy(U)));let $=i.sid;$!==void 0&&(Gn(s,114),Jd(s,$));let q=i.timestamp;q!==void 0&&(Gn(s,120),im(s,q));let ce=i.uid;ce!==void 0&&(Gn(s,128),Gn(s,ce));let me=i.vid;me!==void 0&&(Gn(s,136),Gn(s,me));let ge=i.width;ge!==void 0&&(Gn(s,144),im(s,hy(ge)));let pe=i.service;pe!==void 0&&(Gn(s,152),Gn(s,pe));let Re=i.callbackData;Re!==void 0&&(Gn(s,162),Jd(s,Re));let Ve=i.jpgEncryption;Ve!==void 0&&(Gn(s,168),Gn(s,Ve));let Ze=i.requestType;Ze!==void 0&&(Gn(s,176),Gn(s,Ze));let rt=i.scorePorn;rt!==void 0&&(Gn(s,185),Dx(s,rt));let un=i.scoreSexy;un!==void 0&&(Gn(s,193),Dx(s,un));let dn=i.scoreNeutral;dn!==void 0&&(Gn(s,201),Dx(s,dn));let nr=i.scene;nr!==void 0&&(Gn(s,208),Gn(s,nr));let Qr=i.ossFilePrefix;Qr!==void 0&&(Gn(s,218),Jd(s,Qr));let jr=i.serviceVendor;if(jr!==void 0)for(let js of jr){Gn(s,226);let Pe=L9();ome(js,Pe),Gn(s,Pe.limit),lme(s,Pe),cme(Pe)}}(e,n),function(i){let s=i.bytes,c=i.limit;return s.length===c?s:s.subarray(0,c)}(n)}function rme(e){return function(i){let s={};e:for(;!x9(i);){let c=Qd(i);switch(c>>>3){case 0:break e;case 1:s.code=Qd(i);break;case 2:s.msg=M9(i,Qd(i));break;case 3:{let u=sme(i);s.data=ime(i),i.limit=u;break}default:k9(i,7&c)}}return s}({bytes:n=e,offset:0,limit:n.length});var n}function ime(e){let n={};e:for(;!x9(e);){let i=Qd(e);switch(i>>>3){case 0:break e;case 1:n.requestId=M9(e,Qd(e));break;case 2:n.requestType=Qd(e)>>>0;break;case 3:n.scorePorn=kx(e);break;case 4:n.scoreSexy=kx(e);break;case 5:n.scoreNeutral=kx(e);break;case 6:n.requestScene=Qd(e)>>>0;break;case 7:n.scene=Qd(e)>>>0;break;default:k9(e,7&i)}}return n}function ome(e,n){let i=e.service;i!==void 0&&(Gn(n,8),Gn(n,i));let s=e.vendor;s!==void 0&&(Gn(n,16),Gn(n,s));let c=e.token;c!==void 0&&(Gn(n,26),Jd(n,c));let u=e.callbackUrl;u!==void 0&&(Gn(n,34),Jd(n,u))}function sme(e){let n=Qd(e),i=e.limit;return e.limit=e.offset+n,i}function k9(e,n){switch(n){case 0:for(;128&U9(e););break;case 2:Px(e,Qd(e));break;case 5:Px(e,4);break;case 1:Px(e,8);break;default:throw new Error("Unimplemented type: "+n)}}let ame=new Float32Array(1);new Uint8Array(ame.buffer);let Ox=new Float64Array(1),ha=new Uint8Array(Ox.buffer);function hy(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let D9=[];function L9(){const e=D9.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function cme(e){D9.push(e)}function Px(e,n){if(e.offset+n>e.limit)throw new Error("Skip past limit");e.offset+=n}function x9(e){return e.offset>=e.limit}function fy(e,n){let i=e.bytes,s=e.offset,c=e.limit,u=s+n;if(u>i.length){let h=new Uint8Array(2*u);h.set(i),e.bytes=h}return e.offset=u,u>c&&(e.limit=u),s}function Nx(e,n){let i=e.offset;if(i+n>e.limit)throw new Error("Read past limit");return e.offset+=n,i}function M9(e,n){let i=Nx(e,n),s=String.fromCharCode,c=e.bytes,u="",h="";for(let p=0;p<n;p++){let _,E,S,w,I=c[p+i];(128&I)==0?h+=s(I):(224&I)==192?p+1>=n?h+=u:(_=c[p+i+1],(192&_)!=128?h+=u:(w=(31&I)<<6|63&_,w<128?h+=u:(h+=s(w),p++))):(240&I)==224?p+2>=n?h+=u:(_=c[p+i+1],E=c[p+i+2],(49344&(_|E<<8))!=32896?h+=u:(w=(15&I)<<12|(63&_)<<6|63&E,w<2048||w>=55296&&w<=57343?h+=u:(h+=s(w),p+=2))):(248&I)==240?p+3>=n?h+=u:(_=c[p+i+1],E=c[p+i+2],S=c[p+i+3],(12632256&(_|E<<8|S<<16))!=8421504?h+=u:(w=(7&I)<<18|(63&_)<<12|(63&E)<<6|63&S,w<65536||w>1114111?h+=u:(w-=65536,h+=s(55296+(w>>10),56320+(1023&w)),p+=3))):h+=u}return h}function Jd(e,n){let i=n.length,s=0;for(let h=0;h<i;h++){let p=n.charCodeAt(h);p>=55296&&p<=56319&&h+1<i&&(p=(p<<10)+n.charCodeAt(++h)-56613888),s+=p<128?1:p<2048?2:p<65536?3:4}Gn(e,s);let c=fy(e,s),u=e.bytes;for(let h=0;h<i;h++){let p=n.charCodeAt(h);p>=55296&&p<=56319&&h+1<i&&(p=(p<<10)+n.charCodeAt(++h)-56613888),p<128?u[c++]=p:(p<2048?u[c++]=p>>6&31|192:(p<65536?u[c++]=p>>12&15|224:(u[c++]=p>>18&7|240,u[c++]=p>>12&63|128),u[c++]=p>>6&63|128),u[c++]=63&p|128)}}function lme(e,n){let i=fy(e,n.limit),s=e.bytes,c=n.bytes;for(let u=0,h=n.limit;u<h;u++)s[u+i]=c[u]}function U9(e){return e.bytes[Nx(e,1)]}function V9(e,n){let i=fy(e,1);e.bytes[i]=n}function kx(e){let n=Nx(e,8),i=e.bytes;return ha[0]=i[n++],ha[1]=i[n++],ha[2]=i[n++],ha[3]=i[n++],ha[4]=i[n++],ha[5]=i[n++],ha[6]=i[n++],ha[7]=i[n++],Ox[0]}function Dx(e,n){let i=fy(e,8),s=e.bytes;Ox[0]=n,s[i++]=ha[0],s[i++]=ha[1],s[i++]=ha[2],s[i++]=ha[3],s[i++]=ha[4],s[i++]=ha[5],s[i++]=ha[6],s[i++]=ha[7]}function Qd(e){let n,i=0,s=0;do n=U9(e),i<32&&(s|=(127&n)<<i),i+=7;while(128&n);return s}function Gn(e,n){for(n>>>=0;n>=128;)V9(e,127&n|128),n>>>=7;V9(e,n)}function im(e,n){let i=n.low>>>0,s=(n.low>>>28|n.high<<4)>>>0,c=n.high>>>24,u=c===0?s===0?i<16384?i<128?1:2:i<1<<21?3:4:s<16384?s<128?5:6:s<1<<21?7:8:c<128?9:10,h=fy(e,u),p=e.bytes;switch(u){case 10:p[h+9]=c>>>7&1;case 9:p[h+8]=u!==9?128|c:127&c;case 8:p[h+7]=u!==8?s>>>21|128:s>>>21&127;case 7:p[h+6]=u!==7?s>>>14|128:s>>>14&127;case 6:p[h+5]=u!==6?s>>>7|128:s>>>7&127;case 5:p[h+4]=u!==5?128|s:127&s;case 4:p[h+3]=u!==4?i>>>21|128:i>>>21&127;case 3:p[h+2]=u!==3?i>>>14|128:i>>>14&127;case 2:p[h+1]=u!==2?i>>>7|128:i>>>7&127;case 1:p[h]=u!==1?128|i:127&i}}function F9(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,s)}return i}const ume=new Map([["moderation",1],["supervise",2]]);class dme extends Rr{get connectionState(){return this._connectionState}set connectionState(n){if(this._connectionState===n)return;const i=this._connectionState;this._connectionState=n,this.emit(Bi.CONNECTION_STATE_CHANGE,i,n)}get inspectType(){return this._inspectType}set inspectType(n){var i;this._inspectMode=ka(i=n.map(s=>ume.get(s)||0)).call(i,(s,c)=>s+c),this._inspectType=n}get quality(){return this._quality}set quality(n){this._quality=n>1?1:n<.1?.1:n,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(n){super(),K(this,"name","AgoraRTCVideoContentInspect"),K(this,"_connectionState",Bl.CONNECTING),K(this,"_innerConnectionState",void 0),K(this,"sequence",0),K(this,"inspectStartTime",void 0),K(this,"workerManagerConnection",void 0),K(this,"workerConnection",void 0),K(this,"workerMessageLengthLimit",void 0),K(this,"inspectIntervalMinimum",void 0),K(this,"qualityRatio",void 0),K(this,"_connectInfo",void 0),K(this,"_cancelTokenSource",Ls.CancelToken.source()),K(this,"_retryConfig",void 0),K(this,"wmSequence",0),K(this,"inspectInterval",void 0),K(this,"inspectTimer",null),K(this,"ossFilePrefix",void 0),K(this,"extraInfo",void 0),K(this,"_inspectType",void 0),K(this,"_inspectMode",void 0),K(this,"_quality",1),K(this,"qualityTimer",null),K(this,"_inspectId",void 0),K(this,"_needWorkUrlOnly",!1),K(this,"inspectImage",()=>{if(this.connectionState!==Bl.CONNECTED)throw new be(Y.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===Bl.CONNECTED?this.requestToInspectImage():k.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=er(5,"inspect-"),this.workerMessageLengthLimit=Z("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=Z("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=Z("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=n.interval,this.ossFilePrefix=n.ossFilePrefix,this.extraInfo=n.extraInfo,this.inspectType=n.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new T0("worker-manager-"+this._inspectId,pi),this.on(Bi.STATE_CHANGE,(i,s)=>{this._innerConnectionState=i,k.debug("[".concat(this._inspectId,"] Inspect operation :").concat(Wl[i]," ").concat(s||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new T0("worker-"+this._inspectId,pi),this.handleWorkerEvents()}async init(n,i){this.emit(Bi.STATE_CHANGE,Wl.CONNECT_AP),this._connectInfo=n;const s=this._cancelTokenSource.token;return this._retryConfig=i,new Qe((c,u)=>{this.on(Bi.CONNECTION_STATE_CHANGE,(h,p)=>{p===Bl.CONNECTED&&c()}),this.requestAP(n,s,i).then(h=>{this.connectWorkerManager(h)}).catch(h=>{u(h)})})}async requestAP(n,i,s){const c=Z("WEBCS_DOMAIN").map(p=>"https://".concat(p,"/api/v1")),u=await function(p,_,E,S){let{appId:w,areaCode:I,cname:P,sid:B,token:M,uid:U}=_;ny++;const $="image_moderation_api",q={service_name:$,json_body:JSON.stringify({appId:w,areaCode:I,cname:P,command:"allocateEdge",requestId:ny,seq:ny,sid:B,token:M,ts:Date.now(),uid:U+""})};let ce,me,ge=p[0];return Bu(async()=>{ce=Date.now();const pe=await Ku(ge,{data:q,cancelToken:E,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(me=Date.now()-ce,pe.code!==0){const rt=new be(Y.UNEXPECTED_RESPONSE,"image inspect ap error, code"+pe.code,{retry:!0,responseTime:me});throw k.error(rt.toString()),rt}const Re=JSON.parse(pe.json_body);if(Re.code!==200){const rt=new be(Y.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(Re.code,", reason: ").concat(Re.reason),{code:Re.code,responseTime:me});throw k.error(rt.toString()),rt}if(!Re.servers||!Array.isArray(Re.servers)||Re.servers.length===0){const rt=new be(Y.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:Re.code,responseTime:me});throw k.error(rt.toString()),rt}const Ve=Z("VIDEO_INSPECT_WORKER_MANAGER_HOST"),Ze=Z("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:Re.servers.map(rt=>{let{address:un,wss:dn}=rt;if(un&&dn)return"wss://".concat(un.replace(/\./g,"-"),".").concat(Ve,":").concat(Ze||dn)}).filter(rt=>!!rt),workerToken:Re.workerToken,vid:Re.vid,responseTime:me}},(pe,Re)=>(pt.apworkerEvent(B,{success:!0,sc:200,serviceName:$,responseDetail:JSON.stringify(pe.addressList),firstSuccess:Re===0,responseTime:me,serverIp:p[Re%p.length]}),!1),(pe,Re)=>(pt.apworkerEvent(B,{success:!1,sc:pe.data&&pe.data.code||200,serviceName:$,responseTime:me,serverIp:p[Re%p.length]}),!!(pe.code!==Y.OPERATION_ABORTED&&pe.code!==Y.UNEXPECTED_RESPONSE||pe.data&&pe.data.retry)&&(ge=p[(Re+1)%p.length],!0)),S)}(c,n,i,s);this.emit(Bi.STATE_CHANGE,Wl.AP_CONNECTED);const{addressList:h}=u;return this.wmSequence++,h}async connectWorkerManager(n){let i=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=i,this.emit(Bi.STATE_CHANGE,Wl.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(n,1e4)}async connectWorker(n){await this.workerConnection.init([n])}handleWorkerManagerEvents(){this.workerManagerConnection.on(Gt.CONNECTED,async()=>{this.emit(Bi.STATE_CHANGE,Wl.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.23.2",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(Gt.CLOSED,()=>{this._innerConnectionState<Wl.GET_WORKER_MANAGER_RESPONSE&&k.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(Gt.FAILED,()=>{this._innerConnectionState<Wl.GET_WORKER_MANAGER_RESPONSE&&k.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(Gt.RECONNECTING,()=>{this._innerConnectionState<Wl.GET_WORKER_MANAGER_RESPONSE&&k.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(Gt.ON_MESSAGE,async n=>{this.emit(Bi.STATE_CHANGE,Wl.GET_WORKER_MANAGER_RESPONSE);const i=this.workerManagerConnection.url;this.workerManagerConnection.close();const s=JSON.parse(n.data);if(s.code!==200)throw k.error("[".concat(this._inspectId,"] Unexpected code ").concat(s.code," from worker manager")),new be(Y.UNEXPECTED_RESPONSE,"response code of worker is unexpected",s);if(!(s.serverResponse&&s.serverResponse.portWss&&i))throw k.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(s))),new be(Y.UNEXPECTED_RESPONSE,"response content of worker is unexpected",s);{const c=Z("VIDEO_INSPECT_WORKER_PORT")||s.serverResponse.portWss,u=i.replace(/:\d+\/?$/,":".concat(c));this.emit(Bi.STATE_CHANGE,Wl.CONNECT_WORKER,u),this._needWorkUrlOnly?this.emit(Bi.REQUEST_NEW_WORKER_URL,u):await this.connectWorker(u)}}),this.workerManagerConnection.on(Gt.WILL_RECONNECT,(n,i,s)=>{s(n)}),this.workerManagerConnection.on(Gt.REQUEST_NEW_URLS,(n,i)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(n).catch(i)})}handleWorkerEvents(){this.workerConnection.on(Gt.CONNECTED,async()=>{this.emit(Bi.STATE_CHANGE,Wl.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=Bl.CONNECTED}),this.workerConnection.on(Gt.ON_MESSAGE,async n=>{if(n.data instanceof ArrayBuffer){const s=rme(new Uint8Array(n.data));if(Z("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&k.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(s)),s.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(Bi.INSPECT_RESULT,void 0,void 0);if(s.data&&s.data.scorePorn&&s.data.scoreSexy&&s.data.scoreNeutral){var i;const c={porn:s.data.scorePorn,sexy:s.data.scoreSexy,neutral:s.data.scoreNeutral},u=ka(i=Object.keys(c)).call(i,(p,_)=>c[p]>c[_]?p:_,"porn"),h=Object.keys(c).find(p=>p===u);this.emit(Bi.INSPECT_RESULT,h)}else this.emit(Bi.INSPECT_RESULT,void 0,new be(Y.UNEXPECTED_RESPONSE,s.code+"","There is an unexpected data on message"))}else this.emit(Bi.INSPECT_RESULT,void 0,new be(Y.UNEXPECTED_RESPONSE,s.code+"",s.msg))}else k.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(Bi.INSPECT_RESULT,void 0,new be(Y.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(Gt.CLOSED,()=>{this.connectionState=Bl.CLOSED}),this.workerConnection.on(Gt.FAILED,()=>{this.connectionState=Bl.CLOSED}),this.workerConnection.on(Gt.RECONNECTING,()=>{this.connectionState=this.connectionState===Bl.CONNECTED?Bl.RECONNECTING:Bl.CONNECTING}),this.workerConnection.on(Gt.WILL_RECONNECT,(n,i,s)=>{n==="recover"&&s(n),s("tryNext")}),this.workerConnection.on(Gt.REQUEST_NEW_URLS,(n,i)=>{this.workerManagerConnection.close(),this.once(Bi.REQUEST_NEW_WORKER_URL,s=>{n([s])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(s=>{this.connectWorkerManager(s,!0)}).catch(s=>{i(s)})})}async requestToInspectImage(){this.sequence++;const n=mc(this,Bi.CLIENT_LOCAL_VIDEO_TRACK),i={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(n){if(!n.isPlaying)return void this.emit(Bi.INSPECT_RESULT,void 0,new be(Y.INVALID_OPERATION,"Only the track being played can be inspected"));const s=await this.generateRequestData(n,i);this.workerConnection.sendMessage(s,!0,!0)}else this.emit(Bi.INSPECT_RESULT,void 0,new be(Y.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(n,i){let{appId:s,cname:c,cid:u,vid:h,sid:p,uid:_}=i;const E=Date.now(),S=await n.getCurrentFrameImage("image/jpeg",this.quality),w=await yW(S,s,c),I=this.sequence+"-"+u+"-"+_+"-"+E+"-"+er(12,""),P={appId:s,cid:u,cname:c,deviceId:"",elapse:(B=Number(E-this.inspectStartTime),{low:B|=0,high:B>>31,unsigned:B>=0}),fileSize:w.byteLength,jpgEncryption:2,height:S.height,width:S.width,jpg:w,networkType:6,osType:7,requestId:I,sdkVersion:"4.23.2",sequence:this.sequence,sid:p,timestamp:$8(E),uid:_,vid:h,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var B;this.extraInfo===void 0&&delete P.callbackData,this.ossFilePrefix===void 0&&delete P.ossFilePrefix;const M=nme(P);if(M.byteLength<this.workerMessageLengthLimit){if(Z("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const U=function($){for(var q=1;q<arguments.length;q++){var ce=arguments[q]!=null?arguments[q]:{};q%2?F9(Object(ce),!0).forEach(function(me){K($,me,ce[me])}):Object.getOwnPropertyDescriptors?Object.defineProperties($,Object.getOwnPropertyDescriptors(ce)):F9(Object(ce)).forEach(function(me){Object.defineProperty($,me,Object.getOwnPropertyDescriptor(ce,me))})}return $}({},P);delete U.jpg,k.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(U))}return M}{const U=this.quality*this.qualityRatio;return this.quality=U,await this.generateRequestData(n,{appId:s,cname:c,cid:u,vid:h,sid:p,uid:_})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Ls.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=Bl.CLOSED,this.emit(Bi.STATE_CHANGE,Wl.CLOSED)}}const hme={name:"ContentInspect",create:function(e){let{config:n}=e;return function(i){if(!i)throw new be(Y.INVALID_PARAMS,"inspectConfig is necessary.");if(!i.inspectType||!Array.isArray(i.inspectType))throw new be(Y.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const s=[...new Set(i.inspectType)];s.forEach(c=>{var u;if(!$e(u=["supervise","moderation"]).call(u,c))throw new be(Y.INVALID_PARAMS,"".concat(c," is not a valid inspect type."))}),i.inspectType=s}if(i&&i.extraInfo&&i.extraInfo.length>1024)throw new be(Y.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(n),new dme(n)}};var j9=l(gt.Object.getOwnPropertySymbols),fme=Pn,pme=Ps.indexOf,mme=jh,Lx=le([].indexOf),B9=!!Lx&&1/Lx([1],1,-0)<0;fme({target:"Array",proto:!0,forced:B9||!mme("indexOf")},{indexOf:function(e){var n=arguments.length>1?arguments[1]:void 0;return B9?Lx(this,e,n)||0:pme(this,e,n)}});var gme=Na("Array").indexOf,_me=N,vme=gme,xx=Array.prototype,Eme=function(e){var n=e.indexOf;return e===xx||_me(xx,e)&&n===xx.indexOf?vme:n},W9=l(Eme);function yme(e,n){if(e==null)return{};var i,s,c=function(h,p){if(h==null)return{};var _,E,S={},w=cz(h);for(E=0;E<w.length;E++)_=w[E],W9(p).call(p,_)>=0||(S[_]=h[_]);return S}(e,n);if(j9){var u=j9(e);for(s=0;s<u.length;s++)i=u[s],W9(n).call(n,i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(c[i]=e[i])}return c}let G9=class{get localCapabilities(){return Lr(this._localCapabilities)}get rtpCapabilities(){return Lr(this._rtpCapabilities)}get candidates(){return Lr(this._candidates)}get iceParameters(){return Lr(this._iceParameters)}get dtlsParameters(){return Lr(this._dtlsParameters)}constructor(e){K(this,"sessionDesc",void 0),K(this,"_localCapabilities",void 0),K(this,"_rtpCapabilities",void 0),K(this,"_candidates",void 0),K(this,"_iceParameters",void 0),K(this,"_dtlsParameters",void 0),K(this,"setup",void 0),K(this,"currentMidIndex",void 0),K(this,"cname","o/i14u9pJrxRKAsu"),K(this,"firefoxSsrcMidMap",new Map),e=Lr(e);const{remoteIceParameters:n,remoteDtlsParameters:i,candidates:s,remoteRTPCapabilities:c,localCapabilities:u,direction:h,setup:p,videoCodec:_,audioCodec:E}=e;let S;this.setup=p,S=h===ds.RECEIVE_ONLY?la(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):la(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=c,this._candidates=s,this._iceParameters=n,this._dtlsParameters=i,this._localCapabilities=u;const w=h===ds.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,I=h===ds.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,P=h===ds.RECEIVE_ONLY?c.send.videoCodecs:R0(ot.VIDEO,w,I,_),B=h===ds.RECEIVE_ONLY?c.send.audioCodecs:R0(ot.AUDIO,w,I,E);for(const M of S.mediaDescriptions)M.attributes.iceUfrag=n.iceUfrag,M.attributes.icePwd=n.icePwd,M.attributes.fingerprints=i.fingerprints,M.attributes.candidates=s,M.attributes.setup=this.setup,M.media.mediaType==="application"&&(M.attributes.sctpPort="5000"),M.media.mediaType==="video"&&(M.media.fmts=P.map(U=>U.payloadType.toString(10)),M.attributes.payloads=P,M.attributes.extmaps=w.videoExtensions),M.media.mediaType==="audio"&&(M.media.fmts=B.map(U=>U.payloadType.toString(10)),M.attributes.payloads=B,M.attributes.extmaps=w.audioExtensions,ty(M));this.sessionDesc=S,this.currentMidIndex=S.mediaDescriptions.length-1}toString(){return Gp(this.sessionDesc)}hasMid(e){return Array.isArray(e)?e.every(n=>this.hasMid(n)):this.sessionDesc.mediaDescriptions.some(n=>n.attributes.mid===e)}send(e,n,i,s,c){i=i.replace(/ /g,"-");const{ssrcs:u,ssrcGroups:h}=i_(n,this.cname,Z("SYNC_GROUP")?i:void 0),p=this.findPreloadMediaDesc(u);if(p){if(Nr()&&this.firefoxSsrcMidMap.set(u[0].ssrcId,p.attributes.mid),c&&(c.twcc||c.remb)){const _=this.sessionDesc.mediaDescriptions.indexOf(p);return this.sessionDesc.mediaDescriptions[_]=this.mungSendMediaDesc(p,c),{mid:p.attributes.mid,needExchangeSDP:!0}}return{mid:p.attributes.mid,needExchangeSDP:!1}}{const _=this.findAvailableMediaIndex(e,u,s);let E;return _===-1?(E=this.createOrRecycleSendMedia(e,u,h,"sendonly",s,c),this.updateBundleMids()):(E=Lr(this.sessionDesc.mediaDescriptions[_]),E.attributes.direction="sendonly",E.attributes.ssrcs=u,E.attributes.ssrcGroups=h,this.sessionDesc.mediaDescriptions[_]=this.mungSendMediaDesc(E,c)),Nr()&&this.firefoxSsrcMidMap.set(u[0].ssrcId,E.attributes.mid),{needExchangeSDP:!0,mid:E.attributes.mid}}}stopSending(e){const n=this.sessionDesc.mediaDescriptions.filter(i=>i.attributes.mid&&e.indexOf(i.attributes.mid)!==-1);if(n.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");n.forEach(i=>{i.attributes.ssrcs=[]}),this.updateBundleMids()}receive(e,n,i){const s=[];return e.forEach(c=>{const u=c._mediaStreamTrack.kind,h=this.findAvailableRecvMediaIndex(u);let p,_=!1;h===-1?(_=!0,p=this.createOrRecycleRecvMedia(c,[],"recvonly",n,i),this.updateBundleMids()):(p=Lr(this.sessionDesc.mediaDescriptions[h]),p.attributes.direction="recvonly"),s.push({mid:p.attributes.mid,needCreateTransceiver:_})}),s}stopReceiving(e){const n=this.sessionDesc.mediaDescriptions.filter(i=>e.indexOf(i.attributes.mid)!==-1);if(n.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");n.forEach(i=>{i.media.port="0",i.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(e){const{foundation:n,protocol:i,address:s,port:c,type:u,relatedAddress:h,relatedPort:p,priority:_}=new RTCIceCandidate(e),E={foundation:n??"",componentId:"1",transport:i??"",priority:_?_+"":"",connectionAddress:s??"",port:c?c+"":"",type:u?u+"":"",relAddr:h??"",relPort:p?p+"":"",extension:{}};this.candidates.some(S=>S.priority===E.priority&&S.connectionAddress===E.connectionAddress&&S.port===E.port)||(this._candidates.push(E),this.sessionDesc.mediaDescriptions.forEach(S=>{S.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(e,n,i,s,c){const u=e._mediaStreamTrack.kind,h=this.rtpCapabilities.recv,p=R0(u,h,this.localCapabilities.send,u===ot.AUDIO?c:s),_=u===ot.VIDEO?h.videoExtensions:h.audioExtensions,E="".concat(++this.currentMidIndex);let S={media:{mediaType:u,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:p.map(I=>I.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:_,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:n,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:p,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(E)}};S=this.mungRecvMediaDsec(S,e);const w=this.findFirstClosedMedia(u);if(w){const I=this.sessionDesc.mediaDescriptions.indexOf(w);this.sessionDesc.mediaDescriptions[I]=S}else this.sessionDesc.mediaDescriptions.push(S);return S}muteRemote(e){const n=this.sessionDesc.mediaDescriptions.filter(i=>$e(e).call(e,i.attributes.mid||""));if(n.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");n.forEach(i=>{i.attributes.direction="inactive"})}unmuteRemote(e){const n=this.sessionDesc.mediaDescriptions.filter(i=>$e(e).call(e,i.attributes.mid||""));if(n.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");n.forEach(i=>{i.attributes.direction="recvonly"})}findAvailableMediaIndex(e,n,i){return this.sessionDesc.mediaDescriptions.findIndex(s=>{const c=s.media.mediaType===e&&s.media.port!=="0"&&(s.attributes.direction==="sendonly"||s.attributes.direction==="sendrecv")&&s.attributes.ssrcs.length===0;if(Nr()){if(c){const u=this.firefoxSsrcMidMap.get(n[0].ssrcId);return!(u||s.attributes.mid!=="0"&&s.attributes.mid!=="1")||!(!u||u!==s.attributes.mid)}return!1}return c&&s.attributes.mid===i})}findAvailableRecvMediaIndex(e){return this.sessionDesc.mediaDescriptions.findIndex(n=>{const i=n.media.mediaType===e&&n.media.port!=="0"&&(n.attributes.direction==="recvonly"||n.attributes.direction==="sendrecv");return n.attributes.mid!=="0"&&n.attributes.mid!=="1"&&i})}predictReceivingMids(e){const n=[];for(let i=0;i<e;i++)n.push((this.currentMidIndex+i+1).toString(10));return n}restartICE(e){e=Lr(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(n=>{n.attributes.iceUfrag=e.iceUfrag,n.attributes.icePwd=e.icePwd})}createOrRecycleSendMedia(e,n,i,s,c,u){const h=this.rtpCapabilities.send,p=e===ot.VIDEO?h.videoCodecs:h.audioCodecs,_=e===ot.VIDEO?h.videoExtensions:h.audioExtensions;Nr()&&(c="".concat(++this.currentMidIndex));let E={media:{mediaType:e,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:p.map(w=>w.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:_,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:n,ssrcGroups:i,rtcpFeedbackWildcards:[],payloads:p,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:s,rtcpMux:!0,rtcpRsize:!0,mid:c}};E=this.mungSendMediaDesc(E,u);const S=this.findFirstClosedMedia(e);if(S){const w=this.sessionDesc.mediaDescriptions.indexOf(S);this.sessionDesc.mediaDescriptions[w]=E}else this.sessionDesc.mediaDescriptions.push(E);return E}mungRecvMediaDsec(e,n,i){const s=Lr(e);return ML(s),ey(s,n),UL(s,n),Dz(s),yA(s,i,this.localCapabilities.send),s}mungSendMediaDesc(e,n){const i=Lr(e);return yA(i,n,this.localCapabilities.recv),ty(i),i}updateRecvMedia(e,n){const i=this.sessionDesc.mediaDescriptions.findIndex(s=>s.attributes.mid===e);if(i!==-1){const s=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[i],n);this.sessionDesc.mediaDescriptions[i]=s}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>e.media.port!=="0").map(e=>e.attributes.mid)}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(n=>{var i;return((i=n.attributes)===null||i===void 0||(i=i.ssrcs[0])===null||i===void 0?void 0:i.ssrcId)===e[0].ssrcId})}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(n=>Nr()?n.media.port==="0"&&n.media.mediaType===e:n.media.port==="0")}};const Sme=["sdp"];var ar;function z9(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,s)}return i}function om(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?z9(Object(i),!0).forEach(function(s){K(e,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):z9(Object(i)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(i,s))})}return e}let H9=(ar=class Ay extends pz{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var n,i;return(n=(i=this.peerConnection.getReceivers()[0])===null||i===void 0||(i=i.transport)===null||i===void 0?void 0:i.state)!==null&&n!==void 0?n:null}get localCodecs(){return[]}set isInRestartIce(n){this._isInRestartIce=n}get isInRestartIce(){return this._isInRestartIce}constructor(n,i,s){super(n,i),K(this,"direction",void 0),K(this,"name",void 0),K(this,"store",void 0),K(this,"spec",void 0),K(this,"peerConnection",void 0),K(this,"initialOffer",void 0),K(this,"transport",void 0),K(this,"statsFilter",void 0),K(this,"localCandidateCount",0),K(this,"_isInRestartIce",!1),K(this,"mutex",void 0),K(this,"onLocalCandidate",void 0),K(this,"remoteSDP",void 0),K(this,"pendingCandidates",[]),K(this,"localCapabilities",void 0),K(this,"isReady",!1),K(this,"restartCnt",0),K(this,"curTurnServerIndex",0),this.store=i,this.spec=n,this.mutex=new To("P2PConnection-mutex",i.clientId),this.peerConnection=new RTCPeerConnection(Ay.resolvePCConfiguration(n,i.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=s??ds.SEND_ONLY,this.name=this.direction===ds.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=X1(this.peerConnection,Z("STATS_UPDATE_INTERVAL"),void 0,Nr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(n){try{const i=await xz();if(this.localCapabilities=SA(i),n){const{sdp:s}=n,c=yme(n,Sme),u=function(){const S={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},w=w0(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),I={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},P={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},B={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Gl(w,S,"videoExtensions",I,P,B),Gl(w,S,"videoCodecs",I,P,B),Gl(w,S,"audioExtensions",I,P,B),Gl(w,S,"audioCodecs",I,P,B),Z("RAISE_H264_BASELINE_PRIORITY")){const M=B.videoCodecs.findIndex(U=>U.rtpMap&&U.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&U.fmtp&&U.fmtp.parameters["profile-level-id"]==="42001f");if(M!==-1){const U=B.videoCodecs.findIndex($=>$.rtpMap&&$.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(U<M){k.debug("raising H264 baseline profile priority");const $=B.videoCodecs[M];B.videoCodecs.splice(M,1),B.videoCodecs.splice(U,0,$)}U!==-1&&Z("FILTER_SEND_H264_BASELINE")&&(I.videoCodecs=I.videoCodecs.filter($=>!($.rtpMap&&$.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&$.fmtp&&$.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:I,recv:P,sendrecv:B}}({},{},s);this.remoteSDP=new G9({remoteIceParameters:c.iceParameters,remoteDtlsParameters:c.dtlsParameters,candidates:[],remoteRTPCapabilities:u,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const h=await this.peerConnection.createAnswer();if(!h.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const p=qp(h.sdp);await this.peerConnection.setLocalDescription(h);const _=await Mz({},{},h.sdp);this.localCapabilities=SA(_);const E=this.peerConnection.getTransceivers()[0];return E!=null&&E.receiver&&E.receiver.transport&&this.tryBindTransportEvents(E.receiver.transport),om(om({},p),{},{sdp:h.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const s=await this.peerConnection.createOffer();if(!s.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const c=qp(s.sdp);return this.initialOffer=s,om(om({},c),{},{sdp:s.sdp})}}catch(i){throw new Ie(Y.GET_LOCAL_CONNECTION_PARAMS_FAILED,i.toString())}}async connect(n){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:i,iceParameters:s,dtlsParameters:c}=n,u=await Mz({},{},i);this.remoteSDP=new G9({remoteIceParameters:s,remoteDtlsParameters:c,candidates:[],remoteRTPCapabilities:u,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const h=this.peerConnection.getTransceivers()[0];h!=null&&h.sender&&h.sender.transport&&this.tryBindTransportEvents(h.sender.transport)}catch(i){throw new Ie(Y.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(i.toString()))}}async addRemoteCandidate(n){try{n&&this.pendingCandidates.push(n),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(i=>{this.peerConnection.addIceCandidate(i)}),this.pendingCandidates=[])}catch(i){throw new Ie(Y.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(i.toString()))}}send(n,i,s){var c=this;return Zc(function*(){const u=yield _n(c.mutex.lock("From P2PConnection.send"));try{if(!c.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const h=[],p=c.remoteSDP.receive(n,i,s);n.forEach((U,$)=>{if(p[$].needCreateTransceiver){const q=c.peerConnection.addTransceiver(U._mediaStreamTrack,{direction:"sendonly"});h.push(q),U._updateRtpTransceiver(q)}else{const q=c.peerConnection.getTransceivers().find(ce=>ce.mid===p[$].mid);if(!q)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(p[$].mid));h.push(q),U._updateRtpTransceiver(q)}}),Nr()&&Z("SIMULCAST")===!0&&(yield _n(c.applySimulcastForFirefox(h,n)));const _=p.map(U=>U.mid),E=yield _n(c.peerConnection.createOffer()),S=c.mungSendOfferSDP(E.sdp,n,_),w=la(S),I=_.map(U=>{const $=w.mediaDescriptions.find(q=>q.attributes.mid===U);if(!$)throw new Error("Cannot extract ssrc from mediaDescription.");return Pz($,Z("USE_PUB_RTX"))}),P=h.map((U,$)=>{const q=_[$];return{localSSRC:I[$],id:q}});yield _n(c.peerConnection.setLocalDescription({type:"offer",sdp:S}));try{yield P}catch(U){const $=c.remoteSDP.toString();throw yield _n(c.peerConnection.setLocalDescription({type:"offer",sdp:S})),yield _n(c.peerConnection.setRemoteDescription({type:"answer",sdp:$})),yield _n(c.stopSending(_,!0)),U}yield _n(c.applySimulcastEncodings(h,n)),yield _n(c.applySendEncodings(h,n));const B=c.remoteSDP.toString(),M=c.logSDPExchange(S,"offer","local","send");return M==null||M(B),yield _n(c.setRemoteDescription({type:"answer",sdp:B})),h.map((U,$)=>{const q=_[$];return{localSSRC:I[$],id:q}})}catch(h){throw h instanceof Ie?h:new Ie(Y.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{u()}})()}async stopSending(n,i){const s=i?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const c=this.peerConnection.getTransceivers().filter(_=>n.indexOf(_.mid)!==-1);if(c.length!==n.length)throw new Error("Transceivers' length (".concat(c.length,") doesn't match mids' length (").concat(n.length,") when trying to call P2PConnection.stopSending."));c.map(_=>{var E;_.direction="inactive",(E=_.stop)===null||E===void 0||E.call(_)});const u=await this.peerConnection.createOffer(),h=this.logSDPExchange(u.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(u),this.remoteSDP.stopReceiving(n);const p=this.remoteSDP.toString();h==null||h(p),await this.setRemoteDescription({type:"answer",sdp:p})}catch(c){throw new Ie(Y.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(c.toString()))}finally{s&&s()}}async receive(n,i,s,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(n," before remoteSDP created."));const{mid:u,needExchangeSDP:h}=this.remoteSDP.send(n,i,s,c);if(h){const _=this.remoteSDP.toString(),E=this.logSDPExchange(_,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:_});const S=await this.peerConnection.createAnswer(),w=this.mungReceiveAnswerSDP(S.sdp,u,n);E==null||E(w||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:w}),k.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(n," by exchanging SDP."))}else k.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(n," no need to exchange SDP."));const p=this.peerConnection.getTransceivers().find(_=>_.mid===u);if(!p||p.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:p.receiver.track,mid:p.mid,transceiver:p}}catch(u){throw new Ie(Y.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async mockReceive(n,i,s,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(n," before remoteSDP created."));const{mid:u,needExchangeSDP:h}=this.remoteSDP.send(n,i,s,c);if(h){const p=this.remoteSDP.toString(),_=this.logSDPExchange(p,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:p});const E=await this.peerConnection.createAnswer(),S=this.mungReceiveAnswerSDP(E.sdp,u,n);_==null||_(S||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:S}),k.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(n," by exchanging SDP."))}else k.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(n," no need to exchange SDP."))}catch(u){throw new Ie(Y.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async stopReceiving(n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(n);const i=this.remoteSDP.toString(),s=this.logSDPExchange(i,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:i});const c=await this.peerConnection.createAnswer();s==null||s(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(i){throw new Ie(Y.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}async restartICE(n){try{if(this.store.p2pTransport===Xg.Auto&&(this.store.p2pTransport=Xg.SdRtn,Cn().supportPCSetConfiguration&&this.peerConnection.setConfiguration(Ay.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,Cn().supportPCSetConfiguration&&this.peerConnection.setConfiguration(Ay.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!n){this.restartCnt++,this.isReady=!1;const i=await this.peerConnection.createOffer({iceRestart:!0});if(!i.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:s}=qp(i.sdp);return this.store.descriptionStart(),this.direction===ds.SEND_ONLY&&await this.peerConnection.setLocalDescription(i),s}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(n),this.store.descriptionStart(),this.direction===ds.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const i=await this.peerConnection.createAnswer();if(!i.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:s}=qp(i.sdp);return await this.peerConnection.setLocalDescription(i),s}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(i){throw new Ie(Y.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}close(){var n;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(n=this.onConnectionStateChange)===null||n===void 0||n.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(n){return this.statsFilter.getVideoIsReady(n)}async updateEncoderConfig(n,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const s=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(s.sdp,[i],[n]);this.remoteSDP.updateRecvMedia(n,i);const u=this.remoteSDP.toString(),h=this.logSDPExchange(c,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),h==null||h(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(s){throw new Ie(Y.EXCHANGE_SDP_FAILED,s.toString())}}async updateSendParameters(n,i){const s=this.peerConnection.getTransceivers().filter(c=>c.mid===n);s.length===1&&(this.isVP8Simulcast(i)?Nr()||await this.applySimulcastEncodings(s,[i]):await this.applySendEncodings(s,[i]))}setStatsRemoteVideoIsReady(n,i){this.statsFilter.setVideoIsReady2(n,i)}async replaceTrack(n,i){const s=this.peerConnection.getTransceivers().find(c=>c.mid===i);s&&await s.sender.replaceTrack(n._mediaStreamTrack)}async getSelectedCandidatePair(){const n=this.peerConnection.getReceivers();if(n.length>0&&n[0].transport&&n[0].transport.iceTransport&&n[0].transport.iceTransport.getSelectedCandidatePair&&n[0].transport.iceTransport.getSelectedCandidatePair()){const i=n[0].transport.iceTransport,{local:s,remote:c}=i.getSelectedCandidatePair();return{local:om(om({},Vd),{},{candidateType:s.type,protocol:s.protocol,address:s.address,port:s.port}),remote:om(om({},Vd),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var n,i;$e(n=["connected","completed"]).call(n,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(i=this.onICEConnectionStateChange)===null||i===void 0||i.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var n;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(n=this.onConnectionStateChange)===null||n===void 0||n.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=n=>{if(n.candidate){var i;n.candidate.candidate&&((i=this.onLocalCandidate)===null||i===void 0||i.call(this,n.candidate.toJSON())),this.localCandidateCount+=1}else k.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(n,i){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const c={iceServers:[]};var u;return n.iceServers?c.iceServers=n.iceServers:n.turnServer&&n.turnServer.mode!=="off"&&(d0(n.turnServer.servers)?c.iceServers=n.turnServer.servers:(c.iceServers&&c.iceServers.push(...Ay.turnServerConfigToIceServers(n.turnServer.servers,i,s)),Z("USE_TURN_SERVER_OF_GATEWAY")&&c.iceServers&&n.turnServer.serversFromGateway&&c.iceServers.push(...Ay.turnServerConfigToIceServers(n.turnServer.serversFromGateway,i,s)),$e(u=[Xg.Relay,Xg.SdRtn]).call(u,i)&&(c.iceTransportPolicy="relay"),Z("FORCE_TURN_TCP")?c.iceTransportPolicy="relay":n.turnServer.servers.concat(n.turnServer.serversFromGateway||[]).forEach(h=>{h.forceturn&&(c.iceTransportPolicy="relay")}))),Z("ENABLE_ENCODED_TRANSFORM")&&Cn().supportWebRTCEncodedTransform&&(c.encodedInsertableStreams=!0),k.debug("P2PConnection p2pTransport is ".concat(i)),c}static turnServerConfigToIceServers(n,i){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const c=[],u=n.filter(p=>p.tcpport);k.debug("P2PConnection turnServers is ".concat(u,", current index is ").concat(s));const h=u.length>s?u[s]:u[0];switch(i){case Xg.SdRtn:const p=n.filter(E=>{var S;return $e(S=E.username).call(S,"glb:")&&E.turnServerURL==E.turnServerURL}),_=p.length>s?p[s]:p[0];_&&(c.push({username:_.username,credential:_.password,credentialType:"password",urls:"turn:".concat(Kp(_.turnServerURL),":").concat(_.tcpport,"?transport=udp")}),c.push({username:_.username,credential:_.password,credentialType:"password",urls:"turns:".concat(Kp(_.turnServerURL),":").concat(_.tcpport,"?transport=tcp")}));break;case Xg.Relay:h&&(c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(h.turnServerURL,":").concat(h.tcpport,"?transport=udp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat(Kp(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}));break;default:h&&(c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(h.turnServerURL,":").concat(h.tcpport,"?transport=udp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat(Kp(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"stun:".concat(h.turnServerURL,":").concat(h.tcpport)}))}return c}tryBindTransportEvents(n){if(n){this.transport=n,n.onstatechange=()=>{var s;n!=null&&n.state&&((s=this.onDTLSTransportStateChange)===null||s===void 0||s.call(this,n.state))},n.onerror=s=>{var c;(c=this.onDTLSTransportError)===null||c===void 0||c.call(this,"error"in s?s.error:s)};const i=n.iceTransport;i&&(i.onstatechange=()=>{const s=n==null?void 0:n.iceTransport.state;var c;s&&((c=this.onICETransportStateChange)===null||c===void 0||c.call(this,s))},i.getSelectedCandidatePair&&(i.onselectedcandidatepairchange=()=>{if(i.getSelectedCandidatePair()){const{local:s,remote:c}=i.getSelectedCandidatePair();k.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:s.type,protocol:s.protocol}),", remote ").concat(JSON.stringify({candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})," )"))}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(n,i){var s;if(i||(i=this.peerConnection.getSenders().find(S=>S.track===n._mediaStreamTrack)),!i)return k.warn("[".concat(n.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(n))return k.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Cn().supportSetRtpSenderParameters)return k.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const c={},u={};switch(n._optimizationMode){case"motion":c.degradationPreference="maintain-framerate";break;case"detail":c.degradationPreference="maintain-resolution";break;default:c.degradationPreference="balanced"}if(n._encoderConfig){var h;const{bitrateMax:S,frameRate:w,scaleResolutionDownBy:I}=n._encoderConfig;S&&(u.maxBitrate=1e3*S),$e(h=n._hints).call(h,tr.LOW_STREAM)&&(w&&(u.maxFramerate=Ba(w)),I&&I>=1&&(u.scaleResolutionDownBy=I))}if(Z("DSCP_TYPE")&&df()){var p;const S=Z("DSCP_TYPE");$e(p=["very-low","low","medium","high"]).call(p,S)&&(u.networkPriority=S)}const _=i.getParameters(),E=(s=_.encodings)===null||s===void 0?void 0:s[0];Nr()&&!E&&(c.encodings=[u]),E&&Object.assign(E,u),Object.assign(_,c),k.debug("[".concat(n.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(_.encodings))),await i.setParameters(_)}async applySendEncodings(n,i){try{if(!Cn().supportSetRtpSenderParameters||n.length!==i.length)return;for(let s=0;s<n.length;s++){const c=n[s],u=i[s];u instanceof ur&&!this.isVP8Simulcast(u)&&await this.updateRtpSenderEncodings(u,c.sender)}}catch{k.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(n,i,s){const c=la(n);return i.forEach((u,h)=>{const p=s[h],_=c.mediaDescriptions.find(E=>E.attributes.mid===p);_&&(ey(_,u),Lz(_,u,this.store.codec))}),Gp(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=n=>{var i;(i=this.onFirstAudioReceived)===null||i===void 0||i.call(this,n)},this.statsFilter.onFirstVideoReceived=n=>{var i;(i=this.onFirstVideoReceived)===null||i===void 0||i.call(this,n)},this.statsFilter.onFirstAudioDecoded=n=>{var i;(i=this.onFirstAudioDecoded)===null||i===void 0||i.call(this,n)},this.statsFilter.onFirstVideoDecoded=(n,i,s)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,n,i,s)},this.statsFilter.onSelectedLocalCandidateChanged=(n,i)=>{var s;(s=this.onSelectedLocalCandidateChanged)===null||s===void 0||s.call(this,n,i)},this.statsFilter.onSelectedRemoteCandidateChanged=(n,i)=>{var s;(s=this.onSelectedRemoteCandidateChanged)===null||s===void 0||s.call(this,n,i)},this.statsFilter.onFirstVideoDecodedTimeout=n=>{var i;(i=this.onFirstVideoDecodedTimeout)===null||i===void 0||i.call(this,n)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(n,i){if(n.length===i.length)for(let _=0;_<n.length;_++){var s,c,u,h,p;const E=n[_],S=i[_];if(S instanceof ur&&!$e(s=S._hints).call(s,tr.LOW_STREAM)&&(c=S._encoderConfig)!==null&&c!==void 0&&c.bitrateMax&&((u=S._encoderConfig)===null||u===void 0?void 0:u.bitrateMax)>200&&(h=S._scalabilityMode)!==null&&h!==void 0&&h.numSpatialLayers&&((p=S._scalabilityMode)===null||p===void 0?void 0:p.numSpatialLayers)>1&&this.store.codec==="vp8"){const w={},I={high:1e3*(S._encoderConfig.bitrateMax-50),medium:5e4};w.encodings=[{rid:"m",active:!0,maxBitrate:I.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:I.high}];const P=E.sender.getParameters();await E.sender.setParameters(Object.assign(P,w))}}}async applySimulcastEncodings(n,i){if(!Nr()&&n.length===i.length)for(let s=0;s<n.length;s++){const c=i[s];if(c instanceof ur&&this.isVP8Simulcast(c)){const u=n[s],h={},p={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};h.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:p.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:p.medium,scaleResolutionDownBy:4}];const _=u.sender.getParameters();await u.sender.setParameters(Object.assign(_,h))}}}isVP8Simulcast(n){var i,s,c,u,h;return!!(n instanceof ur&&Z("SIMULCAST")&&this.store.codec==="vp8"&&!$e(i=n._hints).call(i,tr.LOW_STREAM)&&(s=n._encoderConfig)!==null&&s!==void 0&&s.bitrateMax&&((c=n._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(u=n._scalabilityMode)!==null&&u!==void 0&&u.numSpatialLayers&&((h=n._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1)}logSDPExchange(n,i,s,c){if(Z("SDP_LOGGING"))return k.upload("[".concat(this.store.clientId,"] exchanging ").concat(s," ").concat(i," SDP during P2PConnection.").concat(c,`
`),n),i==="offer"?u=>{this.logSDPExchange(u,"answer",s==="local"?"remote":"local",c)}:void 0}async muteLocal(n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const i=this.peerConnection.getTransceivers().filter(h=>h.mid&&n.indexOf(h.mid)!==-1);if(i.length!==n.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(h=>{h.direction="inactive"});const s=await this.peerConnection.createOffer(),c=this.logSDPExchange(s.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(s),this.remoteSDP.muteRemote(n);const u=this.remoteSDP.toString();c==null||c(u),await this.setRemoteDescription({type:"answer",sdp:u})}catch(i){throw new Ie(Y.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(i.toString()))}}async unmuteLocal(n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const i=this.peerConnection.getTransceivers().filter(h=>h.mid&&n.indexOf(h.mid)!==-1);if(i.length!==n.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(async h=>{h.direction="sendonly"});const s=await this.peerConnection.createOffer(),c=this.logSDPExchange(s.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(s),this.remoteSDP.unmuteRemote(n);const u=this.remoteSDP.toString();c==null||c(u),await this.setRemoteDescription({type:"answer",sdp:u})}catch(i){throw new Ie(Y.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(i.toString()))}}async getRemoteSSRC(n,i){var s,c;if(i=(s=i)!==null&&s!==void 0?s:(c=this.currentRemoteDescription)===null||c===void 0?void 0:c.sdp){var u;const h=(u=la(i).mediaDescriptions.find(p=>p.attributes.mid===n))===null||u===void 0?void 0:u.attributes.ssrcs;return h==null?void 0:h[0].ssrcId}}async setRemoteDescription(n){var i;await this.peerConnection.setRemoteDescription(n),$e(i=["connected","completed"]).call(i,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(n,i,s){const c=la(n),u=c.mediaDescriptions.find(h=>h.attributes.mid===i);return u&&s===ot.AUDIO&&u.media.mediaType==="audio"&&ty(u),Gp(c)}},ut(ar.prototype,"establish",[ql],Object.getOwnPropertyDescriptor(ar.prototype,"establish"),ar.prototype),ut(ar.prototype,"connect",[ql],Object.getOwnPropertyDescriptor(ar.prototype,"connect"),ar.prototype),ut(ar.prototype,"receive",[ql],Object.getOwnPropertyDescriptor(ar.prototype,"receive"),ar.prototype),ut(ar.prototype,"mockReceive",[ql],Object.getOwnPropertyDescriptor(ar.prototype,"mockReceive"),ar.prototype),ut(ar.prototype,"stopReceiving",[ql],Object.getOwnPropertyDescriptor(ar.prototype,"stopReceiving"),ar.prototype),ut(ar.prototype,"restartICE",[ql],Object.getOwnPropertyDescriptor(ar.prototype,"restartICE"),ar.prototype),ut(ar.prototype,"close",[ql],Object.getOwnPropertyDescriptor(ar.prototype,"close"),ar.prototype),ut(ar.prototype,"updateEncoderConfig",[ql],Object.getOwnPropertyDescriptor(ar.prototype,"updateEncoderConfig"),ar.prototype),ut(ar.prototype,"updateSendParameters",[ql],Object.getOwnPropertyDescriptor(ar.prototype,"updateSendParameters"),ar.prototype),ut(ar.prototype,"replaceTrack",[ql],Object.getOwnPropertyDescriptor(ar.prototype,"replaceTrack"),ar.prototype),ut(ar.prototype,"muteLocal",[ql],Object.getOwnPropertyDescriptor(ar.prototype,"muteLocal"),ar.prototype),ut(ar.prototype,"unmuteLocal",[ql],Object.getOwnPropertyDescriptor(ar.prototype,"unmuteLocal"),ar.prototype),ar);function ql(e,n,i){const s=e[n];if(typeof s!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const c=this.mutex,u=await c.lock("From P2PConnection.".concat(n));try{for(var h=arguments.length,p=new Array(h),_=0;_<h;_++)p[_]=arguments[_];return await s.apply(this,p)}finally{u()}},i}let qu=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({});var K9,$9,q9,Y9,X9,J9,Q9,Z9,eK,tK,nK,Sr;function rK(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,s)}return i}function rO(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?rK(Object(i),!0).forEach(function(s){K(e,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):rK(Object(i)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(i,s))})}return e}let Tme=(K9=Yu(qu.SEND_ONLY),$9=Yu(qu.SEND_ONLY),q9=Yu(),Y9=Yu(qu.RECEIVE_ONLY),X9=Yu(qu.RECEIVE_ONLY),J9=Yu(qu.RECEIVE_ONLY),Q9=Yu(qu.RECEIVE_ONLY),Z9=Yu(qu.RECEIVE_ONLY),eK=Yu(qu.RECEIVE_ONLY),tK=Yu(),nK=Yu(qu.RECEIVE_ONLY),Sr=class extends Rr{get state(){return this._state}set state(e){const n=this._state;this._state=e,this.emit(Rt.StateChange,n,this._state)}constructor(e,n){super(),K(this,"isPlanB",!1),K(this,"store",void 0),K(this,"statsUploader",void 0),K(this,"sendConnection",void 0),K(this,"recvConnection",void 0),K(this,"localTrackMap",new Map),K(this,"remoteUserMap",new Map),K(this,"localDataChannels",[]),K(this,"pendingLocalTracks",[]),K(this,"pendingRemoteTracks",[]),K(this,"statsCollector",void 0),K(this,"dtlsFailedCount",0),K(this,"sendMutex",void 0),K(this,"recvMutex",void 0),K(this,"_state",Un.Disconnected),K(this,"_restartStates",["disconnected","failed"]),K(this,"reconnectInterval",void 0),K(this,"uploadUnplinkStarted",!1),K(this,"uploadDownlinkStarted",!1),K(this,"uplinkStateUploadInterval",void 0),K(this,"downlinkStatsUploadInterval",void 0),K(this,"handleMuteLocalTrack",async(i,s,c)=>{const u=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==Un.Connected)return void c(new Ie(Y.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const _=this.filterTobeMutedTracks(i);if(_.length===0)return void s();const E=_.find(P=>P[0]==="videoLowTrack");E&&E[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(_.map(P=>{let[,{id:B}]=P;return B}));let S=!1;var h,p;i.trackMediaType==="video"?S=!((h=this.localTrackMap.get(xe.LocalAudioTrack))===null||h===void 0||!h.track._muted):S=((p=this.localTrackMap.get(xe.LocalVideoTrack))===null||p===void 0?void 0:p.id)===void 0;const w=this.createMuteMessage(_);await Zn(this,Rt.RequestMuteLocal,w);const I=i.trackMediaType==="video"?Hp.MUTE_LOCAL_VIDEO:Hp.MUTE_LOCAL_AUDIO;await Zn(this,Rt.RequestP2PMuteLocal,{action:I,message:w,isMuteAll:S}),s()}catch(_){c(_)}finally{u()}}),K(this,"handleUnmuteLocalTrack",async(i,s,c)=>{const u=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==Un.Connected)return void c(new Ie(Y.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const h=this.filterTobeUnmutedTracks(i);if(h.length===0)return void s();await this.sendConnection.unmuteLocal(h.map(E=>{let[,{id:S}]=E;return S}));const p=this.createUnmuteMessage(h),_=i.trackMediaType==="video"?Hp.UNMUTE_LOCAL_VIDEO:Hp.UNMUTE_LOCAL_AUDIO;await Zn(this,Rt.RequestP2PMuteLocal,{action:_,message:p}),s()}catch(h){c(h)}finally{u()}}),K(this,"handleUpdateVideoEncoder",async(i,s,c,u)=>{let h;typeof u=="boolean"&&u||(h=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{const _=this.localTrackMap.get(xe.LocalVideoTrack);if(!this.sendConnection||!_||_.track!==i||this.state!==Un.Connected)return void s();const{id:E,track:S}=_;E&&(await this.sendConnection.updateSendParameters(E,S),await this.sendConnection.updateEncoderConfig(E,S),this.emit(Rt.UpdateVideoEncoder,S)),s()}catch(_){c(_)}finally{var p;(p=h)===null||p===void 0||p()}}),K(this,"handleUpdateVideoSendParameters",async(i,s,c)=>{const u=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const h=this.localTrackMap.get(xe.LocalVideoTrack);if(!this.sendConnection||!h||h.track!==i||this.state!==Un.Connected)return void s();const{id:p,track:_}=h;p&&await this.sendConnection.updateSendParameters(p,_),s()}catch(h){c(h)}finally{u()}}),K(this,"handleReplaceTrack",async(i,s,c,u)=>{let h;k.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(i.getTrackId(),"]")),typeof u=="boolean"&&u||(h=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var p;const E=Array.from(this.localTrackMap.entries()).find(S=>{let[,{track:w}]=S;return i===w});if(!this.sendConnection||!E||E[1].id===void 0||this.state!==Un.Connected)return void s();if(await((p=this.sendConnection)===null||p===void 0?void 0:p.replaceTrack(i,E[1].id)),E[0]===xe.LocalVideoTrack&&Cn().supportDualStreamEncoding){const S=this.localTrackMap.get(xe.LocalVideoLowTrack);if(S){const w=i._mediaStreamTrack.clone();S.track._originMediaStreamTrack.stop(),S.track._mediaStreamTrack=w,S.track._originMediaStreamTrack=w,await new Qe((I,P)=>{this.handleReplaceTrack(S.track,I,P,!0)})}}s()}catch(E){c(E)}finally{var _;(_=h)===null||_===void 0||_()}}),K(this,"handleGetLocalVideoStats",i=>{i(this.statsCollector.getLocalVideoTrackStats())}),K(this,"handleGetLocalAudioStats",i=>{i(this.statsCollector.getLocalAudioTrackStats())}),K(this,"handleGetRemoteVideoStats",i=>this.statsCollector.getRemoteVideoTrackStats(i.uid)[i.uid]),K(this,"handleGetRemoteAudioStats",i=>this.statsCollector.getRemoteAudioTrackStats(i.uid)[i.uid]),this.store=e,this.statsCollector=n,this.statsCollector.addP2PChannel(this),this.statsUploader=new S8(e),this.bindStatsUploaderEvents(),this.sendMutex=new To("P2PChannel2-send-mutex",e.clientId),this.recvMutex=new To("P2PChannel2-recv-mutex",e.clientId),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(i=>{i&&(i.iceConnectionState!=="disconnected"&&i.iceConnectionState!=="failed"||this.handleDisconnect(i.direction))})},Z("ICE_RESTART_INTERVAL"))}async startP2PConnection(e,n){throw new Ie(Y.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(e){throw new Ie(Y.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(e,n){let i;try{if(n){this.recvConnection&&(k.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),i=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new H9(e,this.store,ds.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const s=await this.recvConnection.establish(n);return{iceParameters:s.iceParameters,dtlsParameters:s.dtlsParameters,sdp:s.sdp}}{this.state=Un.New,this.sendConnection&&(k.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),i=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new H9(e,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const s=await this.sendConnection.establish();return{iceParameters:s.iceParameters,dtlsParameters:s.dtlsParameters,sdp:s.sdp}}}finally{i&&i()}}async p2pConnect(e){if(!this.sendConnection)throw new Ie(Y.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Un.Connected}async addRemoteCandidate(e,n){if(n===ds.RECEIVE_ONLY){if(!this.sendConnection)throw new Ie(Y.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(e)}else{if(!this.recvConnection)throw new Ie(Y.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(e)}}publish(e,n,i){var s=this;return Zc(function*(){const c=yield _n(s.sendMutex.lock("From P2PChannel.publish"));try{if(!s.sendConnection||s.state!==Un.Connected){s.throwIfTrackTypeNotMatch(e);const E=e.filter(S=>s.pendingLocalTracks.indexOf(S)===-1);return void(s.pendingLocalTracks=s.pendingLocalTracks.concat(E))}s.store.pubId=s.store.pubId+1,Ro.markPublishStart(s.store.clientId,s.store.pubId);const u=s.filterTobePublishedTracks(e,n,i);if(u.length===0)return void(yield _n(s.tryToUnmuteAudio(e)));u.forEach(E=>{let{track:S,type:w}=E;const I=Date.now();s.store.publish(S.getTrackId(),w===xe.LocalAudioTrack?"audio":"video",I)}),s.bindLocalTrackEvents(u);const h=yield _n(s.sendConnection.send(u.map(E=>{let{track:S}=E;return S}),s.store.codec,s.store.audioCodec)),p=(yield _n(h.next())).value,_=s.createGatewayPublishMessage(u,p);try{yield _}catch(E){throw h.throw(E),(E==null?void 0:E.code)===Y.WS_ABORT&&u.forEach(S=>{let{track:w}=S;s.pendingLocalTracks.indexOf(w)===-1&&s.pendingLocalTracks.push(w)}),s.unbindLocalTrackEvents(u),E}yield _n(h.next()),u.forEach(E=>{let{type:S}=E;s.statsCollector.addLocalStats(S)}),s.statsUploader.startUploadOutboundStats(),s.assignLocalTracks(u,p),u.forEach(E=>{let{track:S,type:w}=E;const I=Date.now();s.store.publish(S.getTrackId(),w===xe.LocalAudioTrack?"audio":"video",void 0,I)}),s.startUploadUplinkState()}finally{c()}})()}async unpublish(e){if(!this.sendConnection||this.state!==Un.Connected)return void(e.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(c=>!$e(e).call(e,c)));const n=this.filterTobeUnpublishedTracks(e);if(n.length===0)return;const i=n.find(c=>c[0]==="videoLowTrack");i&&i[1].track.close();const s=this.createGatewayUnpublishMessage(n);if(await this.sendConnection.stopSending(n.map(c=>{let[,{id:u}]=c;return u})),this.withdrawLocalTracks(n),this.unbindLocalTrackEvents(n.map(c=>{let[u,{track:h}]=c;return{type:u,track:h}})),n.forEach(c=>{let[u]=c;this.statsCollector.removeLocalStats(u)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===Un.Connected)return i&&i[1].track.close(),s;e.forEach(c=>{const u=this.pendingLocalTracks.indexOf(c);u!==-1&&this.pendingLocalTracks.splice(u,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const e=()=>{const n=[],i=[];Array.from(this.localTrackMap.entries()).forEach(s=>{let[c,{track:u,ssrcs:h}]=s;const p={stream_type:ffe(u,c),ssrcs:h};u._muted||!u._enabled?n.push(p):i.push(p)}),n.length>0&&n.forEach(s=>{Zn(this,Rt.RequestMuteLocal,[s])}),i.length>0&&i.forEach(s=>{Zn(this,Rt.RequestUnmuteLocal,[s])})};e(),this.uplinkStateUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(e){return Zc(function*(){throw new Ie(Y.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(k.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await ho(this,Rt.RequestRePublish,this.pendingLocalTracks),this.emit(Rt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new Ie(Y.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(e,n,i,s){var c;if(!this.recvConnection)throw new Ie(Y.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((c=this.remoteUserMap.get(e))!==null&&c!==void 0&&c.has(n))return;const{track:u,mid:h,transceiver:p}=await this.recvConnection.receive(n,[{ssrcId:i}],String(e.uid),s);n===ot.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(u):(e._audioTrack=new KE(u,e.uid,e._uintid,this.store),k.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),p&&e._audioTrack._updateRtpTransceiver(p),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoSSRC=i,e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(u):(e._videoTrack=new HE(u,e.uid,e._uintid,this.store),k.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),p&&e._videoTrack._updateRtpTransceiver(p),this.bindRemoteTrackEvents(e,e._videoTrack));const _=this.remoteUserMap.get(e);_?_.set(n,h):this.remoteUserMap.set(e,new Map([[n,h]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const E=this.pendingRemoteTracks.findIndex(S=>{let{user:w,kind:I}=S;return w.uid===e.uid&&n===I});E!==-1&&(this.pendingRemoteTracks.splice(E,1),this.emit(Rt.MediaReconnectEnd,e.uid))}async mockSubscribe(e,n,i,s){if(!this.recvConnection)throw new Ie(Y.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(n,[{ssrcId:i}],String(e.uid),s)}async unsubscribe(e,n,i){const s=this.pendingRemoteTracks.filter(u=>{let{user:h,kind:p}=u;return n!==void 0?h.uid===e.uid&&n===p:h.uid===e.uid});if(s.forEach(u=>{const h=this.pendingRemoteTracks.indexOf(u);this.pendingRemoteTracks.splice(h,1)}),this.recvConnection||i||s.forEach(u=>{let{kind:h}=u;var p;if(h===ot.AUDIO)(p=e._audioTrack)===null||p===void 0||p._destroy(),e._audioTrack=void 0;else if(h===ot.VIDEO){var _;(_=e._videoTrack)===null||_===void 0||_._destroy(),e._videoTrack=void 0}}),!this.recvConnection)return;const c=this.filterTobeUnSubscribedTracks(e,n);c.length!==0&&(await this.recvConnection.stopReceiving(c.map(u=>{let[,{id:h}]=u;return h})),this.withdrawRemoteTracks(c),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),c.forEach(u=>{let[h,{kind:p}]=u;var _,E;if(p===ot.VIDEO&&h._videoSSRC&&((_=this.recvConnection)===null||_===void 0||_.setStatsRemoteVideoIsReady(h._videoSSRC,!1)),p===ot.VIDEO)this.unbindRemoteTrackEvents(h._videoTrack),i||((E=h._videoTrack)===null||E===void 0||E._destroy(),h._videoTrack=void 0);else if(p===ot.AUDIO){var S;this.unbindRemoteTrackEvents(h._audioTrack),!i&&((S=h._audioTrack)===null||S===void 0||S._destroy(),h._audioTrack=void 0)}}),c.forEach(u=>{let[,{kind:h}]=u;Zn(this,Rt.RequestP2PMuteRemote,h)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const e=()=>Array.from(this.remoteUserMap.entries()).forEach(n=>{let[,i]=n;[ot.VIDEO,ot.AUDIO].forEach(s=>{i.has(s)?Zn(this,Rt.RequestP2PUnmuteRemote,s):Zn(this,Rt.RequestP2PMuteRemote,s)})});e(),this.downlinkStatsUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(e){throw new Ie(Y.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(e){throw new Ie(Y.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(e){throw new Ie(Y.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(e){throw new Ie(Y.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(e,n){if(!this.recvConnection)return;const i=this.remoteUserMap.get(e);if(!i)return void k.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid,"."));if(!i.get(n))return void k.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid," media type ").concat(n,"."));const s=n===ot.VIDEO?e._videoSSRC:e._audioSSRC;s!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(s,!1)}async unmuteRemote(e,n){return this.unmuteRemoteNoLock(e,n)}async unmuteRemoteNoLock(e,n){if(!this.recvConnection)return;const i=this.remoteUserMap.get(e);if(!i)return void k.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid,"."));i.get(n)||k.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(n,"."))}getAllTracks(e){const n=this.localTrackMap.get(xe.LocalAudioTrack);if((n==null?void 0:n.track)instanceof yi){const i=n.track;return Array.from(this.localTrackMap.entries()).filter(s=>{let[c]=s;return c!==xe.LocalAudioTrack}).filter(s=>{let[c]=s;return!(e&&c===xe.LocalVideoLowTrack)}).map(s=>{let[,{track:c}]=s;return c}).concat(i.trackList)}return Array.from(this.localTrackMap.entries()).filter(i=>{let[s]=i;return!(e&&s===xe.LocalVideoLowTrack)}).map(i=>{let[,{track:s}]=i;return s})}reportPublishEvent(e,n,i,s,c){if(e){const h=this.localTrackMap.get(xe.LocalAudioTrack),p=s?this.localTrackMap.get(xe.LocalVideoLowTrack):this.localTrackMap.get(xe.LocalVideoTrack);pt.publish(this.store.sessionId,{eventElapse:Ro.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:n,audioName:h==null?void 0:h.track.getTrackLabel(),videoName:p==null?void 0:p.track.getTrackLabel(),screenshare:(p==null?void 0:p.track._hints.indexOf(tr.SCREEN_TRACK))!==-1,audio:!!h,video:!!p,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}else{var u;i||(i=[]);const h=i.find(_=>_ instanceof Fr),p=s?(u=this.localTrackMap.get(xe.LocalVideoTrack))===null||u===void 0?void 0:u.track:i.find(_=>_ instanceof ur);pt.publish(this.store.sessionId,{eventElapse:Ro.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:n,audioName:h==null?void 0:h.getTrackLabel(),videoName:p==null?void 0:p.getTrackLabel(),screenshare:(p==null?void 0:p._hints.indexOf(tr.SCREEN_TRACK))!==-1,audio:!!h,video:!!p,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}}reportSubscribeEvent(e,n,i,s){const c=s===ot.VIDEO?i._videoSSRC:i._audioSSRC;c&&pt.subscribe(this.store.sessionId,{succ:e,ec:n,video:s===ot.VIDEO,audio:s===ot.AUDIO,peerid:i.uid,subscribeRequestid:s===ot.VIDEO?i._videoSSRC:i._audioSSRC,p2pid:this.store.p2pId,eventElapse:Ro.measureFromSubscribeStart(this.store.clientId,c)})}reset(){k.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new To("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new To("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(xe.LocalAudioTrack);if((e==null?void 0:e.track)instanceof yi){if(e.track.trackList.length>0){const n=e.track;e.track.trackList.forEach(i=>{n.removeAudioTrack(i)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=Un.Disconnected}getStats(e){var n,i;return e?(i=this.recvConnection)===null||i===void 0?void 0:i.getStats():(n=this.sendConnection)===null||n===void 0?void 0:n.getStats()}getRemoteVideoIsReady(e){var n;return((n=this.recvConnection)===null||n===void 0?void 0:n.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(xe.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(xe.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const n=this.localTrackMap.get(e);return n&&n.track instanceof ur||n&&n.track instanceof Fr?n.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,n){if(!e)return this.remoteUserMap.size>0;const i=this.remoteUserMap.get(e);return!!i&&(!n||i.has(n))}async hasRemoteMediaWithLock(e,n){if(!e)return this.remoteUserMap.size>0;const i=this.remoteUserMap.get(e);return!!i&&(!n||i.has(n))}getRemoteMedia(e){var n;const i=Array.from(_c(n=this.remoteUserMap).call(n)).find(s=>s.uid===e);return i?{audioTrack:i.audioTrack,audioSSRC:i._audioSSRC,videoTrack:i.videoTrack,videoSSRC:i._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(i=>{let[s]=i;return{uid:s.uid,level:s.audioTrack?100*s.audioTrack._source.getAccurateVolumeLevel():0}});const n=this.localTrackMap.get(xe.LocalAudioTrack);return n&&e.push({level:100*n.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=YT(e).call(e,(i,s)=>i.level-s.level),e}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(k.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=Un.Reconnecting,Z("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[n]=e;var i;n._videoTrack&&n._videoTrack._player&&((i=n._videoTrack._player.getVideoElement())===null||i===void 0||i.pause(),n._videoTrack._player.isKeepLastFrame=!0,n._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var n;let[i,{track:s}]=e;switch(i){case xe.LocalVideoTrack:$e(n=s._hints).call(n,tr.LOW_STREAM)?s.close():this.pendingLocalTracks.push(s);break;case xe.LocalAudioTrack:s instanceof yi?this.pendingLocalTracks=this.pendingLocalTracks.concat(s.trackList):this.pendingLocalTracks.push(s);case xe.LocalVideoLowTrack:}}),this.emit(Rt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[n,i]=e;Array.from(_c(i).call(i)).forEach(s=>{this.setPendingRemoteMedia(n,s)}),this.emit(Rt.MediaReconnectStart,n.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),k.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(e,n){for(const i of this.pendingRemoteTracks){const{user:s,kind:c}=i;if((e instanceof Xp?e.uid:e)===s.uid&&n===c)return!0}return!1}setPendingRemoteMedia(e,n){this.hasPendingRemoteMedia(e,n)||this.pendingRemoteTracks.push({user:e,kind:n})}async restartICE(e,n){let i,s;if(e===ds.SEND_ONLY){if(!this.sendConnection)throw new Ie(Y.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");i=await this.sendMutex.lock("From P2PChannel.restartICE"),s=this.sendConnection}else{if(!this.recvConnection)throw new Ie(Y.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");i=await this.recvMutex.lock("From P2PChannel.restartICE"),s=this.recvConnection}try{if(n){const c=await s.restartICE(n);return s.isInRestartIce=!1,c}{const c=await s.restartICE();if(c){const u=await ho(this,Rt.RequestP2PRestartICE,{direction:ds.RECEIVE_ONLY,iceParameter:c});await s.restartICE(u),s.isInRestartIce=!1}}}finally{i()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const e=this.sendConnection.getStats(),n=this.localTrackMap.get(xe.LocalVideoTrack),i=this.localTrackMap.get(xe.LocalAudioTrack),s=e.videoSend.find(P=>{var B;return P.ssrc===(n==null||(B=n.ssrcs)===null||B===void 0?void 0:B[0].ssrcId)}),c=e.audioSend.find(P=>{var B;return P.ssrc===(i==null||(B=i.ssrcs)===null||B===void 0?void 0:B[0].ssrcId)});if(!s||!c)return 1;const u=mc(this,Rt.NeedSignalRTT),h=s?s.rttMs:void 0,p=c?c.rttMs:void 0,_=h&&p?(h+p)/2:h||p,E=(_&&u?(_+u)/2:_||u)||0,S=100*e.sendPacketLossRate*.7/50+.3*E/1500,w=S<.17?1:S<.36?2:S<.59?3:S<.1?4:5,I=n==null?void 0:n.track;if(I&&I._encoderConfig&&I._hints.indexOf(tr.SCREEN_TRACK)===-1){const P=I._encoderConfig.bitrateMax,B=e.bitrate.actualEncoded;if(P&&B){const M=(1e3*P-B)/(1e3*P);return oz[M<.15?0:M<.3?1:M<.45?2:M<.6?3:4][w]}}return w}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const e=this.recvConnection.getStats();let n=0;return Array.from(this.remoteUserMap.entries()).forEach(i=>{let[s]=i;const c=s._audioSSRC,u=s._videoSSRC,h=e.audioRecv.find(B=>B.ssrc===c),p=e.videoRecv.find(B=>B.ssrc===u);if(!h&&!p)return void(n+=1);const _=mc(this,Rt.NeedSignalRTT),E=e.rtt,S=(E&&_?(E+_)/2:E||_)||0,w=h?h.jitterMs:void 0,I=e.recvPacketLossRate;let P=.7*I*100/50+.3*S/1500;w&&(P=.6*I*100/50+.2*S/1500+.2*w/400),n+=P<.1?1:P<.17?2:P<.36?3:P<.59?4:5}),this.remoteUserMap.size>0?Math.round(n/this.remoteUserMap.size):n}async muteLocalTrack(e){return new Qe((n,i)=>{this.handleMuteLocalTrack(e,n,i)})}filterTobePublishedTracks(e,n,i){const s=[],c=Cn(),u=this.getAllTracks();e=kE(e=e.filter(_=>u.indexOf(_)===-1));let h=!1,p=!1;for(const _ of e){if(_ instanceof ur&&(this.localTrackMap.has(xe.LocalVideoTrack)||h?new Ie(Y.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(s.push({track:_,type:xe.LocalVideoTrack}),h=!0),n)){const E=this.getLowVideoTrack(_,i);s.push({track:E,type:xe.LocalVideoLowTrack})}if(_ instanceof Fr){const E=this.localTrackMap.get(xe.LocalAudioTrack);if(E){if(!(E.track instanceof yi))throw new Ie(Y.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(_._bypassWebAudio)throw new Ie(Y.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");E.track.addAudioTrack(_),this.bindLocalAudioTrackEvents(_,!0)}else if(p){const S=s.find(w=>{let{type:I}=w;return I===xe.LocalAudioTrack});if(!(S.track instanceof yi))throw new Ie(Y.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(_._bypassWebAudio)throw new Ie(Y.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");S.track.addAudioTrack(_)}else{if(!c.webAudioMediaStreamDest||_ instanceof yi||_._bypassWebAudio)s.push({track:_,type:xe.LocalAudioTrack});else{const S=new yi;S.addAudioTrack(_),s.push({track:S,type:xe.LocalAudioTrack})}p=!0}}}return s}filterTobeUnpublishedTracks(e){const n=[],i=this.getAllTracks();e=kE(e=e.filter(s=>i.indexOf(s)!==-1));for(const s of e){if(s instanceof Fr){const c=this.localTrackMap.get(xe.LocalAudioTrack);if(!c)continue;c.track instanceof yi?(c.track.removeAudioTrack(s),this.unbindLocalAudioTrackEvents(s),c.track.trackList.length===0&&(n.push([xe.LocalAudioTrack,c]),c.track.close())):n.push([xe.LocalAudioTrack,c])}if(s instanceof ur){const c=this.localTrackMap.get(xe.LocalVideoTrack);if(!c)continue;n.push([xe.LocalVideoTrack,c]);const u=this.localTrackMap.get(xe.LocalVideoLowTrack);u&&n.push([xe.LocalVideoLowTrack,u])}}return n}bindLocalTrackEvents(e){e.forEach(n=>{let{track:i,type:s}=n;switch(s){case xe.LocalVideoTrack:i.addListener(ct.GET_STATS,this.handleGetLocalVideoStats),i.addListener(ct.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(ct.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(ct.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.addListener(ct.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.addListener(ct.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.addListener(ct.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(ct.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case xe.LocalAudioTrack:this.bindLocalAudioTrackEvents(i);case xe.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,n){e instanceof yi?e.trackList.forEach(i=>{i.addListener(ct.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(ct.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(ct.GET_STATS,this.handleGetLocalAudioStats),i.addListener(ct.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(ct.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(ct.GET_STATS,this.handleGetLocalAudioStats),e.addListener(ct.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(ct.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(ct.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(ct.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),n||e.addListener(ct.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(n=>{let[i,{track:s}]=n;return{track:s,type:i}})),e.forEach(n=>{let{track:i,type:s}=n;switch(s){case xe.LocalVideoTrack:i.off(ct.GET_STATS,this.handleGetLocalVideoStats),i.off(ct.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.off(ct.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.off(ct.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.off(ct.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.off(ct.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.off(ct.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.off(ct.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case xe.LocalAudioTrack:this.unbindLocalAudioTrackEvents(i);case xe.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof yi?e.trackList.forEach(n=>{n.off(ct.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(ct.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(ct.GET_STATS,this.handleGetLocalAudioStats),n.off(ct.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(ct.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(ct.GET_STATS,this.handleGetLocalAudioStats),e.off(ct.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(ct.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(ct.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(ct.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(ct.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,n){n instanceof HE&&n.addListener(ct.GET_STATS,i=>{i(this.handleGetRemoteVideoStats(e))}),n instanceof KE&&n.addListener(ct.GET_STATS,i=>{i(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(ct.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[n,i]=e;i.has(ot.AUDIO)&&this.unbindRemoteTrackEvents(n._audioTrack),i.has(ot.VIDEO)&&this.unbindRemoteTrackEvents(n._videoTrack)})}createGatewayPublishMessage(e,n){return e.map((i,s)=>{var c;let u,{track:h,type:p}=i;switch(p){case xe.LocalAudioTrack:u=Bn.Audio;break;case xe.LocalVideoTrack:u=$e(c=h._hints).call(c,tr.SCREEN_TRACK)?Bn.Screen:Bn.High;break;case xe.LocalVideoLowTrack:u=Bn.Low}return{kind:p===xe.LocalAudioTrack?ot.AUDIO:ot.VIDEO,stream_type:u,mid:n[s].id,ssrcs:n[s].localSSRC,isMuted:h.muted||!h.enabled}})}createGatewayUnpublishMessage(e){return e.map(n=>{var i;let s,[c,{track:u,ssrcs:h,id:p}]=n;switch(c){case xe.LocalVideoTrack:s=$e(i=u._hints).call(i,tr.SCREEN_TRACK)?Bn.Screen:Bn.High;break;case xe.LocalAudioTrack:s=Bn.Audio;break;case xe.LocalVideoLowTrack:s=Bn.Low}return{stream_type:s,ssrcs:h,mid:p}})}assignLocalTracks(e,n){e.forEach((i,s)=>{let{track:c,type:u}=i;this.localTrackMap.set(u,{track:c,id:n[s].id,ssrcs:n[s].localSSRC})})}withdrawLocalTracks(e){e.forEach(n=>{let[i]=n;this.localTrackMap.delete(i)})}bindConnectionEvents(e){e.onConnectionStateChange=async n=>{var i;k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(e.name,".onConnectionStateChange(").concat(n,")")),this.emit(Rt.PeerConnectionStateChange,n),n!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),n==="connected"&&(e.isInRestartIce=!1),$e(i=this._restartStates).call(i,n)&&!e.isInRestartIce&&(n==="disconnected"&&await Ji(800),e.iceConnectionState!=="disconnected"&&e.iceConnectionState!=="failed"||this.handleDisconnect(e.direction))},e.onICEConnectionStateChange=n=>{n!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(n,")")),pt.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:n,tag:Dr.TRACER}).onSuccess(),this.emit(Rt.IceConnectionStateChange,n)},e.onICETransportStateChange=n=>{k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(n,")"))},e.onDTLSTransportStateChange=n=>{k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(n,")"))},e.onDTLSTransportError=n=>{k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(n,")"))},e.onFirstAudioDecoded=n=>{var i;const s=Array.from(_c(i=this.remoteUserMap).call(i)).find(u=>u._audioSSRC===n);var c;s&&(this.store.subscribe(s.uid,"audio",void 0,void 0,void 0,Date.now()),(c=s.audioTrack)===null||c===void 0||c.emit(jE.FIRST_FRAME_DECODED),pt.firstRemoteFrame(this.store.sessionId,Ni.FIRST_AUDIO_DECODE,Er.FIRST_AUDIO_DECODE,{peer:s._uintid,subscribeElapse:Ro.measureFromSubscribeStart(this.store.clientId,n),subscribeRequestid:n,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=n=>{var i;const s=Array.from(_c(i=this.remoteUserMap).call(i)).find(c=>c._audioSSRC===n);s&&pt.firstRemoteFrame(this.store.sessionId,Ni.FIRST_AUDIO_RECEIVED,Er.FIRST_AUDIO_RECEIVED,{peer:s._uintid,subscribeElapse:Ro.measureFromSubscribeStart(this.store.clientId,n),subscribeRequestid:n,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(n,i,s)=>{this.reportVideoFirstFrameDecoded(n,i,s)},e.onFirstVideoReceived=n=>{var i;const s=Array.from(_c(i=this.remoteUserMap).call(i)).find(c=>c._videoSSRC===n);s&&pt.firstRemoteFrame(this.store.sessionId,Ni.FIRST_VIDEO_RECEIVED,Er.FIRST_VIDEO_RECEIVED,{peer:s._uintid,subscribeElapse:Ro.measureFromSubscribeStart(this.store.clientId,n),subscribeRequestid:n,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(n,i)=>{const s=n.candidateType==="relay",c=i.candidateType==="relay";i.candidateType!=="unknown"&&s===c||this.emit(Rt.ConnectionTypeChange,s),k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify($p(i))," -> ").concat(JSON.stringify($p(n)),")"))},e.onSelectedRemoteCandidateChanged=(n,i)=>{k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify($p(i))," -> ").concat(JSON.stringify($p(n)),")"))},e.onFirstVideoDecodedTimeout=n=>{this.reportVideoFirstFrameDecoded(n,void 0,void 0,!0)},e.onLocalCandidate=n=>{this.emit(Rt.LocalCandidate,{candidate:n,direction:e.direction})}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.onLocalCandidate=void 0}async handleDisconnect(e){const n=e===ds.SEND_ONLY?this.sendConnection:this.recvConnection;n&&!n.isInRestartIce&&(n.isInRestartIce=!0,k.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(n.name,"] start use restartICE")),e===ds.SEND_ONLY?this.restartICE(e):ho(this,Rt.RequestP2PRestartICE,{direction:ds.SEND_ONLY}))}filterTobeMutedTracks(e){const n=[];if(this.getAllTracks().indexOf(e)===-1)return n;const i=this.localTrackMap.get(xe.LocalAudioTrack);if(e instanceof Fr&&(i==null?void 0:i.track)instanceof yi)return i.track.isActive||n.push([xe.LocalAudioTrack,i]),n;const s=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return e===u});if(s&&(n.push(s),s[0]===xe.LocalVideoTrack)){const c=this.localTrackMap.get(xe.LocalVideoLowTrack);c&&n.push([xe.LocalVideoLowTrack,c])}return n}filterTobeUnmutedTracks(e){const n=[],i=this.localTrackMap.get(xe.LocalAudioTrack);if(e instanceof Fr&&(i==null?void 0:i.track)instanceof yi)return i.track.isActive&&n.push([xe.LocalAudioTrack,i]),n;const s=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return e===u});if(s)if(s[0]===xe.LocalVideoTrack){n.push(s);const c=this.localTrackMap.get(xe.LocalVideoLowTrack);c&&n.push([xe.LocalVideoLowTrack,c])}else n.push(s);return n}createMuteMessage(e){return e.map(n=>{var i;let s,[c,{track:u,ssrcs:h,id:p}]=n;switch(c){case xe.LocalAudioTrack:s=Bn.Audio;break;case xe.LocalVideoTrack:s=$e(i=u._hints).call(i,tr.SCREEN_TRACK)?Bn.Screen:Bn.High;break;case xe.LocalVideoLowTrack:s=Bn.Low}return{stream_type:s,ssrcs:h,mid:p}})}createUnmuteMessage(e){return e.map(n=>{var i;let s,[c,{track:u,ssrcs:h,id:p}]=n;switch(c){case xe.LocalAudioTrack:s=Bn.Audio;break;case xe.LocalVideoTrack:s=$e(i=u._hints).call(i,tr.SCREEN_TRACK)?Bn.Screen:Bn.High;break;case xe.LocalVideoLowTrack:s=Bn.Low}return{stream_type:s,ssrcs:h,mid:p}})}filterTobeUnSubscribedTracks(e,n){const i=[],s=this.remoteUserMap.get(e);if(!s)return i;if(n){const c=s.get(n);if(!c)return i;i.push([e,{kind:n,id:c}])}else Array.from(s.entries()).forEach(c=>{let[u,h]=c;i.push([e,{kind:u,id:h}])});return i}createUnsubscribeMessage(e){const n=[];return e.forEach(i=>{let[s,{kind:c,id:u}]=i;switch(c){case ot.VIDEO:return void(s._videoSSRC&&n.push({stream_type:ot.VIDEO,ssrcId:s._videoSSRC}));case ot.AUDIO:return void(s._audioSSRC&&n.push({stream_type:ot.AUDIO,ssrcId:s._audioSSRC}))}}),n}withdrawRemoteTracks(e){e.forEach(n=>{let[i,{kind:s}]=n;const c=this.remoteUserMap.get(i);c&&(c.delete(s),Array.from(c.entries()).length===0&&this.remoteUserMap.delete(i))})}async updateBitrateLimit(e){const n=this.localTrackMap.get(xe.LocalVideoTrack),i=this.localTrackMap.get(xe.LocalVideoLowTrack);n&&(await n.track.setBitrateLimit(e.uplink),await new Qe((s,c)=>{this.handleUpdateVideoEncoder(n.track,s,c,!0)})),i&&e.low_stream_uplink&&(await i.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new Qe((s,c)=>{this.handleUpdateVideoEncoder(i.track,s,c,!0)}))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const e=this.sendConnection.peerConnectionState,n=this.recvConnection.peerConnectionState;return e!=="connected"&&n!=="connected"}return!0}async tryToUnmuteAudio(e){for(let n=0;n<e.length;n++)if(e[n]instanceof Fr){const i=this.filterTobeUnmutedTracks(e[n]);if(i.length===0)continue;const s=this.createUnmuteMessage(i);return void await Zn(this,Rt.RequestUnmuteLocal,s)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=e=>this.getStats(e),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(e=>{let[,{ssrcs:n}]=e;return!!n}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var n;return!((n=this.recvConnection)===null||n===void 0||!n.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,n)=>this.emit(Rt.RequestUpload,e,n),this.statsUploader.requestUploadStats=e=>this.emit(Rt.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Ji(z1(this.dtlsFailedCount,pi)),this.emit(Rt.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(xe.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof ur)}throwIfTrackTypeNotMatch(e){if(e.filter(n=>n instanceof ur).length>1)throw new Ie(Y.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(n=>n instanceof Fr).length>1&&(e.some(n=>n instanceof Fr&&n._bypassWebAudio)||!Cn().webAudioMediaStreamDest))throw new Ie(Y.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const n of e){if(n instanceof ur&&this.pendingLocalTracks.some(i=>i instanceof ur))throw new Ie(Y.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(n instanceof Fr&&this.pendingLocalTracks.some(i=>i instanceof Fr)&&(!Cn().webAudioMediaStreamDest||n._bypassWebAudio||this.pendingLocalTracks.some(i=>i instanceof Fr&&i._bypassWebAudio)))throw new Ie(Y.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,n){const i=!Z("DISABLE_DUAL_STREAM_USE_ENCODING")&&Cn().supportDualStreamEncoding,s=rO(rO({},{width:160,height:120,framerate:15,bitrate:50}),n);let c;c=i?e._mediaStreamTrack.clone():ZL(e,s);const u=er(8,"track-low-"),h=new ur(c,rO(rO({},i&&{scaleResolutionDownBy:xL(s,e)}),{},{frameRate:s.framerate,bitrateMax:s.bitrate,bitrateMin:s.bitrate}),void 0,void 0,u);return h.on(Jg.TRANSCEIVER_UPDATED,p=>{e._updateRtpTransceiver(p,VE.LOW_STREAM)}),h._hints.push(tr.LOW_STREAM),e.addListener(ct.NEED_CLOSE,()=>{h.close()}),h}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(e,n,i,s){var c;const u=Array.from(_c(c=this.remoteUserMap).call(c)).find(h=>h._videoSSRC===e);if(u){s||this.store.subscribe(u.uid,"video",void 0,void 0,void 0,void 0,Date.now());const h=this.store.keyMetrics,p=h.subscribe.find(_=>_.userId===u.uid&&_.type==="video");pt.firstRemoteVideoDecode(this.store.sessionId,Ni.FIRST_VIDEO_DECODE,Er.FIRST_VIDEO_DECODE,{peer:u._uintid,videowidth:n,videoheight:i,subscribeElapse:Ro.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:h.requestAPEnd||0,apStart:h.requestAPStart||0,joinGwEnd:h.joinGatewayEnd||0,joinGwStart:h.joinGatewayStart||0,pcEnd:h.peerConnectionEnd||0,pcStart:h.peerConnectionStart||0,subscriberEnd:(p==null?void 0:p.subscribeEnd)||0,subscriberStart:(p==null?void 0:p.subscribeStart)||0,videoAddNotify:(p==null?void 0:p.streamAdded)||0,state:s?1:0})}}async remoteMediaSsrcChanged(e,n,i){if(!this.recvConnection)return!1;const s=this.remoteUserMap.get(e);if(!s)return!1;const c=s.get(n);if(!c)return!1;const u=await this.recvConnection.getRemoteSSRC(c);return u!==void 0&&u!==i}isPreSubScribe(e){return!1}async publishDataChannel(e){throw new Ie(Y.NOT_SUPPORTED)}async unpublishDataChannel(e){throw new Ie(Y.NOT_SUPPORTED)}async subscribeDataChannel(e,n){throw new Ie(Y.NOT_SUPPORTED)}async unsubscribeDataChannel(e,n){throw new Ie(Y.NOT_SUPPORTED)}hasPendingRemoteDataChannel(e,n){throw new Ie(Y.NOT_SUPPORTED)}setPendingRemoteDataChannel(e,n){throw new Ie(Y.NOT_SUPPORTED)}async preConnect(e){throw new Ie(Y.NOT_SUPPORTED)}getEstablishParams(){throw new Ie(Y.NOT_SUPPORTED)}async reSubscribe(e){throw new Ie(Y.NOT_SUPPORTED)}async updateVideoStreamParameter(e,n){throw new Ie(Y.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[n,{track:i}]=e;n===xe.LocalVideoLowTrack?i._updateRtpTransceiver(void 0,VE.LOW_STREAM):i._updateRtpTransceiver(void 0)})}},ut(Sr.prototype,"p2pConnect",[K9],Object.getOwnPropertyDescriptor(Sr.prototype,"p2pConnect"),Sr.prototype),ut(Sr.prototype,"unpublish",[$9],Object.getOwnPropertyDescriptor(Sr.prototype,"unpublish"),Sr.prototype),ut(Sr.prototype,"unpublishLowStream",[q9],Object.getOwnPropertyDescriptor(Sr.prototype,"unpublishLowStream"),Sr.prototype),ut(Sr.prototype,"subscribe",[Y9],Object.getOwnPropertyDescriptor(Sr.prototype,"subscribe"),Sr.prototype),ut(Sr.prototype,"mockSubscribe",[X9],Object.getOwnPropertyDescriptor(Sr.prototype,"mockSubscribe"),Sr.prototype),ut(Sr.prototype,"unsubscribe",[J9],Object.getOwnPropertyDescriptor(Sr.prototype,"unsubscribe"),Sr.prototype),ut(Sr.prototype,"muteRemote",[Q9],Object.getOwnPropertyDescriptor(Sr.prototype,"muteRemote"),Sr.prototype),ut(Sr.prototype,"unmuteRemote",[Z9],Object.getOwnPropertyDescriptor(Sr.prototype,"unmuteRemote"),Sr.prototype),ut(Sr.prototype,"hasRemoteMediaWithLock",[eK],Object.getOwnPropertyDescriptor(Sr.prototype,"hasRemoteMediaWithLock"),Sr.prototype),ut(Sr.prototype,"disconnectForReconnect",[tK],Object.getOwnPropertyDescriptor(Sr.prototype,"disconnectForReconnect"),Sr.prototype),ut(Sr.prototype,"remoteMediaSsrcChanged",[nK],Object.getOwnPropertyDescriptor(Sr.prototype,"remoteMediaSsrcChanged"),Sr.prototype),Sr);function Yu(e){return function(n,i,s){const c=n[i];if(typeof c!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){for(var u=arguments.length,h=new Array(u),p=0;p<u;p++)h[p]=arguments[p];switch(e){case qu.SEND_ONLY:{const _=await this.sendMutex.lock("From P2PChannel2.".concat(i));try{return await c.apply(this,h)}finally{_()}}case qu.RECEIVE_ONLY:{const _=await this.recvMutex.lock("From P2PChannel2.".concat(i));try{return await c.apply(this,h)}finally{_()}}default:{const _=await this.sendMutex.lock("From P2PChannel2.".concat(i)),E=await this.recvMutex.lock("From P2PChannel2.".concat(i));try{return await c.apply(this,h)}finally{_(),E()}}}},s}}class v_ extends Rr{constructor(n,i){super(),K(this,"signal",void 0),K(this,"token",void 0),K(this,"tokenTimeout",void 0),K(this,"tokenInterval",void 0),K(this,"_sequence",0),K(this,"userMap",new Map),K(this,"encoder",new TextEncoder),this.signal=n,this.token=i;const s=()=>{this.signal.connectionState===ir.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(s,1e3):this.tokenInterval=window.setTimeout(s,3*Z("P2P_TOKEN_INTERVAL"))};s()}async send(n,i,s,c,u){var h,p,_;if(this.userMap.size===0)return;const E=Array.from(fc(h=this.userMap).call(h))[0].token;typeof i!="string"&&(i=JSON.stringify(i)),c=(p=c)!==null&&p!==void 0?p:er(6,""),u=(_=u)!==null&&_!==void 0?_:this._sequence++;const S={_id:c,_type:n,_seq:u,_message:i,token:"".concat(this.token,"_").concat(E)};Z("SHOW_P2P_LOG")&&k.debug("send message",S,"noNeedResponse : ".concat(s)),this.splitMessage(JSON.stringify(S)).forEach(I=>{this.signal.request(kt.DATA_STREAM,{payload:Wp(this.encoder.encode(I))})});const w=new Qe((I,P)=>{const B=window.setTimeout(()=>{this.off("res-@".concat(c,"_ack"),M),this.off("res-@".concat(c),$),this.off(JE.ABORT,U),k.debug("[external-signal] request timeout, type: ".concat(n,", requestId: ").concat(c)),this.userMap.size===0?P(new Ie(Y.INVALID_REMOTE_USER)):P(new Ie(Y.TIMEOUT))},Z("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),M=()=>{B&&window.clearTimeout(B),this.off(JE.ABORT,U),s&&I()},U=()=>{B&&window.clearTimeout(B),this.off("res-@".concat(c,"_ack"),M),this.off("res-@".concat(c),$),P(new Ie(Y.EXTERNAL_SIGNAL_ABORT,"type: ".concat(n,", requestId: ").concat(c)))};this.once(JE.ABORT,U),this.once("res-@".concat(c,"_ack"),M);const $=(ce,me)=>{q=!0,B&&window.clearTimeout(B),this.off("res-@".concat(c,"_ack"),M),this.off(JE.ABORT,U),ce==="success"?I(me):P(new Ie(Y.P2P_MESSAGE_FAILED,"request ".concat(n," failed, requestId: ").concat(c)))};let q=!1;s||(this.once("res-@".concat(c),$),Ji(Z("SIGNAL_REQUEST_TIMEOUT")).then(()=>{q||k.warning("external_signal request timeout, type: ".concat(n,", requestId: ").concat(c,", ").concat(S))}))});try{return await w}catch(I){if(I.code===Y.TIMEOUT)return await this.send(n,i,s,c,u);throw I}}onMessage(n){var i;const{_uid:s}=n;let c,u=this.userMap.get(s);if(u)c=u.splitMessageMap;else{if(this.userMap.size>0||!("_type"in n)||n._type!==Jr.CHECK)return;const{token:E}=n;c=new Map,u={uid:s,isStart:!0,token:E,splitMessageMap:c,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(s,u),this.signal.emit(an.ON_USER_ONLINE,{uid:s}),this.handleUserOnline()}if("id"in n&&"total"in n){var h;const{id:E,total:S}=n,w=(h=c.get(E))!==null&&h!==void 0?h:[];if(w.push(n),c.has(E)||c.set(E,w),w.length!==S)return;{const I=YT(w).call(w,(P,B)=>P.index-B.index).map(P=>P.payload).join("");c.delete(E),(n=JSON.parse(I))._uid=s}}const{_type:p,token:_}=n;if($e(i=[Jr.ACK,Jr.CHECK]).call(i,p))return p===Jr.CHECK&&this.handleCheckToken(u,_),void this.receiveMessage(n);_==="".concat(u.token,"_").concat(this.token)?this.handleReceivedMessage(n):k.debug('Receive unexpected message", '.concat(_,", cur_token: ").concat(u.token,"_").concat(this.token),n)}check(){const n={_id:er(6,""),token:this.token,_type:Jr.CHECK};Z("SHOW_P2P_LOG")&&k.debug("send message",n),this.signal.request(kt.DATA_STREAM,{payload:Wp(this.encoder.encode(JSON.stringify(n)))})}ack(n){const i={_id:n,_type:Jr.ACK,token:this.token};Z("SHOW_P2P_LOG")&&k.debug("send message",i),this.signal.request(kt.DATA_STREAM,{payload:Wp(this.encoder.encode(JSON.stringify(i)))})}response(n,i,s){this.send(Jr.RESPONSE,JSON.stringify({success:!s,message:i}),!0,n)}handleReceivedMessage(n){const i=()=>{this.userMap.forEach(E=>{const{receivedMessagesMap:S,nextExpectedSequenceNumber:w}=E;for(;S.has(w);){const I=S.get(w);S.delete(w),this.receiveMessage(I),E.nextExpectedSequenceNumber++}})};if(!n)return void i();const{_uid:s,_seq:c}=n,u=this.userMap.get(s),{receivedMessagesMap:h,isStart:p,nextExpectedSequenceNumber:_}=u;if(c<_)return this.ack(n._id),void k.debug("[external-signal] receive old message, seq: ".concat(c,", ").concat(n._message));h.set(c,n),p&&c===_&&(this.receiveMessage(n),h.delete(_),u.nextExpectedSequenceNumber++,i())}receiveMessage(n){const{_id:i,_type:s,_message:c,_uid:u}=n;if(Z("SHOW_P2P_LOG")&&k.debug("receive message",n),i){let h;switch(n._type!==Jr.ACK&&(c&&(h=JSON.parse(c)),this.ack(n._id)),n._type){case Jr.CANDIDATE:case Jr.CONTROL:this.signal.emit(s,h,u);break;case Jr.PUBLISH:case Jr.UNPUBLISH:case Jr.RESTART_ICE:case Jr.CALL:h.uid=u,ho(this.signal,s,h).then(p=>{this.response(n._id,p)}).catch(()=>{this.response(n._id,void 0,!0)});break;case Jr.ACK:this.getListeners("res-@".concat(i,"_ack")).length>0&&this.emit("res-@".concat(i,"_ack"));break;case Jr.RESPONSE:{const{success:p,message:_}=h;this.emit("res-@".concat(i),p?"success":"failed",_);break}}}}splitMessage(n){if(n.length<v_.MAX_MESSAGE_SIZE)return[n];const i=[],{remoteToken:s}=JSON.parse(n),c=er(6,"");let u=0,h=800;const p=Math.ceil(n.length/h);for(;n.length>0;){u++;const _={id:c,index:u,total:p,payload:n.slice(0,h),token:"".concat(this.token,"_").concat(s)};JSON.stringify(_).length>v_.MAX_MESSAGE_SIZE?h-=50:(i.push(_),n=n.slice(h))}return i.map(_=>JSON.stringify(_))}handleCheckToken(n,i){return n.token!==i?(k.debug("token changed, from ".concat(n.token," to ").concat(i)),this.reset(n.uid,i),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{k.debug("token timeout, ".concat(i)),this.reset(n.uid)},Z("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const n=await ho(this.signal,Jr.CALL,void 0),i=await this.send(Jr.CALL,n);this.signal.emit(xt.P2P_CONNECTION,i,!0)}async reset(n,i){const s=this.userMap.get(n);s&&(this.emit(JE.ABORT),this.signal.emit(an.ON_USER_OFFLINE,{uid:s.uid,reason:Bhe.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),i||(k.debug("change local token from ".concat(i," to ").concat(i)),this.token=er(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(JE.ABORT)}}K(v_,"MAX_SIZE",1),K(v_,"MAX_MESSAGE_SIZE",1024);class bme extends Rr{get connectionState(){return this._connectionState}set connectionState(n){n!==this._connectionState&&(this._connectionState=n,n===ir.CONNECTED?this.emit(xt.WS_CONNECTED):n===ir.RECONNECTING?this.emit(xt.WS_RECONNECTING,this._websocketReconnectReason):n===ir.CLOSED&&this.emit(xt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(n,i){super(),K(this,"_disconnectedReason",void 0),K(this,"_websocketReconnectReason",void 0),K(this,"_connectionState",ir.CLOSED),K(this,"reconnectToken",void 0),K(this,"p2pToken",void 0),K(this,"websocket",void 0),K(this,"openConnectionTime",void 0),K(this,"clientId",void 0),K(this,"lastMsgTime",Date.now()),K(this,"uploadCache",[]),K(this,"uploadCacheInterval",void 0),K(this,"rttRolling",new D6(5)),K(this,"pingpongTimer",void 0),K(this,"pingpongTimeoutCount",0),K(this,"joinResponse",void 0),K(this,"multiIpOption",void 0),K(this,"initError",void 0),K(this,"spec",void 0),K(this,"store",void 0),K(this,"_external_signal",void 0),K(this,"onWebsocketMessage",s=>{if(s.data instanceof ArrayBuffer)return void this.emit(xt.ON_BINARY_DATA,s.data);const c=JSON.parse(s.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){const u="res-@".concat(c._id);this.emit(u,c._result,c._message)}else if(Object.prototype.hasOwnProperty.call(c,"_type")){switch(c._type){case an.ON_DATA_STREAM:return void this.handleDataStream(c._message);case an.MUTE_AUDIO:case an.MUTE_VIDEO:case an.ON_P2P_LOST:case an.ON_USER_ONLINE:return;case an.ON_USER_OFFLINE:const{uid:u}=c._message;return k.debug("[".concat(this.clientId,"] user-offline uid: ").concat(u)),void this._external_signal.reset(u)}if(this.emit(c._type,c._message),c._type===an.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===an.ON_USER_BANNED)switch(c._message.error_code){case 14:this.close(Mn.UID_BANNED);break;case 15:this.close(Mn.IP_BANNED);break;case 16:this.close(Mn.CHANNEL_BANNED)}if(c._type===an.ON_USER_LICENSE_BANNED)switch(c._message.error_code){case It.ERR_LICENSE_MISSING:this.close(Mn.LICENSE_MISSING);break;case It.ERR_LICENSE_EXPIRED:this.close(Mn.LICENSE_EXPIRED);break;case It.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Mn.LICENSE_MINUTES_EXCEEDED);break;case It.ERR_LICENSE_PERIOD_INVALID:this.close(Mn.LICENSE_PERIOD_INVALID);break;case It.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Mn.LICENSE_MULTIPLE_SDK_SERVICE);break;case It.ERR_LICENSE_ILLEGAL:this.close(Mn.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=n.clientId,this.spec=n,this.store=i,this.websocket=new DL("gateway-".concat(this.clientId),this.spec.retryConfig,!0,Z("JOIN_GATEWAY_USE_DUAL_DOMAIN"),Z("JOIN_GATEWAY_USE_443PORT_ONLY"),i),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===ir.CONNECTED&&this.reconnect("retry",uo.OFFLINE)}),this.p2pToken=er(6,""),this._external_signal=new v_(this,this.p2pToken)}async request(n,i,s,c){const u=er(6,""),h={_id:u,_type:n,_message:i},p=this.websocket.connectionID,_=()=>new Qe((B,M)=>{if(this.connectionState===ir.CONNECTED)return B();const U=()=>{this.off(xt.WS_CLOSED,$),B()},$=()=>{this.off(xt.WS_CONNECTED,U),M(new Ie(Y.WS_ABORT))};this.once(xt.WS_CONNECTED,U),this.once(xt.WS_CLOSED,$)});if(this.connectionState!==ir.CONNECTING&&this.connectionState!==ir.RECONNECTING||n===kt.JOIN||n===kt.REJOIN||await _(),this.websocket.sendMessage(h,!0),c)return;const E=new Qe((B,M)=>{let U=!1;const $=(ce,me)=>{U=!0,B({isSuccess:ce==="success",message:me||{}}),this.off(xt.WS_CLOSED,q),this.off(xt.WS_RECONNECTING,q),this.emit(xt.REQUEST_SUCCESS,n,i)};this.once("res-@".concat(u),$);const q=()=>{M(new Ie(Y.WS_ABORT,"type: ".concat(n))),this.off(xt.WS_CLOSED,q),this.off(xt.WS_RECONNECTING,q),this.off("res-@".concat(u),$)};this.once(xt.WS_CLOSED,q),this.once(xt.WS_RECONNECTING,q),Ji(Z("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==p||U||(k.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(n)),this.emit(xt.REQUEST_TIMEOUT,n,i))})});let S=null;try{S=await E}catch(B){if(this.connectionState===ir.CLOSED||n===kt.LEAVE)throw new Ie(Y.WS_ABORT);return!this.spec.forceWaitGatewayResponse||s?B.throw():n===kt.JOIN||n===kt.REJOIN?null:(await _(),await this.request(n,i))}if(S.isSuccess)return S.message;const w=Number(S.message.error_code||S.message.code),I=S0(w),P=new Ie(Y.UNEXPECTED_RESPONSE,"".concat(I.desc,": ").concat(S.message.error_str),{code:w,data:S.message,desc:I.desc});return I.action==="success"?S.message:(k.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(n,", error_code: ").concat(w,", message: ").concat(I.desc,", action: ").concat(I.action)),w===It.ERR_TOO_MANY_BROADCASTERS?((n===kt.JOIN||n===kt.REJOIN)&&(this.initError=P,this.close()),P.throw()):I.action==="failed"?P.throw():I.action==="quit"?(this.initError=P,this.close(),P.throw()):(w===It.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=S.message.option,k.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",uo.MULTI_IP)):this.reconnect(I.action,uo.SERVER_ERROR),n===kt.JOIN||n===kt.REJOIN?null:await this.request(n,i)))}waitMessage(n,i){return new Qe(s=>{const c=u=>{(!i||i(u))&&(this.off(n,c),s(u))};this.on(n,c)})}uploadWRTCStats(n){if(!this.store.sessionId)return void k.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const i={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:n};this.upload(E0.WRTC_STATS,i)}upload(n,i){const s={_type:n,_message:i};try{this.websocket.sendMessage(s)}catch{const u=Z("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(s),this.uploadCache.length>u&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==ir.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},Z("UPLOAD_CACHE_INTERVAL")||2e3))}}send(n,i){const s={_type:n,_message:i};this.websocket.sendMessage(s)}async sendExtensionMessage(n,i,s){return await this._external_signal.send(n,i,s)}init(n){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new Qe((i,s)=>{this.once(xt.WS_CONNECTED,()=>i(this.joinResponse)),this.once(xt.WS_CLOSED,()=>s(this.initError||new Ie(Y.WS_ABORT))),this.connectionState=ir.CONNECTING,this.websocket.init(n).catch(s)})}close(n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=n||Mn.LEAVE,this.connectionState=ir.CLOSED,k.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=er(6,""),this._external_signal.clear(),this._external_signal=new v_(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(xt.ABORT_P2P_EXECUTION);const n=await ho(this,xt.REQUEST_JOIN_INFO),i=await this.request(kt.JOIN,n);if(!i)return this.emit(xt.REPORT_JOIN_GATEWAY,Y.TIMEOUT,this.url||""),!1;this.joinResponse=i,this.emit(xt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=ir.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(n,i){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(n,i)}handleDataStream(n){try{var i;const s=qg(n.payload),c=new TextDecoder().decode(s),u=JSON.parse(c);"total"in u&&"id"in u||$e(i=Object.values(Jr)).call(i,u._type)?(u._uid=n.uid,this._external_signal.onMessage(u)):this.emit(an.ON_DATA_STREAM,n)}catch{this.emit(an.ON_DATA_STREAM,n)}}handleNotification(n){k.debug("[".concat(this.clientId,"] receive notification: "),n);const i=S0(n.code);if(i.action!=="success"){if(i.action!=="failed")return i.action==="quit"?(i.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Mn.UID_BANNED),void this.close()):void this.reconnect(i.action,uo.SERVER_ERROR);k.error("[".concat(this.clientId,"] ignore error: "),i.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const n=Z("PING_PONG_TIME_OUT"),i=Date.now();this.pingpongTimeoutCount>=n&&(k.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(i-this.lastMsgTime,"ms")),i-this.lastMsgTime>Z("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",uo.TIMEOUT):this.request(kt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const s=Date.now()-i;this.rttRolling.add(s),Z("REPORT_STATS")&&this.send(kt.PING_BACK,{pingpongElapse:s})}).catch(s=>{})}handleWebsocketEvents(){this.websocket.on(Gt.RECONNECT_CREATE_CONNECTION,n=>{this.emit(xt.WS_RECONNECT_CREATE_CONNECTION,n)}),this.websocket.on(Gt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Gt.CLOSED,()=>{this.connectionState=ir.CLOSED}),this.websocket.on(Gt.FAILED,()=>{this._disconnectedReason=Mn.NETWORK_ERROR,this.connectionState=ir.CLOSED}),this.websocket.on(Gt.RECONNECTING,n=>{this._websocketReconnectReason=n,this.joinResponse=void 0,this.connectionState===ir.CONNECTED?this.connectionState=ir.RECONNECTING:this.connectionState=ir.CONNECTING}),this.websocket.on(Gt.WILL_RECONNECT,(n,i,s)=>{n!=="retry"?(k.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(n)),this.reconnectToken=void 0):k.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),s(n)}),this.websocket.on(Gt.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(n=>{if(this.emit(xt.REPORT_JOIN_GATEWAY,n,this.url||""),n instanceof Ie&&n.code===Y.UNEXPECTED_RESPONSE&&n.data.code===It.ERR_NO_AUTHORIZED)return k.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",uo.SERVER_ERROR);k.error("[".concat(this.clientId,"] join gateway request failed"),n.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",uo.SERVER_ERROR):(this.initError=n,this.close())})}),this.websocket.on(Gt.REQUEST_NEW_URLS,(n,i)=>{ho(this,xt.REQUEST_RECOVER,this.multiIpOption).then(n).catch(i)}),this.websocket.on(Gt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(an.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}const wme={name:"P2PChannel",create:function(e){let{store:n,statsCollector:i}=e;return new Tme(n,i)},createSubmodule:function(e){let{store:n,spec:i}=e;return new bme(i,n)}};function iK(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,s)}return i}function oK(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?iK(Object(i),!0).forEach(function(s){K(e,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):iK(Object(i)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(i,s))})}return e}class Rme{constructor(n){K(this,"sessionDesc",void 0),K(this,"localCapabilities",void 0),K(this,"rtpCapabilities",void 0),K(this,"candidates",void 0),K(this,"_originCandidates",void 0),K(this,"iceParameters",void 0),K(this,"dtlsParameters",void 0),K(this,"setup",void 0),K(this,"currentMidIndex",void 0),K(this,"cname",void 0),n=Lr(n);const{iceParameters:i,dtlsParameters:s,candidates:c,rtpCapabilities:u,setup:h,localCapabilities:p,sdkCodec:_,cname:E}=n,S=la(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=u,this.candidates=c,this._originCandidates=Lr(c),this.iceParameters=i,this.dtlsParameters=s,this.setup=h,this.localCapabilities=p,this.cname=E;for(let w=0;w<S.mediaDescriptions.length;w++){const I=S.mediaDescriptions[w];if(I.attributes.iceUfrag=i.iceUfrag,I.attributes.icePwd=i.icePwd,I.attributes.fingerprints=s.fingerprints,I.attributes.candidates=c,I.attributes.setup=h,I.media.mediaType==="video"){I.media.fmts=u.videoCodecs.map(B=>B.payloadType.toString(10));let P=u.videoCodecs.filter(B=>{var M,U;return(M=B.rtpMap)===null||M===void 0?void 0:$e(U=M.encodingName.toLowerCase()).call(U,_)});P.length===0&&(P=u.videoCodecs),I.attributes.payloads=P,I.attributes.extmaps=u.videoExtensions}I.media.mediaType==="audio"&&(I.media.fmts=u.audioCodecs.map(P=>P.payloadType.toString(10)),I.attributes.payloads=u.audioCodecs,I.attributes.extmaps=u.audioExtensions),S.mediaDescriptions[w]=this.mungMediaDesc(I)}this.sessionDesc=S,this.currentMidIndex=S.mediaDescriptions.length-1}toString(){return Gp(this.sessionDesc)}send(n,i,s){const{ssrcs:c,ssrcGroups:u}=i_(i,this.cname),h=this.sessionDesc.mediaDescriptions.find(E=>n===ot.VIDEO?E.media.mediaType==="video":E.media.mediaType==="audio"),p=c[0].attributes.label,_=c[0].attributes.mslabel;return h.attributes.ssrcs=h.attributes.ssrcs.concat(c),h.attributes.ssrcGroups=h.attributes.ssrcGroups.concat(u),{id:p,mslabel:_}}batchSend(n){return n.map(i=>{let{kind:s,ssrcMsg:c}=i;return this.send(s,c,void 0)})}stopSending(n){this.sessionDesc.mediaDescriptions.forEach(i=>{const s=[],c=[],u=[];i.attributes.ssrcs.forEach(h=>{$e(n).call(n,h.attributes.label||"")?u.push(h):s.push(h)}),i.attributes.ssrcGroups.forEach(h=>{var p;$e(p=u.map(_=>_.ssrcId)).call(p,h.ssrcIds[0])||c.push(h)}),i.attributes.ssrcs=s,i.attributes.ssrcGroups=c})}mute(n){const i=this.sessionDesc.mediaDescriptions.find(s=>s.attributes.mid===n);if(!i)throw new Error("mediaDescription not found with ".concat(n," in remote SDP when calling RemoteSDP.mute."));i.attributes.direction="inactive"}unmute(n){const i=this.sessionDesc.mediaDescriptions.find(s=>s.attributes.mid===n);if(!i)throw new Error("mediaDescription not found with ".concat(n," in remote SDP when calling RemoteSDP.unmute."));i.attributes.direction="sendonly"}receive(n,i,s){n.forEach((c,u)=>{const h=c._mediaStreamTrack,p=this.sessionDesc.mediaDescriptions.findIndex(E=>E.attributes.mid===h.kind),_=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[p],c);this.sessionDesc.mediaDescriptions[p]=_})}stopReceiving(n){}updateCandidates(n){const i=this._originCandidates.filter(c=>c.transport==="udp"),s=[];if(i.forEach(c=>{s.push(oK(oK({},c),{},{foundation:"tcpcandidate",priority:Number(c.priority)-1+"",transport:"tcp",port:Number(c.port)+90+""}))}),i.length!==0){switch(n){case wo.TCP_RELAY:this.candidates=s;break;case wo.UDP_TCP_RELAY:case wo.RELAY:this.candidates=[...i,...s];break;default:this.candidates=i}for(const c of this.sessionDesc.mediaDescriptions)c.attributes.candidates=this.candidates}}restartICE(n){n=Lr(n),this.iceParameters=n,this.sessionDesc.mediaDescriptions.forEach(i=>{i.attributes.iceUfrag=n.iceUfrag,i.attributes.icePwd=n.icePwd})}predictReceivingMids(n){const i=[];for(let s=0;s<n;s++)i.push((this.currentMidIndex+s+1).toString(10));return i}mungRecvMediaDsec(n,i){const s=Lr(n);return ey(s,i),UL(s,i),s}updateRecvMedia(n,i){const s=this.sessionDesc.mediaDescriptions.findIndex(c=>c.attributes.mid===n);if(s!==-1){const c=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[s],i);this.sessionDesc.mediaDescriptions[s]=c}}bumpMid(n){this.currentMidIndex+=n}updateTrackLabel(n,i,s){const c=this.sessionDesc.mediaDescriptions.find(h=>n===ot.VIDEO?h.attributes.mid==="video":h.attributes.mid==="audio");if(c){const h=c.attributes.ssrcs.find(p=>p.attributes.label===i);var u;h&&(h.attributes.label=s,(u=h.attributes.msid)===null||u===void 0||u.replace(i,s))}}mungMediaDesc(n){const i=Lr(n);return ML(i),function(s){const c=s.attributes.extmaps.find(u=>EA(u.extensionName));c&&s.attributes.extmaps.splice(s.attributes.extmaps.indexOf(c),1),s.attributes.payloads.forEach(u=>{const h=u.rtcpFeedbacks.findIndex(p=>p.type==="transport-cc");h!==-1&&u.rtcpFeedbacks.splice(h,1)})}(i),i}getSSRC(n){for(const i of this.sessionDesc.mediaDescriptions)for(const s of i.attributes.ssrcs)if(s.attributes.label===n)return[s]}}var Qn;function sK(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,s)}return i}function iO(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?sK(Object(i),!0).forEach(function(s){K(e,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):sK(Object(i)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(i,s))})}return e}let Cme=(Qn=class Ub extends mz{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(n=>n.rtpMap&&n.rtpMap.encodingName.toLowerCase()||"").filter(n=>{var i;return $e(i=Object.keys(qI)).call(i,n)}))]}constructor(n,i){super(n,i),K(this,"store",void 0),K(this,"peerConnection",void 0),K(this,"remoteSDP",void 0),K(this,"initialOffer",void 0),K(this,"statsFilter",void 0),K(this,"useRTX",!1),K(this,"localCapabilities",void 0),K(this,"localCandidateCount",0),K(this,"allCandidatesReceived",!1),K(this,"establishPromise",void 0),K(this,"mutex",void 0),this.store=i,this.mutex=new To("P2PConnection-mutex",i.clientId),this.peerConnection=new RTCPeerConnection(Ub.resolvePCConfiguration(n),{optional:[{googDscp:!0}]}),this.statsFilter=X1(this.peerConnection,Z("STATS_UPDATE_INTERVAL"),void 0,Nr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const n=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!n.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const i=qp(n.sdp),s=w0(n.sdp,{filterRTX:!this.useRTX,filterVideoFec:Z("FILTER_VIDEO_FEC"),filterAudioFec:Z("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=s,this.initialOffer=n,iO(iO({},i),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:s},offerSDP:n.sdp})}catch(n){throw new Ie(Y.GET_LOCAL_CONNECTION_PARAMS_FAILED,n.toString())}}async updateRemoteConnect(){}async connect(n){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new Rme(iO(iO({},n),{},{rtpCapabilities:n.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));const i=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(i){throw new Ie(Y.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(i.toString()))}}async updateRemoteRTPCapabilities(n,i){throw new Ie(Y.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(n){}send(n,i){var s=this;return Zc(function*(){const c=yield _n(s.mutex.lock());try{if(!s.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const u=n.map(I=>s.peerConnection.addTrack(I._mediaStreamTrack)),h=yield _n(s.peerConnection.createOffer()),p=la(h.sdp),_=n.map(I=>{const P=I._mediaStreamTrack,B=p.mediaDescriptions.find(M=>M.attributes.mid===P.kind);if(!B)throw new Error("Cannot extract ssrc from mediaDescription.");return function(M,U,$){const q=M.attributes.ssrcs.filter(me=>me.attributes.label===U),ce=M.attributes.ssrcGroups;if(q.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(ce&&q.length>1){const me=ce.find(ge=>ge.ssrcIds.indexOf(q[0].ssrcId)!==-1);return me?[{ssrcId:me.ssrcIds[0],rtx:$?me.ssrcIds[1]:void 0}]:[{ssrcId:q[0].ssrcId}]}return[{ssrcId:q[0].ssrcId}]}(B,P.id,s.useRTX)});let E;try{E=yield _}catch(I){throw u.forEach(P=>{lo()&&P.replaceTrack(null),s.peerConnection.removeTrack(P)}),I}const S=s.mungSendOfferSDP(h.sdp,n);s.remoteSDP.receive(n,i,E);const w=s.remoteSDP.toString();return yield _n(s.peerConnection.setLocalDescription({type:"offer",sdp:S})),yield _n(s.applySendEncodings(u,n)),yield _n(s.peerConnection.setRemoteDescription({type:"answer",sdp:w})),n.map((I,P)=>{const B=I._mediaStreamTrack.id;return{localSSRC:_[P],id:B}})}catch(u){throw new Ie(Y.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(u.toString()))}finally{c()}})()}async stopSending(n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const i=this.peerConnection.getSenders().filter(u=>{var h;return n.indexOf(((h=u.track)===null||h===void 0?void 0:h.id)||"")!==-1});if(i.length!==n.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");i.map(u=>{lo()&&u.replaceTrack(null),this.peerConnection.removeTrack(u)});const s=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(s),this.remoteSDP.stopReceiving(n);const c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(i){throw new Ie(Y.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(i.toString()))}}async receive(n,i,s,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(n," before remoteSDP created."));const{id:u,mslabel:h}=this.remoteSDP.send(n,i,c),p=new Qe((S,w)=>{const I=setTimeout(()=>{w(new Error("Cannot receive track, id: ".concat(u)))},1e4),P=B=>{const M=vn();if((M.name==="Safari"&&Number(M.version)===11||cs())&&B.track.id!==u&&B.streams[0].id===h){var U;const $=B.streams[0].getTracks()[0];return(U=this.remoteSDP)===null||U===void 0||U.updateTrackLabel(n,u,B.track.id),this.peerConnection.removeEventListener("track",P),clearTimeout(I),void S($)}if(B.track.id===u)return this.peerConnection.removeEventListener("track",P),clearTimeout(I),void S(B.track)};this.peerConnection.addEventListener("track",P)}),_=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:_});const E=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(E),{track:await p,id:u}}catch(u){throw new Ie(Y.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async stopReceiving(n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(n);const i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const s=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(s)}catch(i){throw new Ie(Y.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}async muteRemote(n){}async unmuteRemote(n){}async muteLocal(n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const i=this.peerConnection.getSenders().filter(s=>{var c;return n.indexOf(((c=s.track)===null||c===void 0?void 0:c.id)||"")!==-1});if(i.length!==n.length)throw new Error("sender' length doesn't match mids' length.");i.map(s=>{if(lo()&&s.track)s.track.enabled=!1;else{const c=s.getParameters();c.encodings.forEach(u=>u.active=!1),s.setParameters(c)}})}catch(i){throw new Ie(Y.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(i.toString()))}}async unmuteLocal(n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const i=this.peerConnection.getSenders().filter(u=>{var h;return n.indexOf(((h=u.track)===null||h===void 0?void 0:h.id)||"")!==-1});if(i.length!==n.length)throw new Error("Senders' length doesn't match mids' length.");i.map(async u=>{if(lo()&&u.track)u.track.enabled=!0;else{const h=u.getParameters();h.encodings.forEach(p=>p.active=!0),await u.setParameters(h)}});const s=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(s);const c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(i){throw new Ie(Y.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(i.toString()))}}restartICE(n){var i=this;return Zc(function*(){const s=yield _n(i.mutex.lock("From P2PConnection.restartICE"));try{if(!i.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const c=Cn().supportPCSetConfiguration;if(n===wo.RELAY&&!c)return;if(c){const E=i.peerConnection.getConfiguration(),S=n===wo.RELAY?"relay":"all";E.iceTransportPolicy!==S&&(k.debug("[".concat(i.store.clientId,"] restartICE change iceTransportPolicy from [").concat(E.iceTransportPolicy,"] to [").concat(S,"]")),E.iceTransportPolicy=S,i.peerConnection.setConfiguration(E))}n!==wo.RELAY&&i.remoteSDP.updateCandidates(n);const u=yield _n(i.peerConnection.createOffer({iceRestart:!0}));if(!u.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const h=qp(u.sdp),{remoteIceParameters:p}=yield h.iceParameters;i.remoteSDP.restartICE(p);const _=i.remoteSDP.toString();yield _n(i.peerConnection.setLocalDescription(u)),yield _n(i.peerConnection.setRemoteDescription({type:"answer",sdp:_}))}catch(c){k.warning("[".concat(i.store.clientId,"] restart ICE failed, abort operation"),c)}finally{s()}})()}close(){var n;this.peerConnection.close(),(n=this.onConnectionStateChange)===null||n===void 0||n.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(n){return this.statsFilter.getVideoIsReady(n)}async updateEncoderConfig(n,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const s=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(s.sdp,[i]);this.remoteSDP.updateRecvMedia(i._mediaStreamTrack.kind,i);const u=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(s){throw new Ie(Y.EXCHANGE_SDP_FAILED,s.toString())}}async updateSendParameters(n,i){const s=this.peerConnection.getSenders().filter(c=>{var u;return((u=c.track)===null||u===void 0?void 0:u.id)===n});s.length===1&&await this.applySendEncodings(s,[i])}setStatsRemoteVideoIsReady(n,i){this.statsFilter.setVideoIsReady2(n,i)}async replaceTrack(n,i){const s=this.peerConnection.getSenders().find(c=>{var u;return((u=c.track)===null||u===void 0?void 0:u.id)===i});s&&await s.replaceTrack(n._mediaStreamTrack)}createDataChannels(n,i){throw new Ie(Y.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(n){throw new Ie(Y.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var n;(n=this.onICEConnectionStateChange)===null||n===void 0||n.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var n;(n=this.onConnectionStateChange)===null||n===void 0||n.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=n=>{n.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,k.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,k.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},Z("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(n){const i={iceServers:[],sdpSemantics:"plan-b"};return n.iceServers?i.iceServers=n.iceServers:n.turnServer&&n.turnServer.mode!=="off"&&(d0(n.turnServer.servers)?i.iceServers=n.turnServer.servers:(i.iceServers&&i.iceServers.push(...Ub.turnServerConfigToIceServers(n.turnServer.servers)),Z("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&n.turnServer.serversFromGateway&&i.iceServers.push(...Ub.turnServerConfigToIceServers(n.turnServer.serversFromGateway)),n.turnServer.servers.concat(n.turnServer.serversFromGateway||[]).forEach(s=>{s.forceturn&&(i.iceTransportPolicy="relay")}))),i}static turnServerConfigToIceServers(n){const i=[];return n.forEach(s=>{s.security?s.tcpport&&i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turns:".concat(s.turnServerURL,":").concat(s.tcpport,"?transport=tcp")}):(s.udpport&&i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.udpport,"?transport=udp")}),s.tcpport&&i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.tcpport,"?transport=tcp")}))}),i}async updateRtpSenderEncodings(n,i){var s;if(i||(i=this.peerConnection.getSenders().find(E=>{var S;return((S=E.track)===null||S===void 0?void 0:S.id)===n._mediaStreamTrack.id})),!i)return k.warn("[".concat(n.getTrackId(),"] no rtpSender found}"));if(!Cn().supportSetRtpSenderParameters)return k.warn("Browser not support set rtp-sender parameters");const c={},u={};if(n instanceof ur)switch(n._optimizationMode){case"motion":c.degradationPreference="maintain-framerate";break;case"detail":c.degradationPreference="maintain-resolution";break;default:c.degradationPreference="balanced"}if(Z("DSCP_TYPE")&&df()){var h;const E=Z("DSCP_TYPE");$e(h=["very-low","low","medium","high"]).call(h,E)&&(u.networkPriority=E)}const p=i.getParameters(),_=(s=p.encodings)===null||s===void 0?void 0:s[0];_&&Object.assign(_,u),Object.assign(p,c),k.debug("[".concat(n.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(p.encodings))),await i.setParameters(p)}async applySendEncodings(n,i){try{if(!Cn().supportSetRtpSenderParameters||n.length!==i.length)return;for(let s=0;s<n.length;s++){const c=n[s],u=i[s];c&&u&&await this.updateRtpSenderEncodings(u,c)}}catch{k.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(n,i){const s=la(n);return i.forEach((c,u)=>{const h=c._mediaStreamTrack,p=s.mediaDescriptions.find(_=>_.attributes.mid===h.kind);p&&ey(p,c)}),Gp(s)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=n=>{var i;(i=this.onFirstAudioReceived)===null||i===void 0||i.call(this,n)},this.statsFilter.onFirstVideoReceived=n=>{var i;(i=this.onFirstVideoReceived)===null||i===void 0||i.call(this,n)},this.statsFilter.onFirstAudioDecoded=n=>{var i;(i=this.onFirstAudioDecoded)===null||i===void 0||i.call(this,n)},this.statsFilter.onFirstVideoDecoded=(n,i,s)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,n,i,s)},this.statsFilter.onSelectedLocalCandidateChanged=(n,i)=>{var s;(s=this.onSelectedLocalCandidateChanged)===null||s===void 0||s.call(this,n,i)},this.statsFilter.onSelectedRemoteCandidateChanged=(n,i)=>{var s;(s=this.onSelectedRemoteCandidateChanged)===null||s===void 0||s.call(this,n,i)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const i=this.remoteSDP.batchSend(n).map((u,h)=>{let{id:p,mslabel:_}=u;const{kind:E}=n[h];return new Qe((S,w)=>{const I=setTimeout(()=>{w(new Error("Cannot receive track, id: ".concat(p)))},1e4),P=B=>{const M=vn();if(M.name==="Safari"&&Number(M.version)===11&&B.track.id!==p&&B.streams[0].id===_){var U;const $=B.streams[0].getTracks()[0];return(U=this.remoteSDP)===null||U===void 0||U.updateTrackLabel(E,p,B.track.id),this.peerConnection.removeEventListener("track",P),clearTimeout(I),void S({track:$,id:p})}if(B.track.id===p)return this.peerConnection.removeEventListener("track",P),clearTimeout(I),void S({track:B.track,id:p})};this.peerConnection.addEventListener("track",P)})}),s=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const c=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(c),await Qe.all(i)}catch(i){throw new Ie(Y.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(i.toString()))}}async getRemoteSSRC(n){if(!this.remoteSDP)return;const i=this.remoteSDP.getSSRC(n);return i==null?void 0:i[0].ssrcId}setConfiguration(n){if(Cn().supportPCSetConfiguration){const i=Ub.resolvePCConfiguration(n);this.peerConnection.setConfiguration(i)}}},ut(Qn.prototype,"connect",[al],Object.getOwnPropertyDescriptor(Qn.prototype,"connect"),Qn.prototype),ut(Qn.prototype,"stopSending",[al],Object.getOwnPropertyDescriptor(Qn.prototype,"stopSending"),Qn.prototype),ut(Qn.prototype,"receive",[al],Object.getOwnPropertyDescriptor(Qn.prototype,"receive"),Qn.prototype),ut(Qn.prototype,"stopReceiving",[al],Object.getOwnPropertyDescriptor(Qn.prototype,"stopReceiving"),Qn.prototype),ut(Qn.prototype,"muteRemote",[al],Object.getOwnPropertyDescriptor(Qn.prototype,"muteRemote"),Qn.prototype),ut(Qn.prototype,"unmuteRemote",[al],Object.getOwnPropertyDescriptor(Qn.prototype,"unmuteRemote"),Qn.prototype),ut(Qn.prototype,"muteLocal",[al],Object.getOwnPropertyDescriptor(Qn.prototype,"muteLocal"),Qn.prototype),ut(Qn.prototype,"unmuteLocal",[al],Object.getOwnPropertyDescriptor(Qn.prototype,"unmuteLocal"),Qn.prototype),ut(Qn.prototype,"close",[al],Object.getOwnPropertyDescriptor(Qn.prototype,"close"),Qn.prototype),ut(Qn.prototype,"updateEncoderConfig",[al],Object.getOwnPropertyDescriptor(Qn.prototype,"updateEncoderConfig"),Qn.prototype),ut(Qn.prototype,"updateSendParameters",[al],Object.getOwnPropertyDescriptor(Qn.prototype,"updateSendParameters"),Qn.prototype),ut(Qn.prototype,"replaceTrack",[al],Object.getOwnPropertyDescriptor(Qn.prototype,"replaceTrack"),Qn.prototype),ut(Qn.prototype,"getRemoteSSRC",[al],Object.getOwnPropertyDescriptor(Qn.prototype,"getRemoteSSRC"),Qn.prototype),Qn);function al(e,n,i){const s=e[n];if(typeof s!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const c=this.mutex,u=await c.lock("Locking from P2PConnection.".concat(n));try{for(var h=arguments.length,p=new Array(h),_=0;_<h;_++)p[_]=arguments[_];return await s.apply(this,p)}finally{u()}},i}const Ime={name:"PlanBConnection",create:function(e){let{store:n,spec:i}=e;return new Cme(i,n)}},Ame={interceptLocalAudioFrame:async function(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Cn().supportWebRTCEncodedTransform)return void k.warning("browser not support audio encoded transform");if(rA.has(e)||!e.track)return;const i={track:e.track};if(uf()){if(!e.createEncodedStreams)return void k.warning("browser not support createEncodedStreams() API");let c=null;try{c=e.createEncodedStreams()}catch(h){return void k.error("create audio-encoded-streams error",h&&h.message)}const u=new TransformStream({transform(h,p){i.controller||(i.controller=p),e.track&&e.track.id!==i.track.id&&(k.debug("audio track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",s),i.track=e.track,i.track.addEventListener("ended",s));const _=n.metadata&&n.metadata();_?function(E,S){const{chunk:w,controller:I}=S,P=Z("ENABLE_AUDIO_PTS_METADATA")?mf.AUDIO_64_BIT_PTS:mf.METADATA;w.data=function(B,M,U){const $=U.byteLength,q=$+yL+ZG,ce=vL+EL+q,me=new ArrayBuffer(B.byteLength+ce),ge=new DataView(me);ge.setUint8(0,QG),ge.setUint16(1,q),ge.setUint8(3,M),ge.setUint16(4,$);for(let Re=0;Re<$;Re++)ge.setUint8(6+Re,U[Re]);const pe=new Uint8Array(ge.buffer);return pe.set(new Uint8Array(B),ce),pe.buffer}(w.data,P,E),I.enqueue(w)}(_,{chunk:h,controller:p}):p.enqueue(h)}});c.readable.pipeThrough(u).pipeTo(c.writable)}else if(lo()){if(typeof RTCRtpScriptTransform>"u")return void k.warning("browser not support RTCRtpScriptTransform");const c=nA(),u=new MessageChannel;await new Qe(p=>c.onmessage=_=>{_.data==="registered"&&p(void 0)});const h=new RTCRtpScriptTransform(c,{name:"audio-metadata-tx",port:u.port2},[u.port2]);e.transform=h,await new Qe(p=>c.onmessage=_=>{_.data==="started"&&p(void 0)}),u.port1.onmessage=p=>{var _;if(p.data.transformed&&e.track&&((_=e.track)===null||_===void 0?void 0:_.id)!==i.track.id)k.debug("audio track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",s),i.track=e.track,i.track.addEventListener("ended",s);else if(p.data.getMetadata){const E=n.metadata&&n.metadata();E&&u.port1.postMessage({metadata:E})}},i.worker=c}function s(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",s)}const c=rA.get(e);if(c){rA.delete(e);try{var u,h;(u=c.controller)===null||u===void 0||u.terminate(),(h=c.worker)===null||h===void 0||h.terminate()}catch(p){k.warning(p&&p.message)}}}rA.set(e,i),e.track.addEventListener("ended",s)},interceptRemoteAudioFrame:async function(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Cn().supportWebRTCEncodedTransform)return void k.warning("browser not support audio encoded transform");if(lA.has(e))return;const i={track:e.track,onMetadata:n.onMetadata};if(uf()){if(!e.createEncodedStreams)return void k.warning("browser not support createEncodedStreams() API");k1(Nn.CHROME,87,116)||(n.enableTopn=!1);let c=null;try{c=e.createEncodedStreams()}catch(h){return void k.error("create audio-encoded-streams error",h&&h.message)}const u=new TransformStream({transform(h,p){i.controller||(i.controller=p),e.track&&e.track.id!==i.track.id&&(k.debug("audio track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",s),i.track=e.track,i.track.addEventListener("ended",s)),n.enableTopn?function(_,E,S){var w;const I=ez(new DataView(E.data));if(!I)return S.enqueue(E);const P=_.track.id;che.set(P,_.track);const B=(w=I.tlv.find(me=>me.tag===mf.AUDIO_LEVEL))===null||w===void 0?void 0:w.value;let M=0;typeof B=="number"&&(M=127-B);const U=Math.round(Math.pow(10,M/60)-1),{selected:$,speaker:q}=function(me,ge){let pe=$E.get(me);if(pe||(pe=function(Re){const Ve=new nz;return $E.set(Re,Ve),Gu||(Gu=new she(Z("TOPN_SILENCE_THRESHOLD")||500),Gu.on("ActiveSpeakerChanged",Ze=>{Ze!=null&&(sA=Ze)})),Gu.addSpeakers([Ve]),Ve}(me)),$E.size<=rz)return{selected:!0,speaker:pe};if(!Gu)throw new Error("no active speaker detector");return Gu.levelChanged(pe.id,ge),t_=Gu.loudest.map(Re=>Re.id),sA&&!$e(t_).call(t_,sA)&&t_.length>=rz&&t_.pop(),{selected:$e(t_).call(t_,pe.id)||pe.id===sA,speaker:pe}}(_,U),ce=function(me,ge,pe){const Re=zu.get(me)||new ahe(me,ge);return Re.score=pe,zu.set(me,Re),function(Ve){if(aA.set(Ve,!0),!cA)return void(cA=Date.now());const Ze=Date.now();Ze-cA>1e3&&(aA.get(Ve)?aA.set(Ve,!1):(iz(Ve),aA.delete(Ve)),cA=Ze)}(me),Re}(P,_.track,q.energyScore);ce.addSample($),ce.active&&(E.data=I.frame.buffer,S.enqueue(E))}(e,h,p):n.enableMetadata?function(_,E,S){const w=ez(new DataView(_.data));if(!w)return E.enqueue(_);const I=w.tlv.find(P=>P.tag===mf.METADATA||P.tag===mf.AUDIO_64_BIT_PTS);I&&S&&I.value instanceof Uint8Array&&S(I.value),_.data=w.frame.buffer,E.enqueue(_)}(h,p,n.onMetadata):p.enqueue(h)}});c.readable.pipeThrough(u).pipeTo(c.writable)}else if(lo()){if(typeof RTCRtpScriptTransform>"u")return void k.warning("browser not support RTCRtpScriptTransform");const c=nA(),u=new MessageChannel;await new Qe(p=>c.onmessage=_=>{_.data==="registered"&&p(void 0)});const h=new RTCRtpScriptTransform(c,{name:"audio-metadata-rx",port:u.port2},[u.port2]);e.transform=h,await new Qe(p=>c.onmessage=_=>{_.data==="started"&&p(void 0)}),u.port1.onmessage=p=>{var _;p.data.transformed&&e.track&&((_=e.track)===null||_===void 0?void 0:_.id)!==i.track.id?(k.debug("audio track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",s),i.track=e.track,i.track.addEventListener("ended",s)):p.data.metadata&&i.onMetadata&&i.onMetadata(p.data.metadata)},i.worker=c}function s(){e.track.removeEventListener("ended",s),function(c){const u=lA.get(c);if(u){(function(_){const E=$E.get(_);E&&($E.delete(_),Gu&&(Gu.removeSpeakers([E]),$E.size===0&&(Gu.destroy(),Gu=null)))})(c),iz(c.track.id),lA.delete(c);try{var h,p;(h=u.controller)===null||h===void 0||h.terminate(),(p=u.worker)===null||p===void 0||p.terminate()}catch(_){k.warning(_&&_.message)}}}(e)}lA.set(e,i),e.track.addEventListener("ended",s)},interceptLocalVideoFrame:async function(e,n){if(!Cn().supportWebRTCEncodedTransform)return void k.warning("browser not support video encoded transform");if(uA.has(e)||!e.track)return;const i={track:e.track};if(uf()){if(!e.createEncodedStreams)return void k.warning("browser not support createEncodedStreams() API");let c=null;try{c=e.createEncodedStreams()}catch(p){return void k.error("create video-encoded-streams error",p&&p.message)}const u=[];n.on("sei-to-send",p=>{u.push(p)});const h=new TransformStream({transform(p,_){i.controller||(i.controller=_),e.track&&e.track.id!==i.track.id&&(k.debug("video track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",s),i.track=e.track,i.track.addEventListener("ended",s));const E=u.shift();E&&(p.data=function(S,w){const I=function(q){const ce=q.length;let me=[],ge=0;for(;ge<ce;)ge+2<ce&&q[ge]===0&&q[ge+1]===0&&(q[ge+2]===0||q[ge+2]===1||q[ge+2]===2||q[ge+2]===3)?(me.push(q[ge],q[ge+1],3,q[ge+2]),ge+=3):(me.push(q[ge]),ge++);return new Uint8Array(me)}(w),P=I.length,B=Math.floor(P/255),M=P%255,U=new Uint8Array(6+B+1+P+S.byteLength);U[0]=0,U[1]=0,U[2]=0,U[3]=1,U[4]=6,U[5]=101;let $=0;for(;$<B;)U[6+$]=255,$++;return U[6+$]=M,$++,U.set(I,6+$),U.set(new Uint8Array(S),6+$+P),U.buffer}(p.data,E)),_.enqueue(p)}});c.readable.pipeThrough(h).pipeTo(c.writable)}else{if(!lo())return;{if(typeof RTCRtpScriptTransform>"u")return void k.warning("browser not support RTCRtpScriptTransform");const c=nA(),u=new MessageChannel;await new Qe(p=>c.onmessage=_=>{_.data==="registered"&&p(void 0)});const h=new RTCRtpScriptTransform(c,{name:"sei-tx",port:u.port2},[u.port2]);e.transform=h,await new Qe(p=>c.onmessage=_=>{_.data==="started"&&p(void 0)}),n.on("sei-to-send",p=>{u.port1.postMessage({sei:p})}),u.port1.onmessage=p=>{var _;p.data.transformed&&e.track&&((_=e.track)===null||_===void 0?void 0:_.id)!==i.track.id&&(k.debug("video track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",s),i.track=e.track,i.track.addEventListener("ended",s))},i.worker=c}}function s(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",s)}const c=uA.get(e);if(c){uA.delete(e);try{var u,h;(u=c.controller)===null||u===void 0||u.terminate(),(h=c.worker)===null||h===void 0||h.terminate()}catch(p){k.warning(p&&p.message)}}}uA.set(e,i),e.track.addEventListener("ended",s)},interceptRemoteVideoFrame:async function(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Cn().supportWebRTCEncodedTransform)return void k.warning("browser not support video encoded transform");if(!e.track)return;if(v0.has(e)){const c=v0.get(e);return void(c&&(c.onSei=n.onSei))}const i={track:e.track,onSei:n.onSei};if(uf()){if(!e.createEncodedStreams)return void k.warning("browser not support createEncodedStreams() API");let c=null;try{c=e.createEncodedStreams()}catch(h){return void k.error("create video-encoded-streams error",h&&h.message)}const u=new TransformStream({transform(h,p){i.controller||(i.controller=p),e.track&&e.track.id!==i.track.id&&(k.debug("video track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",s),i.track=e.track,i.track.addEventListener("ended",s));const _=function(E){const S=new DataView(E.data);let w=0;for(;w+4<E.data.byteLength;){if(S.getUint8(w+0)===0&&S.getUint8(w+1)===0&&S.getUint8(w+2)===0&&S.getUint8(w+3)===1&&S.getUint8(w+4)===6){let I=w+6,P=0,B=0;for(;(B=S.getUint8(I++))===255;)P+=255;P+=B;const M=lhe(E.data,I,P);return new Uint8Array(M)}w++}return null}(h);_&&i.onSei&&i.onSei(_),p.enqueue(h)}});c.readable.pipeThrough(u).pipeTo(c.writable)}else if(lo()){if(typeof RTCRtpScriptTransform>"u")return void k.warning("browser not support RTCRtpScriptTransform");const c=nA(),u=new MessageChannel;await new Qe(p=>c.onmessage=_=>{_.data==="registered"&&p(void 0)});const h=new RTCRtpScriptTransform(c,{name:"sei-rx",port:u.port2},[u.port2]);e.transform=h,await new Qe(p=>c.onmessage=_=>{_.data==="started"&&p(void 0)}),u.port1.onmessage=p=>{var _;p.data.transformed&&e.track&&((_=e.track)===null||_===void 0?void 0:_.id)!==i.track.id?(k.debug("video track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",s),i.track=e.track,i.track.addEventListener("ended",s)):p.data.sei&&i.onSei&&i.onSei(p.data.sei)},i.worker=c}function s(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",s)}(function(c){const u=v0.get(c);if(u){v0.delete(c);try{var h,p;(h=u.controller)===null||h===void 0||h.terminate(),(p=u.worker)===null||p===void 0||p.terminate()}catch(_){k.warning(_&&_.message)}}})(e)}v0.set(e,i),e.track.addEventListener("ended",s)}},Ome={name:"InterceptFrame",create:()=>Ame};J1(),Kn("PROCESS_ID","process-".concat(er(8,""),"-").concat(er(4,""),"-").concat(er(4,""),"-").concat(er(4,""),"-").concat(er(12,""))),function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(n){return void k.error("Error loading sdk config",n.message)}if(e)try{const n=JSON.parse(window.atob(e)),i=Date.now();k.debug("Loading global parameters from cache",n),Object.keys(n).forEach(s=>{if(Object.prototype.hasOwnProperty.call(lr,s)){const{value:c,expires:u}=n[s];if(u&&u<=i)return;Wu[s]=c,lr[s]=c}})}catch(n){k.error("Error loading mutableParamsCache: ".concat(e),n.message)}}(),Array.isArray(Wu.AREAS)&&Wu.AREAS.length>0&&WL(Wu.AREAS,!0);const aK=(e,n,i)=>{k.debug("setParameter key:".concat(e,", value:").concat(JSON.stringify(n))),Kn(e,n,i)};Yp(Qpe,!1),Yp(tme,!1),Yp(Lfe,!1),Yp(hme,!1),Yp(Ype,!1),Yp(wme,!1),Yp(Ime,!1),Yp(Ome,!1);const mi=function(e){const n=new Rr,i=e,s={getListeners:n.getListeners.bind(n),on:(c,u)=>(function(h,p){h===Wd.SECURITY_POLICY_VIOLATION&&BH(p,!0)}(c,u),n.on.bind(n)(c,u)),addListener:n.addListener.bind(n),once:n.once.bind(n),off:n.off.bind(n),removeAllListeners:n.removeAllListeners.bind(n),emit:n.emit.bind(n),safeEmit:n.safeEmit.bind(n)};return jH(jH({},i),s)}({__TRACK_LIST__:UE,VERSION:el,BUILD:eL,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:aK,getParameter:Z,getSupportedCodec:async function(){let e={audio:[],video:[]};try{let n=new RTCPeerConnection;const i=await async function(s){let c;return Cn().supportUnifiedPlan?(s.addTransceiver("video",{direction:"recvonly"}),s.addTransceiver("audio",{direction:"recvonly"}),c=(await s.createOffer()).sdp):c=(await s.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,c}(n);if(!i)return e;n.close(),n=null,e=function(s){const c={video:[],audio:[]};return s.match(/ VP8/i)&&c.video.push("VP8"),s.match(/ VP9/i)&&c.video.push("VP9"),s.match(/ AV1/i)&&c.video.push("AV1"),s.match(/ H264/i)&&c.video.push("H264"),s.match(/ H265/i)&&c.video.push("H265"),s.match(/ opus/i)&&c.audio.push("OPUS"),s.match(/ PCMU/i)&&c.audio.push("PCMU"),s.match(/ PCMA/i)&&c.audio.push("PCMA"),s.match(/ G722/i)&&c.audio.push("G722"),c}(i)}catch(n){throw new be(Y.CREATE_OFFER_FAILED,n.toString&&n.toString()).print()}return e},checkSystemRequirements:function(){const e=pt.reportApiInvoke(null,{name:fi.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:Dr.TRACER});let n=!1;try{const u=window.RTCPeerConnection,h=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,p=window.WebSocket;n=!!(u&&h&&p),n&&M1()&&c6(75)&&new u().close()}catch(u){return k.error("check system requirement failed: ",u),!1}let i=!1;const s=vn();s.name===Nn.CHROME&&Number(s.version)>=58&&(ju.engine.name!=="WebKit"||function(){const u=vn();if(FI()){if(u.os===Pi.MAC_OS)return!0;if(u.os===Pi.IOS){const h=ju.os.version&&ju.os.version.split(".");if(h&&Number(h[0])===14&&h[1]&&Number(h[1])>=3||h&&Number(h[0])>14)return!0}}return!1}())&&(i=!0),(s.name===Nn.FIREFOX&&Number(s.version)>=56||s.name===Nn.OPERA&&Number(s.version)>=45||s.name===Nn.SAFARI&&Number(s.version)>=11||s.name==="WebKit"&&(cs()||Ul())&&s.osVersion&&Number(s.osVersion.split(".")[0])>=11||p6()||vn().name===Nn.QQ)&&(i=!0),k.debug("checkSystemRequirements, api:",n,"browser",i);const c=n&&i;return e.onSuccess(c),c},getDevices:function(e){return Tc.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return Tc.getRecordingDevices(e)},getCameras:function(e){return Tc.getCamerasDevices(e)},getElectronScreenSources:cW,getPlaybackDevices:function(e){return Tc.getSpeakers(e)},createClient:function(){var e;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const i=er(5,"client-"),s=pt.reportApiInvoke(null,{id:i,name:fi.CREATE_CLIENT,options:[n],tag:Dr.TRACER});try{(function(c){bi(c.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),bi(c.mode,"config.mode",["rtc","live","p2p"]),c.audioCodec!==void 0&&bi(c.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),c.proxyServer!==void 0&&Xi(c.proxyServer,"config.proxyServer",1,1e4),c.turnServer!==void 0&&T6(c.turnServer),c.httpRetryConfig!==void 0&&S6(c.httpRetryConfig),c.websocketRetryConfig!==void 0&&S6(c.websocketRetryConfig)})(n)}catch(c){throw s.onError(c),c}return(u6(16,0)||d6(16,0,!0))&&(n.codec==="vp9"&&(n.codec="vp8",k.debug("browser not support vp9, force use vp8")),Kn("UNSUPPORTED_VIDEO_CODEC",["vp9"])),n.audioCodec===void 0&&(n.audioCodec="opus"),s.onSuccess(),new xfe(Hl(Hl({forceWaitGatewayResponse:!0},n),{},{role:$e(e=["rtc","p2p"]).call(e,n.mode)?"host":n.role||"audience"}),i)},createCameraVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=Z("CAMERA_CAPTURE_CONFIG"),i=er(8,"track-cam-"),s=pt.reportApiInvoke(null,{id:i,tag:Dr.TRACER,name:fi.CREATE_CAM_VIDEO_TRACK,options:[yr({},e),n]});n&&(e.encoderConfig=n);const c=eA(e);let u=null;k.info("start create camera video track with config",JSON.stringify(e),"trackId",i);try{u=(await Sc({video:c},i)).getVideoTracks()[0]||null}catch(p){throw s.onError(p),p}if(!u){const p=new Ie(Y.UNEXPECTED_ERROR,"can not find track in media stream");return s.onError(p),p.throw(k)}e.optimizationMode&&_L(i,u,e,Fd(e.encoderConfig));const h=new gL(u,e,c,e.scalabiltyMode?XI(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,i);return s.onSuccess(h.getTrackId()),k.info("create camera video success, trackId:",i),h},createCustomVideoTrack:function(e){const n=er(8,"track-cus-"),i=pt.reportApiInvoke(null,{id:n,tag:Dr.TRACER,name:fi.CREATE_CUSTOM_VIDEO_TRACK,options:[e]}),s=new ur(e.mediaStreamTrack,{width:e.width,height:e.height,frameRate:e.frameRate,bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?XI(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,n,[tr.CUSTOM_TRACK]);return i.onSuccess(s.getTrackId()),k.info("create custom video track success with config",e,"trackId",s.getTrackId()),s},createScreenVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const i=typeof n=="object"?function(I){return vW(I)}(n):void 0;i&&(n="auto");const s=er(8,"track-scr-v-"),c=pt.reportApiInvoke(null,{id:s,tag:Dr.TRACER,name:fi.CREATE_SCREEN_VIDEO_TRACK,options:[yr({},e),n]});e.encoderConfig?typeof e.encoderConfig=="string"||e.encoderConfig.width&&e.encoderConfig.height||(e.encoderConfig.width={max:1920},e.encoderConfig.height={max:1080}):e.encoderConfig="1080p_2";const u=function(I){const P={};I.screenSourceType&&(P.mediaSource=I.screenSourceType),I.extensionId&&uf()&&(P.extensionId=I.extensionId);const{displaySurface:B,selfBrowserSurface:M,surfaceSwitching:U,systemAudio:$,preferCurrentTab:q}=I;(a0(107)||D1(107)||L1(93))&&(B&&(bi(B,"displaySurface",["browser","window","monitor"]),P.displaySurface=B),M?(bi(M,"selfBrowserSurface",["exclude","include"]),P.selfBrowserSurface=M):P.selfBrowserSurface="include",U&&(bi(U,"surfaceSwitching",["exclude","include"]),P.surfaceSwitching=U)),(a0(105)||D1(105)||L1(91))&&$&&(bi($,"systemAudio",["exclude","include"]),P.systemAudio=$),(a0(94)||D1(94)||L1(80))&&q&&(P.preferCurrentTab=!0),I.electronScreenSourceId&&(P.sourceId=I.electronScreenSourceId);const ce=I.encoderConfig?oL(I.encoderConfig):null;return P.mandatory={chromeMediaSource:"desktop",maxWidth:ce?ce.width:void 0,maxHeight:ce?ce.height:void 0},ce&&(ce.frameRate&&(typeof ce.frameRate=="number"?(P.mandatory.maxFrameRate=ce.frameRate,P.mandatory.minFrameRate=ce.frameRate):(P.mandatory.maxFrameRate=ce.frameRate.max||ce.frameRate.ideal||ce.frameRate.exact||void 0,P.mandatory.minFrameRate=ce.frameRate.min||ce.frameRate.ideal||ce.frameRate.exact||void 0),P.frameRate=ce.frameRate),ce.width&&(P.width=ce.width),ce.height&&(P.height=ce.height)),P}(e);let h=null,p=null;const _=Cn();if(!_.supportShareAudio&&n==="enable"){const I=new Ie(Y.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return c.onError(I),I.throw(k)}k.info("start create screen video track with config",e,"withAudio",n,"trackId",s);const E=_.supportShareAudio&&n!=="disable";try{const I=await Sc({screen:u,screenAudio:E?i||!0:void 0},s);h=I.getVideoTracks()[0]||null,p=I.getAudioTracks()[0]||null}catch(I){throw c.onError(I),I}if(!h){const I=new Ie(Y.UNEXPECTED_ERROR,"can not find track in media stream");return c.onError(I),I.throw(k)}if(!p&&n==="enable"){h&&h.stop();const I=new Ie(Y.SHARE_AUDIO_NOT_ALLOWED);return c.onError(I),I.throw(k)}e.optimizationMode||(e.optimizationMode="detail"),e.optimizationMode&&(_L(s,h,e,e.encoderConfig&&oL(e.encoderConfig)||void 0),e.encoderConfig&&typeof e.encoderConfig!="string"&&(e.encoderConfig.bitrateMin=e.encoderConfig.bitrateMax));const S=new ur(h,e.encoderConfig?oL(e.encoderConfig):{},e.scalabiltyMode?XI(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,s,[tr.SCREEN_TRACK]);if(!p)return c.onSuccess(S.getTrackId()),k.info("create screen video track success","video:",S.getTrackId()),S;const w=new Fr(p,void 0,er(8,"track-scr-a-"),!1);return c.onSuccess([S.getTrackId(),w.getTrackId()]),k.info("create screen video track success","video:",S.getTrackId(),"audio:",w.getTrackId()),[S,w]},createMicrophoneAndCameraTracks:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=Z("CAMERA_CAPTURE_CONFIG"),s=er(8,"track-mic-"),c=er(8,"track-cam-"),u=pt.reportApiInvoke(null,{id:"".concat(s,"-").concat(c),tag:Dr.TRACER,name:fi.CREATE_MIC_AND_CAM_TRACKS,options:[e,n,i]});i&&(n.encoderConfig=i);const h=eA(n),p=EW(e);let _=null,E=null;k.info("start create camera video track(".concat(c,") and microphone audio track(").concat(s,") with config, audio: ").concat(JSON.stringify(e),", video: ").concat(JSON.stringify(n)));try{const I=await Sc({audio:p,video:h},"".concat(s,"-").concat(c));_=I.getAudioTracks()[0],E=I.getVideoTracks()[0]}catch(I){throw u.onError(I),I}if(!_||!E){const I=new Ie(Y.UNEXPECTED_ERROR,"can not find tracks in media stream");return u.onError(I),I.throw(k)}n.optimizationMode&&_L(c,E,n,Fd(n.encoderConfig));const S=new tA(_,e,p,s),w=new gL(E,n,h,n.scalabiltyMode?XI(n.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},n.optimizationMode,c);return u.onSuccess([S.getTrackId(),w.getTrackId()]),k.info("create camera video track(".concat(c,") and microphone audio track(").concat(s,") success")),[S,w]},createMicrophoneAudioTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=er(8,"track-mic-"),i=pt.reportApiInvoke(null,{id:n,tag:Dr.TRACER,name:fi.CREATE_MIC_AUDIO_TRACK,options:[e]}),s=EW(e);let c=null;k.info("start create microphone audio track with config",JSON.stringify(e),"trackId",n);try{c=(await Sc({audio:s},n)).getAudioTracks()[0]||null}catch(h){throw i.onError(h),h}if(!c){const h=new Ie(Y.UNEXPECTED_ERROR,"can not find track in media stream");return i.onError(h),h.throw(k)}const u=new tA(c,e,s,n);return i.onSuccess(u.getTrackId()),k.info("create microphone audio track success, trackId:",n),u},createCustomAudioTrack:function(e){const n=er(8,"track-cus-"),i=pt.reportApiInvoke(null,{id:n,tag:Dr.TRACER,name:fi.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),s=new Fr(e.mediaStreamTrack,e.encoderConfig?JI(e.encoderConfig):{},n,!1);return k.info("create custom audio track success with config",e,"trackId",s.getTrackId()),i.onSuccess(s.getTrackId()),s},createBufferSourceAudioTrack:async function(e){var n;const{cacheOnlineFile:i,encoderConfig:s}=e;let{source:c}=e;const u={source:c instanceof AudioBuffer?"AudioBuffer":c instanceof File?(n=File.name)!==null&&n!==void 0?n:"File":c,cacheOnlineFile:i,encoderConfig:s},h=er(8,"track-buf-"),p=pt.reportApiInvoke(null,{id:h,tag:Dr.TRACER,name:fi.CREATE_BUFFER_AUDIO_TRACK,options:[u]});if(Z("DISABLE_WEBAUDIO"))throw new Ie(Y.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");k.info("start create buffer source audio track with config",JSON.stringify(u),"trackId",h);const _=c;if(!(c instanceof AudioBuffer))try{c=await async function(w,I){let P=null;if(typeof w=="string"){const M=oG.get(w);if(M)return k.debug("use cached audio resource: ",w),M;try{P=(await Bu(()=>Ls.get(w,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(U){throw new Ie(Y.FETCH_AUDIO_FILE_FAILED,U.toString())}}else P=await new Qe((U,$)=>{const q=new FileReader;q.onload=ce=>{ce.target?U(ce.target.result):$(new Ie(Y.READ_LOCAL_AUDIO_FILE_ERROR))},q.onerror=()=>{$(new Ie(Y.READ_LOCAL_AUDIO_FILE_ERROR))},q.readAsArrayBuffer(w)});const B=await function(M){const U=GE();return new Qe(($,q)=>{U.decodeAudioData(M,ce=>{$(ce)},ce=>{q(new Ie(Y.DECODE_AUDIO_FILE_FAILED,ce.toString()))})})}(P);return typeof w=="string"&&I&&oG.set(w,B),B}(c,i)}catch(w){return p.onError(w),w.throw(k)}const E=new the(c),S=new ehe(_,E,s?JI(s):{},h);return k.info("create buffer source audio track success, trackId:",h),p.onSuccess(S.getTrackId()),S},setAppType:function(e){if(k.debug("setAppType: ".concat(e)),!(Number.isInteger(e)&&e>=0))throw k.debug("Invalid appType"),new be(Y.INVALID_PARAMS,"invalid app type",e);Kn("APP_TYPE",Math.floor(e))},setLogLevel:function(e){k.setLogLevel(e)},enableLogUpload:function(){Z("USE_NEW_LOG")?Kn("UPLOAD_LOG",!0):k.enableLogUpload()},disableLogUpload:function(){Z("USE_NEW_LOG")?Kn("UPLOAD_LOG",!1):k.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new o8},checkAudioTrackIsActive:async function(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const i=pt.reportApiInvoke(null,{tag:Dr.TRACER,name:fi.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[n]});if(!(e instanceof Fr||e instanceof KE)){const _=new be(Y.INVALID_TRACK,"the parameter is not a audio track");return i.onError(_),_.throw()}n&&n<1e3&&(n=1e3);const s=e instanceof Fr?e.getTrackLabel():"remote_track",c=e.getVolumeLevel();let u=c,h=c;const p=Date.now();return new Qe(_=>{const E=setInterval(()=>{const S=e.getVolumeLevel();u=S>u?S:u,h=S<h?S:h;const w=u-h>1e-4,I=Date.now()-p;if(w||I>n){clearInterval(E);const P=w,B={duration:I,deviceLabel:s,maxVolumeLevel:u,result:P};k.info("[track-".concat(e.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(B))),i.onSuccess(B),_(P)}},200)})},checkVideoTrackIsActive:async function(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const i=pt.reportApiInvoke(null,{tag:Dr.TRACER,name:fi.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[n]});if(!(e instanceof ur||e instanceof HE)){const w=new be(Y.INVALID_TRACK,"the parameter is not a video track");return i.onError(w),w.throw()}n&&n<1e3&&(n=1e3);const s=e instanceof ur?e.getTrackLabel():"remote_track",c=e.getMediaStreamTrack(!0),u=document.createElement("video");u.style.width="1px",u.style.height="1px",u.setAttribute("muted",""),u.muted=!0,u.setAttribute("playsinline",""),u.controls=!1,(lo()||FI())&&(u.style.opacity="0.01",u.style.position="fixed",u.style.left="0",u.style.top="0",document.body.appendChild(u)),u.srcObject=new MediaStream([c]),u.play();const h=document.createElement("canvas");h.width=160,h.height=120;let p=0,_=0;try{const w=Date.now();p=await function(I,P,B,M){let U,$=0,q=null;return new Qe((ce,me)=>{function ge(){$>M&&U&&(U(),ce($));const pe=B.getContext("2d");if(!pe){const Ze=new be(Y.UNEXPECTED_ERROR,"can not get canvas 2d context.");return k.error(Ze.toString()),void me(Ze)}pe.drawImage(I,0,0,160,120);const Re=pe.getImageData(0,0,B.width,B.height),Ve=Math.floor(Re.data.length/3);if(q){for(let Ze=0;Ze<Ve;Ze+=3)if(Re.data[Ze]!==q[Ze])return $+=1,void(q=Re.data);q=Re.data}else q=Re.data}setTimeout(()=>{U&&(U(),ce($))},P),U=uL(()=>{ge()},30)})}(u,n,h,4),_=Date.now()-w}catch(w){throw i.onError(w),w}yfe===Nn.SAFARI&&(u.pause(),u.remove()),u.srcObject=null;const E=p>4,S={duration:_,changedPicNum:p,deviceLabel:s,result:E};return k.info("[track-".concat(e.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(S))),i.onSuccess(S),E},setArea:WL,audioElementPlayCenter:xs,resumeAudioContext:function(){xs.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(e){Ufe.processExternalMediaAEC(e)},registerExtensions:function(e){const n=Z("PLUGIN_INFO")||[];e.forEach(i=>{"name"in i&&!$e(n).call(n,i.name)&&n.push(i.name);const s=i;s.__registered__=!0,s.logger.hookLog=k.extLog,s.reporter.hookApiInvoke=pt.extApiInvoke,s.parameters&&Object.keys(s.parameters).forEach(c=>{s.parameters[c]=Z(c)})}),aK("PLUGIN_INFO",n)},ChannelMediaRelayError:YE,ChannelMediaRelayEvent:_f,ChannelMediaRelayState:ua,RemoteStreamFallbackType:$de,RemoteStreamType:Kde,ConnectionDisconnectedReason:Mn,AudienceLatencyLevelType:bde,AREAS:kn,preload:async function(e,n,i,s){return k8(e,n,i,s)}});return Object.defineProperties(mi,{onAudioAutoplayFailed:{get:()=>bc.onAudioAutoplayFailed,set:e=>{bc.onAudioAutoplayFailed=e}},onAutoplayFailed:{get:()=>bc.onAutoplayFailed,set:e=>{bc.onAutoplayFailed=e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>mi._onSecurityPolicyViolation,set(e){mi._onSecurityPolicyViolation=e,BH(e)}},__CLIENT_LIST__:{get:()=>Z("SHOW_GLOBAL_CLIENT_LIST")?n_:[]}}),Tc.on(Qg.CAMERA_DEVICE_CHANGED,e=>{k.info("camera device changed",JSON.stringify(e)),mi.onCameraChanged&&mi.onCameraChanged(e),mi.safeEmit(Wd.CAMERA_CHANGED,e)}),Tc.on(Qg.RECORDING_DEVICE_CHANGED,e=>{k.info("microphone device changed",JSON.stringify(e)),mi.onMicrophoneChanged&&mi.onMicrophoneChanged(e),mi.safeEmit(Wd.MICROPHONE_CHANGED,e)}),Tc.on(Qg.PLAYOUT_DEVICE_CHANGED,e=>{k.debug("playout device changed",JSON.stringify(e)),mi.onPlaybackDeviceChanged&&mi.onPlaybackDeviceChanged(e),mi.safeEmit(Wd.PLAYBACK_DEVICE_CHANGED,e)}),xs.onAutoplayFailed=()=>{k.info("detect audio element autoplay failed"),bc.onAudioAutoplayFailed&&bc.onAudioAutoplayFailed()},$n.on("autoplay-failed",()=>{k.info("detect webaudio autoplay failed"),bc.onAudioAutoplayFailed&&bc.onAudioAutoplayFailed(),mi.safeEmit(Wd.AUTOPLAY_FAILED)}),$n.on(Zi.STATE_CHANGE,(e,n)=>{k.info("audio context state changed: ".concat(n," => ").concat(e)),mi.onAudioContextStateChanged&&mi.onAudioContextStateChanged(e,n),mi.safeEmit(Wd.AUDIO_CONTEXT_STATE_CHANGED,e,n)}),ri.on(NE.NETWORK_STATE_CHANGE,(e,n)=>{k.info("[network-indicator] network state changed, ".concat(n," => ").concat(e))}),window&&(window.__ARTC__=mi),mi})}(EP)),EP.exports}var o3e=i3e();const Dw=TS(o3e),s3e=Dw.createClient({mode:"rtc",codec:"vp8"});let by=null;const Gre=V.createContext(null),zre=({children:r,appId:t="130dccf9b3554bda87f8cf577f91c8c4",channel:o=null,token:a=null,uid:l=null,enabled:d=!0,startMuted:m=!0,onClientReady:v=()=>{}})=>{const[y,b]=V.useState(!1),[R,O]=V.useState(!1),[N,F]=V.useState([]),[H,G]=V.useState(null),[z,ne]=V.useState(null),[J,oe]=V.useState(null),[se,ae]=V.useState(!1),[ye,Q]=V.useState(!1),[te,re]=V.useState(!1),[le,ve]=V.useState(null),fe=V.useRef(s3e),de=V.useRef({appId:t,channel:o,uid:l,enabled:d}),lt=V.useRef(!1),ft=V.useRef(null);V.useRef(null),V.useEffect(()=>{de.current={appId:t,channel:o,uid:l,enabled:d},console.log("AgoraProvider: Updated props ref:",{appId:t,channel:o,uid:l,enabled:d})},[t,o,l,d]),V.useEffect(()=>{console.log("AgoraProvider: Props changed:",{appId:t,channel:o,uid:l,enabled:d}),typeof window<"u"&&!window.agoraClient&&(window.agoraClient={isVoiceEnabled:!1,isJoined:!1,client:fe.current},console.log("AgoraProvider: Initialized window.agoraClient"))},[t,o,l,d]),V.useEffect(()=>{console.log("AgoraProvider: Setting current channel:",o),ne(o)},[o]),V.useEffect(()=>{if(!fe.current)return;const Fe=et=>{console.log(`Connection state changed to: ${et}`),et==="DISCONNECTED"?(b(!1),console.log("Disconnected from Agora")):et==="CONNECTED"&&(b(!0),G(null))};return fe.current.on("connection-state-change",Fe),()=>{fe.current.off("connection-state-change",Fe)}},[]),V.useEffect(()=>{if(!o||!d){console.log("AgoraProvider: Skipping initialization - channel or enabled is falsy",{channel:o,enabled:d});return}console.log("AgoraProvider: Initial setup for channel",o,"with UID",l);const Fe=async(Wt,Fn)=>{console.log("AgoraProvider: User published:",Wt.uid,Fn);try{await fe.current.subscribe(Wt,Fn),console.log("AgoraProvider: Subscribed to user:",Wt.uid,"mediaType:",Fn),Fn==="audio"&&(Wt.audioTrack.play(),console.log("AgoraProvider: Playing audio track for user:",Wt.uid)),F(xn=>xn.some(hn=>hn.uid===Wt.uid)?xn:[...xn,Wt])}catch(xn){console.error("AgoraProvider: Error subscribing to user:",xn)}},et=(Wt,Fn)=>{console.log("AgoraProvider: User unpublished:",Wt.uid,Fn),Fn==="audio"&&Wt.audioTrack&&(Wt.audioTrack.stop(),console.log("AgoraProvider: Stopped audio track for user:",Wt.uid))},_t=Wt=>{console.log("AgoraProvider: User joined:",Wt.uid),F(Fn=>Fn.some(xn=>xn.uid===Wt.uid)?Fn:[...Fn,Wt])},Dt=Wt=>{console.log("AgoraProvider: User left:",Wt.uid),F(Fn=>Fn.filter(xn=>xn.uid!==Wt.uid))};fe.current.on("user-published",Fe),fe.current.on("user-unpublished",et),fe.current.on("user-joined",_t),fe.current.on("user-left",Dt);const Ht=async()=>{if(lt.current){console.log("AgoraProvider: Already initializing, skipping duplicate initialization");return}lt.current=!0;try{console.log("AgoraProvider: Initializing microphone");const Wt=await Xe();if(console.log("AgoraProvider: Microphone initialized:",!!Wt),y&&ft.current===o){console.log("AgoraProvider: Already joined to channel",o),ae(!0),v(fe.current);return}if(fe.current.connectionState==="CONNECTING"||fe.current.connectionState==="CONNECTED")if(console.log("AgoraProvider: Client already in connecting/connected state:",fe.current.connectionState),ft.current&&ft.current!==o){console.log("AgoraProvider: Connected to different channel, leaving first");try{await Ke()}catch(Fn){console.error("AgoraProvider: Error leaving channel:",Fn)}}else{console.log("AgoraProvider: Client already connected or connecting, setting joined state to true"),b(!0),ae(!0),ft.current=o,by=o,v(fe.current);return}console.log("AgoraProvider: Joining channel",o,"current joined channel:",ft.current),await Le(),console.log("AgoraProvider: Join channel completed")}catch(Wt){console.error("AgoraProvider: Error during initialization:",Wt)}finally{lt.current=!1}};return console.log("AgoraProvider: Running initialization"),Ht(),()=>{console.log("AgoraProvider: Cleaning up event listeners"),fe.current.off("user-published",Fe),fe.current.off("user-unpublished",et),fe.current.off("user-joined",_t),fe.current.off("user-left",Dt)}},[o,d,l,v,y]);const Xe=async()=>{if(!d||J)return J;console.log("Initializing microphone");try{const Fe=await Dw.createMicrophoneAudioTrack();return await Fe.setMuted(m),oe(Fe),console.log("Microphone initialized successfully"),Fe}catch(Fe){return console.error("Error initializing microphone:",Fe),G("Failed to initialize microphone. Please check your permissions."),null}},Le=async()=>{if(!d)return console.log("AgoraProvider: Agora is disabled, not joining channel"),!1;if(!o)return console.error("AgoraProvider: No channel specified"),G("No channel specified"),!1;if(console.log("AgoraProvider: joinChannel called for channel",o,"with UID",l),console.log("AgoraProvider: Current state:",{isJoined:y,isJoining:ye,connectionState:fe.current.connectionState,joinedChannel:ft.current}),y&&ft.current===o)return console.log("AgoraProvider: Already joined to channel:",o),!0;if(ye)return console.log("AgoraProvider: Already in the process of joining"),!1;if(fe.current.connectionState==="CONNECTED")if(ft.current&&ft.current!==o){console.log("AgoraProvider: Connected to different channel, leaving first");try{await Ke()}catch(Fe){console.error("AgoraProvider: Error leaving channel:",Fe)}}else return console.log("AgoraProvider: Client already connected, setting joined state to true"),b(!0),ae(!0),ft.current=o,by=o,v(fe.current),!0;if(fe.current.connectionState==="CONNECTING")return console.log("AgoraProvider: Client already connecting, waiting for connection"),Q(!0),new Promise(Fe=>{const et=setInterval(()=>{fe.current.connectionState==="CONNECTED"&&(clearInterval(et),b(!0),Q(!1),ae(!0),ft.current=o,by=o,v(fe.current),Fe(!0))},500);setTimeout(()=>{clearInterval(et),console.log("AgoraProvider: Connection timeout, considering join failed"),Q(!1),Fe(!1)},1e4)});try{console.log("AgoraProvider: Joining channel:",o,"with UID:",l||"random"),Q(!0);const Fe=l||Math.floor(Math.random()*1e6);if(await fe.current.join(t,o,a,Fe),console.log("AgoraProvider: Joined channel successfully with UID:",fe.current.uid),J){if(!J.muted&&R)try{await fe.current.publish(J),console.log("AgoraProvider: Published existing microphone track")}catch(et){!et.message||!et.message.includes("already published")?console.error("AgoraProvider: Error publishing microphone track:",et):console.log("AgoraProvider: Microphone track already published")}}else{const et=await Xe();console.log("AgoraProvider: Microphone initialized in joinChannel:",!!et),et&&!m&&(await fe.current.publish(et),console.log("AgoraProvider: Published microphone track"))}return b(!0),Q(!1),ae(!0),ft.current=o,by=o,v(fe.current),!0}catch(Fe){return console.error("AgoraProvider: Error joining channel:",Fe),Fe.message&&(Fe.message.includes("already in connecting/connected state")||Fe.message.includes("INVALID_OPERATION"))?(console.log("AgoraProvider: Client already connected, considering join successful"),b(!0),Q(!1),ae(!0),ft.current=o,by=o,v(fe.current),!0):(G(`Failed to join channel: ${Fe.message}`),Q(!1),!1)}},Ke=async()=>{if(y)try{J&&await fe.current.unpublish(J),await fe.current.leave(),by=null,ft.current=null,console.log("Left channel successfully"),b(!1),F([])}catch(Fe){console.error("Error leaving channel:",Fe),G(Fe.message||"Failed to leave channel")}};V.useEffect(()=>()=>{J&&J.close()},[]),V.useEffect(()=>{d&&o&&(!y||ft.current!==o)&&Xe().then(()=>{Le()})},[d,o,y]);const nt=()=>{if(!J)return!1;try{return J.isActive&&!J.muted}catch(Fe){return console.error("Error checking microphone status:",Fe),!1}};V.useEffect(()=>{const Fe=()=>{const _t=nt();_t!==R&&(console.log("Syncing microphone state:",{actualStatus:_t,currentState:R}),O(_t),window.dispatchEvent(new CustomEvent("VoiceToggled",{detail:{enabled:_t}})),window.agoraClient&&(window.agoraClient.isVoiceEnabled=_t,window.agoraClient.microphoneTrack=J))};J&&Fe();const et=setInterval(Fe,1e3);return()=>{clearInterval(et)}},[J,R]);const Ee=async()=>{var Fe;try{const et=R!==void 0?R:J?!J.muted:!1;if(console.log("AgoraProvider: Toggling voice, current state:",{isVoiceEnabled:R,currentState:et,hasMicTrack:!!J,trackMuted:J==null?void 0:J.muted}),!J&&(console.log("AgoraProvider: No microphone track, initializing..."),!await Xe()))return console.error("AgoraProvider: Failed to initialize microphone"),et;const _t=!et;if(console.log("AgoraProvider: New voice state will be:",_t),et){if(J)try{console.log("AgoraProvider: Muting microphone track"),await J.setMuted(!0),J.muted||(console.warn("AgoraProvider: Track not muted after setMuted(true), trying again"),await J.setEnabled(!1)),console.log("AgoraProvider: Microphone track muted successfully, muted state:",J.muted)}catch(Dt){return console.error("Error muting track:",Dt),et}}else if(J)try{fe.current&&y&&!((Fe=fe.current.localTracks)!=null&&Fe.includes(J))&&(console.log("AgoraProvider: Publishing microphone track"),await fe.current.publish(J),console.log("AgoraProvider: Microphone track published successfully")),console.log("AgoraProvider: Unmuting microphone track"),await J.setMuted(!1),J.muted&&(console.warn("AgoraProvider: Track still muted after setMuted(false), trying again"),await J.setEnabled(!0)),console.log("AgoraProvider: Microphone track unmuted successfully, muted state:",J.muted)}catch(Dt){return console.error("Error unmuting track:",Dt),et}return console.log("AgoraProvider: Setting voice enabled state to:",_t),O(_t),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isVoiceEnabled=_t,window.agoraClient.microphoneTrack=J,window.agoraClient.client=fe.current,console.log("AgoraProvider: Updated window.agoraClient with new state:",_t)),typeof window<"u"&&(window.dispatchEvent(new CustomEvent("VoiceToggled",{detail:{enabled:_t}})),console.log("AgoraProvider: Dispatched VoiceToggled event with enabled:",_t)),await new Promise(Dt=>setTimeout(Dt,100)),_t}catch(et){return console.error("Error toggling voice:",et),R}},Ye=async Fe=>{try{oe(Fe),console.log("Microphone track updated successfully")}catch(et){throw console.error("Error updating microphone track:",et),et}},yt=async()=>{if(!fe.current||!o)return console.error("AgoraProvider: Voice chat not connected"),!1;try{if(te)return console.log("AgoraProvider: Stopping screen share"),le&&(Array.isArray(le)?(await fe.current.unpublish(le),le.forEach(Fe=>Fe.close())):(await fe.current.unpublish(le),le.close()),ve(null)),re(!1),console.log("AgoraProvider: Screen sharing stopped"),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isScreenSharing=!1,window.agoraClient.screenTrack=null,window.dispatchEvent(new CustomEvent("ScreenShareToggled",{detail:{enabled:!1}}))),!1;console.log("AgoraProvider: Starting screen share");try{const Fe=await Dw.createScreenVideoTrack({encoderConfig:"1080p_1",optimizationMode:"detail"});return console.log("AgoraProvider: Screen track created:",Fe),Fe.on("track-ended",()=>{console.log("AgoraProvider: Screen sharing ended by browser UI"),fe.current.unpublish(Fe),Fe.close(),ve(null),re(!1),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isScreenSharing=!1,window.agoraClient.screenTrack=null,window.dispatchEvent(new CustomEvent("ScreenShareToggled",{detail:{enabled:!1}})))}),await fe.current.publish(Fe),ve(Fe),re(!0),console.log("AgoraProvider: Screen sharing started"),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isScreenSharing=!0,window.agoraClient.screenTrack=Fe,window.dispatchEvent(new CustomEvent("ScreenShareToggled",{detail:{enabled:!0}}))),!0}catch(Fe){return console.error("AgoraProvider: Error creating screen track:",Fe),re(!1),ve(null),!1}}catch(Fe){return console.error("AgoraProvider: Error toggling screen share:",Fe),re(!1),ve(null),!1}};V.useEffect(()=>{if(console.log("AgoraProvider: Initializing window.agoraClient"),typeof window<"u"){window.agoraClient={isVoiceEnabled:!1,isJoined:!1,client:fe.current,isScreenSharing:!1,screenTrack:null};const Fe=_t=>{console.log("AgoraProvider: Received ToggleScreenShare event"),yt().then(Dt=>{_t.detail&&_t.detail.callback&&_t.detail.callback(!0,Dt)}).catch(Dt=>{console.error("AgoraProvider: Error handling ToggleScreenShare event:",Dt),_t.detail&&_t.detail.callback&&_t.detail.callback(!1,te)})},et=_t=>{console.log("AgoraProvider: Received JoinVoiceChat event"),Le().then(Dt=>{_t.detail&&_t.detail.callback&&_t.detail.callback(Dt)}).catch(Dt=>{console.error("AgoraProvider: Error handling JoinVoiceChat event:",Dt),_t.detail&&_t.detail.callback&&_t.detail.callback(!1)})};return window.addEventListener("ToggleScreenShare",Fe),window.addEventListener("JoinVoiceChat",et),()=>{window.removeEventListener("ToggleScreenShare",Fe),window.removeEventListener("JoinVoiceChat",et),typeof window<"u"&&window.agoraClient&&(console.log("AgoraProvider: Cleaning up window.agoraClient"),window.agoraClient=null)}}return()=>{typeof window<"u"&&window.agoraClient&&(console.log("AgoraProvider: Cleaning up window.agoraClient"),window.agoraClient=null)}},[]),V.useEffect(()=>{console.log("AgoraProvider: Voice enabled state changed:",R),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isVoiceEnabled=R,window.agoraClient.microphoneTrack=J,window.agoraClient.client=fe.current,window.dispatchEvent(new CustomEvent("VoiceToggled",{detail:{enabled:R}})),console.log("AgoraProvider: Updated window.agoraClient and dispatched event:",{isVoiceEnabled:R}))},[R,J]);const at={client:fe.current,isJoined:y,isVoiceEnabled:R,users:N,error:H,channel:z,appId:t,toggleVoice:Ee,leaveChannel:Ke,joinChannel:Le,microphoneTrack:J,isReady:se,createMicrophoneTrack:Ye,isScreenSharing:te,screenTrack:le,toggleScreenShare:yt};return D.jsx(Gre.Provider,{value:at,children:r})},Hre=()=>{const r=V.useContext(Gre);if(!r)throw new Error("useAgoraContext must be used within an AgoraProvider");return r};zre.propTypes={children:Mr.node.isRequired,appId:Mr.string.isRequired,channel:Mr.string.isRequired,token:Mr.string,uid:Mr.oneOfType([Mr.string,Mr.number])};const a3e=()=>{var lt,ft;const{client:r,isVoiceEnabled:t,isJoined:o,users:a,error:l,microphoneTrack:d,isReady:m,channel:v,appId:y,toggleVoice:b,joinChannel:R,leaveChannel:O,createMicrophoneTrack:N,isScreenSharing:F,screenTrack:H,toggleScreenShare:G}=Hre(),[z,ne]=V.useState(t!==void 0?t:((lt=window.agoraClient)==null?void 0:lt.isVoiceEnabled)||!1),[J,oe]=V.useState(F!==void 0?F:((ft=window.agoraClient)==null?void 0:ft.isScreenSharing)||!1),[se,ae]=V.useState(!0);V.useEffect(()=>{var Xe;t!==void 0?ne(t):((Xe=window.agoraClient)==null?void 0:Xe.isVoiceEnabled)!==void 0?ne(window.agoraClient.isVoiceEnabled):d&&ne(!d.muted)},[t,d]),V.useEffect(()=>{var Xe;F!==void 0?oe(F):((Xe=window.agoraClient)==null?void 0:Xe.isScreenSharing)!==void 0&&oe(window.agoraClient.isScreenSharing)},[F]);const ye=V.useRef({isVoiceEnabled:z,isScreenSharing:J,isJoined:o,users:a,error:l,isReady:m,channel:v,appId:y});V.useEffect(()=>{ye.current={isVoiceEnabled:z,isScreenSharing:J,isJoined:o,users:a,error:l,isReady:m,channel:v,appId:y}},[z,J,o,a,l,m,v,y]),V.useEffect(()=>{const Xe=setTimeout(()=>{ae(!1)},5e3);return()=>clearTimeout(Xe)},[]),V.useEffect(()=>{m&&ae(!1)},[m]),V.useEffect(()=>{console.log("useVoiceChat context:",{contextIsVoiceEnabled:t,localVoiceEnabled:z,contextIsScreenSharing:F,localScreenSharing:J,isJoined:o,users:a.length,error:l,isReady:m,channel:v,appId:y,hasMicrophoneTrack:!!d,trackMuted:d==null?void 0:d.muted,hasScreenTrack:!!H})},[t,z,F,J,o,a,l,m,v,y,d,H]);const Q=async()=>{try{console.log("useVoiceChat: Toggling voice from:",z);const Xe=await b();if(console.log("useVoiceChat: Toggle result:",Xe),Xe!==void 0)ne(Xe);else{const Le=!z;ne(Le),window.agoraClient&&(window.agoraClient.isVoiceEnabled=Le)}return Xe!==void 0?Xe:!z}catch(Xe){return console.error("useVoiceChat: Error toggling voice:",Xe),z}},te=async()=>{try{console.log("useVoiceChat: Toggling screen share from:",J);const Xe=await G();if(console.log("useVoiceChat: Screen share toggle result:",Xe),Xe!==void 0)oe(Xe);else{const Le=!J;oe(Le),window.agoraClient&&(window.agoraClient.isScreenSharing=Le)}return Xe!==void 0?Xe:!J}catch(Xe){return console.error("useVoiceChat: Error toggling screen share:",Xe),J}},re=async()=>{z&&d&&await Q()},le=async()=>{!z&&d&&await Q()},ve=Xe=>a.some(Le=>{var Ke;return Le.uid===Xe&&((Ke=Le.audioTrack)==null?void 0:Ke.isPlaying)}),fe=V.useCallback(()=>{if(!d||!z)return 0;try{return d.getVolumeLevel()}catch(Xe){return console.error("Error getting volume level:",Xe),0}},[d,z]);return{isVoiceEnabled:z,isScreenSharing:J,isJoined:o,users:a,error:l,toggleVoice:Q,toggleScreenShare:te,mute:re,unmute:le,isUserSpeaking:ve,getVolumeLevel:fe,microphoneTrack:d,screenTrack:H,isLoading:se,channel:v,appId:y,joinChannel:R,leaveChannel:O,client:r,setMicrophoneDevice:async Xe=>{try{if(!Xe){console.error("No device ID provided");return}if(!r||!o){console.error("Client not initialized or not joined to a channel");return}d&&(z&&await r.unpublish(d),await d.close());const Le=await Dw.createMicrophoneAudioTrack({microphoneId:Xe,encoderConfig:"music_standard"});N&&await N(Le),z&&await r.publish(Le),console.log("Microphone device changed successfully")}catch(Le){throw console.error("Error changing microphone device:",Le),Le}}}},c3e=({size:r="md",tooltipPlacement:t="top",defaultMuted:o=!0,joinOnClick:a=!0,className:l="voice-button"})=>{const{isVoiceEnabled:d,toggleVoice:m,isJoined:v,joinChannel:y,channel:b,client:R}=a3e(),[O,N]=V.useState(!1),[F,H]=V.useState(!1);V.useEffect(()=>{const ne=()=>{Ct.log("VoiceButton: Player instantiated, showing button"),H(!0)};return window.addEventListener("PlayerInstantiated",ne),window.isPlayerInstantiated&&(Ct.log("VoiceButton: Player was already instantiated"),H(!0)),()=>{window.removeEventListener("PlayerInstantiated",ne)}},[]),V.useEffect(()=>{console.log("VoiceButton: State:",{isVoiceEnabled:d,isJoined:v,channel:b,hasClient:!!R,clientState:R==null?void 0:R.connectionState,windowAgoraClient:window.agoraClient,isPlayerReady:F})},[d,v,b,R,F]);const G=async()=>{if(!O){N(!0),console.log("VoiceButton: Handling click, current state:",{isVoiceEnabled:d,isJoined:v});try{if(!v&&a)try{console.log("VoiceButton: Not joined, attempting to join channel"),await y(),console.log("VoiceButton: Joined channel successfully")}catch(J){J.message&&J.message.includes("already in connecting/connected state")?console.log("VoiceButton: Already connected to channel"):console.error("VoiceButton: Error joining channel:",J)}console.log("VoiceButton: Toggling voice state from:",d);const ne=await m();console.log("VoiceButton: Voice toggled, new state:",ne)}catch(ne){console.error("VoiceButton: Error toggling voice:",ne)}finally{N(!1)}}},z=()=>F?O?"Processing...":v?d?"Turn microphone off":"Turn microphone on":"Connecting to voice chat...":"Waiting for player to be ready...";return F?D.jsx(Zw,{label:z(),placement:t,hasArrow:!0,children:D.jsxs(Xt,{position:"relative",cursor:"pointer",onClick:G,children:[D.jsx(Eh,{size:r,borderRadius:"full",bg:d?"green.500":"red.500",icon:d?D.jsx(VU,{color:"white"}):D.jsx(UU,{color:"white"}),borderWidth:"1px",borderColor:"whiteAlpha.300",className:l,"data-testid":"voice-button"}),O&&D.jsx(Xt,{position:"absolute",top:"0",left:"0",right:"0",bottom:"0",display:"flex",alignItems:"center",justifyContent:"center",bg:"rgba(0, 0, 0, 0.6)",borderRadius:"full",children:D.jsx(zw,{size:"sm",color:"white"})})]})}):null},l3e=Gi.createContext({user:null}),u3e=({userNickname:r})=>{const{client:t,channel:o,screenTrack:a,isScreenSharing:l,toggleScreenShare:d}=Hre(),[m,v]=V.useState([]),[y,b]=V.useState(!1),[R,O]=V.useState(!0);V.useRef({});const N=V.useRef(null),{user:F}=V.useContext(l3e)||{user:null},[H,G]=V.useState({}),z=V.useRef(a);V.useEffect(()=>{z.current=a},[a]),V.useEffect(()=>{if(!t||!o){b(!1);return}const se=setTimeout(()=>{O(!1)},5e3);console.log("Setting up screen share display with existing client:",t),console.log("Current channel:",o);const ae=t.connectionState;if(console.log("Current connection state:",ae),ae==="CONNECTED")b(!0),O(!1);else{b(!1);const ye=Q=>{console.log("Connection state changed:",Q),Q==="CONNECTED"?(b(!0),O(!1)):b(!1)};return t.on("connection-state-change",ye),()=>{t.off("connection-state-change",ye),clearTimeout(se)}}return()=>{clearTimeout(se)}},[t,o]),V.useEffect(()=>{const se=async()=>{const ae={...H};let ye=!1;for(const Q of m){if(H[Q.uid])continue;let te=null,re=Q.uid;if(typeof re=="string"&&(re.includes("-")?(te=re.split("-")[0],re=re.split("-")[1]):re.includes("_")&&(te=re.split("_")[0],re=re.split("_")[1])),re)try{console.log("Trying to fetch nickname for user ID:",re);const le=await Um(re);le&&le.Nickname?(console.log("Found nickname in Firebase for user ID:",re,"Nickname:",le.Nickname),ae[Q.uid]=le.Nickname,ye=!0):te?(console.log("Using extracted name for user ID:",re,"Name:",te),ae[Q.uid]=te,ye=!0):(ae[Q.uid]="User",ye=!0)}catch(le){console.error("Error fetching user profile:",le),te?(ae[Q.uid]=te,ye=!0):(ae[Q.uid]="User",ye=!0)}else te?(ae[Q.uid]=te,ye=!0):(ae[Q.uid]="User",ye=!0)}ye&&G(ae)};m.length>0&&se()},[m,H]),V.useEffect(()=>{if(!t||!o||!y)return;console.log("Setting up screen share event handlers");const se=async(Q,te)=>{if(console.log("User published:",Q.uid,te,Q),te==="video"){console.log("Remote video track detected:",Q.uid);try{await t.subscribe(Q,te),console.log("Subscribed to remote video track:",Q.uid),v(re=>re.some(le=>le.uid===Q.uid)?re:[...re,Q])}catch(re){console.error("Error subscribing to remote video track:",re)}}},ae=(Q,te)=>{if(console.log("User unpublished:",Q.uid,te),te==="video"){if(console.log("Remote video track unpublished:",Q.uid),Q.videoTrack)try{Q.videoTrack.stop()}catch(re){console.error("Error stopping video track:",re)}if(v(re=>re.filter(le=>le.uid!==Q.uid)),l&&z.current&&N.current)try{console.log("Ensuring local screen track is still playing after remote user unpublished"),z.current.play(N.current)}catch(re){console.error("Error replaying local screen track:",re)}}},ye=Q=>{console.log("User left:",Q.uid);const te=m.find(re=>re.uid===Q.uid);if(te&&te.videoTrack)try{te.videoTrack.stop()}catch(re){console.error("Error stopping video track:",re)}if(v(re=>re.filter(le=>le.uid!==Q.uid)),l&&z.current&&N.current)try{console.log("Ensuring local screen track is still playing after remote user left"),z.current.play(N.current)}catch(re){console.error("Error replaying local screen track:",re)}};return t.on("user-published",se),t.on("user-unpublished",ae),t.on("user-left",ye),()=>{t.off("user-published",se),t.off("user-unpublished",ae),t.off("user-left",ye)}},[t,o,y,m,l]),V.useEffect(()=>{if(console.log("Remote screens changed:",m.length,m),m.forEach(se=>{if(se.videoTrack)try{console.log("Playing video track for:",se.uid),se.videoTrack.play(`video-container-${se.uid}`)}catch(ae){console.error("Error playing video track:",ae)}}),l&&z.current&&N.current)try{console.log("Ensuring local screen track is still playing after remote screens changed"),z.current.play(N.current)}catch(se){console.error("Error replaying local screen track:",se)}},[m,l]),V.useEffect(()=>{if(console.log("Local screen sharing state changed:",l,a),l&&a&&N.current)try{console.log("Playing local screen track"),a.play(N.current)}catch(se){console.error("Error playing local screen track:",se)}},[l,a]),V.useEffect(()=>()=>{if(m.forEach(se=>{if(se.videoTrack)try{se.videoTrack.stop()}catch(ae){console.error("Error stopping video track on unmount:",ae)}}),a)try{a.stop()}catch(se){console.error("Error stopping local screen track on unmount:",se)}},[m,a]);const ne=se=>{console.log("Closing screen share for:",se);const ae=m.find(ye=>ye.uid===se);if(ae&&ae.videoTrack)try{ae.videoTrack.stop()}catch(ye){console.error("Error stopping video track:",ye)}if(v(ye=>ye.filter(Q=>Q.uid!==se)),l&&z.current&&N.current)try{console.log("Ensuring local screen track is still playing after closing remote screen"),z.current.play(N.current)}catch(ye){console.error("Error replaying local screen track:",ye)}},J=()=>{console.log("Stopping local screen share"),d()},oe=se=>(console.log("Getting display name for UID:",se,"type:",typeof se),l&&F&&(se===F.uid||se===(t==null?void 0:t.uid))?r||"You":H[se]?H[se]:typeof se=="string"?se.includes("-")?se.split("-")[0]:se.includes("_")?se.split("_")[0]:se:"User");return!y||R&&m.length===0&&!l||m.length===0&&!l?null:D.jsxs(Xt,{position:"fixed",top:"70px",right:"20px",zIndex:1e4,maxWidth:"80vw",maxHeight:"80vh",overflow:"auto",children:[l&&a&&D.jsxs(Xt,{position:"relative",mb:4,borderRadius:"md",overflow:"hidden",boxShadow:"xl",bg:"black",width:"640px",height:"360px",children:[D.jsx(Xt,{position:"absolute",top:2,right:2,zIndex:10,children:D.jsx(mw,{size:"sm",bg:"rgba(0,0,0,0.5)",color:"white",onClick:J})}),D.jsx(Xt,{ref:N,width:"100%",height:"100%",position:"relative",id:"local-screen-container"}),D.jsx(Xt,{position:"absolute",bottom:2,left:2,color:"white",fontSize:"sm",bg:"rgba(0,0,0,0.5)",px:2,py:1,borderRadius:"md",zIndex:5,children:r?`${r}'s Screen`:"Your Screen"})]}),m.map(se=>{const ae=H[se.uid]||oe(se.uid);return D.jsxs(Xt,{position:"relative",mb:4,borderRadius:"md",overflow:"hidden",boxShadow:"xl",bg:"black",width:"640px",height:"360px",children:[D.jsx(Xt,{position:"absolute",top:2,right:2,zIndex:10,children:D.jsx(mw,{size:"sm",bg:"rgba(0,0,0,0.5)",color:"white",onClick:()=>ne(se.uid)})}),D.jsx(Xt,{id:`video-container-${se.uid}`,width:"100%",height:"100%",position:"relative"}),D.jsx(Xt,{position:"absolute",bottom:2,left:2,color:"white",fontSize:"sm",bg:"rgba(0,0,0,0.5)",px:2,py:1,borderRadius:"md",zIndex:5,children:`${ae}'s Screen`})]},se.uid)})]})},d3e=({onClose:r})=>{const t=Hw(),[o,a]=V.useState(!1),[l,d]=V.useState(!1);V.useEffect(()=>{const y=()=>{window.agoraClient&&d(!!window.agoraClient.isScreenSharing)};y();const b=setInterval(y,1e3),R=()=>{y()};return window.addEventListener("ScreenShareToggled",R),()=>{clearInterval(b),window.removeEventListener("ScreenShareToggled",R)}},[]);const m=async y=>{if(y.preventDefault(),y.stopPropagation(),r&&r(),!window.agoraClient||!window.agoraClient.client){t({title:"Screen sharing not available",description:"Voice chat must be connected to use screen sharing",status:"warning",duration:3e3,isClosable:!0});return}try{if(a(!0),window.agoraClient.isJoined)v();else{console.log("ScreenShareMenuOption: Not joined to voice chat, joining automatically");const b=new CustomEvent("JoinVoiceChat",{detail:{callback:R=>{if(!R){console.error("ScreenShareMenuOption: Failed to join voice chat"),t({title:"Connection failed",description:"Could not connect to voice chat",status:"error",duration:3e3,isClosable:!0}),a(!1);return}v()}}});window.dispatchEvent(b)}}catch(b){console.error("Error in screen share handler:",b),a(!1),t({title:"Screen sharing error",description:b.message||"Failed to toggle screen sharing",status:"error",duration:5e3,isClosable:!0})}},v=async()=>{try{const y=new CustomEvent("ToggleScreenShare",{detail:{callback:(b,R)=>{a(!1),b?(d(R),t(R?{title:"Screen sharing started",status:"success",duration:3e3,isClosable:!0}:{title:"Screen sharing stopped",status:"info",duration:3e3,isClosable:!0})):t({title:"Screen sharing error",description:"Failed to toggle screen sharing",status:"error",duration:5e3,isClosable:!0})}}});window.dispatchEvent(y)}catch(y){console.error("Error toggling screen share:",y),a(!1),t({title:"Screen sharing error",description:y.message||"Failed to toggle screen sharing",status:"error",duration:5e3,isClosable:!0})}};return D.jsx(pn,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:m,color:l?"red.300":"white",children:o?"Connecting...":l?"Stop Screen Sharing":"Share Screen"})};function h3e({open:r,onClose:t}){return D.jsxs(Rh,{isOpen:r,onClose:t,size:"lg",isCentered:!0,children:[D.jsx(Ih,{}),D.jsxs(Ch,{bg:"gray.900",color:"white",borderRadius:"lg",children:[D.jsx(Qf,{children:"Controls"}),D.jsx(Oh,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",_hover:{bg:"gray.600"},_focus:{boxShadow:"none"}}),D.jsx(Ah,{children:D.jsxs(Bo,{spacing:4,children:[D.jsxs(Xt,{bg:"gray.800",p:4,borderRadius:"md",textAlign:"center",children:[D.jsx(pn,{fontSize:"xl",fontWeight:"bold",children:"Getting Started"}),D.jsxs(Xt,{mt:2,children:[D.jsx(pn,{children:"WASD to move"}),D.jsx(pn,{children:"Shift to run"}),D.jsx(pn,{children:"Spacebar to jump/double jump"}),D.jsx(pn,{children:"Click to move around"})]})]}),D.jsxs(Xt,{bg:"gray.800",p:4,borderRadius:"md",textAlign:"center",children:[D.jsx(pn,{fontSize:"xl",fontWeight:"bold",children:"Camera Movements"}),D.jsx(Xt,{mt:2,children:D.jsx(pn,{children:"Click & drag to rotate camera"})})]}),D.jsxs(Xt,{bg:"gray.800",p:4,borderRadius:"md",textAlign:"center",children:[D.jsx(pn,{fontSize:"xl",fontWeight:"bold",children:"##########"}),D.jsx(Xt,{mt:2,children:D.jsx(pn,{children:"Type something here"})})]})]})})]})]})}const f3e=()=>{const[r,t]=V.useState([]),[o,a]=V.useState(""),[l,d]=V.useState(0),[m,v]=V.useState(100),[y,b]=V.useState(100),[R,O]=V.useState(!0),[N,F]=V.useState(!0),[H,G]=V.useState(!1);V.useEffect(()=>{(async()=>{try{await navigator.mediaDevices.getUserMedia({audio:!0});const ae=await Dw.getMicrophones();t(ae),ae.length>0&&a(ae[0].deviceId)}catch(ae){console.error("Error getting audio devices:",ae)}})()},[]),V.useEffect(()=>{const se=setInterval(()=>{d(H?Math.random()*50:0)},100);return()=>clearInterval(se)},[H]);const z=se=>{const ae=se.target.value;a(ae),console.log("Microphone changed to:",ae)},ne=se=>{v(se),console.log("Microphone volume set to:",se)},J=se=>{b(se),console.log("Speaker volume set to:",se)},oe=()=>{G(!H)};return D.jsxs(Bo,{spacing:6,align:"stretch",children:[D.jsxs(go,{children:[D.jsxs(eu,{children:["Microphone",D.jsx(QZ,{ml:2,colorScheme:H?"green":"red",children:H?"Enabled":"Muted"})]}),D.jsxs(kee,{value:o,onChange:z,bg:"gray.700",borderColor:"gray.600",_hover:{borderColor:"gray.500"},children:[r.map(se=>D.jsx("option",{value:se.deviceId,children:se.label||`Microphone ${se.deviceId.slice(0,5)}...`},se.deviceId)),r.length===0&&D.jsx("option",{value:"",children:"No microphones found"})]})]}),D.jsxs(Xt,{children:[D.jsx(pn,{mb:2,children:"Microphone Level"}),D.jsx(lF,{value:l,colorScheme:"green",size:"sm",borderRadius:"md",hasStripe:l>20,isAnimated:l>20})]}),D.jsxs(go,{children:[D.jsxs(eu,{children:["Microphone Volume: ",m,"%"]}),D.jsxs(rU,{value:m,onChange:ne,min:0,max:100,step:1,colorScheme:"blue",children:[D.jsx(oU,{bg:"gray.700",children:D.jsx(sU,{})}),D.jsx(iU,{boxSize:6})]})]}),D.jsxs(go,{children:[D.jsxs(eu,{children:["Speaker Volume: ",y,"%"]}),D.jsxs(rU,{value:y,onChange:J,min:0,max:100,step:1,colorScheme:"blue",children:[D.jsx(oU,{bg:"gray.700",children:D.jsx(sU,{})}),D.jsx(iU,{boxSize:6})]})]}),D.jsxs(go,{display:"flex",alignItems:"center",children:[D.jsx(eu,{mb:"0",children:"Microphone Enabled"}),D.jsx(aP,{isChecked:H,onChange:oe,colorScheme:"green",size:"lg"})]}),D.jsxs(go,{display:"flex",alignItems:"center",children:[D.jsx(eu,{mb:"0",children:"Echo Cancellation"}),D.jsx(aP,{isChecked:R,onChange:()=>O(!R),colorScheme:"green",size:"lg"})]}),D.jsxs(go,{display:"flex",alignItems:"center",children:[D.jsx(eu,{mb:"0",children:"Noise Suppression"}),D.jsx(aP,{isChecked:N,onChange:()=>F(!N),colorScheme:"green",size:"lg"})]}),D.jsxs(bN,{status:"info",borderRadius:"md",children:[D.jsx(TN,{}),"Note: These settings will be applied when you join a voice chat."]})]})};function p3e({open:r,onClose:t,containerRef:o}){return D.jsx(au,{containerRef:o,children:D.jsxs(Rh,{isOpen:r,onClose:t,size:"lg",isCentered:!0,children:[D.jsx(Ih,{}),D.jsxs(Ch,{bg:"gray.900",color:"white",borderRadius:"lg",children:[D.jsx(Qf,{children:"Settings"}),D.jsx(Oh,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",_hover:{bg:"gray.600"},_focus:{boxShadow:"none"}}),D.jsx(Ah,{children:D.jsxs(Fee,{variant:"enclosed",children:[D.jsxs(jee,{mb:4,children:[D.jsx(cU,{_selected:{color:"white",borderBottom:"2px solid white"},children:"Audio"}),D.jsx(cU,{_selected:{color:"white",borderBottom:"2px solid white"},children:"Graphics"})]}),D.jsxs(Bee,{children:[D.jsx(aU,{children:D.jsx(Xt,{p:4,bg:"gray.800",borderRadius:"md",children:D.jsx(f3e,{})})}),D.jsx(aU,{children:D.jsx(Xt,{p:4,bg:"gray.800",borderRadius:"md",children:"Graphics settings content goes here."})})]})]})})]})]})})}const m3e=({onTogglePlayerList:r,spaceID:t})=>{const{fullscreenRef:o}=ep(),[a,l]=V.useState(!0),[d,m]=V.useState(!1),[v,y]=V.useState(!1),[b,R]=V.useState(!1),[O,N]=V.useState(!1),[F,H]=V.useState(null),{user:G}=V.useContext(wa),z=(G==null?void 0:G.Nickname)||"Unknown",ne=async()=>{if(G!=null&&G.uid)try{const Q=await Um(G.uid);H({rpmURL:Q.rpmURL?Q.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null})}catch(Q){console.error("Error fetching profile data:",Q)}};V.useEffect(()=>{ne()},[G==null?void 0:G.uid]),V.useEffect(()=>{const Q=()=>{l(!0)};return window.addEventListener("PlayerInstantiated",Q),()=>{window.removeEventListener("PlayerInstantiated",Q)}},[]);const J=()=>y(!v),oe=()=>R(!b),se=()=>{N(!1),ne()},ae=Q=>{Q.stopPropagation(),typeof r=="function"&&(Ct.log("CanvasMainMenu: Toggling player list"),r())},ye=()=>{m(!1)};return D.jsxs(D.Fragment,{children:[D.jsxs(sF,{isOpen:d,onClose:()=>m(!1),children:[D.jsx(cF,{as:ul,icon:D.jsx(qje,{}),"aria-label":"Main menu",variant:"ghost",color:"white",bg:d?"whiteAlpha.400":"whiteAlpha.200",_hover:{bg:d?"whiteAlpha.500":"whiteAlpha.300"},size:"md",onClick:()=>m(!d)}),D.jsx(au,{containerRef:o,children:D.jsx(aF,{bg:"rgba(0,0,0,0.4)",backdropFilter:"blur(10px)",border:"none",boxShadow:"lg",color:"white",width:"300px",p:4,borderRadius:"xl",zIndex:9999,transform:"none !important",children:D.jsxs(Bo,{align:"stretch",spacing:4,children:[D.jsxs(cS,{children:[D.jsx(Eh,{size:"md",src:F==null?void 0:F.rpmURL,bg:"white",name:" ",borderWidth:"1px",borderColor:"whiteAlpha.300"}),D.jsxs(Bo,{align:"start",spacing:0,children:[D.jsx(pn,{fontWeight:"bold",children:z}),D.jsx(pn,{fontSize:"sm",color:"whiteAlpha.800",children:"Spaces Metaverse"})]})]}),D.jsxs(cS,{spacing:4,justify:"center",children:[D.jsx(ul,{icon:D.jsx($4e,{}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"People",_hover:{bg:"whiteAlpha.200"},onClick:ae}),D.jsx(ul,{icon:D.jsx(Xt,{w:"4",h:"4"}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"Action 3",_hover:{bg:"whiteAlpha.200"}}),D.jsx(ul,{icon:D.jsx(Xt,{w:"4",h:"4"}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"Action 4",_hover:{bg:"whiteAlpha.200"}})]}),D.jsx(Ew,{borderColor:"whiteAlpha.300"}),D.jsxs(Bo,{align:"stretch",spacing:2,children:[G&&t&&D.jsx(d3e,{onClose:ye}),D.jsx(pn,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:J,children:"Settings"}),D.jsx(pn,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:oe,children:"Controls"}),D.jsx(pn,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",children:"Help"}),D.jsx(pn,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",color:"red.300",children:"Leave"})]})]})})})]}),b&&D.jsx(h3e,{open:b,onClose:oe}),v&&D.jsx(p3e,{open:v,onClose:J}),O&&D.jsx(jre,{open:O,onClose:se})]})},mj=V.forwardRef(({settings:r},t)=>{const{unityProvider:o,isLoaded:a}=LS(),l=x4e();U4e();const d=ak(),m=j4e(l),{user:v}=V.useContext(wa),[y,b]=V.useState(!1),[R,O]=V.useState(window.devicePixelRatio),[N,F]=F4e();xre().find(de=>de.isLocalPlayer);const[G,z]=V.useState(!0),[ne,J]=V.useState(!0),[oe,se]=V.useState(!1),ae=r.spaceID||"default",ye=V.useMemo(()=>{const ft=new URLSearchParams(window.location.search).get("sessionId")||ae;return console.log("WebGLRenderer: Using session ID:",ft),ft},[ae]),[Q,te]=V.useState(null);V.useEffect(()=>{v!=null&&v.uid&&Um(v.uid).then(de=>{te(de),console.log("WebGLRenderer: User profile loaded:",(de==null?void 0:de.Nickname)||"Unknown")}).catch(de=>{console.error("Error fetching user profile:",de)})},[v==null?void 0:v.uid]),V.useEffect(()=>{console.log("WebGLRenderer: Setting up player instantiation listener");const de=()=>{console.log("WebGLRenderer: Player instantiated event received"),J(!0),window.dispatchEvent(new CustomEvent("PlayerInstantiated")),window.isPlayerInstantiated=!0};window.isPlayerInstantiated&&(console.log("WebGLRenderer: Player was already instantiated from previous mount"),J(!0)),Mb.subscribe(xb.playerInstantiated,de);const lt=setTimeout(()=>{ne||(console.log("WebGLRenderer: Forcing player instantiation after timeout"),J(!0),window.isPlayerInstantiated=!0,window.dispatchEvent(new CustomEvent("PlayerInstantiated")))},5e3);return()=>{Mb.unsubscribe(xb.playerInstantiated,de),clearTimeout(lt)}},[ne]),V.useEffect(()=>{a||l?setTimeout(()=>{b(!0),Ct.log("WebGLRenderer: Unity is ready to receive messages.")},5e3):Ct.warn("WebGLRenderer: Unity is NOT ready yet.")},[a,l]),V.useEffect(()=>{const de=lt=>{Ct.log("WebGLRenderer: Received 'sendUserToUnity' event"),d("FirebaseUserFromReact",lt)};return Mb.subscribe(xb.sendUserToUnity,de),()=>Mb.unsubscribe(xb.sendUserToUnity,de)},[d]);const{setFullscreenRef:re,fullscreenRef:le}=ep();V.useEffect(()=>{re(t.current)},[t,re]);const ve=()=>{z(!G)},fe=v&&r.enableVoiceChat;return console.log("WebGLRenderer: Render with state:",{user:!!v,userId:v==null?void 0:v.uid,isPlayerInstantiated:ne,showVoiceChat:fe,sessionId:ye}),D.jsx(Xt,{className:"webgl-renderer",children:D.jsx(GU,{containerRef:le.current?le:document.body,children:D.jsxs("div",{ref:t,style:{width:"100%",height:"100%",aspectRatio:"16/9",position:"relative"},children:[D.jsxs(Xt,{position:"absolute",zIndex:"10",top:4,right:4,display:"flex",alignItems:"center",gap:2,children:[r.showAuthButton&&D.jsx(W4e,{}),fe&&D.jsxs(zre,{appId:"130dccf9b3554bda87f8cf577f91c8c4",channel:ye,uid:v==null?void 0:v.uid,enabled:!0,children:[D.jsx(c3e,{size:"md",defaultMuted:!0,joinOnClick:!0}),D.jsx(u3e,{userNickname:Q==null?void 0:Q.Nickname})]}),D.jsx(Y4e,{}),D.jsx(Xt,{position:"relative",zIndex:"9999",children:D.jsx(m3e,{onTogglePlayerList:ve,spaceID:ae})})]}),D.jsxs(Xt,{position:"relative",overflow:"hidden",width:"100%",height:"100%",bgRepeat:"no-repeat",bgSize:"cover",bgPosition:"center",bgColor:"#666666",bgImage:r.urlLoadingBackground?`url('${r.urlLoadingBackground}')`:"",children:[D.jsx(B4e,{}),D.jsx(Xt,{...m,width:"100%",height:"100%",position:"absolute",zIndex:"1",children:D.jsx(yre.Unity,{unityProvider:o,style:{width:"100%",height:"100%"},devicePixelRatio:R})}),D.jsx(Z4e,{})]}),D.jsx(Xt,{...m,position:"absolute",zIndex:"2",top:4,left:4,display:"flex",alignItems:"flex-start",gap:3,height:"50px",children:r.showDisruptiveLogo&&D.jsx(kV,{src:r.urlDisruptiveLogo,width:"100px",alt:"Disruptive Logo"})}),D.jsx(Xt,{...m,position:"absolute",zIndex:"2",bottom:4,left:4,display:"flex",alignItems:"flex-start",gap:3}),D.jsxs(Xt,{...m,position:"absolute",zIndex:"2",bottom:4,right:4,display:"flex",alignItems:"flex-start",gap:3,children:[r.showHelpButton&&D.jsx(G4e,{}),D.jsx(Q4e,{})]}),D.jsx(e3e,{}),D.jsx(t3e,{isOpen:N!==null,onClose:()=>{console.log(" Closing nameplate modal"),F()},playerName:(N==null?void 0:N.playerName)||"Unknown Player",playerId:(N==null?void 0:N.playerId)||"Unknown ID"}),D.jsx(n3e,{isVisible:G,onToggleVisibility:z})]})})})});mj.displayName="WebGLRenderer";mj.propTypes={settings:Mr.shape({urlLoadingBackground:Mr.string,showAuthButton:Mr.bool,showDisruptiveLogo:Mr.bool,urlDisruptiveLogo:Mr.string,showHelpButton:Mr.bool,enableVoiceChat:Mr.bool,spaceID:Mr.string})};const gj=({spaceID:r,overrideSettings:t})=>{const o=V.useRef(null),[a,l]=V.useState(!0),[d,m]=V.useState({spaceID:r,loaderUrl:"",dataUrl:"",frameworkUrl:"",codeUrl:""}),[v,y]=V.useState({urlDisruptiveLogo:"gs://disruptive-metaverse.appspot.com/common/images/Disruptive-logo-white-p-500.png",urlLoadingBackground:"",showDisruptiveLogo:null,showAuthButton:null,showHelpButton:null,enableVoiceChat:!0,spaceID:r});return V.useEffect(()=>{(async()=>{try{const R=await k4e(r);if(R){m(N=>({...N,spaceID:r,loaderUrl:R.loaderUrl,dataUrl:R.dataUrl,frameworkUrl:R.frameworkUrl,codeUrl:R.codeUrl}));const O=await Dre(v.urlDisruptiveLogo);y(N=>({...N,urlLoadingBackground:R.gsUrlLoadingBackground||"",showAuthButton:R.showAuthButton!==void 0?R.showAuthButton:!0,showDisruptiveLogo:R.showDisruptiveLogo!==void 0?R.showDisruptiveLogo:!0,showHelpButton:R.showHelpButton!==void 0?R.showHelpButton:!0,enableVoiceChat:R.enableVoiceChat!==void 0?R.enableVoiceChat:!0,urlDisruptiveLogo:O,spaceID:r,...t||{}})),l(!1)}else Ct.error(`WebGLLoader: No configuration found for spaceID: ${r}`)}catch(R){Ct.error("WebGLLoader: Error fetching space data:",R)}finally{l(!1)}})()},[r,v.urlDisruptiveLogo,t]),V.useEffect(()=>{a||(Ct.log("WebGLLoader: Unity config from Firebase",d),Ct.log("WebGLLoader: Space settings from Firebase",v))},[a]),D.jsx(D.Fragment,{children:a?D.jsx("div",{className:"flex justify-center items-center h-full mt-12",children:"Getting space data..."}):D.jsx(ABe,{...d,children:D.jsx(mj,{ref:o,settings:v})})})};gj.propTypes={spaceID:Mr.string.isRequired,overrideSettings:Mr.object};const UO=document.getElementById("webgl-root");if(UO){const r=UO.getAttribute("data-space-id"),t=UO.getAttribute("data-theme")||"default",o=()=>{const[a,l]=V.useState(null);return V.useEffect(()=>{Tw(t).then(l)},[]),a?D.jsx(wN,{theme:a,children:D.jsx(rk,{children:D.jsx(cj,{children:D.jsx(gj,{spaceID:r})})})}):D.jsx("div",{children:"Loading theme..."})};oN.createRoot(UO).render(D.jsx(o,{}))}else console.error("Root element 'webgl-root' not found.");const g3e=(r,t)=>{try{const o=Gne(Mm,`spaces/${r}/chatMessages`),a=new Date,l=Pje(o,Nje("timestamp","asc"),kje(a));return tre(l,d=>{const m=[];d.docChanges().forEach(v=>{if(v.type==="added"){const y=v.doc.data();console.log("Firestore document data:",y),m.push({id:v.doc.id,...y})}}),m.length>0&&t(m)})}catch(o){throw Ct.error("Error subscribing to space chat messages:",o),o}};function od(r){const t=Object.prototype.toString.call(r);return r instanceof Date||typeof r=="object"&&t==="[object Date]"?new r.constructor(+r):typeof r=="number"||t==="[object Number]"||typeof r=="string"||t==="[object String]"?new Date(r):new Date(NaN)}function ov(r,t){return r instanceof Date?new r.constructor(t):new Date(t)}const Kre=6048e5,_3e=864e5;let v3e={};function ck(){return v3e}function Lw(r,t){var v,y,b,R;const o=ck(),a=(t==null?void 0:t.weekStartsOn)??((y=(v=t==null?void 0:t.locale)==null?void 0:v.options)==null?void 0:y.weekStartsOn)??o.weekStartsOn??((R=(b=o.locale)==null?void 0:b.options)==null?void 0:R.weekStartsOn)??0,l=od(r),d=l.getDay(),m=(d<a?7:0)+d-a;return l.setDate(l.getDate()-m),l.setHours(0,0,0,0),l}function iN(r){return Lw(r,{weekStartsOn:1})}function $re(r){const t=od(r),o=t.getFullYear(),a=ov(r,0);a.setFullYear(o+1,0,4),a.setHours(0,0,0,0);const l=iN(a),d=ov(r,0);d.setFullYear(o,0,4),d.setHours(0,0,0,0);const m=iN(d);return t.getTime()>=l.getTime()?o+1:t.getTime()>=m.getTime()?o:o-1}function gX(r){const t=od(r);return t.setHours(0,0,0,0),t}function _X(r){const t=od(r),o=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()));return o.setUTCFullYear(t.getFullYear()),+r-+o}function E3e(r,t){const o=gX(r),a=gX(t),l=+o-_X(o),d=+a-_X(a);return Math.round((l-d)/_3e)}function y3e(r){const t=$re(r),o=ov(r,0);return o.setFullYear(t,0,4),o.setHours(0,0,0,0),iN(o)}function S3e(r){return r instanceof Date||typeof r=="object"&&Object.prototype.toString.call(r)==="[object Date]"}function T3e(r){if(!S3e(r)&&typeof r!="number")return!1;const t=od(r);return!isNaN(Number(t))}function b3e(r){const t=od(r),o=ov(r,0);return o.setFullYear(t.getFullYear(),0,1),o.setHours(0,0,0,0),o}const w3e={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},R3e=(r,t,o)=>{let a;const l=w3e[r];return typeof l=="string"?a=l:t===1?a=l.one:a=l.other.replace("{{count}}",t.toString()),o!=null&&o.addSuffix?o.comparison&&o.comparison>0?"in "+a:a+" ago":a};function l2(r){return(t={})=>{const o=t.width?String(t.width):r.defaultWidth;return r.formats[o]||r.formats[r.defaultWidth]}}const C3e={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},I3e={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},A3e={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},O3e={date:l2({formats:C3e,defaultWidth:"full"}),time:l2({formats:I3e,defaultWidth:"full"}),dateTime:l2({formats:A3e,defaultWidth:"full"})},P3e={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},N3e=(r,t,o,a)=>P3e[r];function vb(r){return(t,o)=>{const a=o!=null&&o.context?String(o.context):"standalone";let l;if(a==="formatting"&&r.formattingValues){const m=r.defaultFormattingWidth||r.defaultWidth,v=o!=null&&o.width?String(o.width):m;l=r.formattingValues[v]||r.formattingValues[m]}else{const m=r.defaultWidth,v=o!=null&&o.width?String(o.width):r.defaultWidth;l=r.values[v]||r.values[m]}const d=r.argumentCallback?r.argumentCallback(t):t;return l[d]}}const k3e={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},D3e={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},L3e={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},x3e={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},M3e={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},U3e={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},V3e=(r,t)=>{const o=Number(r),a=o%100;if(a>20||a<10)switch(a%10){case 1:return o+"st";case 2:return o+"nd";case 3:return o+"rd"}return o+"th"},F3e={ordinalNumber:V3e,era:vb({values:k3e,defaultWidth:"wide"}),quarter:vb({values:D3e,defaultWidth:"wide",argumentCallback:r=>r-1}),month:vb({values:L3e,defaultWidth:"wide"}),day:vb({values:x3e,defaultWidth:"wide"}),dayPeriod:vb({values:M3e,defaultWidth:"wide",formattingValues:U3e,defaultFormattingWidth:"wide"})};function Eb(r){return(t,o={})=>{const a=o.width,l=a&&r.matchPatterns[a]||r.matchPatterns[r.defaultMatchWidth],d=t.match(l);if(!d)return null;const m=d[0],v=a&&r.parsePatterns[a]||r.parsePatterns[r.defaultParseWidth],y=Array.isArray(v)?B3e(v,O=>O.test(m)):j3e(v,O=>O.test(m));let b;b=r.valueCallback?r.valueCallback(y):y,b=o.valueCallback?o.valueCallback(b):b;const R=t.slice(m.length);return{value:b,rest:R}}}function j3e(r,t){for(const o in r)if(Object.prototype.hasOwnProperty.call(r,o)&&t(r[o]))return o}function B3e(r,t){for(let o=0;o<r.length;o++)if(t(r[o]))return o}function W3e(r){return(t,o={})=>{const a=t.match(r.matchPattern);if(!a)return null;const l=a[0],d=t.match(r.parsePattern);if(!d)return null;let m=r.valueCallback?r.valueCallback(d[0]):d[0];m=o.valueCallback?o.valueCallback(m):m;const v=t.slice(l.length);return{value:m,rest:v}}}const G3e=/^(\d+)(th|st|nd|rd)?/i,z3e=/\d+/i,H3e={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},K3e={any:[/^b/i,/^(a|c)/i]},$3e={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},q3e={any:[/1/i,/2/i,/3/i,/4/i]},Y3e={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},X3e={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},J3e={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},Q3e={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},Z3e={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},e5e={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},t5e={ordinalNumber:W3e({matchPattern:G3e,parsePattern:z3e,valueCallback:r=>parseInt(r,10)}),era:Eb({matchPatterns:H3e,defaultMatchWidth:"wide",parsePatterns:K3e,defaultParseWidth:"any"}),quarter:Eb({matchPatterns:$3e,defaultMatchWidth:"wide",parsePatterns:q3e,defaultParseWidth:"any",valueCallback:r=>r+1}),month:Eb({matchPatterns:Y3e,defaultMatchWidth:"wide",parsePatterns:X3e,defaultParseWidth:"any"}),day:Eb({matchPatterns:J3e,defaultMatchWidth:"wide",parsePatterns:Q3e,defaultParseWidth:"any"}),dayPeriod:Eb({matchPatterns:Z3e,defaultMatchWidth:"any",parsePatterns:e5e,defaultParseWidth:"any"})},n5e={code:"en-US",formatDistance:R3e,formatLong:O3e,formatRelative:N3e,localize:F3e,match:t5e,options:{weekStartsOn:0,firstWeekContainsDate:1}};function r5e(r){const t=od(r);return E3e(t,b3e(t))+1}function i5e(r){const t=od(r),o=+iN(t)-+y3e(t);return Math.round(o/Kre)+1}function qre(r,t){var R,O,N,F;const o=od(r),a=o.getFullYear(),l=ck(),d=(t==null?void 0:t.firstWeekContainsDate)??((O=(R=t==null?void 0:t.locale)==null?void 0:R.options)==null?void 0:O.firstWeekContainsDate)??l.firstWeekContainsDate??((F=(N=l.locale)==null?void 0:N.options)==null?void 0:F.firstWeekContainsDate)??1,m=ov(r,0);m.setFullYear(a+1,0,d),m.setHours(0,0,0,0);const v=Lw(m,t),y=ov(r,0);y.setFullYear(a,0,d),y.setHours(0,0,0,0);const b=Lw(y,t);return o.getTime()>=v.getTime()?a+1:o.getTime()>=b.getTime()?a:a-1}function o5e(r,t){var v,y,b,R;const o=ck(),a=(t==null?void 0:t.firstWeekContainsDate)??((y=(v=t==null?void 0:t.locale)==null?void 0:v.options)==null?void 0:y.firstWeekContainsDate)??o.firstWeekContainsDate??((R=(b=o.locale)==null?void 0:b.options)==null?void 0:R.firstWeekContainsDate)??1,l=qre(r,t),d=ov(r,0);return d.setFullYear(l,0,a),d.setHours(0,0,0,0),Lw(d,t)}function s5e(r,t){const o=od(r),a=+Lw(o,t)-+o5e(o,t);return Math.round(a/Kre)+1}function ci(r,t){const o=r<0?"-":"",a=Math.abs(r).toString().padStart(t,"0");return o+a}const hm={y(r,t){const o=r.getFullYear(),a=o>0?o:1-o;return ci(t==="yy"?a%100:a,t.length)},M(r,t){const o=r.getMonth();return t==="M"?String(o+1):ci(o+1,2)},d(r,t){return ci(r.getDate(),t.length)},a(r,t){const o=r.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return o.toUpperCase();case"aaa":return o;case"aaaaa":return o[0];case"aaaa":default:return o==="am"?"a.m.":"p.m."}},h(r,t){return ci(r.getHours()%12||12,t.length)},H(r,t){return ci(r.getHours(),t.length)},m(r,t){return ci(r.getMinutes(),t.length)},s(r,t){return ci(r.getSeconds(),t.length)},S(r,t){const o=t.length,a=r.getMilliseconds(),l=Math.trunc(a*Math.pow(10,o-3));return ci(l,t.length)}},wy={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},vX={G:function(r,t,o){const a=r.getFullYear()>0?1:0;switch(t){case"G":case"GG":case"GGG":return o.era(a,{width:"abbreviated"});case"GGGGG":return o.era(a,{width:"narrow"});case"GGGG":default:return o.era(a,{width:"wide"})}},y:function(r,t,o){if(t==="yo"){const a=r.getFullYear(),l=a>0?a:1-a;return o.ordinalNumber(l,{unit:"year"})}return hm.y(r,t)},Y:function(r,t,o,a){const l=qre(r,a),d=l>0?l:1-l;if(t==="YY"){const m=d%100;return ci(m,2)}return t==="Yo"?o.ordinalNumber(d,{unit:"year"}):ci(d,t.length)},R:function(r,t){const o=$re(r);return ci(o,t.length)},u:function(r,t){const o=r.getFullYear();return ci(o,t.length)},Q:function(r,t,o){const a=Math.ceil((r.getMonth()+1)/3);switch(t){case"Q":return String(a);case"QQ":return ci(a,2);case"Qo":return o.ordinalNumber(a,{unit:"quarter"});case"QQQ":return o.quarter(a,{width:"abbreviated",context:"formatting"});case"QQQQQ":return o.quarter(a,{width:"narrow",context:"formatting"});case"QQQQ":default:return o.quarter(a,{width:"wide",context:"formatting"})}},q:function(r,t,o){const a=Math.ceil((r.getMonth()+1)/3);switch(t){case"q":return String(a);case"qq":return ci(a,2);case"qo":return o.ordinalNumber(a,{unit:"quarter"});case"qqq":return o.quarter(a,{width:"abbreviated",context:"standalone"});case"qqqqq":return o.quarter(a,{width:"narrow",context:"standalone"});case"qqqq":default:return o.quarter(a,{width:"wide",context:"standalone"})}},M:function(r,t,o){const a=r.getMonth();switch(t){case"M":case"MM":return hm.M(r,t);case"Mo":return o.ordinalNumber(a+1,{unit:"month"});case"MMM":return o.month(a,{width:"abbreviated",context:"formatting"});case"MMMMM":return o.month(a,{width:"narrow",context:"formatting"});case"MMMM":default:return o.month(a,{width:"wide",context:"formatting"})}},L:function(r,t,o){const a=r.getMonth();switch(t){case"L":return String(a+1);case"LL":return ci(a+1,2);case"Lo":return o.ordinalNumber(a+1,{unit:"month"});case"LLL":return o.month(a,{width:"abbreviated",context:"standalone"});case"LLLLL":return o.month(a,{width:"narrow",context:"standalone"});case"LLLL":default:return o.month(a,{width:"wide",context:"standalone"})}},w:function(r,t,o,a){const l=s5e(r,a);return t==="wo"?o.ordinalNumber(l,{unit:"week"}):ci(l,t.length)},I:function(r,t,o){const a=i5e(r);return t==="Io"?o.ordinalNumber(a,{unit:"week"}):ci(a,t.length)},d:function(r,t,o){return t==="do"?o.ordinalNumber(r.getDate(),{unit:"date"}):hm.d(r,t)},D:function(r,t,o){const a=r5e(r);return t==="Do"?o.ordinalNumber(a,{unit:"dayOfYear"}):ci(a,t.length)},E:function(r,t,o){const a=r.getDay();switch(t){case"E":case"EE":case"EEE":return o.day(a,{width:"abbreviated",context:"formatting"});case"EEEEE":return o.day(a,{width:"narrow",context:"formatting"});case"EEEEEE":return o.day(a,{width:"short",context:"formatting"});case"EEEE":default:return o.day(a,{width:"wide",context:"formatting"})}},e:function(r,t,o,a){const l=r.getDay(),d=(l-a.weekStartsOn+8)%7||7;switch(t){case"e":return String(d);case"ee":return ci(d,2);case"eo":return o.ordinalNumber(d,{unit:"day"});case"eee":return o.day(l,{width:"abbreviated",context:"formatting"});case"eeeee":return o.day(l,{width:"narrow",context:"formatting"});case"eeeeee":return o.day(l,{width:"short",context:"formatting"});case"eeee":default:return o.day(l,{width:"wide",context:"formatting"})}},c:function(r,t,o,a){const l=r.getDay(),d=(l-a.weekStartsOn+8)%7||7;switch(t){case"c":return String(d);case"cc":return ci(d,t.length);case"co":return o.ordinalNumber(d,{unit:"day"});case"ccc":return o.day(l,{width:"abbreviated",context:"standalone"});case"ccccc":return o.day(l,{width:"narrow",context:"standalone"});case"cccccc":return o.day(l,{width:"short",context:"standalone"});case"cccc":default:return o.day(l,{width:"wide",context:"standalone"})}},i:function(r,t,o){const a=r.getDay(),l=a===0?7:a;switch(t){case"i":return String(l);case"ii":return ci(l,t.length);case"io":return o.ordinalNumber(l,{unit:"day"});case"iii":return o.day(a,{width:"abbreviated",context:"formatting"});case"iiiii":return o.day(a,{width:"narrow",context:"formatting"});case"iiiiii":return o.day(a,{width:"short",context:"formatting"});case"iiii":default:return o.day(a,{width:"wide",context:"formatting"})}},a:function(r,t,o){const l=r.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return o.dayPeriod(l,{width:"abbreviated",context:"formatting"});case"aaa":return o.dayPeriod(l,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return o.dayPeriod(l,{width:"narrow",context:"formatting"});case"aaaa":default:return o.dayPeriod(l,{width:"wide",context:"formatting"})}},b:function(r,t,o){const a=r.getHours();let l;switch(a===12?l=wy.noon:a===0?l=wy.midnight:l=a/12>=1?"pm":"am",t){case"b":case"bb":return o.dayPeriod(l,{width:"abbreviated",context:"formatting"});case"bbb":return o.dayPeriod(l,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return o.dayPeriod(l,{width:"narrow",context:"formatting"});case"bbbb":default:return o.dayPeriod(l,{width:"wide",context:"formatting"})}},B:function(r,t,o){const a=r.getHours();let l;switch(a>=17?l=wy.evening:a>=12?l=wy.afternoon:a>=4?l=wy.morning:l=wy.night,t){case"B":case"BB":case"BBB":return o.dayPeriod(l,{width:"abbreviated",context:"formatting"});case"BBBBB":return o.dayPeriod(l,{width:"narrow",context:"formatting"});case"BBBB":default:return o.dayPeriod(l,{width:"wide",context:"formatting"})}},h:function(r,t,o){if(t==="ho"){let a=r.getHours()%12;return a===0&&(a=12),o.ordinalNumber(a,{unit:"hour"})}return hm.h(r,t)},H:function(r,t,o){return t==="Ho"?o.ordinalNumber(r.getHours(),{unit:"hour"}):hm.H(r,t)},K:function(r,t,o){const a=r.getHours()%12;return t==="Ko"?o.ordinalNumber(a,{unit:"hour"}):ci(a,t.length)},k:function(r,t,o){let a=r.getHours();return a===0&&(a=24),t==="ko"?o.ordinalNumber(a,{unit:"hour"}):ci(a,t.length)},m:function(r,t,o){return t==="mo"?o.ordinalNumber(r.getMinutes(),{unit:"minute"}):hm.m(r,t)},s:function(r,t,o){return t==="so"?o.ordinalNumber(r.getSeconds(),{unit:"second"}):hm.s(r,t)},S:function(r,t){return hm.S(r,t)},X:function(r,t,o){const a=r.getTimezoneOffset();if(a===0)return"Z";switch(t){case"X":return yX(a);case"XXXX":case"XX":return A_(a);case"XXXXX":case"XXX":default:return A_(a,":")}},x:function(r,t,o){const a=r.getTimezoneOffset();switch(t){case"x":return yX(a);case"xxxx":case"xx":return A_(a);case"xxxxx":case"xxx":default:return A_(a,":")}},O:function(r,t,o){const a=r.getTimezoneOffset();switch(t){case"O":case"OO":case"OOO":return"GMT"+EX(a,":");case"OOOO":default:return"GMT"+A_(a,":")}},z:function(r,t,o){const a=r.getTimezoneOffset();switch(t){case"z":case"zz":case"zzz":return"GMT"+EX(a,":");case"zzzz":default:return"GMT"+A_(a,":")}},t:function(r,t,o){const a=Math.trunc(r.getTime()/1e3);return ci(a,t.length)},T:function(r,t,o){const a=r.getTime();return ci(a,t.length)}};function EX(r,t=""){const o=r>0?"-":"+",a=Math.abs(r),l=Math.trunc(a/60),d=a%60;return d===0?o+String(l):o+String(l)+t+ci(d,2)}function yX(r,t){return r%60===0?(r>0?"-":"+")+ci(Math.abs(r)/60,2):A_(r,t)}function A_(r,t=""){const o=r>0?"-":"+",a=Math.abs(r),l=ci(Math.trunc(a/60),2),d=ci(a%60,2);return o+l+t+d}const SX=(r,t)=>{switch(r){case"P":return t.date({width:"short"});case"PP":return t.date({width:"medium"});case"PPP":return t.date({width:"long"});case"PPPP":default:return t.date({width:"full"})}},Yre=(r,t)=>{switch(r){case"p":return t.time({width:"short"});case"pp":return t.time({width:"medium"});case"ppp":return t.time({width:"long"});case"pppp":default:return t.time({width:"full"})}},a5e=(r,t)=>{const o=r.match(/(P+)(p+)?/)||[],a=o[1],l=o[2];if(!l)return SX(r,t);let d;switch(a){case"P":d=t.dateTime({width:"short"});break;case"PP":d=t.dateTime({width:"medium"});break;case"PPP":d=t.dateTime({width:"long"});break;case"PPPP":default:d=t.dateTime({width:"full"});break}return d.replace("{{date}}",SX(a,t)).replace("{{time}}",Yre(l,t))},c5e={p:Yre,P:a5e},l5e=/^D+$/,u5e=/^Y+$/,d5e=["D","DD","YY","YYYY"];function h5e(r){return l5e.test(r)}function f5e(r){return u5e.test(r)}function p5e(r,t,o){const a=m5e(r,t,o);if(console.warn(a),d5e.includes(r))throw new RangeError(a)}function m5e(r,t,o){const a=r[0]==="Y"?"years":"days of the month";return`Use \`${r.toLowerCase()}\` instead of \`${r}\` (in \`${t}\`) for formatting ${a} to the input \`${o}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const g5e=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,_5e=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,v5e=/^'([^]*?)'?$/,E5e=/''/g,y5e=/[a-zA-Z]/;function S5e(r,t,o){var R,O,N,F;const a=ck(),l=a.locale??n5e,d=a.firstWeekContainsDate??((O=(R=a.locale)==null?void 0:R.options)==null?void 0:O.firstWeekContainsDate)??1,m=a.weekStartsOn??((F=(N=a.locale)==null?void 0:N.options)==null?void 0:F.weekStartsOn)??0,v=od(r);if(!T3e(v))throw new RangeError("Invalid time value");let y=t.match(_5e).map(H=>{const G=H[0];if(G==="p"||G==="P"){const z=c5e[G];return z(H,l.formatLong)}return H}).join("").match(g5e).map(H=>{if(H==="''")return{isToken:!1,value:"'"};const G=H[0];if(G==="'")return{isToken:!1,value:T5e(H)};if(vX[G])return{isToken:!0,value:H};if(G.match(y5e))throw new RangeError("Format string contains an unescaped latin alphabet character `"+G+"`");return{isToken:!1,value:H}});l.localize.preprocessor&&(y=l.localize.preprocessor(v,y));const b={firstWeekContainsDate:d,weekStartsOn:m,locale:l};return y.map(H=>{if(!H.isToken)return H.value;const G=H.value;(f5e(G)||h5e(G))&&p5e(G,t,String(r));const z=vX[G[0]];return z(v,G,l.localize,b)}).join("")}function T5e(r){const t=r.match(v5e);return t?t[1].replace(E5e,"'"):r}const b5e=bh(Xt),Xre=({name:r,timestamp:t,text:o,isCurrentUser:a})=>{console.log("Message props:",{name:r,timestamp:t,text:o,isCurrentUser:a});const l=t&&t.toDate?S5e(t.toDate(),"HH:mm"):"Invalid date";return D.jsxs(b5e,{display:"flex",flexDirection:"column",alignItems:a?"flex-end":"flex-start",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},children:[D.jsxs(Xt,{w:"auto",maxW:"80%",bg:a?"secondary.500":"primary.200",color:a?"white":"black",p:"10px",borderRadius:"10px",alignSelf:a?"flex-end":"flex-start",wordBreak:"break-word",children:[D.jsx(pn,{fontWeight:"bold",children:r}),D.jsx(pn,{children:o})]}),D.jsx(pn,{color:"copy.light",fontSize:"xs",mt:"4px",mx:"6px",mb:"10px",textAlign:a?"right":"left",children:l})]})};Xre.propTypes={name:Mr.string.isRequired,timestamp:Mr.object,text:Mr.string.isRequired,isCurrentUser:Mr.bool.isRequired};const w5e=({spaceID:r})=>{const[t,o]=V.useState([]),{user:a}=V.useContext(wa),l=V.useRef(null);return V.useEffect(()=>{const d=g3e(r,m=>{console.log("New messages received:",m),o(v=>[...v,...m]),Ct.log("Messages updated:",m)});return()=>d()},[r]),V.useEffect(()=>{l.current&&l.current.scrollIntoView({behavior:"smooth"})},[t]),D.jsxs(Xt,{className:"messages-container",display:"flex",flexDirection:"column",my:"10px",overflowY:"auto",maxHeight:"80vh",children:[t.map(d=>{const m=d.uid===(a==null?void 0:a.uid);return D.jsx(Xre,{name:d.user,timestamp:d.timestamp,text:d.text,isCurrentUser:m},d.id)}),D.jsx("div",{ref:l})]})},R5e=({spaceID:r})=>{},Jre=({spaceID:r})=>{const{user:t}=V.useContext(wa);return t?D.jsxs(Xt,{children:[D.jsx(Xt,{height:"400px",overflowY:"auto",border:"1px solid #ccc",backgroundColor:"tertiaryAlpha.600",padding:"10px",children:D.jsx(w5e,{spaceID:r})}),D.jsx(Xt,{mt:"8px",children:D.jsx(R5e,{spaceID:r})})]}):(console.log("No user found, returning login message"),D.jsx(Xt,{children:D.jsx(pn,{children:"Please log in to view the chat."})}))},VO=document.getElementById("chat-root");if(VO){const r=VO.getAttribute("data-space-id"),t=VO.getAttribute("data-theme")||"default",o=()=>{const[a,l]=V.useState(null);return V.useEffect(()=>{Tw(t).then(l)},[]),a?D.jsx(wN,{theme:a,children:D.jsx(rk,{children:D.jsx(Jre,{spaceID:r})})}):D.jsx("div",{children:"Loading theme..."})};oN.createRoot(VO).render(D.jsx(o,{}))}else console.error("Root element 'chat-root' not found.");class C5e extends Component{constructor(t){super(t),this.state={hasError:!1}}static getDerivedStateFromError(t){return{hasError:!0}}componentDidCatch(t,o){console.error("WebGL Error:",t,o)}render(){return this.state.hasError?D.jsx(Xt,{p:4,bg:"red.100",color:"red.900",borderRadius:"md",children:D.jsx(pn,{children:"WebGL component error. Please refresh the page."})}):this.props.children}}const FO=document.getElementById("root");if(FO){const r=FO.getAttribute("data-space-id"),t=FO.getAttribute("data-theme")||"default",o=()=>{const[a,l]=V.useState(null),[d,m]=V.useState(!1);return V.useEffect(()=>{Tw(t).then(l);const v=()=>{document.hidden||Tw(t).then(l)};return document.addEventListener("visibilitychange",v),()=>{document.removeEventListener("visibilitychange",v)}},[]),a?D.jsx(wN,{theme:a,children:D.jsx(rk,{children:D.jsx(cj,{children:D.jsxs(Bo,{spacing:4,align:"stretch",children:[D.jsxs(Ic,{justify:"space-between",align:"center",p:4,bg:"gray.700",m:0,position:"relative",zIndex:"100",children:[D.jsx(pn,{fontSize:"xl",fontWeight:"bold",color:"white",children:"LOGO"}),D.jsx(Xt,{zIndex:"100",position:"relative",children:D.jsx(_re,{})})]}),D.jsx(tP,{maxW:"container.xl",p:0,zIndex:"1",children:D.jsx(JZ,{ratio:16/9,bg:"blue.100",m:0,children:D.jsx(Xt,{id:"webgl-root","data-space-id":r,w:"100%",m:0,children:D.jsx(C5e,{children:D.jsx(gj,{spaceID:r})})})})}),D.jsxs(tP,{maxW:"container.xl",p:2,children:[D.jsx(Nc,{size:"sm",colorScheme:"blue",onClick:()=>m(!d),children:d?"Hide Voice Chat Debug":"Show Voice Chat Debug"}),d&&D.jsx(Xt,{mt:2,p:3,borderWidth:"1px",borderRadius:"md",bg:"gray.50",children:D.jsx(AgoraProvider,{appId:"130dccf9b3554bda87f8cf577f91c8c4",channel:r||"default-channel",children:D.jsx(VoiceChatDebugPanel,{})})})]}),D.jsx(tP,{maxW:"container.xl",p:0,children:D.jsx(Jre,{spaceID:r})})]})})})}):D.jsx("div",{children:"Loading theme..."})};oN.createRoot(FO).render(D.jsx(o,{}))}else console.error("Root element 'root' not found.");export{Qve as a,Yve as b,Ri as c,A5e as d,I5e as e,Bve as f,nd as i,sh as m,Dbe as t};
